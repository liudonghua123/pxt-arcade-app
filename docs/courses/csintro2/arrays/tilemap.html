<!DOCTYPE html>
<html lang="" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
	xmlns:fb="http://www.facebook.com/2008/fbml">

<head>
	<meta charset="UTF-8">
	<title>Microsoft MakeCode Arcade</title>
	<meta name="Description" content="Develop your programming skills by quickly creating and modding retro arcade games with Blocks and JavaScript in the MakeCode editor" />

	<!-- ifdef incontexttranslations endif -->
	
<!-- include meta.html -->
<!-- This file is typically overriden by the target, with own Twitter
     account etc. Most data is taken from the theme file though.  
  -->

<!-- include robotsmeta.html -->

<!-- end include robotsmeta.html -->

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@msmakecode" />
<meta name="twitter:title" content="Microsoft MakeCode Arcade" />
<meta name="twitter:description" content="Develop your programming skills by quickly creating and modding retro arcade games with Blocks and JavaScript in the MakeCode editor" />
<meta name="twitter:image" content="/static/thumbnail_play_video.png" />

<meta property="og:title" content="Microsoft MakeCode Arcade" />
<meta property="og:site_name" content="Microsoft MakeCode" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Develop your programming skills by quickly creating and modding retro arcade games with Blocks and JavaScript in the MakeCode editor" />
<meta property="fb:app_id" content="" />
<meta property="og:image" content="/static/thumbnail_play_video.png" />

<meta name="format-detection" content="telephone=no">
<link rel="apple-touch-icon" href="docs/static/icons/favicon.ico">
<link rel="icon" type="image/png" href="docs/static/icons/favicon.ico">
<link rel="shortcut icon" href="docs/static/icons/favicon.ico">
<meta name="theme-color" content="">

<!-- end include meta.html -->

	
<!-- include head.html -->
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">

<link rel="stylesheet" data-rtl="/blb/rtlsemantic.css" href="/pxt-arcade-app/semantic.css" />
<link id="blocklycss"  data-rtl="/blb/rtlblockly.css" rel="stylesheet" href="/pxt-arcade-app/blockly.css" />
<link rel="stylesheet" href="/pxt-arcade-app/docfiles/style.css" />
<link rel="stylesheet" href="/pxt-arcade-app/docfiles/vs.css" />
<link rel="stylesheet" href="/pxt-arcade-app/docfiles/target.css" />

<script src="/pxt-arcade-app/jquery.js" type="text/javascript"></script>
<script src="/pxt-arcade-app/semantic.js" type="text/javascript"></script>
<script src="/pxt-arcade-app/docfiles/target.js" type="text/javascript"></script>
<script src="/pxt-arcade-app/embed.js" type="text/javascript"></script>
<script src="/pxt-arcade-app/docfiles/docs.js" type="text/javascript"></script>

<style>
    
</style>

<!-- end include head.html -->


</head>

<body id='root' class='root'>
	<div id="accessibleMenu" class="ui accessibleMenu borderless fixed menu docs" role="menubar">
		
            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">Skip to main content</a>
        
	</div>

	
<!-- include tocheader.html -->
<div id="top-bar" class="ui fixed accent borderless inverted main menu hideprint docs" role="menubar">
    <div>
        
            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="Side menu" role="menuitem" aria-expanded="false">
                <i class="content icon"></i>
            </a>
        
        <div class="item" role="menuitem">
            <div class="header-org-logo">
                <img src="/static/logo/Microsoft_logo_rgb_W-white_D.png" alt="Microsoft">
            </div>
            <div class="header-org-logo-sm">
                <img src="/static/logo/Microsoft_logo_rgb_W-white_D-square.png" alt="Microsoft">
            </div>
            <div class="header-title"><span>MakeCode</span></div>
        </div>
    </div>
    <div>
        <div class="item">
            <form id="tocsearch1" class="search" role="form" method="get" action="https://www.bing.com/search">
                <div class="ui fluid icon input">
                    <input type="hidden" name="q1" value="site:https://arcade.makecode.com/" />
                    
                <input type="search" name="q" placeholder="Search..." aria-label="Search Documentation">
                <i onclick="document.getElementById('tocsearch1').submit();" tabindex="0" class="search link icon" aria-label="Search" role="button"></i>
            
                </div>
            </form>
        </div>
    </div>
</div>

<div id="side-menu" class="ui vertical accent inverted sidebar menu left hideprint docs" role="menubar">
    <!-- TOC Menu (tocheader.html) -->
    <div class="menuContainer" role="menu">
        
    <a class="item " href="/pxt-arcade-app/docs/about.html" role="menuitem">About</a>


    <a class="item " href="/pxt-arcade-app/docs/faq.html" role="menuitem">FAQ</a>


    <a class="item " href="/pxt-arcade-app/docs/projects.html" role="menuitem">Projects</a>


    <a class="item " href="/pxt-arcade-app/docs/github.html" role="menuitem">GitHub</a>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/reference.html">Reference</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/reference/sprites.html" role="menuitem">sprites</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/controller.html" role="menuitem">controller</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/game.html" role="menuitem">game</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/music.html" role="menuitem">music</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/scene.html" role="menuitem">scene</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/info.html" role="menuitem">info</a>


    <a class="item " href="/pxt-arcade-app/docs/reference/images.html" role="menuitem">images</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/blocks.html">Blocks</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/blocks/on-start.html" role="menuitem">On Start</a>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/blocks/loops.html">Loops</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/blocks/loops/repeat.html" role="menuitem">repeat</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/loops/for.html" role="menuitem">for</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/loops/while.html" role="menuitem">while</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/loops/for-of.html" role="menuitem">for of</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/blocks/logic.html">Logic</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/blocks/logic/if.html" role="menuitem">if</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/logic/boolean.html" role="menuitem">Boolean</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/blocks/variables.html">Variables</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/blocks/variables/assign.html" role="menuitem">assign</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/variables/change.html" role="menuitem">change var</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/variables/var.html" role="menuitem">var</a>

        </div>
    </div>


    <a class="item " href="/pxt-arcade-app/docs/blocks/math.html" role="menuitem">Math</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/javascript-blocks.html" role="menuitem">JavaScript blocks</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks/custom.html" role="menuitem">Custom blocks</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/python.html">Python</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/python/call.html" role="menuitem">Calling</a>


    <a class="item " href="/pxt-arcade-app/docs/python/sequence.html" role="menuitem">Sequencing</a>


    <a class="item " href="/pxt-arcade-app/docs/python/variables.html" role="menuitem">Variables</a>


    <a class="item " href="/pxt-arcade-app/docs/python/operators.html" role="menuitem">Operators</a>


    <a class="item " href="/pxt-arcade-app/docs/python/statements.html" role="menuitem">Statements</a>


    <a class="item " href="/pxt-arcade-app/docs/python/functions.html" role="menuitem">Functions</a>


    <a class="item " href="/pxt-arcade-app/docs/python/classes.html" role="menuitem">Classes</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/javascript.html">JavaScript</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/javascript/call.html" role="menuitem">Calling</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/sequence.html" role="menuitem">Sequencing</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/variables.html" role="menuitem">Variables</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/operators.html" role="menuitem">Operators</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/statements.html" role="menuitem">Statements</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/functions.html" role="menuitem">Functions</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/types.html" role="menuitem">Types</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/classes.html" role="menuitem">Classes</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/interfaces.html" role="menuitem">Interfaces</a>


    <a class="item " href="/pxt-arcade-app/docs/javascript/generics.html" role="menuitem">Generics</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/types.html">Types</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/types/number.html" role="menuitem">Number</a>


    <a class="item " href="/pxt-arcade-app/docs/types/string.html" role="menuitem">String</a>


    <a class="item " href="/pxt-arcade-app/docs/types/boolean.html" role="menuitem">Boolean</a>


    <a class="item " href="/pxt-arcade-app/docs/types/array.html" role="menuitem">Array</a>


    <a class="item " href="/pxt-arcade-app/docs/types/function.html" role="menuitem">Function</a>


    <a class="item " href="/pxt-arcade-app/docs/types/image.html" role="menuitem">Image</a>


    <a class="item " href="/pxt-arcade-app/docs/types/sprite.html" role="menuitem">Sprite</a>

        </div>
    </div>


    <a class="item " href="/pxt-arcade-app/docs/block-gallery.html" role="menuitem">Blocks Gallery</a>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="">Miscellaneous</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/about.html" role="menuitem">About</a>


    <a class="item " href="/pxt-arcade-app/docs/support.html" role="menuitem">Support</a>


    <a class="item " href="/pxt-arcade-app/docs/translate.html" role="menuitem">Translate</a>


    <a class="item " href="/pxt-arcade-app/docs/share.html" role="menuitem">Sharing projects</a>


    <a class="item " href="/pxt-arcade-app/docs/multiplayer.html" role="menuitem">Multiplayer</a>


    <a class="item " href="/pxt-arcade-app/docs/offline.html" role="menuitem">Offline support</a>


    <a class="item " href="/pxt-arcade-app/docs/save.html" role="menuitem">Save</a>


    <a class="item " href="/pxt-arcade-app/docs/identity/sign-in.html" role="menuitem">Sign In</a>


    <a class="item " href="/pxt-arcade-app/docs/identity/cloud-sync.html" role="menuitem">Cloud Sync</a>


    <a class="item " href="/pxt-arcade-app/docs/vscode.html" role="menuitem">VS Code</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/hardware.html">Hardware</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/hardware/errors.html" role="menuitem">Errors</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/adding.html" role="menuitem">Adding New Board</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/raspberry-pi.html" role="menuitem">Raspberry Pi</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/makey-makey.html" role="menuitem">Makey Makey</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/shoebox-controller.html" role="menuitem">Shoebox Controller</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/dev.html" role="menuitem">Dev</a>


    <a class="item " href="/pxt-arcade-app/docs/hardware/dbg.html" role="menuitem">Debug connector</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="">Developers</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/cli.html" role="menuitem">Command Line Interface</a>


    <a class="item " href="/pxt-arcade-app/docs/code.html" role="menuitem">Visual Studio Code support</a>


    <a class="item " href="/pxt-arcade-app/docs/blocks-embed.html" role="menuitem">Blocks Embed</a>


    <a class="item " href="/pxt-arcade-app/docs/developer/images.html" role="menuitem">Art, images, colors</a>


    <a class="item " href="/pxt-arcade-app/docs/developer/sound.html" role="menuitem">Sounds</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/lessons.html">Lessons</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/lessons/cherry-pickr.html" role="menuitem">Cherry Pickr</a>


    <a class="item " href="/pxt-arcade-app/docs/lessons/barrel-dodger.html" role="menuitem">Barrel Dodger</a>


    <a class="item " href="/pxt-arcade-app/docs/lessons/dance-party.html" role="menuitem">Dance Party</a>


    <a class="item " href="/pxt-arcade-app/docs/lessons/block-out.html" role="menuitem">BlockOut</a>

        </div>
    </div>


    <div class="ui  accordion item visible" role="tree" title="">
        <div class=" title">
            <i class="right chevron icon"></i>
            <a class="header" role="treeitem" aria-expanded="false" href="/pxt-arcade-app/docs/courses.html">Courses</a>
        </div>
        <div class=" content">
            
    <a class="item " href="/pxt-arcade-app/docs/courses/csintro1.html" role="menuitem">CS Intro 1</a>


    <a class="item " href="/pxt-arcade-app/docs/courses/csintro2.html" role="menuitem">CS Intro 2</a>


    <a class="item " href="/pxt-arcade-app/docs/courses/csintro3.html" role="menuitem">CS Intro 3</a>

        </div>
    </div>

    </div>
</div>
<!-- end include tocheader.html -->


	<div id="docs" class="pusher">

		<div class="article" id="maincontent">
			<div class="article-inner">

				
<!-- include header.html -->
<div class="ui one column padded grid hideprint">
    <div class="column ui container">
        
    </div>
</div>
<!-- end include header.html -->


				<div class="main ui container fluid mainbody">
					<button id="printbtn" class="circular ui icon right floated button hideprint hidemobile"
						title="Print" aria-label="Print">
						<i class="icon print"></i>
					</button>
					
    <div class="ui text">
        <h1 id="activity-tilemaps-and-arrays">Activity: Tilemaps and arrays</h1><p>Creating interactive and compelling levels relies on the proper placement of both enemies and resources. Interacting with individual tiles allows for easier and more consistent set up of levels, and provides an easy way to form multiple scenes</p>
<p>In this activity, students will:</p>
<ul>
<li>Use tilemap <code>||scene:tiles||</code> features</li>
<li>Set up a level using the tilemap</li>
<li>Create a ‘trap room’</li>
<li>Create a series of multiple levels</li>
</ul>

    <div class="ui info message">
        <div class="content">
            <h4 id="color-coded-tilemap">Color Coded Tilemap</h4><p>This section uses the color coded tilemap in some of the examples.</p>
<p>These were the original style of tilemaps, that got replaced with new blocks prior to the release of arcade.
The new blocks show the tilemap in full as you draw it, allow more tiles at once, and let you set tiles as walls without changing the image.</p>
<p>If you open any example using the edit button, the extension will be automatically added to the project.</p>
<p>If you wish to use these blocks in another project, they can be added using the <code>color-coded-tilemap</code> extension.</p>

        </div>
    </div>
<pre><code class="lang-package">color-coded-tilemap</code></pre>
<h2 id="concept-tiles">Concept: Tiles</h2><p><a target="_blank" rel="nofollow noopener" href="https://aka.ms/40546a-array-tile1"><img class="ui image" src="/static/thumbnail_play_video.png" alt="Link to Video" loading="lazy"></a></p>
<h2 id="example-1-getting-and-using-tiles">Example #1: Getting and Using Tiles</h2><ol>
<li>Review the code below</li>
<li>Create the sample code and run the code</li>
<li>Save the code for the task (name it “Get Out Of Jail Free Button”)</li>
</ol>
<pre><code class="lang-blocks">let myTile: tiles.Tile = null
let mySprite: Sprite = null
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    myTile = scene.getTile(0, 0)
    myTile.place(mySprite)
})
mySprite = sprites.create(img`
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . . . . . . . . . . . . .
. f f . . . . . . . . f f . . .
. . f . . . . . . . . f . . . .
. . f f . . . . . . f f . . . .
. . . . f f f f f f . . . . . .
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
`, SpriteKind.Player)
controller.moveSprite(mySprite, 100, 100)
scene.setTileMap(img`
1 1 1 1 1 1 1 1 1 1
1 2 2 2 2 2 2 2 2 1
1 2 5 5 5 5 5 5 2 1
1 2 5 3 3 3 3 5 2 1
1 2 5 3 3 3 3 5 2 1
1 2 5 5 5 5 5 5 2 1
1 2 2 2 2 2 2 2 2 1
1 1 1 1 1 1 1 1 1 1
`)
scene.setTile(2, img`
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 . . . . . . . . . . 2 2 2
2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
2 2 2 . . . . . . . . . . 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
`, true)</code></pre>
<p>In this example, there are two new blocks being used: <code>||scene:tile col 0 row 0||</code> and <code>||scene: on top of myTile place mySprite||</code>.</p>
<p>The <code>||scene:tile col 0 row 0||</code> block obtains the tile at the given column and row in the tilemap, starting from 0. This corresponds to the individual pixels in the map itself - opening the image editor and hovering over a pixel will show it’s column and row next the dimensions, in the form <code>column, row</code>.</p>
<p><img class="ui image" src="/static/courses/csintro2/arrays/finding-col-row.gif" alt="Finding column and row" loading="lazy"></p>
<p>The <code>||scene:on top of myTile place mySprite||</code> allows for sprites to be placed centered on top of a tile. In the <code>||controller:on A button pressed||</code> event, this is used to teleport <code>||variables:mySprite||</code> out of the walls that it is trapped within.</p>
<h2 id="student-task-1-placing-sprites">Student Task #1: Placing Sprites</h2><ol>
<li>Start with the code from example #1</li>
<li>Create 3 new sprites</li>
<li>Placing them in the upper right, bottom left, and bottom right corners of the screen using the <code>||scene:on top of myTile place mySprite||</code> block</li>
</ol>
<h2 id="example-2a-setting-tiles">Example #2a: Setting Tiles</h2><ol>
<li>Review the code below</li>
<li>Create the sample code and run the code</li>
<li>Save the code for the task (name it “Random Maze”)</li>
</ol>
<pre><code class="lang-blocks">scene.onHitTile(SpriteKind.Player, 7, function (sprite) {
    game.over(true)
})
scene.setTileMap(img`
    1 1 1 1 1 1 1 1 1 1
    f f f f f f f f f f
    1 1 1 1 1 1 1 1 1 1
    f f f f f f f f f f
    1 1 1 1 1 1 1 1 1 1
    1 f f f f f f f f 1
    1 1 1 f 7 7 7 f 1 1
    1 1 1 f 1 1 1 f 1 1
`)
let mySprite = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . f . . . . f . . . . . .
    . . . . . . . . . . . . . . . .
    . f f . . . . . . . . f f . . .
    . . f . . . . . . . . f . . . .
    . . f f . . . . . . f f . . . .
    . . . . f f f f f f . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`, SpriteKind.Player)
scene.cameraFollowSprite(mySprite)
controller.moveSprite(mySprite, 100, 100)
scene.setTile(15, img`
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
    2 2 2 . . . . . . . . . . 2 2 2
    2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
    2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
    2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
    2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
    2 2 2 . . . . . . . . . . 2 2 2
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
`, true)
scene.setTile(7, img`
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
    7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
`, true)
scene.getTile(5, 0).place(mySprite)
scene.setTileAt(scene.getTile(randint(0, 9), 1), 1)
scene.setTileAt(scene.getTile(randint(0, 9), 3), 1)
if (Math.percentChance(50)) {
    scene.setTileAt(scene.getTile(3, 7), 1)
} else {
    scene.setTileAt(scene.getTile(7, 7), 1)
}</code></pre>
<p>This example sets two random tiles from the first two rows of walls to be tiles with <code>||scene:wall off||</code>, allowing the player to move through them freely. Because there are only two ‘entrances’ to the goal, it chooses between those two entrances with a fifty percent chance and removes the chosen wall.</p>
<h2 id="example-2b-code-scene-array-of-all-tiles-code-">Example #2b: <code>||scene:array of all tiles||</code></h2><ol>
<li>Review the code below</li>
<li>Create the sample code and run the code</li>
<li>Save the code for the task (name it “set up”)</li>
</ol>
<pre><code class="lang-blocks">namespace SpriteKind {
    export const Pizza = SpriteKind.create();
}
let pizza: Sprite = null
let tile_list: tiles.Tile[] = []
let mySprite: Sprite = null
scene.onHitTile(SpriteKind.Player, 7, function (sprite) {
    game.over(true)
})
scene.setTileMap(img`
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
f f f f f f f f f f f f f f f f
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
f f f f f f f f f f f f f f f f
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
1 1 1 f f f f f 1 1 1 1 1 1 1 1
1 1 1 f 7 7 7 f 1 1 1 1 1 1 1 1
1 1 1 f 1 1 1 f 1 1 1 1 1 1 2 1
1 1 1 f 1 1 1 f 1 1 1 1 1 2 1 1
1 1 1 f 9 9 9 f 1 1 1 1 1 1 1 1
1 1 2 2 1 1 1 2 2 1 2 1 1 1 1 1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
1 2 1 1 1 2 1 1 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
`)
mySprite = sprites.create(img`
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . f . . . . f . . . . . .
. . . . . . . . . . . . . . . .
. f f . . . . . . . . f f . . .
. . f . . . . . . . . f . . . .
. . f f . . . . . . f f . . . .
. . . . f f f f f f . . . . . .
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
`, SpriteKind.Player)
scene.cameraFollowSprite(mySprite)
controller.moveSprite(mySprite, 100, 100)
scene.setTile(15, img`
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 . . . . . . . . . . 2 2 2
2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . 2 2 2 2 2 2 2 2 2 2 2 2 . 2
2 . . 2 2 2 2 2 2 2 2 2 2 . . 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
2 2 2 . 2 2 2 2 2 2 2 2 . 2 2 2
2 2 2 . . . . . . . . . . 2 2 2
2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
`, true)
scene.setTile(7, img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 f f f 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
`, true)
scene.setTileAt(scene.getTile(randint(0, 15), 1), 1)
scene.setTileAt(scene.getTile(randint(0, 15), 3), 1)
scene.getTile(5, 0).place(mySprite)
tile_list = scene.getTilesByType(9)
for (let value of tile_list) {
    pizza = sprites.create(img`
. . . . . . b b b b . . . . . .
. . . . . . b 4 4 4 b . . . . .
. . . . . . b b 4 4 4 b . . . .
. . . . . b 4 b b b 4 4 b . . .
. . . . b d 5 5 5 4 b 4 4 b . .
. . . . b 3 2 3 5 5 4 e 4 4 b .
. . . b d 2 2 2 5 7 5 4 e 4 4 e
. . . b 5 3 2 3 5 5 5 5 e e e e
. . b d 7 5 5 5 3 2 3 5 5 e e e
. . b 5 5 5 5 5 2 2 2 5 5 d e e
. b 3 2 3 5 7 5 3 2 3 5 d d e 4
. b 2 2 2 5 5 5 5 5 5 d d e 4 .
b d 3 2 d 5 5 5 d d d 4 4 . . .
b 5 5 5 5 d d 4 4 4 4 . . . . .
4 d d d 4 4 4 . . . . . . . . .
4 4 4 4 . . . . . . . . . . . .
`, SpriteKind.Pizza)
    value.place(pizza)
}</code></pre>
<h2 id="student-task-2-spawning-enemies">Student Task #2: Spawning Enemies</h2><ol>
<li>Start with the code from example #2b</li>
<li>Add an <code>||scene:array of all tiles||</code> block to create an <code>||arrays:array||</code> of all of the red tiles</li>
<li>Use a <code>||loops:for element value in||</code> loop to loop through each tile and place an ‘enemy’ on top of each red tile</li>
<li>Add an <code>||sprites:on overlap||</code> event between the enemies and the player that causes the game to be over</li>
<li><strong>Challenge:</strong> add another row of walls, and pick one at random to change into a non-wall tile. Are there any rows in which choosing randomly might make the game impossible, or too easy?</li>
</ol>
<h2 id="concept-multiple-levels">Concept: Multiple Levels</h2><p>Using the concepts from tasks #1 and #2, the development of multi-level games becomes much easier. This is can be done by creating an array of tilemaps and transitioning through the levels, while using the blocks discussed earlier in this activity to help set up and move through the levels.</p>
<p><a target="_blank" rel="nofollow noopener" href="https://aka.ms/40546a-array-tile2"><img class="ui image" src="/static/thumbnail_play_video.png" alt="Link to Video" loading="lazy"></a></p>
<h2 id="example-3-multiple-tilemaps">Example #3: Multiple Tilemaps</h2><ol>
<li>Review the code below</li>
<li>Create the sample code and run the code</li>
<li>Save the code for the task (name it “move levels”)</li>
</ol>
<pre><code class="lang-blocks">let player: Sprite = null
let nextLevel = 0
let levels: Image[] = []
scene.onHitTile(SpriteKind.Player, 7, function (sprite) {
    buildLevel()
})
function buildLevel() {
    if (nextLevel == levels.length) {
        game.over(true)
    }
    scene.setTileMap(levels[nextLevel])
    for (let value of scene.getTilesByType(4)) {
        value.place(player)
    }
    nextLevel += 1
}
levels = [img`
f f f f f f f f f f
f f f f f f f f f f
f f f f f f f f f f
f 4 f f f f f f 7 f
f f f f f f f f f f
f f f f f f f f f f
f f f f f f f f f f
f f f f f f f f f f
`, img`
9 9 9 9 9 9 9 9 9 9
9 9 9 9 9 9 9 9 9 9
9 9 9 9 9 9 9 9 9 9
9 4 9 9 9 9 9 9 7 9
9 9 9 9 9 9 9 9 9 9
9 9 9 9 9 9 9 9 9 9
9 9 9 9 9 9 9 9 9 9
9 9 9 9 9 9 9 9 9 9
`, img`
3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3
3 4 3 3 3 3 3 3 7 3
3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3
3 3 3 3 3 3 3 3 3 3
`]
scene.setTile(7, img`
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 f 7 7 7 7 f 7 7 7 7 7 7
7 7 7 7 f 7 7 7 7 f 7 7 7 7 7 7
7 7 7 7 f 7 7 7 7 f 7 7 7 7 7 7
7 7 7 7 f 7 7 7 7 f 7 7 7 7 7 7
7 7 7 7 f 7 7 7 7 f 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 f 7 7 7 7 7 7 7 7 f f 7 7 7
7 7 7 f f 7 7 7 7 7 7 f 7 7 7 7
7 7 7 7 f f 7 7 7 7 f f 7 7 7 7
7 7 7 7 7 f f f f f f 7 7 7 7 7
7 7 7 7 7 7 7 f f 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
`, true)
nextLevel = 0
player = sprites.create(img`
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
. . . 2 2 2 2 2 . . . . . . . .
. . 2 2 . . . 2 2 . . . . . . .
. . 2 . 7 . 7 . 2 . . . . . . .
. . 2 2 . . . 2 2 . . . . . . .
. . . 2 2 2 2 2 . . . . . . . .
. . . . . 2 . . . . . . . . . .
. . . . . 2 . . . . . . . . . .
. . . 2 2 2 2 2 . . . . . . . .
. . . . . 2 . . . . . . . . . .
. . . . . 2 . . . . . . . . . .
. . . . 2 2 2 . . . . . . . . .
. . . 2 2 . 2 2 . . . . . . . .
. . . . . . . . . . . . . . . .
. . . . . . . . . . . . . . . .
`, SpriteKind.Player)
controller.moveSprite(player, 100, 100)
buildLevel()</code></pre>
<p>In this example, the <code>||functions:buildLevel||</code> function is used to move from one level in the <code>||variables:levels||</code> array to another, until the player reaches the last level and wins. The player is placed on top of the orange tile each time, and the <code>||variables:nextLevel||</code> counter is incremented as well, so that the levels change each time <code>||functions:buildLevel||</code> is called.</p>
<h2 id="student-task-3-fill-out-levels">Student Task #3: Fill out levels</h2><ol>
<li>Start with the code from example #3</li>
<li>For each level in the <code>||variables:levels||</code> array, add in obstacles to prevent the player from finishing - without making the level impossible (hint: if you want to place enemies each time a level is created, add to the <code>||functions:buildLevel||</code> function. If you do place enemies, remember to destroy them using <code>||sprites:array of sprites of kind||</code> before moving to the next level!)</li>
<li><strong>Challenge:</strong> try adding new levels to the array. What happens if you don’t place an orange tile? Does anything else need to be changed when a level is added?</li>
</ol>
<h2 id="what-did-we-learn-">What did we learn?</h2><ol>
<li>How do the tilemap blocks introduced in this lesson make it easier to set up a level?</li>
<li>In this lesson, were there any times in which a level accidentally became too hard or impossible to complete? Explain how this might happen when adding randomness to levels.</li>
</ol>
<h3 id="-a-rel-nofollow-noopener-href-courses-csintro2-about-teachers-teacher-material-a-"><a  rel="nofollow noopener" href="/pxt-arcade-app/docs/courses/csintro2/about/teachers.html">Teacher Material</a></h3>
    </div>

					<div class="hideprint"></div>
				</div>

			</div>

			
<!-- include footer.html -->
<footer class="ui vertical footer segment hideprint docs inverted" aria-hidden="false">
    <div class="ui center aligned container">
        <div class="ui horizontal link list">
            <a
                class="item"
                href="https://twitter.com/intent/follow?screen_name=MsMakeCode"
                title="Follow us on Twitter"
                target="_blank"
                rel="noopener">
                <i class="huge icon twitter"></i>
            </a>
            <a class="item" href="https://www.youtube.com/channel/UCye7YlvFUUQ1dSy0WZZ1T_Q" title="Subscribe to our YouTube channel"
                target="_blank" rel="noopened">
                <i class="huge icon youtube"></i>
            </a>
            <a class="item" href="mailto:makecode@microsoft.com" title="Send us an Email"
                target="_blank" rel="noopened">
                <i class="huge icon mail"></i>
            </a>
        </div>
        <div class="ui section divider"></div>
        <div class="ui container horizontal small divided link list">
            <a id="langpicker" tabindex="0" class="ui item" rel="noopener">
                <i class="icon xicon globe" aria-hidden="true" role="presentation"></i>Language
            </a>
            <a class="item" href="https://makecode.com/privacy" target="_blank" rel="noopener">Privacy &amp; Cookies</a>
            <a class="item" href="https://makecode.com/termsofuse" target="_blank" rel="noopener">Terms Of Use</a>
            <a class="item" href="https://makecode.com/trademarks" target="_blank" rel="noopener">Trademarks</a>
            <span class="item">© 2022 Microsoft</span>
        </div>
        <div class="ui container horizontal small link list poweredBy">
            <span class="item">Powered by</span>
            <a class="middle aligned" href="https://makecode.com/" title="Microsoft MakeCode"
                target="_blank" rel="noopener">
                <img width="100" src="/static/logo/Microsoft-logo_rgb_c-gray.png" alt="Microsoft">
            </a>
        </div>
    </div>
</footer>

<!-- end include footer.html -->


		</div>

	</div>

    
<!-- include langpicker.html -->
<div id="langmodal" class="ui modal docs" role="dialog" aria-modal="true" aria-describedby="langmodalheader" tabindex="-1">
    <h2 id="langmodalheader" class="header">Select Language</h2>
    <div role="button" class="closeIcon" tabindex="0" aria-label="Close">
        <i class="icon close remove circle" aria-hidden="true"></i>
    </div>

	<div class="content">
	    <div class="group">
            <div id="availablelocales" class="ui cards centered" role="listbox" aria-label="List of available locales"></div>
        </div>
        <div class="ui" id="langmodalfooter">
            <a class="ui" href="/pxt-arcade-app/docs/translate.html" target="_blank" rel="noopener noreferrer">
                How do I add a new language?
            </a>

            <a id="translatebtn" class="ui button" role="button" tabindex="0">
                Translate this page
            </a>
        </div>
    </div>
</div>


<!-- end include langpicker.html -->

	
<!-- include macros.html -->
<!-- macro button -->

<!-- macro vimeo -->

<!-- macro youtube -->

<!-- macro section -->

<!-- macro hide -->

<!-- macro avatar -->

<!-- macro hint -->

<!-- macro codecard -->

<!-- macro tutorialhint -->

<!-- macro reminder -->

<!-- macro alert -->

<!-- macro tip -->

<!-- wrapped around ordinary content -->
<!-- macro main-container -->

<!-- used for 'column' box - they are collected and wrapped in 'column-container' -->
<!-- macro column -->
<!-- macro column-container -->


<!-- Menu on the top of the page -->
<!-- macro item -->

<!-- macro divider -->

<!-- TOC in the sidebar -->
<!-- macro item -->

<!-- macro divider -->

<!-- macro toc-dropdown -->

<!-- macro toc-dropdown-noLink -->

<!-- macro toc-dropdown-noHeading -->

<!-- TODO: duplicates of above for compatability with docsrender.ts;
    remove with pxtlib/docsrender.ts TOC TODOs after cloud bump. -->
<!-- macro top-dropdown -->

<!-- macro top-dropdown-noHeading -->

<!-- macro inner-dropdown -->

<!-- macro nested-dropdown -->
<!-- end include macros.html -->

	
<!-- include tracking.html -->
<script type="text/javascript" src="/pxt-arcade-app/pxtweb.js"></script>
<script type="text/javascript">
    window.loadAppInsights = function (includeCookie) {
        //Backend will patch / + doccdn + / with CDN url and the check that URL ends with the sha would pass
        var isProduction = includeCookie && (/[0-9a-f]{40}\/ai\.2\.min\.js$/.test("/pxt-arcade-app/ai.2.min.js"));
        !function(T,l,y){var S=T.location,k="script",D="connectionString",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\./g,"-"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{
            src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", // The SDK URL Source
            onInit: function (sdk) {
                sdk.addTelemetryInitializer(function (envelope) {
                    // App Insights automatically sends a page view event on setup, but we send our own later with additional properties.
                    // This stops the automatic event from firing, so we don't end up with duplicate page view events.
                    if (envelope.baseType == "PageviewData" && !envelope.baseData.properties) {
                        return false;
                    }

                    if (envelope.baseType == "PageviewPerformanceData") {
                        var pageName = envelope.baseData.name;
                        envelope.baseData.name = window.location.origin;
                        if (!envelope.baseData.properties) {
                            envelope.baseData.properties = {};
                        }
                        envelope.baseData.properties.pageName = pageName;
                        var scrubbedUrl = scrubUrl(envelope.baseData.uri);
                        envelope.baseData.uri = scrubbedUrl;
                        var toUrl = new URL(scrubbedUrl);
                        envelope.baseData.properties.pathName = toUrl ? toUrl.pathname : "";
                        if (envelope.ext && envelope.ext.trace) {
                            envelope.ext.trace.name = toUrl ? toUrl.pathname : "";
                        }
                    }

                    var telemetryItem = envelope.baseData;
                    telemetryItem.properties = telemetryItem.properties || {};
                    telemetryItem.properties["cookie"] = isProduction;
                    if (typeof pxtConfig === "undefined" || !pxtConfig || !pxtConfig.targetId) {
                        telemetryItem.properties["target"] = "arcade";
                        return true;
                    }
                    telemetryItem.properties["target"] = pxtConfig.targetId;
                    telemetryItem.properties["stage"] = (pxtConfig.relprefix || "/--").replace(/[^a-z]/ig, '')
                    if (typeof Windows !== "undefined")
                        telemetryItem.properties["WindowsApp"] = 1;
                    var userAgent = navigator.userAgent.toLowerCase();
                    var electronRegexResult = /\belectron\/(\d+\.\d+\.\d+.*?)(?: |$)/i.exec(userAgent); // Example navigator.userAgent: "Mozilla/5.0 Chrome/61.0.3163.100 Electron/2.0.0 Safari/537.36"
                    if (electronRegexResult) {
                        telemetryItem.properties["Electron"] = 1;
                        telemetryItem.properties["ElectronVersion"] = electronRegexResult[1];
                    }
                    if (typeof pxtElectron !== "undefined") {
                        telemetryItem.properties["PxtElectron"] = 1;
                        telemetryItem.properties["ElectronVersion"] = pxtElectron.versions.electronVersion;
                        telemetryItem.properties["ChromiumVersion"] = pxtElectron.versions.chromiumVersion;
                        telemetryItem.properties["NodeVersion"] = pxtElectron.versions.nodeVersion;
                        telemetryItem.properties["PxtElectronVersion"] = pxtElectron.versions.pxtElectronVersion;
                        telemetryItem.properties["PxtCoreVersion"] = pxtElectron.versions.pxtCoreVersion;
                        telemetryItem.properties["PxtTargetVersion"] = pxtElectron.versions.pxtTargetVersion;
                        telemetryItem.properties["PxtElectronIsProd"] = pxtElectron.versions.isProd;
                    }
                    // Kiosk UWP info is appended to the user agent by the makecode-dotnet-apps/arcade-kiosk UWP app
                    var kioskUwpRegexResult = /\((MakeCode Arcade Kiosk UWP)\/([\S]+)\/([\S]+)\)/i.exec(userAgent); // Example navigator.userAgent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36 Edg/117.0.2045.60 (MakeCode Arcade Kiosk UWP/0.1.41.0/Windows.Xbox)"
                    if (kioskUwpRegexResult) {
                        telemetryItem.properties["KioskUwp"] = 1;
                        telemetryItem.properties["KioskUwpVersion"] = kioskUwpRegexResult[2];
                        telemetryItem.properties["KioskUwpPlatform"] = kioskUwpRegexResult[3];
                    }
                    return true;
                });
            },
            cfg: {
                instrumentationKey:"9801ed01-c40f-46ec-aa40-2a1742a9e71c",
                disableAjaxTracking: true,
                overridePageViewDuration: false,
                disableExceptionTracking: true,
                disableCorrelationHeaders: true,
                disableCookiesUsage: !isProduction,
                isStorageUseDisabled: !isProduction,
                url: "/pxt-arcade-app/ai.2.min.js"
            }
        });
        window.appInsights=appInsights;
        var location = window.location.toString();
        appInsights.trackPageView({
            name: window.location.hostname,
            uri: window.location.origin,
            properties: {
                url: scrubUrl(location),
                urlReferrer: scrubUrl(document.referrer.toString())
            }
        });

        // Scrub potential PII from the URL.
        function scrubUrl(url) {
            if (!url) return url;

            var scriptIdRegex = /(?:S?\d{5}-\d{5}-\d{5}-\d{5})|(?:_[0-9a-zA-Z]{12})/g;
            var scrubbedUrl = new URL(url.toLocaleLowerCase().replace(scriptIdRegex, "xxxxx-xxxxx-xxxxx-xxxxx"));

            // Just as a precaution, strip any suspicious query parameters.
            var blockedParamKeywords = ["username", "password", "token", "pwd"];
            var searchParams = Array.from(scrubbedUrl.searchParams.keys());
            for (var param of searchParams) {
                if (blockedParamKeywords.some(k => param.indexOf(k) != -1)) {
                    scrubbedUrl.searchParams.delete(param);
                }
            }

            return scrubbedUrl.toString();
        }

        return isProduction;
    }
    pxt.initAnalyticsAsync();
</script>

<!-- end include tracking.html -->


</body>

</html>
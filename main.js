!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return r(t[s][1][e]||e)}),u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BlockDragger=void 0;const i=e("./plugins/duplicateOnDrag");class r extends i.DuplicateOnDragBlockDragger{drag(e,t){const n=document.getElementsByClassName("blocklyToolboxDiv")[0],i=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],r=document.getElementById("blocklyTrashIcon");if(i&&r){const t=function(e,t){return Math.abs(t-(e.left+e.width/2))}(i.getBoundingClientRect(),e.clientX);if(t<200){const e=t/200;r.style.opacity=""+(1-e),r.style.display="block",n&&(i.style.opacity=`${e}`,t<50&&pxt.BrowserUtils.addClass(n,"blocklyToolboxDeleting"))}else r.style.display="none",i.style.opacity="1",n&&pxt.BrowserUtils.removeClass(n,"blocklyToolboxDeleting")}return super.drag(e,t)}endDrag(e,t){super.endDrag(e,t);const n=document.getElementsByClassName("blocklyToolboxDiv")[0],i=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],r=document.getElementById("blocklyTrashIcon");r&&i&&(r.style.display="none",i.style.opacity="1",n&&pxt.BrowserUtils.removeClass(n,"blocklyToolboxDeleting"))}}n.BlockDragger=r},{"./plugins/duplicateOnDrag":78}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BreakpointIcon=void 0;const i=e("blockly");class r extends i.icons.Icon{constructor(e,t){super(e),this.onStateChange=t,this.isSet_=!1}getType(){return r.type}initView(e){super.initView(e),this.breakpointSvg||(this.breakpointSvg=i.utils.dom.createSvgElement("circle",{class:"blocklyBreakpointSymbol",stroke:"white","stroke-width":2,cx:7,cy:11.5,r:8},this.svgRoot),this.updateColor())}getSize(){return new i.utils.Size(25,25)}onClick(){this.isSet_=!this.isSet_,this.updateColor(),this.onStateChange(this.sourceBlock,this.isSet_)}isEnabled(){return this.isSet_}setEnabled(e){this.isSet_=e,this.updateColor()}updateColor(){this.breakpointSvg&&this.breakpointSvg.setAttribute("fill",this.isSet_?"#FF0000":"#CCCCCC")}}n.BreakpointIcon=r,r.type=new i.icons.IconType("breakpoint")},{blockly:376}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initFunctions=void 0;const i=e("blockly"),r=e("../help"),o=e("../plugins/functions"),s=e("../toolbox"),a=e("../fields"),l=e("../loader"),c=e("../importer"),u=e("../plugins/duplicateOnDrag");n.initFunctions=function(){const e=i.Msg;e.FUNCTION_CREATE_NEW=lf("Make a Function..."),e.FUNCTION_WARNING_DUPLICATE_ARG=lf("Functions cannot use the same argument name more than once."),e.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME=lf("Argument names must not be the same as the function name."),e.FUNCTION_WARNING_EMPTY_NAME=lf("Function and argument names cannot be empty."),e.FUNCTIONS_DEFAULT_FUNCTION_NAME=lf("doSomething"),e.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME=lf("bool"),e.FUNCTIONS_DEFAULT_STRING_ARG_NAME=lf("text"),e.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME=lf("num"),e.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME=lf("arg"),e.PROCEDURES_HUE=pxt.toolbox.getNamespaceColor("functions"),e.REPORTERS_HUE=pxt.toolbox.getNamespaceColor("variables");const t=pxt.blocks.getBlockDefinition("procedures_defnoreturn");e.PROCEDURES_DEFNORETURN_TITLE=t.block.PROCEDURES_DEFNORETURN_TITLE,e.PROCEDURE_ALREADY_EXISTS=t.block.PROCEDURE_ALREADY_EXISTS,i.Blocks.procedures_defnoreturn.init=function(){let e=new i.FieldTextInput("",i.Procedures.rename);this.appendDummyInput().appendField(i.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.argumentVarModels_=[],this.hat="cap",this.setStatements_(!0),this.statementConnection_=null},(0,r.installBuiltinHelpInfo)("procedures_defnoreturn");const n=pxt.blocks.getBlockDefinition("procedures_callnoreturn");e.PROCEDURES_CALLRETURN_TOOLTIP=t.tooltip.toString(),i.Blocks.procedures_callnoreturn={init:function(){let e=new a.FieldProcedure("");this.appendDummyInput("TOPROW").appendField(n.block.PROCEDURES_CALLNORETURN_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.quarkConnections_={},this.quarkIds_=null},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){i.Names.equals(e,this.getProcedureCall())&&this.setFieldValue(t,"NAME")},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&!this.isInsertionMarker())if(e.type==i.Events.CREATE&&-1!=e.ids.indexOf(this.id)){let t=this.getProcedureCall(),n=i.Procedures.getDefinition(t,this.workspace);if(!n||n.type==this.defType_&&JSON.stringify(n.arguments_)==JSON.stringify(this.arguments_)||(n=null),!n){i.Events.setGroup(e.group);let t=i.utils.xml.createElement("xml"),n=i.utils.xml.createElement("block");n.setAttribute("type",this.defType_);let r=this.getRelativeToSurfaceXY(),o=r.x+i.SNAP_RADIUS*(this.RTL?-1:1),s=r.y+2*i.SNAP_RADIUS;n.setAttribute("x",o),n.setAttribute("y",s);let a=i.utils.xml.createElement("field");a.setAttribute("name","NAME"),a.appendChild(document.createTextNode(this.getProcedureCall())),n.appendChild(a),t.appendChild(n),(0,c.domToWorkspaceNoEvents)(t,this.workspace),i.Events.setGroup(!1)}}else if(e.type==i.Events.DELETE){let t=this.getProcedureCall();i.Procedures.getDefinition(t,this.workspace)||(i.Events.setGroup(e.group),this.dispose(!0,!1),i.Events.setGroup(!1))}},mutationToDom:function(){const e=document.createElement("mutation");return e.setAttribute("name",this.getProcedureCall()),e},domToMutation:function(e){const t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t)},customContextMenu:function(e){let t={enabled:!0};t.text=i.Msg.PROCEDURES_HIGHLIGHT_DEF;let n=this.getProcedureCall(),r=this.workspace;t.callback=function(){let e=i.Procedures.getDefinition(n,r);e&&e.select()},e.push(t)},defType_:"procedures_defnoreturn"},(0,r.installBuiltinHelpInfo)("procedures_callnoreturn");const d=pxt.blocks.getBlockDefinition("function_definition");e.FUNCTIONS_EDIT_OPTION=d.block.FUNCTIONS_EDIT_OPTION,(0,r.installBuiltinHelpInfo)("function_definition");const h=pxt.blocks.getBlockDefinition("function_call");e.FUNCTIONS_CALL_TITLE=h.block.FUNCTIONS_CALL_TITLE,e.FUNCTIONS_GO_TO_DEFINITION_OPTION=h.block.FUNCTIONS_GO_TO_DEFINITION_OPTION,(0,r.installBuiltinHelpInfo)("function_call"),(0,r.installBuiltinHelpInfo)("function_call_output"),i.Blocks.function_return={init:function(){!function(e){const t=pxt.blocks.getBlockDefinition("function_return"),n="0_add_button",r="0_rem_button";i.Extensions.apply("inline-svgs",e,!1);let o,s=!0;function a(){const i=e.getInput("RETURN_VALUE");if(s){if(!i){for(;e.getInput("");)e.removeInput("");e.jsonInit({message0:t.block.message_with_value,args0:[{type:"input_value",name:"RETURN_VALUE",check:null}],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}if(e.getInput(n)&&e.removeInput(n),e.getInput(r)||u(r,e.REMOVE_IMAGE_DATAURI,lf("Remove return value")),o){const t=e.workspace.getBlockById(o);t&&t.outputConnection&&!t.outputConnection.targetBlock()&&e.getInput("RETURN_VALUE").connection.connect(t.outputConnection),o=void 0}}else{if(i){const n=i.connection.targetBlock();n&&(n.isShadow()&&n.setShadow(!1),i.connection.disconnect(),o=n.id),e.removeInput("RETURN_VALUE"),e.jsonInit({message0:t.block.message_no_value,args0:[],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}e.getInput(r)&&e.removeInput(r),e.getInput(n)||u(n,e.ADD_IMAGE_DATAURI,lf("Add return value"))}e.setInputsInline(!0)}function l(){return i.Xml.domToText(e.mutationToDom())}function c(t,n){t!==n&&i.Events.fire(new i.Events.BlockChange(e,"mutation",null,t,n))}function u(t,n,r){e.appendDummyInput(t).appendField(new i.FieldImage(n,24,24,r,(()=>{const e=l();s=!s;const t=l();c(e,t),a(),c(t,l())}),!1))}a(),e.domToMutation=e=>{e.hasAttribute("last_connected_id")&&(o=e.getAttribute("last_connected_id")),s=function(e){return"true"!==e.getAttribute("no_return_value")}(e),a()},e.mutationToDom=()=>{const t=document.createElement("mutation");return function(e,t){e.setAttribute("no_return_value",t?"false":"true")}(t,!!e.getInput("RETURN_VALUE")),o&&t.setAttribute("last_connected_id",o),t}}(this)},onchange:function(e){const t=this;if(!t.workspace||t.workspace.isFlyout)return;const n=e.type===i.Events.BLOCK_CREATE&&-1!=e.ids.indexOf(t.id),r=e.type===i.Events.BLOCK_DRAG&&e.blocks.some((e=>e.id===t.id));if(n||r){const n=t.getRootBlock();if("function_return"===n.type||null!=n.previousConnection)return;"function_definition"!==n.type&&(i.Events.setGroup(e.group),t.previousConnection.disconnect(),i.Events.setGroup(!1))}}},(0,r.installBuiltinHelpInfo)("function_return"),i.Procedures.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,s.createFlyoutHeadingLabel)(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.push(e)}const n=lf("Make a Function..."),r=lf("New function name:");let o=i.utils.xml.createElement("button");return o.setAttribute("text",n),o.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(function(t){let o=t=>{i.dialog.prompt(r,t,(function(t){pxt.tickEvent("blocks.makeafunction"),t&&(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""))==n&&(t=null),t&&(e.getVariable(t)?i.dialog.alert(i.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})):i.Procedures.isNameUsed(t,e)?(t=>{let n=e.getTopBlocks(!0)[0],r=10,o=10;if(n){let e=n.getRelativeToSurfaceXY();r=e.x+i.SNAP_RADIUS*(n.RTL?-1:1),o=e.y+2*i.SNAP_RADIUS}let s=i.utils.xml.createElement("xml"),a=i.utils.xml.createElement("block");a.setAttribute("type","procedures_defnoreturn"),a.setAttribute("x",String(r)),a.setAttribute("y",String(o));let l=i.utils.xml.createElement("field");l.setAttribute("name","NAME"),l.appendChild(document.createTextNode(t)),a.appendChild(l),s.appendChild(a);let u=(0,c.domToWorkspaceNoEvents)(s,e);i.hideChaff();let d=e.getBlockById(u[0]);d.select(),e.centerOnBlock(d.id)})(t):i.dialog.alert(i.Msg.PROCEDURE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})))}))};o("doSomething")})),t.push(o),function(e,n){for(let n=0;n<e.length;n++){let r=e[n][0],o=(e[n][1],i.utils.xml.createElement("block"));o.setAttribute("type","procedures_callnoreturn"),o.setAttribute("gap","16"),o.setAttribute("colour",pxt.toolbox.getNamespaceColor("functions"));let s=i.utils.xml.createElement("field");s.textContent=r,s.setAttribute("name","NAME"),o.appendChild(s),t.push(o)}}(i.Procedures.allProcedures(e)[0]),t};const p={number:pxt.blocks.defaultIconForArgType("number"),boolean:pxt.blocks.defaultIconForArgType("boolean"),string:pxt.blocks.defaultIconForArgType("string"),Array:pxt.blocks.defaultIconForArgType("Array")},f={},g=pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions;g&&g.extraFunctionEditorTypes&&g.extraFunctionEditorTypes.forEach((e=>{p[e.typeName]=e.icon||pxt.blocks.defaultIconForArgType(),e.defaultName&&(f[e.typeName]=e.defaultName)}));for(const e of Object.keys(p))o.FunctionManager.getInstance().setIconForType(e,p[e]);for(const e of Object.keys(f))o.FunctionManager.getInstance().setArgumentNameForType(e,f[e]);i.Blocks.argument_reporter_custom&&(i.Blocks.argument_reporter_custom.domToMutation=function(e){const t=e.getAttribute("typename");this.typeName_=t,e.hasAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase()),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_),(0,l.setOutputCheck)(this,t,l.cachedBlockInfo)});const m=i.Blocks.function_definition.makeCallOption;i.Blocks.function_definition.makeCallOption=function(){const e=m.call(this),t=this.getName();return e.text=pxt.Util.lf("Create 'call {0}'",t),e}}},{"../fields":65,"../help":66,"../importer":67,"../loader":71,"../plugins/duplicateOnDrag":78,"../plugins/functions":93,"../toolbox":120,blockly:376}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initLists=void 0;const i=e("blockly"),r=e("../help"),o=e("../constants");n.initLists=function(){const e=i.Msg,t=pxt.blocks.getBlockDefinition("lists_create_with");e.LISTS_CREATE_EMPTY_TITLE=t.block.LISTS_CREATE_EMPTY_TITLE,e.LISTS_CREATE_WITH_INPUT_WITH=t.block.LISTS_CREATE_WITH_INPUT_WITH,e.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD=t.block.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,e.LISTS_CREATE_WITH_ITEM_TITLE=t.block.LISTS_CREATE_WITH_ITEM_TITLE,(0,r.installBuiltinHelpInfo)("lists_create_with");const n=pxt.blocks.getBlockDefinition("lists_length");e.LISTS_LENGTH_TITLE=n.block.LISTS_LENGTH_TITLE,i.Blocks.lists_length.init=function(){this.jsonInit({message0:e.LISTS_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["Array"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,r.installBuiltinHelpInfo)("lists_length");const s=pxt.blocks.getBlockDefinition("lists_index_get");i.Blocks.lists_index_get={init:function(){this.jsonInit({message0:s.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:pxt.toolbox.blockColors.arrays,outputShape:o.provider.SHAPES.ROUND,inputsInline:!0}),this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0),(0,r.setBuiltinHelpInfo)(this,"lists_index_get")}};const a=pxt.blocks.getBlockDefinition("lists_index_set");i.Blocks.lists_index_set={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE",check:null}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.arrays,inputsInline:!0}),(0,r.setBuiltinHelpInfo)(this,"lists_index_set")}}}},{"../constants":18,"../help":66,blockly:376}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initLogic=void 0;const i=e("blockly"),r=e("../help");n.initLogic=function(){const e=i.Msg,t=pxt.blocks.getBlockDefinition("controls_if"),n=t.tooltip;e.CONTROLS_IF_MSG_IF=t.block.CONTROLS_IF_MSG_IF,e.CONTROLS_IF_MSG_THEN=t.block.CONTROLS_IF_MSG_THEN,e.CONTROLS_IF_MSG_ELSE=t.block.CONTROLS_IF_MSG_ELSE,e.CONTROLS_IF_MSG_ELSEIF=t.block.CONTROLS_IF_MSG_ELSEIF,e.CONTROLS_IF_TOOLTIP_1=n.CONTROLS_IF_TOOLTIP_1,e.CONTROLS_IF_TOOLTIP_2=n.CONTROLS_IF_TOOLTIP_2,e.CONTROLS_IF_TOOLTIP_3=n.CONTROLS_IF_TOOLTIP_3,e.CONTROLS_IF_TOOLTIP_4=n.CONTROLS_IF_TOOLTIP_4,(0,r.installBuiltinHelpInfo)("controls_if");const o=pxt.blocks.getBlockDefinition("logic_compare").tooltip;e.LOGIC_COMPARE_TOOLTIP_EQ=o.LOGIC_COMPARE_TOOLTIP_EQ,e.LOGIC_COMPARE_TOOLTIP_NEQ=o.LOGIC_COMPARE_TOOLTIP_NEQ,e.LOGIC_COMPARE_TOOLTIP_LT=o.LOGIC_COMPARE_TOOLTIP_LT,e.LOGIC_COMPARE_TOOLTIP_LTE=o.LOGIC_COMPARE_TOOLTIP_LTE,e.LOGIC_COMPARE_TOOLTIP_GT=o.LOGIC_COMPARE_TOOLTIP_GT,e.LOGIC_COMPARE_TOOLTIP_GTE=o.LOGIC_COMPARE_TOOLTIP_GTE,(0,r.installBuiltinHelpInfo)("logic_compare");const s=pxt.blocks.getBlockDefinition("logic_operation"),a=s.tooltip;e.LOGIC_OPERATION_AND=s.block.LOGIC_OPERATION_AND,e.LOGIC_OPERATION_OR=s.block.LOGIC_OPERATION_OR,e.LOGIC_OPERATION_TOOLTIP_AND=a.LOGIC_OPERATION_TOOLTIP_AND,e.LOGIC_OPERATION_TOOLTIP_OR=a.LOGIC_OPERATION_TOOLTIP_OR,(0,r.installBuiltinHelpInfo)("logic_operation");const l=pxt.blocks.getBlockDefinition("logic_negate");e.LOGIC_NEGATE_TITLE=l.block.LOGIC_NEGATE_TITLE,(0,r.installBuiltinHelpInfo)("logic_negate");const c=pxt.blocks.getBlockDefinition("logic_boolean");e.LOGIC_BOOLEAN_TRUE=c.block.LOGIC_BOOLEAN_TRUE,e.LOGIC_BOOLEAN_FALSE=c.block.LOGIC_BOOLEAN_FALSE,(0,r.installBuiltinHelpInfo)("logic_boolean")}},{"../help":66,blockly:376}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initLoops=void 0;const i=e("blockly"),r=e("../help");n.initLoops=function(){const e=i.Msg,t=pxt.blocks.getBlockDefinition("controls_repeat_ext");e.CONTROLS_REPEAT_TITLE=t.block.CONTROLS_REPEAT_TITLE,e.CONTROLS_REPEAT_INPUT_DO=t.block.CONTROLS_REPEAT_INPUT_DO,(0,r.installBuiltinHelpInfo)("controls_repeat_ext");const n=pxt.blocks.getBlockDefinition("device_while");i.Blocks.device_while={init:function(){this.jsonInit({message0:n.block.message0,args0:[{type:"input_value",name:"COND",check:"Boolean"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops")}),this.appendStatementInput("DO").appendField(n.block.appendField),(0,r.setBuiltinHelpInfo)(this,"device_while")}};const o=pxt.blocks.getBlockDefinition("pxt_controls_for");i.Blocks.pxt_controls_for={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_value",name:"VAR",variable:o.block.variable,check:"Variable"},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(o.block.appendField);let e=this;(0,r.setHelpResources)(this,"pxt_controls_for",o.name,(function(){return pxt.U.rlf(o.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),o.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const n=this.getField("VAR");i.Names.equals(e,n.getText())&&n.setValue(t)}};const s=pxt.blocks.getBlockDefinition("controls_simple_for");i.Blocks.controls_simple_for={init:function(){this.jsonInit({message0:s.block.message0,args0:[{type:"field_variable",name:"VAR",variable:s.block.variable},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(s.block.appendField);let e=this;(0,r.setHelpResources)(this,"controls_simple_for",s.name,(function(){return pxt.U.rlf(s.tooltip,e.getField("VAR").getText())}),s.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const n=this.getField("VAR");i.Names.equals(e,n.getText())&&n.setValue(t)},customContextMenu:function(e){var t,n;if(!this.isCollapsed()&&!(null===(n=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===n?void 0:n.readOnly)){let t={enabled:!0},n=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",n);let r=i.utils.xml.createElement("field");r.textContent=n,r.setAttribute("name","VAR");let o=i.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(r),t.callback=i.ContextMenu.callbackFactory(this,o),e.push(t)}}};const a=pxt.blocks.getBlockDefinition(ts.pxtc.TS_BREAK_TYPE);i.Blocks[pxtc.TS_BREAK_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:a.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,r.setHelpResources)(this,ts.pxtc.TS_BREAK_TYPE,a.name,a.tooltip,a.url,e,void 0,void 0,!1)}};const l=pxt.blocks.getBlockDefinition(ts.pxtc.TS_CONTINUE_TYPE);i.Blocks[pxtc.TS_CONTINUE_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:l.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,r.setHelpResources)(this,ts.pxtc.TS_CONTINUE_TYPE,l.name,l.tooltip,l.url,e,void 0,void 0,!1)}},i.Blocks[pxtc.COLLAPSED_BLOCK]={init:function(){this.jsonInit({message0:"...",inputsInline:!0,previousStatement:null,nextStatement:null,colour:"#cccccc"}),(0,r.setHelpResources)(this,ts.pxtc.COLLAPSED_BLOCK,"...",lf("a few blocks"),void 0,"#cccccc",void 0,void 0,!1)}};const c=pxt.blocks.getBlockDefinition("pxt_controls_for_of");i.Blocks.pxt_controls_for_of={init:function(){this.jsonInit({message0:c.block.message0,args0:[{type:"input_value",name:"VAR",variable:c.block.variable,check:"Variable"},{type:"input_value",name:"LIST",check:["Array","String"]}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(c.block.appendField);let e=this;(0,r.setHelpResources)(this,"pxt_controls_for_of",c.name,(function(){return pxt.Util.rlf(c.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),c.url,String(pxt.toolbox.getNamespaceColor("loops")))}};const u=pxt.blocks.getBlockDefinition("controls_for_of");i.Blocks.controls_for_of={init:function(){this.jsonInit({message0:u.block.message0,args0:[{type:"field_variable",name:"VAR",variable:u.block.variable},{type:"input_value",name:"LIST",check:"Array"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(u.block.appendField);let e=this;(0,r.setHelpResources)(this,"controls_for_of",u.name,(function(){return pxt.Util.rlf(u.tooltip,e.getField("VAR").getText())}),u.url,String(pxt.toolbox.getNamespaceColor("loops")))}}}},{"../help":66,blockly:376}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initMathRoundBlock=n.initMathOpBlock=n.initMath=void 0;const i=e("blockly"),r=e("../help"),o=e("../constants"),s=e("../composableMutations"),a=e("../fields/field_dropdown");function l(){const e=pxt.blocks.MATH_FUNCTIONS.unary.concat(pxt.blocks.MATH_FUNCTIONS.binary).concat(pxt.blocks.MATH_FUNCTIONS.infix),t=pxt.blocks.getBlockDefinition("math_js_op");function n(e,t){const n=e.appendValueInput("ARG"+(t?1:0));n.setCheck("Number"),t&&(n.connection.setShadowDom(function(){if(!c){(c=document.createElement("shadow")).setAttribute("type","math_number");const e=document.createElement("field");e.setAttribute("name","NUM"),e.textContent="0",c.appendChild(e)}return c}()),n.connection.respawnShadow_())}function l(e,t){let n=!!e.getInput("ARG1");t?(n&&e.moveInputBefore("op_dropdown","ARG1"),e.moveInputBefore("ARG0","op_dropdown")):(n&&e.moveInputBefore("ARG0","ARG1"),e.moveInputBefore("op_dropdown","ARG0"))}i.Blocks.math_js_op={init:function(){const i=this;i.setPreviousStatement(!1),i.setNextStatement(!1),i.setOutput(!0,"Number"),i.setOutputShape(o.provider.SHAPES.ROUND),i.setInputsInline(!0),i.appendDummyInput("op_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e])),(e=>function(e,t){return!function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.unary.indexOf(e)}(t)?e.getInput("ARG1")||n(e,!0):e.removeInput("ARG1",!0),l(e,function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.infix.indexOf(e)}(t)),t}(i,e))),"OP"),n(i,!1),(0,s.appendMutation)(i,{mutationToDom:e=>{let t;for(let e=0;e<i.inputList.length;e++){const n=i.inputList[e];if("op_dropdown"===n.name){t=!1;break}if("ARG0"===n.name){t=!0;break}}return e.setAttribute("op-type",(i.getInput("ARG1")?t?"infix":"binary":"unary").toString()),e},domToMutation:e=>{if(e.hasAttribute("op-type")){const t=e.getAttribute("op-type");"unary"!=t&&n(i,!0),l(i,"infix"===t)}}})}},(0,r.installHelpResources)("math_js_op",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}let c;function u(){const e=pxt.blocks.ROUNDING_FUNCTIONS,t=pxt.blocks.getBlockDefinition("math_js_round");i.Blocks.math_js_round={init:function(){const n=this;n.setPreviousStatement(!1),n.setNextStatement(!1),n.setOutput(!0,"Number"),n.setOutputShape(o.provider.SHAPES.ROUND),n.setInputsInline(!0),n.appendDummyInput("round_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e]))),"OP"),function(e){e.appendValueInput("ARG0").setCheck("Number")}(n)}},(0,r.installHelpResources)("math_js_round",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}n.initMath=function(e){const t=pxt.blocks.getBlockDefinition("math_op2"),n=t.tooltip;i.Blocks.math_op2={init:function(){this.jsonInit({message0:lf("%1 of %2 and %3"),args0:[{type:"field_dropdown",name:"op",options:[[lf("{id:op}min"),"min"],[lf("{id:op}max"),"max"]]},{type:"input_value",name:"x",check:"Number"},{type:"input_value",name:"y",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,r.setHelpResources)(this,"math_op2",t.name,(function(e){return n[e.getFieldValue("op")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))},codeCard:(0,r.attachCardInfo)(e,"Math.min")};const s=pxt.blocks.getBlockDefinition("math_op3");i.Blocks.math_op3={init:function(){this.jsonInit({message0:s.block.message0,args0:[{type:"input_value",name:"x",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,r.setBuiltinHelpInfo)(this,"math_op3")},codeCard:(0,r.attachCardInfo)(e,"Math.abs")},["math_number","math_integer","math_whole_number","math_number_minmax"].forEach((e=>{const t=pxt.blocks.getBlockDefinition(e);(0,r.installHelpResources)(e,t.name,t.tooltip,t.url,"#fff","#fff","#fff")}));const a=i.Msg,c=pxt.blocks.getBlockDefinition("math_arithmetic"),d=c.tooltip;a.MATH_ADDITION_SYMBOL=c.block.MATH_ADDITION_SYMBOL,a.MATH_SUBTRACTION_SYMBOL=c.block.MATH_SUBTRACTION_SYMBOL,a.MATH_MULTIPLICATION_SYMBOL=c.block.MATH_MULTIPLICATION_SYMBOL,a.MATH_DIVISION_SYMBOL=c.block.MATH_DIVISION_SYMBOL,a.MATH_POWER_SYMBOL=c.block.MATH_POWER_SYMBOL,(0,r.installHelpResources)("math_arithmetic",c.name,(function(e){return d[e.getFieldValue("OP")]}),c.url,pxt.toolbox.getNamespaceColor(c.category));const h=pxt.blocks.getBlockDefinition("math_modulo");a.MATH_MODULO_TITLE=h.block.MATH_MODULO_TITLE,(0,r.installBuiltinHelpInfo)("math_modulo"),l(),u()},n.initMathOpBlock=l,n.initMathRoundBlock=u},{"../composableMutations":17,"../constants":18,"../fields/field_dropdown":33,"../help":66,blockly:376}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initOnStart=void 0;const i=e("blockly"),r=e("../fields"),o=e("../help");n.initOnStart=function(){const e=pxt.blocks.getBlockDefinition(ts.pxtc.ON_START_TYPE);if(i.Blocks[ts.pxtc.ON_START_TYPE]={init:function(){this.jsonInit({message0:e.block.message0,args0:[{type:"input_dummy"},{type:"input_statement",name:"HANDLER"}],colour:(pxt.appTarget.runtime?pxt.appTarget.runtime.onStartColor:"")||pxt.toolbox.getNamespaceColor("loops")}),(0,o.setHelpResources)(this,ts.pxtc.ON_START_TYPE,e.name,e.tooltip,e.url,String((pxt.appTarget.runtime?pxt.appTarget.runtime.onStartColor:"")||pxt.toolbox.getNamespaceColor("loops")),void 0,void 0,!!pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable)}},i.Blocks[pxtc.TS_STATEMENT_TYPE]={init:function(){let e,t,n=this;n.setColour("#717171"),n.setPreviousStatement(!0),n.setNextStatement(!0),n.setInputsInline(!1),n.domToMutation=e=>{const i=parseInt(e.getAttribute("numlines"));n.declaredVariables=e.getAttribute("declaredvars"),t=[];for(let n=0;n<i;n++){const i=e.getAttribute("line"+n);t.push(i)}n.setPythonEnabled(!1)},n.mutationToDom=()=>{let e=document.createElement("mutation");return t&&(t.forEach(((t,n)=>e.setAttribute("line"+n,t))),e.setAttribute("numlines",t.length.toString())),n.declaredVariables&&e.setAttribute("declaredvars",this.declaredVariables),e},n.setPythonEnabled=i=>{if(e!==i){for(;n.inputList.length;)n.removeInput(n.inputList[0].name);e=i,i?(n.appendDummyInput().appendField(pxt.Util.lf("<python code>"),"LINE0"),n.setTooltip(lf("A Python statement that could not be converted to blocks"))):(t.forEach(((e,t)=>{n.appendDummyInput().appendField(e,"LINE"+t)})),n.setTooltip(lf("A JavaScript statement that could not be converted to blocks")))}},n.getLines=()=>t,n.setEditable(!1),(0,o.setHelpResources)(this,pxtc.TS_STATEMENT_TYPE,lf("JavaScript statement"),lf("A JavaScript statement that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},i.Blocks[pxtc.TS_OUTPUT_TYPE]={init:function(){let e=this;e.setColour("#717171"),e.setPreviousStatement(!1),e.setNextStatement(!1),e.setOutput(!0),e.setEditable(!1),e.appendDummyInput().appendField(new r.FieldTsExpression(""),"EXPRESSION"),e.setPythonEnabled=t=>{e.getField("EXPRESSION").setPythonEnabled(t),t?e.setTooltip(lf("A Python expression that could not be converted to blocks")):e.setTooltip(lf("A JavaScript expression that could not be converted to blocks"))},(0,o.setHelpResources)(e,pxtc.TS_OUTPUT_TYPE,lf("JavaScript expression"),lf("A JavaScript expression that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock){const e=pxt.appTarget.runtime.pauseUntilBlock,t=pxt.blocks.getBlockDefinition(ts.pxtc.PAUSE_UNTIL_TYPE);i.Blocks[pxtc.PAUSE_UNTIL_TYPE]={init:function(){const n=e.color||pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:t.block.message0,args0:[{type:"input_value",name:"PREDICATE",check:"Boolean"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:n}),(0,o.setHelpResources)(this,ts.pxtc.PAUSE_UNTIL_TYPE,t.name,t.tooltip,t.url,n,void 0,void 0,!1)}}}}},{"../fields":65,"../help":66,blockly:376}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initText=void 0;const i=e("blockly"),r=e("../help"),o=e("../constants");n.initText=function(){const e=pxt.blocks.getBlockDefinition("text");(0,r.installHelpResources)("text",e.name,e.tooltip,e.url,"#fff","#fff","#fff");const t=pxt.blocks.getBlockDefinition("text_length");i.Msg.TEXT_LENGTH_TITLE=t.block.TEXT_LENGTH_TITLE,i.Blocks.text_length.init=function(){this.jsonInit({message0:i.Msg.TEXT_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["String"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,r.installBuiltinHelpInfo)("text_length");const n=pxt.blocks.getBlockDefinition("text_join");i.Msg.TEXT_JOIN_TITLE_CREATEWITH=n.block.TEXT_JOIN_TITLE_CREATEWITH,(0,r.installBuiltinHelpInfo)("text_join")}},{"../constants":18,"../help":66,blockly:376}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initVariables=void 0;const i=e("blockly"),r=e("../toolbox"),o=e("../help");n.initVariables=function(){i.FieldVariable.prototype.getVariableTypes_=()=>[""];let e=lf("{id:var}item");i.Variables.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,r.createFlyoutHeadingLabel)(lf("Variables"),pxt.toolbox.getNamespaceColor("variables"),pxt.toolbox.getNamespaceIcon("variables"));t.push(e)}let n=document.createElement("button");n.setAttribute("text",lf("Make a Variable...")),n.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){i.Variables.createVariableButtonHandler(e.getTargetWorkspace())})),t.push(n);let o=i.Variables.flyoutCategoryBlocks(e);return t.concat(o)},i.Variables.flyoutCategoryBlocks=function(e){let t=e.getVariablesOfType(""),n=[];if(t.length>0){let e=t[t.length-1];t.sort(i.VariableModel.compareByName);for(let e=0;e<t.length;e++){const o=t[e];if(i.Blocks.variables_get){let e=(0,r.mkVariableFieldBlock)("variables_get",o.getId(),o.type,o.name,!1);e.setAttribute("gap","8"),n.push(e)}}if(n[n.length-1].setAttribute("gap","24"),(i.Blocks.variables_change||i.Blocks.variables_set)&&n.unshift((0,r.createFlyoutGroupLabel)(lf("Your Variables"))),i.Blocks.variables_change){let t=i.Blocks.variables_get?20:8,o=(0,r.mkVariableFieldBlock)("variables_change",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=i.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=i.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let n=i.utils.xml.createElement("field");n.setAttribute("name","NUM"),n.appendChild(document.createTextNode("1")),t.appendChild(n),o.appendChild(e)}n.unshift(o)}if(i.Blocks.variables_set){let t=i.Blocks.variables_change?8:24,o=(0,r.mkVariableFieldBlock)("variables_set",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=i.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=i.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let n=i.utils.xml.createElement("field");n.setAttribute("name","NUM"),n.appendChild(document.createTextNode("0")),t.appendChild(n),o.appendChild(e)}n.unshift(o)}}return n};const t=i.Msg,n=pxt.blocks.getBlockDefinition("variables_get");t.VARIABLES_GET_CREATE_SET=n.block.VARIABLES_GET_CREATE_SET,(0,o.installBuiltinHelpInfo)("variables_get"),(0,o.installBuiltinHelpInfo)("variables_get_reporter"),t.RENAME_VARIABLE=lf("Rename variable..."),t.DELETE_VARIABLE=lf('Delete the "%1" variable'),t.DELETE_VARIABLE_CONFIRMATION=lf('Delete %1 uses of the "%2" variable?'),t.NEW_VARIABLE_DROPDOWN=lf("New variable...");const s=pxt.blocks.getBlockDefinition("variables_set");t.VARIABLES_SET=s.block.VARIABLES_SET,t.VARIABLES_DEFAULT_NAME=e,t.VARIABLES_SET_CREATE_GET=lf("Create 'get %1'"),(0,o.installBuiltinHelpInfo)("variables_set");const a=pxt.blocks.getBlockDefinition("variables_change");i.Blocks.variables_change={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"field_variable",name:"VAR",variable:e},{type:"input_value",name:"VALUE",check:"Number"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("variables")}),(0,o.setBuiltinHelpInfo)(this,"variables_change")},customContextMenu:function(e){var t,n;if(!(null===(n=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===n?void 0:n.readOnly)){let t={enabled:this.workspace.remainingCapacity()>0},n=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",n);let r=i.utils.xml.createElement("field");r.textContent=n,r.setAttribute("name","VAR");let o=i.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(r),t.callback=i.ContextMenu.callbackFactory(this,o),e.push(t)}}},t.NEW_VARIABLE_TITLE=lf("New variable name:"),t.RENAME_VARIABLE_TITLE=lf("Rename all '%1' variables to:")}},{"../help":66,"../toolbox":120,blockly:376}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.renderCodeCard=void 0;const i=e("./render");n.renderCodeCard=function(e,t={}){const n=e.url?/^[^:]+:\/\//.test(e.url)?e.url:"/"+e.url.replace(/^\.?\/?/,""):e.youTubeId?`https://youtu.be/${e.youTubeId}`:void 0,r=!!n,o=(e,t,n="div",i="")=>{let r=document.createElement(n);return t&&(r.className=t),e&&e.appendChild(r),i&&r.appendChild(document.createTextNode(i+"")),r};let s=o(null,"ui "+(e.style||"card")+" "+(e.color||"")+(r?" link":""),r?"a":"div");if(s.setAttribute("role","option"),s.setAttribute("aria-selected","true"),r){const e=s;e.href=n,/^https?:\/\//.test(n)&&(e.target="_blank")}if(!t.hideHeader&&e.header){let t=o(s,"ui content "+(e.responsive?" tall desktop only":""));e.header&&o(t,"description","span",e.header)}const a=(t.shortName?e.shortName:"")||e.name;let l=o(s,"ui image"+(e.responsive?" tall landscape only":""));if(e.label){let t=document.createElement("label");t.className=`ui ${e.labelClass?e.labelClass:"orange right ribbon"} label`,t.textContent=e.label,l.appendChild(t)}if(e.blocksXml){const t=(0,i.render)(e.blocksXml);if(t){let e=o(l,"");e.setAttribute("style","width:100%; min-height:10em"),e.appendChild(t)}else console.error("failed to render blocks"),pxt.debug(e.blocksXml)}if(e.typeScript){let t=document.createElement("pre");t.appendChild(document.createTextNode(e.typeScript)),l.appendChild(t)}if(e.imageUrl||(e.youTubeId?`https://img.youtube.com/vi/${e.youTubeId}/0.jpg`:void 0)){let t=document.createElement("div");t.className="ui imagewrapper";let n=document.createElement("div");n.className="ui cardimage",n.style.backgroundImage=`url("${e.imageUrl}")`,n.title=a,n.setAttribute("role","presentation"),t.appendChild(n),l.appendChild(t)}if("file"==e.cardType){let e=o(s,"ui fileimage");l.appendChild(e)}if(a||e.description){let t=o(s,"ui content");if(a&&(s.setAttribute("aria-label",a),o(t,"header","div",a)),e.description){const n=o(t,"ui description"),i=e.description.split(".")[0]+".";n.appendChild(document.createTextNode(i))}}if(e.time){let t=o(s,"meta");e.time&&o(t,"date","span").appendChild(document.createTextNode(pxt.Util.timeSince(e.time)))}return e.extracontent&&o(s,"extra content","div").appendChild(document.createTextNode(e.extracontent)),s}},{"./render":118}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.workerOpAsync=n.compileExpression=n.callKey=n.compileAsync=n.compileBlockAsync=void 0;const i=e("blockly"),r=e("./environment"),o=e("./typeChecker"),s=e("./util"),a=e("../toolbox"),l=e("../legacyMutations"),c=e("./variables"),u=e("../fields");function d(e,t){if(e.type===ts.pxtc.ON_START_TYPE)return 0;const n=t.stdCallTable[e.type],i=h(t,e),r=1+ts.pxtc.Util.codalHash16(i);return n&&n.attrs.afterOnStart?r:-r}function h(e,t){return t.type==ts.pxtc.ON_START_TYPE?JSON.stringify({name:ts.pxtc.ON_START_TYPE}):t.type==ts.pxtc.FUNCTION_DEFINITION_TYPE?JSON.stringify({type:"function",name:t.getFieldValue("function_name")}):JSON.stringify(p(t)).replace(/"id"\s*:\s*"[^"]+"/g,"")}function p(e){const t=[],n=[];for(const r of e.inputList){for(const e of r.fieldRow)e.name&&t.push(e.getText());r.type===i.inputTypes.VALUE&&(r.connection.targetBlock()?n.push(p(r.connection.targetBlock())):n.push(null))}return{type:e.type,fields:t,inputs:n}}function f(e,t){e.setEnabled(t);const n=e.getDescendants(!1);for(const e of n)e.setEnabled(t)}function g(e,t){if(t.isInsertionMarker())return[];let n;const i=[];switch(e.stats[t.type]=(e.stats[t.type]||0)+1,w(t,i),t.type){case"controls_if":n=function(e,t,n){let i=[];for(let r=0;r<=t.elseifCount_;++r){let o=m(e,(0,s.getInputTargetBlock)(e,t,"IF"+r),n),a=b(e,(0,s.getInputTargetBlock)(e,t,"DO"+r)),l=pxt.blocks.mkText("if (");r>0&&((l=pxt.blocks.mkText("else if (")).glueToBlock=pxt.blocks.GlueMode.WithSpace),(0,s.append)(i,[l,o,pxt.blocks.mkText(")"),a])}if(t.elseCount_){let n=pxt.blocks.mkText("else");n.glueToBlock=pxt.blocks.GlueMode.WithSpace,(0,s.append)(i,[n,b(e,(0,s.getInputTargetBlock)(e,t,"ELSE"))])}return i}(e,t,i);break;case"pxt_controls_for":case"controls_for":case"controls_simple_for":n=function(e,t,n){let i=(0,s.getInputTargetBlock)(e,t,"TO"),r=(0,s.getInputTargetBlock)(e,t,"DO"),a=(0,s.getInputTargetBlock)(e,t,"BY"),l=(0,s.getInputTargetBlock)(e,t,"FROM"),c=!a||a.type.match(/^math_number/)&&1==B(a),u=(0,o.lookup)(e,t,(0,s.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+u.escapedName+" = "),l?m(e,l,n):pxt.blocks.mkText("0"),pxt.blocks.mkText("; "),pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"<=",m(e,i,n)),pxt.blocks.mkText("; "),c?pxt.blocks.mkText(u.escapedName+"++"):pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"+=",m(e,a,n)),pxt.blocks.mkText(")"),b(e,r)]}(e,t,i);break;case"pxt_controls_for_of":case"controls_for_of":n=function(e,t,n){let i=(0,s.getInputTargetBlock)(e,t,"LIST"),r=(0,s.getInputTargetBlock)(e,t,"DO"),a=(0,o.lookup)(e,t,(0,s.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+a.escapedName+" of "),m(e,i,n),pxt.blocks.mkText(")"),b(e,r)]}(e,t,i);break;case"variables_set":n=[v(e,t,i)];break;case"variables_change":n=[_(e,t,i)];break;case"controls_repeat_ext":n=function(e,t,n){let i=m(e,(0,s.getInputTargetBlock)(e,t,"TIMES"),n),r=b(e,(0,s.getInputTargetBlock)(e,t,"DO")),a=n=>!(0,o.lookup)(e,t,n),l="index";for(let e=2;!a(l);e++)l="index"+e;return[pxt.blocks.mkText("for (let "+l+" = 0; "),pxt.blocks.mkInfix(pxt.blocks.mkText(l),"<",i),pxt.blocks.mkText("; "+l+"++)"),r]}(e,t,i);break;case"device_while":n=function(e,t,n){let i=m(e,(0,s.getInputTargetBlock)(e,t,"COND"),n),r=b(e,(0,s.getInputTargetBlock)(e,t,"DO"));return[pxt.blocks.mkText("while ("),i,pxt.blocks.mkText(")"),r]}(e,t,i);break;case"procedures_defnoreturn":n=function(e,t,n){const i=(0,s.escapeVarName)(t.getFieldValue("NAME"),e,!0),r=(0,s.getInputTargetBlock)(e,t,"STACK");return[pxt.blocks.mkText("function "+i+"() "),b(e,r)]}(e,t);break;case"function_definition":n=function(e,t,n){const i=(0,s.escapeVarName)(t.getField("function_name").getText(),e,!0),r=(0,s.getInputTargetBlock)(e,t,"STACK"),a=t.getArguments().map((n=>{if("Array"==n.type){const i=(0,o.lookup)(e,t,n.name),r=(0,o.getConcreteType)(i.type),a=(null==r?void 0:r.type)&&"Array"!==r.type?r.type:"any[]";return`${(0,s.escapeVarName)(n.name,e)}: ${a}`}return`${(0,s.escapeVarName)(n.name,e)}: ${n.type}`})),l=(0,o.isFunctionRecursive)(e,t,!1);return[pxt.blocks.mkText(`function ${i} (${a.join(", ")})${l?": any":""}`),b(e,r)]}(e,t);break;case"procedures_callnoreturn":n=[A(e,t,i)];break;case"function_call":n=[I(e,t,i,!0)];break;case pxtc.TS_RETURN_STATEMENT_TYPE:n=[O(e,t,i)];break;case ts.pxtc.ON_START_TYPE:n=function(e,t){const n=b(e,(0,s.getInputTargetBlock)(e,t,"HANDLER"));return pxt.appTarget.compile&&pxt.appTarget.compile.onStartText&&n&&n.children&&n.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.ON_START_COMMENT}\n`))),n}(e,t).children;break;case pxtc.TS_STATEMENT_TYPE:n=function(e,t){return t.getLines().map((e=>pxt.blocks.mkText(e+"\n")))}(0,t);break;case pxtc.PAUSE_UNTIL_TYPE:n=function(e,t,n){const i=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;pxt.U.assert(!!i,"target has block enabled");const r=i.namespace,o=i.callName||"pauseUntil",s=R(e,t,{definitionName:"PREDICATE",actualName:"PREDICATE"},n),a=[pxt.blocks.mkGroup([pxt.blocks.mkText("() => "),s])];return r?[pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(r,o,a,!1))]:[pxt.blocks.mkStmt(pxt.blocks.H.mkCall(o,a,!1,!1))]}(e,t,i);break;case pxtc.TS_DEBUGGER_TYPE:n=function(e,t){return"1"==t.getFieldValue("ON_OFF")?[pxt.blocks.mkText("debugger;\n")]:[]}(0,t);break;case pxtc.TS_BREAK_TYPE:n=[pxt.blocks.mkText("break;\n")];break;case pxtc.TS_CONTINUE_TYPE:n=[pxt.blocks.mkText("continue;\n")];break;default:n=e.stdCallTable[t.type]?[N(e,t,i)]:[pxt.blocks.mkStmt(m(e,t,i))]}let r=n[n.length-1];return r&&!r.id&&(r.id=t.id),i.length&&function(e,t){const n=[];for(const t of e)for(const e of t.split("\n"))n.push(pxt.blocks.mkText(`// ${e}`)),n.push(pxt.blocks.mkNewLine());for(const e of n.reverse())t.unshift(e)}(i,n),n.forEach((e=>{!(e.type===pxt.blocks.NT.Block||e.type===pxt.blocks.NT.Prefix&&pxt.Util.startsWith(e.op,"//"))||t.type==pxtc.ON_START_TYPE&&e.id||(e.id=t.id)})),n}function m(e,t,n){let i;if(pxt.U.assert(null!=t),e.stats[t.type]=(e.stats[t.type]||0)+1,w(t,n),"placeholder"!=t.type&&t.isEnabled&&t.isEnabled())switch(t.type){case"math_number":case"math_integer":case"math_whole_number":case"math_number_minmax":i=function(e,t,n){return pxt.blocks.H.mkNumberLiteral(B(t))}(0,t);break;case"math_op2":i=function(e,t,n){let i=t.getFieldValue("op"),r=m(e,(0,s.getInputTargetBlock)(e,t,"x"),n),o=m(e,(0,s.getInputTargetBlock)(e,t,"y"),n);return pxt.blocks.H.mathCall(i,[r,o])}(e,t,n);break;case"math_op3":i=function(e,t,n){let i=m(e,(0,s.getInputTargetBlock)(e,t,"x"),n);return pxt.blocks.H.mathCall("abs",[i])}(e,t,n);break;case"math_arithmetic":case"logic_compare":case"logic_operation":i=function(e,t,n){let i=t.getFieldValue("OP"),r=(0,s.getInputTargetBlock)(e,t,"A"),a=(0,s.getInputTargetBlock)(e,t,"B"),l=[m(e,r,n),m(e,a,n)];(function(e){return-1!==["LT","LTE","GT","GTE","EQ","NEQ"].indexOf(e)})(i)&&M(e,r)&&M(e,a)&&pxt.blocks.flattenNode([l[0]]).output!==pxt.blocks.flattenNode([l[1]]).output&&(l=l.map((e=>pxt.blocks.H.mkParenthesizedExpression(pxt.blocks.mkGroup([e,pxt.blocks.mkText(" as any")])))));const c=(0,o.returnType)(e,r);if((0,o.isStringType)(c)){if("EQ"==i)return pxt.blocks.H.mkSimpleCall("==",l);if("NEQ"==i)return pxt.blocks.H.mkSimpleCall("!=",l)}else if((0,o.isBooleanType)(c))return pxt.blocks.H.mkSimpleCall(C[i],l);return pxt.U.assert(i in C),pxt.blocks.H.mkSimpleCall(C[i],l)}(e,t,n);break;case"math_modulo":i=function(e,t,n){let i=(0,s.getInputTargetBlock)(e,t,"DIVIDEND"),r=(0,s.getInputTargetBlock)(e,t,"DIVISOR"),o=[m(e,i,n),m(e,r,n)];return pxt.blocks.H.mkSimpleCall("%",o)}(e,t,n);break;case"logic_boolean":i=function(e,t,n){return pxt.blocks.H.mkBooleanLiteral("TRUE"==t.getFieldValue("BOOL"))}(0,t);break;case"logic_negate":i=function(e,t,n){let i=m(e,(0,s.getInputTargetBlock)(e,t,"BOOL"),n);return pxt.blocks.mkPrefix("!",[pxt.blocks.H.mkParenthesizedExpression(i)])}(e,t,n);break;case"variables_get":case"variables_get_reporter":i=function(e,t){const n=t.getField("VAR").getText();let i=(0,o.lookup)(e,t,n);return i?(i.firstReference||(i.firstReference=t),pxt.U.assert(null!=i&&null!=i.type),pxt.blocks.mkText(i.escapedName)):pxt.blocks.mkText(n)}(e,t);break;case"text":i=function(e,t,n){return pxt.blocks.H.mkStringLiteral(t.getFieldValue("TEXT"))}(0,t);break;case"text_join":i=function(e,t,n){let i,r=0;for(;;){const o=(0,s.getInputTargetBlock)(e,t,"ADD"+r);if(r++,!o){if(r<t.inputList.length)continue;break}const a=m(e,o,n);i=i?pxt.blocks.H.mkSimpleCall("+",[i,a]):0===o.type.indexOf("text")?a:pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),a])}return i||pxt.blocks.H.mkStringLiteral("")}(e,t,n);break;case"lists_create_with":i=function(e,t,n){let i=t.inputList.map((t=>t.connection&&t.connection.targetBlock()?m(e,t.connection.targetBlock(),n):void 0)).filter((e=>!!e));return pxt.blocks.H.mkArrayLiteral(i,!t.getInputsInline())}(e,t,n);break;case"lists_index_get":i=function(e,t,n){const i=m(e,(0,s.getInputTargetBlock)(e,t,"LIST"),n),r=m(e,(0,s.getInputTargetBlock)(e,t,"INDEX"),n);return pxt.blocks.mkGroup([i,pxt.blocks.mkText("["),r,pxt.blocks.mkText("]")])}(e,t,n);break;case"lists_index_set":i=function(e,t,n){const i=(0,s.getInputTargetBlock)(e,t,"LIST"),r=m(e,i,n),o=m(e,(0,s.getInputTargetBlock)(e,t,"INDEX"),n),a=m(e,(0,s.getInputTargetBlock)(e,t,"VALUE"),n),l=pxt.blocks.mkGroup([r,pxt.blocks.mkText("["),o,pxt.blocks.mkText("] = "),a]);return"lists_create_with"===i.type?y(l):l}(e,t,n);break;case"math_js_op":case"math_js_round":i=function(e,t,n){const i=t.getFieldValue("OP"),r=[m(e,(0,s.getInputTargetBlock)(e,t,"ARG0"),n)];return t.getInput("ARG1")&&r.push(m(e,(0,s.getInputTargetBlock)(e,t,"ARG1"),n)),pxt.blocks.H.mathCall(i,r)}(e,t,n);break;case pxtc.TS_OUTPUT_TYPE:i=function(e,t,n){return pxt.blocks.mkText(t.getFieldValue("EXPRESSION").trim())}(0,t);break;case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":i=function(e,t,n){const i=(0,s.escapeVarName)(t.getFieldValue("VALUE"),e);return pxt.blocks.mkText(i)}(e,t);break;case"function_call_output":i=I(e,t,n,!1);break;default:let r=e.stdCallTable[t.type];r?i=r.imageLiteral?T(e,t,r.imageLiteral,r.imageLiteralColumns,r.imageLiteralRows,r.namespace,r.f,(0,s.visibleParams)(r,(0,s.countOptionals)(t,r)).map((i=>R(e,t,i,n)))):D(e,t,r,n):(pxt.reportError("blocks","unable to compile expression",{details:t.type}),i=(0,o.defaultValueForType)((0,o.returnType)(e,t)))}else if("Array"===(0,o.find)((0,o.returnType)(e,t)).type){let n="lists_index_get"===t.getParent().type;if(!n){const i=e.stdCallTable[t.getParent().type];n=i&&i.isExpression}const r=pxt.blocks.mkText("[0]");i=n?r:y(r)}else i=(0,o.defaultValueForType)((0,o.returnType)(e,t));return i.id=t.id,i}function b(e,t){let n=[],i=t;for(;t;)t.isEnabled()&&(0,s.append)(n,g(e,t)),t=t.getNextBlock();return i&&e.blockDeclarations[i.id]&&e.blockDeclarations[i.id].filter((e=>!e.alreadyDeclared)).forEach((t=>{n.unshift(k(t,e.blocksInfo)),t.alreadyDeclared=r.BlockDeclarationType.Implicit})),pxt.blocks.mkBlock(n)}function y(e){const t=pxt.blocks.mkStmt(pxt.blocks.mkText(";"));return t.glueToBlock=pxt.blocks.GlueMode.NoSpace,pxt.blocks.mkGroup([t,e])}function v(e,t,n){let i=(0,s.getInputTargetBlock)(e,t,"VALUE"),a=(0,o.lookup)(e,t,t.getField("VAR").getText()),l=e.idToScope[t.id].declaredVars[a.name]===a&&!a.firstReference&&!a.alreadyDeclared;l&&(0,s.forEachChildExpression)(t,(t=>{"variables_get"===t.type&&(0,o.lookup)(e,t,t.getField("VAR").getText())===a&&(l=!1)}),!0);let c=m(e,i,n),u=a.escapedName+" = ";if(a.isAssigned=!0,l){a.alreadyDeclared=r.BlockDeclarationType.Assigned;const t=(0,o.getConcreteType)(a.type);if(u=`let ${a.escapedName} = `,t){const n=(0,o.getConcreteType)((0,o.returnType)(e,i));t.type!==n.type&&(u=`let ${a.escapedName}: ${t.type} = `)}}else a.firstReference||(a.firstReference=t);return pxt.blocks.mkStmt(pxt.blocks.mkText(u),c)}function _(e,t,n){let i=(0,s.getInputTargetBlock)(e,t,"VALUE"),r=(0,o.lookup)(e,t,t.getField("VAR").getText()),a=m(e,i,n),l=pxt.blocks.mkText(r.escapedName);return pxt.blocks.mkStmt(pxt.blocks.mkInfix(l,"+=",a))}function E(e,t,n,i,r,a){const c=i.map((n=>R(e,t,n,a))),u=(0,s.getInputTargetBlock)(e,t,"HANDLER"),d=b(e,u);let h;if(pxt.appTarget.compile&&pxt.appTarget.compile.emptyEventHandlerComments&&0===d.children.length&&d.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.HANDLER_COMMENT}`))),(0,s.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.ObjectDestructuringMutator)h=t.mutation.compileMutation(e,a);else if(n.comp.handlerArgs.length){let i=(0,o.getEscapedCBParameters)(t,n,e);h=pxt.blocks.mkText(`function (${i.join(", ")})`)}return function(e,t,n,i,r,o,s=!1){let a;return r.noFinalNewline=!0,a=o?pxt.blocks.mkGroup([o,r]):pxt.blocks.mkGroup([pxt.blocks.mkText("function ()"),r]),s?pxt.blocks.mkStmt(pxt.blocks.H.extensionCall(n,i.concat([a]),!1)):t?pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(t,n,i.concat([a]),!1)):pxt.blocks.mkStmt(pxt.blocks.H.mkCall(n,i.concat([a]),!1))}(0,r,n.f,c,d,h,n.isExtensionMethod)}function T(e,t,n,i,r,o,s,a){a=void 0===a?[]:a;let l="\n";r=r||5,i=(i||5)*n;let c=t.getFieldValue("LEDS");c=c.replace(/[ `\n]+/g,"");for(let e=0;e<r;++e){for(let t=0;t<i;++t)t>0&&(l+=" "),l+="#"===c[e*i+t]?"#":".";l+="\n"}let u=pxt.blocks.H.mkStringLiteral(l);return u.canIndentInside=!0,pxt.blocks.H.namespaceCall(o,s,[u].concat(a),!1)}function x(e,t,n){let i=pxt.blocks.flattenNode(t);return j("format",{format:{input:i.output,pos:1}}).then((()=>({source:i.output,sourceMap:i.sourceMap,stats:e.stats,diagnostics:n||[]})))}function w(e,t){var n;const i=null===(n=e.getCommentText)||void 0===n?void 0:n.call(e);i&&t.push(i)}function k(e,t){const n=(0,o.getConcreteType)(e.type);let i,r="";if("null"==(i="Array"===n.type?pxt.blocks.mkText("[]"):(0,o.defaultValueForType)(n)).op||"[]"==i.op){let e=n.type;"Array"!==e&&"null[]"!==e||(e="number[]");let o=t.apis.byQName[e];o&&o.attributes.autoCreate?i=pxt.blocks.mkText(o.attributes.autoCreate+"()"):r=": "+e}return pxt.blocks.mkStmt(pxt.blocks.mkText("let "+e.escapedName+r+" = "),i)}function S(e,t,n,i,r){const o=a(e,r.x,r.x+r.width)||a(r.x,e,e+n),s=a(t,r.y,r.y+r.height)||a(r.y,t,t+i);return o&&s;function a(e,t,n){return e>=t&&e<=n}}n.compileBlockAsync=function(e,t){const n=e.workspace,i=(0,r.mkEnv)(n,t);(0,o.infer)(n&&n.getAllBlocks(!1),i,n);const s=g(i,e);return i.placeholders={},x(i,s)},n.compileAsync=function(e,t,n={}){const l=(0,r.mkEnv)(e,t,n),[u,p]=function(e,t,n){try{let l=t.getAllBlocks(!1);pxt.react.getTilemapProject&&pxt.react.getTilemapProject().removeInactiveBlockAssets(l.map((e=>e.id)));let u=t.getTopBlocks(!0);u=u.sort(((t,n)=>d(t,e)-d(n,e))),function(e,t,n){const r=i.Events.isEnabled();r&&i.Events.disable(),t.forEach((e=>e.setEnabled(!0)));const o={};function a(e,t){o[e]?f(t,!1):(f(t,!0),o[e]=t)}n.forEach((t=>{const n=e.stdCallTable[t.type];if(t.type==ts.pxtc.ON_START_TYPE)a(ts.pxtc.ON_START_TYPE,t);else{if((0,s.isFunctionDefinition)(t)||n&&n.attrs.blockAllowMultiple&&!n.attrs.handlerStatement)return;if(n&&n.hasHandler&&!n.attrs.handlerStatement)a(n.attrs.blockHandlerKey||h(e,t),t);else{let e=t;for(;e;)f(t,!1),e=e.getNextBlock()}}})),r&&i.Events.enable()}(e,l,u),l=l.filter((e=>e.isEnabled())),u=u.filter((e=>e.isEnabled())),(0,c.trackAllVariables)(u,e),(0,o.infer)(l,e,t);const p=[],m=function(e,t){if(!e.length||e.some((e=>!e.rendered)))return{orphans:t,idToComments:{}};const n=e.map((e=>{const t=e.getBoundingRectangle(),n=e.getHeightWidth();return{id:e.id,x:t.left,y:t.top,width:n.width,height:n.height}})),i={orphans:[],idToComments:{}};for(const e of t){const t=e.getBoundingRectangle(),r=e.getHeightWidth(),o=t.left,s=t.top;let a;for(const e of n)(S(o,s,r.width,r.height,e)||!a&&S(o-20,s-20,r.width+40,r.height+40,e))&&(a=e);a?(i.idToComments[a.id]||(i.idToComments[a.id]=[]),i.idToComments[a.id].push(e)):i.orphans.push(e)}return i}(u,t.getTopComments(!0));m.orphans.forEach((e=>(0,s.append)(p,L(e).children))),u.forEach((t=>{if(m.idToComments[t.id]&&m.idToComments[t.id].forEach((e=>{(0,s.append)(p,L(e).children)})),t.type==ts.pxtc.ON_START_TYPE)(0,s.append)(p,g(e,t));else{const n=pxt.blocks.mkBlock(g(e,t));n.type==pxt.blocks.NT.Block?(0,s.append)(p,n.children):p.push(n)}}));const b=[];e.enums.forEach((e=>{const n=t.getVariablesOfType(e.name);if(n&&n.length){const t=n.map((e=>{const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}));t.sort(((e,t)=>e[1]-t[1]));const i=[];let r=-1;t.forEach((([t,n],o)=>{let s;if(e.isBitMask){const e=Math.log2(n);e>=0&&Math.floor(e)===e&&(s=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkSimpleCall("<<",[pxt.blocks.H.mkNumberLiteral(1),pxt.blocks.H.mkNumberLiteral(e)])))}else if(e.isHash){const e=ts.pxtc.Util.codalHash16(t.toLowerCase());s=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(e))}s||(s=n===r+1?pxt.blocks.mkText(t):pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(n))),i.push(s),r=n}));const o=pxt.blocks.mkCommaSep(i,!0);o.glueToBlock=pxt.blocks.GlueMode.NoSpace,b.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`enum ${e.name}`),pxt.blocks.mkBlock([o])]))}})),e.kinds.forEach((e=>{const n=t.getVariablesOfType("KIND_"+e.name);if(n&&n.length){const t=n.map((e=>e.name)).filter((t=>-1===e.initialMembers.indexOf(t)));t.length&&b.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`namespace ${e.name}`),pxt.blocks.mkBlock(t.map((t=>pxt.blocks.mkStmt(pxt.blocks.mkText(`export const ${t} = ${e.name}.${e.createFunctionName}()`)))))]))}}));const y=e.allVariables.filter((e=>!e.alreadyDeclared)).map((e=>k(e,n)));return e.allVariables.filter((e=>e.alreadyDeclared===r.BlockDeclarationType.Implicit&&!e.isAssigned)).forEach((t=>{const n=(0,o.getConcreteType)(t.type);"string"===n.type||"number"===n.type||"boolean"===n.type||(0,a.isArrayType)(n.type)||e.diagnostics.push({blockId:t.firstReference&&t.firstReference.id,message:lf("Variable '{0}' is never assigned",t.name)})})),[b.concat(y.concat(p)),e.diagnostics]}catch(t){let n=t.block;if(!n)throw t;n.setWarningText(t+""),e.errors.push(n)}finally{e.placeholders={}}return[null,null]}(l,e,t);return x(l,u,p)},n.callKey=h,n.compileExpression=m;let C={ADD:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",LT:"<",LTE:"<=",GT:">",GTE:">=",AND:"&&",OR:"||",EQ:"==",NEQ:"!=",POWER:"**"};function A(e,t,n){const i=(0,s.escapeVarName)(t.getFieldValue("NAME"),e,!0);return pxt.blocks.mkStmt(pxt.blocks.mkText(i+"()"))}function I(e,t,n,i){const r=(0,s.escapeVarName)(t.getField("function_name").getText(),e,!0),o=!t.getInputsInline(),a=t.getArguments().map((e=>({actualName:e.name,definitionName:e.id}))).map((i=>R(e,t,i,n))),l=pxt.blocks.H.stdCall(r,a,o);return i?pxt.blocks.mkStmt(l):l}function O(e,t,n){const i=(0,s.getInputTargetBlock)(e,t,"RETURN_VALUE");return i&&"placeholder"!=i.type?pxt.blocks.mkStmt(pxt.blocks.mkText("return "),m(e,i,n)):pxt.blocks.mkStmt(pxt.blocks.mkText("return"))}function N(e,t,n){const i=e.stdCallTable[t.type];return i.imageLiteral?pxt.blocks.mkStmt(T(0,t,i.imageLiteral,i.imageLiteralColumns,i.imageLiteralRows,i.namespace,i.f,(0,s.visibleParams)(i,(0,s.countOptionals)(t,i)).map((i=>R(e,t,i,n))))):i.hasHandler?E(e,t,i,function(e,t){return(0,s.visibleParams)(e,(0,s.countOptionals)(t,e)).filter((e=>!!e.definitionName))}(i,t),i.namespace,n):pxt.blocks.mkStmt(D(e,t,i,n))}function R(e,t,n,r,a=!1){let l=t.getFieldValue(n.definitionName);if(null!=l){const r=t.getField(n.definitionName);if(r instanceof i.FieldTextInput||r instanceof u.FieldTextInput)return pxt.blocks.H.mkStringLiteral(l);if(r instanceof u.FieldTilemap&&!r.isGreyBlock){const t=pxt.react.getTilemapProject(),n=r.getValue();if(n.startsWith("tilemap`"))return pxt.blocks.mkText(n);if(e.options.emitTilemapLiterals)try{const e=pxt.sprite.decodeTilemap(n,"typescript",t);if(e){const[n]=t.createNewTilemapFromData(e);return pxt.blocks.mkText(`tilemap\`${n}\``)}}catch(e){}}const o=e.blocksInfo.apis.byQName[n.type];if(o&&o.attributes.emitAsConstant)for(const t of Object.keys(e.blocksInfo.apis.byQName)){const n=e.blocksInfo.apis.byQName[t];if(n&&n.attributes&&n.attributes.enumIdentity===l)return pxt.blocks.mkText(t)}let s=pxt.blocks.mkText(l);return s.canIndentInside="string"==typeof l&&l.indexOf("\n")>=0,s}{(0,o.attachPlaceholderIf)(e,t,n.definitionName);const i=(0,s.getInputTargetBlock)(e,t,n.definitionName);return a&&"lists_create_with"===i.type?y(m(e,i,r)):n.shadowOptions&&n.shadowOptions.toString&&!(0,o.isStringType)((0,o.returnType)(e,i))?pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),pxt.blocks.H.mkParenthesizedExpression(m(e,i,r))]):m(e,i,r)}}function D(e,t,n,i){let r;if((0,s.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.RestParameterMutator)r=t.mutation.compileMutation(e,i).children;else{if("ENUM_GET"===n.attrs.shim){const e=n.attrs.enumName,i=t.getFieldValue("MEMBER").replace(/^\d+/,"");return pxt.blocks.H.mkPropertyAccess(i,pxt.blocks.mkText(e))}if("KIND_GET"===n.attrs.shim){const i=e.kinds.filter((e=>e.blockId===n.attrs.blockId))[0];return pxt.blocks.H.mkPropertyAccess(t.getFieldValue("MEMBER"),pxt.blocks.mkText(i.name))}r=(0,s.visibleParams)(n,(0,s.countOptionals)(t,n)).map(((r,o)=>R(e,t,r,i,n.isExtensionMethod&&0===o&&!n.isExpression)))}let o=n.namespace,a=n.f;if(n.attrs.blockAliasFor){const t=e.blocksInfo.apis.byQName[n.attrs.blockAliasFor];t&&(a=t.name,o=t.namespace)}const c=!t.getInputsInline();if(n.isIdentity)return r[0];if(n.property)return pxt.blocks.H.mkPropertyAccess(a,r[0]);if("@get@"==a)return pxt.blocks.H.mkPropertyAccess(r[1].op.replace(/.*\./,""),r[0]);if("@set@"==a)return pxt.blocks.H.mkAssign(pxt.blocks.H.mkPropertyAccess(r[1].op.replace(/.*\./,"").replace(/@set/,""),r[0]),r[2]);if("@change@"==a)return pxt.blocks.H.mkSimpleCall("+=",[pxt.blocks.H.mkPropertyAccess(r[1].op.replace(/.*\./,"").replace(/@set/,""),r[0]),r[2]]);if(n.isExtensionMethod){if(n.attrs.defaultInstance){let o;(0,s.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.DefaultInstanceMutator&&(o=t.mutation.compileMutation(e,i)),o?r.unshift(o):r.unshift(pxt.blocks.mkText(n.attrs.defaultInstance))}return pxt.blocks.H.extensionCall(a,r,c)}return o?pxt.blocks.H.namespaceCall(o,a,r,c):pxt.blocks.H.stdCall(a,r,c)}function L(e){const t=e.getContent();return pxt.blocks.H.mkMultiComment(t.trim())}function M(e,t){return P(e,t)||"logic_boolean"===t.type||"text"===t.type}function P(e,t){if(!t)return!1;if("math_number"===t.type||"math_integer"===t.type||"math_number_minmax"===t.type||"math_whole_number"===t.type)return!0;const n=e.stdCallTable[t.type];if(!n)return!1;const{comp:i}=n;if("TD_ID"===n.attrs.shim&&1===i.parameters.length){const n=t.getFieldValue(i.parameters[0].definitionName);return n?!isNaN(parseInt(n)):P(e,(0,s.getInputTargetBlock)(e,t,i.parameters[0].definitionName))}return!1}function B(e){let t=e.getFieldValue("math_number_minmax"===e.type?"SLIDER":"NUM");const n=parseFloat(t);return function(e,t){isFinite(e)&&!isNaN(e)||function(e,t){let n=new Error(e);throw n.block=t,n}(lf("Number entered is either too large or too small"),t)}(n,e),n}function j(e,t){return pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t)}n.workerOpAsync=j},{"../fields":65,"../legacyMutations":70,"../toolbox":120,"./environment":13,"./typeChecker":14,"./util":15,"./variables":16,blockly:376}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mkEnv=n.emptyEnv=n.BlockDeclarationType=n.Point=void 0;const i=e("./util");var r;function o(e,t){return{workspace:e,options:t,stdCallTable:{},userFunctionReturnValues:{},diagnostics:[],errors:[],renames:{oldToNew:{},takenNames:{},oldToNewFunctions:{}},stats:{},enums:[],kinds:[],idToScope:{},blockDeclarations:{},allVariables:[],blocksInfo:null,placeholders:{}}}n.Point=class{constructor(e,t,n,i,r){this.link=e,this.type=t,this.parentType=n,this.childType=i,this.isArrayType=r}},(r=n.BlockDeclarationType||(n.BlockDeclarationType={}))[r.None=0]="None",r[r.Argument=1]="Argument",r[r.Assigned=2]="Assigned",r[r.Implicit=3]="Implicit",n.emptyEnv=o,n.mkEnv=function(e,t,n={}){let r=o(e,n);return r.blocksInfo=t,t&&(Object.keys(t.apis.byQName).forEach((e=>{const n=t.apis.byQName[e];!n.pkg||6!==n.kind&&3!==n.kind&&5!==n.kind&&4!==n.kind||(r.renames.takenNames[n.qName]=!0)})),t.enumsByName&&Object.keys(t.enumsByName).forEach((e=>r.enums.push(t.enumsByName[e]))),t.kindsByName&&Object.keys(t.kindsByName).forEach((e=>r.kinds.push(t.kindsByName[e]))),t.blocks.forEach((e=>{if(r.stdCallTable[e.attributes.blockId])return void pxt.reportError("blocks","function already defined",{details:e.attributes.blockId,qualifiedName:e.qName,packageName:e.pkg});r.renames.takenNames[e.namespace]=!0;const t=pxt.blocks.compileInfo(e),n=!!t.thisParameter;r.stdCallTable[e.attributes.blockId]={namespace:e.namespace,f:e.name,comp:t,attrs:e.attributes,isExtensionMethod:n,isExpression:e.retType&&"void"!==e.retType,imageLiteral:e.attributes.imageLiteral||e.attributes.gridLiteral,imageLiteralColumns:e.attributes.imageLiteralColumns,imageLiteralRows:e.attributes.imageLiteralRows,hasHandler:pxt.blocks.hasHandler(e),property:!e.parameters,isIdentity:"TD_ID"==e.attributes.shim}})),e.getTopBlocks(!1).filter(i.isFunctionDefinition).forEach((e=>{const t="procedures_defnoreturn"===e.type?e.getFieldValue("NAME"):e.getField("function_name").getText();(0,i.escapeVarName)(t,r,!0)}))),r}},{"./util":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isBooleanType=n.isStringType=n.defaultValueForType=n.getEscapedCBParameters=n.isFunctionRecursive=n.getDeclaredVariables=n.lookup=n.getConcreteType=n.attachPlaceholderIf=n.returnType=n.find=n.mkPoint=n.infer=void 0;const i=e("./environment"),r=e("./util"),o=e("../plugins/functions");function s(e,t){let n=f(e),i=f(t);if(C(null==n.link&&null==i.link),n==i)return;if(g(n))return void y(e.type,t.type);if(g(i))return y(e.type,t.type),e.type=null,e.link=i,n.link=i,void(n.isArrayType=i.isArrayType);if(n.childType&&i.childType){const e=n.childType;n.childType=null,s(e,i.childType)}else n.childType&&!i.childType&&(i.childType=n.childType);if(n.parentType&&i.parentType){const e=n.parentType;n.parentType=null,s(e,i.parentType)}else!n.parentType||i.parentType||i.type||(i.parentType=n.parentType);let r=y(n.type,i.type);e.link=i,n.link=i,n.isArrayType=i.isArrayType,e.type=null,t.type=r}function a(e,t,n,i){_(e,t,n);try{s(m(e,(0,r.getInputTargetBlock)(e,t,n)),i)}catch(e){}}function l(e,t=!1){return new i.Point(null,e,null,null,t)}n.infer=function(e,t,n){function i(e){var t,n;const i=null===(n=null===(t=e.connection)||void 0===t?void 0:t.getCheck())||void 0===n?void 0:n[0];return e.name?i||"T":void 0}function o(e,n){let o=e.inputList.filter((e=>"T"===i(e)));if(o.length){const i=(0,r.getInputTargetBlock)(t,e,o[0].name);if(i){const r=m(t,i),o=r.type?p(m(t,i).type+"[]"):p(null);return E(o,r),a(t,e,n,o),!0}}return!1}e&&e.filter((e=>e.isEnabled())).forEach((e=>{try{switch(e.type){case"math_op2":a(t,e,"x",p(c.type)),a(t,e,"y",p(c.type));break;case"math_op3":a(t,e,"x",p(c.type));break;case"math_arithmetic":case"logic_compare":switch(e.getFieldValue("OP")){case"ADD":case"MINUS":case"MULTIPLY":case"DIVIDE":case"LT":case"LTE":case"GT":case"GTE":case"POWER":a(t,e,"A",p(c.type)),a(t,e,"B",p(c.type));break;case"AND":case"OR":_(t,e,"A",u.type),_(t,e,"B",u.type);break;case"EQ":case"NEQ":_(t,e,"A"),_(t,e,"B");let n=m(t,(0,r.getInputTargetBlock)(t,e,"A")),i=m(t,(0,r.getInputTargetBlock)(t,e,"B"));try{s(n,i)}catch(e){}}break;case"logic_operation":_(t,e,"A",u.type),_(t,e,"B",u.type);break;case"logic_negate":_(t,e,"BOOL",u.type);break;case"controls_if":for(let n=0;n<=e.elseifCount_;++n)_(t,e,"IF"+n,u.type);break;case"pxt_controls_for":case"controls_simple_for":a(t,e,"TO",p(c.type));break;case"pxt_controls_for_of":case"controls_for_of":E(m(t,(0,r.getInputTargetBlock)(t,e,"LIST")),x(t,e,(0,r.getLoopVariableField)(t,e).getField("VAR").getText()).type);break;case"variables_set":case"variables_change":let n=x(t,e,e.getField("VAR").getText()).type;_(t,e,"VALUE");let l=(0,r.getInputTargetBlock)(t,e,"VALUE");if(l){let i=function(e,t){var n;const i=null===(n=t.outputConnection)||void 0===n?void 0:n.getCheck();return(null==i?void 0:i.length)&&"Array"!==i[0]&&"T"!==i[0]?i.map((e=>p(e))):[m(e,t)]}(t,l);const r=f(n);if(r.type&&i.slice(1).some((e=>e.type===r.type)))n.link=f(i[0]);else try{s(n,i[0])}catch(e){}}break;case"controls_repeat_ext":a(t,e,"TIMES",p(c.type));break;case"device_while":_(t,e,"COND",u.type);break;case"lists_index_get":a(t,e,"LIST",p("Array")),a(t,e,"INDEX",p(c.type)),E(m(t,(0,r.getInputTargetBlock)(t,e,"LIST")),m(t,e));break;case"lists_index_set":a(t,e,"LIST",p("Array")),_(t,e,"VALUE"),o(e,"LIST"),a(t,e,"INDEX",p(c.type));break;case"function_definition":b(t,e.getField("function_name").getText());break;case"function_call":case"function_call_output":e.getArguments().forEach((n=>{a(t,e,n.id,p(n.type))}));break;case pxtc.TS_RETURN_STATEMENT_TYPE:_(t,e,"RETURN_VALUE");break;case pxtc.PAUSE_UNTIL_TYPE:a(t,e,"PREDICATE",u);break;default:if(e.type in t.stdCallTable){const n=t.stdCallTable[e.type];if("ENUM_GET"===n.attrs.shim||"KIND_GET"===n.attrs.shim)return;(0,r.visibleParams)(n,(0,r.countOptionals)(e,n)).forEach(((r,s)=>{var l;const c=n.isExtensionMethod&&0===s;if(r.definitionName&&!e.getFieldValue(r.definitionName)){let n=e.inputList.find((e=>e.name==r.definitionName));const s=null===(l=null==n?void 0:n.connection)||void 0===l?void 0:l.getCheck();if(s){if(c&&"Array"===i(n)&&o(e,r.definitionName))return;for(let n=0;n<s.length;n++)try{let i=s[n];a(t,e,r.definitionName,p(i));break}catch(e){}}}}))}}}catch(n){const i=n.block||e;i.setWarningText(n+""),t.errors.push(i)}})),t.allVariables.forEach((e=>{null==T(e.type).type&&(e.isFunctionParameter?e.type.isArrayType&&(e.type.type="any[]"):s(e.type,p(e.type.isArrayType?"number[]":c.type)))}))},n.mkPoint=l;const c=l("number"),u=l("boolean"),d=l("string"),h=l("void");function p(e){if(!e)return l(e);switch(e.toLowerCase()){case"number":return c;case"boolean":return u;case"string":return d;case"void":return h;default:return l(e)}}function f(e){return e.link?f(e.link):e}function g(e){return e===c||e===u||e===d||e===h}function m(e,t){var n,i;if(C(null!=t),function(e){return"placeholder"==e.type||e.type===pxtc.TS_OUTPUT_TYPE}(t))return t.p||(t.p=l(null)),f(t.p);if("variables_get"==t.type)return f(x(e,t,t.getField("VAR").getText()).type);if("function_call_output"==t.type)return function(e,t){return b(e,t.getField("function_name").getText())}(e,t);if(!t.outputConnection)return p(h.type);const r=(null===(i=null===(n=t.outputConnection)||void 0===n?void 0:n.getCheck())||void 0===i?void 0:i[0])||"T";if("Array"===r){const n=t.outputConnection.getCheck();if(n.length>1)return p(n[1]);let i;if("lists_create_with"==t.type){if(t.inputList&&t.inputList.length)for(const n of t.inputList)if(n.connection&&n.connection.targetBlock()){let t=f(m(e,n.connection.targetBlock()));if(t){if(t.parentType)return t.parentType;E(i=t.type?p(t.type+"[]"):l(null),t);break}}}else"argument_reporter_array"==t.type&&(i||(i=x(e,t,t.getFieldValue("VALUE")).type));return i&&(i.isArrayType=!0),i||l(null,!0)}if("T"===r){const n=e.stdCallTable[t.type],i="lists_index_get"===t.type;if(i||n&&n.comp.thisParameter){let r;if((r=i?t.inputList.find((e=>"LIST"===e.name)):t.inputList.find((e=>e.name===n.comp.thisParameter.definitionName))).connection&&r.connection.targetBlock()){const t=m(e,r.connection.targetBlock());if(t.childType)return t.childType;const n=v(t.type)&&"Array"!==t.type?l(t.type.substr(0,t.type.length-2)):l(null);return E(t,n),n}}return l(null)}return p(r)}function b(e,t){if(!e.userFunctionReturnValues[t]){const n=(0,o.getDefinition)(t,e.workspace);let i=l("void");if(k(e,n,!0))i=l("any");else{const o=[];for(const t of n.getDescendants(!1))"function_return"===t.type&&(_(e,t,"RETURN_VALUE"),o.push(m(e,(0,r.getInputTargetBlock)(e,t,"RETURN_VALUE"))));if(o.length)try{const e=l(null);for(const t of o)s(e,t);i=e}catch(r){e.diagnostics.push({blockId:n.id,message:pxt.Util.lf("Function '{0}' has an invalid return type",t)}),i=l("any")}}e.userFunctionReturnValues[t]=i}return e.userFunctionReturnValues[t]}function y(e,t){if(null==e||"Array"===e&&v(t))return t;if(null==t||"Array"===t&&v(e))return e;if(e==t)return e;throw new Error("cannot mix "+e+" with "+t)}function v(e){return e&&(-1!==e.indexOf("[]")||"Array"==e)}function _(e,t,n,i){const r=t.getInputTargetBlock(n);r?r.type!==pxtc.TS_OUTPUT_TYPE||r.p||(r.p=l(null)):(e.placeholders[t.id]||(e.placeholders[t.id]={}),e.placeholders[t.id][n]||(e.placeholders[t.id][n]=function(e,t,n){return{type:"placeholder",p:l(n||null),workspace:e.workspace,parentBlock_:t,getParent:()=>t}}(e,t,i)))}function E(e,t){const n=f(e),i=f(t);n.childType?s(n.childType,i):n.type||(n.childType=i),i.parentType?s(i.parentType,n):i.type||(i.parentType=n),v(n.type)&&(n.isArrayType=!0)}function T(e,t=[]){const n=f(e);if(-1===t.indexOf(n)&&(t.push(n),!n.type||"Array"===n.type)){if(n.parentType){const e=T(n.parentType,t);if(e.type&&"Array"!==e.type)return v(e.type)?n.type=e.type.substr(0,e.type.length-2):n.type=e.type,n}if(n.childType){const e=T(n.childType,t);if(e.type)return n.type=e.type+"[]",n}}return n}function x(e,t,n){return w(n,e.idToScope[t.id])}function w(e,t){return t&&t.declaredVars[e]?t.declaredVars[e]:t&&t.parent?w(e,t.parent):null}function k(e,t,n){const i=(0,r.getFunctionName)(t),s={};return function t(a){let l;l=n?a.getDescendants(!1).filter((e=>"function_return"==e.type)).map((t=>(0,r.getInputTargetBlock)(e,t,"RETURN_VALUE"))).filter((e=>e&&"function_call_output"===e.type)):a.getDescendants(!1).filter((e=>"function_call_output"==e.type));for(const e of l){const n=(0,r.getFunctionName)(e);if(n===i)return!0;if(!s[n]&&(s[n]=!0,t((0,o.getDefinition)(n,e.workspace))))return!0}return!1}(t)}function S(e,t,n){let i=[];if(t.attrs.draggableParameters)for(let o=0;o<t.comp.handlerArgs.length;o++){const s=t.comp.handlerArgs[o];let a;const c=(0,r.getInputTargetBlock)(n,e,"HANDLER_DRAG_PARAM_"+s.name);if(null===(a="reporter"===t.attrs.draggableParameters?c&&c.getFieldValue("VALUE"):c&&c.getField("VAR").getText()))break;i.push({name:a,type:l(s.type)})}else for(let n=0;n<t.comp.handlerArgs.length;n++){const r=t.comp.handlerArgs[n],o=e.getField("HANDLER_"+r.name),s=o&&o.getText();if(null===s)break;i.push({name:s,type:l(r.type)})}return i}function C(e){if(!e)throw new Error("Assertion failure")}n.find=f,n.returnType=m,n.attachPlaceholderIf=_,n.getConcreteType=T,n.lookup=x,n.getDeclaredVariables=function(e,t){switch(e.type){case"pxt_controls_for":case"controls_simple_for":return[{name:(0,r.getLoopVariableField)(t,e).getField("VAR").getText(),type:c}];case"pxt_controls_for_of":case"controls_for_of":return[{name:(0,r.getLoopVariableField)(t,e).getField("VAR").getText(),type:l(null)}];case"function_definition":return e.getArguments().filter((e=>"Array"===e.type)).map((e=>{const t=l(null);return t.isArrayType=!0,{name:e.name,type:t,isFunctionParameter:!0}}))}if((0,r.isMutatingBlock)(e)){const t=e.mutation.getDeclaredVariables();if(t)return Object.keys(t).map((e=>({name:e,type:l(t[e])})))}let n=t.stdCallTable[e.type];return n&&n.comp.handlerArgs.length?S(e,n,t):[]},n.isFunctionRecursive=k,n.getEscapedCBParameters=function(e,t,n){return S(e,t,n).map((t=>x(n,e,t.name).escapedName))},n.defaultValueForType=function(e){if(null==e.type&&(s(e,p(c.type)),e=f(e)),v(e.type)||e.isArrayType)return pxt.blocks.mkText("[]");switch(e.type){case"boolean":return pxt.blocks.H.mkBooleanLiteral(!1);case"number":return pxt.blocks.H.mkNumberLiteral(0);case"string":return pxt.blocks.H.mkStringLiteral("");default:return pxt.blocks.mkText("null")}},n.isStringType=function(e){return e===d},n.isBooleanType=function(e){return e===u}},{"../plugins/functions":93,"./environment":13,"./util":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isFunctionDefinition=n.append=n.escapeVarName=n.isMutatingBlock=n.getInputTargetBlock=n.countOptionals=n.visibleParams=n.getFunctionName=n.getLoopVariableField=n.printScope=n.forEachStatementInput=n.forEachChildExpression=void 0;const i=e("blockly");function r(e){let t="";for(let n=0;n<e;n++)t+="    ";return t}function o(e,t,n){var i;return t.getInputTargetBlock(n)||(null===(i=e.placeholders[t.id])||void 0===i?void 0:i[n])}n.forEachChildExpression=function e(t,n,r=!1){t.inputList.filter((e=>e.type===i.inputTypes.VALUE)).forEach((t=>{t.connection&&t.connection.targetBlock()&&(n(t.connection.targetBlock()),r&&e(t.connection.targetBlock(),n,r))}))},n.forEachStatementInput=function(e,t){e.inputList.filter((e=>e.type===i.inputTypes.STATEMENT)).forEach((e=>{e.connection&&e.connection.targetBlock()&&t(e.connection.targetBlock())}))},n.printScope=function e(t,n=0){const i=Object.keys(t.declaredVars).map((e=>`${e}(${t.declaredVars[e].id})`)).join(",");t.referencedVars.join(", "),console.log(`${r(n)}SCOPE: ${t.firstStatement?t.firstStatement.type:"TOP-LEVEL"}`),i.length&&console.log(`${r(n)}DECS: ${i}`),t.children.forEach((t=>e(t,n+1)))},n.getLoopVariableField=function(e,t){return"pxt_controls_for"==t.type||"pxt_controls_for_of"==t.type?o(e,t,"VAR"):t},n.getFunctionName=function(e){return e.getField("function_name").getText()},n.visibleParams=function({comp:e},t){const n=[];return e.thisParameter&&n.push(e.thisParameter),e.parameters.forEach((e=>{e.isOptional&&t>0?(n.push(e),--t):e.isOptional||n.push(e)})),n},n.countOptionals=function(e,t){if(t.attrs.compileHiddenArguments)return t.comp.parameters.reduce(((e,t)=>(t.isOptional&&e++,e)),0);if(e.mutationToDom){const t=e.mutationToDom();if(t.hasAttribute("_expanded")){const e=parseInt(t.getAttribute("_expanded"));return isNaN(e)?0:Math.max(e,0)}}return 0},n.getInputTargetBlock=o,n.isMutatingBlock=function(e){return!!e.mutation},n.escapeVarName=function(e,t,n=!1){if(!e)return"_";if(n){if(t.renames.oldToNewFunctions[e])return t.renames.oldToNewFunctions[e]}else if(t.renames.oldToNew[e])return t.renames.oldToNew[e];let i=ts.pxtc.escapeIdentifier(e);if(t.renames.takenNames[i]){let e=2;for(;t.renames.takenNames[i+e];)e++;i+=e}return n?(t.renames.oldToNewFunctions[e]=i,t.renames.takenNames[i]=!0):t.renames.oldToNew[e]=i,i},n.append=function(e,t){e.push.apply(e,t)},n.isFunctionDefinition=function(e){return"procedures_defnoreturn"===e.type||"function_definition"===e.type}},{blockly:376}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.trackAllVariables=void 0;const i=e("blockly"),r=e("./environment"),o=e("./typeChecker"),s=e("./util");function a(e,t){const n=Object.keys(e.declaredVars);if(n.length){const i=n.map((t=>e.declaredVars[t]));e.firstStatement&&(t.blockDeclarations[e.firstStatement.id]=i.concat(t.blockDeclarations[e.firstStatement.id]||[])),i.forEach((e=>t.allVariables.push(e)))}e.children.forEach((e=>a(e,t)))}function l(e,t){let n;if(-1!==e.referencedVars.indexOf(t))return e;for(const i of e.children)if(c(i,t)){if(u(i,t))return e;if(n)return e;n=i}return n?l(n,t):void 0}function c(e,t){if(-1!==e.referencedVars.indexOf(t))return!0;for(const n of e.children)if(c(n,t))return!0;return!1}function u(e,t){if(-1!==e.assignedVars.indexOf(t))return!0;for(const n of e.children)if(u(n,t))return!0;return!1}function d(e,t){for(const t of Object.keys(e.declaredVars)){const i=e.declaredVars[t];i.escapedName||(i.escapedName=n(t))}function n(n){if(!n)return"_";let r=ts.pxtc.escapeIdentifier(n);if(t.renames.takenNames[r]||i(r,e,n)){let o=2;for(;t.renames.takenNames[r+o]||i(r+o,e,n);)o++;r+=o}return r}function i(e,t,n){if(t){for(const i of Object.keys(t.declaredVars)){const r=t.declaredVars[i];if((n!==r.name||r.name!==r.escapedName)&&r.escapedName===e)return!0}return i(e,t.parent,n)}return!1}e.children.forEach((e=>d(e,t)))}n.trackAllVariables=function(e,t){let n,c=1;return e.forEach((e=>{if(e.type===ts.pxtc.ON_START_TYPE){const i=e.getInputTargetBlock("HANDLER");i&&u(i,n={firstStatement:i,declaredVars:{},referencedVars:[],children:[],assignedVars:[]},t)}})),n||(n={firstStatement:null,declaredVars:{},referencedVars:[],children:[],assignedVars:[]}),e.forEach((e=>{e.type!==ts.pxtc.ON_START_TYPE&&u(e,n,t)})),Object.keys(n.declaredVars).forEach((e=>{const t=n.declaredVars[e];delete n.declaredVars[e],(l(n,t.id)||n).declaredVars[e]=t})),a(n,t),d(n,t),n;function u(e,t,n){if(n.idToScope[e.id]=t,"variables_get"===e.type){const n=h(e.getField("VAR").getText(),t);t.referencedVars.push(n.id)}else if("variables_set"===e.type||"variables_change"===e.type){const n=h(e.getField("VAR").getText(),t);t.assignedVars.push(n.id),t.referencedVars.push(n.id)}else if(e.type===pxtc.TS_STATEMENT_TYPE){const n=e.declaredVariables;n&&n.split(",").forEach((e=>{h(e,t).alreadyDeclared=r.BlockDeclarationType.Argument}))}if(function(e){return e.inputList.some((e=>e.type===i.inputTypes.STATEMENT))}(e)){const i=(0,o.getDeclaredVariables)(e,n).map((e=>Object.assign(Object.assign({},e),{id:c++})));let a=t;i.length&&(a={parent:t,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]},i.forEach((e=>{e.alreadyDeclared=r.BlockDeclarationType.Assigned,a.declaredVars[e.name]=e})),n.idToScope[e.id]=a),t!==a&&t.children.push(a),(0,s.forEachChildExpression)(e,(e=>{u(e,a,n)})),(0,s.forEachStatementInput)(e,(e=>{const t={parent:a,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]};a.children.push(t),u(e,t,n)}))}else(0,s.forEachChildExpression)(e,(e=>{u(e,t,n)}));e.nextConnection&&e.nextConnection.targetBlock()&&u(e.nextConnection.targetBlock(),t,n)}function h(e,t){return t.declaredVars[e]?t.declaredVars[e]:t.parent?h(e,t.parent):(t.declaredVars[e]={name:e,type:(0,o.mkPoint)(null),id:c++},t.declaredVars[e])}}},{"./environment":13,"./typeChecker":14,"./util":15,blockly:376}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initExpandableBlock=n.initVariableArgsBlock=n.appendMutation=void 0;const i=e("blockly"),r=e("./toolbox"),o=e("./constants"),s=e("./fields"),a=e("./loader");function l(e,t){const n=e,i=n.mutationToDom,r=n.domToMutation;n.mutationToDom=()=>{const e=i?i():document.createElement("mutation");return t.mutationToDom(e)},n.domToMutation=e=>{r&&r(e),t.domToMutation(e)}}n.appendMutation=l,n.initVariableArgsBlock=function(e,t){let n=0,r=0,o=e.appendDummyInput(),c=()=>{if(n!==r){if(n>r){const i=n-r;for(let n=0;n<i;n++){const i=t[r+n];o.insertFieldAt(o.fieldRow.length-1,new s.FieldArgumentVariable(i.name),"HANDLER_"+i.name);const a=e;(null==a?void 0:a.initSvg)&&a.initSvg()}}else{let e=r-n;for(let n=0;n<e;n++){const e=t[r-n-1];o.removeField("HANDLER_"+e.name)}}n>=t.length?o.removeField("_HANDLER_ADD"):r>=t.length&&u(),r=n}};function u(){o.appendField(new i.FieldImage(e.ADD_IMAGE_DATAURI,24,24,lf("Add argument"),(()=>{n=Math.min(n+1,t.length),c()}),!1),"_HANDLER_ADD")}i.Extensions.apply("inline-svgs",e,!1),u(),l(e,{mutationToDom:i=>{i.setAttribute("numArgs",n.toString());for(let r=0;r<n;r++){const n=e.getField("HANDLER_"+t[r].name);let o=n&&n.getText();i.setAttribute("arg"+r,o)}return i},domToMutation:i=>{let r=parseInt(i.getAttribute("numargs"));n=Math.min(isNaN(r)?0:r,t.length),c();for(let r=0;r<n;r++){const n=i.getAttribute("arg"+r),o="HANDLER_"+t[r].name;e.getField(o)&&(0,a.setVarFieldValue)(e,o,n)}}})},n.initExpandableBlock=function(e,t,n,s,a,u){const d="0_add_button",h="0_rem_button",p="0_add_rem_button",f="_expanded",g="_input_init",m=n.parameters.map((e=>e.name)),b=n.parameters.length,y=a?b:1,v="variable"===e.blocksById[t.type].attributes.inlineInputMode,_=e.blocksById[t.type].attributes.inlineInputModeLimit||4,E=e.blocksById[t.type].attributes.compileHiddenArguments,T=e.blocksById[t.type].attributes.expandableArgumentBreaks;let x;T&&(x=T.split(/[;,]/).map((e=>parseInt(e))));const w=new c(t);w.setEventsEnabled(!1),w.setValue(f,0),w.setValue(g,!1),w.setEventsEnabled(!0),i.Extensions.apply("inline-svgs",t,!1);let k=!1,S=!0;if(l(t,{mutationToDom:e=>(e.setAttribute(f,w.getString(f)),e.setAttribute(g,w.getString(g)),e),domToMutation:e=>{if(w.setEventsEnabled(!1),e.hasAttribute(g)&&"true"==e.getAttribute(g)&&!w.getBoolean(g)&&w.setValue(g,!0),N(),e.hasAttribute(f)){const n=parseInt(e.getAttribute(f));if(!isNaN(n)){const e=n-(w.getNumber(f)||0);w.getBoolean(g)?t.rendered||t.isInsertionMarker()?A(e,!0,t.isInsertionMarker()):(w.setValue(f,R(e)),O()):A(e,!0)}}w.setEventsEnabled(!0)}}),N(),E){let e=0;for(let i=0;i<t.inputList.length;i++){const r=t.inputList[i];(pxt.Util.startsWith(r.name,o.optionalInputWithFieldPrefix)||-1!==m.indexOf(r.name))&&(!r.connection||r.connection.isConnected()||t.isInsertionMarker()||L(r,s.definitionNameToParam[n.parameters[e].name]),++e)}}const C={updateBeforeRender:()=>{k||S&&(S=!1,k=!0,A(0,void 0,!0),k=!1)}};function A(e,i=!1,r=!1){const a=R(e);if(!r&&!i&&a===w.getNumber(f))return;w.setValue(f,a);const l=a;if(!w.getBoolean(g)&&l>0&&(N(),!t.rendered))return;let c=0;for(let e=0;e<t.inputList.length;e++){const i=t.inputList[e];if(pxt.Util.startsWith(i.name,o.optionalDummyInputPrefix))D(i,c<l||l===b);else if(pxt.Util.startsWith(i.name,o.optionalInputWithFieldPrefix)||-1!==m.indexOf(i.name)){const e=c<l;D(i,e),e&&i.connection&&!i.connection.isConnected()&&!t.isInsertionMarker()&&L(i,s.definitionNameToParam[n.parameters[c].name]),++c}}O(),v&&t.setInputsInline(l<_),i||t.render()}function I(e,n,r,o){t.appendDummyInput(e).appendField(new i.FieldImage(n,24,24,r,(()=>A(o)),!1))}function O(){if(k)return;const e=w.getNumber(f),n=e!==b,r=0!==e;t.inputList.some((e=>e.name===d))&&t.removeInput(d,!0),t.inputList.some((e=>e.name===h))&&t.removeInput(h,!0),t.inputList.some((e=>e.name===p))&&t.removeInput(p,!0),n&&r?t.appendDummyInput(p).appendField(new i.FieldImage(t.REMOVE_IMAGE_DATAURI,24,24,lf("Hide optional arguments"),(()=>A(-1*y)),!1)).appendField(new i.FieldImage(t.ADD_IMAGE_DATAURI,24,24,lf("Reveal optional arguments"),(()=>A(y)),!1)):n?I(d,t.ADD_IMAGE_DATAURI,lf("Reveal optional arguments"),y):r&&I(h,t.REMOVE_IMAGE_DATAURI,lf("Hide optional arguments"),-1*y)}function N(){w.setValue(g,!0),u(),O()}function R(e){const t=Math.min(Math.max(w.getNumber(f)+e,0),b);if(x){if(e>=0){if(0===t)return 0;for(const e of x)if(e>=t)return e;return b}for(let e=0;e<x.length;e++)if(x[e]>=t)return e>0?x[e-1]:0;return x[x.length-1]}return t}function D(e,t){e.setVisible(t)}function L(n,o){let s=(0,r.createShadowValue)(e,o);"value"===s.tagName.toLowerCase()&&(s=s.firstElementChild),i.Events.disable();try{const e=i.Xml.domToBlock(s,t.workspace);e&&n.connection.connect(e.outputConnection)}catch(e){}i.Events.enable()}t.mixin(C)};class c{constructor(e,t){this.block=e,this.fireEvents=!0,this.state=t||{}}setValue(e,t){if(this.fireEvents&&this.block.mutationToDom){const n=this.block.mutationToDom();this.state[e]=t.toString();const r=this.block.mutationToDom();Object.keys(this.state).forEach((e=>{n.getAttribute(e)!==this.state[e]&&r.setAttribute(e,this.state[e])}));const o=i.Xml.domToText(n),s=i.Xml.domToText(r);o!=s&&i.Events.fire(new i.Events.BlockChange(this.block,"mutation",null,o,s))}else this.state[e]=t.toString()}getNumber(e){return parseInt(this.state[e])}getBoolean(e){return"false"!=this.state[e]}getString(e){return this.state[e]}setEventsEnabled(e){this.fireEvents=e}}},{"./constants":18,"./fields":65,"./loader":71,"./toolbox":120,blockly:376}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.optionalInputWithFieldPrefix=n.optionalDummyInputPrefix=n.provider=void 0;const i=e("blockly");n.provider=new i.zelos.ConstantProvider,n.optionalDummyInputPrefix="0_optional_dummy",n.optionalInputWithFieldPrefix="0_optional_field"},{blockly:376}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerBlockitems=void 0;const i=e("blockly"),r=e("../external");var o,s;(s=o||(o={}))[s.Duplicate=10]="Duplicate",s[s.AddComment=20]="AddComment",s[s.ExpandCollapse=30]="ExpandCollapse",s[s.DeleteBlock=40]="DeleteBlock",s[s.Help=50]="Help",n.registerBlockitems=function(){(function(){const e={displayText:e=>e.block.isCollapsed()?pxt.U.lf("Expand Block"):pxt.U.lf("Collapse Block"),preconditionFn(e){const t=e.block;return t.workspace.getTopBlocks(!1).some((e=>e===t))&&t.statementInputCount>0&&!t.previousConnection&&!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block&&(pxt.tickEvent("blocks.context.expandCollapseBlock",void 0,{interactiveConsent:!0}),e.block.setCollapsed(!e.block.isCollapsed()))},scopeType:i.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtExpandCollapseBlock",weight:o.ExpandCollapse};i.ContextMenuRegistry.registry.register(e)})(),function(){const e={displayText:()=>pxt.U.lf("Help"),preconditionFn(e){const t=e.block;return("function"==typeof t.helpUrl?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback(e){if(!e.block)return;const t=e.block,n="function"==typeof t.helpUrl?t.helpUrl():t.helpUrl;n&&(0,r.openHelpUrl)(n)},scopeType:i.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtHelpBlock",weight:o.Help};i.ContextMenuRegistry.registry.register(e)}(),i.ContextMenuRegistry.registry.getItem("blockDelete").weight=o.DeleteBlock,i.ContextMenuRegistry.registry.getItem("blockComment").weight=o.AddComment,i.ContextMenuRegistry.registry.getItem("blockDuplicate").weight=o.Duplicate,i.ContextMenuRegistry.registry.unregister("blockCollapseExpand"),i.ContextMenuRegistry.registry.unregister("blockHelp"),i.ContextMenuRegistry.registry.unregister("blockInline")}},{"../external":24,blockly:376}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupWorkspaceContextMenu=n.initContextMenu=void 0;const i=e("blockly"),r=e("./workspaceItems"),o=e("../external"),s=e("./blockItems");n.initContextMenu=function(){const e=i.Msg;e.DUPLICATE_BLOCK=lf("{id:block}Duplicate"),e.DUPLICATE_COMMENT=lf("Duplicate Comment"),e.REMOVE_COMMENT=lf("Remove Comment"),e.ADD_COMMENT=lf("Add Comment"),e.EXTERNAL_INPUTS=lf("External Inputs"),e.INLINE_INPUTS=lf("Inline Inputs"),e.EXPAND_BLOCK=lf("Expand Block"),e.COLLAPSE_BLOCK=lf("Collapse Block"),e.ENABLE_BLOCK=lf("Enable Block"),e.DISABLE_BLOCK=lf("Disable Block"),e.DELETE_BLOCK=lf("Delete Block"),e.DELETE_X_BLOCKS=lf("Delete Blocks"),e.DELETE_ALL_BLOCKS=lf("Delete All Blocks"),e.HELP=lf("Help"),(0,r.registerWorkspaceItems)(),(0,s.registerBlockitems)()},n.setupWorkspaceContextMenu=function(e){e.configureContextMenu=(t,n)=>{e.options.comments&&!e.options.readOnly&&t.unshift(i.ContextMenu.workspaceCommentOption(e,n)),(0,o.onWorkspaceContextMenu)(e,t)}}},{"../external":24,"./blockItems":19,"./workspaceItems":22,blockly:376}],21:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./contextMenu"),n)},{"./contextMenu":20}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerWorkspaceItems=void 0;const i=e("blockly"),r=e("../layout");var o,s;(s=o||(o={}))[s.DeleteAll=20]="DeleteAll",s[s.FormatCode=30]="FormatCode",s[s.CollapseBlocks=40]="CollapseBlocks",s[s.ExpandBlocks=50]="ExpandBlocks",s[s.Snapshot=60]="Snapshot",n.registerWorkspaceItems=function(){(function(){const e={displayText:()=>pxt.U.lf("Format Code"),preconditionFn:e=>e.workspace.options.readOnly?"hidden":"enabled",callback(e){e.workspace&&(pxt.tickEvent("blocks.context.format",void 0,{interactiveConsent:!0}),(0,r.flow)(e.workspace,{useViewWidth:!0}))},scopeType:i.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtFormatCode",weight:o.FormatCode};i.ContextMenuRegistry.registry.register(e)})(),function(){const e={displayText:()=>pxt.U.lf("Snapshot"),preconditionFn(e){if(!(0,r.screenshotEnabled)())return"hidden";const t=e.workspace,n=t.getTopBlocks(!1),i=t.getTopComments(!1);return 0===n.length&&0===i.length?"disabled":"enabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.screenshot",void 0,{interactiveConsent:!0}),(async()=>{var t;let n=await(0,r.screenshotAsync)(e.workspace,null,null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.embedBlocksInSnapshot);pxt.BrowserUtils.isSafari()&&(n=n.replace(/^data:image\/[^;]/,"data:application/octet-stream")),pxt.BrowserUtils.browserDownloadDataUri(n,`${pxt.appTarget.nickname||pxt.appTarget.id}-${lf("screenshot")}.png`)})())},scopeType:i.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtSnapshotCode",weight:o.Snapshot};i.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Collapse Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&!e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.collapse",void 0,{interactiveConsent:!0}),(0,r.setCollapsedAll)(e.workspace,!0))},scopeType:i.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtCollapseBlocks",weight:o.CollapseBlocks};i.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Expand Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.expand",void 0,{interactiveConsent:!0}),(0,r.setCollapsedAll)(e.workspace,!1))},scopeType:i.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtExpandBlocks",weight:o.ExpandBlocks};i.ContextMenuRegistry.registry.register(e)}(),function(){const e=e=>{const t=[],n=e=>{if(e.isDeletable())t.push(...e.getDescendants(!1));else for(const t of e.getChildren(!1))n(t)};for(const t of e.getTopBlocks())n(t);return t},t={displayText:t=>e(t.workspace).filter((e=>!e.isShadow())).length>1?pxt.U.lf("Delete All Blocks"):pxt.U.lf("Delete Block"),preconditionFn:t=>t.workspace.options.readOnly?"hidden":0===e(t.workspace).filter((e=>!e.isShadow())).length?"disabled":"enabled",callback(t){if(!t.workspace)return;const n=e(t.workspace),r=n.filter((e=>!e.isShadow())).length,o=()=>{let e=i.utils.idGenerator.genUid();i.Events.setGroup(e);let t=n.shift();t&&(t.workspace?(t.dispose(!1,!0),setTimeout(o,10)):o()),i.Events.setGroup(!1)};pxt.tickEvent("blocks.context.delete",void 0,{interactiveConsent:!0}),r<2?o():i.dialog.confirm(lf("Delete all {0} blocks?",r),(e=>{e&&o()}))},scopeType:i.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtDeleteAllBlocks",weight:o.DeleteAll};i.ContextMenuRegistry.registry.register(t)}(),i.ContextMenuRegistry.registry.unregister("workspaceDelete"),i.ContextMenuRegistry.registry.unregister("expandWorkspace"),i.ContextMenuRegistry.registry.unregister("collapseWorkspace"),i.ContextMenuRegistry.registry.unregister("cleanWorkspace"),i.ContextMenuRegistry.registry.unregister("redoWorkspace"),i.ContextMenuRegistry.registry.unregister("undoWorkspace")}},{"../layout":69,blockly:376}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.decompiledDiffAsync=n.mergeXml=n.diffXml=n.needsDecompiledDiff=void 0;const i=e("blockly"),r=e("./importer"),o=e("./render");n.needsDecompiledDiff=function(e,t){if(!e||!t)return!1;const n={};if(e.replace(/id="([^"]+)"/g,((e,t)=>(n[t]=!0,""))),!Object.keys(n).length)return!1;let i=0,r=0;return t.replace(/id="([^"]+)"/g,((e,t)=>(i++,n[t]&&r++,""))),i>0&&0==r},n.diffXml=function(e,t,n){return a((0,r.loadWorkspaceXml)(e,!0),(0,r.loadWorkspaceXml)(t,!0),n)};const s="#d0d0d0";function a(e,t,n){try{return i.Events.disable(),function(e,t,n){pxt.tickEvent("blocks.diff",{started:1}),n=n||{};const a=l();if(!e)return{ws:void 0,message:lf("All blocks are new."),added:0,deleted:0,modified:1};if(!t)return{ws:void 0,message:lf("The current blocks seem corrupted."),added:0,deleted:0,modified:1};const u=pxt.Util.toDictionary(e.getTopBlocks(!1),(e=>c(e,!0)));t.getTopBlocks(!1).forEach((t=>{const n=c(t,!0),i=e.getBlockById(t.id)||u[n];i&&n==c(i,!0)&&(a("fast unmodified top ",t.id),t.dispose(!1),i.dispose(!1))}));const d=e.getAllBlocks(!1).filter((e=>e.isEnabled())),h=e.getTopBlocks(!1).filter((e=>e.isEnabled())),p=t.getAllBlocks(!1).filter((e=>e.isEnabled()));if(a("blocks",p.map((e=>e.toDevString()))),a(p),0==d.length&&0==p.length)return pxt.tickEvent("blocks.diff",{moves:1}),{ws:void 0,message:lf("Some blocks were moved or changed."),added:0,deleted:0,modified:1};const f=h.filter((e=>!t.getBlockById(e.id))),g=d.filter((e=>!t.getBlockById(e.id))),m=p.filter((t=>!e.getBlockById(t.id))),b=(0,o.initRenderingWorkspace)(),y=(0,r.saveWorkspaceXml)(t,!0);(0,r.domToWorkspaceNoEvents)(i.utils.xml.textToDom(y),b),b.getAllBlocks(!1).filter((e=>!e.isEnabled())).forEach((e=>{a("disabled ",e.toDevString()),e.dispose(!1)}));const v=pxt.Util.toDictionary(b.getAllBlocks(!1),(e=>e.id));a("todo blocks",v),A("start"),n.hideDeletedTopBlocks||(f.forEach((e=>{a(`deleted top ${e.toDevString()}`),C(e);const t=S(e);C(t),t.setEnabled(!1)})),A("deleted top")),m.map((e=>b.getBlockById(e.id))).filter((e=>!!e)).forEach((e=>{a(`added ${e.toDevString()}`),C(e)})),A("added");const _={};if(!n.hideDeletedBlocks){const e=g.filter((e=>!(v[e.id]||k(e)||e.outputConnection&&e.outputConnection.isConnected())));e.forEach((e=>{const t=S(e);_[e.id]=t.id,a(`deleted block ${e.toDevString()}->${t.toDevString()}`)})),e.forEach((e=>function(e){a(`stitching ${e.toDevString()}->${_[e.id]}`);const t=b.getBlockById(_[e.id]);t.setEnabled(!1),w(t),C(t);const n=e.getPreviousBlock();if(n){const r=b.getBlockById(_[n.id])||b.getBlockById(n.id);if(a(`previous ${e.id}->${t.toDevString()}: ${r.toDevString()}`),r)if(r.nextConnection)t.previousConnection.connect(r.nextConnection);else{const e=r.inputList.slice().reverse().find((e=>e.connection&&e.connection.type==i.NEXT_STATEMENT));e&&t.previousConnection.connect(e.connection)}}const r=e.getNextBlock();if(r){const n=b.getBlockById(_[r.id])||b.getBlockById(r.id);n&&(a(`next ${e.id}->${t.toDevString()}: ${n.toDevString()}`),t.nextConnection.connect(n.previousConnection))}}(e)))}let E=0;if(pxt.Util.values(v).filter((t=>function(t){const n=e.getBlockById(t.id);if(!n)return!1;const i=t.getPreviousBlock();if(i&&!v[i.id])return!1;const r=t.getNextBlock();if(r&&!v[r.id])return!1;const o=n.getPreviousBlock();if(!o&&!i)return!1;if(!!o!=!!i||o.id!=i.id)return!0;const s=n.getNextBlock();return!(!s&&!r||!!s==!!r&&s.id==r.id)}(t))).forEach((e=>{a(`moved ${e.toDevString()}`),delete v[e.id],w(e),E++})),A("moved"),pxt.Util.values(v).filter((t=>function(t){let n=e.getBlockById(t.id);if(!n)return!1;const i=c(n),r=c(t);return i!=r&&(a(`old ${n.toDevString()}`,i),a(`new ${t.toDevString()}`,r),!0)}(t))).forEach((e=>{a(`changed ${e.toDevString()}`),delete v[e.id],w(e),E++})),A("changed"),b.getTopBlocks(!1).forEach((e=>{(function(e){return!!e.getDescendants(!1).find((e=>k(e)))})(e)||(a(`unmodified top ${e.toDevString()}`),delete v[e.id],e.dispose(!1))})),A("cleaned"),pxt.Util.values(v).filter((e=>!!b.getBlockById(e.id))).forEach((e=>{!function e(t){t.setColour(s),function(e){e.rendered=!1,e.inputList.forEach((e=>e.fieldRow.forEach((e=>{e.init()}))))}(t),n.statementsOnly&&(t.inputList||[]).map((e=>e.type==i.inputTypes.VALUE&&e.connection&&e.connection.targetBlock())).filter((e=>!!e)).forEach((t=>e(t)))}(e)})),A("unmodified"),!b.getAllBlocks(!1).length)return pxt.tickEvent("blocks.diff",{missed:1}),{ws:b,message:lf("Some blocks were changed."),deleted:g.length,added:m.length,modified:E};b.resize(),i.svgResize(b);const T=(0,o.renderWorkspace)(n.renderOptions||{emPixels:20,layout:4,aspectRatio:.5,useViewWidth:!0}),x={ws:b,svg:T,deleted:g.length,added:m.length,modified:E};return pxt.tickEvent("blocks.diff",{deleted:x.deleted,added:x.added,modified:x.modified}),x;function w(e){e.__pxt_used=!0}function k(e){return!!e.__pxt_used}function S(e){const t=i.Xml.blockToDom(e,!1),n=i.Xml.domToBlock(t,b);return n.nextConnection&&n.nextConnection.targetConnection&&n.nextConnection.disconnect(),n.previousConnection&&n.previousConnection.targetConnection&&n.previousConnection.disconnect(),n}function C(e){e.getDescendants(!1).forEach((e=>{delete v[e.id],w(e)}))}function A(e){a(`${e}:`,pxt.Util.values(v).map((e=>e.toDevString())))}}(e,t,n)}catch(e){return pxt.reportException(e),{ws:void 0,message:lf("Oops, we could not diff those blocks."),error:e,deleted:0,added:0,modified:0}}finally{i.Events.enable()}}function l(){return pxt.options.debug||window&&/diffdbg=1/.test(window.location.href)?console.log:(e,...t)=>{}}function c(e,t){const n=i.Xml.blockToDom(e,!0);return u(n),d(n,(e=>{u(e),t||("next"==e.localName||"statement"==e.localName||"shadow"==e.localName)&&e.remove()})),i.Xml.domToText(n)}function u(e){e.removeAttribute("id"),e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("deletable"),e.removeAttribute("editable"),e.removeAttribute("movable")}function d(e,t){if(e){t(e);for(const n of pxt.Util.toArray(e.children))d(n,t)}}function h(e,t){if(!t)return;let n,i;for(let r=0;r<e.length;++r){let o=e[r];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!n||i>o.endPos-o.startPos)&&(n=o,i=o.endPos-o.startPos)}return n?n.id:void 0}n.mergeXml=function(e,t,n){return e==t?n:n==t?e:void 0},n.decompiledDiffAsync=function(e,t,n,i,o={}){const s=l(),c=t.outfiles[pxt.MAIN_BLOCKS];let u=i.outfiles[pxt.MAIN_BLOCKS];s(c),s(u);const d=pxt.diff.compute(e,n,{ignoreWhitespace:!0,full:!0});s(d);const p={};let f=0,g=0;d.forEach(((e,n)=>{const r=e[0],o=e.substr(2);let a=o.length;switch(r){case"-":f+=a+1;break;case"+":g+=a+1;break;default:const n=/^\s+/.exec(o);if(n){const e=n[0].length;f+=e,g+=e,a-=e}const r=h(i.blockSourceMap,{start:g,length:a});if(r&&!p[r]){const n=h(t.blockSourceMap,{start:f,length:a});n&&(s(e),s(`id ${f}:${o.length}>${n} ==> ${g}:${o.length}>${r}`),p[r]=n,u=u.replace(r,n))}f+=a+1,g+=a+1}}));const m=(0,r.loadWorkspaceXml)(c,!0),b=(0,r.loadWorkspaceXml)(u,!0);return o.statementsOnly=!0,a(m,b,o)}},{"./importer":67,"./render":118,blockly:376}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.prompt=n.setPrompt=n.setOnWorkspaceContextMenu=n.onWorkspaceContextMenu=n.setOpenHelpUrl=n.openHelpUrl=n.setExtensionBlocklyPatch=n.extensionBlocklyPatch=n.setPromptTranslateBlock=n.promptTranslateBlock=void 0;const i=e("blockly");let r,o,s,a,l;n.promptTranslateBlock=function(e,t){r&&r(e,t)},n.setPromptTranslateBlock=function(e){r=e},n.extensionBlocklyPatch=function(e,t){o&&o(e,t)},n.setExtensionBlocklyPatch=function(e){o=e},n.openHelpUrl=function(e){s?s(e):window.open(e)},n.setOpenHelpUrl=function(e){s=e},n.onWorkspaceContextMenu=function(e,t){a&&a(e,t)},n.setOnWorkspaceContextMenu=function(e){a=e},n.setPrompt=function(e,t){t&&i.dialog.setPrompt(e),l=e},n.prompt=function(e,t,n,r){l?l(e,t,n,r):i.dialog.prompt(e,t,n)}},{blockly:376}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createFieldEditor=n.registerFieldEditor=n.initFieldEditors=void 0;const i=e("./field_animation"),r=e("./field_tilemap"),o=e("./field_textinput"),s=e("./field_sprite"),a=e("./field_gridpicker"),l=e("./field_colour"),c=e("./field_images"),u=e("./field_textdropdown"),d=e("./field_numberdropdown"),h=e("./field_imagedropdown"),p=e("./field_note"),f=e("./field_melodySandbox"),g=e("./field_toggle"),m=e("./field_toggle_downup"),b=e("./field_toggle_highlow"),y=e("./field_toggle_onoff"),v=e("./field_toggle_updown"),_=e("./field_toggle_winlose"),E=e("./field_toggle_yesno"),T=e("./field_protractor"),x=e("./field_position"),w=e("./field_speed"),k=e("./field_tileset"),S=e("./field_turnratio"),C=e("./field_musiceditor"),A=e("./field_sound_effect"),I=e("./field_autocomplete"),O=e("./field_colorwheel");let N={};function R(e,t,n){null==N[e]&&(N[e]={field:t,validator:n})}n.initFieldEditors=function(){var e;R("text",o.FieldTextInput),R("note",p.FieldNote),R("gridpicker",a.FieldGridPicker),R("textdropdown",u.FieldTextDropdown),R("numberdropdown",d.FieldNumberDropdown),R("imagedropdown",h.FieldImageDropdown),R("colorwheel",O.FieldColorWheel),R("toggle",g.FieldToggle),R("toggleonoff",y.FieldToggleOnOff),R("toggleyesno",E.FieldToggleYesNo),R("toggleupdown",v.FieldToggleUpDown),R("toggledownup",m.FieldToggleDownUp),R("togglehighlow",b.FieldToggleHighLow),R("togglewinlose",_.FieldToggleWinLose),R("colornumber",l.FieldColorNumber),R("images",c.FieldImages),R("sprite",s.FieldSpriteEditor),R("animation",i.FieldAnimationEditor),R("tilemap",r.FieldTilemap),R("tileset",k.FieldTileset),R("speed",w.FieldSpeed),R("turnratio",S.FieldTurnRatio),R("protractor",T.FieldProtractor),R("position",x.FieldPosition),R("melody",f.FieldCustomMelody),R("soundeffect",A.FieldSoundEffect),R("autocomplete",I.FieldAutoComplete),(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.songEditor)&&R("musiceditor",C.FieldMusicEditor)},n.registerFieldEditor=R,n.createFieldEditor=function(e,t,n){if(null==N[e])return console.error(`Field editor ${e} not registered`),null;n||(n={}),pxt.Util.assert(null==n.lightMode,"lightMode is a reserved parameter for custom fields"),n.lightMode=pxt.options.light;let i=N[e];return new i.field(t,n,i.validator)}},{"./field_animation":26,"./field_autocomplete":29,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_downup":55,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_turnratio":62}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldAnimationEditor=void 0;var i=pxt.svgUtil;const r=e("./field_asset"),o=e("./field_utils"),s=32;class a extends r.FieldAssetEditor{constructor(){super(...arguments),this.onMouseEnter=()=>{if(this.animateRef||!this.asset)return;const e=this.getParentInterval()||this.asset.interval,t=e>50?e:50;let n=0;this.animateRef=setInterval((()=>{this.preview&&this.frames[n]&&this.preview.src(this.frames[n]),n=(n+1)%this.frames.length}),t)},this.onMouseLeave=()=>{this.animateRef&&clearInterval(this.animateRef),this.animateRef=void 0,this.preview&&this.frames[0]&&this.preview.src(this.frames[0])}}initView(){this.sourceBlock_.getSvgRoot().addEventListener("mouseenter",this.onMouseEnter),this.sourceBlock_.getSvgRoot().addEventListener("mouseleave",this.onMouseLeave)}showEditor_(){this.asset&&(this.asset.interval=this.getParentInterval()||this.asset.interval),super.showEditor_()}render_(){super.render_(),this.size_.height=42,this.size_.width=80}getAssetType(){return"animation"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const n=pxt.lookupProjectAssetByTSReference(e,t);if(n)return n;const i=function(e,t){return-1===e.indexOf("[")?null:(e=e.replace(/[\[\]]/gm,"")).split(",").map((e=>pxt.sprite.imageLiteralToBitmap(e,t).data())).filter((e=>e.height&&e.width))}(e,this.params.taggedTemplate);if(i&&i.length)return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:i,interval:this.getParentInterval(),meta:{}};const r=t.lookupAssetByName("animation",e.trim());if(r)return r}return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:[new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight).data()],interval:500,meta:{}}}onEditorClose(e){this.setParentInterval(e.interval)}getValueText(){return this.asset?this.isTemporaryAsset()?"["+this.asset.frames.map((e=>pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e),"typescript",this.params.taggedTemplate))).join(",")+"]":pxt.getTSReferenceForAsset(this.asset):this.valueText||"[]"}redrawPreview(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);const e=(new i.Rect).at(35,1).size(40,40).corner(4).setClass("blocklyAnimationField");this.fieldGroup_.appendChild(e.el);const t=new i.Text("").at(5,26).setClass("semanticIcon");this.fieldGroup_.appendChild(t.el),this.asset&&(this.frames=this.asset.frames.map((e=>(0,o.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e),s,this.lightMode))),this.preview=(new i.Image).src(this.frames[0]).at(39,5).size(s,s),this.fieldGroup_.appendChild(this.preview.el))}getParentIntervalBlock(){const e=this.sourceBlock_;if(e.getParent()){const t=e.getParent();for(const e of t.inputList)if("frameInterval"===e.name)return e.connection.targetBlock()}}setParentInterval(e){const t=this.getParentIntervalBlock();if(t){const n=l(t);n&&t.setFieldValue(String(e),n)}}getParentInterval(){const e=this.getParentIntervalBlock();if(e){const t=l(e);if(t)return Number(e.getFieldValue(t))}return 100}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),t.initWidth=n(e.initWidth,t.initWidth),t.initHeight=n(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t):t;function n(e,t){const n=parseInt(e);return isNaN(n)?t:n}}(e)}}function l(e){return"math_number_minmax"===e.type?"SLIDER":function(e){return"math_number"===e||"math_integer"===e||"math_whole_number"===e}(e.type)?"NUM":"timePicker"===e.type?"ms":null}n.FieldAnimationEditor=a},{"./field_asset":28,"./field_utils":64}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldArgumentVariable=void 0;const i=e("blockly");class r extends i.FieldVariable{constructor(e){super(e),this.menuGenerator_=this.generateMenu}generateMenu(){return i.FieldVariable.dropdownCreate.call(this).filter((e=>e[1]!=i.DELETE_VARIABLE_ID))}}n.FieldArgumentVariable=r},{blockly:376}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BlocklyTilemapChange=n.FieldAssetEditor=void 0;const i=e("blockly");var r=pxt.svgUtil;const o=e("./field_base"),s=e("./field_utils"),a=32;class l extends o.FieldBase{constructor(e,t,n){super(e,t,n),this.pendingEdit=!1,this.isEmpty=!1,this.assetChangeListener=()=>{if(this.pendingEdit)return;const e=this.getBlockData();e&&(this.asset=pxt.react.getTilemapProject().lookupAsset(this.getAssetType(),e)),this.redrawPreview()},this.lightMode=t.lightMode,this.params=this.parseFieldOptions(t),this.blocksInfo=t.blocksInfo}onInit(){this.redrawPreview()}onValueChanged(e){return this.parseValueText(e),this.redrawPreview(),this.getValueText()}showEditor_(){if(this.isGreyBlock)return;const e=Object.assign({},this.params);let t;switch(e.blocksInfo=this.blocksInfo,this.asset.type){case"tile":case"image":t="image-editor",e.temporaryAssets=(0,s.getTemporaryAssets)(this.sourceBlock_.workspace,"image");break;case"animation":t="animation-editor",e.temporaryAssets=(0,s.getTemporaryAssets)(this.sourceBlock_.workspace,"image").concat((0,s.getTemporaryAssets)(this.sourceBlock_.workspace,"animation"));break;case"tilemap":t="tilemap-editor";const n=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(n,this.asset);for(const e of(0,s.getTilesReferencedByTilesets)(this.sourceBlock_.workspace))-1===this.asset.data.projectReferences.indexOf(e.id)&&this.asset.data.projectReferences.push(e.id);break;case"song":t="music-editor",e.temporaryAssets=(0,s.getTemporaryAssets)(this.sourceBlock_.workspace,"song"),(0,s.setMelodyEditorOpen)(this.sourceBlock_,!0)}this.isFullscreen()?this.showEditorFullscreen(t,e):this.showEditorInWidgetDiv(t,e)}showEditorFullscreen(e,t){const n=pxt.react.getFieldEditorView(e,this.asset,t);this.undoRedoState&&n.restorePersistentData(this.undoRedoState),pxt.react.getTilemapProject().pushUndo(),n.onHide((()=>{this.onFieldEditorHide(n)})),n.show()}showEditorInWidgetDiv(e,t){let n,r={getScaledBBox:()=>n};i.WidgetDiv.show(r,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),o.classList.remove("sound-effect-editor-widget"),o.style.transform="",o.style.position="",o.style.left="",o.style.top="",o.style.width="",o.style.height="",o.style.opacity="",o.style.transition="",o.style.alignItems="",this.onFieldEditorHide(a)}));const o=i.WidgetDiv.getDiv(),a=pxt.react.getFieldEditorView(e,this.asset,t,o),l=this.sourceBlock_,c=l.getBoundingRectangle(),u=(0,s.workspaceToScreenCoordinates)(l.workspace,new i.utils.Coordinate(c.right,c.top)),d=u.x-400,h=u.y+60-20;o.style.opacity="0",o.classList.add("sound-effect-editor-widget"),o.style.position="absolute",o.style.left=d+"px",o.style.top=h+"px",o.style.width="50rem",o.style.height="34.25rem",o.style.display="flex",o.style.alignItems="center",o.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",o.style.borderRadius="",a.onHide((()=>{i.WidgetDiv.hideIfOwner(r)})),a.show();const p=o.getBoundingClientRect(),f=l.workspace.getInjectionDiv().getBoundingClientRect();p.height>f.height?(o.style.height="",o.style.top="calc(1rem - 20px)",o.style.bottom="calc(1rem + 20px)"):(p.bottom>f.bottom||p.top<f.top)&&(o.style.top=f.top+f.height/2-p.height/2-20+"px");const g=l.workspace.getToolbox().getWidth(),m=f.left+g;if(p.width>f.width-g)o.style.width="",o.style.left="1rem",o.style.right="1rem";else if(p.left+p.width>=f.right){const e=(0,s.workspaceToScreenCoordinates)(l.workspace,new i.utils.Coordinate(c.left,c.top));e.x-p.width-20>m?o.style.left=e.x-p.width-20+"px":o.style.left=m+(f.width-g)/2-p.width/2+"px"}else p.left<f.left&&(o.style.left=m+"px");const b=o.getBoundingClientRect();n=new i.utils.Rect(b.top,b.bottom,b.left,b.right),requestAnimationFrame((()=>{o.style.opacity="1",o.style.transform="translateY(20px)"}))}onFieldEditorHide(e){var t;const n=e.getResult(),r=pxt.react.getTilemapProject();if("song"===this.asset.type&&(0,s.setMelodyEditorOpen)(this.sourceBlock_,!1),n){const o=this.getValue();if(pxt.assetEquals(this.asset,n))return;const s=c(this.asset)?null:this.asset.id;let a=c(n)?null:n.id;s||a!==this.sourceBlock_.id||(n.id=r.generateNewID(n.type),a=n.id),this.pendingEdit=!0,(null===(t=n.meta)||void 0===t?void 0:t.displayName)&&this.disposeOfTemporaryAsset(),this.asset=n;const l=r.revision();if(this.onEditorClose(this.asset),this.updateAssetListener(),this.updateAssetMeta(),this.redrawPreview(),this.undoRedoState=e.getPersistentData(),this.sourceBlock_&&i.Events.isEnabled()){const e=new u(this.sourceBlock_,"field",this.name,o,this.getValue(),l,r.revision());s!==a&&(e.oldAssetId=s,e.newAssetId=a),i.Events.fire(e)}this.pendingEdit=!1}}render_(){this.isGreyBlock&&!this.textElement_&&this.createTextElement_(),super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=50)}getDisplayText_(){if(this.isGreyBlock){const e=pxt.Util.htmlUnescape(this.valueText);return e.substr(0,e.indexOf("("))+"(...)"}return""}updateEditable(){if(this.isGreyBlock&&this.fieldGroup_){const e=this.fieldGroup_;i.utils.dom.removeClass(e,"blocklyNonEditableText"),i.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""}else super.updateEditable()}getValue(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.getValueText()}onDispose(){var e;(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&!this.sourceBlock_.workspace.rendered&&this.disposeOfTemporaryAsset(),pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener)}disposeOfTemporaryAsset(){this.isTemporaryAsset()&&(pxt.react.getTilemapProject().removeAsset(this.asset),this.setBlockData(null),this.asset=void 0)}clearTemporaryAssetData(){this.isTemporaryAsset()&&this.setBlockData(null)}isTemporaryAsset(){return c(this.asset)}getAsset(){return this.asset}updateAsset(e){this.asset=e,this.setValue(this.getValue())}onEditorClose(e){}redrawPreview(){if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return this.createTextElement_(),this.render_(),void this.updateEditable();const e=(new r.Rect).at(5,1).size(40,40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(e.el),this.asset){let e;switch(this.asset.type){case"image":case"tile":e=(0,s.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.bitmap),a,this.lightMode);break;case"animation":e=(0,s.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.frames[0]),a,this.lightMode);break;case"tilemap":e=(0,s.tilemapToImageURI)(this.asset.data,a,this.lightMode);break;case"song":e=(0,s.songToDataURI)(this.asset.song,60,20,this.lightMode)}if(e){const t=(new r.Image).src(e).at(9,5).size(a,a);this.fieldGroup_.appendChild(t.el)}}}parseValueText(e){if(e=pxt.Util.htmlUnescape(e),this.sourceBlock_){const t=pxt.react.getTilemapProject(),n=this.getBlockData(),i=t.lookupAsset(this.getAssetType(),n);!i||e&&this.isEmpty?(this.setBlockData(null),this.asset&&this.sourceBlock_&&this.asset.meta.blockIDs&&(this.asset.meta.blockIDs=this.asset.meta.blockIDs.filter((e=>e!==this.sourceBlock_.id)),this.isTemporaryAsset()||t.updateAsset(this.asset)),this.isEmpty=!e,this.asset=this.createNewAsset(e)):this.asset=i,this.updateAssetMeta(),this.updateAssetListener()}}parseFieldOptions(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initWidth=n(e.initWidth,t.initWidth),t.initHeight=n(e.initHeight,t.initHeight),t.lightMode=e.lightMode,t):t;function n(e,t){const n=parseInt(e);return isNaN(n)?t:n}}updateAssetMeta(){if(this.asset){if(this.asset.meta||(this.asset.meta={}),this.asset.meta.blockIDs||(this.asset.meta.blockIDs=[]),this.sourceBlock_){if(-1===this.asset.meta.blockIDs.indexOf(this.sourceBlock_.id)){const e=this.asset.meta.blockIDs;e.length&&this.isTemporaryAsset()&&e.some((e=>this.sourceBlock_.workspace.getBlockById(e)))&&(this.asset=pxt.cloneAsset(this.asset),this.asset.meta.blockIDs=[]),this.asset.meta.blockIDs.push(this.sourceBlock_.id)}this.setBlockData(this.isTemporaryAsset()?null:this.asset.id)}this.isTemporaryAsset()?this.asset.meta.temporaryInfo={blockId:this.sourceBlock_.id,fieldName:this.name}:pxt.react.getTilemapProject().updateAsset(this.asset)}}updateAssetListener(){pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener),this.asset&&!this.isTemporaryAsset()&&pxt.react.getTilemapProject().addChangeListener(this.asset,this.assetChangeListener)}isFullscreen(){return!0}}function c(e){return e&&!e.meta.displayName}n.FieldAssetEditor=l;class u extends i.Events.BlockChange{constructor(e,t,n,i,r,o,s){super(e,t,n,i,r),this.oldRevision=o,this.newRevision=s,this.fieldName=n}isNull(){return this.oldRevision===this.newRevision&&super.isNull()}run(e){if(this.newAssetId||this.oldAssetId){const t=this.getEventWorkspace_().getBlockById(this.blockId);e?(0,s.setBlockDataForField)(t,this.fieldName,this.newAssetId):(0,s.setBlockDataForField)(t,this.fieldName,this.oldAssetId)}e?(pxt.react.getTilemapProject().redo(),super.run(e)):(pxt.react.getTilemapProject().undo(),super.run(e));const t=this.getEventWorkspace_(),n=new u(t.getBlockById(this.blockId),"tilemap-revision","revision",null,pxt.react.getTilemapProject().revision(),0,0);n.recordUndo=!1,i.Events.fire(n)}}n.BlocklyTilemapChange=u},{"./field_base":30,"./field_utils":64,blockly:376}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldAutoComplete=void 0;const i=e("blockly"),r=e("./field_utils"),o=e("./field_textdropdown"),s=e("../plugins/text");class a extends o.FieldTextDropdown{constructor(e,t,n){super(e,t,n),this.isFieldCustom_=!0,this.key=t.key,this.isTextValid_=!0}isOptionListDynamic(){return!0}getDisplayText_(){return this.parsedValue||""}doValueUpdate_(e){this.isDirty_=!0,null!==e&&(/['"`].*['"`]/.test(e)?this.parsedValue=JSON.parse(e):this.parsedValue=e,this.value_=this.parsedValue)}getValue(){return this.parsedValue?this.parsedValue:""}getOptions(){var e;const t=null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace;if(!t)return[];const n=[],i=(0,r.getAllFields)(t,(e=>e instanceof a&&e.getKey()===this.key)).map((e=>e.ref.getDisplayText_()));for(const e of i)e.trim()&&!n.some((t=>t[0]===e))&&n.push([e,e]);return n.sort(((e,t)=>e[0].localeCompare(t[0]))),n}showDropdown_(){this.getOptions().length&&super.showDropdown_()}getKey(){return this.key?this.key:this.sourceBlock_?this.sourceBlock_.type:void 0}initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=i.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=i.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(){super.updateSize_();const e=Math.max(this.size_.width,1);let t=this.positionLeft(e+3);this.textElement_.setAttribute("x",t.toString()),t+=this.positionRight(t+e+3),this.size_.width=e+t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=s.FieldString.quotePadding,t=this.quoteWidth_+s.FieldString.quotePadding):(this.quoteRightX_=e+s.FieldString.quotePadding,t=this.quoteWidth_+s.FieldString.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*s.FieldString.quotePadding,t=this.quoteWidth_+s.FieldString.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+s.FieldString.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}createSVGArrow(){}}n.FieldAutoComplete=a},{"../plugins/text":115,"./field_textdropdown":50,"./field_utils":64,blockly:376}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldBase=void 0;const i=e("blockly"),r=e("./field_utils");class o extends i.Field{constructor(e,t,n){super(e,n),this.SERIALIZABLE=!0,this.options=t,e&&!this.valueText&&(this.valueText=e)}static enqueueInit(e){o.pendingInit.push(e),this.pendingTimeout||(o.pendingTimeout=setTimeout((()=>o.flushInitQueue())))}static flushInitQueue(){for(const e of o.pendingInit)e.onLoadedIntoWorkspace();o.pendingTimeout=void 0,o.pendingInit=[]}init(){super.init(),this.onInit(),o.enqueueInit(this)}dispose(){this.onDispose()}getValue(){return this.valueText}doValueUpdate_(e){null!==e&&(this.valueText=this.loaded?this.onValueChanged(e):e)}getDisplayText_(){return this.valueText}onLoadedIntoWorkspace(){this.loaded||(this.loaded=!0,this.valueText=this.onValueChanged(this.valueText))}getAnchorDimensions(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=i.FieldDropdown.CHECKMARK_OVERHANG:e.left-=i.FieldDropdown.CHECKMARK_OVERHANG,e}isInitialized(){return!!this.fieldGroup_}getBlockData(){return(0,r.getBlockDataForField)(this.sourceBlock_,this.name)}setBlockData(e){(0,r.setBlockDataForField)(this.sourceBlock_,this.name,e)}getSiblingBlock(e,t=!1){const n=t?this.sourceBlock_.getParent():this.sourceBlock_;if(n&&n.inputList)for(const t of n.inputList)if(t.name===e)return t.connection.targetBlock()}getSiblingField(e,t=!1){const n=t?this.sourceBlock_.getParent():this.sourceBlock_;if(n)return n.getField(e)}}n.FieldBase=o,o.pendingInit=[]},{"./field_utils":64,blockly:376}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldColorWheel=void 0;const i=e("../plugins/math");class r extends i.FieldSlider{constructor(e,t,n){super(String(e),"0","255","1","10","Color",n),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.channel&&(this.channel_=this.params.channel)}setBackground_(e){let t=this.createColourStops_().join(",");e.style.background=`linear-gradient(left, ${t})`,this.params.sliderWidth&&(e.style.width=`${this.params.sliderWidth}px`)}setReadout_(e,t){const n=this.colorWheel(parseInt(t),this.channel_),i=document.createElement("span");i.className="blocklyColorReadout",i.style.backgroundColor=`${n}`,pxsim.U.clear(e),e.appendChild(i)}createColourStops_(){let e=[];for(let t=0;t<=255;t+=20)e.push(this.colorWheel(t,this.channel_));return e}colorWheel(e,t){return"hsvfast"==t?this.hsvFast(e,255,255):(e=255-e)<85?this.hex(3*e,255,255-3*e):e<170?(e-=85,this.hex(255,255-3*e,3*e)):(e-=170,this.hex(255-3*e,3*e,255))}hsvFast(e,t,n){let i=e%255>>0;i<0&&(i+=255);let r,o,s,a=n*(255-t)/255>>0,l=n-a,c=(i=192*i/255>>0)/64>>0,u=i%64>>0,d=(u*l/63.75>>0)+a,h=((63-u)*l/63.75>>0)+a;return c?1==c?(r=a,o=h,s=d):(r=d,o=a,s=h):(r=h,o=d,s=a),this.hex(r,o,s)}hex(e,t,n){return`#${this.componentToHex(255&e)}${this.componentToHex(255&t)}${this.componentToHex(255&n)}`}componentToHex(e){let t=e.toString(16);return 1==t.length?"0"+t:t}}n.FieldColorWheel=r},{"../plugins/math":101}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldColorNumber=void 0;const i=e("blockly");class r extends i.FieldColour{constructor(e,t,n){if(super(e,n),this.isFieldCustom_=!0,this.valueMode_="rgb",t.colours)this.setColours(JSON.parse(t.colours));else if(pxt.appTarget.runtime&&pxt.appTarget.runtime.palette){let e,t=pxt.Util.clone(pxt.appTarget.runtime.palette);t[0]="#dedede",pxt.appTarget.runtime.paletteNames&&((e=pxt.Util.clone(pxt.appTarget.runtime.paletteNames))[0]=lf("transparent")),this.setColours(t,e)}this.setValue(this.getColours_()[0]),t.columns&&this.setColumns(parseInt(t.columns)),t.valueMode&&(this.valueMode_=t.valueMode)}setColours(e,t){const n=super.setColours(e,t);return this.colours_=e,n}doClassValidation_(e){return"string"!=typeof e?null:o(e,this.getColours_())}getValue(e){if(e)return this.value_;switch(this.valueMode_){case"hex":return`"${this.value_}"`;case"rgb":return this.value_.indexOf("#")>-1?`0x${this.value_.replace(/^#/,"")}`:this.value_;case"index":if(!this.value_)return"-1";const e=this.getColours_();for(let t=0;t<e.length;t++)if(this.value_.toUpperCase()===e[t].toUpperCase())return t+""}return this.value_}doValueUpdate_(e){super.doValueUpdate_(o(e,this.getColours_()))}getColours_(){return this.colours_}applyColour(){const e=this.getSourceBlock();if(!e)throw new i.UnattachedFieldError;if(!this.fieldGroup_)return;const t=this.borderRect_;if(!t)throw new Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",o(this.getValue(),this.getColours_())),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}}function o(e,t){if(e){const n=/Colors\.([a-zA-Z]+)/.exec(e),i=/(0x|#)([0-9a-fA-F]+)/.exec(e);if(n)switch(n[1].toLocaleLowerCase()){case"red":return"#FF0000";case"orange":return"#FF7F00";case"yellow":return"#FFFF00";case"green":return"#00FF00";case"blue":return"#0000FF";case"indigo":return"#4B0082";case"violet":return"#8A2BE2";case"purple":return"#A033E5";case"pink":return"#FF007F";case"white":return"#FFFFFF";case"black":return"#000000";default:return e}else if(i){const e=i[2];if(3===e.length){let t="#";for(let n=0;n<e.length;n++){const i=e.charAt(n);t+=i+i}return t}if(6===e.length)return"#"+e}if(t){const n=parseInt(e);return isNaN(n)||null==t[n]?t[0]:t[n]}}return e}n.FieldColorNumber=r,i.Css.register("\n/* eslint-disable indent */\ntable.blocklyColourTable {\n    outline: none;\n    border-radius: 11px;\n}\n\ntable.blocklyColourTable > tr > td {\n    height: 22px;\n    width: 22px;\n    margin: 2px;\n    text-align: center;\n    cursor: pointer;\n    border-radius: 4px;\n    border: 2px solid rgba(0,0,0,.1);\n}\n\ntable.blocklyColourTable > tr > td:hover {\n    border: 1px solid #FFF;\n    box-sizing: border-box;\n}\n\ntable.blocklyColourTable > tr > td.blocklyColourSelected {\n    border: 1px solid #000;\n    box-sizing: border-box;\n    color: #fff;\n}\n\ntable.blocklyColourTable>tr>td.blocklyColourHighlighted {\n    border-color: #eee;\n    box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);\n    position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n    border-color: #eee !important;\n    outline: 1px solid #333;\n    position: relative;\n}\n/* eslint-enable indent */\n")},{blockly:376}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldDropdown=void 0;const i=e("blockly"),r=e("../plugins/newVariableField/fieldDropdownMixin");class o extends i.FieldDropdown{shouldAddBorderRect_(){return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}showEditor_(e){r.showEditorMixin.call(this,e)}}n.FieldDropdown=o},{"../plugins/newVariableField/fieldDropdownMixin":103,blockly:376}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldGridPicker=void 0;const i=e("blockly"),r=e("./field_utils");class o extends i.FieldDropdown{constructor(e,t,n){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");null!==t&&(this.setValue(t),this.closeModal_&&(this.close(),this.closeModal_=!1))},this.buttonClickAndClose_=e=>{this.closeModal_=!0,this.buttonClick_(e)},this.columns_=parseInt(t.columns)||4,this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||200,this.backgroundColour_=(0,r.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1);let i={xOffset:parseInt(t.tooltipsXOffset)||15,yOffset:parseInt(t.tooltipsYOffset)||-10};this.tooltipConfig_=i,this.hasSearchBar_=!!t.hasSearchBar||!1,this.hideRect_=!!t.hideRect||!1}dispose(){super.dispose(),this.disposeTooltip(),this.disposeIntersectionObserver()}createTooltip_(){this.gridTooltip_||(this.gridTooltip_=document.createElement("div"),this.gridTooltip_.className="goog-tooltip blocklyGridPickerTooltip",this.gridTooltip_.style.position="absolute",this.gridTooltip_.style.display="none",this.gridTooltip_.style.visibility="hidden",document.body.appendChild(this.gridTooltip_))}populateTableContainer(e,t,n){pxsim.U.removeChildren(t),0==e.length&&(this.firstItem_=void 0);for(let n=0;n<e.length/this.columns_;n++){let i=this.populateRow(n,e,t);t.appendChild(i)}}populateRow(e,t,n){const r=this.columns_,s=document.createElement("div");s.className="blocklyGridPickerRow";for(let a=r*e;a<Math.min(r*e+r,t.length);a++){let e=t[a][0];const r=t[a][1],l=document.createElement("div");l.className="goog-menuitem goog-option",l.setAttribute("id",":"+a),l.setAttribute("role","menuitem"),l.style.userSelect="none",l.title=e.alt||e,l.setAttribute("data-value",r);const c=document.createElement("div");c.setAttribute("class","goog-menuitem-content"),c.title=e.alt||e,c.setAttribute("data-value",r);const u="object"==typeof e;let d=this.backgroundColour_;if(r==this.getValue()&&(l.setAttribute("aria-selected","true"),pxt.BrowserUtils.addClass(l,"goog-option-selected"),d=this.sourceBlock_.getColourTertiary(),this.selectedItemDom=l,u&&!this.shouldShowTooltips()&&this.updateSelectedBar_(e,r)),l.style.backgroundColor=d,l.style.borderColor=this.borderColour_,u){const t=new Image(e.width,e.height);t.setAttribute("draggable","false"),"IntersectionObserver"in window?(t.src=o.DEFAULT_IMG,t.setAttribute("data-src",e.src),this.observer.observe(t)):t.src=e.src,t.alt=e.alt||"",t.setAttribute("data-value",r),c.appendChild(t)}else c.textContent=e;if(this.shouldShowTooltips()){i.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_);const e=this.sourceBlock_.RTL?-this.tooltipConfig_.xOffset:this.tooltipConfig_.xOffset,t=this.tooltipConfig_.yOffset;i.browserEvents.conditionalBind(l,"mousemove",this,(i=>{if(u){this.gridTooltip_.style.top=`${i.clientY+t}px`,this.gridTooltip_.style.left=`${i.clientX+e}px`;const n=document.elementFromPoint(i.clientX,i.clientY),r=n.title||n.alt;this.gridTooltip_.textContent=r,this.gridTooltip_.style.visibility=r?"visible":"hidden",this.gridTooltip_.style.display=r?"":"none"}pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),n.setAttribute("aria-activedescendant",l.id)})),i.browserEvents.conditionalBind(l,"mouseout",this,(e=>{u&&(this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"),pxt.BrowserUtils.removeClass(l,"goog-menuitem-highlight"),n.removeAttribute("aria-activedescendant")}))}else u?(this.selectedBar_.style.display="",i.browserEvents.conditionalBind(l,"click",this,(t=>{if(this.closeModal_)this.buttonClick_(t);else{const t=n.getElementsByClassName("goog-menuitem-highlight");for(let e=0;e<t.length;e++)pxt.BrowserUtils.removeClass(t[e],"goog-menuitem-highlight");pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),this.updateSelectedBar_(e,r)}}))):(i.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_),i.browserEvents.conditionalBind(l,"mouseup",this,this.buttonClickAndClose_));l.appendChild(c),s.appendChild(l),0==a&&(this.firstItem_=l)}return s}shouldShowRect_(){return!this.hideRect_&&!this.sourceBlock_.isShadow()}doClassValidation_(e){return e}close(){this.disposeTooltip(),i.WidgetDiv.hideIfOwner(this),i.Events.setGroup(!1)}getFirstItem(){return this.firstItem_}highlightFirstItem(e){let t=e.childNodes;if(t.length&&t[0].childNodes){for(let e=0;e<t.length;++e){let n=t[e].childNodes.length;for(let i=0;i<n;++i){const n=t[e].childNodes[i];pxt.BrowserUtils.removeClass(n,"goog-menuitem-highlight"),pxt.BrowserUtils.removeClass(n,"goog-option-selected")}}t[0].childNodes[0].className+=" goog-menuitem-highlight"}}highlightAndScrollSelected(e,t){this.selectedItemDom&&i.utils.style.scrollIntoContainerView(this.selectedItemDom,t,!0)}showEditor_(){i.WidgetDiv.show(this,this.sourceBlock_.RTL,(()=>{this.onClose_()})),this.setupIntersectionObserver_(),this.createTooltip_();const e=document.createElement("div");this.positionMenu_(e)}positionMenu_(e){const t=i.utils.svgMath.getViewportBBox(),n=this.getAnchorDimensions_(),{paddingContainer:r,scrollContainer:o}=this.createWidget_(e),s={width:r.offsetWidth,height:r.offsetHeight},a=window.outerWidth,l=window.outerHeight;this.width_>a&&(this.width_=a),e.style.width=this.width_+"px";let c=0;if(this.hasSearchBar_&&(c+=50),this.selectedBar_&&(c+=50),this.maxRows_){let t=e.children[0].offsetHeight*(this.maxRows_+.3);l<t+c&&(t=l-c),s.height>t&&(o.style.overflowY="auto",o.style.height=t+"px",s.height=t)}s.height+=c,i.WidgetDiv.positionWithAnchor(t,n,s,this.sourceBlock_.RTL),this.highlightAndScrollSelected(e,o)}shouldShowTooltips(){return!pxt.BrowserUtils.isMobile()}getAnchorDimensions_(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=i.FieldDropdown.CHECKMARK_OVERHANG:e.left-=i.FieldDropdown.CHECKMARK_OVERHANG,e}createWidget_(e){const t=i.WidgetDiv.getDiv(),n=this.getOptions();e.setAttribute("role","menu"),e.setAttribute("aria-haspopup","true");const r=document.createElement("div"),o=document.createElement("div");if(o.style.border=`solid 1px ${this.borderColour_}`,e.style.backgroundColor=this.backgroundColour_,r.style.backgroundColor=this.backgroundColour_,o.style.backgroundColor=this.backgroundColour_,e.className="blocklyGridPickerMenu",r.className="blocklyGridPickerScroller",o.className="blocklyGridPickerPadder",o.appendChild(r),r.appendChild(e),t.appendChild(o),this.hasSearchBar_){const t=this.createSearchBar_(e,r,n);o.insertBefore(t,o.childNodes[0])}return this.shouldShowTooltips()||(this.selectedBar_=this.createSelectedBar_(),o.appendChild(this.selectedBar_)),this.populateTableContainer(n,e,r),{paddingContainer:o,scrollContainer:r}}createSearchBar_(e,t,n){const i=document.createElement("div");i.setAttribute("class","ui fluid icon input");const r=document.createElement("i");r.setAttribute("class","search icon");const o=document.createElement("input");return o.setAttribute("type","search"),o.setAttribute("id","search-bar"),o.setAttribute("class","blocklyGridPickerSearchBar"),o.setAttribute("placeholder",pxt.Util.lf("Search")),o.addEventListener("click",(()=>{o.focus(),o.setSelectionRange(0,o.value.length)})),o.addEventListener("keyup",pxt.Util.debounce((()=>{let i=o.value,r=new RegExp(i,"i"),s=n.filter((e=>{const t=e[0].alt,n=e[1];return t?r.test(t):r.test(n)}));this.populateTableContainer.bind(this)(s,e,t),i?this.highlightFirstItem(e):this.highlightAndScrollSelected(e,t),this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"}),300,!1)),o.addEventListener("keyup",(t=>{if(13==t.which){const t=e.childNodes[0];if(t){const e=t.childNodes[0];e&&(this.closeModal_=!0,e.click())}}})),i.appendChild(o),i.appendChild(r),i}createSelectedBar_(){const e=document.createElement("div");e.setAttribute("class","blocklyGridPickerSelectedBar"),e.style.display="none";const t=document.createElement("div"),n=document.createElement("div");n.className="blocklyGridPickerSelectedImage",t.appendChild(n),this.selectedImg_=document.createElement("img"),this.selectedImg_.setAttribute("width","30px"),this.selectedImg_.setAttribute("height","30px"),this.selectedImg_.setAttribute("draggable","false"),this.selectedImg_.style.display="none",this.selectedImg_.src=o.DEFAULT_IMG,n.appendChild(this.selectedImg_),this.selectedBarText_=document.createElement("span"),this.selectedBarText_.className="blocklyGridPickerTooltip",t.appendChild(this.selectedBarText_);const r=document.createElement("div"),s=document.createElement("div");s.className="ui buttons mini",r.appendChild(s);const a=document.createElement("button");a.className="ui button icon green";const l=document.createElement("i");l.className="icon check",a.appendChild(l),i.browserEvents.conditionalBind(a,"click",this,(()=>{this.setValue(this.selectedBarValue_),this.close()}));const c=document.createElement("button");c.className="ui button icon red";const u=document.createElement("i");return u.className="icon cancel",c.appendChild(u),i.browserEvents.conditionalBind(c,"click",this,(()=>{this.close()})),s.appendChild(a),s.appendChild(c),e.appendChild(t),e.appendChild(r),e}updateSelectedBar_(e,t){e.src&&(this.selectedImg_.src=e.src,this.selectedImg_.style.display=""),this.selectedImg_.alt=e.alt||e,this.selectedBarText_.textContent=e.alt||e,this.selectedBarValue_=t}setupIntersectionObserver_(){"IntersectionObserver"in window&&(this.disposeIntersectionObserver(),this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");t&&(e.src=t,e.removeAttribute("data-src"))})(e.target))}))}),{rootMargin:"20px 0px",threshold:.01}))}disposeIntersectionObserver(){this.observer&&(this.observer=null)}disposeTooltip(){this.gridTooltip_&&(pxsim.U.remove(this.gridTooltip_),this.gridTooltip_=null)}onClose_(){this.disposeTooltip()}}n.FieldGridPicker=o,o.DEFAULT_IMG="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{"./field_utils":64,blockly:376}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldImageDropdown=void 0;const i=e("blockly"),r=e("./field_utils"),o=e("./field_dropdown");class s extends o.FieldDropdown{constructor(e,t,n){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");t&&(this.setValue(t),i.DropDownDiv.hide())},this.columns_=parseInt(t.columns),this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||300,this.backgroundColour_=(0,r.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1)}showEditor_(){if(i.DropDownDiv.hideIfOwner(this))return;i.DropDownDiv.hideWithoutAnimation(),i.DropDownDiv.clearContent();let e=i.DropDownDiv.getContentDiv(),t=document.createElement("div");t.setAttribute("role","menu"),t.setAttribute("aria-haspopup","true");const n=this.getOptions();let r=0;for(let e=0;e<n.length;e++){let o=n[e][0];const s=n[e][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",t.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+e),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt;let l=o.height;this.columns_?(l=this.width_/this.columns_-8,a.style.width=l+"px",a.style.height=l+"px"):(a.style.width=o.width+"px",a.style.height=o.height+"px"),l>r&&(r=l);let c=this.backgroundColour_;s==this.getValue()&&(c=this.sourceBlock_.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=c,a.style.borderColor=this.borderColour_,i.browserEvents.bind(a,"click",this,this.buttonClick_),i.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),t.setAttribute("aria-activedescendant",a.id)})),i.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),t.removeAttribute("aria-activedescendant")}));let u=document.createElement("img");u.src=o.src,a.setAttribute("data-value",s),u.setAttribute("data-value",s),a.appendChild(u),t.appendChild(a)}t.style.width=this.width_+"px",e.appendChild(t),this.maxRows_&&(e.style.maxHeight=(this.maxRows_+.4)*(r+8)+"px"),pxt.BrowserUtils.isFirefox()&&(e.style.paddingRight="20px"),i.DropDownDiv.setColour(this.backgroundColour_,this.borderColour_),i.DropDownDiv.showPositionedByField(this,this.onHide_.bind(this));let o=this.sourceBlock_;this.savedPrimary_=null==o?void 0:o.getColour(),(null==o?void 0:o.isShadow())?o.setColour(o.getColourTertiary()):this.borderRect_&&this.borderRect_.setAttribute("fill",o.getColourTertiary())}doValueUpdate_(e){this.selectedOption_=void 0,super.doValueUpdate_(e)}onHide_(){let e=i.DropDownDiv.getContentDiv();e.removeAttribute("role"),e.removeAttribute("aria-haspopup"),e.removeAttribute("aria-activedescendant"),e.style.width="",e.style.paddingRight="",e.style.maxHeight="";let t=this.sourceBlock_;(null==t?void 0:t.isShadow())?this.sourceBlock_.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}}n.FieldImageDropdown=s,i.Css.register("\n.blocklyDropDownButton {\n    display: inline-block;\n    float: left;\n    padding: 0;\n    margin: 4px;\n    border-radius: 4px;\n    outline: none;\n    border: 1px solid;\n    transition: box-shadow .1s;\n    cursor: pointer;\n}\n\n.blocklyDropDownButtonHover {\n    box-shadow: 0px 0px 0px 4px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton:active {\n    box-shadow: 0px 0px 0px 6px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton > img {\n    width: 80%;\n    height: 80%;\n    margin-top: 5%\n}\n")},{"./field_dropdown":33,"./field_utils":64,blockly:376}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldImages=void 0;const i=e("blockly"),r=e("./field_imagedropdown");class o extends r.FieldImageDropdown{constructor(e,t,n){super(e,t,n),this.isFieldCustom_=!0,this.shouldSort_=t.sort,this.addLabel_=!!t.addLabel}showEditor_(){if(i.DropDownDiv.hideIfOwner(this))return;let e=this.sourceBlock_;i.DropDownDiv.hideWithoutAnimation(),i.DropDownDiv.clearContent();let t=i.DropDownDiv.getContentDiv(),n=document.createElement("div");n.setAttribute("role","menu"),n.setAttribute("aria-haspopup","true");const r=this.getOptions();this.shouldSort_&&r.sort();for(let t=0;t<r.length;t++){const o=r[t][0],s=r[t][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",n.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+t),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt,this.columns_?a.style.width=this.width_/this.columns_-8+"px":(a.style.width=o.width+"px",a.style.height=o.height+"px");let l=e.getColour();s==this.getValue()&&(l=e.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=l,a.style.borderColor=e.getColourTertiary(),i.browserEvents.bind(a,"click",this,this.buttonClick_),i.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),n.setAttribute("aria-activedescendant",a.id)})),i.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),n.removeAttribute("aria-activedescendant")}));let c=document.createElement("img");if(c.src=o.src,a.setAttribute("data-value",s),c.setAttribute("data-value",s),a.appendChild(c),this.addLabel_){const e=this.createTextNode_(o.alt);e.setAttribute("data-value",s),a.appendChild(e)}n.appendChild(a)}n.style.width=this.width_+"px",t.appendChild(n),i.DropDownDiv.setColour(e.getColour(),e.getColourTertiary()),i.DropDownDiv.showPositionedByField(this,this.onHideCallback.bind(this)),this.savedPrimary_=null==e?void 0:e.getColour(),(null==e?void 0:e.isShadow())?e.setColour(e.style.colourTertiary):this.borderRect_&&this.borderRect_.setAttribute("fill",e.style.colourTertiary)}onHideCallback(){let e=this.sourceBlock_;(null==e?void 0:e.isShadow())?e.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}createTextNode_(e){const t=document.createElement("span");return t.setAttribute("class","blocklyDropdownTextLabel"),t.textContent=e,t}}n.FieldImages=o},{"./field_imagedropdown":35,blockly:376}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldKind=void 0;const i=e("blockly"),r=e("./field_utils"),o=e("../external"),s=e("./field_dropdown");class a extends s.FieldDropdown{constructor(e){super(function(e){return function(){const t=[],n=this.getSourceBlock();return(null==n?void 0:n.workspace)&&!n.isInFlyout?n.workspace.getVariablesOfType(p(e.name)).forEach((e=>{t.push([e.name,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t.push([void 0,"SEPARATOR"]),t.push([lf("Rename {0}...",e.memberName),"RENAME"]),t.push([lf("Delete {0}...",e.memberName),"DELETE"]),t}}(e)),this.opts=e}initView(){super.initView()}onItemSelected_(e,t){const n=t.getValue();if("CREATE"===n)c(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e)));else if("RENAME"===n){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),n=t.name;if(-1!==this.opts.initialMembers.indexOf(n))return void i.dialog.alert(lf("The built-in {0} '{1}' cannot be renamed. Try creating a new kind instead!",this.opts.memberName,n));u(e,Object.assign(Object.assign({},this.opts),{toRename:t}),lf("Rename '{0}':",n),(t=>{const i=(0,r.getAllFields)(e,(e=>e instanceof a&&e.getValue()===n&&e.opts.name===this.opts.name));for(const e of i)e.ref.setValue(t)}))}else if("DELETE"===n){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),n=t.name;if(-1!==this.opts.initialMembers.indexOf(n))return void i.dialog.alert(lf("The built-in {0} '{1}' cannot be deleted.",this.opts.memberName,n));const o=(0,r.getAllFields)(e,(e=>e instanceof a&&e.getValue()===n&&e.opts.name===this.opts.name));o.length>1?i.dialog.confirm(lf('Delete {0} uses of the "{1}" {2}?',o.length,n,this.opts.memberName),(n=>{if(n){i.Events.setGroup(!0);for(const e of o)e.block.dispose(!0);e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]),i.Events.setGroup(!1)}})):(e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]))}else super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}getOptions(e){return this.initVariables(),super.getOptions(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=d(e,this.opts.name);this.opts.initialMembers.forEach((n=>{-1===t.indexOf(n)&&h(e,this.opts,n)})),"CREATE"!==this.getValue()&&"RENAME"!==this.getValue()&&"DELETE"!==this.getValue()||this.opts.initialMembers.length&&this.setValue(this.opts.initialMembers[0])}}}function l(e,t,n,r,s){(0,o.prompt)(n,null,(o=>{if(o){let a=!1;if(pxtc.isIdentifierStart(o.charCodeAt(0),2)){a=!0;for(let e=1;e<o.length;e++)pxtc.isIdentifierPart(o.charCodeAt(e),2)||(a=!1)}if(!a)return void i.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>l(e,t,n,r,s)));if(pxt.blocks.isReservedWord(o)||"CREATE"===o||"RENAME"===o||"DELETE"===o)return void i.dialog.alert(lf("'{0}' is a reserved word and cannot be used.",o),(()=>l(e,t,n,r,s)));const c=d(e,t.name);for(let a=0;a<c.length;a++)if(c[a]===o)return void i.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,o),(()=>l(e,t,n,r,s)));o===t.createFunctionName&&i.dialog.alert(lf("'{0}' is a reserved name.",t.createFunctionName),(()=>l(e,t,n,r,s))),r(o)}}),{placeholder:t.promptHint})}function c(e,t,n,i){l(e,t,n,(n=>{i(h(e,t,n))}),c)}function u(e,t,n,i){l(e,t,n,(n=>{e.getVariableMap().renameVariable(t.toRename,n),i(n)}),u)}function d(e,t){const n=e.getVariablesOfType(p(t));return n&&n.length?n.map((e=>e.name)):[]}function h(e,t,n){return i.Variables.getOrCreateVariablePackage(e,null,n,p(t.name)),n}function p(e){return"KIND_"+e}n.FieldKind=a},{"../external":24,"./field_dropdown":33,"./field_utils":64,blockly:376}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldMatrix=void 0;const i=e("blockly"),r=/^.*[\.#].*$/;var o,s;(s=o||(o={}))[s.None=0]="None",s[s.Number=1]="Number",s[s.Letter=2]="Letter";class a extends i.Field{constructor(e,t,n){if(super(e,n),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.onColor="#FFFFFF",this.scale=1,this.matrixWidth=5,this.matrixHeight=5,this.yAxisLabel=o.None,this.xAxisLabel=o.None,this.cellState=[],this.cells=[],this.dontHandleMouseEvent_=e=>{e.stopPropagation(),e.preventDefault()},this.clearLedDragHandler=e=>{const t=this.sourceBlock_.getSvgRoot();pxsim.pointerEvents.down.forEach((e=>t.removeEventListener(e,this.dontHandleMouseEvent_))),t.removeEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.removeEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.removeEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),i.Touch.clearTouchIdentifier(),this.elt.removeEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),e.stopPropagation(),e.preventDefault()},this.toggleRect=(e,t)=>{this.cellState[e][t]=this.currentDragState_,this.updateValue()},this.handleRootMouseMoveListener=e=>{let t,n;e.changedTouches&&1==e.changedTouches.length?(t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY):(t=e.clientX,n=e.clientY);const i=document.elementFromPoint(t,n);if(!i)return;const r=i.getAttribute("data-x"),o=i.getAttribute("data-y");null!=r&&null!=o&&this.toggleRect(parseInt(r),parseInt(o))},this.params=t,void 0!==this.params.rows){let e=parseInt(this.params.rows);isNaN(e)||(this.matrixHeight=e)}if(void 0!==this.params.columns){let e=parseInt(this.params.columns);isNaN(e)||(this.matrixWidth=e)}void 0!==this.params.onColor&&(this.onColor=this.params.onColor),void 0!==this.params.offColor&&(this.offColor=this.params.offColor),void 0!==this.params.scale?this.scale=Math.max(.6,Math.min(2,Number(this.params.scale))):Math.max(this.matrixWidth,this.matrixHeight)>15?this.scale=.85:Math.max(this.matrixWidth,this.matrixHeight)>10&&(this.scale=.9)}showEditor_(){}initMatrix(){if(!this.sourceBlock_.isInsertionMarker()){this.elt=pxsim.svg.parseString('<svg xmlns="http://www.w3.org/2000/svg" id="field-matrix" />');for(let e=0;e<this.matrixWidth;e++){this.cellState.push([]),this.cells.push([]);for(let t=0;t<this.matrixHeight;t++)this.cellState[e].push(!1)}this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.createCell(e,t);if(this.updateValue(),this.xAxisLabel!==o.None){const e=this.scale*this.matrixHeight*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN,t=pxsim.svg.child(this.elt,"g",{transform:`translate(0 ${e})`});for(let e=0;e<this.matrixWidth;e++){const n=this.getYAxisWidth()+this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_WIDTH/2+a.CELL_HORIZONTAL_MARGIN/2;pxsim.svg.child(t,"text",{x:n,class:"blocklyText"}).textContent=this.getLabel(e,this.xAxisLabel)}}if(this.yAxisLabel!==o.None){const e=pxsim.svg.child(this.elt,"g",{});for(let t=0;t<this.matrixHeight;t++){const n=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_WIDTH/2+2*a.CELL_VERTICAL_MARGIN;pxsim.svg.child(e,"text",{x:0,y:n,class:"blocklyText"}).textContent=this.getLabel(t,this.yAxisLabel)}}this.fieldGroup_.replaceChild(this.elt,this.fieldGroup_.firstChild)}}getLabel(e,t){switch(t){case o.Letter:return String.fromCharCode(e+65);default:return(e+1).toString()}}createCell(e,t){const n=this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_HORIZONTAL_MARGIN+this.getYAxisWidth(),r=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_VERTICAL_MARGIN,o=pxsim.svg.child(this.elt,"g",{transform:`translate(${n} ${r})`}),s=pxsim.svg.child(o,"rect",{class:"blocklyLed"+(this.cellState[e][t]?"On":"Off"),cursor:"pointer",width:this.scale*a.CELL_WIDTH,height:this.scale*a.CELL_WIDTH,fill:this.getColor(e,t),"data-x":e,"data-y":t,rx:Math.max(2,this.scale*a.CELL_CORNER_RADIUS)});this.cells[e][t]=s,this.sourceBlock_.workspace.isFlyout||pxsim.pointerEvents.down.forEach((n=>s.addEventListener(n,(n=>{const r=this.sourceBlock_.getSvgRoot();this.currentDragState_=!this.cellState[e][t],i.hideChaff(),this.sourceBlock_.select(),this.toggleRect(e,t),pxsim.pointerEvents.down.forEach((e=>r.addEventListener(e,this.dontHandleMouseEvent_))),r.addEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.addEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.addEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),this.elt.addEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),n.stopPropagation(),n.preventDefault()}),!1)))}getColor(e,t){return this.cellState[e][t]?this.onColor:this.offColor||a.DEFAULT_OFF_COLOR}getOpacity(e,t){const n=this.offColor?"1.0":"0.2";return this.cellState[e][t]?"1.0":n}updateCell(e,t){const n=this.cells[e][t];n.setAttribute("fill",this.getColor(e,t)),n.setAttribute("fill-opacity",this.getOpacity(e,t)),n.setAttribute("class","blocklyLed"+(this.cellState[e][t]?"On":"Off"))}setValue(e,t=!0){if(super.setValue(String(e)),this.elt){t&&this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.updateCell(e,t)}}render_(){this.visible_?(this.elt||this.initMatrix(),this.size_.height=this.scale*Number(this.matrixHeight)*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN+this.getXAxisHeight(),this.size_.width=this.scale*Number(this.matrixWidth)*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+this.getYAxisWidth()):this.markDirty()}getValue(){let e=function(e){const t=(e=(e||"").trim()).charAt(0);return t===e.charAt(e.length-1)&&-1!==u.indexOf(t)?e.substr(1,e.length-2).trim():e}(this.value_);return`\`\n${a.TAB}${e}\n${a.TAB}\``}restoreStateFromString(){let e=this.value_;if(e){const t=e.split("\n").filter((e=>r.test(e)));for(let e=0;e<t.length&&e<this.matrixHeight;e++){let n=0;const i=t[e];for(let t=0;t<i.length&&n<this.matrixWidth;t++)c(i[t])?(this.cellState[n][e]=!1,n++):l(i[t])&&(this.cellState[n][e]=!0,n++)}}}updateValue(){let e="";for(let t=0;t<this.matrixHeight;t++){for(let n=0;n<this.matrixWidth;n++)e+=(this.cellState[n][t]?"#":".")+" ";e+="\n"+a.TAB}this.setValue(e,!1)}getYAxisWidth(){return this.yAxisLabel===o.None?0:a.Y_AXIS_WIDTH}getXAxisHeight(){return this.xAxisLabel===o.None?0:a.X_AXIS_HEIGHT}}function l(e){return"#"===e||"*"===e||"1"===e}function c(e){return"."===e||"_"===e||"0"===e}n.FieldMatrix=a,a.CELL_WIDTH=25,a.CELL_HORIZONTAL_MARGIN=7,a.CELL_VERTICAL_MARGIN=5,a.CELL_CORNER_RADIUS=5,a.BOTTOM_MARGIN=9,a.Y_AXIS_WIDTH=9,a.X_AXIS_HEIGHT=10,a.TAB="        ",a.DEFAULT_OFF_COLOR="#000000";const u=["'",'"',"`"]},{blockly:376}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldCustomMelody=n.TOTAL_WIDTH=n.HEADER_HEIGHT=void 0;const i=e("blockly");var r=pxt.svgUtil;const o=e("./field_utils");n.HEADER_HEIGHT=50,n.TOTAL_WIDTH=300;class s extends i.Field{constructor(e,t,n){super(e,n),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.soundingKeys=0,this.numRow=8,this.numCol=8,this.tempo=120,this.isPlaying=!1,this.timeouts=[],this.params=t,this.createMelodyIfDoesntExist()}init(){super.init(),this.onInit()}showEditor_(){i.DropDownDiv.hideWithoutAnimation(),i.DropDownDiv.clearContent(),i.DropDownDiv.setColour(this.getDropdownBackgroundColour(),this.getDropdownBorderColour());let e=i.DropDownDiv.getContentDiv();pxt.BrowserUtils.addClass(e,"melody-content-div"),pxt.BrowserUtils.addClass(e.parentElement,"melody-editor-dropdown"),this.gallery=new pxtmelody.MelodyGallery,this.renderEditor(e),this.prevString=this.getValue(),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!0),i.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>{this.onEditorClose(),pxt.BrowserUtils.removeClass(e,"melody-content-div"),pxt.BrowserUtils.removeClass(e.parentElement,"melody-editor-dropdown"),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!1)}))}getValue(){return this.stringRep=this.getTypeScriptValue(),this.stringRep}doValueUpdate_(e){null==e||""==e||'""'==e||this.stringRep&&this.stringRep===e||(this.stringRep=e,this.parseTypeScriptValue(e),super.doValueUpdate_(this.getValue()))}getText_(){return this.invalidString?pxt.Util.lf("Invalid Input"):this.getValue()}onInit(){this.render_(),this.createMelodyIfDoesntExist(),this.invalidString||(this.fieldGroup_||(this.fieldGroup_=i.utils.dom.createSvgElement("g",{},null)),this.visible_||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.updateFieldLabel())}render_(){super.render_(),this.invalidString||(this.size_.width=s.MUSIC_ICON_WIDTH+(s.COLOR_BLOCK_WIDTH+s.COLOR_BLOCK_SPACING)*this.numCol),this.sourceBlock_.setColour("#ffffff")}renderEditor(e){let t=this.getDropdownBackgroundColour(),i=this.getDropdownBorderColour();this.topDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.topDiv,"melody-top-bar-div"),this.root=new r.SVG(this.topDiv).id("melody-editor-header-controls"),this.toggle=new c(this.root,{leftText:lf("Editor"),rightText:lf("Gallery"),baseColor:t}),this.toggle.onStateChange((e=>{e?this.hideGallery():this.showGallery()})),this.toggle.layout(),this.toggle.translate((n.TOTAL_WIDTH-this.toggle.width())/2,0),e.appendChild(this.topDiv),e.appendChild(this.gallery.getElement()),this.editorDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.editorDiv,"melody-editor-div"),this.editorDiv.style.setProperty("background-color",i),this.gridDiv=this.createGridDisplay(),this.editorDiv.appendChild(this.gridDiv),this.bottomDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.bottomDiv,"melody-bottom-bar-div"),this.doneButton=document.createElement("button"),pxt.BrowserUtils.addClass(this.doneButton,"melody-confirm-button"),this.doneButton.innerText=lf("Done"),this.doneButton.addEventListener("click",(()=>this.onDone())),this.doneButton.style.setProperty("background-color",t),this.playButton=document.createElement("button"),this.playButton.id="melody-play-button",this.playButton.addEventListener("click",(()=>this.togglePlay())),this.playIcon=document.createElement("i"),this.playIcon.id="melody-play-icon",pxt.BrowserUtils.addClass(this.playIcon,"play icon"),this.playButton.appendChild(this.playIcon),this.tempoInput=document.createElement("input"),pxt.BrowserUtils.addClass(this.tempoInput,"ui input"),this.tempoInput.type="number",this.tempoInput.title=lf("tempo"),this.tempoInput.id="melody-tempo-input",this.tempoInput.addEventListener("input",(()=>this.setTempo(+this.tempoInput.value))),this.syncTempoField(!0),this.bottomDiv.appendChild(this.tempoInput),this.bottomDiv.appendChild(this.playButton),this.bottomDiv.appendChild(this.doneButton),this.editorDiv.appendChild(this.bottomDiv),e.appendChild(this.editorDiv)}onEditorClose(){this.stopMelody(),this.gallery&&this.gallery.stopMelody(),this.clearDomReferences(),this.sourceBlock_&&i.Events.isEnabled()&&this.getValue()!==this.prevString&&i.Events.fire(new i.Events.BlockChange(this.sourceBlock_,"field",this.name,this.prevString,this.getValue())),this.prevString=void 0}onDone(){i.DropDownDiv.hideIfOwner(this),this.onEditorClose()}clearDomReferences(){this.topDiv=null,this.editorDiv=null,this.gridDiv=null,this.bottomDiv=null,this.doneButton=null,this.playButton=null,this.playIcon=null,this.tempoInput=null,this.elt=null,this.cells=null,this.toggle=null,this.root=null,this.gallery.clearDomReferences()}getTypeScriptValue(){return this.invalidString?this.invalidString:this.melody?'"'+this.melody.getStringRepresentation()+'"':""}parseTypeScriptValue(e){let t=e;try{e=(e=e.slice(1,-1)).trim(),this.createMelodyIfDoesntExist();let t=e.split(" ");t.forEach((e=>{if(!this.isValidNote(e))throw new Error(lf("Invalid note '{0}'. Notes can be C D E F G A B C5",e))})),this.melody.resetMelody();for(let e=0;e<t.length;e++)if("-"!=t[e]){let n=pxtmelody.noteToRow(t[e]);this.melody.updateMelody(n,e)}this.updateFieldLabel()}catch(e){pxt.log(e),this.invalidString=t}}isValidNote(e){switch(e){case"C":case"D":case"E":case"F":case"G":case"A":case"B":case"C5":case"-":return!0}return!1}getPreviewWidth(){return this.updateSize_(),this.size_.width}getPreviewHeight(){var e;return(null===(e=this.getConstants())||void 0===e?void 0:e.FIELD_BORDER_RECT_HEIGHT)||16}getDropdownBackgroundColour(){const e=this.sourceBlock_.getParent();return e?e.getColour():"#3D3D3D"}getDropdownBorderColour(){const e=this.sourceBlock_.getParent();return e?e.getColourTertiary():"#2A2A2A"}updateFieldLabel(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);let e=u("").appendClass("melody-editor-field-icon").at(6,15);this.fieldGroup_.appendChild(e.el);let t=this.melody.getStringRepresentation().trim().split(" ");for(let e=0;e<t.length;e++){let n=pxtmelody.getColorClass(pxtmelody.noteToRow(t[e]));const i=(new r.Rect).at((s.COLOR_BLOCK_WIDTH+s.COLOR_BLOCK_SPACING)*e+s.COLOR_BLOCK_X,s.COLOR_BLOCK_Y).size(s.COLOR_BLOCK_WIDTH,s.COLOR_BLOCK_HEIGHT).stroke("#898989",1).fill(d(pxtmelody.noteToRow(t[e]))).corners(3,2);pxt.BrowserUtils.addClass(i.el,n),this.fieldGroup_.appendChild(i.el)}}setTempo(e){(isNaN(e)||e<=0)&&this.tempoInput?this.tempoInput.value=this.tempo+"":this.tempo!=e&&(this.tempo=e,this.melody&&this.melody.setTempo(this.tempo),this.tempoInput&&(this.tempoInput.value=this.tempo+""),this.syncTempoField(!1))}syncTempoField(e){const t=this.sourceBlock_.getParent();if(t)for(const n of t.inputList)if("tempo"===n.name||"bpm"===n.name){const t=n.connection.targetBlock();t&&(e?t.getFieldValue("SLIDER")?(this.tempoInput.value=t.getFieldValue("SLIDER"),this.tempo=+this.tempoInput.value):this.tempoInput.value=this.tempo+"":("math_number_minmax"===t.type?t.setFieldValue(this.tempoInput.value,"SLIDER"):t.setFieldValue(this.tempoInput.value,"NUM"),this.tempoInput.focus()));break}}getDuration(){return 6e4/this.tempo}createMelodyIfDoesntExist(){return!this.melody&&(this.melody=new pxtmelody.MelodyArray,!0)}onNoteSelect(e,t){this.invalidString=null,this.melody.updateMelody(e,t),this.melody.getValue(e,t)&&!this.isPlaying&&this.playNote(e,t),this.updateGrid(),this.updateFieldLabel()}updateGrid(){for(let e=0;e<this.numRow;e++){const t=pxtmelody.getColorClass(e);for(let n=0;n<this.numCol;n++){const i=this.cells[e][n];this.melody.getValue(e,n)?(pxt.BrowserUtils.removeClass(i,"melody-default"),pxt.BrowserUtils.addClass(i,t)):(pxt.BrowserUtils.addClass(i,"melody-default"),pxt.BrowserUtils.removeClass(i,t))}}}playNote(e,t){let n=++this.soundingKeys;this.isPlaying?(this.timeouts.push(setTimeout((()=>{this.playToneCore(e)}),t*this.getDuration())),this.timeouts.push(setTimeout((()=>{pxt.AudioContextManager.stop()}),(t+1)*this.getDuration()))):(this.playToneCore(e),this.timeouts.push(setTimeout((()=>{this.soundingKeys==n&&pxt.AudioContextManager.stop()}),this.getDuration())))}queueToneForColumn(e,t,n){const i=setTimeout((()=>{++this.soundingKeys,pxt.AudioContextManager.stop();for(let t=0;t<this.numRow;t++)this.melody.getValue(t,e)&&this.playToneCore(t);this.highlightColumn(e,!0),this.timeouts=this.timeouts.filter((e=>e!==i))}),t),r=setTimeout((()=>{this.timeouts=this.timeouts.filter((e=>e!==r)),this.highlightColumn(e,!1)}),t+n);this.timeouts.push(i),this.timeouts.push(r)}playToneCore(e){let t=0;switch(e){case 0:t=523;break;case 1:t=494;break;case 2:t=440;break;case 3:t=392;break;case 4:t=349;break;case 5:t=330;break;case 6:t=294;break;case 7:t=262}pxt.AudioContextManager.tone(t)}highlightColumn(e,t){this.cells.map((t=>t[e])).forEach((e=>{t?pxt.BrowserUtils.addClass(e,"playing"):pxt.BrowserUtils.removeClass(e,"playing")}))}createGridDisplay(){s.VIEWBOX_WIDTH=(s.CELL_WIDTH+s.CELL_VERTICAL_MARGIN)*this.numCol+s.CELL_VERTICAL_MARGIN,pxt.BrowserUtils.isEdge()&&(s.VIEWBOX_WIDTH+=37),s.VIEWBOX_HEIGHT=(s.CELL_WIDTH+s.CELL_HORIZONTAL_MARGIN)*this.numRow+s.CELL_HORIZONTAL_MARGIN,this.elt=pxsim.svg.parseString(`<svg xmlns="http://www.w3.org/2000/svg" class="melody-grid-div" viewBox="0 0 ${s.VIEWBOX_WIDTH} ${s.VIEWBOX_HEIGHT}"/>`),this.cells=[];for(let e=0;e<this.numRow;e++)this.cells.push([]);for(let e=0;e<this.numRow;e++)for(let t=0;t<this.numCol;t++)this.createCell(e,t);return this.elt}createCell(e,t){const n=e*(s.CELL_WIDTH+s.CELL_HORIZONTAL_MARGIN)+s.CELL_HORIZONTAL_MARGIN,i=t*(s.CELL_WIDTH+s.CELL_VERTICAL_MARGIN)+s.CELL_VERTICAL_MARGIN,r=pxsim.svg.child(this.elt,"g",{transform:`translate(${i} ${n})`}),o=pxsim.svg.child(r,"rect",{cursor:"pointer",width:s.CELL_WIDTH,height:s.CELL_WIDTH,stroke:"white","data-x":e,"data-y":t,rx:s.CELL_CORNER_RADIUS});this.melody.getValue(e,t)?pxt.BrowserUtils.addClass(o,pxtmelody.getColorClass(e)):pxt.BrowserUtils.addClass(o,"melody-default"),this.sourceBlock_.workspace.isFlyout||(pxsim.pointerEvents.down.forEach((n=>o.addEventListener(n,(n=>{this.onNoteSelect(e,t),n.stopPropagation(),n.preventDefault()}),!1))),this.cells[e][t]=o)}togglePlay(){this.isPlaying?this.stopMelody():(this.isPlaying=!0,this.playMelody()),this.updatePlayButton()}updatePlayButton(){this.isPlaying?(pxt.BrowserUtils.removeClass(this.playIcon,"play icon"),pxt.BrowserUtils.addClass(this.playIcon,"stop icon")):(pxt.BrowserUtils.removeClass(this.playIcon,"stop icon"),pxt.BrowserUtils.addClass(this.playIcon,"play icon"))}playMelody(){if(this.isPlaying){for(let e=0;e<this.numCol;e++)this.queueToneForColumn(e,e*this.getDuration(),this.getDuration());this.timeouts.push(setTimeout((()=>this.playMelody()),this.numCol*this.getDuration()))}else this.stopMelody()}stopMelody(){if(this.isPlaying){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop(),this.isPlaying=!1,this.cells.forEach((e=>e.forEach((e=>pxt.BrowserUtils.removeClass(e,"playing")))))}}showGallery(){this.stopMelody(),this.updatePlayButton(),this.gallery.show((e=>{e&&(this.melody.parseNotes(e),this.gallery.hide(),this.toggle.toggle(),this.updateFieldLabel(),this.updateGrid())}))}hideGallery(){this.gallery.hide()}}n.FieldCustomMelody=s,s.CELL_WIDTH=25,s.CELL_HORIZONTAL_MARGIN=7,s.CELL_VERTICAL_MARGIN=5,s.CELL_CORNER_RADIUS=5,s.COLOR_BLOCK_WIDTH=10,s.COLOR_BLOCK_HEIGHT=20,s.COLOR_BLOCK_X=20,s.COLOR_BLOCK_Y=5,s.COLOR_BLOCK_SPACING=2,s.MUSIC_ICON_WIDTH=20;const a=200,l=40;class c{constructor(e,t){this.props=function(e){return e.baseColor||(e.baseColor="#e95153"),e.backgroundColor||(e.backgroundColor="rgba(52,73,94,.2)"),e.borderColor||(e.borderColor="rgba(52,73,94,.4)"),e.selectedTextColor||(e.selectedTextColor=e.baseColor),e.unselectedTextColor||(e.unselectedTextColor="hsla(0,0%,100%,.9)"),e.switchColor||(e.switchColor="#ffffff"),e}(t),this.root=e.group(),this.buildDom(),this.isLeft=!0}buildDom(){this.root.style().content("\n        .toggle-left {\n            transform: translateX(0px);\n            animation: mvleft 0.2s 0s ease;\n        }\n\n        .toggle-right {\n            transform: translateX(100px);\n            animation: mvright 0.2s 0s ease;\n        }\n\n        @keyframes mvright {\n            0% {\n                transform: translateX(0px);\n            }\n            100% {\n                transform: translateX(100px);\n            }\n        }\n\n        @keyframes mvleft {\n            0% {\n                transform: translateX(100px);\n            }\n            100% {\n                transform: translateX(0px);\n            }\n        }\n        "),this.root.def().create("clipPath","sprite-editor-toggle-border").clipPathUnits(!0).draw("rect").at(0,0).corners(.02,.1).size(1,1),this.root.draw("rect").size(a,l).fill(this.props.baseColor).stroke(this.props.borderColor,4).corners(4,4).clipPath("url(#sprite-editor-toggle-border)"),this.root.draw("rect").at(2,2).size(196,36).fill(this.props.backgroundColor).corners(4,4),this.switch=this.root.draw("rect").at(2,2).size(98,36).fill(this.props.switchColor).corners(4,4),this.leftElement=this.root.group(),this.leftText=u(this.props.leftText).appendClass("sprite-editor-text").fill(this.props.selectedTextColor),this.leftElement.appendChild(this.leftText),this.rightElement=this.root.group(),this.rightText=u(this.props.rightText).appendClass("sprite-editor-text").fill(this.props.unselectedTextColor),this.rightElement.appendChild(this.rightText),this.root.onClick((()=>this.toggle()))}toggle(e=!1){this.isLeft?(this.switch.removeClass("toggle-left"),this.switch.appendClass("toggle-right"),this.leftText.fill(this.props.unselectedTextColor),this.rightText.fill(this.props.selectedTextColor)):(this.switch.removeClass("toggle-right"),this.switch.appendClass("toggle-left"),this.leftText.fill(this.props.selectedTextColor),this.rightText.fill(this.props.unselectedTextColor)),this.isLeft=!this.isLeft,!e&&this.changeHandler&&this.changeHandler(this.isLeft)}onStateChange(e){this.changeHandler=e}layout(){this.leftText.moveTo(51,20),this.rightText.moveTo(149,20)}translate(e,t){this.root.translate(e,t)}height(){return l}width(){return a}}function u(e){return new r.Text(e).anchor("middle").setAttribute("dominant-baseline","middle").setAttribute("dy",pxt.BrowserUtils.isIE()||pxt.BrowserUtils.isEdge()?"0.3em":"0.1em")}function d(e){switch(e){case 0:return"#A80000";case 1:return"#D83B01";case 2:return"#FFB900";case 3:return"#107C10";case 4:return"#008272";case 5:return"#0078D7";case 6:return"#5C2D91";case 7:return"#B4009E"}return"#DCDCDC"}},{"./field_utils":64,blockly:376}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldMusicEditor=void 0;var i=pxt.svgUtil;const r=e("./field_asset"),o=e("./field_utils");class s extends r.FieldAssetEditor{getAssetType(){return"song"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const n=pxt.lookupProjectAssetByTSReference(e,t);if(n)return n}if(this.getBlockData())return t.lookupAsset("song",this.getBlockData());let n;if(e){const t=/^\s*hex\s*`([a-fA-F0-9]+)`\s*(?:;?)\s*$/.exec(e);t&&(n=pxt.assets.music.decodeSongFromHex(t[1]))}else n=pxt.assets.music.getEmptySong(2);return n?(pxt.assets.music.inflateSong(n),{internalID:-1,id:this.sourceBlock_.id,type:"song",meta:{},song:n}):(this.isGreyBlock=!0,void(this.valueText=e))}render_(){super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=18+this.previewWidth())}getValueText(){return this.asset&&!this.isTemporaryAsset()?pxt.getTSReferenceForAsset(this.asset):this.asset?`hex\`${pxt.assets.music.encodeSongToHex(this.asset.song)}\``:this.valueText||""}parseFieldOptions(e){return{}}redrawPreview(){var e;if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return void super.redrawPreview();const t=18+this.previewWidth(),n=(new i.Rect).at(5,1).size(8+this.previewWidth(),40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(n.el),this.asset){const e=(0,o.songToDataURI)(this.asset.song,this.previewWidth(),32,this.lightMode);if(e){const t=(new i.Image).src(e).at(9,5).size(this.previewWidth(),32);this.fieldGroup_.appendChild(t.el)}}(null===(e=this.size_)||void 0===e?void 0:e.width)!=t&&this.forceRerender()}previewWidth(){return 32*(this.asset?this.asset.song.measures:2)}}n.FieldMusicEditor=s},{"./field_asset":28,"./field_utils":64}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldNote=void 0;const i=e("blockly"),r=e("./field_utils");var o,s;(s=o||(o={}))[s.C=262]="C",s[s.CSharp=277]="CSharp",s[s.D=294]="D",s[s.Eb=311]="Eb",s[s.E=330]="E",s[s.F=349]="F",s[s.FSharp=370]="FSharp",s[s.G=392]="G",s[s.GSharp=415]="GSharp",s[s.A=440]="A",s[s.Bb=466]="Bb",s[s.B=494]="B",s[s.C3=131]="C3",s[s.CSharp3=139]="CSharp3",s[s.D3=147]="D3",s[s.Eb3=156]="Eb3",s[s.E3=165]="E3",s[s.F3=175]="F3",s[s.FSharp3=185]="FSharp3",s[s.G3=196]="G3",s[s.GSharp3=208]="GSharp3",s[s.A3=220]="A3",s[s.Bb3=233]="Bb3",s[s.B3=247]="B3",s[s.C4=262]="C4",s[s.CSharp4=277]="CSharp4",s[s.D4=294]="D4",s[s.Eb4=311]="Eb4",s[s.E4=330]="E4",s[s.F4=349]="F4",s[s.FSharp4=370]="FSharp4",s[s.G4=392]="G4",s[s.GSharp4=415]="GSharp4",s[s.A4=440]="A4",s[s.Bb4=466]="Bb4",s[s.B4=494]="B4",s[s.C5=523]="C5",s[s.CSharp5=555]="CSharp5",s[s.D5=587]="D5",s[s.Eb5=622]="Eb5",s[s.E5=659]="E5",s[s.F5=698]="F5",s[s.FSharp5=740]="FSharp5",s[s.G5=784]="G5",s[s.GSharp5=831]="GSharp5",s[s.A5=880]="A5",s[s.Bb5=932]="Bb5",s[s.B5=988]="B5",s[s.C6=1047]="C6",s[s.CSharp6=1109]="CSharp6",s[s.D6=1175]="D6",s[s.Eb6=1245]="Eb6",s[s.E6=1319]="E6",s[s.F6=1397]="F6",s[s.FSharp6=1480]="FSharp6",s[s.G6=1568]="G6",s[s.GSharp6=1568]="GSharp6",s[s.A6=1760]="A6",s[s.Bb6=1865]="Bb6",s[s.B6=1976]="B6",s[s.C7=2093]="C7";class a extends i.FieldNumber{constructor(e,t,n){super(null,0,null,null,n),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.isTextValid_=!0,this.nKeys_=36,this.minNote_=28,this.maxNote_=63,this.eps=2,this.setSpellcheck(!1),this.prepareNotes(),this.isExpanded=!1,this.currentPage=0,this.totalPlayCount=0,t.editorColour&&(this.primaryColour=(0,r.parseColour)(t.editorColour),this.borderColour=i.utils.colour.blend("#000000",this.primaryColour,.2));const o=parseInt(t.eps);!Number.isNaN(o)&&o>=0&&(this.eps=o);const s=parseInt(t.minNote)||this.minNote_,a=parseInt(t.maxNote)||this.maxNote_;s>=28&&a<=75&&a>s&&(this.minNote_=s,this.maxNote_=a,this.nKeys_=this.maxNote_-this.minNote_+1),this.setValue(e)}doClassValidation_(e){const t=/^Note\.(.+)$/.exec(e),n=t&&t.length>1?t[1]:null;if(null===(e=o[n]?o[n]:String(parseFloat(e||"0"))))return null;const i=parseFloat(e||"0");if(isNaN(i)||i<0)return null;const r=Math.floor(i)!=i;return Number(i.toFixed(r?2:0))}getValue(){return this.value_+""}doValueUpdate_(e){isNaN(Number(e))||Number(e)<0||(this.sourceBlock_&&i.Events.isEnabled()&&this.value_!=e&&i.Events.fire(new i.Events.BlockChange(this.sourceBlock_,"field",this.name,this.value_,e)),this.value_=e,this.refreshText())}getText(){if(this.isExpanded)return""+this.value_;{const e=+this.value_;for(let t=0;t<this.nKeys_;t++)if(Math.abs(this.getKeyFreq(t+this.minNote_)-e)<this.eps)return this.getKeyName(t+this.minNote_);let t=e.toString();return isNaN(e)||(t+=" Hz"),t}}refreshText(){this.forceRerender()}onFinishEditing_(e){this.refreshText()}onHide(){this.isExpanded=!1,this.refreshText()}showEditor_(e){this.isExpanded=!0,this.updateColor(),i.DropDownDiv.hideWithoutAnimation(),i.DropDownDiv.clearContent();const t=pxt.BrowserUtils.isMobile()||pxt.BrowserUtils.isIOS();super.showEditor_(e,t),this.refreshText(),i.Events.setGroup(!0),this.piano=[],this.currentSelectedKey=void 0;const n=this.nKeys_-this.nKeys_/a.notesPerOctave*a.blackKeysPerOctave,r=a.notesPerOctave-a.blackKeysPerOctave;let o=a.keyWidth*n,s=a.keyHeight+a.labelHeight;const c=window.innerWidth<o;c&&(o=r*a.keyWidth,s=a.keyHeight+a.labelHeight+a.prevNextHeight);const u=l("blocklyPianoDiv",`width: ${o}px;\n            height: ${s}px;`);i.DropDownDiv.getContentDiv().appendChild(u),this.noteLabel=l("blocklyNoteLabel",`top: ${a.keyHeight}px;\n            width: ${o}px;\n            background-color: ${this.primaryColour};\n            border-color: ${this.primaryColour};`),u.appendChild(this.noteLabel),this.noteLabel.textContent="-";let d=0;for(let e=0;e<this.nKeys_;e++){const t=Math.floor(e/a.notesPerOctave);let n=this.getPosition(e+this.minNote_);c&&e>=a.notesPerOctave&&(n-=r*t*a.keyWidth);const i=this.getKeyDiv(e+this.minNote_,n);this.piano.push(i),u.appendChild(i),Math.abs(this.getKeyFreq(e+this.minNote_)-Number(this.getValue()))<this.eps&&(pxt.BrowserUtils.addClass(i,"selected"),this.currentSelectedKey=i,d=t)}c&&(this.setPage(d),u.appendChild(this.getNextPrevDiv(!0,o)),u.appendChild(this.getNextPrevDiv(!1,o))),i.DropDownDiv.setColour(this.primaryColour,this.borderColour),i.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>this.onHide()))}playKey(e,t){const n=++this.totalPlayCount;this.currentSelectedKey!==e&&(this.currentSelectedKey&&pxt.BrowserUtils.removeClass(this.currentSelectedKey,"selected"),pxt.BrowserUtils.addClass(e,"selected"),this.setValue(t)),this.currentSelectedKey=e,this.htmlInput_.value=this.getText(),pxt.AudioContextManager.tone(t),setTimeout((()=>{this.totalPlayCount==n&&pxt.AudioContextManager.stop()}),300)}dispose(){i.DropDownDiv.hideIfOwner(this),super.dispose()}updateColor(){const e=this.sourceBlock_.getParent();e&&(this.sourceBlock_.isShadow()||function(e){return 1===e.inputList.length&&1===e.inputList[0].fieldRow.length}(this.sourceBlock_))?(this.primaryColour=e.getColour(),this.borderColour=e.getColourTertiary()):(this.primaryColour="#3D3D3D",this.borderColour="#2A2A2A")}setPage(e){const t=this.nKeys_/a.notesPerOctave;e=Math.max(Math.min(e,t-1),0),this.noteLabel.textContent=`Octave #${e+1}`;const n=e*a.notesPerOctave;for(let e=0;e<this.piano.length;++e){const t=e>=n&&e<n+a.notesPerOctave;this.piano[e].style.display=t?"block":"none"}this.currentPage=e}getNextPrevDiv(e,t){const n=e?0:t/2,r=l("blocklyNotePrevNext",`top: ${a.keyHeight+a.labelHeight}px;\n            left: ${n}px;\n            width: ${Math.ceil(t/2)}px;\n            ${e?"border-left-color":"border-right-color"}: ${this.primaryColour};\n            background-color: ${this.primaryColour};\n            border-bottom-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{i.browserEvents.conditionalBind(r,t,this,(()=>this.setPage(e?this.currentPage-1:this.currentPage+1)),!0)})),r.textContent=e?"<":">",r}getKeyDiv(e,t){const n=l("blocklyNote "+(this.isWhite(e)?"":"black"),`width: ${this.getKeyWidth(e)}px;\n            height: ${this.getKeyHeight(e)}px;\n            left: ${t}px;\n            border-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{i.browserEvents.conditionalBind(n,t,this,(()=>this.playKey(n,this.getKeyFreq(e))),!0)})),i.browserEvents.conditionalBind(n,"mouseover",this,(t=>{this.noteLabel.textContent=this.getKeyName(e),t.buttons&&this.playKey(n,this.getKeyFreq(e))}),!0),n}isWhite(e){switch((e+=8)%12){case 1:case 3:case 6:case 8:case 10:return!1;default:return!0}}whiteKeysBefore(e){switch((e+=8)%12){case 0:return 0;case 1:case 2:return 1;case 3:case 4:return 2;case 5:return 3;case 6:case 7:return 4;case 8:case 9:return 5;case 10:case 11:return 6}return-1}getKeyWidth(e){return this.isWhite(e)?a.keyWidth:a.keyWidth/2}getKeyHeight(e){return this.isWhite(e)?a.keyHeight:a.keyHeight/2}getKeyFreq(e){return this.getKeyNoteData(e).freq}getKeyName(e){const t=this.getKeyNoteData(e);let n=t.prefixedName;return this.nKeys_<=a.notesPerOctave?n=t.name:this.minNote_>=28&&this.maxNote_<=63&&(n=t.altPrefixedName||n),n}getKeyNoteData(e){return a.Notes[e]}getPosition(e){if(e===this.minNote_)return 0;const t=a.keyWidth/4,n=Math.floor((this.minNote_+8)/a.notesPerOctave),i=Math.floor((e+8)/a.notesPerOctave);let r=this.whiteKeysBefore(this.minNote_)*a.keyWidth;if(this.isWhite(this.minNote_)||(r-=t),i>n){const o=7*a.keyWidth,s=o-r+(i-n-1)*o;return this.whiteKeysBefore(e)*a.keyWidth+s-(this.isWhite(e)?0:t)}return this.whiteKeysBefore(e)*a.keyWidth-r-(this.isWhite(e)?0:t)}prepareNotes(){a.Notes||(a.Notes={28:{name:lf("{id:note}C"),prefixedName:lf("Low C"),freq:131},29:{name:lf("C#"),prefixedName:lf("Low C#"),freq:139},30:{name:lf("{id:note}D"),prefixedName:lf("Low D"),freq:147},31:{name:lf("D#"),prefixedName:lf("Low D#"),freq:156},32:{name:lf("{id:note}E"),prefixedName:lf("Low E"),freq:165},33:{name:lf("{id:note}F"),prefixedName:lf("Low F"),freq:175},34:{name:lf("F#"),prefixedName:lf("Low F#"),freq:185},35:{name:lf("{id:note}G"),prefixedName:lf("Low G"),freq:196},36:{name:lf("G#"),prefixedName:lf("Low G#"),freq:208},37:{name:lf("{id:note}A"),prefixedName:lf("Low A"),freq:220},38:{name:lf("A#"),prefixedName:lf("Low A#"),freq:233},39:{name:lf("{id:note}B"),prefixedName:lf("Low B"),freq:247},40:{name:lf("{id:note}C"),prefixedName:lf("Middle C"),freq:262},41:{name:lf("C#"),prefixedName:lf("Middle C#"),freq:277},42:{name:lf("{id:note}D"),prefixedName:lf("Middle D"),freq:294},43:{name:lf("D#"),prefixedName:lf("Middle D#"),freq:311},44:{name:lf("{id:note}E"),prefixedName:lf("Middle E"),freq:330},45:{name:lf("{id:note}F"),prefixedName:lf("Middle F"),freq:349},46:{name:lf("F#"),prefixedName:lf("Middle F#"),freq:370},47:{name:lf("{id:note}G"),prefixedName:lf("Middle G"),freq:392},48:{name:lf("G#"),prefixedName:lf("Middle G#"),freq:415},49:{name:lf("{id:note}A"),prefixedName:lf("Middle A"),freq:440},50:{name:lf("A#"),prefixedName:lf("Middle A#"),freq:466},51:{name:lf("{id:note}B"),prefixedName:lf("Middle B"),freq:494},52:{name:lf("{id:note}C"),prefixedName:lf("Tenor C"),altPrefixedName:lf("High C"),freq:523},53:{name:lf("C#"),prefixedName:lf("Tenor C#"),altPrefixedName:lf("High C#"),freq:554},54:{name:lf("{id:note}D"),prefixedName:lf("Tenor D"),altPrefixedName:lf("High D"),freq:587},55:{name:lf("D#"),prefixedName:lf("Tenor D#"),altPrefixedName:lf("High D#"),freq:622},56:{name:lf("{id:note}E"),prefixedName:lf("Tenor E"),altPrefixedName:lf("High E"),freq:659},57:{name:lf("{id:note}F"),prefixedName:lf("Tenor F"),altPrefixedName:lf("High F"),freq:698},58:{name:lf("F#"),prefixedName:lf("Tenor F#"),altPrefixedName:lf("High F#"),freq:740},59:{name:lf("{id:note}G"),prefixedName:lf("Tenor G"),altPrefixedName:lf("High G"),freq:784},60:{name:lf("G#"),prefixedName:lf("Tenor G#"),altPrefixedName:lf("High G#"),freq:831},61:{name:lf("{id:note}A"),prefixedName:lf("Tenor A"),altPrefixedName:lf("High A"),freq:880},62:{name:lf("A#"),prefixedName:lf("Tenor A#"),altPrefixedName:lf("High A#"),freq:932},63:{name:lf("{id:note}B"),prefixedName:lf("Tenor B"),altPrefixedName:lf("High B"),freq:988},64:{name:lf("{id:note}C"),prefixedName:lf("High C"),freq:1046},65:{name:lf("C#"),prefixedName:lf("High C#"),freq:1109},66:{name:lf("{id:note}D"),prefixedName:lf("High D"),freq:1175},67:{name:lf("D#"),prefixedName:lf("High D#"),freq:1245},68:{name:lf("{id:note}E"),prefixedName:lf("High E"),freq:1319},69:{name:lf("{id:note}F"),prefixedName:lf("High F"),freq:1397},70:{name:lf("F#"),prefixedName:lf("High F#"),freq:1478},71:{name:lf("{id:note}G"),prefixedName:lf("High G"),freq:1568},72:{name:lf("G#"),prefixedName:lf("High G#"),freq:1661},73:{name:lf("{id:note}A"),prefixedName:lf("High A"),freq:1760},74:{name:lf("A#"),prefixedName:lf("High A#"),freq:1865},75:{name:lf("{id:note}B"),prefixedName:lf("High B"),freq:1976}})}}function l(e,t){const n=document.createElement("div");return pxt.BrowserUtils.addClass(n,e),n.setAttribute("style",t.replace(/\s+/g," ")),n}n.FieldNote=a,a.keyWidth=22,a.keyHeight=90,a.labelHeight=24,a.prevNextHeight=20,a.notesPerOctave=12,a.blackKeysPerOctave=5},{"./field_utils":64,blockly:376}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldNumberDropdown=void 0;const i=e("./field_textdropdown");class r extends i.BaseFieldTextDropdown{constructor(e,t,n,i,r,o){super(e+"",t,o),this.setConstraints(n,i,r)}setConstraints(e,t,n){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(n),this.setValue(this.getValue())}getValue(){return Number(super.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);-1!==t.indexOf("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const n=t.indexOf(".");this.decimalPlaces=-1===n?e?0:null:t.length-n-1}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);return isNaN(t)?null:(t=Math.min(Math.max(t,this.min_),this.max_),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),null!==this.decimalPlaces&&(t=Number(t.toFixed(this.decimalPlaces))),t+"")}}n.FieldNumberDropdown=class extends r{constructor(e,t,n){super(e,t.data,t.min,t.max,t.precision,n),this.isFieldCustom_=!0}getOptions(){let e;return this.menuGenerator_&&("string"==typeof this.menuGenerator_&&(this.menuGenerator_=JSON.parse(this.menuGenerator_)),e=this.menuGenerator_.map((e=>"object"==typeof e?[pxt.Util.rlf(e[0]),e[1]]:[String(e),String(e)]))),e}}},{"./field_textdropdown":50}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldPosition=void 0;const i=e("blockly"),r=e("../plugins/math");class o extends r.FieldSlider{constructor(e,t,n){super(e,"0","100","1","1","Value",n),this.isFieldCustom_=!0,this.params=t,this.params.screenHeight||(this.params.screenHeight=120),this.params.screenWidth||(this.params.screenWidth=160),this.params.xInputName||(this.params.xInputName="x"),this.params.yInputName||(this.params.yInputName="y"),this.params.min&&(this.min_=parseInt(this.params.min)),this.params.max&&(this.max_=parseInt(this.params.max))}showEditor_(e){this.getFieldByName(this.params.xInputName)===this&&(this.max_=this.params.screenWidth,this.labelText_=this.params.xInputName),this.getFieldByName(this.params.yInputName)===this&&(this.max_=this.params.screenHeight,this.labelText_=this.params.yInputName),super.showEditor_(e),this.renderScreenPicker()}doValueUpdate_(e){super.doValueUpdate_(e),this.resetCrosshair&&this.resetCrosshair()}renderScreenPicker(){let e=i.DropDownDiv.getContentDiv();this.selectorDiv_=document.createElement("div"),this.selectorDiv_.className="blocklyCanvasOverlayOuter",e.appendChild(this.selectorDiv_);const t=document.createElement("div");t.className="blocklyCanvasOverlayDiv",this.selectorDiv_.appendChild(t);const n=document.createElement("div");n.className="cross-x",t.appendChild(n);const r=document.createElement("div");r.className="cross-y",t.appendChild(r);const o=document.createElement("div");o.className="label",t.appendChild(o);const s=1.5*this.params.screenWidth,a=1.5*this.params.screenHeight;t.style.height=a+"px",t.style.width=s+"px";const l=e.getElementsByClassName("goog-slider-horizontal")[0];if(l){l.style.width=s+"px";const e=Number(this.getValue());!isNaN(e)&&e>this.getMin()&&(this.setValue(e-1+""),this.setValue(e+""))}const c=(e,t)=>{e=Math.round(Math.max(0,Math.min(s,e))),t=Math.round(Math.max(0,Math.min(a,t))),n.style.top=t+"px",r.style.left=e+"px",e=Math.round(Math.max(0,Math.min(this.params.screenWidth,e/s*this.params.screenWidth))),t=Math.round(Math.max(0,Math.min(this.params.screenHeight,t/a*this.params.screenHeight))),isNaN(e)?o.textContent=`${this.params.yInputName}=${t}`:isNaN(t)?o.textContent=`${this.params.xInputName}=${e}`:o.textContent=`${this.params.xInputName}=${e} ${this.params.yInputName}=${t}`;const i=o.getBoundingClientRect();e>this.params.screenWidth/2?o.style.left=e*(s/this.params.screenWidth)-i.width-8+"px":o.style.left=e*(s/this.params.screenWidth)+4+"px",t>this.params.screenHeight/2?o.style.top=t*(a/this.params.screenHeight)-i.height-6+"px":o.style.top=t*(a/this.params.screenHeight)+"px"};this.resetCrosshair=()=>{const{currentX:e,currentY:t}=this.getXY();c(e/this.params.screenWidth*s,t/this.params.screenHeight*a)},this.resetCrosshair(),i.browserEvents.bind(this.selectorDiv_,"mousemove",this,(e=>{const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;c(i,r)})),i.browserEvents.bind(this.selectorDiv_,"mouseleave",this,this.resetCrosshair),i.browserEvents.bind(this.selectorDiv_,"click",this,(e=>{const n=t.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,o=Math.round(i/s*this.params.screenWidth),l=Math.round(r/a*this.params.screenHeight);this.close(),this.setXY(o,l)}))}resizeHandler(){this.close()}setXY(e,t){const n=this.getFieldByName(this.params.xInputName);n&&"number"==typeof n.getValue()&&n.setValue(String(e));const i=this.getFieldByName(this.params.yInputName);i&&"number"==typeof i.getValue()&&i.setValue(String(t))}getFieldByName(e){const t=this.sourceBlock_.getParent();if(t)for(let n=0;n<t.inputList.length;n++){const i=t.inputList[n];if(i.name===e)return this.getTargetField(i)}}getXY(){let e,t;const n=this.getFieldByName(this.params.xInputName);n&&(e=n.getValue());const i=this.getFieldByName(this.params.yInputName);return i&&(t=i.getValue()),{currentX:parseInt(e),currentY:parseInt(t)}}getTargetField(e){const t=e.connection.targetBlock();if(!t)return null;const n=t.inputList[0];return n?n.fieldRow[0]:null}widgetDispose_(){super.widgetDispose_(),this.close(!0)}close(e){e||(i.WidgetDiv.hideIfOwner(this),i.DropDownDiv.hideIfOwner(this)),window.removeEventListener("resize",this.resizeHandler),this.resetCrosshair=void 0,this.selectorDiv_&&(i.utils.dom.removeNode(this.selectorDiv_),this.selectorDiv_=void 0)}}n.FieldPosition=o},{"../plugins/math":101,blockly:376}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldProcedure=void 0;const i=e("./field_dropdown");class r extends i.FieldDropdown{constructor(e,t){super((function(){let e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){let t=this.sourceBlock_.workspace.getAllBlocks(!1);for(let n=0;n<t.length;n++)if(t[n].getProcedureDef){let i=t[n].getProcedureDef();e.push(i[0])}}let t=this.getValue();t&&-1==e.indexOf(t)&&e.push(t),e.sort(((e,t)=>{const n=e.toLowerCase(),i=t.toLowerCase();return n===i?0:n>i?1:-1})),e.length||e.push("Temp"),this.rawValue&&-1===e.indexOf(this.rawValue)&&e.push(this.rawValue);let n=[];for(let t=0;t<e.length;t++)n[t]=[e[t],e[t]];return n}),t),this.setValue(e||"")}getOptions(e){return this.menuGenerator_()}doClassValidation_(e){return void 0===e?null:e}doValueUpdate_(e){this.rawValue=e,super.doValueUpdate_(e)}init(){this.fieldGroup_||super.init.call(this)}setSourceBlock(e){pxt.Util.assert(!e.isShadow(),"Procedure fields are not allowed to exist on shadow blocks."),super.setSourceBlock.call(this,e)}}n.FieldProcedure=r},{"./field_dropdown":33}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldProtractor=void 0;const i=e("../plugins/math");class r extends i.FieldSlider{constructor(e,t,n){super(String(e),"0","180","1","15",lf("Angle"),n),this.isFieldCustom_=!0,this.params=t}createLabelDom_(e){const t=document.createElement("div");this.circleSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.circleSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.circleSVG),pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.circleSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"});const n=document.createElement("span");return n.setAttribute("class","blocklyFieldSliderReadout"),[t,n]}setReadout(e){this.updateAngle("string"==typeof e?parseFloat(e):e),this.reporter&&(this.reporter.textContent=`${e}`)}updateAngle(e){if(!this.circleBar)return;const t=(180-(e=Math.max(0,Math.min(180,e))))/180*Math.PI*90;this.circleBar.setAttribute("stroke-dashoffset",`${t}`)}}n.FieldProtractor=r},{"../plugins/math":101}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldSoundEffect=void 0;const i=e("blockly");var r=pxt.svgUtil;const o=e("./field_base"),s=e("./field_utils"),a=160,l=40;class c extends o.FieldBase{constructor(){super(...arguments),this.registeredChangeListener=!1,this.onWorkspaceChange=e=>{if(e.type!==i.Events.CHANGE)return;const t=this.sourceBlock_.workspace.getBlockById(e.blockId);!t||t!==this.sourceBlock_&&t.getParent()!==this.sourceBlock_||this.redrawPreview()}}onInit(){this.options||(this.options={}),this.options.durationInputName||(this.options.durationInputName="duration"),this.options.startFrequencyInputName||(this.options.startFrequencyInputName="startFrequency"),this.options.endFrequencyInputName||(this.options.endFrequencyInputName="endFrequency"),this.options.startVolumeInputName||(this.options.startVolumeInputName="startVolume"),this.options.endVolumeInputName||(this.options.endVolumeInputName="endVolume"),this.options.waveFieldName||(this.options.waveFieldName="waveShape"),this.options.interpolationFieldName||(this.options.interpolationFieldName="interpolation"),this.options.effectFieldName||(this.options.effectFieldName="effect"),this.options.useMixerSynthesizer||(this.options.useMixerSynthesizer=!1),this.redrawPreview(),this.sourceBlock_.workspace&&(this.workspace=this.sourceBlock_.workspace,this.sourceBlock_.isShadow()||this.sourceBlock_.isInsertionMarker()||(this.registeredChangeListener=!0,this.workspace.addChangeListener(this.onWorkspaceChange)))}onDispose(){this.workspace&&this.registeredChangeListener&&(this.workspace.removeChangeListener(this.onWorkspaceChange),this.registeredChangeListener=!1)}onValueChanged(e){return e}redrawPreview(){if(!this.fieldGroup_)return;if(this.drawnSound){const e=this.readCurrentSound();if(e.startFrequency===this.drawnSound.startFrequency&&e.endFrequency===this.drawnSound.endFrequency&&e.startVolume===this.drawnSound.startVolume&&e.endVolume===this.drawnSound.endVolume&&e.wave===this.drawnSound.wave&&e.interpolation===this.drawnSound.interpolation)return}pxsim.U.clear(this.fieldGroup_);const e=(new r.Rect).at(5,4).size(a,l).setClass("blocklySpriteField").stroke("#fff",1).fill("#dedede").corner(20),t="preview-clip-"+pxt.U.guidGen(),n=(new r.ClipPath).id(t).clipPathUnits(!1),i=(new r.Rect).size(115,l).fill("#FFF").at(0,0);n.appendChild(i),this.drawnSound=this.readCurrentSound();const o=(new r.Path).stroke("grey",2).fill("none").setD(pxt.assets.renderSoundPath(this.drawnSound,120,32)).clipPath("url('#"+t+"')"),s=(new r.Group).translate(35,7);s.appendChild(n),s.appendChild(o);const c=new r.Text("").appendClass("melody-editor-field-icon").setAttribute("alignment-baseline","middle").anchor("middle").at(20,24);this.fieldGroup_.appendChild(e.el),this.fieldGroup_.appendChild(c.el),this.fieldGroup_.appendChild(s.el)}showEditor_(){const e=this.readCurrentSound();let t;i.Events.disable();let n={getScaledBBox:()=>t};i.WidgetDiv.show(n,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),r.classList.remove("sound-effect-editor-widget"),r.style.transform="",r.style.position="",r.style.left="",r.style.top="",r.style.width="",r.style.height="",r.style.opacity="",r.style.transition="",r.style.alignItems="",i.Events.enable(),i.Events.setGroup(!0),this.fireNumberInputUpdate(this.options.durationInputName,e.duration),this.fireNumberInputUpdate(this.options.startFrequencyInputName,e.startFrequency),this.fireNumberInputUpdate(this.options.endFrequencyInputName,e.endFrequency),this.fireNumberInputUpdate(this.options.startVolumeInputName,e.startVolume),this.fireNumberInputUpdate(this.options.endVolumeInputName,e.endVolume),this.fireFieldDropdownUpdate(this.options.waveFieldName,u[e.wave]),this.fireFieldDropdownUpdate(this.options.interpolationFieldName,h[e.interpolation]),this.fireFieldDropdownUpdate(this.options.effectFieldName,d[e.effect]),i.Events.setGroup(!1),this.mostRecentValue&&this.setBlockData(JSON.stringify(this.mostRecentValue))}));const r=i.WidgetDiv.getDiv(),o={onClose:()=>{a.hide(),i.WidgetDiv.hideIfOwner(n)},onSoundChange:e=>{this.mostRecentValue=e,this.updateSiblingBlocks(e),this.redrawPreview()},initialSound:e,useMixerSynthesizer:f(this.options.useMixerSynthesizer)},a=pxt.react.getFieldEditorView("soundeffect-editor",e,o,r),l=this.sourceBlock_,c=l.getBoundingRectangle(),p=(0,s.workspaceToScreenCoordinates)(l.workspace,new i.utils.Coordinate(c.right,c.top)),g=p.x+20,m=p.y-20;r.style.opacity="0",r.classList.add("sound-effect-editor-widget"),r.style.position="absolute",r.style.left=g+"px",r.style.top=m+"px",r.style.width="30rem",r.style.height="40rem",r.style.display="flex",r.style.alignItems="center",r.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",r.style.borderRadius="",a.onHide((()=>{})),a.show();const b=r.getBoundingClientRect(),y=l.workspace.getInjectionDiv().getBoundingClientRect();b.height>y.height?(r.style.height="",r.style.top="calc(1rem - 20px)",r.style.bottom="calc(1rem + 20px)"):(b.bottom>y.bottom||b.top<y.top)&&(r.style.top=y.top+y.height/2-b.height/2-20+"px");const v=l.workspace.getToolbox().getWidth();if(b.width>y.width-v)r.style.width="",r.style.left="1rem",r.style.right="1rem";else if(b.left+b.width>=y.right){const e=(0,s.workspaceToScreenCoordinates)(l.workspace,new i.utils.Coordinate(c.left,c.top)),t=y.left+v;e.x-b.width-20>t?r.style.left=e.x-b.width-20+"px":r.style.left=t+(y.width-v)/2-b.width/2+"px"}const _=r.getBoundingClientRect();t=new i.utils.Rect(_.top,_.bottom,_.left,_.right),requestAnimationFrame((()=>{r.style.opacity="1",r.style.transform="translateY(20px)"}))}render_(){super.render_(),this.size_.height=48,this.size_.width=165}updateSiblingBlocks(e){this.setNumberInputValue(this.options.durationInputName,e.duration),this.setNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),this.setNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),this.setNumberInputValue(this.options.startVolumeInputName,e.startVolume),this.setNumberInputValue(this.options.endVolumeInputName,e.endVolume),this.setFieldDropdownValue(this.options.waveFieldName,u[e.wave]),this.setFieldDropdownValue(this.options.interpolationFieldName,h[e.interpolation]),this.setFieldDropdownValue(this.options.effectFieldName,d[e.effect])}setNumberInputValue(e,t){const n=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);n&&("math_number"===n.type||"math_integer"===n.type||"math_whole_number"===n.type?n.setFieldValue(Math.round(t),"NUM"):"math_number_minmax"===n.type&&n.setFieldValue(Math.round(t),"SLIDER"))}getNumberInputValue(e,t){const n=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);return n?"math_number"===n.type||"math_integer"===n.type||"math_whole_number"===n.type?parseInt(n.getFieldValue("NUM")+""):"math_number_minmax"===n.type?parseInt(n.getFieldValue("SLIDER")+""):t:t}fireNumberInputUpdate(e,t){const n=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);if(!n)return;let r;"math_number"===n.type||"math_integer"===n.type||"math_whole_number"===n.type?r="NUM":"math_number_minmax"===n.type&&(r="SLIDER"),r&&i.Events.fire(new i.Events.BlockChange(n,"field",r,t,this.getNumberInputValue(e,t)))}setFieldDropdownValue(e,t){const n=this.getSiblingField(e)||this.getSiblingField(e,!0);n&&n.setValue(t)}getFieldDropdownValue(e){const t=this.getSiblingField(e)||this.getSiblingField(e,!0);if(t)return t.getValue()}fireFieldDropdownUpdate(e,t){const n=this.getSiblingField(e)||this.getSiblingField(e,!0);n&&i.Events.fire(new i.Events.BlockChange(n.getSourceBlock(),"field",n.name,t,this.getFieldDropdownValue(e)))}readCurrentSound(){const e=this.readBlockDataSound();return{duration:this.getNumberInputValue(this.options.durationInputName,e.duration),startFrequency:this.getNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),endFrequency:this.getNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),startVolume:this.getNumberInputValue(this.options.startVolumeInputName,e.startVolume),endVolume:this.getNumberInputValue(this.options.endVolumeInputName,e.endVolume),wave:p(u,this.getFieldDropdownValue(this.options.waveFieldName))||e.wave,interpolation:p(h,this.getFieldDropdownValue(this.options.interpolationFieldName))||e.interpolation,effect:p(d,this.getFieldDropdownValue(this.options.effectFieldName))||e.effect}}readBlockDataSound(){const e=this.getBlockData();let t;try{t=JSON.parse(e)}catch(e){t={duration:1e3,startFrequency:100,endFrequency:4800,startVolume:100,endVolume:0,wave:"sine",interpolation:"linear",effect:"none"}}return t}}n.FieldSoundEffect=c;const u={sine:"WaveShape.Sine",square:"WaveShape.Square",sawtooth:"WaveShape.Sawtooth",triangle:"WaveShape.Triangle",noise:"WaveShape.Noise"},d={none:"SoundExpressionEffect.None",vibrato:"SoundExpressionEffect.Vibrato",tremolo:"SoundExpressionEffect.Tremolo",warble:"SoundExpressionEffect.Warble"},h={linear:"InterpolationCurve.Linear",curve:"InterpolationCurve.Curve",logarithmic:"InterpolationCurve.Logarithmic"};function p(e,t){return Object.keys(e).find((n=>e[n]===t))}function f(e){if(!e)return!1;if("string"==typeof e)switch(e.toLowerCase().trim()){case"1":case"yes":case"y":case"on":case"true":return!0;default:return!1}return!!e}},{"./field_base":30,"./field_utils":64,blockly:376}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldSpeed=void 0;const i=e("../plugins/math");class r extends i.FieldSlider{constructor(e,t,n){super(String(e),"-100","100","1","10","Speed",n),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.format||(this.params.format="{0}%")}createLabelDom_(e){const t=document.createElement("div");this.speedSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.speedSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.speedSVG),pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.speedSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:`font-size: ${Math.max(14,50-5*(this.params.format.length-4))}px`,class:"sim-text inverted number"});const n=document.createElement("span");return n.setAttribute("class","blocklyFieldSliderReadout"),[t,n]}setReadout(e){this.updateSpeed("string"==typeof e?parseFloat(e):e),this.params&&this.reporter&&(this.reporter.textContent=ts.pxtc.U.rlf(this.params.format,e))}updateSpeed(e){if(!this.circleBar)return;let t=this.sign(e);e=Math.abs(e)/100*50+50,-1==t&&(e=50-e);let n=(100-e)/100*(180*Math.PI);this.circleBar.setAttribute("stroke-dashoffset",`${n}`)}sign(e){return e?e<0?-1:1:0}}n.FieldSpeed=r},{"../plugins/math":101}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldSpriteEditor=void 0;const i=e("./field_asset");class r extends i.FieldAssetEditor{getAssetType(){return"image"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const n=pxt.lookupProjectAssetByTSReference(e,t);if(n)return n}if(this.getBlockData())return t.lookupAsset("image",this.getBlockData());const n=e?pxt.sprite.imageLiteralToBitmap(e,this.params.taggedTemplate):new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight);let i;if(!n){if(!(i=o(e)))return this.isGreyBlock=!0,void(this.valueText=e);this.qName=e}return i||(i=n.data()),{internalID:-1,id:this.sourceBlock_.id,type:"image",jresData:pxt.sprite.base64EncodeBitmap(i),meta:{},bitmap:i}}getValueText(){if(!this.asset)return this.valueText||"";if(this.asset&&!this.isTemporaryAsset())return pxt.getTSReferenceForAsset(this.asset);if(this.qName){const e=o(this.qName);if(e&&pxt.sprite.bitmapEquals(e,this.asset.bitmap))return this.qName}return pxt.sprite.bitmapToImageLiteral(this.asset&&pxt.sprite.Bitmap.fromData(this.asset.bitmap),"typescript",this.params.taggedTemplate)}parseFieldOptions(e){return function(e){const t={initColor:1,initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.sizes){const n=e.sizes.split(";"),i=[];for(let e=0;e<n.length;e++){const t=n[e].split(",");if(2!==t.length)continue;let r=parseInt(t[0]),o=parseInt(t[1]);if(isNaN(r)||isNaN(o))continue;const s=pxt.appTarget.runtime&&pxt.appTarget.runtime.screenSize;r<0&&s&&(r=s.width),o<0&&s&&(o=s.height),i.push([r,o])}i.length>0&&(t.initWidth=i[0][0],t.initHeight=i[0][1])}return e.filter&&(t.filter=e.filter),e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initColor=n(e.initColor,t.initColor),t.initWidth=n(e.initWidth,t.initWidth),t.initHeight=n(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t;function n(e,t){const n=parseInt(e);return isNaN(n)?t:n}}(e)}}function o(e){const t=pxt.react.getTilemapProject().getGalleryAssets("image").filter((t=>t.id===e)),n=t.length&&t[0];if(n)return n.bitmap}n.FieldSpriteEditor=r},{"./field_asset":28}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldStyledLabel=void 0;const i=e("blockly");class r extends i.FieldLabel{constructor(e,t,n){super(e,function(e){if(e){if(e.bold&&e.italics)return"blocklyBoldItalicizedText";if(e.bold)return"blocklyBoldText";if(e.italics)return"blocklyItalicizedText"}}(t)),this.isFieldCustom_=!0}}n.FieldStyledLabel=r},{blockly:376}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTextDropdown=n.BaseFieldTextDropdown=void 0;const i=e("blockly");class r extends i.FieldTextInput{constructor(e,t,n){super(e,n),this.menuGenerator_=t,this.selectedMenuItem=null,this.menu_=null,this.svgArrow=null,this.generatedOptions=null}initView(){super.initView(),this.createSVGArrow()}showEditor_(e,t){super.showEditor_(e,t),this.dropDownOpen_||this.showDropdown_(),i.Touch.clearTouchIdentifier()}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)?"string"!=typeof i[1]?(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option id must be a string. Found "+i[1]+" in: ",i)):i[0]&&"string"!=typeof i[0]&&"string"!=typeof i[0].src&&(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must have a string label or image description. Found"+i[0]+" in: ",i)):(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must be an array. Found: ",i))}if(t)throw TypeError("Found invalid FieldDropdown options.")}(this.generatedOptions),this.generatedOptions)}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}dropdownDispose_(){this.dropDownOpen_=!1,this.menu_&&this.menu_.dispose(),this.menu_=null,this.selectedMenuItem=null,this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new i.UnattachedFieldError;const t=new i.Menu;t.setRole(i.utils.aria.Role.LISTBOX),this.menu_=t;const n=this.getOptions(!1);this.selectedMenuItem=null;for(let r=0;r<n.length;r++){const[o,s]=n[r],a=(()=>{if("object"==typeof o){const e=new Image(o.width,o.height);return e.src=o.src,e.alt=o.alt||"",e}return o})(),l=new i.MenuItem(a,s);l.setRole(i.utils.aria.Role.OPTION),l.setRightToLeft(e.RTL),l.setCheckable(!0),t.addChild(l),l.setChecked(s===this.value_),s===this.value_&&(this.selectedMenuItem=l),l.onAction(this.handleMenuActionEvent,this)}}showDropdown_(e){const t=this.getSourceBlock();if(!t)throw new i.UnattachedFieldError;this.dropdownCreate(),e&&"number"==typeof e.clientX?this.menu_.openingCoords=new i.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,i.DropDownDiv.clearContent();const n=this.menu_.render(i.DropDownDiv.getContentDiv());i.utils.dom.addClass(n,"blocklyDropdownMenu");const r=t.getParent(),o=(r||t).getColour(),s=(r||t).style.colourTertiary;i.DropDownDiv.setColour(o,s),this.dropDownOpen_=!0,i.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),i.utils.style.scrollIntoContainerView(this.selectedMenuItem.getElement(),i.DropDownDiv.getContentDiv(),!0)),this.applyColour()}updateSize_(e){super.updateSize_(e);const t=this.positionSVGArrow(this.size_.width,this.size_.height/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2);this.size_.width+=t}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const n=this.getSourceBlock();if(!n)throw new i.UnattachedFieldError;const r=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,s=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE,a=n.RTL?r:e+o;return this.svgArrow.setAttribute("transform","translate("+a+","+t+")"),s+o}createSVGArrow(){this.svgArrow=i.utils.dom.createSvgElement("image",{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(i.utils.dom.XLINK_NS,"xlink:href",o.DROPDOWN_SVG_DATAURI)}handleMenuActionEvent(e){i.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue()),i.WidgetDiv.hideIfOwner(this)}}n.BaseFieldTextDropdown=r,r.DROPDOWN_SVG_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiM1NzVFNzUiLz48L3N2Zz4K";class o extends r{constructor(e,t,n){super(e,t.values,n),this.isFieldCustom_=!0}}n.FieldTextDropdown=o},{blockly:376}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTextInput=void 0;const i=e("blockly");class r extends i.FieldTextInput{constructor(e,t,n){super(e,n),this.isFieldCustom_=!0}}n.FieldTextInput=r},{blockly:376}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTilemap=void 0;const i=e("./field_asset");class r extends i.FieldAssetEditor{getInitText(){return this.initText}getTileset(){var e;return null===(e=this.asset)||void 0===e?void 0:e.data.tileset}getAssetType(){return"tilemap"}createNewAsset(e=""){var t;e&&(e=e.replace(/&#96;/g,"`"));const n=pxt.react.getTilemapProject(),i=pxt.lookupProjectAssetByTSReference(e,n);if(i)return i;if(null===(t=this.sourceBlock_)||void 0===t?void 0:t.isInFlyout)return;const r=pxt.sprite.decodeTilemap(e,"typescript",n)||n.blankTilemap(this.params.tileWidth,this.params.initWidth,this.params.initHeight);let o;if(function(e){return!!(e&&e.tilemap&&e.tilemap.width&&e.tilemap.height&&e.layers&&e.layers.width===e.tilemap.width&&e.layers.height===e.tilemap.height&&e.tileset)}(r)){this.initText=e,this.isGreyBlock=!1;const[t]=n.createNewTilemapFromData(r);o=n.getTilemap(t)}else e.trim()&&(this.isGreyBlock=!0,this.valueText=e);return o}onEditorClose(e){pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),e)}getValueText(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.asset?pxt.getTSReferenceForAsset(this.asset):this.initText?this.getInitText():this.valueText||""}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,tileWidth:16,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),e.tileWidth)if("number"==typeof e.tileWidth)switch(e.tileWidth){case 4:t.tileWidth=4;break;case 8:t.tileWidth=8;break;case 16:t.tileWidth=16;break;case 32:t.tileWidth=32}else switch(e.tileWidth.trim().toLowerCase()){case"4":case"four":t.tileWidth=4;break;case"8":case"eight":t.tileWidth=8;break;case"16":case"sixteen":t.tileWidth=16;break;case"32":case"thirtytwo":t.tileWidth=32}return t.initWidth=n(e.initWidth,t.initWidth),t.initHeight=n(e.initHeight,t.initHeight),t;function n(e,t){const n=parseInt(e);return isNaN(n)?t:n}}(e)}}n.FieldTilemap=r},{"./field_asset":28}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTileset=void 0;const i=e("./field_images"),r=e("./field_utils"),o=32;class s extends i.FieldImages{constructor(e,t,n){super(e,t,n),this.isFieldCustom_=!0,this.menuGenerator_=()=>{var e,t;return(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&(0,r.needsTilemapUpgrade)(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)?[a()]:s.getReferencedTiles(this.sourceBlock_.workspace)},this.assetChangeListener=()=>{this.doValueUpdate_(this.getValue()),this.forceRerender()},this.blocksInfo=t.blocksInfo}static getReferencedTiles(e){const t=pxt.react.getTilemapProject();if(t.revision()!==s.cachedRevision||e.id!=s.cachedWorkspaceId){s.cachedRevision=t.revision(),s.cachedWorkspaceId=e.id;const n=(0,r.getAllReferencedTiles)(e),i=[16,4,8,32];for(const e of i){const i=t.getProjectTiles(e,16===e);if(i)for(const e of i.tiles)n.find((t=>t.id===e.id))||n.push(e)}let a={};n.sort(((e,t)=>e.id===t.id?0:e.bitmap.width!==t.bitmap.width?e.bitmap.width-t.bitmap.width:e.isProjectTile!==t.isProjectTile?e.isProjectTile?-1:1:(a[e.id]||(a[e.id]=c(e.id)))-(a[t.id]||(a[t.id]=c(t.id)))));const d=e=>c(e.id)<=2?l(e.bitmap.width):(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1);s.referencedTiles=n.map((e=>[{src:d(e),width:o,height:o,alt:u(e)},e.id,e]))}return s.referencedTiles}initView(){super.initView(),this.sourceBlock_&&this.sourceBlock_.isInFlyout&&this.setValue(this.getOptions()[0][1])}getValue(){if(this.selectedOption_){let e=this.selectedOption_[2];return(e=pxt.react.getTilemapProject().lookupAsset(e.type,e.id))?pxt.getTSReferenceForAsset(e):super.getValue()}const e=super.getValue();return"string"==typeof e&&-1===e.indexOf(".")&&-1===e.indexOf("`")?`img\`${e}\``:e}getText(){const e=this.getValue();return"string"==typeof e&&-1!==e.indexOf("`")?e:super.getText()}render_(){if(this.value_&&this.selectedOption_&&this.selectedOption_[1]!==this.value_){const e=pxt.react.getTilemapProject().resolveTile(this.value_);s.cachedRevision=-1,e&&(this.selectedOption_=[{src:(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1),width:o,height:o,alt:u(e)},this.value_,e])}super.render_()}doValueUpdate_(e){let t=!1;const n=this.getOptions(!0);if(e){const i=pxt.parseAssetTSReference(e);i&&(e=i.name),e=e.trim();for(const i of n)if(e===i[2].id||e===i[2].meta.displayName||e===pxt.getShortIDForAsset(i[2]))return this.selectedOption_=i,this.value_=this.getValue(),this.updateAssetListener(),super.doValueUpdate_(i[1]),void(t=!0);t||super.doValueUpdate_(e),this.selectedOption_=null,this.updateAssetListener()}}doClassValidation_(e){if(!this.getOptions(!0).some((([t,n])=>n===e))){if(e){const t=pxt.react.getTilemapProject(),n=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(e);if(n){const i=t.lookupAssetByName("tile",n[1]);if(i)return this.localTile=i,e}}return this.sourceBlock_&&console.warn(`Trying to set tile reference to nonexistent tile. Block type: ${this.sourceBlock_.type}, Field name: ${this.name}, Value: ${e}`),null}return e}getOptions(e){if("function"!=typeof this.menuGenerator_){this.transparent=a();const e=[this.transparent];return this.localTile&&e.push([{src:(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.localTile.bitmap),o,!1),width:o,height:o,alt:u(this.localTile)},this.localTile.id,this.localTile]),e}return this.menuGenerator_.call(this)}dispose(){super.dispose(),pxt.react.getTilemapProject().removeChangeListener("tile",this.assetChangeListener)}updateAssetListener(){const e=pxt.react.getTilemapProject();e.removeChangeListener("tile",this.assetChangeListener),this.selectedOption_&&e.addChangeListener(this.selectedOption_[2],this.assetChangeListener)}}function a(){const e=pxt.react.getTilemapProject().getTransparency(16);return[{src:l(16),width:o,height:o,alt:pxt.U.lf("transparency")},e.id,e]}function l(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e,t.height=e,n.fillStyle="#aeaeae",n.fillRect(0,0,e,e),n.fillStyle="#dedede";for(let t=0;t<e;t+=4)for(let i=0;i<e;i+=4)t+i>>2&1&&n.fillRect(t,i,4,4);return t.toDataURL()}function c(e){switch(e){case"myTiles.transparency16":return 1;case"myTiles.transparency4":case"myTiles.transparency8":case"myTiles.transparency32":return 2;default:if(e.startsWith("myTiles.tile")){const t=parseInt(e.slice(12));if(!Number.isNaN(t))return t+2}return 9999999999}}function u(e){return e.meta.displayName||pxt.getShortIDForAsset(e)}n.FieldTileset=s},{"./field_images":36,"./field_utils":64}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggle=n.BaseFieldToggle=void 0;const i=e("blockly"),r=e("../constants");class o extends i.FieldNumber{constructor(e,t,n,i,r){super(e,void 0,void 0,void 0,r),this.trueText=n,this.falseText=i,this.isFieldCustom_=!0,this.CURSOR="pointer",this.params=t,this.setValue(e),this.type_=t.type}initView(){if(!this.fieldGroup_)return;this.clickTarget_=this.sourceBlock_.getSvgRoot(),!this.sourceBlock_.isShadow()&&this.sourceBlock_.inputList&&this.sourceBlock_.inputList.length>1&&(this.borderRect_=i.utils.dom.createSvgElement("rect",{rx:this.getConstants().CORNER_RADIUS,ry:this.getConstants().CORNER_RADIUS,x:0,y:0,width:this.size_.width,height:this.size_.height,fill:this.sourceBlock_.getColour(),stroke:this.sourceBlock_.getColourTertiary()},null),this.fieldGroup_.insertBefore(this.borderRect_,this.textElement_));const e=this.getSize();switch(this.checkElement_=i.utils.dom.createSvgElement("g",{class:"blocklyToggle "+(this.state_?"blocklyToggleOn":"blocklyToggleOff"),transform:`translate(8, ${e.height/2})`},this.fieldGroup_),this.getOutputShape()){case r.provider.SHAPES.HEXAGONAL:this.toggleThumb_=i.utils.dom.createSvgElement("polygon",{class:"blocklyToggleRect",points:"-7,-14 -21,0 -7,14 7,14 21,0 7,-14",cursor:"pointer"},this.checkElement_);break;case r.provider.SHAPES.ROUND:this.toggleThumb_=i.utils.dom.createSvgElement("rect",{class:"blocklyToggleCircle",x:-6,y:-14,height:28,width:28,rx:14,ry:14,cursor:"pointer"},this.checkElement_);break;case r.provider.SHAPES.SQUARE:this.toggleThumb_=i.utils.dom.createSvgElement("rect",{class:"blocklyToggleRect",x:-6,y:-14,height:28,width:28,rx:3,ry:3,cursor:"pointer"},this.checkElement_)}let t=this.sourceBlock_.RTL?-e.width/2:e.width/2;this.textElement_=i.utils.dom.createSvgElement("text",{class:"blocklyText",x:t,dy:"0.6ex",y:e.height/2},this.fieldGroup_),this.updateEditable(),this.switchToggle(this.state_),this.setValue(this.getValue()),this.markDirty()}getDisplayText_(){return this.state_?this.getTrueText():this.getFalseText()}getTrueText(){return this.trueText}getFalseText(){return this.falseText}updateSize_(){switch(this.getOutputShape()){case r.provider.SHAPES.ROUND:this.size_.width=2*this.getInnerWidth()-7;break;case r.provider.SHAPES.HEXAGONAL:this.size_.width=2*this.getInnerWidth()+8-Math.floor(this.getInnerWidth()/2);break;case r.provider.SHAPES.SQUARE:this.size_.width=9+2*this.getInnerWidth()}}getInnerWidth(){return 10*this.getMaxLength()}getMaxLength(){return Math.max(this.getTrueText().length,this.getFalseText().length)}getOutputShape(){return this.sourceBlock_.isShadow()?this.sourceBlock_.getOutputShape():r.provider.SHAPES.SQUARE}doClassValidation_(e){return"boolean"==typeof this.fromVal(e)?e:"false"}applyColour(){let e=this.sourceBlock_.getColourTertiary();this.borderRect_?this.borderRect_.setAttribute("stroke",e):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e)}getValue(){return this.toVal(this.state_)}doValueUpdate_(e){let t=this.fromVal(e);this.state_!==t&&(this.sourceBlock_&&i.Events.isEnabled()&&i.Events.fire(new i.Events.BlockChange(this.sourceBlock_,"field",this.name,this.state_,t)),this.state_=t,this.switchToggle(this.state_),this.isDirty_=!0)}switchToggle(e){if(this.checkElement_){this.updateSize_();const t=this.getSize(),n=this.getInnerWidth();e?(pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOff")):(pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOff"));const i=this.getOutputShape();let o=0,s=0,a=0,l=0;switch(i){case r.provider.SHAPES.HEXAGONAL:a=-(s=(o=t.width/2)/2),l=s-n,this.toggleThumb_.setAttribute("points",`0,-14 -14,0 0,14 ${o},14 ${o+14},0 ${o},-14`);break;case r.provider.SHAPES.ROUND:case r.provider.SHAPES.SQUARE:s=(o=5+n)/2,this.toggleThumb_.setAttribute("width",""+o),this.toggleThumb_.setAttribute("x",`-${s}`),a=l=i==r.provider.SHAPES.SQUARE?2:-6}this.checkElement_.setAttribute("transform",`translate(${e?l+n+s:s+a}, ${t.height/2})`)}}render_(){if(this.visible_&&this.textElement_){for(;this.textElement_.firstChild;)this.textElement_.firstChild.remove();let e=document.createTextNode(this.getDisplayText_());this.textElement_.appendChild(e),pxt.BrowserUtils.addClass(this.textElement_,"blocklyToggleText"),this.updateSize_();let t=this.size_.width,n=(this.state_?t+t/8:t/2)-t/2;this.textElement_.setAttribute("x",`${n}`)}this.borderRect_&&(this.borderRect_.setAttribute("width",`${this.size_.width}`),this.borderRect_.setAttribute("height",`${this.size_.height}`))}showEditor_(){let e=!this.state_;null!==e&&this.setValue(this.toVal(e))}toVal(e){return"number"==this.type_?String(e?"1":"0"):String(e?"true":"false")}fromVal(e){return"string"==typeof e?"1"==e||"TRUE"==e.toUpperCase():!!e}}n.BaseFieldToggle=o;n.FieldToggle=class extends o{constructor(e,t,n){super(e,t,lf("True"),lf("False"),n)}}},{"../constants":18,blockly:376}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleDownUp=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("DOWN"),lf("UP"),n)}}n.FieldToggleDownUp=r},{"./field_toggle":54}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleHighLow=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("HIGH"),lf("LOW"),n)}}n.FieldToggleHighLow=r},{"./field_toggle":54}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleOnOff=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("ON"),lf("OFF"),n)}}n.FieldToggleOnOff=r},{"./field_toggle":54}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleUpDown=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("UP"),lf("DOWN"),n)}}n.FieldToggleUpDown=r},{"./field_toggle":54}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleWinLose=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("WIN"),lf("LOSE"),n)}}n.FieldToggleWinLose=r},{"./field_toggle":54}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldToggleYesNo=void 0;const i=e("./field_toggle");class r extends i.BaseFieldToggle{constructor(e,t,n){super(e,t,lf("Yes"),lf("No"),n)}}n.FieldToggleYesNo=r},{"./field_toggle":54}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTsExpression=void 0;const i=e("blockly");class r extends i.FieldTextInput{constructor(){super(...arguments),this.isFieldCustom_=!0,this.pythonMode=!1}updateEditable(){let e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(pxt.BrowserUtils.addClass(e,"blocklyEditableText"),pxt.BrowserUtils.removeClass(e,"blocklyGreyExpressionBlockText"),this.fieldGroup_.style.cursor=this.CURSOR):(pxt.BrowserUtils.addClass(e,"blocklyGreyExpressionBlockText"),pxt.BrowserUtils.removeClass(e,"blocklyEditableText"),this.fieldGroup_.style.cursor=""))}setPythonEnabled(e){e!==this.pythonMode&&(this.pythonMode=e,this.forceRerender())}getText(){return this.pythonMode?pxt.Util.lf("<python code>"):this.getValue()}applyColour(){var e;this.sourceBlock_&&(null===(e=this.getConstants())||void 0===e?void 0:e.FULL_BLOCK_FIELDS)&&this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourPrimary),this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourPrimary))}}n.FieldTsExpression=r},{blockly:376}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldTurnRatio=void 0;const i=e("blockly"),r=e("../plugins/math");class o extends r.FieldSlider{constructor(e,t,n){super(String(e),"-200","200","1","10","TurnRatio",n),this.isFieldCustom_=!0,this.params=t,this.sliderColor_="#a8aaa8"}createLabelDom_(e){let t=document.createElement("div"),n=i.utils.dom.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",height:o.HALF+o.HANDLE_RADIUS+10+"px",width:2*o.HALF+"px"},t),r=i.utils.dom.createSvgElement("defs",{},n),s=i.utils.dom.createSvgElement("marker",{id:"head",orient:"auto",markerWidth:"2",markerHeight:"4",refX:"0.1",refY:"1.5"},r);i.utils.dom.createSvgElement("path",{d:"M0,0 V3 L1.5,1.5 Z",fill:"#f12a21"},s),this.reporter_=pxsim.svg.child(n,"text",{x:o.HALF,y:96,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"}),this.path_=i.utils.dom.createSvgElement("path",{x1:o.HALF,y1:o.HALF,"marker-end":"url(#head)",style:"fill: none; stroke: #f12a21; stroke-width: 10"},n),this.updateGraph_();let a=document.createElement("span");return a.setAttribute("class","blocklyFieldSliderReadout"),[t,a]}updateGraph_(){if(!this.path_)return;let e=Math.min(Math.max(Number(this.getValue())||0,-200),200);const t=e/100,n=Math.max(-1,Math.min(1,t)),i=Math.max(n)*Math.PI/2,r=o.RADIUS-6;let s=o.HALF;const a=o.HALF-22;Math.abs(t)>1&&(s-=(t-(t>0?1:-1))*r/2);const l=.2+.5*Math.abs(n),c=r*l,u=r*Math.sin(Math.PI/2-i),d=r*Math.cos(Math.PI/2-i),h=u-r*l*Math.cos(2*i),p=`M ${s} ${a} C ${s} ${a-c} ${s+(d-r*l*Math.sin(2*i))} ${a-h} ${s+d} ${a-u}`;this.path_.setAttribute("d",p),this.reporter_.textContent=`${e}`}setReadout(e){this.updateGraph_()}}n.FieldTurnRatio=o,o.HALF=80,o.HANDLE_RADIUS=30,o.RADIUS=o.HALF-o.HANDLE_RADIUS-1},{"../plugins/math":101,blockly:376}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getNextValue=n.FieldUserEnum=void 0;const i=e("blockly"),r=e("../external"),o=e("./field_dropdown");class s extends o.FieldDropdown{constructor(e){super(function(e){return function(){const t=[];return this.sourceBlock_&&this.sourceBlock_.workspace?this.sourceBlock_.workspace.getVariablesOfType(e.name).forEach((e=>{const n=e.name.replace(/^\d+/,"");t.push([n,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t}}(e)),this.opts=e}init(){super.init(),this.initVariables()}onItemSelected_(e,t){"CREATE"===t.getValue()?a(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e))):super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=c(e,this.opts.name);if(this.opts.initialMembers.forEach((n=>{t.some((([e,t])=>e===n))||d(e,this.opts,n)})),"CREATE"===this.getValue()){const t=function(e,t,n){const i=e.getVariablesOfType(t);if(i&&i.length)for(let e=0;e<i.length;e++){const[t]=l(i[e]);if(t===n)return i[e].name}}(e,this.opts.name,this.opts.initialMembers[0]);t&&this.setValue(t)}}}}function a(e,t,n,o){(0,r.prompt)(n,null,(r=>{if(r){let s=!1;if(pxtc.isIdentifierStart(r.charCodeAt(0),2)){s=!0;for(let e=1;e<r.length;e++)pxtc.isIdentifierPart(r.charCodeAt(e),2)||(s=!1)}if(!s)return void i.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>a(e,t,n,o)));const l=c(e,t.name);for(let s=0;s<l.length;s++){const[c,u]=l[s];if(c===r)return void i.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,r),(()=>a(e,t,n,o)))}o(d(e,t,r))}}),{placeholder:t.promptHint})}function l(e){const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}function c(e,t){const n=e.getVariablesOfType(t);return n&&n.length?n.map(l):[]}function u(e,t){const n=e.map((([e,t])=>t));if(t.isBitMask){for(let e=0;e<n.length;e++){let t=1<<e;if(n.indexOf(t)<0)return t}return 1<<n.length}if(t.isHash)return 0;{const e=t.firstValue||0;for(let t=0;t<n.length;t++)if(n.indexOf(e+t)<0)return e+t;return e+n.length}}function d(e,t,n){const r=u(c(e,t.name),t)+n;return i.Variables.getOrCreateVariablePackage(e,null,r,t.name),r}n.FieldUserEnum=s,n.getNextValue=u},{"../external":24,"./field_dropdown":33,blockly:376}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getBlockDataForField=n.setBlockDataForField=n.setBlockData=n.getBlockData=n.workspaceToScreenCoordinates=n.setMelodyEditorOpen=n.FieldEditorOpenEvent=n.FIELD_EDITOR_OPEN_EVENT_TYPE=n.getTemporaryAssets=n.getTilesReferencedByTilesets=n.getAllReferencedTiles=n.getAllFields=n.upgradeTilemapsInWorkspace=n.needsTilemapUpgrade=n.getAllBlocksWithTilesets=n.getAllBlocksWithTilemaps=n.songToDataURI=n.tilemapToImageURI=n.bitmapToImageURI=n.parseColour=n.svg=void 0;const i=e("blockly"),r=e("./field_tilemap"),o=e("./field_animation"),s=e("./field_musiceditor"),a=e("./field_sprite"),l=e("./field_tileset");var c;function u(e,t){const n=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE);for(const i of n)if(parseInt(i.name.substr(0,i.name.indexOf(";")))===t.projectId){e.deleteVariableById(i.getId());break}}function d(e){return p(e,(e=>e instanceof r.FieldTilemap&&!e.isGreyBlock))}function h(e){return p(e,(e=>e instanceof l.FieldTileset))}function p(e,t){const n=[];return e.getTopBlocks(!1).forEach((e=>function e(i){for(const r of i.inputList){for(const e of r.fieldRow)t(e)&&n.push({block:i,field:e.name,ref:e});r.connection&&r.connection.targetBlock()&&e(r.connection.targetBlock())}i.nextConnection&&i.nextConnection.targetBlock()&&e(i.nextConnection.targetBlock())}(e))),n}(c=n.svg||(n.svg={})).hasClass=function(e,t){return pxt.BrowserUtils.containsClass(e,t)},c.addClass=function(e,t){pxt.BrowserUtils.addClass(e,t)},c.removeClass=function(e,t){pxt.BrowserUtils.removeClass(e,t)},n.parseColour=function(e){const t=Number(e);return isNaN(t)?"string"==typeof e&&e.match(/^#[0-9a-fA-F]{6}$/)?e:"#000":i.utils.colour.hueToHex(t)},n.bitmapToImageURI=function(e,t,n){const i=pxt.appTarget.runtime.palette.slice(1),r=document.createElement("canvas");r.width=t,r.height=t;const o=Math.min(t/e.width,t/e.height),s=Math.max(Math.floor(t*(1-e.width/e.height)/2),0),a=Math.max(Math.floor(t*(1-e.height/e.width)/2),0);let l;n?((l=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=r.getContext("2d");for(let t=0;t<e.width;t++)for(let r=0;r<e.height;r++){const c=e.get(t,r);c?(l.fillStyle=i[c-1],l.fillRect(s+t*o,a+r*o,o,o)):n&&(l.fillStyle="#dedede",l.fillRect(s+t*o,a+r*o,o,o))}return r.toDataURL()},n.tilemapToImageURI=function(e,t,n){const i=pxt.appTarget.runtime.palette.slice(),r=document.createElement("canvas");r.width=t,r.height=t;const o=Math.min(t/e.tilemap.width,t/e.tilemap.height),s=Math.max(Math.floor(t*(1-e.tilemap.width/e.tilemap.height)/2),0),a=Math.max(Math.floor(t*(1-e.tilemap.height/e.tilemap.width)/2),0);let l;n?((l=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=r.getContext("2d");let c=[];for(let t=0;t<e.tilemap.width;t++)for(let r=0;r<e.tilemap.height;r++){const u=e.tilemap.get(t,r);if(u){if(!c[u]){const t=e.tileset.tiles[u];c[u]=t?pxt.sprite.computeAverageColor(pxt.sprite.Bitmap.fromData(t.bitmap),i):"#dedede"}l.fillStyle=c[u],l.fillRect(s+t*o,a+r*o,o,o)}else n&&(l.fillStyle="#dedede",l.fillRect(s+t*o,a+r*o,o,o))}return r.toDataURL()},n.songToDataURI=function(e,t,n,i,r){const o=pxt.appTarget.runtime.palette.slice(),s=document.createElement("canvas");let a;s.width=t,s.height=n,i?((a=s.getContext("2d",{alpha:!1})).fillStyle="#dedede",a.fillRect(0,0,t,n)):a=s.getContext("2d");const l=[5,11,5,4,2,6,14,2,5,1];r=r||e.measures;const c=Math.max(Math.floor(t/(e.beatsPerMeasure*r*2)),1),u=Math.floor(t/c),d=Math.max(Math.floor(n/12),1),h=Math.floor(n/d);for(const t of e.tracks)for(const n of t.notes){const i=Math.floor(n.startTick/(e.ticksPerBeat/2));if(i>u)break;for(const r of n.notes){const n=12-r.note%12;n>h||(a.fillStyle=o[l[t.id||e.tracks.indexOf(t)]],a.fillRect(i*c,n*d,c,d))}}return s.toDataURL()},n.getAllBlocksWithTilemaps=d,n.getAllBlocksWithTilesets=h,n.needsTilemapUpgrade=function(e){return!!e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name))).length},n.upgradeTilemapsInWorkspace=function(e,t){const n=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name)));if(n.length)try{i.Events.disable();let r=[];for(const i of n)i.qualifiedName?r[i.projectId]=t.resolveTile(i.qualifiedName):i.data&&(r[i.projectId]=t.createNewTile(i.data,"myTiles.tile"+i.projectId)),u(e,i);const o=d(e);for(const e of o){const n=pxt.sprite.legacy.decodeTilemap(e.ref.getInitText(),"typescript"),i=[],o=new pxt.sprite.TilemapData(n.tilemap,{tileWidth:n.tileset.tileWidth,tiles:n.tileset.tiles.map(((e,n)=>null!=e.projectId?r[e.projectId]:(i[n]||(i[n]=t.resolveTile(e.qualifiedName)),i[n])))},n.layers);e.ref.setValue(pxt.sprite.encodeTilemap(o,"typescript"))}const s=h(e);for(const e of s)e.ref.doValueUpdate_(e.ref.getValue()),e.ref.getSize()}finally{i.Events.enable()}},n.getAllFields=p,n.getAllReferencedTiles=function(e,t){var n;let i={};const r=d(e),o=pxt.react.getTilemapProject();for(const e of r)if(e.block.id!==t)for(const t of(null===(n=e.ref.getTileset())||void 0===n?void 0:n.tiles)||[])i[t.id]=o.lookupAsset("tile",t.id);const s=o.getAssets("tilemap");for(const e of s)for(const t of e.data.tileset.tiles)i[t.id]=o.lookupAsset("tile",t.id);const a=h(e);for(const e of a){const t=e.ref.getValue(),n=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(t);if(n){const e=o.lookupAssetByName("tile",n[1]);e&&!i[e.id]&&(i[e.id]=e)}else i[t]||(i[t]=o.resolveTile(t))}return Object.keys(i).map((e=>i[e])).filter((e=>!!e))},n.getTilesReferencedByTilesets=function(e){let t={};const n=pxt.react.getTilemapProject(),i=h(e);for(const e of i){const i=e.ref.getValue(),r=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(i);if(r){const e=n.lookupAssetByName("tile",r[1]);e&&!t[e.id]&&(t[e.id]=e)}else t[i]||(t[i]=n.resolveTile(i))}return Object.keys(t).map((e=>t[e])).filter((e=>!!e))},n.getTemporaryAssets=function(e,t){switch(t){case"image":return p(e,(e=>e instanceof a.FieldSpriteEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"animation":return p(e,(e=>e instanceof o.FieldAnimationEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"song":return p(e,(e=>e instanceof s.FieldMusicEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));default:return[]}},n.FIELD_EDITOR_OPEN_EVENT_TYPE="field_editor_open";class f extends i.Events.UiBase{constructor(e,t){super(e.workspace.id),this.type=n.FIELD_EDITOR_OPEN_EVENT_TYPE,this.blockId=e.id,this.isOpen=t}}function g(e){return e.data?/^(?:\d+;?)+$/.test(e.data)?{commentRefs:e.data.split(";"),fieldData:{}}:JSON.parse(e.data):{commentRefs:[],fieldData:{}}}function m(e,t){e.data=JSON.stringify(t)}n.FieldEditorOpenEvent=f,n.setMelodyEditorOpen=function(e,t){i.Events.fire(new f(e,t))},n.workspaceToScreenCoordinates=function(e,t){const n=t.scale(e.scale),r=e.getOriginOffsetInPixels(),o=i.utils.Coordinate.sum(n,r),s=e.getInjectionDiv().getBoundingClientRect();return new i.utils.Coordinate(o.x+s.left,o.y+s.top)},n.getBlockData=g,n.setBlockData=m,n.setBlockDataForField=function(e,t,n){const i=g(e);i.fieldData[t]=n,m(e,i)},n.getBlockDataForField=function(e,t){return g(e).fieldData[t]}},{"./field_animation":26,"./field_musiceditor":40,"./field_sprite":48,"./field_tilemap":52,"./field_tileset":53,blockly:376}],65:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./field_utils"),n),r(e("./fieldEditorRegistry"),n),r(e("./field_animation"),n),r(e("./field_argumentvariable"),n),r(e("./field_kind"),n),r(e("./field_asset"),n),r(e("./field_ledmatrix"),n),r(e("./field_styledlabel"),n),r(e("./field_base"),n),r(e("./field_tsexpression"),n),r(e("./field_textinput"),n),r(e("./field_tilemap"),n),r(e("./field_userenum"),n),r(e("./field_procedure"),n),r(e("./field_sprite"),n),r(e("./field_imagedropdown"),n),r(e("./field_protractor"),n),r(e("./field_toggle_highlow"),n),r(e("./field_images"),n),r(e("./field_sound_effect"),n),r(e("./field_toggle_onoff"),n),r(e("./field_speed"),n),r(e("./field_toggle_updown"),n),r(e("./field_toggle_winlose"),n),r(e("./field_autocomplete"),n),r(e("./field_melodySandbox"),n),r(e("./field_toggle_yesno"),n),r(e("./field_musiceditor"),n),r(e("./field_textdropdown"),n),r(e("./field_note"),n),r(e("./field_turnratio"),n),r(e("./field_colorwheel"),n),r(e("./field_numberdropdown"),n),r(e("./field_colour"),n),r(e("./field_position"),n),r(e("./field_tileset"),n),r(e("./field_gridpicker"),n),r(e("./field_toggle"),n)},{"./fieldEditorRegistry":25,"./field_animation":26,"./field_argumentvariable":27,"./field_asset":28,"./field_autocomplete":29,"./field_base":30,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_kind":37,"./field_ledmatrix":38,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_procedure":44,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_styledlabel":49,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_tsexpression":61,"./field_turnratio":62,"./field_userenum":63,"./field_utils":64}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.attachCardInfo=n.mkCard=n.installHelpResources=n.setHelpResources=n.installBuiltinHelpInfo=n.setBuiltinHelpInfo=void 0;const i=e("blockly"),r=e("./xml"),o=e("./external"),s=e("./toolbox");function a(e,t,n,i,s,a,l,c,u){!i||"string"!=typeof i&&"function"!=typeof i||e.setTooltip(i),s&&e.setHelpUrl(s),a&&e.setColour(a,l,c),u&&e.setDeletable(!1);let d=document.getElementById("blocklyToolboxDefinition"),h=d?(0,r.getFirstChildWithAttr)(d,"block","type",t):void 0;e.codeCard={header:n,name:n,software:1,description:"function"==typeof i?i(e):i,blocksXml:h?'<xml xmlns="http://www.w3.org/1999/xhtml">'+((0,r.cleanOuterHTML)(h)||`<block type="${t}"></block>`)+"</xml>":void 0,url:s},pxt.Util.isTranslationMode()&&(e.customContextMenu=n=>{const i=pxt.blocks.getBlockDefinition(e.type);i&&i.translationIds&&n.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,o.promptTranslateBlock)(t,i.translationIds)}})})}function l(e,t,n,r,o,s,l){let c=i.Blocks[e],u=c.init;u&&(c.init=function(){u.call(this),a(this,e,t,n,r,o,s,l)})}function c(e,t){return{name:e.namespace+"."+e.name,shortName:e.name,description:e.attributes.jsDoc,url:e.attributes.help?"reference/"+e.attributes.help.replace(/^\//,""):void 0,blocksXml:`<xml xmlns="http://www.w3.org/1999/xhtml">${(0,r.cleanOuterHTML)(t)}</xml>`}}n.setBuiltinHelpInfo=function(e,t){const n=pxt.blocks.getBlockDefinition(t);a(e,t,n.name,n.tooltip,n.url,pxt.toolbox.getNamespaceColor(n.category))},n.installBuiltinHelpInfo=function(e){const t=pxt.blocks.getBlockDefinition(e);l(e,t.name,t.tooltip,t.url,pxt.toolbox.getNamespaceColor(t.category))},n.setHelpResources=a,n.installHelpResources=l,n.mkCard=c,n.attachCardInfo=function(e,t){const n=e.apis.byQName[t];if(n){const t=pxt.blocks.compileInfo(n);return c(n,(0,s.createToolboxBlock)(e,n,t))}}},{"./external":24,"./toolbox":120,"./xml":121,blockly:376}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateAllReferencedBlocksExist=n.patchShadows=n.patchCommentIds=n.importXml=n.loadWorkspaceXml=n.loadBlocksXml=n.getFirstChildWithAttr=n.getChildrenWithAttr=n.getBlocksWithType=n.getDirectChildren=n.saveBlocksXml=n.workspaceToDom=n.saveWorkspaceXml=n.clearWithoutEvents=n.domToWorkspaceNoEvents=void 0;const i=e("blockly"),r=e("./loader"),o=e("./external"),s=e("./fields");function a(e,t,n){pxt.tickEvent("blocks.domtow");let r=[];p(e),g(e,!1);try{i.Events.disable(),r=i.Xml.domToWorkspace(e,t),s.FieldBase.flushInitQueue();for(const e of t.getAllBlocks())e.afterWorkspaceLoad&&e.afterWorkspaceLoad.call(e);!function(e,t){e.getAllBlocks(!1).filter((e=>!!e.getCommentText())).forEach((n=>{var i,r;const o=n.getCommentText();if(/@hide/.test(o)&&(null==t?void 0:t.applyHideMetaComment))return void n.dispose(!0);let s=o;/@highlight/.test(s)&&(s=s.replace(/@highlight/g,"").trim(),null===(r=(i=e).highlightBlock)||void 0===r||r.call(i,n.id,!0)),/@collapsed/.test(s)&&!n.getParent()&&(s=s.replace(/@collapsed/g,"").trim(),n.setCollapsed(!0)),o===(s=s.replace(/@validate-\S+/g,"").trim())||(null==t?void 0:t.keepMetaComments)||n.setCommentText(s||null)}))}(t,n)}catch(e){pxt.reportException(e)}finally{i.Events.enable()}return r.filter((e=>!!t.getBlockById(e)))}function l(e,t){const n=i.Xml.workspaceToDom(e,t),r=i.Xml.variablesToDom(e.getAllVariables()),o=c(n,"variables");for(const e of o)e.remove();return n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),n}function c(e,t){const n=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes.item(i);r.tagName===t&&n.push(r)}return n}function u(e,t){return d(e,"block","type",t).concat(d(e,"shadow","type",t))}function d(e,t,n,i){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(n)===i))}function h(e,t,n,i){const r=d(e,t,n,i);return r.length?r[0]:void 0}function p(e){const t=c(e,"comment");for(const e of t)e.hasAttribute("id")||e.setAttribute("id",i.utils.idGenerator.genUid())}function f(e){if(2===e.parentElement.childElementCount)return void e.remove();const t=i.utils.xml.createElement("block");for(const n of e.getAttributeNames())t.setAttribute(n,e.getAttribute(n));for(const n of e.childNodes)t.appendChild(n.cloneNode(!0));return e.parentElement.appendChild(t),e.remove(),t}function g(e,t){if("shadow"===e.tagName){const t=e.getAttribute("type");let n=!1;switch(t){case"variables_get_reporter":case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":n=!0}if(n){if(!(e=f(e)))return;let t=c(e,"mutation")[0];t?t.setAttribute("duplicateondrag","true"):((t=i.utils.xml.createElement("mutation")).setAttribute("duplicateondrag","true"),e.appendChild(t))}else("variables_get"===t||m(e))&&(e=f(e))}if(e)for(const n of e.children)g(n,t||"shadow"===e.tagName)}function m(e){for(const t of e.children)if("block"===t.tagName.toLowerCase()||m(t))return!0;return!1}function b(e,t,n){var o;let s=n.getAttribute("type"),a=i.Blocks[s],l=(0,r.blockSymbol)(s);if(!l||!a)return;let c=pxt.blocks.compileInfo(l);null===(o=l.parameters)||void 0===o||o.forEach(((i,r)=>{let o=e.apis.byQName[i.type];if(o&&6==o.kind){let e=h(n,"field","name",c.actualNameToParam[i.name].definitionName);if(e){let n=t[o.name+"."+e.textContent];n&&(e.textContent=n)}}}))}n.domToWorkspaceNoEvents=a,n.clearWithoutEvents=function(e){if(pxt.tickEvent("blocks.clear"),e)try{i.Events.disable(),e.clear(),e.clearUndo()}finally{i.Events.enable()}},n.saveWorkspaceXml=function(e,t){const n=l(e,!t);return i.Xml.domToText(n)},n.workspaceToDom=l,n.saveBlocksXml=function(e,t){return e.getTopBlocks(!1).map((e=>i.Xml.domToText(i.Xml.blockToDom(e,!t))))},n.getDirectChildren=c,n.getBlocksWithType=u,n.getChildrenWithAttr=d,n.getFirstChildWithAttr=h,n.loadBlocksXml=function(e,t){let n=i.utils.xml.textToDom(t),r=i.Xml.domToBlock(n,e);if(e.getMetrics){let t=e.getMetrics(),n=r.getHeightWidth();r.moveBy(t.viewLeft+t.viewWidth/2-n.width/2,t.viewTop+t.viewHeight/2-n.height/2)}},n.loadWorkspaceXml=function(e,t=!1,n){const r=new i.Workspace;try{return a(i.utils.xml.textToDom(e),r,n),r}catch(e){return t||pxt.reportException(e),null}},n.importXml=function(e,t,n,i=!1){try{(0,r.initializeAndInject)(n);const i=(new DOMParser).parseFromString(t,"application/xml"),s=pxt.patching.computePatches(e);s&&(s.filter((e=>"blockId"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{u(i,t).forEach((n=>{n.setAttribute("type",e.map[t]),pxt.debug(`patched block ${t} -> ${e.map[t]}`)}))})))),s.filter((e=>"blockValue"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{const n=t.split("."),r=n[0];n[1],u(i,r).reduce(((e,t)=>e.concat(c(t,"value"))),[]).forEach((n=>{n.setAttribute("name",e.map[t]),pxt.debug(`patched block value ${t} -> ${e.map[t]}`)}))})))),s.filter((e=>"userenum"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{d(i,"variable","type",t).forEach((n=>{n.setAttribute("type",e.map[t]),pxt.debug(`patched enum variable type ${t} -> ${e.map[t]}`)}))})))));const a=c(i.children.item(0),"shadow");for(const e of a){const t=i.createElement("block");e.getAttributeNames().forEach((n=>t.setAttribute(n,e.getAttribute(n))));for(let n=0;n<e.childNodes.length;n++)t.appendChild(e.childNodes.item(n));e.replaceWith(t)}g(i.documentElement,!1),p(i.documentElement);const l={};Object.keys(n.apis.byQName).forEach((e=>{let t=n.apis.byQName[e];7==t.kind&&(l[t.namespace+"."+(t.attributes.blockImportId||t.attributes.block||t.attributes.blockId||t.name)]=t.namespace+"."+t.name)}));const h=i.getElementsByTagName("block");for(let e=0;e<h.length;++e)b(n,l,h[e]);return function(e,t){const n=u(e,ts.pxtc.ON_START_TYPE);let i=n.length?n[0]:void 0;if(i)return void i.removeAttribute("deletable");let o=[];const s=t.blocksById;let a,l=e.firstElementChild;for(;l;){const t=l.nextElementSibling,n=l.getAttribute("type");if(!l.getAttribute("disabled")&&!l.getElementsByTagName("statement").length&&(r.buildinBlockStatements[n]||s[n]&&"void"==s[n].retType&&!(0,r.hasArrowFunction)(s[n])))if(a){const t=e.ownerDocument.createElement("next");t.appendChild(l),a.appendChild(t),l.removeAttribute("x"),l.removeAttribute("y"),a=l}else(a=e.ownerDocument.createElement("statement")).setAttribute("name","HANDLER"),i||((i=e.ownerDocument.createElement("block")).setAttribute("type",ts.pxtc.ON_START_TYPE),o.push(i)),i.appendChild(a),a.appendChild(l),l.removeAttribute("x"),l.removeAttribute("y"),a=l;l=t}o.forEach((t=>e.appendChild(t)))}(i.documentElement,n),function(e,t){pxt.U.toArray(e.querySelectorAll("block[type=procedures_defnoreturn]")).forEach((e=>{e.setAttribute("type","function_definition"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")})),pxt.U.toArray(e.querySelectorAll("block[type=procedures_callnoreturn]")).forEach((e=>{e.setAttribute("type","function_call"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")}))}(i.documentElement),(0,o.extensionBlocklyPatch)(e,i.documentElement),(new XMLSerializer).serializeToString(i)}catch(e){return i||pxt.reportException(e),t}},n.patchCommentIds=p,n.patchShadows=g,n.validateAllReferencedBlocksExist=function(e){pxt.U.assert(!!(null==i?void 0:i.Blocks),"Called validateAllReferencedBlocksExist before initializing Blockly");const t=i.utils.xml.textToDom(e),n=t.querySelectorAll("block");for(let e=0;e<n.length;e++)if(!i.Blocks[n.item(e).getAttribute("type")])return!1;const r=t.querySelectorAll("shadow");for(let e=0;e<r.length;e++)if(!i.Blocks[r.item(e).getAttribute("type")])return!1;return!0}},{"./external":24,"./fields":65,"./loader":71,blockly:376}],68:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.external=n.contextMenu=void 0,r(e("./plugins/arrays"),n),r(e("./plugins/functions"),n),r(e("./plugins/logic"),n),r(e("./plugins/math"),n),r(e("./plugins/text"),n),r(e("./plugins/renderer"),n),r(e("./plugins/flyout"),n),r(e("./plugins/newVariableField"),n),r(e("./compiler/compiler"),n),r(e("./compiler/environment"),n),r(e("./loader"),n),r(e("./layout"),n),r(e("./render"),n),r(e("./toolbox"),n),r(e("./fields"),n),r(e("./sourceMap"),n),r(e("./importer"),n),r(e("./diff"),n),r(e("./legacyMutations"),n),r(e("./blockDragger"),n);const o=e("./contextMenu");n.contextMenu=o;const s=e("./external");n.external=s,r(e("./breakpointIcon"),n)},{"./blockDragger":1,"./breakpointIcon":2,"./compiler/compiler":12,"./compiler/environment":13,"./contextMenu":21,"./diff":23,"./external":24,"./fields":65,"./importer":67,"./layout":69,"./legacyMutations":70,"./loader":71,"./plugins/arrays":75,"./plugins/flyout":80,"./plugins/functions":93,"./plugins/logic":99,"./plugins/math":101,"./plugins/newVariableField":105,"./plugins/renderer":110,"./plugins/text":115,"./render":118,"./sourceMap":119,"./toolbox":120}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.documentToSvg=n.blocklyToSvgAsync=n.cleanUpBlocklySvg=n.serializeSvgString=n.serializeNode=n.toSvgAsync=n.toPngAsync=n.screenshotAsync=n.screenshotEnabled=n.flow=n.setCollapsedAll=n.verticalAlign=n.splitSvg=n.patchBlocksFromOldWorkspace=void 0;const i=e("blockly"),r=e("./compiler/environment"),o=e("./fields"),s=e("./compiler/compiler"),a=e("./importer");n.patchBlocksFromOldWorkspace=function(e,t,n){const o=(0,a.loadWorkspaceXml)(n,!0);return function(e,t,n){let i,o;t.getTopBlocks(!1).filter((e=>e.isEnabled())).forEach((a=>{const l=a.getRelativeToSurfaceXY();if(l&&0!=l.x&&0!=l.y){i||(i=(0,r.mkEnv)(t,e),o={},n.getTopBlocks(!1).forEach((e=>{const t=(0,s.callKey)(i,e),n=o[t]||[];n.push(e),o[t]=n})));const c=(0,s.callKey)(i,a),u=(o[c]||[]).shift();if(u){const e=u.getRelativeToSurfaceXY();e.x=l.x,e.y=l.y}}}))}(e,t,o),function(e,t){const n=(0,a.workspaceToDom)(e,!0),r=(0,a.workspaceToDom)(t,!0);return pxt.Util.toArray(n.childNodes).filter((e=>e.nodeType==Node.ELEMENT_NODE&&"block"==e.localName&&"true"==e.getAttribute("disabled"))).filter((e=>!!i.Blocks[e.getAttribute("type")])).forEach((e=>r.appendChild(r.ownerDocument.importNode(e,!0)))),i.Xml.domToText(r)}(t,o)},n.splitSvg=function(e,t,n=18){const i=t.getTopComments(!0),r=t.getTopBlocks(!0);if(i.length+r.length<2)return e;const o=document.createElement("div");function s(t,i,r,s,a,l){const c=e.cloneNode(!0),u=c.querySelector(`g.blocklyWorkspace > g.${t}`),d=c.querySelector(`g.blocklyWorkspace > g.${i}`),h=pxt.Util.toArray(u.querySelectorAll(`g.blocklyWorkspace > g.${t} > ${l?"."+l:"g[transform]"}`)),p=h.splice(r,1)[0];if(!p)return void pxt.log("missing block, did block failed to load?");h.filter((e=>e!=p)).forEach((e=>{e.parentNode.removeChild(e)})),u.removeAttribute("transform"),d.parentNode.removeChild(d),p.setAttribute("transform",`translate(${a.x}, ${a.y})`);const f=s.width/n+"em",g=s.height/n+"em";c.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),c.style.width=f,c.style.height=g,c.setAttribute("width",f),c.setAttribute("height",g),o.appendChild(c)}return o.className=`blocks-svg-list ${t.getInjectionDiv().className}`,i.forEach(((e,t)=>s("blocklyBubbleCanvas","blocklyBlockCanvas",t,e.getHeightWidth(),{x:0,y:0},"blocklyComment"))),r.forEach(((e,t)=>{const i=e.getHeightWidth(),r={x:0,y:0};e.hat&&(i.height+=n,r.y+=n),s("blocklyBlockCanvas","blocklyBubbleCanvas",t,i,r)})),o},n.verticalAlign=function(e,t){let n=0;e.getTopComments(!0).forEach((e=>{e.moveBy(0,n),n+=e.getHeightWidth().height,n+=t})),e.getTopBlocks(!0).forEach(((e,i)=>{e.hat&&(n+=t),e.moveBy(0,n),n+=e.getHeightWidth().height,n+=t}))},n.setCollapsedAll=function(e,t){e.getTopBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>e.setCollapsed(t)))};const l=20;function c(e,t,n){let i;n&&(i={target:pxt.appTarget.id,versions:pxt.appTarget.versions,xml:(0,a.saveBlocksXml)(e).map((e=>pxt.Util.htmlEscape(e)))});const r=0|t||4;return h(e,r).then((e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:r,text:n?JSON.stringify(i,null,2):null}):Promise.resolve(void 0))).catch((e=>{pxt.reportException(e)}))}n.flow=function(e,t){if(t){if(t.useViewWidth){const t=e.getMetrics();if(t.viewHeight>t.viewWidth)return _(e.getTopComments(!0),e.getTopBlocks(!0),void 0,t.viewWidth),void e.scroll(l,20)}_(e.getTopComments(!0),e.getTopBlocks(!0),t.ratio)}else _(e.getTopComments(!0),e.getTopBlocks(!0));e.scroll(l,20)},n.screenshotEnabled=function(){return!pxt.BrowserUtils.isIE()},n.screenshotAsync=function(e,t,n){return c(e,t,n)},n.toPngAsync=c;const u="http://www.w3.org/1999/xlink",d=12e7;function h(e,t){if(!e)return Promise.resolve(void 0);const n=e.getBlocksBoundingBox(),i=e.getParentSvg().cloneNode(!0);g(i);let r=n.right-n.left,o=n.bottom-n.top,s=1;const a=r*o*Math.pow(t,2);return a>d&&(s=Math.sqrt(d/a)),m(i,n.left,n.top,r,o,s)}function p(e){return f((new XMLSerializer).serializeToString(e))}function f(e){return e.replace(new RegExp("&nbsp;","g"),"&#160;")}function g(e){pxt.BrowserUtils.removeClass(e,"blocklySvg"),pxt.BrowserUtils.addClass(e,"blocklyPreview pxt-renderer classic-theme"),pxt.U.toArray(e.querySelectorAll(".blocklyMainBackground,.blocklyScrollbarBackground")).forEach((e=>{e&&e.parentNode.removeChild(e)})),pxt.U.toArray(e.querySelectorAll(".blocklyConnectionIndicator,.blocklyInputConnectionIndicator")).forEach((e=>{e&&e.parentNode.removeChild(e)})),e.removeAttribute("width"),e.removeAttribute("height"),pxt.U.toArray(e.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.removeAttribute("transform")));const t=new DOMParser;return pxt.U.toArray(e.querySelectorAll(".blocklyCommentTextarea")).forEach((e=>{const n=t.parseFromString("<!doctype html><body>"+pxt.docs.html2Quote(e.value),"text/html");e.textContent=n.body.textContent})),e}function m(e,t,n,i,r,o){if(!e.childNodes[0])return Promise.resolve(void 0);e.removeAttribute("width"),e.removeAttribute("height"),e.removeAttribute("transform");let s=Math.round(i*(o||1)),a=Math.round(r*(o||1));const l=p(e).replace(/^\s*<svg[^>]+>/i,"").replace(/<\/svg>\s*$/i,""),c=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="${u}" width="${s}" height="${a}" viewBox="${t} ${n} ${i} ${r}" class="pxt-renderer classic-theme">${l}</svg>`,d=(new DOMParser).parseFromString(c,"image/svg+xml"),h=d.createElementNS("http://www.w3.org/1999/xhtml","style"),f=pxt.Util.isUserLanguageRtl(),g=document.getElementById(`style-${f?"rtl":""}blockly.css`).href,m=pxt.Util.toArray(document.head.getElementsByTagName("link")).filter((e=>pxt.Util.endsWith(e.getAttribute("href"),"semantic.css")))[0].href;return Promise.all([pxt.BrowserUtils.loadAjaxAsync(g),pxt.BrowserUtils.loadAjaxAsync(m)]).then((e=>{var t,n;const i=pxt.Util.toArray(document.head.querySelectorAll("style")).filter((e=>/\.blocklySvg/.test(e.innerText)))[0];e.unshift((null===(t=document.getElementById("blockly-common-style"))||void 0===t?void 0:t.innerText)||""),e.unshift((null===(n=document.getElementById("blockly-renderer-style-pxt-classic"))||void 0===n?void 0:n.innerText)||"");const r=(i?i.innerText:"")+"\n\n"+e.map((e=>e+"\n\n"));return h.appendChild(d.createCDATASection(r)),d.documentElement.insertBefore(h,d.documentElement.firstElementChild),function(e){y||(y={});const t=e.getElementsByTagName("image"),n=pxt.Util.toArray(t).filter((e=>{const t=e.getAttributeNS(u,"href");return t&&!/^data:/.test(t)})).map((e=>e)).map((e=>{const t=e.getAttributeNS(u,"href");let n=y[t];return(n?Promise.resolve(y[t]):pxt.BrowserUtils.loadImageAsync(e.getAttributeNS(u,"href")).then((e=>{const i=document.createElement("canvas"),r=i.getContext("2d");let o=e.width,s=e.height;return i.width=o,i.height=s,r.drawImage(e,0,0,o,s,0,0,i.width,i.height),y[t]=n=i.toDataURL("image/png"),n})).catch((e=>(pxt.debug(`svg render: failed to load ${t}`),"")))).then((t=>{e.setAttributeNS(u,"href",t)}))}));return Promise.all(n).then((()=>{}))}(d).then((()=>function(e){if(v||(v={}),!pxt.BrowserUtils.isEdge())return Promise.resolve();const t=e.getElementsByTagName("image"),n=pxt.Util.toArray(t).filter((e=>/^data:image\/svg\+xml/.test(e.getAttributeNS(u,"href")))).map((e=>e)).map((e=>{const t=e.getAttributeNS(u,"href"),n=parseInt(e.getAttribute("width").replace(/[^0-9]/g,"")),i=parseInt(e.getAttribute("height").replace(/[^0-9]/g,""));let r=v[t];return(r?Promise.resolve(r):pxt.BrowserUtils.encodeToPngAsync(t,{width:n,height:i,pixelDensity:2})).then((n=>{v[t]=n,e.setAttributeNS(u,"href",n)}))}));return Promise.all(n).then((()=>{}))}(d))).then((()=>({width:s,height:a,svg:p(d).replace('<style xmlns="http://www.w3.org/1999/xhtml">',"<style>"),xml:b(d),css:r})))}))}function b(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(unescape(encodeURIComponent(t)))}let y,v;function _(e,t,n=1.62,i){const r=[],s={};let a;e.forEach((e=>{const t=e.data;null!=t&&(s[t]=e)})),t.sort(((e,t)=>e.isEnabled()===t.isEnabled()?e.type===t.type?0:"function_definition"===e.type?1:"function_definition"===t.type?-1:e.type.localeCompare(t.type):e.isEnabled()?-1:1)),t.forEach((e=>{const t=(0,o.getBlockData)(e).commentRefs;if(t.length){const n=[];for(let e=0;e<t.length;e++){const i=s[t[e]];i&&(n.push(E(i)),delete s[t[e]])}if(n.length)return void r.push({value:e,width:-1,height:-1,children:n})}const n=E(e);!a&&e.isEnabled()&&e.type===pxtc.ON_START_TYPE?a=n:r.push(n)})),a&&r.unshift(a),Object.keys(s).sort(((e,t)=>e.length===t.length?e>t?-1:1:e.length>t.length?-1:1)).forEach((e=>{s[e]&&r.push(E(s[e]))})),e.forEach((e=>{null==e.data&&r.push(E(e))}));let c,u=0;for(let e=0;e<r.length;e++){const t=r[e];if(t.children){const e=t.value.getHeightWidth();t.x=0,t.y=0;let n=e.width+13,i=0;for(let e=0;e<t.children.length;e++){const r=t.children[e];r.x=n,r.y=i,i+=r.height+13,t.width=Math.max(t.width,n+r.width)}t.height=Math.max(i-13,e.height)}u+=(t.height+13)*(t.width+13)}c=i>l?i-l:Math.sqrt(u)*n;let d=l,h=20,p=0;for(let e=0;e<r.length;e++){const t=r[e];if(t.children){f(t,d+t.x,h+t.y);for(let e=0;e<t.children.length;e++){const n=t.children[e];f(n,d+n.x,h+n.y)}}else f(t,d,h);d+=t.width+45,p=Math.max(p,h+t.height+45),d>c&&(d=l,h=p)}function f(e,t,n){const i=e.value.getBoundingRectangle();e.value.moveBy(t-i.left,n-i.top)}}function E(e){const t=e.getHeightWidth();return{value:e,height:t.height,width:t.width}}n.toSvgAsync=h,n.serializeNode=p,n.serializeSvgString=f,n.cleanUpBlocklySvg=g,n.blocklyToSvgAsync=m,n.documentToSvg=b},{"./compiler/compiler":12,"./compiler/environment":13,"./fields":65,"./importer":67,blockly:376}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mutateToolboxBlock=n.addMutation=n.MutatorTypes=void 0;const i=e("blockly"),r=e("./compiler/util"),o=e("./compiler/compiler"),s=e("./loader");var a,l;(l=a=n.MutatorTypes||(n.MutatorTypes={})).ObjectDestructuringMutator="objectdestructuring",l.RestParameterMutator="restparameter",l.DefaultInstanceMutator="defaultinstance",n.addMutation=function(e,t,n){let i;switch(n){case a.ObjectDestructuringMutator:if(!t.parameters||t.parameters.length<1)console.error("Destructuring mutations require at least one parameter");else{let e=!1;for(const n of t.parameters)if(-1!==n.type.indexOf("=>")){if(!n.properties||0===n.properties.length)return void console.error("Destructuring mutations only supported for functions with an event parameter that has multiple properties");e=!0}if(!e)return void console.error("Destructuring mutations must have an event parameter")}i=new u(e,t);break;case a.RestParameterMutator:i=new d(e,t);break;case a.DefaultInstanceMutator:i=new h(e,t);break;default:return void console.warn("Ignoring unknown mutation type: "+n)}e.mutationToDom=i.mutationToDom.bind(i),e.domToMutation=i.domToMutation.bind(i),e.compose=i.compose.bind(i),e.decompose=i.decompose.bind(i),e.mutation=i},n.mutateToolboxBlock=function(e,t,n){const i=document.createElement("mutation");switch(t){case a.ObjectDestructuringMutator:i.setAttribute(u.propertiesAttributeName,n);break;case a.RestParameterMutator:i.setAttribute(d.countAttributeName,n);break;case a.DefaultInstanceMutator:i.setAttribute(h.attributeName,n);default:return void console.warn("Ignoring unknown mutation type: "+t)}e.appendChild(i)};class c{constructor(e,t){this.info=t,this.block=e,this.topBlockType=this.block.type+"_mutator";const n=this.getSubBlockNames();this.initializeMutatorTopBlock(),this.initializeMutatorSubBlocks(n);const r=n.map((e=>e.type));this.block.setMutator(new i.icons.MutatorIcon(r,e))}compose(e){const t=e.getDescendants(!1).map((e=>({type:e.type,name:e.inputList[0].name})));t.shift(),this.updateBlock(t)}decompose(e){const t=e.newBlock(this.topBlockType);t.initSvg();for(const n of t.inputList)if(n.name===c.mutatorStatmentInput){let t=n.connection;this.getVisibleBlockTypes().forEach((n=>{const i=e.newBlock(n);i.initSvg(),t.connect(i.previousConnection),t=i.nextConnection}));break}return t}compileMutation(e,t){}getDeclaredVariables(){}isDeclaredByMutation(e){return!1}initializeMutatorSubBlock(e,t,n){e.appendDummyInput(t).appendField(t),e.setColour(n),e.setNextStatement(!0),e.setPreviousStatement(!0)}initializeMutatorTopBlock(){const e=this.info.attributes.mutateText,t=this.block.getColour();i.Blocks[this.topBlockType]=i.Blocks[this.topBlockType]||{init:function(){this.appendDummyInput().appendField(e),this.setColour(t),this.appendStatementInput(c.mutatorStatmentInput)}}}initializeMutatorSubBlocks(e){const t=this.block.getColour(),n=this.initializeMutatorSubBlock.bind(this);e.forEach((e=>{i.Blocks[e.type]=i.Blocks[e.type]||{init:function(){n(this,e.name,t)}}}))}}c.mutatorStatmentInput="PROPERTIES",c.mutatedVariableInputName="properties";class u extends c{constructor(e,t){super(e,t),this.currentlyVisible=[],this.parameterRenames={},this.prefix=this.info.attributes.mutatePrefix,this.block.appendDummyInput(c.mutatedVariableInputName),this.block.appendStatementInput("HANDLER").setCheck("null")}getMutationType(){return a.ObjectDestructuringMutator}compileMutation(e,t){if(!this.info.attributes.mutatePropertyEnum&&!this.parameters.length)return;const n=`function ({ ${this.parameters.map((t=>{const n=this.block.getField(t),i=n&&n.getText(),o=(0,r.escapeVarName)(t,e);return i!==t?(this.parameterRenames[t]=i,`${t}: ${(0,r.escapeVarName)(i,e)}`):o})).join(", ")} })`;return this.info.attributes.mutatePropertyEnum?pxt.blocks.mkText(` [${this.parameters.map((e=>`${this.info.attributes.mutatePropertyEnum}.${e}`)).join(", ")}],${n}`):pxt.blocks.mkText(n)}getDeclaredVariables(){const e={};return this.parameters.forEach((t=>{e[this.getVarFieldValue(t)]=this.parameterTypes[t]})),e}isDeclaredByMutation(e){return this.parameters.some((t=>this.getVarFieldValue(t)===e))}mutationToDom(){const e=document.createElement("mutation"),t=this.parameters.map((e=>{const t=this.getVarFieldValue(e);return t!==e&&(this.parameterRenames[e]=pxt.Util.htmlEscape(t)),pxt.Util.htmlEscape(e)})).join(",");e.setAttribute(u.propertiesAttributeName,t);for(const e in this.parameterRenames)e===this.parameterRenames[e]&&delete this.parameterRenames[e];return e.setAttribute(u.renameAttributeName,JSON.stringify(this.parameterRenames)),e}domToMutation(e){const t=e.getAttribute(u.propertiesAttributeName);if(t){const n=t.split(","),i=[];if(void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),n.forEach((e=>{const t=e.split(":");this.info.parameters[this.paramIndex].properties.some((e=>e.name===t[0]))&&i.push({property:t[0],newName:t[1]})})),this.parameterRenames=void 0,e.hasAttribute(u.renameAttributeName))try{this.parameterRenames=JSON.parse(e.getAttribute(u.renameAttributeName))}catch(e){console.warn("Ignoring invalid rename map in saved block mutation")}this.parameterRenames=this.parameterRenames||{},this.parameters=[],i.forEach((e=>{this.parameters.push(e.property),e.newName&&e.newName!==e.property&&(this.parameterRenames[e.property]=e.newName)})),this.updateVisibleProperties(),i.filter((e=>!!e.newName)).forEach((e=>this.setVarFieldValue(e.property,e.newName)))}}getVarFieldValue(e){const t=this.block.getField(e);return t&&t.getText()}setVarFieldValue(e,t){this.block.getField(e),this.block.getField(e)&&(0,s.setVarFieldValue)(this.block,e,t)}updateBlock(e){this.parameters=[],e.forEach((e=>{-1===this.parameters.indexOf(e.name)&&this.parameters.push(e.name)})),this.updateVisibleProperties()}getSubBlockNames(){return this.parameters=[],this.parameterTypes={},void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),this.info.parameters[this.paramIndex].properties.map((e=>(this.parameterTypes[e.name]=e.type,{type:this.propertyId(e.name),name:e.name})))}getVisibleBlockTypes(){return this.currentlyVisible.map((e=>this.propertyId(e)))}updateVisibleProperties(){if(pxt.Util.listsEqual(this.currentlyVisible,this.parameters))return;const e=this.block.inputList.find((e=>e.name===c.mutatedVariableInputName));this.prefix&&0===this.currentlyVisible.length&&e.appendField(this.prefix,u.prefixLabel),this.currentlyVisible.forEach((t=>{if(-1===this.parameters.indexOf(t)){const n=this.getVarFieldValue(t);n!==t&&(this.parameterRenames[t]=n),e.removeField(t)}})),this.parameters.forEach((t=>{if(-1===this.currentlyVisible.indexOf(t)){const n=this.parameterRenames[t]||t;e.appendField(new i.FieldVariable(n),t)}})),this.prefix&&0===this.parameters.length&&e.removeField(u.prefixLabel),this.currentlyVisible=this.parameters}propertyId(e){return this.block.type+"_"+e}getParameterIndex(){for(let e=0;e<this.info.parameters.length;e++)if(-1!==this.info.parameters[e].type.indexOf("=>"))return e}}u.propertiesAttributeName="callbackproperties",u.renameAttributeName="renamemap",u.prefixLabel="0prefix_label_";class d extends c{constructor(){super(...arguments),this.count=0}getMutationType(){return a.RestParameterMutator}compileMutation(e,t){const n=[];return this.forEachInput((i=>n.push((0,o.compileExpression)(e,i,t)))),pxt.blocks.mkGroup(n)}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(d.countAttributeName,this.count.toString()),e}domToMutation(e){const t=e.getAttribute(d.countAttributeName);if(t){try{this.count=parseInt(t)}catch(e){return}for(let e=0;e<this.count;e++)this.addNumberField(!1,e)}}updateBlock(e){if(e){const t=Math.abs(this.count-e.length);if(this.count<e.length)for(let e=0;e<t;e++)this.addNumberField(!0,this.count);else if(this.count>e.length)for(let e=0;e<t;e++)this.removeNumberField()}}getSubBlockNames(){return[{name:"Value",type:d.entryTypeName}]}getVisibleBlockTypes(){const e=[];return this.forEachInput((()=>e.push(d.entryTypeName))),e}addNumberField(e,t){const n=this.block.appendValueInput(d.valueInputPrefix+t).setCheck("Number");if(e){const e=this.block.workspace.newBlock("math_number");e.initSvg(),e.setShadow(!0),n.connection.connect(e.outputConnection),this.block.workspace.render(),this.count++}}removeNumberField(){this.count>0&&this.block.removeInput(d.valueInputPrefix+(this.count-1)),this.count--}forEachInput(e){for(let t=0;t<this.count;t++)e(this.block.getInputTargetBlock(d.valueInputPrefix+t),t)}}d.countAttributeName="count",d.entryTypeName="entry",d.valueInputPrefix="value_input_";class h extends c{constructor(){super(...arguments),this.showing=!1}getMutationType(){return a.DefaultInstanceMutator}compileMutation(e,t){if(this.showing){const n=this.block.getInputTargetBlock(h.instanceInputName);if(n)return(0,o.compileExpression)(e,n,t)}}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(h.attributeName,this.showing?"true":"false"),e}domToMutation(e){const t=e.getAttribute(h.attributeName);t?this.updateShape("true"===t):this.updateShape(!1)}updateBlock(e){this.updateShape(!(!e||!e.length))}getSubBlockNames(){return[{name:"Instance",type:h.instanceSubBlockType}]}getVisibleBlockTypes(){const e=[];return this.showing&&e.push(h.instanceSubBlockType),e}updateShape(e){this.showing!==e&&(e&&!this.block.getInputTargetBlock(h.instanceInputName)?this.block.appendValueInput(h.instanceInputName):this.block.removeInput(h.instanceInputName),this.showing=e)}}h.attributeName="showing",h.instanceInputName="__instance__",h.instanceSubBlockType="instance"},{"./compiler/compiler":12,"./compiler/util":15,"./loader":71,blockly:376}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PxtWorkspaceSearch=n.setVarFieldValue=n.generateIcons=n.getFixedInstanceDropdownValues=n.setOutputCheck=n.initialize=n.initializeAndInject=n.cleanBlocks=n.hasArrowFunction=n.injectBlocks=n.blockSymbol=n.cachedBlockInfo=n.buildinBlockStatements=n.builtinBlocks=n.isTupleType=void 0;const i=e("blockly"),r=e("@blockly/plugin-workspace-search"),o=e("./constants"),s=e("./composableMutations"),a=e("./legacyMutations"),l=e("./builtins/math"),c=e("./fields"),u=e("./builtins/functions"),d=e("./builtins/lists"),h=e("./builtins/logic"),p=e("./builtins/loops"),f=e("./builtins/text"),g=e("./toolbox"),m=e("./help"),b=e("./fields"),y=e("./fields"),v=e("./fields"),_=e("./fields"),E=e("./external"),T=e("./builtins/variables"),x=e("./builtins/misc"),w=e("./contextMenu"),k=e("./codecardRenderer"),S=e("./monkeyPatches"),C=e("./fields/field_dropdown");let A;function I(){return A||(A={},Object.keys(i.Blocks).forEach((e=>A[e]={block:i.Blocks[e]}))),A}n.isTupleType=function(e){let t=/^\[(.+)\]$/.exec(e);return t?t[1].split(/,\s*/):void 0},n.builtinBlocks=I,n.buildinBlockStatements={controls_if:!0,controls_for:!0,pxt_controls_for:!0,controls_simple_for:!0,controls_repeat_ext:!0,pxt_controls_for_of:!0,controls_for_of:!0,variables_set:!0,variables_change:!0,device_while:!0};let O={};function N(e){return n.cachedBlockInfo=e,e.blocks.map((t=>{const n=pxt.blocks.compileInfo(t),r=(0,g.createToolboxBlock)(e,t,n);if(t.attributes.blockBuiltin){pxt.Util.assert(!!I()[t.attributes.blockId]);const e=I()[t.attributes.blockId];e.symbol=t,e.block.codeCard=(0,m.mkCard)(t,r)}else!function(e,t,n,r){let l=t.attributes.blockId;if(I()[l])return pxt.reportError("blocks","trying to override builtin block",{details:l}),!1;let u=JSON.stringify(t);if(O[l]&&O[l].hash==u)return!0;if(i.Blocks[t.attributes.blockId])return console.error("duplicate block definition: "+l),!1;let d={hash:u,fn:t,block:{codeCard:(0,m.mkCard)(t,r),init:function(){!function(e,t,n,r){var l;const u=(n.attributes.blockNamespace||n.namespace).split(".")[0],d=1==n.kind||2==n.kind,h=t.apis.byQName[u],p=n.attributes.blockNamespace&&h&&h.attributes.color||n.attributes.color||h&&h.attributes.color||pxt.toolbox.getNamespaceColor(u)||255,f=pxt.blocks.getHelpUrl(n);f&&e.setHelpUrl(f),e.setColour(p);let g=o.provider.SHAPES.ROUND;"boolean"==n.retType&&(g=o.provider.SHAPES.HEXAGONAL),e.setOutputShape(g),n.attributes.undeletable&&e.setDeletable(!1),x(n.attributes._def);let m=!1;if(n.attributes.mutate)(0,a.addMutation)(e,n,n.attributes.mutate);else if(n.attributes.defaultInstance)(0,a.addMutation)(e,n,a.MutatorTypes.DefaultInstanceMutator);else if(n.attributes._expandedDef&&"disabled"!==n.attributes.expandableArgumentMode){const i="toggle"===n.attributes.expandableArgumentMode;(0,s.initExpandableBlock)(t,e,n.attributes._expandedDef,r,i,(()=>x(n.attributes._expandedDef,!0)))}else if(r.handlerArgs.length)if(m=!0,n.attributes.optionalVariableArgs)(0,s.initVariableArgsBlock)(e,r.handlerArgs);else if(n.attributes.draggableParameters)r.handlerArgs.filter((e=>!e.inBlockDef)).forEach((i=>{const r=e.appendValueInput("HANDLER_DRAG_PARAM_"+i.name);"reporter"==n.attributes.draggableParameters?r.setCheck(M(i.type,t)):r.setCheck("Variable")}));else{let t=e.appendDummyInput();r.handlerArgs.filter((e=>!e.inBlockDef)).forEach((e=>{t.appendField(new i.FieldVariable(e.name),"HANDLER_"+e.name)}))}(0,s.appendMutation)(e,{mutationToDom:t=>(e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.saveOptions){const n=e.saveOptions();n&&t.setAttribute("customfield",JSON.stringify(n))}}))})),t),domToMutation:t=>{e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.restoreOptions){const n=JSON.parse(t.getAttribute("customfield"));n&&e.restoreOptions(n)}}))}))}});const E=n.attributes.imageLiteral||n.attributes.gridLiteral;if(E){const t=(n.attributes.imageLiteralColumns||5)*E,i=n.attributes.imageLiteralRows||5,r=n.attributes.imageLiteralScale,o=n.attributes.gridLiteralOnColor,s=n.attributes.gridLiteralOffColor;e.appendDummyInput().appendField(new b.FieldMatrix("",{columns:t,rows:i,scale:r,onColor:o,offColor:s}),"LEDS")}"external"===n.attributes.inlineInputMode?e.setInputsInline(!1):"inline"===n.attributes.inlineInputMode?e.setInputsInline(!0):e.setInputsInline(!n.parameters||n.parameters.length<4&&!E),((null===(l=n.parameters)||void 0===l?void 0:l.find((e=>pxtc.parameterTypeIsArrowFunction(e))))||m)&&(e.appendStatementInput("HANDLER").setCheck(null),e.setInputsInline(!0)),P(e,n.retType,t);const T=R(n);function x(s,a=!1){let l=0,u=!a&&!!r.thisParameter;const h=function(e){const t=[];let n=[];return e.parts.forEach((e=>{switch(e.kind){case"break":i();break;case"param":n.push(e),i();break;case"image":case"label":n.push(e)}})),i(),t;function i(){n.length&&(t.push(n),n=[])}}(s),f=new pxt.ImageConverter;if(("ENUM_GET"===n.attributes.shim||"KIND_GET"===n.attributes.shim)&&(r.parameters.length>1||r.thisParameter))return void console.warn(`Enum blocks may only have 1 parameter but ${n.attributes.blockId} has ${r.parameters.length}`);const g=t=>{var n;return null===(n=e.inputList)||void 0===n?void 0:n.some((e=>e.name===t))};h.forEach((s=>{const h=[];let m,b,E,T=!1;if(s.forEach((e=>{if("param"!==e.kind){const t=function(e){if("image"===e.kind)return function(e){let t=j[e];if(t)return new i.FieldImage(t,40,40,"",null,pxt.Util.isUserLanguageRtl());pxt.log(`missing jres icon ${e}`)}(e.uri);const t=function(e){if(" "===e)return"";if(e.length>1){const t=" "==e.charAt(0),n=" "==e.charAt(e.length-1);if(t||n)return e.substring(t?1:0,n?e.length-1:e.length)}return e}(e.text);return t?e.cssClass?new i.FieldLabel(t,e.cssClass):e.style.length?new y.FieldStyledLabel(t,{bold:-1!==e.style.indexOf("bold"),italics:-1!==e.style.indexOf("italics"),blocksInfo:void 0}):new i.FieldLabel(t,void 0):void 0}(e);t&&h.push({field:t})}else{if("ENUM_GET"===n.attributes.shim)return pxt.Util.assert(!!n.attributes.enumName,"Trying to create an ENUM_GET block without a valid enum name"),void h.push({name:"MEMBER",field:new v.FieldUserEnum(t.enumsByName[n.attributes.enumName])});if("KIND_GET"===n.attributes.shim)return void h.push({name:"MEMBER",field:new c.FieldKind(t.kindsByName[n.attributes.kindNamespace||n.attributes.blockNamespace||n.namespace])});{let o=function(e,t,n=!1){if(e.ref){const n="this"===e.name?t.thisParameter:t.actualNameToParam[e.name];if(!n){let n;if(t.handlerArgs.forEach((t=>{t.name===e.name&&(n=t)})),n)return n}return n}return n?t.thisParameter:t.definitionNameToParam[e.name]}(e,r,u);if(u=!1,!o)return void console.error("block "+n.attributes.blockId+": unknown parameter "+e.name+(e.ref?` (${e.ref})`:""));if(function(e){return!e.definitionName}(o))return m="HANDLER_DRAG_PARAM_"+o.name,void(b="reporter"===n.attributes.draggableParameters?M(o.type,t):"Variable");let s=pxt.Util.lookup(t.apis.byQName,o.type);T=!0;const a=o.definitionName,l=o.actualName;let c=s&&6==s.kind,g=s&&!!s.attributes.fixedInstances&&!o.shadowBlockId,y=!!n.attributes.constantShim,v="@combined@"==o.type,E=o.fieldEditor,x=a.charAt(0).toUpperCase()+a.slice(1),w=o.type;if(c||g||y||v){let e;0==(e=c?function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.namespace===t&&!e.attributes.blockHidden))}(t.apis,o.type):g?$(t.apis,s.qName):v?n.combinedProperties.map((e=>pxt.Util.lookup(t.apis.byQName,e))):function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.attributes.blockIdentity===t))}(t.apis,n.qName)).length&&console.error(`no instances of ${s.qName} found`);const i=e.map((e=>{let t=e.attributes.block||e.attributes.blockId||e.name,n=e.attributes.blockCombine;return e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=f.convert(e.attributes.jresURL)),n&&(t=t.replace(/@set/,"")),[e.attributes.iconURL||e.attributes.blockImage?{src:e.attributes.iconURL||pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,`blocks/${e.namespace.toLowerCase()}/${e.name.toLowerCase()}.png`),alt:t,width:36,height:36,value:e.name}:t,e.namespace+"."+e.name]}));if(o.defaultValue){let e=-1;if(i.some(((t,n)=>t[1]===o.defaultValue&&(e=n,!0))),e>-1){const t=i.splice(e,1)[0];i.unshift(t)}}if(E){let e=n.attributes.paramDefl[l]||"";const r={data:i,colour:p,label:x,type:w,blocksInfo:t};pxt.Util.jsonMergeFrom(r,n.attributes.paramFieldEditorOptions&&n.attributes.paramFieldEditorOptions[l]||{}),h.push(F((0,_.createFieldEditor)(E,e,r),a))}else h.push(F(new C.FieldDropdown(i),a))}else if(E){const e=n.attributes.paramDefl[o.actualName]||"",i={colour:p,label:x,type:w,blocksInfo:t};pxt.Util.jsonMergeFrom(i,n.attributes.paramFieldEditorOptions&&n.attributes.paramFieldEditorOptions[o.actualName]||{}),h.push(F((0,_.createFieldEditor)(E,e,i),o.definitionName))}else m=a,d&&"this"===e.name?b=o.type:"number"==o.type&&o.shadowBlockId&&"value"==o.shadowBlockId?(m=void 0,h.push(F(new i.FieldNumber("0"),a))):b="string"==o.type&&o.shadowOptions&&o.shadowOptions.toString?null:M(o.type,t)}}})),m){if(g(m))return;(E=e.appendValueInput(m)).setAlign(i.ALIGN_LEFT)}else if(a){const t=T?o.optionalInputWithFieldPrefix:o.optionalDummyInputPrefix;if(m=t+l++,g(m))return;E=e.appendDummyInput(m)}else E=e.appendDummyInput();b&&E.setCheck(b),h.forEach((e=>E.appendField(e.field,e.name)))})),f.logTime()}e.setPreviousStatement(!(T&&!n.attributes.handlerStatement)&&"void"==n.retType),e.setNextStatement(!(T&&!n.attributes.handlerStatement)&&"void"==n.retType),e.setTooltip(/^__/.test(n.namespace)?"":n.attributes.jsDoc)}(this,e,t,n)}}};pxt.Util.isTranslationMode()&&(d.block.customContextMenu=e=>{t.attributes.translationId&&e.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,E.promptTranslateBlock)(l,[t.attributes.translationId])}})}),O[l]=d,i.Blocks[l]=d.block}(e,t,n,r);return t}))}function R(e){var t;return!!(null===(t=e.parameters)||void 0===t?void 0:t.some((e=>pxtc.parameterTypeIsArrowFunction(e))))}n.blockSymbol=function(e){let t=O[e];return t?t.fn:void 0},n.injectBlocks=N,n.hasArrowFunction=R,n.cleanBlocks=function(){pxt.debug("removing all custom blocks");for(const e in O)B(O[e].fn)},n.initializeAndInject=function(e){L(e),N(e)},n.initialize=function(e){L(e),function(e){j={};const t=e.apis.jres;t&&Object.keys(t).forEach((e=>{const n=t[e];n&&n.icon&&(j[e]=n.icon)}))}(e)};let D=!1;function L(e){D||(D=!0,(0,S.applyMonkeyPatches)(),(0,_.initFieldEditors)(),(0,w.initContextMenu)(),(0,x.initOnStart)(),(0,l.initMath)(e),(0,T.initVariables)(),(0,u.initFunctions)(),(0,d.initLists)(),(0,p.initLoops)(),(0,h.initLogic)(),(0,f.initText)(),i.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="",function(){const e=e=>{if(e.disabled)return lf("This block is disabled and will not run. Attach this block to an event to enable it.");let t=e.tooltip;for(;"function"==typeof t;)t=t(e);return t};i.Tooltip.setCustomTooltip(((t,n)=>{if(n.codeCard){const i=(0,k.renderCodeCard)({header:e(n)});t.appendChild(i)}else{let r=e(n),o=(r=i.utils.string.wrap(r,i.Tooltip.LIMIT)).split("\n");for(let e=0;e<o.length;e++){let n=document.createElement("div");n.appendChild(document.createTextNode(o[e])),t.appendChild(n)}}}))}())}function M(e,t){const n=e.split(/\s*\|\s*/),i=[];for(const e of n)switch(e){case"number":i.push("Number");break;case"string":i.push("String");break;case"boolean":i.push("Boolean");break;case"T":case"any":return null;case"void":return;default:if((0,g.isArrayType)(e)){if(n.length>1)return null;i.push("Array")}const r=t.apis.byQName[e];r&&r.extendsTypes&&0<r.extendsTypes.length?i.push(...r.extendsTypes):i.push(e)}return i}function P(e,t,n){const i=M(t,n);(i||null===i)&&e.setOutput(!0,i)}function B(e){delete i.Blocks[e.attributes.blockId],delete O[e.attributes.blockId]}n.setOutputCheck=P;let j={};function F(e,t){return{field:e,name:t}}function $(e,t){return pxt.Util.values(e.byQName).filter((n=>4===n.kind&&n.attributes.fixedInstance&&function(e,t,n){if(t==n)return!0;let i=e.byQName[t];return!(!i||!i.extendsTypes)&&i.extendsTypes.indexOf(n)>=0}(e,n.retType,t))).sort(((e,t)=>(t.attributes.weight||50)-(e.attributes.weight||50)))}n.getFixedInstanceDropdownValues=$,n.generateIcons=function(e){const t=new pxt.ImageConverter;e.forEach((e=>{e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=t.convert(e.attributes.jresURL))}))},n.setVarFieldValue=function(e,t,n){const i=e.getField(t),r=e.workspace.getAllVariables();let o=!1;if(r&&r.length)for(let e=0;e<r.length;e++){const t=r[e];t.name===n&&(i.setValue(t.getId()),o=!0)}if(!o){i.initModel();const e=i.getVariable();e.name=n,i.setValue(e.getId())}};class U extends r.WorkspaceSearch{}n.PxtWorkspaceSearch=U},{"./builtins/functions":3,"./builtins/lists":4,"./builtins/logic":5,"./builtins/loops":6,"./builtins/math":7,"./builtins/misc":8,"./builtins/text":9,"./builtins/variables":10,"./codecardRenderer":11,"./composableMutations":17,"./constants":18,"./contextMenu":21,"./external":24,"./fields":65,"./fields/field_dropdown":33,"./help":66,"./legacyMutations":70,"./monkeyPatches":73,"./toolbox":120,"@blockly/plugin-workspace-search":365,blockly:376}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.monkeyPatchBlockSvg=void 0;const i=e("blockly"),r=e("../plugins/renderer/constants");n.monkeyPatchBlockSvg=function(){const e=i.BlockSvg.prototype.setCollapsed;i.BlockSvg.prototype.setCollapsed=function(t){if(t!==this.isCollapsed()&&(e.call(this,t),this.isCollapsed())){const e=this.getInput(i.constants.COLLAPSED_INPUT_NAME),t=r.ConstantProvider.EXPAND_IMAGE_DATAURI;t&&e.appendField(new i.FieldImage(t,24,24,"",(()=>{this.setCollapsed(!1)}),!1))}}}},{"../plugins/renderer/constants":108,blockly:376}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.applyMonkeyPatches=void 0;const i=e("./blockSvg");n.applyMonkeyPatches=function(){(0,i.monkeyPatchBlockSvg)()}},{"./blockSvg":72}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("../functions/constants"),o={valueConnections_:[],horizontalAfter_:3,itemCount_:3,mutationToDom:function(){const e=i.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),this.horizontalAfter_&&e.setAttribute("horizontalafter",this.horizontalAfter_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10);const t=e.getAttribute("horizontalafter");t&&(this.horizontalAfter_=parseInt(t,10)),this.updateShape_()},storeConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreConnections_(),this.itemCount_>1){const o=this.getInput("ADD0");if(o&&o.connection.targetConnection){const s=this.getInput("ADD"+(this.itemCount_-1)),a=o.connection.getShadowDom(),l=a&&a.getAttribute("type");if(l){const i=n("shadow",l),r=e(a,"value");for(let n=0;n<r.length;n++){const o=r[n],s=o.getAttribute("name"),a=e(o,"shadow")[0];t(i,s,a&&a.getAttribute("type"))}s.connection.setShadowDom(i)}const c=o.connection.targetConnection,u=c&&c.getSourceBlock(),d=u&&u.type;if(d&&d!==l){const e=n("block",d);if(u)if(d===r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=i.utils.xml.createElement("mutation");t.setAttribute("name",u.getName()),e.appendChild(t)}else if(u.inputList)for(let n=0;n<u.inputList.length;n++){const i=u.inputList[n],r=i.connection&&i.connection.getShadowDom(),o=r&&r.getAttribute("type");t(e,i.name,o)}const o=i.Xml.domToBlock(e,this.workspace);s.connection.connect(o.outputConnection)}else s.connection.setShadowDom(s.connection.getShadowDom())}}function e(e,t){const n=[];if(!e||!e.children)return n;for(let i=0;i<e.children.length;i++){const r=e.children[i];r.tagName===t&&n.push(r)}return n}function t(e,t,r){if(!t||!r)return;const o=i.utils.xml.createElement("value");o.setAttribute("name",t),o.appendChild(n("shadow",r)),e.appendChild(o)}function n(e,t){const n=i.utils.xml.createElement(e);return n.setAttribute("type",t),n.setAttribute("id",i.utils.idGenerator.genUid()),n}},removeItem_:function(){this.storeConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreConnections_()},update_:function(e){i.Events.setGroup(!0);const t=this,n=t.mutationToDom(),r=n&&i.Xml.domToText(n),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof i.BlockSvg&&t.initSvg();const s=i.Events.getGroup(),a=t.mutationToDom(),l=a&&i.Xml.domToText(a);r!=l&&(i.Events.fire(new i.Events.BlockChange(t,"mutation",null,r,l)),setTimeout((function(){i.Events.setGroup(s),t.bumpNeighbours(),i.Events.setGroup(!1)}),i.config.bumpDelay)),t.rendered&&t instanceof i.BlockSvg&&t.render(),i.Events.setGroup(!1)},updateShape_:function(){this.itemCount_?(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(i.Msg.LISTS_CREATE_WITH_INPUT_WITH)):(this.getInput("TITLE")&&this.removeInput("TITLE"),this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(i.Msg.LISTS_CREATE_EMPTY_TITLE));let e=0;for(e=0;e<this.itemCount_;e++)this.getInput("ADD"+e)||this.appendValueInput("ADD"+e);for(;this.getInput("ADD"+e);)this.removeInput("ADD"+e),e++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const t=this.appendDummyInput("BUTTONS");this.itemCount_>0&&t.appendField(new i.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(()=>{this.removeItem_()}),!1)),t.appendField(new i.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(()=>{this.addItem_()}),!1));const n=this.itemCount_<=this.horizontalAfter_;if(this.setInputsInline(n),this.workspace instanceof i.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(n?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};i.Blocks.lists_create_with=Object.assign(Object.assign({},o),{init:function(){if(i.Extensions.apply("inline-svgs",this,!1),this.setHelpUrl(i.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.updateShape_(),this.setOutput(!0,"Array"),this.workspace instanceof i.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.ROUND)}this.setInputsInline(!0),this.setTooltip(i.Msg.LISTS_CREATE_WITH_TOOLTIP)}})},{"../functions/constants":88,blockly:376}],75:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./createList"),n)},{"./createList":74}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DuplicateOnDragConnectionChecker=void 0;const i=e("blockly"),r=e("./duplicateOnDrag"),o=[];o[i.ConnectionType.INPUT_VALUE]=i.ConnectionType.OUTPUT_VALUE,o[i.ConnectionType.OUTPUT_VALUE]=i.ConnectionType.INPUT_VALUE,o[i.ConnectionType.NEXT_STATEMENT]=i.ConnectionType.PREVIOUS_STATEMENT,o[i.ConnectionType.PREVIOUS_STATEMENT]=i.ConnectionType.NEXT_STATEMENT;class s extends i.ConnectionChecker{doDragChecks(e,t,n){if(!super.doDragChecks(e,t,n))return!1;const i=t.targetBlock();return!i||!(0,r.isDuplicateOnDragBlock)(i)}doSafetyChecks(e,t){if(!e||!t)return i.Connection.REASON_TARGET_NULL;let n,r,s,a;return e.isSuperior()?(n=e.getSourceBlock(),r=t.getSourceBlock(),s=e,a=t):(r=e.getSourceBlock(),n=t.getSourceBlock(),a=e,s=t),n===r?i.Connection.REASON_SELF_CONNECTION:a.type!==o[s.type]?i.Connection.REASON_WRONG_TYPE:n.workspace!==r.workspace?i.Connection.REASON_DIFFERENT_WORKSPACES:a.type===i.ConnectionType.OUTPUT_VALUE&&r.previousConnection&&r.previousConnection.isConnected()||a.type===i.ConnectionType.PREVIOUS_STATEMENT&&r.outputConnection&&r.outputConnection.isConnected()?i.Connection.REASON_PREVIOUS_AND_OUTPUT:i.Connection.CAN_CONNECT}}n.DuplicateOnDragConnectionChecker=s},{"./duplicateOnDrag":77,blockly:376}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isDuplicateOnDragBlock=n.DuplicateOnDragBlockDragger=n.DUPLICATE_ON_DRAG_MUTATION_KEY=void 0;const i=e("blockly");n.DUPLICATE_ON_DRAG_MUTATION_KEY="duplicateondrag";class r extends i.BlockDragger{disconnectBlock_(e,t){var r,o,s;let a,l;const c=this.draggingBlock_.mutationToDom&&this.draggingBlock_.mutationToDom();if("true"===(null===(r=null==c?void 0:c.getAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===r?void 0:r.toLowerCase())){const e=this.draggingBlock_.outputConnection;if(!(null==e?void 0:e.targetConnection))return;a=i.Xml.domToBlock(i.Xml.blockToDom(this.draggingBlock_,!0),this.workspace_),l=e.targetConnection}super.disconnectBlock_(e,t),a&&l&&(l.connect(a.outputConnection),c.setAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY,"false"),null===(s=(o=this.draggingBlock_).domToMutation)||void 0===s||s.call(o,c))}}n.DuplicateOnDragBlockDragger=r,n.isDuplicateOnDragBlock=function(e){var t,i,r;return"true"===(null===(r=null===(i=null===(t=e.mutationToDom)||void 0===t?void 0:t.call(e))||void 0===i?void 0:i.getAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===r?void 0:r.toLowerCase())}},{blockly:376}],78:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./duplicateOnDrag"),n),r(e("./variablesGetReporter"),n),r(e("./connectionChecker"),n)},{"./connectionChecker":76,"./duplicateOnDrag":77,"./variablesGetReporter":79}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("./duplicateOnDrag"),o={duplicateOnDrag_:!1,mutationToDom(){const e=i.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_))}};i.Extensions.registerMutator("variables_get_reporter_mutator",o),i.defineBlocksWithJsonArray([{type:"variables_get_reporter",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,colour:"%{BKY_VARIABLES_HUE}",outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableReporter"],mutator:"variables_get_reporter_mutator"}])},{"./duplicateOnDrag":77,blockly:376}],80:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./verticalFlyout"),n)},{"./verticalFlyout":81}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VerticalFlyout=void 0;const i=e("blockly");n.VerticalFlyout=class{constructor(e){this.options=e,this.horizontalLayout=!1,this.autoClose=!0,this.cached=[],this.dummyWorkspace=new i.WorkspaceSvg(e)}createDom(e){return this.element||(this.dummyWorkspace.createDom(),this.element=i.utils.dom.createSvgElement(e,{class:"blocklyFlyout"}),this.element.id="multiFlyout",this.element.style.display="none"),this.element}init(e){this.targetWorkspace=e}dispose(){for(const e of this.cached)e.dispose()}getWidth(){return this.activeFlyout?this.activeFlyout.getWidth():0}getHeight(){return this.activeFlyout?this.activeFlyout.getHeight():0}getWorkspace(){return this.activeFlyout?this.activeFlyout.getWorkspace():this.dummyWorkspace}isVisible(){return this.visible}setVisible(e){if(e!==this.visible){this.visible=e,this.element.style.display=e?"block":"none";for(const e of this.cached)e!==this.activeFlyout&&e.isVisible()&&e.setVisible(!1);this.activeFlyout&&this.activeFlyout.setVisible(e)}}setContainerVisible(e){if(this.containerVisible!==e){this.containerVisible=e;for(const t of this.cached)t.setContainerVisible(e)}}hide(){this.activeFlyout&&this.activeFlyout.hide(),this.setVisible(!1)}show(e,t){const n=t||this.hashBlocks(e);this.activeFlyout&&this.activeFlyout.hide();const i=this.cached.find((e=>e.key===n));if(this.element.style.display="block",this.visible=!0,i)return this.activeFlyout=i,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),void this.activeFlyout.show(e);this.activeFlyout=new r(this.options),this.cached.push(this.activeFlyout),this.element.appendChild(this.activeFlyout.createDom("g")),this.activeFlyout.init(this.targetWorkspace),this.activeFlyout.key=n,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),this.activeFlyout.show(e)}createBlock(e){if(this.activeFlyout)return this.activeFlyout.createBlock(e)}reflow(){this.activeFlyout&&this.activeFlyout.reflow()}isScrollable(){return!this.activeFlyout||this.activeFlyout.isScrollable()}getX(){return this.activeFlyout?this.activeFlyout.getX():0}getY(){return this.activeFlyout?this.activeFlyout.getY():0}position(){this.activeFlyout&&this.activeFlyout.position()}isDragTowardWorkspace(e){return!!this.activeFlyout&&this.activeFlyout.isDragTowardWorkspace(e)}isBlockCreatable(e){return!!this.activeFlyout&&this.activeFlyout.isBlockCreatable(e)}scrollToStart(){this.activeFlyout&&this.activeFlyout.scrollToStart()}blocksToString(e){let t=null;return e.map((e=>e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e")).reduce(((e,t)=>e+t),"")}hashBlocks(e){if(Array.isArray(e))return pxt.Util.codalHash16(this.blocksToString(e))}};class r extends i.VerticalFlyout{constructor(e){super(e),this.options=e,this.buttonListeners=[]}show(e){Array.isArray(e)&&(this.def=e.slice()),super.show(e)}blockIsRecyclable_(e){switch(e.type){case"variables_get":case"variables_set":case"variables_change":return!1}return!0}initFlyoutButton_(e,t,n){const r=i.FlyoutButton.TEXT_MARGIN_X,o=i.FlyoutButton.TEXT_MARGIN_Y;e.isLabel()||(i.FlyoutButton.TEXT_MARGIN_X=17.5,i.FlyoutButton.TEXT_MARGIN_Y=14);const s=e.createDom();if(e.moveTo(t,n),e.show(),this.buttonListeners.push(i.browserEvents.conditionalBind(s,"pointerdown",this,this.onButtonMouseDown)),this.buttons_.push(e),i.FlyoutButton.TEXT_MARGIN_X=r,i.FlyoutButton.TEXT_MARGIN_Y=o,!this.def)return;const a=this.def.find((t=>t.getAttribute("text")===e.getButtonText()));if(this.def.splice(this.def.indexOf(a),1),!a)return;a.hasAttribute("web-class")&&s.classList.add(a.getAttribute("web-class"));const l=a.getAttribute("web-icon"),c=a.getAttribute("web-icon-class"),u=a.getAttribute("web-icon-color");if(l||c){const t=i.utils.dom.createSvgElement("text",{class:c?"blocklyFlyoutLabelIcon "+c:"blocklyFlyoutLabelIcon",x:0,y:0,"text-anchor":"start"},s);l&&(t.textContent=l),u&&t.setAttribute("style","fill: "+u);const n=e.getTargetWorkspace();t.setAttribute("dominant-baseline","central"),t.setAttribute("dy","0"),t.setAttribute("x",(n.RTL?e.width+i.FlyoutButton.TEXT_MARGIN_X:0)+""),t.setAttribute("y",e.height/2+i.FlyoutButton.TEXT_MARGIN_Y+"");const r=i.utils.dom.getTextWidth(t)+2*i.FlyoutButton.TEXT_MARGIN_X;e.width+=r;for(let e=0;e<s.children.length;e++){const n=s.children.item(e);if(n!==t){const e=Number(n.getAttribute("x"));n.setAttribute("x",e+r+"")}}}const d=a.getAttribute("web-line"),h=a.getAttribute("web-line-width");if(d){const t=i.utils.dom.createSvgElement("line",{class:"blocklyFlyoutLine","stroke-dasharray":d,"text-anchor":"middle"},s);t.setAttribute("x1","0"),t.setAttribute("x2",null!=h?h:e.width+""),t.setAttribute("y1",e.height+10+""),t.setAttribute("y2",e.height+10+"")}}onButtonMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}}},{blockly:376}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("../constants"),o={typeName_:"",getTypeName(){return this.typeName_},removeFieldCallback(e){const t=this.getParent();(null==t?void 0:t.removeFieldCallback)&&t.removeFieldCallback(e)}};i.Blocks[r.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"bool"}],extensions:["output_boolean","text_field_color"]}),this.typeName_="boolean"}}),i.Blocks[r.ARGUMENT_EDITOR_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"text"}],extensions:["output_string","text_field_color"]}),this.typeName_="string"}}),i.Blocks[r.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"num"}],extensions:["output_number","text_field_color"]}),this.typeName_="number"}}),i.Blocks[r.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"list"}],extensions:["output_array","text_field_color"]}),this.typeName_="Array"}}),i.Blocks[r.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"arg"}],outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,extensions:["text_field_color"]}),this.typeName_="any"},mutationToDom(){const e=i.utils.xml.createElement("mutation");return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_)}})},{"../constants":88,blockly:376}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("../constants"),o=e("../msg"),s=e("../../duplicateOnDrag"),a={typeName_:"",duplicateOnDrag_:!1,getTypeName(){return this.typeName_},mutationToDom(){const e=i.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(s.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_))}};i.Blocks[r.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:i.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_boolean"]}),this.typeName_="boolean"}}),i.Blocks[r.ARGUMENT_REPORTER_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:i.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_string"]}),this.typeName_="string"}}),i.Blocks[r.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:i.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_number"]}),this.typeName_="number"}}),i.Blocks[r.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:i.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_array"]}),this.typeName_="Array"}}),i.Blocks[r.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:i.Msg[o.MsgKey.REPORTERS_HUE],inputsInline:!0,outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,output:null}),this.typeName_=""},mutationToDom(){const e=a.mutationToDom.call(this);return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_),a.domToMutation.call(this,e),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_)}})},{"../../duplicateOnDrag":78,"../constants":88,"../msg":94,blockly:376}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("../commonFunctionMixin"),o=e("../constants"),s=e("../utils"),a=e("../msg"),l=Object.assign(Object.assign({},r.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,n){let r=null,o=null;if(t&&e.id in t){const n=t[e.id];r=n.block,o=n.shadow}const s=null==r?void 0:r.workspace.connectionChecker;i.Events.disable();try{if(r&&!r.isDisposed()&&t&&(null==s?void 0:s.canConnectWithReason(null==r?void 0:r.outputConnection,n.connection,!1))===i.Connection.CAN_CONNECT){let s;r.outputConnection.connect(n.connection),"variables_get"!==(s=r.isShadow()?i.Xml.blockToDom(r):o||this.buildShadowDom_(e.type)).getAttribute("type")&&n.connection.setShadowDom(s),delete t[n.name]}else this.attachShadow_(n,e.type)}finally{i.Events.enable()}},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==i.inputTypes.VALUE)continue;const n=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();n&&n.isShadow()&&n.getVarModels().length&&n.setShadow(!1);const r=t.connection&&t.getShadowDom();(0,s.isVariableBlockType)(null==r?void 0:r.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){this.appendDummyInput("function_name").appendField(new i.FieldLabel(e,"functionNameText"),"function_name")},updateFunctionLabel_:function(e){this.getField("function_name").setValue(e)},attachShadow_(e,t){const n=(0,s.getShadowBlockInfoFromType_)(t,this.workspace),r=n[0],o=n[1],a=n[2];i.Events.disable();let l=null;try{(l=this.workspace.newBlock(r)).setFieldValue(a,o),l.setShadow("variables_get"!==r),!this.isInsertionMarker()&&l instanceof i.BlockSvg&&(l.initSvg(),l.render())}finally{i.Events.enable()}l&&(l.setShadow(!0),l.outputConnection.connect(e.connection))},buildShadowDom_(e){const t=i.utils.xml.createElement("shadow"),n=(0,s.getShadowBlockInfoFromType_)(e,this.workspace),r=n[0],o=n[1],a=n[2],l="variables_get"===r;t.setAttribute("type",r);const c=i.utils.xml.createElement("field");if(c.textContent=a,l){c.setAttribute("id",a);const e=this.workspace.getVariableById(a);c.textContent=e?e.name:""}return c.setAttribute("name",o),t.appendChild(c),t},onchange(e){var t;if(this.workspace&&!this.workspace.isFlyout)if(e.type==i.Events.BLOCK_CREATE&&-1!=(null===(t=e.ids)||void 0===t?void 0:t.indexOf(this.id))){const t=this.getName(),n=(0,s.getDefinition)(t,this.workspace);if(n){const e=n.getArguments().slice(),t=this.arguments_.slice();JSON.stringify(t)!==JSON.stringify(e)&&(0,s.mutateCallersAndDefinition)(n.getName(),this.workspace,n.mutationToDom()),this.functionId_=n.functionId_}else{i.Events.setGroup(e.group);const t=i.utils.xml.createElement("xml"),n=i.utils.xml.createElement("block");n.setAttribute("type",o.FUNCTION_DEFINITION_BLOCK_TYPE);const r=this.getRelativeToSurfaceXY(),s=r.x+i.config.snapRadius*(this.RTL?-1:1),a=r.y+2*i.config.snapRadius;n.setAttribute("x",s+""),n.setAttribute("y",a+"");const l=this.mutationToDom();n.appendChild(l),t.appendChild(n),i.Xml.domToWorkspace(t,this.workspace),i.Events.setGroup(!1)}}else if(e.type==i.Events.BLOCK_DELETE){const t=this.getName();(0,s.getDefinition)(t,this.workspace)||(i.Events.setGroup(e.group),this.dispose(!0),i.Events.setGroup(!1))}}});i.Blocks[o.FUNCTION_CALL_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(i.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(i.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(i.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}}),i.Blocks[o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0,null),this.setOutputShape((new i.zelos.ConstantProvider).SHAPES.ROUND),this.setColour(i.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(i.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(i.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}})},{"../commonFunctionMixin":87,"../constants":88,"../msg":94,"../utils":96,blockly:376}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.newFunctionMutation=void 0;const i=e("blockly"),r=e("../commonFunctionMixin"),o=e("../constants"),s=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../functionManager"),c=e("../msg"),u=Object.assign(Object.assign({},r.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,n){const i=this.createArgumentEditor_(e.type,e.name);n.connection.connect(i.outputConnection)},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",void 0,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){i.Events.disable(),this.getField("function_name").setValue(e),i.Events.enable()},createArgumentEditor_:function(e,t){let n;i.Events.disable();try{let r="";switch(e){case"boolean":r=o.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE;break;case"number":r=o.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE;break;case"string":r=o.ARGUMENT_EDITOR_STRING_BLOCK_TYPE;break;case"Array":r=o.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE;break;default:r=o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE}(n=r==o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE?(0,s.createCustomArgumentEditor)(e,this.workspace):this.workspace.newBlock(r)).setFieldValue(t,"TEXT"),n.setShadow(!0),!this.isInsertionMarker()&&n instanceof i.BlockSvg&&(n.initSvg(),n.render())}finally{i.Events.enable()}return n},focusLastEditor_(){if(this.inputList.length>0){let e=this.inputList[this.inputList.length-2];if(e.type==i.inputTypes.DUMMY){const t=this.workspace;t instanceof i.WorkspaceSvg&&t.centerOnBlock(this.id),e.fieldRow[0].showEditor()}else if(e.type==i.inputTypes.VALUE){const t=e.connection.targetBlock(),n=t.workspace;n instanceof i.WorkspaceSvg&&n.centerOnBlock(t.id),t.getField("TEXT").showEditor()}}},removeFieldCallback(e){let t=null;for(let n=0;n<this.inputList.length&&!t;n++){let i=this.inputList[n];if(i.connection){let n=i.connection.targetBlock();if(!n)continue;n.getField(e.name)===e&&(t=i.name)}else for(let n=0;n<i.fieldRow.length;n++)i.fieldRow[n]==e&&(t=i.name)}t&&(i.WidgetDiv.hide(),this.removeInput(t),this.updateFunctionSignature(),this.updateDisplay_())},addParam_(e,t){i.WidgetDiv.hide();const n=(0,s.findUniqueParamName)(t,this.arguments_.map((e=>e.name)));this.arguments_.push({id:i.utils.idGenerator.genUid(),name:n,type:e}),this.updateDisplay_(),this.focusLastEditor_()},addBooleanExternal(){this.addParam_("boolean",i.Msg[c.MsgKey.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME])},addStringExternal(){this.addParam_("string",i.Msg[c.MsgKey.FUNCTIONS_DEFAULT_STRING_ARG_NAME])},addNumberExternal(){this.addParam_("number",i.Msg[c.MsgKey.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME])},addArrayExternal(){this.addParam_("Array",i.Msg[c.MsgKey.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME])},addCustomExternal(e){this.addParam_(e,l.FunctionManager.getInstance().getArgumentNameForType(e))},updateFunctionSignature(){this.arguments_=[];for(let e=1;e<this.inputList.length;e++){const t=this.inputList[e];switch(t.type){case i.inputTypes.STATEMENT:break;case i.inputTypes.DUMMY:this.name_=t.fieldRow[0].getValue()||t.fieldRow[0].getText();break;case i.inputTypes.VALUE:const e=t.connection.targetBlock();this.arguments_.push({id:t.name,name:e.getFieldValue("TEXT"),type:e.getTypeName()});break;default:console.warn("Unexpected input type on a function mutator root: "+t.type)}}}});n.newFunctionMutation=function(e){const t=(0,s.findLegalName)(i.Msg[c.MsgKey.FUNCTIONS_DEFAULT_FUNCTION_NAME],e),n=i.utils.xml.createElement("mutation");return n.setAttribute("name",t),n.setAttribute("functionid",i.utils.idGenerator.genUid()),n},i.Blocks[o.FUNCTION_DECLARATION_BLOCK_TYPE]=Object.assign(Object.assign({},u),{init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(i.Msg[c.MsgKey.PROCEDURES_HUE]),this.setStatements_(!0),this.setDeletable(!1),this.setMovable(!1),this.contextMenu=!1,this.setInputsInline(!0)}})},{"../commonFunctionMixin":87,"../constants":88,"../fields/fieldAutocapitalizeTextInput":91,"../functionManager":92,"../msg":94,"../utils":96,blockly:376}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("../commonFunctionMixin"),o=e("../constants"),s=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../msg"),c=e("../functionManager"),u=e("../svgs"),d=e("../../duplicateOnDrag"),h=Object.assign(Object.assign({},r.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,n){let i,r=null;(null==t?void 0:t[e.id])&&(r=t[e.id].block),t&&r&&!r.isDisposed()?((i=r).setFieldValue(e.name,"VALUE"),delete t[n.name]):i=this.createArgumentReporter_(e),i.duplicateOnDrag_=!0,n.connection.connect(i.outputConnection)},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==i.inputTypes.VALUE)continue;const n=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();(null==n?void 0:n.isShadow())&&n.mutationToDom&&n.mutationToDom().getAttribute(d.DUPLICATE_ON_DRAG_MUTATION_KEY)&&n.setShadow(!1);const r=t.connection&&t.getShadowDom();(0,s.isVariableBlockType)(null==r?void 0:r.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",s.rename,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){i.Events.disable(),this.getField("function_name").setValue(e),i.Events.enable()},createArgumentReporter_:function(e){let t,n="";switch(e.type){case"boolean":n=o.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE;break;case"number":n=o.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE;break;case"string":n=o.ARGUMENT_REPORTER_STRING_BLOCK_TYPE;break;case"Array":n=o.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE;break;default:n=o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}i.Events.disable();try{(t=n==o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE?(0,s.createCustomArgumentReporter)(e.type,this.workspace):this.workspace.newBlock(n)).setFieldValue(e.name,"VALUE"),t.setShadow(!0),!this.isInsertionMarker()&&t instanceof i.BlockSvg&&(t.initSvg(),t.render())}finally{i.Events.enable()}return t},customContextMenu:function(e){var t,n;this.isInFlyout||(null===(n=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===n?void 0:n.readOnly)||(e.push(this.makeEditOption()),e.push(this.makeCallOption()))},makeEditOption:function(){var e,t;return{enabled:!(null===(t=null===(e=this.workspace)||void 0===e?void 0:e.options)||void 0===t?void 0:t.readOnly),text:i.Msg.FUNCTIONS_EDIT_OPTION,callback:()=>{!function(e){if(e.type==o.FUNCTION_CALL_BLOCK_TYPE||e.type==o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=e.workspace;e=(0,s.getDefinition)(e.getName(),t)}i.hideChaff(),i.getSelected()&&i.getSelected().unselect(),c.FunctionManager.getInstance().editFunctionExternal(e.mutationToDom(),(t=>{t&&((0,s.mutateCallersAndDefinition)(e.getName(),e.workspace,t),e.updateDisplay_()),setTimeout((()=>{e.afterWorkspaceLoad&&e.afterWorkspaceLoad()}))}))}(this)}}},makeCallOption:function(){var e,t;const n=this.getName(),r=i.utils.xml.createElement("mutation");r.setAttribute("name",n);const s=i.utils.xml.createElement("block");return s.appendChild(r),s.setAttribute("type",o.FUNCTION_CALL_BLOCK_TYPE),{enabled:this.workspace.remainingCapacity()>0&&!(null===(t=null===(e=this.workspace)||void 0===e?void 0:e.options)||void 0===t?void 0:t.readOnly),text:i.Msg.FUNCTIONS_CREATE_CALL_OPTION.replace("%1",n),callback:i.ContextMenu.callbackFactory(this,s)}}});i.Blocks[o.FUNCTION_DEFINITION_BLOCK_TYPE]=Object.assign(Object.assign({},h),{init:function(){if(this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(i.Msg[l.MsgKey.PROCEDURES_HUE]),this.setTooltip(i.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_TOOLTIP]),this.setHelpUrl(i.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_HELPURL]),this.setStatements_(!0),this.setInputsInline(!0),this.workspace.options.collapse){const e=u.COLLAPSE_IMAGE_DATAURI;this.appendDummyInput("function_collapse").appendField(new i.FieldImage(e,24,24,"",(()=>{this.setCollapsed(!0)}),!1))}}})},{"../../duplicateOnDrag":78,"../commonFunctionMixin":87,"../constants":88,"../fields/fieldAutocapitalizeTextInput":91,"../functionManager":92,"../msg":94,"../svgs":95,"../utils":96,blockly:376}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.COMMON_FUNCTION_MIXIN=void 0;const i=e("blockly"),r=e("./constants"),o=e("./utils"),s=e("./msg");n.COMMON_FUNCTION_MIXIN={name_:"",functionId_:"",arguments_:[],mutationToDom:function(){this.ensureIds_();const e=i.utils.xml.createElement("mutation");return e.setAttribute("name",this.name_),e.setAttribute("functionid",this.functionId_),this.arguments_.forEach((function(t){const n=i.utils.xml.createElement("arg");n.setAttribute("name",t.name),n.setAttribute("id",t.id),n.setAttribute("type",t.type),e.appendChild(n)})),e},domToMutation:function(e){const t=[];for(let n=0;n<e.childNodes.length;++n){const i=e.childNodes[n];"arg"==i.nodeName.toLowerCase()&&t.push({id:i.getAttribute("id"),name:i.getAttribute("name"),type:i.getAttribute("type")})}this.arguments_=t,this.name_=e.getAttribute("name"),this.restoreSavedFunctionId(e.getAttribute("functionid"))},saveExtraState:function(){return{name:this.name_,functionid:this.functionId_,arguments:this.arguments_.slice()}},loadExtraState:function(e){this.arguments_=e.arguments.slice(),this.name_=e.name,this.restoreSavedFunctionId(e.functionid)},restoreSavedFunctionId:function(e){(0,o.idsInUse)(this.workspace).indexOf(e)<0&&(this.functionId_=e),this.ensureIds_();let t=null;this instanceof i.BlockSvg&&(t=this.getHeightWidth()),this.type!==r.FUNCTION_DEFINITION_BLOCK_TYPE||t&&!t.height&&!t.width?this.updateDisplay_():!this.getFieldValue("function_name")&&this.name_&&(this.setFieldValue(this.name_,"function_name"),this.updateDisplay_())},getName:function(){return this.name_},getFunctionId:function(){return this.functionId_},getArguments:function(){return this.arguments_},removeValueInputs_:function(){const e=[];for(let t,n=0;t=this.inputList[n];n++)t.type==i.inputTypes.VALUE?t.dispose():e.push(t);this.inputList=e},disconnectOldBlocks_:function(){let e={};for(let t,n=0;t=this.inputList[n];n++)if("STACK"!==t.name&&t.connection){let n=t.connection.targetBlock(),i={shadow:t.connection.getShadowDom(),block:n};e[t.name]=i,t.connection.setShadowDom(null),t.connection.targetConnection&&t.connection.disconnect()}return e},deleteShadows_:function(e){if(e)for(let t in e){let n=e[t];if(n){const i=n.block;(null==i?void 0:i.isShadow())&&(i.dispose(!1),delete e[t])}}},createAllInputs_:function(e){let t=!1,n=!1,a=!1;if(this.inputList.forEach((function(e){"function_title"==e.name?t=!0:"function_name"==e.name?n=!0:"function_collapse"==e.name&&(a=!0)})),!t){let e="";switch(this.type){case r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case r.FUNCTION_CALL_BLOCK_TYPE:e=i.Msg[s.MsgKey.FUNCTIONS_CALL_TITLE];break;case r.FUNCTION_DEFINITION_BLOCK_TYPE:case r.FUNCTION_DECLARATION_BLOCK_TYPE:e=i.Msg[s.MsgKey.FUNCTIONS_DEFNORETURN_TITLE]}this.appendDummyInput("function_title").appendField(e,"function_title")}n?this.updateFunctionLabel_(this.getName()):this.addFunctionLabel_(this.getName());let l=this;this.arguments_.forEach((function(t){let n=l.appendValueInput(t.id);(0,o.isCustomType)(t.type)?n.setCheck(t.type):n.setCheck(t.type.charAt(0).toUpperCase()+t.type.slice(1)),l.isInsertionMarker()||l.populateArgument_(t,e,n)})),a&&this.moveInputBefore("function_collapse",null),this.hasStatements_&&this.moveInputBefore("STACK",null)},updateDisplay_:function(){let e=this.rendered;this.rendered=!1;let t=this.disconnectOldBlocks_();this.removeValueInputs_(),this.createAllInputs_(t),this.deleteShadows_(t),this.rendered=e,e&&!this.isInsertionMarker()&&this instanceof i.BlockSvg&&(this.initSvg(),this.render())},setStatements_:function(e){this.hasStatements_!==e&&(e?this.appendStatementInput("STACK"):this.removeInput("STACK",!0),this.hasStatements_=e)},ensureIds_:function(){switch(this.type){case r.FUNCTION_DEFINITION_BLOCK_TYPE:this.functionId_&&"null"!=this.functionId_||(this.functionId_=i.utils.idGenerator.genUid());for(let e=0;e<this.arguments_.length;++e)this.arguments_[e].id||(this.arguments_[e].id=i.utils.idGenerator.genUid());break;case r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case r.FUNCTION_CALL_BLOCK_TYPE:const e=(0,o.getDefinition)(this.name_,this.workspace);if(e){this.functionId_=e.getFunctionId();const t=e.getArguments();for(let e=0;e<this.arguments_.length;++e)for(let n=0;n<t.length;++n)if(t[n].name==this.arguments_[e].name){this.arguments_[e].id=t[n].id;break}}}}}},{"./constants":88,"./msg":94,"./utils":96,blockly:376}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE=n.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE=n.ARGUMENT_EDITOR_STRING_BLOCK_TYPE=n.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE=n.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE=n.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE=n.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE=n.ARGUMENT_REPORTER_STRING_BLOCK_TYPE=n.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE=n.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE=n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE=n.FUNCTION_CALL_BLOCK_TYPE=n.FUNCTION_DECLARATION_BLOCK_TYPE=n.FUNCTION_DEFINITION_BLOCK_TYPE=void 0,n.FUNCTION_DEFINITION_BLOCK_TYPE="function_definition",n.FUNCTION_DECLARATION_BLOCK_TYPE="function_declaration",n.FUNCTION_CALL_BLOCK_TYPE="function_call",n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE="function_call_output",n.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE="argument_reporter_boolean",n.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE="argument_reporter_number",n.ARGUMENT_REPORTER_STRING_BLOCK_TYPE="argument_reporter_string",n.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE="argument_reporter_array",n.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE="argument_reporter_custom",n.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE="argument_editor_boolean",n.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE="argument_editor_number",n.ARGUMENT_EDITOR_STRING_BLOCK_TYPE="argument_editor_string",n.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE="argument_editor_array",n.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE="argument_editor_custom"},{}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=e("./utils"),o=e("./msg"),s=e("./svgs"),a=new i.zelos.ConstantProvider;const l={customContextMenu:function(e){var t,n;const s={enabled:!(null===(n=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===n?void 0:n.readOnly),text:i.Msg[o.MsgKey.FUNCTIONS_GO_TO_DEFINITION_OPTION],callback:()=>{const e=this.getField("function_name").getText(),t=(0,r.getDefinition)(e,this.workspace);t&&this.workspace instanceof i.WorkspaceSvg&&this.workspace.centerOnBlock(t.id)}};e.push(s)}},c={customContextMenu:function(e){if(this.isCollapsed())return;const t={text:i.Msg.RENAME_VARIABLE,enabled:!this.workspace.options.readOnly,callback:()=>{const e=this.workspace,t=this.getField("VAR").getVariable();i.Variables.renameVariable(e,t)}};if(e.unshift(t),!this.isInFlyout){const t=this.workspace.getVariablesOfType("");for(const n of t){const t={enabled:!this.workspace.options.readOnly,text:n.name,callback:()=>{let e=this.getField("VAR");e||console.log("Tried to get a variable field on the wrong type of block."),e.setValue(n.getId())}};e.unshift(t)}}}};i.Extensions.registerMixin("function_contextmenu_edit",l),i.Extensions.registerMixin("contextMenu_variableReporter",c),i.Extensions.register("output_number",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Number")})),i.Extensions.register("output_string",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"String")})),i.Extensions.register("output_boolean",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.HEXAGONAL),this.setOutput(!0,"Boolean")})),i.Extensions.register("output_array",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Array")})),i.Extensions.register("text_field_color",(function(){if(this.workspace instanceof i.WorkspaceSvg){const e=this.workspace.getRenderer().getConstants();this.setColour(e.FIELD_BORDER_RECT_COLOUR)}else this.setColour("#fff")})),i.Extensions.register("inline-svgs",(function(){this.ADD_IMAGE_DATAURI=s.ADD_IMAGE_DATAURI,this.REMOVE_IMAGE_DATAURI=s.REMOVE_IMAGE_DATAURI}))},{"./msg":94,"./svgs":95,"./utils":96,blockly:376}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldArgumentEditor=void 0;const i=e("blockly"),r=e("../functionManager");class o extends i.FieldTextInput{constructor(e,t,n){super(e,t,n),this.typeName=n.typeName}showEditor(e){var t;super.showEditor(e);const n=i.WidgetDiv.getDiv();n.className+=" argumentEditorInput";const s=document.createElement("img");if(s.setAttribute("class","argumentEditorRemoveIcon"),s.setAttribute("src",o.REMOVE_ARG_URI),this.removeButtonMouseWrapper_=i.browserEvents.conditionalBind(s,"mousedown",this,this.removeCallback),n.appendChild(s),this.typeName&&(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)){const e=r.FunctionManager.getInstance().getIconForType(this.typeName);if(e){const t=e+" icon argumentEditorTypeIcon",i=document.createElement("i");i.className=t,n.appendChild(i)}}}removeCallback(){var e,t;const n=null===(e=this.sourceBlock_)||void 0===e?void 0:e.getParent();if(!n)return;let r;for(const e of n.inputList)if((null===(t=e.connection)||void 0===t?void 0:t.targetBlock())===this.sourceBlock_){r=e.name;break}r&&(i.WidgetDiv.hide(),n.removeInput(r))}}n.FieldArgumentEditor=o,o.REMOVE_ARG_URI="data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='UTF-8' standalone='no'?%3e%3csvg width='20px' height='20px' viewBox='0 0 20 20' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3c!-- Generator: Sketch 48.1 (47250) - http://www.bohemiancoding.com/sketch --%3e%3ctitle%3edelete-argument v2%3c/title%3e%3cdesc%3eCreated with Sketch.%3c/desc%3e%3cdefs%3e%3c/defs%3e%3cg id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e%3cg id='delete-argument-v2' stroke='%23FF661A'%3e%3cg id='Group' transform='translate(3.000000, 2.500000)'%3e%3cpath d='M1,3 L13,3 L11.8900496,14.0995037 C11.8389294,14.6107055 11.4087639,15 10.8950124,15 L3.10498756,15 C2.59123611,15 2.16107055,14.6107055 2.10995037,14.0995037 L1,3 Z' id='Rectangle' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M7,11 L7,6' id='Line' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M9.5,11 L9.5,6' id='Line-Copy' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M4.5,11 L4.5,6' id='Line-Copy-2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3crect id='Rectangle-2' fill='%23FF661A' x='0' y='2.5' width='14' height='1' rx='0.5'%3e%3c/rect%3e%3cpath d='M6,0 L8,0 C8.55228475,-1.01453063e-16 9,0.44771525 9,1 L9,3 L5,3 L5,1 C5,0.44771525 5.44771525,1.01453063e-16 6,0 Z' id='Rectangle-3' stroke-width='1.5'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",i.fieldRegistry.register("field_argument_editor",o),i.Css.register("\n\n.argumentEditorInput {\n    overflow: visible;\n}\n\n.functioneditor i.argumentEditorTypeIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: 40px;\n    left: 50%;\n    margin-left: -12px;\n}\n\n.argumentEditorRemoveIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: -40px;\n    left: 50%;\n    margin-left: -12px;\n    cursor: pointer;\n}\n\n")},{"../functionManager":92,blockly:376}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldAutocapitalizeTextInput=void 0;const i=e("blockly");class r extends i.FieldTextInput{constructor(e,t,n){super(e,t,n),this.disableAutocapitalize=!1}setAutocapitalize(e){this.disableAutocapitalize=!e,this.htmlInput_&&(this.disableAutocapitalize?this.htmlInput_.setAttribute("autocapitalize","none"):this.htmlInput_.removeAttribute("autocapitalize"))}configure_(e){super.configure_(e),void 0!==e.disableAutocapitalize&&(this.disableAutocapitalize=e.disableAutocapitalize)}widgetCreate_(){const e=super.widgetCreate_();return this.disableAutocapitalize&&e.setAttribute("autocapitalize","none"),e}}n.FieldAutocapitalizeTextInput=r,i.fieldRegistry.register("field_autocapitalize_text_input",r)},{blockly:376}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FunctionManager=void 0;const i=e("blockly"),r=e("./msg");class o{constructor(){this.typeIcons={},this.typeArgumentNames={}}static getInstance(){return o.instance}getIconForType(e){return this.typeIcons[e]}setIconForType(e,t){this.typeIcons[t]=e}setArgumentNameForType(e,t){this.typeArgumentNames[e]=t}getArgumentNameForType(e){return this.typeArgumentNames[e]?this.typeArgumentNames[e]:i.Msg[r.MsgKey.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME]}setEditFunctionExternal(e){this._editFunctionExternal=e}editFunctionExternal(e,t){this._editFunctionExternal?this._editFunctionExternal(e,t):console.warn("External function editor must be overriden: Blockly.Functions.editFunctionExternalHandler",e,t)}}n.FunctionManager=o,o.instance=new o},{"./msg":94,blockly:376}],93:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.validateFunctionExternal=n.getAllFunctionDefinitionBlocks=n.getDefinition=n.flyoutCategory=void 0,r(e("./msg"),n),r(e("./extensions"),n),r(e("./fields/fieldArgumentEditor"),n),r(e("./fields/fieldAutocapitalizeTextInput"),n),r(e("./blocks/argumentEditorBlocks"),n),r(e("./blocks/argumentReporterBlocks"),n),r(e("./blocks/functionDeclarationBlock"),n),r(e("./blocks/functionDefinitionBlock"),n),r(e("./blocks/functionCallBlocks"),n),r(e("./functionManager"),n);var o=e("./utils");Object.defineProperty(n,"flyoutCategory",{enumerable:!0,get:function(){return o.flyoutCategory}}),Object.defineProperty(n,"getDefinition",{enumerable:!0,get:function(){return o.getDefinition}}),Object.defineProperty(n,"getAllFunctionDefinitionBlocks",{enumerable:!0,get:function(){return o.getAllFunctionDefinitionBlocks}}),Object.defineProperty(n,"validateFunctionExternal",{enumerable:!0,get:function(){return o.validateFunctionExternal}})},{"./blocks/argumentEditorBlocks":82,"./blocks/argumentReporterBlocks":83,"./blocks/functionCallBlocks":84,"./blocks/functionDeclarationBlock":85,"./blocks/functionDefinitionBlock":86,"./extensions":89,"./fields/fieldArgumentEditor":90,"./fields/fieldAutocapitalizeTextInput":91,"./functionManager":92,"./msg":94,"./utils":96}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MsgKey=void 0;const i=e("blockly");var r,o;function s(e,t){i.Msg[e]||(i.Msg[e]=t)}(o=r=n.MsgKey||(n.MsgKey={})).REPORTERS_HUE="REPORTERS_HUE",o.FUNCTIONS_CALL_TITLE="FUNCTIONS_CALL_TITLE",o.FUNCTIONS_DEFNORETURN_TITLE="FUNCTIONS_DEFNORETURN_TITLE",o.FUNCTIONS_GO_TO_DEFINITION_OPTION="FUNCTIONS_GO_TO_DEFINITION_OPTION",o.FUNCTION_CALL_TOOLTIP="FUNCTION_CALL_TOOLTIP",o.PROCEDURES_HUE="PROCEDURES_HUE",o.PROCEDURES_CALLNORETURN_HELPURL="PROCEDURES_CALLNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME="FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME",o.FUNCTIONS_DEFAULT_STRING_ARG_NAME="FUNCTIONS_DEFAULT_STRING_ARG_NAME",o.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME="FUNCTIONS_DEFAULT_NUMBER_ARG_NAME",o.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME="FUNCTIONS_DEFAULT_ARRAY_ARG_NAME",o.PROCEDURES_DEFNORETURN_TOOLTIP="PROCEDURES_DEFNORETURN_TOOLTIP",o.PROCEDURES_DEFNORETURN_HELPURL="PROCEDURES_DEFNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME="FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME",o.FUNCTIONS_DEFAULT_FUNCTION_NAME="FUNCTIONS_DEFAULT_FUNCTION_NAME",o.FUNCTION_CREATE_NEW="FUNCTION_CREATE_NEW",o.FUNCTION_FLYOUT_LABEL="FUNCTION_FLYOUT_LABEL",o.FUNCTIONS_EDIT_OPTION="FUNCTIONS_EDIT_OPTION",o.FUNCTIONS_CREATE_CALL_OPTION="FUNCTIONS_CREATE_CALL_OPTION",s(r.REPORTERS_HUE,"#A80000"),s(r.FUNCTIONS_CALL_TITLE,"call"),s(r.FUNCTIONS_DEFNORETURN_TITLE,"function"),s(r.FUNCTIONS_GO_TO_DEFINITION_OPTION,"Go to Definition"),s(r.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME,"bool"),s(r.FUNCTIONS_DEFAULT_STRING_ARG_NAME,"text"),s(r.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME,"num"),s(r.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME,"array"),s(r.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME,"value"),s(r.FUNCTIONS_DEFAULT_FUNCTION_NAME,"doSomething"),s(r.FUNCTION_CREATE_NEW,"Make a Function"),s(r.FUNCTION_FLYOUT_LABEL,"Your Functions"),s(r.FUNCTIONS_EDIT_OPTION,"Edit Function"),s(r.FUNCTIONS_CREATE_CALL_OPTION,"Create 'call %1'")},{blockly:376}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.REMOVE_IMAGE_DATAURI=n.ADD_IMAGE_DATAURI=n.COLLAPSE_IMAGE_DATAURI=void 0,n.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",n.ADD_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJhZGQuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjQ4MjEiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NjkiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjEyLjkxNTI1NCIKICAgICBpbmtzY2FwZTpjeT0iMTYuMDY3Nzk2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0icmVwZWF0IiAvPjxzdHlsZQogICAgIHR5cGU9InRleHQvY3NzIgogICAgIGlkPSJzdHlsZTMiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjx0aXRsZQogICAgIGlkPSJ0aXRsZTUiPnJlcGVhdDwvdGl0bGU+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMiCiAgICAgd2lkdGg9IjQuMDUwMDAwMiIKICAgICBoZWlnaHQ9IjEyLjM5NzA1IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSItMTguMTk4NTI2IgogICAgIHJ4PSIwLjgxIgogICAgIHJ5PSIwLjgxIgogICAgIHRyYW5zZm9ybT0ic2NhbGUoMSwtMSkiIC8+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMtMSIKICAgICB3aWR0aD0iNC4wNTAwMDAyIgogICAgIGhlaWdodD0iMTIuMzk3MTE5IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSI1LjgwMTQ0MDciCiAgICAgcng9IjAuODEiCiAgICAgcnk9IjAuODEiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwxLDEsMCwwLDApIiAvPjxjaXJjbGUKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICBpZD0icGF0aDQxMzYiCiAgICAgY3g9IjEyIgogICAgIGN5PSIxMiIKICAgICByPSIxMC41MDMxOTEiIC8+PC9zdmc+",n.REMOVE_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJyZW1vdmUuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjFhZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NTAiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjAuMDUwODQ3NTIxIgogICAgIGlua3NjYXBlOmN5PSI5Ljk2NjEwMTciCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJyZXBlYXQiIC8+PHN0eWxlCiAgICAgdHlwZT0idGV4dC9jc3MiCiAgICAgaWQ9InN0eWxlMyI+Cgkuc3Qwe2ZpbGw6I0NGOEIxNzt9Cgkuc3Qxe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+PHRpdGxlCiAgICAgaWQ9InRpdGxlNSI+cmVwZWF0PC90aXRsZT48cmVjdAogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eTowLjA3ODQzMTM3IgogICAgIGlkPSJyZWN0NDE0My0xIgogICAgIHdpZHRoPSI0LjA1MDAwMDIiCiAgICAgaGVpZ2h0PSIxMi4zOTcxMTkiCiAgICAgeD0iOS45NzUwMDA0IgogICAgIHk9IjUuODAxNDQwNyIKICAgICByeD0iMC44MSIKICAgICByeT0iMC44MSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsMSwwLDAsMCkiIC8+PGNpcmNsZQogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgIGlkPSJwYXRoNDEzNiIKICAgICBjeD0iMTIiCiAgICAgY3k9IjEyIgogICAgIHI9IjEwLjUwMzE5MSIgLz48L3N2Zz4="},{}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isVariableBlockType=n.validateFunctionExternal=n.flyoutCategory=n.getShadowBlockInfoFromType_=n.findUniqueParamName=n.mutateCallersAndDefinition=n.idsInUse=n.findLegalName=n.createCustomArgumentEditor=n.createCustomArgumentReporter=n.isCustomType=n.getAllFunctionDefinitionBlocks=n.getDefinition=n.rename=void 0;const i=e("blockly"),r=e("./constants"),o=e("./functionManager"),s=e("./msg"),a=e("./blocks/functionDeclarationBlock");function l(e,t){for(const n of t.getTopBlocks(!1))if(n.type===r.FUNCTION_DEFINITION_BLOCK_TYPE){const t=n;if(t.getName()===e)return t}return null}function c(e){return e.getTopBlocks(!1).filter((e=>e.type===r.FUNCTION_DEFINITION_BLOCK_TYPE))}function u(e,t,n){const r=i.utils.xml.createElement("block");r.setAttribute("type",e);const o=i.utils.xml.createElement("mutation");return o.setAttribute("typename",t),r.appendChild(o),i.Xml.domToBlock(r,n)}function d(e,t,n){if(null==n?void 0:n.isInFlyout)return e;const i=h(t,n);for(;i[e];)e=p(e);return e}function h(e,t,n){const i={};return e.getAllVariables().forEach((function(e){i[e.name]=!0})),e.getAllBlocks(!1).forEach((function(e){const o=e;o==t||n&&o.getFunctionId&&o.getFunctionId()==n||(o.type==r.FUNCTION_DEFINITION_BLOCK_TYPE?i[o.getName()]=!0:"procedures_defreturn"==e.type||e.type)})),i}function p(e){const t=e.match(/^(.*?)(\d+)$/);return t?e=t[1]+(parseInt(t[2],10)+1):e+="2",e}function f(e,t,n){const o=l(e,t);if(o){const t=function(e,t){const n=[];for(const i of t.getAllBlocks(!1))if(i.type===r.FUNCTION_CALL_BLOCK_TYPE||i.type===r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=i;t.getName()===e&&n.push(t)}return n}(e,o.workspace);t.push(o),i.Events.setGroup(!0),t.forEach((function(e){const t=e.mutationToDom(),s=t&&i.Xml.domToText(t);e.domToMutation(n);const a=e.mutationToDom(),l=a&&i.Xml.domToText(a);if(s!=l)if(i.Events.fire(new i.Events.BlockChange(e,"mutation",null,s,l)),e.id==o.id){const e=g(t,!1),n=g(a,!0);o.getDescendants(!1).forEach((function(t){if(!function(e){return e.type==r.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE||e.type==r.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE||e.type==r.ARGUMENT_REPORTER_STRING_BLOCK_TYPE||e.type==r.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE||e.type==r.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}(t))return;let i=t.getFieldValue("VALUE"),o=e[i];n[o]?n[o]!==i&&t.setFieldValue(n[o],"VALUE"):t.dispose(!0)}))}else setTimeout((function(){e.bumpNeighbours()}),i.config.bumpDelay)})),i.Events.setGroup(!1)}else console.warn("Attempted to change function "+e+", but no definition block was found on the workspace")}function g(e,t){const n={};for(let i=0;i<e.childNodes.length;++i){const r=e.childNodes[i],o=t?r.getAttribute("id"):r.getAttribute("name"),s=t?r.getAttribute("name"):r.getAttribute("id");n[o]=s}return n}function m(e,t){return!t||-1==t.indexOf(e)}n.rename=function(e){e=e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");const t=this.sourceBlock_,n=d(e,t.workspace,t),i=this.getValue();if(!e)return i;if(!n)return e;if(!i)return t.name_=n,n;if(i!=e&&i!=n){t.name_=n;const e=t.mutationToDom();t.name_=i,f(i,t.workspace,e)}return n},n.getDefinition=l,n.getAllFunctionDefinitionBlocks=c,n.isCustomType=function(e){return!("boolean"==e||"string"==e||"number"==e)},n.createCustomArgumentReporter=function(e,t){return u(r.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE,e,t)},n.createCustomArgumentEditor=function(e,t){return u(r.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE,e,t)},n.findLegalName=d,n.idsInUse=function(e){const t=[];return e.getAllBlocks(!1).forEach((function(e){e.type==r.FUNCTION_DEFINITION_BLOCK_TYPE&&t.push(e.getFunctionId())})),t},n.mutateCallersAndDefinition=f,n.findUniqueParamName=function(e,t){for(;!m(e,t);)e=p(e);return e},n.getShadowBlockInfoFromType_=function(e,t){let n="",r="",s="";switch(e){case"boolean":n="logic_boolean",r="BOOL",s="TRUE";break;case"number":n="math_number",r="NUM",s="1";break;case"string":n="text",r="TEXT",s="abc";break;case"Array":n="variables_get",r="VAR",s=i.Variables.getOrCreateVariablePackage(t,null,"list","").getId();break;default:n="variables_get",r="VAR",s=i.Variables.getOrCreateVariablePackage(t,null,o.FunctionManager.getInstance().getArgumentNameForType(e),"").getId()}return[n,r,s]},n.flyoutCategory=function(e){const t=[],n=document.createElement("button"),l=i.Msg[s.MsgKey.FUNCTION_CREATE_NEW];n.setAttribute("text",l),n.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(()=>{!function(e){i.hideChaff(),i.getSelected()&&i.getSelected().unselect(),o.FunctionManager.getInstance().editFunctionExternal((0,a.newFunctionMutation)(e),function(e){return function(t){if(t){const n='<xml><block type="'+r.FUNCTION_DEFINITION_BLOCK_TYPE+'">'+i.Xml.domToText(t)+"</block></xml>",o=i.utils.xml.textToDom(n);i.Events.setGroup(!0);const s=i.Xml.domToBlock(o.firstChild,e);if(s.updateDisplay_(),e.getMetrics){const t=e.getMetrics(),n=s.getHeightWidth();s.moveBy(t.viewLeft+t.viewWidth/2-n.width/2,t.viewTop+t.viewHeight/2-n.height/2),s.scheduleSnapAndBump()}e.centerOnBlock(s.id),i.Events.setGroup(!1),setTimeout((()=>{s.afterWorkspaceLoad&&s.afterWorkspaceLoad()}))}}}(e))}(e)})),t.push(n);for(const n of c(e)){const e=n.getName(),r=n.getArguments(),o=i.utils.xml.createElement("block");o.setAttribute("type","function_call"),o.setAttribute("gap","16");const s=i.utils.xml.createElement("mutation");s.setAttribute("name",e),o.appendChild(s);for(let e=0;e<r.length;e++){const t=i.utils.xml.createElement("arg");t.setAttribute("name",r[e].name),t.setAttribute("type",r[e].type),t.setAttribute("id",r[e].id),s.appendChild(t)}t.push(o)}return t},n.validateFunctionExternal=function(e,t){const n=e.getAttribute("name");if(!n)return i.dialog.alert(i.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;const r={};for(let t=0;t<e.childNodes.length;++t){const n=e.childNodes[t].getAttribute("name");if(!n)return i.dialog.alert(i.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;if(r[n])return i.dialog.alert(i.Msg.FUNCTION_WARNING_DUPLICATE_ARG),!1;r[n]=!0}return r[n]?(i.dialog.alert(i.Msg.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME),!1):!h(t,null,e.getAttribute("functionid"))[n]||(i.dialog.alert(i.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",n)),!1)},n.isVariableBlockType=function(e){switch(e){case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":case"variables_get_reporter":case"variables_get":return!0}return!1}},{"./blocks/functionDeclarationBlock":85,"./constants":88,"./functionManager":92,"./msg":94,blockly:376}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly");i.Extensions.unregister("logic_compare"),i.Extensions.register("logic_compare",(function(){}))},{blockly:376}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r={elseifCount_:0,elseCount_:0,valueConnections_:[],statementConnections_:[],elseStatementConnection_:null,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=i.utils.xml.createElement("mutation");return this.elseifCount_&&e.setAttribute("elseif",this.elseifCount_+""),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){e&&(this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_())},storeConnections_:function(e){e||(e=0),this.valueConnections_=[null],this.statementConnections_=[null],this.elseStatementConnection_=null;for(let t=1;t<=this.elseifCount_;t++)e!=t&&(this.valueConnections_.push(this.getInput("IF"+t).connection.targetConnection),this.statementConnections_.push(this.getInput("DO"+t).connection.targetConnection));this.getInput("ELSE")&&(this.elseStatementConnection_=this.getInput("ELSE").connection.targetConnection)},restoreConnections_:function(){var e,t,n;for(let n=1;n<=this.elseifCount_;n++)null===(e=this.valueConnections_[n])||void 0===e||e.reconnect(this,"IF"+n),null===(t=this.statementConnections_[n])||void 0===t||t.reconnect(this,"DO"+n);this.getInput("ELSE")&&(null===(n=this.elseStatementConnection_)||void 0===n||n.reconnect(this,"ELSE"))},addElse_:function(){this.storeConnections_(),this.update_((()=>{this.elseCount_++})),this.restoreConnections_()},removeElse_:function(){this.storeConnections_(),this.update_((()=>{this.elseCount_--})),this.restoreConnections_()},addElseIf_:function(){this.storeConnections_(),this.update_((()=>{this.elseifCount_++})),this.restoreConnections_()},removeElseIf_:function(e){this.storeConnections_(e),this.update_((()=>{this.elseifCount_--})),this.restoreConnections_()},update_:function(e){i.Events.setGroup(!0);const t=this,n=t.mutationToDom(),r=n&&i.Xml.domToText(n),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof i.BlockSvg&&t.initSvg();const s=i.Events.getGroup(),a=t.mutationToDom(),l=a&&i.Xml.domToText(a);r!=l&&(i.Events.fire(new i.Events.BlockChange(t,"mutation",null,r,l)),setTimeout((function(){i.Events.setGroup(s),t.bumpNeighbours(),i.Events.setGroup(!1)}),i.config.bumpDelay)),t.rendered&&t instanceof i.BlockSvg&&t.render(),i.Events.setGroup(!1)},updateShape_:function(){this.getInput("ELSE")&&(this.removeInput("ELSE"),this.removeInput("ELSETITLE"),this.removeInput("ELSEBUTTONS"));let e=1;for(;this.getInput("IF"+e);)this.removeInput("IF"+e),this.removeInput("IFTITLE"+e),this.removeInput("IFBUTTONS"+e),this.removeInput("DO"+e),e++;for(let e=1;e<=this.elseifCount_;e++){const n=function(e){return function(){t.removeElseIf_(e)}}(e);this.appendValueInput("IF"+e).setCheck("Boolean").appendField(i.Msg.CONTROLS_IF_MSG_ELSEIF),this.appendDummyInput("IFTITLE"+e).appendField(i.Msg.CONTROLS_IF_MSG_THEN),this.appendDummyInput("IFBUTTONS"+e).appendField(new i.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",n,!1)).setAlign(i.ALIGN_RIGHT),this.appendStatementInput("DO"+e)}this.elseCount_&&(this.appendDummyInput("ELSETITLE").appendField(i.Msg.CONTROLS_IF_MSG_ELSE),this.appendDummyInput("ELSEBUTTONS").setAlign(i.ALIGN_RIGHT).appendField(new i.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",this.removeElse_.bind(this),!1)),this.appendStatementInput("ELSE")),this.getInput("ADDBUTTON")&&this.removeInput("ADDBUTTON");const t=this;this.appendDummyInput("ADDBUTTON").appendField(new i.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){0==t.elseCount_?t.addElse_():(t.elseifCount_||(t.elseifCount_=0),t.addElseIf_())}),!1))},rebuildShape_:function(){const e=[null],t=[null];let n=null;this.getInput("ELSE")&&(n=this.getInput("ELSE").connection.targetConnection);let i=1;for(;this.getInput("IF"+i);){const n=this.getInput("IF"+i),r=this.getInput("DO"+i);e.push(n.connection.targetConnection),t.push(r.connection.targetConnection),i++}this.updateShape_(),this.reconnectChildBlocks_(e,t,n)},reconnectChildBlocks_:function(e,t,n){var i,r;for(let n=1;n<=this.elseifCount_;n++)null===(i=e[n])||void 0===i||i.reconnect(this,"IF"+n),null===(r=t[n])||void 0===r||r.reconnect(this,"DO"+n);null==n||n.reconnect(this,"ELSE")}};i.Blocks.controls_if=Object.assign(Object.assign({},r),{init(){if(i.Extensions.apply("inline-svgs",this,!1),this.elseifCount_=0,this.elseCount_=0,this.setHelpUrl(i.Msg.CONTROLS_IF_HELPURL),this.appendValueInput("IF0").setCheck("Boolean").appendField(i.Msg.CONTROLS_IF_MSG_IF),this.appendDummyInput("THEN0").appendField(i.Msg.CONTROLS_IF_MSG_THEN),this.appendStatementInput("DO0"),this.workspace instanceof i.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.HEXAGONAL)}this.updateShape_(),this.setInputsInline(!0),this.setColour(i.Msg.LOGIC_HUE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip((()=>this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?i.Msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?i.Msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?i.Msg.CONTROLS_IF_TOOLTIP_4:"":i.Msg.CONTROLS_IF_TOOLTIP_1))}})},{blockly:376}],99:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./extensions"),n),r(e("./ifElse"),n)},{"./extensions":97,"./ifElse":98}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldSlider=void 0;const i=e("blockly");class r extends i.FieldNumber{constructor(e,t,n,i,r,o,s,a){super(e,t,n,i,s,a),"string"==typeof r?this.step_=parseFloat(r):"number"==typeof r&&(this.step_=r),this.labelText_=o}hasMin(){return this.getMin()>-1/0}hasMax(){return this.getMax()<1/0}getStep(){return this.step_}getLabel(){return this.labelText_}setLabel(e){this.labelText_=e}setOptions(e,t,n,i){this.setConstraints(e,t,i),this.step_=parseFloat(n)||void 0}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);if(isNaN(t))return null;this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_);let n=String(this.precision_);-1!==n.indexOf("e")&&(n=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=n.indexOf(".");let r;return null!==(r=-1===i?this.precision_?0:null:n.length-i-1)&&(t=Number(t.toFixed(r))),t}showEditor_(e,t){super.showEditor_(e,t),i.DropDownDiv.hideWithoutAnimation(),i.DropDownDiv.clearContent();const n=i.DropDownDiv.getContentDiv();n.setAttribute("role","menu"),n.setAttribute("aria-haspopup","true"),this.addSlider_(n),i.DropDownDiv.setColour("#ffffff","#dddddd"),i.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_)}addSlider_(e){if(this.labelText_){let t=this.createLabelDom_(this.labelText_);e.appendChild(t[0]),this.readout_=t[1],this.setReadout(this.value_)}this.slider_=this.createSlider(),e.appendChild(this.slider_);const t=()=>{pxt.BrowserUtils.isFirefox()||this.htmlInput_.focus()};i.browserEvents.bind(this.slider_,"input",this,(e=>{const n=parseFloat(this.slider_.value)||0;if(null!==n){this.setValue(n);const e=this.htmlInput_;e&&(e.value=n+"",t())}})),i.browserEvents.bind(this.slider_,"focus",this,(e=>{t()}))}setValue(e,t){super.setValue(e,t),this.updateDom(),this.slider_&&(this.slider_.value=this.getValue()+"")}createSlider(){const e=document.createElement("input");let t;return e.type="range",e.min=this.getMin()+"",e.max=this.getMax()+"",e.value=this.getValue()+"",this.sourceBlock_ instanceof i.BlockSvg&&("#ffffff"===this.sourceBlock_.getColour()?this.sourceBlock_.getParent()&&(t=this.sourceBlock_.getParent().getColourTertiary()):t=this.sourceBlock_.getColourTertiary()),t&&e.setAttribute("style",`--blocklyFieldSliderBackgroundColor: ${t}`),Number.isNaN(this.step_)||(e.step=this.step_+""),e}updateDom(){this.setReadout(this.getValue())}setReadout(e){this.readout_&&(this.readout_.innerText=e+"")}createLabelDom_(e){const t=document.createElement("div");t.setAttribute("class","blocklyFieldSliderLabel");const n=document.createElement("span");n.setAttribute("class","blocklyFieldSliderReadout");const i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderLabelText"),i.innerText=e,t.appendChild(i),t.appendChild(n),[t,n]}}n.FieldSlider=r,i.fieldRegistry.register("field_slider",r),i.Css.register('\n:root {\n    --blocklyFieldSliderBackgroundColor: #547AB2;\n}\n.blocklyFieldSliderLabel {\n    font-family: "Helvetica Neue", "Segoe UI", Helvetica, sans-serif;\n    font-size: 0.65rem;\n    color: $colour_toolboxText;\n    margin: 8px;\n}\n.blocklyFieldSliderLabelText {\n    font-weight: bold;\n}\n.blocklyFieldSliderReadout {\n    margin-left: 10px;\n}\n\ninput[type=range] {\n    -webkit-appearance: none;\n    width: 100%;\n}\ninput[type=range]:focus {\n    outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n    -webkit-appearance: none;\n    margin: 8px;\n    height: 22px;\n    width: 150px;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: var(--blocklyFieldSliderBackgroundColor);\n}\ninput[type=range]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\ninput[type=range]::-moz-range-track {\n    margin: 8px;\n    height: 22px;\n    width: 95%;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: #547AB2;\n}\ninput[type=range]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\n')},{blockly:376}],101:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./fieldSlider"),n),r(e("./numberBlocks"),n)},{"./fieldSlider":100,"./numberBlocks":102}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r=new i.zelos.ConstantProvider;i.defineBlocksWithJsonArray([{type:"math_integer",message0:"%1",args0:[{type:"field_number",name:"NUM",precision:1}],output:"Number",outputShape:r.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_whole_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0,precision:1}],output:"Number",outputShape:r.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_positive_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0}],output:"Number",outputShape:r.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_number_minmax",message0:"%1",args0:[{type:"field_slider",name:"SLIDER",value:0,step:1,labelText:"Number"}],output:"Number",outputShape:r.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",mutator:"math_number_minmax_mutator",extensions:["parent_tooltip_when_inline"]}]);const o={mutationToDom:function(){const e=this.inputList[0].fieldRow[0];let t=i.utils.xml.createElement("mutation");return e.hasMin()&&t.setAttribute("min",e.getMin()+""),e.hasMax()&&t.setAttribute("max",e.getMax()+""),null!=e.getLabel()&&t.setAttribute("label",e.getLabel()),null!=e.getStep()&&t.setAttribute("step",e.getStep()+""),null!=e.getPrecision()&&t.setAttribute("precision",e.getPrecision()+""),t},domToMutation:function(e){const t=this.inputList[0].fieldRow[0],n=e.getAttribute("min"),i=e.getAttribute("max"),r=e.getAttribute("step"),o=e.getAttribute("label"),s=e.getAttribute("precision");t.setLabel(o),t.setOptions(n,i,r,s)}};i.Extensions.registerMutator("math_number_minmax_mutator",o)},{blockly:376}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showEditorMixin=void 0;const i=e("blockly");n.showEditorMixin=function(e){const t=this.getSourceBlock();if(!t)throw new i.UnattachedFieldError;const n=new i.Menu;n.setRole(i.utils.aria.Role.LISTBOX),this.menu_=n;const o=this.getOptions(!1);let s=null;const a=e=>{i.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)};for(let e=0;e<o.length;e++){const[l,c]=o[e];if("SEPARATOR"===c){const e=new r("");n.addChild(e);continue}const u=(()=>{if("object"==typeof l){const e=new Image(l.width,l.height);return e.src=l.src,e.alt=l.alt||"",e}return l})(),d=new i.MenuItem(u,c);d.setRole(i.utils.aria.Role.OPTION),d.setRightToLeft(t.RTL),d.setCheckable(!0),n.addChild(d),d.setChecked(c===this.value_),d.onAction(a,this),c===this.value_&&(s=d)}e&&"number"==typeof e.clientX?this.menu_.openingCoords=new i.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,i.DropDownDiv.clearContent();const l=this.menu_.render(i.DropDownDiv.getContentDiv());if(i.utils.dom.addClass(l,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV){const e=t.getColour(),n=this.sourceBlock_.style.colourTertiary;i.DropDownDiv.setColour(e,n)}i.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),s&&(this.menu_.setHighlighted(s),i.utils.style.scrollIntoContainerView(s.getElement(),i.DropDownDiv.getContentDiv(),!0)),this.applyColour()};class r extends i.MenuItem{createDom(){const e=document.createElement("div");return e.id=i.utils.idGenerator.getNextUniqueId(),this.element_=e,e.className="blockly-menuseparator",e.setAttribute("role","separator"),e}getElement(){return this.element_}getId(){return this.element_.id}}i.Css.register("\n.blockly-menuseparator {\n    border-top: 1px solid rgba(0, 0, 0, 0.2);\n    margin: 4px 0;\n    padding: 0;\n}\n")},{blockly:376}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldVariable=void 0;const i=e("blockly"),r=e("./fieldDropdownMixin");class o extends i.FieldVariable{constructor(e,t,n,i,r){super(e,t,n,i,r),this.menuGenerator_=o.dropdownCreate}static dropdownCreate(){const e=i.FieldVariable.dropdownCreate.call(this),t=e.findIndex((e=>"RENAME_VARIABLE_ID"===e[1]));return e.splice(t,0,[i.Msg.NEW_VARIABLE_DROPDOWN,o.CREATE_VARIABLE_ID],[void 0,"SEPARATOR"]),e}onItemSelected_(e,t){!this.sourceBlock_||this.sourceBlock_.isDeadOrDying()||t.getValue()!==o.CREATE_VARIABLE_ID?super.onItemSelected_(e,t):i.Variables.createVariableButtonHandler(this.sourceBlock_.workspace,(e=>{const t=this.sourceBlock_.workspace.getVariable(e);t&&this.setValue(t.getId())}))}showEditor_(e){r.showEditorMixin.call(this,e)}}n.FieldVariable=o,o.CREATE_VARIABLE_ID="CREATE_VARIABLE",i.fieldRegistry.unregister("field_variable"),i.fieldRegistry.register("field_variable",o)},{"./fieldDropdownMixin":103,blockly:376}],105:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./fieldVariable"),n)},{"./fieldVariable":104}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isCollapsedInputRow=n.CollapsedInputRow=void 0;const i=e("blockly");class r extends i.blockRendering.InputRow{constructor(e){super(e),this.type|=i.blockRendering.Types.INPUT_ROW|i.blockRendering.Types.getType("COLLAPSED_INPUT_ROW")}measure(){this.width=this.minWidth,this.height=this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT}}n.CollapsedInputRow=r,n.isCollapsedInputRow=function(e){return!!(e.type&i.blockRendering.Types.getType("COLLAPSED_INPUT_ROW"))}},{blockly:376}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionPreviewer=void 0;const i=e("blockly");class r extends i.InsertionMarkerPreviewer{previewReplacement(e,t,n){super.previewReplacement(e,t,n),this.connectionLine||(this.connectionLine=i.utils.dom.createSvgElement("line",{class:"blocklyConnectionLine",x1:0,y1:0,x2:0,y2:0},e.sourceBlock_.getSvgRoot()),this.draggedConnectionIndicator=this.createConnectionIndicator(e));const o=r.CONNECTION_INDICATOR_RADIUS,s=e.getOffsetInBlock(),a=i.utils.Coordinate.sum(e.sourceBlock_.getRelativeToSurfaceXY(),s),l=i.utils.Coordinate.sum(t.sourceBlock_.getRelativeToSurfaceXY(),t.getOffsetInBlock()),c=l.x-a.x,u=l.y-a.y,d=Math.atan2(u,c);Math.sqrt(c*c+u*u)<2*o+1?i.utils.dom.addClass(this.connectionLine,"hidden"):(i.utils.dom.removeClass(this.connectionLine,"hidden"),this.connectionLine.setAttribute("x1",String(s.x+Math.cos(d)*o)),this.connectionLine.setAttribute("y1",String(s.y+Math.sin(d)*o)),this.connectionLine.setAttribute("x2",String(s.x+c-Math.cos(d)*o)),this.connectionLine.setAttribute("y2",String(s.y+u-Math.sin(d)*o)))}hidePreview(){super.hidePreview(),this.connectionLine&&(this.connectionLine.remove(),this.connectionLine=null,this.draggedConnectionIndicator.remove(),this.draggedConnectionIndicator=null,this.staticConnection=null)}createConnectionIndicator(e){const t=i.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"},e.sourceBlock_.getSvgRoot());i.utils.dom.createSvgElement("circle",{r:r.CONNECTION_INDICATOR_RADIUS},t);const n=e.getOffsetInBlock();return t.setAttribute("transform","translate("+n.x+","+n.y+")"),t}}n.ConnectionPreviewer=r,r.CONNECTION_INDICATOR_RADIUS=9},{blockly:376}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConstantProvider=void 0;const i=e("blockly");class r extends i.zelos.ConstantProvider{constructor(){super(...arguments),this.FIELD_TEXT_FONTFAMILY='"Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace',this.FIELD_TEXT_FONTWEIGHT="600",this.HIGHLIGHT_GLOW_COLOUR="#FFF200",this.ERROR_HIGHLIGHT_GLOW_COLOR="#FF0000",this.HIGHLIGHT_GLOW_SIZE=1.1,this.ELLIPSES_RADIUS=6,this.ELLIPSES_SPACING=8,this.ellipses=this.makeEllipses()}createDom(e,t,n){super.createDom(e,t,n);const r=i.utils.dom.createSvgElement(i.utils.Svg.DEFS,{},e);this.highlightOutlineFilter=this.createHighlight(r,"blocklyHighlightedGlowFilter",this.HIGHLIGHT_GLOW_COLOUR),this.highlightOutlineFilterId=this.highlightOutlineFilter.id,this.errorOutlineFilter=this.createHighlight(r,"blocklyErrorHighlightedGlowFilter",this.ERROR_HIGHLIGHT_GLOW_COLOR),this.errorOutlineFilterId=this.errorOutlineFilter.id,this.embossFilterOverride=this.createOutline(r,"blocklyBubbleEmbossGlowFilter"),this.embossFilterId=this.embossFilterOverride.id}dispose(){super.dispose(),this.highlightOutlineFilter&&i.utils.dom.removeNode(this.highlightOutlineFilter)}makeEllipses(){const e=this.ELLIPSES_RADIUS,t=this.ELLIPSES_SPACING;let n="";for(let r=0;r<3;r++)n+=i.utils.svgPaths.moveBy(t,0)+i.utils.svgPaths.arc("a","180 1,1",e,i.utils.svgPaths.point(2*e,0));for(let r=0;r<3;r++)n+=i.utils.svgPaths.arc("a","180 1,1",e,i.utils.svgPaths.point(2*-e,0))+i.utils.svgPaths.moveBy(-t,0);return n}getCSS_(e){return super.getCSS_(e).concat([e+" .blocklyConnectionIndicator, "+e+" .blocklyInputConnectionIndicator {","fill: #ff0000;","stroke: #ffff00;","stroke-width: 3px;","}",e+" .blocklyConnectionIndicator {","display: none;","}",e+" .blocklyBlockDragSurface > g > .blocklyDraggable > .blocklyConnectionIndicator {","display: block;","}",e+" .blocklyConnectionLine {","stroke: #ffff00;","stroke-width: 4px;","}",e+" .blocklyConnectionLine.hidden {","display: none;","}",e+" .blocklyFlyoutHeading .blocklyFlyoutLabelText {font-size: 1.5rem;","}"])}createHighlight(e,t,n){const r=i.utils.dom.createSvgElement(i.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);i.utils.dom.createSvgElement(i.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.HIGHLIGHT_GLOW_SIZE},r);const o=i.utils.dom.createSvgElement(i.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},r);return i.utils.dom.createSvgElement(i.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},o),i.utils.dom.createSvgElement(i.utils.Svg.FEFLOOD,{"flood-color":n,"flood-opacity":1,result:"outColor"},r),i.utils.dom.createSvgElement(i.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},r),r}createOutline(e,t){const n=i.utils.dom.createSvgElement(i.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);i.utils.dom.createSvgElement(i.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:.92},n);const r=i.utils.dom.createSvgElement(i.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},n);i.utils.dom.createSvgElement(i.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},r),i.utils.dom.createSvgElement(i.utils.Svg.FEFLOOD,{"flood-color":"#000000","flood-opacity":.5,result:"outColor"},n),i.utils.dom.createSvgElement(i.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},n);const o=i.utils.dom.createSvgElement("feMerge",{},n);return i.utils.dom.createSvgElement("feMergeNode",{in:"outBlur"},o),i.utils.dom.createSvgElement("feMergeNode",{in:"outGlow"},o),i.utils.dom.createSvgElement("feMergeNode",{in:"SourceGraphic"},o),n}}n.ConstantProvider=r,r.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",r.EXPAND_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.654)'%3E%3Cpath d='m1611 832q0-53-37-90l-651-651q-38-38-91-38-54 0-90 38l-651 651q-38 36-38 90 0 53 38 91l74 75q39 37 91 37 53 0 90-37l486-486 486 486q37 37 90 37 52 0 91-37l75-75q37-39 37-91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A"},{blockly:376}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Drawer=void 0;const i=e("blockly"),r=e("./collapsedInputRow");class o extends i.zelos.Drawer{drawCollapsedStack_(e){const t=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.constants_.INSIDE_CORNERS.width,n=this.constants_.STATEMENT_INPUT_PADDING_LEFT+2*this.constants_.INSIDE_CORNERS.width+i.utils.svgPaths.lineOnAxis("h",-this.constants_.INSIDE_CORNERS.width)+this.constants_.INSIDE_CORNERS.pathTop,r=e.height-2*this.constants_.INSIDE_CORNERS.height,o=this.constants_.INSIDE_CORNERS.pathBottom+i.utils.svgPaths.lineOnAxis("h",this.constants_.INSIDE_CORNERS.width),s=this.constants_.ellipses;this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.bottomRight+i.utils.svgPaths.lineOnAxis("H",t)+n+i.utils.svgPaths.lineOnAxis("v",r/2)+s+i.utils.svgPaths.lineOnAxis("v",r/2)+o+i.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.constants_.OUTSIDE_CORNERS.rightHeight)+this.constants_.OUTSIDE_CORNERS.topRight}drawOutline_(){if(this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection)this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_();else{this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):(0,r.isCollapsedInputRow)(t)?this.drawCollapsedStack_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}}drawLeft_(){if(super.drawLeft_(),this.info_.rows.find((function(e){return(0,r.isCollapsedInputRow)(e)}))){let e=this.info_.startY;i.blockRendering.Types.isLeftRoundedCorner(this.info_.topRow.elements[0])&&(e+=this.constants_.OUTSIDE_CORNERS.rightHeight),this.outlinePath_=this.outlinePath_.slice(0,-1),this.outlinePath_+=i.utils.svgPaths.lineOnAxis("V",e)}}}n.Drawer=o},{"./collapsedInputRow":106,blockly:376}],110:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./renderer"),n),r(e("./connectionPreviewer"),n)},{"./connectionPreviewer":107,"./renderer":113}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RenderInfo=void 0;const i=e("blockly"),r=e("./collapsedInputRow");class o extends i.zelos.RenderInfo{measure(){if(this.block_)for(const e of this.block_.inputList)e.init();super.measure()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new i.blockRendering.InputRow(this.constants_);this.inputRows.push(e);const t=this.block_.getIcons();for(let n,r=0;n=t[r];r++){const t=new i.blockRendering.Icon(this.constants_,n);this.isCollapsed&&!n.isShownWhenCollapsed()||e.elements.push(t)}let n;for(let t,r=0;t=this.block_.inputList[r];r++)if(t.isVisible()){this.shouldStartNewRow_(t,n)&&(this.rows.push(e),e=new i.blockRendering.InputRow(this.constants_),this.inputRows.push(e));for(let n,r=0;n=t.fieldRow[r];r++)e.elements.push(new i.blockRendering.Field(this.constants_,n,t));this.addInput_(t,e),n=t}this.isCollapsed&&(this.block_.inputList.find((function(e){return e.type==i.inputTypes.STATEMENT}))?e=this.addCollapsedRow_(e):(e.hasJaggedEdge=!0,e.elements.push(new i.blockRendering.JaggedEdge(this.constants_)))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;const e=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof i.inputs.StatementInput||this.rows.some((e=>(0,r.isCollapsedInputRow)(e)));this.bottomRow.minHeight=e?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new i.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new i.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new i.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new i.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new i.blockRendering.RoundCorner(this.constants_,"right"))}addCollapsedRow_(e){this.rows.push(e);const t=new r.CollapsedInputRow(this.constants_);return t.hasDummyInput=!0,t}}n.RenderInfo=o},{"./collapsedInputRow":106,blockly:376}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PathObject=void 0;const i=e("blockly"),r="blockly-dotted-outline-on-hover",o="hover";class s extends i.zelos.PathObject{constructor(){super(...arguments),this.connectionPointIndicators=new WeakMap}updateHighlighted(e){if(e){if(!this.svgPathHighlighted){const e=this.constants,t=this.hasError?e.errorOutlineFilterId:e.highlightOutlineFilterId;this.svgPathHighlighted=this.svgPath.cloneNode(!0),this.svgPathHighlighted.setAttribute("fill","none"),this.svgPathHighlighted.setAttribute("filter","url(#"+t+")"),this.svgRoot.appendChild(this.svgPathHighlighted)}}else this.svgPathHighlighted&&(this.svgRoot.removeChild(this.svgPathHighlighted),this.svgPathHighlighted=null)}updateSelected(e){e&&this.svgPath.classList.remove(o),super.updateSelected(e)}addConnectionHighlight(e,t,n,r){if(super.addConnectionHighlight(e,t,n,r),e.type===i.INPUT_VALUE||e.type===i.OUTPUT_VALUE){const t=i.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"});i.utils.dom.createSvgElement("circle",{r:s.CONNECTION_INDICATOR_RADIUS},t);const n=e.getOffsetInBlock();t.setAttribute("transform","translate("+n.x+","+n.y+")"),this.connectionPointIndicators.set(e,t),this.svgRoot.appendChild(t)}}removeConnectionHighlight(e){super.removeConnectionHighlight(e),this.connectionPointIndicators.has(e)&&(this.connectionPointIndicators.get(e).remove(),this.connectionPointIndicators.delete(e))}applyColour(e){if(super.applyColour(e),e.isShadow()&&e.getParent()){const t=e.getParent().style.colourTertiary;(function(e){return(.2126*e[0]+.7152*e[1]+.0722*e[2])/255})(i.utils.colour.hexToRgb(t))<.15&&this.svgPath.setAttribute("stroke",i.utils.colour.blend("#ffffff",t,.3))}}setHasDottedOutllineOnHover(e){this.hasDottedOutlineOnHover=e,e?(this.svgPath.classList.add(r),this.mouseOverData||(this.mouseOverData=i.browserEvents.bind(this.svgRoot,"mouseover",this,(()=>{this.svgPath.classList.add(o)})),this.mouseLeaveData=i.browserEvents.bind(this.svgRoot,"mouseleave",this,(()=>{this.svgPath.classList.remove(o)})))):(this.svgPath.classList.remove(r),this.mouseOverData&&(i.browserEvents.unbind(this.mouseOverData),i.browserEvents.unbind(this.mouseLeaveData),this.mouseOverData=void 0,this.mouseLeaveData=void 0),this.svgPath.classList.remove(r))}setHasError(e){this.hasError=e}isHighlighted(){return!!this.svgPathHighlighted}resizeHighlight(){this.svgPathHighlighted&&(this.updateHighlighted(!1),this.updateHighlighted(!0))}}n.PathObject=s,s.CONNECTION_INDICATOR_RADIUS=9,i.Css.register("\n.blockly-dotted-outline-on-hover {\n    transition: stroke .4s;\n}\n.blockly-dotted-outline-on-hover.hover {\n    stroke-dasharray: 2;\n    stroke: white;\n    stroke-width: 2;\n}\n")},{blockly:376}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Renderer=void 0;const i=e("blockly"),r=e("./pathObject"),o=e("./constants"),s=e("./info"),a=e("./drawer");class l extends i.zelos.Renderer{makePathObject(e,t){return new r.PathObject(e,t,this.getConstants())}makeConstants_(){return new o.ConstantProvider}makeRenderInfo_(e){return new s.RenderInfo(this,e)}makeDrawer_(e,t){return new a.Drawer(e,t)}render(e){e.updateBeforeRender&&e.updateBeforeRender(),super.render(e)}}n.Renderer=l,i.blockRendering.register("pxt",l)},{"./constants":108,"./drawer":109,"./info":111,"./pathObject":112,blockly:376}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FieldString=void 0;const i=e("blockly");class r extends i.FieldTextInput{initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=i.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=i.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(e){super.updateSize_(e);const t=this.value_?this.size_.width:1;let n=this.positionLeft(t+3);this.textElement_.setAttribute("x",n+""),n+=this.positionRight(n+t+3),this.size_.width=t+n}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*r.quotePadding,t=this.quoteWidth_+r.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+r.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=r.quotePadding,t=this.quoteWidth_+r.quotePadding):(this.quoteRightX_=e+r.quotePadding,t=this.quoteWidth_+r.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}}n.FieldString=r,r.quotePadding=0,i.Css.register("\n.field-text-quote {\n    fill: #a31515 !important;\n}\n"),i.fieldRegistry.register("field_string",r)},{blockly:376}],115:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./fieldString"),n),r(e("./text"),n),r(e("./join"),n)},{"./fieldString":114,"./join":116,"./text":117}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly"),r={itemCount_:0,valueConnections_:[],mutationToDom:function(){const e=i.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},storeValueConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreValueConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeValueConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreValueConnections_(),this.itemCount_>1){const e=this.getInput("ADD0");if(e&&e.connection.targetConnection){const t=this.getInput("ADD"+(this.itemCount_-1)),n=e.connection.getShadowDom();if(n){const e=i.utils.xml.createElement("shadow"),r=n.getAttribute("type");e.setAttribute("type",r),e&&(e.setAttribute("id",i.utils.idGenerator.genUid()),t.connection.setShadowDom(e))}}}},removeItem_:function(){this.storeValueConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreValueConnections_()},update_:function(e){i.Events.setGroup(!0);const t=this,n=t.mutationToDom(),r=n&&i.Xml.domToText(n),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof i.BlockSvg&&t.initSvg();const s=i.Events.getGroup(),a=t.mutationToDom(),l=a&&i.Xml.domToText(a);r!=l&&(i.Events.fire(new i.Events.BlockChange(t,"mutation",null,r,l)),setTimeout((function(){i.Events.setGroup(s),t.bumpNeighbours(),i.Events.setGroup(!1)}),i.config.bumpDelay)),t.rendered&&t instanceof i.BlockSvg&&t.render(),i.Events.setGroup(!1)},updateShape_:function(){const e=this;let t;for(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(i.Msg.TEXT_JOIN_TITLE_CREATEWITH),t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||this.appendValueInput("ADD"+t).setAlign(i.ALIGN_LEFT);for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const n=this.appendDummyInput("BUTTONS");this.itemCount_>1&&n.appendField(new i.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(function(){e.removeItem_()}),!1)),n.appendField(new i.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){e.addItem_()}),!1));const r=this.itemCount_<=4;if(this.setInputsInline(r),this.workspace instanceof i.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(r?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};i.Extensions.registerMutator("pxt_text_join_mutator",r,(function(){i.Extensions.apply("inline-svgs",this,!1),this.itemCount_=2,this.updateShape_()})),i.defineBlocksWithJsonArray([{type:"text_join",message0:"",output:"String",outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"pxt_text_join_mutator"}])},{blockly:376}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("blockly");i.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_string",name:"TEXT",text:""}],output:"String",outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]}])},{blockly:376}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blocksMetrics=n.render=n.renderWorkspace=n.cleanRenderingWorkspace=n.initRenderingWorkspace=void 0;const i=e("blockly"),r=e("./layout"),o=e("./importer");let s,a;function l(){return s||((a=document.createElement("div")).style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="1px",a.style.height="1px",document.body.appendChild(a),s=i.inject(a,{move:{scrollbars:!1},readOnly:!0,sounds:!1,media:pxt.webConfig.commitCdnUrl+"blockly/media/",rtl:pxt.Util.isUserLanguageRtl(),renderer:"pxt"})),(0,o.clearWithoutEvents)(s),s}function c(){s&&s.dispose(),s=void 0}function u(e={emPixels:18,layout:1}){switch(e.splitSvg?1:e.layout||4){case 1:(0,r.verticalAlign)(s,e.emPixels||18);break;case 4:(0,r.flow)(s,{ratio:e.aspectRatio,useViewWidth:e.useViewWidth});break;case 3:s.cleanUp_&&s.cleanUp_()}let t=s.getMetrics();const n=a.querySelectorAll("svg")[0].cloneNode(!0);return(0,r.cleanUpBlocklySvg)(n),pxt.U.toArray(n.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.setAttribute("transform",`translate(${-t.contentLeft}, ${-t.contentTop}) scale(1)`))),n.setAttribute("viewBox",`0 0 ${t.contentWidth} ${t.contentHeight}`),e.emPixels&&(n.style.width=t.contentWidth/e.emPixels+"em",n.style.height=t.contentHeight/e.emPixels+"em"),e.splitSvg?(0,r.splitSvg)(n,s,e.emPixels):n}n.initRenderingWorkspace=l,n.cleanRenderingWorkspace=c,n.renderWorkspace=u,n.render=function(e,t={emPixels:18,layout:1}){l();try{let n=e||'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',r=i.utils.xml.textToDom(n);return(0,o.domToWorkspaceNoEvents)(r,s,{applyHideMetaComment:!0}),u(t)}catch(e){return void pxt.reportException(e)}finally{c()}},n.blocksMetrics=function(e){const t=e.getTopBlocks(!1);if(!t.length)return{width:0,height:0};let n;return t.forEach((e=>{const t=e.getBoundingRectangle();n?(n.l=Math.min(n.l,t.left),n.r=Math.max(n.r,t.right),n.t=Math.min(n.t,t.top),n.b=Math.min(n.b,t.bottom)):n={l:t.left,r:t.right,t:t.top,b:t.bottom}})),{width:n.r-n.l,height:n.b-n.t}}},{"./importer":67,"./layout":69,blockly:376}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findBlockIdByLine=n.findBlockIdByPosition=void 0,n.findBlockIdByPosition=function(e,t){if(!t)return;let n,i;for(let r=0;r<e.length;++r){let o=e[r];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!n||i>o.endPos-o.startPos)&&(n=o,i=o.endPos-o.startPos)}return n?n.id:void 0},n.findBlockIdByLine=function(e,t){if(!t)return;let n,i;for(let r=0;r<e.length;++r){let o=e[r];o.startLine<=t.start&&o.endLine>t.start+t.length&&(!n||i>o.endLine-o.startLine)&&(n=o,i=o.endLine-o.startLine)}return n?n.id:void 0}},{}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createFunctionsFlyoutCategory=n.mkReturnStatementBlock=n.mkVariableFieldBlock=n.mkFieldBlock=n.mkPredicateBlock=n.createToolboxBlock=n.createFlyoutGap=n.createFlyoutButton=n.createFlyoutGroupLabel=n.createFlyoutHeadingLabel=n.createShadowValue=n.isArrayType=void 0;const i=e("blockly"),r=e("./plugins/functions"),o=e("./plugins/duplicateOnDrag"),s=/^(string|number|boolean)$/,a={string:{field:"TEXT",block:"text",defaultValue:""},number:{field:"NUM",block:"math_number",defaultValue:"0"},boolean:{field:"BOOL",block:"logic_boolean",defaultValue:"false"},Array:{field:"VAR",block:"variables_get",defaultValue:"list"}};function l(e){let t=/^(?:Array<(.+)>)|(?:(.+)\[\])|(?:\[.+\])$/.exec(e);return t?t[1]?t[1]:t[2]:void 0}function c(e,t,n,i){let r;if(i=i||t.defaultValue,!(n=n||t.shadowBlockId)&&t.range&&(n="math_number_minmax"),r=i&&'"'==i.slice(0,1)?JSON.parse(i):i,"number"==t.type&&"value"==n){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode("0")),e}if(t.fieldEditor){if(t.defaultValue){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(t.defaultValue)),e}return}let o=pxt.Util.lookup(e.apis.byQName,t.type),s=6==(null==o?void 0:o.kind),c=o&&!!o.attributes.fixedInstances&&!t.shadowBlockId,d="@combined@"==t.type;if(!n&&(s||c||d)){if(i){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(i)),e}return}const h="variables_get"==n,p="text"==n,f=document.createElement("value");f.setAttribute("name",t.definitionName);const g=l(t.type),m=document.createElement(h||g?"block":"shadow");f.appendChild(m);const b=a[g||t.type];if(m.setAttribute("type",n||(g?"lists_create_with":b&&b.block||t.type)),m.setAttribute("colour","#fff"),g){if(b&&!n){let e;switch(g){case"number":e=["0","1"];break;case"string":e=["a","b","c"];break;case"boolean":e=["FALSE","FALSE","FALSE"]}return u(m,b.block,b.field,e),f}if(n&&r)return u(m,r),f}if(!b||n&&b.block!==n&&"math_number_minmax"!==n){if(r){const i=document.createElement("field");if(i.textContent=r,h)i.setAttribute("name","VAR"),m.appendChild(i);else if(p)i.setAttribute("name","TEXT"),m.appendChild(i);else if(n){const t=e.blocksById[n];if(t&&t.attributes._def&&t.attributes._def.parameters.length){const e=t.attributes._def.parameters[0];i.setAttribute("name",e.name),m.appendChild(i)}}else i.setAttribute("name",t.definitionName),m.appendChild(i)}}else{const e=document.createElement("field");let i,o;switch(m.appendChild(e),n){case"variables_get":i="VAR";break;case"math_number_minmax":i="SLIDER";break;default:i=b.field}e.setAttribute("name",i),o="boolean"==t.type?document.createTextNode((r||b.defaultValue).toUpperCase()):document.createTextNode(r||b.defaultValue),e.appendChild(o)}let y;return t.range&&((y=document.createElement("mutation")).setAttribute("min",t.range.min.toString()),y.setAttribute("max",t.range.max.toString()),y.setAttribute("label",t.actualName.charAt(0).toUpperCase()+t.actualName.slice(1)),t.fieldOptions&&(t.fieldOptions.step&&y.setAttribute("step",t.fieldOptions.step),t.fieldOptions.color&&y.setAttribute("color",t.fieldOptions.color),t.fieldOptions.precision&&y.setAttribute("precision",t.fieldOptions.precision))),t.fieldOptions&&(y||(y=document.createElement("mutation")),y.setAttribute("customfield",JSON.stringify(t.fieldOptions))),y&&m.appendChild(y),f}function u(e,t,n,i){const r=i?i.length:2,o=document.createElement("mutation");o.setAttribute("items",""+r),o.setAttribute("horizontalafter",""+r),e.appendChild(o);for(let o=0;o<r;o++){const r=document.createElement("value");r.setAttribute("name","ADD"+o);const s=document.createElement("shadow");if(s.setAttribute("type",t),n){const e=document.createElement("field");e.setAttribute("name",n),i&&e.appendChild(document.createTextNode(i[o])),s.appendChild(e)}r.appendChild(s),e.appendChild(r)}}function d(e,t,n,i){const r=p(e,pxt.toolbox.convertColor(t),n,i);return r.setAttribute("web-class","blocklyFlyoutHeading"),r}function h(e,t,n,i){const r=p(e,void 0,t);return r.setAttribute("web-class","blocklyFlyoutGroup"),r.setAttribute("web-line","1.5"),n&&r.setAttribute("web-line-width",n),i&&(r.setAttribute("web-help-button","true"),r.setAttribute("callbackKey",i)),r}function p(e,t,n,r){let o=i.utils.xml.createElement("label");return o.setAttribute("text",e),t&&o.setAttribute("web-icon-color",pxt.toolbox.convertColor(t)),n&&(1===n.length?(o.setAttribute("web-icon",n),r&&o.setAttribute("web-icon-class",r)):o.setAttribute("web-icon-class",`blocklyFlyoutIcon${e}`)),o}function f(e,t,n,i){const r=document.createElement(i?"shadow":"block");r.setAttribute("type",pxt.Util.htmlEscape(e));const o=document.createElement("field");return o.setAttribute("name",pxt.Util.htmlEscape(t)),o.textContent=pxt.Util.htmlEscape(n),r.appendChild(o),r}function g(){const e=document.createElement("block");e.setAttribute("type","function_return");const t=document.createElement("value");t.setAttribute("name","RETURN_VALUE"),e.appendChild(t);const n=f("math_number","NUM","0",!0);return t.appendChild(n),e}n.isArrayType=l,n.createShadowValue=c,n.createFlyoutHeadingLabel=d,n.createFlyoutGroupLabel=h,n.createFlyoutButton=function(e,t){let n=i.utils.xml.createElement("button");return n.setAttribute("text",t),n.setAttribute("callbackKey",e),n},n.createFlyoutGap=function(e){const t=i.utils.xml.createElement("sep");return t.setAttribute("gap",e+""),t},n.createToolboxBlock=function e(t,n,i){var r,a;let u,d;if(n.attributes.toolboxParent){const i=t.blocksById[n.attributes.toolboxParent];if(i){const r=pxt.blocks.compileInfo(i);if(u=e(t,i,r),n.attributes.toolboxParentArgument)!(d=u.querySelector(`value[name=${n.attributes.toolboxParentArgument}]`))&&r.parameters.some((e=>e.definitionName===n.attributes.toolboxParentArgument))&&((d=document.createElement("value")).setAttribute("name",n.attributes.toolboxParentArgument),u.appendChild(d));else if(!(d=u.querySelector("value")))for(const e of r.parameters)if(!u.querySelector(`field[name=${e.definitionName}]`)){(d=document.createElement("value")).setAttribute("name",e.definitionName),u.appendChild(d);break}if(d)for(;d.firstChild;)d.removeChild(d.firstChild);else u=void 0}}let h=document.createElement(u?"shadow":"block");if(h.setAttribute("type",n.attributes.blockId),n.attributes.blockGap?h.setAttribute("gap",n.attributes.blockGap):pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&h.setAttribute("gap",pxt.appTarget.appTheme.defaultBlockGap.toString()),i.thisParameter){const e=i.thisParameter,n=!!(null===(r=t.apis.byQName[e.type])||void 0===r?void 0:r.attributes.fixedInstances);let o=e.shadowBlockId,s=e.defaultValue;n||o&&"variables_get"!==o||(o="variables_get",s=s||e.definitionName);const a=c(t,e,o,s);a&&h.appendChild(a)}if("ENUM_GET"===n.attributes.shim||"KIND_GET"===n.attributes.shim){if(null===(a=n.parameters)||void 0===a?void 0:a.length){const e=n.parameters[0].default;if(e){const t=document.createElement("field");t.setAttribute("name","MEMBER"),t.textContent=e,h.appendChild(t)}}}else n.parameters&&(i.parameters.filter((e=>s.test(e.type)||s.test(l(e.type))||e.shadowBlockId||e.defaultValue)).forEach((e=>{const n=c(t,e);n&&h.appendChild(n)})),n.attributes.draggableParameters?i.handlerArgs.forEach((e=>{const t="reporter"===n.attributes.draggableParameters,i=document.createElement("value");i.setAttribute("name","HANDLER_DRAG_PARAM_"+e.name);const r=t?pxt.blocks.reporterTypeForArgType(e.type):"variables_get_reporter",s=document.createElement("block");s.setAttribute("type",r);const a=document.createElement("mutation");s.appendChild(a),a.setAttribute(o.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),t&&"argument_reporter_custom"===r&&a.setAttribute("typename",e.type);const l=document.createElement("field");l.setAttribute("name",t?"VALUE":"VAR"),l.textContent=pxt.Util.htmlEscape(e.name),s.appendChild(l),i.appendChild(s),h.appendChild(i)})):i.handlerArgs.forEach((e=>{const t=document.createElement("field");t.setAttribute("name","HANDLER_"+e.name),t.textContent=e.name,h.appendChild(t)})));return u?(d.appendChild(h),u):h},n.mkPredicateBlock=function(e){const t=document.createElement("block");t.setAttribute("type",e);const n=document.createElement("value");n.setAttribute("name","PREDICATE"),t.appendChild(n);const i=f("logic_boolean","BOOL","TRUE",!0);return n.appendChild(i),t},n.mkFieldBlock=f,n.mkVariableFieldBlock=function(e,t,n,i,r){const o=document.createElement(r?"shadow":"block");o.setAttribute("type",pxt.Util.htmlEscape(e));const s=document.createElement("field");return s.setAttribute("name","VAR"),s.id=t,s.setAttribute("variabletype",pxt.Util.htmlEscape(n)),s.textContent=pxt.Util.htmlEscape(i),o.appendChild(s),o},n.mkReturnStatementBlock=g,n.createFunctionsFlyoutCategory=function(e){const t=(0,r.flyoutCategory)(e);if(t.length>1){let e=g();t.splice(1,0,h(lf("Your Functions"))),t.splice(1,0,e)}const n=(0,r.getAllFunctionDefinitionBlocks)(e).filter((e=>e.getDescendants(!1).some((e=>"function_return"===e.type&&e.getInputTargetBlock("RETURN_VALUE"))))).map((e=>e.getField("function_name").getText())),i=d(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.unshift(i);const o=[];for(const e of t)if(o.push(e),"function_call"===e.getAttribute("type")){const t=e.children.item(0);if(t){const i=t.getAttribute("name");if(n.some((e=>e===i))){const t=e.cloneNode(!0);t.setAttribute("type","function_call_output"),o.push(t)}}}return o}},{"./plugins/duplicateOnDrag":78,"./plugins/functions":93,blockly:376}],121:[function(e,t,n){"use strict";function i(e,t,n,i){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(n)===i))}Object.defineProperty(n,"__esModule",{value:!0}),n.cleanOuterHTML=n.getDirectChildren=n.getFirstChildWithAttr=n.getChildrenWithAttr=n.getBlocksWithType=void 0,n.getBlocksWithType=function(e,t){return i(e,"block","type",t).concat(i(e,"shadow","type",t))},n.getChildrenWithAttr=i,n.getFirstChildWithAttr=function(e,t,n,r){const o=i(e,t,n,r);return o.length?o[0]:void 0},n.getDirectChildren=function(e,t){const n=[];for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes.item(i);r.tagName===t&&n.push(r)}return n},n.cleanOuterHTML=function(e){return e.outerHTML.replace(/^<\?[^>]*>/,"")}},{}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getNestedChildBlocks=void 0,n.getNestedChildBlocks=function(e){return e.getDescendants(!0).filter((t=>t.isEnabled()&&t.getSurroundParent()===e))}},{}],123:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./runValidatorPlan"),n),r(e("./validateBlocksExist"),n),r(e("./validateBlocksInSetExist"),n),r(e("./validateCommentsExist"),n),r(e("./validateSpecificBlockCommentsExist"),n)},{"./runValidatorPlan":124,"./validateBlocksExist":126,"./validateBlocksInSetExist":127,"./validateCommentsExist":128,"./validateSpecificBlockCommentsExist":129}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.runValidatorPlan=void 0;const i=e("./validateBlockFieldValueExists"),r=e("./validateBlocksExist"),o=e("./validateBlocksInSetExist"),s=e("./validateCommentsExist"),a=e("./validateSpecificBlockCommentsExist"),l=e("./getNestedChildBlocks");function c(e,t){const n=t.blockCounts.reduce(((e,t)=>(e[t.blockId]=t.count,e)),{}),i=(0,r.validateBlocksExist)({usedBlocks:e,requiredBlockCounts:n});let o=[];if(i.passed)for(const e of t.blockCounts){const t=e.blockId;o.push(...i.successfulBlocks[t])}return[o,i.passed]}function u(e,t){return(0,s.validateBlockCommentsExist)({usedBlocks:e,numRequired:t.count}).passed}function d(e,t){return(0,a.validateSpecificBlockCommentsExist)({usedBlocks:e,blockType:t.blockType}).passed}function h(e,t){const n=(0,o.validateBlocksInSetExist)({usedBlocks:e,blockIdsToCheck:t.blocks,count:t.count});return[n.successfulBlocks,n.passed]}function p(e,t){const n=(0,i.validateBlockFieldValueExists)({usedBlocks:e,fieldType:t.fieldType,fieldValue:t.fieldValue,specifiedBlock:t.blockType});return[n.successfulBlocks,n.passed]}n.runValidatorPlan=function e(t,n,i){const r=Date.now();let o=0,s=[];for(const r of n.checks){let n=!1;switch(r.validator){case"blocksExist":[s,n]=[...c(t,r)];break;case"blockCommentsExist":n=u(t,r);break;case"specificBlockCommentsExist":n=d(t,r);break;case"blocksInSetExist":[s,n]=[...h(t,r)];break;case"blockFieldValueExists":[s,n]=[...p(t,r)];break;default:pxt.debug(`Unrecognized validator: ${r.validator}`),n=!1}if(n&&r.childValidatorPlans)for(const t of r.childValidatorPlans){let r=0;for(const n of s)r+=e((0,l.getNestedChildBlocks)(n),i.find((e=>e.name===t)),i)?1:0;n=n&&r>0}o+=n?1:0}const a=o>=n.threshold;return pxt.tickEvent("validation.evaluation_complete",{plan:n.name,durationMs:Date.now()-r,passed:`${a}`}),a}},{"./getNestedChildBlocks":122,"./validateBlockFieldValueExists":125,"./validateBlocksExist":126,"./validateBlocksInSetExist":127,"./validateCommentsExist":128,"./validateSpecificBlockCommentsExist":129}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateBlockFieldValueExists=void 0,n.validateBlockFieldValueExists=function({usedBlocks:e,fieldType:t,fieldValue:n,specifiedBlock:i}){const r=e.filter((e=>e.isEnabled()&&e.type===i)).filter((e=>{var i;return"VAR"===t?(null===(i=e.getVarModels())||void 0===i?void 0:i[0].name)===n:e.getFieldValue(t)===n}));return{successfulBlocks:r,passed:r.length>0}}},{}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateBlocksExist=void 0,n.validateBlocksExist=function({usedBlocks:e,requiredBlockCounts:t}){let n=[],i=[],r=[],o={};const s=null==e?void 0:e.reduce(((e,t)=>(e[t.type]=(e[t.type]||0)+(t.isEnabled()?1:0),e)),{});for(const[a,l]of Object.entries(t||{})){const t=s[a],c=e.filter((e=>e.isEnabled()&&e.type===a));c.length>0&&(o[a]=c),void 0===t?n.push(a):t?t<l&&r.push(a):i.push(a)}return{missingBlocks:n,disabledBlocks:i,insufficientBlocks:r,successfulBlocks:o,passed:0===n.length&&0===i.length&&0===r.length}}},{}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateBlocksInSetExist=void 0,n.validateBlocksInSetExist=function({usedBlocks:e,blockIdsToCheck:t,count:n,requireUnique:i}){const r=[],o=e.filter((e=>e.isEnabled()));for(const e of t){const t=o.filter((t=>t.type===e));i&&t.length>=1?r.push(t[0]):r.push(...t)}return{successfulBlocks:r,passed:r.length>=n}}},{}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateBlockCommentsExist=void 0,n.validateBlockCommentsExist=function({usedBlocks:e,numRequired:t}){const n=e.filter((e=>!!e.getCommentText()));return{commentedBlocks:n,passed:n.length>=t}}},{}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.validateSpecificBlockCommentsExist=void 0,n.validateSpecificBlockCommentsExist=function({usedBlocks:e,blockType:t}){const n=e.filter((e=>e.type===t)),i=n.filter((e=>!e.getCommentText()));return{uncommentedBlocks:i,passed:0!==n.length&&0===i.length}}},{}],130:[function(e,t,n){"use strict";let i;Object.defineProperty(n,"__esModule",{value:!0}),n.isBlocks=n.initEditorExtensionsAsync=n.HELP_IMAGE_URI=void 0,n.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",n.initEditorExtensionsAsync=function(){if(!i&&(i=Promise.resolve(),pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.extendFieldEditors)){const e={};i=i.then((()=>pxt.BrowserUtils.loadBlocklyAsync())).then((()=>pxt.BrowserUtils.loadScriptAsync("fieldeditors.js"))).then((()=>pxt.editor.initFieldExtensionsAsync(e))).then((e=>{e.fieldEditors&&e.fieldEditors.forEach((e=>{pxt.blocks.registerFieldEditor(e.selector,e.editor,e.validator)}))}))}return i},n.isBlocks=function(e){return pxt.U.endsWith(e.name,".blocks")}},{}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.postHostMessageAsync=n.shouldPostHostMessages=n.enableControllerAnalytics=n.bindEditorMessages=void 0;const i=e("./code-validation/runValidatorPlan"),r=e("../pxtservices/iframeEmbeddedClient"),o={};let s;function a(e,t,n,i){if(e.response){const r={type:e.type,id:e.id,resp:t,success:n,error:i};s?s.postMessage(r):window.parent.postMessage(r,"*")}}function l(e){return new Promise(((t,n)=>{const i=pxt.Util.clone(e);i.id=ts.pxtc.Util.guidGen(),e.response&&(o[i.id]={resolve:t,reject:n}),s?s.postMessage(i):window.parent.postMessage(i,"*"),e.response||t(void 0)}))}n.bindEditorMessages=function(e){const t=(pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode())&&pxt.BrowserUtils.isIFrame(),n=pxt.appTarget.appTheme.allowPackageExtensions,l=pxt.appTarget.appTheme.allowSimulatorTelemetry;(t||n||l)&&(s=new r.IFrameEmbeddedClient((r=>{const s=r.data;if(!s||!/^pxt(host|editor|pkgext|sim)$/.test(s.type))return!1;if("pxtpkgext"===s.type&&n)e().then((e=>{e.handleExtensionRequest(s)}));else if("pxtsim"===s.type&&l){const e=s;"event"===e.action&&(e.category||e.message?pxt.reportError(e.category,e.message,e.data):pxt.tickEvent(e.tick,e.data))}else if(t){let t,n=Promise.resolve();if("pxthost"==s.type){const e=o[s.id];e?n=n.then((()=>e.resolve(s))):pxt.debug(`pxthost: unknown request ${s.id}`)}else"pxteditor"==s.type&&(n=n.then((()=>e().then((e=>{const n=s;switch(pxt.debug(`pxteditor: ${n.action}`),n.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then((()=>e.openJavaScript()));case"switchpython":return Promise.resolve().then((()=>e.openPython()));case"switchblocks":return Promise.resolve().then((()=>e.openBlocks()));case"startsimulator":return Promise.resolve().then((()=>e.startSimulator()));case"restartsimulator":return Promise.resolve().then((()=>e.restartSimulator()));case"hidesimulator":return Promise.resolve().then((()=>e.collapseSimulator()));case"showsimulator":return Promise.resolve().then((()=>e.expandSimulator()));case"closeflyout":return Promise.resolve().then((()=>e.closeFlyout()));case"unloadproject":return Promise.resolve().then((()=>e.unloadProjectAsync()));case"saveproject":return e.saveProjectAsync();case"redo":return Promise.resolve().then((()=>{const t=e.editor;t&&t.hasRedo()&&t.redo()}));case"undo":return Promise.resolve().then((()=>{const t=e.editor;t&&t.hasUndo()&&t.undo()}));case"setscale":{const t=s;return Promise.resolve().then((()=>e.editor.setScale(t.scale)))}case"stopsimulator":{const t=s;return Promise.resolve().then((()=>e.stopSimulator(t.unload)))}case"newproject":{const t=s;return Promise.resolve().then((()=>e.newProject(t.options)))}case"importproject":{const t=s;return Promise.resolve().then((()=>e.importProjectAsync(t.project,{filters:t.filters,searchBar:t.searchBar})))}case"openheader":{const t=s;return e.openProjectByHeaderIdAsync(t.headerId)}case"startactivity":{const t=s;let n,i=t.path;return/^([jt]s|py|blocks?):/i.test(i)&&(n=/^py:/i.test(i)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(i)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,i=i.substr(i.indexOf(":")+1)),Promise.resolve().then((()=>e.startActivity({activity:t.activityType,path:i,title:t.title,editor:n,previousProjectHeaderId:t.previousProjectHeaderId,carryoverPreviousCode:t.carryoverPreviousCode})))}case"importtutorial":{const t=s;return Promise.resolve().then((()=>e.importTutorialAsync(t.markdown)))}case"proxytosim":{const t=s;return Promise.resolve().then((()=>e.proxySimulatorMessage(t.content)))}case"renderblocks":{const n=s;return Promise.resolve().then((()=>e.renderBlocksAsync(n))).then((e=>e.xml.then((e=>{t=e.xml}))))}case"renderxml":{const n=s;return Promise.resolve().then((()=>e.renderXml(n).resultXml.then((e=>{t=e.xml}))))}case"renderbyblockid":{const n=s;return Promise.resolve().then((()=>e.renderByBlockIdAsync(n))).then((e=>e.resultXml.then((e=>{t=e.xml}))))}case"runeval":{const n=s,r=n.validatorPlan,o=n.planLib;return Promise.resolve().then((()=>{const t=e.getBlocks();return(0,i.runValidatorPlan)(t,r,o)})).then((e=>{t={result:e}}))}case"gettoolboxcategories":{const n=s;return Promise.resolve().then((()=>{t=e.getToolboxCategories(n.advanced)}))}case"renderpython":{const n=s;return Promise.resolve().then((()=>e.renderPythonAsync(n))).then((e=>{t=e.python}))}case"toggletrace":{const t=s;return Promise.resolve().then((()=>e.toggleTrace(t.intervalSpeed)))}case"settracestate":{const t=s;return Promise.resolve().then((()=>e.setTrace(t.enabled,t.intervalSpeed)))}case"setsimulatorfullscreen":{const t=s;return Promise.resolve().then((()=>e.setSimulatorFullScreen(t.enabled)))}case"togglehighcontrast":return Promise.resolve().then((()=>e.toggleHighContrast()));case"sethighcontrast":{const t=s;return Promise.resolve().then((()=>e.setHighContrast(t.on)))}case"togglegreenscreen":return Promise.resolve().then((()=>e.toggleGreenScreen()));case"print":return Promise.resolve().then((()=>e.printCode()));case"pair":return e.pairAsync().then((()=>{}));case"info":return Promise.resolve().then((()=>{t={versions:pxt.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:pxt.appTarget.appTheme.availableLocales}}));case"shareproject":{const n=s;return e.anonymousPublishHeaderByIdAsync(n.headerId,n.projectName).then((e=>{t=e}))}case"savelocalprojectstocloud":{const n=s;return e.saveLocalProjectsToCloudAsync(n.headerIds).then((e=>{t={headerIdMap:e}}))}case"requestprojectcloudstatus":{const t=s;return e.requestProjectCloudStatus(t.headerIds)}case"convertcloudprojectstolocal":{const t=s;return e.convertCloudProjectsToLocal(t.userId)}case"setlanguagerestriction":{const t=s;if("no-blocks"===t.restriction)throw console.warn("no-blocks language restriction is not supported"),new Error("no-blocks language restriction is not supported");return e.setLanguageRestrictionAsync(t.restriction)}}return Promise.resolve()})))));n.then((()=>a(s,t,!0,void 0)),(e=>a(s,t,!1,e)))}return!0})))},n.enableControllerAnalytics=function(){if(!pxt.appTarget.appTheme.allowParentController||!pxt.BrowserUtils.isIFrame())return;const e=pxt.tickEvent;pxt.tickEvent=function(t,n){e&&e(t,n),l({type:"pxthost",action:"event",tick:t,response:!1,data:n})};const t=pxt.reportException;pxt.reportException=function(e,n){t&&t(e,n);try{l({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:n})}catch(e){}};const n=pxt.reportError;pxt.reportError=function(e,t,i){n&&n(e,t,i),l({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:i})}},n.shouldPostHostMessages=function(){return pxt.appTarget.appTheme.allowParentController&&pxt.BrowserUtils.isIFrame()},n.postHostMessageAsync=l},{"../pxtservices/iframeEmbeddedClient":143,"./code-validation/runValidatorPlan":124}],132:[function(e,t,n){"use strict";function i(e){return`experiments-${"object"==typeof e?e.id:e}`}function r(){const e=pxt.savedAppTheme(),t={},n=o();return n.forEach((n=>{const i=s(n);e[n.id]=!!i,i&&(t[n.id]=i?1:0)})),n.length&&Object.keys(t).length&&(pxt.tickEvent("experiments.loaded",t),pxt.reloadAppTargetVariant()),pxt.appTarget.appTheme}function o(){const e=pxt.appTarget.appTheme.experiments;return e?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419",enableOnline:!0},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release"),enableOnline:!0},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"accessibleBlocks",name:lf("Accessible Blocks"),description:lf("Use the WASD keys to move and modify blocks."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6850"},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")},{id:"blocksErrorList",name:lf("Blocks Error List"),description:lf("Show an error list panel for Blocks")},{id:"timeMachine",name:lf("Time Machine"),description:lf("Save and restore past versions of a project")}].filter((t=>e.indexOf(t.id)>-1&&!(pxt.BrowserUtils.isPxtElectron()&&t.enableOnline))):[]}function s(e){return!!pxt.storage.getLocal(i(e))}function a(e,t){t!=s(e)&&(t?pxt.storage.setLocal(i(e),"1"):pxt.storage.removeLocal(i(e)),r())}Object.defineProperty(n,"__esModule",{value:!0}),n.setState=n.state=n.toggle=n.isEnabled=n.someEnabled=n.clear=n.all=n.syncTheme=void 0,n.syncTheme=r,n.all=o,n.clear=function(){o().forEach((e=>pxt.storage.removeLocal(i(e)))),r()},n.someEnabled=function(){return o().some((e=>s(e)))},n.isEnabled=s,n.toggle=function(e){a(e,!s(e))},n.state=function(){const e={};return o().forEach((t=>e[t.id]=s(t))),JSON.stringify(e)},n.setState=a},{}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.updateShareHistory=n.pushSnapshotOnHistory=n.updateHistory=n.parseHistoryFile=n.applySnapshot=n.createSnapshot=n.applyDiff=n.diffScriptText=n.collapseHistory=void 0;const i=9e5,r=864e5;function o(e,t,n,i){var r,o;const s=[];for(const n of Object.keys(e))(n.endsWith(".ts")||n.endsWith(".jres")||n.endsWith(".py")||n.endsWith(".blocks")||"pxt.json"===n)&&(null==t[n]?s.push({type:"removed",filename:n,value:e[n]}):e[n]!==t[n]&&s.push({type:"edited",filename:n,patch:i(t[n],e[n])}));for(const n of Object.keys(t))(n.endsWith(".ts")||n.endsWith(".jres")||n.endsWith(".py")||n.endsWith(".blocks")||"pxt.json"===n)&&null==e[n]&&s.push({type:"added",filename:n,value:t[n]});if(s.length)return{timestamp:n,editorVersion:null===(o=null===(r=pxt.appTarget)||void 0===r?void 0:r.versions)||void 0===o?void 0:o.target,changes:s}}function s(e,t,n){const i=Object.assign({},e);for(const r of t.changes)"added"===r.type?delete i[r.filename]:"removed"===r.type?i[r.filename]=r.value:i[r.filename]=n(r.patch,e[r.filename]);return i}function a(e){try{const t={},n=JSON.parse(e[pxt.CONFIG_NAME]);for(const i of n.files)i===pxt.IMAGES_CODE||i===pxt.TILEMAP_CODE?t[i]="":t[i]=e[i];if(t[pxt.CONFIG_NAME]=e[pxt.CONFIG_NAME],n.preferredEditor===pxt.BLOCKS_PROJECT_NAME?t[pxt.MAIN_BLOCKS]&&(t[pxt.MAIN_TS]=""):n.preferredEditor===pxt.PYTHON_PROJECT_NAME&&t[pxt.MAIN_PY]&&(t[pxt.MAIN_TS]=""),n.testFiles)for(const i of n.testFiles)t[i]=e[i];return t}catch(t){return Object.assign({},e)}}function l(e){const t=JSON.parse(e);return t.entries||(t.entries=[]),t.shares||(t.shares=[]),t.snapshots||(t.snapshots=[]),t}function c(e,t){return{timestamp:t,editorVersion:pxt.appTarget.versions.target,text:a(e)}}function u(){var e,t;return null!=(null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.appTheme)||void 0===t?void 0:t.timeMachineDiffInterval)?pxt.appTarget.appTheme.timeMachineDiffInterval:3e5}n.collapseHistory=function(e,t,n,i,r){var a,l;const c=[];let u,d,h,p=Object.assign({},t),f=null===(l=null===(a=pxt.appTarget)||void 0===a?void 0:a.versions)||void 0===l?void 0:l.target,{interval:g,minTime:m,maxTime:b}=n;void 0===m&&(m=0),void 0===b&&(b=e[e.length-1].timestamp);for(let t=e.length-1;t>=0;t--){const n=e[t];n.timestamp>b?(c.unshift(n),p=s(p,n,r)):n.timestamp<m?(void 0!==d&&(d-t>1?c.unshift({timestamp:u,editorVersion:f,changes:o(p,h,u,i).changes}):c.unshift(e[d])),c.unshift(n),d=void 0):void 0!==d?u-n.timestamp>g?(d-t>1?c.unshift({timestamp:u,editorVersion:f,changes:o(p,h,u,i).changes}):c.unshift(e[d]),h=Object.assign({},p),p=s(p,n,r),d=t,u=n.timestamp,f=n.editorVersion):p=s(p,n,r):(h=Object.assign({},p),u=n.timestamp,f=n.editorVersion,d=t,p=s(p,n,r))}return void 0!==d&&(d?c.unshift({timestamp:u,editorVersion:f,changes:o(p,h,u,i).changes}):c.unshift(e[0])),c},n.diffScriptText=o,n.applyDiff=s,n.createSnapshot=a,n.applySnapshot=function(e,t){var n;try{const i=Object.assign({},t),r=JSON.parse(e[pxt.CONFIG_NAME]);for(const t of Object.keys(e))-1!==r.files.indexOf(t)||-1!==(null===(n=r.testFiles)||void 0===n?void 0:n.indexOf(t))||i[t]||(i[t]=e[t]);return i}catch(n){const i=Object.assign({},e);for(const e of Object.keys(t))i[e]=t[e];return i}},n.parseHistoryFile=l,n.updateHistory=function(e,t,n,a,d,h){let p;p=e[pxt.HISTORY_FILE]?l(e[pxt.HISTORY_FILE]):{entries:[],snapshots:[c(e,n-1)],shares:[]};for(const e of a)p.shares.some((t=>t.id===e.id))||p.shares.push({id:e.id,timestamp:n});if(function(e,t){const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const r of n){if(-1===i.indexOf(r))return!1;if(e[r]!==t[r])return!1}return!0}(e,t))return void(t[pxt.HISTORY_FILE]=JSON.stringify(p));let f=!1;if(p.entries.length>1){const e=p.entries[p.entries.length-1].timestamp,t=p.entries[p.entries.length-2].timestamp;n-e<u()&&e-t<u()&&(f=!0)}if(f){const i=o(s(e,p.entries.pop(),h),t,n,d);i&&p.entries.push(i)}else{const i=o(e,t,n,d);i&&p.entries.push(i)}if(0==p.snapshots.length)p.snapshots.push(c(e,n-1));else if(n-p.snapshots[p.snapshots.length-1].timestamp>=function(){var e,t;return null!=(null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.appTheme)||void 0===t?void 0:t.timeMachineSnapshotInterval)?pxt.appTarget.appTheme.timeMachineSnapshotInterval:i}()){p.snapshots.push(c(e,n));const t=[];let i=Math.floor(n/r)*r;for(let e=0;e<p.snapshots.length;e++){const o=p.snapshots[p.snapshots.length-1-e];n-o.timestamp<r||e===p.snapshots.length-1?t.unshift(o):o.timestamp<i&&(t.unshift(o),i=Math.floor(o.timestamp/r)*r)}p.snapshots=t}t[pxt.HISTORY_FILE]=JSON.stringify(p)},n.pushSnapshotOnHistory=function(e,t){let n;(n=e[pxt.HISTORY_FILE]?l(e[pxt.HISTORY_FILE]):{entries:[],snapshots:[],shares:[]}).snapshots.push(c(e,t)),e[pxt.HISTORY_FILE]=JSON.stringify(n)},n.updateShareHistory=function(e,t,n){let i;i=e[pxt.HISTORY_FILE]?l(e[pxt.HISTORY_FILE]):{entries:[],snapshots:[],shares:[]};for(const e of n)i.shares.some((t=>t.id===e.id))||i.shares.push({id:e.id,timestamp:t});e[pxt.HISTORY_FILE]=JSON.stringify(i)}},{}],134:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.validation=n.experiments=n.workspace=n.monaco=n.history=void 0;const o=e("./history");n.history=o;const s=e("./monaco");n.monaco=s;const a=e("./workspace");n.workspace=a;const l=e("./experiments");n.experiments=l;const c=e("./code-validation");n.validation=c,r(e("./editor"),n),r(e("./editorcontroller"),n),r(e("./monaco-fields/monacoFieldEditor"),n),r(e("./monaco-fields/field_tilemap"),n),r(e("./monaco-fields/field_musiceditor"),n),r(e("./monaco-fields/field_soundEffect"),n),r(e("./monaco-fields/field_sprite"),n),r(e("./monaco-fields/field_react"),n)},{"./code-validation":123,"./editor":130,"./editorcontroller":131,"./experiments":132,"./history":133,"./monaco":141,"./monaco-fields/field_musiceditor":135,"./monaco-fields/field_react":136,"./monaco-fields/field_soundEffect":137,"./monaco-fields/field_sprite":138,"./monaco-fields/field_tilemap":139,"./monaco-fields/monacoFieldEditor":140,"./workspace":142}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.songEditorDefinition=n.MonacoSongEditor=void 0;const i=e("./field_react"),r=e("./monacoFieldEditor"),o="music-editor";class s extends i.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`"),this.text=e;const t=pxt.parseAssetTSReference(e);if(t){const{type:e,name:n}=t,i=n.trim(),r=pxt.react.getTilemapProject();this.isAsset=!0;const o=r.lookupAssetByName("song",i);if(o)return o;{const e=r.createNewSong(pxt.assets.music.getEmptySong(2));return i&&!r.isNameTaken("song",i)&&pxt.validateAssetName(i)&&(e.meta.displayName=i),e}}const n=/hex\s*(?:`|\(""")\s*([a-fA-F0-9]*)\s*(?:`|"""\))\s*(?:;?)/m.exec(e);if(n){const e=n[1].trim();return function(e){return{type:"song",id:"",internalID:0,meta:{},song:e}}(e?pxt.assets.music.decodeSongFromHex(e):pxt.assets.music.getEmptySong(2))}}resultToText(e){var t;if(null===(t=e.meta)||void 0===t?void 0:t.displayName){const t=pxt.react.getTilemapProject();return e=this.isAsset||t.lookupAsset(e.type,e.id)?t.updateAsset(e):t.createNewSong(e.song,e.meta.displayName),this.isAsset=!0,pxt.getTSReferenceForAsset(e,this.isPython)}let n=pxt.assets.music.encodeSongToHex(e.song);return n=this.isPython?`hex("""${n}""")`:"hex`"+n+"`",this.text.replace(/hex\s*(?:`|\(""")\s*([a-fA-F0-9]*)\s*(?:`|"""\))\s*(?:;?)/m,n)}getFieldEditorId(){return o}getOptions(){return{blocksInfo:this.host.blocksInfo()}}}n.MonacoSongEditor=s,n.songEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"fas fa-music sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:(?:assets\\s*\\.\\s*song)|(?:music\\s*\\.\\s*create(?:S|_s)ong\\s*\\(\\s*hex))\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:s},(0,r.registerMonacoFieldEditor)(o,n.songEditorDefinition)},{"./field_react":136,"./monacoFieldEditor":140}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MonacoReactFieldEditor=void 0;n.MonacoReactFieldEditor=class{getId(){return"image-editor"}showEditorAsync(e,t,n){return this.fileType=e,this.editrange=t,this.host=n,this.initAsync().then((()=>{const e=this.textToValue(n.getText(t));return e?(this.fv=pxt.react.getFieldEditorView(this.getFieldEditorId(),e,this.getOptions()),this.fv.onHide((()=>{this.onClosed()})),this.fv.show(),new Promise(((e,t)=>{this.resolver=e,this.rejecter=t}))):Promise.resolve(null)}))}onClosed(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)}dispose(){this.onClosed()}initAsync(){return Promise.resolve()}textToValue(e){return null}resultToText(e){return e+""}getFieldEditorId(){return""}getOptions(){return null}}},{}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.soundEditorDefinition=n.MonacoSoundEffectEditor=void 0;const i=e("./field_react"),r=e("./monacoFieldEditor"),o="soundeffect-editor";class s extends i.MonacoReactFieldEditor{textToValue(e){const t={wave:"sine",startFrequency:5e3,endFrequency:0,startVolume:255,endVolume:0,duration:500,effect:"none",interpolation:"linear"};this.value=t;const n=/\(([^)]*)\)/.exec(e)[1].split(",").map((e=>e.replace(/\s/g,"")));if(8!==n.length)return t;switch(n[0]){case"WaveShape.Sawtooth":t.wave="sawtooth";break;case"WaveShape.Square":t.wave="square";break;case"WaveShape.Noise":t.wave="noise";break;case"WaveShape.Triangle":t.wave="triangle";break;case"WaveShape.Sine":default:t.wave="sine"}const i=(e,t)=>isNaN(e)?t:e;switch(t.startFrequency=i(parseInt(n[1]),t.startFrequency),t.endFrequency=i(parseInt(n[2]),t.endFrequency),t.startVolume=i(parseInt(n[3]),t.startVolume),t.endVolume=i(parseInt(n[4]),t.endVolume),t.duration=i(parseInt(n[5]),t.duration),n[6]){case"SoundExpressionEffect.Vibrato":t.effect="vibrato";break;case"SoundExpressionEffect.Tremolo":t.effect="tremolo";break;case"SoundExpressionEffect.Warble":t.effect="warble";break;case"SoundExpressionEffect.None":default:t.effect="none"}switch(n[7]){case"InterpolationCurve.Logarithmic":t.interpolation="logarithmic";break;case"InterpolationCurve.Curve":t.interpolation="curve";break;case"InterpolationCurve.Linear":default:t.interpolation="linear"}return t}resultToText(e){let t,n,i;switch((e=this.value).wave){case"sine":t="WaveShape.Sine";break;case"square":t="WaveShape.Square";break;case"triangle":t="WaveShape.Triangle";break;case"noise":t="WaveShape.Noise";break;case"sawtooth":t="WaveShape.Sawtooth"}switch(e.effect){case"vibrato":n="SoundExpressionEffect.Vibrato";break;case"tremolo":n="SoundExpressionEffect.Tremolo";break;case"warble":n="SoundExpressionEffect.Warble";break;case"none":n="SoundExpressionEffect.None"}switch(e.interpolation){case"curve":i="InterpolationCurve.Curve";break;case"linear":i="InterpolationCurve.Linear";break;case"logarithmic":i="InterpolationCurve.Logarithmic"}return`music.createSoundEffect(${t}, ${Math.round(e.startFrequency)}, ${Math.round(e.endFrequency)}, ${Math.round(e.startVolume)}, ${Math.round(e.endVolume)}, ${Math.round(e.duration)}, ${n}, ${i})`}getFieldEditorId(){return o}getOptions(){return{onClose:()=>this.fv.hide(),onSoundChange:e=>this.value=e,initialSound:this.value,useFlex:!0,useMixerSynthesizer:"microbit"!==pxt.appTarget.id}}}n.MonacoSoundEffectEditor=s,n.soundEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"fas fa-music sprite-focus-hover",heightInPixels:510,matcher:{searchString:"music\\s*\\.\\s*createSoundEffect\\s*\\(",isRegex:!0,matchCase:!0,matchWholeWord:!1,validateRange:function(e,t){let n=e.startLineNumber,i=0,r=!1,o=0;const s=t.getLineCount();for(;n<s;){const s=t.getLineContent(n),a=s.indexOf("createSoundEffect");if(-1!==a&&(r=!0,i=a+"createSoundEffect".length),r)for(;i<s.length;){const r=s.charAt(i);if("("===r)o++;else if(")"===r&&0==--o)return new monaco.Range(e.startLineNumber,e.startColumn,n,i+t.getLineMinColumn(n)+1);i++}i=0,n++}}},proto:s},(0,r.registerMonacoFieldEditor)(o,n.soundEditorDefinition)},{"./field_react":136,"./monacoFieldEditor":140}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.spriteEditorDefinition=n.MonacoSpriteEditor=void 0;const i=e("./field_react"),r=e("./monacoFieldEditor"),o="image-editor";class s extends i.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`"),this.template=e.startsWith("bmp")?"bmp":"img";const t=pxt.parseAssetTSReference(e);if(t){const{type:e,name:n}=t,i=n.trim(),r=pxt.react.getTilemapProject();this.isAsset=!0;const o=r.lookupAssetByName("image",i);if(o)return o;{const e=r.createNewImage();return i&&!r.isNameTaken("image",i)&&pxt.validateAssetName(i)&&(e.meta.displayName=i),e}}return function(e){return{type:"image",id:"",internalID:0,bitmap:e.data(),meta:{},jresData:""}}(pxt.sprite.imageLiteralToBitmap(e,this.template))}resultToText(e){var t;if(null===(t=e.meta)||void 0===t?void 0:t.displayName){const t=pxt.react.getTilemapProject();return e=this.isAsset||t.lookupAsset(e.type,e.id)?t.updateAsset(e):t.createNewProjectImage(e.bitmap,e.meta.displayName),this.isAsset=!0,pxt.getTSReferenceForAsset(e,this.isPython)}return pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e.bitmap),this.isPython?"python":"typescript",this.template)}getFieldEditorId(){return"image-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}}n.MonacoSpriteEditor=s,n.spriteEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:img|bmp|assets\\s*\\.\\s*image)\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:s},(0,r.registerMonacoFieldEditor)(o,n.spriteEditorDefinition)},{"./field_react":136,"./monacoFieldEditor":140}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tilemapEditorDefinition=n.MonacoTilemapEditor=void 0;const i=e("./field_react"),r=e("./monacoFieldEditor"),o="tilemap-editor";class s extends i.MonacoReactFieldEditor{textToValue(e){const t=this.readTilemap(e),n=pxt.react.getTilemapProject();return pxt.sprite.addMissingTilemapTilesAndReferences(n,t),t}readTilemap(e){const t=pxt.react.getTilemapProject();if(/^\s*tiles\s*\./.test(e)&&(this.isTilemapLiteral=!1,e)){try{return function(e){return{type:"tilemap",id:"",internalID:0,meta:{},data:e}}(pxt.sprite.decodeTilemap(e,"typescript",t))}catch(e){}return null}this.isTilemapLiteral=!0;const n=/^\s*(tilemap(?:4|8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(e),i=(n[2]||n[3]||"").trim();let r,o;if(this.tilemapLiteral=n[1],i&&(o=ts.pxtc.escapeIdentifier(i),r=t.getTilemap(o)||t.lookupAssetByName("tilemap",i)),!r){let e=16;"tilemap8"===this.tilemapLiteral?e=8:"tilemap32"===this.tilemapLiteral?e=32:"tilemap4"===this.tilemapLiteral&&(e=4);const[n]=t.createNewTilemap(o,e,16,16);r=t.getTilemap(n),o=n}return r}resultToText(e){const t=pxt.react.getTilemapProject();return t.pushUndo(),pxt.sprite.updateTilemapReferencesFromResult(t,e),this.isTilemapLiteral?(t.updateAsset(e),pxt.getTSReferenceForAsset(e,"python"===this.fileType)):pxt.sprite.encodeTilemap(e.data,"typescript"===this.fileType?"typescript":"python")}getFieldEditorId(){return"tilemap-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}getCreateTilemapRange(){const e=this.editrange.getStartPosition();let t,n=this.editrange.getEndPosition(),i=1;for(;;){t=new monaco.Range(n.lineNumber,n.column,n.lineNumber+1,0);const r=this.host.getText(t);for(let t=0;t<r.length;t++)if("("===r.charAt(t))i++;else if(")"===r.charAt(t)&&0==--i){const i=new monaco.Position(n.lineNumber,n.column+t+2);return monaco.Range.fromPositions(e,i)}if((n=t.getEndPosition()).lineNumber>e.lineNumber+20)return null}}}n.MonacoTilemapEditor=s,n.tilemapEditorDefinition={id:o,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:s},(0,r.registerMonacoFieldEditor)(o,n.tilemapEditorDefinition)},{"./field_react":136,"./monacoFieldEditor":140}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getMonacoFieldEditor=n.registerMonacoFieldEditor=void 0;const i={};n.registerMonacoFieldEditor=function(e,t){i[e]=t},n.getMonacoFieldEditor=function(e){return i[e]}},{}],141:[function(e,t,n){"use strict";function i(e){const t=pxt.appTarget.appTheme.invertedMonaco,n=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),i=pxt.BrowserUtils.isAndroid();let r=monaco.editor.create(e,{model:null,ariaLabel:pxt.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:n,glyphMargin:n||pxt.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!i,comments:!i,strings:!i},acceptSuggestionOnCommitCharacter:!i,acceptSuggestionOnEnter:i?"off":"on",accessibilitySupport:i?"off":"on"});return r.layout(),r}Object.defineProperty(n,"__esModule",{value:!0}),n.createEditor=n.initMonacoAsync=n.syncModels=void 0,n.syncModels=function(e,t,n,i){if(i)return;let r=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),o={};e.sortedDeps().forEach((e=>{e.getFiles().forEach((i=>{let r=e.id+"/"+i;if(/\.(ts)$/.test(i)&&r!=n){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[r]){let n=e.readFile(i)||"\n";t[r]=monaco.languages.typescript.typescriptDefaults.addExtraLib(n,r)}o[r]="1"}}))})),Object.keys(r).filter((e=>/\.(ts)$/.test(e)&&!o[e])).forEach((e=>{t[e].dispose()}))},n.initMonacoAsync=function(e){return new Promise(((t,n)=>{if("object"==typeof window.monaco)return void t(i(e));let r=window.MonacoPaths,o=()=>{let n=window.require;n.config({paths:r}),n(["vs/editor/editor.main"],(()=>{monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript&&(monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setWorkerOptions({customWorkerPath:pxt.webConfig.typeScriptWorkerJs}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1})),t(i(e))}))};if(window.require)o();else{let e=document.createElement("script");e.type="text/javascript",e.src=r["vs/loader"],e.addEventListener("load",o),document.body.appendChild(e)}}))},n.createEditor=i},{}],142:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.freshHeader=void 0,n.freshHeader=function(e,t){return{target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,name:e,meta:{},editor:pxt.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:pxt.U.guidGen(),recentUse:t,modificationTime:t,cloudUserId:null,cloudCurrent:!1,cloudVersion:null,cloudLastSyncTime:0,isDeleted:!1}}},{}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.IFrameEmbeddedClient=void 0;n.IFrameEmbeddedClient=class{constructor(e){this.messageHandler=e,this.onMessageReceived=e=>{const t=e.data;if(t){if("iframeclientsetmessageport"===t.type)return this.port=e.ports[0],this.port.onmessage=this.onMessageReceived,void this.postMessage({type:"iframeclientsetmessageport"});if("iframeclientready"===t.type)return void this.sendReadyMessage()}this.messageHandler(e)},this.frameId=function(){const e=/frameid=([a-zA-Z0-9\-]+)/i.exec(window.location.href);if(e)return e[1]}(),window.addEventListener("message",this.onMessageReceived),this.sendReadyMessage()}dispose(){window.removeEventListener("message",this.onMessageReceived),this.port&&this.port.close()}postMessage(e){this.postMessageCore(e)}postMessageCore(e){this.frameId&&(e.frameId=this.frameId),this.port?this.port.postMessage(e):window.acquireVsCodeApi?window.acquireVsCodeApi().postMessage(e):window.parent.postMessage(e,"*")}sendReadyMessage(){this.postMessage({type:"iframeclientready"})}}},{}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.pushNotificationMessage=n.Notification=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-dom");class s extends r.Component{constructor(e){super(e),this.state={notifications:{}}}push(e){const t=this.state.notifications,n=ts.pxtc.Util.guidGen();Object.keys(t).filter((n=>t[n].kind==e.kind)).forEach((e=>this.remove(e))),t[n]=e;const i=this;setTimeout((()=>{i.remove(n)}),3e3),this.setState({notifications:t})}remove(e){const t=this.state.notifications;t[e]&&(delete t[e],this.setState({notifications:t}))}render(){const{notifications:e}=this.state;return(0,i.jsx)("div",Object.assign({id:"msg","aria-live":"polite"},{children:Object.keys(e).map((t=>function(e,t){const{kind:n,text:r,hc:o}=t;let s="ignored info message";switch(n){case"err":s="red inverted segment";break;case"warn":s="orange inverted segment";break;case"info":s="teal inverted segment";break;case"compile":s="ignored info message"}return(0,i.jsx)("div",Object.assign({id:`${n}msg`,className:`ui ${o} ${s}`},{children:r}),`${e}`)}(t,e[t])))}))}}n.Notification=s;let a,l=!1;n.pushNotificationMessage=function(e){if(l)a&&a.push(e);else{l=!0;const t=document.body.appendChild(document.createElement("div"));(a=o.render(r.createElement(s,e),t)).push(e)}}},{react:548,"react-dom":491,"react/jsx-runtime":549}],145:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Confetti=void 0;const i=e("react/jsx-runtime");n.Confetti=e=>{const{children:t}=e;return(0,i.jsxs)("div",Object.assign({className:"confetti-container"},{children:[t,Array(100).fill(0).map(((e,t)=>{const n={animationDelay:t%100*.1+"s",left:1*Math.floor(100*Math.random())+"%"};return(0,i.jsx)("div",{style:n,className:`confetti ${Math.random()>.5?"reverse":""} color-${Math.floor(9*Math.random())}`},t)}))]}))}},{"react/jsx-runtime":549}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Button=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.Button=e=>{const{id:t,className:n,style:o,ariaLabel:s,ariaHidden:a,ariaDescribedBy:l,ariaControls:c,ariaExpanded:u,ariaHasPopup:d,ariaPosInSet:h,ariaSetSize:p,ariaSelected:f,ariaPressed:g,role:m,onClick:b,onKeydown:y,onBlur:v,buttonRef:_,title:E,label:T,leftIcon:x,rightIcon:w,hardDisabled:k,href:S,target:C,tabIndex:A,children:I}=e;let{disabled:O}=e;O=O||k;const N=(0,r.classList)("common-button",n,O&&"disabled");return(0,i.jsxs)("button",Object.assign({id:t,className:N,style:o,title:E,ref:_,onClick:O?void 0:e=>{b&&b(),S&&window.open(S,C||"_blank","noopener,noreferrer"),e.stopPropagation(),e.preventDefault()},onKeyDown:y||r.fireClickOnEnter,onBlur:v,role:m||"button",tabIndex:A||(O?-1:0),disabled:k,"aria-label":s,"aria-hidden":a,"aria-controls":c,"aria-expanded":u,"aria-haspopup":d,"aria-posinset":h,"aria-setsize":p,"aria-describedby":l,"aria-selected":f,"aria-pressed":g},{children:[(x||w||T)&&(0,i.jsxs)("span",Object.assign({className:"common-button-flex"},{children:[x&&(0,i.jsx)("i",{className:x,"aria-hidden":!0}),(0,i.jsx)("span",Object.assign({className:"common-button-label"},{children:T})),w&&(0,i.jsx)("i",{className:"right "+w,"aria-hidden":!0})]})),I]}))}},{"../util":187,"react/jsx-runtime":549}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Card=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.Card=e=>{const{id:t,className:n,role:o,children:s,ariaDescribedBy:a,ariaLabelledBy:l,ariaHidden:c,ariaLabel:u,onClick:d,label:h,labelClass:p,tabIndex:f}=e;return(0,i.jsxs)("div",Object.assign({id:t,className:(0,r.classList)("common-card",n),role:o||(d?"button":void 0),"aria-describedby":a,"aria-labelledby":l,"aria-hidden":c,"aria-label":u,onClick:d,tabIndex:f,onKeyDown:r.fireClickOnEnter},{children:[(0,i.jsx)("div",Object.assign({className:"common-card-body"},{children:s})),h&&(0,i.jsx)("label",Object.assign({className:(0,r.classList)("common-card-label",p)},{children:h}))]}))}},{"../util":187,"react/jsx-runtime":549}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Checkbox=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.Checkbox=e=>{const{id:t,className:n,ariaHidden:o,ariaLabel:s,role:a,isChecked:l,onChange:c,label:u}=e;return(0,i.jsxs)("div",Object.assign({className:(0,r.classList)("common-checkbox",n)},{children:[(0,i.jsx)("input",{id:t,tabIndex:0,type:"checkbox",checked:l,onChange:()=>{c(!l)},onKeyDown:r.fireClickOnEnter,role:a,"aria-hidden":o,"aria-label":s}),u&&(0,i.jsx)("label",Object.assign({htmlFor:t},{children:u}))]}))}},{"../util":187,"react/jsx-runtime":549}],149:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DraggableGraph=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");function s(e,t,n,i,r,o){let s;switch(r){case"linear":s=r=>t+(r-e)*(i-t)/(n-e);break;case"curve":s=r=>t+(i-t)*Math.sin((r-e)/(n-e)*(Math.PI/2));break;case"logarithmic":s=r=>t+Math.log10(1+(r-e)/(n-e)*9)*(i-t)}const a=(n-e)/20,l=[`M ${e} ${t}`];let c=e,u=t,d=e,h=t;for(let t=1;t<21;t++){if(h=s(d=e+t*a),!o){l.push(`L ${d} ${h}`);continue}const n=Math.atan2(h-u,d-c),i=Math.sqrt((h-u)**2+(d-c)**2),r=c+Math.cos(n)*(i/4)+20*Math.cos(n+Math.PI/2),p=u+Math.sin(n)*(i/4)+20*Math.sin(n+Math.PI/2);l.push(`Q ${r} ${p} ${c+Math.cos(n)*(i/2)} ${u+Math.sin(n)*(i/2)}`);const f=c+Math.cos(n)*(3*i/4)-20*Math.cos(n+Math.PI/2),g=u+Math.sin(n)*(3*i/4)-20*Math.sin(n+Math.PI/2);l.push(`Q ${f} ${g} ${d} ${h}`),c=d,u=h}return l.join(" ")}n.DraggableGraph=e=>{const{interpolation:t,min:n,max:a,points:l,handleStartAnimationRef:c,onPointChange:u,id:d,className:h,ariaLabel:p,ariaHidden:f,ariaDescribedBy:g,role:m,aspectRatio:b,squiggly:y,valueUnits:v}=e,_=1/b*1e3,E=_-62.5,T=962.5/(l.length-1),x=E/(a-n),[w,k]=r.useState(-1),S=e=>(1-(e.y-25)/E)*(a-n)+n;let C;const A=(e,t)=>{C&&cancelAnimationFrame(C),C=requestAnimationFrame((()=>{I(e,t)}))},I=(e,t)=>{u(e,Math.max(Math.min(t,a),n))},O=[],N=e=>t=>{t&&(O[e]=t)};r.useEffect((()=>{O.forEach(((e,t)=>{e.onpointerdown=n=>{if(-1!==w)return;n.preventDefault();const i=(0,o.clientCoord)(n),r=(0,o.screenToSVGCoord)(e.ownerSVGElement,i);k(t),A(t,S(r))},e.onpointermove=n=>{if(w!==t)return;n.preventDefault();const i=(0,o.clientCoord)(n),r=(0,o.screenToSVGCoord)(e.ownerSVGElement,i);A(t,S(r))},e.onpointerleave=n=>{if(w!==t)return;k(-1);const i=(0,o.clientCoord)(n),r=(0,o.screenToSVGCoord)(e.ownerSVGElement,i);A(t,S(r))},e.onpointerup=n=>{if(w!==t)return;k(-1);const i=(0,o.clientCoord)(n),r=(0,o.screenToSVGCoord)(e.ownerSVGElement,i);A(t,S(r))}}))}),[w,u]);const R=e=>Math.min(Math.max(l[e],n),a);return(0,i.jsx)("div",Object.assign({id:d,className:(0,o.classList)("common-draggable-graph",h),"aria-label":p,"aria-hidden":f,"aria-describedby":g,role:m},{children:(0,i.jsxs)("svg",Object.assign({className:"draggable-graph-svg",viewBox:`0 0 1000 ${_}`,xmlns:"http://www.w3.org/2000/svg"},{children:[(0,i.jsx)("defs",{children:(0,i.jsxs)("filter",Object.assign({id:"dropshadow"},{children:[(0,i.jsx)("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3"}),(0,i.jsx)("feOffset",{dx:"0",dy:"0"}),(0,i.jsx)("feComponentTransfer",{children:(0,i.jsx)("feFuncA",{type:"linear",slope:"0.5"})}),(0,i.jsxs)("feMerge",{children:[(0,i.jsx)("feMergeNode",{}),(0,i.jsx)("feMergeNode",{in:"SourceGraphic"})]})]}))}),l.map(((e,n)=>{const r=n<l.length-1,o=Math.max(T*n-12.5,25),c=25+Math.max(x*(a-R(n))-12.5,12.5),u=r&&R(n+1)>R(n)||!r&&R(n-1)>R(n);return(0,i.jsxs)("g",Object.assign({className:"draggable-graph-column"},{children:[r&&(0,i.jsx)("path",{className:"draggable-graph-path",stroke:"black",fill:"none",strokeWidth:"2px",d:s(o,c,Math.max(T*(n+1),0),25+Math.max(x*(a-R(n+1))-12.5,12.5),t,y)}),(0,i.jsx)("circle",{className:"draggable-graph-point",cx:o+12.5,cy:c,r:25,fill:"white",filter:"url(#dropshadow)"}),(0,i.jsx)("text",Object.assign({className:"common-draggable-graph-text",x:r?o+50:o-25,y:u?c+50:Math.max(c-25,25),textAnchor:r?"start":"end",fontSize:25},{children:Math.round(R(n))+(v||"")})),(0,i.jsx)("rect",{className:"draggable-graph-surface",ref:N(n),x:o-T/6,y:0,width:T/3,height:_,fill:"white",opacity:0})]}),n)})),(0,i.jsx)("rect",Object.assign({x:"-2",y:"0",width:"1",height:"100%",fill:"grey"},{children:(0,i.jsx)("animate",{ref:e=>{e&&c&&c((t=>{t<=0&&(t=1),e.setAttribute("dur",t+"ms"),e.beginElement()}))},attributeName:"x",from:"2%",to:"98%",dur:"1000ms",begin:"indefinite"})}))]}))}))}},{"../util":187,react:548,"react/jsx-runtime":549}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Dropdown=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util"),s=e("./Button"),a=e("./FocusList");n.Dropdown=e=>{const{id:t,className:n,ariaHidden:l,ariaLabel:c,role:u,items:d,tabIndex:h,selectedId:p,onItemSelected:f}=e,[g,m]=r.useState(!1);let b;const y=(0,o.classList)("common-dropdown",n),v=d.find((e=>e.id===p))||d[0];return(0,i.jsxs)("div",Object.assign({className:y,ref:e=>{e&&(b=e)},onBlur:e=>{b&&g&&!b.contains(e.relatedTarget)&&m(!1)}},{children:[(0,i.jsx)(s.Button,Object.assign({},v,{id:t,tabIndex:h,rightIcon:g?"fas fa-chevron-up":"fas fa-chevron-down",role:u,className:(0,o.classList)("common-dropdown-button",g&&"expanded",v.className),onClick:()=>{m(!g)},onKeydown:e=>{const t=d.indexOf(v);"ArrowDown"===e.key?t<d.length-1&&(f(d[t+1].id),e.preventDefault(),e.stopPropagation()):"ArrowUp"===e.key?t>0&&(f(d[t-1].id),e.preventDefault(),e.stopPropagation()):"Enter"===e.key&&(m(!0),e.preventDefault(),e.stopPropagation())},ariaHasPopup:"listbox",ariaExpanded:g,ariaLabel:c,ariaHidden:l})),g&&(0,i.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:p,"aria-labelledby":t,useUpAndDownArrowKeys:!0,onItemReceivedFocus:e=>{e.id&&d.some((t=>t.id===e.id))&&f(e.id)}},{children:(0,i.jsx)("ul",Object.assign({role:"presentation"},{children:d.map((e=>(0,i.jsx)("li",Object.assign({role:"presentation"},{children:(0,i.jsx)(s.Button,Object.assign({},e,{className:(0,o.classList)("common-dropdown-item",e.className),onClick:()=>{m(!1),f(e.id)},ariaSelected:e.id===p,role:"option"}))}),e.id)))}))}))]}))}},{"../util":187,"./Button":146,"./FocusList":152,react:548,"react/jsx-runtime":549}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditorToggle=void 0;const i=e("react/jsx-runtime"),r=e("../util"),o=e("./Button"),s=e("./FocusList"),a=e("./MenuDropdown");n.EditorToggle=e=>{const{id:t,className:n,ariaHidden:o,ariaLabel:s,role:d,items:h,selected:p}=e,f=h.some((e=>u(e))),g=e=>{};return(0,i.jsxs)("div",Object.assign({className:"common-editor-toggle-outer"},{children:[(0,i.jsx)(c,Object.assign({},e)),(0,i.jsxs)("div",Object.assign({id:t,className:(0,r.classList)("common-editor-toggle",f&&"has-dropdown",n),role:d||"tablist","aria-hidden":!0,"aria-label":s},{children:[h.map(((e,t)=>{const n=p===t;return(0,i.jsxs)("div",Object.assign({className:(0,r.classList)("common-editor-toggle-item",n&&"selected",u(e)&&"common-editor-toggle-item-dropdown")},{children:[(0,i.jsx)(l,{item:e,isSelected:n,onKeydown:g}),u(e)&&(0,i.jsx)(a.MenuDropdown,{id:"toggle-dropdown",className:"toggle-dropdown",icon:"fas fa-chevron-down",title:lf("More options"),tabIndex:-1,ariaHidden:!0,items:e.items.map((e=>({title:e.title,label:e.label,onClick:e.onClick,leftIcon:e.icon})))})]}),t)})),(0,i.jsx)("div",{className:"common-editor-toggle-handle","aria-hidden":!0})]}))]}))};const l=e=>{const{item:t,isSelected:n,onKeydown:r}=e,{label:s,title:a,onClick:l,icon:c,focusable:u}=t;return(0,i.jsx)(o.Button,{className:c?void 0:"no-icon",role:u?"tab":void 0,tabIndex:-1,onKeydown:r,label:s,title:a,onClick:l,leftIcon:c,ariaHidden:!0})},c=e=>{const{items:t,id:n,selected:r,ariaHidden:a}=e,l=t.reduce(((e,t,n)=>{const i=[...e];return i.push(Object.assign({},t)),r===n&&(i[i.length-1].selected=!0),u(t)&&i.push(...t.items.filter((e=>e.focusable))),i}),[]);return(0,i.jsx)(s.FocusList,Object.assign({id:n,role:"tablist",className:"common-toggle-accessibility",childTabStopId:n+"-selected"},{children:l.map(((e,t)=>(0,i.jsx)(o.Button,{className:e.selected?"selected":void 0,id:e.selected?n+"-selected":void 0,role:"tab",title:e.title,label:e.label,onClick:e.onClick,ariaSelected:e.selected,ariaHidden:a},t)))}))};function u(e){var t;return!!(null===(t=e.items)||void 0===t?void 0:t.length)}},{"../util":187,"./Button":146,"./FocusList":152,"./MenuDropdown":158,"react/jsx-runtime":549}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FocusList=void 0;const i=e("react/jsx-runtime");n.FocusList=e=>{const{id:t,className:n,role:r,ariaHidden:o,ariaLabel:s,childTabStopId:a,children:l,onItemReceivedFocus:c,useUpAndDownArrowKeys:u}=e;let d,h;const p=e=>"true"===e.getAttribute("data-isfocusable")&&"none"!==getComputedStyle(e).display,f=()=>d.find((e=>p(e))),g=()=>{for(let e=0;e<d.length;e++)if(p(d[d.length-1-e]))return d[d.length-1-e];return d[0]},m=(e,t)=>{let n;for(let i=1;i<d.length;i++)if(n=t?d[(e+i)%d.length]:d[(e+d.length-i)%d.length],p(n))return n;return d[0]};return(0,i.jsx)("div",Object.assign({id:t,className:n,role:r,tabIndex:a?void 0:0,onKeyDown:e=>{if(!(null==d?void 0:d.length))return;const t=document.activeElement,n=d.indexOf(t),i=e=>{e.focus(),c&&c(e)};-1===n&&t!==h||("Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),t.click?t.click():t.dispatchEvent(new Event("click"))):e.key===(u?"ArrowDown":"ArrowRight")?(n===d.length-1||t===h?i(f()):i(m(n,!0)),e.preventDefault(),e.stopPropagation()):e.key===(u?"ArrowUp":"ArrowLeft")?(i(0===n||t===h?g():m(n,!1)),e.preventDefault(),e.stopPropagation()):"Home"===e.key?(i(f()),e.preventDefault(),e.stopPropagation()):"End"===e.key&&(i(g()),e.preventDefault(),e.stopPropagation()))},ref:e=>{if(!e||h)return;h=e;const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]');d=[];for(const e of t.values())d.push(e),e.setAttribute("tabindex","-1"),e.setAttribute("data-isfocusable","true");if(a){const e=h.querySelector("#"+a);e&&e.setAttribute("tabindex","0")}},"aria-hidden":o,"aria-label":s},{children:l}))}},{"react/jsx-runtime":549}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FocusTrap=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");n.FocusTrap=e=>{const{children:t,id:n,className:s,onEscape:a,arrowKeyNavigation:l,dontStealFocus:c,includeOutsideTabOrder:u}=e;let d;const[h,p]=r.useState(!1),f=()=>(0,o.nodeListToArray)(u?d.querySelectorAll("[tabindex]"):d.querySelectorAll('[tabindex]:not([tabindex="-1"])'));return(0,i.jsx)("div",Object.assign({id:n,className:(0,o.classList)("common-focus-trap",s),ref:e=>{e&&(d=e,c||h||e.contains(document.activeElement)||!f().length||(d.focus(),p(!0)))},onKeyDown:e=>{if(!d)return;const t=(t,n)=>{const i=f();if(!i.length)return;const r=i.indexOf(e.target);t?n?i[i.length-1].focus():r===i.length-1?i[0].focus():i[r+1].focus():n?i[0].focus():0===r?i[i.length-1].focus():i[Math.max(r-1,0)].focus(),e.preventDefault(),e.stopPropagation()};"Escape"===e.key?(a(),e.preventDefault(),e.stopPropagation()):"Tab"===e.key?e.shiftKey?t(!1,!1):t(!0,!1):l&&("ArrowDown"===e.key?t(!0,!1):"ArrowUp"===e.key?t(!1,!1):"Home"===e.key?t(!1,!0):"End"===e.key&&t(!0,!0))},tabIndex:-1},{children:t}))}},{"../util":187,react:548,"react/jsx-runtime":549}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Input=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util"),s=e("./Button"),a=e("./FocusList");n.Input=e=>{var t;const{id:n,className:l,inputClassName:c,groupClassName:u,role:d,ariaHidden:h,ariaLabel:p,initialValue:f,label:g,title:m,placeholder:b,icon:y,iconTitle:v,disabled:_,type:E,readOnly:T,autoComplete:x,selectOnClick:w,onChange:k,onEnterKey:S,onIconClick:C,onBlur:A,onOptionSelected:I,handleInputRef:O,preserveValueOnBlur:N,options:R}=e,[D,L]=r.useState(void 0),[M,P]=r.useState(!1);let B;const j=e=>e&&-1!=Object.values(R).indexOf(e)?`dropdown-item-${e}`:void 0;return(0,i.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-wrapper",_&&"disabled",l),onBlur:e=>{M&&!B.contains(e.relatedTarget)&&P(!1)},ref:e=>{e&&(B=e)}},{children:[g&&(0,i.jsx)("label",Object.assign({className:"common-input-label",htmlFor:n},{children:g})),(0,i.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-group",u)},{children:[(0,i.jsx)("input",{id:n,className:(0,o.classList)("common-input",y&&"has-icon",c),title:m,role:d||"textbox",tabIndex:_?-1:0,"aria-label":p,"aria-hidden":h,type:E||"text",placeholder:b,value:void 0!==D?D:f||"",readOnly:!!T,onClick:e=>{w&&e.target.select(),R&&!M&&P(!0)},onChange:e=>{const t=e.target.value;T||D===t||L(t),k&&k(t)},onKeyDown:t=>{var n,i;const r="number"==typeof t.which?t.which:t.keyCode;if(13===r||e.treatSpaceAsEnter&&32===r)S&&(t.preventDefault(),S(D));else if(R&&M&&"ArrowDown"===t.key)null===(n=document.getElementById(j(Object.values(R)[0])))||void 0===n||n.focus(),t.preventDefault(),t.stopPropagation();else if(R&&M&&"ArrowUp"===t.key){const e=Object.values(R);null===(i=document.getElementById(j(e[e.length-1])))||void 0===i||i.focus(),t.preventDefault(),t.stopPropagation()}},onBlur:()=>{A&&A(D),N||L(void 0)},autoComplete:x?"":"off",autoCorrect:x?"":"off",autoCapitalize:x?"":"off",spellCheck:x,disabled:_,ref:O}),y&&(C?(0,i.jsx)(s.Button,{leftIcon:y,title:v,disabled:_,onClick:()=>{C&&C(D)}}):(0,i.jsx)("i",{className:y,"aria-hidden":!0})),R&&(0,i.jsx)(s.Button,{leftIcon:M?"fas fa-chevron-up":"fas fa-chevron-down",title:v,disabled:_,ariaHasPopup:"listbox",ariaExpanded:M,ariaLabel:p,onClick:()=>{R&&P(!M)}})]})),M&&(0,i.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:null!==(t=j(D))&&void 0!==t?t:j(Object.values(R)[0]),"aria-labelledby":n,useUpAndDownArrowKeys:!0},{children:(0,i.jsx)("ul",Object.assign({role:"presentation"},{children:Object.keys(R).map((e=>(0,i.jsx)("li",Object.assign({role:"presentation"},{children:(0,i.jsx)(s.Button,{title:e,label:e,id:j(R[e]),className:(0,o.classList)("common-dropdown-item"),onClick:()=>(e=>{var t;P(!1);const i=R[e];L(i),I&&I(i),null===(t=document.getElementById(n))||void 0===t||t.focus()})(e),ariaSelected:j(R[e])===j(null!=D?D:f),role:"option"})}),e)))}))}))]}))}},{"../util":187,"./Button":146,"./FocusList":152,react:548,"react/jsx-runtime":549}],155:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LazyImage=void 0;const i=e("react/jsx-runtime");let r;n.LazyImage=e=>{const{id:t,className:n,role:o,src:s,alt:a,title:l,ariaLabel:c,ariaHidden:u,ariaDescribedBy:d,loadingElement:h}=e;let p;return function(){if(r)return;r=new IntersectionObserver((e=>{e.forEach((e=>{if(e.intersectionRatio>0){r.unobserve(e.target);const t=e.target.getAttribute("data-src");e.target.src=t;const n=e.target;n.src=t,n.onload=()=>{n.parentElement.classList.add("loaded"),n.parentElement.classList.remove("error")},n.onerror=()=>{n.parentElement.classList.add("error"),n.parentElement.classList.remove("loaded")}}}))}),{rootMargin:"50px 0px",threshold:.01})}(),(0,i.jsxs)("div",Object.assign({className:"common-lazy-image-wrapper"},{children:[(0,i.jsx)("div",Object.assign({className:"loading-element"},{children:h||(0,i.jsx)("div",{className:"common-spinner"})})),(0,i.jsx)("img",{id:t,ref:e=>{e&&(p&&r.unobserve(p),p=e,r.observe(e))},className:n,"data-src":s,alt:a,title:l,role:o,"aria-label":c,"aria-hidden":u,"aria-describedby":d}),(0,i.jsx)("i",{className:"fas fa-image","aria-hidden":!0})]}))}},{"react/jsx-runtime":549}],156:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Link=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.Link=e=>{const{id:t,className:n,ariaLabel:o,href:s,target:a,children:l,tabIndex:c}=e,u=(0,r.classList)("common-link",n);return(0,i.jsx)("a",Object.assign({id:t,className:u,"aria-label":o,href:s,target:a,rel:"_blank"===a?"noopener noreferrer":"",tabIndex:null!=c?c:0},{children:l}))}},{"../util":187,"react/jsx-runtime":549}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.List=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");n.List=e=>{const{id:t,className:n,ariaHidden:s,ariaLabel:a,role:l}=e;return(0,i.jsx)("div",Object.assign({id:t,"aria-hidden":s,"aria-label":a,role:l,className:(0,o.classList)("common-list",n)},{children:r.Children.map(e.children,((e,t)=>(0,i.jsx)("div",Object.assign({className:"common-list-item"},{children:e}),t)))}))}},{"../util":187,react:548,"react/jsx-runtime":549}],158:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MenuDropdown=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util"),s=e("./Button"),a=e("./FocusTrap");n.MenuDropdown=e=>{const{id:t,className:n,ariaHidden:l,ariaLabel:c,role:u,items:d,label:h,title:p,icon:f,tabIndex:g,disabled:m}=e,[b,y]=r.useState(!1);let v,_;const E=(0,o.classList)("common-menu-dropdown",n),T=t+"-menu";return(0,i.jsxs)("div",Object.assign({className:E,ref:e=>{e&&(v=e)},onBlur:e=>{v&&b&&!v.contains(e.relatedTarget)&&y(!1)}},{children:[(0,i.jsx)(s.Button,{id:t,label:h,tabIndex:g,buttonRef:e=>{e&&(_=e)},title:p,leftIcon:f,role:u||"menuitem",className:(0,o.classList)("menu-button",b&&"expanded"),onClick:()=>{y(!b)},ariaHasPopup:"true",ariaExpanded:b,ariaControls:b?T:void 0,ariaLabel:c,ariaHidden:l,disabled:m}),b&&(0,i.jsx)("div",Object.assign({role:"menu",className:"common-menu-dropdown-pane",tabIndex:0,id:T,"aria-labelledby":t},{children:(0,i.jsx)(a.FocusTrap,Object.assign({arrowKeyNavigation:!0,onEscape:()=>{y(!1),_&&_.focus()}},{children:(0,i.jsx)("ul",Object.assign({role:"presentation"},{children:d.map(((e,t)=>(0,i.jsx)("li",Object.assign({role:"presentation"},{children:(0,i.jsx)(s.Button,Object.assign({},e,{className:(0,o.classList)("common-menu-dropdown-item",e.className),onClick:()=>{y(!1),e.onClick()},role:"menuitem",ariaPosInSet:t+1,ariaSetSize:d.length}))}),t)))}))}))}))]}))}},{"../util":187,"./Button":146,"./FocusTrap":153,react:548,"react/jsx-runtime":549}],159:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Modal=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("../util"),s=e("./Button"),a=e("./FocusTrap");n.Modal=e=>{const{children:t,id:n,className:l,ariaLabel:c,ariaHidden:u,ariaDescribedBy:d,role:h,title:p,leftIcon:f,helpUrl:g,actions:m,onClose:b,parentElement:y,fullscreen:v,hideDismissButton:_}=e,E=e=>{b&&b()},T=(0,o.classList)("common-modal-container",v&&"fullscreen",l);return r.createPortal((0,i.jsx)(a.FocusTrap,Object.assign({className:T,onEscape:E},{children:(0,i.jsxs)("div",Object.assign({id:n,className:"common-modal",role:h||"dialog","aria-hidden":u,"aria-label":c,"aria-describedby":d,"aria-labelledby":"modal-title"},{children:[(0,i.jsxs)("div",Object.assign({className:"common-modal-header"},{children:[v&&!_&&(0,i.jsx)("div",Object.assign({className:"common-modal-back"},{children:(0,i.jsx)(s.Button,{className:"menu-button",onClick:E,title:lf("Go Back"),label:lf("Go Back"),leftIcon:"fas fa-arrow-left"})})),(0,i.jsxs)("div",Object.assign({id:"modal-title",className:"common-modal-title"},{children:[f&&(0,i.jsx)("i",{className:f,"aria-hidden":!0}),p]})),v&&g&&(0,i.jsx)("div",Object.assign({className:"common-modal-help"},{children:(0,i.jsx)(s.Button,{className:"menu-button",title:lf("Help on {0} dialog",p),href:e.helpUrl,onClick:()=>{},rightIcon:"fas fa-question"})})),!v&&!_&&(0,i.jsx)("div",Object.assign({className:"common-modal-close"},{children:(0,i.jsx)(s.Button,{className:"menu-button inverted",onClick:E,title:lf("Close"),rightIcon:"fas fa-times-circle"})}))]})),(0,i.jsx)("div",Object.assign({className:"common-modal-body"},{children:t})),(null==m?void 0:m.length)&&(0,i.jsx)("div",Object.assign({className:"common-modal-footer"},{children:m.map(((e,t)=>{var n;return(0,i.jsx)(s.Button,{className:null!==(n=e.className)&&void 0!==n?n:"primary inverted",disabled:e.disabled,onClick:e.onClick,href:e.url,label:e.label,title:e.label,rightIcon:(e.xicon?"xicon ":"")+e.icon,leftIcon:e.leftIcon},t)}))}))]}))})),y||document.getElementById("root")||document.body)}},{"../util":187,"./Button":146,"./FocusTrap":153,"react-dom":491,"react/jsx-runtime":549}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ProgressBar=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.ProgressBar=e=>{const{value:t,max:n,id:o,className:s,title:a,label:l,role:c,ariaHidden:u,ariaLabel:d,ariaDescribedBy:h,ariaValueText:p}=e;return(0,i.jsxs)("div",Object.assign({className:(0,r.classList)("common-progressbar-wrapper",s)},{children:[l&&(0,i.jsx)("label",Object.assign({className:"common-progressbar-label"},{children:l})),(0,i.jsx)("progress",{className:"common-progressbar",value:t,"aria-valuetext":p,max:n||1,id:o,role:c||"progressbar",title:a,"aria-label":d,"aria-describedby":h,"aria-hidden":u})]}))}},{"../util":187,"react/jsx-runtime":549}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RadioButtonGroup=void 0;const i=e("react/jsx-runtime"),r=e("../util"),o=e("./FocusList");n.RadioButtonGroup=e=>{const{id:t,className:n,ariaHidden:s,ariaLabel:a,role:l,choices:c,selectedId:u,onChoiceSelected:d}=e;return(0,i.jsx)(o.FocusList,Object.assign({id:t,className:(0,r.classList)("common-radio-group",n),ariaHidden:s,ariaLabel:a,role:l||"radiogroup",childTabStopId:u},{children:c.map((e=>(0,i.jsxs)("div",Object.assign({className:(0,r.classList)("common-radio-choice",e.className,u===e.id&&"selected"),onClick:()=>(e=>{d(e)})(e.id)},{children:[(0,i.jsx)("input",{type:"radio",id:e.id,value:e.id,name:t+"-input",checked:u===e.id,tabIndex:0,"aria-label":e.label?void 0:e.title,"aria-labelledby":e.label?e.id+"-label":void 0}),e.label&&(0,i.jsx)("span",Object.assign({id:e.id+"-label"},{children:e.label})),e.icon&&(0,i.jsx)("i",{className:e.icon,"aria-hidden":!0})]}),e.id)))}))}},{"../util":187,"./FocusList":152,"react/jsx-runtime":549}],162:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TeachingBubble=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("./Button"),s=e("../animations/Confetti"),a=e("../util"),l=e("./FocusTrap"),c=e("react");n.TeachingBubble=e=>{const{id:t,className:n,ariaLabel:u,ariaHidden:d,ariaDescribedBy:h,role:p,targetContent:f,onClose:g,onNext:m,onBack:b,onFinish:y,stepNumber:v,totalSteps:_,parentElement:E,activeTarget:T}=e,x={above:!1,below:!1,left:!1,right:!1};(0,c.useEffect)((()=>(k(),w(),window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)})),[v]);const w=()=>{document.querySelector(".teaching-bubble-steps").style.visibility=v>_||1===_?"hidden":"visible"},k=()=>{const e=document.getElementById(t),n=document.querySelector(".teaching-bubble-arrow");n.style.border="none";const i=document.querySelector(".teaching-bubble-arrow-outline");i.style.border="none";const r=e.getBoundingClientRect();let o;if("nothing"===f.targetQuery)o={top:window.innerHeight/2,bottom:0,left:window.innerWidth/2,right:0,width:0,height:0};else{const e=document.querySelector(f.targetQuery),t=e.getBoundingClientRect();o=S(t,e)}C(o),A(o,e,r,n,i)},S=(e,t)=>{let n=e.top,i=e.left,r=e.width,o=e.height;if(f.sansQuery){const t=document.querySelector(f.sansQuery).getBoundingClientRect(),s={top:n,bottom:n+o,left:i,right:i+r,width:r,height:o};O(s,t)&&(2===f.sansLocation?(i=e.left+t.width,r=e.width-t.width):1===f.sansLocation&&(o=e.height-t.height,s.bottom>window.innerHeight&&(o-=s.bottom-window.innerHeight)))}if(4!==f.location){const e=parseFloat(window.getComputedStyle(t).paddingTop),s=parseFloat(window.getComputedStyle(t).paddingRight),a=parseFloat(window.getComputedStyle(t).paddingBottom),l=parseFloat(window.getComputedStyle(t).paddingLeft);e<10&&(n-=10+e,o+=10-e),a<10&&(o+=10-a),l<10&&(i-=10+l,r+=10-l),s<10&&(r+=10-s)}return{top:n,bottom:n+o,left:i,right:i+r,width:r,height:o}},C=e=>{const t=document.querySelector(".teaching-bubble-cutout");t.style.top=`${e.top}px`,t.style.height=`${e.height}px`,t.style.left=`${e.left}px`,t.style.width=`${e.width}px`,T&&(t.style.pointerEvents="none")},A=(e,t,n,i,r)=>{r.style.opacity="1",i.style.opacity="1",x.above=!1,x.below=!1,x.left=!1,x.right=!1;const o="10px solid transparent",s="12.5px solid transparent",a=()=>{const t=e.top-n.height-10,a=e.left-(n.width-e.width)/2;if(x.above=!0,!d(t,a))return;const l=t+n.height,c=e.left+(e.width-10)/2;i.style.borderLeft=o,i.style.borderRight=o,i.style.borderTop="10px solid",R(i,l,c),r.style.borderLeft=s,r.style.borderRight=s,r.style.borderTop="12.5px solid",R(r,l,c-2.5)},l=()=>{const t=e.bottom+10,a=e.left-(n.width-e.width)/2;if(x.below=!0,!d(t,a))return;const l=t-10,c=e.left+(e.width-10)/2;i.style.borderLeft=o,i.style.borderRight=o,i.style.borderBottom="10px solid",R(i,l,c),r.style.borderLeft=s,r.style.borderRight=s,r.style.borderBottom="12.5px solid",R(r,l-2.5,c-2.5)},c=()=>{const t=e.top-(n.height-e.height)/2,a=e.left-n.width-10;if(x.left=!0,!d(t,a))return;const l=t+(n.height-10)/2,c=e.left-10;i.style.borderLeft="10px solid",i.style.borderTop=o,i.style.borderBottom=o,R(i,l,c),r.style.borderLeft="12.5px solid",r.style.borderTop=s,r.style.borderBottom=s,R(r,l-2.5,c)},u=()=>{const t=e.top-(n.height-e.height)/2,a=e.right+10;if(x.right=!0,!d(t,a))return;const l=t+(n.height-10)/2,c=e.right;i.style.borderRight="10px solid",i.style.borderTop=o,i.style.borderBottom=o,R(i,l,c),r.style.borderRight="12.5px solid",r.style.borderTop=s,r.style.borderBottom=s,R(r,l-2.5,c-2.5)},d=(i,r)=>{const[o,s]=I(e,n,i,r);return o&&s?(R(t,o,s),!0):(h(),!1)},h=()=>{x.above?x.below?x.left?x.right?N(t,n):u():c():l():a()};switch(f.location){case 0:a();break;case 1:l();break;case 2:c();break;case 3:u();break;default:(()=>{const t=(e.height-n.height)/2+e.top,o=(e.width-n.width)/2+e.left;d(t,o),R(i,t+n.height/2,o+n.width/2),R(r,t+n.height/2,o+n.width/2),r.style.opacity="0",i.style.opacity="0"})()}},I=(e,t,n,i)=>{n<10&&(n=10),i<10&&(i=10);const r=i+t.width,o=n+t.height;return r<window.innerWidth-10&&o<window.innerHeight-10?[n,i]:(r>window.innerWidth&&(i-=r-window.innerWidth+10),o>window.innerHeight&&(n-=o-window.innerHeight+10),O(e,t,n,i)?[null,null]:[n,i])},O=(e,t,n,i)=>{const r=(null!=i?i:t.left)<e.left+e.width,o=(null!=i?i:t.left)+t.width>e.left,s=(null!=n?n:t.top)<e.top+e.height,a=(null!=n?n:t.top)+t.height>e.top;return r&&o&&s&&a},N=(e,t)=>{R(e,(window.innerHeight-t.height)/2,(window.innerWidth-t.width)/2)},R=(e,t,n)=>{t<10&&(t=10),n<10&&(n=10),e.style.top=t+"px",e.style.left=n+"px"},D=v>1,L=v<_+1,M=_>1,P=lf("Close"),B=lf("Back"),j=lf("Next"),F=M?lf("Finish"):lf("Got it"),$=(0,a.classList)("teaching-bubble-container",n);return r.createPortal((0,i.jsxs)(l.FocusTrap,Object.assign({className:$,onEscape:g},{children:[v===_+1&&(0,i.jsx)(s.Confetti,{}),(0,i.jsx)("div",{className:"teaching-bubble-cutout"}),(0,i.jsx)("div",{className:"teaching-bubble-arrow"}),(0,i.jsx)("div",{className:"teaching-bubble-arrow-outline"}),(0,i.jsxs)("div",Object.assign({id:t,className:"teaching-bubble",role:p||"dialog","aria-hidden":d,"aria-label":u,"aria-describedby":h,"aria-labelledby":"teaching-bubble-title"},{children:[(0,i.jsx)(o.Button,{className:"teaching-bubble-close",onClick:g,title:P,ariaLabel:P,rightIcon:"fas fa-times-circle"}),(0,i.jsxs)("div",Object.assign({className:"teaching-bubble-content"},{children:[(0,i.jsx)("strong",Object.assign({"aria-live":"polite"},{children:f.title})),(0,i.jsx)("p",Object.assign({"aria-live":"polite"},{children:f.description})),(0,i.jsxs)("div",Object.assign({className:"teaching-bubble-footer "+(M?"":"no-steps")},{children:[M&&(0,i.jsxs)("div",Object.assign({className:"teaching-bubble-steps","aria-live":"polite"},{children:[v," of ",_]})),(0,i.jsxs)("div",Object.assign({className:"teaching-bubble-navigation"},{children:[D&&(0,i.jsx)(o.Button,{className:"primary",onClick:b,title:B,ariaLabel:B,label:B}),L&&(0,i.jsx)(o.Button,{className:"primary inverted",onClick:m,title:j,ariaLabel:j,label:j}),!L&&(0,i.jsx)(o.Button,{className:"primary inverted",onClick:y,title:F,ariaLabel:F,label:F})]}))]}))]}))]}))]})),E||document.getElementById("root")||document.body)}},{"../animations/Confetti":145,"../util":187,"./Button":146,"./FocusTrap":153,react:548,"react-dom":491,"react/jsx-runtime":549}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Textarea=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");n.Textarea=e=>{const{id:t,className:n,role:s,ariaHidden:a,ariaLabel:l,initialValue:c,label:u,title:d,placeholder:h,autoComplete:p,cols:f,rows:g,disabled:m,minLength:b,readOnly:y,resize:v,wrap:_,autoResize:E,onChange:T,onEnterKey:x}=e,[w,k]=r.useState(c||""),S=r.useRef(null),C=r.useRef(0),A=()=>{S.current&&(S.current.style.height="1px",S.current.style.height=`${S.current.scrollHeight}px`)};return r.useEffect((()=>{k(c),E&&S.current&&A()}),[c]),r.useEffect((()=>{if(!E)return()=>{};const e=new ResizeObserver((e=>{const t=e[0].contentRect.width;C.current!=t&&(requestAnimationFrame((()=>A())),C.current=t)}));return S.current&&e.observe(S.current),()=>{e.disconnect()}}),[E]),(0,i.jsxs)("div",Object.assign({className:(0,o.classList)("common-textarea-wrapper",m&&"disabled",v&&`resize-${v}`,n)},{children:[u&&(0,i.jsx)("label",Object.assign({className:"common-textarea-label"},{children:u})),(0,i.jsx)("div",Object.assign({className:"common-textarea-group"},{children:(0,i.jsx)("textarea",{id:t,className:"common-textarea",title:d,role:s||"textbox",tabIndex:m?-1:0,"aria-label":l,"aria-hidden":a,placeholder:h,value:w||"",cols:f,rows:g,minLength:b,wrap:_,readOnly:!!y,ref:S,onChange:e=>{const t=e.target.value;y||w===t||k(t),T&&T(t),E&&S.current&&A()},onKeyDown:e=>{const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||x&&(e.preventDefault(),x(w))},autoComplete:p?"":"off",autoCorrect:p?"":"off",autoCapitalize:p?"":"off",spellCheck:p,disabled:m})}))]}))}},{"../util":187,react:548,"react/jsx-runtime":549}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TreeItemBody=n.TreeItem=n.Tree=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util"),s=e("./FocusList");n.Tree=e=>{const{children:t,id:n,className:r,ariaLabel:a,ariaHidden:l,ariaDescribedBy:c,role:u}=e;return u&&"tree"!==u?(0,i.jsx)("div",Object.assign({className:(0,o.classList)("common-tree","subtree",r),id:n,"aria-label":a,"aria-hidden":l,"aria-describedby":c,role:u||"tree"},{children:t})):(0,i.jsx)(s.FocusList,Object.assign({className:(0,o.classList)("common-tree",r),id:n,"aria-label":a,"aria-hidden":l,"aria-describedby":c,role:u||"tree"},{children:t}))};n.TreeItem=e=>{const{children:t,id:n,className:s,ariaLabel:a,ariaHidden:l,ariaDescribedBy:c,role:u,initiallyExpanded:d,onClick:h,title:p}=e,[f,g]=r.useState(d),m=r.Children.toArray(t),b=m.length>1,y=r.useRef();r.useEffect((()=>{b&&(f?y.current.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]').forEach((e=>e.setAttribute("data-isfocusable","true"))):y.current.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]').forEach((e=>e.setAttribute("data-isfocusable","false"))))}),[f,b]);const v=r.useCallback((()=>{b&&g(!f),h&&h()}),[b,f]);return(0,i.jsxs)("div",Object.assign({className:"common-treeitem-container",id:n,"aria-label":a,"aria-hidden":l,"aria-describedby":c,role:u||"treeitem",title:p},{children:[(0,i.jsxs)("div",Object.assign({className:(0,o.classList)("common-treeitem",s),onClick:v},{children:[b&&(0,i.jsx)("i",{className:(0,o.classList)("fas",f?"fa-chevron-down":"fa-chevron-right"),"aria-hidden":!0}),m[0]]})),(0,i.jsx)("div",Object.assign({ref:y,style:{display:f?void 0:"none"}},{children:b?m[1]:void 0}))]}))};n.TreeItemBody=e=>{const{children:t,id:n,className:r,ariaLabel:s,ariaHidden:a,ariaDescribedBy:l,role:c}=e;return(0,i.jsx)("div",Object.assign({className:(0,o.classList)("common-treeitembody",r),id:n,"aria-label":s,"aria-hidden":a,"aria-describedby":l,role:c,tabIndex:0},{children:t}))}},{"../util":187,"./FocusList":152,react:548,"react/jsx-runtime":549}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VerticalResizeContainer=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");n.VerticalResizeContainer=e=>{const{id:t,className:n,ariaDescribedBy:s,ariaHidden:a,ariaLabel:l,minHeight:c,maxHeight:u,initialHeight:d,children:h,resizeEnabled:p,onResizeDrag:f,onResizeEnd:g}=e,m=r.useRef(),b=`--${t}-height`;let[y,v]=r.useState(!1);return r.useEffect((()=>{if(!p)return;const e=m.current,t=t=>{let n=t.pageY-e.offsetTop+"px";u&&(n=`min(${u}, ${n})`),c&&(n=`max(${c}, ${n})`),e.style.setProperty(b,n),f&&f(e.clientHeight),v(!0),t.preventDefault(),t.stopPropagation()},n=()=>{document.removeEventListener("pointermove",t,!1),document.removeEventListener("pointerup",i,!1),document.body.classList.remove("cursor-resize")},i=()=>{n(),g&&g(e.clientHeight)},r=n=>{const r=getComputedStyle(e),o=parseInt(r.height)-parseInt(r.borderWidth);n.offsetY<o&&n.offsetY>o-4-4&&(document.body.classList.add("cursor-resize"),document.addEventListener("pointermove",t,!1),document.addEventListener("pointerup",i,!1))};return e.addEventListener("pointerdown",r),()=>{e.removeEventListener("pointerdown",r),n()}}),[b,c,u,g,f,p]),(0,i.jsx)("div",Object.assign({id:t,ref:m,className:(0,o.classList)(p?"vertical-resize-container":"",n),"aria-describedby":s,"aria-hidden":a,"aria-label":l,style:{height:p&&y?`var(${b})`:d}},{children:h}))}},{"../util":187,react:548,"react/jsx-runtime":549}],166:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DeleteConfirmationModal=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Modal");n.DeleteConfirmationModal=e=>{const t=[{label:lf("Cancel"),onClick:e.onCancelClick},{label:lf("Remove"),className:"red",onClick:()=>{e.onDeleteClick(e.ns)}}];return(0,i.jsx)(r.Modal,Object.assign({title:lf("Removing extension"),actions:t,onClose:e.onCancelClick},{children:lf("Are you sure you want to remove this extension? Doing so will remove any of its blocks that you used in your code and other extensions that use it.")}))}},{"../controls/Modal":159,"react/jsx-runtime":549}],167:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionCard=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Button"),o=e("../controls/Card"),s=e("../controls/LazyImage"),a=e("../util");n.ExtensionCard=e=>{const{title:t,description:n,imageUrl:l,learnMoreUrl:c,label:u,onClick:d,extension:h,loading:p,showDisclaimer:f}=e,g=pxt.Util.guidGen();return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(o.Card,Object.assign({className:(0,a.classList)("common-extension-card",p&&"loading"),onClick:()=>{d&&d(h)},ariaLabelledBy:g+"-title",ariaDescribedBy:g+"-description",tabIndex:d&&0,label:u},{children:[(0,i.jsx)("div",Object.assign({className:"common-extension-card-contents"},{children:!p&&(0,i.jsxs)(i.Fragment,{children:[l&&(0,i.jsx)(s.LazyImage,{src:l,alt:t}),(0,i.jsx)("div",Object.assign({className:"common-extension-card-title",id:g+"-title"},{children:t})),(0,i.jsx)("div",Object.assign({className:"common-extension-card-description"},{children:(0,i.jsx)("div",Object.assign({id:g+"-description"},{children:n}))})),(f||c)&&(0,i.jsxs)("div",Object.assign({className:"common-extension-card-extra-content"},{children:[f&&lf("User-provided extension, not endorsed by Microsoft."),c&&(0,i.jsx)(r.Button,{className:"link-button",label:lf("Learn More"),title:lf("Learn More"),onClick:()=>{},href:c})]}))]})})),(0,i.jsx)("div",{className:"common-spinner"})]}))})}},{"../controls/Button":146,"../controls/Card":147,"../controls/LazyImage":155,"../util":187,"react/jsx-runtime":549}],168:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImportModal=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Modal");n.ImportModal=e=>{const t=[{label:lf("Cancel"),onClick:e.onCancelClick},{label:lf("Import"),onClick:()=>{e.onImportClick(document.getElementById("url-input").value)}}];return(0,i.jsxs)(r.Modal,Object.assign({title:lf("Import extension"),actions:t,className:"import-extension-modal"},{children:[lf("Enter Github project URL"),(0,i.jsx)("input",{id:"url-input"})]}))}},{"../controls/Modal":159,"react/jsx-runtime":549}],169:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ColorPickerField=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../controls/Button"),s=e("../controls/Input");n.ColorPickerField=e=>{const{index:t,color:n,onColorChanged:a,onMoveColor:l}=e,[c,u]=r.useState(void 0);return(0,i.jsxs)("div",Object.assign({className:"common-color-picker-field"},{children:[(0,i.jsx)("div",Object.assign({className:"common-color-index"},{children:t})),(0,i.jsxs)("div",Object.assign({className:"common-color-inputs"},{children:[(0,i.jsx)("input",{className:"color-input",type:"color",value:c||n,onBlur:()=>{c&&a(c),u(void 0)},onChange:e=>{u(e.target.value.toUpperCase())}}),(0,i.jsx)(s.Input,{initialValue:c||n.toUpperCase(),onChange:e=>{"#"!=(null==(e=e.trim())?void 0:e[0])&&(e="#"+e),e.length>7&&(e=e.substring(0,7)),/#[0-9a-fA-F]{6}/.test(e)&&a(e.toUpperCase())}})]})),(0,i.jsx)(o.Button,{className:"circle-button",title:lf("Move color up"),leftIcon:"fas fa-arrow-up",onClick:()=>l(!0),disabled:1===t}),(0,i.jsx)(o.Button,{className:"circle-button",title:lf("Move color down"),leftIcon:"fas fa-arrow-down",onClick:()=>l(!1),disabled:15===t})]}))}},{"../controls/Button":146,"../controls/Input":154,react:548,"react/jsx-runtime":549}],170:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PaletteEditor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./ColorPickerField");n.PaletteEditor=e=>{const{palette:t,onPaletteChanged:n}=e,[s,a]=(0,r.useState)(t);return(0,r.useEffect)((()=>{n(s)}),[s]),(0,r.useEffect)((()=>{a(t)}),[t]),(0,i.jsx)("div",Object.assign({className:"common-palette-editor"},{children:s.colors.slice(1).map(((e,t)=>(0,i.jsx)(o.ColorPickerField,{index:t+1,color:e,onColorChanged:e=>((e,t)=>{const n=s;a(Object.assign(Object.assign({},n),{colors:n.colors.map(((n,i)=>e===i?t:n))}))})(t+1,e),onMoveColor:e=>((e,t)=>{const n=s,i=Object.assign(Object.assign({},n),{colors:n.colors.slice()});t?e>1&&(i.colors[e-1]=n.colors[e],i.colors[e]=n.colors[e-1]):e<i.colors.length-1&&(i.colors[e+1]=n.colors[e],i.colors[e]=n.colors[e+1]),a(i)})(t+1,e)},t+1)))}))}},{"./ColorPickerField":169,react:548,"react/jsx-runtime":549}],171:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PalettePicker=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Dropdown"),o=e("./PaletteSwatch");n.PalettePicker=e=>{const{palettes:t,selectedId:n,onPaletteSelected:s}=e;return(0,i.jsx)(r.Dropdown,{id:"common-palette-picker",selectedId:n,onItemSelected:e=>{s(t.find((t=>t.id===e)))},items:t.map((e=>({id:e.id,title:e.name,label:(0,i.jsx)(o.PaletteSwatch,{palette:e})})))})}},{"../controls/Dropdown":150,"./PaletteSwatch":172,"react/jsx-runtime":549}],172:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PaletteSwatch=void 0;const i=e("react/jsx-runtime");n.PaletteSwatch=e=>{const{palette:t}=e;return(0,i.jsxs)("div",Object.assign({className:"common-palette-swatch"},{children:[(0,i.jsx)("div",Object.assign({className:"common-palette-swatch-name"},{children:t.name})),(0,i.jsx)("div",Object.assign({className:"common-palette-color-list"},{children:t.colors.slice(1).map(((e,t)=>(0,i.jsx)(r,{color:e},t)))}))]}))};const r=e=>(0,i.jsx)("div",{className:"common-palette-color",style:{backgroundColor:e.color}})},{"react/jsx-runtime":549}],173:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AllPalettes=n.Arcade=n.Adventure=n.Sweet=n.SteamPunk=n.StillLife=n.DIY=n.Poke=n.Grayscale=n.Matte=n.Pastel=n.Adafruit=void 0,n.Adafruit={id:"Adafruit",name:lf("Adafruit"),colors:["#000000","#FFFFFF","#FF0000","#FF007D","#FF7a00","#e5FF00","#2D9F00","#00FF72","#0034FF","#17ABFF","#C600FF","#636363","#7400DB","#00EFFF","#DF2929","#000000"]},n.Pastel={id:"Pastel",name:lf("Pastel"),colors:["#000000","#fff7e4","#f98284","#feaae4","#ffc384","#fff7a0","#87a889","#b0eb93","#b0a9e4","#accce4","#b3e3da","#d9c8bf","#6c5671","#ffe6c6","#dea38b","#28282e"]},n.Matte={id:"Matte",name:lf("Matte"),colors:["#000000","#FFF1E8","#FF004D","#FF77A8","#FFA300","#FFEC27","#008751","#00E436","#29ADFF","#C2C3C7","#7E2553","#83769C","#5F574F","#FFCCAA","#AB5236","#1D2B53"]},n.Grayscale={id:"Grayscale",name:lf("Grayscale"),colors:["#000000","#FFFFFF","#EDEDED","#DBDBDB","#C8C8C8","#B6B6B6","#A4A4A4","#929292","#808080","#6D6D6D","#5B5B5B","#494949","#373737","#242424","#121212","#000000"]},n.Poke={id:"Poke",name:lf("Poke"),colors:["#000000","#ffffff","#d45362","#e8958b","#cc8945","#f5dc8c","#417d53","#5dd48f","#5162c2","#6cadeb","#b56edd","#8f3f29","#612431","#c0fac2","#24325e","#1b1221"]},n.DIY={id:"DIY",name:lf("DIY"),colors:["#000000","#f8f8f8","#f80000","#FF93C4","#f8a830","#f8f858","#089050","#70d038","#2868c0","#10c0c8","#c868e8","#c0c0c0","#787878","#f8d898","#c04800","#000000"]},n.StillLife={id:"StillLife",name:lf("Still Life"),colors:["#000000","#a8e4d4","#d13b27","#e07f8a","#cc8218","#b3e868","#5d853a","#68c127","#286fb8","#9b8bff","#3f2811","#513155","#122615","#c7b581","#7a2222","#000000"]},n.SteamPunk={id:"SteamPunk",name:lf("Steam Punk"),colors:["#000000","#c0d1cc","#603b3a","#170e19","#775c4f","#77744f","#4f7754","#a19f7c","#4f5277","#65738c","#3a604a","#213b25","#433a60","#7c94a1","#3b2137","#2f213b"]},n.Sweet={id:"Sweet",name:lf("Sweet"),colors:["#000000","#f4f4f4","#b13e53","#a7f070","#ef7d57","#ffcd75","#257179","#38b764","#29366f","#3b5dc9","#41a6f6","#566c86","#333c57","#94b0c2","#5d275d","#1a1c2c"]},n.Adventure={id:"Adventure",name:lf("Adventure"),colors:["#000000","#f5edba","#9d303b","#d26471","#e4943a","#c0c741","#647d34","#34859d","#17434b","#7ec4c1","#584563","#8c8fae","#3e2137","#d79b7d","#9a6348","#1f0e1c"]},n.Arcade={id:"Arcade",name:lf("Arcade"),colors:["#000000","#FFFFFF","#FF2121","#FF93C4","#FF8135","#FFF609","#249CA3","#78DC52","#003FAD","#87F2FF","#8E2EC4","#A4839F","#5C406c","#E5CDC4","#91463d","#000000"]},n.AllPalettes=[n.Arcade,n.Matte,n.Pastel,n.Sweet,n.Poke,n.Adventure,n.DIY,n.Adafruit,n.StillLife,n.SteamPunk,n.Grayscale]},{}],174:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Badge=void 0;const i=e("react/jsx-runtime"),r=e("../util");n.Badge=e=>{const{badge:t,disabled:n,isNew:o,onClick:s}=e,a=s&&(()=>{s(t)}),l=n&&t.lockedImage||t.image,c=n?pxt.U.lf("Locked '{0}' badge",t.title):t.title;return(0,i.jsxs)("div",Object.assign({className:"profile-badge "+(s?"clickable":""),role:s?"button":void 0,tabIndex:s?0:void 0,title:lf("{0} Badge",t.title),onClick:a,onKeyDown:r.fireClickOnEnter},{children:[o&&(0,i.jsx)("div",Object.assign({className:"profile-badge-notification"},{children:pxt.U.lf("New!")})),(0,i.jsx)("img",{src:l,alt:c})]}))}},{"../util":187,"react/jsx-runtime":549}],175:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.badgeDescription=n.BadgeInfo=void 0;const i=e("react/jsx-runtime"),r=e("../util"),o=e("./Badge");n.BadgeInfo=e=>{const{badge:t}=e,r=new Date(t.timestamp);return(0,i.jsxs)("div",Object.assign({className:"profile-badge-info"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-badge-info-image"},{children:(0,i.jsx)(o.Badge,{badge:t,disabled:!t.timestamp})})),(0,i.jsxs)("div",Object.assign({className:"profile-badge-info-item",id:"profile-badge-info-"+t.id},{children:[(0,i.jsx)("div",Object.assign({className:"profile-badge-info-header"},{children:lf("Awarded For:")})),(0,i.jsx)("div",Object.assign({className:"profile-badge-info-text"},{children:(0,n.badgeDescription)(t)}))]})),t.timestamp?(0,i.jsxs)("div",Object.assign({className:"profile-badge-info-item"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-badge-info-header"},{children:lf("Awarded On:")})),(0,i.jsx)("div",Object.assign({className:"profile-badge-info-text"},{children:r.toLocaleDateString(pxt.U.userLanguage())}))]})):void 0]}))};function s(e){var t;if(-1!==e.indexOf("/api/md/")){const n=e.split("/api/md/")[1].split("/").slice(1).join("/");return(null===(t=pxt.webConfig)||void 0===t?void 0:t.skillmapUrl)+"#docs:"+n}{const t=e.split("#");if(2==t.length)return pxt.webConfig.skillmapUrl+"#github:https://github.com/"+t[0]+"/"+t[1]}return pxt.BrowserUtils.isLocalHostDev()?"http://localhost:3000#local:"+e:e}n.badgeDescription=e=>{switch(e.type){case"skillmap-completion":return(0,i.jsx)("span",{children:(0,r.jsxLF)(lf("Completing {0}"),(0,i.jsx)("a",Object.assign({tabIndex:0,"aria-labelledby":"profile-badge-info-"+e.id,target:"_blank",rel:"noopener noreferrer",href:s(e.sourceURL)},{children:pxt.U.rlf(e.title)})))})}}},{"../util":187,"./Badge":174,"react/jsx-runtime":549}],176:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BadgeList=void 0;const i=e("react/jsx-runtime"),r=e("./Badge");n.BadgeList=e=>{const{onBadgeClick:t,availableBadges:n,userState:o}=e,s=n.slice();let a={};for(const e of o.badges){a[e.id]=!0;const t=s.findIndex((t=>t.id===e.id));t>-1?s[t]=Object.assign(Object.assign({},s[t]),{timestamp:s[t].timestamp||e.timestamp}):s.push(e)}const l=[];for(let e=0;e<Math.max(s.length+10,20);e++)l.push((0,i.jsx)("div",{className:"placeholder-badge"},e));return(0,i.jsxs)("div",Object.assign({className:"profile-badge-list"},{children:[(0,i.jsxs)("div",Object.assign({className:"profile-badge-header",id:"profile-badge-header"},{children:[(0,i.jsx)("span",Object.assign({className:"profile-badge-title"},{children:lf("Badges")})),(0,i.jsx)("span",Object.assign({className:"profile-badge-subtitle"},{children:lf("Click each badge to see details")}))]})),(0,i.jsx)("div",Object.assign({className:"profile-badges-scroller"},{children:(0,i.jsxs)("div",Object.assign({className:"profile-badges",role:"list","aria-labelledby":"profile-badge-header"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-badges-background-container","aria-hidden":"true"},{children:(0,i.jsx)("div",Object.assign({className:"profile-badges-background"},{children:l}))})),s.map((e=>(0,i.jsxs)("div",Object.assign({className:"profile-badge-and-title",role:"listitem"},{children:[(0,i.jsx)(r.Badge,{onClick:t,badge:e,disabled:!a[e.id]}),(0,i.jsx)("div",Object.assign({className:"profile-badge-name"},{children:e.title}))]}),e.id)))]}))}))]}))}},{"./Badge":174,"react/jsx-runtime":549}],177:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Profile=void 0;const i=e("react/jsx-runtime"),r=e("./BadgeList"),o=e("./UserPane"),s=e("./BadgeInfo");n.Profile=e=>{var t,n,a,l,c;const{user:u,signOut:d,deleteProfile:h,onClickedEmail:p,notification:f,checkedEmail:g,showModalAsync:m}=e,b=(null==u?void 0:u.profile)||{idp:{}},y=(null===(t=null==u?void 0:u.preferences)||void 0===t?void 0:t.badges)||{badges:[]},v=(null===(a=null===(n=pxt.appTarget)||void 0===n?void 0:n.cloud)||void 0===a?void 0:a.showBadges)||!1,_=null===(l=pxt.appTarget.appTheme)||void 0===l?void 0:l.condenseProfile,E=null===(c=pxt.appTarget.appTheme)||void 0===c?void 0:c.cloudProfileIcon;return(0,i.jsxs)("div",Object.assign({className:"user-profile"},{children:[(0,i.jsx)(o.UserPane,{profile:b,onSignOutClick:d,onDeleteProfileClick:h,notification:f,emailChecked:g,onEmailCheckClick:p}),v&&(0,i.jsx)(r.BadgeList,{availableBadges:pxt.appTarget.defaultBadges||[],userState:y,onBadgeClick:e=>{m({header:lf("{0} Badge",e.title),size:"tiny",hasCloseIcon:!0,onClose:()=>{const e=document.body.querySelector(".common-modal-container.fullscreen [tabindex]");e&&e.focus()},jsx:(0,i.jsx)(s.BadgeInfo,{badge:e})})}}),_&&(0,i.jsxs)("div",Object.assign({className:"profile-info-container"},{children:[(0,i.jsx)("p",Object.assign({className:"profile-info"},{children:lf("Now that you're logged in, your projects will be automatically saved to the cloud so you can access them from any device!")})),E&&(0,i.jsx)("img",{className:"ui image centered medium",src:E,alt:""})]}))]}))}},{"./BadgeInfo":175,"./BadgeList":176,"./UserPane":180,"react/jsx-runtime":549}],178:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignInModal=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../controls/Checkbox"),s=e("../controls/Button"),a=e("../controls/Link"),l=e("../controls/Modal");n.SignInModal=e=>{var t,n;const{onSignIn:c,onClose:u,appMessage:d,dialogMessages:h,hideDismissButton:p}=e,{signInMessage:f,signUpMessage:g}=h||{signInMessage:lf("Sign in to save your progress and access your work anytime, anywhere."),signUpMessage:lf("Join now to save your progress and access your work anytime, anywhere.")},m=null!==(t=e.resolvePath)&&void 0!==t?t:e=>e,[b,y]=r.useState(!1),[v,_]=r.useState(null!==(n=e.mode)&&void 0!==n?n:"signin"),E=r.useMemo((()=>"signin"===v?lf("Sign in"):lf("Sign up")),[v]),T=r.useMemo((()=>"signin"===v?f:g),[v,f,g]),x=r.useMemo((()=>"signin"===v?(0,i.jsxs)("div",Object.assign({className:"switch"},{children:[(0,i.jsx)("span",{children:lf("Don't have an account?")}),(0,i.jsx)(s.Button,{className:"link-button",onClick:()=>_("signup"),title:lf("Sign up"),label:lf("Sign up")})]})):(0,i.jsxs)("div",Object.assign({className:"switch"},{children:[(0,i.jsx)("span",{children:lf("Have an account?")}),(0,i.jsx)(s.Button,{className:"link-button",onClick:()=>_("signin"),title:lf("Sign in"),label:lf("Sign in")})]}))),[v]);return(0,i.jsx)(l.Modal,Object.assign({title:E,onClose:u,hideDismissButton:p},{children:(0,i.jsxs)("div",Object.assign({className:"signin-form"},{children:[(0,i.jsxs)("div",Object.assign({className:"signin-header"},{children:[d||void 0," ",T]})),(0,i.jsx)("div",Object.assign({className:"signin-body"},{children:(0,i.jsxs)("div",Object.assign({className:"providers"},{children:[pxt.auth.identityProviders().map(((e,t)=>{const n="signin"===v?lf("Continue with {0}",e.name):lf("Sign up with {0}",e.name);return(0,i.jsx)(s.Button,{className:"teal inverted provider",onClick:()=>c(e,b),title:n,ariaLabel:n,label:(0,i.jsxs)("div",Object.assign({className:"label"},{children:[(0,i.jsx)("div",{children:(0,i.jsx)("img",{className:"logo",src:m(e.icon)})}),(0,i.jsx)("div",Object.assign({className:"title"},{children:n}))]}))},t)})),(0,i.jsx)("div",Object.assign({className:"rememberme"},{children:(0,i.jsx)(o.Checkbox,{id:"rememberme",label:lf("Remember me"),isChecked:b,onChange:y})}))]}))})),(0,i.jsxs)("div",Object.assign({className:"signin-footer"},{children:[x,(0,i.jsx)("div",Object.assign({className:"learn"},{children:(0,i.jsx)(a.Link,Object.assign({href:"/identity/sign-in",target:"_blank"},{children:lf("Learn more")}))}))]}))]}))}))}},{"../controls/Button":146,"../controls/Checkbox":148,"../controls/Link":156,"../controls/Modal":159,react:548,"react/jsx-runtime":549}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserNotification=void 0;const i=e("react/jsx-runtime");n.UserNotification=e=>{const{message:t,icon:n,actionText:r,link:o,xicon:s,title:a}=e.notification;return(0,i.jsxs)("div",Object.assign({className:"profile-notification"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-notification-icon"},{children:(0,i.jsx)("i",{className:`${s?"xicon":"ui large circular icon "} ${n}`})})),(0,i.jsx)("div",Object.assign({className:"profile-notification-title"},{children:a})),(0,i.jsx)("div",Object.assign({className:"profile-notification-message"},{children:t})),(0,i.jsxs)("button",Object.assign({className:"ui icon button profile-notification-button",onClick:()=>{window.open(o,"_blank")},role:"link"},{children:[(0,i.jsx)("i",{className:"icon external alternate"}),r]}))]}))}},{"react/jsx-runtime":549}],180:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserPane=void 0;const i=e("react/jsx-runtime"),r=e("../util"),o=e("./UserNotification"),s=e("../controls/Checkbox"),a=e("../controls/Button");n.UserPane=e=>{const{profile:t,onSignOutClick:n,onDeleteProfileClick:l,onEmailCheckClick:c,notification:u,emailChecked:d}=e,{username:h,displayName:p,picture:f,pictureUrl:g}=t.idp,m=null!=g?g:null==f?void 0:f.dataUrl,b=(0,i.jsxs)(i.Fragment,{children:[d===r.CheckboxStatus.Waiting?(0,i.jsx)("div",{className:"common-spinner"}):void 0,lf("I would like to receive the MakeCode newsletter. "),(0,i.jsx)("a",Object.assign({href:"https://makecode.com/privacy",target:"_blank",rel:"noopener noreferrer",tabIndex:0},{children:lf("View Privacy Statement")}))]});return(0,i.jsxs)("div",Object.assign({className:"profile-user-pane"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-portrait"},{children:m?(0,i.jsx)("div",{children:(0,i.jsx)("img",{src:m,alt:pxt.U.lf("Profile Picture"),referrerPolicy:"no-referrer"})}):(0,i.jsx)("div",Object.assign({className:"profile-initials-portrait"},{children:pxt.auth.userInitials(t)}))})),(0,i.jsxs)("div",Object.assign({className:"profile-user-details"},{children:[(0,i.jsx)("div",Object.assign({className:"profile-display-name"},{children:p})),h&&(0,i.jsx)("div",Object.assign({className:"profile-username"},{children:h}))]})),u&&(0,i.jsx)(o.UserNotification,{notification:u}),(0,i.jsx)("div",{className:"profile-spacer"}),(0,i.jsx)("div",Object.assign({className:"profile-email"},{children:(0,i.jsx)(s.Checkbox,{id:"profile-email-checkbox",className:d===r.CheckboxStatus.Waiting?"loading":"",isChecked:d===r.CheckboxStatus.Selected,onChange:c,label:b})})),(0,i.jsxs)("div",Object.assign({className:"profile-actions"},{children:[(0,i.jsx)(a.Button,{className:"link-button",title:lf("Delete Profile"),label:lf("Delete Profile"),onClick:l}),(0,i.jsx)(a.Button,{className:"sign-out",leftIcon:"fas fa-sign-out-alt",title:lf("Sign Out"),label:lf("Sign Out"),onClick:n})]}))]}))}},{"../controls/Button":146,"../controls/Checkbox":148,"../util":187,"./UserNotification":179,"react/jsx-runtime":549}],181:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addGameToKioskAsync=void 0;n.addGameToKioskAsync=async(e,t)=>{const n=await fetch("https://makecode.com/api/kiosk/updatecode",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({kioskCode:e,shareId:t})});if(!n.ok)throw new Error(n.statusText)}},{}],182:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MultiplayerConfirmation=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Modal");n.MultiplayerConfirmation=e=>{const{onCancelClicked:t,onConfirmClicked:n}=e,o=[{label:lf("Cancel"),onClick:t},{label:lf("Share and Host"),onClick:n,className:"primary"}];return(0,i.jsx)(r.Modal,Object.assign({title:lf("Host a multiplayer game"),actions:o,onClose:t},{children:lf("This will share the code of your game publicly. Is that okay?")}))}},{"../controls/Modal":159,"react/jsx-runtime":549}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Share=void 0;const i=e("react/jsx-runtime"),r=e("./ShareInfo");n.Share=e=>{const{projectName:t,screenshotUri:n,isLoggedIn:o,simRecorder:s,publishAsync:a,hasProjectBeenPersistentShared:l,anonymousShareByDefault:c,setAnonymousSharePreference:u,isMultiplayerGame:d,kind:h,onClose:p}=e;return(0,i.jsx)("div",Object.assign({className:"project-share"},{children:(0,i.jsx)(r.ShareInfo,{projectName:t,isLoggedIn:o,screenshotUri:n,simRecorder:s,publishAsync:a,isMultiplayerGame:d,kind:h,hasProjectBeenPersistentShared:l,anonymousShareByDefault:c,setAnonymousSharePreference:u,onClose:p})}))}},{"./ShareInfo":184,"react/jsx-runtime":549}],184:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ShareInfo=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../controls/Button"),s=e("../controls/EditorToggle"),a=e("../controls/Input"),l=e("../controls/Textarea"),c=e("../controls/Modal"),u=e("./ThumbnailRecorder"),d=e("./SocialButton"),h=e("../controls/Checkbox"),p=e("./MultiplayerConfirmation"),f=e("./Kiosk"),g=e("../Notification"),m=e("../util");n.ShareInfo=e=>{var t,n,b,y,v,_,E;const{projectName:T,description:x,screenshotUri:w,isLoggedIn:k,simRecorder:S,publishAsync:C,hasProjectBeenPersistentShared:A,anonymousShareByDefault:I,setAnonymousSharePreference:O,isMultiplayerGame:N,kind:R,onClose:D}=e,[L,M]=r.useState(T),[P,B]=r.useState(w),[j,F]=r.useState("share"),[$,U]=r.useState(),[H,G]=r.useState("none"),[V,W]=r.useState(!1),[z,q]=r.useState(!1),[Y,K]=r.useState(!1),[Z,X]=r.useState(!1),[J,Q]=r.useState(!k||I),[ee,te]=r.useState(!1),{simScreenshot:ne,simGif:ie}=pxt.appTarget.appTheme,re=(ne||ie)&&!!S,oe="publish"!==j;let se,ae,le;r.useEffect((()=>{B(w)}),[w]),r.useEffect((()=>{k?pxt.tickEvent("share.open.loggedIn",{state:j,anonymous:null==J?void 0:J.toString(),persistent:null==A?void 0:A.toString()}):pxt.tickEvent("share.open",{state:j})}),[j,J,A]);const ce=()=>{F("share")},ue=[{name:"code",label:lf("Code"),title:lf("Code"),focusable:!0,onClick:()=>G("code")},{name:"editor",label:lf("Editor"),title:lf("Editor"),focusable:!0,onClick:()=>G("editor")},{name:"simulator",label:lf("Simulator"),title:lf("Simulator"),focusable:!0,onClick:()=>G("simulator")}],de="share"===j||"publishing"===j,he=de?lf("Project Title"):lf("Project Link");return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",Object.assign({className:"project-share-info"},{children:[re&&"gifrecord"!==j&&(0,i.jsxs)("div",Object.assign({className:"project-share-thumbnail"},{children:[P?(0,i.jsx)("img",{src:P}):(0,i.jsx)("div",Object.assign({className:"project-thumbnail-placeholder"},{children:(0,i.jsx)("div",{className:"common-spinner"})})),"publish"!==j&&(0,i.jsx)(o.Button,{className:"link-button",title:lf("Update project thumbnail"),label:lf("Update project thumbnail"),onClick:()=>F("gifrecord")})]})),(0,i.jsxs)("div",Object.assign({className:"project-share-content"},{children:[(de||"publish"===j)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",Object.assign({className:"project-share-title project-share-label",id:"share-input-title"},{children:he})),oe&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.Input,{ariaDescribedBy:"share-input-title",className:"name-input",initialValue:L,placeholder:lf("Name your project"),onChange:M}),k&&A&&(0,i.jsx)(h.Checkbox,{id:"persistent-share-checkbox",label:lf("Update existing share link for this project"),isChecked:!J,onChange:e=>{pxt.tickEvent("share.persistentCheckbox",{checked:e.toString()}),Q(!e),O&&O(!e)}})]}),de&&(0,i.jsxs)(i.Fragment,{children:[(null==$?void 0:$.error)&&(0,i.jsx)("div",Object.assign({className:"project-share-error"},{children:413===$.error.statusCode&&(null===(b=null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.cloud)||void 0===n?void 0:n.cloudProviders)||void 0===b?void 0:b.github)?lf("Oops! Your project is too big. You can create a GitHub repository to share it."):lf("Oops! There was an error. Please ensure you are connected to the Internet and try again.")})),(0,i.jsxs)("div",Object.assign({className:"project-share-publish-actions"},{children:["share"===j&&(0,i.jsxs)(i.Fragment,{children:[(null===(v=null===(y=pxt.appTarget)||void 0===y?void 0:y.appTheme)||void 0===v?void 0:v.multiplayer)&&(N||"multiplayer"===R)&&(0,i.jsx)(o.Button,{className:(0,m.classList)("primary share-host-button","share"===R&&"primary inverted text-only","multiplayer"===R&&"share-publish-button"),title:lf("Host a multiplayer game"),label:lf("Host a multiplayer game"),leftIcon:"xicon multiplayer",onClick:async()=>{te(!0),pxt.tickEvent("share.hostMultiplayer")}}),"share"===R&&(0,i.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Share Project"),label:lf("Share Project"),onClick:async()=>{F("publishing");let e=await C(L,P,J);U(e),(null==e?void 0:e.error)?F("share"):F("publish")}}),"vscode"===R&&(0,i.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Open in VS Code"),label:lf("Open in VS Code"),onClick:async()=>{F("publishing");let e=await C(L,P,J);U(e),(null==e?void 0:e.error)?F("share"):(F("publish"),pxt.tickEvent("share.openInVscode"),window.open("https://insiders.vscode.dev/makecode/"+e.url.split("/").pop(),"_blank"))}})]}),"publishing"===j&&(0,i.jsx)(o.Button,{className:"primary share-publish-button",title:lf("Publishing..."),label:(0,i.jsx)("div",{className:"common-spinner"}),onClick:()=>{}})]}))]}),"publish"===j&&(0,i.jsxs)("div",Object.assign({className:"project-share-data"},{children:[(0,i.jsxs)("div",Object.assign({className:"common-input-attached-button"},{children:[(0,i.jsx)(a.Input,{ariaDescribedBy:"share-input-title",handleInputRef:e=>{e&&(ae=e)},initialValue:$.url,readOnly:!0,onChange:M}),(0,i.jsx)(o.Button,{className:z?"green":"primary",title:lf("Copy link"),label:z?lf("Copied!"):lf("Copy"),leftIcon:"fas fa-link",onClick:()=>{pxt.BrowserUtils.isIpcRenderer()?q(pxt.BrowserUtils.legacyCopyText(ae)):(navigator.clipboard.writeText($.url),q(!0))},onBlur:()=>{q(!1)}})]})),(0,i.jsxs)("div",Object.assign({className:"project-share-actions"},{children:[(0,i.jsxs)("div",Object.assign({className:"project-share-social"},{children:[(0,i.jsx)(o.Button,{className:"square-button gray embed mobile-portrait-hidden",title:lf("Show embed code"),leftIcon:"fas fa-code",onClick:()=>{"none"===H?(pxt.tickEvent("share.embed"),W(!1),X(!1),G("code")):G("none")}}),(0,i.jsx)(d.SocialButton,{className:"square-button facebook",url:null==$?void 0:$.url,type:"facebook",heading:lf("Share on Facebook")}),(0,i.jsx)(d.SocialButton,{className:"square-button twitter",url:null==$?void 0:$.url,type:"twitter",heading:lf("Share on Twitter")}),(0,i.jsx)(d.SocialButton,{className:"square-button google-classroom",url:null==$?void 0:$.url,type:"google-classroom",heading:lf("Share on Google Classroom")}),(0,i.jsx)(d.SocialButton,{className:"square-button microsoft-teams",url:null==$?void 0:$.url,type:"microsoft-teams",heading:lf("Share on Microsoft Teams")}),(0,i.jsx)(d.SocialButton,{className:"square-button whatsapp",url:null==$?void 0:$.url,type:"whatsapp",heading:lf("Share on WhatsApp")}),(null===(E=null===(_=pxt.appTarget)||void 0===_?void 0:_.appTheme)||void 0===E?void 0:E.shareToKiosk)&&(0,i.jsx)(o.Button,{className:"square-button gray mobile-portrait-hidden",title:lf("Share to MakeCode Arcade Kiosk"),leftIcon:"xicon kiosk",onClick:()=>{Z?X(!1):(pxt.tickEvent("share.kiosk"),G("none"),W(!1),X(!0))}}),navigator.share&&(0,i.jsx)(o.Button,{className:"square-button device-share",title:lf("Show device share options"),ariaLabel:lf("Show device share options"),leftIcon:"icon share",onClick:async()=>{var e;pxt.tickEvent("share.device");const t={title:document.title,url:$.url,text:lf("Check out my new MakeCode project!")};if(null===(e=null===navigator||void 0===navigator?void 0:navigator.canShare)||void 0===e?void 0:e.call(navigator,t))return navigator.share(t)}})]})),(0,i.jsx)(o.Button,{className:"menu-button project-qrcode",buttonRef:e=>{e&&(se=e)},title:lf("Show QR Code"),label:(0,i.jsx)("img",{className:"qrcode-image",src:null==$?void 0:$.qr}),onClick:()=>{pxt.tickEvent("share.qrtoggle"),V?W(!1):(G("none"),W(!0),X(!1))}})]}))]})),"none"!==H&&(0,i.jsxs)("div",Object.assign({className:"project-embed"},{children:[(0,i.jsx)(s.EditorToggle,{id:"project-embed-toggle",className:"slim tablet-compact",items:ue,selected:ue.findIndex((e=>e.name===H))}),(0,i.jsx)(l.Textarea,{readOnly:!0,rows:5,initialValue:null==$?void 0:$.embed[H]})]})),Z&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",Object.assign({className:"project-share-label"},{children:[lf("Enter Kiosk Code"),(0,i.jsx)(o.Button,{className:"link-button kiosk",title:lf("Learn more about Kiosk"),leftIcon:"far fa-question-circle",onClick:()=>{window.open("https://arcade.makecode.com/hardware/kiosk","_blank")}})]})),(0,i.jsxs)("div",Object.assign({className:"common-input-attached-button"},{children:[(0,i.jsx)(a.Input,{handleInputRef:e=>{e&&(le=e)},ariaDescribedBy:"share-input-title",preserveValueOnBlur:!0,placeholder:"A12B3C"}),(0,i.jsx)(o.Button,{className:Y?"green":"primary",title:lf("Submit Kiosk Code"),label:Y?lf("Submitted!"):lf("Submit"),onClick:async()=>{var e;pxt.tickEvent("share.kiosk.submitClicked");const t=pxt.Cloud.parseScriptId($.url);if(null==le?void 0:le.value){let n=null===(e=/^[a-zA-Z0-9]{6}$/.exec(le.value))||void 0===e?void 0:e[0];if(n){n=n.toUpperCase(),K(!0);try{await(0,f.addGameToKioskAsync)(n,t),pxt.tickEvent("share.kiosk.submitSuccessful"),(0,g.pushNotificationMessage)({kind:"info",text:lf("Game submitted to kiosk {0} successfully!",n),hc:!1})}catch(e){pxt.tickEvent("share.kiosk.submitServerError"),"Not Found"===e.message?(0,g.pushNotificationMessage)({kind:"err",text:lf("Kiosk Code not found"),hc:!1}):(0,g.pushNotificationMessage)({kind:"err",text:lf("Something went wrong submitting game to kiosk {0}",n),hc:!1})}}else(0,g.pushNotificationMessage)({kind:"err",text:lf("Invalid format for Kiosk Code"),hc:!1})}else(0,g.pushNotificationMessage)({kind:"err",text:lf("Input a six-character kiosk Code"),hc:!1})},onBlur:()=>{K(!1)}})]}))]})]}),"gifrecord"===j&&(0,i.jsx)(u.ThumbnailRecorder,{initialUri:P,onApply:e=>{B(e),ce()},onCancel:ce,simRecorder:S})]})),V&&(0,i.jsx)(c.Modal,Object.assign({title:lf("QR Code"),onClose:()=>{W(!1),se&&se.focus()}},{children:(0,i.jsx)("div",Object.assign({className:"qrcode-modal-body"},{children:(0,i.jsx)("img",{className:"qrcode-image",src:null==$?void 0:$.qr})}))})),ee&&(0,i.jsx)(p.MultiplayerConfirmation,{onCancelClicked:async()=>{te(!1),pxt.tickEvent("share.hostMultiplayerCancel")},onConfirmClicked:async()=>{F("publishing"),te(!1);const e=await C(L,P,J),t=pxt.Cloud.parseScriptId(e.url);if(!t)return void pxt.tickEvent("share.hostMultiplayerError");const n=pxt.multiplayer.makeHostLink(t,!1);pxt.tickEvent("share.hostMultiplayerShared",{shareId:t}),window.open(n,"_blank"),U(e),(null==e?void 0:e.error)?F("share"):F("publish"),"multiplayer"===R&&D()}})]}))})}},{"../Notification":144,"../controls/Button":146,"../controls/Checkbox":148,"../controls/EditorToggle":151,"../controls/Input":154,"../controls/Modal":159,"../controls/Textarea":163,"../util":187,"./Kiosk":181,"./MultiplayerConfirmation":182,"./SocialButton":185,"./ThumbnailRecorder":186,react:548,"react/jsx-runtime":549}],185:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SocialButton=void 0;const i=e("react/jsx-runtime"),r=e("../controls/Button"),o=e("../util");n.SocialButton=e=>{const{className:t,url:n,type:s,heading:a}=e,l=(0,o.classList)(t,"social-button","type"),c=()=>{const e=pxt.appTarget.appTheme.socialOptions;let t="";switch(pxt.tickEvent(`share.social.${s}`),s){case"facebook":t=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`;break;case"twitter":{let i=lf("Check out what I made!");e.twitterHandle&&e.orgTwitterHandle?i=lf("Check out what I made with @{0} and @{1}!",e.twitterHandle,e.orgTwitterHandle):e.twitterHandle?i=lf("Check out what I made with @{0}!",e.twitterHandle):e.orgTwitterHandle&&(i=lf("Check out what I made with @{0}!",e.orgTwitterHandle)),t=`https://twitter.com/intent/tweet?url=${encodeURIComponent(n)}&text=${encodeURIComponent(i)}`+(e.hashtags?`&hashtags=${encodeURIComponent(e.hashtags)}`:"")+(e.related?`&related=${encodeURIComponent(e.related)}`:"");break}case"discourse":t=`${e.discourse||"https://forum.makecode.com/"}new-topic?title=${encodeURIComponent(n)}`,e.discourseCategory&&(t+=`&category=${encodeURIComponent(e.discourseCategory)}`);break;case"google-classroom":t=`https://classroom.google.com/share?url=${encodeURIComponent(n)}`;break;case"microsoft-teams":t=`https://teams.microsoft.com/share?href=${encodeURIComponent(n)}`;break;case"whatsapp":t=`https://api.whatsapp.com/send?text=${encodeURIComponent(n)}`}pxt.BrowserUtils.popupWindow(t,a,600,600)};switch(s){case"facebook":case"twitter":case"discourse":case"whatsapp":return(0,i.jsx)(r.Button,{className:l,ariaLabel:s,title:a,leftIcon:`icon ${s}`,onClick:c});case"google-classroom":case"microsoft-teams":return(0,i.jsx)(r.Button,{className:l,ariaLabel:s,title:a,label:(0,i.jsx)("img",{src:`/static/logo/social-buttons/${s}.png`,alt:a||pxt.U.rlf(s)}),onClick:c})}}},{"../controls/Button":146,"../util":187,"react/jsx-runtime":549}],186:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ThumbnailRecorder=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../controls/Button"),s=e("../util");n.ThumbnailRecorder=e=>{const{initialUri:t,onApply:n,onCancel:a,simRecorder:l}=e,[c,u]=r.useState(void 0),[d,h]=r.useState(void 0),[p,f]=r.useState(void 0),[g,m]=r.useState("default");let b;r.useEffect((()=>{if(p)return p.addStateChangeListener(m),p.addThumbnailListener(u),p.addErrorListener(h),()=>{p.removeStateChangeListener(m),p.removeThumbnailListener(u),p.removeErrorListener(h)}}),[p]);const y=pxt.appTarget.appTheme,v=y.simScreenshotKey?lf("Screenshot ({0})",y.simScreenshotKey):lf("Screenshot"),_=y.simGifKey?lf("Record ({0})",y.simGifKey):lf("Record"),E=y.simGifKey?lf("Stop recording ({0})",y.simGifKey):lf("Stop recording"),T=lf("Rendering...");let x;switch(g){case"default":x=_;break;case"recording":x=E;break;case"rendering":x=T}const w=c?lf("New Thumbnail"):lf("Current Thumbnail"),k=(0,s.classList)("gif-recorder-content",c&&"has-uri");return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",Object.assign({className:k},{children:[(0,i.jsxs)("div",Object.assign({className:"gif-recorder-sim"},{children:[(0,i.jsx)("div",Object.assign({className:"gif-recorder-sim-embed",ref:e=>{e&&(b=e)}},{children:r.createElement(l,{onSimRecorderInit:e=>{f(e)}})})),(0,i.jsx)("div",Object.assign({className:"gif-recorder"},{children:(0,i.jsxs)("div",Object.assign({className:"gif-recorder-actions"},{children:["default"===g&&(0,i.jsx)(o.Button,{className:"teal inverted",title:v,label:v,leftIcon:"fas fa-camera",onClick:async()=>{h(void 0),p&&p.screenshotAsync()}}),(0,i.jsx)(o.Button,{className:"teal inverted",disabled:"rendering"===g,title:x,label:x,leftIcon:"fas fa-"+("recording"===g?"square":"circle"),onClick:async()=>{if(h(void 0),p)if("recording"===p.state)p.stopRecordingAsync();else if("default"===p.state&&(p.startRecordingAsync(),b)){const e=b.querySelector("iframe");e&&e.focus()}}}),(0,i.jsx)("div",{className:"spacer mobile-only"}),(0,i.jsx)(o.Button,{className:"mobile-only",title:lf("Cancel"),label:lf("Cancel"),onClick:a})]}))}))]})),(0,i.jsxs)("div",Object.assign({className:"thumbnail-controls"},{children:[(0,i.jsx)("div",Object.assign({className:"thumbnail-preview"},{children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",Object.assign({className:"thumbnail-header"},{children:[(0,i.jsx)("span",Object.assign({className:"project-share-label"},{children:w})),(0,i.jsx)(o.Button,{className:"link-button mobile-only",title:lf("Try again?"),label:lf("Try again?"),onClick:()=>u(void 0)})]})),(0,i.jsxs)("div",Object.assign({className:"project-share-thumbnail"},{children:["default"!==g&&(0,i.jsxs)("div",Object.assign({className:"project-thumbnail-placeholder"},{children:[(0,i.jsx)("div",{className:"common-spinner"}),(0,i.jsx)("div",Object.assign({className:"project-thumbnail-label"},{children:"recording"===g?lf("Recording..."):lf("Rendering GIF...")}))]})),"default"===g&&(c||t?(0,i.jsx)("img",{src:c||t}):(0,i.jsx)("div",{className:"thumbnail-placeholder"}))]}))]})})),(0,i.jsxs)("div",Object.assign({className:"thumbnail-actions"},{children:[(0,i.jsx)(o.Button,{title:lf("Cancel"),label:lf("Cancel"),onClick:a}),c&&"default"===g&&(0,i.jsx)(o.Button,{className:"primary",title:lf("Apply"),label:lf("Apply"),onClick:e=>{n(c)}})]}))]}))]}))})}},{"../controls/Button":146,"../util":187,react:548,"react/jsx-runtime":549}],187:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.screenToSVGCoord=n.clientCoord=n.CheckboxStatus=n.nodeListToArray=n.classList=n.fireClickOnEnter=n.jsxLF=void 0;const i=e("react/jsx-runtime");var r;n.jsxLF=function(e,...t){const n=[];e.replace(/\{\d\}/g,(e=>(n.push(parseInt(e.substr(1,1))),e)));const r=[];let o,s=0;for(const a of n)o=e.split(`{${a}}`),pxt.U.assert(2===o.length),r.push((0,i.jsx)("span",{children:o[0]},s++)),r.push((0,i.jsx)("span",{children:t[a]},s++)),e=o[1];return r.push((0,i.jsx)("span",{children:e},s++)),r},n.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())},n.classList=function(...e){return e.filter((e=>"string"==typeof e)).reduce(((e,t)=>e.concat(t.split(" "))),[]).map((e=>e.trim())).filter((e=>!!e)).join(" ")},n.nodeListToArray=function(e){const t=[];for(const n of e)t.push(n);return t},(r=n.CheckboxStatus||(n.CheckboxStatus={}))[r.Selected=0]="Selected",r[r.Unselected=1]="Unselected",r[r.Waiting=2]="Waiting",n.clientCoord=function(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e},n.screenToSVGCoord=function(e,t){const n=e.createSVGPoint();return n.x=t.clientX,n.y=t.clientY,n.matrixTransform(e.getScreenCTM().inverse())}},{"react/jsx-runtime":549}],188:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HomeAccessibilityMenu=n.EditorAccessibilityMenu=void 0;const i=e("react/jsx-runtime"),r=e("./auth"),o=e("./data"),s=e("./sui");class a extends o.Component{constructor(e){super(e),this.state={},this.openJavaScript=this.openJavaScript.bind(this),this.openPython=this.openPython.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.goHome=this.goHome.bind(this)}openJavaScript(){pxt.tickEvent("accmenu.editor.openJS",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()}openPython(){pxt.tickEvent("accmenu.editor.openPY",void 0,{interactiveConsent:!0}),this.props.parent.openPython()}showLanguagePicker(){pxt.tickEvent("accmenu.editor.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.editor.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}goHome(){pxt.tickEvent("accmenu.editor.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.highContrast!=t.highContrast}renderCore(){let e=this.getData(r.HIGHCONTRAST);const t=pxt.appTarget.appTheme,n=!pxt.shell.isControllerMode();return(0,i.jsxs)("div",Object.assign({className:"ui accessibleMenu borderless fixed menu",role:"menubar"},{children:[(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon js",text:lf("Skip to JavaScript editor"),onClick:this.openJavaScript}),t.python?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon python",text:lf("Skip to Python editor"),onClick:this.openPython}):void 0,t.selectLanguage?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,n?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"home",text:lf("Go Home"),onClick:this.goHome}):void 0]}))}}n.EditorAccessibilityMenu=a;class l extends o.Component{constructor(e){super(e),this.state={},this.newProject=this.newProject.bind(this),this.importProjectDialog=this.importProjectDialog.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this)}newProject(){pxt.tickEvent("accmenu.home.new",void 0,{interactiveConsent:!0}),this.props.parent.newProject()}importProjectDialog(){pxt.tickEvent("accmenu.home.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showLanguagePicker(){pxt.tickEvent("accmenu.home.langpicker"),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.highContrast!=t.highContrast}renderCore(){const{highContrast:e}=this.state,t=pxt.appTarget.appTheme;return(0,i.jsxs)("div",Object.assign({className:"ui accessibleMenu borderless fixed menu",role:"menubar"},{children:[(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"add circle",text:lf("New Project"),onClick:this.newProject}),(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"upload",text:lf("Import Project"),onClick:this.importProjectDialog}),t.selectLanguage?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?(0,i.jsx)(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0]}))}}n.HomeAccessibilityMenu=l},{"./auth":194,"./data":282,"./sui":346,"react/jsx-runtime":549}],189:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AccessibleBlocksInfo=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.state={shown:!1},this.handleOnClose=this.handleOnClose.bind(this)}handleOnClose(){this.setState({shown:!0})}render(){return this.state.shown?(0,i.jsx)("div",{}):(0,i.jsxs)(o.Modal,Object.assign({isOpen:!this.state.shown,onClose:this.handleOnClose,closeIcon:!0,dimmer:!0,header:lf("Move, edit, and insert blocks using your keyboard")},{children:[(0,i.jsxs)("div",Object.assign({className:"ui equal width grid"},{children:[(0,i.jsxs)("div",Object.assign({className:"column"},{children:[(0,i.jsx)("h3",{children:lf("Navigate")}),(0,i.jsx)("span",Object.assign({className:"ui small"},{children:lf("Use the WASD keys to move between blocks. Hold shift to move on the workspace.")}))]})),(0,i.jsxs)("div",Object.assign({className:"column"},{children:[(0,i.jsx)("h3",{children:lf("Modify")}),(0,i.jsx)("span",Object.assign({className:"ui small"},{children:lf("Press Enter to 'mark' a block, then X to disconnect, I to reconnect.")}))]})),(0,i.jsxs)("div",Object.assign({className:"column"},{children:[(0,i.jsx)("h3",{children:lf("Insert")}),(0,i.jsx)("span",Object.assign({className:"ui small"},{children:lf("Use T to open the toolbox. Inside the toolbox, use WASD to navigate, and Enter to insert.")}))]}))]})),(0,i.jsx)("div",Object.assign({className:"ui grid"},{children:(0,i.jsx)("strong",{children:(0,i.jsx)("a",Object.assign({href:"https://developers.google.com/blockly/guides/configure/web/keyboard-nav"},{children:lf("See the official Blockly Documentation for additional detail")}))})}))]}))}}n.AccessibleBlocksInfo=s},{"./data":282,"./sui":346,"react/jsx-runtime":549}],190:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ksVersion=n.ProjectView=n.getBlocksEditor=n.getEditorAsync=n.hasEditor=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("blockly"),s=e("./workspace"),a=e("./cloudsync"),l=e("./data"),c=e("./package"),u=e("./core"),d=e("./sui"),h=e("./simulator"),p=e("./compiler"),f=e("./cmds"),g=e("./appcache"),m=e("./screenshot"),b=e("./hidbridge"),y=e("./share"),v=e("./lang"),_=e("./accessibility"),E=e("./tutorial"),T=e("./sidebarTutorial"),x=e("./editortoolbar"),w=e("./dialogs"),k=e("./identity"),S=e("./container"),C=e("./scriptsearch"),A=e("./extensionsBrowser"),I=e("./projects"),O=e("./scriptmanager"),N=e("./extensions"),R=e("./sounds"),D=e("./make"),L=e("./blocksSnippets"),M=e("./monacoSnippets"),P=e("./greenscreen"),B=e("./accessibleblocks"),j=e("./socketbridge"),F=e("./webusb"),$=e("./auth"),U=e("./cloud"),H=e("./user"),G=e("./headerbar"),V=e("./sidepanel"),W=e("./qr"),z=e("./monaco"),q=e("./pxtjson"),Y=e("./serial"),K=e("./blocks"),Z=e("./gitjson"),X=e("./components/assetEditor/editor"),J=e("./draganddrop"),Q=e("./notification"),ee=e("./electron"),te=e("./blocklyFieldView"),ne=e("../../pxtblocks"),ie=e("../../pxteditor");var re=pxt.Cloud,oe=pxt.Util;const se=e("./hinttooltip"),ae=e("./mergeProjects"),le=e("./components/onboarding/Tour"),ce=e("./onboarding"),ue=e("./idbworkspace");let de,he,pe;function fe(){return de?Promise.resolve(de):(pe||(pe=[]),new Promise((e=>{pe.push(e)})))}pxt.blocks.requirePxtBlockly=()=>ne,pxt.blocks.requireBlockly=()=>o,pxt.blocks.registerFieldEditor=(e,t,n)=>ne.registerFieldEditor(e,t,n),pxsim.util.injectPolyphils(),n.hasEditor=function(){return!!de},n.getEditorAsync=fe,n.getBlocksEditor=function(){return de?de.blocksEditor:null};class ge extends $.Component{constructor(e){var t,n;super(e),this.allEditors=[],this.screenshotHandlers=[],this.highContrastSubscriber={subscriptions:[],onDataChanged:()=>{this.onHighContrastChanged()}},this.cloudStatusSubscriber={subscriptions:[],onDataChanged:e=>this.onCloudStatusChanged(e)},this.handleSetPresenceIcon=(e,t,n)=>{if((e|=0)<1||e>4)return;const i=document.getElementById("root"),r=`--multiplayer-presence-icon-${e}`;if(t&&n){const e=pxt.convertUint8BufferToPngUri(t,n);if(!e)return;const o=`url("${e}")`;i.style.setProperty(r,o)}else i.style.removeProperty(r)},this.autoRunSimulatorDebounced=pxtc.Util.debounce((()=>{oe.now()-this.lastChangeTime<1e3?pxt.debug("sim: skip auto, debounced"):this.state.active?this.blocksEditor&&this.blocksEditor.isDropdownDivVisible()?pxt.debug("sim: skip blocks auto, field editor is open"):this.editor!==this.serialEditor?this.state.debugging||this.state.tracing?pxt.debug("sim: don't restart when debugging or tracing"):this.state.collapseEditorTools?pxt.debug("sim: don't restart when simulator collapsed"):!pxt.BrowserUtils.isSkillmapEditor()||this.state.header?this.runSimulator({debug:!!this.state.debugging,background:!0}):pxt.debug("sim: don't restart when no project is open"):pxt.debug("sim: don't restart when entering console view"):pxt.debug("sim: skip blocks auto, !active")}),1e3,!0),this._slowTypeCheck=0,this.typecheckDebouncer=new pxtc.Util.AdaptiveDebouncer((()=>{if(this.editor.isIncomplete())return;const e=oe.now();this.saveFileAsync();const t=this.editor.snapshotState();p.typecheckAsync().then((n=>{const i=oe.now();if(!pxt.options.light&&i-e>1e4&&this._slowTypeCheck++>1&&(pxt.tickEvent("light.typecheck"),pxt.options.light=!0),pxt.tickEvent("typecheck.complete",{editor:this.getPreferredEditor()}),this.editor.setDiagnostics(this.editorFile,t),l.invalidate("open-pkg-meta:"+c.mainEditorPkg().getPkgId()),this.state.autoRun){const e=c.mainEditorPkg().outputPkg.files["output.txt"];e&&!e.numDiagnosticsOverride&&this.state.autoRun&&this.autoRunSimulatorDebounced()}this.maybeShowPackageErrors()}))})),this.markdownChangeHandler=oe.debounce((()=>{this.state.currFile&&/\.md$/i.test(this.state.currFile.name)&&this.setSideMarkdown(this.editor.getCurrentSource())}),3e3,!1),this.editorChangeHandler=oe.debounce((()=>{this.editor.isIncomplete()||(this.saveFileAsync(),this.typecheck()),this.markdownChangeHandler()}),500,!1),this.hexFileImporters=[{id:"default",canImport:e=>e.meta.cloudId=="ks/"+pxt.appTarget.id||e.meta.cloudId==pxt.CLOUD_ID+pxt.appTarget.id||oe.startsWith(e.meta.cloudId,pxt.CLOUD_ID+pxt.appTarget.id),importAsync:(e,t)=>{let n={target:pxt.appTarget.id,targetVersion:t.meta.targetVersions?t.meta.targetVersions.target:void 0,editor:t.meta.editor,name:t.meta.name,meta:{},pubId:"",pubCurrent:!1};const i=JSON.parse(t.source);return s.installAsync(n,i).then((e=>this.loadHeaderAsync(e,null)))}}],this.resourceImporters=[new Y.ResourceImporter],this.pushScreenshotHandler=e=>{this.screenshotHandlers.push(e)},this.popScreenshotHandler=()=>{this.screenshotHandlers.pop()},this.checkWebUSBVariant=!0,this._deploying=!1,this.closeOnEscape=e=>{u.keyCodeFromEvent(e)===u.ESC_KEY&&(e.preventDefault(),this.toggleSimulatorFullscreen())},this.hintManager=new se.HintManager,this.handleScriptManagerDialogClose=()=>{this.home.forceUpdate(),s.syncAsync()},this.handleHomeRef=e=>{this.home=e},this.handleScriptSearchRef=e=>{this.scriptSearch=e},this.handleExtensionRef=e=>{this.extensions=e},this.handleScriptManagerDialogRef=e=>{this.scriptManagerDialog=e},this.handleImportDialogRef=e=>{this.importDialog=e},this.handleExitAndSaveDialogRef=e=>{this.exitAndSaveDialog=e},this.handleNewProjectDialogRef=e=>{this.newProjectDialog=e},this.handleShareEditorRef=e=>{this.shareEditor=e},this.handleLanguagePickerRef=e=>{this.languagePicker=e},this.handleChooseHwDialogRef=e=>{this.chooseHwDialog=e},this.handleLoginDialogRef=e=>{this.loginDialog=e},this.handleProfileDialogRef=e=>{this.profileDialog=e},document.title=pxt.appTarget.title||pxt.appTarget.name,this.reload=!1,this.settings=JSON.parse(pxt.storage.getLocal("editorSettings")||"{}");const i=this.shouldShowHomeScreen();(/hc=(\w+)/.test(window.location.href)||(null===(n=null===(t=window.matchMedia)||void 0===t?void 0:t.call(window,"(forced-colors: active)"))||void 0===n?void 0:n.matches))&&u.setHighContrast(!0);const r=pxt.appTarget.simulator;this.state={showFiles:!1,home:i,active:"visible"==document.visibilityState||pxt.BrowserUtils.isElectron()||pxt.appTarget.appTheme.dontSuspendOnVisibility,collapseEditorTools:r.headless,simState:0,autoRun:this.autoRunOnStart(),isMultiplayerGame:!1,onboarding:void 0,mute:"unmuted"},this.settings.editorFontSize||(this.settings.editorFontSize=/mobile/i.test(navigator.userAgent)?15:19),this.settings.fileHistory||(this.settings.fileHistory=[]),i&&this.homeLoaded(),this.hidePackageDialog=this.hidePackageDialog.bind(this),this.hwDebug=this.hwDebug.bind(this),this.hideLightbox=this.hideLightbox.bind(this),this.hideOnboarding=this.hideOnboarding.bind(this),this.openSimSerial=this.openSimSerial.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.openSerial=this.openSerial.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.showKeymap=this.showKeymap.bind(this),this.toggleKeymap=this.toggleKeymap.bind(this),this.showMiniSim=this.showMiniSim.bind(this),this.setTutorialStep=this.setTutorialStep.bind(this),this.completeTutorialAsync=this.completeTutorialAsync.bind(this),this.exitTutorial=this.exitTutorial.bind(this),this.setEditorOffset=this.setEditorOffset.bind(this),this.resetTutorialTemplateCode=this.resetTutorialTemplateCode.bind(this),this.initSimulatorMessageHandlers(),pxt.BrowserUtils.useOldTutorialLayout&&this.hintManager.addHint(ge.tutorialCardId,this.tutorialCardHintCallback.bind(this))}autoRunOnStart(){return pxt.appTarget.simulator&&((pxt.options.light?!!pxt.appTarget.simulator.autoRunLight:!!pxt.appTarget.simulator.autoRun)||this.firstRun&&!!pxt.appTarget.simulator.emptyRunCode)}initSimulatorMessageHandlers(){window.addEventListener("message",(e=>{var t,n;let i=e.data;if(i&&this.state.header)if("addextensions"===i.type){const e=i.extensions;this.addOrUpdateGithubExtensions(e)}else if("screenshot"===i.type){const e=i;if(!e.data)return;const t=this.screenshotHandlers[this.screenshotHandlers.length-1];if(t)t(e);else{const t=pxt.BrowserUtils.imageDataToPNG(e.data);pxt.appTarget.compile.saveAsPNG&&this.encodeProjectAsPNGAsync(t,!1),m.saveAsync(this.state.header,t).then((()=>{pxt.debug("screenshot saved")}))}}else if("recorder"===i.type){const e=i,t=this.screenshotHandlers[this.screenshotHandlers.length-1];t&&t({event:e.action})}else if("thumbnail"===i.type)this.shareEditor&&this.shareEditor.setThumbnailFrames(i.frames);else if("multiplayer"===i.type){const e=i;if("Icon"===e.content&&e.iconType===pxsim.multiplayer.IconType.Player){const{palette:t,icon:n,slot:i}=e;this.handleSetPresenceIcon(i,t,null==n?void 0:n.data)}}else if("toplevelcodefinished"===i.type&&(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.appTheme)||void 0===n?void 0:n.multiplayer)){const e={type:"multiplayer",content:"Connection",slot:1,connected:!0};h.driver.postMessage(e)}}),!1)}async addOrUpdateGithubExtensions(e){pxt.tickEvent("package.addextensions");const t=c.mainEditorPkg(),n=await pxt.packagesConfigAsync(),r=null==e?void 0:e.map((e=>pxt.github.parseRepoId(e))).filter((e=>!!e)).filter((e=>pxt.github.repoStatus(e,n)!==pxt.github.GitRepoStatus.Banned));if(!t||!(null==r?void 0:r.length))return;const o=r.filter((e=>pxt.github.repoStatus(e,n)!==pxt.github.GitRepoStatus.Approved));if(!o.length||await u.confirmAsync({header:lf("Add extensions?"),jsx:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:lf("Add or update these user-provided extensions to your project?")}),(0,i.jsx)("ul",{children:o.map((e=>(0,i.jsx)("li",{children:(0,i.jsx)("a",Object.assign({href:`/pkg/${e.fullName}`},{children:e.fullName}))},e.fullName)))}),(0,i.jsx)("hr",{}),(0,i.jsx)("p",{children:lf("User-provided extension are not endorsed by Microsoft.")})]})})){pxt.debug(`adding extensions ${e}`);try{u.showLoading("addextensions",lf("adding extensions..."));for(const e of r){pxt.debug(`adding ${e.fullName}`);const{config:n,version:i}=await pxt.github.downloadLatestPackageAsync(e);await t.setDependencyAsync(n.name,i)}this.reloadHeaderAsync()}catch(e){u.handleNetworkError(e)}finally{u.hideLoading("addextensions")}}}shouldShowHomeScreen(){const e=ye(),t=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),n=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode()||/^#editor/.test(window.location.hash);return!t&&!n&&!_e(e)}async updateVisibilityAsync(){var e;if(pxt.BrowserUtils.isElectron()||pxt.appTarget.appTheme.dontSuspendOnVisibility)return;const t=pxt.BrowserUtils.isDocumentVisible();if(pxt.debug(`page visibility: ${t}`),this.setState({active:t}),l.invalidate("pkg-git-pull-status"),l.invalidate("pkg-git-pr"),l.invalidate("pkg-git-pages"),t||(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||(this._deploying?pxt.debug("visibility: disconnect cancelled because deploy in progress"):f.disconnectAsync()),!t&&this.state.autoRun)h.driver.state==pxsim.SimulatorState.Running&&(this.suspendSimulator(),this.setState({resumeOnVisibility:!0})),this.saveFileAsync();else if(t){l.invalidate("header:*");let e=this.state.header?this.state.header.id:"";const t=!this.state.home&&e;!t&&s.isHeadersSessionOutdated()||s.isHeaderSessionOutdated(this.state.header)?(pxt.debug("workspace: changed, reloading..."),await s.syncAsync(),t&&await this.loadHeaderAsync(s.getHeader(e),this.state.editorState)):this.state.resumeOnVisibility?(this.setState({resumeOnVisibility:!1}),this.runSimulator(),f.maybeReconnectAsync(!1,!0)):this.state.home||f.maybeReconnectAsync(!1,!0)}this.editor&&this.editor.onPageVisibilityChanged(t)}saveSettings(){if(this.reload)return;let e=this.editorFile;e&&e.epkg.getTopHeader()&&this.editor.hasHistory()&&this.pushFileHistory(e.epkg.getTopHeader().id,e.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings))}pushFileHistory(e,t,n){const i=this.settings;let r={id:e,name:t,pos:n};for(i.fileHistory=i.fileHistory.filter((e=>e.id!=r.id||e.name!=r.name));i.fileHistory.length>100;)i.fileHistory.pop();i.fileHistory.unshift(r)}popFileHistory(){this.settings.fileHistory.shift()}openProjectInLegacyEditor(e){if(!this.editorFile||!this.editorFile.epkg||!this.editorFile.epkg.getTopHeader())return Promise.resolve();const t=this.editorFile.epkg.getTopHeader();return pxt.tickEvent("update.openLegacyEditor",{version:t.targetVersion}),s.copyProjectToLegacyEditor(t,e).then((n=>{this.pushFileHistory(n.id,this.editorFile.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings));const i=pxt.appTarget.appTheme;if(i&&i.editorVersionPaths&&i.editorVersionPaths[e]){const t=i.editorVersionPaths[e];window.location.href=pxt.Util.pathJoin(window.location.origin,t+"#editor")}else window.location.href=pxt.Util.pathJoin(window.location.origin,"v"+t.targetVersion+"#editor")})).catch((e=>{u.warningNotification(lf("Importing to older editor version only supported in web browsers"))}))}async componentDidUpdate(e,t){this.saveSettings(),this.editor.domUpdate(),h.setState(this.state.header?this.state.header.editor:"",this.state.tutorialOptions&&!!this.state.tutorialOptions.tutorial),this.state.fullscreen||this.editor.resize();let n=Promise.resolve();this.editor&&this.editor.isReady&&(n=n.then((()=>this.updateEditorFileAsync()))),this.editor&&(n=n.then((()=>{this.editor.updateBreakpoints(),this.editor.updateToolbox()})))}fireResize(){if(document.createEvent){let e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}else document.fireEvent("onresize")}updateEditorLogo(e,t){if(pxt.appTarget.appTheme.hideMenuBar){const n=document.getElementById("editorlogo");if(n)return n.style.left=`${e}px`,n.style.display="block",n.style.background=t||"",n.offsetHeight}return 0}saveFileAsync(){return!this.editorFile||this.loadingExample?Promise.resolve():this.saveTypeScriptAsync().then((()=>this.saveCurrentSourceAsync()))}saveProjectAsync(){return this.saveFileAsync().then((()=>c.mainEditorPkg().buildAssetsAsync())).then((()=>this.state.header&&s.saveAsync(this.state.header)))}saveCurrentSourceAsync(){let e=this.editor.getCurrentSource();return e!=this.editorFile.content&&h.setDirty(),this.editor.isIncomplete()?Promise.resolve():this.editorFile.setContentAsync(e)}isEmbedSimActive(){return this.state.embedSimView}isBlocksActive(){return!this.state.embedSimView&&this.editor==this.blocksEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_BLOCKS}isJavaScriptActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_TS}isPythonActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_PY}isAssetsActive(){return!this.state.embedSimView&&this.editor==this.assetEditor&&this.editorFile&&this.editorFile.name==pxt.ASSETS_FILE}isAnyEditeableJavaScriptOrPackageActive(){return this.editor==this.textEditor&&this.editorFile&&!this.editorFile.isReadonly()&&/(\.ts|pxt.json)$/.test(this.editorFile.name)}openPython(e=!0){if(this.updatingEditorFile)return;if(this.setState({tracing:!1}),this.isPythonActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());this.textEditor&&(this.textEditor.giveFocusOnLoading=e);const t=this.state.header;if(this.isBlocksActive()||t.editor==pxt.BLOCKS_PROJECT_NAME)this.blocksEditor.openPython();else if(this.isJavaScriptActive()||t.editor==pxt.JAVASCRIPT_PROJECT_NAME)this.openPythonAsync();else{const e=c.mainEditorPkg().files[pxt.MAIN_PY];e?this.setFile(e):this.updateFileAsync(pxt.MAIN_PY,"# ...",!1)}}openJavaScript(e=!0){if(!this.updatingEditorFile){if(this.isJavaScriptActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openTypeScript();else if(this.isPythonActive())this.openTypeScriptAsync();else{const e=c.mainEditorPkg().files;let t=e[pxt.MAIN_TS];t||(t=e[Object.keys(e).find((e=>/\.ts$/.test(e)))]),this.setFile(t)}pxt.shell.setEditorLanguagePref("js")}}openBlocks(){var e;if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));(null===(e=pxt.appTarget.simulator)||void 0===e?void 0:e.headless)&&!this.state.collapseEditorTools&&this.toggleSimulatorCollapse();const t=c.mainEditorPkg().files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)this.textEditor.openBlocks();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!t.content)this.saveFileAsync().then((()=>this.textEditor.openBlocks()));else{const e=this.state.header;e&&e.editor!==pxt.BLOCKS_PROJECT_NAME?this.textEditor.openBlocks():this.setFile(t)}this.shouldTryDecompile=!1}async openBlocksAsync(){if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));const e=c.mainEditorPkg();e.files[pxt.MAIN_BLOCKS]||e.setContentAsync(pxt.MAIN_BLOCKS,"");const t=e.files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)await this.textEditor.openBlocksAsync();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!t.content)await this.saveFileAsync(),await this.textEditor.openBlocksAsync();else{const e=this.state.header;e&&e.editor!==pxt.BLOCKS_PROJECT_NAME?await this.textEditor.openBlocksAsync():this.setFile(t)}this.shouldTryDecompile=!1}openAssets(){const e=c.mainEditorPkg();e&&(e.lookupFile("this/"+pxt.ASSETS_FILE)||e.setFile(pxt.ASSETS_FILE,"\n",!0),this.saveFileAsync().then((()=>this.setFile(c.mainEditorPkg().lookupFile(`this/${pxt.ASSETS_FILE}`)))))}openSettings(){this.setFile(c.mainEditorPkg().lookupFile("this/pxt.json"))}openSimSerial(){this.openSerial(!0)}openDeviceSerial(){this.openSerial(!1)}openSerial(e){if(!pxt.appTarget.serial||!pxt.appTarget.serial.useEditor)return;if(this.editor==this.serialEditor&&this.serialEditor.isSim==e)return;const t=c.mainEditorPkg();if(!t)return;t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE)||t.setFile(pxt.SERIAL_EDITOR_FILE,"serial\n",!0),this.serialEditor.setSim(e);let n="serial."+(e?"simulator":"device")+"EditorOpened";pxt.tickEvent(n),this.setFile(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE))}openPreviousEditor(){this.preserveUndoStack=!0;const e=this.state.header.id,t=this.settings.fileHistory[0];this.editorFile&&t.id==e&&t.name==this.editorFile.getName()&&this.popFileHistory();const n=this.settings.fileHistory.find((t=>t.id==e));if(n){const e=c.mainEditorPkg().lookupFile(n.name);if(e)return void this.setSideFile(e)}const i=!!c.mainEditorPkg().files[pxt.MAIN_BLOCKS];"monacoEditor"!=this.prevEditorId&&i?this.openBlocks():this.openJavaScript(!1)}openTypeScriptAsync(){return this.saveTypeScriptAsync(!0)}openPythonAsync(){const e=c.mainEditorPkg().files[pxt.MAIN_PY];if(e){const t=c.mainEditorPkg().files[pxt.MAIN_TS].content;return this.textEditor.convertPythonToTypeScriptAsync().then((n=>n==t?(pxt.debug("ts -> py shortcut"),this.setFile(e),Promise.resolve()):this.convertTypeScriptToPythonAsync()))}return this.convertTypeScriptToPythonAsync()}convertTypeScriptToPythonAsync(){var e,t;this.editor.snapshotState();const n=this.isBlocksActive()?"blocks":"ts",i=this.isBlocksActive()?pxt.MAIN_BLOCKS:pxt.MAIN_TS,r=c.mainEditorPkg(),o=null!==(t=null===(e=r.files[i])||void 0===e?void 0:e.content)&&void 0!==t?t:"";let s;const a=r.getCachedTranspile(n,o,"py"),l=(s=a?this.saveVirtualMainFileAsync(pxt.PYTHON_PROJECT_NAME,a,!0):this.saveTypeScriptAsync(!1).then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((e=>{if(e&&e.success){const t=e.outfiles[pxt.MAIN_PY];return r.cacheTranspile(n,o,"py",t),this.saveVirtualMainFileAsync(pxt.PYTHON_PROJECT_NAME,t,!0)}{const e=new Error("Failed to convert to Python.");return pxt.reportException(e),Promise.reject(e)}})).then((()=>(pxt.shell.setEditorLanguagePref("py"),Promise.resolve())))).then((()=>{}),(e=>u.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to Python."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((()=>{}))));return u.showLoadingAsync("switchtopython",lf("switching to Python..."),s),l}openSimView(){this.state.embedSimView?this.startStopSimulator():(this.setState({embedSimView:!0}),this.startSimulator())}shouldPreserveUndoStack(){return this.preserveUndoStack}typecheckNow(){this.saveFileAsync(),this.typecheck()}showPackageErrorsOnNextTypecheck(){this.setState({suppressPackageWarning:!1})}maybeShowPackageErrors(e=!1){if(pxt.perf.measureStart("maybeShowPackageErrors"),this.state.currFile){const e=this.state.currFile;if(!ie.isBlocks(e)&&e.name!==pxt.MAIN_TS)return!1}if(!this.state.suppressPackageWarning||e){this.setState({suppressPackageWarning:!0});const t=p.getPackagesWithErrors();if(t.length){const n=this.state.header,i=pxt.semver.parse(pxt.appTarget.versions.target),r=pxt.semver.parse(n.targetVersion);let o;return s.isBrowserWorkspace()&&i.major!==r.major&&(o=()=>{this.openProjectInLegacyEditor(r.major)}),w.showPackageErrorDialogAsync(t,p.updatePackagesAsync,o).then((t=>{t?this.reloadHeaderAsync():e||this.openHome()})),pxt.perf.measureEnd("maybeShowPackageErrors"),!0}}return pxt.perf.measureEnd("maybeShowPackageErrors"),!1}typecheck(){this.typecheckDebouncer.trigger()}initEditors(){this.textEditor=new z.Editor(this),this.pxtJsonEditor=new q.Editor(this),this.serialEditor=new Y.Editor(this),this.blocksEditor=new K.Editor(this),this.gitjsonEditor=new Z.Editor(this),this.assetEditor=new X.AssetEditor(this);let e=()=>{this.editorFile&&(this.editorFile.inSyncWithEditor&&pxt.tickEvent("activity.edit",{editor:this.editor.getId().replace(/Editor$/,"")},{interactiveConsent:!0}),this.editorFile.markDirty()),this.lastChangeTime=oe.now(),0!=this.state.simState&&pxt.appTarget.simulator&&pxt.appTarget.simulator.stopOnChange&&this.stopSimulator(),this.editor.isIncomplete()||(this.editor==this.textEditor&&this.typecheckDebouncer.poke(),this.editorChangeHandler())};this.allEditors=[this.pxtJsonEditor,this.gitjsonEditor,this.blocksEditor,this.serialEditor,this.assetEditor,this.textEditor],this.allEditors.forEach((t=>t.changeCallback=e)),this.editor=this.allEditors[this.allEditors.length-1]}UNSAFE_componentWillMount(){this.initEditors(),this.initDragAndDrop()}componentDidMount(){this.allEditors.forEach((e=>e.prepare())),h.init(document.getElementById("boardview"),{orphanException:e=>{var t;null===(t=this.editor)||void 0===t||t.onExceptionDetected(e)},highlightStatement:(e,t)=>{if(this.state.debugging&&!h.driver.areBreakpointsSet()&&t&&!t.exceptionMessage){let e;if(this.isAnyEditeableJavaScriptOrPackageActive()||this.isPythonActive()?e=this.textEditor.getBreakpoints():this.isBlocksActive()&&(e=this.blocksEditor.getBreakpoints()),e=e||[],h.driver.setBreakpoints(e),-1===e.indexOf(t.breakpointId))return this.state.debugFirstRun?(this.dbgStepInto(),this.setState({debugFirstRun:!1})):this.dbgPauseResume(),!0}return!!this.editor&&this.editor.highlightStatement(e,t)},restartSimulator:()=>this.restartSimulator(),onStateChanged:e=>{const t=()=>this.allEditors.forEach((e=>e.simStateChanged()));switch(e){case pxsim.SimulatorState.Paused:case pxsim.SimulatorState.Unloaded:case pxsim.SimulatorState.Suspended:case pxsim.SimulatorState.Pending:case pxsim.SimulatorState.Stopped:this.setState({simState:0},t);break;case pxsim.SimulatorState.Running:this.setState({simState:3},t)}},onSimulatorReady:()=>{this.autoRunOnStart()&&pxt.analytics.trackPerformanceReport()},onMuteButtonStateChange:e=>this.setMute(e),setState:(e,t)=>{c.mainEditorPkg().setSimState(e,t)},editor:this.state.header?this.state.header.editor:""}),this.forceUpdate(),this.loadBlocklyAsync(),l.subscribe(this.highContrastSubscriber,$.HIGHCONTRAST),l.subscribe(this.cloudStatusSubscriber,`${U.HEADER_CLOUDSTATE}:*`)}componentWillUnmount(){l.unsubscribe(this.highContrastSubscriber),l.unsubscribe(this.cloudStatusSubscriber)}componentDidCatch(e,t){this.handleCriticalError(e,t)}handleCriticalError(e,t){try{u.killLoadingQueue(),pxsim.U.remove(document.getElementById("loading")),this.setState({hasError:!0}),pxt.tickEvent("pxt.criticalerror",{error:e||"",info:t||""});const n=pxt.storage.getLocal("lastcriticalerror")&&Date.parse(pxt.storage.getLocal("lastcriticalerror"));(!n||isNaN(n)||Date.now()-n>6e4)&&(pxt.storage.setLocal("lastcriticalerror",(new Date).toISOString()),setTimeout((()=>{this.reloadEditor()}),2e3))}catch(e){}}pickEditorFor(e){return this.allEditors.filter((t=>t.acceptsFile(e)))[0]}updateEditorFileAsync(e=null){if(!this.state.active||this.updatingEditorFile||this.state.currFile==this.editorFile&&!e)return void(this.state.editorPosition&&this.editorFile==this.state.editorPosition.file&&(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0})));let t=!1;return this.updatingEditorFile=!0,u.showLoadingAsync("updateeditorfile",lf("loading editor..."),Promise.resolve()).then((()=>(t=0!=this.state.simState,this.state.currFile.virtual||this.state.debugging||(this.stopSimulator(),(t||this.state.autoRun)&&(h.setPending(),this.setState({simState:1}))),this.saveSettings(),this.openingTypeScript?Promise.resolve():this.saveFileAsync()))).then((()=>{this.editorFile=this.state.currFile;let t=this.editor;return this.prevEditorId=t.getId(),this.editor=e||this.pickEditorFor(this.editorFile),this.allEditors.forEach((e=>e.setVisible(e==this.editor))),t?t.unloadFileAsync():Promise.resolve()})).then((()=>{let e=this.getData($.HIGHCONTRAST);return this.editor.loadFileAsync(this.editorFile,e)})).then((()=>{if(this.saveFileAsync(),this.editor!=this.textEditor&&this.editor!=this.blocksEditor||this.typecheck(),this.state.editorPosition)this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0});else{const e=this.settings.fileHistory.find((e=>e.id==this.state.header.id&&e.name==this.editorFile.getName()));e&&this.editor.setViewState(e.pos)}S.SideDocs.notify({type:"fileloaded",name:this.editorFile.getName(),locale:pxt.Util.localeInfo()}),this.state.showBlocks&&this.editor==this.textEditor&&this.textEditor.openBlocks()})).finally((()=>{this.updatingEditorFile=!1,this.preserveUndoStack=!1,this.isJavaScriptActive()&&(this.openingTypeScript=!1),this.forceUpdate()})).then((()=>{this.state.currFile.virtual||!t||this.state.autoRun?this.typecheck():this.startSimulator()}))}setFile(e,t){if(!e)return;e.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0);const n=this.state.header;let i=!1;n&&"this"===(e.epkg&&e.epkg.getPkgId())&&(this.isBlocksFile(e.name)?(n.editor=pxt.BLOCKS_PROJECT_NAME,n.pubCurrent=!1,i=!0):this.isTypescriptFile(e.name)?(n.editor=pxt.JAVASCRIPT_PROJECT_NAME,n.pubCurrent=!1,i=!0):this.isPythonFile(e.name)&&(n.editor=pxt.PYTHON_PROJECT_NAME,n.pubCurrent=!1,i=!0),i&&c.mainPkg.setPreferredEditor(n.editor));const r={currFile:e,showBlocks:!1,embedSimView:!1,autoRun:this.autoRunOnStart()};void 0!==t&&(r.editorPosition={lineNumber:t,column:1,file:e}),this.setState(r)}setSideFile(e,t){let n=e.name,i=this.state.currFile.name;const r=this.state.header;n!=i&&ie.isBlocks(e)?(pxt.tickEvent("sidebar.showBlocks"),this.openBlocks()):r.editor!=pxt.PYTHON_PROJECT_NAME&&n.endsWith(".py")?(pxt.tickEvent("sidebar.showPython"),this.openPython()):r.editor!=pxt.JAVASCRIPT_PROJECT_NAME&&n.endsWith(".ts")?(pxt.tickEvent("sidebar.showTypescript"),this.openJavaScript()):((this.isTextEditor()||this.isPxtJsonEditor())&&(this.textEditor.giveFocusOnLoading=!1),this.setFile(e,t))}navigateToError(e){if(!e)return;let t=e.fileName;/^(pxt_modules|built)\//.test(t)||(t="this/"+t);let n=c.mainEditorPkg().lookupFile(t);n&&this.setSideFile(n,e.line+1)}removeFile(e,t=!1){const n=()=>{c.mainEditorPkg().removeFileAsync(e.name).then((()=>c.mainEditorPkg().saveFilesAsync())).then((()=>this.reloadHeaderAsync()))};t?n():u.confirmAsync({header:lf("Remove {0}",e.name),body:lf("You are about to remove a file from your project. You can't undo this. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((e=>{e&&n()}))}updateFileAsync(e,t,n){const i=c.mainEditorPkg();return i.setContentAsync(e,t).then((()=>{n&&this.setFile(i.lookupFile("this/"+e))})).then((()=>this.reloadHeaderAsync()))}isSideDocExpanded(){const e=this.refs.sidedoc;return!!e&&!e.isCollapsed()}setSideMarkdown(e){let t=this.refs.sidedoc;t&&t.setMarkdown(e)}setSideDoc(e,t=!0){let n=this.refs.sidedoc;n&&(e?n.setPath(e,t):n.collapse())}setSideDocCollapsed(e=!0){let t=this.refs.sidedoc;t&&(e&&this.isSideDocExpanded()?t.collapse():e||this.isSideDocExpanded()||t.expand())}setTutorialInstructionsExpanded(e){const t=this.state.tutorialOptions;t.tutorialStepExpanded=e,t.autoexpandStep=e,this.setState({tutorialOptions:t},(()=>{this.editor==this.blocksEditor?this.blocksEditor.hideFlyout():this.editor==this.textEditor&&this.textEditor.hideFlyout(),this.setEditorOffset()}))}setTutorialStep(e){var t;this.typecheckNow(),this.stopPokeUserActivity();let n=this.refs[ge.tutorialCardId];if(this.isTutorial()&&e>-1){let i=this.state.tutorialOptions;i.tutorialStep=e,i.tutorialStepExpanded=!1,this.setState({tutorialOptions:i},(()=>{this.postTutorialProgress(),s.saveAsync(this.state.header)})),i.tutorialStepInfo[e].showHint&&n&&this.showTutorialHint(),i.tutorialStepInfo[e].tutorialCompleted&&pxt.commands.onTutorialCompleted&&pxt.commands.onTutorialCompleted(),this.editor.closeFlyout(),this.textEditor.giveFocusOnLoading&&this.isTextEditor()&&(null===(t=this.textEditor.editor)||void 0===t||t.focus())}}postTutorialProgress(){var e,t,n,i,r,o,s,a,l,c,u;const d=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorialStep)||(null===(n=null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted)||void 0===n?void 0:n.steps)||0,h=(null===(r=null===(i=this.state.tutorialOptions)||void 0===i?void 0:i.tutorialStepInfo)||void 0===r?void 0:r.length)||(null===(s=null===(o=this.state.header)||void 0===o?void 0:o.tutorialCompleted)||void 0===s?void 0:s.steps)||0,p=(null===(a=this.state.tutorialOptions)||void 0===a?void 0:a.tutorial)||(null===(l=this.state.header)||void 0===l?void 0:l.tutorialCompleted.id);ie.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"progress",currentStep:d,totalSteps:h,tutorialId:p,projectHeaderId:null===(c=this.state.header)||void 0===c?void 0:c.id,isCompleted:!!(null===(u=this.state.header)||void 0===u?void 0:u.tutorialCompleted)})}postTutorialLoaded(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);ie.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"loaded",tutorialId:n,projectHeaderId:this.state.header.id})}postTutorialCompleted(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);ie.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"completed",tutorialId:n,projectHeaderId:this.state.header.id})}postTutorialExit(){var e,t;const n=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);ie.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"exit",tutorialId:n,projectHeaderId:this.state.header.id})}handleMessage(e){switch(e.type){case"opendoc":window.open(e.url,"_blank"),this.setState({sideDocsCollapsed:!0,sideDocsLoadUrl:""});break;case"tutorial":switch(e.subtype){case"loaded":let t=e;t.toolboxSubset&&Object.keys(t.toolboxSubset).length>0&&(this.setState({editorState:{filters:{blocks:t.toolboxSubset,defaultState:0}}}),this.editor.filterToolbox(t.showCategories));let n=this.state.tutorialOptions;n.tutorialReady=!0,n.tutorialStepInfo=t.stepInfo,this.setState({tutorialOptions:n},(()=>s.saveAsync(this.state.header))),n.tutorialStepInfo[0].showHint&&this.showTutorialHint(),u.hideLoading("tutorial");break;case"error":let i=e;pxt.reportException(i.message),u.errorNotification(lf("We're having trouble loading this tutorial, please try again later.")),this.setState({tutorialOptions:void 0});let r=c.mainEditorPkg().header;r.isDeleted=!0,r.tutorial=void 0,s.forceSaveAsync(r,{}).then((()=>{this.openHome()})).finally((()=>u.hideLoading("tutorial")))}}}reloadHeaderAsync(){return this.loadHeaderAsync(this.state.header,this.state.editorState)}tryCheckTargetVersionAsync(e){const t=e||"0.0.0";if(pxt.semver.majorCmp(t,pxt.appTarget.versions.target)<0&&pxt.tickEvent("patch.load.legacy",{targetVersion:t}),pxt.semver.majorCmp(t,pxt.appTarget.versions.target)>0){pxt.tickEvent("patch.load.future",{targetVersion:t});const e=[];return pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.homeUrl&&e.push({label:lf("Get latest"),icon:"external alternate",url:pxt.appTarget.appTheme.homeUrl}),u.dialogAsync({header:lf("Oops, this project is too new!"),body:lf("This project was created in a newer version of this editor. Please try again in that editor."),disagreeLbl:lf("Ok"),buttons:e}).then((()=>this.openHome()))}}async loadHeaderAsync(e,t,n=!0){if(!e)return Promise.resolve();this.shareEditor&&this.shareEditor.setThumbnailFrames(void 0),this.setState({isMultiplayerGame:!1});const i=this.tryCheckTargetVersionAsync(e.targetVersion);if(i)return i.then((()=>this.openHome()));if(s.isHeadersSessionOutdated()&&(pxt.log("multi-tab sync before load"),await s.syncAsync()),n){const t=15e3,n=oe.nowSeconds();let i=!1;await Promise.race([pxt.U.delay(t).then((()=>{i=!0})),U.syncAsync({hdrs:[e],direction:"down"}).then((t=>{if(t.length){const r=oe.nowSeconds()-n;i?(pxt.tickEvent("identity.syncOnProjectOpen.timedout",{elapsedSec:r}),t.some((t=>t.id===e.id))&&U.forceReloadForCloudSync()):(pxt.tickEvent("identity.syncOnProjectOpen.syncSuccess",{elapsedSec:r}),e=s.getHeader(e.id))}}))])}e&&(s.acquireHeaderSession(e),await this.internalLoadHeaderAsync(e,t))}internalLoadHeaderAsync(e,t){var n;pxt.debug(`loading ${e.id} (pxt v${e.targetVersion})`),this.stopSimulator(!0),pxt.appTarget.simulator&&pxt.appTarget.simulator.aspectRatio&&h.driver.preload(pxt.appTarget.simulator.aspectRatio),this.clearSerial(),this.firstRun=!0,this.allEditors.forEach((e=>e.clearCaches())),this.setState({autoRun:this.autoRunOnStart(),tracing:void 0});const i=this.state.editorState;return i&&t&&(void 0===t.filters&&(t.filters=i.filters),void 0===t.hasCategories&&(t.hasCategories=i.hasCategories),void 0===t.searchBar&&(t.searchBar=i.searchBar)),this.hasCloudSync()&&(e.cloudUserId=null===(n=this.getUserProfile())||void 0===n?void 0:n.id),p.newProjectAsync().then((()=>e.backupRef?s.restoreFromBackupAsync(e):Promise.resolve())).then((()=>c.loadPkgAsync(e.id))).then((()=>(this.state&&this.state.header==e||this.showPackageErrorsOnNextTypecheck(),h.setDirty(),p.newProjectAsync()))).then((()=>p.applyUpgradesAsync())).then((()=>this.loadTutorialJresCodeAsync())).then((()=>this.loadTutorialCustomTsAsync())).then((()=>this.loadTutorialTemplateCodeAsync())).then((()=>this.loadTutorialBlockConfigsAsync())).then((()=>{var n,i,r,o,a;const l=c.getEditorPkg(c.mainPkg);c.mainPkg.config.preferredEditor&&(e.editor=c.mainPkg.config.preferredEditor);let d=l.getMainFile();const h=e.editor!=pxt.BLOCKS_PROJECT_NAME&&this.settings.fileHistory.filter((t=>t.id==e.id))[0];if(h){const e=l.lookupFile(h.name);e?d=e:"ts"===c.getExtensionOfFileName(h.name)?d=l.lookupFile("this/"+d.getFileNameWithExtension("ts"))||d:"py"===c.getExtensionOfFileName(h.name)&&(d=l.lookupFile("this/"+d.getFileNameWithExtension("py"))||d)}const p=c.mainPkg.config.name;e.name=p||lf("Untitled"),!h&&e.editor&&d.getVirtualFileName(e.editor)&&(d=l.lookupFile("this/"+d.getVirtualFileName(e.editor))||d),ie.isBlocks(d)&&!d.content&&(d.content||(d=l.lookupFile("this/"+d.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME))||d));const f=null===(i=null===(n=e.tutorial)||void 0===n?void 0:n.metadata)||void 0===i?void 0:i.preferredEditor;if(f){let e="this/"+Se(f);(d=l.lookupFile(e))||(d=l.setFile(e,"\n"),c.mainPkg.config.files.push(e),c.mainPkg.saveConfig())}d.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0),this.setState({home:!1,showFiles:!!e.githubId,editorState:t,tutorialOptions:e.tutorial,header:e,projectName:e.name,currFile:d,sideDocsLoadUrl:"",debugging:!1,isMultiplayerGame:!1}),c.getEditorPkg(c.mainPkg).onupdate=()=>{this.loadHeaderAsync(e,this.state.editorState)},c.mainPkg.getCompileOptionsAsync().catch((e=>{if(e instanceof pxt.cpp.PkgConflictError){const t=e,n=e=>({label:lf("Remove {0}",e.id),class:"pink",icon:"trash",onclick:()=>{u.showLoading("removedep",lf("Removing {0}...",e.id)),c.mainEditorPkg().removeDepAsync(e.id).then((()=>this.reloadHeaderAsync())).finally((()=>u.hideLoading("removedep")))}});u.dialogAsync({hideCancel:!0,buttons:[n(t.pkg1),n(t.pkg0)],header:lf("Extensions cannot be used together"),body:lf("Extensions '{0}' and '{1}' cannot be used together, because they use incompatible settings ({2}).",t.pkg1.id,t.pkg0.id,t.settingName)})}}));const g=this.pickEditorFor(d),m=null===(o=null===(r=null==c?void 0:c.mainPkg)||void 0===r?void 0:r.config)||void 0===o?void 0:o.documentation;if(m)this.setSideDoc(m,g==this.blocksEditor);else{const t=l.lookupFile("this/README.md"),n=null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.trim();e.githubId||!n||/#{2,}\s+@autoOpen\s+false\s*/i.test(n)||this.setSideMarkdown(t.content)}return s.saveAsync(e)})).then((()=>this.loadTutorialFiltersAsync())).finally((()=>{pxt.BrowserUtils.changeHash("#editor",!0),document.getElementById("root").focus(),f.maybeReconnectAsync(!1,!0),this.editorLoaded()}))}loadTutorialFiltersAsync(){const e=c.mainEditorPkg().header;if(!e||!e.tutorial||!e.tutorial.tutorialMd)return Promise.resolve();pxt.perf.measureStart("loadTutorial loadBlockly");const t=e.tutorial,n=/notutorialinfocache=1/i.test(window.location.href);return"string"==typeof t.tutorialCode&&(t.tutorialCode=[t.tutorialCode]),this.loadBlocklyAsync().then((()=>E.getUsedBlocksAsync(t.tutorialCode,t.tutorial,t.language,n))).then((n=>{let i={};(null==n?void 0:n.usedBlocks)&&Object.keys(n.usedBlocks).length>0&&(i.filters={blocks:n.usedBlocks,defaultState:0},i.hasCategories=!(e.tutorial.metadata&&e.tutorial.metadata.flyoutOnly)),this.setState({editorState:i}),this.editor.filterToolbox(!0),t.tutorialStepInfo[e.tutorial.tutorialStep].showHint&&this.showTutorialHint()})).catch((e=>{pxt.tickEvent("tutorial.faileddecompile",{tutorial:t.tutorial}),this.setState({editorState:{filters:void 0}}),u.warningNotification(lf("Could not filter tutorial blocks, displaying full toolbox."))})).finally((()=>{pxt.perf.measureEnd("loadTutorial loadBlockly")}))}async loadTutorialBlockConfigsAsync(){var e,t,n,i,r;const s=async e=>{e.blocks=[];const t=[];try{const n=(await p.decompileBlocksSnippetAsync(e.md,void 0,{snippetMode:!0,generateSourceMap:!1})).outfiles[pxt.MAIN_BLOCKS];pxt.debug(`decompiled ${e.md} to ${n}`),(()=>{const e=o.utils.xml.textToDom(n),i=Array.from(e.children);for(const e of i)"block"===e.nodeName&&t.push(e)})(),(()=>{for(const e of t){const n=Array.from(e.children);for(const i of n)if("next"===i.nodeName){for(const e of Array.from(i.children))t.push(e);e.removeChild(i)}}})()}catch(t){console.error(`Failed to resolve blockconfig for tutorial: ${a.tutorial.tutorialName}, ${t.message}. md:${e.md}`)}for(const n of t)try{const t={},i=n.getAttribute("type");switch(i){case"typescript_statement":throw new Error("Block config decompiled to gray block: "+o.Xml.domToText(n));case"variables_set":case"variables_change":{const e=Array.from(n.children).find((e=>"value"===e.tagName)),i=Array.from(e.children).find((e=>"block"===e.tagName));t.blockId=i.getAttribute("type");break}default:t.blockId=i}t.xml=o.Xml.domToText(n).replace(/^<xml[^>]*>\n*/i,"").replace(/\n*<\/xml>\n*$/i,""),e.blocks.push(t)}catch(e){console.error(`Failed to resolve blockconfig for tutorial: ${a.tutorial.tutorialName}. ${e.message}`)}},a=c.mainEditorPkg().header;if(!a||!a.tutorial||!a.tutorial.tutorialStepInfo)return;if(null===(t=null===(e=a.tutorial.globalBlockConfig)||void 0===e?void 0:e.blocks)||void 0===t?void 0:t.length)return;const l=a.tutorial.tutorialStepInfo;for(const e of l)if(null===(i=null===(n=e.localBlockConfig)||void 0===n?void 0:n.blocks)||void 0===i?void 0:i.length)return;const u=[];(null===(r=a.tutorial.globalBlockConfig)||void 0===r?void 0:r.md)&&u.push(s(a.tutorial.globalBlockConfig)),l.map((e=>e.localBlockConfig)).filter((e=>null==e?void 0:e.md)).forEach((e=>u.push(s(e)))),await Promise.all(u)}async loadTutorialTemplateCodeAsync(){var e;const t=c.mainEditorPkg().header;if(!t||!t.tutorial||!t.tutorial.templateCode||t.tutorial.templateLoaded)return;const n=t.tutorial.templateCode;t.tutorial.templateLoaded=!0;let i=await s.getTextAsync(t.id);const r=null===(e=t.tutorial.metadata)||void 0===e?void 0:e.preferredEditor;r&&Se(r)===pxt.ASSETS_FILE&&(i[pxt.MAIN_TS]=n);const o=function(e){switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return pxt.JAVASCRIPT_PROJECT_NAME;case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return pxt.PYTHON_PROJECT_NAME;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return pxt.BLOCKS_PROJECT_NAME}}(r||t.editor);if(o===pxt.JAVASCRIPT_PROJECT_NAME)i[pxt.MAIN_TS]=n;else if(o===pxt.PYTHON_PROJECT_NAME){const e=await p.decompilePythonSnippetAsync(n);e&&(i[pxt.MAIN_PY]=e)}else{const e=(await p.decompileBlocksSnippetAsync(n)).outfiles[pxt.MAIN_BLOCKS];e&&(i[pxt.MAIN_BLOCKS]=e)}let a=i;if(t.tutorial.mergeHeaderId){const e=s.getHeader(t.tutorial.mergeHeaderId);if(e){const n=await s.getTextAsync(e.id);a=(0,ae.mergeProjectCode)(n,i,!!t.tutorial.mergeCarryoverCode)}}let l,u,d=!1;for(const e of Object.keys(a))void 0!==a[e]&&(c.mainEditorPkg().setFile(e,a[e]),c.mainPkg.config.files.indexOf(e)<0&&(d=!0,c.mainPkg.config.files.push(e)));d&&c.mainPkg.saveConfig(),await s.saveAsync(t);try{l=a[pxt.TILEMAP_JRES]?JSON.parse(a[pxt.TILEMAP_JRES]):null,u=a[pxt.IMAGES_JRES]?JSON.parse(a[pxt.IMAGES_JRES]):null}catch(e){return Promise.reject(e)}const h=pxt.react.getTilemapProject();l&&h.loadTilemapJRes(pxt.inflateJRes(l),!0),u&&h.loadAssetsJRes(pxt.inflateJRes(u)),await c.mainEditorPkg().buildAssetsAsync(),await c.mainEditorPkg().saveFilesAsync()}loadTutorialJresCodeAsync(){var e,t;const n=c.mainEditorPkg().header;if(!n||!n.tutorial||!n.tutorial.jres&&!n.tutorial.assetFiles)return Promise.resolve();const i=n.tutorial.jres||(null===(e=n.tutorial.assetFiles)||void 0===e?void 0:e[pxt.TILEMAP_JRES]),r=null===(t=n.tutorial.assetFiles)||void 0===t?void 0:t[pxt.IMAGES_JRES];let o,s;delete n.tutorial.jres,delete n.tutorial.assetFiles;try{o=i?JSON.parse(i):null,s=r?JSON.parse(r):null}catch(e){return Promise.reject(e)}const a=pxt.react.getTilemapProject();return o&&a.loadTilemapJRes(pxt.inflateJRes(o),!0),s&&a.loadAssetsJRes(pxt.inflateJRes(s)),c.mainEditorPkg().buildAssetsAsync()}async loadTutorialCustomTsAsync(){const e=c.mainEditorPkg(),t=e.header;if(!t||!t.tutorial||!t.tutorial.customTs)return Promise.resolve();const n=t.tutorial.customTs;return await e.setContentAsync(pxt.TUTORIAL_CUSTOM_TS,n),await e.saveFilesAsync(),Promise.resolve()}async resetTutorialTemplateCode(e){var t;const n=c.mainEditorPkg(),i=n.header;if(null===(t=null==i?void 0:i.tutorial)||void 0===t?void 0:t.templateCode){if(e){let e=await s.getTextAsync(i.id);const t=(0,ae.appendTemporaryAssets)(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]);c.mainEditorPkg().setFile(pxt.IMAGES_JRES,t),await n.saveFilesAsync()}i.tutorial.templateLoaded=!1,delete i.tutorial.mergeHeaderId,await this.reloadHeaderAsync()}}removeProject(){c.mainEditorPkg().header&&u.confirmDelete(c.mainEditorPkg().header.name,(()=>{let e=c.mainEditorPkg().header;return e.isDeleted=!0,s.forceSaveAsync(e,{}).then((()=>this.openHome()))}))}isHexFile(e){return/\.(hex|uf2)$/i.test(e)}isBlocksFile(e){return/\.blocks$/i.test(e)}isTypescriptFile(e){return/\.ts$/i.test(e)}isPythonFile(e){return/\.py$/i.test(e)}isProjectFile(e){return/\.(pxt|mkcd|mkcd-\w+)$/i.test(e)}isPNGFile(e){return pxt.appTarget.compile.saveAsPNG&&/\.png$/i.test(e)}isAssetFile(e){let t=pxt.appTarget.runtime?pxt.appTarget.runtime.assetExtensions:null;if(t){let n=e.replace(/.*\./,"").toLowerCase();return t.indexOf(n)>=0}return!1}isZipFile(e){return/\.zip$/i.test(e)}importProjectCoreAsync(e,t){return(e[0]=="{".charCodeAt(0)?Promise.resolve(pxt.U.uint8ArrayToString(e)):pxt.lzmaDecompressAsync(e)).then((e=>{let n=JSON.parse(e);if(n.target&&n.target==pxt.appTarget.id)n.xml.forEach((e=>{let t=pxt.Util.htmlUnescape(e.replace(/^"|"$/g,""));ne.loadBlocksXml(this.blocksEditor.editor,t)}));else{let e=n;this.importHex(e,t)}})).catch((e=>{u.warningNotification(lf("Sorry, we could not import this project or block snippet.")),this.openHome()}))}importHexFile(e,t){e&&pxt.cpp.unpackSourceFromHexFileAsync(e).then((e=>this.importHex(e,t))).catch((e=>{pxt.reportException(e),u.warningNotification(lf("Sorry, we could not recognize this file."))}))}importBlocksFiles(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:t,[pxt.MAIN_TS]:"  "},name:e.name.replace(/\.blocks$/i,"")||lf("Untitled")})}))}importTypescriptFile(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:"",[pxt.MAIN_TS]:t||"  "},name:e.name.replace(/\.ts$/i,"")||lf("Untitled")})}))}importProjectFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>this.importProjectCoreAsync(e,t)))}importPNGFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(e))))).then((e=>this.importProjectCoreAsync(e,t)))}async importZipFileAsync(e,t){if(!e)return;pxt.tickEvent("import.zip"),await O.loadZipAsync();const n=new zip.ZipReader(new zip.BlobReader(e)),r=(await n.getEntries()).filter((e=>this.isProjectFile(e.filename)));let o={done:0};if(0===r.length)return void u.warningNotification(lf("No projects available to import found inside zip file."));if(!await u.confirmAsync({header:lf("Import zip file?"),body:lf("Do you want to import all projects in this zip file? This will import {0} projects.",r.length),agreeLbl:lf("Okay"),hasCloseIcon:!0}))return;let a=!1;u.dialogAsync({header:lf("Extracting files..."),jsxd:()=>(0,i.jsx)(w.ProgressBar,{percentage:o.done/r.length*100}),onClose:()=>a=!0});for(const t of r){try{const e=await t.getData(new zip.Uint8ArrayWriter),n=JSON.parse(await pxt.lzmaDecompressAsync(e));let i={target:pxt.appTarget.id,targetVersion:n.meta.targetVersions?n.meta.targetVersions.target:void 0,editor:n.meta.editor,name:n.meta.name,meta:{},pubId:"",pubCurrent:!1};const r=JSON.parse(n.source);await s.installAsync(i,r)}catch(e){}if(a)break;o.done++,u.forceUpdate()}u.hideDialog()}importPNGBuffer(e){pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(new Uint8Array(e)))).then((e=>this.importProjectCoreAsync(e)))}importAssetFile(e){ts.pxtc.Util.fileReadAsBufferAsync(e).then((t=>{let n=e.name.replace(/.*[\/\\]/,"");return c.mainEditorPkg().saveAssetAsync(n,t)}))}importHex(e,t){if(!e||!e.meta){if(!e||!e[pxt.CONFIG_NAME])return u.warningNotification(lf("Sorry, we could not recognize this file.")),void(t&&t.openHomeIfFailed&&this.openHome());e=a.reconstructMeta(e)}if("object"==typeof e.source&&(e.source=JSON.stringify(e.source)),this.hexFileImporters.some((t=>"default"==t.id&&t.canImport(e)))){const n=this.tryCheckTargetVersionAsync(e.meta.targetVersions&&e.meta.targetVersions.target);if(n)return void n.then((()=>{t&&t.openHomeIfFailed&&this.newProject()}))}if(t&&t.extension){if(pxt.tickEvent("import.extension"),ts.pxtc.Util.jsonTryParse(e.source)){const t=e.meta.name,n=`${e.meta.name}.json`,i=c.mainEditorPkg();i&&(pxt.debug(`adding ${n} to package`),i.setContentAsync(n,e.source).then((()=>i.updateConfigAsync((e=>{e.dependencies||(e.dependencies={}),e.dependencies[t]=`pkg:${n}`})))).then((()=>this.reloadHeaderAsync())))}return}const n=this.hexFileImporters.filter((t=>t.canImport(e)))[0];n?(pxt.tickEvent("import",{id:n.id}),u.hideDialog(),u.showLoading("importhex",lf("loading project...")),ie.initEditorExtensionsAsync().then((()=>n.importAsync(this,e).then((()=>u.hideLoading("importhex")),(e=>{pxt.reportException(e,{importer:n.id}),u.hideLoading("importhex"),u.errorNotification(lf("Oops, something went wrong when importing your project")),t&&t.openHomeIfFailed&&this.openHome()}))))):(u.warningNotification(lf("Sorry, we could not import this project.")),pxt.tickEvent("warning.importfailed"),t&&t.openHomeIfFailed&&this.openHome())}async importProjectAsync(e,t){this.pendingImport&&this.pendingImport.reject("concurrent import requests"),this.pendingImport=pxt.Util.defer();try{await Promise.all([this.installAndLoadProjectAsync(e,t),this.pendingImport.promise])}finally{this.pendingImport=void 0}}async installAndLoadProjectAsync(e,t){let n=e.header;n||(n={target:pxt.appTarget.id,targetVersion:void 0,editor:pxt.BLOCKS_PROJECT_NAME,name:lf("Untitled"),meta:{},pubId:"",pubCurrent:!1});const i=await s.installAsync(n,e.text);await this.loadHeaderAsync(i,t)}importTutorialAsync(e){try{const{options:t,editor:n}=pxt.tutorial.getTutorialOptions(e,"untitled","untitled","",!1),i=pxt.gallery.parsePackagesFromMarkdown(e);return this.hintManager.clearViewedHints(),this.createProjectAsync({name:"untitled",tutorial:t,preferredEditor:n,dependencies:i})}catch(e){return oe.userError(lf("Could not import tutorial")),Promise.reject(e)}}async importSkillmapProjectAsync(e){const t=new pxt.skillmap.IndexedDBWorkspace;await t.initAsync();const n=await t.getProjectAsync(e);if(n&&!n.deleted)return n.header.tutorial&&(n.header.tutorialCompleted={id:n.header.tutorial.tutorial,steps:n.header.tutorial.tutorialStepInfo.length},delete n.header.tutorial),this.installAndLoadProjectAsync(n);const i=s.getHeader(e);if(!i)return void oe.userError(lf("Unable to import skillmap project"));const r=await s.duplicateAsync(i);r.tutorial&&(r.tutorialCompleted={id:r.tutorial.tutorial,steps:r.tutorial.tutorialStepInfo.length},delete r.tutorial),r.isSkillmapProject=!1,await s.saveAsync(r),l.invalidate("headers:"),await this.loadHeaderAsync(r)}openProjectByHeaderIdAsync(e){const t=s.getHeader(e);return this.loadHeaderAsync(t)}initDragAndDrop(){J.setupDragAndDrop(document.body,(e=>e.size<1e6&&this.isHexFile(e.name)||this.isBlocksFile(e.name)||this.isZipFile(e.name)),(e=>{e&&(pxt.tickEvent("dragandrop.open"),this.importFile(e[0]))}),(e=>{this.isPNGFile(e)&&pxt.Util.httpRequestCoreAsync({url:e,method:"GET",responseArrayBuffer:!0}).then((t=>this.importUri(e,t.buffer))).catch((e=>u.handleNetworkError(e)))}))}importUri(e,t){this.isPNGFile(e)&&this.importPNGBuffer(t)}importFile(e,t){if(e&&!pxt.shell.isReadOnly())if(this.isHexFile(e.name))this.importHexFile(e,t);else if(this.isBlocksFile(e.name))this.importBlocksFiles(e,t);else if(this.isTypescriptFile(e.name))this.importTypescriptFile(e,t);else if(this.isProjectFile(e.name))this.importProjectFile(e,t);else if(this.isAssetFile(e.name))this.importAssetFile(e);else if(this.isPNGFile(e.name))this.importPNGFile(e,t);else if(this.isZipFile(e.name))this.importZipFileAsync(e,t);else{const t=this.resourceImporters.filter((t=>t.canImport(e)))[0];t?t.importAsync(this,e):u.warningNotification(lf("Oops, don't know how to load this file!"))}}importProjectFromFileAsync(e,t){return pxt.lzmaDecompressAsync(e).then((e=>{let n=JSON.parse(e);return this.importHex(n,t)})).catch((()=>this.newProject()))}syncPreferredEditor(){const e=this.getPreferredEditor();e&&c.mainPkg.setPreferredEditor(e)}exportProjectToFileAsync(){return this.syncPreferredEditor(),c.mainPkg.compressToFileAsync()}exportAsync(){return pxt.debug("exporting project"),this.exportProjectToFileAsync().then((e=>ts.pxtc.encodeBase64(oe.uint8ArrayToString(e))))}downloadScreenshotAsync(){return pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!1):this.requestScreenshotAsync().then((e=>pxt.BrowserUtils.browserDownloadDataUri(e,c.genFileName(".png"))))}requestScreenshotAsync(){return this.requestScreenshotPromise?this.requestScreenshotPromise:(this.setState({screenshoting:!0}),h.driver.postMessage({type:"screenshot"}),oe.promiseTimeout(1e3,this.requestScreenshotPromise=new Promise(((e,t)=>{this.pushScreenshotHandler((t=>e(pxt.BrowserUtils.imageDataToPNG(t.data,3))))}))).catch((e=>{pxt.tickEvent("screenshot.timeout")})).finally((()=>{this.popScreenshotHandler(),this.requestScreenshotPromise=void 0,this.setState({screenshoting:!1})})))}encodeProjectAsPNGAsync(e,t){return this.exportProjectToFileAsync().then((t=>m.encodeBlobAsync(this.state.header.name,e,t))).then((e=>{const n=c.genFileName(".png");return pxt.BrowserUtils.browserDownloadDataUri(e,n),t?u.dialogAsync({header:lf("Project Saved!"),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1,jsx:(0,i.jsx)("div",Object.assign({className:"ui items"},{children:(0,i.jsxs)("div",Object.assign({className:"item"},{children:[(0,i.jsx)("div",Object.assign({className:"ui small image"},{children:(0,i.jsx)("a",Object.assign({download:n,className:"ui link",href:e},{children:(0,i.jsx)("img",{src:e,alt:lf("Project cartridge"),title:lf("Click to download again")})}))})),(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)("div",Object.assign({className:"description"},{children:(0,i.jsxs)("p",{children:[lf("Your project is saved in this image."),(0,i.jsx)("br",{}),lf("Import or drag it into the editor to reload it.")]})}))}))]}))}))}):Promise.resolve()}))}saveProjectAsPNGAsync(e){return this.requestScreenshotAsync().then((t=>this.encodeProjectAsPNGAsync(t,e)))}saveProjectToFileAsync(){const e=c.mainPkg;return we()?(pxt.BrowserUtils.browserDownloadText(e.readFile(pxt.MAIN_BLOCKS),c.genFileName(".blocks"),{contentType:"application/xml"}),Promise.resolve()):ke()?this.saveTutorialTemplateAsync():pxt.commands.saveProjectAsync?(u.infoNotification(lf("Saving...")),this.syncPreferredEditor(),e.saveToJsonAsync().then((e=>pxt.commands.saveProjectAsync(e)))):pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!0):this.exportProjectToFileAsync().then((e=>{const t=c.genFileName(".mkcd");pxt.BrowserUtils.browserDownloadUInt8Array(e,t,{contentType:"application/octet-stream"})}))}openHome(){!pxt.shell.isControllerMode()&&!pxt.appTarget.appTheme.lockedEditor&&this.unloadProjectAsync(!0)}homeLoaded(){pxt.tickEvent("app.home")}editorLoaded(){pxt.tickEvent("app.editor")}unloadProjectAsync(e){return this.stopSimulator(!0),this.showKeymap(!1),f.disconnectAsync(),this.editor&&this.editor.unloadFileAsync(),this.extensions.unload(),this.editorFile=void 0,e&&pxt.BrowserUtils.changeHash("",!0),this.setStateAsync({home:void 0!==e?e:this.state.home,tracing:void 0,fullscreen:void 0,tutorialOptions:void 0,editorState:void 0,debugging:void 0,header:void 0,currFile:void 0,fileState:void 0}).then((()=>(this.allEditors.forEach((e=>e.setVisible(!1))),e&&(this.homeLoaded(),this.showPackageErrorsOnNextTypecheck()),s.syncAsync()))).then((()=>{}))}reloadEditor(){var e,t;try{if(window.removeEventListener("hashchange",xe),he&&(pxt.BrowserUtils.isIFrame()&&("pub"===he.cmd||"sandbox"===he.cmd)||"tutorial"==he.cmd)?location.hash=`#${he.cmd}:${he.arg}`:(null===(e=this.state)||void 0===e?void 0:e.home)?location.hash="#reload":(null===(t=this.state)||void 0===t?void 0:t.header)&&!this.state.header.isDeleted&&(location.hash="#editor"),pxt.BrowserUtils.isIFrame()&&!pxt.BrowserUtils.getCookieLang()){const e=pxt.Util.userLanguage(),t=new URLSearchParams(location.search);t.set("lang",e);const n=!!t.get("hc"),i=!!u.getHighContrastOnce();i!=n&&(i?t.set("hc","1"):t.delete("hc")),location.search=t.toString(),location.assign(location.toString())}else location.reload()}catch(e){pxt.reportException(e),location.reload()}}getPreferredEditor(){if(this.editor==this.blocksEditor)return pxt.BLOCKS_PROJECT_NAME;if(this.editor==this.textEditor)switch(this.textEditor.fileType){case"python":return pxt.PYTHON_PROJECT_NAME;default:return pxt.JAVASCRIPT_PROJECT_NAME}}openExtension(e,t){pxt.tickEvent("app.openextension",{extension:e}),this.extensions.showExtensionAsync(e,t)}handleExtensionRequest(e){this.extensions.handleExtensionRequest(e)}newEmptyProject(e,t,n){this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},name:e,documentation:t,preferredEditor:n,filters:{}})}newProject(e={}){return pxt.tickEvent("app.newproject"),u.showLoading("newproject",lf("creating new project...")),this.createProjectAsync(e).then((()=>this.autoChooseBoardAsync())).then((()=>oe.delay(500))).finally((()=>{var t,n;u.hideLoading("newproject"),(null==e?void 0:e.firstProject)&&(null===(n=null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.tours)||void 0===n?void 0:n.editor)&&this.showOnboarding()}))}async createProjectAsync(e){var t,n,i;pxt.perf.measureStart("createProjectAsync"),this.setSideDoc(void 0),e.prj||(e.prj=pxt.appTarget.blocksprj);let r=pxt.U.clone(e.prj.config);r.name=e.name||lf("Untitled"),r.documentation=e.documentation;let o=oe.clone(e.prj.files);if(e.filesOverride&&(oe.jsonCopyFrom(o,e.filesOverride),Object.keys(e.filesOverride).forEach((e=>{-1===r.files.indexOf(e)&&r.files.push(e)}))),e.dependencies&&oe.jsonMergeFrom(r.dependencies,e.dependencies),e.extensionUnderTest){const t=s.getHeader(e.extensionUnderTest);t&&(r.dependencies[t.name]=`workspace:${t.id}`)}if(e.tsOnly&&(e.languageRestriction="no-blocks"),e.preferredEditor&&(r.preferredEditor=e.preferredEditor),e.simTheme||(null===(t=e.tutorial)||void 0===t?void 0:t.simTheme)){const t=e.simTheme||(null===(n=e.tutorial)||void 0===n?void 0:n.simTheme);t.theme&&(r.theme=t.theme),t.palette&&(r.palette=t.palette)}if(e.languageRestriction){let t=/\.(blocks)$/;"javascript-only"===e.languageRestriction?(t=/\.(py|blocks)$/,r.preferredEditor=pxt.JAVASCRIPT_PROJECT_NAME):"python-only"===e.languageRestriction&&(r.preferredEditor=pxt.PYTHON_PROJECT_NAME),r.languageRestriction=e.languageRestriction,r.files=r.files.filter((e=>!t.test(e))),delete o[pxt.MAIN_BLOCKS]}r.preferredEditor==pxt.PYTHON_PROJECT_NAME&&r.files.indexOf(pxt.MAIN_PY)<0&&(r.files.push(pxt.MAIN_PY),o[pxt.MAIN_PY]||(o[pxt.MAIN_PY]="\n")),e.tutorial&&e.tutorial.metadata&&(e.tutorial.metadata.codeStart&&(o[pxt.TUTORIAL_CODE_START]=`control._onCodeStart('${pxt.U.htmlEscape(e.tutorial.metadata.codeStart)}')`,r.files.splice(r.files.indexOf(pxt.MAIN_TS),0,pxt.TUTORIAL_CODE_START)),e.tutorial.metadata.codeStop&&(o[pxt.TUTORIAL_CODE_STOP]=`control._onCodeStop('${pxt.U.htmlEscape(e.tutorial.metadata.codeStop)}')`,r.files.push(pxt.TUTORIAL_CODE_STOP))),o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(r),await pxt.github.cacheProjectDependenciesAsync(r);const a=await s.installAsync({name:r.name,meta:{},editor:e.preferredEditor||e.prj.id,pubId:"",pubCurrent:!1,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,cloudUserId:null===(i=this.getUserProfile())||void 0===i?void 0:i.id,temporary:e.temporary,tutorial:e.tutorial,extensionUnderTest:e.extensionUnderTest,isSkillmapProject:e.skillmapProject},o);await this.loadHeaderAsync(a,{filters:e.filters}),pxt.perf.measureEnd("createProjectAsync")}autoChooseBoardAsync(e){return pxt.appTarget.appTheme.chooseBoardOnNewProject&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition?this.showBoardDialogAsync(e,!1):Promise.resolve()}importExampleAsync(e){const{name:t,path:n,loadBlocks:i,prj:r,preferredEditor:o}=e;return u.showLoading("changingcode",lf("loading...")),this.loadingExample=!0,this.loadActivityFromMarkdownAsync(n,t.toLowerCase(),o).then((e=>{const{filename:t,md:n,features:s,autoChooseBoard:a}=e||{},l=!r&&a,c=!!n&&pxt.gallery.parseExampleMarkdown(t,n);if(!c)throw new Error(lf("Example not found or invalid format"));const u=c;return r&&(u.prj=r),i&&o==pxt.BLOCKS_PROJECT_NAME?this.createProjectAsync(u).then((()=>this.loadBlocklyAsync().then(p.getBlocksAsync).then((e=>p.decompileAsync(pxt.MAIN_TS,e))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideBlocksFile(e.outfiles[pxt.MAIN_BLOCKS])})).then((()=>l&&this.autoChooseBoardAsync(s))))):(i||(u.languageRestriction="no-blocks"),u.preferredEditor=o,this.createProjectAsync(u).then((()=>o==pxt.PYTHON_PROJECT_NAME&&"python"!==c.snippetType?p.getApisInfoAsync().then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideTypescriptFile(e.outfiles[pxt.MAIN_PY])})).then((()=>l&&this.autoChooseBoardAsync(s))):Promise.resolve())))})).catch((e=>(u.warningNotification(lf("Please check your internet connection and check the example is valid.")),pxt.reportException(e),Promise.reject(e)))).finally((()=>{this.loadingExample=!1,u.hideLoading("changingcode")}))}switchTypeScript(){const e=c.mainEditorPkg(),t=this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),n=e.files[t];this.setFile(n)}saveBlocksToTypeScriptAsync(){return this.blocksEditor.saveToTypeScriptAsync()}saveVirtualFileAsync(e,t,n){const i=this.editorFile.getVirtualFileName(e);return this.saveVirtualFileAsyncInternal(e,t,n,i)}saveVirtualMainFileAsync(e,t,n){const i=this.getMainFileName(e);return this.saveVirtualFileAsyncInternal(e,t,n,i)}saveVirtualFileAsyncInternal(e,t,n,i){t=t||"\n";const r=c.mainEditorPkg();return oe.assert(i&&i!=this.editorFile.name),r.setContentAsync(i,t).then((()=>{if(n){let e=r.files[i];this.setFile(e)}}))}getMainFileName(e){switch(e){case pxt.PYTHON_PROJECT_NAME:return pxt.MAIN_PY;case pxt.JAVASCRIPT_PROJECT_NAME:return pxt.MAIN_TS;case pxt.BLOCKS_PROJECT_NAME:return pxt.MAIN_BLOCKS;default:return void oe.assert(!1,`Unrecognized project type ${e}`)}}saveTypeScriptAsync(e=!1){const t=c.mainEditorPkg();if(!this.editor||!this.state.currFile||this.editorFile.epkg!=t||this.reload)return Promise.resolve();const n=this.editorFile.getExtension(),i=this.editorFile.content;let r=e?this.textEditor.loadMonacoAsync():Promise.resolve();return"py"==n&&(r=r.then((()=>this.saveCurrentSourceAsync()))),r=r.then((()=>{if(e){this.openingTypeScript=!0;const e=t.getCachedTranspile(n,i,"ts");return e?Promise.resolve(e):this.editor.saveToTypeScriptAsync(!0).then((e=>(void 0!==e&&t.cacheTranspile(n,i,"ts",e),e)))}return this.editor.saveToTypeScriptAsync()})).then((t=>void 0===t&&e?u.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to JavaScript."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((e=>{this.isPythonActive()&&pxt.shell.setEditorLanguagePref("py")})):void 0===t||this.editorFile&&this.editorFile.name==this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?Promise.resolve():this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?this.saveVirtualFileAsync(pxt.JAVASCRIPT_PROJECT_NAME,t,e):Promise.resolve())),e?u.showLoadingAsync("switchtojs",lf("switching to JavaScript..."),r,0):r}resetWorkspace(){return this.reload=!0,window.location.hash="#reload",s.resetAsync().then((()=>this.reloadEditor()),(()=>this.reloadEditor()))}pairAsync(){return f.pairAsync()}saveAndCompile(){if(this.state.header)return this.setState({isSaving:!0}),(this.state.projectName!==lf("Untitled")?Promise.resolve(!0):this.showRenameProjectDialogAsync()).then((e=>e?this.saveProjectNameAsync().then((()=>this.saveFileAsync())).then((()=>{!pxt.appTarget.compile.hasHex||pxt.appTarget.compile.useMkcd||pxt.appTarget.compile.saveAsPNG||we()||ke()?this.saveProjectToFileAsync().finally((()=>{this.setState({isSaving:!1})})):this.compile(!0)})):(this.setState({isSaving:!1}),Promise.resolve())))}checkForHwVariant(){if(pxt.hwVariant||!pxt.hasHwVariants())return!1;const e=pxt.getHwVariants();if(0==e.length)return!1;return pxt.usb.isEnabled&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.checkForHwVariantWebUSB&&this.checkWebUSBVariant?(pxt.packetio.initAsync(!0).then((t=>{if(t.familyID)for(let n of e){let e=pxt.U.clone(pxt.appTarget.compile);if(n.compileServiceVariant){let t=pxt.appTarget.variants[n.compileServiceVariant];t.compile&&pxt.U.jsonCopyFrom(e,t.compile)}if(parseInt(e.uf2Family)===t.familyID)return pxt.setHwVariant(n.name),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"HID-"+pxt.hwVariant}),void this.reloadHeaderAsync().then((()=>this.compile()))}this.checkWebUSBVariant=!1,this.checkForHwVariant()}),(()=>f.pairAsync().then((()=>{this.checkForHwVariant()}),(e=>{this.checkWebUSBVariant=!1,this.checkForHwVariant()})))).then((()=>{pxt.perf.recordMilestone("HID bridge init finished")})),!0):(this.showChooseHwDialog(),!0)}beforeCompile(){}async compile(e=!1){if(pxt.tickEvent("compile",{editor:this.getPreferredEditor()}),pxt.debug("compiling..."),this.checkForHwVariant())return;if(pxt.appTarget.compile.saveAsPNG&&pxt.hasHwVariants()&&!pxt.hwVariant)return void this.saveAndCompile();let t;if(this.beforeCompile(),pxt.appTarget.compile.useModulator||!pxt.BrowserUtils.isBrowserDownloadInSameWindow()||pxt.BrowserUtils.isBrowserDownloadWithinUserContext()||(t=window.open("")),this.state.compiling)return void pxt.tickEvent("compile.double");let n=0!=this.state.simState;n&&1==this.state.simState&&pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor()&&(n=!1);try{this.setState({compiling:!0,cancelledDownload:!1}),this.clearSerial(),this.editor.beforeCompile(),n&&this.stopSimulator();let i=this.editor.snapshotState();this.syncPreferredEditor();try{const r=await p.compileAsync({native:!0,forceEmit:!0});if(!(this.editor.setDiagnostics(this.editorFile,i),r.usedParts&&-1!==r.usedParts.indexOf("multiplayer")?this.setState({isMultiplayerGame:!0}):this.setState({isMultiplayerGame:!1}),e||await f.showUnsupportedHardwareMessageAsync(r)))return void this.setState({cancelledDownload:!0});let o=pxt.outputName();if(!r.outfiles[o]){pxt.tickEvent("compile.noemit");const t=r.diagnostics.find((e=>9043===e.code))||1==r.diagnostics.length?r.diagnostics[0]:void 0;if(9283===(null==t?void 0:t.code)&&pxt.commands.showProgramTooLargeErrorAsync){pxt.tickEvent("compile.programTooLargeDialog");const t=await pxt.commands.showProgramTooLargeErrorAsync(pxt.appTarget.multiVariants,u.confirmAsync,e);if(null==t?void 0:t.recompile){pxt.tickEvent("compile.programTooLargeDialog.recompile");const n=pxt.appTarget.multiVariants;this.setState({compiling:!1,isSaving:!1});try{return pxt.appTarget.multiVariants=t.useVariants,void await this.compile(e)}finally{pxt.appTarget.multiVariants=n}}else pxt.tickEvent("compile.programTooLargeDialog.cancelled")}return void(t?u.warningNotification(t.messageText):u.warningNotification(lf("Compilation failed, please check your code for errors.")))}r.saveOnly=e,r.userContextWindow=t,r.downloadFileBaseName=c.genFileName(""),r.confirmAsync=u.confirmAsync;let s=this.state.header;if(s&&(r.headerId=s.id),pxt.commands.patchCompileResultAsync&&await pxt.commands.patchCompileResultAsync(r),e)return void await pxt.commands.saveOnlyAsync(r);r.success||this.maybeShowPackageErrors(!0)||u.confirmAsync({header:lf("Compilation failed"),body:lf("Ooops, looks like there are errors in your program."),hideAgree:!0,disagreeLbl:lf("Close")}),n&&(this.runSimulator(),n=!1);let a=Date.now();pxt.tickEvent("deploy.start");try{this._deploying=!0,await pxt.commands.deployAsync(r,{reportError:e=>{pxt.tickEvent("deploy.reporterror"),u.errorNotification(e)},showNotification:e=>u.infoNotification(e)});let e=Date.now()-a;pxt.tickEvent("deploy.finished",{elapsedMs:e})}catch(e){if(e.notifyUser)u.warningNotification(e.message);else{const e=pxt.appTarget.appTheme.useUploadMessage?lf("Upload failed, please try again."):lf("Download failed, please try again.");u.warningNotification(e)}let n=Date.now()-a;if(pxt.tickEvent("deploy.exception",{notifyUser:e.notifyUser,elapsedMs:n}),pxt.reportException(e),t)try{t.close()}catch(e){}}finally{this._deploying=!1,pxt.BrowserUtils.isDocumentVisible()||(pxt.debug("visibility: updated after deploy"),await this.updateVisibilityAsync())}}catch(e){if(pxt.reportException(e),u.errorNotification(lf("Compilation failed, please contact support.")),t)try{t.close()}catch(e){}}finally{this.setState({compiling:!1,isSaving:!1}),n&&this.runSimulator()}}catch(e){this.setState({compiling:!1,isSaving:!1}),pxt.reportException(e),u.errorNotification(lf("Compilation failed, please try again."))}}overrideTypescriptFile(e){this.textEditor&&this.textEditor.overrideFile(e)}overrideBlocksFile(e){this.blocksEditor&&this.blocksEditor.overrideFile(e)}async setLanguageRestrictionAsync(e){if(this.state.header){const t=c.mainEditorPkg(),n=t.files["pxt.json"],i=pxt.Package.parseAndValidConfig(null==n?void 0:n.content);if(i){let r;switch(i.languageRestriction=e,await n.setContentAsync(JSON.stringify(i,null,4)),e){case"blocks-only":case"no-javascript":case"":r=[];break;case"javascript-only":r=[pxt.MAIN_BLOCKS,pxt.MAIN_PY];break;case"python-only":case"no-blocks":r=[pxt.MAIN_BLOCKS];break;case"no-python":r=[pxt.MAIN_PY]}for(const e of r)await t.removeFileAsync(e);switch(e){case"blocks-only":case"no-javascript":case"":case"no-python":if(this.editorFile.name!==pxt.MAIN_BLOCKS)return void this.openBlocksAsync();break;case"javascript-only":case"no-blocks":if(this.editorFile.name!==pxt.MAIN_TS)return void await this.openTypeScriptAsync();break;case"python-only":if(this.editorFile.name!==pxt.MAIN_PY)return void await this.openPythonAsync()}await this.reloadHeaderAsync()}}}startStopSimulator(e){switch(this.state.simState){case 2:case 1:break;case 3:this.stopSimulator(!1,e);break;default:this.maybeShowPackageErrors(!0),this.startSimulator(e),e&&e.clickTrigger&&h.driver.focus()}}toggleTrace(e){const t=!!this.state.tracing;t?(this.editor.clearHighlightedStatements(),h.setTraceInterval(0)):h.setTraceInterval(e||h.SLOW_TRACE_INTERVAL),this.setState({tracing:!t},(()=>{this.state.debugging?this.onDebuggingStart():this.restartSimulator()}))}setTrace(e,t){!!this.state.tracing!=e?this.toggleTrace(t):this.state.tracing&&(h.setTraceInterval(t||h.SLOW_TRACE_INTERVAL),this.startSimulator())}proxySimulatorMessage(e){h.proxy({type:"custom",content:e})}toggleSimulatorCollapse(){const e=this.state;pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!e.collapseEditorTools},{interactiveConsent:!0}),0==e.simState&&e.collapseEditorTools&&!pxt.appTarget.simulator.headless&&this.startStopSimulator(),e.collapseEditorTools?this.expandSimulator():this.collapseSimulator()}expandSimulator(){pxt.appTarget.simulator.headless?h.unhide():this.startSimulator(),this.setState({collapseEditorTools:!1}),this.fireResize()}collapseSimulator(){h.hide((()=>{this.setState({collapseEditorTools:!0}),this.fireResize()}))}setSimulatorFullScreen(e){this.state.collapseEditorTools&&this.expandSimulator(),e?document.removeEventListener("keydown",this.closeOnEscape):(document.addEventListener("keydown",this.closeOnEscape),h.driver.focus()),this.closeFlyout(),this.setState({fullscreen:e})}toggleSimulatorFullscreen(){this.setSimulatorFullScreen(!this.state.fullscreen)}closeFlyout(){this.editor.closeFlyout()}toggleMute(){switch(this.state.mute){case"muted":this.setMute("unmuted");break;case"unmuted":this.setMute("muted")}}setMute(e){switch(e){case"muted":h.mute(!0);break;case"unmuted":h.mute(!1)}this.setState({mute:e})}openInstructions(){const e=0!=this.state.simState;e&&this.stopSimulator(),D.makeAsync().finally((()=>{e&&this.startSimulator()}))}printCode(){if(!this.state.header)return;const e=c.mainEditorPkg().getAllFiles(),t=pxt.webConfig.docsUrl||"/--docs",n=de.isBlocksActive()?"blocks":de.isPythonActive()?"python":"typescript";window.localStorage.printjob=JSON.stringify(e);const r=`${t}#print:job:${n}:${pxt.Util.localeInfo()}`;u.dialogAsync({header:lf("Print Code"),hasCloseIcon:!0,size:"large",jsx:(0,i.jsx)("div",Object.assign({className:"ui container"},{children:(0,i.jsx)("div",Object.assign({id:"printcontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},{children:(0,i.jsx)("iframe",{frameBorder:"0","aria-label":lf("Print preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:r})}))}))}).then((e=>{}))}clearSerial(){var e,t;this.serialEditor.clear(),null===(e=this.simulatorSerialIndicator())||void 0===e||e.clear(),null===(t=this.deviceSerialIndicator())||void 0===t||t.clear(),this.setState({simSerialActive:!1,deviceSerialActive:!1})}simulatorSerialIndicator(){return this.refs.simIndicator}deviceSerialIndicator(){return this.refs.devIndicator}shouldStartSimulator(){switch(this.state.simState){case 2:case 3:return!1}return!!pxt.shell.isControllerMode()||!this.state.home}isSimulatorRunning(){return 3==this.state.simState}restartSimulator(){const e=this.state.tracing||this.state.debugging;0==this.state.simState||this.debugOptionsChanged()?this.startSimulator():h.driver.restart(),h.driver.focus(),e||this.blocksEditor.clearBreakpoints()}async startSimulator(e){pxt.tickEvent("simulator.start");const t=!this.debugOptionsChanged(),n=e&&e.clickTrigger;pxt.debug(`start sim (autorun ${this.state.autoRun})`),!this.shouldStartSimulator()&&t||this.state.home?pxt.log("Ignoring call to start simulator, either already running or we shouldn't start."):(await this.saveFileAsync(),await this.runSimulator({debug:this.state.debugging,clickTrigger:n}))}debugOptionsChanged(){const{debugging:e,tracing:t}=this.state;return!!e!=h.driver.isDebug()||!!t!=h.driver.isTracing()}stopSimulator(e,t){var n;pxt.perf.measureStart("stopSimulator"),pxt.tickEvent("simulator.stop");const i=t&&t.clickTrigger;pxt.debug(`sim: stop (autorun ${this.state.autoRun})`),this.runToken&&(this.runToken.cancel(),this.runToken=null),(this.isSimulatorRunning()||e&&(null===(n=h.driver)||void 0===n?void 0:n.state)!==pxsim.SimulatorState.Unloaded)&&h.stop(e);const r=this.state.autoRun&&!i;0===this.state.simState&&!!this.state.autoRun==!!r||this.setState({simState:0,autoRun:r}),pxt.perf.measureEnd("stopSimulator")}suspendSimulator(){pxt.tickEvent("simulator.suspend"),this.runToken&&(this.runToken.cancel(),this.runToken=null),h.suspend()}showMiniSim(e){this.setState({showMiniSim:e})}onHighContrastChanged(){this.clearSerial(),this.isSimulatorRunning()&&(this.stopSimulator(),this.startSimulator());const e=this.getData($.HIGHCONTRAST),t=document.body.classList.contains("high-contrast");e?t||document.body.classList.add("high-contrast"):t&&document.body.classList.remove("high-contrast")}onCloudStatusChanged(e){const t=this.getData(e),n=null==t?void 0:t.cloudStatus();if(n){const e={type:"pxthost",action:"projectcloudstatus",headerId:t.headerId,status:n.value};ie.postHostMessageAsync(e),ie.postHostMessageAsync(Object.assign(Object.assign({},e),{type:"pxteditor"}))}}runSimulator(e={}){const t=this.firstRun&&e.background&&pxt.appTarget.simulator&&!!pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor();this.firstRun&&pxt.BrowserUtils.isSafari()&&this.setMute("disabled"),pxt.debug(`sim: start run (autorun ${this.state.autoRun}, first ${this.firstRun})`),this.firstRun=!1,this.runToken&&this.runToken.cancel();let n=new pxt.Util.CancellationToken;return this.runToken=n,n.startOperation(),(()=>{const i=this.editor?this.editor.getId().replace(/Editor$/,""):"unknown";if(e.background){if(pxt.tickEvent("activity.autorun",{editor:i}),pxt.storage.getLocal("noAutoRun"))return Promise.resolve()}else pxt.tickEvent(e.debug?"debug":"run",{editor:i});e.background||this.editor.beforeCompile(),this.state.tracing&&this.state.debugging&&(e.trace=!0),e.debug&&(e.debugExtensionCode=pxt.appTarget.appTheme.debugExtensionCode&&!this.isBlocksActive()),this.syncPreferredEditor(),h.stop(!1,!0);const r=this.autoRunOnStart()&&this.isBlocksEditor()&&(this.state.autoRun||!!e.clickTrigger),o=this.editor.snapshotState();return this.setStateAsync({simState:2,autoRun:r}).then((()=>t?Promise.resolve(p.emptyCompileResult()):p.compileAsync(e))).then((t=>{var i,r;if(n.isCancelled())pxt.debug("sim: cancelled");else if(this.clearSerial(),this.editor.setDiagnostics(this.editorFile,o),t.usedParts&&-1!==t.usedParts.indexOf("multiplayer")?this.setState({isMultiplayerGame:!0}):this.setState({isMultiplayerGame:!1}),t.outfiles[pxtc.BINARY_JS]){if(!n.isCancelled()){pxt.debug("sim: run");const o=l.getData($.HIGHCONTRAST);(null===(r=(i=pxt.react).isFieldEditorViewVisible)||void 0===r?void 0:r.call(i))||h.run(c.mainPkg,e.debug,t,{mute:"muted"===this.state.mute,highContrast:o,light:pxt.options.light,clickTrigger:e.clickTrigger,storedState:c.mainEditorPkg().getSimState(),autoRun:this.state.autoRun},e.trace),this.blocksEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),this.textEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),n.isCancelled()?(pxt.debug("sim: cancelled 2"),h.stop(),this.setState({simState:0})):this.setState({showParts:h.driver.hasParts()})}}else e.background||(u.warningNotification(lf("Oops, we could not run this project. Please check your code for errors.")),h.stop(),this.setState({simState:0}))})).finally((()=>{n.isCancelled()||n.resolveCancel(),n=null}))})()}openNewTab(e,t){if(!e||pxt.BrowserUtils.isElectron()||pxt.BrowserUtils.isIOS())return;let n=window.location.href.replace(/#.*$/,"");t&&(n=n+(n.indexOf("?")>-1?"&":"?")+"nestededitorsim=1&lockededitor=1"),n+="#header:"+e.id;const i=window.open(n,pxt.appTarget.id+e.id);i&&(pxt.log("dependent editor window registered"),h.driver.registerDependentEditor(i))}createGitHubRepositoryAsync(){const{projectName:e,header:t}=this.state;return a.githubProvider(!0).createRepositoryAsync(e,t).then((e=>e&&this.reloadHeaderAsync()))}simDebug(){pxt.tickEvent("menu.debug.sim"),this.stopSimulator(),this.runSimulator({debug:!0})}hwDebug(){pxt.tickEvent("menu.debug.hw");let e=Promise.resolve();return 3==this.state.simState&&h.driver.isDebug()||(e=this.runSimulator({debug:!0})),e.then((()=>(h.driver.setHwDebugger({postMessage:e=>{pxt.HWDBG.handleMessage(e)}}),pxt.HWDBG.postMessage=e=>h.driver.handleHwDebuggerMsg(e),Promise.all([p.compileAsync({debug:!0,native:!0}),pxt.packetio.initAsync()]).then((e=>pxt.HWDBG.startDebugAsync(e[0],e[1]))))))}toggleDebugging(){const e=!this.state.debugging;this.setState({debugging:e,debugFirstRun:e},(()=>{this.setSimulatorFullScreen(!1),this.onDebuggingStart()}))}onDebuggingStart(){this.renderCore(),this.editor&&(this.editor.updateBreakpoints(),this.editor.updateToolbox()),this.restartSimulator()}dbgPauseResume(){h.dbgPauseResume()}dbgStepOver(){h.dbgStepOver()}dbgStepInto(){h.dbgStepInto()}dbgInsertBreakpoint(){this.editor.insertBreakpoint()}editText(){this.editor!=this.textEditor&&(this.updateEditorFileAsync(this.textEditor).then((()=>{this.textEditor.editor.focus()})),this.forceUpdate())}hasCloudSync(){return this.isLoggedIn()}showScriptManager(){this.scriptManagerDialog.show()}importProjectDialog(){this.importDialog.show()}renderPythonAsync(e){return p.decompilePythonSnippetAsync(e.ts).then((e=>({python:e})))}blocksScreenshotAsync(e,t){return ne.screenshotEnabled()&&this.blocksEditor&&this.blocksEditor.isReady&&this.blocksEditor.editor?ne.screenshotAsync(this.blocksEditor.editor,e,t):Promise.resolve(void 0)}renderBlocksAsync(e){return p.getBlocksAsync().then((t=>p.decompileBlocksSnippetAsync(e.ts,t,e))).then((t=>{const n=ne.render(t.outfiles[pxt.MAIN_BLOCKS],{snippetMode:e.snippetMode||!1,layout:void 0!==e.layout?e.layout:1,splitSvg:!1}),i=n.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return{svg:n,xml:ne.blocklyToSvgAsync(n,i[0],i[1],i[2],i[3])}}))}renderXmlInner(e,t,n){const i=e.trim().toLocaleLowerCase().startsWith("<xml")?e:`<xml xmlns="https://developers.google.com/blockly/xml">${e}</xml>`,r=ne.render(i,{snippetMode:t||!1,layout:void 0!==n?n:1,splitSvg:!1}),o=r.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return{svg:r,resultXml:ne.blocklyToSvgAsync(r,o[0],o[1],o[2],o[3])}}renderXml(e){return this.renderXmlInner(e.xml,e.snippetMode,e.layout)}async renderByBlockIdAsync(e){const t=await p.getBlocksAsync(),n=t.blocksById[e.blockId],i=t.apis.byQName[n.qName],r=pxt.blocks.compileInfo(i),o=ne.createToolboxBlock(t,i,r);return this.renderXmlInner(o.outerHTML,e.snippetMode,e.layout)}getBlocks(){if(!this.isBlocksActive())throw console.error("Trying to get blocks from a non-blocks editor."),new Error("Trying to get blocks from a non-blocks editor.");return this.blocksEditor.editor.getAllBlocks(!1)}getToolboxCategories(e){if(!this.isBlocksActive())throw console.error("Trying to get blocks info from a non-blocks editor."),new Error("Trying to get blocks info from a non-blocks editor.");return{categories:this.blocksEditor.getToolboxCategories(e).map((e=>Object.assign(Object.assign({},e),{name:e.name||e.nameid,customClick:void 0,blocks:e.blocks.map((e=>Object.assign(Object.assign({},e),{group:e.attributes.group,advanved:e.attributes.advanced,weight:e.attributes.weight,jsDoc:e.attributes.jsDoc,blockId:e.attributes.blockId})))})))}}launchFullEditor(){oe.assert(pxt.shell.isSandboxMode());let e=pxt.appTarget.appTheme.embedUrl;/\/$/.test(e)||(e+="/");const t=c.mainPkg,n=c.getEditorPkg(t);pxt.shell.isReadOnly()?(n.header.pubId,e+=`#pub:${n.header.pubId}`,window.open(e,"_blank")):this.exportAsync().then((t=>{pxt.tickEvent("sandbox.openfulleditor"),e+=`#project:${t}`,window.open(e,"_blank")}))}async anonymousPublishHeaderByIdAsync(e,t){const n=s.getHeader(e),i=await s.getTextAsync(e),r=JSON.stringify(i,null,2)+"\n";if(t&&i[pxt.CONFIG_NAME])try{const e=JSON.parse(i[pxt.CONFIG_NAME]);e.name=t,i[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(e)}catch(e){pxt.debug("Could not update config")}const o={name:t||n.name,target:n.target,targetVersion:n.targetVersion,description:lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:n.editor,text:i,meta:{versions:pxt.appTarget.versions,blocksHeight:0,blocksWidth:0}};pxt.debug(`publishing script; ${r.length} bytes`);const a=await re.privatePostAsync("scripts",o,!0);return this.getShareUrl(a.shortid||a.id,!1)}async publishAsync(e,t,n){pxt.tickEvent("menu.embed.publish",void 0,{interactiveConsent:!0}),e&&this.state.projectName!=e&&await this.updateHeaderNameAsync(e);const i=$.hasIdentity()&&this.isLoggedIn();try{const e=i&&!n,r=await this.publishCurrentHeaderAsync(e,t);return await this.getShareUrl(r,e)}catch(e){return pxt.tickEvent("menu.embed.error",{code:e.statusCode}),{url:"",embed:{},error:e}}}async getShareUrl(e,t){const n=pxt.appTarget.appTheme;let i={url:"",embed:{}},r=(t?n.homeUrl:n.shareUrl)||"https://makecode.com/";/\/$/.test(r)||(r+="/");let o=n.embedUrl;/\/$/.test(o)||(o+="/");const s=pxt.webConfig.verprefix||"";i.url=`${r}${e}`,i.embed.code=pxt.docs.codeEmbedUrl(`${o}${s}`,e),i.embed.editor=pxt.docs.embedUrl(`${o}${s}`,"pub",e),i.embed.url=`${o}${s}#pub:${e}`;let a="81.97%",l=`${s}---run`;pxt.webConfig.runUrl&&(l=pxt.webConfig.isStatic?pxt.webConfig.runUrl:pxt.webConfig.runUrl.replace(pxt.webConfig.relprefix,"/---")),pxt.appTarget.simulator&&(a=(100/pxt.appTarget.simulator.aspectRatio).toPrecision(4)+"%");const c=o+l.replace(/^\//,"");return i.embed.simulator=pxt.docs.runUrl(c,a,e),n.qrCode&&(i.qr=await W.renderAsync(`${r}${e}`)),i}async publishCurrentHeaderAsync(e,t){pxt.tickEvent("publish"),this.setState({publishing:!0});const n=c.mainPkg,i=c.getEditorPkg(n);try{await this.saveProjectNameAsync(),await this.saveFileAsync();const r=await n.filesToBePublishedAsync(!0);if(i.header.pubCurrent&&!t)return i.header.pubId;const o={description:n.config.description},a=this.blocksEditor.contentSize();return a&&(o.blocksHeight=a.height,o.blocksWidth=a.width),e?(await s.persistentPublishAsync(i.header,r,o,t)).pubId:(await s.anonymousPublishAsync(i.header,r,o,t)).id}finally{this.setState({publishing:!1})}}hasHeaderBeenPersistentShared(){var e;return!!(null===(e=this.state.header)||void 0===e?void 0:e.pubPermalink)}getSharePreferenceForHeader(){var e;return null===(e=this.state.header)||void 0===e?void 0:e.anonymousSharePreference}async saveSharePreferenceForHeaderAsync(e){this.state.header&&(this.state.header.anonymousSharePreference=e,await s.saveAsync(this.state.header))}async saveLocalProjectsToCloudAsync(e){return U.saveLocalProjectsToCloudAsync(e)}async requestProjectCloudStatus(e){await U.requestProjectCloudStatus(e)}convertCloudProjectsToLocal(e){return U.convertCloudToLocal(e)}updateHeaderName(e){this.setState({projectName:e}),this.debouncedSaveProjectName||(this.debouncedSaveProjectName=oe.debounce((()=>{this.saveProjectNameAsync()}),pxt.options.light?2e3:500,!1)),this.debouncedSaveProjectName()}saveProjectNameAsync(){if(!this.state.projectName||!this.state.header)return Promise.resolve();try{return this.updateHeaderNameAsync(this.state.projectName)}catch(e){return pxt.reportException(e),Promise.resolve()}}updateHeaderNameAsync(e){if(c.mainPkg.config.name==e)return Promise.resolve();c.mainPkg.config.name=e,pxt.debug("saving project name to "+e);let t=c.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME),n=JSON.parse(t.content);return n.name=e,t.setContentAsync(pxt.Package.stringifyConfig(n)).then((()=>{this.state.header&&this.setState({projectName:e})}))}isTextEditor(){return this.editor==this.textEditor}isPxtJsonEditor(){return this.editor==this.pxtJsonEditor}isBlocksEditor(){return this.editor==this.blocksEditor}loadBlocklyAsync(){return this.blocksEditor.loadBlocklyAsync()}createModalClasses(e){const t=[e,-1!=this.rootClasses.indexOf("flyoutOnly")?"flyoutOnly":"",-1!=this.rootClasses.indexOf("inverted-theme")?"inverted-theme":"",-1!=this.rootClasses.indexOf("hideIteration")?"hideIteration":""];return d.cx(t)}showReportAbuse(){const e=this.state.tutorialOptions&&this.state.tutorialOptions.tutorialReportId||this.state.header&&this.state.header.pubCurrent&&this.state.header.pubId;w.showReportAbuseAsync(e)}showAboutDialog(){w.showAboutDialogAsync(this)}async showTurnBackTimeDialogAsync(){let e=this.isSimulatorRunning();e&&this.stopSimulator(),await w.showTurnBackTimeDialogAsync(this.state.header,(()=>{this.reloadHeaderAsync(),e=!1})),e&&this.startSimulator()}showLoginDialog(e){this.loginDialog.show(e)}showProfileDialog(e){this.profileDialog.show(e)}showShareDialog(e,t){this.shareEditor.show(e,t)}showLanguagePicker(){this.languagePicker.show()}showImportUrlDialog(){w.showImportUrlDialogAsync().then((e=>{e&&(pxt.github.isGithubId(e)?Ee(e):Te(e))}),(e=>{u.errorNotification(lf("Sorry, the project url looks invalid."))}))}showImportGithubDialog(){w.showImportGithubDialogAsync().then((e=>{"NEW"===e?w.showCreateGithubRepoDialogAsync().then((e=>{e&&Ee(e)})):e&&Ee(e)}),(e=>{u.errorNotification(lf("Sorry, that repository looks invalid."))}))}showImportFileDialog(e){w.showImportFileDialogAsync(e).then((t=>{t&&(pxt.tickEvent("app.open.file"),this.importFile(t,e))}))}showResetDialog(){w.showResetDialogAsync().then((e=>e?(w.clearDontShowDownloadDialogFlag(),F.clearUserPrefersDownloadFlag(),this.resetWorkspace()):Promise.resolve()))}showExitAndSaveDialog(){var e,t;this.setState({debugging:!1}),this.isTutorial()?(pxt.tickEvent("tutorial.exit.home",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),this.exitTutorialAsync().finally((()=>this.openHome()))):this.state.projectName!==lf("Untitled")?this.openHome():this.exitAndSaveDialog.show()}askForProjectCreationOptionsAsync(){return this.newProjectDialog.promptUserAsync()}hidePackageDialog(){this.setState(Object.assign(Object.assign({},this.state),{extensionsVisible:!1}))}showPackageDialog(){this.setState(Object.assign(Object.assign({},this.state),{extensionsVisible:!0}))}showBoardDialogAsync(e,t){return this.scriptSearch.showBoardsAsync(e,t)}showModalDialogAsync(e){return u.dialogAsync({header:e.header,body:e.body,hasCloseIcon:!0,buttons:e.buttons})}showExperimentsDialog(){this.scriptSearch.showExperiments()}showChooseHwDialog(e){this.chooseHwDialog&&this.chooseHwDialog.show(e)}showRenameProjectDialogAsync(){if(!this.state.header||this.state.header.githubId)return Promise.resolve(!1);const e={header:lf("Rename your project"),agreeLbl:lf("Save"),agreeClass:"green",placeholder:lf("Enter your project name here")};return u.promptAsync(e).then((e=>null===e?Promise.resolve(!1):new Promise(((t,n)=>{this.setState({projectName:e},(()=>t()))})).then((()=>this.saveProjectNameAsync())).then((()=>!0))))}signOutGithub(){const e=a.githubProvider();e&&(e.logout(),this.forceUpdate(),u.infoNotification(lf("Signed out from GitHub")))}async loadActivityFromMarkdownAsync(e,t,n){const i=s.getHeader(e.split(":")[0]),r=!i&&pxt.Cloud.parseScriptId(e),o=!i&&!r&&pxt.github.parseRepoId(e);let a,l,c,d,h=!0,p={},f=!1;try{if(/^\//.test(e)){a=t||e.split("/").reverse()[0].replace("-"," "),pxt.perf.measureStart("downloadMarkdown");const n=await pxt.Cloud.markdownAsync(e);pxt.perf.measureEnd("downloadMarkdown"),h=!0,l=g(n)}else if(r){pxt.tickEvent("tutorial.shared",{tutorial:r});const e=await s.downloadFilesByIdAsync(r),t=pxt.Package.parseAndValidConfig(e["pxt.json"]);pxt.Util.jsonMergeFrom(p,t.dependencies),a=t.name||lf("Untitled"),h=!1,c=r,l=g(e["README.md"])}else if(o&&o.owner&&o.project){pxt.tickEvent("tutorial.github"),pxt.log(`loading tutorial from ${o.fullName}`),pxt.perf.measureStart("downloadGitHubTutorial");const t=await pxt.packagesConfigAsync();switch(pxt.github.repoStatus(o,t)){case pxt.github.GitRepoStatus.Banned:throw lf("This GitHub repository has been banned.");case pxt.github.GitRepoStatus.Approved:c=void 0;break;default:c="https://github.com/"+o.slug}let n,i;(n=o.tag?o.tag:await pxt.github.latestVersionAsync(o.slug,t,!0))?(o.tag=n,pxt.log(`tutorial ${o.fullName} tag: ${n}`),i=await pxt.github.downloadPackageAsync(`${o.slug}#${o.tag}`,t)):(pxt.log(`tutorial github tag not found at ${o.fullName}`),i=void 0),pxt.perf.measureEnd("downloadGitHubTutorial"),(null==i?void 0:i.files[pxt.TUTORIAL_INFO_FILE])&&await pxt.tutorial.parseCachedTutorialInfo(i.files[pxt.TUTORIAL_INFO_FILE],e),i&&(l=m(o,i.files))}else if(i){pxt.tickEvent("tutorial.header"),f=!0,pxt.github.parseRepoId(i.githubId);const t=e.split(":")[1]||"README";l=m(o,await s.getTextAsync(i.id),t)}return{reportId:c,filename:a,autoChooseBoard:h,dependencies:p,features:d,temporary:f,md:l}}catch(e){return u.handleNetworkError(e),u.errorNotification(lf("Oops, we could not load this activity.")),void this.openHome()}function g(e){return e?(n==pxt.JAVASCRIPT_PROJECT_NAME?e=e.replace(/^```(blocks|block|spy)\b/gm,"```typescript"):n==pxt.PYTHON_PROJECT_NAME&&(e=e.replace(/^```(blocks|block|typescript)\b/gm,"```spy")),pxt.Util.jsonMergeFrom(p,pxt.gallery.parsePackagesFromMarkdown(e)),d=pxt.gallery.parseFeaturesFromMarkdown(e),e):e}function m(e,t,n){const i=pxt.Package.parseAndValidConfig(t["pxt.json"]);return i.files.find((e=>/\.ts$/.test(e)))?(p={})[e.project]=pxt.github.toGithubDependencyPath(e.slug,e.tag):pxt.Util.jsonMergeFrom(p,i.dependencies),a=i.name||lf("Untitled"),h=!1,g(pxt.tutorial.resolveLocalizedMarkdown(e,t,n))}}startTutorialAsync(e,t,n,i,r,o){var s,a,l,d,h,p;return(null===(a=null===(s=this.state.header)||void 0===s?void 0:s.tutorial)||void 0===a?void 0:a.tutorial)&&(pxt.tickEvent("recipe.exit",{tutorial:null===(d=null===(l=this.state.header)||void 0===l?void 0:l.tutorial)||void 0===d?void 0:d.tutorial,goto:e}),pxt.tickEvent("tutorial.finish",{tutorial:null===(p=null===(h=this.state.header)||void 0===h?void 0:h.tutorial)||void 0===p?void 0:p.tutorial})),u.hideDialog(),u.showLoading("tutorial",lf("starting tutorial...")),R.initTutorial(),n=n&&!!this.state.header,this.loadActivityFromMarkdownAsync(e,t,i).then((t=>{const{filename:s,dependencies:a,temporary:l,reportId:u,autoChooseBoard:d,features:h,md:p}=t||{};if(!p)throw new Error(lf("Tutorial {0} not found",e));const{options:f,editor:g}=pxt.tutorial.getTutorialOptions(p,e,s,u,!!n);this.hintManager.clearViewedHints(),f.mergeCarryoverCode=o,f.mergeHeaderId=r;const m=i||g;if(n){const e=c.mainEditorPkg().header;return e.tutorial=f,e.tutorialCompleted=void 0,this.loadHeaderAsync(e)}return this.createProjectAsync({name:s,tutorial:f,preferredEditor:m,dependencies:a,temporary:l,skillmapProject:pxt.BrowserUtils.isSkillmapEditor()}).then((()=>d?this.autoChooseBoardAsync(h):Promise.resolve())).then((()=>this.postTutorialProgress()))})).catch((t=>{pxt.reportException(t,{tutorialId:e}),u.warningNotification(lf("Please check your internet connection and check the tutorial is valid.")),this.openHome()})).finally((()=>u.hideLoading("tutorial")))}async startActivity(e){const{activity:t,path:n,editor:i,title:r,focus:o,importOptions:s,previousProjectHeaderId:a,carryoverPreviousCode:l}=e;switch(pxt.perf.measureStart("startActivity"),this.textEditor.giveFocusOnLoading=o,t){case"tutorial":pxt.tickEvent("tutorial.start",{tutorial:n,editor:i}),await this.startTutorialAsync(n,r,!1,i,e.previousProjectHeaderId,e.carryoverPreviousCode);break;case"recipe":pxt.tickEvent("recipe.start",{recipe:n,editor:i}),await this.startTutorialAsync(n,r,!0,i);break;case"example":pxt.tickEvent("example.start",{example:n,editor:i}),await this.importExampleAsync(Object.assign({name:r,path:n,preferredEditor:i},s))}pxt.perf.measureEnd("startActivity")}completeTutorialAsync(){var e,t,n,i;pxt.tickEvent("tutorial.finish",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),pxt.tickEvent("tutorial.complete",{tutorial:null===(i=null===(n=this.state.header)||void 0===n?void 0:n.tutorial)||void 0===i?void 0:i.tutorial}),u.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialCompleted();const r=this.state.header.tutorial;return r&&!this.state.header.isSkillmapProject&&(this.state.tutorialOptions&&this.state.tutorialOptions.tutorialRecipe?this.state.header.tutorialCompleted=void 0:this.state.header.tutorialCompleted={id:r.tutorial,steps:r.tutorialStepInfo.length},this.state.header.tutorial=void 0),pxt.BrowserUtils.isIE()?(this.exitTutorial(),Promise.resolve()):pxt.BrowserUtils.isSkillmapEditor()?this.exitTutorialAsync().finally((()=>{u.hideLoading("leavingtutorial")})):this.exitTutorialAsync().then((()=>{let e=c.mainEditorPkg().header;return this.loadHeaderAsync(e)})).finally((()=>{u.hideLoading("leavingtutorial"),this.state.collapseEditorTools&&!pxt.appTarget.simulator.headless&&this.expandSimulator(),this.postTutorialProgress()})).then((()=>{pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.appTheme.shareFinishedTutorials&&(pxt.tickEvent("tutorial.share",void 0,{interactiveConsent:!1}),this.showShareDialog(lf("Well done! Would you like to share your project?")))}))}exitTutorial(e){var t,n;pxt.tickEvent("tutorial.exit",{tutorial:null===(n=null===(t=this.state.header)||void 0===t?void 0:t.tutorial)||void 0===n?void 0:n.tutorial}),u.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialExit(),this.exitTutorialAsync(e).finally((()=>{u.hideLoading("leavingtutorial"),this.openHome()}))}async exitTutorialAsync(e){let t=c.mainEditorPkg().header;t.isDeleted=e;let n=c.mainEditorPkg().getAllFiles();try{await s.saveAsync(t,n),await oe.delay(500)}catch(e){}finally{u.resetFocus(),await this.setStateAsync({tutorialOptions:void 0,tracing:void 0,editorState:void 0}),this.state.header&&await s.saveAsync(this.state.header)}}showTutorialHint(e){let t=this.refs[ge.tutorialCardId];t&&t.showHint(!0,e)}isTutorial(){return null!=this.state.tutorialOptions}onEditorContentLoaded(){this.isTutorial()&&(pxt.tickEvent("tutorial.editorLoaded"),this.postTutorialLoaded(),pxt.perf.recordMilestone("editorContentLoaded"),this.autoRunOnStart()||pxt.analytics.trackPerformanceReport());const e={type:"pxthost",action:"editorcontentloaded"};ie.postHostMessageAsync(e),ie.postHostMessageAsync(Object.assign(Object.assign({},e),{type:"pxteditor"})),this.pendingImport&&(this.pendingImport.resolve(),this.pendingImport=void 0)}setEditorOffset(){var e,t,n;if(this.isTutorial())if(pxt.BrowserUtils.useOldTutorialLayout()){const i=document.getElementById("tutorialcard");if(i){let r=0;(!1===(null===(e=this.state.editorState)||void 0===e?void 0:e.hasCategories)||(null===(n=null===(t=this.state.tutorialOptions)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.flyoutOnly))&&(r=document.getElementById("headers").offsetHeight);const o=i.offsetHeight+r;this.setState({editorOffset:`${o}px`})}}else{const e=null===document||void 0===document?void 0:document.getElementById("tutorialWrapper");e&&(pxt.BrowserUtils.isTabletSize()||pxt.appTarget.appTheme.tutorialSimSidebarLayout)?this.setState({editorOffset:e.offsetHeight+"px"}):this.setState({editorOffset:void 0})}}saveTutorialTemplateAsync(){return c.mainEditorPkg().buildAssetsAsync().then((()=>c.mainPkg.saveToJsonAsync())).then((e=>{pxt.BrowserUtils.browserDownloadText(e.source,c.genFileName(".assets.mkcd"))}))}pokeUserActivity(){this.state.tutorialOptions&&this.state.tutorialOptions.tutorial&&this.hintManager.pokeUserActivity(ge.tutorialCardId,this.state.tutorialOptions.tutorialStep,this.state.tutorialOptions.tutorialHintCounter)}stopPokeUserActivity(){this.hintManager.stopPokeUserActivity()}clearUserPoke(){this.setState({pokeUserComponent:null})}setHintSeen(e){this.hintManager.viewedHint(e)}tutorialCardHintCallback(){let e=this.state.tutorialOptions;e.tutorialHintCounter=e.tutorialHintCounter+1,this.setState({pokeUserComponent:ge.tutorialCardId,tutorialOptions:e}),setTimeout((()=>this.clearUserPoke()),1e4)}toggleHighContrast(){u.toggleHighContrast(),pxt.tickEvent("app.highcontrast",{on:u.getHighContrastOnce()?1:0}),this.isSimulatorRunning()&&this.startSimulator()}setHighContrast(e){return u.setHighContrast(e)}toggleGreenScreen(){const e=!this.state.greenScreen;pxt.tickEvent("app.greenscreen",{on:e?1:0}),this.setState({greenScreen:e})}toggleAccessibleBlocks(){this.setAccessibleBlocks(!this.state.accessibleBlocks)}setAccessibleBlocks(e){pxt.tickEvent("app.accessibleblocks",{on:e?1:0}),this.blocksEditor.enableAccessibleBlocks(e),this.setState({accessibleBlocks:e})}setBannerVisible(e){this.setState({bannerVisible:e})}hideLightbox(){this.setState({lightbox:!1})}showLightbox(){this.setState({lightbox:!0})}hideOnboarding(){this.setState({onboarding:void 0})}async showOnboarding(){var e,t;const n=await(0,ce.parseTourStepsAsync)(null===(t=null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.tours)||void 0===t?void 0:t.editor);this.setState({onboarding:n})}showKeymap(e){this.setState({keymap:e})}toggleKeymap(){this.state.keymap?this.showKeymap(!1):this.showKeymap(!0)}renderCore(){var e,t,n;!function(e){if(de=e,pe){for(;pe.length;)pe.shift()(e);pe=void 0}}(this);const r=pxt.appTarget.appTheme,o=pxt.appTarget.simulator,s=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!pxt.shell.isControllerMode(),a=pxt.shell.isSandboxMode(),l=!this.editor.isVisible||this.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME,u=!(a||r.hideSideDocs),h=this.state.tutorialOptions,p=!!h&&!!h.tutorial,g=pxt.appTarget.appTheme.sidebarTutorial,m=p&&!pxt.BrowserUtils.useOldTutorialLayout(),b=p&&h.tutorialStepExpanded,w=pxt.appTarget.appTheme.tutorialSimSidebarLayout&&!pxt.BrowserUtils.isTabletSize(),R=this.state.debugging,D=this.state.home&&!a,L=!!this.state.header&&!D,{lightbox:M,greenScreen:j,accessibleBlocks:F}=this.state,U=p&&(null===(e=h.metadata)||void 0===e?void 0:e.hideIteration),W=!1===(null===(t=this.state.editorState)||void 0===t?void 0:t.hasCategories)||p&&(null===(n=h.metadata)||void 0===n?void 0:n.flyoutOnly),{hideEditorToolbar:z,transparentEditorToolbar:q}=r,Y=r.hideMenuBar||U||m&&pxt.appTarget.appTheme.embeddedTutorial||pxt.shell.isTimeMachineEmbed(),K=o&&o.headless,Z=r.selectLanguage,X=L&&!z&&this.editor.hasEditorToolbar(),J=pxt.appTarget.serial&&!!pxt.appTarget.serial.useEditor,ee=u&&this.state.sideDocsLoadUrl&&!this.state.sideDocsCollapsed,te=X&&!D&&!a&&!r.simCollapseInMenu&&(!K||R)&&!m,ne=this.state.hideEditorFloats||this.state.collapseEditorTools,ie=!!r.logoWide,re=!a&&pxt.hasHwVariants(),oe=(b||m)&&this.state.editorOffset?{top:this.state.editorOffset}:void 0,se=r.invertedMenu&&r.invertedMonaco,ae=r.multiplayer,ce=this.state.isMultiplayerGame,ue=this.state.collapseEditorTools?lf("Show the simulator"):lf("Hide the simulator"),he=f.isNativeHost()||pxt.BrowserUtils.isElectron(),fe=this.getData($.HIGHCONTRAST);let me=["ui",M?"dimmable dimmed":"dimmable",ne?"hideEditorFloats":"",this.state.collapseEditorTools?"collapsedEditorTools":"",q?"transparentEditorTools":"",se?"inverted-theme":"",this.state.fullscreen?"fullscreensim":"",this.state.showMiniSim?"miniSim":"",fe?"hc":"",ee?"sideDocs":"",pxt.shell.layoutTypeClass(),D?"inHome":"",p&&!m?"tutorial":"",b&&!m?"tutorialExpanded":"",m?"tabTutorial":"",g?"sidebarTutorial":"",w?"tutorialSimSidebar":"",R?"debugger":"",pxt.options.light?"light":"",pxt.BrowserUtils.isTouchEnabled()?"has-touch":"",Y?"hideMenuBar":"",!X||q?"hideEditorToolbar":"",this.state.bannerVisible&&!D?"notificationBannerVisible":"",this.state.debugging?"debugging":"",a&&this.isEmbedSimActive()?"simView":"",he?"app":"",j?"greenscreen":"",ie?"logo-wide":"",K?"headless":"",W?"flyoutOnly":"",U?"hideIteration":"",this.editor!=this.blocksEditor?"editorlang-text":"",this.editor==this.textEditor&&this.state.errorListState,"full-abs",pxt.appTarget.appTheme.embeddedTutorial?"tutorial-embed":""];this.rootClasses=me;const be=d.cx(me);if(this.state.hasError)return(0,i.jsx)("div",Object.assign({id:"root",className:"ui middle aligned center aligned grid",style:{height:"100%",alignItems:"center"}},{children:(0,i.jsxs)("div",Object.assign({className:"ui raised segment inverted purple"},{children:[(0,i.jsx)("h2",{children:lf("Oops")}),lf("We detected a problem and we will reload the editor in a few seconds..")]}))}));const ye=pxt.Util.isUserLanguageRtl(),ve=(this.state.collapseEditorTools||ye)&&!(this.state.collapseEditorTools&&ye),_e=!(a||p||this.isAssetsActive()||l||c.mainPkg&&c.mainPkg.config&&c.mainPkg.config.preferredEditor==pxt.BLOCKS_PROJECT_NAME),Ee=pxt.auth.hasIdentity();return(0,i.jsxs)("div",Object.assign({id:"root",className:be},{children:[this.state.extensionsVisible&&(0,i.jsx)(A.ExtensionsBrowser,{hideExtensions:this.hidePackageDialog,importExtensionCallback:()=>this.showImportFileDialog({extension:!0}),header:this.state.header,reloadHeaderAsync:()=>this.reloadHeaderAsync()}),j?(0,i.jsx)(P.WebCam,{close:this.toggleGreenScreen}):void 0,F&&(0,i.jsx)(B.AccessibleBlocksInfo,{}),Y||D?void 0:(0,i.jsxs)("header",Object.assign({className:"menubar",role:"banner"},{children:[L?(0,i.jsx)(_.EditorAccessibilityMenu,{parent:this,highContrast:fe}):void 0,(0,i.jsx)(Q.NotificationBanner,{parent:this}),(0,i.jsx)(G.HeaderBar,{parent:this})]})),g&&W&&p&&(0,i.jsx)(T.SidebarTutorialCard,{ref:ge.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==ge.tutorialCardId}),p&&!m&&(0,i.jsxs)("div",Object.assign({id:"maineditor",className:a?"sandbox":"",role:"main"},{children:[!(g&&W)&&p&&(0,i.jsx)(E.TutorialCard,{ref:ge.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==ge.tutorialCardId}),W&&(0,i.jsx)(E.WorkspaceHeader,{parent:this})]})),(0,i.jsx)(V.Sidepanel,{parent:this,inHome:D,showKeymap:this.state.keymap&&o.keymap,showSerialButtons:J,showFileList:_e,showFullscreenButton:!K,showHostMultiplayerGameButton:ae&&ce,collapseEditorTools:this.state.collapseEditorTools,simSerialActive:this.state.simSerialActive,devSerialActive:this.state.deviceSerialActive,showMiniSim:this.showMiniSim,openSerial:this.openSerial,handleHardwareDebugClick:this.hwDebug,handleFullscreenButtonClick:this.toggleSimulatorFullscreen,tutorialOptions:m?h:void 0,tutorialSimSidebar:w,onTutorialStepChange:this.setTutorialStep,onTutorialComplete:this.completeTutorialAsync,setEditorOffset:this.setEditorOffset}),(0,i.jsxs)("div",Object.assign({id:"maineditor",className:(a?"sandbox":"")+(R?"debugging":""),role:"main","aria-hidden":D},{children:[te&&(0,i.jsx)(d.Button,{id:"computertogglesim",className:"computer only collapse-button large",icon:"inverted chevron "+(ve?"right":"left"),title:ue,onClick:this.toggleSimulatorCollapse}),this.allEditors.map((e=>e.displayOuter(oe)))]})),D?(0,i.jsx)("div",Object.assign({id:"homescreen",className:"full-abs"},{children:(0,i.jsxs)("div",Object.assign({className:"ui home projectsdialog"},{children:[(0,i.jsxs)("header",Object.assign({className:"menubar",role:"banner"},{children:[(0,i.jsx)(_.HomeAccessibilityMenu,{parent:this,highContrast:fe}),(0,i.jsx)(G.HeaderBar,{parent:this})]})),(0,i.jsx)(I.Projects,{parent:this,ref:this.handleHomeRef})]}))})):void 0,X&&(0,i.jsx)(x.EditorToolbar,{ref:"editortools",parent:this}),u?(0,i.jsx)(S.SideDocs,{ref:"sidedoc",parent:this,sideDocsCollapsed:this.state.sideDocsCollapsed,docsUrl:this.state.sideDocsLoadUrl}):void 0,a?void 0:(0,i.jsx)(C.ScriptSearch,{parent:this,ref:this.handleScriptSearchRef}),a?void 0:(0,i.jsx)(N.Extensions,{parent:this,ref:this.handleExtensionRef}),D?(0,i.jsx)(I.ImportDialog,{parent:this,ref:this.handleImportDialogRef}):void 0,Ee?(0,i.jsx)(k.LoginDialog,{parent:this,ref:this.handleLoginDialogRef}):void 0,Ee?(0,i.jsx)(H.ProfileDialog,{parent:this,ref:this.handleProfileDialogRef}):void 0,D&&r.scriptManager?(0,i.jsx)(O.ScriptManagerDialog,{parent:this,ref:this.handleScriptManagerDialogRef,onClose:this.handleScriptManagerDialogClose}):void 0,a?void 0:(0,i.jsx)(I.ExitAndSaveDialog,{parent:this,ref:this.handleExitAndSaveDialogRef}),a?void 0:(0,i.jsx)(I.NewProjectDialog,{parent:this,ref:this.handleNewProjectDialogRef}),re?(0,i.jsx)(I.ChooseHwDialog,{parent:this,ref:this.handleChooseHwDialogRef}):void 0,a||!s?void 0:(0,i.jsx)(y.ShareEditor,{parent:this,ref:this.handleShareEditorRef,loading:this.state.publishing}),Z?(0,i.jsx)(v.LanguagePicker,{parent:this,ref:this.handleLanguagePickerRef}):void 0,a?(0,i.jsx)(S.SandboxFooter,{parent:this}):void 0,Y?(0,i.jsx)("div",Object.assign({id:"editorlogo"},{children:(0,i.jsx)("a",{className:"poweredbylogo"})})):void 0,M?(0,i.jsx)(d.Dimmer,{isOpen:!0,active:M,portalClassName:"tutorial",className:"ui modal",shouldFocusAfterRender:!1,closable:!0,onClose:this.hideLightbox}):void 0,this.state.onboarding&&(0,i.jsx)(le.Tour,{tourSteps:this.state.onboarding,onClose:this.hideOnboarding})]}))}}function me(){return de}n.ProjectView=ge,ge.tutorialCardId="tutorialcard";let be={workspace:s,require:e,core:u,getEditor:me,monaco:z,blocks:K,compiler:p,pkg:c,getsrc:function(){pxt.log(de.editor.getCurrentSource())},sim:h,apiAsync:u.apiAsync,assembleCurrent:function(){p.compileAsync({native:!0}).then((()=>p.assembleAsync(me().editorFile.content))).then((e=>{let t=e.words;pxt.debug("["+t.map((e=>"0x"+e.toString(16))).join(",")+"]")}))},log:function(e){console.log(e)},cloudsync:a};function ye(){let e=/^#(\w+)(:([:\.\/\-\+\=\w]+))?/.exec(window.location.hash);return e?{cmd:e[1],arg:e[3]||""}:{cmd:"",arg:""}}function ve(e,t){if(!e)return!1;let n=de;if(!n)return!1;switch(_e(e)&&n.setState({home:!1}),e.cmd){case"doc":pxt.tickEvent("hash.doc"),n.setSideDoc(e.arg,n.editor===n.blocksEditor);break;case"follow":return pxt.tickEvent("hash.follow"),n.newEmptyProject(void 0,e.arg),!0;case"newproject":return pxt.tickEvent("hash.newproject"),n.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"newjavascript":return pxt.tickEvent("hash.newjavascript"),n.newProject({preferredEditor:pxt.JAVASCRIPT_PROJECT_NAME}),pxt.BrowserUtils.changeHash(""),!0;case"newpython":return pxt.tickEvent("hash.newpython"),n.newProject({preferredEditor:pxt.PYTHON_PROJECT_NAME}),pxt.BrowserUtils.changeHash(""),!0;case"testproject":{pxt.tickEvent("hash.testproject");const t=e.arg,i=s.getHeader(t);if(i){const e=s.getHeaders().filter((e=>e.extensionUnderTest==i.id))[0];e?n.loadHeaderAsync(e):n.newProject({prj:pxt.appTarget.blocksprj,name:lf("test {0}",i.name),extensionUnderTest:t})}return pxt.BrowserUtils.changeHash(""),!0}case"gettingstarted":return pxt.tickEvent("hash.gettingstarted"),n.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"tutorial":case"example":case"recipe":{pxt.tickEvent("hash."+e.cmd),he=e;let t,i=e.arg;return/^([jt]s|py|blocks?):/i.test(i)&&(t=/^py:/i.test(i)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(i)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,i=i.substr(i.indexOf(":")+1)),n.startActivity({activity:e.cmd,path:i,editor:t,focus:!1}),pxt.BrowserUtils.changeHash("editor"),!0}case"home":return pxt.tickEvent("hash.home"),n.openHome(),pxt.BrowserUtils.changeHash(""),!0;case"sandbox":case"pub":case"edit":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),/^(github:|https:\/\/github\.com\/)/.test(e.arg)?Ee(e.arg):Te(e.arg),!0;case"header":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),n.loadHeaderAsync(s.getHeader(e.arg)),!0;case"sandboxproject":case"project":pxt.tickEvent("hash."+e.cmd);const i=oe.stringToUint8Array(atob(e.arg));return pxt.BrowserUtils.changeHash(""),u.showLoading("loadingproject",lf("loading project...")),n.importProjectFromFileAsync(i).finally((()=>u.hideLoading("loadingproject"))),!0;case"reload":return t&&pxt.BrowserUtils.changeHash(""),!1;case"skillmapimport":const r=e.arg;return u.showLoading("skillmapimport",lf("loading project...")),n.importSkillmapProjectAsync(r).finally((()=>{pxt.BrowserUtils.changeHash(""),u.hideLoading("skillmapimport")})),!0;case"github":{const t=pxt.github.parseRepoId(e.arg),[n,i]=e.arg.split(":",2);pxt.BrowserUtils.changeHash("");const r=a.githubProvider();if(!r)return!1;if("create-repository"===n){const e=s.getHeader(i);if(e)return!!r.hasToken()&&(de.loadHeaderAsync(e).then((()=>r.createRepositoryAsync(e.name,e))).then((e=>e&&de.reloadHeaderAsync())),!0)}else{if("import"===n)return w.showImportGithubDialogAsync(),!0;if(t)return Ee(e.arg,!0),!0}break}}return!1}function _e(e){if(!e)return!1;switch(e.cmd){case"follow":case"newproject":case"newjavascript":case"testproject":case"tutorial":case"example":case"recipe":case"projects":case"sandbox":case"pub":case"edit":case"sandboxproject":case"project":case"header":return!0;case"github":default:return!1}}async function Ee(e,t){if(!pxt.appTarget.appTheme.githubEditor||pxt.BrowserUtils.isPxtElectron())return u.warningNotification(lf("Importing GitHub projects not currently supported")),void de.openHome();u.showLoading("loadingheader",lf("importing GitHub project..."));try{const n=await pxt.packagesConfigAsync(),i=pxt.github.parseRepoId(e),r=await pxt.github.repoAsync(i.slug,n);e=pxt.github.normalizeRepoId(e,null==r?void 0:r.defaultBranch);let o=s.getHeaders().find((t=>t.githubId&&pxt.github.normalizeRepoId(t.githubId)==e));if(!o){if(t&&!(await a.githubProvider(!0).routedLoginAsync(e)).accessToken)return void de.openHome();o=await s.importGithubAsync(e)}o?await de.loadHeaderAsync(o,null):de.openHome()}catch(e){u.handleNetworkError(e),de.openHome()}finally{u.hideLoading("loadingheader")}}function Te(e){u.showLoading("loadingheader",lf("loading project...")),s.installByIdAsync(e).then((e=>de.loadHeaderAsync(e,null))).catch((e=>{de.openHome(),u.handleNetworkError(e)})).finally((()=>u.hideLoading("loadingheader")))}window.E=be;const xe=e=>{ve(ye(),!1)};function we(){try{return/saveblocks=1/.test(window.location.href)&&!!c.mainPkg.readFile(pxt.MAIN_BLOCKS)}catch(e){return!1}}function ke(){try{return/save(?:as)?template=1/i.test(window.location.href)}catch(e){return!1}}function Se(e){var t;const n=null===(t=c.getEditorPkg(c.mainPkg))||void 0===t?void 0:t.getMainFile();switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return n.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return n.getVirtualFileName(pxt.PYTHON_PROJECT_NAME);case"assets":case"asset":return pxt.ASSETS_FILE;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return n.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME)}}document.addEventListener("DOMContentLoaded",(async()=>{var t;pxt.perf.recordMilestone("DOM loaded"),pxt.setupWebConfig(window.pxtConfig);const n=pxt.webConfig,o=oe.parseQueryString(window.location.href.toLowerCase());"1"==o.dbg&&(pxt.debug=console.debug),pxt.options.light="1"==o.light||pxt.BrowserUtils.isARM()||pxt.BrowserUtils.isIE(),pxt.options.light&&pxsim.U.addClass(document.body,"light"),o.wsport?(pxt.options.wsPort=parseInt(o.wsport)||3233,pxt.BrowserUtils.changeHash(window.location.hash.replace(`wsport=${o.wsport}`,""))):pxt.options.wsPort=3233,"1"==o.consoleticks||"verbose"==o.consoleticks?pxt.analytics.consoleTicks=pxt.analytics.ConsoleTickOptions.Verbose:"2"!=o.consoleticks&&"short"!=o.consoleticks||(pxt.analytics.consoleTicks=pxt.analytics.ConsoleTickOptions.Short),"1"==o.tooltipblockids&&(pxt.blocks.showBlockIdInTooltip=!0),(0,ue.initGitHubDb)(),pxt.perf.measureStart("setAppTarget"),c.setupAppTarget(window.pxtTargetBundle),g.init((()=>de.reloadEditor())),pxt.setBundledApiInfo(window.pxtTargetBundle.apiInfo),pxt.perf.measureEnd("setAppTarget");let p=pxt.appTarget.appTheme;const m=(p.allowParentController||pxt.shell.isControllerMode())&&pxt.BrowserUtils.isIFrame();if(m&&pxt.auth.enableAuth(!1),function(){pxt.analytics.enable(pxt.Util.userLanguage()),ie.enableControllerAnalytics();const e={};if("undefined"!=typeof window){const t=window.screen;e["screen.width"]=t.width,e["screen.height"]=t.height,e["screen.availwidth"]=t.availWidth,e["screen.availheight"]=t.availHeight,e["screen.innerWidth"]=window.innerWidth,e["screen.innerHeight"]=window.innerHeight,e["screen.devicepixelratio"]=pxt.BrowserUtils.devicePixelRatio();const n=document.firstElementChild;n&&(e["screen.clientWidth"]=n.clientWidth,e["screen.clientHeight"]=n.clientHeight)}pxt.tickEvent("editor.loaded",e)}(),!pxt.BrowserUtils.isBrowserSupported()&&!/skipbrowsercheck=1/i.exec(window.location.href))return pxt.tickEvent("unsupported"),window.location.href="/browsers",void u.showLoading("browsernotsupported",lf("Sorry, this browser is not supported."));if(pxt.BrowserUtils.isWinRT())return pxt.tickEvent("redirected.winrt"),window.location.href="/v4",void u.showLoading("micro:bit-winrt-reload",lf("Redirecting to MakeCode micro:bit v4"));const y=oe.parseQueryString(window.location.href);y.authcallback&&await $.loginCallbackAsync(y),await $.initAsync();const _=y.autologin;if(_&&await $.loginAsync(_,!0),U.init(),a.loginCheck(),function(){const e=oe.parseQueryString((location.hash||"#").slice(1).replace(/%local_token/,"local_token"));e.local_token&&(pxt.storage.setLocal("local_token",e.local_token),location.hash=location.hash.replace(/(%23)?[\#\&\?]*local_token.*/,"")),re.localToken=pxt.storage.getLocal("local_token")||""}(),he=ye(),te.init(),pxt.react.getTilemapProject=()=>{const e=c.mainEditorPkg();return e.tilemapProject||(e.tilemapProject=new pxt.TilemapProject,e.tilemapProject.loadPackage(c.mainPkg)),e.tilemapProject},pxt.hexloader.showLoading=e=>u.showLoading("hexcloudcompiler",e),pxt.hexloader.hideLoading=()=>u.hideLoading("hexcloudcompiler"),pxt.docs.requireMarked=()=>e("marked"),null===(t=pxt.appTarget.cloud)||void 0===t?void 0:t.apiRoot)re.apiRoot=pxt.appTarget.cloud.apiRoot;else{const e=/^(https:\/\/[^/]+)/.exec(window.location.href);e&&(re.apiRoot=e[1]+"/api/")}y.hw&&(pxt.setHwVariant(y.hw),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"QUERY-"+pxt.hwVariant})),pxt.setCompileSwitches(y.compiler||y.compile);const E=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly();y.ws?s.setupWorkspace(y.ws):m?s.setupWorkspace("iframe"):E?s.setupWorkspace("mem"):pxt.BrowserUtils.isIpcRenderer()?s.setupWorkspace("idb"):pxt.BrowserUtils.isPxtElectron()?s.setupWorkspace("fs"):s.setupWorkspace("browser"),Promise.resolve().then((async()=>{const e=window.location.href;let t=!1;const i=l.getData($.LANGUAGE);let r;if($.initialUserPreferencesAsync().then((e=>{const t=pxt.BrowserUtils.getCookieLang();t&&e&&e.language&&e.language!=t&&(pxt.BrowserUtils.setCookieLang(e.language),u.infoNotification(lf("Reload the page to apply your new language preference.")),pxt.tickEvent("identity.preferences.askingUserToReloadToApplyLang"))})),/[&?]translate=1/.test(e)&&!pxt.BrowserUtils.isIE())console.log("translation mode"),t=!0,pxt.Util.enableLiveLocalizationUpdates(),r=ts.pxtc.Util.TRANSLATION_LOCALE;else{const e=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href);e&&window.location.hash.indexOf(e[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],""));const n=!!(null==e?void 0:e[1]),o=!!(null==e?void 0:e[2]),s=null==e?void 0:e[3],a=pxt.BrowserUtils.getCookieLang();r=s||i||a||p.defaultLocale||navigator.userLanguage||navigator.language;const l=/staticlang=1/i.test(window.location.href),c=pxt.appTarget.appTheme.defaultLocale,u=null==r?void 0:r.toLocaleLowerCase(),d=pxt.BrowserUtils.isLocalHostDev()&&(!u||(c?c.toLocaleLowerCase()===u:"en"===u||"en-us"===u)),h=pxt.BrowserUtils.isPxtElectron()||d;(l||h||p.disableLiveTranslations)&&!n||pxt.Util.enableLiveLocalizationUpdates(),t=o}const o=pxt.appTarget.id,s=n.commitCdnUrl;return oe.updateLocalizationAsync({targetId:o,baseUrl:s,code:r,force:t}).then((()=>{pxt.Util.isLocaleEnabled(r)?(pxt.BrowserUtils.setCookieLang(r),v.setInitialLang(r)):pxt.tickEvent("unavailablelocale",{lang:r,force:t?"true":"false"}),pxt.tickEvent("locale",{lang:pxt.Util.userLanguage(),live:pxt.Util.liveLocalizationEnabled()?"true":"false"}),oe.downloadTranslationsAsync(o,s,r,pxt.Util.liveLocalizationEnabled(),oe.TranslationsKind.Sim).then((e=>e&&h.setTranslations(e)))}))})).then((()=>(pxt.BrowserUtils.initTheme(),((p=ie.experiments.syncTheme()).allowParentController||p.allowPackageExtensions||p.allowSimulatorTelemetry||pxt.shell.isControllerMode())&&ie.bindEditorMessages(fe),s.initAsync().then((async e=>(await U.syncAsync(),e)))))).then((e=>(r.render((0,i.jsx)(ge,{}),d.appElement),e&&de.setState({editorState:e}),function(){if(!pxt.appTarget.appTheme||!pxt.appTarget.appTheme.extendEditor)return Promise.resolve();pxt.debug("loading editor extensions...");const e={blocklyToolbox:L.getToolboxDefinition(),monacoToolbox:M.getToolboxDefinition(),projectView:de};return pxt.BrowserUtils.loadScriptAsync("editor.js").then((()=>pxt.editor.initExtensionsAsync(e))).then((e=>{e.hexFileImporters&&e.hexFileImporters.forEach((e=>{pxt.debug(`\tadded hex importer ${e.id}`),de.hexFileImporters.push(e)})),e.resourceImporters&&e.resourceImporters.forEach((e=>{pxt.debug(`\tadded resource importer ${e.id}`),de.resourceImporters.push(e)})),e.beforeCompile&&(de.beforeCompile=e.beforeCompile),e.toolboxOptions&&(e.toolboxOptions.blocklyToolbox&&L.overrideToolbox(e.toolboxOptions.blocklyToolbox),e.toolboxOptions.monacoToolbox&&M.overrideToolbox(e.toolboxOptions.monacoToolbox)),f.setExtensionResult(e)}))}()))).then((()=>f.initAsync())).then((()=>{pxt.debug("packetio: hook events"),pxt.packetio.configureEvents((()=>l.invalidate("packetio:*")),((e,t)=>{try{const t=oe.fromUTF8(oe.uint8ArrayToString(e));window.postMessage({type:"serial",id:"n/a",data:t},"*")}catch(t){console.debug("invalid utf8 serial data",{buf:e,e:t})}}),((e,t)=>{var n;const i=null===(n=pxt.appTarget.simulator)||void 0===n?void 0:n.messageSimulators;(null==i?void 0:i[e])&&window.postMessage({type:"messagepacket",broadcast:!1,channel:e,data:t,sender:"packetio"},"*")})),window.addEventListener("message",(e=>{var t,n;const i=e.data;"messagepacket"===i.type&&"packetio"!==i.sender&&(null===(n=null===(t=pxt.appTarget.simulator)||void 0===t?void 0:t.messageSimulators)||void 0===n?void 0:n[i.channel])&&i.channel===pxt.HF2.CUSTOM_EV_JACDAC&&pxt.packetio.sendCustomEventAsync(i.channel,i.data).then((()=>{}),(e=>{u.errorNotification(lf("{0}: {1}",i.channel,e.message))}))}),!1),function(){if(!(pxt.appTarget.serial&&pxt.BrowserUtils.isLocalHost()&&re.localToken||pxt.usb.isEnabled))return;if(b.shouldUse()||pxt.usb.isEnabled)return;pxt.debug("initializing serial pipe");let e=new WebSocket(`ws://localhost:${pxt.options.wsPort}/${re.localToken}/serial`),t={};e.onopen=e=>{pxt.debug("serial: socket opened")},e.onclose=e=>{pxt.debug("serial: socket closed")},e.onerror=e=>{pxt.debug("serial: error")},e.onmessage=e=>{try{let n=JSON.parse(e.data);n&&"serial"==n.type&&pxt.Util.bufferSerial(t,n.data,n.id)}catch(t){pxt.debug("unknown message: "+e.data)}}}(),window.addEventListener("hashchange",xe),j.tryInit(),ee.initElectron(de)})).then((()=>{const e=de.shouldShowHomeScreen();if(e||de.setState({home:!1}),he.cmd&&ve(he,!0))return Promise.resolve();if(pxt.shell.isNoProject())return ie.postHostMessageAsync({action:"newproject",options:{preferredEditor:"blocks"}}),Promise.resolve();if(e)return Promise.resolve();const t=de.settings.fileHistory.filter((e=>!!s.getHeader(e.id)))[0];let n=s.getHeaders()[0];return t&&(n=s.getHeader(t.id)),n?de.loadHeaderAsync(n,de.state.editorState):(de.newProject(),Promise.resolve())})).catch((e=>{throw de.handleCriticalError(e,"Failure in DOM loaded handler"),e})).then((()=>(pxsim.U.remove(document.getElementById("loading")),s.loadedAsync()))),document.addEventListener("visibilitychange",(async e=>{de&&await de.updateVisibilityAsync()})),window.addEventListener("unload",(e=>{de&&de.saveSettings(),f.disconnectAsync()})),window.addEventListener("resize",(e=>{de&&de.editor&&(de.editor.resize(e),pxt.BrowserUtils.isIOS()&&setTimeout((()=>{de.editor.resize(e)}),1e3),(!de.isTutorial()||pxt.appTarget.appTheme.tutorialSimSidebarLayout||pxt.BrowserUtils.useOldTutorialLayout())&&(pxt.BrowserUtils.isTabletSize()?de.showMiniSim(!0):de.showMiniSim(!1)),de.isTutorial()&&!pxt.BrowserUtils.useOldTutorialLayout()&&de.setEditorOffset())}),!1);const T=window.ipcRenderer;T&&T.on("responseFromApp",((e,t)=>{try{h.driver.postMessage(JSON.parse(t))}catch(e){}})),window.addEventListener("message",(e=>{let t=e.data;if(t)if("parent"!=e.data.__proxy)if("tutorial"!=t.type&&"opendoc"!=t.type)if("sidedocready"===t.type&&pxt.BrowserUtils.isLocalHost()&&re.localToken)S.SideDocs.notify({type:"localtoken",localToken:re.localToken});else if("importfile"!=t.type);else{const e=t;de&&de.importFile(new File(e.parts,e.filename))}else de&&de.editor&&de.handleMessage(t);else{pxt.debug("received parent proxy message"+e.data),delete e.data.__proxy;const t=window.ipcRenderer;t?t.sendToHost("sendToApp",e.data):window.parent&&window!=window.parent&&window.parent.postMessage(e.data,"*")}}),!1),pxt.appTarget.appTheme.lockedEditor&&window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}))},{"../../pxtblocks":68,"../../pxteditor":134,"./accessibility":188,"./accessibleblocks":189,"./appcache":191,"./auth":194,"./blocklyFieldView":195,"./blocks":196,"./blocksSnippets":197,"./cloud":200,"./cloudsync":201,"./cmds":202,"./compiler":204,"./components/assetEditor/editor":243,"./components/onboarding/Tour":263,"./container":278,"./core":279,"./data":282,"./dialogs":289,"./draganddrop":290,"./editortoolbar":291,"./electron":292,"./extensions":295,"./extensionsBrowser":296,"./gitjson":301,"./greenscreen":302,"./headerbar":303,"./hidbridge":304,"./hinttooltip":305,"./idbworkspace":306,"./identity":307,"./lang":311,"./make":312,"./mergeProjects":315,"./monaco":316,"./monacoSnippets":321,"./notification":323,"./onboarding":324,"./package":325,"./projects":326,"./pxtjson":327,"./qr":328,"./screenshot":329,"./scriptmanager":330,"./scriptsearch":331,"./serial":332,"./share":334,"./sidebarTutorial":335,"./sidepanel":336,"./simulator":338,"./socketbridge":343,"./sounds":344,"./sui":346,"./tutorial":350,"./user":351,"./webusb":353,"./workspace":354,blockly:376,marked:450,"react-dom":491,"react/jsx-runtime":549}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.init=void 0;const i=e("./core"),r=e("./cmds");n.init=function(e){"serviceWorker"in navigator&&!pxt.webConfig.isStatic&&!pxt.BrowserUtils.isLocalHost(!0)&&window.addEventListener("load",(function(){const t=pxt.webConfig.relprefix.replace("---","").replace(/^\//,"");navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",(n=>{const o=n.data;"serviceworker"===(null==o?void 0:o.type)&&"activated"===o.state&&o.ref===t&&(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.noReloadOnUpdate||(i.infoNotification(lf("Update download complete. Reloading... ")),setTimeout((()=>{pxt.tickEvent("appcache.updated"),e()}),3e3))),o&&r.handleServiceWorkerMessageAsync(o)})),navigator.serviceWorker.register(pxt.webConfig.serviceworkerjs).then((function(e){pxt.debug("ServiceWorker registration successful with scope: "+e.scope)}),(function(e){pxt.debug("ServiceWorker registration failed: "+e)}))}))}},{"./cmds":202,"./core":279}],192:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.assetToGalleryItem=n.getAssets=n.getNewInternalID=n.lookupAsset=n.createTile=n.createProjectImage=n.createNewImageAsset=n.isNameTaken=void 0;const i=e("../../pxtblocks");function r(e,t=new pxt.ImageConverter){var n;switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":let r=e.data.tilemap;return e.previewURI=i.tilemapToImageURI(e.data,Math.max(r.width,r.height),!1),e;case"animation":return(null===(n=e.frames)||void 0===n?void 0:n.length)<=0?null:(e.framePreviewURIs=e.frames.map((e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e)))),e.previewURI=e.framePreviewURIs[0],e);case"song":return e.previewURI=i.songToDataURI(e.song,32,32,!1,1),e}}function o(e){return function(t,n){const i=-1===e.indexOf(t.meta.package)?0:1,r=-1===e.indexOf(n.meta.package)?0:1;return i===r?function(e,t){return e.internalID-t.internalID}(t,n):i-r}}n.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},n.createNewImageAsset=function(e,t,n,i){const r=pxt.react.getTilemapProject();switch(e){case"tile":return r.createNewTile(new pxt.sprite.Bitmap(t,n).data(),null,i);case"image":return r.createNewImage(t,n)}return null},n.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},n.createTile=function(e,t,n){return pxt.react.getTilemapProject().createNewTile(e,t,n)},n.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},n.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()},n.getAssets=function(e=!1,t="image",n=[]){const i=pxt.react.getTilemapProject(),s=new pxt.ImageConverter,a=e=>r(e,s),l=e?i.getGalleryAssets.bind(i):i.getAssets.bind(i),c=function(){var e;const t=null===(e=pxt.appTarget.blocksprj)||void 0===e?void 0:e.config;if(t)return Object.keys(t.dependencies);return[]}(),u=l("image").map(a).sort(o(c)),d=l("tile").map(a).filter((e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi))).sort(o(c)),h=l("tilemap").map(a).sort(o(c)),p=l("animation").map(a).sort(o(c)),f=l("song").map(a).sort(o(c));for(const e of n)switch(e.type){case"image":u.push(a(e));break;case"tile":d.push(a(e));break;case"animation":p.push(a(e));break;case"tilemap":h.push(a(e));break;case"song":f.push(a(e))}let g=[];switch(t){case"image":g=u.concat(d).concat(p).concat(h).concat(f);break;case"tile":g=d.concat(u).concat(p).concat(h).concat(f);break;case"animation":g=p.concat(u).concat(d).concat(h).concat(f);break;case"tilemap":g=h.concat(d).concat(u).concat(p).concat(f);break;case"song":g=f.concat(u).concat(d).concat(p).concat(h)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:g.length}),g},n.assetToGalleryItem=r},{"../../pxtblocks":68}],193:[function(e,t,n){"use strict";let i;function r(){return i||(i=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()),i}Object.defineProperty(n,"__esModule",{value:!0}),n.loadAsync=n.play=void 0,n.play=function(e,t=1){if(!e)return;const n=r();if(!n)return;const i=n.createBufferSource();i.buffer=e;const o=n.createGain();o.gain.value=t,i.connect(o),o.connect(n.destination),i.start(0)},n.loadAsync=function(e){const t=r();return new Promise(((n,i)=>{t.decodeAudioData(e,(e=>n(e)),(()=>{n(void 0)}))}))}},{}],194:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apiAsync=n.setEmailPrefAsync=n.setImmersiveReaderPrefAsync=n.setLanguagePrefAsync=n.setHighContrastPrefAsync=n.patchUserPreferencesAsync=n.deleteProfileAsync=n.logoutAsync=n.loginCallbackAsync=n.loginAsync=n.initialUserPreferencesAsync=n.authCheckAsync=n.userPreferences=n.userProfile=n.loggedIn=n.hasIdentity=n.initAsync=n.Component=n.HAS_USED_CLOUD=n.READER=n.LANGUAGE=n.HIGHCONTRAST=n.USER_PREFERENCES=n.LOGGED_IN=n.USER_PROFILE=void 0;const i=e("./core"),r=e("./data"),o=e("./cloud"),s=e("./workspace"),a="auth",l="profile",c="logged-in";n.USER_PROFILE="auth:profile",n.LOGGED_IN="auth:logged-in";const u="user-pref",d="preferences",h="high-contrast",p="language",f="reader";n.USER_PREFERENCES="user-pref:preferences",n.HIGHCONTRAST="user-pref:high-contrast",n.LANGUAGE="user-pref:language",n.READER="user-pref:reader",n.HAS_USED_CLOUD="has-used-cloud";class g extends r.Component{getUserProfile(){return this.getData(n.USER_PROFILE)}getUserPreferences(){return this.getData(n.USER_PREFERENCES)}isLoggedIn(){return this.getData(n.LOGGED_IN)}}n.Component=g;class m extends pxt.auth.AuthClient{async onSignedIn(){const e=await pxt.auth.getUserStateAsync();i.infoNotification(lf("Signed in: {0}",pxt.auth.userName(e.profile))),s.getWorkspaceType()&&await o.syncAsync(),pxt.storage.setLocal(n.HAS_USED_CLOUD,"true")}onSignedOut(){return i.infoNotification(lf("Signed out")),Promise.resolve()}onSignInFailed(){return i.errorNotification(lf("Sign in failed. Something went wrong.")),Promise.resolve()}async onUserProfileChanged(){const e=await pxt.auth.getUserStateAsync();pxt.auth.generateUserProfilePicDataUrl(null==e?void 0:e.profile),r.invalidate("auth:*")}onUserPreferencesChanged(e){for(const t of e)switch(t.path.join("/")){case"language":r.invalidate(n.LANGUAGE);break;case"highContrast":r.invalidate(n.HIGHCONTRAST);break;case"reader":r.invalidate(n.READER)}return Promise.resolve()}async onProfileDeleted(e){try{await o.convertCloudToLocal(e)}catch(e){pxt.tickEvent("auth.profile.cloudToLocalFailed")}}async onStateLoaded(){const e=await pxt.auth.getUserStateAsync();pxt.auth.generateUserProfilePicDataUrl(e.profile),r.invalidate("auth:*"),r.invalidate("user-pref:*")}async onApiError(e){i.handleNetworkError(e)}async onStateCleared(){r.invalidate("auth:*")}static authApiHandler(e){const t=r.stripProtocol(e),n=pxt.auth.cachedUserState,i=pxt.auth.cachedHasAuthToken;switch(t){case l:return i?Object.assign({},null==n?void 0:n.profile):null;case c:return i&&null!=(null==n?void 0:n.profile)}return null}static userPreferencesHandler(e){const t=pxt.auth.client(),i=pxt.auth.cachedUserState;if(t&&i)return i.preferences||t.initialUserPreferencesAsync().then((()=>{})),m.internalUserPreferencesHandler(e);switch(e){case n.HIGHCONTRAST:return/^true$/i.test(pxt.storage.getLocal(n.HIGHCONTRAST));case n.LANGUAGE:return pxt.storage.getLocal(n.LANGUAGE);case n.READER:return pxt.storage.getLocal(n.READER)}return null}static internalUserPreferencesHandler(e){var t,n,i,o,s,a;const l=pxt.auth.client(),c=pxt.auth.cachedUserState;if(l&&c){switch(r.stripProtocol(e)){case d:return Object.assign({},c.preferences);case h:return null!==(n=null===(t=c.preferences)||void 0===t?void 0:t.highContrast)&&void 0!==n?n:pxt.auth.DEFAULT_USER_PREFERENCES().highContrast;case p:return null!==(o=null===(i=c.preferences)||void 0===i?void 0:i.language)&&void 0!==o?o:pxt.auth.DEFAULT_USER_PREFERENCES().language;case f:return null!==(a=null===(s=c.preferences)||void 0===s?void 0:s.reader)&&void 0!==a?a:pxt.auth.DEFAULT_USER_PREFERENCES().reader}return c.preferences}return null}}let b;async function y(){if(pxt.auth.hasIdentity())return b||(b=new Promise((async(e,t)=>{const n=new m;await n.initAsync(),await n.authCheckAsync(),await n.initialUserPreferencesAsync(),e(n)})))}async function v(e,t={}){const n=await y();return await(null==n?void 0:n.patchUserPreferencesAsync(e,t))}n.initAsync=async function(){r.mountVirtualApi(u,{getSync:m.userPreferencesHandler}),r.mountVirtualApi(a,{getSync:m.authApiHandler});const e=await y();await(null==e?void 0:e.authCheckAsync())},n.hasIdentity=function(){return pxt.auth.hasIdentity()},n.loggedIn=function(){return r.getData(n.LOGGED_IN)},n.userProfile=function(){return r.getData(n.USER_PROFILE)},n.userPreferences=function(){return r.getData(n.USER_PREFERENCES)},n.authCheckAsync=async function(){const e=await y();return await(null==e?void 0:e.authCheckAsync())},n.initialUserPreferencesAsync=async function(){const e=await y();return await(null==e?void 0:e.initialUserPreferencesAsync())},n.loginAsync=async function(e,t,n){const i=await y();await(null==i?void 0:i.loginAsync(e,t,n))},n.loginCallbackAsync=async function(e){await pxt.auth.loginCallbackAsync(e)},n.logoutAsync=async function(){const e=await y();await(null==e?void 0:e.logoutAsync("#"))},n.deleteProfileAsync=async function(){const e=await y();await(null==e?void 0:e.deleteProfileAsync())},n.patchUserPreferencesAsync=v,n.setHighContrastPrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["highContrast"],value:e}):(pxt.storage.setLocal(n.HIGHCONTRAST,e.toString()),r.invalidate(n.HIGHCONTRAST))},n.setLanguagePrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["language"],value:e},{immediate:!0}):(pxt.storage.setLocal(n.LANGUAGE,e),r.invalidate(n.LANGUAGE))},n.setImmersiveReaderPrefAsync=async function(e){const t=await y();t?await t.patchUserPreferencesAsync({op:"replace",path:["reader"],value:e}):(pxt.storage.setLocal(n.READER,e),r.invalidate(n.READER))},n.setEmailPrefAsync=async function(e){return await v({op:"replace",path:["email"],value:e},{immediate:!0})},n.apiAsync=async function(e,t,n){const i=await y();return await(null==i?void 0:i.apiAsync(e,t,n))}},{"./cloud":200,"./core":279,"./data":282,"./workspace":354}],195:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dismissIfVisible=n.init=n.setContainerClass=n.setEditorBounds=n.FieldEditorView=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("./components/ImageFieldEditor"),s=e("./components/soundEffectEditor/SoundEffectEditor");let a,l;class c{constructor(e,t,n){this.contentDiv=e,this.inContainer=t,this.useFlex=n,this.resizeContentCore=()=>{if(this.inContainer)return void(this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize());this.resizeFrameRef=void 0;const e=this.editorBounds;let t=25,n=25;e.width-2*t<500&&(t=0,n=0),e.height-2*n<610&&(n=(n=Math.min(e.height-610,0)/2)<0?0:n,t=0),t=null!=e.horizontalPadding?e.horizontalPadding:t,n=null!=e.horizontalPadding?e.verticalPadding:n,this.contentBounds={left:e.left+t,top:e.top+n,width:e.width-2*t,height:e.height-2*n},this.contentDiv.style.left=this.contentBounds.left+"px",this.contentDiv.style.top=this.contentBounds.top+"px",this.contentDiv.style.width=this.contentBounds.width+"px",this.contentDiv.style.height=this.contentBounds.height+"px",this.overlayDiv.style.left=e.left+"px",this.overlayDiv.style.top=e.top+"px",this.overlayDiv.style.width=e.width+"px",this.overlayDiv.style.height=e.height+"px",this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize()},this.handleOutsideClick=e=>{this.contentBounds&&(function(e,t,n){return!(e<n.left||e>n.left+n.width||t<n.top||t>n.top+n.height)}(e.clientX,e.clientY,this.contentBounds)||(e.stopPropagation(),this.hide()))}}isVisible(){return this.visible}injectElement(e){r.render(e,this.contentDiv)}setRef(e){this.componentRef=e,e&&this.persistentData&&(e.restorePersistentData(this.persistentData),this.persistentData=void 0)}show(){!this.visible&&this.contentDiv&&(this.visible=!0,this.resize(this.editorBounds),this.contentDiv.style.display=this.useFlex?"flex":"block",this.inContainer||(this.overlayDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.overlayDiv,"blocks-editor-field-overlay"),this.contentDiv.parentElement.appendChild(this.overlayDiv),this.overlayDiv.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("mousedown",this.handleOutsideClick)))}hide(){var e,t;this.visible&&this.contentDiv&&(null!==(t=null===(e=this.componentRef)||void 0===e?void 0:e.shouldPreventHide)&&void 0!==t&&t.call(e)||(this.visible=!1,this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.clearContents(),this.contentDiv.style.display="none",this.inContainer||(this.overlayDiv.parentElement.removeChild(this.overlayDiv),document.removeEventListener("mousedown",this.handleOutsideClick)),this.hideCallback&&this.hideCallback()))}onHide(e){this.hideCallback=e}getResult(){return this.componentRef?this.componentRef.getValue():void 0}resize(e){this.editorBounds=e,this.visible&&(this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.resizeFrameRef=requestAnimationFrame(this.resizeContentCore))}dispose(){this.contentDiv&&(this.hide(),this.contentDiv=null)}getPersistentData(){return this.componentRef.getPersistentData()}restorePersistentData(e){this.componentRef?this.componentRef.restorePersistentData(e):this.persistentData=e}setContainerClass(e){this.contentDiv&&this.contentDiv.classList.contains(this.containerClass)&&this.contentDiv.classList.remove(this.containerClass),this.containerClass=e,this.updateContainerClass()}clearContents(){for(r.unmountComponentAtNode(this.contentDiv);this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild)}updateContainerClass(){this.contentDiv&&this.containerClass&&(this.contentDiv.classList.contains(this.containerClass)||this.contentDiv.classList.add(this.containerClass))}}function u(){l&&l.dispose(),l=void 0}n.FieldEditorView=c,n.setEditorBounds=function(e){l&&l.resize(e),a=e},n.setContainerClass=function(e){l&&l.setContainerClass(e)},n.init=function(){pxt.react.getFieldEditorView=function(e,t,n,r){l&&l.dispose();const d=e=>{e&&l&&(l.setRef(e),e.init(t,u,n))};switch(l=new c(r||document.getElementById("blocks-editor-field-div"),!!r,null==n?void 0:n.useFlex),e){case"image-editor":l.injectElement((0,i.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0}));break;case"animation-editor":l.injectElement((0,i.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!1}));break;case"tilemap-editor":l.injectElement((0,i.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0}));break;case"soundeffect-editor":l.injectElement((0,i.jsx)(s.SoundEffectEditor,{onClose:()=>{n.onClose&&n.onClose(),u()},onSoundChange:n.onSoundChange,initialSound:n.initialSound,useMixerSynthesizer:n.useMixerSynthesizer}));break;case"music-editor":l.injectElement((0,i.jsx)(o.ImageFieldEditor,{ref:d,singleFrame:!0,isMusicEditor:!0}))}return a&&l.resize(a),l};let e=new pxt.TilemapProject;pxt.react.getTilemapProject=()=>e,pxt.react.isFieldEditorViewVisible=()=>!(!l||!l.isVisible())},n.dismissIfVisible=u},{"./components/ImageFieldEditor":229,"./components/soundEffectEditor/SoundEffectEditor":266,"react-dom":491,"react/jsx-runtime":549}],196:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-dom"),s=e("blockly"),a=e("./package"),l=e("./core"),c=e("./toolboxeditor"),u=e("./compiler"),d=e("./toolbox"),h=e("./blocksSnippets"),p=e("./workspace"),f=e("./simulator"),g=e("./dialogs"),m=e("./blocklyFieldView"),b=e("./createFunction"),y=e("./snippetBuilder"),v=e("../../pxtblocks"),_=e("@blockly/keyboard-navigation");var E=pxt.Util;const T=e("./debuggerToolbox"),x=e("./errorList"),w=e("./extensionManager"),k=e("../../pxteditor"),S=e("../../pxtblocks/plugins/duplicateOnDrag");class C extends c.ToolboxEditor{constructor(e){super(e),this.isFirstBlocklyLoad=!0,this.functionsDialog=null,this.showCategories=!0,this.errorChangesListeners={},this.handleKeyDown=e=>{var t;(null===(t=this.parent.state)||void 0===t?void 0:t.accessibleBlocks)&&84===("number"==typeof e.which?e.which:e.keyCode)&&(this.focusToolbox(),e.stopPropagation())},this.markIncomplete=!1,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebuggerToolboxRef=e=>{this.debuggerToolbox=e},this.flyoutBlockXmlCache={},this.flyoutXmlList=[],this.onBreakpointClick=(e,t)=>{t?this.addBreakpointFromEvent(e.id):this.removeBreakpointFromEvent(e.id)},this.listenToBlockErrorChanges=this.listenToBlockErrorChanges.bind(this),this.onErrorListResize=this.onErrorListResize.bind(this)}setBreakpointsMap(e,t){if(!e||!this.compilationResult)return;const n={};for(const t of e){const e=v.findBlockIdByLine(this.compilationResult.sourceMap,{start:t.line,length:t.endLine-t.line});n[e]||(n[e]=[]),n[e].push(t)}this.breakpointsByBlock={};for(const e of Object.keys(n)){let t=n[e][n[e].length-1];const i=this.editor.getBlockById(e);if(i){switch(i.type){case"pxt_controls_for":case"controls_for":case"controls_simple_for":t=n[e][2]}this.breakpointsByBlock[e]=t.id}else this.breakpointsByBlock[e]=t.id}}setBreakpointsFromBlocks(){this.breakpointsSet=this.getBreakpoints(),f.driver.setBreakpoints(this.breakpointsSet)}getBreakpoints(){const e=[],t=this.breakpointsByBlock;return t&&this.editor&&this.editor.getAllBlocks(!1).forEach((n=>{t[n.id]&&function(e){const t=e.getIcon(v.BreakpointIcon.type);return!!(null==t?void 0:t.isEnabled())}(n)&&e.push(this.breakpointsByBlock[n.id])})),e}addBreakpointFromEvent(e){this.breakpointsSet.push(this.breakpointsByBlock[e]),f.driver.setBreakpoints(this.breakpointsSet)}removeBreakpointFromEvent(e){let t=this.breakpointsByBlock[e];this.breakpointsSet.filter((e=>e!=t)),f.driver.setBreakpoints(this.breakpointsSet)}clearBreakpoints(){f.driver.setBreakpoints([])}setVisible(e){super.setVisible(e),this.isVisible=e;let t="#blocksEditor .blocklyToolboxDiv, #blocksEditor .blocklyWidgetDiv, #blocksEditor .blocklyToolboxDiv";this.isVisible?(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="")),this.parent.fireResize()):(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="none")),this.editor&&s.hideChaff(),this.toolbox&&this.toolbox.clearExpandedItem())}saveToTypeScriptAsync(e=!1){if(!this.typeScriptSaveable)return Promise.resolve(void 0);this.clearHighlightedStatements();try{return v.compileAsync(this.editor,this.blockInfo,{emitTilemapLiterals:e}).then((t=>{this.compilationResult=t,pxt.tickEvent("activity.blocks.compile");let n=Promise.resolve();return e&&this.parent&&(function(e){A(e,(e=>e.clearTemporaryAssetData()))}(this.editor),n=this.parent.saveCurrentSourceAsync().then((()=>function(e){A(e,(e=>e.disposeOfTemporaryAsset()))}(this.editor)))),n.then((()=>this.compilationResult.source))}))}catch(e){return pxt.reportException(e),l.errorNotification(lf("Sorry, we were not able to convert this program.")),Promise.resolve(void 0)}}domUpdate(){if(this.delayLoadXml){if(this.loadingXml)return;pxt.debug("loading blockly"),pxt.perf.measureStart("domUpdate loadBlockly"),this.loadingXml=!0;const e=document.createElement("div");e.className="ui active dimmer";const t=document.createElement("div");t.className="ui text loader",t.appendChild(document.createTextNode(lf("Loading blocks..."))),e.appendChild(t);let n=document.getElementById("blocksEditor");n.appendChild(e),u.clearCaches(),this.loadingXmlPromise=this.loadBlocklyAsync().then((()=>u.getBlocksAsync())).then((e=>{this.blockInfo=e,v.initialize(this.blockInfo),this.nsMap=this.partitionBlocks(),this.refreshToolbox(),pxt.debug("loading block workspace");let t=this.delayLoadXml;this.delayLoadXml=void 0,this.loadBlockly(t),this.resize(),s.svgResize(this.editor),this.isFirstBlocklyLoad=!1})).finally((()=>{try{n.removeChild(e)}catch(e){}this.loadingXml=!1,this.loadingXmlPromise=null,pxt.perf.measureEnd("domUpdate loadBlockly"),this.parent.onEditorContentLoaded()}))}}onPageVisibilityChanged(e){e&&this.highlightStatement(this.highlightedStatement)}isDropdownDivVisible(){return void 0!==s&&s.DropDownDiv&&s.DropDownDiv.isVisible()}beforeCompile(){void 0!==s&&(s.DropDownDiv.hide(),s.WidgetDiv.hide())}getTemporaryAssets(){return this.editor?v.getTemporaryAssets(this.editor,"image").concat(v.getTemporaryAssets(this.editor,"animation")).concat(v.getTemporaryAssets(this.editor,"song")):[]}updateTemporaryAsset(e){this.editor.getBlockById(e.meta.temporaryInfo.blockId).getField(e.meta.temporaryInfo.fieldName).updateAsset(e)}saveBlockly(){return this.delayLoadXml?this.delayLoadXml:this.serializeBlocks()}serializeBlocks(e){let t=v.saveWorkspaceXml(this.editor,!e&&this.parent.state&&this.parent.state.header&&!!this.parent.state.header.githubId);return e&&(t=t.replace(/(x|y|id)="[^"]*"/g,"")),pxt.debug(t),t}loadBlockly(e){if(this.serializeBlocks()==e)return this.typeScriptSaveable=!0,pxt.debug("blocks already loaded..."),!1;this.typeScriptSaveable=!1,v.clearWithoutEvents(this.editor);try{const t=e||`<block type="${ts.pxtc.ON_START_TYPE}"></block>`,n=s.utils.xml.textToDom(t);this.cleanXmlForWorkspace(n),v.domToWorkspaceNoEvents(n,this.editor),v.upgradeTilemapsInWorkspace(this.editor,pxt.react.getTilemapProject()),this.initLayout(),this.editor.clearUndo(),this.reportDeprecatedBlocks(),this.updateGrayBlocks(),this.typeScriptSaveable=!0}catch(e){return pxt.log(e),v.clearWithoutEvents(this.editor),this.switchToTypeScript(),this.changeCallback(),!1}return this.changeCallback(),!0}cleanXmlForWorkspace(e){e.querySelectorAll("block[deletable], shadow[deletable]").forEach((e=>{e.removeAttribute("deletable")}))}initLayout(){let e,t,n=!1,i=!this.editor.getToolbox()&&this.editor.getFlyout();this.editor.getTopComments(!1).forEach((i=>{const r=i.getBoundingRectangle(),o=Math.sqrt(r.left*r.left+r.top*r.top);(void 0===e||o<e)&&(t=r,e=o),n=n||10==r.left&&10==r.top}));let r=[];this.editor.getTopBlocks(!1).forEach((i=>{const o=i.getBoundingRectangle(),s=Math.sqrt(o.left*o.left+o.top*o.top);(void 0===e||s<e)&&(t=o,e=s);const a=!!r.find((e=>e.left===o.left&&e.top===o.top));n=n||a,r.push(o)})),n&&!i?v.flow(this.editor,{useViewWidth:!0}):(t&&(this.editor.getTopComments(!1).forEach((e=>e.moveBy(-t.left,-t.top))),this.editor.getTopBlocks(!1).forEach((e=>e.moveBy(-t.left,-t.top)))),this.editor.scrollX=10,this.editor.scrollY=10,this.editor.resizeContents())}initPrompts(){s.dialog.setAlert((function(e,t){return l.confirmAsync({hideCancel:!0,header:lf("Alert"),agreeLbl:lf("Ok"),agreeClass:"positive",agreeIcon:"checkmark",body:e,size:"tiny"}).then((()=>{t&&t()}))})),s.dialog.setConfirm((function(e,t){return l.confirmAsync({header:lf("Confirm"),body:e,agreeLbl:lf("Yes"),agreeClass:"positive",agreeIcon:"checkmark",disagreeLbl:lf("No"),disagreeClass:"cancel",disagreeIcon:"cancel",size:"tiny"}).then((e=>{t(1==e)}))})),v.external.setPrompt((function(e,t,n,i){return l.promptAsync(Object.assign({header:e,initialValue:t,agreeLbl:lf("Ok"),hasCloseIcon:!0,size:"tiny"},i)).then((e=>{n(e)}))}),!0),pxt.Util.isTranslationMode()&&v.external.setPromptTranslateBlock(g.promptTranslateBlock)}initBlocklyToolbox(){let e=this;const t=s.Toolbox.prototype.position;s.Toolbox.prototype.position=function(){t.call(this),e.resizeToolbox()};const n=this;s.WorkspaceSvg.prototype.refreshToolboxSelection=function(){let e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.flyout_&&n.toolbox.refreshSelection()};const i=s.hideChaff;s.hideChaff=function(e){i(e),e||n.hideFlyout()}}initWorkspaceSounds(){const e=this,t=s.WorkspaceAudio.prototype.play;s.WorkspaceAudio.prototype.play=function(n,i){var r,o;const s=null===(o=null===(r=pxt.appTarget)||void 0===r?void 0:r.appTheme)||void 0===o?void 0:o.blocklySoundVolume;"muted"===(null==e?void 0:e.parent.state.mute)?i=0:null!=s&&(null!=i?i*=s:i=s),t.call(this,n,i)}}initAccessibleBlocks(){var e;(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.accessibleBlocks)&&!this.navigationController&&(this.navigationController=new _.NavigationController,this.navigationController.init(),this.navigationController.addWorkspace(this.editor),_.Navigation.prototype.focusToolbox=e=>{this.toolbox&&(this.focusToolbox(),this.navigationController.navigation.resetFlyout(e,!1),this.navigationController.navigation.setState(e,"toolbox"))})}enableAccessibleBlocks(e){e?this.navigationController.enable(this.editor):this.navigationController.disable(this.editor)}initWorkspaceSearch(){pxt.appTarget.appTheme.workspaceSearch&&!this.workspaceSearch&&(this.workspaceSearch=new v.PxtWorkspaceSearch(this.editor),this.workspaceSearch.init())}reportDeprecatedBlocks(){const e={};let t=!1;this.blockInfo.blocks.forEach((t=>{t.attributes.deprecated&&(e[t.attributes.blockId]=0)})),this.editor.getAllBlocks(!1).forEach((n=>{e[n.type]>=0&&(e[n.type]++,t=!0)}));for(const t in e)0!==e[t]&&pxt.tickEvent("blocks.usingDeprecated",{block:t,count:e[t]})}contentSize(){return this.editor?v.blocksMetrics(this.editor):void 0}isIncomplete(){var e;const t=null===(e=this.editor)||void 0===e?void 0:e.isDragging();return t&&(this.markIncomplete=!0),t}prepare(){this.isReady=!0}prepareBlockly(e){pxt.perf.measureStart("prepareBlockly");let t=document.getElementById("blocksEditor");if(!t)return;pxsim.U.clear(t),s.config.snapRadius=48,s.config.connectingSnapRadius=96,this.editor=s.inject(t,this.getBlocklyOptions(e)),v.contextMenu.setupWorkspaceContextMenu(this.editor);const n=pxt.appTarget.appTheme.blocklyColors;if(n){const e=this.editor.getTheme();for(const t of Object.keys(n))e.setComponentStyle(t,n[t]);this.editor.setTheme(e)}let i=!1;this.editor.addChangeListener((e=>{if(s.Events.disableOrphans(e),"block_field_intermediate_change"===e.type||"change"===e.type)e.blockId&&O(this.editor.getBlockById(e.blockId));else if("drag"===e.type)for(const e of this.editor.getAllBlocks(!1))e.pathObject.resizeHighlight();const t=[s.Events.UI,s.Events.SELECTED,s.Events.CLICK,s.Events.VIEWPORT_CHANGE,s.Events.BUBBLE_OPEN,v.FIELD_EDITOR_OPEN_EVENT_TYPE];if("var_create"!==e.type&&"marker_move"!==e.type&&this.hideFlyout(),(-1===t.indexOf(e.type)||this.markIncomplete)&&(this.changeCallback(),this.markIncomplete=!1),e.type==s.Events.CREATE){let t=e.xml.getAttribute("type");"variables_set"==t&&this.clearFlyoutCaches(),t!==pxtc.TS_STATEMENT_TYPE&&t!==pxtc.TS_OUTPUT_TYPE||this.updateGrayBlocks(),pxt.tickEvent("blocks.create",{block:t},{interactiveConsent:!0}),"SHADOW"==e.xml.tagName&&this.cleanUpShadowBlocks(),this.parent.state.tutorialOptions&&this.parent.state.tutorialOptions.metadata&&this.parent.state.tutorialOptions.metadata.flyoutOnly||this.parent.setState({hideEditorFloats:!1}),p.fireEvent({type:"create",editor:"blocks",blockId:t})}else if(e.type==s.Events.VAR_CREATE||e.type==s.Events.VAR_RENAME||e.type==s.Events.VAR_DELETE)this.clearFlyoutCaches();else if(e.type==s.Events.UI){if("category"==e.element){let t=!!e.newValue;t&&pxt.setInteractiveConsent(!0),this.parent.setState({hideEditorFloats:t})}}else e.type===v.FIELD_EDITOR_OPEN_EVENT_TYPE&&(e.isOpen?(i=0!=this.parent.state.simState,this.parent.stopSimulator()):i&&this.parent.startSimulator());null!=this.parent.state.tutorialOptions&&this.parent.pokeUserActivity()})),this.editor.addChangeListener((e=>{if(e.type===s.Events.BLOCK_MOVE){const t=this.editor.getBlockById(e.newParentId);if(t&&t.isShadow()){s.Events.setGroup(e.group);const n=s.serialization.blocks.save(t);this.editor.getBlockById(e.blockId).dispose();const i=s.serialization.blocks.append(n,this.editor,{recordUndo:!0});t.outputConnection.targetConnection.connect(i.outputConnection),s.Events.setGroup(!1)}}})),this.shouldShowCategories()&&this.renderToolbox(),this.hideFlyout(),this.initPrompts(),this.initBlocklyToolbox(),this.initWorkspaceSounds(),this.initAccessibleBlocks(),this.initWorkspaceSearch(),this.setupIntersectionObserver(),this.resize(),pxt.perf.measureEnd("prepareBlockly")}setupIntersectionObserver(){if(!("IntersectionObserver"in window)||this.intersectionObserver)return;this.intersectionObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.intersectionObserver.unobserve(e.target),this.editor.refreshTheme())}))}));const e=document.getElementById("blocksEditor");this.intersectionObserver.observe(e)}resize(e){this.getBlocksAreaDiv()&&this.getBlocksEditorDiv()&&this.editor&&(s.svgResize(this.editor),this.resizeToolbox(),this.resizeFieldEditorView())}resizeToolbox(){if(!this.getBlocksEditorDiv())return;const e=this.getBlocklyToolboxDiv();e&&(this.parent.isBlocksActive()&&this.parent.updateEditorLogo(e.offsetWidth),this.getBlocklyOptions(this.showCategories).horizontalLayout||(e.style.height="100%"))}resizeFieldEditorView(){if(!window)return;const e=this.getBlocksEditorDiv(),t=null==e?void 0:e.getBoundingClientRect();t&&this.parent.isTutorial()&&t.width>pxt.BREAKPOINT_TABLET?m.setEditorBounds({top:t.top,left:t.left,width:t.width,height:t.height}):m.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}hasUndo(){var e,t;const n=null===(e=this.editor)||void 0===e?void 0:e.getUndoStack(),i=null===(t=this.editor)||void 0===t?void 0:t.getRedoStack();return!!this.editor&&(0!=n.length||0==n.length&&0==i.length)}undo(){this.editor&&(this.editor.undo(!1),s.hideChaff(),this.parent.forceUpdate())}hasRedo(){return!!this.editor&&0!=this.editor.getRedoStack().length}redo(){this.editor&&(this.editor.undo(!0),s.hideChaff(),this.parent.forceUpdate())}zoomIn(){this.editor&&this.editor.zoomCenter(.8)}zoomOut(){this.editor&&this.editor.zoomCenter(-.8)}setScale(e){this.editor&&e!=this.editor.scale&&this.editor.setScale(e)}closeFlyout(){this.editor&&this.hideFlyout()}getId(){return"blocksArea"}display(){let e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=pxt.appTarget.appTheme.blocksErrorList;return(0,i.jsxs)("div",Object.assign({className:"blocksAndErrorList"},{children:[(0,i.jsxs)("div",Object.assign({className:"blocksEditorOuter"},{children:[(0,i.jsx)("div",{id:"blocksEditor"}),(0,i.jsx)(d.ToolboxTrashIcon,{flyoutOnly:e})]})),t&&(0,i.jsx)(x.ErrorList,{isInBlocksEditor:!0,listenToBlockErrorChanges:this.listenToBlockErrorChanges,onSizeChange:this.onErrorListResize})]}))}onErrorListResize(){this.parent.fireResize()}listenToBlockErrorChanges(e,t){this.errorChangesListeners[e]=t}onBlockErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}getBlocksAreaDiv(){return document.getElementById("blocksArea")}getBlocksEditorDiv(){return this.getBlocksAreaDiv()?document.getElementById("blocksEditor"):void 0}getBlocklyToolboxDiv(){const e=this.getBlocksAreaDiv();return e?e.getElementsByClassName("blocklyToolboxDiv")[0]:void 0}moveFocusToFlyout(){}focusToolbox(){this.toolbox&&this.toolbox.focus()}renderToolbox(e){if(pxt.shell.isReadOnly())return;const t=this.getBlocklyToolboxDiv(),n=(0,i.jsxs)("div",Object.assign({className:"blocklyToolbox"},{children:[(0,i.jsx)(d.Toolbox,{ref:this.handleToolboxRef,editorname:"blocks",parent:this}),(0,i.jsx)("div",{id:"debuggerToolbox"})]}));E.assert(!!t),o.render(n,t),e||this.toolbox.showLoading()}updateToolbox(){var e;const t=document.getElementById("debuggerToolbox");if(!t)return;pxt.perf.measureStart("updateToolbox");const n=!!this.parent.state.debugging;let r=n?(0,i.jsx)(T.DebuggerToolbox,{ref:this.handleDebuggerToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName}):(0,i.jsx)("div",{});n?(this.toolbox.hide(),null===(e=s.getSelected())||void 0===e||e.unselect()):(this.debuggerToolbox=null,this.toolbox.show()),o.render(r,t),pxt.perf.measureEnd("updateToolbox")}showPackageDialog(){pxt.tickEvent("blocks.addpackage"),this.editor.getToolbox()&&this.editor.getToolbox().clearSelection(),this.parent.showPackageDialog()}showVariablesFlyout(){this.showFlyoutInternal_(s.Variables.flyoutCategory(this.editor),"variables")}showFunctionsFlyout(){this.showFlyoutInternal_(v.createFunctionsFlyoutCategory(this.editor),"functions")}getViewState(){return{}}setViewState(e){}getCurrentSource(){return this.editor&&!this.delayLoadXml?this.saveBlockly():this.currSource}acceptsFile(e){return"blocks"==e.getExtension()}overrideFile(e){this.delayLoadXml?(this.delayLoadXml=e,this.currSource=e):this.loadBlockly(e)}insertBreakpoint(){if(!this.editor)return;const e=this.editor.newBlock(pxtc.TS_DEBUGGER_TYPE),t=this.editor.getMetrics();e.moveBy(t.viewWidth/2,t.viewHeight/3),e.initSvg(),e.render()}loadBlocklyAsync(){return this._loadBlocklyPromise||(pxt.perf.measureStart("loadBlockly"),this._loadBlocklyPromise=pxt.BrowserUtils.loadBlocklyAsync().then((()=>{v.FunctionManager.getInstance().setEditFunctionExternal(((e,t)=>{E.delay(10).then((()=>{if(!this.functionsDialog){const e=document.body.appendChild(document.createElement("div"));this.functionsDialog=o.render(r.createElement(b.CreateFunctionDialog,{parent:this.parent}),e)}this.functionsDialog.show(e,t,this.editor)}))})),v.external.setOpenHelpUrl((e=>{var t;pxt.tickEvent("blocks.help",{url:e},{interactiveConsent:!0});const n=/^\/pkg\/([^#]+)#(.+)$/.exec(e);if(n){const t=a.mainPkg.deps[n[1]];if(t&&"github"==t.verProtocol())return e=`/pkg/${t.verArgument().replace(/#.*$/,"")}#${n[2]}`,void window.open(e,n[1])}if(/^github:/.test(e)){e=e.replace(/^github:\/?/,"")+(/\.md$/i.test(e)?"":".md");const n=a.getEditorPkg(a.mainPkg).lookupFile(e),i=null===(t=null==n?void 0:n.content)||void 0===t?void 0:t.trim();i&&(this.parent.setSideMarkdown(i),this.parent.setSideDocCollapsed(!1))}else/^\//.test(e)?this.parent.setSideDoc(e):window.open(e,"docs")})),this.prepareBlockly()})).then((()=>(0,k.initEditorExtensionsAsync)())).then((()=>pxt.perf.measureEnd("loadBlockly")))),this._loadBlocklyPromise}loadFileAsync(e){return E.assert(!this.delayLoadXml),(this.loadingXmlPromise||Promise.resolve()).then((()=>this.loadBlocklyAsync())).then((()=>{v.cleanBlocks(),this.toolbox&&this.toolbox.showLoading(),this.blockInfo=void 0,this.currSource=e.content,this.typeScriptSaveable=!1,this.setDiagnostics(e),this.delayLoadXml=e.content,this.parent.shouldPreserveUndoStack()||v.clearWithoutEvents(this.editor),this.closeFlyout(),this.filterToolbox(),this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.showCategories=this.parent.state.editorState.hasCategories:this.showCategories=!0,this.currFile=e;let t=document.getElementById("blocklySearchInputField");t&&t.value&&(t.value=""),this.extensions=!!pxt.appTarget.appTheme.allowPackageExtensions&&a.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>{var t;return!!(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.extension)}))||[]}))}unloadFileAsync(){return this.delayLoadXml=void 0,this.toolbox&&this.toolbox.clearSearch(),Promise.resolve()}switchToTypeScript(){pxt.tickEvent("blocks.switchjavascript"),this.parent.closeFlyout(),this.parent.switchTypeScript()}setDiagnostics(e){if(E.assert(null!=this.editor),!this.compilationResult||this.delayLoadXml||this.loadingXml)return;this.editor.getAllBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>{e.setWarningText(null),I(e,!1)}));let t=e&&e.epkg&&e.epkg.files[e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];if(!t||!t.diagnostics)return;let n=t.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)),i=this.compilationResult.sourceMap;n.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)).forEach((e=>{let t=v.findBlockIdByLine(i,{start:e.line,length:0});if(t){let n=this.editor.getBlockById(t);if(n){let t=ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n");n.setWarningText(t),I(n,!0)}}})),this.compilationResult.diagnostics.forEach((e=>{if(e.blockId){let t=this.editor.getBlockById(e.blockId);t&&(t.setWarningText(e.message),I(t,!0))}})),this.onBlockErrorChanges(this.compilationResult.diagnostics),this.setBreakpointsFromBlocks()}highlightStatement(e,t){if(!this.compilationResult||this.delayLoadXml||this.loadingXml)return!1;if(this.updateDebuggerVariables(t),this.highlightedStatement=e,!e)return this.editor.highlightBlock(null),!1;{let n=v.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});if(n){const e=this.editor.getBlockById(n).getRootBlock();if(n=(null==e?void 0:e.isCollapsed())?e.id:n,this.editor.highlightBlock(n),t){const e=this.editor.getBlockById(n);e.setWarningText(t?t.exceptionMessage:void 0);const i=e.getRelativeToSurfaceXY(),r=e.getHeightWidth(),o=this.editor.scale,s=this.editor.getMetrics(),a=4,l=4;(i.x*o<s.viewLeft+a||(i.x+r.width)*o>s.viewLeft+s.viewWidth-a||i.y*o<s.viewTop+l||(i.y+r.height)*o>s.viewTop+s.viewHeight-l)&&this.editor.centerOnBlock(n)}return!0}}return!1}updateDebuggerVariables(e){if(this.parent.state.debugging&&this.debuggerToolbox){const t=s.Variables.allUsedVarModels(this.editor).map((e=>pxtc.escapeIdentifier(e.name)));this.debuggerToolbox.setBreakpoint(e,t)}}clearHighlightedStatements(){this.editor.highlightBlock(null),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null)}openTypeScript(){pxt.tickEvent("blocks.showjavascript"),this.parent.closeFlyout(),this.parent.openTypeScriptAsync()}openPython(){pxt.tickEvent("blocks.showpython"),this.parent.closeFlyout(),this.parent.openPythonAsync()}cleanUpShadowBlocks(){this.editor.getTopBlocks(!1).filter((e=>e.isShadow())).forEach((e=>e.dispose(!1)))}getBlocklyOptions(e){let t=Object.assign({},this.getDefaultOptions());E.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyOptions||{});const n=null!=e?e:this.showCategories;t.renderer="pxt",n||(this.showCategories=!1,delete t.plugins.flyoutsVerticalToolbox);const i=n?document.getElementById("blocklyToolboxDefinitionCategory"):document.getElementById("blocklyToolboxDefinitionFlyout");return t.toolbox=null!=t.toolbox?t.toolbox:t.readOnly?void 0:i,t}getDefaultOptions(){if(this.blocklyOptionsCache)return this.blocklyOptionsCache;const e=pxt.shell.isReadOnly(),t=pxt.appTarget.appTheme,n={media:pxt.webConfig.commitCdnUrl+"blockly/media/",sounds:!0,trashcan:!1,collapse:!!t.blocksCollapsing,comments:!0,disable:!1,readOnly:e,plugins:{blockDragger:v.BlockDragger,connectionChecker:S.DuplicateOnDragConnectionChecker,flyoutsVerticalToolbox:v.VerticalFlyout,connectionPreviewer:v.ConnectionPreviewer},move:{scrollbars:!0,wheel:!0},zoom:{controls:!1,maxScale:2.5,minScale:.2,scaleSpeed:1.5,startScale:pxt.BrowserUtils.isMobile()?.7:.9,pinch:!0},rtl:E.isUserLanguageRtl()};return this.blocklyOptionsCache=n,n}refreshToolbox(){if(!this.blockInfo)return;if(pxt.perf.measureStart("refreshToolbox"),pxt.shell.isReadOnly())return;if(null!=this.parent.state.tutorialOptions&&!this.parent.state.tutorialOptions.tutorialReady)return;this.clearCaches();const e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=this.shouldShowCategories(!e);if(this.editor.options.hasCategories===t)t?this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}):this.showFlyoutOnlyToolbox();else{t||o.unmountComponentAtNode(this.getBlocklyToolboxDiv());const e=()=>{this.delayLoadXml=this.getCurrentSource(),this.editor=void 0,this.prepareBlockly(t),this.domUpdate(),this.editor.scrollCenter(),t&&this.renderToolbox(!0)};this.loadingXmlPromise?this.loadingXmlPromise.then(e):e()}pxt.perf.measureEnd("refreshToolbox")}filterToolbox(e){this.showCategories=e,this.refreshToolbox()}async openExtension(e){const t=this.extensions.filter((t=>t.config.name===e))[0];if(!(null==t?void 0:t.config.extension))return;pxt.tickEvent("blocks.extensions.open",{extension:e});const{name:n,url:i,trusted:r}=await(0,w.resolveExtensionUrl)(t);if(!r)return l.errorNotification(lf("Sorry, this extension is not allowed.")),void pxt.tickEvent("blocks.extensions.untrusted",{extension:e});pxt.tickEvent("blocks.extensions.trusted",{extension:e}),this.parent.openExtension(n,i)}partitionBlocks(){const e={};this.topBlocks=[];const t=this;function n(e,n){t.subcategoryMap[e]||(t.subcategoryMap[e]={}),t.subcategoryMap[e][n]=!0}return v.injectBlocks(this.blockInfo).forEach((t=>{let i=(t.attributes.blockNamespace||t.namespace).split(".")[0];e[i]||(e[i]=[]),e[i].push(t);const r=t.attributes.subcategory;t.attributes.advanced?n(i,lf("more")):r&&n(i,r),t.attributes.topblock&&this.topBlocks.push(t)})),e}hideFlyout(){this.editor.getToolbox()&&this.editor.getFlyout().hide(),this.toolbox&&this.toolbox.clear()}clearCaches(){super.clearCaches(),this.clearFlyoutCaches(),h.clearBuiltinBlockCache()}clearFlyoutCaches(){this.flyoutBlockXmlCache={}}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}shouldShowCategories(e){return!this.parent.state.editorState||null==this.parent.state.editorState.hasCategories||this.parent.state.editorState.hasCategories}getBuiltinCategory(e){return h.getBuiltinCategory(e)}isBuiltIn(e){return h.isBuiltin(e)}getNamespaceAttrs(e){const t=h.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!h.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return h.getBuiltinCategory(e).removed}let n=pxt.appTarget.runtime||{};return n.loopsBlocks&&!t("loops")&&e.push("loops"),n.logicBlocks&&!t("logic")&&e.push("logic"),n.variablesBlocks&&!t("variables")&&e.push("variables"),n.mathBlocks&&!t("Math")&&e.push("Math"),n.functionBlocks&&!t("functions")&&e.push("functions"),n.listsBlocks&&!t("arrays")&&e.push("arrays"),n.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}getBlocksForCategory(e,t){return h.isBuiltin(e)?this.getBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t)):this.getNonBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t))}filterBlocks(e,t){return t?t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory)))):[]}getBuiltInBlocks(e,t){let n=h.getBuiltinCategory(e),i=n.blocks||[];return!n.custom&&this.nsMap[e]&&(i=this.filterBlocks(t,i.concat(this.nsMap[e]))),i}getNonBuiltInBlocks(e,t){return this.filterBlocks(t,this.nsMap[e])||[]}getExtraBlocks(e,t){if(t)return[];let n=[];const i=pxt.appTarget.runtime.onStartNamespace||"loops";e==i&&n.push({name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10,group:pxt.appTarget.runtime.onStartGroup||void 0},blockXml:'<block type="pxt-on-start"></block>'});const r=h.getPauseUntil();return r&&e==r.attributes.blockNamespace&&n.push(r),t||this.extensions.forEach((t=>{const i=t.config,r=i.name,o=i.extension.namespace||r;e==o&&n.push({name:`EXT${r}_BUTTON`,type:"button",attributes:{blockId:`EXT${r}_BUTTON`,label:i.extension.label?E.rlf(i.extension.label):E.lf("Editor"),weight:101,group:i.extension.group},callback:()=>{this.openExtension(r)}})})),pxt.appTarget.appTheme.snippetBuilder&&(0,y.initializeSnippetExtensions)(e,n,this.editor,this.parent),n}showFlyout(e){var t,n,i;const{nameid:r,subns:o}=e;if("search"==r)return void this.showSearchFlyout();if("topblocks"==r)return void this.showTopBlocksFlyout();const s=null===(t=this.parent.state.tutorialOptions)||void 0===t?void 0:t.tutorialStep,a=void 0!==s?this.parent.state.tutorialOptions.tutorialStepInfo[s]:void 0,l=!((null===(i=null===(n=null==a?void 0:a.localBlockConfig)||void 0===n?void 0:n.blocks)||void 0===i?void 0:i.length)>0||pxt.Util.isTranslationMode());this.flyoutXmlList=[];const c=r+o+(a?"tutorialexpanded":"");if(l&&this.flyoutBlockXmlCache[c])return pxt.debug("showing flyout with blocks from flyout blocks xml cache"),this.flyoutXmlList=this.flyoutBlockXmlCache[c],void this.showFlyoutInternal_(this.flyoutXmlList,c);this.abstractShowFlyout(e)&&(l&&(this.flyoutBlockXmlCache[c]=this.flyoutXmlList),this.showFlyoutInternal_(this.flyoutXmlList,c))}showFlyoutHeadingLabel(e,t,n,i,r){const o=t||E.capitalize(n||e),s=`blocklyTreeIcon${i?e.toLowerCase():"Default"}`.replace(/\s/g,"");let a=v.createFlyoutHeadingLabel(o,r,i,s);this.flyoutXmlList.push(a)}showFlyoutGroupLabel(e,t,n,i){let r=v.createFlyoutGroupLabel(pxt.Util.rlf(`{id:group}${e}`),t,n,i?`GROUP_HELP_${e}`:void 0);i&&this.editor.registerButtonCallback(`GROUP_HELP_${e}`,(()=>{this.helpButtonCallback(e)})),this.flyoutXmlList.push(v.createFlyoutGap(30)),this.flyoutXmlList.push(r),this.flyoutXmlList.push(v.createFlyoutGap(30))}helpButtonCallback(e){pxt.debug(`${e} help icon clicked.`),p.fireEvent({type:"ui",editor:"blocks",action:"groupHelpClicked",data:{group:e}})}showFlyoutBlocks(e,t,n){this.parent.state.editorState&&this.parent.state.editorState.filters,n.sort(((e,t)=>(null!=t.attributes.weight?t.attributes.weight:50)-(null!=e.attributes.weight?e.attributes.weight:50))).forEach((e=>{let t;(t="button"==e.type?this.getButtonXml(e):this.getBlockXml(e))&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}))}showSearchFlyout(){if(this.flyoutXmlList=[],this.toolbox.getSearchBlocks().forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))})),0==this.flyoutXmlList.length){let e=s.utils.xml.createElement("label");e.setAttribute("text",lf("No search results...")),this.flyoutXmlList.push(e)}this.showFlyoutInternal_(this.flyoutXmlList,"search"),this.toolbox.setSearch()}showTopBlocksFlyout(){this.flyoutXmlList=[];const e=this.getTopBlocks();if(0==e.length){let e=s.utils.xml.createElement("label");e.setAttribute("text",lf("No basic blocks...")),this.flyoutXmlList.push(e)}else this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),e.forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}));this.showFlyoutInternal_(this.flyoutXmlList)}showFlyoutInternal_(e,t="default"){const n=this.editor.getFlyout();n.show(e,t),n.scrollToStart()}showFlyoutOnlyToolbox(){const e=this.getAllCategories();let t=[];e.forEach((e=>{const n=e.blocks;t=t.concat(n),e.subcategories&&e.subcategories.forEach((e=>{const n=e.blocks;t=t.concat(n)}))}));let n=document.createElement("div");o.render((0,i.jsx)(d.ToolboxStyle,{categories:e}),n),document.getElementById("editorcontent").appendChild(n);let r=[];t.forEach((e=>{const t=this.getBlockXml(e);t&&(r=r.concat(t))})),this.showFlyoutInternal_(r),this.parent.forceUpdate()}updateGrayBlocks(){if(this.editor){const e=pxt.shell.isPyLangPref();this.editor.getAllBlocks(!1).forEach((t=>{t.type!==pxtc.TS_STATEMENT_TYPE&&t.type!==pxtc.TS_OUTPUT_TYPE||t.setPythonEnabled(e)}))}}getBlockXml(e,t,n){var i,r,o,a;const l=this;let c;if(!e.attributes.blockBuiltin){if(e.builtinBlock){if("function_return"===e.attributes.blockId)return[v.mkReturnStatementBlock()];const n=h.allBuiltinBlocks()[e.attributes.blockId];if(n&&n.blockXml&&e.builtinField&&2==e.builtinField.length){const t=e.builtinField[0],i=e.builtinField[1],r=new RegExp(`<field name="${t}">(.*)</field>`,"i");n.blockXml=n.blockXml.replace(r,(()=>`<field name="${t}">${i}</field>`))}return n?this.getBlockXml(n,t):void 0}if(e.blockXml)c=s.utils.xml.textToDom(e.blockXml);else{let t=v.blockSymbol(e.attributes.blockId);if(t){if(!function(e){if(e.attributes.debug&&!pxt.options.debug)return!1;if(!n&&e.attributes.blockHidden)return!1;if(e.attributes.deprecated&&!l.parent.isTutorial())return!1;let t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return l.shouldShowBlock(e.attributes.blockId,t,n)}(t))return;let h=pxt.blocks.compileInfo(t);function u(t){const n=t.blocks.find((t=>t.blockId===e.attributes.blockId));if(n){const e=s.utils.xml.textToDom(n.xml);return e.setAttribute("gap",`${pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8}`),e}}const p=null===(i=this.parent.state.tutorialOptions)||void 0===i?void 0:i.tutorialStep,f=void 0!==p?this.parent.state.tutorialOptions.tutorialStepInfo[p]:void 0;if((null===(r=null==f?void 0:f.localBlockConfig)||void 0===r?void 0:r.blocks)&&(c=u(f.localBlockConfig)),!c&&(null===(a=null===(o=this.parent.state.tutorialOptions)||void 0===o?void 0:o.globalBlockConfig)||void 0===a?void 0:a.blocks)&&(c=u(this.parent.state.tutorialOptions.globalBlockConfig)),!c)if(c=v.createToolboxBlock(this.blockInfo,t,h),t.attributes.optionalVariableArgs&&t.attributes.toolboxVariableArgs){const e=h.handlerArgs;t.attributes.toolboxVariableArgs.split(";").map((e=>parseInt(e))).filter((t=>t<=e.length&&t>=0)).forEach((t=>{const n=document.createElement("mutation");n.setAttribute("numargs",t.toString());for(let i=0;i<t;i++)n.setAttribute("arg"+i,e[i].name);c.appendChild(n)}))}else{if(t.attributes.mutateDefaults){const e=t.attributes.mutateDefaults.split(";"),n=[];return e.forEach((e=>{const i=c.cloneNode(!0);v.mutateToolboxBlock(i,t.attributes.mutate,e),n.push(i)})),n}if(null!=t.attributes.blockSetVariable&&t.retType&&!n){const e=t.attributes.blockSetVariable;let n,i=n=!e||pxt.blocks.isReservedWord(e)?E.htmlEscape(t.retType.toLowerCase()):E.htmlEscape(e),r=2;for(;d(i,this.editor);)i=n+r++;n=i;const o=s.utils.xml.textToDom(`\n                            <block type="variables_set" gap="${E.htmlEscape((t.attributes.blockGap||8)+"")}">\n                            <field name="VAR" variabletype="">${n}</field>\n                            </block>`);{let e=document.createElement("value");e.setAttribute("name","VALUE"),e.appendChild(c),e.appendChild(v.mkFieldBlock("math_number","NUM","0",!0)),o.appendChild(e)}c=o}else if(t.attributes.duplicateWithToolboxParent){const e=Object.assign(Object.assign({},t),{attributes:Object.assign(Object.assign({},t.attributes),{toolboxParent:t.attributes.duplicateWithToolboxParent,toolboxParentArgument:t.attributes.duplicateWithToolboxParentArgument})});return[v.createToolboxBlock(this.blockInfo,e,h),c]}}}else pxt.log("Couldn't find block for: "+e.attributes.blockId),pxt.log(e)}return c&&(t&&c.setAttribute("gap",`${pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8}`),pxt.Util.toArray(c.querySelectorAll("shadow")).filter((e=>!e.innerHTML)).forEach(((n,i)=>{let r=n.getAttribute("type");if(r===e.type)return;const o=h.allBuiltinBlocks()[r];let s=this.getBlockXml(o||{name:r,type:r,attributes:{blockId:r}},t,!0);s&&s.length>0&&s[0]&&s[0].getAttribute("type")===r&&(n.innerHTML=s[0].innerHTML)}))),[c]}function d(e,t){const n=t.getVariable(e),i=n&&t.getVariableUsesById(n.getId());return i&&i.some((e=>"variables_set"==e.type||"variables_change"==e.type))}pxt.log("ignoring built in block: "+e.attributes.blockId)}getButtonXml(e){return this.editor.registerButtonCallback(e.attributes.blockId,(t=>{e.callback()})),[v.createFlyoutButton(e.attributes.blockId,e.attributes.label)]}updateBreakpoints(){if(!this.editor)return;const e=!!this.parent.state.debugging;this.editor.getAllBlocks(!1).forEach((t=>{t.previousConnection&&this.enableBreakpoint(t,e)})),this.editor.options.readOnly=e||pxt.shell.isReadOnly()}enableBreakpoint(e,t){const n=e.getIcon(v.BreakpointIcon.type);if(t){if(n)return;e.addIcon(new v.BreakpointIcon(e,this.onBreakpointClick))}else n&&e.removeIcon(v.BreakpointIcon.type)}}function A(e,t){const n=e.getAllBlocks(!1);for(const e of n)for(const n of e.inputList)for(const e of n.fieldRow)(e instanceof v.FieldSpriteEditor||e instanceof v.FieldAnimationEditor)&&t(e)}function I(e,t){e.pathObject.setHasError(t),e.setHighlighted(t)}function O(e){var t;e.pathObject.resizeHighlight();const n=null===(t=e.outputConnection)||void 0===t?void 0:t.targetBlock();n&&O(n)}n.Editor=C},{"../../pxtblocks":68,"../../pxtblocks/plugins/duplicateOnDrag":78,"../../pxteditor":134,"./blocklyFieldView":195,"./blocksSnippets":197,"./compiler":204,"./core":279,"./createFunction":281,"./debuggerToolbox":287,"./dialogs":289,"./errorList":293,"./extensionManager":294,"./package":325,"./simulator":338,"./snippetBuilder":339,"./toolbox":348,"./toolboxeditor":349,"./workspace":354,"@blockly/keyboard-navigation":364,blockly:376,react:548,"react-dom":491,"react/jsx-runtime":549}],197:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getToolboxDefinition=n.overrideToolbox=n.overrideCategory=n.clearBuiltinBlockCache=n.allBuiltinBlocks=n.isBuiltin=n.getBuiltinCategory=n.getPauseUntil=void 0;const i=e("blockly"),r=e("../../pxtblocks");let o,s,a=null;function l(){return a||((a={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"controls_repeat_ext",attributes:{blockId:"controls_repeat_ext",weight:49},blockXml:'<block type="controls_repeat_ext">\n                    <value name="TIMES">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"device_while",attributes:{blockId:"device_while",weight:48},blockXml:'<block type="device_while">\n                    <value name="COND">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">FALSE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for",attributes:{blockId:"pxt_controls_for",weight:47},blockXml:`<block type="pxt_controls_for">\n                    <value name="VAR">\n                        <block type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}index")}</field>\n                            <mutation duplicateondrag="true"></mutation>\n                        </block>\n                    </value>\n                    <value name="TO">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>`},{name:"pxt_controls_for_of",attributes:{blockId:"pxt_controls_for_of",weight:46},blockXml:`<block type="pxt_controls_for_of">\n                    <value name="VAR">\n                        <block type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}value")}</field>\n                            <mutation duplicateondrag="true"></mutation>\n                        </block>\n                    </value>\n                    <value name="LIST">\n                        <block type="variables_get">\n                            <field name="VAR">list</field>\n                        </block>\n                    </value>\n                </block>`}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},pxt.appTarget.runtime&&pxt.appTarget.runtime.breakBlock&&a.loops.blocks.push({name:"pxt_break",attributes:{blockId:"break_keyword",weight:30},blockXml:'<block type="break_keyword"></block>'}),pxt.appTarget.runtime&&pxt.appTarget.runtime.continueBlock&&a.loops.blocks.push({name:"pxt_continue",attributes:{blockId:"continue_keyword",weight:29},blockXml:'<block type="continue_keyword"></block>'}),a.logic={name:lf("{id:category}Logic"),nameid:"logic",groups:[lf("Conditionals"),lf("Comparison"),lf("Boolean"),"other"],blocks:[{name:"controls_if",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:49},blockXml:'<block type="controls_if" gap="8">\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"controls_if_else",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:48},blockXml:'<block type="controls_if" gap="8">\n                    <mutation else="1"></mutation>\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_eq",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:47},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_lt",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:46},blockXml:'<block type="logic_compare">\n                    <field name="OP">LT</field>\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_strings",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:45},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_operation_and",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:44},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">AND</field>\n                </block>'},{name:"logic_operation_or",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:43},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">OR</field>\n                </block>'},{name:"logic_negate",attributes:{blockId:"logic_negate",group:lf("Boolean"),weight:42},blockXml:'<block type="logic_negate"></block>'},{name:"logic_boolean_true",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:41},blockXml:'<block type="logic_boolean" gap="8">\n                    <field name="BOOL">TRUE</field>\n                </block>'},{name:"logic_boolean_false",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:40},blockXml:'<block type="logic_boolean">\n                    <field name="BOOL">FALSE</field>\n                </block>'}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},a.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:void 0,custom:!0,customClick:e=>(e.showVariablesFlyout(),!1),attributes:{weight:50.07,icon:"variables",callingConvention:0,paramDefl:{}}},a.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"math_arithmetic_ADD",attributes:{blockId:"math_arithmetic",weight:90},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">ADD</field>\n                    </block>'},{name:"math_arithmetic_MINUS",attributes:{blockId:"math_arithmetic",weight:89},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MINUS</field>\n                    </block>'},{name:"math_arithmetic_TIMES",attributes:{blockId:"math_arithmetic",weight:88},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MULTIPLY</field>\n                    </block>'},{name:"math_arithmetic_DIVIDE",attributes:{blockId:"math_arithmetic",weight:87},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">DIVIDE</field>\n                    </block>'},{name:"math_number",attributes:{blockId:"math_number",weight:86},blockXml:'<block type="math_number" gap="8">\n                        <field name="NUM">0</field>\n                    </block>'},{name:"math_modulo",attributes:{blockId:"math_modulo",weight:85},blockXml:'<block type="math_modulo">\n                        <value name="DIVIDEND">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="DIVISOR">\n                            <shadow type="math_number">\n                                <field name="NUM">1</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_op2_min",attributes:{blockId:"math_op2",weight:84},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">min</field>\n                    </block>'},{name:"math_op2_max",attributes:{blockId:"math_op2",weight:83},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">max</field>\n                    </block>'},{name:"math_op3",attributes:{blockId:"math_op3",weight:82},blockXml:'<block type="math_op3">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_op",attributes:{blockId:"math_js_op",weight:81},blockXml:'<block type="math_js_op">\n                        <field name="OP">sqrt</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_round",attributes:{blockId:"math_js_round",weight:80},blockXml:'<block type="math_js_round">\n                        <field name="OP">round</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},a.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[],custom:!0,customClick:e=>(e.showFunctionsFlyout(),!1),attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},a.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",blocks:[{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:90},blockXml:`<block type="variables_set" gap="8">\n                        <field name="VAR" variabletype="">${lf("{id:var}list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="2"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="math_number">\n                                        <field name="NUM">0</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="math_number">\n                                        <field name="NUM">1</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:89},blockXml:`<block type="variables_set">\n                        <field name="VAR" variabletype="">${lf("{id:var}text list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="3"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("a")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("b")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD2">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("c")}</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:5},blockXml:'<block type="lists_create_with">\n                        <mutation items="0"></mutation>\n                    </block>'},{name:"lists_index_get",attributes:{blockId:"lists_index_get",group:"Read",weight:87},blockXml:`<block type="lists_index_get">\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"lists_index_set",attributes:{blockId:"lists_index_set",group:"Modify",weight:86},blockXml:`<block type="lists_index_set">\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_length",attributes:{blockId:"lists_length",group:"Read",weight:88},blockXml:`<block type="lists_length">\n                        <value name="VALUE">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.07,icon:"arrays",groups:["Create","Read","Modify","Operations"],callingConvention:0,paramDefl:{}}},a.text={name:lf("{id:category}Text"),nameid:"text",blocks:[{name:"text",attributes:{blockId:"text",weight:90},blockXml:'<block type="text"></block>'},{name:"text_length",attributes:{blockId:"text_length",weight:89},blockXml:`<block type="text_length">\n                        <value name="VALUE">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"text_join",attributes:{blockId:"text_join",weight:88},blockXml:`<block type="text_join">\n                        <mutation items="2"></mutation>\n                        <value name="ADD0">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                        <value name="ADD1">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("World")}</field>\n                            </shadow>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},a.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!1,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),a}function c(){if(o)return o;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;return e&&(o={name:pxtc.PAUSE_UNTIL_TYPE,attributes:{blockId:pxtc.PAUSE_UNTIL_TYPE,blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight},blockXml:i.Xml.domToText(r.mkPredicateBlock(pxtc.PAUSE_UNTIL_TYPE))}),o}function u(e){return l()[e]}function d(e,t){const n=u(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){let e=100;n.blocks=t.blocks.map(((t,n)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,snippetOnly:e.snippetOnly,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function h(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}n.getPauseUntil=c,n.getBuiltinCategory=u,n.isBuiltin=function(e){return!!l()[e]},n.allBuiltinBlocks=function(){s||(s={},[u("loops"),u("logic"),u("Math"),u("text"),u("arrays")].forEach((e=>{e.blocks.forEach((e=>{e.attributes.blockId&&!s[e.attributes.blockId]&&(s[e.attributes.blockId]=e)}))}))),s[ts.pxtc.ON_START_TYPE]={name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10,group:pxt.appTarget.runtime.onStartGroup||void 0},blockXml:'<block type="pxt-on-start"></block>'};const e=c();return e&&(s[pxtc.PAUSE_UNTIL_TYPE]=e),s},n.clearBuiltinBlockCache=function(){s=void 0},n.overrideCategory=d,n.overrideToolbox=function(e){d("loops",e.loops),d("logic",e.logic),d("variables",e.variables),d("Math",e.maths),d("text",e.text),d("arrays",e.arrays),d("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:h(u("loops")),logic:h(u("logic")),variables:h(u("variables")),maths:h(u("Math")),text:h(u("text")),arrays:h(u("arrays")),functions:h(u("functions"))}}},{"../../pxtblocks":68,blockly:376}],198:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.copyProjectToLegacyEditor=void 0;const i=e("./db"),r=e("./workspace");let o,s;function a(e,t,n){return l(o,s,e,t,n)}function l(e,t,n,i,r){let o="";return(r?t.setAsync({id:n.id,files:r,_rev:i}).then((e=>{o=e})):Promise.resolve()).then((()=>e.setAsync(n))).then((e=>(n._rev=e,o)))}n.copyProjectToLegacyEditor=async function(e,t,n){const r=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[n],o=new i.Table(r?`${r}-header`:"header"),s=new i.Table(r?`${r}-text`:"text");await l(o,s,e,void 0,t)},n.provider={getAsync:async function(e){const t=o.getAsync(e.id),n=s.getAsync(e.id);let[i,r]=await Promise.all([t,n]);if(i&&r)return{header:i,text:r.files,version:r._rev}},setAsync:a,deleteAsync:function(e,t){return o.deleteAsync(e).then((()=>s.deleteAsync({id:e.id,_rev:e._rev})))},listAsync:async function(){return await function(){const e=pxt.semver.parse(pxt.appTarget.versions.target).major,t=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[e];return t?(o=new i.Table(`${t}-header`),s=new i.Table(`${t}-text`),o.getAllAsync().then((t=>{if(t.length)return Promise.resolve();const n=e-1,r=n<0?"":pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[n];let o=new i.Table("header"),s=new i.Table("text");return r&&(o=new i.Table(`${r}-header`),s=new i.Table(`${r}-text`)),o.getAllAsync().then((e=>pxt.Util.promiseMapAll(e,(e=>(e=>s.getAsync(e.id).then((t=>(delete e._id,delete e._rev,a(e,void 0,t.files)))))(e))))).then((()=>{}))}))):(o=new i.Table("header"),s=new i.Table("text"),Promise.resolve())}(),await async function(){const e=new pxt.skillmap.IndexedDBWorkspace;await e.initAsync();const t=await e.getAllProjectsAsync();for(const n of t)n.header.isSkillmapProject=!0,await r.installAsync(n.header,n.text,!0),await e.deleteProjectAsync(n.header.id)}(),o.getAllAsync()},resetAsync:function(){return Promise.resolve()},loadedAsync:function(){var e,t;return null===(t=(e=pxt.commands).workspaceLoadedAsync)||void 0===t?void 0:t.call(e)}}},{"./db":283,"./workspace":354}],199:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Carousel=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./sui"),s=e("./data"),a=e("./util"),l=300;var c,u;(u=c||(c={}))[u.None=0]="None",u[u.X=1]="X",u[u.Y=2]="Y";class d extends s.Component{constructor(e){super(e),this.arrows=[],this.isDragging=!1,this.definitelyDragging=c.None,this.currentOffset=0,this.index=0,this.childrenElements=[],this.handleContainerRef=e=>{this.container=e},this.handleDragSurfaceRef=e=>{this.dragSurface=e},this.handleArrowRefs=e=>{this.arrows.push(e)},this.handleChildRefs=e=>{e&&this.childrenElements.push(e)},this.updateDimensions=()=>{if(this.container){let e=!1;if(this.containerWidth=this.container.getBoundingClientRect().width,this.getArrowWidth(),this.childrenElements.length){const t=this.childrenElements[0].getBoundingClientRect().width;t!==this.childWidth&&(this.childWidth=t,e=!0),this.actualPageLength=Math.floor(this.containerWidth/this.childWidth)}this.dragSurface.style.width=this.totalLength()+"px",this.updateArrows(),this.index>=this.maxIndex()&&(e=!0,this.index=this.maxIndex()),e&&this.setPosition(this.indexToOffset(this.index))}},this.state={},this.childrenElements=[],this.arrows=[],this.onLeftArrowClick=this.onLeftArrowClick.bind(this),this.onRightArrowClick=this.onRightArrowClick.bind(this)}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&this.setIndex(e.selectedIndex)}renderCore(){const{rightDisabled:e,leftDisabled:t}=this.state,n=pxt.Util.isUserLanguageRtl();return(0,i.jsxs)("div",Object.assign({className:"ui carouselouter"},{children:[!t&&(0,i.jsx)("span",Object.assign({role:"button",className:"carouselarrow left aligned",tabIndex:0,title:lf("See previous"),"aria-label":lf("See previous"),onClick:this.onLeftArrowClick,onKeyDown:a.fireClickOnEnter,ref:this.handleArrowRefs},{children:(0,i.jsx)(o.Icon,{icon:"circle angle "+(n?"right":"left")})})),(0,i.jsx)("div",Object.assign({className:"carouselcontainer",ref:this.handleContainerRef},{children:(0,i.jsx)("div",Object.assign({className:"carouselbody",ref:this.handleDragSurfaceRef},{children:r.Children.map(this.props.children,((e,t)=>e?(0,i.jsx)("div",Object.assign({className:"carouselitem "+(this.props.selectedIndex==t?"selected":""),ref:this.handleChildRefs},{children:r.cloneElement(e,{tabIndex:this.isVisible(t)?0:-1})})):void 0))}))})),!e&&(0,i.jsx)("span",Object.assign({role:"button",className:"carouselarrow right aligned",tabIndex:0,title:lf("See more"),"aria-label":lf("See more"),onClick:this.onRightArrowClick,onKeyDown:a.fireClickOnEnter,ref:this.handleArrowRefs},{children:(0,i.jsx)(o.Icon,{icon:"circle angle "+(pxt.Util.isUserLanguageRtl()?"left":"right")})}))]}))}onLeftArrowClick(){this.onArrowClick(!0)}onRightArrowClick(){this.onArrowClick(!1)}onArrowClick(e){const t=this.index,n=this.container.scrollLeft;this.setIndex(e?this.index-this.actualPageLength:this.index+this.actualPageLength);const{tickId:i}=this.props;if(i&&pxt.tickEvent("carousel.arrow.click",{tickId:i,index:this.index,left:e?-1:1},{interactiveConsent:!0}),e){const e=this.index+this.actualPageLength<t?this.index+this.actualPageLength:t-1;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}else{const e=this.index>t+this.actualPageLength?this.index:t+this.actualPageLength;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}this.container.scrollLeft=n}componentDidMount(){this.initDragSurface(),this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){this.updateDimensions()}initDragSurface(){let e=e=>{this.definitelyDragging=c.None,this.dragStart(p(e),f(e))},t=e=>{this.isDragging&&(this.dragEnd(),this.definitelyDragging&&(e.preventDefault(),e.stopPropagation()))},n=e=>{this.isDragging&&this.dragEnd()},i=e=>{if(this.isDragging){let t=p(e);if(!this.definitelyDragging){let n=f(e);Math.abs(t-this.dragStartX)>5?this.definitelyDragging=c.X:Math.abs(n-this.dragStartY)>5&&(this.definitelyDragging=c.Y)}this.definitelyDragging==c.X&&(e.stopPropagation(),e.preventDefault(),window.requestAnimationFrame((()=>{this.dragMove(t)})))}};this.dragSurface.addEventListener("click",(e=>{this.definitelyDragging&&(e.stopPropagation(),e.preventDefault())})),window.PointerEvent?(this.dragSurface.addEventListener("pointerdown",e),this.dragSurface.addEventListener("pointerup",t),this.dragSurface.addEventListener("pointerleave",n),this.dragSurface.addEventListener("pointermove",i)):(this.dragSurface.addEventListener("mousedown",e),this.dragSurface.addEventListener("mouseup",t),this.dragSurface.addEventListener("mouseleave",n),this.dragSurface.addEventListener("mousemove",i),pxt.BrowserUtils.isTouchEnabled()&&(this.dragSurface.addEventListener("touchstart",e),this.dragSurface.addEventListener("touchend",t),this.dragSurface.addEventListener("touchcancel",n),this.dragSurface.addEventListener("touchmove",i)))}dragStart(e,t){this.isDragging=!0,this.dragStartX=e,this.dragStartY=t,this.dragStartOffset=this.currentOffset,this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=0)}dragEnd(){this.isDragging=!1,this.calculateIndex()}dragMove(e){this.dragOffset=e-this.dragStartX;const t=pxt.Util.isUserLanguageRtl()?this.dragStartOffset+this.dragOffset:this.dragStartOffset-this.dragOffset;this.setPosition(t)}setPosition(e){this.dragSurface&&(e=Math.min(Math.max(e,-300),this.maxScrollOffset()),this.currentOffset=e,pxt.Util.isUserLanguageRtl()?this.dragSurface.style.marginRight=-e+"px":this.dragSurface.style.marginLeft=-e+"px")}calculateIndex(){if(this.dragSurface){const e=Math.round(Math.max(this.currentOffset,0)/this.childWidth);let t;t=this.currentOffset>this.dragStartOffset?e:e-1,this.setIndex(t,200)}}setIndex(e,t){const n=Math.max(Math.min(e,this.maxIndex()),0);t||(t=100*Math.abs(n-this.index)),this.index=n,this.updateArrows(),this.animation=new h(this.currentOffset,this.indexToOffset(this.index),t),this.animationId||(this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}isVisible(e){return e>=this.index&&e<this.index+(this.actualPageLength||4)}easeTowardsIndex(e){this.dragSurface&&(this.setPosition(this.animation.getPosition(e)),this.animation.isComplete?(this.animation=void 0,this.animationId=0):this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}indexToOffset(e){return e<=0?0:e===this.maxIndex()?this.totalLength()-this.containerWidth-l+2*this.arrowWidth:e*this.childWidth-this.childWidth*this.props.bleedPercent/100}totalLength(){return r.Children.count(this.props.children)*this.childWidth+l}getArrowWidth(){this.arrows.length&&(this.arrowWidth=0,this.arrows.forEach((e=>{e&&(this.arrowWidth=Math.max(e.getBoundingClientRect().width,this.arrowWidth))})))}maxScrollOffset(){return Math.max(this.totalLength()-this.actualPageLength*this.childWidth+l,0)}maxIndex(){return Math.max(this.childrenElements.length-this.actualPageLength,0)}updateArrows(){const{rightDisabled:e,leftDisabled:t}=this.state||{},n=this.index===this.maxIndex(),i=0===this.index;n===e&&i===t||this.setState({leftDisabled:i,rightDisabled:n})}}n.Carousel=d;class h{constructor(e,t,n){this.start=e,this.end=t,this.millis=n,this.isComplete=!1,this.slope=(t-e)/n}getPosition(e){if(this.isComplete)return this.end;if(void 0===this.startTime)return this.startTime=e,this.start;const t=e-this.startTime;return t>this.millis?(this.isComplete=!0,this.end):this.start+Math.floor(this.slope*t)}}function p(e){return"screenX"in e?e.screenX:e.changedTouches[0].screenX}function f(e){return"screenY"in e?e.screenY:e.changedTouches[0].screenY}},{"./data":282,"./sui":346,"./util":352,react:548,"react/jsx-runtime":549}],200:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.init=n.HEADER_CLOUDSTATE=n.requestProjectCloudStatus=n.saveLocalProjectsToCloudAsync=n.convertCloudToLocal=n.forceReloadForCloudSync=n.syncAsync=n.getCloudTempMetadata=n.CloudTempMetadata=n.shareAsync=n.excludeCloudMetadataFields=n.excludeLocalOnlyMetadataFields=void 0;const i=e("./core"),r=e("./auth"),o=e("./data"),s=e("./workspace"),a=e("./app"),l=e("../../pxteditor");var c=pxt.Util;const u=["_rev","_id","cloudVersion","cloudCurrent","cloudLastSyncTime"],d=["cloudVersion","cloudCurrent","cloudLastSyncTime","cloudUserId"];function h(e,t){const n=Object.assign({},e);for(let e of t)delete n[e];return n}function p(e){return h(e,u)}function f(e){return h(e,d)}function g(e){return new Promise((async(t,n)=>{var i;const o=y(e.id);try{pxt.debug(`downloading from cloud: '${O(e)}`),o.syncInProgress();const s=await r.apiAsync(`/api/user/project/${e.id}`);if(s.success){const e=null===(i=r.userProfile())||void 0===i?void 0:i.id,n=s.resp,o={header:p(JSON.parse(n.header)),text:JSON.parse(n.text),version:n.version};o.header.cloudCurrent=!0,o.header.cloudVersion=o.version,o.header.cloudUserId=e,o.header.cloudLastSyncTime=c.nowSeconds(),pxt.tickEvent("identity.cloudApi.getProject.success"),t(o)}else pxt.tickEvent("identity.cloudApi.getProject.failed"),n(s.err)}catch(e){pxt.tickEvent("identity.cloudApi.getProject.failed"),n(e)}finally{o.syncFinished()}}))}n.excludeLocalOnlyMetadataFields=p,n.excludeCloudMetadataFields=f,n.shareAsync=function(e,t){return new Promise((async(n,i)=>{const o=y(e);try{o.syncInProgress();const e=await r.apiAsync("/api/user/project/share",t,"POST");e.success?n(e.resp):i(e.err)}finally{o.syncFinished()}}))};class m{constructor(e){this.headerId=e}get justSynced(){return this._justSynced}syncInProgress(){this._syncStartTime=c.nowSeconds(),o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`)}syncFinished(){this._syncStartTime=0,this._justSynced=!0,o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`),setTimeout((()=>{0===this._syncStartTime&&(this._justSynced=!1,o.invalidate(`${n.HEADER_CLOUDSTATE}:${this.headerId}`))}),1500)}cloudStatus(){const e=s.getHeader(this.headerId);if(e&&e.cloudUserId)return r.loggedIn()?this._syncStartTime>0?pxt.cloud.cloudStatus.syncing:e.cloudCurrent?this.justSynced?pxt.cloud.cloudStatus.justSynced:e.cloudLastSyncTime>0?pxt.cloud.cloudStatus.synced:void pxt.reportError("cloudsave",`Invalid project cloud state for project ${O(e)}: user: ${e.cloudUserId}, inProg: ${this._syncStartTime}, cloudCurr: ${e.cloudCurrent}, lastCloud: ${e.cloudLastSyncTime}`):pxt.cloud.cloudStatus.localEdits:pxt.cloud.cloudStatus.offline}}n.CloudTempMetadata=m;const b={};function y(e){return b[e]||(b[e]=new m(e)),b[e]}let v;async function _(e){return r.hasIdentity()&&r.loggedIn()?(e=null!=e?e:{},v||(v=async function(e){var t;try{const n=!e.hdrs;n&&(e.hdrs=w()),pxt.debug(`Synchronizing ${e.hdrs.length} local project(s) with the cloud...`);const i=w(e.hdrs),a=c.nowSeconds();pxt.tickEvent("identity.sync.start");const l=e=>a-e+" seconds ago",u=await async function(e){return new Promise((async(t,n)=>{var i;const o={};(null==e?void 0:e.length)&&(o.projectIds=e.map((e=>e.id)).join(","));const s=pxt.Util.stringifyQueryString("/api/user/project",o),a=await r.apiAsync(s);if(a.success){const e=c.nowSeconds(),n=null===(i=r.userProfile())||void 0===i?void 0:i.id,o=a.resp.map((t=>{const i=p(JSON.parse(t.header));return i.cloudUserId=n,i.cloudCurrent=!0,i.cloudLastSyncTime=e,i.cloudVersion=t.version,i}));pxt.tickEvent("identity.cloudApi.list.success",{count:o.length}),t(o)}else pxt.tickEvent("identity.cloudApi.list.failed"),n(a.err)}))}(n?void 0:e.hdrs),d=u.length-i.length;0!==d&&pxt.debug(`${Math.abs(d)} ${d>0?"more":"fewer"} projects found in the cloud.`);const h=u.length?Math.max(...u.map((e=>e.modificationTime))):a;pxt.debug(`Last cloud project change was ${l(h)}`);const f=c.toDictionary(u,(e=>e.id)),g={},m=E,b=async(e,t)=>{const n=await T(e,t);if(n)return g[n.id]=n,n};let y=[];const v=10;e.direction&&"up"!==e.direction||await c.promisePoolAsync(v,i,(async function(e){const t=O(e);try{if(!e.cloudCurrent)if(e.isDeleted){if("succeeded"!==(await m(e,null)).status)throw new Error(`Failed to save deleted ${t} to the cloud.`)}else{const n=f[e.id];if(n){const i=await m(e,e.cloudVersion);if("conflict"===i.status)await x(e,n);else if("succeeded"!==i.status)throw new Error(`Failed to save ${t} to the cloud.`)}else if("succeeded"!==(await m(e,null)).status)throw pxt.tickEvent("identity.sync.failed.localNewProjectSyncUpFailed"),new Error(`Failed to save new ${t} to the cloud.`)}}catch(e){y.push(e)}})),e.direction&&"down"!==e.direction||await c.promisePoolAsync(v,u,(async function(e){if(null==e?void 0:e.id)try{const t=O(e),n=s.getHeader(e.id);if(n){if(n.cloudVersion!==e.cloudVersion)if(n.cloudCurrent){if(!await b(n,e))throw new Error(`Failed to download cloud project ${t}`)}else await x(n,e)}else if(!e.isDeleted&&!await b(n,e))throw new Error(`Failed to import new cloud project ${t}`)}catch(e){y.push(e)}})),y.forEach((e=>pxt.debug(e))),y=[];const _=c.nowSeconds()-a;return pxt.tickEvent("identity.sync.finished",{elapsed:_,provider:pxt.auth.identityProviderId(null===(t=pxt.auth.cachedUserState)||void 0===t?void 0:t.profile)}),o.invalidate("headers:"),c.values(g)}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.failed",{exception:e})}return[]}(e).then((e=>e)).finally((()=>{v=void 0}))),v):[]}async function E(e,t){const n=await s.getTextAsync(e.id);s.acquireHeaderSession(e);const i=await function(e,t,n){return new Promise((async(i,o)=>{var s;const a=y(e.id);try{pxt.debug(`uploading to cloud: ${O(e)}`);const l=null===(s=r.userProfile())||void 0===s?void 0:s.id;e.cloudUserId=l,e.cloudCurrent=!1,e.cloudVersion=t,a.syncInProgress();const u={id:e.id,header:JSON.stringify(p(e)),text:n?JSON.stringify(n):void 0,version:t},d=await r.apiAsync("/api/user/project",u);d.success?(e.cloudCurrent=!0,e.cloudVersion=d.resp,e.cloudLastSyncTime=c.nowSeconds(),pxt.tickEvent("identity.cloudApi.setProject.success"),i({header:e,status:"succeeded"})):409===d.statusCode?(pxt.tickEvent("identity.cloudApi.setProject.conflict"),i({header:e,status:"conflict"})):(pxt.tickEvent("identity.cloudApi.setProject.failed"),o(d.err))}finally{a.syncFinished()}}))}(e,t,n);return"succeeded"===i.status?(await s.saveAsync(e,null,!0),i.header=s.getHeader(e.id)):pxt.tickEvent("identity.toCloud.failed"),i}async function T(e,t){if(e){const n=Object.assign(Object.assign({},e),t);s.acquireHeaderSession(e);const i=await g(e);return await s.saveAsync(n,i.text,!0),s.getHeader(n.id)}if(t){const e=Object.assign({},t);s.acquireHeaderSession(t);const n=await g(t);return await s.importAsync(e,n.text,!0),s.getHeader(e.id)}pxt.tickEvent("identity.fromCloud.failed")}async function x(e,t){var n;pxt.debug(`cloud conflict detected for ${O(e)}`);const r=function(e){return e.name+lf(" - Copy")}(e);let o=await s.duplicateAsync(e,r);pxt.tickEvent("identity.sync.conflict.createdDuplicate");let l=!1;try{if(a.hasEditor()){const t=await a.getEditorAsync();t.state.home||(null===(n=t.state.header)||void 0===n?void 0:n.id)!==e.id||await t.loadHeaderAsync(o,t.state.editorState,!1)}}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.reloadEditorFailed",{exception:e}),l=!0}try{e=await T(e,t)}catch(e){throw pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.overwriteLocalFailed",{exception:e}),pxt.tickEvent("identity.sync.conflict.failed"),e}try{i.dialogAsync({header:lf("Project '{0}' had a conflict!",e.name),body:lf("Project '{0}' was edited in two places and the changes conflict. The changes on this computer have been saved to '{1}'. The changes made elsewhere remain in '{2}'.",e.name,o.name,e.name),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1})}catch(e){pxt.reportException(e),l=!0}l?pxt.tickEvent("identity.sync.conflict.failed"):pxt.tickEvent("identity.sync.conflict.success")}function w(e){var t;const n=null===(t=r.userProfile())||void 0===t?void 0:t.id;return(e||s.getHeaders(!0,!1)).filter((e=>e.cloudUserId&&e.cloudUserId===n))}n.getCloudTempMetadata=y,n.syncAsync=_,n.forceReloadForCloudSync=function(){i.infoNotification(lf("Cloud synchronization finished. Reloading... ")),setTimeout((()=>{pxt.debug("cloud forcing reload."),pxt.tickEvent("identity.sync.forcingReload"),location.reload()}),3e3)},n.convertCloudToLocal=async function(e){if(e){const t=s.getHeaders(!1,!1,e).filter((t=>t.cloudUserId&&t.cloudUserId===e)),n=[];t.forEach((e=>{e=f(e),n.push(s.forceSaveAsync(e,null,!0))})),await Promise.all(n)}},n.saveLocalProjectsToCloudAsync=async function(e){const t=s.getHeaders().filter((e=>null==e.cloudUserId)).filter((t=>e.includes(t.id)));if(t.length){const e={},n=[];for(const i of t){const t=await s.duplicateAsync(i,i.name);e[i.id]=t.id,n.push(t)}return await _({hdrs:n,direction:"up"}),e}},n.requestProjectCloudStatus=async function(e){for(const t of e){const e=y(t),n=e.cloudStatus(),i={type:"pxthost",action:"projectcloudstatus",headerId:e.headerId,status:n.value};l.postHostMessageAsync(i),l.postHostMessageAsync(Object.assign(Object.assign({},i),{type:"pxteditor"}))}};let k={},S=0,C=0;const A={subscriptions:[],onDataChanged:e=>{const t=e.split("header:");c.assert(2===t.length,"onHeaderChangeSubscriber has invalid path subscription: "+e);const n=t[1];if("*"===n)w().forEach((e=>I(e)));else{const e=s.getHeader(n);e?I(e):pxt.debug("cannot find header with id: "+n)}}};async function I(e){var t;if(!r.hasIdentity())return;if(!r.loggedIn())return;if(e.cloudUserId!==(null===(t=r.userProfile())||void 0===t?void 0:t.id)||e.cloudCurrent)return;if(s.isHeaderSessionOutdated(e))return;k[e.id]=!0,clearTimeout(S);const n=async()=>{C=0,await async function(){try{await v}catch(e){v=void 0}const e=w().filter((e=>k[e.id]));k={},_({hdrs:e,direction:"up"})}()};C||(C=c.now()),15e3<c.now()-C?await n():S=setTimeout(n,3e3)}function O(e){return`'${e.name}' (${e.id.substr(0,5)}...)`}function N(e){return"*"==(e=o.stripProtocol(e))?s.getHeaders().map((e=>y(e.id))):y(e)}n.HEADER_CLOUDSTATE="header-cloudstate",n.init=function(){o.mountVirtualApi(n.HEADER_CLOUDSTATE,{getSync:N}),o.subscribe(A,"header:*")}},{"../../pxteditor":134,"./app":190,"./auth":194,"./core":279,"./data":282,"./workspace":354}],201:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loginCheck=n.syncAsync=n.refreshToken=n.resetAsync=n.ensureGitHubTokenAsync=n.githubProvider=n.reconstructMeta=n.ProviderBase=n.setOauth=n.OAUTH_REMEMBER_STATE=n.OAUTH_HASH=n.OAUTH_REDIRECT=n.OAUTH_STATE=n.OAUTH_TYPE=void 0;const i=e("./core"),r=e("./data");var o=pxt.Util;const s=o.lf;let a,l;function c(e){const t=new Error(e);return t.isUserError=!0,t.isSyncError=!0,t}n.OAUTH_TYPE="oauthType",n.OAUTH_STATE="oauthState",n.OAUTH_REDIRECT="oauthRedirect",n.OAUTH_HASH="oauthHash",n.OAUTH_REMEMBER_STATE="oauthRememberState";const u="token",d="tokenExp",h="AutoLogin",p="cloudUser";function f(e,t,i,r){const o=ts.pxtc.Util.guidGen();return pxt.storage.setLocal(n.OAUTH_TYPE,e),pxt.storage.setLocal(n.OAUTH_STATE,o),pxt.storage.setLocal(n.OAUTH_REDIRECT,i||window.location.hash),pxt.storage.setLocal(n.OAUTH_HASH,r),t?pxt.storage.setLocal(n.OAUTH_REMEMBER_STATE,o):pxt.storage.removeLocal(n.OAUTH_REMEMBER_STATE),o}function g(){pxt.storage.removeLocal(n.OAUTH_TYPE),pxt.storage.removeLocal(n.OAUTH_STATE),pxt.storage.removeLocal(n.OAUTH_REDIRECT),pxt.storage.removeLocal(n.OAUTH_HASH),pxt.storage.removeLocal(n.OAUTH_REMEMBER_STATE)}n.setOauth=f;n.ProviderBase=class{constructor(e,t,n,i){this.name=e,this.friendlyName=t,this.icon=n,this.urlRoot=i,this._token=pxt.storage.getLocal(this.name+u)}syncError(e){throw c(e)}user(){return pxt.Util.jsonTryParse(pxt.storage.getLocal(this.name+p))}setUser(e){e?pxt.storage.setLocal(this.name+p,JSON.stringify(e)):pxt.storage.removeLocal(this.name+p),r.invalidate("sync:user"),r.invalidate("github:user")}token(){if(!this.hasTokenExpired())return this._token}reqAsync(e){const t=this.token();if(!t)throw this.pleaseLogin();return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,/^https:\/\//.test(e.url)||(e.url=this.urlRoot+e.url),e.allowHttpErrors=!0,o.requestAsync(e)}getJsonAsync(e){return this.reqAsync({url:e}).then((t=>{if(t.statusCode<300)return t.json;throw this.syncError(s("Invalid {0} response {1} at {2}",this.friendlyName,t.statusCode,e))}))}fileSuffix(){return".mkcd-"+pxt.appTarget.id}createFileNameWithSuffix(e){return e.replace(/[~"#%&*:<>?/\\{|}]+/g,"_")+this.fileSuffix()}parseTime(e){return Math.round(new Date(e).getTime()/1e3)}pleaseLogin(){let e=s("Please log in to {0}",this.friendlyName);i.infoNotification(e);let t=c(e);return t.isLoginError=!0,t}loginCheck(){if(this.token())if(this.hasTokenExpired()){if(pxt.storage.getLocal(this.name+h))return void this.pleaseLogin();pxt.storage.setLocal(this.name+h,"yes"),this.loginAsync(void 0,!0).then((e=>e&&this.setNewToken(e.accessToken,e.rememberMe,e.expiresIn)))}else(e=this)!==l&&(l=e,v());var e}loginAsync(e,t){return o.userError("Not implemented"),Promise.resolve(void 0)}loginInner(){var e,t;const n=this.name;i.showLoading(n+"login",s("Signing you in to {0}...",this.friendlyName));const r=f(n,!1),o=null===(t=null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.cloudProviders)||void 0===t?void 0:t[this.name],a=window.location.protocol+"//"+window.location.host+"/oauth-redirect",l={client_id:o.client_id,response_type:"token",state:r,redirect_uri:a,scope:"",expires_in:86400};return o.redirect&&(l.redirect=o.redirect),l}loginCompleteInner(){const e=this.name;i.hideLoading(e+"login")}loginCallback(e,t){const n=this.name;pxt.storage.removeLocal(n+h),this.setNewToken(t.access_token,e,parseInt(t.expires_in)),this.setUser(void 0)}setNewToken(e,t,n){const i=this.name,r=i+u,o=i+d;if(this._token=e,!t)return pxt.debug("token storage non-opted in"),pxt.storage.removeLocal(r),void pxt.storage.removeLocal(o);if(e)if(pxt.storage.setLocal(r,e),n){let e=Math.round(Date.now()/1e3+.75*n);pxt.storage.setLocal(o,e+"")}else pxt.storage.removeLocal(o);else pxt.storage.removeLocal(r),pxt.storage.removeLocal(o);v()}hasTokenExpired(){const e=parseInt(pxt.storage.getLocal(this.name+d)||"0");return!(!e||e<o.nowSeconds())}logout(){pxt.storage.removeLocal(this.name+u),pxt.storage.removeLocal(this.name+d),pxt.storage.removeLocal(this.name+h),this._token=void 0,this.setUser(void 0),v()}},n.reconstructMeta=function(e){let t=JSON.parse(e[pxt.CONFIG_NAME]),n={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,editor:pxt.BLOCKS_PROJECT_NAME,name:t.name},source:JSON.stringify(e)},i=JSON.parse(e[".cloudheader.json"]||"{}");return i&&(i.editor&&(n.meta.editor=i.editor),i.target&&(n.meta.cloudId=pxt.CLOUD_ID+i.target),i.targetVersion&&(n.meta.targetVersions={target:i.targetVersion})),n};const m=e("./githubprovider");function b(){if(!a){a={};const e=pxt.appTarget.cloud;if(e&&e.githubPackages){const e=new m.GithubProvider;a[e.name]=e}}return pxt.Util.values(a)}function y(e){const t=b().filter((e=>e.name==m.PROVIDER_NAME))[0];return!t&&e&&o.userError(s("GitHub not configured in this editor.")),t}function v(){r.invalidate("sync:status"),r.invalidate("sync:user"),r.invalidate("sync:loggedin"),r.invalidate("sync:provider"),r.invalidate("sync:providericon"),r.invalidate("github:user")}n.githubProvider=y,n.ensureGitHubTokenAsync=async function(){await y(!0).loginAsync(),pxt.github.token||o.userError(s("Please sign in to GitHub to perform this operation."))},n.resetAsync=function(){const e=y(),t=e&&e.hasToken();return l&&l.logout(),l=null,pxt.storage.removeLocal("cloudId"),g(),v(),t&&e.logout(),Promise.resolve()},n.refreshToken=function(){l&&l.loginAsync(void 0,!0)},n.syncAsync=function(){return function(){const e=y();return e?function(e){return e?e.user()?Promise.resolve():e.getUserInfoAsync().then((t=>t?(t.initials||(t.initials=o.initials(t.name)),e.setUser(t),null):Promise.resolve())):Promise.resolve()}(e):Promise.resolve()}().then((()=>{}))},n.loginCheck=function(){const e=b();if(e.length){{const t=o.parseQueryString(pxt.storage.getLocal(n.OAUTH_HASH)||"");if(t.access_token){const i=pxt.storage.getLocal(n.OAUTH_TYPE),r=e.filter((e=>e.name==i))[0];if(r){pxt.storage.removeLocal(n.OAUTH_HASH);const e=t.state===pxt.storage.getLocal(n.OAUTH_REMEMBER_STATE);r.loginCallback(e,t)}g()}}{const t=o.parseQueryString((location.hash||"#").slice(1).replace(/%23access_token/,"access_token"));if(t.access_token){const i=pxt.storage.getLocal(n.OAUTH_STATE),r=pxt.storage.getLocal(n.OAUTH_TYPE);if(i&&i==t.state){pxt.storage.removeLocal(n.OAUTH_STATE),pxt.storage.removeLocal(n.OAUTH_TYPE);const i=t.state===pxt.storage.getLocal(n.OAUTH_REMEMBER_STATE),o=e.filter((e=>e.name==r))[0];if(o){o.loginCallback(i,t);const e=pxt.storage.getLocal(n.OAUTH_REDIRECT)||"";location.hash=e}}g()}}for(const t of e)t.loginCheck()}},r.mountVirtualApi("sync",{getSync:function(e){const t=l;switch(r.stripProtocol(e)){case"user":return t&&t.user();case"loggedin":return!!t;case"status":return"";case"provider":return t&&t.name;case"providericon":return t?t.icon:"user"}return null}}),r.mountVirtualApi("github",{getSync:function(e){const t=y();switch(r.stripProtocol(e)){case"user":return t&&t.user()}return null}}),r.mountVirtualApi("ping",{getAsync:function(e){const t=r.stripProtocol(e);if(/\.ico$/.test(e)){const e=pxt.BrowserUtils.isEdge()?t:`${t}?v=${Math.random()}&origin=${encodeURIComponent(window.location.origin)}`,n=document.createElement("img");return new Promise(((t,i)=>{n.onload=()=>t(!0),n.onerror=()=>t(!1),n.src=e}))}return pxt.Util.requestAsync({url:t,method:"GET",allowHttpErrors:!0}).then((e=>200===e.statusCode||403==e.statusCode||400==e.statusCode)).catch((e=>!1))},expirationTime:e=>864e5,isOffline:()=>!pxt.Cloud.isOnline()})},{"./core":279,"./data":282,"./githubprovider":300}],202:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showUnsupportedHardwareMessageAsync=n.handleServiceWorkerMessageAsync=n.disconnectAsync=n.showDisconnectAsync=n.pairAsync=n.maybeReconnectAsync=n.initAsync=n.setExtensionResult=n.hidDeployCoreAsync=n.nativeHostLongpressAsync=n.nativeHostBackAsync=n.isNativeHost=n.nativeHostPostMessageFunction=n.browserDownloadDeployCoreAsync=void 0;const i=e("./core"),r=e("./electron"),o=e("./package"),s=e("./hidbridge"),a=e("./webusb"),l=e("./data"),c=e("./dialogs");var u=pxt.Cloud;const d=e("./dialogs"),h=e("../../pxtblocks");function p(e){pxt.debug(`cmds: ${e}`)}let f;function g(e,t,n){return pxt.BrowserUtils.browserDownloadBinText(e,t,{contentType:n,onError:e=>i.errorNotification(lf("saving file failed..."))}),Promise.resolve()}function m(e){let t="";const n=pxt.outputName().replace(/[^.]*/,""),r=e.outfiles[pxt.outputName()],s=o.genFileName(n),a=pxt.BrowserUtils.isBrowserDownloadWithinUserContext();return a?t=pxt.BrowserUtils.toDownloadDataUri(pxt.isOutputText()?ts.pxtc.encodeBase64(r):r,pxt.appTarget.compile.hexMimeType):pxt.isOutputText()?(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBinText(r,s,{contentType:pxt.appTarget.compile.hexMimeType,userContextWindow:e.userContextWindow,onError:e=>i.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})):(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBase64(r,s,{contentType:"application/x-uf2",userContextWindow:e.userContextWindow,onError:e=>i.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})),e.success?!a&&pxt.BrowserUtils.isBrowserDownloadInSameWindow()||!e.saveOnly&&(0,d.isDontShowDownloadDialogFlagSet)()?Promise.resolve().then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):pxt.commands.showUploadInstructionsAsync(s,t,i.confirmAsync,e.saveOnly,(()=>x(e))).then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):Promise.resolve()}function b(e,t,n,r,o){var s,a;const l=pxt.appTarget.appTheme.boardName||lf("device"),c=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",u=pxt.BrowserUtils.isBrowserDownloadWithinUserContext(),d=!pxt.BrowserUtils.isIE()&&!pxt.BrowserUtils.isEdge(),h=pxt.appTarget.appTheme.usbDocs,p=pxt.appTarget.compile.useUF2?".uf2":".hex",f=!u&&(null===(a=(s=pxt.commands).renderBrowserDownloadInstructions)||void 0===a?void 0:a.call(s,r,o)),g=u?lf("Click 'Download' to open the {0} app.",pxt.appTarget.appTheme.boardName):!f&&lf("Move the {0} file to the {1} drive to transfer the code into your {2}.",p,c,l),m=pxt.BrowserUtils.isBrowserDownloadWithinUserContext()?0:1e4;return n({header:u?lf("Download ready..."):lf("Download completed..."),body:g,jsx:f,hasCloseIcon:!0,hideAgree:!0,helpUrl:h,bigHelpButton:!0,className:"downloaddialog",buttons:[d&&{label:u?lf("Download"):lf("Download Again"),className:u?"primary":"lightgrey",urlButton:!0,url:t,fileName:e},{label:lf("Done"),className:"primary",onclick:()=>{pxt.tickEvent("downloaddialog.done"),i.hideDialog()}}],timeout:m}).then((()=>{}))}function y(){const e=window.webkit;if(e&&e.messageHandlers&&e.messageHandlers.host&&e.messageHandlers.host.postMessage)return t=>e.messageHandlers.host.postMessage(t);const t=window.android;return t&&t.postMessage?e=>t.postMessage(JSON.stringify(e)):void 0}function v(){return!!y()}function _(e){p("native deploy"),i.infoNotification(lf("Flashing device..."));const t=e.outfiles[pxt.outputName()];return y()({name:e.downloadFileBaseName,download:t}),Promise.resolve()}function E(e){p("native save"),i.infoNotification(lf("Saving file..."));const t=e.outfiles[pxt.outputName()];return y()({name:e.downloadFileBaseName,save:t}),Promise.resolve()}function T(){p("native workspace loaded");const e=y();return e&&e({cmd:"workspaceloaded"}),Promise.resolve()}async function x(e,t){if(pxt.tickEvent("hid.deploy"),p("hid deploy"),!e.success)return p("compilation failed, use browser deploy instead"),m(e);const n="hiddeploy";P=!0;try{await pxt.Util.promiseTimeout(12e4,(async()=>{const t=await pxt.packetio.initAsync(!1);i.showLoading(n,lf("Downloading..."));try{await t.reflashAsync(e,(e=>{i.updateLoadingCompletion(n,e)})),await t.reconnectAsync()}finally{i.hideLoading(n)}})())}catch(n){return"repairbootloader"===n.type?(await C(),x(e,t)):("timeout"===n.message?(pxt.tickEvent("hid.flash.timeout"),p("flash timeout")):"devicenotfound"===n.type?(pxt.tickEvent("hid.flash.devicenotfound"),p("device not found")):19==n.code||"devicelocked"===n.type?(pxt.tickEvent("hid.flash.devicelocked"),p("error: device locked")):(pxt.tickEvent("hid.flash.error"),p(`hid error ${n.message}`),pxt.reportException(n),t&&t.reportError(n.message)),m(e))}finally{P=!1}}function w(e){return p("local deploy"),i.infoNotification(lf("Uploading...")),pxt.Util.requestAsync({url:"/api/deploy",headers:{Authorization:u.localToken},method:"POST",data:e,allowHttpErrors:!0}).then((e=>{200!==e.statusCode?i.errorNotification(lf("There was a problem, please try again")):0===e.json.boardCount&&i.warningNotification(lf("Please connect your {0} to your computer and try again",pxt.appTarget.appTheme.boardName))}))}function k(){const e=f;e&&(e.mkPacketIOWrapper&&(p("extension mkPacketIOWrapper"),pxt.packetio.mkPacketIOWrapper=e.mkPacketIOWrapper),e.deployAsync&&(p("extension deploy core async"),pxt.commands.deployCoreAsync=e.deployAsync),e.saveOnlyAsync&&(p("extension save only async"),pxt.commands.saveOnlyAsync=e.saveOnlyAsync),e.saveProjectAsync&&(p("extension save project async"),pxt.commands.saveProjectAsync=e.saveProjectAsync),e.renderBrowserDownloadInstructions?(p("extension upload renderBrowserDownloadInstructions"),pxt.commands.renderBrowserDownloadInstructions=e.renderBrowserDownloadInstructions):pxt.commands.renderBrowserDownloadInstructions=c.renderBrowserDownloadInstructions,e.renderUsbPairDialog&&(p("extension renderUsbPairDialog"),pxt.commands.renderUsbPairDialog=e.renderUsbPairDialog),e.renderIncompatibleHardwareDialog?(p("extension renderIncompatibleHardwareDialog"),pxt.commands.renderIncompatibleHardwareDialog=e.renderIncompatibleHardwareDialog):pxt.commands.renderIncompatibleHardwareDialog=c.renderIncompatibleHardwareDialog,e.showUploadInstructionsAsync&&(p("extension upload instructions async"),pxt.commands.showUploadInstructionsAsync=e.showUploadInstructionsAsync),e.patchCompileResultAsync&&(p("extension build patch"),pxt.commands.patchCompileResultAsync=e.patchCompileResultAsync),e.blocklyPatch&&(p("extension blockly patch"),h.external.setExtensionBlocklyPatch(e.blocklyPatch)),e.webUsbPairDialogAsync&&(p("extension webusb pair dialog"),pxt.commands.webUsbPairDialogAsync=e.webUsbPairDialogAsync),e.onTutorialCompleted&&(p("extension tutorial completed"),pxt.commands.onTutorialCompleted=e.onTutorialCompleted),e.showProgramTooLargeErrorAsync&&(p("extension showProgramTooLargeErrorAsync"),pxt.commands.showProgramTooLargeErrorAsync=e.showProgramTooLargeErrorAsync))}async function S(e=!1,t=!1){return p("[CLIENT]: starting reconnect"),!(!t||!pxt.packetio.isConnected()||B)||D||(D=(async()=>{try{await async function(){var e;if(M)return;return O?Promise.reject("Already waiting for packet lock"):await async function(){if(void 0!==L)return L;const e=new Promise((e=>{R=e,j({type:"serviceworkerclient",action:"packet-io-supported"})}));try{await pxt.U.promiseTimeout(1e3,e),L=!0}catch(e){p("[CLIENT]: old version of service worker, ignoring lock"),L=!1}return L}()&&(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)?new Promise(((e,t)=>{O=e,N=t,p("[CLIENT]: requesting lock "+I),j({type:"serviceworkerclient",action:"request-packet-io-lock",lock:I})})).finally((()=>{O=void 0,N=void 0})):void 0}();const t=await pxt.packetio.initAsync();if(!t)return!1;try{return await t.reconnectAsync(),!0}catch(t){if("devicenotfound"==t.type)return!!e&&C();throw t}}finally{D=void 0}})())}async function C(e){switch(pxt.tickEvent("cmds.pair"),await pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,i.confirmAsync,e)){case pxt.commands.WebUSBPairResult.Success:try{return await S(!1,!0),!0}catch(e){return i.infoNotification(lf("Oops, connection failed.")),!1}case pxt.commands.WebUSBPairResult.Failed:return i.infoNotification(lf("Oops, no device was paired.")),!1;case pxt.commands.WebUSBPairResult.UserRejected:return!1}}function A(){return p("[CLIENT]: starting disconnect"),B=!0,pxt.packetio.disconnectAsync().then((()=>{p("[CLIENT]: sending confirmed disconnect "+I),M=!1,j({type:"serviceworkerclient",action:"release-packet-io-lock",lock:I}),B=!1}))}n.browserDownloadDeployCoreAsync=m,n.nativeHostPostMessageFunction=y,n.isNativeHost=v,n.nativeHostBackAsync=function(){p("native back");const e=y();return e&&e({cmd:"backtap"}),Promise.resolve()},n.nativeHostLongpressAsync=function(){p("native longpress");const e=y();return e&&e({cmd:"backpress"}),Promise.resolve()},n.hidDeployCoreAsync=x,n.setExtensionResult=function(e){f=e,k()},n.initAsync=async function e(){var t,n,i,o,l,c,d,h,f,y,S,C,A,I;p("cmds init"),pxt.onAppTargetChanged=()=>{p("app target changed"),e()},await pxt.usb.checkAvailableAsync(),await pxt.packetio.disconnectAsync(),pxt.packetio.mkPacketIOWrapper=void 0,pxt.commands.renderDisconnectDialog=void 0,pxt.commands.deployCoreAsync=m,pxt.commands.browserDownloadAsync=g,pxt.commands.saveOnlyAsync=m,pxt.commands.webUsbPairDialogAsync=a.webUsbPairDialogAsync,pxt.commands.showUploadInstructionsAsync=b,pxt.packetio.mkPacketIOAsync=void 0,(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===n?void 0:n.useUF2)&&(p("hf2 wrapper"),pxt.packetio.mkPacketIOWrapper=pxt.HF2.mkHF2PacketIOWrapper),((null===(o=null===(i=pxt.appTarget)||void 0===i?void 0:i.compile)||void 0===o?void 0:o.isNative)||(null===(c=null===(l=pxt.appTarget)||void 0===l?void 0:l.compile)||void 0===c?void 0:c.hasHex))&&!pxt.BrowserUtils.isPxtElectron()&&(pxt.usb.isAvailable()&&(null===(h=null===(d=pxt.appTarget)||void 0===d?void 0:d.compile)||void 0===h?void 0:h.webUSB)?(p("enabled webusb"),pxt.usb.setEnabled(!0),pxt.packetio.mkPacketIOAsync=pxt.usb.mkWebUSBHIDPacketIOAsync):(p("webusb disabled"),pxt.usb.setEnabled(!1),!(null===(y=null===(f=pxt.appTarget)||void 0===f?void 0:f.compile)||void 0===y?void 0:y.disableHIDBridge)&&pxt.BrowserUtils.isLocalHost()&&(p("enabled hid bridge"),pxt.packetio.mkPacketIOAsync=s.mkHIDBridgePacketIOAsync)));const O=/force(Hex)?(Browser)?Download/i.test(window.location.href),N=pxt.usb.isEnabled&&(null===(C=null===(S=pxt.appTarget)||void 0===S?void 0:S.compile)||void 0===C?void 0:C.webUSB);O||(null===(I=null===(A=pxt.appTarget)||void 0===A?void 0:A.serial)||void 0===I?void 0:I.noDeploy)?p("deploy: force browser download"):v()?(p("deploy: webkit deploy/save"),pxt.commands.deployCoreAsync=_,pxt.commands.saveOnlyAsync=E,pxt.commands.workspaceLoadedAsync=T):pxt.BrowserUtils.isPxtElectron()?(p("deploy: electron"),pxt.commands.deployCoreAsync=r.driveDeployAsync,pxt.commands.electronDeployAsync=r.driveDeployAsync):N?(p("deploy: webusb"),pxt.commands.deployCoreAsync=x,pxt.commands.renderDisconnectDialog=a.renderUnpairDialog,pxt.commands.showUsbDeviceForgottenDialog=a.showDeviceForgottenDialog):s.shouldUse()?(p("deploy: hid"),pxt.commands.deployCoreAsync=x):pxt.BrowserUtils.isLocalHost()&&u.localToken?(p("deploy: localhost"),pxt.commands.deployCoreAsync=w):p("deploy: browser only"),k()},n.maybeReconnectAsync=S,n.pairAsync=C,n.showDisconnectAsync=async function(){if(await pxt.usb.forgetDeviceAsync())await pxt.commands.showUsbDeviceForgottenDialog(i.confirmAsync);else if(pxt.commands.renderDisconnectDialog){const{header:e,jsx:t,helpUrl:n}=pxt.commands.renderDisconnectDialog();await i.dialogAsync({header:e,jsx:t,helpUrl:n,hasCloseIcon:!0})}},n.disconnectAsync=A;const I=pxtc.Util.guidGen();let O,N,R,D,L,M=!1,P=!1,B=!1;function j(e){var t;(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)&&navigator.serviceWorker.controller.postMessage(e)}n.handleServiceWorkerMessageAsync=async function(e){"packet-io-lock-disconnect"!==e.action||O||I!==e.lock?"packet-io-lock-granted"===e.action&&e.lock===I&&O?(e.granted?(p("[CLIENT]: received granted lock "+I),O(),M=!0):(p("[CLIENT]: received denied lock "+I),N()),O=void 0,N=void 0):"packet-io-supported"===e.action&&R?(R(),L=!0,R=void 0):"packet-io-status"===e.action&&j({type:"serviceworkerclient",action:"packet-io-status",hasLock:M,lock:I}):(p("[CLIENT]: received disconnect request "+I),P||pxt.packetio.isConnecting()?j({type:"serviceworkerclient",action:"packet-io-lock-disconnect",lock:I,didDisconnect:!1}):await A())},n.showUnsupportedHardwareMessageAsync=function(e){var t;if(!pxt.packetio.isConnected())return!0;const n=pxt.packetio.unsupportedParts(),r=pxtc.computeUsedParts(e);let o=[];for(const e of n)if(-1!==r.indexOf(e)){o.push(e);break}if(o.length){const e=pxt.commands.renderIncompatibleHardwareDialog(o);pxt.tickEvent("unsupportedhardwaredialog.shown");const n=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareHelpURL;let r=!0;return i.confirmAsync({header:lf("Incompatible Code"),jsx:e,hasCloseIcon:!0,hideAgree:!0,helpUrl:n,bigHelpButton:!0,className:"downloaddialog",buttons:[{label:lf("Download Anyway"),className:"primary",onclick:()=>{pxt.tickEvent("unsupportedhardwaredialog.downloadagain"),r=!1,i.hideDialog()}}]}).then((()=>(r&&pxt.tickEvent("unsupportedhardwaredialog.cancelled"),!r)))}return Promise.resolve(!0)},l.mountVirtualApi("packetio",{getSync:function(e){switch(l.stripProtocol(e)){case"active":return pxt.packetio.isActive();case"connected":return pxt.packetio.isConnected();case"connecting":return pxt.packetio.isConnecting();case"icon":return pxt.packetio.icon()}return!1}})},{"../../pxtblocks":68,"./core":279,"./data":282,"./dialogs":289,"./electron":292,"./hidbridge":304,"./package":325,"./webusb":353}],203:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CodeCardView=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./data"),s=e("./cloud"),a=e("./util");pxt.Util.repeatMap;class l extends o.Component{constructor(e){super(e),this.state={}}static setupIntersectionObserver(){this.observer||(this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`})(e.target))}))}),{rootMargin:"50px 0px",threshold:.01}))}componentDidMount(){const e=this.refs.lazyimage;if(e)if("IntersectionObserver"in window)l.setupIntersectionObserver(),l.observer.observe(e);else{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`}}renderCore(){var e;const t=this.props;let n=t.color||"";const o=e=>e.replace(/`/g,""),l=t.url?/^[^:]+:\/\//.test(t.url)?t.url:"/"+t.url.replace(/^\.?\/?/,""):void 0,c=t.className,u=t.cardType,d=t.tutorialLength==t.tutorialStep+1,h=t&&t.description&&t.description.split("\n"),p=t.onClick?e=>{e.target&&"A"==e.target.tagName||(pxt.setInteractiveConsent(!0),t.onClick(e))}:void 0,f=t.imageUrl||(t.youTubeId?`https://img.youtube.com/vi/${t.youTubeId}/0.jpg`:void 0),g=t.projectId?this.getData(`header:${t.projectId}`):null,m=g?g.name:t.name,b=t.projectId?this.getData(`${s.HEADER_CLOUDSTATE}:${t.projectId}`):null,y=null==b?void 0:b.cloudStatus(),v=y?Math.min(g.cloudLastSyncTime,g.modificationTime):t.time,_=y&&("synced"===y.value||"justSynced"===y.value||"localEdits"===y.value),E=t.ariaLabel||t.title||t.shortName||m,T=t.style||"card",x=(0,i.jsxs)("div",Object.assign({className:`ui ${T} ${n} ${t.onClick?"link":""} ${c||""}`,role:t.role,"aria-selected":"option"===t.role?"true":void 0,"aria-label":E,title:t.title,onClick:p,tabIndex:t.onClick?t.tabIndex||0:null,onKeyDown:t.onClick?a.fireClickOnEnter:null},{children:[t.header?(0,i.jsx)("div",Object.assign({className:"ui content "+(t.responsive?" tall desktop only":"")},{children:t.header}),"header"):null,t.label||t.labelIcon||t.blocksXml||t.typeScript||f||"file"==u?(0,i.jsxs)("div",Object.assign({className:"ui image"},{children:[t.label||t.labelIcon?(0,i.jsx)("label",Object.assign({role:t.onLabelClicked?"button":void 0,onClick:t.onLabelClicked,className:`ui ${t.labelClass?t.labelClass:"orange right ribbon"} label`,"aria-label":`${E} ${t.onLabelClicked?"button":"label"}`},{children:t.labelIcon?(0,i.jsx)(r.Icon,{icon:t.labelIcon}):t.label})):void 0,t.typeScript?(0,i.jsx)("pre",{children:t.typeScript},"promots"):void 0,"file"!=t.cardType&&f?(0,i.jsx)("div",Object.assign({className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},{children:(0,i.jsx)("div",{className:"ui cardimage","data-src":f,ref:"lazyimage","aria-hidden":!0,role:"presentation"})})):void 0,"file"!=t.cardType||f?void 0:(0,i.jsx)("div",{className:"ui fileimage"}),"file"==t.cardType&&f?(0,i.jsx)("div",{className:"ui fileimage","data-src":f,ref:"lazyimage"}):void 0]})):void 0,t.icon||t.iconContent?(0,i.jsx)("div",Object.assign({className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},{children:(0,i.jsxs)("div",Object.assign({className:`ui button massive fluid ${t.iconColor} ${t.iconContent?"iconcontent":""}`,"aria-hidden":!0,role:"presentation"},{children:[t.icon?(0,i.jsx)(r.Icon,{icon:""+("icon "+t.icon)}):void 0,t.iconContent||void 0]}))})):void 0,t.shortName||m||h?(0,i.jsxs)("div",Object.assign({className:"content "+(this.props.tallCard?"tall":"")},{children:[t.shortName||m?(0,i.jsxs)("div",Object.assign({className:"header"},{children:[t.shortName||m,(0,i.jsx)("div",Object.assign({className:"tags"},{children:null===(e=t.tags)||void 0===e?void 0:e.join(" ")}))]})):null,h&&h.map(((e,n)=>(0,i.jsx)("div",Object.assign({className:"description tall "+(t.icon||t.iconContent||t.imageUrl?"":"long")},{children:o(e)}),`line${n}`)))]})):void 0,t.time?(0,i.jsxs)("div",Object.assign({className:"meta"},{children:[t.tutorialLength?(0,i.jsxs)("span",Object.assign({className:`ui tutorial-progress ${d?"green":"orange"} left floated label`},{children:[(0,i.jsx)("i",{className:(d?"trophy":"circle")+" icon"}),"",lf("{0}/{1}",(t.tutorialStep||0)+1,t.tutorialLength)]})):void 0,!y&&t.time&&(0,i.jsx)("span",Object.assign({className:"date"},{children:pxt.Util.timeSince(t.time)}),"date"),y&&_&&(0,i.jsxs)("span",Object.assign({className:"date "+(t.tutorialLength?"small-screen hide":"")},{children:[pxt.Util.timeSince(v),y.indicator]}),"date"),y&&!_&&(0,i.jsx)("span",Object.assign({className:"date"},{children:y.indicator}),"date"),y&&(0,i.jsx)("i",{className:"ui large right floated icon cloud"})]})):void 0,t.extracontent||t.learnMoreUrl||t.buyUrl||t.feedbackUrl?(0,i.jsxs)("div",Object.assign({className:"ui extra content mobile hide"},{children:[t.extracontent,t.buyUrl?(0,i.jsx)("a",Object.assign({className:"learnmore left floated",href:t.buyUrl,"aria-label":lf("Buy"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Buy")})):void 0,t.learnMoreUrl?(0,i.jsx)("a",Object.assign({className:"learnmore right floated",href:t.learnMoreUrl,tabIndex:0,"aria-label":lf("Learn more"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Learn more")})):void 0,t.feedbackUrl?(0,i.jsx)("a",Object.assign({className:"learnmore right floated",href:t.feedbackUrl,"aria-label":lf("Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Feedback")})):void 0]})):void 0]}));return!t.onClick&&l?(0,i.jsx)("a",Object.assign({href:l},{children:x})):x}}n.CodeCardView=l},{"./cloud":200,"./data":282,"./sui":346,"./util":352,"react/jsx-runtime":549}],204:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clearApiInfoDbAsync=n.getPackagesWithErrors=n.clearCaches=n.newProjectAsync=n.updatePackagesAsync=n.applyUpgradesAsync=n.getBlocksAsync=n.getApisInfoAsync=n.typecheckAsync=n.snippetAsync=n.formatAsync=n.projectSearchClear=n.projectSearchAsync=n.apiSearchAsync=n.refreshLanguageServiceApisInfo=n.workerOpAsync=n.decompilePySnippetstoXmlAsync=n.decompileSnippetstoXmlAsync=n.decompilePythonSnippetAsync=n.pyDecompileAsync=n.pySnippetToBlocksAsync=n.decompileBlocksSnippetAsync=n.decompileAsync=n.syntaxInfoAsync=n.completionsAsync=n.py2tsAsync=n.assembleAsync=n.compileAsync=n.emptyCompileResult=n.emptyProgram=void 0;const i=e("./package"),r=e("./core"),o=e("./workspace"),s=e("blockly"),a=e("../../pxtblocks");var l=pxt.Util;const c=e("../../pxteditor");function u(e,t,n){let r=i.mainEditorPkg();r.forEachFile((e=>e.diagnostics=[]));let o,s="";if(t.length>0&&r.files[pxt.MAIN_TS]&&r.files[pxt.MAIN_PY]&&n){const e=r.files[pxt.MAIN_TS].content,t=r.files[pxt.MAIN_PY].content;o=pxtc.BuildSourceMapHelpers(n,e,t).ts.locToLoc}for(let e of t){if(e.fileName){s+=`${e.category==ts.pxtc.DiagnosticCategory.Error?lf("error"):e.category==ts.pxtc.DiagnosticCategory.Warning?lf("warning"):lf("message")}: ${e.fileName}(${e.line+1},${e.column+1}): `;let t=r.filterFiles((t=>t.getTextFileName()==e.fileName))[0];if(t&&(t.diagnostics.push(e),o&&e.fileName===pxt.MAIN_TS)){let t=o(e);if(t){let n=Object.assign(Object.assign({},e),t);r.files[pxt.MAIN_PY].diagnostics.push(n)}}}s+=`${ts.pxtc.DiagnosticCategory[e.category].toLowerCase()} TS${e.code}: ${ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n")}\n`}s&&pxt.log(s),s||(s=l.lf("Everything seems fine!\n"));let a=r.outputPkg.setFile("output.txt",s);const u=t.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error));a.numDiagnosticsOverride=u.length,h(u),(0,c.shouldPostHostMessages)()&&(0,c.postHostMessageAsync)({type:"pxthost",action:"workspacediagnostics",operation:e,output:s,diagnostics:t.map((e=>({code:e.code,category:ts.pxtc.DiagnosticCategory[e.category].toLowerCase(),fileName:e.fileName,start:e.start,length:e.length,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn})))})}let d="";function h(e){if(e&&e.length){const t={};e.filter((e=>e.code)).forEach((e=>t[e.code]=(t[e.code]||0)+1));const n=JSON.stringify(e);if(n!==d){for(const e of Object.keys(t))pxt.tickEvent("diagnostics",{errorCode:e,count:t[e]});d=n}}else d=""}let p,f,g,m=new Promise((()=>{}));function b(e){return t=>t.isUserError?(r.errorNotification(t.message),i.mainEditorPkg().outputPkg.setFile("output.txt",t.message).numDiagnosticsOverride=1,e):Promise.reject(t)}function y(e){return w("assemble",{fileContent:e})}function v(e){return w("compile",{options:e})}function _(e,t,n){const r=i.mainPkg.getTargetOptions();return i.mainPkg.getCompileOptionsAsync(r).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",t.snippetMode=n&&n.snippetMode||!1,t.generateSourceMap=null==n?void 0:n.generateSourceMap,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,E(t,pxt.MAIN_TS))))}function E(e,t){return w("decompile",{options:e,fileName:t})}function T(e,t){return w("pydecompile",{options:e,fileName:t})}function x(e){const t=i.mainPkg.getTargetOptions();return i.mainPkg.getCompileOptionsAsync(t).then((t=>(t.sourceTexts=e,t.snippetMode=!1,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,function(e){return w("decompileSnippets",{options:e})}(t))))}function w(e,t){const n=Date.now();return pxt.debug("worker op: "+e),pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t).then((t=>(pxt.appTarget.compile.switches.time&&(pxt.log(`Worker perf: ${e} ${Date.now()-n}ms`),t.times&&console.log(t.times)),pxt.debug("worker op done: "+e),t)))}n.emptyProgram="(function (ectx) {\n'use strict';\nectx.runtime.setupPerfCounters([]);\nectx.setupDebugger(1)\nreturn function (s) {\n    // START\n    ectx.runtime.kill()\n    return ectx.leave(s, s.r0)\n}\n})\n",n.emptyCompileResult=function(){return{success:!0,diagnostics:[],times:{},breakpoints:[],outfiles:{"binary.js":n.emptyProgram.replace("// START",pxt.appTarget.simulator.emptyRunCode||"")}}},n.compileAsync=function(e={}){let t=i.mainPkg.getTargetOptions();return t.isNative=e.native,i.mainEditorPkg().buildAssetsAsync().then((()=>i.mainPkg.getCompileOptionsAsync(t))).then((t=>(e.debug&&(t.breakpoints=!0,t.justMyCode=!e.debugExtensionCode,t.testMode=!0),e.trace&&(t.breakpoints=!0,t.justMyCode=!0,t.trace=!0),t.computeUsedSymbols=!0,t.computeUsedParts=!0,e.forceEmit&&(t.forceEmit=!0),/test=1/i.test(window.location.href)&&(t.testMode=!0),t))).then(v).then((t=>{let n=i.mainEditorPkg().outputPkg;for(const e of Object.keys(n.files))e.endsWith(".asm")&&!t.outfiles[e]&&(t.outfiles[e]=n.files[e].content);if(e.jsMetaVersion&&t.outfiles[pxtc.BINARY_JS]){const n={simUrl:pxt.webConfig.simUrl.replace(/\/[^\-]*---simulator/,`/v${pxt.appTarget.versions.target}/---simulator`),cdnUrl:pxt.webConfig.cdnUrl,version:e.jsMetaVersion,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target},r=i.mainPkg.readGitJson();r&&(n.repo=pxt.github.parseRepoId(r.repo).fullName),t.outfiles[pxtc.BINARY_JS]=`// meta=${JSON.stringify(n)}\n${t.outfiles[pxtc.BINARY_JS]}`}return i.mainEditorPkg().outputPkg.setFiles(t.outfiles),u("compile",t.diagnostics),C().then((()=>{if(!t.usedSymbols||!f)return t;for(let e of Object.keys(t.usedSymbols))t.usedSymbols[e]=l.lookup(f.byQName,e);return t}))})).catch(b(m))},n.assembleAsync=function(e){return y(`.startaddr 536887040\n${e}`).then((t=>y(`.startaddr ${536887296-4*(t.words.length+1)}\n${e}`).then((e=>(l.assert(e.words.length==t.words.length),e)))))},n.py2tsAsync=function(e=!1){let t=i.mainPkg.getTargetOptions();return S().then((()=>i.mainPkg.getCompileOptionsAsync(t))).then((e=>(e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME,w("py2ts",{options:e}))))},n.completionsAsync=function(e,t,n,i,r,o){return w("getCompletions",{fileName:e,fileContent:r,position:t,wordStartPos:n,wordEndPos:i,light:o,runtime:pxt.appTarget.runtime})},n.syntaxInfoAsync=function(e,t,n,i){return w("syntaxInfo",{fileName:t,fileContent:i,position:n,infoType:e})},n.decompileAsync=function(e,t,n,r){let o=i.mainPkg.getTargetOptions();return i.mainPkg.getCompileOptionsAsync(o).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,E(t,e)))).then((e=>{if(e.success&&t&&n&&r){const i=a.patchBlocksFromOldWorkspace(t,n,e.outfiles[r]);e.outfiles[r]=i}return i.mainEditorPkg().outputPkg.setFiles(e.outfiles),u("decompile",e.diagnostics),e}))},n.decompileBlocksSnippetAsync=_,n.pySnippetToBlocksAsync=function(e,t){let n=i.mainPkg.getTargetOptions();return S().then((()=>i.mainPkg.getCompileOptionsAsync(n))).then((t=>(t.fileSystem[pxt.MAIN_PY]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:t})))).then((e=>_(e.outfiles[pxt.MAIN_TS])))},n.pyDecompileAsync=function(e){let t=i.mainPkg.getTargetOptions();return i.mainPkg.getCompileOptionsAsync(t).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,T(t,e)))).then((e=>(i.mainEditorPkg().outputPkg.setFiles(e.outfiles),h(e.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error))),e)))},n.decompilePythonSnippetAsync=function(e){let t=i.mainPkg.getTargetOptions();return i.mainPkg.getCompileOptionsAsync(t).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_PY]="",-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),t.ast=!0,T(t,pxt.MAIN_TS)))).then((e=>e.outfiles[pxt.MAIN_PY]))},n.decompileSnippetstoXmlAsync=x,n.decompilePySnippetstoXmlAsync=function(e){const t=/^\s*namespace\s+[^\s]+\s*{([\S\s]*)}\s*$/im,n=/^\s*export\s(let\s*[\S\s]*)\s*$/im,r=/^\s*export\s(function\s*[\S\s]*)\s*$/im,o=i.mainPkg.getTargetOptions();let s=[];return S().then((()=>i.mainPkg.getCompileOptionsAsync(o))).then((t=>{for(let n=0;n<e.length;n++){const i=`snippet_${n}`;t.fileSystem[i+".py"]=e[n],t.sourceFiles.push(i+".py"),s.push(i)}return t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:t})})).then((e=>{const i=[];for(let o of s){let s=e.outfiles[o+".ts"].match(t);if(s&&s[1]){let e=s[1].split("\n").map((e=>{const t=e.match(n),i=t?t[1]:e,o=i.match(r);return o?o[1]:i}));i.push(e.join("\n"))}}return x(i)}))},n.workerOpAsync=w;let k=!1;function S(){return p||I()}function C(){return k||!f?w("apiInfo",{}).then((e=>{if(0!==Object.keys(e).length)return k=!1,ts.pxtc.localizeApisAsync(e,i.mainPkg)})).then((e=>{f=e})):Promise.resolve()}function A(){k=!0}function I(){const e=i.mainEditorPkg(),t=!p;let n=e.buildAssetsAsync().then((()=>i.mainPkg.getCompileOptionsAsync())).then((e=>(e.testMode=!0,w("setOptions",{options:e})))).then((()=>w("allDiags",{}))).then((e=>u("typecheck",e.diagnostics,e.sourceMap))).then((()=>(t&&A(),C()))).catch(b(null));return t&&(p=n),n}function O(){return S().then((()=>f))}function N(){if(!g){const e=i.mainPkg.resolveBannedCategories();return async function(e,t){if(!t)return null;const n="libs/"+pxt.appTarget.corepkg,r=t[n];if(!r)return null;const o=e.getAllFiles(),s=[pxt.MAIN_TS,pxt.TUTORIAL_CODE_START,pxt.TUTORIAL_CODE_STOP,pxt.TILEMAP_CODE,pxt.IMAGES_CODE];if(Object.keys(o).some((e=>-1===s.indexOf(e)&&-1===e.indexOf("/")&&pxt.Util.endsWith(e,".ts"))))return null;const a=pxt.appTarget.bundleddirs.map((e=>{const t=pxt.appTarget.bundledpkgs[e.substr(e.lastIndexOf("/")+1)];return t?{dirname:e,files:t,config:JSON.parse(t[pxt.CONFIG_NAME])}:null})).filter((e=>e&&e.config)),c=e.pkgAndDeps(),u=[],d=[{dirname:n,info:r}];for(const e of c){if("built"===e.id||e.isTopLevel())continue;let n=!1;for(const i of a)if(i.config.name===G(e)){d.push({dirname:i.dirname,info:t[i.dirname]}),n=!0;break}n||u.push(e)}if(u.length){let t;try{t=await V.createAsync()}catch(e){return console.log("Unable to open API info cache DB"),null}for(const e of u){const n=await t.getAsync(e);if(!n)return pxt.debug(`Could not find cached API info for ${G(e)}, waiting for full compile`),null;pxt.debug(`Fetched cached API info for ${G(e)}`),d.push({dirname:e.getPkgId(),info:n})}}const h={byQName:{}};for(const e of d){if(!e)continue;let{info:t,dirname:n}=e;const i=l.cloneApis(t.apis.byQName);for(const e of Object.keys(i))i[e].pkg=n,delete i[e].attributes._translatedLanguageCode,h.byQName[e]=i[e]}h.jres=i.mainPkg.getJRes()||{};for(const e of Object.keys(h.byQName)){let t=h.byQName[e],n=t.attributes.jres;if(n){"true"==n&&(n=e);let i=l.lookup(h.jres,n);i&&i.icon&&!t.attributes.iconURL&&(t.attributes.iconURL=i.icon),i&&i.data&&!t.attributes.jresURL&&(t.attributes.jresURL="data:"+i.mimeType+";base64,"+i.data)}}return h}(i.mainEditorPkg(),pxt.getBundledApiInfo()).then((t=>t?ts.pxtc.localizeApisAsync(t,i.mainPkg).then((t=>g=pxtc.getBlocksInfo(t,e))):O().then((e=>{const t=i.mainPkg.resolveBannedCategories();return g=pxtc.getBlocksInfo(e,t),async function(e,t){var n;const i=pxt.Package.corePackages().map((e=>e.name)),r=e.pkgAndDeps().filter((e=>"built"!==e.id&&!e.isTopLevel()&&-1===i.indexOf(e.getPkgId())));if(r.length){const i=Object.keys(t.byQName);let o;try{o=await V.createAsync()}catch(e){return void pxt.log("Unable to create DB to cache API info")}for(const e of r){const r=e.getPkgId(),s={sha:null,apis:{byQName:{}}};for(const e of i){const i=t.byQName[e];(i.pkg===r||(null===(n=i.pkgs)||void 0===n?void 0:n.find((e=>e===r))))&&(s.apis.byQName[e]=R(i))}await o.setAsync(e,s),pxt.debug(`Stored API info for ${G(e)}`)}}}(i.mainEditorPkg(),e)})).then((()=>g))))}return Promise.resolve(g)}function R(e){const t=l.clone(e);delete t.pkgs;const n=l.clone(t.attributes);delete n._translatedLanguageCode;let i=!1;return n._untranslatedBlock&&(n.block=n._untranslatedBlock,delete n._untranslatedBlock,i=!0),n._untranslatedJsDoc&&(n.jsDoc=n._untranslatedJsDoc,delete n._untranslatedJsDoc,i=!0),i&&ts.pxtc.updateBlockDef(n),t.attributes=n,t}function D(){const e=i.mainPkg,t=i.getEditorPkg(e),n=t.header.targetVersion,r=t.files[pxt.MAIN_BLOCKS]?t.files[pxt.MAIN_BLOCKS].content:`<block type="${ts.pxtc.ON_START_TYPE}"></block>`;let o,l={};return pxt.debug("Applying upgrades to blocks"),pxt.BrowserUtils.loadBlocklyAsync().then((()=>N())).then((e=>{o=new s.Workspace;const t=a.importXml(n,r,e,!0),i=s.utils.xml.textToDom(t);a.domToWorkspaceNoEvents(i,o),a.upgradeTilemapsInWorkspace(o,pxt.react.getTilemapProject());const c=a.workspaceToDom(o);return l[pxt.MAIN_BLOCKS]=s.Xml.domToText(c),a.compileAsync(o,e)})).then((e=>(l[pxt.MAIN_TS]=e.source,t.buildAssetsAsync()))).then((()=>{const e=t.getAllFiles(),n=Object.keys(e).filter((e=>!/^main\.(blocks|ts|py)$/.test(e)));for(const t of n)l[t]=e[t];return P(l)})).then((()=>({success:!0,editor:pxt.BLOCKS_PROJECT_NAME,patchedFiles:l}))).catch((e=>(console.log(e),pxt.debug("Block upgrade failed, falling back to TS"),L())))}async function L(){const e=i.mainPkg,t=i.getEditorPkg(e),n=t.header.targetVersion,r={};pxt.Util.values(t.files).filter(B).forEach((e=>{const t=pxt.patching.patchJavaScript(n,e.content);t!=e.content&&(r[e.name]=t)})),pxt.debug("Applying upgrades to TypeScript");try{return await P(r),{success:!0,editor:pxt.JAVASCRIPT_PROJECT_NAME,patchedFiles:r}}catch(e){return{success:!1,errorCodes:e.errorCodes}}}async function M(){const e=i.mainPkg,t=i.getEditorPkg(e),n=t.header.targetVersion,r={};pxt.Util.values(t.files).filter(j).forEach((e=>{const t=pxt.patching.patchPython(n,e.content);t!=e.content&&(r[e.name]=t)})),pxt.debug("Applying upgrades to Python");try{return await P(r),{success:!0,editor:pxt.PYTHON_PROJECT_NAME,patchedFiles:r}}catch(e){return{success:!1,errorCodes:e.errorCodes}}}function P(e){const t=i.mainPkg;return i.mainEditorPkg().buildAssetsAsync().then((()=>t.getCompileOptionsAsync())).then((t=>(e&&Object.keys(e).forEach((n=>{e[n]&&(t.fileSystem[n]=e[n])})),v(t)))).then((e=>{if(!e.success){const t={};e.diagnostics&&e.diagnostics.forEach((e=>{const n="TS"+e.code;t[n]=(t[n]||0)+1}));const n=new Error("Compile failed on updated package");return n.errorCodes=t,Promise.reject(n)}return Promise.resolve()}))}function B(e){return pxt.Util.endsWith(e.getName(),".ts")}function j(e){return pxt.Util.endsWith(e.getName(),".py")}function F(){return $(),w("reset",{})}function $(){p=null,f=null,g=null}function U(){const e=i.mainPkg.resolveBannedCategories();if(e)return{bannedCategories:e}}function H(e){const t=JSON.stringify(e.getAllFiles())+pxt.appTarget.versions.pxt+"_"+pxt.appTarget.versions.target;return pxtc.U.sha256(t)}function G(e){const t=e.getKsPkg(),n=t._verspec;return pxt.github.isGithubId(n)?/^([^#]+)/.exec(n)[1]:t.config.name}n.refreshLanguageServiceApisInfo=A,n.apiSearchAsync=async function(e){return await S(),await C(),e.localizedApis=f,e.localizedStrings=pxt.Util.getLocalizedStrings(),w("apiSearch",{search:e,blocks:U()})},n.projectSearchAsync=function(e){return C().then((()=>w("projectSearch",{projectSearch:e})))},n.projectSearchClear=function(){return C().then((()=>w("projectSearchClear",{})))},n.formatAsync=function(e,t){return w("format",{format:{input:e,pos:t}})},n.snippetAsync=function(e,t){let n=Promise.resolve();return t&&(n=I().then((()=>{}))),n.then((()=>w("snippet",{snippet:{qName:e,python:t},runtime:pxt.appTarget.runtime}))).then((e=>e))},n.typecheckAsync=I,n.getApisInfoAsync=O,n.getBlocksAsync=N,n.applyUpgradesAsync=function(){const e=i.mainPkg,t=i.getEditorPkg(e),n=pxt.semver.parse(t.header.targetVersion||"0.0.0"),r=pxt.semver.parse(pxt.appTarget.versions.target);if(0===pxt.semver.cmp(n,r))return pxt.debug("Skipping project upgrade"),Promise.resolve({success:!0});const o=t.header.editor!==pxt.BLOCKS_PROJECT_NAME?t.header.editor!==pxt.PYTHON_PROJECT_NAME?L:M:D;let s=!1;return P().catch((()=>s=!0)).then(o).then((e=>e.success?(pxt.tickEvent("upgrade.success",{projectEditor:t.header.editor,upgradedEditor:e.editor,preUpgradeVersion:t.header.targetVersion||"unknown",projectNeverCompiled:""+s}),pxt.debug("Upgrade successful!"),function(e,t,n){return Object.keys(t).forEach((n=>e.setFile(n,t[n]))),e.header.targetVersion=pxt.appTarget.versions.target,e.header.editor=n,e.saveFilesAsync()}(t,e.patchedFiles,e.editor).then((()=>e))):(pxt.tickEvent("upgrade.failed",{projectEditor:t.header.editor,preUpgradeVersion:t.header.targetVersion||"unknown",errors:JSON.stringify(e.errorCodes),projectNeverCompiled:""+s}),pxt.debug("Upgrade failed; bailing out and leaving project as-is"),Promise.resolve(e))))},n.updatePackagesAsync=function(e,t){const n=i.mainEditorPkg();let r,s=0;return t&&t.startOperation(),o.getTextAsync(n.header.id).then((e=>o.makeBackupAsync(n.header,e))).then((e=>(r=e,n.header.backupRef=r.id,o.saveAsync(n.header)))).then((()=>l.promiseMapAllSeries(e,(i=>(t&&t.throwIfCancelled(),n.updateDepAsync(i.getPkgId()).then((()=>{++s,t&&!t.isCancelled()&&t.reportProgress(s,e.length)}))))))).then((()=>i.loadPkgAsync(n.header.id))).then((()=>F())).then((()=>P())).then((()=>(t&&t.throwIfCancelled(),delete n.header.backupRef,o.saveAsync(n.header)))).then((()=>!0)).catch((()=>o.restoreFromBackupAsync(n.header).then((()=>!1)))).finally((()=>{let e=Promise.resolve();return r&&(r.isDeleted=!0,e=o.forceSaveAsync(r)),e.finally((()=>{t&&t.resolveCancel()}))}))},n.newProjectAsync=F,n.clearCaches=$,n.getPackagesWithErrors=function(){const e={},t=i.mainEditorPkg();if(t){const n=pxt.Package.corePackages().map((e=>e.name));t.forEachFile((t=>{t.diagnostics&&t.diagnostics.length&&t.epkg&&-1===n.indexOf(t.epkg.getPkgId())&&!t.epkg.isTopLevel()&&t.diagnostics.some((e=>e.category===ts.pxtc.DiagnosticCategory.Error))&&(e[t.epkg.getPkgId()]=t.epkg)}))}return pxt.Util.values(e)};class V{constructor(e){this.db=e}static dbName(){return`__pxt_apis_${pxt.appTarget.id||""}`}static createAsync(){function e(){const e=new pxt.BrowserUtils.IDBWrapper(V.dbName(),2,((e,t)=>{t.result.createObjectStore(V.TABLE,{keyPath:V.KEYPATH})}),(()=>{pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(V.dbName())}));return e.openAsync().then((()=>new V(e)))}return e().catch((t=>(console.log("db: failed to open api database, try delete entire store..."),pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(V.dbName()).then((()=>e())))))}getAsync(e){const t=G(e),n=H(e);return this.db.getAsync(V.TABLE,t).then((e=>{if(e&&e.hash===n)return e.apis}))}setAsync(e,t){pxt.perf.measureStart("compiler db setAsync");const n={id:G(e),hash:H(e),apis:t};return this.db.setAsync(V.TABLE,n).then((()=>{pxt.perf.measureEnd("compiler db setAsync")}))}clearAsync(){return this.db.deleteAllAsync(V.TABLE).then((()=>console.debug("db: all clean"))).catch((e=>{console.error("db: failed to delete all")}))}}V.TABLE="files",V.KEYPATH="id",n.clearApiInfoDbAsync=function(){return V.createAsync().then((e=>e.clearAsync())).catch((e=>pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(V.dbName()).then()))}},{"../../pxtblocks":68,"../../pxteditor":134,"./core":279,"./package":325,"./workspace":354,blockly:376}],205:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FilterPanel=n.FilterPanelSubheading=n.FilterTag=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../util");class s extends r.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return(0,i.jsxs)("div",Object.assign({className:"filter-tag"},{children:[(0,i.jsx)("div",Object.assign({className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter,"aria-checked":this.props.selected},{children:(0,i.jsx)("i",{className:"icon square outline "+(this.props.selected?"check":"")})})),(0,i.jsx)("div",Object.assign({className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter},{children:pxtc.U.rlf(this.props.tag)}))]}))}clickHandler(){this.props.onClickHandler(this.props.tag)}}n.FilterTag=s;class a extends r.Component{render(){return(0,i.jsxs)("div",Object.assign({className:"filter-subheading-row"},{children:[(0,i.jsx)("div",Object.assign({className:"filter-subheading-title"},{children:`${this.props.subheading}:`})),this.props.buttonText&&(0,i.jsx)("div",Object.assign({className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:o.fireClickOnEnter},{children:this.props.buttonText}))]}))}}n.FilterPanelSubheading=a;class l extends r.Component{isTagSelected(e){return this.props.enabledTags.indexOf(e.toLowerCase())>=0}render(){const e=this.props.tagOptions;return(0,i.jsxs)("div",Object.assign({className:"filter-panel"},{children:[(0,i.jsx)("div",Object.assign({className:"filter-title"},{children:lf("Filter")})),(0,i.jsx)(a,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:this.props.enabledTags.length>0?{color:"white"}:{}}),(0,i.jsx)("div",Object.assign({className:"filter-tag-list"},{children:e.map((e=>(0,i.jsx)(s,{tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler},e)))}))]}))}}n.FilterPanel=l},{"../util":352,react:548,"react/jsx-runtime":549}],206:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Alert=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./actions/dispatch");class a extends r.Component{constructor(e){super(e)}render(){const{title:e,text:t,options:n,dispatchHideAlert:r}=this.props;return(0,i.jsx)("div",Object.assign({className:"image-editor-alert-container",role:"region",onClick:r},{children:(0,i.jsxs)("div",Object.assign({className:"image-editor-alert",role:"dialog"},{children:[(0,i.jsxs)("div",Object.assign({className:"title"},{children:[(0,i.jsx)("span",{className:"ms-Icon ms-Icon--Warning"}),(0,i.jsx)("span",{children:e}),(0,i.jsx)("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:r})]})),(0,i.jsx)("div",Object.assign({className:"text"},{children:t})),n&&(0,i.jsx)("div",Object.assign({className:"options"},{children:n.map(((e,t)=>(0,i.jsx)("div",Object.assign({className:"button",role:"button",onClick:e.onClick},{children:e.label}),t)))}))]}))}))}}const l={dispatchHideAlert:s.dispatchHideAlert};n.Alert=(0,o.connect)((function({editor:e},t){return e?t:{}}),l)(a)},{"./actions/dispatch":219,react:548,"react-redux":521,"react/jsx-runtime":549}],207:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BottomBar=n.BottomBarImpl=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./Button"),l=e("./util"),c=e("../../assets"),u=e("./keyboardShortcuts"),d=e("../../../../react-common/components/util");class h extends r.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{const t=e.target.value,n=parseInt(t),{aspectRatioLocked:i,imageDimensions:r}=this.props;!isNaN(n)&&i?this.setState({width:n+"",height:Math.floor(n*(r[1]/r[0]))+""}):this.setState({width:t})},this.handleHeightChange=e=>{const t=e.target.value,n=parseInt(t),{aspectRatioLocked:i,imageDimensions:r}=this.props;!isNaN(n)&&i?this.setState({height:n+"",width:Math.floor(n*(r[0]/r[1]))+""}):this.setState({height:t})},this.handleDimensionalBlur=()=>{const{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:n}=this.props,i=parseInt(this.state.width),r=parseInt(this.state.height),o=t?255:512,s=isNaN(i)?e[0]:Math.min(Math.max(i,1),o),a=isNaN(r)?e[1]:Math.min(Math.max(r,1),o);s===e[0]&&a===e[1]||n([s,a]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;const n=e.target.value||"",i=n.trim();pxt.validateAssetName(i)?(0,c.isNameTaken)(i)&&i!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:n,assetNameMessage:t})},this.handleAssetNameBlur=()=>{const{dispatchChangeAssetName:e,assetName:t}=this.props;if(this.state.assetName){let n=this.state.assetName.trim();n!==t&&pxt.validateAssetName(n)&&!(0,c.isNameTaken)(n)&&e(n)}this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){const{imageDimensions:e,cursorLocation:t,hasUndo:n,hasRedo:r,dispatchUndoImageEdit:o,dispatchRedoImageEdit:s,aspectRatioLocked:c,onionSkinEnabled:u,dispatchToggleAspectRatioLocked:h,dispatchToggleOnionSkinEnabled:p,resizeDisabled:f,singleFrame:g,onDoneClick:m,assetName:b,hideDoneButton:y,hideAssetName:v}=this.props,{assetNameMessage:_}=this.state,E=null==this.state.width?e[0]:this.state.width,T=null==this.state.height?e[1]:this.state.height,x=null==this.state.assetName?b||"":this.state.assetName;return(0,i.jsxs)("div",Object.assign({className:"image-editor-bottombar"},{children:[!f&&(0,i.jsxs)("div",Object.assign({className:"image-editor-resize"},{children:[(0,i.jsx)("input",{className:"image-editor-input",title:lf("Image Width"),value:E,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),(0,i.jsx)(a.IconButton,{onClick:h,iconClass:c?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:c?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!c,noTab:!0}),(0,i.jsx)("input",{className:"image-editor-input",title:lf("Image Height"),value:T,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})]})),!g&&(0,i.jsx)("div",{className:"image-editor-seperator"}),!g&&(0,i.jsx)("div",{children:(0,i.jsx)(a.IconButton,{onClick:p,iconClass:"ms-Icon ms-Icon--MapLayers",title:u?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!u})}),!f&&(0,i.jsx)("div",{className:(0,d.classList)("image-editor-seperator",!t&&"transparent")}),(0,i.jsx)("div",Object.assign({className:"image-editor-coordinate-preview"},{children:t&&`${t[0]}, ${t[1]}`})),(0,i.jsx)("div",Object.assign({className:"image-editor-change-name"},{children:!v&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{className:"image-editor-input",title:lf("Asset Name"),value:x,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),_&&(0,i.jsx)("div",Object.assign({className:"ui pointing below red basic label"},{children:_}))]})})),(0,i.jsxs)("div",Object.assign({className:"image-editor-undo-redo"},{children:[(0,i.jsx)(a.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:n?o:null,disabled:!n}),(0,i.jsx)(a.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:r?s:null,disabled:!r})]})),(0,i.jsx)("div",{className:"image-editor-seperator"}),(0,i.jsxs)("div",Object.assign({className:"image-editor-zoom-controls"},{children:[(0,i.jsx)(a.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),(0,i.jsx)(a.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})]})),!y&&(0,i.jsx)("div",Object.assign({role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:m,onKeyDown:l.fireClickOnlyOnEnter},{children:lf("Done")}))]}))}setShortcutsEnabled(e){e&&this.shortcutLock?((0,u.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,u.obtainShortcutLock)())}}n.BottomBarImpl=h;const p={dispatchChangeImageDimensions:s.dispatchChangeImageDimensions,dispatchUndoImageEdit:s.dispatchUndoImageEdit,dispatchRedoImageEdit:s.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:s.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:s.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:s.dispatchChangeZoom,dispatchChangeAssetName:s.dispatchChangeAssetName};n.BottomBar=(0,o.connect)((function({store:{present:e,past:t,future:n},editor:i},r){var o,s,a;if(!e)return{};const l=i.isTilemap?e.tilemap.bitmap:e.frames[e.currentFrame].bitmap;return{imageDimensions:[l.width,l.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:i.onionSkinEnabled,cursorLocation:i.cursorLocation,resizeDisabled:"tile"===(null===(o=e.asset)||void 0===o?void 0:o.type),assetName:null===(a=null===(s=e.asset)||void 0===s?void 0:s.meta)||void 0===a?void 0:a.displayName,hasUndo:!!t.length,hasRedo:!!n.length,isTilemap:i.isTilemap}}),p)(h)},{"../../../../react-common/components/util":187,"../../assets":192,"./Button":208,"./actions/dispatch":219,"./keyboardShortcuts":221,"./util":228,react:548,"react-redux":521,"react/jsx-runtime":549}],208:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.IconButton=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./util");class s extends r.Component{render(){const{title:e,iconClass:t,onClick:n,toggle:r,disabled:s,noTab:a}=this.props;return(0,i.jsx)("div",Object.assign({role:"button",className:`image-editor-button ${r?"toggle":""} ${s?"disabled":""}`,title:e,tabIndex:a||s?-1:0,onClick:n,onKeyDown:o.fireClickOnlyOnEnter},{children:(0,i.jsx)("span",{className:t})}))}}n.IconButton=s},{"./util":228,react:548,"react/jsx-runtime":549}],209:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CursorSizes=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./actions/dispatch"),s=e("react-redux");class a extends r.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selected:e}=this.props;return(0,i.jsxs)("div",Object.assign({className:"cursor-buttons"},{children:[(0,i.jsx)("div",Object.assign({className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},{children:(0,i.jsx)("div",{className:"cursor-button small"})})),(0,i.jsx)("div",Object.assign({className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},{children:(0,i.jsx)("div",{className:"cursor-button medium"})})),(0,i.jsx)("div",Object.assign({className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},{children:(0,i.jsx)("div",{className:"cursor-button large"})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{dispatchChangeCursorSize:t}=this.props;t(e)}),this.handlers[e]}}const l={dispatchChangeCursorSize:o.dispatchChangeCursorSize};n.CursorSizes=(0,s.connect)((function({editor:e},t){return e?{selected:e.cursorSize}:{}}),l)(a)},{"./actions/dispatch":219,react:548,"react-redux":521,"react/jsx-runtime":549}],210:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Dropdown=void 0;const i=e("react/jsx-runtime"),r=e("react");class o extends r.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,{open:n}=this.state,r=e[t];return(0,i.jsxs)("div",Object.assign({className:"image-editor-dropdown-outer"},{children:[(0,i.jsxs)("button",Object.assign({className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},{children:[(null==r?void 0:r.text)||"",(0,i.jsx)("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})]})),(0,i.jsx)("ul",Object.assign({tabIndex:-1,role:"listbox","aria-activedescendant":null==r?void 0:r.id,className:n&&e.length?"":"hidden"},{children:e.map(((e,n)=>(0,i.jsx)("li",Object.assign({role:"option","aria-selected":n===t,className:n===t?"selected":"",onClick:this.clickHandler(n)},{children:e.text}),e.id)))}))]}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:n}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(n[e],e)}}return this.handlers[e]}}n.Dropdown=o},{react:548,"react/jsx-runtime":549}],211:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageCanvas=n.ImageCanvasImpl=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./store/imageReducer"),a=e("./actions/dispatch"),l=e("./util"),c=e("./toolDefinitions"),u=e("../../assets"),d=e("./keyboardShortcuts"),h=e("./ImageEditor"),p=[s.TileDrawingMode.Wall];class f extends r.Component{constructor(){super(...arguments),this.cursor=c.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache={},this.onKeyDown=e=>{var t,n,i,r,o,a;if((0,d.areShortcutsEnabled)()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&(null===(n=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===n?void 0:n.image)){let t=!1;switch(e.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),t=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),t=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),t=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),t=!0}t&&(this.props.dispatchImageEdit(this.editState.toImageState()),e.preventDefault())}if(!e.repeat){switch(!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"v"!==e.key||e.stopPropagation(),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),e.preventDefault()),"Escape"==e.key&&(null===(r=null===(i=this.editState)||void 0===i?void 0:i.floating)||void 0===r?void 0:r.image)&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),e.preventDefault()),("Backspace"===e.key||"Delete"===e.key)&&(null===(a=null===(o=this.editState)||void 0===o?void 0:o.floating)||void 0===a?void 0:a.image)&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),e.preventDefault()),this.lastTool=this.props.tool,e.keyCode){case 18:this.props.dispatchChangeImageTool(s.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:this.props.dispatchChangeImageTool(s.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t,n;if(this.props.tool===s.ImageEditorTool.Marquee&&(null===(n=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===n?void 0:n.image))if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify((0,l.createTilemapPatchFromFloatingLayer)(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=e=>{if(this.props.isTilemap){const t=e.clipboardData.getData("application/makecode-tilemap");let n;try{n=JSON.parse(t)}catch(e){}if(!(n&&n.map&&n.layers&&n.tiles))return;return e.preventDefault(),void this.applyTilemapPatch(n)}let t=e.clipboardData.getData("application/makecode-image");if(!t){const n=e.clipboardData.getData("text/plain"),i=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(n);i&&(t=i[0])}const n=t&&pxt.sprite.imageLiteralToBitmap(t);n&&n.width&&n.height&&(e.preventDefault(),this.props.tool!==s.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(s.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.setFloatingLayer(n),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){const e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width,n=!this.props.isTilemap&&this.props.tool==s.ImageEditorTool.Marquee;return(0,i.jsx)("div",Object.assign({ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu,tabIndex:0},{children:(0,i.jsxs)("div",Object.assign({className:"paint-container"},{children:[!this.props.lightMode&&(0,i.jsx)("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),(0,i.jsx)("canvas",{ref:"paint-surface",className:"paint-surface main"}),p.map(((e,t)=>(0,i.jsx)("canvas",{ref:`paint-surface-${e.toString()}`,className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide")},t))),(0,i.jsx)("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"}),n&&(0,i.jsx)("div",{ref:"floating-layer-nw-corner",className:"image-editor-floating-layer-corner"}),n&&(0,i.jsx)("div",{ref:"floating-layer-ne-corner",className:"image-editor-floating-layer-corner"}),n&&(0,i.jsx)("div",{ref:"floating-layer-se-corner",className:"image-editor-floating-layer-corner"}),n&&(0,i.jsx)("div",{ref:"floating-layer-sw-corner",className:"image-editor-floating-layer-corner"})]}))}))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.tileCache={},this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=p.map((e=>this.refs[`paint-surface-${e.toString()}`])),(0,l.bindGestureEvents)(this.refs["canvas-bounds"],this);const e=this.refs["canvas-bounds"];e.addEventListener("wheel",(e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()})),e.addEventListener("mousemove",(e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)})),e.addEventListener("mouseout",(e=>{this.edit||this.updateCursorLocation(null)})),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste);const t=this.getImageState();this.editState=(0,c.getEditState)(t,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){if(!this.edit||!this.editState){const e=this.getImageState();this.editState=(0,c.getEditState)(e,this.props.isTilemap,this.props.drawingMode)}if(this.props.isTilemap||(this.tileCache={}),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()}componentWillUnmount(){this.tileCache={},document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){var n,i;this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement!==this.refs["canvas-bounds"]&&document.activeElement.blur(),this.refs["canvas-bounds"].focus(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):(null===(i=null===(n=this.editState)||void 0===n?void 0:n.floating)||void 0===i?void 0:i.image)&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}}onDragEnd(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else if(this.isResizing){if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit(!1),this.updateCursor(!1,!1)}else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}this.isResizing=!1}updateCursorLocation(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){const t=this.canvas.getBoundingClientRect(),n=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),i=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&n===this.cursorLocation[0]&&i===this.cursorLocation[1]||(this.cursorLocation=[n,i,e.clientX,e.clientY],this.hasHover&&this.props.dispatchChangeCursorLocation(this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(n,i)),0))}return this.cursorLocation=[0,0,e.clientX,e.clientY],!1}updateCursor(e,t){const{tool:n}=this.props,i=c.tools.find((e=>e.tool===n));i?t?e?this.updateCursorCore(i.downLayerCursor||i.hoverLayerCursor||i.downCursor||i.hoverCursor):this.updateCursorCore(i.hoverLayerCursor||i.hoverCursor):e?this.updateCursorCore(i.downCursor||i.hoverCursor):this.updateCursorCore(i.hoverCursor):this.updateCursorCore(c.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||c.ToolCursor.Default,this.updateBackground()}startEdit(e){const{tool:t,toolWidth:n,selectedColor:i,backgroundColor:r,drawingMode:o}=this.props,[a,l]=this.cursorLocation;if(this.inBounds(a,l)||this.isResizing){let a=o==s.TileDrawingMode.Wall?2:e?r:i;this.edit=(0,c.getEdit)(t,this.editState,a,n),this.edit.originalImage=this.originalImage,this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.cursorLocation[2],this.cursorLocation[3],this.editState)}}updateEdit(e,t){this.edit&&(this.edit.inBounds(e,t)||this.isResizing)&&(this.edit.update(e,t),this.redraw())}commitEdit(e=!0){const{dispatchImageEdit:t}=this.props,n=this.getImageState();this.edit&&(this.editState=(0,c.getEditState)(n,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.originalImage=e?void 0:this.edit.originalImage,this.edit=void 0,t(this.editState.toImageState()))}redraw(){const{prevFrame:e,onionSkinEnabled:t,selectedColor:n,toolWidth:i,drawingMode:r,tool:o}=this.props,a=this.getImageState(),l=r==s.TileDrawingMode.Wall?2:n;let u=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,u=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach((e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth})),t&&e){const t=(0,c.getEditState)(e,this.props.isTilemap,r),n=this.canvas.getContext("2d");n.globalAlpha=.5,this.drawImage(t.image),t.floating&&t.floating.image&&this.drawImage(t.floating.image,t.layerOffsetX,t.layerOffsetY,!0),n.globalAlpha=1}if(this.edit){const n=this.editState.copy();n.setActiveLayer(r),this.edit.doEdit(n),this.drawImage(n.image,0,0,!(!t||!e)),this.drawOverlayLayers(n.overlayLayers),this.redrawFloatingLayer(n)}else if(this.drawImage(this.editState.image,0,0,!(!t||!e)),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const e=o===s.ImageEditorTool.Erase?0:l;this.drawCursor(this.cursorLocation[0]-(i>>1),this.cursorLocation[1]-(i>>1),i,e)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const e=this.background.getContext("2d");e.imageSmoothingEnabled=!1,e.fillStyle="#aeaeae",e.fillRect(0,0,this.background.width,this.background.height),e.fillStyle="#dedede";const t=this.imageHeight<<1,n=this.imageWidth<<1;for(let i=0;i<n;i++)for(let n=0;n<t;n++)i+n&1&&e.fillRect(i*this.cellWidth,n*this.cellWidth,this.cellWidth,this.cellWidth)}}u&&this.zoomToCanvas()}drawImage(e,t=0,n=0,i=!1,r=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,n,i,r):this.drawBitmap(e,t,n,i,r)}redrawFloatingLayer(e,t=!1){const n=this.refs["floating-layer-border"],i=this.refs["floating-layer-nw-corner"],r=this.refs["floating-layer-ne-corner"],o=this.refs["floating-layer-se-corner"],s=this.refs["floating-layer-sw-corner"],a=[i,r,o,s];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));const l=this.canvas.getBoundingClientRect(),c=Math.max(e.layerOffsetX,0),u=Math.max(e.layerOffsetY,0),d=Math.min(e.layerOffsetX+e.floating.image.width,e.width),h=Math.min(e.layerOffsetY+e.floating.image.height,e.height),p=l.width/e.width,f=l.height/e.height;n.style.display="",(d-c<1||h-u<1)&&(n.style.display="none");const g=-this.panX+p*c,m=-this.panY+f*u,b=p*(d-c),y=f*(h-u);if(n.style.left=g+"px",n.style.top=m+"px",n.style.width=b+"px",n.style.height=y+"px",n.style.borderLeft=e.layerOffsetX>=0?"":"none",n.style.borderTop=e.layerOffsetY>=0?"":"none",n.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",n.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none",null!=i){const e=16,t=3;this.props.isTilemap||(a.forEach((n=>{n.style.display="",n.style.width=e+"px",n.style.height=e+"px",n.style.border=t+"px solid black",n.style.position="absolute",n.style.backgroundColor="white"})),i.style.left=g-e+"px",i.style.top=m-e+"px",i.style.cursor="nw-resize",r.style.left=g+b+"px",r.style.top=m-e+"px",r.style.cursor="ne-resize",o.style.left=g+b+"px",o.style.top=m+y+"px",o.style.cursor="se-resize",s.style.left=g-e+"px",s.style.top=m+y+"px",s.style.cursor="sw-resize")}}else n.style.display="none",a.forEach((e=>{e&&(e.style.display="none")}))}drawOverlayLayers(e,t=0,n=0,i=!this.props.lightMode){e&&e.forEach(((e,r)=>{this.drawBitmap(e,t,n,!0,i,this.canvasLayers[r])}))}drawBitmap(e,t=0,n=0,i=!1,r=!this.props.lightMode,o=this.canvas){const{colors:s}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let r=0;r<e.width;r++)for(let o=0;o<e.height;o++){const l=e.get(r,o);l?(a.fillStyle=s[l],a.fillRect(r+t,o+n,1,1)):i||a.clearRect(r+t,o+n,1,1)}}generateTile(e,t){if(!t.tiles[e])return null;const n=document.createElement("canvas");return n.width=t.tileWidth,n.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!1,!this.props.lightMode,n),this.tileCache[t.tiles[e].id]=n,n}drawTilemap(e,t=0,n=0,i=!1,r=!this.props.lightMode,o=this.canvas){const{tilemapState:{tileset:s}}=this.props,a=o.getContext("2d");let l,c;this.tileCacheRevision!==this.props.tilesetRevision&&(this.tileCache={},this.tileCacheRevision=this.props.tilesetRevision),a.imageSmoothingEnabled=!1,a.fillStyle=h.LIGHT_MODE_TRANSPARENT;for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if((l=e.get(o,u))&&l<s.tiles.length){if((c=this.tileCache[s.tiles[l].id])||(c=this.generateTile(l,s)),!c)continue;a.drawImage(c,(o+t)*this.cellWidth,(u+n)*this.cellWidth)}else i||(r?a.clearRect((o+t)*this.cellWidth,(u+n)*this.cellWidth,this.cellWidth,this.cellWidth):a.fillRect((o+t)*this.cellWidth,(u+n)*this.cellWidth,this.cellWidth,this.cellWidth))}drawCursor(e,t,n,i){const r=this.props.isTilemap&&this.props.drawingMode===s.TileDrawingMode.Wall,o=(r?this.canvasLayers[0]:this.canvas).getContext("2d");if(o.imageSmoothingEnabled=!1,i&&-1!==i)if(this.props.isTilemap&&!r){if(i>=this.props.tilemapState.tileset.tiles.length)return;let r=this.tileCache[this.props.tilemapState.tileset.tiles[i].id];if(r||(r=this.generateTile(i,this.props.tilemapState.tileset)),!r)return;for(let i=0;i<n;i++)for(let s=0;s<n;s++)o.drawImage(r,(e+i)*this.cellWidth,(t+s)*this.cellWidth)}else r?(o.fillStyle=this.props.colors[i],o.fillRect(e,t,1,1)):(o.fillStyle=this.props.colors[i],o.fillRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth));else this.props.lightMode?(o.fillStyle=h.LIGHT_MODE_TRANSPARENT,o.fillRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth)):o.clearRect(e*this.cellWidth,t*this.cellWidth,n*this.cellWidth,n*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,n){const i=this.refs["canvas-bounds"];if(this.canvas&&i){const r=i.getBoundingClientRect();t=void 0===t?r.left+(r.width>>1):t,n=void 0===n?r.top+(r.height>>1):n;const{canvasX:o,canvasY:s}=this.clientToCanvas(t,n,r);this.zoom=Math.max(this.zoom+e,2.5);const a=this.getCanvasUnit(r);if(a){const{canvasX:e,canvasY:i}=this.clientToCanvas(t,n,r);if(isNaN(e)||isNaN(i)||isNaN(o)||isNaN(s))return;this.panX+=(o-e)*a,this.panY+=(s-i)*a}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];const n=this.refs["canvas-bounds"].getBoundingClientRect(),i=this.canvas.getBoundingClientRect();return i.width<n.width&&(e=-((n.width>>1)-(i.width>>1))),i.height<n.height&&(t=-((n.height>>1)-(i.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;const e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){const t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();const n=this.getCanvasUnit(e);if(0===n){if(this.waitingToZoom)return;return this.waitingToZoom=!0,void requestAnimationFrame((()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}))}this.waitingToZoom=!1;const i=n*this.imageWidth,r=n*this.imageHeight,o=this.imageWidth>1&&this.imageHeight>1?2*n:n>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,i-o),-(e.width-o)),this.panY=Math.max(Math.min(this.panY,r-o),-(e.height-o)),this.canvas.style.position="fixed",this.canvas.style.width=`${i}px`,this.canvas.style.height=`${r}px`,this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach((e=>this.cloneCanvasStyle(this.canvas,e))),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){const n=this.refs["canvas-bounds"].getBoundingClientRect();let i,{canvasX:r,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,n);r=Math.floor(r),o=Math.floor(o),this.editState.inFloatingLayer(r,o)&&(i=this.editState.floating.image.get(r-this.editState.layerOffsetX,o-this.editState.layerOffsetY)),i||(i=this.editState.image.get(r,o)),t?this.props.dispatchChangeBackgroundColor(i):this.props.dispatchChangeSelectedColor(i)}selectAll(){this.props.tool!==s.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(s.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,n){const i=this.getCanvasUnit(n);return{canvasX:(e-n.left+this.panX)/i,canvasY:(t-n.top+this.panY)/i}}getCanvasUnit(e){const t=e.width/e.height,n=this.imageWidth/this.imageHeight,i=Math.pow(this.zoom/10,2);return t>n?i*(e.height/this.imageHeight):i*(e.width/this.imageWidth)}inBounds(e,t){return e>=0&&e<this.imageWidth&&t>=0&&t<this.imageHeight}isPanning(){return this.props.tool===s.ImageEditorTool.Pan}touchesResize(e,t){const n=document.querySelectorAll(":hover");for(let e=0;e<n.length;e++)if("image-editor-floating-layer-corner"==n[e].className)return!0;return!1}isColorSelect(){return this.props.tool===s.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case s.ImageEditorTool.Fill:case s.ImageEditorTool.Marquee:case s.ImageEditorTool.Pan:case s.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(e){const{tilemapState:t,dispatchCreateNewTile:n,gallery:i,backgroundColor:r}=this.props,{tileset:o}=t,s=pxt.sprite.tilemapLiteralToTilemap(e.map);if(!s||!s.width||!s.height)return;const a=e.tiles.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),l=e.layers.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),c=[];let d=o.tiles.length;for(const e of a){const t=o.tiles.findIndex((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t>=0)c.push(t);else{if(i){const t=i.find((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t){n(null,o.tiles.length,r,t.qualifiedName),c.push(d),d++;continue}}n((0,u.createTile)(e.data()),o.tiles.length,r),c.push(d),d++}}this.editState.mergeFloatingLayer();const h=new pxt.sprite.Tilemap(s.width,s.height);for(let e=0;e<h.width;e++)for(let t=0;t<h.height;t++)h.set(e,t,c[s.get(e,t)]);this.editState.floating={image:h,overlayLayers:l},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}n.ImageCanvasImpl=f;const g={dispatchImageEdit:a.dispatchImageEdit,dispatchChangeCursorLocation:a.dispatchChangeCursorLocation,dispatchChangeZoom:a.dispatchChangeZoom,dispatchChangeImageTool:a.dispatchChangeImageTool,dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchCreateNewTile:a.dispatchCreateNewTile};n.ImageCanvas=(0,o.connect)((function({store:{present:e},editor:t},n){if(t.isTilemap){let n=e;return n?{selectedColor:t.selectedColor,tilemapState:n,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:n.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery,tilesetRevision:t.tilesetRevision}:{}}let i=e;return i?{selectedColor:t.selectedColor,colors:i.colors,imageState:i.frames[i.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:i.frames[i.currentFrame-1],isTilemap:t.isTilemap,tilesetRevision:t.tilesetRevision}:{}}),g)(f)},{"../../assets":192,"./ImageEditor":212,"./actions/dispatch":219,"./keyboardShortcuts":221,"./store/imageReducer":223,"./toolDefinitions":227,"./util":228,react:548,"react-redux":521,"react/jsx-runtime":549}],212:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageEditor=n.LIGHT_MODE_TRANSPARENT=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./store/imageStore"),a=e("./SideBar"),l=e("./BottomBar"),c=e("./TopBar"),u=e("./ImageCanvas"),d=e("./Alert"),h=e("./Timeline"),p=e("./keyboardShortcuts"),f=e("./actions/dispatch"),g=e("./util"),m=e("../../assets"),b=e("../../../../react-common/components/util");n.LIGHT_MODE_TRANSPARENT="#dedede";class y extends r.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if((0,p.setStore)(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){const n=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:n})}else{const e=t.store.present.tileset.tileWidth,n=(0,m.createNewImageAsset)("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:n})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{const t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore((0,f.dispatchCloseTileEditor)(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){(0,p.addKeyListener)(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||(0,p.removeKeyListener)(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){const{singleFrame:e,lightMode:t,hideDoneButton:n,hideAssetName:r}=this.props,p=this.getStore(),{tileToEdit:f,editingTile:g,alert:m}=this.state,v="Animation"===p.getState().store.present.kind;return(0,i.jsxs)("div",Object.assign({className:"image-editor-outer"},{children:[(0,i.jsx)(o.Provider,Object.assign({store:p},{children:(0,i.jsxs)("div",Object.assign({className:(0,b.classList)("image-editor",g&&"editing-tile",n&&"hide-done-button")},{children:[(0,i.jsx)(c.TopBar,{singleFrame:e}),(0,i.jsxs)("div",Object.assign({className:"image-editor-content"},{children:[(0,i.jsx)(a.SideBar,{lightMode:t}),(0,i.jsx)(u.ImageCanvas,{suppressShortcuts:g,lightMode:t}),v&&!e?(0,i.jsx)(h.Timeline,{}):void 0]})),(0,i.jsx)(l.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick,hideDoneButton:!!n,hideAssetName:!!r}),m&&m.title&&(0,i.jsx)(d.Alert,{title:m.title,text:m.text,options:m.options})]}))})),g&&(0,i.jsx)(y,{store:s.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:f,singleFrame:!0,nested:!0,hideAssetName:r})]}))}openAsset(e,t,n=!1){this.dispatchOnStore((0,f.dispatchOpenAsset)(e,n,t)),e.meta.displayName?this.dispatchOnStore((0,f.dispatchChangeAssetName)(e.meta.displayName)):n&&this.dispatchOnStore((0,f.dispatchChangeAssetName)(""))}openGalleryAsset(e){const t=this.getAsset(),n=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===n.length);break;case"animation":this.dispatchOnStore((0,f.dispatchSetFrames)(e.frames.map((e=>({bitmap:e})))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore((0,f.dispatchChangeZoom)(0))}getCurrentFrame(){const e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return(0,g.imageStateToBitmap)(t)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e;const t=this.getStore().getState().store.present,n=this.getCurrentFrame().data(),i=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),type:"image",bitmap:n,jresData:pxt.sprite.base64EncodeBitmap(n),meta:i}}getTile(){var e;const t=this.getStore().getState().store.present,n=this.getCurrentFrame().data(),i=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),isProjectTile:!0,type:"tile",bitmap:n,jresData:pxt.sprite.base64EncodeBitmap(n),meta:i}}getAnimation(){var e;const t=this.getStore().getState().store.present,n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,m.getNewInternalID)(),type:"animation",interval:t.interval,frames:t.frames.map((e=>(0,g.imageStateToBitmap)(e).data())),meta:n}}getTilemap(){var e;const t=this.getStore().getState(),n=t.store.present,{floating:i,overlayLayers:r,layerOffsetX:o,layerOffsetY:s}=n.tilemap,a=(0,g.applyBitmapData)(pxt.sprite.Bitmap.fromData(r[0]).copy().data(),i&&i.overlayLayers&&i.overlayLayers[0],o,s),l=new pxt.sprite.TilemapData((0,g.imageStateToTilemap)(n.tilemap),n.tileset,a);l.deletedTiles=t.editor.deletedTiles,l.editedTiles=t.editor.editedTiles;const c=n.asset?Object.assign({},n.asset.meta):{};return{id:null===(e=n.asset)||void 0===e?void 0:e.id,internalID:n.asset?n.asset.internalID:(0,m.getNewInternalID)(),type:"tilemap",data:l,meta:c}}getPersistentData(){const e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore((0,f.dispatchSetInitialState)(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];if(e.width!==t.bitmap.width||e.height!==t.bitmap.height){const n=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)];t.bitmap.width===n[0]&&t.bitmap.height===n[1]||this.dispatchOnStore((0,f.dispatchChangeImageDimensions)(n)),e=(e=e.copy()).resize(n[0],n[1])}}this.dispatchOnStore((0,f.dispatchImageEdit)({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore((0,f.dispatchDisableResize)())}closeNestedEditor(){var e;this.state.editingTile&&(null===(e=this.refs["nested-image-editor"])||void 0===e||e.onDoneClick())}getJres(){if(this.props.singleFrame){const e=this.getCurrentFrame().data();return pxt.sprite.base64EncodeBitmap(e)}return""}loadJres(e){if(e)try{this.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){}}getStore(){return this.props.store||s.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}n.ImageEditor=y},{"../../../../react-common/components/util":187,"../../assets":192,"./Alert":206,"./BottomBar":207,"./ImageCanvas":211,"./SideBar":214,"./Timeline":215,"./TopBar":218,"./actions/dispatch":219,"./keyboardShortcuts":221,"./store/imageStore":224,"./util":228,react:548,"react-redux":521,"react/jsx-runtime":549}],213:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Pivot=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./util");class s extends r.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,n=e[t];return(0,i.jsx)("div",Object.assign({className:"image-editor-pivot-outer"},{children:e.map(((e,t)=>(0,i.jsx)("div",Object.assign({role:"tab",className:"image-editor-pivot-option "+(e===n?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:o.fireClickOnlyOnEnter},{children:e.text}),e.id)))}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:n}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(n[e],e)}}return this.handlers[e]}}n.Pivot=s},{"./util":228,react:548,"react/jsx-runtime":549}],214:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SideBar=n.SideBarImpl=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./toolDefinitions"),a=e("./Button"),l=e("./actions/dispatch"),c=e("./sprite/Palette"),u=e("./tilemap/TilePalette"),d=e("./tilemap/Minimap");class h extends r.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:e,isTilemap:t,lightMode:n}=this.props;return(0,i.jsxs)("div",Object.assign({className:"image-editor-sidebar "+(t?"tilemap":"")},{children:[t&&(0,i.jsx)("div",Object.assign({className:"image-editor-tilemap-minimap"},{children:(0,i.jsx)(d.Minimap,{lightMode:n})})),(0,i.jsx)("div",Object.assign({className:"image-editor-tool-buttons"},{children:s.tools.filter((e=>!e.hiddenTool)).map((t=>(0,i.jsx)(a.IconButton,{iconClass:t.iconClass,toggle:e!=t.tool,title:t.title,onClick:this.clickHandler(t.tool)},t.tool)))})),(0,i.jsx)("div",Object.assign({className:"image-editor-palette"},{children:t?(0,i.jsx)(u.TilePalette,{}):(0,i.jsx)(c.Palette,{})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}n.SideBarImpl=h;const p={dispatchChangeImageTool:l.dispatchChangeImageTool};n.SideBar=(0,o.connect)((function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}}),p)(h)},{"./Button":208,"./actions/dispatch":219,"./sprite/Palette":222,"./tilemap/Minimap":225,"./tilemap/TilePalette":226,"./toolDefinitions":227,react:548,"react-redux":521,"react/jsx-runtime":549}],215:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Timeline=n.TimelineImpl=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./TimelineFrame"),l=e("./util");class c extends r.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{const{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{const{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{const{dispatchNewFrame:e}=this.props;this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:t,currentFrame:n,interval:r,previewAnimating:o}=this.props,{isMovingFrame:s,dropPreviewIndex:l}=this.state;let c,u=e.slice();return s&&(c=e[n],u.splice(n,1),u.splice(l,0,null)),(0,i.jsxs)("div",Object.assign({className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},{children:[(0,i.jsx)("div",Object.assign({className:"image-editor-timeline-preview"},{children:(0,i.jsx)(a.TimelineFrame,{frames:o?e:[e[n]],colors:t,interval:r,animating:!0})})),(0,i.jsx)("div",Object.assign({className:"image-editor-timeline-frames-outer"},{children:(0,i.jsxs)("div",Object.assign({className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},{children:[u.map(((e,r)=>{const o=!s&&r===n;return e?(0,i.jsx)("div",Object.assign({className:"image-editor-timeline-frame "+(o?"active":""),role:"button",onClick:this.clickHandler(r)},{children:(0,i.jsx)(a.TimelineFrame,{frames:[e],colors:t,showActions:o,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})}),r):(0,i.jsx)("div",{className:"image-editor-timeline-frame drop-marker"},r)})),c&&(0,i.jsx)("div",Object.assign({ref:"floating-frame",className:"image-editor-timeline-frame dragging"},{children:(0,i.jsx)(a.TimelineFrame,{frames:[c],colors:t,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})})),(0,i.jsx)("div",Object.assign({className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},{children:(0,i.jsx)("span",{className:"ms-Icon ms-Icon--Add"})}))]}))}))]}))}componentDidMount(){let e;this.frameScroller=this.refs["frame-scroller-ref"];let t=!1;(0,l.bindGestureEvents)(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:n=>{e=n.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");const i=this.frameScroller.getBoundingClientRect(),r=n.clientY-i.top,o=this.frameScroller.firstElementChild.getBoundingClientRect().height,s=Math.floor(r/o);t=s!==this.props.currentFrame},onDragMove:n=>{if(t){this.scrollOffset-=e-n.clientY,e=n.clientY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(n)},onDragEnd:()=>{if(e=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:e,currentFrame:t}=this.props;e(t,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",(e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{currentFrame:t,dispatchChangeCurrentFrame:n}=this.props;this.dragEnd?this.dragEnd=!1:e!=t&&n(e)}),this.handlers[e]}updateDragDrop(e){const t=this.frameScroller.getBoundingClientRect(),n=e.clientY-t.top,i=this.frameScroller.firstElementChild.getBoundingClientRect().height,r=Math.floor(n/i);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=n+"px",this.setState({dropPreviewIndex:r})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}n.TimelineImpl=c;const u={dispatchDuplicateFrame:s.dispatchDuplicateFrame,dispatchDeleteFrame:s.dispatchDeleteFrame,dispatchChangeCurrentFrame:s.dispatchChangeCurrentFrame,dispatchNewFrame:s.dispatchNewFrame,dispatchMoveFrame:s.dispatchMoveFrame};n.Timeline=(0,o.connect)((function({store:{present:e},editor:t},n){let i=e;return i?{frames:i.frames,currentFrame:i.currentFrame,colors:i.colors,interval:i.interval,previewAnimating:t.previewAnimating}:{}}),u)(c)},{"./TimelineFrame":216,"./actions/dispatch":219,"./util":228,react:548,"react-redux":521,"react/jsx-runtime":549}],216:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimelineFrame=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./Button"),s=pxt.BrowserUtils.isEdge()?25:1;class a extends r.Component{constructor(e){super(e),this.state={index:0}}render(){const{frames:e,animating:t,showActions:n,duplicateFrame:r,deleteFrame:s}=this.props,a=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],l=a.bitmap.height>a.bitmap.width;return(0,i.jsxs)("div",Object.assign({className:"timeline-frame-outer "+(l?"portrait":"landscape")},{children:[(0,i.jsx)("div",{className:"timeline-frame-spacer"}),(0,i.jsx)("canvas",{ref:"preview-canvas"}),(0,i.jsx)("div",{className:"timeline-frame-spacer"}),n&&(0,i.jsxs)("div",Object.assign({className:"timeline-frame-actions"},{children:[(0,i.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:r}),(0,i.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:s})]}))]}))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(!this.canvas)return;const{animating:e,frames:t}=this.props,n=t[e?Math.min(Math.max(0,this.state.index),t.length-1):0];this.canvas.height=n.bitmap.height*s,this.canvas.width=n.bitmap.width*s;const i=pxt.sprite.Bitmap.fromData(n.bitmap);if(this.drawBitmap(i),n.floating&&n.floating.bitmap){const e=pxt.sprite.Bitmap.fromData(n.floating.bitmap);this.drawBitmap(e,n.layerOffsetX,n.layerOffsetY,!0)}}updateAnimation(){const{animating:e,interval:t,frames:n}=this.props,i=e&&t>5&&n.length>1;i&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.setState({index:(this.state.index+1)%this.props.frames.length})),t),this.intervalcurrent=t):!i&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(e,t=0,n=0,i=!1){const{colors:r}=this.props,o=this.canvas.getContext("2d");for(let a=0;a<e.width;a++)for(let l=0;l<e.height;l++){const c=e.get(a,l);c?(o.fillStyle=r[c],o.fillRect((a+t)*s,(l+n)*s,s,s)):i||o.clearRect((a+t)*s,(l+n)*s,s,s)}}}n.TimelineFrame=a},{"./Button":208,react:548,"react/jsx-runtime":549}],217:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Toggle=void 0;const i=e("react/jsx-runtime"),r=e("react");class o extends r.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){const{initialValue:e,label:t}=this.props;return(0,i.jsxs)("div",Object.assign({className:"image-editor-toggle-container"},{children:[t&&(0,i.jsx)("span",{children:t}),(0,i.jsxs)("label",Object.assign({className:"image-editor-toggle"},{children:[(0,i.jsx)("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),(0,i.jsx)("span",{className:"image-editor-toggle-switch"})]}))]}))}}n.Toggle=o},{react:548,"react/jsx-runtime":549}],218:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TopBar=n.TopBarImpl=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./actions/dispatch"),a=e("./Button"),l=e("./CursorSizes"),c=e("./Toggle"),u=e("./keyboardShortcuts");class d extends r.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>(0,u.flip)(!0),this.flipHorizontal=()=>(0,u.flip)(!1),this.rotateClockwise=()=>(0,u.rotate)(!0),this.rotateCounterclockwise=()=>(0,u.rotate)(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{const{dispatchChangeInterval:e}=this.props,t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){const{interval:e,previewAnimating:t,singleFrame:n,isTilemap:r,dispatchChangeOverlayEnabled:o}=this.props,s=null==this.state.interval?e:this.state.interval;return(0,i.jsxs)("div",Object.assign({className:"image-editor-topbar"},{children:[(0,i.jsx)("div",Object.assign({className:"cursor-group"},{children:(0,i.jsx)(l.CursorSizes,{})})),(0,i.jsx)("div",{className:"image-editor-seperator"}),(0,i.jsxs)("div",Object.assign({className:"image-transform-group"},{children:[(0,i.jsx)(a.IconButton,{iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical},"flipv"),(0,i.jsx)(a.IconButton,{iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal},"fliph"),(0,i.jsx)(a.IconButton,{iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise},"rotatec"),(0,i.jsx)(a.IconButton,{iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise},"rotatecc")]})),(0,i.jsx)("div",{className:"spacer"}),!n&&(0,i.jsx)("div",{className:"image-editor-seperator"}),!n&&(0,i.jsxs)("div",Object.assign({className:"timeline-controls"},{children:[(0,i.jsx)(a.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),(0,i.jsx)("div",Object.assign({className:"image-editor-interval-label image-editor-label"},{children:(0,i.jsx)("span",{className:"ms-Icon ms-Icon--Clock"})})),(0,i.jsx)("div",Object.assign({className:"image-editor-interval"},{children:(0,i.jsx)("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:s,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur})}))]})),r&&(0,i.jsx)(c.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o})]}))}}n.TopBarImpl=d;const h={dispatchChangeInterval:s.dispatchChangeInterval,dispatchChangePreviewAnimating:s.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:s.dispatchChangeOverlayEnabled};n.TopBar=(0,o.connect)((function({store:{present:e},editor:t},n){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}}),h)(d)},{"./Button":208,"./CursorSizes":209,"./Toggle":217,"./actions/dispatch":219,"./keyboardShortcuts":221,react:548,"react-redux":521,"react/jsx-runtime":549}],219:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dispatchSetFrames=n.dispatchOpenAsset=n.dispatchChangeAssetName=n.dispatchDisableResize=n.dispatchDeleteTile=n.dispatchCloseTileEditor=n.dispatchOpenTileEditor=n.dispatchSetGalleryOpen=n.dispatchCreateNewTile=n.dispatchChangeDrawingMode=n.dispatchChangeTilePalettePage=n.dispatchChangeTilePaletteCategory=n.dispatchSetInitialState=n.dispatchChangeBackgroundColor=n.dispatchSwapBackgroundForeground=n.dispatchHideAlert=n.dispatchShowAlert=n.dispatchChangeZoom=n.dispatchChangeOverlayEnabled=n.dispatchToggleOnionSkinEnabled=n.dispatchChangePreviewAnimating=n.dispatchChangeInterval=n.dispatchMoveFrame=n.dispatchChangeCurrentFrame=n.dispatchDuplicateFrame=n.dispatchDeleteFrame=n.dispatchNewFrame=n.dispatchToggleAspectRatioLocked=n.dispatchRedoImageEdit=n.dispatchUndoImageEdit=n.dispatchImageEdit=n.dispatchChangeCursorLocation=n.dispatchChangeKeyModifiers=n.dispatchChangeImageDimensions=n.dispatchChangeSelectedColor=n.dispatchChangeCursorSize=n.dispatchChangeImageTool=void 0;const i=e("./types");n.dispatchChangeImageTool=e=>({type:i.CHANGE_IMAGE_TOOL,tool:e});n.dispatchChangeCursorSize=e=>({type:i.CHANGE_CURSOR_SIZE,cursorSize:e});n.dispatchChangeSelectedColor=e=>({type:i.CHANGE_SELECTED_COLOR,selectedColor:e});n.dispatchChangeImageDimensions=e=>({type:i.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e});n.dispatchChangeKeyModifiers=e=>({type:i.CHANGE_KEY_MODIFIERS,keyModifiers:e});n.dispatchChangeCursorLocation=e=>({type:i.CHANGE_CURSOR_LOCATION,cursorLocation:e});n.dispatchImageEdit=e=>({type:i.IMAGE_EDIT,newState:e});n.dispatchUndoImageEdit=()=>({type:i.UNDO_IMAGE_EDIT});n.dispatchRedoImageEdit=()=>({type:i.REDO_IMAGE_EDIT});n.dispatchToggleAspectRatioLocked=()=>({type:i.TOGGLE_ASPECT_RATIO});n.dispatchNewFrame=e=>({type:i.NEW_FRAME,index:e});n.dispatchDeleteFrame=e=>({type:i.DELETE_FRAME,index:e});n.dispatchDuplicateFrame=e=>({type:i.DUPLICATE_FRAME,index:e});n.dispatchChangeCurrentFrame=e=>({type:i.CHANGE_CURRENT_FRAME,index:e});n.dispatchMoveFrame=(e,t)=>({type:i.MOVE_FRAME,oldIndex:e,newIndex:t});n.dispatchChangeInterval=e=>({type:i.CHANGE_INTERVAL,newInterval:e});n.dispatchChangePreviewAnimating=e=>({type:i.CHANGE_PREVIEW_ANIMATING,animating:e});n.dispatchToggleOnionSkinEnabled=()=>({type:i.TOGGLE_ONION_SKIN_ENABLED});n.dispatchChangeOverlayEnabled=e=>({type:i.CHANGE_OVERLAY_ENABLED,enabled:e});n.dispatchChangeZoom=e=>({type:i.CHANGE_CANVAS_ZOOM,zoom:e});n.dispatchShowAlert=(e,t,n)=>({type:i.SHOW_ALERT,title:e,text:t,options:n});n.dispatchHideAlert=()=>({type:i.HIDE_ALERT});n.dispatchSwapBackgroundForeground=()=>({type:i.SWAP_FOREGROUND_BACKGROUND});n.dispatchChangeBackgroundColor=e=>({type:i.CHANGE_BACKGROUND_COLOR,backgroundColor:e});n.dispatchSetInitialState=(e,t)=>({type:i.SET_INITIAL_STATE,state:e,past:t});n.dispatchChangeTilePaletteCategory=e=>({type:i.CHANGE_TILE_PALETTE_CATEGORY,category:e});n.dispatchChangeTilePalettePage=e=>({type:i.CHANGE_TILE_PALETTE_PAGE,page:e});n.dispatchChangeDrawingMode=e=>({type:i.CHANGE_DRAWING_MODE,drawingMode:e});n.dispatchCreateNewTile=(e,t,n,r)=>({type:i.CREATE_NEW_TILE,tile:e,foreground:t,background:n,qualifiedName:r});n.dispatchSetGalleryOpen=e=>({type:i.SET_GALLERY_OPEN,open:e});n.dispatchOpenTileEditor=(e,t)=>({type:i.OPEN_TILE_EDITOR,index:e,id:t});n.dispatchCloseTileEditor=(e,t)=>({type:i.CLOSE_TILE_EDITOR,result:e,index:t});n.dispatchDeleteTile=(e,t)=>({type:i.DELETE_TILE,id:t,index:e});n.dispatchDisableResize=()=>({type:i.DISABLE_RESIZE});n.dispatchChangeAssetName=e=>({type:i.CHANGE_ASSET_NAME,name:e});n.dispatchOpenAsset=(e,t,n)=>({type:i.OPEN_ASSET,asset:e,keepPast:t,gallery:n});n.dispatchSetFrames=e=>({type:i.SET_FRAMES,frames:e})},{"./types":220}],220:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OPEN_ASSET=n.CHANGE_ASSET_NAME=n.DISABLE_RESIZE=n.DELETE_TILE=n.CLOSE_TILE_EDITOR=n.OPEN_TILE_EDITOR=n.CREATE_NEW_TILE=n.CHANGE_DRAWING_MODE=n.CHANGE_TILE_PALETTE_CATEGORY=n.CHANGE_TILE_PALETTE_PAGE=n.CHANGE_BACKGROUND_COLOR=n.SWAP_FOREGROUND_BACKGROUND=n.HIDE_ALERT=n.SHOW_ALERT=n.CHANGE_CANVAS_ZOOM=n.CHANGE_OVERLAY_ENABLED=n.TOGGLE_ONION_SKIN_ENABLED=n.CHANGE_PREVIEW_ANIMATING=n.CHANGE_INTERVAL=n.CHANGE_CURRENT_FRAME=n.MOVE_FRAME=n.DUPLICATE_FRAME=n.DELETE_FRAME=n.NEW_FRAME=n.SET_GALLERY_OPEN=n.TOGGLE_ASPECT_RATIO=n.REDO_IMAGE_EDIT=n.UNDO_IMAGE_EDIT=n.IMAGE_EDIT=n.CHANGE_CURSOR_LOCATION=n.CHANGE_KEY_MODIFIERS=n.CHANGE_IMAGE_DIMENSIONS=n.CHANGE_SELECTED_COLOR=n.CHANGE_CURSOR_SIZE=n.CHANGE_IMAGE_TOOL=n.SET_FRAMES=n.SET_INITIAL_STATE=void 0,n.SET_INITIAL_STATE="SET_INITIAL_STATE",n.SET_FRAMES="SET_FRAMES",n.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",n.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",n.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",n.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",n.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",n.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",n.IMAGE_EDIT="IMAGE_EDIT",n.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",n.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",n.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",n.SET_GALLERY_OPEN="SET_GALLERY_OPEN",n.NEW_FRAME="NEW_FRAME",n.DELETE_FRAME="DELETE_FRAME",n.DUPLICATE_FRAME="DUPLICATE_FRAME",n.MOVE_FRAME="MOVE_FRAME",n.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",n.CHANGE_INTERVAL="CHANGE_INTERVAL",n.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",n.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",n.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",n.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",n.SHOW_ALERT="SHOW_ALERT",n.HIDE_ALERT="HIDE_ALERT",n.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",n.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",n.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",n.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",n.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",n.CREATE_NEW_TILE="CREATE_NEW_TILE",n.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",n.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",n.DELETE_TILE="DELETE_TILE",n.DISABLE_RESIZE="DISABLE_RESIZE",n.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",n.OPEN_ASSET="OPEN_ASSET"},{}],221:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.replaceColor=n.outline=n.rotate=n.flip=n.setStore=n.areShortcutsEnabled=n.releaseShortcutLock=n.obtainShortcutLock=n.removeKeyListener=n.addKeyListener=void 0;const i=e("./store/imageReducer"),r=e("./actions/dispatch"),o=e("./store/imageStore"),s=e("./toolDefinitions");let a=o.mainStore,l=[];function c(){return!l.length}function u(e){const t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(m((0,r.dispatchUndoImageEdit)()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(m((0,r.dispatchRedoImageEdit)()),e.preventDefault(),e.stopPropagation())}function d(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function h(e){if(!c())return;if(e.shiftKey&&/^(?:Digit[1-9])|(?:Key[A-F])$/.test(e.code))return void(0==e.code.indexOf("Digit")?_(parseInt(e.code.substring(5))):_(parseInt(e.code.substring(3),16)));switch(e.key){case"e":f(i.ImageEditorTool.Erase);break;case"h":f(i.ImageEditorTool.Pan);break;case"b":case"p":f(i.ImageEditorTool.Paint);break;case"g":f(i.ImageEditorTool.Fill);break;case"m":f(i.ImageEditorTool.Marquee);break;case"u":f(i.ImageEditorTool.Rect);break;case"l":f(i.ImageEditorTool.Line);break;case"c":f(i.ImageEditorTool.Circle);break;case"-":case"_":g(-1);break;case"=":case"+":g(1);break;case"x":m((0,r.dispatchSwapBackgroundForeground)());break;case"H":y(!1);break;case"V":y(!0);break;case"[":v(!1);break;case"]":v(!0);break;case">":b(!0);break;case"<":b(!1)}const t=a.getState().editor;if(e.shiftKey&&"KeyR"===e.code)E(t.backgroundColor,t.selectedColor);else if(!t.isTilemap&&/^Digit\d$/.test(e.code)){const t=+e.code.slice(-1)+(e.shiftKey?9:0);t>=0&&t<16&&function(e){m((0,r.dispatchChangeSelectedColor)(e))}(t)}}function p(){const e=a.getState();if(e.editor.isTilemap){const t=e.store.present;return[(0,s.getEditState)(t.tilemap,!0,e.editor.drawingMode),"tilemap"]}{const t=e.store.present;return[(0,s.getEditState)(t.frames[t.currentFrame],!1,e.editor.drawingMode),t.frames.length>1?"animation":"image"]}}function f(e){m((0,r.dispatchChangeImageTool)(e))}function g(e){m((0,r.dispatchChangeZoom)(e))}function m(e){a.dispatch(e)}function b(e){let t;const n=a.getState().editor.cursorSize;switch(n){case 1:t=e?3:1;break;case 3:t=e?5:1;break;case 5:t=e?5:3}n!==t&&m((0,r.dispatchChangeCursorSize)(t))}function y(e){const[t,n]=p(),i=(0,s.flipEdit)(t,e,"tilemap"===n);m((0,r.dispatchImageEdit)(i.toImageState()))}function v(e){const[t,n]=p(),i=(0,s.rotateEdit)(t,e,"tilemap"===n,"animation"===n);m((0,r.dispatchImageEdit)(i.toImageState()))}function _(e){const[t,n]=p();if("tilemap"===n)return;const i=(0,s.outlineEdit)(t,e);m((0,r.dispatchImageEdit)(i.toImageState()))}function E(e,t){const[n,i]=p(),o=(0,s.replaceColorEdit)(n,e,t);m((0,r.dispatchImageEdit)(o.toImageState()))}n.addKeyListener=function(){l=[],document.addEventListener("keydown",h),document.addEventListener("keydown",u,!0),document.addEventListener("keydown",d,!0)},n.removeKeyListener=function(){document.removeEventListener("keydown",h),document.removeEventListener("keydown",u,!0),document.removeEventListener("keydown",d,!0)},n.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},n.releaseShortcutLock=function(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)},n.areShortcutsEnabled=c,n.setStore=function(e){a=e||o.mainStore},n.flip=y,n.rotate=v,n.outline=_,n.replaceColor=E},{"./actions/dispatch":219,"./store/imageReducer":223,"./store/imageStore":224,"./toolDefinitions":227}],222:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Palette=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("../actions/dispatch");class a extends r.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){const{colors:e,selected:t,backgroundColor:n,dispatchSwapBackgroundForeground:r}=this.props;return(0,i.jsxs)("div",{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:r},{children:[(0,i.jsx)("defs",{children:(0,i.jsxs)("pattern",Object.assign({id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},{children:[(0,i.jsx)("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),(0,i.jsx)("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),(0,i.jsx)("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"})]}))}),(0,i.jsxs)("g",{children:[(0,i.jsx)("rect",Object.assign({fill:n?e[n]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,i.jsx)("title",{children:l(n,e[n])})})),(0,i.jsx)("rect",Object.assign({fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,i.jsx)("title",{children:l(t,e[t])})}))]})]})),(0,i.jsx)("div",Object.assign({className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},{children:this.props.colors.map(((e,t)=>(0,i.jsx)("div",{className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:l(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}},t)))}))]})}clickHandler(e){return this.handlers[e]||(this.handlers[e]=t=>{0===t.button?this.props.dispatchChangeSelectedColor(e):(this.props.dispatchChangeBackgroundColor(e),t.preventDefault(),t.stopPropagation())}),this.handlers[e]}}function l(e,t){const n=0===e?lf("transparency"):function(e){switch(null==e?void 0:e.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}(t);return n?lf("Color {0} ({1})",e,n):lf("Color {0}",e)}const c={dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:s.dispatchSwapBackgroundForeground};n.Palette=(0,o.connect)((function({store:{present:e},editor:t},n){let i=e;return i?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:i.colors}:{}}),c)(a)},{"../actions/dispatch":219,react:548,"react-redux":521,"react/jsx-runtime":549}],223:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setTelemetryFunction=n.TileDrawingMode=n.TileCategory=n.KeyModifiers=n.CursorSize=n.ImageEditorTool=void 0;const i=e("../../../assets"),r=e("../actions/types");var o,s,a,l;(l=o=n.ImageEditorTool||(n.ImageEditorTool={}))[l.Paint=0]="Paint",l[l.Fill=1]="Fill",l[l.Line=2]="Line",l[l.Erase=3]="Erase",l[l.Circle=4]="Circle",l[l.Rect=5]="Rect",l[l.ColorSelect=6]="ColorSelect",l[l.Marquee=7]="Marquee",l[l.Pan=8]="Pan",function(e){e[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five"}(n.CursorSize||(n.CursorSize={})),function(e){e[e.Alt=1]="Alt",e[e.Shift=2]="Shift"}(n.KeyModifiers||(n.KeyModifiers={})),function(e){e[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc"}(s=n.TileCategory||(n.TileCategory={})),function(e){e.Default="default",e.Wall="wall"}(a=n.TileDrawingMode||(n.TileDrawingMode={}));const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!1,currentFrame:0,frames:[f(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,tilesetRevision:0,isTilemap:!1}},u=(e,t)=>{switch(t.type){case r.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case r.CHANGE_CURRENT_FRAME:return m("change-frame"),Object.assign(Object.assign({},e),{currentFrame:t.index});case r.CHANGE_INTERVAL:return m("change-interval"),Object.assign(Object.assign({},e),{interval:t.newInterval});case r.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[n,i]=t.imageDimensions;return Object.assign(Object.assign({},e),{frames:e.frames.map(((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(n,i).data()})))});case r.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},e),{frames:e.frames.map(((n,i)=>i===e.currentFrame?t.newState:n))});case r.DELETE_FRAME:if(1===e.frames.length)return e;m("delete-frame");const o=e.frames.slice();o.splice(t.index,1);let s=e.currentFrame;return e.currentFrame>=t.index&&e.currentFrame>0&&s--,Object.assign(Object.assign({},e),{currentFrame:s,frames:o});case r.DUPLICATE_FRAME:m("duplicate-frame");const a=e.frames.slice();return a.splice(t.index,0,function(e){let t,n,i;return e.floating&&(e.floating.bitmap&&(n=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(i=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data()))),t={bitmap:n,overlayLayers:i}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data())),floating:t})}(e.frames[t.index])),Object.assign(Object.assign({},e),{frames:a,currentFrame:t.index+1});case r.NEW_FRAME:return m("new-frame"),Object.assign(Object.assign({},e),{frames:[...e.frames,f(e.frames[0].bitmap.width,e.frames[0].bitmap.height)],currentFrame:e.frames.length});case r.MOVE_FRAME:if(t.newIndex<0||t.newIndex>=e.frames.length||t.newIndex<0||t.newIndex>=e.frames.length)return e;m("move-frame");const l=e.frames.slice(),c=l.splice(t.oldIndex,1)[0];return l.splice(t.newIndex,0,c),Object.assign(Object.assign({},e),{frames:l,currentFrame:t.oldIndex===e.currentFrame?t.newIndex:e.currentFrame});case r.SET_FRAMES:return m("set-frames"),Object.assign(Object.assign({},e),{frames:t.frames,currentFrame:0});default:return e}},d=(e,t,n)=>{let i;switch(t.type){case r.CHANGE_PREVIEW_ANIMATING:return m("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case r.CHANGE_CANVAS_ZOOM:return(t.zoom>0||t.zoom<0)&&m("zoom-"+(t.zoom>0?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case r.CHANGE_IMAGE_TOOL:return m(`change-tool-${o[t.tool]}`),Object.assign(Object.assign({},e),{tool:t.tool});case r.CHANGE_CURSOR_SIZE:return m(`change-cursor-size-${t.cursorSize}`),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case r.CHANGE_SELECTED_COLOR:return m(`foreground-color-${t.selectedColor}`),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case r.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case r.CHANGE_BACKGROUND_COLOR:return m(`background-color-${t.backgroundColor}`),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case r.SWAP_FOREGROUND_BACKGROUND:return m("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case r.TOGGLE_ONION_SKIN_ENABLED:return m("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case r.CHANGE_TILE_PALETTE_CATEGORY:return m(`change-tile-category-${s[t.category]}`),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case r.CHANGE_TILE_PALETTE_PAGE:return m("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case r.CHANGE_DRAWING_MODE:return m("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||a.Default});case r.CHANGE_OVERLAY_ENABLED:return m("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case r.CREATE_NEW_TILE:return i=e.editedTiles,!t.tile||i&&-1!==i.indexOf(t.tile.id)||(i=(i||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:i,selectedColor:t.foreground,backgroundColor:t.background});case r.SET_GALLERY_OPEN:return m(`set-gallery-open-${t.open}`),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case r.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor,tilesetRevision:e.tilesetRevision+1});case r.OPEN_TILE_EDITOR:const l=t.index?"edit":"new";return m(`open-tile-editor-${l}`),Object.assign(Object.assign({},e),{editingTile:{type:l,tilesetIndex:t.index}});case r.CLOSE_TILE_EDITOR:return i=e.editedTiles,!t.result||i&&-1!==i.indexOf(t.result.id)||(i=(i||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:i,selectedColor:t.index||n.present.tileset.tiles.length,editingTile:void 0,tilesetRevision:e.tilesetRevision+1});case r.SHOW_ALERT:return m("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case r.HIDE_ALERT:return m("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case r.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},h=(e,t)=>{switch(t.type){case r.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case r.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[n,o]=t.imageDimensions;return Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:v(e.tilemap.bitmap,n,o),overlayLayers:e.tilemap.overlayLayers&&e.tilemap.overlayLayers.map((e=>function(e,t,n){return pxt.sprite.Bitmap.fromData(e).resize(t,n).data()}(e,n,o)))})});case r.CREATE_NEW_TILE:const s=!t.qualifiedName;let a;return m(s?"new-tile":`used-tile-${t.qualifiedName}`),s?(a=t.tile).isProjectTile=!0:a=(0,i.lookupAsset)("tile",t.qualifiedName),Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([a])}),nextId:s?e.nextId+1:e.nextId});case r.CLOSE_TILE_EDITOR:return m("close-tile-editor"),t.result?t.index?Object.assign(Object.assign({},e),{tileset:p(e.tileset,t.index,t.result)}):Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([t.result])}),nextId:e.nextId+1}):e;case r.DELETE_TILE:m("delete-tile");const l=e.tileset.tiles.slice();return l.splice(t.index,1),Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:y(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},e.tileset),{tiles:l})});case r.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},e),{tilemap:t.newState});default:return e}};function p(e,t,n){return Object.assign(Object.assign({},e),{tiles:e.tiles.map(((e,i)=>i===t?n:e))})}function f(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let g;function m(e){g&&g(e)}function b(e,t){for(const n of e.tiles)if(!n.jresData&&!n.isProjectTile)for(const e of t)if(e.qualifiedName===n.id){n.bitmap=e.bitmap;break}return e}function y(e,t){const n=t.copy();for(let t=0;t<n.width;t++)for(let i=0;i<n.height;i++){const r=n.get(t,i);r===e?n.set(t,i,0):r>e&&n.set(t,i,r-1)}return n}function v(e,t,n){return pxt.sprite.Tilemap.fromData(e).resize(t,n).data()}function _(e,t){return"tilemap"===e.type?function(e,t){return{kind:"Tilemap",asset:e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:e.data.tilemap.data(),overlayLayers:[e.data.layers]},tileset:b(e.data.tileset,t),nextId:e.data.nextId}}(e,t):function(e){return{kind:"Animation",asset:e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===e.type,currentFrame:0,frames:"animation"===e.type?e.frames.map((e=>({bitmap:e}))):[{bitmap:e.bitmap}],interval:"animation"===e.type?e.interval:100}}(e)}n.setTelemetryFunction=function(e){g=e},n.default=(e=c,t)=>{var n;switch(t.type){case r.OPEN_TILE_EDITOR:case r.CHANGE_PREVIEW_ANIMATING:case r.CHANGE_CANVAS_ZOOM:case r.CHANGE_IMAGE_TOOL:case r.CHANGE_CURSOR_SIZE:case r.CHANGE_SELECTED_COLOR:case r.CHANGE_CURSOR_LOCATION:case r.CHANGE_BACKGROUND_COLOR:case r.SWAP_FOREGROUND_BACKGROUND:case r.TOGGLE_ONION_SKIN_ENABLED:case r.CHANGE_OVERLAY_ENABLED:case r.CHANGE_TILE_PALETTE_PAGE:case r.CHANGE_TILE_PALETTE_CATEGORY:case r.CHANGE_DRAWING_MODE:case r.SET_GALLERY_OPEN:case r.SHOW_ALERT:case r.HIDE_ALERT:case r.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store)});case r.SET_INITIAL_STATE:const o=t.state;return Object.assign(Object.assign({},e),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:o.selectedColor,backgroundColor:o.backgroundColor,tilemapPalette:o.tilemapPalette,tileGalleryOpen:o.tileGalleryOpen,tileGallery:o.tileGallery,isTilemap:o.isTilemap,referencedTiles:e.editor.referencedTiles}),store:Object.assign(Object.assign({},e.store),{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case r.OPEN_ASSET:const l=t.asset,p=t.gallery||(t.keepPast?e.editor.tileGallery:[]);let f=-1;if("tilemap"===l.type){const e=t.asset.data;if(pxt.sprite.isEmptyTilemap(e)){const t=e.tileset.tiles||[],r=null===(n=p.find((e=>-1!==e.tags.indexOf("forest"))))||void 0===n?void 0:n.qualifiedName,o=(0,i.lookupAsset)("tile",r);o&&!t.find((e=>e.id===r))&&t.push(o),f=t.indexOf(o)}}return Object.assign(Object.assign({},e),{editor:"tilemap"===l.type?{selectedColor:f,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:s.Forest,page:0},drawingMode:a.Default,overlayEnabled:!0,tileGallery:p,tileGalleryOpen:!!p,referencedTiles:l.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tilesetRevision:0,tool:t.keepPast?e.editor.tool:c.editor.tool,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,editedTiles:t.keepPast?e.editor.editedTiles:void 0,deletedTiles:t.keepPast?e.editor.deletedTiles:void 0}:{isTilemap:!1,tilesetRevision:0,selectedColor:t.keepPast?e.editor.selectedColor:c.editor.selectedColor,backgroundColor:t.keepPast?e.editor.backgroundColor:c.editor.backgroundColor,previewAnimating:t.keepPast?e.editor.previewAnimating:c.editor.previewAnimating,tool:t.keepPast?e.editor.tool:c.editor.tool,onionSkinEnabled:t.keepPast?e.editor.onionSkinEnabled:c.editor.onionSkinEnabled,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,resizeDisabled:t.keepPast?e.editor.resizeDisabled:c.editor.resizeDisabled},store:Object.assign(Object.assign({},e.store),{past:t.keepPast?e.store.past:[],present:_(t.asset,p),future:[]})});case r.CHANGE_ASSET_NAME:return m("change-asset-name"),Object.assign(Object.assign({},e),{store:{past:[...e.store.past,e.store.present],present:Object.assign(Object.assign({},e.store.present),{asset:Object.assign(Object.assign({},e.store.present.asset),{meta:Object.assign(Object.assign({},e.store.present.asset.meta||{}),{displayName:t.name})})}),future:[]}});case r.UNDO_IMAGE_EDIT:return e.store.past.length?(m("undo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:[...e.store.future,e.store.present]}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;case r.REDO_IMAGE_EDIT:return e.store.future.length?(m("redo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;default:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store),store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.editor.isTilemap?h(e.store.present,t):u(e.store.present,t),future:[]})})}}},{"../../../assets":192,"../actions/types":220}],224:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mainStore=n.tileEditorStore=void 0;const i=e("redux"),r=e("./imageReducer"),o=(0,i.createStore)(r.default);n.default=o,n.tileEditorStore=(0,i.createStore)(r.default),n.mainStore=o},{"./imageReducer":223,redux:565}],225:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Minimap=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("../ImageEditor"),a=pxt.BrowserUtils.isEdge()?25:1;class l extends r.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return(0,i.jsx)("div",Object.assign({className:"minimap-outer"},{children:(0,i.jsx)("canvas",{ref:"minimap-canvas",className:"paint-surface"})}))}redrawCanvas(){const{tilemap:e,lightMode:t}=this.props;let{bitmap:n,floating:i,layerOffsetX:r,layerOffsetY:o}=e;const l=this.canvas.getContext("2d"),c=pxt.sprite.Tilemap.fromData(n),u=i&&i.bitmap?pxt.sprite.Tilemap.fromData(i.bitmap):null;this.canvas.width=c.width*a,this.canvas.height=c.height*a,this.tileColors=[];for(let e=0;e<c.width;e++)for(let n=0;n<c.height;n++){const i=u?u.get(e-r,n-o):null,d=c.get(e,n);i?(l.fillStyle=this.getColor(i),l.fillRect(e*a,n*a,a,a)):d?(l.fillStyle=this.getColor(d),l.fillRect(e*a,n*a,a,a)):t?(l.fillStyle=s.LIGHT_MODE_TRANSPARENT,l.fillRect(e*a,n*a,a,a)):l.clearRect(e*a,n*a,a,a)}}getColor(e){if(!this.tileColors[e]){const{tileset:t,colors:n}=this.props;if(e>=t.tiles.length)return"#ffffff";const i=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(i,n)}return this.tileColors[e]}}n.Minimap=(0,o.connect)((function({store:{present:e},editor:t},n){let i=e;return i?{tilemap:i.tilemap,tileset:i.tileset,colors:i.colors}:{}}),{})(l)},{"../ImageEditor":212,react:548,"react-redux":521,"react/jsx-runtime":549}],226:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TilePalette=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("../store/imageReducer"),a=e("../actions/dispatch"),l=e("../TimelineFrame"),c=e("../Dropdown"),u=e("../Pivot"),d=e("../Button"),h=e("../../../assets"),p=pxt.BrowserUtils.isEdge()?25:1,f=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],g=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],m=new pxt.sprite.Bitmap(16,16);class b extends r.Component{constructor(e){super(e),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{const{tileset:e,selected:t,dispatchOpenTileEditor:n}=this.props,i=e.tiles[t];(null==i?void 0:i.isProjectTile)&&0!==t&&n(t,i.id)},this.tileDuplicateHandler=()=>{var e;const{tileset:t,selected:n,backgroundColor:i,dispatchCreateNewTile:r}=this.props;if(!t.tiles[n]||!t.tiles[n].isProjectTile||0===n)return;const o=t.tiles[n];r((0,h.createTile)(o.bitmap,null,null===(e=o.meta)||void 0===e?void 0:e.displayName),t.tiles.length,i)},this.tileDeleteAlertHandler=()=>{const{tileset:e,selected:t,dispatchShowAlert:n,dispatchHideAlert:i,referencedTiles:r}=this.props,o=e.tiles[t];t&&o&&o.isProjectTile&&(r&&-1!==r.indexOf(o.id)?n(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:i}]):n(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:i}]))},this.deleteTile=()=>{const e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,e.button>0)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=s.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.drawingMode===s.TileDrawingMode.Wall?this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default):this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const{gallery:t}=e;if(this.refreshGallery(e),t){const e={};for(const n of t){const t=n.tags.find((e=>pxt.Util.startsWith(e,"category-")));t&&(e[t]||(e[t]={id:t,text:pxt.Util.rlf(`{id:tilecategory}${t.substr(9)}`),tiles:[]}),e[t].tiles.push(n))}this.categories=f.concat(Object.keys(e).map((t=>e[t])))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:n,tileset:r,category:o,page:a,drawingMode:h,galleryOpen:p}=this.props,f=r.tiles[t]?r.tiles[t].bitmap:m.data(),b=r.tiles[n]?r.tiles[n].bitmap:m.data();m.data(),this.updateGalleryTiles();let _=Math.ceil(this.categoryTiles.length/16);p||this.categoryTiles.length%16!=0||_++;const E=!p&&(1===_||a===_-1),T=p||!this.renderedTiles.some((e=>!v(e)&&e.index===t));return(0,i.jsxs)("div",Object.assign({className:"tile-palette"},{children:[(0,i.jsxs)("div",Object.assign({className:"tile-palette-fg-bg"},{children:[(0,i.jsx)("div",Object.assign({className:"tile-palette-swatch fg "+(h==s.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:(0,i.jsx)(l.TimelineFrame,{frames:[{bitmap:f}],colors:e})})),(0,i.jsxs)("div",Object.assign({className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:[(0,i.jsx)(l.TimelineFrame,{frames:[{bitmap:b}],colors:e}),(0,i.jsx)(d.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})]})),(0,i.jsx)("div",Object.assign({className:"tile-palette-swatch wall "+(h==s.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},{children:(0,i.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},{children:(0,i.jsx)("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})}))}))]})),(0,i.jsx)(u.Pivot,{options:g,selected:p?1:0,onChange:this.pivotHandler}),(0,i.jsxs)("div",Object.assign({className:"tile-palette-controls-outer"},{children:[p&&(0,i.jsx)(c.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter((e=>!!e.tiles.length)),selected:o}),!p&&(0,i.jsxs)("div",Object.assign({className:"tile-palette-controls"},{children:[(0,i.jsx)(d.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:T,toggle:!T}),(0,i.jsx)(d.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:T,toggle:!T}),(0,i.jsx)(d.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:T,toggle:!T})]}))]})),(0,i.jsxs)("div",Object.assign({className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},{children:[(0,i.jsxs)("div",Object.assign({className:"tile-canvas"},{children:[(0,i.jsx)("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),E&&(0,i.jsx)("div",Object.assign({ref:"create-tile-ref"},{children:(0,i.jsx)(d.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0})}))]})),(0,i.jsx)("div",Object.assign({className:"tile-canvas-controls"},{children:y(_,a,this.pageHandler)}))]}))]}))}updateGalleryTiles(){const{page:e,category:t,galleryOpen:n}=this.props;this.categoryTiles=n?this.categories[t].tiles:this.getCustomTiles().map((([e,t])=>({index:t,bitmap:e.bitmap})));const i=16*e;this.renderedTiles=this.categoryTiles.slice(i,i+16)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:n,dispatchChangeTilePaletteCategory:i,dispatchChangeTilePalettePage:r}=this.props;if(!e||e<0||e>=t.tiles.length)return;const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map((([e,t])=>e));if(!e)return;const t=Math.max(Math.floor(e.findIndex((e=>e.id==o.id))/16),0);n(!1),r(t)}else{const e=this.categories.find((e=>-1!==e.tiles.findIndex((e=>e.qualifiedName==o.id))));if(!e||!e.tiles)return;const t=Math.max(Math.floor(e.tiles.findIndex((e=>e.qualifiedName==o.id))/16),0);n(!0),i(this.categories.indexOf(e)),r(t)}}redrawCanvas(){const{tileset:e,page:t,selected:n}=this.props,i=4*t*4,r=e.tileWidth+1;this.canvas.width=(4*r+1)*p,this.canvas.height=(4*r+1)*p;const o=this.canvas.getContext("2d");for(let e=0;e<4;e++)for(let t=0;t<4;t++){const s=this.categoryTiles[i+4*e+t];s&&(v(s)||s.index!==n||(o.fillStyle="#ff0000",o.fillRect(t*r,e*r,r+1,r+1)),o.fillStyle="#333333",o.fillRect(t*r+1,e*r+1,r-1,r-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(s.bitmap),1+t*r,1+e*r))}this.positionCreateTileButton()}drawBitmap(e,t=0,n=0,i=!0,r=p,o=this.canvas){const{colors:s}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let o=0;o<e.width;o++)for(let l=0;l<e.height;l++){const c=e.get(o,l);c?(a.fillStyle=s[c],a.fillRect((o+t)*r,(l+n)*r,r,r)):i||a.clearRect((o+t)*r,(l+n)*r,r,r)}}handleCanvasClickCore(e,t,n){const i=this.canvas.getBoundingClientRect(),r=(e-i.left)/(i.width/4)|0,o=(t-i.top)/(i.height/4)|0,a=this.renderedTiles[4*o+r];if(a){let e,t;if(v(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,e>=0)n?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:e,backgroundColor:i,tileset:r}=this.props,o=r.tiles.length||1;this.props.dispatchCreateNewTile(null,n?e:o,n?o:i,t)}this.props.dispatchChangeDrawingMode(s.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:t,tileset:n}=e;t&&f.forEach((e=>{e.tiles=t.filter((t=>-1!==t.tags.indexOf(e.id)&&t.tileWidth===n.tileWidth))}))}positionCreateTileButton(){const e=this.refs["create-tile-ref"];if(e){const t=this.categoryTiles.length%4,n=Math.floor(this.categoryTiles.length/4)%4;e.style.position="absolute",e.style.left="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)",e.style.top="calc("+n/4+" * (100% - 0.5rem) + 0.25rem)"}}getCustomTiles(){return this.props.tileset.tiles.map(((e,t)=>[e,t])).filter((([e])=>e.isProjectTile)).sort((([e],[t])=>{const n="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==n?-1:t.id==n?1:e.internalID-t.internalID}))}getTileIndex(e){const{tileset:t}=this.props;for(let n=0;n<t.tiles.length;n++)if(t.tiles[n].id===e.qualifiedName)return n;return-1}}function y(e,t,n){const r=16+5*(e-1),o=[];for(let n=0;n<e;n++)o[n]=n===t;return(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${r} 10`,className:"tile-palette-pages "+(e<2?"disabled":"")},{children:[(0,i.jsx)("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?()=>n(t-1):void 0}),o.map(((e,t)=>(0,i.jsx)("circle",{className:"tile-palette-page-dot",cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>n(t)},t))),(0,i.jsx)("polygon",{className:"tile-palette-page-arrow",points:`${r-1},5 ${r-4},3 ${r-4},7`,onClick:t<e-1?()=>n(t+1):void 0})]}))}function v(e){return!!e.qualifiedName}const _={dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:a.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:a.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:a.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:a.dispatchChangeDrawingMode,dispatchCreateNewTile:a.dispatchCreateNewTile,dispatchSetGalleryOpen:a.dispatchSetGalleryOpen,dispatchOpenTileEditor:a.dispatchOpenTileEditor,dispatchDeleteTile:a.dispatchDeleteTile,dispatchShowAlert:a.dispatchShowAlert,dispatchHideAlert:a.dispatchHideAlert};n.TilePalette=(0,o.connect)((function({store:{present:e},editor:t},n){let i=e;return i?{selected:t.selectedColor,tileset:i.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:i.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}}),_)(b)},{"../../../assets":192,"../Button":208,"../Dropdown":210,"../Pivot":213,"../TimelineFrame":216,"../actions/dispatch":219,"../store/imageReducer":223,react:548,"react-redux":521,"react/jsx-runtime":549}],227:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.replaceColorEdit=n.outlineEdit=n.flipEdit=n.rotateEdit=n.MarqueeEdit=n.FillEdit=n.CircleEdit=n.LineEdit=n.OutlineEdit=n.RectangleEdit=n.PaintEdit=n.SelectionEdit=n.Edit=n.EditState=n.getEditState=n.getEdit=n.tools=n.ToolCursor=void 0;const i=e("./store/imageReducer");var r,o;(o=r=n.ToolCursor||(n.ToolCursor={})).None="none",o.Default="default",o.Pointer="pointer",o.Crosshair="crosshair",o.Grab="grab",o.Grabbing="grabbing",o.EyeDropper="var(--eyedropper)",n.tools=[{tool:i.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:r.Crosshair},{tool:i.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:r.Crosshair,hoverLayerCursor:r.Grab,downLayerCursor:r.Grabbing},{tool:i.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:r.Grab,downCursor:r.Grabbing},{tool:i.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:r.EyeDropper}],n.getEdit=function(e,t,n,r){switch(e){case i.ImageEditorTool.Paint:return new c(t.width,t.height,n,r);case i.ImageEditorTool.Rect:return new u(t.width,t.height,n,r);case i.ImageEditorTool.Fill:return new p(t.width,t.height,n,r);case i.ImageEditorTool.Line:return new d(t.width,t.height,n,r);case i.ImageEditorTool.Marquee:return new f(t.width,t.height,n,r);case i.ImageEditorTool.Circle:return new h(t.width,t.height,n,r);case i.ImageEditorTool.Erase:return new c(t.width,t.height,0,r);case i.ImageEditorTool.ColorSelect:default:return}},n.getEditState=function(e,t,n=i.TileDrawingMode.Default){const r=new s(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());let o,a,l;return e.overlayLayers&&(r.overlayLayers=e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),r.layerOffsetX=e.layerOffsetX,r.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(a=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(l=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),o={image:a,overlayLayers:l}),r.floating=o,r.setActiveLayer(n),r};class s{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){switch(e){case i.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}}copy(){const e=new s;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map((e=>e.copy())),this.floating){let t,n;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(n=this.floating.overlayLayers.map((e=>e.copy()))),e.floating={image:t,overlayLayers:n}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)})),this.floating.overlayLayers=void 0))}copyToLayer(e,t,n,i,r=!1){if(0===n||0===i)return;n<0&&(e+=n,n=-n),i<0&&(t+=i,i=-i);let o,s=this.image.copy(e,t,n,i);if(this.layerOffsetX=s.x0,this.layerOffsetY=s.y0,s.x0=void 0,s.y0=void 0,this.overlayLayers&&(o=this.overlayLayers.map((r=>r.copy(e,t,n,i)))),r)for(let r=0;r<n;r++)for(let n=0;n<i;n++)this.image.set(e+r,t+n,0),this.overlayLayers&&this.overlayLayers.forEach((i=>i.set(e+r,t+n,0)));this.floating={image:s,overlayLayers:o}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,e>=0&&e<this.floating.image.width&&t>=0&&t<this.floating.image.height)}setFloatingLayer(e,t,n){var i,r;n&&this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!==(i=null==t?void 0:t.layerOffsetX)&&void 0!==i?i:0,this.layerOffsetY=null!==(r=null==t?void 0:t.layerOffsetY)&&void 0!==r?r:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map((e=>e.data())):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map((e=>e.data())):void 0}}}n.EditState=s;class a{constructor(e,t,n,i){this.canvasWidth=e,this.canvasHeight=t,this.color=n,this.toolWidth=i}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return e>=0&&e<this.canvasWidth&&t>=0&&t<this.canvasHeight}start(e,t,n,i,r){this.isStarted=!0,this.startCol=e,this.startRow=t,this.startX=n,this.startY=i}drawCursor(e,t,n){n(e,t)}}n.Edit=a;class l extends a{update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}n.SelectionEdit=l;class c extends a{constructor(e,t,n,i){super(e,t,n,i),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(e,t,n,i){const r=n-e,o=i-t,s=(e,t)=>this.mask.set(e,t);if(0===r){const n=o>=0?i:t;for(let r=o>=0?t:i;r<=n;r++)this.drawCore(e,r,s);return}const a=r>0?1:-1,l=o>0?1:-1,c=Math.abs(o/r);let u=0,d=t;for(let t=e;a>0?t<=n:t>=n;t+=a)for(this.drawCore(t,d,s),u+=c;u>=.5;)(l>0?d<=i:d>=i)&&this.drawCore(t,d,s),d+=l,u-=1}doEditCore(e){e.mergeFloatingLayer();for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++)this.mask.get(t,n)&&e.activeLayer.set(t,n,this.color)}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let i=0;i<this.toolWidth;i++)for(let r=0;r<this.toolWidth;r++){const o=e+i,s=t+r;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&n(e+i,t+r)}}}n.PaintEdit=c;n.RectangleEdit=class extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),n=this.bottomRight();for(let i=t.x;i<=n.x;i++)for(let r=t.y;r<=n.y;r++)e.activeLayer.set(i,r,this.color)}};class u extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();let t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;let n=this.bottomRight();n.x+=this.toolWidth>>1,n.y+=this.toolWidth>>1;for(let i=0;i<this.toolWidth;i++)this.drawRectangle(e,{x:t.x+i,y:t.y+i},{x:n.x-i,y:n.y-i})}drawRectangle(e,t,n){if(!(t.x>n.x||t.y>n.y)){for(let i=t.x;i<=n.x;i++)e.activeLayer.set(i,t.y,this.color),e.activeLayer.set(i,n.y,this.color);for(let i=t.y;i<=n.y;i++)e.activeLayer.set(t.x,i,this.color),e.activeLayer.set(n.x,i,this.color)}}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let i=0;i<this.toolWidth;i++)for(let r=0;r<this.toolWidth;r++){const o=e+i,s=t+r;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&n(e+i,t+r)}}}n.OutlineEdit=u;class d extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(e,t,n,i,r){const o=n-e,s=i-t,a=(e,t)=>r.activeLayer.set(e,t,this.color);if(0===o){const n=s>=0?i:t;for(let r=s>=0?t:i;r<=n;r++)this.drawCore(e,r,a);return}const l=o>0?1:-1,c=s>0?1:-1,u=Math.abs(s/o);let d=0,h=t;for(let t=e;l>0?t<=n:t>=n;t+=l)for(this.drawCore(t,h,a),d+=u;d>=.5;)(c>0?h<=i:h>=i)&&this.drawCore(t,h,a),h+=c,d-=1}drawCursor(e,t,n){this.drawCore(e,t,n)}drawCore(e,t,n){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let i=0;i<this.toolWidth;i++)for(let r=0;r<this.toolWidth;r++)n(e+i,t+r)}}n.LineEdit=d;class h extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),n=this.bottomRight(),i=n.x-t.x,r=n.y-t.y,o=Math.floor(Math.hypot(i,r)),s=this.startCol,a=this.startRow;this.midpoint(s,a,o,e)}midpoint(e,t,n,i){let r=n-1,o=0,s=1,a=1,l=s-2*n;for(;r>=o;)i.activeLayer.set(e+r,t+o,this.color),i.activeLayer.set(e+r,t-o,this.color),i.activeLayer.set(e+o,t+r,this.color),i.activeLayer.set(e+o,t-r,this.color),i.activeLayer.set(e-o,t+r,this.color),i.activeLayer.set(e-o,t-r,this.color),i.activeLayer.set(e-r,t+o,this.color),i.activeLayer.set(e-r,t-o,this.color),l<=0&&(o++,l+=a,a+=2),l>0&&(r--,l+=(s+=2)-2*n)}}n.CircleEdit=h;class p extends a{constructor(){super(...arguments),this.showPreview=!0}start(e,t,n,i,r){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(e){const t=e.activeLayer!==e.image,n=(n,i)=>(t?e.activeLayer.get(n,i)+1<<8:0)+e.image.get(n,i),i=n(this.col,this.row);if(i===this.color)return;e.mergeFloatingLayer();const r=new pxt.sprite.Bitmask(e.width,e.height);r.set(this.col,this.row);const o=[{x:this.col,y:this.row}];for(;o.length;){const t=o.pop();n(t.x,t.y)===i&&(e.activeLayer.set(t.x,t.y,this.color),s(t.x+1,t.y),s(t.x-1,t.y),s(t.x,t.y+1),s(t.x,t.y-1))}function s(e,t){e>=0&&e<r.width&&t>=0&&t<r.height&&!r.get(e,t)&&(r.set(e,t),o.push({x:e,y:t}))}}}n.FillEdit=p;class f extends l{constructor(){super(...arguments),this.isMove=!1,this.isResize=!1,this.showPreview=!1}start(e,t,n,i,r){this.isStarted=!0,this.startCol=e,this.startRow=t;const o=document.elementFromPoint(n,i);if(r.floating&&r.floating.image)if(o&&"image-editor-floating-layer-corner"==o.className){this.isResize=!0,this.startOffsetX=r.layerOffsetX,this.startOffsetY=r.layerOffsetY;let e,t=0;const o=document.getElementsByClassName("image-editor-floating-layer-corner");for(let r=0;r<o.length;r++){let s=Math.sqrt(Math.pow(o[r].getBoundingClientRect().x-n,2)+Math.pow(o[r].getBoundingClientRect().y-i,2));s>t&&(t=s,e=o[r])}const s=document.getElementsByClassName("paint-surface");let a;for(let e=0;e<s.length;e++)s[e].className.includes("main")&&(a=s[e]);const l=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,u=a.getBoundingClientRect().width,d=a.getBoundingClientRect().height;this.anchorCol=(e.getBoundingClientRect().x-l)/u*this.canvasWidth,this.anchorRow=(e.getBoundingClientRect().y-c)/d*this.canvasHeight,this.originalImage||(this.originalImage=r.floating.image.copy())}else r.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=r.layerOffsetX,this.startOffsetY=r.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){const t=this.topLeft(),n=this.bottomRight();if(this.isDragged)if(this.isMove)e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow;else if(this.isResize){const t=Math.round(Math.abs(this.anchorCol-this.endCol)),n=Math.round(Math.abs(this.anchorRow-this.endRow)),i=function(e,t,n){const i=new pxt.sprite.Bitmap(t,n,0,0);for(let r=0;r<t;r++)for(let o=0;o<n;o++){const s=Math.floor(r/t*e.width),a=Math.floor(o/n*e.height),l=e.get(s,a);i.set(r,o,l)}return i}(this.originalImage,t,n);e.setFloatingLayer(i,{layerOffsetX:Math.round(Math.min(this.anchorCol,this.endCol)),layerOffsetY:Math.round(Math.min(this.anchorRow,this.endRow))},!1)}else e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,n.x-t.x+1,n.y-t.y+1,!0);else this.isMove||e.mergeFloatingLayer()}}n.MarqueeEdit=f,n.rotateEdit=function(e,t,n,i){var r;const o=!!(null===(r=e.floating)||void 0===r?void 0:r.image),a=o?e.floating:e,l=n?new pxt.sprite.Tilemap(a.image.height,a.image.width):new pxt.sprite.Bitmap(a.image.height,a.image.width),c=a.overlayLayers?a.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.height,e.width))):void 0;for(let e=0;e<a.image.width;e++)for(let t=0;t<a.image.height;t++)d(a.image,l,e,t),c&&c.forEach(((n,i)=>d(a.overlayLayers[i],n,e,t)));const u=l.width===l.height&&l.width===e.image.width&&e.image.width===e.image.height;if(!i&&!o||u){const e=new s(l);return e.overlayLayers=c,e}if(!o)for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++)e.image.set(t,n,0),e.overlayLayers&&e.overlayLayers.forEach((e=>null==e?void 0:e.set(t,n,0)));return(l.width===e.image.height&&l.height===e.image.width||l.width===e.image.width&&l.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(l.width>>1),e.layerOffsetY=(e.height>>1)-(l.height>>1)),e.floating={image:l,overlayLayers:c},e;function d(e,n,i,r){t?n.set(r,i,e.get(i,e.height-r-1)):n.set(r,i,e.get(e.width-i-1,r))}},n.flipEdit=function(e,t,n){var i,r;const o=(null===(i=e.floating)||void 0===i?void 0:i.image)?e.floating:e,a=n?new pxt.sprite.Tilemap(o.image.width,o.image.height):new pxt.sprite.Bitmap(o.image.width,o.image.height),l=o.overlayLayers?o.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.width,e.height))):void 0;for(let e=0;e<o.image.width;e++)for(let t=0;t<o.image.height;t++)c(o.image,a,e,t),l&&l.forEach(((n,i)=>c(o.overlayLayers[i],n,e,t)));if(null===(r=e.floating)||void 0===r?void 0:r.image)return e.floating={image:a,overlayLayers:l},e;{const e=new s(a);return e.overlayLayers=l,e}function c(e,n,i,r){t?n.set(i,r,e.get(i,e.height-r-1)):n.set(i,r,e.get(e.width-i-1,r))}},n.outlineEdit=function(e,t){var n,i;const r=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,o=e.copy(),s=(null===(i=null==e?void 0:e.floating)||void 0===i?void 0:i.image)?o.floating.image:o.image;for(let e=0;e<r.image.width;e++)for(let n=0;n<r.image.height;n++)0===r.image.get(e,n)&&(0===r.image.get(e-1,n)&&0===r.image.get(e,n-1)&&0===r.image.get(e+1,n)&&0===r.image.get(e,n+1)||s.set(e,n,t));return o},n.replaceColorEdit=function(e,t,n){var i,r;const o=(null===(i=e.floating)||void 0===i?void 0:i.image)?e.floating:e,s=e.copy(),a=(null===(r=null==e?void 0:e.floating)||void 0===r?void 0:r.image)?s.floating.image:s.image;for(let e=0;e<o.image.width;e++)for(let i=0;i<o.image.height;i++)o.image.get(e,i)===t&&a.set(e,i,n);return s}},{"./store/imageReducer":223}],228:[function(e,t,n){"use strict";function i(){return"undefined"!=typeof window&&!!window.PointerEvent}function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}var o;Object.defineProperty(n,"__esModule",{value:!0}),n.createTilemapPatchFromFloatingLayer=n.applyBitmapData=n.imageStateToTilemap=n.imageStateToBitmap=n.bindGestureEvents=n.GestureState=n.fireClickOnlyOnEnter=n.clientCoord=n.pointerEvents=n.Bitmask=n.MapTools=n.isBitmapSupported=n.isTouchEnabled=n.hasPointerEvents=n.DRAG_RADIUS=void 0,n.DRAG_RADIUS=3,n.hasPointerEvents=i,n.isTouchEnabled=r,n.isBitmapSupported=function(){return!!window.createImageBitmap},(o=n.MapTools||(n.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase";function s(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}n.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){const n=e+this.width*t,i=n>>3,r=7&n;this.mask[i]|=1<<r}get(e,t){const n=e+this.width*t,i=n>>3,r=7&n;return this.mask[i]>>r&1}},n.pointerEvents=i()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},n.clientCoord=s,n.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class a{constructor(e,t,n){this.target=e,this.isRightClick=n,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>n.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(e,t){for(let n=0;n<e.changedTouches.length;n++)if(e.changedTouches[n].identifier===t)return e.changedTouches[n]}function c(e){return e.button>0}n.GestureState=a,n.bindGestureEvents=function(e,t){i()?function(e,t){let n;e.addEventListener("pointerup",(e=>{n&&(n.end(s(e)),e.preventDefault()),n=void 0})),e.addEventListener("pointerdown",(e=>{n&&n.end(),n=new a(t,s(e),c(e)),e.preventDefault()})),e.addEventListener("pointermove",(e=>{n&&(n.update(s(e)),e.preventDefault())})),e.addEventListener("pointerleave",(e=>{n&&(n.end(s(e)),e.preventDefault()),n=void 0}))}(e,t):r()?function(e,t){let n,i;e.addEventListener("touchend",(e=>{if(n&&i){const t=l(e,i);t&&(n.end(t),n=void 0,e.preventDefault())}})),e.addEventListener("touchstart",(e=>{n&&n.end(),i=e.changedTouches[0].identifier,n=new a(t,e.changedTouches[0],c(e))})),e.addEventListener("touchmove",(e=>{if(n&&i){const t=l(e,i);t&&(n.update(t),e.preventDefault())}})),e.addEventListener("touchcancel",(e=>{if(n&&i){const t=l(e,i);t&&(n.end(t),n=void 0,e.preventDefault())}}))}(e,t):function(e,t){let n;e.addEventListener("mouseup",(e=>{n&&n.end(s(e)),n=void 0})),e.addEventListener("mousedown",(e=>{n&&n.end(),n=new a(t,s(e),c(e))})),e.addEventListener("mousemove",(e=>{n&&n.update(s(e))})),e.addEventListener("mouseleave",(e=>{n&&n.end(s(e)),n=void 0}))}(e,t)},n.imageStateToBitmap=function(e){const t=pxt.sprite.Bitmap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const n=pxt.sprite.Bitmap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.imageStateToTilemap=function(e){const t=pxt.sprite.Tilemap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const n=pxt.sprite.Tilemap.fromData(e.floating.bitmap);n.x0=e.layerOffsetX||0,n.y0=e.layerOffsetY||0,t.apply(n,!0)}return t},n.applyBitmapData=function(e,t,n=0,i=0){if(!e||!t)return e;const r=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=n,o.y0=i,r.apply(o,!0),r.data()},n.createTilemapPatchFromFloatingLayer=function(e,t){if(!e.floating)return;const n=pxt.sprite.Tilemap.fromData(e.floating.image.data()),i=new pxt.sprite.Tilemap(n.width,n.height),r=e.floating.overlayLayers?e.floating.overlayLayers.map((e=>pxt.sprite.base64EncodeBitmap(e.data()))):[];let o=[];for(let e=0;e<n.width;e++)for(let r=0;r<n.height;r++){const s=t.tiles[n.get(e,r)],a=o.indexOf(s);-1===a?(i.set(e,r,o.length),o.push(s)):i.set(e,r,a)}return{map:pxt.sprite.hexEncodeTilemap(i),layers:r,tiles:o.map((e=>pxt.sprite.base64EncodeBitmap(e.bitmap)))}}},{}],229:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImageFieldEditor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./assetEditor/assetCard"),s=e("../assets"),a=e("./ImageEditor/ImageEditor"),l=e("./ImageEditor/keyboardShortcuts"),c=e("./ImageEditor/store/imageReducer"),u=e("./FilterPanel"),d=e("../util"),h=e("../../../react-common/components/controls/EditorToggle"),p=e("./MusicFieldEditor"),f=e("../../../react-common/components/util");class g extends r.Component{constructor(e){super(e),this.tagClickHandler=e=>{let t=this.state.gallerySelectedTags;const n=e.toLowerCase(),i=t.indexOf(n);i<0?t.push(n):t.splice(i,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),b("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),b("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),b("gallery-my-assets"),this.userAssets=(0,s.getAssets)(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,n;if(this.ref&&e.id!==(null===(t=this.asset)||void 0===t?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null===(n=this.asset)||void 0===n?void 0:n.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}b("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},(0,c.setTelemetryFunction)(b)}get asset(){var e;return null===(e=this.ref)||void 0===e?void 0:e.getAsset()}render(){var e,t,n,r,o;const{currentView:s,headerVisible:l,editingTile:c,hideMyAssets:g,filterOpen:b,hideCloseButton:y}=this.state,v="gallery"===this.state.currentView&&b;let _=l,E=!this.props.isMusicEditor&&(!this.asset||c||"tilemap"!==this.asset.type);const T=!g&&!c;this.asset&&!this.galleryAssets&&E&&this.updateGalleryAssets(),(null===(e=this.galleryAssets)||void 0===e?void 0:e.length)||(E=!1);const x=this.props.includeSpecialTagsInFilter?[]:["tile","dialog","background"];let w=[],k=[];switch(s){case"my-assets":k=this.filterAssetsByType(this.userAssets,c?"tile":null===(t=this.asset)||void 0===t?void 0:t.type),w=this.getAvailableTags(k,x);break;case"gallery":k=this.filterAssetsByType(this.galleryAssets,c?"tile":null===(n=this.asset)||void 0===n?void 0:n.type,!0,!0),w=this.getAvailableTags(k,x),k=this.filterAssetsByTag(k)}const S=[{label:lf("Editor"),title:lf("Editor"),focusable:!0,icon:"fas fa-paint-brush",onClick:this.showEditor,view:"editor"},{label:lf("Gallery"),title:lf("Gallery"),focusable:!0,icon:"fas fa-image",onClick:this.showGallery,view:"gallery"},{label:lf("My Assets"),title:lf("My Assets"),focusable:!0,icon:"fas fa-folder",onClick:this.showMyAssets,view:"my-assets"}];return E||T?E?T||S.splice(2,1):S.splice(1,1):_=!1,(0,i.jsxs)("div",Object.assign({className:(0,f.classList)("image-editor-wrapper",this.props.isMusicEditor&&"music-asset-editor")},{children:[_&&(0,i.jsxs)("div",Object.assign({className:"gallery-editor-header"},{children:[(0,i.jsx)("div",{className:"image-editor-header-left"}),(0,i.jsx)("div",Object.assign({className:"image-editor-header-center"},{children:(0,i.jsx)(h.EditorToggle,{id:"image-editor-toggle",className:"slim tablet-compact",items:S,selected:S.findIndex((e=>e.view===s))})})),(0,i.jsxs)("div",Object.assign({className:"image-editor-header-right"},{children:[(0,i.jsxs)("div",Object.assign({className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:d.fireClickOnEnter},{children:[(0,i.jsx)("div",Object.assign({className:"gallery-filter-button-icon"},{children:(0,i.jsx)("i",{className:"icon filter"})})),(0,i.jsx)("div",Object.assign({className:"gallery-filter-button-label"},{children:lf("Filter")}))]})),!c&&!y&&(0,i.jsx)("div",Object.assign({className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},{children:(0,i.jsx)("i",{className:"ui icon close"})}))]}))]})),(0,i.jsxs)("div",Object.assign({className:"image-editor-gallery-window"},{children:[(0,i.jsxs)("div",Object.assign({className:"image-editor-gallery-content"},{children:[this.props.isMusicEditor?(0,i.jsx)(p.MusicFieldEditor,{ref:"image-editor",onDoneClicked:this.onDoneClick,hideDoneButton:this.props.hideDoneButton}):(0,i.jsx)(a.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode,hideDoneButton:this.props.hideDoneButton,hideAssetName:!(null===(o=null===(r=pxt.appTarget)||void 0===r?void 0:r.appTheme)||void 0===o?void 0:o.assetEditor)}),(0,i.jsx)(m,{items:k,hidden:"editor"===s,onAssetSelected:this.onAssetSelected})]})),(0,i.jsx)("div",Object.assign({className:"filter-panel-gutter "+(v?"":"hidden")},{children:(0,i.jsx)("div",Object.assign({className:"filter-panel-container"},{children:(0,i.jsx)(u.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:w})}))}))]}))]}))}componentDidMount(){this.ref=this.refs["image-editor"],b("image-editor-shown")}componentWillUnmount(){b("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,n){switch(this.closeEditor=t,this.options=n,this.lightMode=n.lightMode,e.type){case"image":this.initSingleFrame(e,n);break;case"tile":n.disableResize=!0,this.initSingleFrame(e,n);break;case"animation":this.initAnimation(e,n);break;case"tilemap":this.initTilemap(e,n);break;case"song":this.ref.openAsset(e)}this.editID=e.id;let i=!1;n&&(this.blocksInfo=n.blocksInfo,n.filter&&(this.setState({galleryFilter:n.filter}),i=!0),null!=n.headerVisible&&(this.setState({headerVisible:n.headerVisible}),i=!0),null!=n.hideMyAssets&&(this.setState({hideMyAssets:n.hideMyAssets}),i=!0),null!=n.hideCloseButton&&(this.setState({hideCloseButton:n.hideCloseButton}),i=!0)),i||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){return this.ref?this.ref.getJres():""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options&&this.options.disableResize&&this.ref.disableResize())}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=(0,s.getAssets)(!0,this.asset.type)}getAvailableTags(e,t){let n=[];return this.galleryAssets?(e.forEach((e=>{var i;null===(i=e.meta.tags)||void 0===i||i.forEach((e=>{const i=function(e){let t=0===e.indexOf("?")&&e.length>1?e.substring(1):e;return t.toLowerCase()}(e);t.indexOf(i)<0&&n.indexOf(i)<0&&n.push(i)}))})),n):[]}filterAssetsByTag(e){return this.state.gallerySelectedTags.length>0&&this.state.filterOpen&&(e=e.filter((e=>{var t;return!!(null===(t=e.meta.tags)||void 0===t?void 0:t.find((e=>this.state.gallerySelectedTags.indexOf(e)>=0)))}))),e}filterAssetsByType(e,t,n=!1,i){var r;if(void 0===t&&(t=null===(r=this.asset)||void 0===r?void 0:r.type),void 0===t)return e;if(this.asset&&!n&&(e=e.map((e=>e.type!==this.asset.type||e.id!==this.asset.id?e:(0,s.assetToGalleryItem)(this.getValue()))),this.state.editingTile)){const t=this.ref.getAsset();e=e.map((e=>{var n;return(null===(n=t.data.editedTiles)||void 0===n?void 0:n.indexOf(e.id))>=0?(0,s.assetToGalleryItem)(t.data.tileset.tiles.find((t=>t.id===e.id))):e}))}if(i){e.forEach((e=>{var t,n,i;!e.meta.tags&&this.options&&(e.meta.tags=(null===(i=null===(n=null===(t=this.blocksInfo)||void 0===t?void 0:t.apis.byQName[e.id])||void 0===n?void 0:n.attributes.tags)||void 0===i?void 0:i.split(" "))||[])}));const t=this.state.galleryFilter.split(" ").filter((e=>!!e)).map((e=>e.toLowerCase())),n=t.filter((e=>0!==e.indexOf("!"))),i=t.filter((e=>0===e.indexOf("!")&&e.length>1)).map((e=>e.substring(1)));e=e.filter((e=>function(e,t){const n=e.meta.tags?e.meta.tags:[];return t.every((e=>{const t=`?${e}`;return n.some((n=>n===e||n===t))}))}(e,n)&&function(e,t){const n=e.meta.tags?e.meta.tags:[];return t.every((e=>!n.some((t=>t===e))))}(e,i)))}if(n)switch(t){case"animation":return e.filter((e=>"animation"===e.type||"tile"===e.type||"image"===e.type));case"image":return e.filter((e=>"tile"===e.type||"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}else switch(t){case"animation":return e.filter((e=>"animation"===e.type));case"image":return e.filter((e=>"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let n;(null==t?void 0:t.blocksInfo)&&(this.blocksInfo=t.blocksInfo,n=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map((e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),(null==t?void 0:t.galleryTiles)&&(n=t.galleryTiles.map((e=>({bitmap:e.bitmap,tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),this.ref.openAsset(e,n)}loadJres(e){this.ref&&this.ref.loadJres(e)}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?((0,l.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,l.obtainShortcutLock)())}}n.ImageFieldEditor=g;class m extends r.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){let{items:e,hidden:t}=this.props;return(0,i.jsx)("div",Object.assign({className:"image-editor-gallery "+(e&&!t?"visible":"")},{children:!t&&e&&e.map(((e,t)=>(0,i.jsx)(o.AssetCardView,{asset:e,selected:!1,onClick:this.clickHandler},t)))}))}}r.Component;function b(e){pxt.tickEvent("image.editor",{action:e})}},{"../../../react-common/components/controls/EditorToggle":151,"../../../react-common/components/util":187,"../assets":192,"../util":352,"./FilterPanel":205,"./ImageEditor/ImageEditor":212,"./ImageEditor/keyboardShortcuts":221,"./ImageEditor/store/imageReducer":223,"./MusicFieldEditor":230,"./assetEditor/assetCard":235,react:548,"react/jsx-runtime":549}],230:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MusicFieldEditor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./musicEditor/MusicEditor");class s extends r.Component{constructor(e){super(e),this.onSongChanged=e=>{this.mostRecentValue=e},this.onAssetNameChanged=e=>{this.setState({editingSong:Object.assign(Object.assign({},this.state.editingSong),{meta:Object.assign(Object.assign({},this.state.editingSong.meta),{displayName:e})})})},this.state={editRef:0}}render(){const{onDoneClicked:e}=this.props,{editingSong:t}=this.state;return(0,i.jsx)("div",Object.assign({className:"music-field-editor"},{children:t&&(0,i.jsx)(o.MusicEditor,{asset:t,onSongChanged:this.onSongChanged,onAssetNameChanged:this.onAssetNameChanged,editRef:this.state.editRef,onDoneClicked:e,hideDoneButton:this.props.hideDoneButton})}))}getAsset(){if(this.state.editingSong)return Object.assign(Object.assign({},this.state.editingSong),{song:this.mostRecentValue||this.state.editingSong.song})}openAsset(e){pxt.assets.music.inflateSong(e.song),this.setState({editingSong:e,editRef:this.state.editRef+1})}openGalleryAsset(e){}getJres(){return""}loadJres(e){}disableResize(){}onResize(){}getPersistentData(){}restorePersistentData(e){}}n.MusicFieldEditor=s},{"./musicEditor/MusicEditor":249,react:548,"react/jsx-runtime":549}],231:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimRecorderImpl=void 0;const i=e("react/jsx-runtime"),r=e("../simulator"),o=e("react"),s=e("../screenshot"),a=e("../app");let l;n.SimRecorderImpl=e=>{const{onSimRecorderInit:t}=e,[n,c]=o.useState(void 0);let u;return o.useEffect((()=>{const e=r.driver.loanSimulator();c(e);const n=function(){if(l)return l;let e,t,n=[],i=[],o=[];const c=e=>{l.state=e;for(const t of n)t(e)},u=e=>{for(const t of o)t(e)},d=async()=>{if("recording"!==l.state)return;r.driver.stopRecording(),t&&clearTimeout(t),c("rendering");const n=await e.renderAsync();pxt.log(`gif: ${(null==n?void 0:n.length)||0} chars`);const o=pxt.appTarget.appTheme.simScreenshotMaxUriLength;if(n){if(o&&n.length>o)return pxt.tickEvent("gif.toobig",{size:n.length}),void u(lf("Oops! The GIF you recorded is too large. Try recording a shorter clip!"));pxt.tickEvent("gif.ok",{size:n.length})}c("default");for(const e of i)e(n,"gif");return n};return l={state:"default",addStateChangeListener:e=>{n.push(e)},addThumbnailListener:e=>{i.push(e)},addErrorListener:e=>{o.push(e)},removeStateChangeListener:e=>{n=n.filter((t=>t!==e))},removeThumbnailListener:e=>{i=i.filter((t=>t!==e))},removeErrorListener:e=>{o=o.filter((t=>t!==e))},startRecordingAsync:async()=>{if("default"!==l.state)return;if(e||(e=await s.loadGifEncoderAsync()),!e)return void u(lf("Unable to load GIF encoder. Are you offline?"));e.cancel(),e.start();const n=pxt.appTarget.appTheme.simGifWidth||160;r.driver.startRecording(n),c("recording"),t&&clearTimeout(t),t=setTimeout((()=>{"recording"===l.state&&d()}),1e4)},stopRecordingAsync:d,screenshotAsync:async()=>{const e=await(0,a.getEditorAsync)(),t=await e.requestScreenshotAsync();for(const e of i)e(t,"png");return t},gifAddFrame:(t,n)=>e.addFrame(t,n)}}(),i=e=>{"screenshot"===e.type?"recording"===n.state?n.gifAddFrame(e.data,e.delay)&&n.stopRecordingAsync():n.screenshotAsync():"start"===e.event?n.startRecordingAsync():"stop"===e.event&&n.stopRecordingAsync()};return(0,a.getEditorAsync)().then((e=>{e.pushScreenshotHandler(i),t(n)})),()=>{r.driver.unloanSimulator(),r.driver.stopRecording(),(0,a.getEditorAsync)().then((e=>{e.popScreenshotHandler()}))}}),[]),(0,i.jsx)("div",{id:"shareLoanedSimulator",ref:e=>{if(e&&(u=e,n&&u.firstChild!==n)){for(;u.firstChild;)u.firstChild.remove();u.appendChild(n)}}})}},{"../app":190,"../screenshot":329,"../simulator":338,react:548,"react/jsx-runtime":549}],232:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimulatorPresenceBar=void 0;const i=e("react/jsx-runtime"),r=e("../../../react-common/components/controls/Button"),o=e("../simulator");function s(e){const{slot:t}=e;return(0,i.jsx)(r.Button,{className:`sim-presence-bar-player player-${t}`,title:lf("Player {0}",t),onClick:()=>{const e={type:"setactiveplayer",playerNumber:t},n={type:"multiplayer",content:"Connection",slot:t,connected:!0};o.driver.postMessage(e),o.driver.postMessage(n),o.driver.focus()}})}n.SimulatorPresenceBar=function(){return(0,i.jsxs)("div",Object.assign({className:"sim-presence-bar"},{children:[(0,i.jsx)(s,{slot:1}),(0,i.jsx)(s,{slot:2}),(0,i.jsx)(s,{slot:3}),(0,i.jsx)(s,{slot:4})]}))}},{"../../../react-common/components/controls/Button":146,"../simulator":338,"react/jsx-runtime":549}],233:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dispatchUpdateGalleryAssets=n.dispatchUpdateUserAssets=n.dispatchChangeGalleryView=n.dispatchChangeSelectedAsset=void 0;const i=e("./types");n.dispatchChangeSelectedAsset=(e,t)=>({type:i.CHANGE_SELECTED_ASSET,assetType:e,assetId:t});n.dispatchChangeGalleryView=(e,t,n)=>({type:i.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:n});n.dispatchUpdateUserAssets=()=>({type:i.UPDATE_USER_ASSETS});n.dispatchUpdateGalleryAssets=()=>({type:i.UPDATE_GALLERY_ASSETS})},{"./types":234}],234:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UPDATE_GALLERY_ASSETS=n.UPDATE_USER_ASSETS=n.CHANGE_GALLERY_VIEW=n.CHANGE_SELECTED_ASSET=void 0,n.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",n.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",n.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",n.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],235:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetCard=n.AssetCardView=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./store/assetEditorReducerState"),a=e("./actions/dispatch"),l=e("./assetPreview");class c extends r.Component{constructor(){super(...arguments),this.clickHandler=()=>{const{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){const{asset:e,selected:t}=this.props;return(0,i.jsx)(u,{asset:e,selected:t,onClick:this.clickHandler})}}class u extends r.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";case"song":return"music";case"image":default:return null}}render(){var e,t;const{asset:n,selected:r}=this.props,o=(0,s.isGalleryAsset)(n),a=this.getDisplayIconForAsset(n.type),c=a||!(null===(e=n.meta)||void 0===e?void 0:e.displayName);return(0,i.jsxs)("div",Object.assign({className:"asset-editor-card "+(r?"selected":""),onClick:this.clickHandler,role:"listitem"},{children:[(0,i.jsx)(l.AssetPreview,{asset:n}),c&&(0,i.jsxs)("div",Object.assign({className:"asset-editor-card-label"},{children:[a&&(0,i.jsx)("div",Object.assign({className:"asset-editor-card-icon"},{children:(0,i.jsx)("i",{className:`icon ${a}`})})),!(null===(t=n.meta)||void 0===t?void 0:t.displayName)&&!o&&(0,i.jsx)("div",Object.assign({className:"asset-editor-card-icon warning"},{children:(0,i.jsx)("i",{className:"icon exclamation triangle"})}))]}))]}))}}n.AssetCardView=u;const d={dispatchChangeSelectedAsset:a.dispatchChangeSelectedAsset};n.AssetCard=(0,o.connect)((function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}}),d)(c)},{"./actions/dispatch":233,"./assetPreview":240,"./store/assetEditorReducerState":245,react:548,"react-redux":521,"react/jsx-runtime":549}],236:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetCardList=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./assetCard");class s extends r.Component{constructor(){super(...arguments),this.hasUpdatedCards=!1,this.handleContainerRef=e=>{e&&(this.container=e,this.updateEmptyCards())},this.updateEmptyCards=pxtc.Util.throttle((()=>{if(!this.container)return;const e=this.container.firstElementChild;if(!e)return;this.emptyCards||(this.emptyCards=[]);const t=e.getBoundingClientRect(),n=this.container.getBoundingClientRect();if(!(t.width&&t.height&&n.width&&n.height))return;let i=t.width;if(e.nextElementSibling){const n=e.nextElementSibling.getBoundingClientRect();i=Math.max(i,n.left-t.left)}this.hasUpdatedCards=!0;const r=Math.floor(n.width/i),o=Math.floor(this.container.parentElement.getBoundingClientRect().height/i);let s,a,l=this.container.firstElementChild,c=0;for(;l;)l.classList.contains("empty-card")?s||(s=l):(c++,s&&this.container.insertBefore(l,s)),l=l.nextElementSibling;if((a=r*o>c?r*o-c:r-c%r)!==this.emptyCards.length)if(this.emptyCards.length>a)for(;this.emptyCards.length>a;)this.emptyCards.pop().remove();else for(let e=this.emptyCards.length;e<a;e++){const e=document.createElement("div");e.setAttribute("class","asset-editor-card empty-card"),this.container.appendChild(e),this.emptyCards.push(e)}}),100)}componentDidUpdate(){this.updateEmptyCards()}componentDidMount(){window.addEventListener("resize",this.updateEmptyCards);let e=()=>{this.hasUpdatedCards||(this.updateEmptyCards(),this.hasUpdatedCards||requestAnimationFrame(e))};requestAnimationFrame(e)}componentWillUnmount(){window.removeEventListener("resize",this.updateEmptyCards)}render(){const{assets:e}=this.props;return(0,i.jsxs)("div",Object.assign({ref:this.handleContainerRef},{children:[this.props.children,e.map((e=>(0,i.jsx)(o.AssetCard,{asset:e},e.id)))]}))}}n.AssetCardList=s},{"./assetCard":235,react:548,"react/jsx-runtime":549}],237:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetGallery=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../package"),s=e("react-redux"),a=e("../../../../react-common/components/controls/List"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/controls/Modal"),u=e("./actions/dispatch"),d=e("./assetCardList"),h=e("./assetTopbar");class p extends r.Component{constructor(e){var t;super(e),this.showCreateModal=()=>{this.setState({showCreateModal:!0})},this.hideCreateModal=()=>{this.setState({showCreateModal:!1})},this.getCreateAssetHandler=e=>()=>{pxt.tickEvent("assets.create",{type:e.toString()});const t=pxt.react.getTilemapProject(),n=this.getEmptyAsset(e);this.hideCreateModal(),this.props.showAssetFieldView(n,(n=>{var i;t.pushUndo();const r=null===(i=n.meta)||void 0===i?void 0:i.displayName;switch(e){case"image":t.createNewProjectImage(n.bitmap,r);break;case"tile":t.createNewTile(n.bitmap,null,r);break;case"tilemap":t.createNewTilemapFromData(n.data,r);break;case"animation":t.createNewAnimationFromData(n.frames,n.interval,r);break;case"song":t.createNewSong(n.song,r)}o.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}))},this.state={showCreateModal:!1},this.assetCreateOptions=[{label:lf("Image"),icon:"picture",handler:this.getCreateAssetHandler("image")},{label:lf("Tile"),icon:"clone",handler:this.getCreateAssetHandler("tile")},{label:lf("Tilemap"),icon:"map",handler:this.getCreateAssetHandler("tilemap")},{label:lf("Animation"),icon:"video",handler:this.getCreateAssetHandler("animation")}],(null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.songEditor)&&this.assetCreateOptions.push({label:lf("Song"),icon:"music",handler:this.getCreateAssetHandler("song")})}getEmptyAsset(e){const t=pxt.react.getTilemapProject(),n={type:e,id:"",internalID:0,meta:{displayName:pxt.getDefaultAssetDisplayName(e)}};switch(e){case"image":case"tile":n.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":n.data=t.blankTilemap(16,16,16);case"animation":const e=n;e.frames=[new pxt.sprite.Bitmap(16,16).data()],e.interval=200;break;case"song":n.song=pxt.assets.music.getEmptySong(2)}return n}render(){var e;const{view:t,galleryAssets:n,userAssets:r,disableCreateButton:s}=this.props,{showCreateModal:u}=this.state,p=(null===(e=o.mainPkg)||void 0===e?void 0:e.config)&&o.mainPkg.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME;return(0,i.jsxs)("div",Object.assign({className:"asset-editor-gallery"},{children:[(0,i.jsx)(h.AssetTopbar,{}),(0,i.jsx)("div",Object.assign({className:"asset-editor-card-list "+(0!==t?"hidden":"")},{children:(0,i.jsx)(d.AssetCardList,Object.assign({assets:f(r,p)},{children:(0,i.jsx)(l.Button,{className:"create-new inverted",disabled:s,leftIcon:"icon huge add circle",title:lf("Create a new asset"),ariaLabel:lf("Create a new asset"),onClick:s?void 0:this.showCreateModal})}))})),(0,i.jsx)("div",Object.assign({className:"asset-editor-card-list "+(1!==t?"hidden":"")},{children:(0,i.jsx)(d.AssetCardList,{assets:n})})),u&&(0,i.jsxs)(c.Modal,Object.assign({className:"asset-editor-create-dialog",onClose:this.hideCreateModal,title:lf("Create New Asset"),parentElement:document.getElementById("root")},{children:[(0,i.jsx)("div",{children:lf("Choose your asset type from the options below:")}),(0,i.jsx)(a.List,Object.assign({className:"asset-editor-create-options"},{children:this.assetCreateOptions.map(((e,t)=>(0,i.jsx)(l.Button,{className:"asset-editor-create-button inverted",leftIcon:`icon ${e.icon}`,label:e.label,title:lf("Create a new {0} asset",e.label),ariaLabel:lf("Create a new {0} asset",e.label),onClick:e.handler},t)))}))]}))]}))}}function f(e,t){return t?e:e.filter((e=>!!e.meta.displayName))}const g={dispatchUpdateUserAssets:u.dispatchUpdateUserAssets};n.AssetGallery=(0,s.connect)((function(e,t){return e?Object.assign(Object.assign({},t),{view:e.view,userAssets:e.assets,galleryAssets:e.galleryAssets}):{}}),g)(p)},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/List":157,"../../../../react-common/components/controls/Modal":159,"../../package":325,"./actions/dispatch":233,"./assetCardList":236,"./assetTopbar":242,react:548,"react-redux":521,"react/jsx-runtime":549}],238:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetGalleryTab=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-redux"),s=e("./actions/dispatch");class a extends r.Component{constructor(){super(...arguments),this.handleClick=()=>{pxt.tickEvent("assets.gallerytab",{view:this.props.view.toString()}),this.props.dispatchChangeGalleryView(this.props.view)}}render(){const{title:e,selected:t}=this.props;return(0,i.jsx)("div",Object.assign({className:"asset-editor-gallery-tab "+(t?"selected":""),onClick:this.handleClick,role:"navigation"},{children:e}))}}const l={dispatchChangeGalleryView:s.dispatchChangeGalleryView};n.AssetGalleryTab=(0,o.connect)((function(e,t){return e?{selected:e.view==t.view}:{}}),l)(a)},{"./actions/dispatch":233,react:548,"react-redux":521,"react/jsx-runtime":549}],239:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetPalette=void 0;const i=e("react/jsx-runtime"),r=e("../../package"),o=e("react"),s=e("../../../../react-common/components/controls/Modal"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/palette/PalettePicker"),u=e("../../../../react-common/components/palette/PaletteEditor"),d=e("../../../../react-common/components/palette/PaletteSwatch"),h=e("../../../../react-common/components/palette/Palettes");var p,f;(f=p||(p={}))[f.None=0]="None",f[f.New=1]="New",f[f.Rename=2]="Rename";n.AssetPalette=e=>{const{onClose:t}=e,[n,p]=(0,o.useState)(void 0),[f,g]=(0,o.useState)(void 0),[m,b]=(0,o.useState)(void 0),[y,v]=(0,o.useState)(!1),[_,E]=(0,o.useState)(0),[T,x]=(0,o.useState)(!1),[w,k]=(0,o.useState)(!0);(0,o.useEffect)((()=>{D()}),[]),(0,o.useEffect)((()=>{m&&!R(m.colors,f.colors)?k(!1):k(!0)}),[m]);const S=e=>{m&&(e.id!==m.id?b(e):R(m.colors,e.colors)||(L(e)?C(e):(p(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:e})})),b(e))))},C=e=>{const t={id:"custom"+n.nextPaletteID,name:lf("Custom"),colors:(null==e?void 0:e.colors)||m.colors,custom:!0};p(Object.assign(Object.assign({},n),{nextPaletteID:++n.nextPaletteID,palettes:Object.assign(Object.assign({},n.palettes),{[t.id]:t})})),b(t),E(1)},A=e=>{r.mainEditorPkg().setFile(pxt.PALETTES_FILE,JSON.stringify(n,void 0,4)),e&&(pxt.tickEvent("palette.modified",{id:m.id}),r.mainEditorPkg().updateConfigAsync((e=>e.palette=m.colors))),t(e)},I=()=>{E(0),x(!1)},O=e=>{0!==(e=e.trim()).length?(x(!1),p(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:Object.assign(Object.assign({},m),{name:e})})})),b(Object.assign(Object.assign({},m),{name:e}))):x(!0)},N=()=>{p(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[m.id]:void 0})}));const e=M.findIndex((e=>e===m))+1;e<M.length?b(M[e]):b(h.Arcade),v(!1)},R=(e,t)=>{let n=!0;for(let i=0;i<e.length;i++)if(e[i].toLowerCase()!==t[i].toLowerCase()){n=!1;break}return n},D=()=>{const e=r.mainEditorPkg().lookupFile("this/"+pxt.PALETTES_FILE);let t;t=e?JSON.parse(e.content):{nextPaletteID:0,palettes:{}};const n=Object.values(null==t?void 0:t.palettes).concat(h.AllPalettes),i=r.mainPkg.config.palette||pxt.appTarget.runtime.palette;let o=!1;for(const e of n)if(R(i,e.colors)){o=!0,g(e),b(e);break}if(!o){const e={id:"custom"+t.nextPaletteID++,name:lf("Custom"),colors:i,custom:!0};t.palettes[e.id]=e,g(e),b(e)}p(t)},L=e=>h.AllPalettes.some((t=>t.id===e.id));if(!n)return(0,i.jsx)("div",{});const M=Object.values(n.palettes).filter((e=>void 0!==e)).reverse().concat(h.AllPalettes),P=[{label:lf("Reset"),onClick:()=>{f.custom&&!n.palettes[f.id]&&p(Object.assign(Object.assign({},n),{palettes:Object.assign(Object.assign({},n.palettes),{[f.id]:f})})),b(f)},leftIcon:"icon undo",className:"palette-transparent-button",disabled:w},{label:lf("Apply"),onClick:()=>A(!0),className:"green palette-apply-button",disabled:w}],B=[{label:lf("Done"),onClick:I,className:"teal palette-done-button",disabled:T}],j=[{label:lf("Delete"),onClick:N,leftIcon:"icon trash",className:"red"}],F=()=>{switch(_){case 0:return;case 1:return lf("Name Your Custom Palette");case 2:return lf("Rename Your Custom Palette")}};return(0,i.jsxs)("div",{children:[(0,i.jsxs)(s.Modal,Object.assign({title:lf("Color Palette"),onClose:()=>{A(!1)},actions:P,leftIcon:"fas fa-palette"},{children:[(0,i.jsxs)("div",Object.assign({className:"common-palette-picker"},{children:[(0,i.jsx)(c.PalettePicker,{palettes:M,selectedId:(null==m?void 0:m.id)||h.Arcade.id,onPaletteSelected:S}),(0,i.jsxs)("div",Object.assign({className:"palette-actions"},{children:[(0,i.jsx)(l.Button,{title:lf("New palette"),ariaLabel:lf("New palette"),className:"palette-new-button",leftIcon:"icon add",onClick:C}),(0,i.jsx)(l.Button,{title:lf("Rename palette"),ariaLabel:lf("Rename palette"),className:"palette-rename-button",leftIcon:"xicon rename",onClick:()=>E(2),disabled:!m.custom}),(0,i.jsx)(l.Button,{title:lf("Delete palette"),ariaLabel:lf("Delete palette"),className:"palette-delete-button",leftIcon:"icon trash",onClick:()=>v(!0),disabled:!m.custom})]}))]})),(0,i.jsx)(u.PaletteEditor,{palette:m||h.Arcade,onPaletteChanged:S})]})),F()&&(0,i.jsxs)(s.Modal,Object.assign({title:F(),onClose:()=>{1===_&&N(),I()},actions:B,className:"palette-name-modal"},{children:[(0,i.jsx)(a.Input,{className:"palette-name-input",initialValue:T?"":m.name,placeholder:lf("Palette Name"),onBlur:O,onEnterKey:O}),T&&(0,i.jsx)("p",Object.assign({className:"invalid-palette-name"},{children:lf("Name must not be empty")}))]})),y&&(0,i.jsxs)(s.Modal,Object.assign({title:lf("Delete Palette"),onClose:()=>v(!1),actions:j,className:"palette-delete-modal"},{children:[(0,i.jsx)("div",{children:lf("Are you sure you want to delete this palette?")}),(0,i.jsx)(d.PaletteSwatch,{palette:m})]}))]})}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/Input":154,"../../../../react-common/components/controls/Modal":159,"../../../../react-common/components/palette/PaletteEditor":170,"../../../../react-common/components/palette/PalettePicker":171,"../../../../react-common/components/palette/PaletteSwatch":172,"../../../../react-common/components/palette/Palettes":173,"../../package":325,react:548,"react/jsx-runtime":549}],240:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetPreview=void 0;const i=e("react/jsx-runtime"),r=e("react");class o extends r.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1&&(this.currentFrame=0,this.animationIntervalRef=setInterval((()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length}),Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e;const{asset:t}=this.props,n="animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1,r=t.meta.displayName||(t.meta.temporaryInfo?lf("Temporary Asset"):t.id);return(0,i.jsx)("div",Object.assign({className:"asset-editor-preview",title:r},{children:(0,i.jsx)("img",{src:t.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:n?this.onMouseEnter:void 0,onMouseLeave:n?this.onMouseLeave:void 0,ref:n?this.handleRef:void 0,loading:"lazy"})}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}n.AssetPreview=o},{react:548,"react/jsx-runtime":549}],241:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetSidebar=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../package"),s=e("../../simulator"),a=e("react-redux"),l=e("../../../../react-common/components/controls/Button"),c=e("../../../../react-common/components/controls/List"),u=e("../../../../react-common/components/controls/Modal"),d=e("./store/assetEditorReducerState"),h=e("./actions/dispatch"),p=e("./assetPreview"),f=e("./assetPalette"),g=e("../../app");class m extends r.Component{constructor(e){super(e),this.editAssetHandler=()=>{this.props.showAssetFieldView(this.props.asset,this.editAssetDoneHandler)},this.editAssetDoneHandler=e=>{var t;pxt.tickEvent("assets.edit",{type:e.type.toString()});const n=pxt.react.getTilemapProject();n.pushUndo(),!(null===(t=this.props.asset.meta)||void 0===t?void 0:t.displayName)&&e.meta.temporaryInfo&&((0,g.getBlocksEditor)().updateTemporaryAsset(e),o.mainEditorPkg().lookupFile(`this/${pxt.MAIN_BLOCKS}`).setContentAsync((0,g.getBlocksEditor)().getCurrentSource())),e.meta.displayName&&n.updateAsset(e),this.props.dispatchChangeGalleryView(0),this.updateAssets().then((()=>s.setDirty()))},this.duplicateAssetHandler=()=>{var e;const{isGalleryAsset:t}=this.props;pxt.tickEvent("assets.duplicate",{type:this.props.asset.type.toString(),gallery:t.toString()});const n=this.props.asset,i=(null===(e=n.meta)||void 0===e?void 0:e.displayName)||y(n,t)||pxt.getDefaultAssetDisplayName(n.type),r=pxt.react.getTilemapProject();r.pushUndo();const{type:o,id:s}=r.duplicateAsset(n,i);this.updateAssets().then((()=>{t&&this.props.dispatchChangeGalleryView(0,o,s)}))},this.copyAssetHandler=()=>{const{asset:e}=this.props;switch(pxt.tickEvent("assets.clipboard",{type:e.type.toString(),gallery:this.props.isGalleryAsset.toString()}),e.type){case"image":case"tile":try{const t=pxt.sprite.bitmapToImageLiteral(pxt.sprite.getBitmapFromJResURL(e.jresData),"typescript");this.copyTextAreaRef.value=t,this.copyTextAreaRef.focus(),this.copyTextAreaRef.select(),document.execCommand("copy")}catch(e){}}},this.copyTextAreaRefHandler=e=>{this.copyTextAreaRef=e},this.showDeleteModal=()=>{this.setState({showDeleteModal:!0})},this.hideDeleteModal=()=>{this.setState({showDeleteModal:!1})},this.showPaletteModal=()=>{this.setState({showPaletteModal:!0}),pxt.tickEvent("palette.open")},this.hidePaletteModal=e=>{this.setState({showPaletteModal:!1}),e&&this.props.updateProject()},this.deleteAssetHandler=()=>{pxt.tickEvent("assets.delete",{type:this.props.asset.type.toString()}),this.setState({showDeleteModal:!1});const e=pxt.react.getTilemapProject();e.pushUndo(),e.removeAsset(this.props.asset),this.props.dispatchChangeSelectedAsset(),this.updateAssets()},this.state={showDeleteModal:!1,showPaletteModal:!1,canEdit:!0,canCopy:!0,canDelete:!0}}UNSAFE_componentWillReceiveProps(e){if(e.asset&&this.props.asset!=e.asset){const{asset:t,isGalleryAsset:n}=e,i=pxt.react.getTilemapProject(),r=!n,s="tilemap"!=(null==t?void 0:t.type)&&"animation"!=(null==t?void 0:t.type),a=!n&&!i.isAssetUsed(t,o.mainEditorPkg().files);this.setState({canEdit:r,canCopy:s,canDelete:a})}}getAssetDetails(){const e=this.props.asset,t=[];if(e)switch(t.push({name:lf("Type"),value:b(e.type)}),e.type){case"image":case"tile":t.push({name:lf("Size"),value:`${e.bitmap.width} x ${e.bitmap.height}`});break;case"tilemap":t.push({name:lf("Size"),value:`${e.data.tilemap.width} x ${e.data.tilemap.height}`});break;case"animation":t.push({name:lf("Size"),value:`${e.frames[0].width} x ${e.frames[0].height}`})}return t}updateAssets(){return o.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}render(){var e;const{asset:t,isGalleryAsset:n}=this.props,{showDeleteModal:r,showPaletteModal:o,canEdit:s,canCopy:a,canDelete:d}=this.state,h=this.getAssetDetails(),g=(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.displayName)||n,m=y(t,n),b=[{label:lf("Delete"),onClick:this.deleteAssetHandler,icon:"icon trash",className:"red"}];return(0,i.jsxs)("div",Object.assign({className:"asset-editor-sidebar"},{children:[(0,i.jsxs)(c.List,Object.assign({className:"asset-editor-sidebar-info"},{children:[(0,i.jsx)("div",{children:lf("Asset Preview")}),(0,i.jsx)("div",Object.assign({className:"asset-editor-sidebar-preview"},{children:t&&(0,i.jsx)(p.AssetPreview,{asset:t})})),g||!t?(0,i.jsx)("div",Object.assign({className:"asset-editor-sidebar-name"},{children:m})):(0,i.jsxs)("div",Object.assign({className:"asset-editor-sidebar-temp"},{children:[(0,i.jsx)("i",{className:"icon exclamation triangle"}),(0,i.jsx)("span",{children:lf("No asset name")})]})),h.map((e=>(0,i.jsx)("div",Object.assign({className:"asset-editor-sidebar-detail"},{children:`${e.name}: ${e.value}`}),e.name)))]})),(0,i.jsxs)(c.List,Object.assign({className:"asset-editor-sidebar-controls"},{children:[t&&s&&(0,i.jsx)(l.Button,{label:lf("Edit"),title:lf("Edit the selected asset"),ariaLabel:lf("Edit the selected asset"),leftIcon:"icon edit",className:"asset-editor-button",onClick:this.editAssetHandler}),t&&(0,i.jsx)(l.Button,{label:lf("Duplicate"),title:lf("Duplicate the selected asset"),ariaLabel:lf("Duplicate the selected asset"),leftIcon:"icon copy",className:"asset-editor-button",onClick:this.duplicateAssetHandler}),t&&a&&(0,i.jsx)(l.Button,{label:lf("Copy"),title:lf("Copy the selected asset to the clipboard"),ariaLabel:lf("Copy the selected asset to the clipboard"),leftIcon:"icon paste",className:"asset-editor-button",onClick:this.copyAssetHandler}),t&&d&&(0,i.jsx)(l.Button,{label:lf("Delete"),title:lf("Delete the selected asset"),ariaLabel:lf("Delete the selected asset"),className:"asset-editor-button",leftIcon:"icon trash",onClick:this.showDeleteModal}),(0,i.jsx)(l.Button,{className:"teal asset-palette-button",label:lf("Colors"),title:lf("Open the color palette"),ariaLabel:lf("Open the color palette"),leftIcon:"fas fa-palette",onClick:this.showPaletteModal})]})),(0,i.jsx)("textarea",{className:"asset-editor-sidebar-copy",ref:this.copyTextAreaRefHandler}),r&&(0,i.jsx)(u.Modal,Object.assign({className:"asset-editor-delete-dialog",onClose:this.hideDeleteModal,title:lf("Delete Asset"),actions:b,parentElement:document.getElementById("root")},{children:(0,i.jsx)("div",{children:lf("Are you sure you want to delete {0}? Deleted assets cannot be recovered.",m)})})),o&&(0,i.jsx)(f.AssetPalette,{onClose:this.hidePaletteModal})]}))}}function b(e){switch(e){case"image":return lf("Image");case"tile":return lf("Tile");case"animation":return lf("Animation");case"tilemap":return lf("Tilemap");case"song":return lf("Song")}}function y(e,t){var n;return e?(null===(n=null==e?void 0:e.meta)||void 0===n?void 0:n.displayName)?e.meta.displayName:t?e.id.split(".").pop():null:lf("No asset selected")}const v={dispatchChangeGalleryView:h.dispatchChangeGalleryView,dispatchChangeSelectedAsset:h.dispatchChangeSelectedAsset,dispatchUpdateUserAssets:h.dispatchUpdateUserAssets};n.AssetSidebar=(0,a.connect)((function(e,t){return e?{asset:e.selectedAsset,isGalleryAsset:(0,d.isGalleryAsset)(e.selectedAsset)}:{}}),v)(m)},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/List":157,"../../../../react-common/components/controls/Modal":159,"../../app":190,"../../package":325,"../../simulator":338,"./actions/dispatch":233,"./assetPalette":239,"./assetPreview":240,"./store/assetEditorReducerState":245,react:548,"react-redux":521,"react/jsx-runtime":549}],242:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetTopbar=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./assetGalleryTab");class s extends r.Component{render(){return(0,i.jsxs)("div",Object.assign({className:"asset-editor-topbar"},{children:[(0,i.jsx)(o.AssetGalleryTab,{title:lf("My Assets"),view:0}),(0,i.jsx)(o.AssetGalleryTab,{title:lf("Gallery"),view:1})]}))}}n.AssetTopbar=s},{"./assetGalleryTab":238,react:548,"react/jsx-runtime":549}],243:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetEditor=void 0;const i=e("react/jsx-runtime"),r=e("../../package"),o=e("../../compiler"),s=e("../../blocklyFieldView"),a=e("../../../../pxtblocks"),l=e("react-redux"),c=e("./store/assetEditorStore"),u=e("./actions/dispatch"),d=e("../../srceditor"),h=e("./assetSidebar"),p=e("./assetGallery");class f extends d.Editor{constructor(){super(...arguments),this.showAssetFieldView=(e,t)=>{let n;switch(e.type){case"image":case"tile":n=pxt.react.getFieldEditorView("image-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"tilemap":const t=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(t,e),n=pxt.react.getFieldEditorView("tilemap-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"animation":n=pxt.react.getFieldEditorView("animation-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"song":n=pxt.react.getFieldEditorView("music-editor",e,{})}this.parent.isTutorial()&&s.setContainerClass("asset-editor-tutorial"),n.onHide((()=>{this.parent.isTutorial()&&this.unbindTutorialEvents();const i=n.getResult();"tilemap"==e.type&&pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),i),Promise.resolve(t(i)).then((()=>{var t;(null===(t=e.meta)||void 0===t?void 0:t.displayName)||this.parent.saveBlocksToTypeScriptAsync().then((e=>{e&&r.mainEditorPkg().setContentAsync(pxt.MAIN_TS,e)}))})),s.setContainerClass(null)})),this.parent.isTutorial()&&this.bindTutorialEvents(),n.show()}}getId(){return"assetEditor"}acceptsFile(e){return e.name===pxt.ASSETS_FILE}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>o.getBlocksAsync())).then((e=>{a.initializeAndInject(e),this.blocksInfo=e,this.updateGalleryAssets()})).then((()=>c.default.dispatch((0,u.dispatchUpdateUserAssets)()))).then((()=>{this.parent.forceUpdate(),this.parent.onEditorContentLoaded()}))}unloadFileAsync(){return s.dismissIfVisible(),r.mainEditorPkg().buildAssetsAsync()}undo(){pxt.react.getTilemapProject().undo(),c.default.dispatch((0,u.dispatchUpdateUserAssets)())}redo(){pxt.react.getTilemapProject().redo(),c.default.dispatch((0,u.dispatchUpdateUserAssets)())}resize(e){const t=this.getAssetEditorDiv();if(t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect(),n=document.getElementById("editortools");s.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height+(n?n.getBoundingClientRect().height:0),horizontalPadding:0,verticalPadding:0})}else s.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}display(){return(0,i.jsx)(l.Provider,Object.assign({store:c.default},{children:(0,i.jsxs)("div",Object.assign({className:"asset-editor-outer"},{children:[(0,i.jsx)(h.AssetSidebar,{showAssetFieldView:this.showAssetFieldView,updateProject:async()=>{await this.parent.reloadHeaderAsync(),this.parent.openAssets()}}),(0,i.jsx)(p.AssetGallery,{showAssetFieldView:this.showAssetFieldView,disableCreateButton:this.parent.isTutorial()})]}))}))}getAssetEditorDiv(){return document.getElementById("assetEditor")}getTutorialCardDiv(){return document.getElementById("tutorialcard")}getTutorialMenuDiv(){var e;return null===(e=document.getElementsByClassName("tutorial-menuitem"))||void 0===e?void 0:e[0]}handleTutorialClick(e){e.stopPropagation(),e.preventDefault()}bindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.addEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.addEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.addClass(document.getElementById("maineditor"),"image-editor-open")}unbindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.removeEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.removeEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.removeClass(document.getElementById("maineditor"),"image-editor-open")}updateGalleryAssets(){c.default.dispatch((0,u.dispatchUpdateGalleryAssets)())}}n.AssetEditor=f},{"../../../../pxtblocks":68,"../../blocklyFieldView":195,"../../compiler":204,"../../package":325,"../../srceditor":345,"./actions/dispatch":233,"./assetGallery":237,"./assetSidebar":241,"./store/assetEditorStore":246,"react-redux":521,"react/jsx-runtime":549}],244:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("../actions/types"),r=e("../../../package"),o=e("../../../app"),s=e("../../../assets"),a={view:0,assets:[],galleryAssets:[]};function l(e,t,n){if(t&&n)return e.assets.find((e=>e.type==t&&e.id==n))||e.galleryAssets.find((e=>e.type==t&&e.id==n))}n.default=(e=a,t)=>{switch(t.type){case i.CHANGE_SELECTED_ASSET:return Object.assign(Object.assign({},e),{selectedAsset:l(e,t.assetType,t.assetId)});case i.CHANGE_GALLERY_VIEW:const n=t.assetId?l(e,t.assetType,t.assetId):e.selectedAsset;return Object.assign(Object.assign({},e),{view:t.view,selectedAsset:n});case i.UPDATE_USER_ASSETS:let a=(0,s.getAssets)(),c=new pxt.ImageConverter;return function(){var e,t;return(null===(t=null===(e=r.mainPkg)||void 0===e?void 0:e.config)||void 0===t?void 0:t.preferredEditor)===pxt.BLOCKS_PROJECT_NAME}()&&(a=a.concat((0,o.getBlocksEditor)().getTemporaryAssets().map((e=>(0,s.assetToGalleryItem)(e,c))))),Object.assign(Object.assign({},e),{selectedAsset:e.selectedAsset?a.find((t=>t.id==e.selectedAsset.id)):void 0,assets:a});case i.UPDATE_GALLERY_ASSETS:return Object.assign(Object.assign({},e),{galleryAssets:(0,s.getAssets)(!0)});default:return e}}},{"../../../app":190,"../../../assets":192,"../../../package":325,"../actions/types":234}],245:[function(e,t,n){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.isGalleryAsset=n.GalleryView=void 0,(i=n.GalleryView||(n.GalleryView={}))[i.User=0]="User",i[i.Gallery=1]="Gallery",n.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")}},{}],246:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("redux"),r=e("./assetEditorReducer"),o=(0,i.createStore)(r.default);n.default=o},{"./assetEditorReducer":244,redux:565}],247:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EditControls=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/controls/Input"),a=e("../../assets");n.EditControls=e=>{const{onAssetNameChanged:t,onDoneClicked:n,assetName:l,hideDoneButton:c}=e,[u,d]=r.useState(),[h,p]=r.useState(),f=e=>{let n=null;const i=e.trim();if(!i)return d(void 0),void p(void 0);pxt.validateAssetName(i)?(0,a.isNameTaken)(i)&&i!==l&&(n=lf("This name is already used elsewhere in your project")):n=lf("Names may only contain letters, numbers, '-', '_', and space"),n?(d(i),p(n)):(t(i),d(void 0),p(void 0))};return(0,i.jsxs)("div",Object.assign({className:"music-editor-edit-controls"},{children:[h&&(0,i.jsx)("div",Object.assign({className:"music-editor-name-error"},{children:h})),(0,i.jsx)(s.Input,{placeholder:lf("Asset Name"),initialValue:l||u,onBlur:f,onEnterKey:f}),!c&&(0,i.jsx)(o.Button,{className:"green",title:lf("Done"),label:lf("Done"),onClick:n})]}))}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/Input":154,"../../assets":192,react:548,"react/jsx-runtime":549}],248:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridHighlight=void 0;const i=e("react/jsx-runtime"),r=e("./svgConstants");n.GridHighlight=e=>{const{start:t,end:n,ticksPerBeat:o}=e,s=null!=t&&null!=n,a=Math.min(t,n),l=Math.max(t,n);return s?(0,i.jsxs)("g",{children:[(0,i.jsx)("rect",{fill:"#03adfc",x:(0,r.tickToX)(o,a),y:r.STAFF_HEADER_HEIGHT-r.STAFF_GRID_TICK_HEIGHT,width:(0,r.tickToX)(o,l)-(0,r.tickToX)(o,a),height:r.STAFF_GRID_TICK_HEIGHT}),(0,i.jsx)("rect",{fill:"#03adfc",x:(0,r.tickToX)(o,a),y:r.BASS_STAFF_TOP+r.STAFF_HEADER_HEIGHT-r.STAFF_GRID_TICK_HEIGHT,width:(0,r.tickToX)(o,l)-(0,r.tickToX)(o,a),height:r.STAFF_GRID_TICK_HEIGHT})]}):(0,i.jsx)("g",{})}},{"./svgConstants":261,"react/jsx-runtime":549}],249:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MusicEditor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./EditControls"),s=e("./keyboardNavigation"),a=e("./playback"),l=e("./PlaybackControls"),c=e("./ScrollableWorkspace"),u=e("./TrackSelector"),d=e("./utils");n.MusicEditor=e=>{const{asset:t,onSongChanged:n,savedUndoStack:h,onAssetNameChanged:p,editRef:f,onDoneClicked:g,hideDoneButton:m}=e,[b,y]=r.useState(0),[v,_]=r.useState("1/8"),[E,T]=r.useState(t.song),[x,w]=r.useState(!1),[k,S]=r.useState(!1),[C,A]=r.useState(h||[]),[I,O]=r.useState([]),[N,R]=r.useState(f),[D,L]=r.useState(),[M,P]=r.useState(),[B,j]=r.useState(!1),[F,$]=r.useState((0,d.doesSongUseBassClef)(t.song));r.useEffect((()=>()=>{(0,a.stopPlayback)()}),[]),r.useEffect((()=>{const e=e=>{D&&(e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(D)))},t=e=>{if(D){e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(D));const t=(0,d.applySelection)(D,k?b:void 0);V((0,d.deleteSelectedNotes)(t),!0)}},n=e=>{const t=e.clipboardData.getData("application/makecode-song");if(t){const e=JSON.parse(t);let n;n=D?{originalSong:(0,d.unselectAllNotes)((0,d.applySelection)(D,k?b:void 0)),pastedContent:e,startTick:D.startTick,endTick:D.startTick+(e.endTick-e.startTick),deltaTick:0,transpose:0}:{originalSong:E,pastedContent:e,startTick:0,endTick:e.endTick-e.startTick,deltaTick:0,transpose:0},V((0,d.applySelection)(n,k?b:void 0),!1),L(n)}};return document.addEventListener("copy",e),document.addEventListener("cut",t),document.addEventListener("paste",n),()=>{document.removeEventListener("copy",e),document.removeEventListener("cut",t),document.removeEventListener("paste",n)}}),[D,k,E]),N!==f&&(R(f),T(t.song));const U=r.useRef(),H=x?1:function(e,t){switch(e){case"1/4":return t;case"1/8":return t/2;case"1/16":return t/4;case"1/32":return t/8}}(v,E.ticksPerBeat),G=!!E.tracks[b].drums,V=(e,t)=>{var i;(0,a.isPlaying)()&&(0,a.updatePlaybackSongAsync)(e);let r=C.slice();t&&(r.push(pxt.assets.music.cloneSong((null==D?void 0:D.originalSong)||(null===(i=U.current)||void 0===i?void 0:i.original)||E)),A(r),O([])),T(e),n&&n(e),U.current&&(U.current.editing=e)},W=()=>{var e,t;let n;return L(void 0),"move"===(null===(e=null==U?void 0:U.current)||void 0===e?void 0:e.dragType)?n=(0,d.unselectAllNotes)(U.current.editing):(0,d.findSelectedRange)(E)&&(n=(0,d.unselectAllNotes)(E)),n&&(V(n,!0),"move"===(null===(t=null==U?void 0:U.current)||void 0===t?void 0:t.dragType)&&(U.current=void 0)),n},z=e=>{P(M?Object.assign(Object.assign({},M),{tick:e}):{tick:e,gridTicks:H,track:b,bassClef:!1,hideTracksActive:k,selection:D})};return(0,i.jsxs)("div",Object.assign({className:"music-editor"},{children:[(0,i.jsx)(u.TrackSelector,{song:E,selected:b,onTrackSelected:e=>{W(),j(!1);const t=E.tracks[e];t.drums?pxsim.music.playDrumAsync(t.drums[0]):pxsim.music.playNoteAsync((0,d.rowToNote)(t.instrument.octave,6,!1,!!t.drums).note,t.instrument,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,E.ticksPerBeat/2)),y(e),M&&P(Object.assign(Object.assign({},M),{track:e})),x&&w(!1)},eraserActive:x,onEraserClick:()=>{W(),j(!1),w(!x)},hideTracksActive:k,onHideTracksClick:()=>{W(),j(!1),S(!k)},selectedResolution:v,onResolutionSelected:_}),(0,i.jsx)(c.ScrollableWorkspace,{song:E,selectedTrack:b,eraserActive:x,onWorkspaceClick:(e,t)=>{j(!1);const n=E.tracks[b],i=n.instrument,r=(0,d.findPreviousNoteEvent)(E,b,e.tick),o=(0,d.findPreviousNoteEvent)(E,b,e.exactTick);W(),z(e.tick);const s=t=>(0,d.isBassClefNote)(i.octave,t,G)===e.isBassClef&&(0,d.noteToRow)(i.octave,t,G)===e.row;let a,l;if((null==o?void 0:o.startTick)===e.exactTick&&o.notes.some(s)?(a=e.exactTick,l=o):(null==r?void 0:r.startTick)===e.tick&&r.notes.some(s)&&(a=e.tick,l=r),l){const n=(0,d.unselectAllNotes)(E);if(t&&!G){const t=l.notes.find(s),r=12*i.octave-20,o=12*i.octave+20,c=(0,d.removeNoteAtRowFromTrack)(n,b,e.row,e.isBassClef,a);let u;u="normal"===t.enharmonicSpelling&&t.note<o?"sharp":"sharp"===t.enharmonicSpelling&&t.note>r||t.note===o?"flat":"normal";const h=(0,d.rowToNote)(i.octave,e.row,e.isBassClef,G,u);V((0,d.addNoteToTrack)(c,b,h,l.startTick,l.endTick),!0),pxsim.music.playNoteAsync(h.note,i,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,l.endTick-l.startTick))}else V((0,d.removeNoteAtRowFromTrack)(n,b,e.row,e.isBassClef,a),!0)}else{if(x){for(let t=0;t<E.tracks.length;t++){if(k&&t!==b)continue;const n=(0,d.findPreviousNoteEvent)(E,t,e.tick),i=(0,d.findPreviousNoteEvent)(E,t,e.exactTick);let r,o;(null==i?void 0:i.startTick)===e.exactTick&&i.notes.some(s)?(r=e.exactTick,o=i):(null==n?void 0:n.startTick)===e.tick&&n.notes.some(s)&&(r=e.tick,o=n),((null==o?void 0:o.startTick)===r||(null==o?void 0:o.endTick)>r)&&o.notes.some(s)&&V((0,d.removeNoteAtRowFromTrack)(E,t,e.row,e.isBassClef,o.startTick),!1)}return}{const t=(0,d.rowToNote)(i.octave,e.row,e.isBassClef,G),r=E.beatsPerMeasure*E.ticksPerBeat*E.measures;if(e.tick===r)return;const o=G?1:H;V((0,d.unselectAllNotes)((0,d.addNoteToTrack)(E,b,t,e.tick,e.tick+o)),!0),G?pxsim.music.playDrumAsync(n.drums[t.note]):pxsim.music.playNoteAsync(t.note,i,pxsim.music.tickToMs(E.beatsPerMinute,E.ticksPerBeat,H))}}},onWorkspaceDragStart:()=>{if(j(!1),U.current)return U.current.editing=E,U.current.original=E,void(U.current.selectionAtDragStart=D&&Object.assign({},D));U.current={editing:E,original:E,selectionAtDragStart:D&&Object.assign({},D)}},onWorkspaceDragEnd:()=>{if("move"===U.current.dragType){const e=U.current.dragEnd.tick-U.current.dragStart.tick,t=U.current.dragEnd.row-(U.current.dragEnd.isBassClef?12:0)-(U.current.dragStart.row-(U.current.dragStart.isBassClef?12:0));return L(Object.assign(Object.assign({},U.current.selectionAtDragStart),{deltaTick:U.current.selectionAtDragStart.deltaTick+e,transpose:U.current.selectionAtDragStart.transpose+t})),U.current.dragStart=void 0,U.current.dragEnd=void 0,void(U.current.selectionAtDragStart=void 0)}if("note-length"===U.current.dragType&&W(),pxt.assets.music.songEquals(U.current.editing,U.current.original)||V(U.current.editing,!0),"marquee"===U.current.dragType){const e=(0,d.findSelectedRange)(U.current.editing,H);L(e?{startTick:e.start,endTick:e.end,deltaTick:0,transpose:0,originalSong:U.current.editing}:void 0)}U.current=void 0},onWorkspaceDrag:(e,t)=>{if(z(t.tick),x){for(let e=0;e<E.tracks.length;e++){if(k&&e!==b)continue;const n=E.tracks[e].instrument,i=(0,d.findPreviousNoteEvent)(E,e,t.exactTick),r=e=>(0,d.isBassClefNote)(n.octave,e,G)===t.isBassClef&&(0,d.noteToRow)(n.octave,e,G)===t.row;((null==i?void 0:i.startTick)===t.exactTick||(null==i?void 0:i.endTick)>t.exactTick)&&i.notes.some(r)&&V((0,d.removeNoteAtRowFromTrack)(E,e,t.row,t.isBassClef,i.startTick),!1)}return}if(U.current.dragType=void 0,U.current.dragStart=e,U.current.dragEnd=t,U.current.original.tracks[b].drums)return void V((0,d.fillDrums)(U.current.original,b,e.row,e.tick,t.tick,H),!1);if(U.current.selectionAtDragStart){const n=(0,d.findNoteEventAtPosition)(U.current.original,e,k?b:void 0);if(null==n?void 0:n.selected){U.current.dragType="move";const n=t.tick-e.tick,i=t.row-(t.isBassClef?12:0)-(e.row-(e.isBassClef?12:0)),r=Object.assign(Object.assign({},U.current.selectionAtDragStart),{deltaTick:n+U.current.selectionAtDragStart.deltaTick,transpose:i+U.current.selectionAtDragStart.transpose}),o=(0,d.applySelection)(r,k?b:void 0);return V(o,!1),void L(r)}}const n=(0,d.findPreviousNoteEvent)(U.current.original,b,e.exactTick);if(!G&&n&&e.exactTick>=n.startTick&&e.exactTick<n.endTick){let i=!1;for(const t of n.notes)if((0,d.noteToRow)(E.tracks[b].instrument.octave,t,!1)===e.row){i=!0;break}if(i){if(t.tick<n.startTick+1)return;return L(void 0),U.current.dragType="note-length",void V((0,d.editNoteEventLength)(U.current.original,b,n.startTick,t.tick),!1)}}L({startTick:e.tick,endTick:t.tick,deltaTick:0,transpose:0,originalSong:U.current.editing}),V((0,d.selectNoteEventsInRange)(U.current.original,e.tick,t.tick,k?b:void 0),!1),U.current.dragType="marquee"},gridTicks:H,hideUnselectedTracks:k,showBassClef:F,selection:D,cursor:B?M:void 0,onKeydown:e=>{j(!0);let t=M;t||(t={tick:0,gridTicks:H,track:b,bassClef:!1,hideTracksActive:k,selection:D}),t.gridTicks=H,t.track=b,t.selection=D,t.hideTracksActive=k;const[n,i]=(0,s.handleKeyboardEvent)(E,t,e);pxt.assets.music.songEquals(n,E)||V(n,!i.selection),i.selection?L(i.selection):L(void 0),P(i)}}),(0,i.jsx)(l.PlaybackControls,{song:E,onTempoChange:e=>{W(),j(!1),V(Object.assign(Object.assign({},E),{beatsPerMinute:e}),!0)},onMeasuresChanged:e=>{W(),j(!1),V((0,d.changeSongLength)(E,e),!0)},onUndoClick:()=>{if(!C.length)return;O(I.concat([E]));const e=C.pop();A(C.slice()),V(e,!1)},onRedoClick:()=>{if(!I.length)return;A(C.concat([E]));const e=I.pop();O(I.slice()),V(e,!1)},showBassClef:F,onBassClefCheckboxClick:$,hasUndo:!!C.length,hasRedo:!!I.length}),(0,i.jsx)(o.EditControls,{assetName:t.meta.displayName,onAssetNameChanged:p,onDoneClicked:g,hideDoneButton:m})]}))}},{"./EditControls":247,"./PlaybackControls":252,"./ScrollableWorkspace":253,"./TrackSelector":256,"./keyboardNavigation":259,"./playback":260,"./utils":262,react:548,"react/jsx-runtime":549}],250:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Note=void 0;const i=e("react/jsx-runtime"),r=e("../../../../react-common/components/util"),o=e("./svgConstants"),s=e("./utils");n.Note=e=>{const{row:t,iconURI:n,length:a,opacity:l,enharmonicSpelling:c,isBassClef:u,selected:d,cursorHighlighted:h}=e;return(0,i.jsxs)("g",Object.assign({className:(0,r.classList)("music-staff-note",d&&"selected",h&&"cursor-highlighted"),transform:`translate(${-o.NOTE_ICON_WIDTH/2}, ${(0,o.rowY)(t,u)-o.NOTE_ICON_WIDTH/2})`},{children:[0===t&&(0,i.jsx)("line",{className:"music-staff-row",x1:-o.NOTE_ICON_WIDTH/2,y1:o.NOTE_ICON_WIDTH/2,x2:3*o.NOTE_ICON_WIDTH/2,y2:o.NOTE_ICON_WIDTH/2,opacity:l}),!!a&&(0,i.jsx)("rect",{x:o.NOTE_ICON_WIDTH/2,y:o.NOTE_ICON_WIDTH/2-o.NOTE_DURATION_HEIGHT/2,width:a,height:o.NOTE_DURATION_HEIGHT}),(0,i.jsx)("image",Object.assign({x:0,y:0,width:o.NOTE_ICON_WIDTH,height:o.NOTE_ICON_WIDTH,href:(0,s.resolveImageURL)(n),opacity:l},{children:(0,i.jsx)("animate",{attributeName:"y",values:"0;-7;-10;-7;0",dur:"0.25s",repeatCount:"1",begin:"indefinite"})})),c&&"normal"!==c&&(0,i.jsx)("text",Object.assign({x:o.NOTE_ICON_WIDTH,y:0,fontSize:o.NOTE_ICON_WIDTH/2},{children:"sharp"===c?"":""}))]}))}},{"../../../../react-common/components/util":187,"./svgConstants":261,"./utils":262,"react/jsx-runtime":549}],251:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NoteGroup=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./Note"),s=e("./playback"),a=e("./svgConstants"),l=e("./utils");n.NoteGroup=e=>{const{song:t,noteEvent:n,octave:c,iconURI:u,isDrumTrack:d,cursor:h}=e;let p;r.useEffect((()=>{let e=!1;const t=t=>{if(t>=n.startTick&&t<n.endTick){if(!e){e=!0,p.classList.add("music-note-playing");const t=p.querySelectorAll("animate");for(let e=0;e<t.length;e++)t.item(e).beginElement()}}else e&&(e=!1,p.classList.remove("music-note-playing"))},i=()=>{e&&(e=!1,p.classList.remove("music-note-playing"))};return(0,s.addTickListener)(t),(0,s.addPlaybackStateListener)(i),()=>{(0,s.removeTickListener)(t),(0,s.removePlaybackStateListener)(i),p.classList.remove("music-note-playing")}}),[n]);const f=(0,a.tickToX)(t.ticksPerBeat,n.startTick),g=d?0:(0,a.tickToX)(t.ticksPerBeat,n.endTick)-f,m=(null==h?void 0:h.tick)===n.startTick;return(0,i.jsx)("g",Object.assign({className:"music-staff-note-group",transform:`translate(${f}, 0)`,ref:e=>{e&&(p=e)}},{children:n.notes.map(((e,t)=>{const r=(0,l.isBassClefNote)(c,e,d),s=(0,l.noteToRow)(c,e,d);return(0,i.jsx)(o.Note,{isBassClef:r,row:s,enharmonicSpelling:e.enharmonicSpelling,iconURI:u,length:g,selected:n.selected,cursorHighlighted:m&&h.noteGroupIndex===t},t)}))}))}},{"./Note":250,"./playback":260,"./svgConstants":261,"./utils":262,react:548,"react/jsx-runtime":549}],252:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PlaybackControls=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/controls/Checkbox"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/util"),c=e("./playback");n.PlaybackControls=e=>{const{song:t,onTempoChange:n,onMeasuresChanged:u,onUndoClick:d,onRedoClick:h,hasUndo:p,hasRedo:f,showBassClef:g,onBassClefCheckboxClick:m}=e,[b,y]=r.useState("stop");r.useEffect((()=>{const e=e=>{y(e)};return(0,c.addPlaybackStateListener)(e),()=>(0,c.removePlaybackStateListener)(e)}),[]);const v=e=>{let t=parseFloat(e);Number.isNaN(t)||(t=Math.min(500,Math.max(20,Math.floor(t))),n(t))},_=e=>{let t=parseInt(e);isNaN(t)||t<1||t>50||u(t)};return(0,i.jsxs)("div",Object.assign({className:"music-playback-controls"},{children:[(0,i.jsxs)("div",Object.assign({className:"music-playback-buttons"},{children:[(0,i.jsx)(o.Button,{className:"square-button",title:lf("Stop"),leftIcon:"fas fa-stop",onClick:()=>{(0,c.stopPlayback)(),y("stop")}}),(0,i.jsx)(o.Button,{className:(0,l.classList)("square-button","play"===b&&"green"),title:lf("Play"),leftIcon:"fas fa-play",onClick:()=>{(0,c.startPlaybackAsync)(t,!1,0),y("play")}}),(0,i.jsx)(o.Button,{className:(0,l.classList)("square-button","loop"===b&&"green"),title:lf("Loop"),leftIcon:"fas fa-retweet",onClick:()=>{(0,c.isLooping)()||((0,c.isPlaying)()?(0,c.setLooping)(!0):(0,c.startPlaybackAsync)(t,!0,0),y("loop"))}})]})),(0,i.jsx)(a.Input,{id:"music-playback-tempo-input music-editor-label",label:lf("Tempo:"),initialValue:t.beatsPerMinute.toString(),onBlur:v,onEnterKey:v}),(0,i.jsx)("div",{className:"spacer"}),(0,i.jsx)(s.Checkbox,{className:"music-editor-label",id:"show-bass-clef",label:lf("Show bass clef"),isChecked:g,onChange:m}),(0,i.jsxs)("div",Object.assign({className:"music-undo-redo common-button-group"},{children:[(0,i.jsx)(o.Button,{className:"square-button purple",title:lf("Undo"),leftIcon:"xicon undo",disabled:!p,onClick:d}),(0,i.jsx)(o.Button,{className:"square-button purple",title:lf("Redo"),leftIcon:"xicon redo",disabled:!f,onClick:h})]})),(0,i.jsxs)("div",Object.assign({className:"music-playback-measures"},{children:[(0,i.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Measures:")})),(0,i.jsx)(o.Button,{className:"menu-button",title:lf("Remove measure"),leftIcon:"fas fa-minus-circle",onClick:()=>{t.measures>1&&u(t.measures-1)}}),(0,i.jsx)(a.Input,{id:"music-playback-measures-input",initialValue:t.measures.toString(),onBlur:_,onEnterKey:_}),(0,i.jsx)(o.Button,{className:"menu-button",title:lf("Add measure"),leftIcon:"fas fa-plus-circle",onClick:()=>{t.measures<50&&u(t.measures+1)}})]}))]}))}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/Checkbox":148,"../../../../react-common/components/controls/Input":154,"../../../../react-common/components/util":187,"./playback":260,react:548,"react/jsx-runtime":549}],253:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollableWorkspace=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./svgConstants"),s=e("./utils"),a=e("./Workspace");n.ScrollableWorkspace=e=>{const{cursor:t,song:n}=e,l=r.useRef(null);return r.useEffect((()=>{if(!t)return;const e=(0,o.tickToX)(n.ticksPerBeat,t.tick),i=l.current.querySelector("svg"),r=e=>{const t=i.createSVGPoint();return t.x=e,t.y=0,t.matrixTransform(i.getScreenCTM()).x},a=r(e),c=(0,s.findNoteEventAtTick)(n,t.track,t.tick),u=r(e+o.BEAT_WIDTH)-a;let d;d=c?r((0,o.tickToX)(n.ticksPerBeat,c.endTick+n.ticksPerBeat/2))-a:u;const h=l.current.getBoundingClientRect(),p=a-h.x,f=p+d;p<u?l.current.scrollLeft+=p-u:d<h.width&&f>h.width&&(l.current.scrollLeft+=f-h.width)}),[null==t?void 0:t.tick,n.ticksPerBeat]),(0,i.jsx)("div",Object.assign({ref:l,className:"music-scrollable-workspace"},{children:(0,i.jsx)("div",Object.assign({className:"music-scroller"},{children:(0,i.jsx)(a.Workspace,Object.assign({},e))}))}))}},{"./Workspace":257,"./svgConstants":261,"./utils":262,react:548,"react/jsx-runtime":549}],254:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Staff=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/util"),s=e("./playback"),a=e("./svgConstants"),l=e("./utils");n.Staff=e=>{const{top:t,isBassClef:n,gridTicks:c,ticksPerBeat:u,beatsPerMeasure:d,beatsPerMinute:h,measures:p}=e;let f;r.useEffect((()=>{const e=pxsim.music.tickToMs(h,u,1),t=(0,a.tickToX)(u,2)-(0,a.tickToX)(u,1);let n,i,r=0,o=!1;const l=e=>{r=(0,a.tickToX)(u,e),i=Date.now(),o||(o=!0,f.style.display="unset",n=requestAnimationFrame(d))},c=()=>{o=!1,f.style.display="none",n&&cancelAnimationFrame(n)},d=()=>{const s=r+t*(Date.now()-i)/e;f.setAttribute("transform",`translate(${s}, 0)`),o&&(n=requestAnimationFrame(d))};return(0,s.addTickListener)(l),(0,s.addPlaybackStateListener)(c),()=>{(0,s.removeTickListener)(l),(0,s.removePlaybackStateListener)(c),n&&cancelAnimationFrame(n)}}),[u,h]);const g=(0,a.workspaceWidth)(p,d),m=[];for(let e=0;e<5;e++)m.push((0,i.jsx)("line",{className:"music-staff-row",x1:0,y1:(0,a.rowY)(2*e+2,!1),x2:g,y2:(0,a.rowY)(2*e+2,!1)},e));const b=[],y=c;for(let e=0;e<p*d*u;e+=y){const t=e%u==0,r=e%(d*u)==0,s=!t&&!r;b.push((0,i.jsxs)("g",{children:[r&&!n&&(0,i.jsx)("text",Object.assign({x:(0,a.tickToX)(u,e),y:a.STAFF_HEADER_HEIGHT-a.STAFF_HEADER_OFFSET,textAnchor:"middle",fontSize:a.STAFF_HEADER_FONT_SIZE},{children:Math.floor(e/(d*u))+1})),(0,i.jsx)("line",{className:"music-staff-column",x1:(0,a.tickToX)(u,e),y1:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.STAFF_HEADER_HEIGHT}),!s&&(0,i.jsx)("line",{className:(0,o.classList)("music-staff-column",t&&"beat-start",r&&"measure-start"),x1:(0,a.tickToX)(u,e),y1:n&&r?0:a.STAFF_HEADER_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.WORKSPACE_HEIGHT})]},e))}return(0,i.jsxs)("g",Object.assign({className:"music-staff",transform:`translate(0 ${t})`},{children:[(0,i.jsx)("rect",{className:"music-staff-background",x:0,y:a.STAFF_HEADER_HEIGHT,width:g,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,i.jsx)("image",{className:"music-staff-clef",href:(0,l.resolveImageURL)(n?"music-editor/bass-clef.svg":"music-editor/treble-clef.svg"),height:n?a.BASS_CLEF_HEIGHT:a.CLEF_HEIGHT,x:0,y:n?a.BASS_CLEF_TOP:a.STAFF_HEADER_HEIGHT}),(0,i.jsx)("rect",{fill:"#000",x:0,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:g,height:a.STAFF_GRID_TICK_HEIGHT}),(0,i.jsx)("rect",{fill:"#dedede",x:a.CLEF_WIDTH,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:g-a.CLEF_WIDTH-a.STAFF_END_WIDTH,height:a.STAFF_GRID_TICK_HEIGHT}),(0,i.jsx)("g",Object.assign({className:"music-staff-rows"},{children:m})),(0,i.jsx)("g",Object.assign({className:"music-staff-beats"},{children:b})),(0,i.jsxs)("g",Object.assign({className:"music-staff-end"},{children:[(0,i.jsx)("rect",{x:g-a.STAFF_END_WIDTH,y:a.STAFF_HEADER_HEIGHT,width:3,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,i.jsx)("rect",{x:g-12,y:a.STAFF_HEADER_HEIGHT,width:12,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT})]})),(0,i.jsx)("g",Object.assign({className:"music-playback-head",ref:e=>{e&&(f=e)}},{children:(0,i.jsx)("line",{className:"music-playback-line",x1:0,y1:a.STAFF_HEADER_HEIGHT,x2:0,y2:a.WORKSPACE_HEIGHT})}))]}))}},{"../../../../react-common/components/util":187,"./playback":260,"./svgConstants":261,"./utils":262,react:548,"react/jsx-runtime":549}],255:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Track=void 0;const i=e("react/jsx-runtime"),r=e("./Note"),o=e("./NoteGroup"),s=e("./svgConstants");n.Track=e=>{const{song:t,track:n,cursorLocation:a,keyboardCursor:l}=e;let c;return a&&(c=(0,i.jsx)("g",Object.assign({transform:`translate(${(0,s.tickToX)(t.ticksPerBeat,a.tick)}, 0)`},{children:(0,i.jsx)(r.Note,{isBassClef:a.isBassClef,row:a.row,iconURI:n.iconURI,opacity:.5})}))),(0,i.jsxs)("g",Object.assign({className:"music-staff-track"},{children:[l&&(0,i.jsx)("g",{children:(0,i.jsx)("rect",{x:(0,s.tickToX)(t.ticksPerBeat,l.tick),y:l.bassClef?s.BASS_STAFF_TOP+s.STAFF_HEADER_HEIGHT:s.STAFF_HEADER_HEIGHT,width:5,height:s.WORKSPACE_HEIGHT-s.STAFF_HEADER_HEIGHT,fill:"purple"})}),n.notes.map((e=>(0,i.jsx)(o.NoteGroup,{noteEvent:e,octave:n.instrument.octave,song:t,iconURI:n.iconURI,isDrumTrack:!!n.drums,cursor:l},e.startTick))),c]}))}},{"./Note":250,"./NoteGroup":251,"./svgConstants":261,"react/jsx-runtime":549}],256:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TrackSelector=void 0;const i=e("react/jsx-runtime"),r=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/Checkbox"),s=e("../../../../react-common/components/controls/Dropdown"),a=e("../../../../react-common/components/controls/FocusList"),l=e("../../../../react-common/components/util"),c=e("./utils"),u={four:"1/4",eight:"1/8",sixteen:"1/16",thirtytwo:"1/32"};n.TrackSelector=e=>{const{song:t,selected:n,onTrackSelected:d,selectedResolution:h,onResolutionSelected:p,eraserActive:f,onEraserClick:g,hideTracksActive:m,onHideTracksClick:b}=e,y=[{title:lf("1/4 Note"),label:lf("1/4"),id:"four"},{title:lf("1/8 Note"),label:lf("1/8"),id:"eight"},{title:lf("1/16 Note"),label:lf("1/16"),id:"sixteen"},{title:lf("1/32 Note"),label:lf("1/32"),id:"thirtytwo"}];return(0,i.jsxs)("div",Object.assign({className:"music-track-selector"},{children:[(0,i.jsxs)(a.FocusList,Object.assign({role:"radiogroup",ariaLabel:lf("Track selection")},{children:[t.tracks.map(((e,o)=>(0,i.jsx)(r.Button,{role:"radio",ariaSelected:n===o&&!f,ariaPosInSet:o+1,ariaSetSize:t.tracks.length+1,title:e.name,className:(0,l.classList)("music-track-button square-button pixellated",n===o&&!f&&"selected"),label:(0,i.jsx)("img",{src:(0,c.resolveImageURL)(e.iconURI),alt:e.name}),onClick:()=>(e=>{d(e)})(o)},e.name))),(0,i.jsx)(r.Button,{className:(0,l.classList)("music-track-button square-button",f&&"selected"),title:f?lf("Turn off eraser tool"):lf("Turn on eraser tool"),leftIcon:"fas fa-eraser",ariaSelected:f,ariaPosInSet:t.tracks.length,ariaSetSize:t.tracks.length+1,onClick:g})]})),(0,i.jsx)(o.Checkbox,{className:"music-editor-label",id:"hide-tracks",label:lf("Only show selected instrument"),isChecked:m,onChange:b}),(0,i.jsxs)("div",Object.assign({className:"music-track-grid"},{children:[(0,i.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Grid:")})),(0,i.jsx)(s.Dropdown,{id:"grid-resolution",ariaLabel:lf("Staff grid resolution"),items:y,selectedId:Object.keys(u).find((e=>u[e]===h)),onItemSelected:e=>{p(u[e])}})]}))]}))}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/Checkbox":148,"../../../../react-common/components/controls/Dropdown":150,"../../../../react-common/components/controls/FocusList":152,"../../../../react-common/components/util":187,"./utils":262,"react/jsx-runtime":549}],257:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Workspace=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/util"),s=e("./GridHighlight"),a=e("./Staff"),l=e("./svgConstants"),c=e("./Track"),u=e("./utils"),d=e("./WorkspaceSelection");function h(e,t,n,i){const r=(0,o.screenToSVGCoord)(t,(0,o.clientCoord)(e)),s=r.y>l.BASS_STAFF_TOP,a=(0,l.closestTick)(n.ticksPerBeat,r.x+l.BEAT_WIDTH/n.ticksPerBeat,i);return{isBassClef:s,row:(0,l.closestRow)(r.y),tick:a,exactTick:(0,l.closestTick)(n.ticksPerBeat,r.x,1)}}n.Workspace=e=>{const{song:t,onWorkspaceClick:n,gridTicks:p,selectedTrack:f,onWorkspaceDrag:g,onWorkspaceDragStart:m,onWorkspaceDragEnd:b,onKeydown:y,cursor:v,hideUnselectedTracks:_,eraserActive:E,showBassClef:T,selection:x}=e,[w,k]=r.useState(null),[S,C]=r.useState(null),[A,I]=r.useState(!1);let O;r.useEffect((()=>{O.onpointerdown=e=>{e.preventDefault(),O.focus();const n=h(e,O,t,p);n.tick>=0&&n.row>=0&&n.row<12&&C(n)},O.onpointermove=e=>{const n=h(e,O,t,p);if(w&&w.exactTick===n.exactTick&&w.row===n.row)return;const i=t.beatsPerMeasure*t.ticksPerBeat*t.measures;n.tick>=0&&n.row>=0&&n.row<12&&n.tick<=i?(S&&(A||(I(!0),m()),g(S,n)),n.tick<i?k(n):k(null)):k(null)},O.onpointerleave=e=>{k(null),A&&(b(),I(!1))},O.onpointerup=e=>{if(C(null),A)b(),I(!1);else{const i=h(e,O,t,p);i.tick>=0&&i.row>=0&&i.row<12&&n(i,e.ctrlKey)}}}),[w,S,A,g,b,m]);let N,R,D=A||E?void 0:w;const L=w&&(0,u.findNoteEventAtTick)(t,f,w.tick),M=S&&(0,u.findNoteEventAtTick)(t,f,S.tick);x?(N=x.startTick+x.deltaTick,R=x.endTick+x.deltaTick):!E&&M&&(null==w?void 0:w.tick)>=M.startTick?(N=M.startTick,R=M.endTick):!E&&A&&w&&S?(N=Math.min(w.tick,S.tick),R=Math.max(w.tick,S.tick)):L?(N=L.startTick,R=L.endTick):w&&(N=w.tick,R=w.tick+p),L&&D&&(D=Object.assign(Object.assign({},D),{tick:L.startTick}));const P=t.tracks.filter(((e,t)=>t!==f)),B=T?2*l.WORKSPACE_HEIGHT:l.WORKSPACE_HEIGHT,j=pxt.assets.music.getSongInfo(t);return(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:(0,o.classList)("music-workspace",E&&"erasing"),viewBox:`0 0 ${(0,l.workspaceWidth)(t.measures,t.beatsPerMeasure)+20} ${B}`,"aria-label":lf("Music Workspace"),tabIndex:0,onKeyDown:y,ref:e=>{e&&(O=e)}},{children:[(0,i.jsxs)("filter",Object.assign({id:"selection-outline"},{children:[(0,i.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,i.jsx)("feFlood",{floodColor:"yellow",floodOpacity:"1",result:"FLOODED"}),(0,i.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,i.jsxs)("feMerge",{children:[(0,i.jsx)("feMergeNode",{in:"OUTLINE"}),(0,i.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,i.jsxs)("filter",Object.assign({id:"cursor-outline"},{children:[(0,i.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,i.jsx)("feFlood",{floodColor:"purple",floodOpacity:"1",result:"FLOODED"}),(0,i.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,i.jsxs)("feMerge",{children:[(0,i.jsx)("feMergeNode",{in:"OUTLINE"}),(0,i.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,i.jsx)(a.Staff,Object.assign({},j,{top:0,gridTicks:p})),T&&(0,i.jsx)(a.Staff,Object.assign({},j,{top:l.BASS_STAFF_TOP,isBassClef:!0,gridTicks:p})),(0,i.jsx)(s.GridHighlight,Object.assign({},j,{start:N,end:R})),x&&(0,i.jsx)(d.WorkspaceSelection,Object.assign({},j,{range:x})),!_&&P.map(((e,n)=>(0,i.jsx)(c.Track,{track:e,song:t},n))),(0,i.jsx)(c.Track,{track:t.tracks[f],song:t,cursorLocation:D,keyboardCursor:v})]}))}},{"../../../../react-common/components/util":187,"./GridHighlight":248,"./Staff":254,"./Track":255,"./WorkspaceSelection":258,"./svgConstants":261,"./utils":262,react:548,"react/jsx-runtime":549}],258:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkspaceSelection=void 0;const i=e("react/jsx-runtime"),r=e("./svgConstants");n.WorkspaceSelection=e=>{const{range:t,ticksPerBeat:n}=e,o=(0,r.tickToX)(n,t.startTick+t.deltaTick),s=(0,r.tickToX)(n,t.endTick+t.deltaTick);return(0,i.jsxs)("g",{children:[(0,i.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,s),y:r.STAFF_HEADER_HEIGHT,width:Math.max(o,s)-Math.min(o,s),height:r.WORKSPACE_HEIGHT-r.STAFF_HEADER_HEIGHT}),(0,i.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,s),y:r.BASS_STAFF_TOP+r.STAFF_HEADER_HEIGHT,width:Math.max(o,s)-Math.min(o,s),height:r.WORKSPACE_HEIGHT-r.STAFF_HEADER_HEIGHT})]})}},{"./svgConstants":261,"react/jsx-runtime":549}],259:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.handleKeyboardEvent=void 0;const i=e("./playback"),r=e("./utils");n.handleKeyboardEvent=function(e,t,n){const o=n.ctrlKey||n.metaKey,s=n.shiftKey,a=n.altKey,l=t.selection?void 0:(0,r.findNoteEventAtTick)(e,t.track,t.tick);(null==l?void 0:l.startTick)===t.tick&&void 0===t.noteGroupIndex&&(t.noteGroupIndex=0);let c=e,u=Object.assign(Object.assign({},t),{selection:t.selection&&Object.assign({},t.selection)});const d=e.tracks[t.track].instrument,h=d.octave,p=e.ticksPerBeat*e.beatsPerMeasure,f=p*e.measures,g=!!t.selection,m=!!e.tracks[t.track].drums,b=e=>{u.selection&&(c=(0,r.applySelection)(u.selection,t.hideTracksActive?t.track:void 0),e&&(c=(0,r.unselectAllNotes)(c)),delete u.selection)},y=t=>{for(const n of t.notes)pxsim.music.playNoteAsync(n.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,t.endTick-t.startTick))};switch(n.key){case"ArrowUp":case"Up":if(n.preventDefault(),s){u.bassClef=!1;break}if(u.selection){u.selection.transpose++,c=(0,r.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=l.notes.length-1;else if(a)u.noteGroupIndex=Math.min(t.noteGroupIndex+1,l.notes.length-1);else{let n=l.notes[t.noteGroupIndex],i=(0,r.isBassClefNote)(h,n,m);const s=(0,r.noteToRow)(h,n,m);let a=s;const p=o?12:1;for(;l.notes.some((e=>(0,r.isBassClefNote)(h,e,m)===i&&a===(0,r.noteToRow)(h,e,m)));)if((a+=p)>=12){if(!i)break;i=!1,a-=12}if(a>=12||a<0)break;const f=(0,r.rowToNote)(h,a,i,m,n.enharmonicSpelling);c=(0,r.removeNoteAtRowFromTrack)(c,t.track,s,(0,r.isBassClefNote)(h,n,m),l.startTick),c=(0,r.addNoteToTrack)(c,t.track,f,l.startTick,l.endTick);const g=(0,r.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=g.notes.findIndex((e=>e.note===f.note)),pxsim.music.playNoteAsync(f.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,g.endTick-g.startTick))}break;case"ArrowDown":case"Down":if(n.preventDefault(),s){u.bassClef=!0;break}if(u.selection){u.selection.transpose--,c=(0,r.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=0;else if(a)u.noteGroupIndex=Math.max(t.noteGroupIndex-1,0);else{let n=l.notes[t.noteGroupIndex];const i=c.tracks[t.track];let s=(0,r.isBassClefNote)(h,n,!!i.drums);const a=(0,r.noteToRow)(h,n,!!i.drums);let p=a;const f=o?-12:-1;for(;l.notes.some((e=>(0,r.isBassClefNote)(h,e,!!i.drums)===s&&p===(0,r.noteToRow)(h,e,!!i.drums)));)if((p+=f)<0){if(s)break;s=!0,p+=12}if(p>=12||p<0)break;const g=(0,r.rowToNote)(h,p,s,!!i.drums,n.enharmonicSpelling);c=(0,r.removeNoteAtRowFromTrack)(c,t.track,a,(0,r.isBassClefNote)(h,n,!!i.drums),l.startTick),c=(0,r.addNoteToTrack)(c,t.track,g,l.startTick,l.endTick);const m=(0,r.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=m.notes.findIndex((e=>e.note===g.note)),pxsim.music.playNoteAsync(g.note,d,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,m.endTick-m.startTick))}break;case"ArrowLeft":case"Left":if(n.preventDefault(),s&&g&&(u.selection.deltaTick||u.selection.transpose)&&b(!0),o){u.tick%p==0?u.tick=Math.max(u.tick-p,0):u.tick=Math.floor(u.tick/p)*p;const e=(0,r.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0;break}const v=t.tick%t.gridTicks!=0?Math.floor(u.tick/t.gridTicks)*t.gridTicks:t.tick-t.gridTicks,_=(0,r.findPreviousNoteEvent)(c,t.track,t.tick-1);if((null==_?void 0:_.endTick)>v){u.tick=_.startTick,u.noteGroupIndex=0;break}u.tick=Math.max(v,0),u.noteGroupIndex=void 0;break;case"ArrowRight":case"Right":if(n.preventDefault(),s&&g&&(u.selection.deltaTick||u.selection.transpose)&&b(!0),o){u.tick%p==0?u.tick=Math.min(u.tick+p,f-p):(u.tick=Math.min(Math.ceil(u.tick/p)*p,f-p),u.tick>=f&&(u.tick-=p));const e=(0,r.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0;break}const E=l?Math.ceil(l.endTick/t.gridTicks)*t.gridTicks:t.tick+t.gridTicks,T=(0,r.findNextNoteEvent)(c,t.track,t.tick);if((null==T?void 0:T.startTick)<=E){u.tick=T.startTick,u.noteGroupIndex=0;break}u.tick=Math.min(Math.ceil(E/t.gridTicks)*t.gridTicks,f-t.gridTicks),u.noteGroupIndex=void 0;break;case"End":if(n.preventDefault(),o){u.tick=f-t.gridTicks;const e=(0,r.findNoteEventAtTick)(c,t.track,u.tick);e?(u.tick=e.startTick,u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0}break;case"Home":if(n.preventDefault(),o){u.tick=0;const e=(0,r.findNoteEventAtTick)(c,t.track,u.tick);e?(u.noteGroupIndex=0,y(e)):u.noteGroupIndex=void 0}break;case"Backspace":if(n.preventDefault(),t.selection)b(),c=(0,r.deleteSelectedNotes)(c);else if(void 0!==t.noteGroupIndex){if(o){c=(0,r.removeNoteEventFromTrack)(c,t.track,t.tick),u.noteGroupIndex=void 0;break}c=(0,r.removeNoteFromTrack)(c,t.track,l.notes[t.noteGroupIndex],l.startTick),1===l.notes.length?u.noteGroupIndex=void 0:u.noteGroupIndex=Math.min(u.noteGroupIndex,l.notes.length-2)}break;case"Enter":g&&b(!0);break;case"Spacebar":case" ":n.preventDefault(),(0,i.isPlaying)()?(0,i.stopPlayback)():s?(0,i.startPlaybackAsync)(e,o,null==t?void 0:t.tick):(0,i.startPlaybackAsync)(e,o,0);break;case"j":case"J":if(e.tracks[t.track].drums)break;if(l){n.preventDefault();const e=l.notes[u.noteGroupIndex],i=12*d.octave-20,o=12*d.octave+20,s=(0,r.noteToRow)(h,e,!1),a=l.startTick,p=(0,r.isBassClefNote)(h,e,!1);let f;c=(0,r.removeNoteAtRowFromTrack)(c,u.track,s,p,a),f="normal"===e.enharmonicSpelling&&e.note<o?"sharp":"sharp"===e.enharmonicSpelling&&e.note>i||e.note===o?"flat":"normal";const g=(0,r.rowToNote)(d.octave,s,p,!1,f);c=(0,r.addNoteToTrack)(c,u.track,g,l.startTick,l.endTick),pxsim.music.playNoteAsync(g.note,d,pxsim.music.tickToMs(c.beatsPerMinute,c.ticksPerBeat,t.gridTicks))}break;default:if(o&&"a"===n.key||"A"===n.key){n.preventDefault(),u.selection&&b(!0),u.selection={startTick:0,endTick:f,originalSong:c,transpose:0,deltaTick:0};break}if(/^[a-g]$/i.test(n.key)){if(o)break;let e;n.preventDefault(),b(!0),e=t.bassClef?(0,r.rowToNote)(h,3+"abcdefg".indexOf(n.key.toLowerCase()),!0,m):(0,r.rowToNote)(h,5+"abcdefg".indexOf(n.key.toLowerCase()),!1,m),l?-1===l.notes.indexOf(e)&&(c=(0,r.addNoteToTrack)(c,t.track,e,l.startTick,l.endTick),y((0,r.findNoteEventAtTick)(c,t.track,l.startTick))):(c=(0,r.addNoteToTrack)(c,t.track,e,t.tick,t.tick+t.gridTicks),u.noteGroupIndex=0,y((0,r.findNoteEventAtTick)(c,t.track,t.tick)));break}if(/^[1-9]$/.test(n.key)){n.preventDefault(),b(!0),l&&(c=(0,r.editNoteEventLength)(c,t.track,l.startTick,l.startTick+parseInt(n.key)*t.gridTicks),y((0,r.findNoteEventAtTick)(c,t.track,l.startTick)));break}}if(u.tick!==t.tick)if(s)u.selection?u.selection.endTick=u.tick:u.selection={originalSong:e,startTick:t.tick,endTick:u.tick,transpose:0,deltaTick:0},c=(0,r.applySelection)(u.selection,u.hideTracksActive?u.track:void 0);else if(u.selection){const e=(0,r.selectNoteEventsInRange)(u.selection.originalSong,u.selection.startTick,u.selection.endTick,u.hideTracksActive?u.track:void 0),n=(0,r.findSelectedRange)(e,u.gridTicks);n&&(u.selection.startTick=n.start,u.selection.endTick=n.end),u.selection.deltaTick+=u.tick-t.tick,c=(0,r.applySelection)(u.selection,u.hideTracksActive?u.track:void 0),u.selection.startTick+u.selection.deltaTick>0&&(u.tick=u.selection.startTick+u.selection.deltaTick)}return[c,u]}},{"./playback":260,"./utils":262}],260:[function(e,t,n){"use strict";let i;Object.defineProperty(n,"__esModule",{value:!0}),n.removePlaybackStateListener=n.addPlaybackStateListener=n.removeTickListener=n.addTickListener=n.stopPlayback=n.updatePlaybackSongAsync=n.setLooping=n.isLooping=n.isPlaying=n.startPlaybackAsync=void 0;let r=[],o=[];function s(){return!!i&&"stop"!==i.state()}n.startPlaybackAsync=async function(e,t,n){i||(i=new pxsim.music.Sequencer,await i.initAsync(),i.addEventListener("state-change",(()=>{for(const e of r)e(i.state())})),i.addEventListener("tick",(()=>{for(const e of o)e(i.currentTick())})),i.setVolume(100)),i.startFrom(e,t,n)},n.isPlaying=s,n.isLooping=function(){return s()&&"loop"===i.state()},n.setLooping=function(e){i&&i.setLooping(e)},n.updatePlaybackSongAsync=async function(e){i&&i.updateSong(e)},n.stopPlayback=function(){i&&i.stop()},n.addTickListener=function(e){o.push(e)},n.removeTickListener=function(e){o=o.filter((t=>e!==t))},n.addPlaybackStateListener=function(e){r.push(e)},n.removePlaybackStateListener=function(e){r=r.filter((t=>e!==t))}},{}],261:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rowY=n.closestRow=n.closestTick=n.beatToX=n.tickToX=n.workspaceWidth=n.BASS_CLEF_HEIGHT=n.BASS_CLEF_TOP=n.BASS_STAFF_HEADER_HEIGHT=n.BASS_STAFF_TOP=n.NOTE_DURATION_HEIGHT=n.NOTE_ICON_WIDTH=n.WORKSPACE_HEIGHT=n.STAFF_GRID_TICK_HEIGHT=n.STAFF_END_WIDTH=n.STAFF_HEADER_OFFSET=n.STAFF_HEADER_FONT_SIZE=n.STAFF_HEADER_HEIGHT=n.CLEF_HEIGHT=n.CLEF_WIDTH=n.STAFF_ROW_HEIGHT=n.BEAT_WIDTH=void 0,n.BEAT_WIDTH=150,n.STAFF_ROW_HEIGHT=50,n.CLEF_WIDTH=250,n.CLEF_HEIGHT=320,n.STAFF_HEADER_HEIGHT=n.STAFF_ROW_HEIGHT,n.STAFF_HEADER_FONT_SIZE=40,n.STAFF_HEADER_OFFSET=11,n.STAFF_END_WIDTH=25,n.STAFF_GRID_TICK_HEIGHT=7,n.WORKSPACE_HEIGHT=n.STAFF_HEADER_HEIGHT+7*n.STAFF_ROW_HEIGHT,n.NOTE_ICON_WIDTH=45,n.NOTE_DURATION_HEIGHT=n.NOTE_ICON_WIDTH/3,n.BASS_STAFF_TOP=n.WORKSPACE_HEIGHT,n.BASS_STAFF_HEADER_HEIGHT=n.STAFF_ROW_HEIGHT/2,n.BASS_CLEF_TOP=90,n.BASS_CLEF_HEIGHT=230,n.workspaceWidth=function(e,t){return n.CLEF_WIDTH+e*t*n.BEAT_WIDTH+n.STAFF_END_WIDTH},n.tickToX=function(e,t){return n.CLEF_WIDTH+n.BEAT_WIDTH/e*t},n.beatToX=function(e){return n.CLEF_WIDTH+n.BEAT_WIDTH*e},n.closestTick=function(e,t,i){const r=Math.floor((t-n.CLEF_WIDTH)*(e/n.BEAT_WIDTH));return Math.floor(r/i)*i},n.closestRow=function(e){const t=e>n.BASS_STAFF_TOP;return 12-Math.round((e-n.STAFF_HEADER_HEIGHT-(t?n.BASS_STAFF_TOP:0))/(n.STAFF_ROW_HEIGHT/2))},n.rowY=function(e,t){return t?n.BASS_STAFF_TOP+n.STAFF_HEADER_HEIGHT+(12-e%12)*n.STAFF_ROW_HEIGHT/2:n.STAFF_HEADER_HEIGHT+(12-e%12)*n.STAFF_ROW_HEIGHT/2}},{}],262:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.doesSongUseBassClef=n.applySelection=n.moveSelectedNotes=n.deleteSelectedNotes=n.unselectAllNotes=n.selectNoteEventsInRange=n.findSelectedRange=n.changeSongLength=n.findNoteEventAtPosition=n.findNextNoteEvent=n.findPreviousNoteEvent=n.findNoteEventAtTick=n.fillDrums=n.editNoteEventLength=n.removeNoteEventFromTrack=n.removeNoteAtRowFromTrack=n.removeNoteFromTrack=n.addNoteToTrack=n.isBassClefNote=n.noteToRow=n.resolveImageURL=n.rowToNote=void 0;const i=[0,2,4,5,7,9,11,12,14,16,17,19],r=[0,1,3,5,7,8,10,12,13,15,17,19];function o(e,t,n,o,s){if(o)return{note:t+(n?12:0),enharmonicSpelling:"normal"};let a;return a=n?r[t]+12*e-19:i[t]+12*e+1,s&&"normal"!==s?"sharp"===s?{note:a+1,enharmonicSpelling:s}:{note:a-1,enharmonicSpelling:s}:{note:a,enharmonicSpelling:"normal"}}function s(e,t,n){if(n)return t.note>=12?t.note-12:t.note;const o=a(e,t,!1),s=t.note-1-12*e+(o?20:0),l=o?r:i;for(let e=0;e<l.length;e++){if(l[e]===s)return"normal"===t.enharmonicSpelling?e:"sharp"===t.enharmonicSpelling?e-1:e+1;if(l[e]>s){if("sharp"===t.enharmonicSpelling)return e-1;if("flat"===t.enharmonicSpelling)return e}}return"sharp"===t.enharmonicSpelling&&s===l[l.length-1]+1?l.length-1:-1}function a(e,t,n){return n?t.note>=12:"flat"===t.enharmonicSpelling?t.note<12*e:"sharp"===t.enharmonicSpelling?t.note<=12*e+1:t.note<12*e+1}function l(e,t,n,i,r){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:c(e.notes,n,i,r,e.instrument.octave,!!e.drums).filter((e=>(e.startTick<=i||e.startTick>=r)&&(e.endTick>=r||e.endTick<=i)))})))})}function c(e,t,n,i,r,o){const l={notes:[t],startTick:n,endTick:i};for(let i=0;i<e.length;i++){if(e[i].startTick>n)return e.slice(0,i).concat([l]).concat(e.slice(i));if(e[i].endTick>n)return e[i].notes.some((e=>e.note===t.note&&e.enharmonicSpelling===t.enharmonicSpelling))?e.slice():e.map(((e,n)=>n!==i?e:Object.assign(Object.assign({},e),{notes:e.notes.concat([t]).sort(((e,t)=>{const n=a(r,e,o);return n===a(r,t,o)?s(r,e,o)-s(r,t,o):n?-1:1}))})))}return e.slice().concat([l])}function u(e,t,n){const i=e.slice();for(let e=0;e<i.length;e++)if(i[e].startTick==n){i[e]=Object.assign(Object.assign({},i[e]),{notes:i[e].notes.filter((e=>e.note!==t.note))});break}return i.filter((e=>e.notes.length))}function d(e,t,n,i,r,o){const l=e.slice();for(let e=0;e<l.length;e++)if(l[e].startTick==r){l[e]=Object.assign(Object.assign({},l[e]),{notes:l[e].notes.filter((e=>a(i,e,o)!==n||s(i,e,o)!==t))});break}return l.filter((e=>e.notes.length))}function h(e,t,n){const i=e.slice();if(t>=n)return i;let r;for(let e=0;e<i.length;e++)i[e].startTick===t?(r=Object.assign(Object.assign({},i[e]),{endTick:n}),i[e]=r):r&&i[e].startTick<r.endTick&&(i[e]=void 0);return i.filter((e=>!!e))}function p(e,t,n){const i=e.tracks[t];for(const e of i.notes)if(e.startTick<=n&&e.endTick>n)return e}function f(e,t){let n=e.measures*e.beatsPerMeasure*e.ticksPerBeat+1,i=-1;for(const t of e.tracks)for(const e of t.notes)e.selected&&(n=Math.min(e.startTick,n),i=Math.max(e.endTick,i));if(-1!==i)return void 0!==t&&(n=Math.floor(n/t)*t,i=Math.ceil(i/t)*t),{start:n,end:i}}function g(e,t,n,i){return void 0!==i?Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,r)=>r!==i?e:m(e,Math.min(t,n),Math.max(t,n))))}):Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>m(e,Math.min(t,n),Math.max(t,n))))})}function m(e,t,n){return Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.slice(),selected:!(e.startTick>=n||e.endTick<=t)})))})}function b(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{selected:!1})))})))})}function y(e,t,n,i){const r=f(e);if(!r)return e;const{start:o,end:s}=r,a=o+t,l=s+t,c=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,r)=>void 0!==i&&i!=r?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.selected||e.endTick<=a||e.startTick>=l)).map((i=>i.selected?_(i,e.instrument.octave,t,n,!!e.drums):i)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,c)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<c)).sort(((e,t)=>e.startTick-t.startTick))})))})}function v(e,t){return e.pastedContent?function(e,t){const n=v(e.pastedContent,t),i=f(n,t),r=e.startTick+e.deltaTick,o=r+(i.end-i.start),s=b(e.originalSong),a=s.beatsPerMeasure*s.ticksPerBeat*s.measures;return Object.assign(Object.assign({},s),{tracks:s.tracks.map(((s,l)=>void 0!==t&&t!=l?s:Object.assign(Object.assign({},s),{notes:s.notes.filter((e=>e.endTick<=r||e.startTick>=o)).concat(n.tracks[l].notes.filter((e=>e.selected)).map((t=>Object.assign(Object.assign({},t),{startTick:t.startTick-i.start+e.startTick,endTick:t.endTick-i.start+e.startTick})))).map((t=>t.selected?_(t,s.instrument.octave,e.deltaTick,e.transpose,!!s.drums):t)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,a)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<a)).sort(((e,t)=>e.startTick-t.startTick))})))})}(e,t):y(g(e.originalSong,e.startTick,e.endTick,t),e.deltaTick,e.transpose,t)}function _(e,t,n,r,l){const c=Object.assign(Object.assign({},e),{startTick:e.startTick+n,endTick:e.endTick+n,notes:[]});if(l)c.notes=e.notes.slice();else for(const n of e.notes){let e=a(t,n,l),u=s(t,n,l);u+r>=i.length?e&&(u-=12,e=!1):u+r<0&&(e||(u+=12,e=!0));const d=u+r;d<0||d>=i.length||c.notes.push(o(t,d,e,l,n.enharmonicSpelling))}return c}n.rowToNote=o,n.resolveImageURL=function(e){return window.MonacoPaths&&window.MonacoPaths[e]||e},n.noteToRow=s,n.isBassClefNote=a,n.addNoteToTrack=l,n.removeNoteFromTrack=function(e,t,n,i){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,r)=>r!==t?e:Object.assign(Object.assign({},e),{notes:u(e.notes,n,i)})))})},n.removeNoteAtRowFromTrack=function(e,t,n,i,r){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:d(e.notes,n,i,e.instrument.octave,r,!!e.drums)})))})},n.removeNoteEventFromTrack=function(e,t,n){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,i)=>i!==t?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.startTick!==n))})))})},n.editNoteEventLength=function(e,t,n,i){const r=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:h(e.notes,n,Math.min(i,r))})))})},n.fillDrums=function(e,t,n,i,r,o){for(let s=i;s<r;s+=o)e=l(e,t,{note:n,enharmonicSpelling:"normal"},s,s+1);return e},n.findNoteEventAtTick=p,n.findPreviousNoteEvent=function(e,t,n){const i=e.tracks[t];let r;for(const e of i.notes){if(e.startTick>n)return r;r=e}return r},n.findNextNoteEvent=function(e,t,n){const i=e.tracks[t];for(const e of i.notes)if(e.startTick>n)return e},n.findNoteEventAtPosition=function(e,t,n){if(void 0!==n){const i=p(e,n,t.tick),r=e.tracks[n];return(null==i?void 0:i.notes.some((e=>s(r.instrument.octave,e,!!r.drums)===t.row)))?i:void 0}for(let n=0;n<e.tracks.length;n++){const i=p(e,n,t.tick),r=e.tracks[n];if(null==i?void 0:i.notes.some((e=>s(r.instrument.octave,e,!!r.drums)===t.row)))return i}},n.changeSongLength=function(e,t){const n=t*e.beatsPerMeasure*e.ticksPerBeat;return Object.assign(Object.assign({},e),{measures:t,tracks:e.tracks.map((e=>{const t=Object.assign(Object.assign({},e),{notes:e.notes.slice()});return t.notes=t.notes.filter((e=>e.startTick<n)),t.notes=t.notes.map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,n)}))),t}))})},n.findSelectedRange=f,n.selectNoteEventsInRange=g,n.unselectAllNotes=b,n.deleteSelectedNotes=function(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>!e.selected))})))})},n.moveSelectedNotes=y,n.applySelection=v,n.doesSongUseBassClef=function(e){return e.tracks.some((e=>e.notes.some((t=>t.notes.some((t=>a(e.instrument.octave,t,!!e.drums)))))))}},{}],263:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tour=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/TeachingBubble");n.Tour=e=>{const{onClose:t,tourSteps:n}=e,[s,a]=(0,r.useState)(0),l=(0,r.useRef)(Date.now()),c=(0,r.useRef)(Date.now());(0,r.useEffect)((()=>{c.current=Date.now()}),[s]);const u=()=>({title:n[s].title,stepDuration:((Date.now()-c.current)/1e3).toFixed(1)+"s",tourDuration:((Date.now()-l.current)/1e3).toFixed(1)+"s",step:s+1,totalSteps:n.length});return(0,i.jsx)(o.TeachingBubble,{id:"teachingBubble",targetContent:n[s],onNext:()=>{pxt.tickEvent("tour.next",u()),a(s+1)},onBack:()=>{pxt.tickEvent("tour.back",u()),a(s-1)},stepNumber:s+1,totalSteps:n.length-1,onClose:()=>{pxt.tickEvent("tour.exit",u()),t()},onFinish:()=>{pxt.tickEvent("tour.finish",u()),t()}})}},{"../../../../react-common/components/controls/TeachingBubble":162,react:548,"react/jsx-runtime":549}],264:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SearchInput=void 0;const r=e("react/jsx-runtime"),o=e("react");class s extends o.Component{constructor(e){super(e),this.updateInputValue=e=>{const{searchOnChange:t}=this.props,n=e.target.value;this.setState({inputValue:n}),t&&this.handleSearch(n)},this.state={inputValue:(null==e?void 0:e.defaultValue)||""},this.handleSearchKeyUpdate=this.handleSearchKeyUpdate.bind(this),this.handleClick=this.handleClick.bind(this)}handleSearchKeyUpdate(e){13==e.keyCode&&this.handleSearch(this.state.inputValue)}handleSearch(e){const{searchHandler:t}=this.props;t(e)}handleClick(){this.handleSearch(this.state.inputValue)}render(){const e=this.props,{ariaMessage:t,disabled:n,loading:o,placeholder:s,autoFocus:a,className:l,inputClassName:c,searchOnChange:u,searchHandler:d}=e,h=i(e,["ariaMessage","disabled","loading","placeholder","autoFocus","className","inputClassName","searchOnChange","searchHandler"]),{inputValue:p}=this.state;return(0,r.jsx)("div",Object.assign({className:`ui search ${l||""}`},h,{children:(0,r.jsxs)("div",Object.assign({className:`ui icon input ${c||""}`},{children:[(0,r.jsx)("div",Object.assign({"aria-live":"polite",className:"accessible-hidden",id:"searchInputBoxLabel"},{children:t})),(0,r.jsx)("input",{role:"search",autoFocus:a,ref:"searchInput","aria-labelledby":"searchInputBoxLabel",className:"prompt",type:"text",placeholder:s,onChange:this.updateInputValue,value:p,onKeyUp:this.handleSearchKeyUpdate,disabled:n,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),(0,r.jsx)("i",{role:"button",onClick:this.handleClick,title:lf("Search"),style:{cursor:"pointer"},className:`search link icon ${n?"disabled":""} ${o?"loading":""}`})]}))}))}}n.SearchInput=s},{react:548,"react/jsx-runtime":549}],265:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundControls=void 0;const i=e("react/jsx-runtime"),r=e("../../../../react-common/components/controls/Dropdown"),o=e("../../../../react-common/components/controls/RadioButtonGroup"),s=e("../../../../react-common/components/controls/Input"),a=e("../../../../react-common/components/controls/DraggableGraph");function l(e){switch(e){case"sine":return pxt.U.lf("Sine");case"square":return pxt.U.lf("Square");case"triangle":return pxt.U.lf("Triangle");case"sawtooth":return pxt.U.lf("Sawtooth");case"noise":return pxt.U.lf("Noise")}}n.SoundControls=e=>{const{onSoundChange:t,sound:n,handleStartAnimationRef:c}=e,u=[{title:l("sine"),id:"sine",icon:"xicon sound-sine"},{title:l("square"),id:"square",icon:"xicon sound-square"},{title:l("sawtooth"),id:"sawtooth",icon:"xicon sound-saw"},{title:l("triangle"),id:"triangle",icon:"xicon sound-triangle"},{title:l("noise"),id:"noise",icon:"xicon sound-noise"}],d=[{label:pxt.U.lf("Linear"),leftIcon:"xicon sound-linear",title:pxt.U.lf("Linear"),id:"linear"},{label:pxt.U.lf("Curve"),leftIcon:"xicon sound-curve",title:pxt.U.lf("Curve"),id:"curve"},{label:pxt.U.lf("Logarithmic"),leftIcon:"xicon sound-logarithmic",title:pxt.U.lf("Logarithmic"),id:"logarithmic"}],h=[{label:pxt.U.lf("None"),leftIcon:"xicon sound-none",title:pxt.U.lf("None"),id:"none"},{label:pxt.U.lf("Vibrato"),leftIcon:"xicon sound-vibrato",title:pxt.U.lf("Vibrato"),id:"vibrato"},{label:pxt.U.lf("Tremolo"),leftIcon:"xicon sound-tremolo",title:pxt.U.lf("Tremolo"),id:"tremolo"},{label:pxt.U.lf("Warble"),leftIcon:"xicon sound-warble",title:pxt.U.lf("Warble"),id:"warble"}],p=e=>{const i=parseInt(e);isNaN(i)||t(Object.assign(Object.assign({},n),{duration:Math.max(Math.min(0|i,9999),1)}))};let f,g;return c&&c((e=>{f&&f(e),g&&g(e)})),(0,i.jsxs)("div",Object.assign({className:"sound-controls"},{children:[(0,i.jsxs)("div",Object.assign({className:"waveform-and-duration"},{children:[(0,i.jsxs)("div",Object.assign({className:"waveform-control-label"},{children:[(0,i.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Waveform:")})),(0,i.jsx)("span",Object.assign({className:"sound-label waveform-name"},{children:l(n.wave)}))]})),(0,i.jsxs)("div",Object.assign({className:"waveform-and-duration-controls"},{children:[(0,i.jsx)(o.RadioButtonGroup,{className:"common-radio-buttons",id:"waveform-select",choices:u,selectedId:n.wave,onChoiceSelected:e=>{t(Object.assign(Object.assign({},n),{wave:e}))}}),(0,i.jsxs)("div",Object.assign({className:"duration-controls"},{children:[(0,i.jsx)("div",Object.assign({className:"sound-label"},{children:pxt.U.lf("Duration (ms)")})),(0,i.jsx)(s.Input,{id:"sound-duration-input",initialValue:n.duration+"",className:"sound-duration-input",onEnterKey:p,treatSpaceAsEnter:!0,onBlur:p,onOptionSelected:e=>{pxt.tickEvent("soundeffect.durationSelected",{option:e}),p(e)},ariaLabel:pxt.U.lf("Duration (milliseconds)"),options:{[pxt.U.lf("100 ms")]:"100",[pxt.U.lf("200 ms")]:"200",[pxt.U.lf("500 ms")]:"500",[pxt.U.lf("1 second")]:"1000",[pxt.U.lf("2 seconds")]:"2000",[pxt.U.lf("5 seconds")]:"5000"}})]}))]}))]})),(0,i.jsxs)("div",Object.assign({className:"sound-graph-container"},{children:[(0,i.jsxs)("div",Object.assign({className:"frequency-graph"},{children:[(0,i.jsxs)("div",Object.assign({className:"sound-graph-header"},{children:[(0,i.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Frequency")})),(0,i.jsxs)("div",Object.assign({className:"dropdown-and-label"},{children:[(0,i.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Effect")})),(0,i.jsx)(r.Dropdown,{id:"effect-dropdown",className:"icon-preview",selectedId:n.effect,onItemSelected:e=>{t(Object.assign(Object.assign({},n),{effect:e}))},items:h})]})),(0,i.jsxs)("div",Object.assign({className:"dropdown-and-label"},{children:[(0,i.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Interpolation")})),(0,i.jsx)(r.Dropdown,{id:"interpolation-dropdown",className:"icon-preview hang-left",selectedId:n.interpolation,onItemSelected:e=>{t(Object.assign(Object.assign({},n),{interpolation:e}))},items:d})]}))]})),(0,i.jsx)(a.DraggableGraph,{min:1,max:pxt.assets.MAX_FREQUENCY,aspectRatio:3,valueUnits:pxt.U.lf("Hz"),points:[n.startFrequency,n.endFrequency],interpolation:n.interpolation,onPointChange:(e,i)=>{t(0===e?Object.assign(Object.assign({},n),{startFrequency:i}):Object.assign(Object.assign({},n),{endFrequency:i}))},handleStartAnimationRef:e=>{f=e},squiggly:"vibrato"===n.effect||"warble"===n.effect})]})),(0,i.jsxs)("div",Object.assign({className:"volume-graph"},{children:[(0,i.jsx)("div",Object.assign({className:"sound-graph-header"},{children:(0,i.jsx)("span",Object.assign({className:"sound-label"},{children:pxt.U.lf("Volume")}))})),(0,i.jsx)(a.DraggableGraph,{min:0,max:pxt.assets.MAX_VOLUME,aspectRatio:5,points:[n.startVolume,n.endVolume],interpolation:"linear",onPointChange:(e,i)=>{t(0===e?Object.assign(Object.assign({},n),{startVolume:i}):Object.assign(Object.assign({},n),{endVolume:i}))},handleStartAnimationRef:e=>{g=e},squiggly:"tremolo"===n.effect})]}))]}))]}))}},{"../../../../react-common/components/controls/DraggableGraph":149,"../../../../react-common/components/controls/Dropdown":150,"../../../../react-common/components/controls/Input":154,"../../../../react-common/components/controls/RadioButtonGroup":161,"react/jsx-runtime":549}],266:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundEffectEditor=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("./SoundControls"),a=e("./SoundEffectHeader"),l=e("./SoundGallery"),c=e("./SoundPreview"),u=e("./soundUtil");function d(e){const t=Object.assign({},e);t.interpolation=h("linear","curve","logarithmic"),t.duration=f(t.duration+(Math.random()-.5)*t.duration,Math.min(100,t.duration),Math.max(2e3,t.duration)),"noise"===t.wave?p(20)&&(t.wave=h("sine","sawtooth","square","triangle"),t.effect=h("vibrato","tremolo","warble")):(t.wave=h("sine","sawtooth","square","triangle"),("none"!==t.effect||p(10))&&(t.effect=h("vibrato","tremolo","warble")));const n=t.endFrequency-t.startFrequency;let i=n+2*n*(Math.random()-.5);Math.sign(n)!==Math.sign(i)&&(i*=-1),i=f(i,-pxt.assets.MAX_FREQUENCY,pxt.assets.MAX_FREQUENCY),t.startFrequency=f(Math.random()*pxt.assets.MAX_FREQUENCY,Math.max(-i,1),f(5e3-i,1,pxt.assets.MAX_FREQUENCY)),t.endFrequency=f(t.startFrequency+i,1,pxt.assets.MAX_FREQUENCY);const r=t.endVolume-t.startVolume;let o=r+r*(Math.random()-.5);return o=f(o,-pxt.assets.MAX_VOLUME,pxt.assets.MAX_VOLUME),Math.sign(r)!==Math.sign(o)&&(o*=-1),t.startVolume=f(Math.random()*pxt.assets.MAX_VOLUME,Math.max(-o,0),f(pxt.assets.MAX_VOLUME-o,0,pxt.assets.MAX_VOLUME)),t.endVolume=f(t.startVolume+o,0,pxt.assets.MAX_VOLUME),t}function h(...e){return e[Math.floor(Math.random()*e.length)]}function p(e){return 100*Math.random()<e}function f(e,t,n){return Math.floor(Math.min(n,Math.max(t,e)))}n.SoundEffectEditor=e=>{const{onSoundChange:t,onClose:n,initialSound:h,useMixerSynthesizer:p}=e,[f,g]=r.useState("editor"),[m,b]=r.useState(h),[y,v]=r.useState(void 0),[_,E]=r.useState(null);let T,x,w;const k=()=>{_&&(_.cancelled=!0,T&&T(-1),x&&x(-1))};r.useEffect((()=>{const e=e=>{1!==e.key.length||e.metaKey||e.ctrlKey||/[0-9]/.test(e.key)||document.activeElement&&"INPUT"===document.activeElement.tagName&&"text"===document.activeElement.type||S()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}));const S=async(e=m)=>{k();let t={cancelled:!1};E(t),T&&T(e.duration),x&&x(e.duration);const n=()=>t.cancelled,i=(n,i)=>{w(n,i,e,t)};p?await pxsim.AudioContextManager.playInstructionsAsync(pxt.assets.soundToInstructionBuffer(e,20,1),n,i):await pxsim.codal.music.playSoundExpressionAsync((0,u.soundToCodalSound)(e).src,n,i),E(null)},C=(e,n=!0)=>{_&&k(),n&&v(void 0),t&&t(e),b(e)};return(0,i.jsxs)("div",Object.assign({className:"sound-effect-editor"},{children:[(0,i.jsx)(a.SoundEffectHeader,{selectedView:f,onViewSelected:e=>{g(e)},onClose:()=>{n&&n()}}),(0,i.jsxs)("div",Object.assign({className:"sound-effect-editor-content"},{children:[(0,i.jsx)(c.SoundPreview,{sound:m,handleStartAnimationRef:e=>{T=e},handleSynthListenerRef:e=>{w=e}}),(0,i.jsx)(o.Button,{className:"sound-effect-play-button",title:_?lf("Stop"):lf("Play"),onClick:()=>{_?k():S()},leftIcon:_?"fas fa-stop":"fas fa-play"}),(0,i.jsx)(s.SoundControls,{sound:m,onSoundChange:C,handleStartAnimationRef:e=>{x=e}}),(0,i.jsx)(o.Button,{className:"link-button generate-similar",leftIcon:"fas fa-sync",label:pxt.U.lf("Generate Similar Sound"),title:pxt.U.lf("Generate Similar Sound"),onClick:()=>{let e;y?e=d(y):(v(m),e=d(m)),C(e,!1),S(e)}}),(0,i.jsx)(l.SoundGallery,{sounds:(0,u.getGallerySounds)(p),onSoundSelected:e=>{C(e),g("editor")},visible:"gallery"===f,useMixerSynthesizer:p})]}))]}))}},{"../../../../react-common/components/controls/Button":146,"./SoundControls":265,"./SoundEffectHeader":267,"./SoundGallery":268,"./SoundPreview":269,"./soundUtil":270,react:548,"react/jsx-runtime":549}],267:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundEffectHeader=void 0;const i=e("react/jsx-runtime"),r=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/EditorToggle");n.SoundEffectHeader=e=>{const{selectedView:t,onClose:n,onViewSelected:s}=e,a=[{label:pxt.U.lf("Editor"),title:pxt.U.lf("Editor"),onClick:()=>s("editor"),focusable:!0},{label:pxt.U.lf("Gallery"),title:pxt.U.lf("Gallery"),onClick:()=>s("gallery"),focusable:!0}];return(0,i.jsxs)("div",Object.assign({className:"sound-effect-header"},{children:[(0,i.jsx)(o.EditorToggle,{id:"sound-effect-editor-toggle",items:a,selected:"editor"===t?0:1}),(0,i.jsx)(r.Button,{className:"menu-button",onClick:n,title:lf("Close"),rightIcon:"fas fa-times-circle"})]}))}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/controls/EditorToggle":151,"react/jsx-runtime":549}],268:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundGallery=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/Button"),s=e("../../../../react-common/components/util"),a=e("./soundUtil");n.SoundGallery=e=>{const{sounds:t,onSoundSelected:n,visible:r,useMixerSynthesizer:o}=e;return(0,i.jsx)("div",Object.assign({className:(0,s.classList)("sound-gallery",r&&"visible"),"aria-hidden":!r},{children:(0,i.jsx)("div",Object.assign({className:"sound-gallery-scroller"},{children:t.map(((e,t)=>(0,i.jsx)("div",Object.assign({className:"common-button",title:e.name,role:"button",tabIndex:0,onKeyDown:s.fireClickOnEnter,onClick:()=>n(e.sound)},{children:(0,i.jsx)(l,Object.assign({},e,{useMixerSynthesizer:o}))}),t)))}))}))};const l=e=>{const{sound:t,name:n,useMixerSynthesizer:s}=e,[l,c]=r.useState(null);return(0,i.jsxs)("div",Object.assign({className:"sound-gallery-item-label"},{children:[(0,i.jsx)("div",Object.assign({className:"sound-effect-name"},{children:n})),(0,i.jsx)("div",Object.assign({className:"sound-gallery-preview"},{children:(0,i.jsx)("svg",Object.assign({viewBox:"0 0 160 40",xmlns:"http://www.w3.org/2000/svg"},{children:(0,i.jsx)("path",{className:"sound-gallery-preview-wave",d:pxt.assets.renderSoundPath(t,160,40),stroke:"grey",strokeWidth:"2",fill:"none"})}))})),(0,i.jsx)(o.Button,{className:"sound-effect-play-button",title:l?lf("Stop Sound Preview"):lf("Preview Sound"),onClick:async()=>{if(l)return l.cancelled=!0,void c(null);c({cancelled:!1}),s?await pxsim.AudioContextManager.playInstructionsAsync(pxt.assets.soundToInstructionBuffer(t,20,1)):await pxsim.codal.music.playSoundExpressionAsync((0,a.soundToCodalSound)(t).src),c(null)},leftIcon:l?"fas fa-stop":"fas fa-play"})]}))}},{"../../../../react-common/components/controls/Button":146,"../../../../react-common/components/util":187,"./soundUtil":270,react:548,"react/jsx-runtime":549}],269:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SoundPreview=void 0;const i=e("react/jsx-runtime");n.SoundPreview=e=>{const{sound:t,handleStartAnimationRef:n,handleSynthListenerRef:r}=e;let o,s,a;const l=()=>{o&&s&&n((e=>{if(e<=0)return void(a=0);let n=t,i=n.startFrequency,l=n.startVolume,c=null;r(((e,t,r,o)=>{i=e,l=t*pxt.assets.MAX_VOLUME,n=r,c=o}));const u=()=>{if(!o)return;const e=Date.now()-a;if((null==c?void 0:c.cancelled)||e>n.duration)return o.setAttribute("opacity","0"),void s.setAttribute("opacity","1");o.setAttribute("opacity","1"),s.setAttribute("opacity","0"),o.setAttribute("d",pxt.assets.renderWaveSnapshot(i,l,n.wave,1e3,1e3/3.75,10)),requestAnimationFrame(u)};a=Date.now(),requestAnimationFrame(u)}))};let c;switch(t.interpolation){case"linear":c=e=>t.startFrequency+e*(t.endFrequency-t.startFrequency)/t.duration;break;case"curve":c=e=>t.startFrequency+(t.endFrequency-t.startFrequency)*Math.sin(e/t.duration*(Math.PI/2));break;case"logarithmic":c=e=>t.startFrequency+Math.log10(1+e/t.duration*9)*(t.endFrequency-t.startFrequency)}return(0,i.jsx)("div",Object.assign({className:"sound-preview"},{children:(0,i.jsxs)("svg",Object.assign({viewBox:"0 0 1000 "+1e3/3.75,xmlns:"http://www.w3.org/2000/svg"},{children:[(0,i.jsx)("path",{className:"sound-preview-baseline",d:`M 0 ${1e3/3.75/2} h 1000`,fill:"none",stroke:"grey",strokeWidth:"2px"}),(0,i.jsx)("path",{ref:e=>{e&&(s=e),l()},className:"sound-preview-static-wave",d:pxt.assets.renderSoundPath(t,1e3,1e3/3.75),fill:"none",stroke:"grey",strokeWidth:"4px",strokeLinejoin:"round"}),(0,i.jsx)("path",{ref:e=>{e&&(o=e),l()},className:"sound-preview-animated-wave",d:"",fill:"none",stroke:"#E63022",strokeWidth:"6px",strokeLinejoin:"round"}),(0,i.jsx)("rect",{x:"-2",y:"0",width:"1",height:"100%",fill:"grey"})]}))}))}},{"react/jsx-runtime":549}],270:[function(e,t,n){"use strict";function i(){return[{name:pxt.U.lf("Laser"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:1600,endFrequency:1,duration:300}},{name:pxt.U.lf("Radio"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:499,duration:750}},{name:pxt.U.lf("Jump"),sound:{interpolation:"linear",effect:"warble",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:400,endFrequency:600,duration:100}},{name:pxt.U.lf("Water Drop"),sound:{interpolation:"linear",effect:"none",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:600,duration:150}},{name:pxt.U.lf("Kick Drum"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:1,duration:100}},{name:pxt.U.lf("Tom"),sound:{interpolation:"curve",effect:"none",wave:"triangle",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:300,endFrequency:200,duration:75}},{name:pxt.U.lf("Snare"),sound:{interpolation:"logarithmic",effect:"warble",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:523,endFrequency:1,duration:100}},{name:pxt.U.lf("Hi-Hat"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:1,duration:10}},{name:pxt.U.lf("Cowbell"),sound:{interpolation:"linear",effect:"vibrato",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:500,endFrequency:500,duration:50}},{name:pxt.U.lf("Triangle"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:54,endFrequency:54,duration:500}}]}function r(){return[{name:pxt.U.lf("Laser"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:1600,endFrequency:1,duration:300}},{name:pxt.U.lf("Jump"),sound:{interpolation:"linear",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:400,endFrequency:600,duration:100}},{name:pxt.U.lf("Water Drop"),sound:{interpolation:"linear",effect:"none",wave:"sine",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:600,duration:150}},{name:pxt.U.lf("Kick Drum"),sound:{interpolation:"curve",effect:"none",wave:"square",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:200,endFrequency:1,duration:100}},{name:pxt.U.lf("Tom"),sound:{interpolation:"curve",effect:"none",wave:"triangle",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:300,endFrequency:200,duration:75}},{name:pxt.U.lf("Snare"),sound:{interpolation:"linear",effect:"warble",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:3300,endFrequency:1400,duration:150}},{name:pxt.U.lf("Hi-Hat"),sound:{interpolation:"linear",effect:"none",wave:"noise",startVolume:pxt.assets.MAX_VOLUME,endVolume:0,startFrequency:3900,endFrequency:3500,duration:10}}]}Object.defineProperty(n,"__esModule",{value:!0}),n.getMixerGallerySounds=n.getCODALGallerySounds=n.getGallerySounds=n.soundToCodalSound=void 0,n.soundToCodalSound=function(e){const t=new pxsim.codal.music.Sound;switch(t.frequency=e.startFrequency,t.volume=e.startVolume/pxt.assets.MAX_VOLUME*1023|0,t.endFrequency=e.endFrequency,t.endVolume=e.endVolume/pxt.assets.MAX_VOLUME*1023|0,e.wave){case"sine":t.wave=pxsim.codal.music.WaveShape.Sine;break;case"triangle":t.wave=pxsim.codal.music.WaveShape.Triangle;break;case"square":t.wave=pxsim.codal.music.WaveShape.Square;break;case"sawtooth":t.wave=pxsim.codal.music.WaveShape.Sawtooth;break;case"noise":t.wave=pxsim.codal.music.WaveShape.Noise}switch(e.interpolation){case"linear":t.shape=pxsim.codal.music.InterpolationEffect.Linear;break;case"curve":t.shape=pxsim.codal.music.InterpolationEffect.Curve;break;case"logarithmic":t.shape=pxsim.codal.music.InterpolationEffect.Logarithmic}switch(e.effect){case"vibrato":t.fx=pxsim.codal.music.Effect.Vibrato,t.fxnSteps=512,t.fxParam=2;break;case"tremolo":t.fx=pxsim.codal.music.Effect.Tremolo,t.fxnSteps=900,t.fxParam=3;break;case"warble":t.fx=pxsim.codal.music.Effect.Warble,t.fxnSteps=700,t.fxParam=2}return t.duration=Math.max(Math.min(0|e.duration,9999),1),t.steps=90,t},n.getGallerySounds=function(e){return e?r():i()},n.getCODALGallerySounds=i,n.getMixerGallerySounds=r},{}],271:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialCallout=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../sui");n.TutorialCallout=function(e){const{children:t,className:n,buttonIcon:s,buttonLabel:a,onClick:l}=e,[c,u]=r.useState(!1),[d,h]=r.useState("unset"),[p,f]=r.useState("unset"),[g,m]=r.useState("unset"),b=r.useRef(null),y=r.useRef(null);r.useEffect((()=>{if(!c)return;function e(){var e,t,n;const i=(null!==(t=null===(e=document.getElementById("editortools"))||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0)+30;(null===(n=y.current)||void 0===n?void 0:n.getBoundingClientRect().bottom)>=window.innerHeight-i?(f("unset"),m(`${i}px`),h("90vh")):m("unset")}const t=new ResizeObserver((()=>{window.requestAnimationFrame(e)}));t.observe(document.body),y.current&&t.observe(y.current),e();const n=e=>{var t;(null===(t=null==b?void 0:b.current)||void 0===t?void 0:t.contains(e.target))||u(!1)};return document.addEventListener("click",n),()=>{t.disconnect(),document.removeEventListener("click",n)}}),[c]);const v=e=>{var t;e.preventDefault(),e.stopPropagation(),null===(t=e.nativeEvent)||void 0===t||t.stopImmediatePropagation()},_=r.useCallback((()=>{u(!1)}),[]),E=r.useCallback((e=>{v(e),u(!c)}),[c]),T=r.useCallback((e=>{l&&l(c),E(e)}),[l,c]),x=lf("Click to show a hint!");return(0,i.jsxs)("div",Object.assign({ref:b,className:n},{children:[(0,i.jsx)(o.Button,{icon:s,text:a,className:"tutorial-callout-button",title:x,ariaLabel:x,disabled:!t,onClick:t?T:void 0}),c&&(0,i.jsxs)("div",Object.assign({ref:y,className:"tutorial-callout no-select",onClick:v,style:{top:p,bottom:g,maxHeight:d}},{children:[(0,i.jsx)(o.Button,{icon:"close",className:"tutorial-callout-close",onClick:_}),t]})),c&&(0,i.jsx)("div",{className:"tutorial-callout-mask",onClick:_})]}))}},{"../../sui":346,react:548,"react/jsx-runtime":549}],272:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialContainer=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../marked"),s=e("../../sui"),a=e("../../immersivereader"),l=e("./TutorialStepCounter"),c=e("./TutorialHint"),u=e("./TutorialResetCode"),d=e("../../../../react-common/components/util"),h=e("./TutorialValidationErrorMessage"),p=e("../tutorialValidators");n.TutorialContainer=function(e){const{parent:t,tutorialId:n,name:f,steps:g,hideIteration:m,hasTemplate:b,preferredEditor:y,tutorialOptions:v,onTutorialStepChange:_,onTutorialComplete:E,setParentHeight:T}=e,[x,w]=r.useState(e.currentStep||0),[k,S]=r.useState(0),[C,A]=r.useState(!1),[I,O]=r.useState(!1),[N,R]=r.useState([]),D=r.useRef(void 0),L=r.useRef(void 0),M=0!==x,P=x!==g.length-1,B=!P&&!pxt.appTarget.appTheme.lockedEditor&&!m,j=pxt.appTarget.appTheme.immersiveReader,F=e.tutorialSimSidebar||pxt.BrowserUtils.isTabletSize(),$=r.useRef(),U=r.useRef();r.useEffect((()=>{const e=new ResizeObserver(J);return e.observe(document.body),$.current&&e.observe($.current),()=>e.disconnect()}),[document.body]),r.useEffect((()=>{var t,n,i;if(!e.hasBeenResized)if(F){let e=0;((null===(t=null==D?void 0:D.current)||void 0===t?void 0:t.children)?pxt.Util.toArray(null===(n=null==D?void 0:D.current)||void 0===n?void 0:n.children):[]).forEach((t=>e+=null==t?void 0:t.scrollHeight)),L&&(e-=(null===(i=L.current)||void 0===i?void 0:i.scrollHeight)||0);const r=Math.max(Math.min(194,Math.floor(.25*window.innerHeight)),80);e&&T(Math.min(Math.max(e+2,80),r))}else T()}),[e.hasBeenResized,document.body]),r.useEffect((()=>{w(e.currentStep)}),[e.currentStep]),r.useEffect((()=>{const e=null==D?void 0:D.current;U.current&&U.current.focus(),e.scrollTo(0,0),J(),S(0),_(x),P&&A(!1)}),[x]),r.useEffect((()=>()=>o.MarkedContent.clearBlockSnippetCache()),[C]);const H=g[x];if(!g[x])return(0,i.jsx)("div",{});const G=H.showDialog,V=G?Math.min(x+1,g.length-1):x,W=g.findIndex((e=>!e.showDialog)),z=g[V].title,q=g[V].headerContentMd,Y=g[V].hintContentMd,K=async(t=!1)=>{var i,r,o,s;let a={};null===(r=null===(i=H.localValidationConfig)||void 0===i?void 0:i.validatorsMetadata)||void 0===r||r.forEach((e=>a[e.validatorType]=(0,p.GetValidator)(e))),null===(s=null===(o=v.globalValidationConfig)||void 0===o?void 0:o.validatorsMetadata)||void 0===s||s.forEach((e=>{a[e.validatorType]||(a[e.validatorType]=(0,p.GetValidator)(e))}));let l=[];for(let t of Object.values(a)){let n=await(null==t?void 0:t.execute({parent:e.parent,tutorialOptions:e.tutorialOptions}));n&&!n.isValid&&l.push(n)}if(R(l),0==l.length)Z(t);else{let e=k+1;S(e),pxt.tickEvent("codevalidation.stopnext",{tutorial:n,step:x,errorCount:l.length,attemptsWithError:e})}},Z=(t=!1)=>{var i;const r=Math.min(x+1,e.steps.length-1);pxt.tickEvent("tutorial.next",{tutorial:n,step:r,isModal:G?1:0,validationErrors:null!==(i=null==N?void 0:N.length)&&void 0!==i?i:0,attemptsWithError:k,isStepCounter:t?1:0},{interactiveConsent:!0}),N.length>0&&R([]),w(r)},X=P?()=>Z():()=>A(!0),J=()=>{const e=null==D?void 0:D.current;O(e&&e.scrollHeight-e.scrollTop-e.clientHeight>1)};let Q=[{label:lf("Ok"),onclick:X,icon:"arrow circle right",className:"green"}];M&&Q.unshift({label:lf("Back"),onclick:()=>{const e=Math.max(x-1,0);pxt.tickEvent("tutorial.previous",{tutorial:n,step:e,isModal:G?1:0},{interactiveConsent:!0}),w(e)},icon:"arrow circle left",disabled:!M,labelPosition:"left"}),j&&Q.push({className:"immersive-reader-button",onclick:async()=>{await(0,a.launchImmersiveReaderAsync)(H.contentMd,v)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")});const ee=lf("Finish the tutorial."),te=lf("Go to the next step of the tutorial."),ne=B?(0,i.jsx)(s.Button,{icon:"check circle",title:ee,ariaLabel:ee,text:lf("Done"),onClick:E}):(0,i.jsx)(s.Button,{icon:"arrow circle right",title:te,ariaLabel:te,disabled:!P,text:lf("Next"),onClick:()=>K()}),ie=(0,i.jsx)(l.TutorialStepCounter,{tutorialId:n,currentStep:V,totalSteps:g.length,title:f,isHorizontal:F,setTutorialStep:e=>{e==x+1?K(!0):w(e)},onDone:E}),re=!!Y;return(0,i.jsxs)("div",Object.assign({className:"tutorial-container",ref:$},{children:[!F&&ie,(0,i.jsx)("div",Object.assign({className:(0,d.classList)("tutorial-content",re&&"has-hint"),ref:D,onScroll:J},{children:(0,i.jsxs)("div",Object.assign({className:"tutorial-content-bkg"},{children:[!F&&(0,i.jsxs)("div",Object.assign({className:"tutorial-step-label"},{children:[f&&(0,i.jsx)("span",Object.assign({className:"tutorial-step-title"},{children:f})),(0,i.jsx)("span",Object.assign({className:"tutorial-step-number"},{children:lf("Step {0} of {1}",V+1,g.length)}))]})),j&&(0,i.jsx)(a.ImmersiveReaderButton,{ref:L,content:q,tutorialOptions:v}),z&&(0,i.jsx)("div",Object.assign({className:"tutorial-title"},{children:z})),(0,i.jsx)(o.MarkedContent,{className:"no-select tutorial-step-content",tabIndex:0,markdown:q,parent:t,contentRef:e=>{U.current=e}}),(0,i.jsxs)("div",Object.assign({className:"tutorial-controls"},{children:[re&&(0,i.jsx)(c.TutorialHint,{tutorialId:n,currentStep:V,markdown:Y,parent:t}),F&&ie,!F&&ne]}))]}))})),N.length>0&&(0,i.jsx)(h.TutorialValidationErrorMessage,{onContinueClicked:()=>{pxt.tickEvent("codevalidation.continueanyway",{tutorial:n,step:x,attemptsWithError:k}),Z()},onReturnClicked:()=>{R([]),pxt.tickEvent("codevalidation.popupclose",{tutorial:n,step:x,attemptsWithError:k})},validationFailures:N,tutorialId:n,currentStep:x,attemptsWithError:k}),b&&x==W&&"asset"!==y&&!pxt.appTarget.appTheme.hideReplaceMyCode&&(0,i.jsx)(u.TutorialResetCode,{tutorialId:n,currentStep:V,resetTemplateCode:t.resetTutorialTemplateCode}),I&&(0,i.jsx)("div",{className:"tutorial-scroll-gradient"}),G&&!C&&(0,i.jsx)(s.Modal,Object.assign({isOpen:G,closeIcon:!1,header:H.title||f,buttons:Q,className:"hintdialog",onClose:X,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsx)(o.MarkedContent,{markdown:H.contentMd,parent:t})}))]}))}},{"../../../../react-common/components/util":187,"../../immersivereader":309,"../../marked":313,"../../sui":346,"../tutorialValidators":277,"./TutorialHint":273,"./TutorialResetCode":274,"./TutorialStepCounter":275,"./TutorialValidationErrorMessage":276,react:548,"react/jsx-runtime":549}],273:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialHint=void 0;const i=e("react/jsx-runtime"),r=e("../../marked"),o=e("./TutorialCallout");n.TutorialHint=function(e){const{parent:t,markdown:n,tutorialId:s,currentStep:a}=e;return(0,i.jsx)(o.TutorialCallout,Object.assign({className:"tutorial-hint",buttonIcon:"lightbulb",onClick:e=>{e||pxt.tickEvent("tutorial.showhint",{tutorial:s,step:a})}},{children:n&&(0,i.jsx)(r.MarkedContent,{className:"hint-content",markdown:n,unboxSnippets:!0,parent:t})}))}},{"../../marked":313,"./TutorialCallout":271,"react/jsx-runtime":549}],274:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialResetCode=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../sui"),s=e("./TutorialCallout");n.TutorialResetCode=function(e){const{resetTemplateCode:t,tutorialId:n,currentStep:a}=e,[l,c]=r.useState(!1);return(0,i.jsxs)(s.TutorialCallout,Object.assign({buttonLabel:lf("Replace my code"),className:"tutorial-replace-code"},{children:[(0,i.jsx)("p",{children:lf("Did the code you're working with get off track? It happens.")}),(0,i.jsx)("p",{children:lf("Click below to replace your code with updated blocks.")}),(0,i.jsx)("p",{children:lf('This will delete all your current code blocks. Any custom images and tiles can still be found in the gallery under "My Assets".')}),(0,i.jsx)("div",Object.assign({className:"tutorial-replace-code-actions"},{children:(0,i.jsx)(o.Button,{className:"primary",text:lf("Replace my code"),disabled:l,onClick:async()=>{pxt.tickEvent("tutorial.resetcode",{tutorial:n,step:a}),c(!0);try{await t(!0)}finally{document.dispatchEvent(new Event("click")),c(!1)}}})}))]}))}},{"../../sui":346,"./TutorialCallout":271,react:548,"react/jsx-runtime":549}],275:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialStepCounter=void 0;const i=e("react/jsx-runtime"),r=e("../../../../react-common/components/controls/Button");n.TutorialStepCounter=function(e){const{tutorialId:t,currentStep:n,totalSteps:o,title:s,setTutorialStep:a}=e,l=Math.max(0,Math.min(n-Math.floor(3.5),o-7)),c=[];for(let e=0;e<Math.min(7,o);e++)c.push(e+l);const u=e=>()=>{pxt.tickEvent("tutorial.step",{tutorial:t,step:e,prevStep:n},{interactiveConsent:!0}),a(e)},d=e=>lf("Go to step {0} of {1}",e+1,o),h=lf("Go to the previous step of the tutorial."),p=n==o-1,f=p?lf("Finish the tutorial."):lf("Go to the next step of the tutorial.");return(0,i.jsxs)("div",Object.assign({className:"tutorial-step-counter"},{children:[(0,i.jsxs)("div",Object.assign({className:"tutorial-step-label"},{children:[s&&(0,i.jsx)("span",Object.assign({className:"tutorial-step-title"},{children:s})),(0,i.jsx)("span",Object.assign({className:"tutorial-step-number"},{children:lf("Step {0} of {1}",n+1,o)}))]})),(0,i.jsxs)("div",Object.assign({className:"tutorial-step-bubbles"},{children:[(0,i.jsx)(r.Button,{disabled:0==n,className:e.isHorizontal?"ui button counter-previous-button":"square-button",leftIcon:"icon "+(e.isHorizontal?"arrow circle left":"left chevron"),onClick:()=>{const e=Math.max(n-1,0);pxt.tickEvent("tutorial.previous",{tutorial:t,step:e,isModal:0,isStepCounter:1},{interactiveConsent:!0}),a(e)},"aria-label":h,title:h}),c.map((e=>{const t=e===n;return(0,i.jsx)(r.Button,{className:"empty circle-button "+(t?"current":""),disabled:t,onClick:u(e),"aria-label":d(e),title:d(e),label:e===n?`${e+1}`:void 0},`step${e}`)})),(0,i.jsx)(r.Button,{className:e.isHorizontal?"ui button counter-next-button":"square-button",leftIcon:"icon "+(p?"check":e.isHorizontal?"arrow circle right":"right chevron"),onClick:p?e.onDone:()=>{const e=Math.min(n+1,o-1);a(e)},"aria-label":f,title:f,label:e.isHorizontal?p?lf("Done"):lf("Next"):""})]}))]}))}},{"../../../../react-common/components/controls/Button":146,"react/jsx-runtime":549}],276:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TutorialValidationErrorMessage=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("../../../../react-common/components/controls/Button");n.TutorialValidationErrorMessage=function(e){const[t,n]=r.useState(!1),s=!!e.validationFailures.find((e=>e.hint&&""!=e.hint)),a=s?(0,i.jsx)("div",Object.assign({className:"tutorial-validation-error-hint"},{children:e.validationFailures.map(((e,t)=>e.hint?(0,i.jsx)("div",{children:e.hint},t):null))})):void 0,l=lf("Show Hint"),c=lf("Continue Anyway"),u=lf("Close");return(0,i.jsxs)("div",Object.assign({className:"tutorial-validation-error-container"},{children:[(0,i.jsx)(o.Button,{className:"tutorial-validation-error-close",onClick:e.onReturnClicked,title:u,ariaLabel:u,rightIcon:"fas fa-times-circle"}),t?a:(0,i.jsxs)("div",Object.assign({className:"tutorial-validation-error-body"},{children:[(0,i.jsx)("img",{className:"tutorial-validation-error-emoji",src:"/static/validation/ladybeetle.svg",alt:lf("Ladybug"),height:"50%"}),(0,i.jsxs)("div",Object.assign({className:"tutorial-validation-error-inner"},{children:[(0,i.jsx)("strong",{children:lf("Is there a bug?")}),(0,i.jsx)("p",{children:lf("This code doesn't look the way we expected.")}),(0,i.jsxs)("div",Object.assign({className:"tutorial-validation-error-controls"},{children:[s&&(0,i.jsx)(o.Button,{className:"teal",leftIcon:"fas fa-lightbulb",onClick:()=>{t||(pxt.tickEvent("codevalidation.showhint",{tutorial:e.tutorialId,step:e.currentStep,attemptsWithError:e.attemptsWithError}),n(!0))},title:l,ariaLabel:l,label:l}),(0,i.jsx)(o.Button,{className:"teal inverted",leftIcon:"fas fa-arrow-circle-right",onClick:e.onContinueClicked,title:c,ariaLabel:c,label:c})]}))]}))]}))]}))}},{"../../../../react-common/components/controls/Button":146,react:548,"react/jsx-runtime":549}],277:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BlocksExistValidator=n.GetValidator=void 0;const i=e("react/jsx-runtime"),r=e("../marked"),o=e("../app"),s=e("../../../pxteditor");n.GetValidator=function(e){switch(e.validatorType.toLowerCase()){case"blocksexistvalidator":return new a(e.properties);default:return console.error(`Unrecognized validator: ${e.validatorType}`),null}};class a extends class{constructor(e){var t;this.enabled="false"!=(null===(t=e.enabled)||void 0===t?void 0:t.toLowerCase())}async execute(e){return this.enabled?this.executeInternal(e):{isValid:!0,hint:null}}}{constructor(e){super(e),this.name="blocksexistvalidator",e.markers&&(this.markers=e.markers.split(",").map((e=>e.trim())))}async executeInternal(e){var t,n;const{parent:a,tutorialOptions:l}=e,c=null===(t=l.tutorialStepInfo)||void 0===t?void 0:t[l.tutorialStep];if(!c)return{isValid:!0,hint:null};const u=null===(n=(0,o.getBlocksEditor)())||void 0===n?void 0:n.editor;if(!u)return{isValid:!0,hint:null};this.markers&&(this.markers.includes("highlight")||this.markers.includes("validate-exists"))||(this.markers=["highlight","validate-exists"]);const d=await pxt.tutorial.getTutorialHighlightedBlocks(l),h=await pxt.tutorial.getTutorialValidateBlocks(l);if(!d&&!h)return{isValid:!0,hint:null};const p=pxt.tutorial.getTutorialStepHash(l);let f={},g={};if(d&&this.markers.includes("highlight")&&(f=d[p]),h&&this.markers.includes("validate-exists")){const e=h[p];g=pxt.tutorial.getRequiredBlockCounts(e)}const m=Object.assign({},f);for(const e in g)m[e]=(m[e]||0)+g[e];const{missingBlocks:b,disabledBlocks:y,insufficientBlocks:v}=s.validation.validateBlocksExist({usedBlocks:u.getAllBlocks(!1),requiredBlockCounts:m});let _,E=!0;b.length>0&&y.length>0?(E=!1,_=lf("Make sure you see blocks that look like this and that they're connected to the rest of your code.")):b.length>0?(E=!1,_=lf("Make sure you see blocks that look like this in your workspace.")):y.length>0?(E=!1,_=lf("Make sure your blocks are connected to the rest of your code like this.")):v.length>0&&(E=!1,_=lf("Make sure you have enough blocks and that they're connected to the rest of your code. It should look like this."));const T=(null==c?void 0:c.hintContentMd)?(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:lf("Looks like you're missing some blocks.")}),(0,i.jsx)("p",{children:_}),(0,i.jsx)(r.MarkedContent,{className:"no-select tutorial-validation-answer-key-hint",markdown:c.hintContentMd,parent:a})]}):"";return{isValid:E,hint:E?void 0:T}}}n.BlocksExistValidator=a},{"../../../pxteditor":134,"../app":190,"../marked":313,"react/jsx-runtime":549}],278:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SandboxFooter=n.SideDocs=n.EditorSelector=n.SettingsMenu=n.DocsMenu=void 0;const r=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./auth"),c=e("./package"),u=e("./util");function d(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.startActivity({activity:"tutorial",path:t})}function h(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.setSideDoc(t)}function p(e){pxt.tickEvent("tour.start",{origin:"help-menu"}),e.showOnboarding()}function f(e,t,n=""){return t.map((t=>t.tutorial?(0,r.jsx)(y,{role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+n,parent:e,path:t.path,onItemClick:d},"docsmenututorial"+t.path):/^\//.test(t.path)?(0,r.jsx)(y,{role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+n,parent:e,path:t.path,onItemClick:h},"docsmenu"+t.path):(0,r.jsx)("a",Object.assign({role:"menuitem","aria-label":t.name,title:t.name,className:`ui item link ${n}`,href:t.path,target:"docs"},{children:pxt.Util.rlf(t.name)}),"docsmenulink"+t.path)))}function g(e,t,n=""){const i="/"+e.toLowerCase();return(0,r.jsx)(y,{role:"menuitem",ariaLabel:pxt.Util.rlf(e),text:pxt.Util.rlf(e),className:`ui ${n}`,parent:t,path:i,onItemClick:h},"docsmenu"+i)}function m(e,t=""){return(0,r.jsx)(y,{role:"menuitem",ariaLabel:lf("Tour"),text:lf("Tour"),className:`ui ${t}`,parent:e,path:"/tour",onItemClick:p},"docsmenu/tour")}class b extends o.PureComponent{renderCore(){var e;const t=this.props.parent,n=pxt.appTarget.appTheme;return(0,r.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",icon:"help circle large",className:"item mobile hide help-dropdown-menuitem",textClass:"landscape only",title:lf("Help")},{children:[(null===(e=n.tours)||void 0===e?void 0:e.editor)&&m(t),f(t,n.docMenu),g(this.props.editor,t)]}))}}n.DocsMenu=b;class y extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{onItemClick:e,parent:t,path:n}=this.props;e(t,n)}renderCore(){const e=this.props,{onClick:t,onItemClick:n,parent:o,path:a}=e,l=i(e,["onClick","onItemClick","parent","path"]);return(0,r.jsx)(s.Item,Object.assign({},l,{onClick:this.handleClick}))}}class v extends o.Component{constructor(e){super(e),this.state={},this.openSettings=this.openSettings.bind(this),this.showPackageDialog=this.showPackageDialog.bind(this),this.showBoardDialog=this.showBoardDialog.bind(this),this.removeProject=this.removeProject.bind(this),this.saveProject=this.saveProject.bind(this),this.toggleCollapse=this.toggleCollapse.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleAccessibleBlocks=this.toggleAccessibleBlocks.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showShareDialog=this.showShareDialog.bind(this),this.showExitAndSaveDialog=this.showExitAndSaveDialog.bind(this),this.pair=this.pair.bind(this),this.pairBluetooth=this.pairBluetooth.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.showTurnBackTimeDialog=this.showTurnBackTimeDialog.bind(this),this.print=this.print.bind(this),this.signOutGithub=this.signOutGithub.bind(this),this.hide=this.hide.bind(this)}showExitAndSaveDialog(){pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}showShareDialog(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()}openSettings(){pxt.tickEvent("menu.settings",void 0,{interactiveConsent:!0}),this.props.parent.openSettings()}showPackageDialog(){pxt.tickEvent("menu.addpackage",void 0,{interactiveConsent:!0}),this.props.parent.showPackageDialog()}showBoardDialog(){pxt.tickEvent("menu.changeboard",void 0,{interactiveConsent:!0}),pxt.hasHwVariants()?this.props.parent.showChooseHwDialog():this.props.parent.showBoardDialogAsync(void 0,!0)}saveProject(){pxt.tickEvent("menu.saveproject",void 0,{interactiveConsent:!0}),this.props.parent.saveAndCompile()}removeProject(){pxt.tickEvent("menu.removeproject",void 0,{interactiveConsent:!0}),this.props.parent.removeProject()}toggleCollapse(){pxt.tickEvent("menu.toggleSim",void 0,{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}showReportAbuse(){pxt.tickEvent("menu.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showLanguagePicker(){pxt.tickEvent("menu.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("menu.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("menu.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("menu.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("menu.reset",void 0,{interactiveConsent:!0}),pxt.tickEvent("reset"),this.props.parent.showResetDialog()}pair(){pxt.tickEvent("menu.pair"),this.props.parent.pairAsync()}pairBluetooth(){pxt.tickEvent("menu.pair.bluetooth"),a.showLoading("webblepair",lf("Pairing Bluetooth device...")),pxt.webBluetooth.pairAsync().then((()=>a.hideLoading("webblepair")))}showAboutDialog(){pxt.tickEvent("menu.about"),this.props.parent.showAboutDialog()}showTurnBackTimeDialog(){pxt.tickEvent("menu.turnBackTime"),this.props.parent.showTurnBackTimeDialogAsync()}print(){pxt.tickEvent("menu.print"),this.props.parent.printCode()}hide(){var e;null===(e=this.dropdown)||void 0===e||e.hide()}signOutGithub(){pxt.tickEvent("menu.github.signout"),this.hide(),this.props.parent.signOutGithub()}UNSAFE_componentWillReceiveProps(e){const t={};void 0!==e.greenScreen&&(t.greenScreen=e.greenScreen),void 0!==e.accessibleBlocks&&(t.accessibleBlocks=e.accessibleBlocks),void 0!==e.showShare&&(t.showShare=e.showShare),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.greenScreen!=t.greenScreen||this.state.accessibleBlocks!=t.accessibleBlocks||this.state.showShare!=t.showShare||e.inBlocks!==this.props.inBlocks}renderCore(){var e,t,n;const i=pxt.auth.hasIdentity(),o=this.getData(l.HIGHCONTRAST),{greenScreen:a,accessibleBlocks:c}=this.state,u=pxt.appTarget.appTheme,d=pxt.appTarget.cloud&&!!pxt.appTarget.cloud.packages,h=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,p=pxt.shell.isReadOnly(),g=pxt.shell.isControllerMode(),m=u.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),b=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),y=null===(e=pxt.appTarget.simulator)||void 0===e?void 0:e.headless,v=!u.lockedEditor&&!g&&l.hasIdentity(),_=this.props.showShare&&(null===(t=pxt.appTarget.cloud)||void 0===t?void 0:t.sharing)&&!g,E=!(p||g||!u.saveInMenu||m||b),T=!(p||g||!u.simCollapseInMenu||y&&this.props.inBlocks),x=u.greenScreen||/greenscreen=1/i.test(window.location.href),w=u.print&&!pxt.BrowserUtils.isIE(),k=u.showProjectSettings,S=u.docMenu&&u.docMenu.filter((e=>!e.tutorial)),C=(null===(n=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===n?void 0:n.deviceIcon)||"usb",A=!i&&!p&&!g&&this.getData("github:user"),I=pxt.usb.isEnabled,O=u.selectLanguage||u.highContrast||x||A,N=y?lf("Toggle the File Explorer"):lf("Toggle the simulator");return(0,r.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem",ref:e=>this.dropdown=e},{children:[v&&(0,r.jsx)(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"home",title:lf("Home"),text:lf("Home"),ariaLabel:lf("Home screen"),onClick:this.showExitAndSaveDialog}),_&&(0,r.jsx)(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"share alternate",title:lf("Publish your game to create a shareable link"),text:lf("Share"),ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),(v||_)&&(0,r.jsx)("div",{className:"ui divider mobile only inherit"}),k?(0,r.jsx)(s.Item,{role:"menuitem",icon:"options",text:lf("Project Settings"),onClick:this.openSettings}):void 0,d?(0,r.jsx)(s.Item,{role:"menuitem",icon:"disk outline",text:lf("Extensions"),onClick:this.showPackageDialog}):void 0,I?(0,r.jsx)(s.Item,{role:"menuitem",icon:C,text:lf("Connect Device"),onClick:this.pair}):void 0,pxt.webBluetooth.isAvailable()?(0,r.jsx)(s.Item,{role:"menuitem",icon:"bluetooth",text:lf("Pair Bluetooth"),onClick:this.pairBluetooth}):void 0,w?(0,r.jsx)(s.Item,{role:"menuitem",icon:"print",text:lf("Print..."),onClick:this.print}):void 0,E?(0,r.jsx)(s.Item,{role:"menuitem",icon:"save",text:lf("Save Project"),onClick:this.saveProject}):void 0,g?void 0:(0,r.jsx)(s.Item,{role:"menuitem",icon:"trash",text:lf("Delete Project"),onClick:this.removeProject}),u.timeMachine?(0,r.jsx)(s.Item,{role:"menuitem",icon:"history",text:lf("Version History"),onClick:this.showTurnBackTimeDialog}):void 0,T?(0,r.jsx)(s.Item,{role:"menuitem",icon:"toggle right",text:N,onClick:this.toggleCollapse}):void 0,(0,r.jsx)("div",{className:"ui divider"}),u.selectLanguage?(0,r.jsx)(s.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,u.highContrast?(0,r.jsx)(s.Item,{role:"menuitem",text:o?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,u.accessibleBlocks?(0,r.jsx)(s.Item,{role:"menuitem",text:c?lf("Accessible Blocks Off"):lf("Accessible Blocks On"),onClick:this.toggleAccessibleBlocks}):void 0,x?(0,r.jsx)(s.Item,{role:"menuitem",text:a?lf("Green Screen Off"):lf("Green Screen On"),onClick:this.toggleGreenScreen}):void 0,S&&f(this.props.parent,S,"setting-docs-item mobile only inherit"),A?(0,r.jsx)("div",{className:"ui divider"}):void 0,A?(0,r.jsxs)("div",Object.assign({className:"ui item",title:lf("Unlink {0} from GitHub",A.name),role:"menuitem",onClick:this.signOutGithub},{children:[(0,r.jsx)("div",Object.assign({className:"avatar",role:"presentation"},{children:(0,r.jsx)("img",{className:"ui circular image",src:A.photo,alt:lf("User picture")})})),lf("Disconnect GitHub")]})):void 0,O&&(0,r.jsx)("div",{className:"ui divider"}),h?(0,r.jsx)(s.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,g?void 0:(0,r.jsx)(s.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),(0,r.jsx)(s.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),u.feedbackUrl?(0,r.jsx)("a",Object.assign({className:"ui item",href:u.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Give Feedback")})):void 0]}))}}n.SettingsMenu=v;class _ extends o.Component{constructor(e){super(e)}renderCore(){const e=this.props.isActive();return(0,r.jsx)(s.Item,{className:`base-menuitem ${this.props.className} ${e?"selected":""}`,role:"option",textClass:"landscape only",text:this.props.text,icon:this.props.icon,active:e,onClick:this.props.onClick,title:this.props.title})}}class E extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.javascript",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()},this.isActive=()=>this.props.parent.isJavaScriptActive()}renderCore(){return(0,r.jsx)(_,{className:"javascript-menuitem",icon:"xicon js",text:"JavaScript",title:lf("Convert code to JavaScript"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class T extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.python",void 0,{interactiveConsent:!0}),this.props.parent.openPython()},this.isActive=()=>this.props.parent.isPythonActive()}renderCore(){return(0,r.jsx)(_,{className:"python-menuitem",icon:"xicon python",text:"Python",title:lf("Convert code to Python"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class x extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.blocks",void 0,{interactiveConsent:!0}),this.props.parent.openBlocks()},this.isActive=()=>this.props.parent.isBlocksActive()}renderCore(){return(0,r.jsx)(_,{className:"blocks-menuitem",icon:"xicon blocks",text:lf("Blocks"),title:lf("Convert code to Blocks"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class w extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.simView",void 0,{interactiveConsent:!0}),this.props.parent.openSimView()},this.isActive=()=>this.props.parent.isEmbedSimActive()}renderCore(){const e=this.isActive(),t=3==this.props.parent.state.simState,n=t?lf("Stop the simulator"):lf("Start the simulator");return(0,r.jsx)(_,{className:"sim-menuitem",icon:e&&t?"stop":"play",text:lf("Simulator"),title:e?n:lf("Show Simulator"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class k extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.assets",void 0,{interactiveConsent:!0}),this.props.parent.openAssets()},this.isActive=()=>this.props.parent.isAssetsActive()}renderCore(){return(0,r.jsx)(_,{className:"assets-menuitem",icon:"picture",text:lf("Assets"),title:lf("View project assets"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class S extends o.Component{constructor(e){super(e)}renderCore(){const{python:e,sandbox:t,headless:n,languageRestriction:i,parent:o}=this.props,a=e&&(o.isJavaScriptActive()||o.isPythonActive()),l="javascript-only"===i,u="python-only"===i,d="blocks-only"===i,h="no-javascript"===i,p="no-python"===i,f="no-blocks"===i,g=o.isPythonActive()||pxt.shell.isPyLangPref(),m=e&&!l&&!d&&!p,b=!(u||l||f||!c.mainEditorPkg().files[pxt.MAIN_BLOCKS]),y=!h&&!u&&!d,v=t&&!n,_=m&&y&&b,S=pxt.appTarget.appTheme.assetEditor&&!t;let C,A;return _?C=g?(0,r.jsx)(T,{parent:o}):(0,r.jsx)(E,{parent:o}):m&&y?(C=(0,r.jsx)(E,{parent:o}),A=(0,r.jsx)(T,{parent:o})):m?C=(0,r.jsx)(T,{parent:o}):y&&(C=(0,r.jsx)(E,{parent:o})),(0,r.jsxs)("div",Object.assign({id:"editortoggle",className:"ui grid padded "+(u||l?"one-language":""),role:"listbox","aria-orientation":"horizontal","aria-label":lf("Editor toggle")},{children:[v&&(0,r.jsx)(w,{parent:o}),b&&(0,r.jsx)(x,{parent:o}),C,A,_&&(0,r.jsxs)(s.DropdownMenu,Object.assign({id:"editordropdown",role:"option",icon:"chevron down",rightIcon:!0,title:lf("Select code editor language"),className:"item button attached right "+(a?"active":"")},{children:[(0,r.jsx)(E,{parent:o}),(0,r.jsx)(T,{parent:o})]})),S&&(0,r.jsx)(k,{parent:o}),(0,r.jsx)("div",{className:"ui item toggle "+(a?"dropdown-attached":"")})]}))}}n.EditorSelector=S;class C extends o.Component{constructor(e){super(e),this.openingSideDoc=!1,this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.popOut=this.popOut.bind(this)}rootDocsUrl(){return(pxt.webConfig.docsUrl||"/--docs")+"#"}static notify(e){let t=document.getElementById("sidedocsframe");t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")}setPath(e,t){this.openingSideDoc=!0;let n=this.rootDocsUrl();const i=t?"blocks":"js",r=pxt.BrowserUtils.isPxtElectron()?"?pxtElectron=true":"";r&&n.endsWith("#")&&(n=n.substr(0,n.length-1)+r+"#");const o=`${n}doc:${e}:${i}:${pxt.Util.localeInfo()}`;this.setUrl(o)}setMarkdown(e){const t=`${this.rootDocsUrl()}md:${encodeURIComponent(e)}:blocks:${pxt.Util.localeInfo()}`;this.props.parent.setState({sideDocsLoadUrl:t})}setUrl(e){this.props.parent.setState({sideDocsLoadUrl:e,sideDocsCollapsed:!1})}expand(){this.props.parent.setState({sideDocsCollapsed:!1})}collapse(){this.props.parent.setState({sideDocsCollapsed:!0})}isCollapsed(){return!!this.state.sideDocsCollapsed}popOut(){C.notify({type:"popout"})}toggleVisibility(){const e=this.props.parent.state;this.props.parent.setState({sideDocsCollapsed:!e.sideDocsCollapsed}),document.getElementById("sidedocstoggle").focus()}componentDidUpdate(){this.props.parent.editor.resize();let e=document.getElementById("sidedocstoggle");this.openingSideDoc&&e&&(e.focus(),this.openingSideDoc=!1)}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.sideDocsCollapsed&&(t.sideDocsCollapsed=e.sideDocsCollapsed),null!=e.docsUrl&&(t.docsUrl=e.docsUrl),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.sideDocsCollapsed!=t.sideDocsCollapsed||this.state.docsUrl!=t.docsUrl}renderCore(){const{sideDocsCollapsed:e,docsUrl:t}=this.state,n=pxt.Util.isUserLanguageRtl(),i=(e||n)&&!(e&&n),o=!!pxt.appTarget.appTheme.lockedEditor;if(!t)return null;const a=e?this.rootDocsUrl():t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("button",Object.assign({id:"sidedocstoggle",role:"button","aria-label":e?lf("Expand the side documentation"):lf("Collapse the side documentation"),className:"ui icon button large",onClick:this.toggleVisibility},{children:(0,r.jsx)(s.Icon,{icon:"icon inverted chevron "+(i?"left":"right")})})),(0,r.jsxs)("div",Object.assign({id:"sidedocs"},{children:[(0,r.jsx)("div",Object.assign({id:"sidedocsframe-wrapper"},{children:(0,r.jsx)("iframe",{id:"sidedocsframe",src:a,title:lf("Documentation"),"aria-atomic":"true","aria-live":"assertive",sandbox:"allow-scripts allow-same-origin allow-forms "+(o?"":"allow-popups")})})),!o&&(0,r.jsx)("div",Object.assign({className:"ui app hide",id:"sidedocsbar"},{children:(0,r.jsx)("a",Object.assign({className:"ui icon link",role:"button",tabIndex:0,"data-content":lf("Open documentation in new tab"),"aria-label":lf("Open documentation in new tab"),onClick:this.popOut,onKeyDown:u.fireClickOnEnter},{children:(0,r.jsx)(s.Icon,{icon:"external"})}))}))]}))]})}}n.SideDocs=C;class A extends o.PureComponent{constructor(e){super(e),this.state={},this.compile=this.compile.bind(this)}compile(){pxt.tickEvent("sandboxfooter.compile",void 0,{interactiveConsent:!0}),this.props.parent.compile()}renderCore(){const e=pxt.appTarget.appTheme,t=lf("Download your code to the {0}",e.boardName);return(0,r.jsxs)("div",Object.assign({className:"ui horizontal small divided link list sandboxfooter"},{children:[e.organizationUrl&&e.organization?(0,r.jsx)("a",Object.assign({className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},{children:e.organization})):void 0,(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})),(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})),(0,r.jsx)("span",Object.assign({className:"item"},{children:(0,r.jsxs)("a",Object.assign({role:"button",className:"ui thin portrait only",title:t,onClick:this.compile},{children:[(0,r.jsx)(s.Icon,{icon:`icon ${pxt.appTarget.appTheme.downloadIcon||"download"}`}),pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download")]}))}))]}))}}n.SandboxFooter=A},{"./auth":194,"./core":279,"./data":282,"./package":325,"./sui":346,"./util":352,"react/jsx-runtime":549}],279:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.apiAsync=n.handleNetworkError=n.findChild=n.navigateInWindow=n.keyCodeFromEvent=n.resetFocus=n.setLanguage=n.setHighContrast=n.toggleHighContrast=n.getHighContrastOnce=n.SPACE_KEY=n.ENTER_KEY=n.ESC_KEY=n.TAB_KEY=n.promptAsync=n.confirmDelete=n.confirmAsync=n.forceUpdate=n.hideDialog=n.dialogAsync=n.infoNotification=n.warningNotification=n.errorNotification=n.cancelAsyncLoading=n.showLoadingAsync=n.updateLoadingCompletion=n.showLoading=n.killLoadingQueue=n.hideLoading=n.isLoading=void 0;const i=e("react"),r=e("react-dom"),o=e("./data"),s=e("./coretsx"),a=e("./auth"),l=e("../../react-common/components/Notification");var c=pxt.Cloud;let u,d=!1,h=[],p={};function f(e){if(pxt.debug("hideloading: "+e),pxt.perf.recordMilestone(`loading done #${e}`),null!=p[e]){const t=h.indexOf(e);t>-1&&h.splice(t,1),delete p[e]}else pxt.debug("Loading not in queue, disregard: "+e);h.length>0?m():d&&u&&u.hide()}function g(e,t,n){pxt.debug("showloading: "+e),p[e]||(pxt.perf.recordMilestone(`loading started #${e}`),function(){if(d)return;const e=document.getElementById("content").appendChild(document.createElement("div"));u=r.render(i.createElement(s.LoadingDimmer,{}),e),d=!0}(),u.show("initializing-loader",lf("Please wait")),h.push(e),p[e]={displayText:t,percentComplete:n},m())}function m(){if(!h.length)return;const e=h[h.length-1],t=p[e];u.show(e,t.displayText,t.percentComplete)}n.isLoading=function(){return u&&u.isVisible()},n.hideLoading=f,n.killLoadingQueue=function(){h=[],p={},d&&u&&u.hide()},n.showLoading=g,n.updateLoadingCompletion=function(e,t){const n=p[e];n?(n.percentComplete=t,(null==u?void 0:u.currentlyLoading())===e&&u.setPercentLoaded(t)):pxt.debug("Loading not in queue, disregard: "+e)};let b={};function y(e){clearTimeout(b[e]),f(e)}function v(e,t){(0,l.pushNotificationMessage)({kind:e,text:t,hc:x()})}function _(e){pxt.log("warning: "+e),v("warn",e)}function E(e){return e.buttons||(e.buttons=[]),e.type||(e.type="dialog"),e.hasCloseIcon&&(e.hideCancel=!0),e.hideCancel||(e.buttons||(e.buttons=[]),e.buttons.push({label:e.disagreeLbl||lf("Cancel"),className:e.disagreeClass||"cancel",icon:e.disagreeIcon||"cancel"})),e.helpUrl&&(e.bigHelpButton?e.buttons.unshift({className:"dialog-help-large help",urlButton:!0,label:lf("Help"),title:lf("Help"),url:e.helpUrl}):e.buttons.unshift({className:"circular help",title:lf("Help"),icon:"help",url:e.helpUrl})),s.renderConfirmDialogAsync(e)}function T(e){e.type="confirm",e.buttons||(e.buttons=[]);let t=0;return e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{t=1}}),e.deleteLbl&&e.buttons.push({label:e.deleteLbl,className:"delete red",icon:"trash",onclick:()=>{t=2}}),E(e).then((()=>t))}function x(){return o.getData(a.HIGHCONTRAST)||!1}async function w(e){await a.setHighContrastPrefAsync(e)}n.showLoadingAsync=function(e,t,n,i=700){return clearTimeout(b[e]),b[e]=setTimeout((function(){g(e,t)}),i),n.finally((()=>{y(e)}))},n.cancelAsyncLoading=y,n.errorNotification=function(e){pxt.tickEvent("notification.error",{message:e}),v("err",e)},n.warningNotification=_,n.infoNotification=function(e){pxt.debug(e),v("info",e)},n.dialogAsync=E,n.hideDialog=function(){s.hideDialog()},n.forceUpdate=function(){s.forceUpdate()},n.confirmAsync=T,n.confirmDelete=function(e,t,n){T({header:n?lf("Would you like to delete {0} projects?",e):lf("Would you like to delete '{0}'?",e),body:lf("It will be deleted for good. No undo."),agreeLbl:lf("Delete"),agreeClass:"red",agreeIcon:"trash"}).then((e=>{e&&t()}))},n.promptAsync=function(e){e.type="prompt",e.buttons||(e.buttons=[]);let t=e.initialValue||"",n=!1;return e.onInputChanged=e=>{t=e},e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{n=!0}}),E(e).then((()=>n?t:null))},n.TAB_KEY=9,n.ESC_KEY=27,n.ENTER_KEY=13,n.SPACE_KEY=32,n.getHighContrastOnce=x,n.toggleHighContrast=function(){w(!x())},n.setHighContrast=w,n.setLanguage=async function(e){pxt.BrowserUtils.setCookieLang(e),pxt.Util.setUserLanguage(e),await a.setLanguagePrefAsync(e)},n.resetFocus=function(){let e=document.getElementById("content");e.tabIndex=0,e.focus(),e.blur(),e.tabIndex=-1},n.keyCodeFromEvent=function(e){return"number"==typeof e.which?e.which:e.keyCode},n.navigateInWindow=function(e){window.location.href=e},n.findChild=function(e,t){let n=r.findDOMNode(e);return t?pxt.Util.toArray(n.querySelectorAll(t)):[n]},n.handleNetworkError=function(e,t){let n=parseInt(e.statusCode);if(e.isOffline||0===n)_(lf("Network request failed; you appear to be offline"));else if(!isNaN(n)&&200!==n){if(t&&-1!==t.indexOf(n))return e;_(lf("Network request failed"))}throw e},n.apiAsync=function(e,t){return(t?c.privatePostAsync(e,t):c.privateGetAsync(e)).then((t=>(console.log("*"),console.log("*******",e,"---\x3e"),console.log("*"),console.log(t),console.log("*"),t)),(e=>{console.log(e.message)}))}},{"../../react-common/components/Notification":144,"./auth":194,"./coretsx":280,"./data":282,react:548,"react-dom":491}],280:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoadingDimmer=n.hideDialog=n.renderConfirmDialogAsync=n.forceUpdate=n.dialogIsShowing=n.CoreDialog=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("react-dom"),s=e("./sui"),a=e("./core"),l=e("../../react-common/components/controls/ProgressBar");class c extends r.Component{constructor(e){super(e),this.state={inputValue:e.initialValue,inputError:void 0,confirmationGranted:!e.confirmationText&&!e.confirmationCheckbox&&void 0},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleConfirmationTextChange=this.handleConfirmationTextChange.bind(this),this.handleConfirmationCheckboxChange=this.handleConfirmationCheckboxChange.bind(this)}hide(){this.close()}close(e){this.setState({visible:!1}),this.resolve(e),this.props.onClose&&this.props.onClose()}componentDidMount(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}modalDidOpen(e){const t=this.props,n=this.refs.promptInput;if(n){n.setSelectionRange(0,9999);const e=this;n.onkeydown=t=>{a.keyCodeFromEvent(t)===a.ENTER_KEY&&e.okButton&&n.value&&(e.okButton.onclick(),t.preventDefault())}}t.onLoaded&&t.onLoaded(e)}handleInputChange(e){const t=this.props;let n;t.onInputChanged&&t.onInputChanged(e.target.value),t.onInputValidation&&(n=t.onInputValidation(e.target.value)),this.setState({inputValue:e.target.value,inputError:n})}handleConfirmationTextChange(e){this.setState({confirmationText:e,confirmationGranted:this.state.confirmationText===this.props.confirmationText})}handleConfirmationCheckboxChange(e){this.setState({confirmationGranted:e})}render(){var e;const t=this.props,{inputValue:n,inputError:r}=this.state,o=void 0===t.size?"small":t.size,a=t.hasCloseIcon||!t.hideCancel,l=t.buttons?t.buttons.filter((e=>!!e)):[];l.forEach((e=>{const t=e.onclick;e.onclick=()=>{e.noCloseOnClick?null==t||t():this.close(t?t():0)},e.className||(e.className="approve positive"),e.approveButton&&(this.okButton=e)})),"prompt"==t.type&&this.okButton&&(this.okButton.disabled=!n||!!r);const c=s.cx(["coredialog",t.className]),u=pxt.BrowserUtils.isMobile();return null===(e=t.buttons)||void 0===e||e.forEach((e=>{if(e.approveButton&&void 0!==this.state.confirmationGranted){const t=" disabled";this.state.confirmationGranted?e.className=e.className.replace(t,""):e.className+=e.className.indexOf(t)>=0?"":t}})),(0,i.jsxs)(s.Modal,Object.assign({isOpen:!0,ref:"modal",className:c,onClose:this.hide,size:o,defaultOpen:!0,buttons:l,dimmer:!0,closeIcon:t.hasCloseIcon,header:t.header,headerIcon:t.headerIcon,closeOnDimmerClick:a,closeOnDocumentClick:a,closeOnEscape:a,modalDidOpen:this.modalDidOpen},{children:["prompt"==t.type&&(0,i.jsxs)("div",Object.assign({className:"ui"},{children:[(0,i.jsx)("div",Object.assign({className:"ui fluid icon input"},{children:(0,i.jsx)("input",{autoFocus:!0,className:"ui input "+(r?"error":""),type:"text",ref:"promptInput",onChange:this.handleInputChange,value:n,placeholder:t.placeholder,"aria-label":t.placeholder})})),!!r&&(0,i.jsx)("div",Object.assign({className:"ui error message"},{children:r}))]})),t.jsx,!!t.jsxd&&t.jsxd(),!!t.body&&(0,i.jsx)("p",{children:t.body}),!!t.copyable&&(0,i.jsx)(s.Input,{copy:!0,readOnly:!0,value:t.copyable,selectOnClick:!0,autoComplete:!1}),!!t.confirmationText&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("p",{children:["Type '",t.confirmationText,"' to confirm:"]}),(0,i.jsx)(s.Input,{ref:"confirmationInput",id:"confirmationInput",ariaLabel:lf("Type your name to confirm"),autoComplete:!1,value:this.state.confirmationText||"",onChange:this.handleConfirmationTextChange,selectOnMount:!u,autoFocus:!u})]}),!!t.confirmationCheckbox&&(0,i.jsx)(s.PlainCheckbox,{label:t.confirmationCheckbox,isChecked:this.state.confirmationGranted,onChange:this.handleConfirmationCheckboxChange})]}))}}let u;n.CoreDialog=c,n.dialogIsShowing=function(){return!!u},n.forceUpdate=function(){u&&u.forceUpdate()},n.renderConfirmDialogAsync=function(e){return pxt.Util.delay(10).then((()=>{const t=document.body.appendChild(document.createElement("div")),n=o.render(r.createElement(c,e),t);return u=n,n.promise.finally((()=>(o.unmountComponentAtNode(t),void setTimeout((()=>{t.parentElement.removeChild(t),n===u&&(u=void 0)})))))}))},n.hideDialog=function(){u&&(u.hide(),u=void 0)};class d extends r.Component{constructor(e){super(e),this.state={visible:!0}}hide(){this.setState({visible:!1,loadedId:void 0,content:void 0,loadedPercentage:void 0})}show(e,t,n){this.setState({visible:!0,loadedId:e,content:t,loadedPercentage:n})}setPercentLoaded(e){this.setState({loadedPercentage:e})}currentlyLoading(){return this.state.loadedId}isVisible(){return this.state.visible}render(){const{visible:e,content:t,loadedPercentage:n}=this.state;if(!e)return(0,i.jsx)("div",{});const r=a.getHighContrastOnce();return(0,i.jsx)(s.Dimmer,Object.assign({isOpen:!0,active:e,closable:!1},{children:(0,i.jsxs)(s.Loader,Object.assign({className:"large main msg no-select "+(r?"hc":""),"aria-live":"assertive"},{children:[t,void 0!==n&&(0,i.jsx)(l.ProgressBar,{value:n})]}))}))}}n.LoadingDimmer=d},{"../../react-common/components/controls/ProgressBar":160,"./core":279,"./sui":346,react:548,"react-dom":491,"react/jsx-runtime":549}],281:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CreateFunctionDialog=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui"),s=e("blockly"),a=e("../../pxtblocks");class l extends r.Component{constructor(e){super(e),this.state={visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this)}hide(){pxt.BrowserUtils.removeClass(s.WidgetDiv.getDiv(),"functioneditor");const{functionEditorWorkspace:e,mainWorkspace:t}=this.state;e.clear(),e.dispose(),t.refreshToolboxSelection(),this.setState({visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null})}show(e,t,n){pxt.tickEvent("createfunction.show",null,{interactiveConsent:!1}),this.setState({visible:!0,functionCallback:t,initialMutation:e,mainWorkspace:n})}modalDidOpen(e){const t=document.getElementById("functionEditorWorkspace");let{functionEditorWorkspace:n,initialMutation:i}=this.state;if(!t)return;pxt.BrowserUtils.addClass(s.WidgetDiv.getDiv(),"functioneditor"),(n=s.inject(t,{trashcan:!1,move:{scrollbars:!0},renderer:"pxt"})).showContextMenu_=()=>{},n.clear();const r=n.newBlock("function_declaration");r.domToMutation(i),r.initSvg(),r.render(),n.centerOnBlock(r.id),n.addChangeListener((()=>{const{functionBeingEdited:e}=this.state;e&&e.updateFunctionSignature()})),this.setState({functionEditorWorkspace:n,functionBeingEdited:r}),s.svgResize(n)}cancel(){pxt.tickEvent("createfunction.cancel",void 0,{interactiveConsent:!0}),this.hide()}confirm(){s.hideChaff();const{functionBeingEdited:e,mainWorkspace:t,functionCallback:n}=this.state,i=e.mutationToDom();a.validateFunctionExternal(i,t)&&(n(i),this.hide())}addArgumentFactory(e){return()=>this.addArgument(e)}addArgument(e){const{functionBeingEdited:t}=this.state;switch(e){case"boolean":t.addBooleanExternal();break;case"string":t.addStringExternal();break;case"number":t.addNumberExternal();break;case"Array":t.addArrayExternal();break;default:t.addCustomExternal(e)}}renderCore(){const{visible:e}=this.state,t=[{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}],n=this.getArgumentTypes().slice(),r=this.props.parent.createModalClasses("createfunction");return(0,i.jsx)(o.Modal,Object.assign({isOpen:e,className:r,size:"large",closeOnEscape:!1,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:t,header:lf("Edit Function"),modalDidOpen:this.modalDidOpen,onClose:this.hide},{children:(0,i.jsxs)("div",{children:[(0,i.jsx)("span",Object.assign({className:"ui text mobile only paramlabel"},{children:lf("Add a parameter")})),(0,i.jsxs)("div",Object.assign({className:"horizontal list"},{children:[(0,i.jsx)("span",Object.assign({className:"ui text mobile hide paramlabel"},{children:lf("Add a parameter")})),n.map((e=>(0,i.jsx)(o.Button,{role:"button",className:"icon",icon:e.icon,textClass:"mobile hide",text:e.label||e.typeName,ariaLabel:lf("Add {0} parameter",e.label||e.typeName),onClick:this.addArgumentFactory(e.typeName)},e.typeName)))]})),(0,i.jsx)("div",{id:"functionEditorWorkspace"})]})}))}getArgumentTypes(){if(!l.cachedFunctionTypes){const e=[{label:lf("Text"),typeName:"string",icon:pxt.blocks.defaultIconForArgType("string")},{label:lf("Boolean"),typeName:"boolean",icon:pxt.blocks.defaultIconForArgType("boolean")},{label:lf("Number"),typeName:"number",icon:pxt.blocks.defaultIconForArgType("number")},{label:lf("Array"),typeName:"Array",icon:pxt.blocks.defaultIconForArgType("Array")}];pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes&&Array.isArray(pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes)&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes.forEach((t=>{e.push(Object.assign(Object.assign({},t),{label:t.label&&pxt.Util.rlf(`{id:type}${t.label}`),defaultName:t.defaultName&&pxt.Util.rlf(`{id:var}${t.defaultName}`)}))})),e.forEach((e=>{e.icon||(e.icon=pxt.blocks.defaultIconForArgType())})),l.cachedFunctionTypes=e}return l.cachedFunctionTypes}}n.CreateFunctionDialog=l,l.cachedFunctionTypes=null},{"../../pxtblocks":68,"./data":282,"./sui":346,blockly:376,"react/jsx-runtime":549}],282:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PureComponent=n.Component=n.invalidateHeader=n.getDataWithStatus=n.getData=n.getAsync=n.invalidate=n.stripProtocol=n.mountVirtualApi=n.getCached=n.loadCache=n.clearCache=n.unsubscribe=n.subscribe=n.FetchStatus=void 0;const i=e("react"),r=e("./core");var o,s,a=pxt.Cloud,l=pxt.Util;(s=o=n.FetchStatus||(n.FetchStatus={}))[s.Pending=0]="Pending",s[s.Complete=1]="Complete",s[s.Error=2]="Error",s[s.Offline=3]="Offline";const c={};let u,d={};function h(e,t){let n=_(t),i=n.components;i.indexOf(e)<0&&(i.push(e),e.subscriptions.push(n))}function p(e){let t=e.subscriptions;0!=t.length&&(e.subscriptions=[],t.forEach((t=>{let n=t.components.indexOf(e);n>=0&&t.components.splice(n,1)})))}function f(e){return e.api.expirationTime?null==e.data||Date.now()-e.lastRefresh>e.api.expirationTime(e.path):!e.lastRefresh}function g(e){return!(!e.data||e.data instanceof Error)&&/^cloud:(me\/settings|ptr-pkg-)/.test(e.path)}function m(){JSON.parse(pxt.storage.getLocal("apiCache2")||"[]").forEach((e=>{_(e.path).data=e.data}))}function b(){let e=l.values(d).filter((e=>g(e))).map((e=>({path:e.path,data:e.data})));pxt.storage.setLocal("apiCache2",JSON.stringify(e))}function y(e){let t=/^([\w\-]+):/.exec(e);return t&&c[t[1]]||l.oops("bad data protocol: "+e),c[t[1]]}function v(e,t){if(e.queued)return;if(e.api.isOffline&&e.api.isOffline())return;e.queued=!0;let n=n=>{e.data=n,e.lastRefresh=pxt.Util.now(),e.queued=!1,function(e,t){g(e)&&b();let n=e.callbackOnce;n.length>0&&(e.callbackOnce=[],l.nextTick((()=>n.forEach((e=>e()))))),e.components.length>0&&e.components.forEach((e=>l.nextTick((()=>e.onDataChanged(t)))))}(e,t)};e.api.isSync?n(e.api.getSync(e.path)):e.api.getAsync(e.path).then(n)}function _(e){return d.hasOwnProperty(e)||(d[e]={path:e,data:null,lastRefresh:0,queued:!1,callbackOnce:[],components:[],api:y(e)}),d[e]}function E(e,t){return h(e,t),k(t)}function T(e,t){l.assert(!c[e]),l.assert(!!t.getSync||!!t.getAsync),l.assert(!!t.getSync!=!!t.getAsync),t.isSync=!!t.getSync,c[e]=t}function x(e){let t=/^([\w\-]+):(.*)/.exec(e);return t?t[2]:(l.oops("protocol missing in: "+e),e)}function w(e){const t=e.replace(/:\*$/,":");l.values(d).forEach((n=>{(function(e,t){if(e.path.slice(0,t.length)==t)return!0;if(e.path.endsWith(":*")){const[n]=e.path.split(":"),[i]=t.split(":");return n==i}return!1})(n,t)&&(n.lastRefresh=0,n.components.length>0&&v(_(n.path),e),n.api.onInvalidated&&n.api.onInvalidated(e))}))}function k(e){let t=_(e);if(t.api.isSync)return{data:t.api.getSync(t.path),status:o.Complete};let n={data:t.data,status:o.Complete};return(f(t)||t.data instanceof Error)&&(n.status=t.data instanceof Error?o.Error:o.Pending,t.api.isOffline&&t.api.isOffline()?n.status=o.Offline:v(t,e)),n}n.subscribe=h,n.unsubscribe=p,n.clearCache=function(){d={},b()},n.loadCache=m,n.getCached=E,n.mountVirtualApi=T,n.stripProtocol=x,n.invalidate=w,n.getAsync=function(e){let t=_(e);return t.api.isSync?Promise.resolve(t.api.getSync(t.path)):a.isOnline()&&f(t)?new Promise(((n,i)=>{t.callbackOnce.push((()=>{n(t.data)})),v(t,e)})):Promise.resolve(t.data)},n.getData=function(e){return k(e).data},n.getDataWithStatus=k,T("cloud",{getAsync:e=>a.privateGetAsync(x(e)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),T("cloud-search",{getAsync:e=>a.privateGetAsync(x(e)).catch((e=>(r.handleNetworkError(e,[404]),{statusCode:404,headers:{},json:{}}))),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),T("extension-search",{getAsync:e=>pxt.targetConfigAsync().then((t=>pxt.github.searchAsync(x(e),null==t?void 0:t.packages))).catch(r.handleNetworkError),expirationTime:e=>36e5,isOffline:()=>!a.isOnline()}),T("gallery",{getAsync:e=>pxt.gallery.loadGalleryAsync(x(decodeURIComponent(e))).catch((e=>Promise.resolve(e))),expirationTime:e=>36e5}),T("gh-search",{getAsync:e=>pxt.targetConfigAsync().then((t=>pxt.github.searchAsync(x(e),null==t?void 0:t.packages))).catch(r.handleNetworkError),expirationTime:e=>36e4,isOffline:()=>!a.isOnline()}),T("gh-commits",{getAsync:e=>{const t=x(e),[n,i]=t.split("#",2);return pxt.github.getCommitsAsync(n,i).catch((e=>(r.handleNetworkError(e),[])))},expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),T("target-config",{getAsync:e=>{u||(u=pxt.targetConfigAsync().then((e=>(e&&(pxt.storage.setLocal("targetconfig",JSON.stringify(e)),w("target-config"),w("gh-search")),e))).catch(r.handleNetworkError));const t=JSON.parse(pxt.storage.getLocal("targetconfig")||"null");return t?Promise.resolve(t):u},expirationTime:e=>864e5,isOffline:()=>!a.isOnline()}),n.invalidateHeader=function(e,t){t&&w(e+":"+t.id)};class S extends i.Component{constructor(e){super(e),this.subscriptions=[],this.renderCoreOk=!1,this.state={}}getData(e){return this.getDataWithStatus(e).data}getDataWithStatus(e){return this.renderCoreOk||l.oops("Override renderCore() not render()"),E(this,e)}onDataChanged(){this.forceUpdate()}componentWillUnmount(){p(this)}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return p(this),this.renderCoreOk=!0,this.renderCore()}setStateAsync(e){return new Promise(((t,n)=>{this.setState(e,(()=>{t()}))}))}}n.Component=S;class C extends i.PureComponent{constructor(e){super(e),this.renderCoreOk=!1,this.state={}}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return this.renderCoreOk=!0,this.renderCore()}}n.PureComponent=C,m()},{"./core":279,react:548}],283:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Table=n.destroyAsync=n.getDbAsync=void 0;const i=e("pouchdb").plugin(e("pouchdb-adapter-memory"));let r;function o(){return r||(r=Promise.resolve().then((()=>{const e=new i("pxt-"+pxt.storage.storageId(),{revs_limit:2});return pxt.log(`PouchDB adapter: ${e.adapter}`),e})))}n.getDbAsync=o,n.destroyAsync=function(){return r?r.then((e=>{e.destroy(),r=void 0})):Promise.resolve()};n.Table=class{constructor(e){this.name=e}getAsync(e){return o().then((t=>t.get(this.name+"--"+e))).then((t=>(t.id=e,t)))}getAllAsync(){return o().then((e=>e.allDocs({include_docs:!0,startkey:this.name+"--",endkey:this.name+"--"}))).then((e=>e.rows.map((e=>e.doc))))}deleteAsync(e){return o().then((t=>t.remove(e)))}forceSetAsync(e){return this.getAsync(e.id).then((t=>(e._rev=t._rev,this.setAsync(e))),(t=>this.setAsync(e)))}setAsync(e){return this.setAsyncNoRetry(e).then((e=>(pxt.BrowserUtils.scheduleStorageCleanup(),e))).catch((t=>{if(409!=t.status)return pxt.reportException(t),pxt.log("table: set failed, cleaning translation db"),pxt.BrowserUtils.clearTranslationDbAsync().then((()=>pxt.BrowserUtils.clearTutorialInfoDbAsync())).then((()=>this.setAsyncNoRetry(e))).catch((e=>{throw pxt.log("table: we are out of space..."),e}));pxt.debug("table: set conflict (409)")}))}setAsyncNoRetry(e){return e.id&&!e._id&&(e._id=this.name+"--"+e.id),o().then((t=>t.put(e))).then((e=>e.rev))}}},{pouchdb:483,"pouchdb-adapter-memory":474}],284:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerCallStack=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./debuggerTable");class s extends r.Component{constructor(e){super(e),this.handleRowClick=(e,t)=>{if(!this.props.openLocation)return;const[n,i]=t.props.refID.split("_").map((e=>parseInt(e))),r=this.props.stackframes[i];r&&r.breakpointId===n&&this.props.openLocation(r.breakpointId,i)}}render(){return(0,i.jsx)(o.DebuggerTable,Object.assign({header:lf("Call Stack")},{children:this.props.stackframes.map(((e,t)=>{if(!e.breakpointId)return null;const n=e.breakpointId+"_"+t;let r=e.funcInfo.fileName;return 0===r.indexOf("pxt_modules/")&&(r=r.slice(12)),(0,i.jsx)(o.DebuggerTableRow,{refID:n,onClick:this.handleRowClick,leftText:e.funcInfo.functionName,rightText:`${r}:${e.funcInfo.line}`,icon:t===this.props.activeFrame?"arrow right":void 0,rowClass:"callstack-row"},n)}))}))}}n.DebuggerCallStack=s},{"./debuggerTable":285,react:548,"react/jsx-runtime":549}],285:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerTableRow=n.DebuggerTable=void 0;const i=e("react/jsx-runtime"),r=e("react");class o extends r.Component{render(){return(0,i.jsxs)("div",Object.assign({className:"ui varExplorer"},{children:[(0,i.jsx)("div",Object.assign({className:"ui variableTableHeader"},{children:this.props.header})),this.props.placeholderText&&(0,i.jsx)("div",Object.assign({className:"ui variableTablePlaceholder"},{children:this.props.placeholderText})),(0,i.jsx)("div",Object.assign({className:"ui segment debugvariables collapsing basic striped table"},{children:this.props.children}))]}))}}n.DebuggerTable=o;class s extends r.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onClick&&this.props.onClick(e,this)},this.valueClickHandler=e=>{this.props.onValueClick&&this.props.onValueClick(e,this)}}render(){return(0,i.jsx)("div",Object.assign({role:"listitem",className:`item ${this.props.rowClass||""}`,onClick:this.props.onClick?this.clickHandler:void 0,"aria-describedby":this.props.describedBy},{children:(0,i.jsxs)("div",Object.assign({className:"variableAndValue"},{children:[(0,i.jsxs)("div",Object.assign({className:`variable varname ${this.props.leftClass||""}`,title:this.props.leftTitle,style:this.props.depth?{marginLeft:.75*this.props.depth+"em"}:void 0},{children:[(0,i.jsx)("i",{className:`ui icon small ${this.props.icon||"invisible"}`}),(0,i.jsx)("span",{children:this.props.leftText})]})),(0,i.jsx)("div",Object.assign({className:"variable detail",role:"button",style:{padding:.2},title:this.props.rightTitle,onClick:this.valueClickHandler},{children:(0,i.jsx)("span",Object.assign({className:`varval ${this.props.rightClass||""}`},{children:this.props.rightText}))}))]}))}))}}n.DebuggerTableRow=s},{react:548,"react/jsx-runtime":549}],286:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerToolbar=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("./sui"),s=e("./data"),a=e("./simulator");class l extends s.Component{constructor(e){super(e),this.state={},this.restartSimulator=this.restartSimulator.bind(this),this.dbgPauseResume=this.dbgPauseResume.bind(this),this.dbgStepOver=this.dbgStepOver.bind(this),this.dbgStepInto=this.dbgStepInto.bind(this),this.dbgStepOut=this.dbgStepOut.bind(this),this.exitDebugging=this.exitDebugging.bind(this),this.toggleTrace=this.toggleTrace.bind(this)}restartSimulator(){pxt.tickEvent("debugger.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}exitDebugging(){pxt.tickEvent("debugger.exit",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}dbgPauseResume(){pxt.tickEvent("debugger.pauseresume",void 0,{interactiveConsent:!0}),this.props.parent.dbgPauseResume()}dbgStepOver(){pxt.tickEvent("debugger.stepover",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepOver()}dbgStepInto(){pxt.tickEvent("debugger.stepinto",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepInto()}dbgStepOut(){pxt.tickEvent("debugger.stepout",void 0,{interactiveConsent:!0}),a.dbgStepOut()}toggleTrace(){pxt.tickEvent("simulator.trace",void 0,{interactiveConsent:!0}),this.props.parent.toggleTrace()}getMenuDom(){const e=r.findDOMNode(this);return e&&e.firstElementChild}renderCore(){const e=this.props.parent.state,t=e.simState,n=3==t,r=2==t,s=e.debugging;if(!s)return(0,i.jsx)("div",{});const l=a.driver&&a.driver.state==pxsim.SimulatorState.Running,c=!this.props.parent.isBlocksActive();if(!(c||this.props.parent.isBlocksActive()||pxt.appTarget.appTheme.debugExtensionCode))return(0,i.jsx)("div",{});const u=l||r,d=u?"disabled":"",h=lf("Restart debugging"),p=n?lf("Pause execution"):lf("Continue execution"),f=lf("Step into"),g=lf("Step over"),m=lf("Step out"),b=this.props.parent.state.tracing,y=b?lf("Disable Slow-Mo"):lf("Slow-Mo");return s?c?(0,i.jsx)("div",Object.assign({className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},{children:s?(0,i.jsxs)("div",Object.assign({className:"ui compact borderless menu icon"},{children:[(0,i.jsx)(o.Item,{className:`dbg-btn dbg-pause-resume ${d} ${l?"pause":"play"}`,icon:""+(l?"pause blue":"play green"),title:p,onClick:this.dbgPauseResume},"dbgpauseresume"),(0,i.jsx)(o.Item,{className:`dbg-btn dbg-step-over ${d}`,icon:"xicon stepover "+(l?"disabled":"blue"),title:g,onClick:this.dbgStepOver},"dbgstepover"),(0,i.jsx)(o.Item,{className:`dbg-btn dbg-step-into ${d}`,icon:"xicon stepinto "+(l?"disabled":""),title:f,onClick:this.dbgStepInto},"dbgstepinto"),(0,i.jsx)(o.Item,{className:`dbg-btn dbg-step-out ${d}`,icon:"xicon stepout "+(l?"disabled":""),title:m,onClick:this.dbgStepOut},"dbgstepout"),(0,i.jsx)(o.Item,{className:"dbg-btn dbg-restart right",icon:"refresh green",title:h,onClick:this.restartSimulator},"dbgrestart"),(0,i.jsx)(o.Item,{className:"dbg-btn dbg-trace "+(b?"tracing":""),icon:"xicon turtle",title:y,onClick:this.toggleTrace},"dbgslowmo")]})):void 0})):(0,i.jsx)("div",Object.assign({className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},{children:(0,i.jsxs)("div",Object.assign({className:"ui compact borderless menu icon"},{children:[(0,i.jsx)(o.Item,{className:`dbg-btn dbg-step separator-after ${d}`,icon:"arrow right "+(u?"disabled":"blue"),title:f,onClick:this.dbgStepInto,text:"Step"},"dbgstep"),(0,i.jsx)(o.Item,{className:"dbg-btn dbg-pause-resume "+(l?"pause":"play"),icon:""+(l?"pause blue":"play green"),title:p,onClick:this.dbgPauseResume},"dbgpauseresume"),(0,i.jsx)(o.Item,{className:"dbg-btn dbg-restart",icon:"refresh green",title:h,onClick:this.restartSimulator},"dbgrestart"),(0,i.jsx)(o.Item,{className:"dbg-btn dbg-trace "+(b?"tracing":""),icon:"xicon turtle",title:y,onClick:this.toggleTrace},"dbgslowmo")]}))})):(0,i.jsx)("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")})}}n.DebuggerToolbar=l},{"./data":282,"./simulator":338,"./sui":346,"react-dom":491,"react/jsx-runtime":549}],287:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerToolbox=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./debuggerCallStack"),s=e("./debuggerVariables"),a=e("./debuggerToolbar");class l extends r.Component{constructor(e){super(e),this.state={sequence:0,currentFrame:0}}setBreakpoint(e,t){this.setState({lastBreakpoint:e,currentFrame:0,sequence:this.state.sequence+1,varFilters:t||this.state.varFilters})}render(){return(0,i.jsxs)("div",{children:[(0,i.jsx)(a.DebuggerToolbar,{parent:this.props.parent}),(0,i.jsx)(s.DebuggerVariables,{apis:this.props.apis,breakpoint:this.state.lastBreakpoint,filters:this.state.varFilters,activeFrame:this.state.currentFrame,sequence:this.state.sequence}),this.props.showCallStack&&(0,i.jsx)(o.DebuggerCallStack,{openLocation:this.props.openLocation,activeFrame:this.state.currentFrame,stackframes:this.state.lastBreakpoint?this.state.lastBreakpoint.stackframes:[]})]})}}n.DebuggerToolbox=l},{"./debuggerCallStack":284,"./debuggerToolbar":286,"./debuggerVariables":288,react:548,"react/jsx-runtime":549}],288:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebuggerVariables=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./simulator"),s=e("./debuggerTable");class a extends r.Component{constructor(e){super(e),this.handleComponentClick=(e,t)=>{if(this.state.frozen)return;const n=this.getVariableById(t.props.refID);n&&(this.toggle(n),null!==this.state.preview&&this.setState({preview:null}))},this.handleValueClick=(e,t)=>{if(this.state.frozen)return;const n=t.props.refID,i=e.target.getBoundingClientRect();this.setState({preview:{id:n,top:i.top,left:i.left}})},this.handlePreviewRef=e=>{if(e){const t=this.state.preview;e.focus(),e.addEventListener("blur",(()=>{var e;(null===(e=this.state.preview)||void 0===e?void 0:e.id)===t.id&&this.setState({preview:null})}));const n=window.getSelection();n.removeAllRanges();const i=document.createRange();i.selectNodeContents(e),n.addRange(i)}},this.state={globalFrame:{title:lf("Globals"),variables:[]},stackFrames:[],nextID:0,preview:null}}clear(){this.setState({globalFrame:{title:this.state.globalFrame.title,variables:[]},stackFrames:[],preview:null})}update(e=!1){this.setState({frozen:e,preview:e?null:this.state.preview})}componentDidUpdate(e){this.props.breakpoint?this.props.sequence!=this.state.renderedSequence&&this.updateVariables(this.props.breakpoint,this.props.filters):this.state.frozen||this.update(!0)}renderCore(){const{globalFrame:e,stackFrames:t,frozen:n,preview:r}=this.state,{activeFrame:o,breakpoint:a}=this.props,l=lf("Variables");let c,u=e.variables;t&&t.length&&void 0!==o&&(u=t[o].variables.concat(u)),n?c=lf("Code is running..."):u.length||(null==a?void 0:a.exceptionMessage)||(c=lf("No variables to show"));const d=c?[]:this.renderVars(u);(null==a?void 0:a.exceptionMessage)&&!n&&d.unshift((0,i.jsx)(s.DebuggerTableRow,{leftText:lf("Exception:"),leftClass:"exception",rightText:p(a.exceptionMessage),rightTitle:a.exceptionMessage},"exception-message"));const f=this.getVariableById(null==r?void 0:r.id),g=f&&lf("Current value for '{0}'",f.name);return(0,i.jsxs)("div",{children:[(0,i.jsx)(s.DebuggerTable,Object.assign({header:l,placeholderText:c},{children:d})),r&&(0,i.jsx)("div",Object.assign({id:"debugger-preview",role:"tooltip",className:"debugger-preview",ref:this.handlePreviewRef,tabIndex:0,"aria-label":g,style:{top:`${r.top}px`,left:`${r.left}px`}},{children:h(f.value)}))]})}renderVars(e,t=0,n=[]){var r;const o=null===(r=this.state.preview)||void 0===r?void 0:r.id;return e.forEach((e=>{const r=h(e.value),a=function(e){let t=e.value;if(null==t)return"undefined";let n=typeof t;switch(n){case"string":case"number":case"boolean":return n;case"object":return t.type?t.type:t.preview?t.preview:t.text?t.text:"object";default:return"unknown"}}(e);n.push((0,i.jsx)(s.DebuggerTableRow,{describedBy:e.id===o?"debugger-preview":void 0,refID:e.id,icon:e.value&&e.value.hasFields?e.children?"down triangle":"right triangle":void 0,leftText:e.name+":",leftTitle:e.name,leftClass:void 0!==e.prevValue?"changed":void 0,rightText:p(r),rightTitle:f(a)?r:void 0,rightClass:a,onClick:this.handleComponentClick,onValueClick:this.handleValueClick,depth:t},e.id)),e.children&&this.renderVars(e.children,t+1,n)})),n}updateVariables(e,t){const{globals:n,environmentGlobals:i,stackframes:r}=e;if(!n&&!i)return void this.update(!0);let o=0;const s=c(this.state.globalFrame,n);let a;if(t&&(s.variables=s.variables.filter((e=>-1!==t.indexOf(e.name)))),i&&(s.variables=s.variables.concat(l(i))),d(s.variables),r){const e=this.state.stackFrames;(a=r.map(((t,n)=>{const i=t.breakpointId+"_"+n;for(const n of e)if(n.key===i)return c(n,t.locals,u(t.arguments));return c({key:i,title:t.funcInfo.functionName,variables:[]},t.locals,u(t.arguments))}))).forEach((e=>d(e.variables)))}function u(e){return e?null!=e.thisParam?[{name:"this",value:e.thisParam},...e.params]:e.params:[]}function d(e){e.forEach((e=>{e.id=o++,e.children&&d(e.children)}))}this.setState({globalFrame:s,stackFrames:a||[],nextID:o,renderedSequence:this.props.sequence,frozen:!1})}getVariableById(e){if(null===e)return null;for(const t of this.getFullVariableList())if(t.id===e)return t;return null}getFullVariableList(){let e=[];return t(this.state.globalFrame.variables),this.state.stackFrames&&this.state.stackFrames.forEach((e=>t(e.variables))),e;function t(n){n.forEach((n=>{e.push(n),n.children&&t(n.children)}))}}toggle(e){if(e.children)delete e.children,this.setState({globalFrame:this.state.globalFrame});else{if(!e.value||!e.value.id)return;let t=this.props.apis,n=new RegExp("^((.+.)?"+e.value.type+")."),i=Object.keys(t).filter((e=>n.test(e))),r=[];i.forEach((e=>{let n=t[e];!e.endsWith("@set")&&n&&n.attributes.callInDebugger&&r.push(e)})),o.driver.variablesAsync(e.value.id,r).then((t=>{if(t&&t.variables){let n=this.state.nextID;e.children=Object.keys(t.variables).map((e=>({name:e,value:t.variables[e],id:n++}))),this.setState({globalFrame:this.state.globalFrame,nextID:n})}}))}}}function l(e){return Object.keys(e).map((t=>({name:u(t),value:e[t]})))}function c(e,t,n){let i=l(t);return n&&(i=n.concat(i)),Object.assign(Object.assign({},e),{variables:d(e.variables,i)})}function u(e){return e.replace(/___\d+$/,"")}function d(e,t){return t.map((t=>{const n=function(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t.name)return e[n]}(e,t);return n&&n.value&&!n.value.id&&n.value!==t.value?Object.assign(Object.assign({},t),{prevValue:n.value}):t}))}function h(e){let t="";switch(typeof e){case"undefined":t="undefined";break;case"number":case"boolean":t=e+"";break;case"string":t=JSON.stringify(e);break;case"object":if(null==e)t="null";else if(e.text)t=e.text;else{if(e.id&&e.preview)return e.preview;t=void 0!==e.id?"(object)":"(unknown)"}}return t}function p(e){let t=17,n=!1;return 0==e.indexOf('"')&&(t-=2,n=!0,e=e.substring(1,e.length-1)),e.length>t&&(e=e.substring(0,t)+"..."),n&&(e='"'+e+'"'),e}function f(e){switch(e){case"string":case"number":case"boolean":case"array":return!0;default:return!1}}n.DebuggerVariables=a},{"./data":282,"./debuggerTable":285,"./simulator":338,"react/jsx-runtime":549}],289:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.showTurnBackTimeDialogAsync=n.isDontShowDownloadDialogFlagSet=n.clearDontShowDownloadDialogFlag=n.renderIncompatibleHardwareDialog=n.renderBrowserDownloadInstructions=n.promptTranslateBlock=n.showResetDialogAsync=n.showReportAbuseAsync=n.showImportFileDialogAsync=n.showImportGithubDialogAsync=n.showCreateGithubRepoDialogAsync=n.showGithubTokenError=n.showImportUrlDialogAsync=n.showPRDialogAsync=n.ProgressBar=n.showPackageErrorDialogAsync=n.showAboutDialogAsync=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./sui"),s=e("./core"),a=e("./coretsx"),l=e("./cloudsync"),c=e("./workspace"),u=e("../../pxteditor");var d=pxt.Cloud,h=pxt.Util;const p=e("./timeMachine"),f=e("./util"),g=e("./cmds"),m=e("./data");let b=!1;function y(e,t){let n,i,r;return"object"==typeof t.codalTarget&&"string"==typeof t.codalTarget.url?(n=t.codalTarget.branch?pxt.BrowserUtils.joinURLs(t.codalTarget.url,"releases/tag",t.codalTarget.branch):t.codalTarget.url,i=t.codalTarget.branch||"master",r=t.codalTarget.name||t.serviceId):(n=`https://github.com/${t.githubCorePackage}/releases/tag/${t.gittag}`,i=t.gittag,r=t.serviceId),v(lf("{0} runtime",r),i,n)}function v(e,t,n){return(0,i.jsxs)("p",{children:[lf("{0} version:",e)," ",(0,i.jsx)("a",Object.assign({href:encodeURI(n),title:`${lf("{0} version: {1}",e,t)}`,"aria-label":`${lf("{0} version{1}",e,t)}`,target:"_blank",rel:"noopener noreferrer"},{children:t}))]})}n.showAboutDialogAsync=function(e){var t;pxt.appTarget.compileService;const n=pxt.appTarget.appTheme.githubUrl,r=pxt.appTarget.appTheme,o=pxt.appTarget.versions,a=[];r.experiments&&a.push({label:lf("Experiments"),className:"secondary",onclick:()=>{s.hideDialog(),pxt.tickEvent("about.experiments",void 0,{interactiveConsent:!0}),e.showExperimentsDialog()}});const l=((null===(t=pxt.appTarget.multiVariants)||void 0===t?void 0:t.map((e=>{const t=pxt.U.clone(pxt.appTarget.compileService),n=pxt.appTarget.variants[e];return(null==n?void 0:n.compileService)&&pxt.U.jsonCopyFrom(t,n.compileService),{variantName:e,compileService:t}})))||[{variantName:"",compileService:pxt.appTarget.compileService}]).filter((e=>e.compileService&&e.compileService.githubCorePackage&&e.compileService.gittag&&e.compileService.serviceId));pxt.targetConfigAsync().then((e=>{var t;const c=pxt.BrowserUtils.isPxtElectron(),u=null===(t=null==e?void 0:e.electronManifest)||void 0===t?void 0:t.latest;return s.confirmAsync({header:lf("About"),hasCloseIcon:!0,agreeLbl:lf("Ok"),agreeClass:"positive",buttons:a,jsx:(0,i.jsxs)("div",{children:[c?pxt.Cloud.isOnline()&&u?pxt.semver.strcmp(pxt.appTarget.versions.target,u)<0?(0,i.jsx)("a",Object.assign({target:"_blank",rel:"noopener noreferrer",href:"/offline-app"},{children:lf("An update {0} for {1} is available",u,pxt.appTarget.title)})):(0,i.jsx)("p",{children:lf("{0} is up to date",pxt.appTarget.title)}):(0,i.jsx)("p",{children:lf("Please connect to internet to check for updates")}):void 0,n&&o&&v(pxt.appTarget.name,o.target,`${n}/releases/tag/v${o.target}`),o&&v("Microsoft MakeCode",o.pxt,`https://github.com/Microsoft/pxt/releases/tag/v${o.pxt}`),(null==l?void 0:l.length)?l.map((e=>(0,i.jsx)("div",{children:y(e.variantName,e.compileService)},e.variantName))):void 0,(0,i.jsx)("p",{children:(0,i.jsx)("br",{})}),(0,i.jsxs)("p",{children:[r.termsOfUseUrl?(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:r.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})):void 0," ",r.privacyUrl?(0,i.jsx)("a",Object.assign({target:"_blank",className:"item",href:r.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})):void 0]}),r.copyrightText?(0,i.jsxs)("p",{children:[" ",r.copyrightText," "]}):void 0]})})}))},n.showPackageErrorDialogAsync=function(e,t,n){let r=!1;const o=new h.CancellationToken;return pxt.tickEvent("update.extensionErrorsShown"),s.dialogAsync({header:lf("Extension Errors"),hasCloseIcon:!0,jsx:(0,i.jsx)("div",Object.assign({className:"wizard-wrapper"},{children:(0,i.jsx)(_,{openLegacyEditor:n,affectedPackages:e,updatePackages:t,onProjectOpen:()=>r=!0,token:o})}))}).then((()=>r?Promise.resolve():(s.showLoading("package-update-cancel",lf("Stopping update...")),o.cancelAsync()))).then((()=>(s.hideLoading("package-update-cancel"),r)))};class _ extends r.Component{constructor(e){super(e),this.state={updating:!1,showProgressBar:!1,updateComplete:!1,packagesUpdated:0},this.startUpdate=this.startUpdate.bind(this),this.openProject=this.openProject.bind(this),this.openLegacyEditor=this.openLegacyEditor.bind(this)}startUpdate(){if(this.state.updating)return;pxt.tickEvent("update.startExtensionUpdate");const e=Date.now();this.setState({updating:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.state.updating&&this.props.affectedPackages.length>1&&this.setState({showProgressBar:!0})}),3e3);const t=this.props.affectedPackages;this.props.token.onProgress((e=>{this.setState({packagesUpdated:e})})),this.props.updatePackages(t,this.props.token).then((t=>{this.props.token.isCancelled()||(pxt.tickEvent("update.endExtensionUpdate",{success:""+t,duration:Date.now()-e}),t?(this.setState({updating:!1,updateComplete:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.openProject(!0)}),1500)):this.setState({updateError:!0,updating:!1}))}))}openProject(e=!1){e||pxt.tickEvent("update.ignoredExtensionErrors"),this.props.onProjectOpen(),a.hideDialog()}openLegacyEditor(){this.props.onProjectOpen(),this.props.openLegacyEditor()}buildActionList(){const e=[];return this.state.updateError||e.push({text:lf("Try to fix"),title:lf("Update all extensions in the project to their latest versions"),callback:this.startUpdate}),e.push({text:lf("Ignore errors and open"),title:lf("Ignore errors and open"),callback:this.openProject}),this.props.openLegacyEditor&&e.push({text:lf("Go to the old editor"),title:lf("Open this project in the editor where it was created"),callback:this.openLegacyEditor}),e}render(){const{affectedPackages:e}=this.props,{updating:t,updateComplete:n,packagesUpdated:r,updateError:o,showProgressBar:s}=this.state;if(t){const t=r===e.length?lf("Finishing up..."):lf("Updating extension {0} of {1}...",r+1,e.length);return(0,i.jsx)("div",{children:s?(0,i.jsx)(E,{percentage:r/e.length*100,label:t}):(0,i.jsx)("div",Object.assign({className:"ui centered inline inverted text loader"},{children:t}))})}if(n)return(0,i.jsx)("div",{children:(0,i.jsxs)("h2",Object.assign({className:"ui center aligned icon header"},{children:[(0,i.jsx)("i",{className:"green check circle outline icon"}),lf("Update complete")]}))});const a=o?lf("Looks like updating didn't fix the issue. How would you like to proceed?"):lf("Looks like there are some errors in the extensions added to this project. How would you like to proceed?");return(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:a}),(0,i.jsx)(T,{actions:this.buildActionList()})]})}}class E extends r.Component{render(){let{percentage:e,label:t,cornerRadius:n}=this.props;return n=null==n?3:Math.max(n,0),e=Math.max(Math.min(e,100),2),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",Object.assign({className:"progress-bar-container"},{children:(0,i.jsxs)("svg",Object.assign({className:"progress-bar",width:"100%",height:"100%"},{children:[(0,i.jsx)("rect",{className:"progress-bar-bg",width:"100%",height:"100%",rx:n,ry:n}),(0,i.jsx)("rect",{className:"progress-bar-content",width:e.toString()+"%",height:"100%",rx:n,ry:n})]}))})),t?(0,i.jsx)("p",Object.assign({className:"progress-bar-label"},{children:t})):void 0]})}}n.ProgressBar=E;class T extends o.StatelessUIElement{render(){return(0,i.jsx)("div",Object.assign({className:"ui relaxed list",role:"menu"},{children:this.props.actions.map((({text:e,title:t,callback:n},r)=>(0,i.jsxs)("div",Object.assign({className:"item wizard-action","aria-label":t,title:t,onClick:n,role:"menuitem"},{children:[(0,i.jsx)("span",Object.assign({className:"left floated"},{children:(0,i.jsx)("i",{className:"medium arrow right icon"})})),(0,i.jsx)(o.Link,{children:e})]}),r)))}))}}function x(e){return 401==e.statusCode?(s.errorNotification(lf("GitHub didn't accept token")),!0):404==e.statusCode&&(s.errorNotification(lf("Token has neither '{0}' nor '{1}' scope","repo","public_repo")),!0)}n.showPRDialogAsync=function e(t,n){return s.confirmAsync({header:lf("Commit conflict in {0}",t),agreeLbl:lf("Resolve conflict"),disagreeLbl:lf("I'm done!"),body:lf("The latest online version of {0} contains edits conflicting with yours. We have created a pull request (PR) that you can use to resolve the conflicts. Once you're done, sync to get all merged changes. In the meantime we have taken you to the latest online version of {0}.",t)}).then((i=>i?(pxt.tickEvent("app.commit.pr"),window.open(n,"_blank"),e(t,n)):Promise.resolve()))},n.showImportUrlDialogAsync=function(){let e;const t=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";return s.confirmAsync({header:lf("Open project URL"),hasCloseIcon:!0,onLoaded:t=>{(e=t.querySelector("input")).onkeydown=e=>{if("Enter"===e.key){const e=t.querySelector(".button.approve");null==e||e.click()}}},jsx:(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui icon violet message"},{children:[(0,i.jsx)("i",{className:"user icon","aria-hidden":!0}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("h3",Object.assign({className:"header"},{children:lf("User-provided content")})),(0,i.jsxs)("p",{children:[lf("The content below is provided by a user, and is not endorsed by Microsoft."),(0,i.jsx)("br",{}),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")]})]}))]})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"selectUrlToOpenLabel"},{children:lf("Copy the URL of the project.")})),(0,i.jsx)("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:lf("{0} or {1}...",t,"https://github.com/..."),className:"ui blue fluid"})]}))]}))}).then((t=>{if(t){pxt.tickEvent("app.open.url");const t=e.value;let n=pxt.github.normalizeRepoId(t);return n||(n=pxt.Cloud.parseScriptId(t)),n?Promise.resolve(n):Promise.reject(new Error(lf("Sorry, the project url looks invalid.")))}return Promise.resolve(void 0)}))},n.showGithubTokenError=x,n.showCreateGithubRepoDialogAsync=function(e){pxt.tickEvent("github.create.dialog"),e&&(e=(e=e.toLocaleLowerCase().replace(/\s+/g,"-")).replace(/[^\w\-]/g,""));let t=e||"",n="",r=!0;function l(){return t=="pxt-"+lf("Untitled").toLocaleLowerCase()||"pxt-untitled"==t?lf("Please pick a different name."):/^[\w\-]{1,64}$/.test(t)?void 0:lf("Repository names must be less than 64 characters and cannot include spaces or special characters.")}function c(e){e=e.trim(),t!=e&&(t=e,a.forceUpdate())}function u(e){n!=e&&(n=e,a.forceUpdate())}function d(e){const t=0==e.currentTarget.selectedIndex;r!=t&&(r=t,a.forceUpdate())}return s.confirmAsync({hasCloseIcon:!0,header:lf("Create GitHub repository"),jsxd:()=>{const e=l();return(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsxs)("p",{children:[lf("Host your code on GitHub and work together with friends."),o.helpIconLink("/github",lf("Learn more about GitHub"))]}),(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsx)(o.Input,{type:"url",autoFocus:!0,value:t,onChange:c,label:lf("Repository name"),id:"githubRepoNameInput",placeholder:"pxt-my-gadget...",class:"fluid",error:e})})),(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsx)(o.Input,{type:"text",value:n,onChange:u,label:lf("Repository description"),id:"githubRepoDescriptionInput",placeholder:lf("MakeCode extension for my gadget"),class:"fluid"})})),(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsxs)("select",Object.assign({className:"ui dropdown",onChange:d,"aria-label":lf("Repository visibility setting")},{children:[(0,i.jsx)("option",Object.assign({"aria-selected":r,value:"true"},{children:lf("Public repository, anyone can look at your code.")})),(0,i.jsx)("option",Object.assign({"aria-selected":!r,value:"false"},{children:lf("Private repository, your code is only visible to you.")}))]}))}))]}))}}).then((e=>{if(e){if(!l())return n=n||lf("A MakeCode project"),s.showLoading("creategithub",lf("creating {0} repository...",t)),pxt.github.createRepoAsync(t,n.trim(),!r).finally((()=>s.hideLoading("creategithub"))).then((e=>(pxt.tickEvent("github.create.ok"),pxt.github.normalizeRepoId("https://github.com/"+e.fullName,"master"))),(e=>(x(e)||(422==e.statusCode?s.errorNotification(lf("Repository '{0}' already exists.",t)):s.errorNotification(e.message),pxt.tickEvent("github.create.error",{statusCode:e.statusCode})),"")));s.errorNotification(lf("Invalid repository name.")),pxt.tickEvent("github.create.invalidname")}else pxt.tickEvent("github.create.cancel");return""}))},n.showImportGithubDialogAsync=function(){let e="",t=()=>{e="NEW",s.hideDialog()};return s.showLoading("githublist",lf("searching GitHub repositories...")),l.githubProvider(!0).routedLoginAsync("import").then((e=>e&&e.accessToken&&pxt.github.listUserReposAsync())).finally((()=>s.hideLoading("githublist"))).then((n=>{if(!n)return Promise.resolve(-1);const r=n.map((t=>({name:t.fullName,description:t.description,updatedAt:t.updatedAt,onClick:()=>{e=pxt.github.normalizeRepoId("https://github.com/"+t.fullName,t.defaultBranch),s.hideDialog()}})));return s.confirmAsync({header:lf("Clone or create your own GitHub repo"),hideAgree:!0,hasCloseIcon:!0,jsx:(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui relaxed divided list"},{children:[(0,i.jsxs)("div",Object.assign({className:"item"},{children:[(0,i.jsx)("i",{className:"large plus circle middle aligned icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("a",Object.assign({onClick:t,role:"button",className:"header",tabIndex:0,onKeyDown:f.fireClickOnEnter,title:lf("Create new GitHub repository")},{children:(0,i.jsx)("b",{children:lf("Create new...")})})),(0,i.jsx)("div",Object.assign({className:"description"},{children:lf("Create a new GitHub repo in your account.")}))]}))]}),"create new"),r.map((e=>(0,i.jsxs)("div",Object.assign({className:"item"},{children:[(0,i.jsx)("i",{className:"large github middle aligned icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("a",Object.assign({onClick:e.onClick,role:"button",className:"header",tabIndex:0,onKeyDown:f.fireClickOnEnter},{children:e.name})),(0,i.jsxs)("div",Object.assign({className:"description"},{children:[pxt.Util.timeSince(e.updatedAt),". ",e.description]}))]}))]}),e.name)))]})),(0,i.jsxs)("div",Object.assign({className:"ui icon green message"},{children:[(0,i.jsx)("i",{className:"info circle icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("h3",Object.assign({className:"header"},{children:lf("Not finding what you're looking for?")})),(0,i.jsx)("p",{children:lf("Use the 'Import URL' option in the previous dialog to import repo by exact URL.")})]}))]}))]}))})})).then((()=>e))},n.showImportFileDialogAsync=function(e){let t,n=[pxt.appTarget.compile.saveAsPNG?".png":".mkcd"];return pxt.appTarget.compile.hasHex&&n.push(".hex"),pxt.appTarget.compile.useUF2&&n.push(".uf2"),s.confirmAsync({header:lf("Open {0} file",n.join(lf(" or "))),hasCloseIcon:!0,onLoaded:e=>{t=e.querySelectorAll("input")[0]},jsx:(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"selectFileToOpenLabel"},{children:lf("Select a {0} file to open.",n.join(lf(" or ")))})),(0,i.jsx)("input",{type:"file",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectFileToOpenLabel",className:"ui blue fluid"})]})),(0,i.jsx)("div",Object.assign({className:"ui secondary segment"},{children:lf("You can import files by dragging and dropping them anywhere in the editor!")}))]}))}).then((e=>{if(e)return t.files[0]}))},n.showReportAbuseAsync=function(e){if(pxt.github.parseRepoId(e))return pxt.tickEvent("reportabuse.github"),void s.confirmAsync({header:lf("Is this content inappropriate?"),hasCloseIcon:!0,agreeLbl:lf("Report"),disagreeLbl:lf("Cancel"),jsx:(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsx)("p",{children:lf("This content was written by an independent user and may be inappropriate or abusive. Help us block or filter that content by reporting it to Github.")})})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"githubContentUrlLabel"},{children:lf("Content URL")})),(0,i.jsx)(o.Input,{type:"url","aria-labelledby":"githubContentUrlLabel",readOnly:!0,lines:1,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,value:e})]}))]}))}).then((e=>{e&&window.open("https://github.com/contact/report-content","_blank")}));let t,n;const r=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";s.confirmAsync({header:lf("Report Abuse"),hasCloseIcon:!0,onLoaded:i=>{t=i.querySelectorAll("input")[0],n=i.querySelectorAll("textarea")[0],e&&(t.value=r+e)},agreeLbl:lf("Submit"),jsx:(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"abuseUrlLabel"},{children:lf("What is the URL of the offensive project?")})),(0,i.jsx)("input",{type:"url","aria-labelledby":"abuseUrlLabel",tabIndex:0,autoFocus:!0,placeholder:"Enter project URL here..."})]})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"abuseDescriptionLabel"},{children:lf("Why do you find it offensive?")})),(0,i.jsx)("textarea",{"aria-labelledby":"abuseDescriptionLabel"})]}))]}))}).then((e=>{if(e){pxt.tickEvent("app.reportabuse.send");const e=pxt.Cloud.parseScriptId(t.value);e?(s.infoNotification(lf("Sending abuse report...")),d.privatePostAsync(`${e}/abusereports`,{text:n.value}).then((e=>{s.infoNotification(lf("Report sent. Thank you!"))})).catch((e=>{404==e.statusCode?s.warningNotification(lf("Oops, we could not find this script.")):s.handleNetworkError(e)}))):s.errorNotification(lf("Sorry, the project url looks invalid."))}}))},n.showResetDialogAsync=function(){return s.confirmAsync({header:lf("Reset"),body:lf("You are about to clear all projects. Are you sure? This operation cannot be undone."),agreeLbl:lf("Reset"),agreeClass:"red",agreeIcon:"sign out",disagreeLbl:lf("Cancel")})},n.promptTranslateBlock=function(e,t){s.confirmAsync({header:lf("Translate this block"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/translate",jsx:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[lf("Update the block translation below."),lf("Do not translate variable names (%name, $name)."),lf("Once validated in Crowdin, translations may take 24h to be active.")]}),t.map((e=>(0,i.jsx)("div",Object.assign({className:"ui basic segment"},{children:e}),`ictr${e}`)))]})})},n.renderBrowserDownloadInstructions=function(e,t){var n,r,a,l;const c=pxt.appTarget.appTheme.boardName||lf("device"),u=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",d=(null===(n=pxt.appTarget.compile)||void 0===n?void 0:n.useUF2)?".uf2":".hex",h=pxt.usb.isEnabled&&(null===(a=null===(r=pxt.appTarget)||void 0===r?void 0:r.compile)||void 0===a?void 0:a.webUSB),p=null===(l=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===l?void 0:l.dragFileImage,f=p?"two":"one";return(0,i.jsx)("div",Object.assign({className:"ui grid stackable upload"},{children:(0,i.jsxs)("div",Object.assign({className:"column sixteen wide instructions"},{children:[(0,i.jsx)("div",Object.assign({className:"ui grid"},{children:(0,i.jsx)("div",Object.assign({className:"row"},{children:(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsxs)("div",Object.assign({className:`ui ${f} column grid padded`},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("div",Object.assign({className:"description"},{children:lf("Your code is being downloaded as a {1} file. You can drag this file to your {0} using your computer's file explorer.",c,d)})),h&&(0,i.jsxs)("div",Object.assign({className:"download-callout"},{children:[(0,i.jsx)("label",Object.assign({className:"ui purple ribbon label"},{children:lf("Want faster downloads?")})),(0,i.jsxs)("div",Object.assign({className:"ui two column grid content"},{children:[(0,i.jsxs)("div",Object.assign({className:"icon-align three wide column"},{children:[(0,i.jsx)("div",{}),(0,i.jsx)("i",{className:"icon big usb"}),(0,i.jsx)("div",{})]})),(0,i.jsxs)("div",Object.assign({className:"thirteen wide column"},{children:[lf("Download your code faster by pairing with WebUSB!"),(0,i.jsx)("a",Object.assign({className:"ui button purple",onClick:async()=>{s.hideDialog();const e=await(0,g.pairAsync)(!0);t&&e&&await t()}},{children:lf("Pair Now")}))]}))]}))]}))]}))}))})),p&&(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"image"},{children:(0,i.jsx)("img",{alt:lf("Comic moving {1} file to {0}",u,d),className:"ui medium rounded image",src:p})}))}))}))]}))}))}))})),(0,i.jsx)("div",{children:!e&&(0,i.jsx)(o.Checkbox,{inputLabel:lf("Don't show this again"),onChange:e=>{const t=""+e;pxt.tickEvent("downloaddialog.dontshowagain",{checked:t}),b=e}})})]}))}))},n.renderIncompatibleHardwareDialog=function(){var e,t;const n=pxt.appTarget.appTheme.boardName||lf("device"),r=lf("Oops! Looks like your project has code that won't run on the hardware you have connected. Would you like to download anyway?"),o=lf("Learn more about what's supported by your hardware"),s=null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.incompatibleHardwareHelpURL,a=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareImage,l=a?"two":"one";return(0,i.jsxs)("div",Object.assign({className:`ui ${l} column grid padded download-dialog`},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[r,(0,i.jsx)("br",{}),s&&(0,i.jsx)("a",Object.assign({target:"_blank",rel:"noopener noreferrer",href:s},{children:o}))]}))}))}))})),a&&(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,i.jsx)("img",{alt:lf("Image of {0}",n),className:"ui medium rounded image",src:a})}))}))}))]}))},n.clearDontShowDownloadDialogFlag=function(){b=!1},n.isDontShowDownloadDialogFlagSet=function(){return b},n.showTurnBackTimeDialogAsync=async function(e,t){const n=await c.getTextAsync(e.id,!0);let r;(null==n?void 0:n[pxt.HISTORY_FILE])&&(r=u.history.parseHistoryFile(n[pxt.HISTORY_FILE])),await s.dialogAsync({header:lf("Turn back time"),className:"time-machine-dialog",size:"fullscreen",hasCloseIcon:!0,jsx:(0,i.jsx)(p.TimeMachine,{history:r,text:n,onProjectLoad:async(n,i)=>{s.hideDialog(),e.targetVersion=i,await c.saveSnapshotAsync(e.id),await c.saveAsync(e,n),t()},onProjectCopy:async(t,n,i)=>{s.hideDialog();let o=r;null!=i&&(o={entries:r.entries.slice(0,r.entries.findIndex((e=>e.timestamp===i))),snapshots:r.snapshots.filter((e=>e.timestamp<=i)),shares:r.shares.filter((e=>e.timestamp<=i))}),t[pxt.HISTORY_FILE]&&(t[pxt.HISTORY_FILE]=JSON.stringify(o));const a=new Date(i),l=a.toLocaleDateString(pxt.U.userLanguage(),{year:"numeric",month:"numeric",day:"numeric"}),u=a.toLocaleTimeString(pxt.U.userLanguage(),{timeStyle:"short"}),d=Object.assign(Object.assign({},e),{targetVersion:n});await c.duplicateAsync(d,`${d.name} ${l} ${u}`,t),(0,m.invalidate)("headers:"),s.infoNotification(lf("Project copy saved to My Projects"))}})})}},{"../../pxteditor":134,"./cloudsync":201,"./cmds":202,"./core":279,"./coretsx":280,"./data":282,"./sui":346,"./timeMachine":347,"./util":352,"./workspace":354,react:548,"react/jsx-runtime":549}],290:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setupDragAndDrop=void 0,n.setupDragAndDrop=function(e,t,n,i){e.addEventListener("paste",(function(e){if(e.clipboardData){let i=pxt.Util.toArray(e.clipboardData.files).filter(t);if(i.length>0)e.stopPropagation(),e.preventDefault(),n(i);else if(e.clipboardData.items&&e.clipboardData.items.length>0){let t=e.clipboardData.items[0].getAsFile();t&&(e.stopPropagation(),e.preventDefault(),n([t]))}}})),e.addEventListener("dragover",(function(e){let t=e.dataTransfer.types,n=!1;for(let e=0;e<t.length;++e)"Files"!=t[e]&&"text/uri-list"!=t[e]||(n=!0);return!n||(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!1)}),!1),e.addEventListener("drop",(function(e){let t=pxt.Util.toArray(e.dataTransfer.files);if(t.length>0)e.stopPropagation(),e.preventDefault(),n(t);else if(e.dataTransfer.types.indexOf("text/uri-list")>-1){const t=e.dataTransfer.getData("text/uri-list");t&&(e.stopPropagation(),e.preventDefault(),i(t))}return!1}),!1),e.addEventListener("dragend",(function(e){return!1}),!1)}},{}],291:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.SmallEditorToolbar=n.ZoomSlider=n.EditorToolbar=void 0;const r=e("react/jsx-runtime"),o=e("react"),s=e("./data"),a=e("./sui"),l=e("./githubbutton"),c=e("./cmds"),u=e("./identity"),d=e("./webusb"),h=e("./core");var p,f;(f=p||(p={}))[f.Computer=0]="Computer",f[f.Tablet=1]="Tablet",f[f.Mobile=2]="Mobile";class g extends s.Component{constructor(e){super(e),this.onHwItemClick=()=>{pxt.hasHwVariants()?this.props.parent.showChooseHwDialog(!0):this.props.parent.showBoardDialogAsync(void 0,!0)},this.onDownloadButtonClick=async()=>{pxt.tickEvent("editortools.downloadbutton",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),!this.shouldShowPairingDialogOnDownload()||pxt.packetio.isConnected()||pxt.packetio.isConnecting()||await c.pairAsync(!0),this.compile()},this.onHwDownloadClick=()=>{pxt.tickEvent("editortools.download",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),pxt.tickEvent("editortools.downloadasfile",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile(!0)},this.onPairClick=()=>{pxt.tickEvent("editortools.pair",void 0,{interactiveConsent:!0}),this.props.parent.pairAsync()},this.onCannotPairClick=async()=>{let e;switch(pxt.tickEvent("editortools.pairunsupported",void 0,{interactiveConsent:!0}),await pxt.usb.getReasonUnavailable()){case"security":e=lf("WebUSB is disabled by browser policies. Check with your admin for help.");break;case"oldwindows":e=lf("WebUSB is not available on Windows devices with versions below 8.1.");break;case"electron":e=lf("WebUSB is not supported in electron.");break;case"notimpl":e=lf("WebUSB is not supported by this browser; please check for updates.")}(0,h.dialogAsync)({header:lf("Cannot Connect Device"),body:e,hasCloseIcon:!0,buttons:[{label:lf("Okay"),className:"primary",onclick:h.hideDialog}]})},this.onDisconnectClick=()=>{c.showDisconnectAsync()},this.onHelpClick=()=>{var e;pxt.tickEvent("editortools.downloadhelp"),window.open(null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.downloadMenuHelpURL)},this.shouldShowPairingDialogOnDownload=()=>{var e,t;return pxt.appTarget.appTheme.preferWebUSBDownload&&(null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.compile)||void 0===t?void 0:t.webUSB)&&pxt.usb.isEnabled&&!(0,d.userPrefersDownloadFlagSet)()},this.saveProjectName=this.saveProjectName.bind(this),this.compile=this.compile.bind(this),this.saveFile=this.saveFile.bind(this),this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleDebugging=this.toggleDebugging.bind(this),this.toggleCollapsed=this.toggleCollapsed.bind(this),this.cloudButtonClick=this.cloudButtonClick.bind(this)}saveProjectName(e,t){pxt.tickEvent("editortools.projectrename",{view:t},{interactiveConsent:!0}),this.props.parent.updateHeaderName(e)}compile(e){this.setState({compileState:"compiling"}),pxt.tickEvent("editortools.download",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile()}saveFile(e){pxt.tickEvent("editortools.save",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.saveAndCompile()}undo(e){pxt.tickEvent("editortools.undo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.undo()}redo(e){pxt.tickEvent("editortools.redo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.redo()}zoomIn(e){pxt.tickEvent("editortools.zoomIn",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate()}zoomOut(e){pxt.tickEvent("editortools.zoomOut",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate()}startStopSimulator(e){pxt.tickEvent("editortools.startStopSimulator",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}toggleDebugging(e){pxt.tickEvent("editortools.debug",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleCollapsed(){pxt.tickEvent("editortools.portraitToggleCollapse",{collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}cloudButtonClick(e){pxt.tickEvent("editortools.cloud",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0})}componentDidUpdate(){var e,t;this.props.parent.state.compiling?(null===(e=this.state)||void 0===e?void 0:e.compileState)||this.setState({compileState:"compiling"}):"compiling"===(null===(t=this.state)||void 0===t?void 0:t.compileState)&&(this.props.parent.state.cancelledDownload?this.setState({compileState:null}):(this.setState({compileState:"success"}),this.compileTimeout&&clearTimeout(this.compileTimeout),this.compileTimeout=setTimeout((()=>{var e;"success"===(null===(e=this.state)||void 0===e?void 0:e.compileState)&&this.setState({compileState:null})}),2e3)))}componentWillUnmount(){this.compileTimeout&&clearTimeout(this.compileTimeout)}getCollapsedState(){return""+this.props.parent.state.collapseEditorTools}getHeadlessState(){return pxt.appTarget.simulator.headless?"true":"false"}getSaveInput(e,t,n,i){let o="";this.props.parent.state.isSaving?o="loading disabled":this.props.parent.state.compiling&&(o="disabled");let s=[];return s.push((0,r.jsx)("label",Object.assign({htmlFor:t,className:"accessible-hidden phone hide"},{children:lf("Type a name for your project")}),"label")),s.push((0,r.jsx)(y,{id:t,view:this.getViewString(0),type:"text","aria-labelledby":t,placeholder:lf("Pick a name..."),value:n||"",onChangeValue:this.saveProjectName,disabled:i,readOnly:i},"input")),e&&s.push((0,r.jsx)(b,{role:"button",icon:"save",className:`right attached editortools-btn save-editortools-btn ${o}`,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:this.getViewString(0)},"save0")),s}getZoomControl(e){return[(0,r.jsx)(b,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.getViewString(e)},"minus"),(0,r.jsx)(b,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.getViewString(e)},"plus")]}getUndoRedo(e){const t=this.props.parent.editor.hasUndo(),n=this.props.parent.editor.hasRedo();return[(0,r.jsx)(b,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(t?"":"disabled"),title:lf("Undo"),ariaLabel:lf("{0}, {1}",lf("Undo"),t?"":lf("Disabled")),onButtonClick:this.undo,view:this.getViewString(e)},"undo"),(0,r.jsx)(b,{icon:"xicon redo",className:"editortools-btn redo-editortools-btn "+(n?"":"disabled"),title:lf("Redo"),ariaLabel:lf("{0}, {1}",lf("Redo"),n?"":lf("Disabled")),onButtonClick:this.redo,view:this.getViewString(e)},"redo")]}getViewString(e){return e.toString().toLowerCase()}getCompileButton(e){var t,n,i,o,s;const l=pxt.appTarget.appTheme,{compiling:c,isSaving:u}=this.props.parent.state,{compileState:d}=this.state,h=lf("Download your code to the {0}",l.boardName);let p;p="success"===d?l.useUploadMessage?lf("Uploaded!"):lf("Downloaded!"):l.useUploadMessage?lf("Upload"):lf("Download");const f=pxt.appTarget.simulator&&!!pxt.appTarget.simulator.dynamicBoardDefinition,g=null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===n?void 0:n.webUSB,m=pxt.usb.isEnabled&&g,y=g&&!pxt.usb.isEnabled&&!pxt.BrowserUtils.isPxtElectron()&&(pxt.BrowserUtils.isChromiumEdge()||pxt.BrowserUtils.isChrome()),v=!!this.getData("packetio:connected"),_=!!this.getData("packetio:connecting"),E=this.getData("packetio:icon"),T=0===e&&this.shouldShowPairingDialogOnDownload(),x=l.downloadIcon||"xicon file-download",w=v&&(null===(i=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===i?void 0:i.deviceSuccessIcon)||"xicon file-download-check",k=!!_&&"ping "+E||"success"===d&&w||!!v&&E||!T&&x;let S="left attached ",C="",A=!1;switch(u?S+="disabled ":c&&(S+="loading disabled "),v?S+="connected ":_&&(S+="connecting "),e){case 2:S+="download-button-full ",A=!0;break;case 1:S+="download-button-full  ",C="",A=!0;break;case 0:default:S+="large fluid ",C="large"}let I=[];I.push((0,r.jsx)(b,{icon:k,className:`primary download-button ${S}`,text:2!=e?p:void 0,title:h,onButtonClick:this.onDownloadButtonClick,view:"computer"},"downloadbutton"));const O=pxt.hwName||pxt.appTarget.appTheme.boardNickname||lf("device"),N=pxt.hwName||v&&lf("Connected to {0}",O)||_&&lf("Connecting...")||(f?lf("Click to select hardware"):m?lf("Click for one-click downloads."):void 0),R=2==e?lf("Hardware"):lf("Choose Hardware"),D=2==e?pxt.hwName||lf("Download"):lf("Download as File"),L=null===(o=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===o?void 0:o.downloadMenuHelpURL,M=(null===(s=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===s?void 0:s.deviceIcon)||"usb";return I.push((0,r.jsxs)(a.DropdownMenu,Object.assign({role:"menuitem",icon:`ellipsis horizontal ${C}`,title:lf("Download options"),className:`${C} right attached editortools-btn hw-button button`,dataTooltip:N,displayAbove:!0,displayRight:A},{children:[m&&!v&&(0,r.jsx)(a.Item,{role:"menuitem",icon:M,text:lf("Connect Device"),tabIndex:-1,onClick:this.onPairClick}),y&&(0,r.jsx)(a.Item,{role:"menuitem",icon:M,text:lf("Connect Device"),tabIndex:-1,onClick:this.onCannotPairClick}),m&&(_||v)&&(0,r.jsx)(a.Item,{role:"menuitem",icon:M,text:lf("Disconnect"),tabIndex:-1,onClick:this.onDisconnectClick}),f&&(0,r.jsx)(a.Item,{role:"menuitem",icon:"microchip",text:R,tabIndex:-1,onClick:this.onHwItemClick}),(0,r.jsx)(a.Item,{role:"menuitem",icon:"xicon file-download",text:D,tabIndex:-1,onClick:this.onHwDownloadClick}),L&&(0,r.jsx)(a.Item,{role:"menuitem",icon:"help circle",text:lf("Help"),tabIndex:-1,onClick:this.onHelpClick})]}),"downloadmenu")),I}renderCore(){var e;const{tutorialOptions:t,projectName:n,compiling:i,isSaving:o,simState:s,debugging:a,editorState:c}=this.props.parent.state,d=null!==(e=this.getData(`header:${this.props.parent.state.header.id}`))&&void 0!==e?e:this.props.parent.state.header,h=pxt.appTarget.appTheme,p=pxt.shell.isControllerMode(),f=pxt.shell.isReadOnly(),g=!!t&&t.tutorial,m=pxt.appTarget.simulator.headless,y=c&&!1===c.hasCategories,v=h.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),_=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),E=!(!d||!pxt.github.parseRepoId(d.githubId)),T=!(f||p||h.saveInMenu||g||a||v||_||E),x=!(g||f||p||h.hideProjectRename||a),w=pxt.appTarget.compile,k=w.hasHex||w.saveAsPNG||w.useUF2,S=lf("Download your code to the {0}",h.boardName),C=!!i,A=3==s,I=2==s,O=!f&&!a&&!y,N=!y,R=!!pxt.appTarget.cloud&&!!pxt.appTarget.cloud.githubPackages&&h.githubEditor&&!pxt.BrowserUtils.isPxtElectron()&&!f&&!p&&!a&&!g,D=pxt.appTarget.appTheme.downloadIcon||"download",L=(()=>{switch(s){case 0:return lf("Start");case 1:case 2:return lf("Starting");default:return lf("Stop")}})();let M="",P="";return o?(M="disabled",P="loading disabled"):C&&(M="loading disabled",P="disabled"),(0,r.jsxs)("div",Object.assign({id:"editortools",className:"ui",role:"region","aria-label":lf("Editor toolbar")},{children:[(0,r.jsxs)("div",Object.assign({id:"downloadArea",role:"menubar",className:"ui column items"},{children:[m&&(0,r.jsx)("div",Object.assign({className:"ui item"},{children:(0,r.jsx)("div",Object.assign({className:"ui icon large buttons"},{children:k&&(0,r.jsx)(b,{icon:D,className:`primary large download-button mobile tablet hide ${M}`,title:S,onButtonClick:this.compile,view:"computer"})}))})),!m&&(0,r.jsx)("div",Object.assign({className:"ui item portrait hide"},{children:k&&this.getCompileButton(0)})),!m&&(0,r.jsx)("div",Object.assign({className:"ui portrait only"},{children:k&&this.getCompileButton(2)}))]})),(x||R||u.CloudSaveStatus.wouldRender(d.id))&&(0,r.jsx)("div",Object.assign({id:"projectNameArea",className:"ui column items"},{children:(0,r.jsxs)("div",Object.assign({className:`ui right ${T?"labeled":""} input projectname-input projectname-computer`},{children:[x&&this.getSaveInput(T,"fileNameInput2",n,!1),R&&(0,r.jsx)(l.GithubButton,{parent:this.props.parent},"githubbtn0"),(0,r.jsx)(u.CloudSaveStatus,{headerId:d.id})]}))})),(0,r.jsxs)("div",Object.assign({id:"editorToolbarArea",role:"menubar",className:"ui column items"},{children:[O&&(0,r.jsx)("div",Object.assign({className:"ui icon buttons"},{children:this.getUndoRedo(0)})),N&&(0,r.jsx)("div",Object.assign({className:"ui icon buttons mobile hide"},{children:this.getZoomControl(0)})),h.bigRunButton&&!pxt.shell.isTimeMachineEmbed()&&(0,r.jsx)("div",Object.assign({className:"big-play-button-wrapper"},{children:(0,r.jsx)(b,{className:"big-play-button play-button "+(A?"stop":"play"),disabled:I,icon:A?"stop":"play",title:L,onButtonClick:this.startStopSimulator,view:"computer"},"runmenubtn")}))]}))]}))}}n.EditorToolbar=g;class m extends s.Component{constructor(e){super(e),this.zoomMin=this.props.zoomMin?this.props.zoomMin:0,this.zoomMax=this.props.zoomMax?this.props.zoomMax:5,this.state={zoomValue:Math.floor((this.zoomMax+1-this.zoomMin)/2)+this.zoomMin},this.handleWheelZoom=this.handleWheelZoom.bind(this),this.zoomUpdate=this.zoomUpdate.bind(this),this.zoomOut=this.zoomOut.bind(this),this.zoomIn=this.zoomIn.bind(this)}componentDidMount(){window.addEventListener("wheel",this.handleWheelZoom)}componentWillUnmount(){window.removeEventListener("wheel",this.handleWheelZoom)}handleWheelZoom(e){e.ctrlKey&&(e.deltaY<0?this.increaseZoomState():this.decreaseZoomState())}decreaseZoomState(){this.state.zoomValue>this.zoomMin&&this.setState({zoomValue:this.state.zoomValue-1})}increaseZoomState(){this.state.zoomValue<this.zoomMax&&this.setState({zoomValue:this.state.zoomValue+1})}zoomOut(){this.state.zoomValue>this.zoomMin&&(this.decreaseZoomState(),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate())}zoomIn(){this.state.zoomValue<this.zoomMax&&(this.increaseZoomState(),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate())}zoomUpdate(e){const t=parseInt(e.target.value);if(this.state.zoomValue<t)for(let e=0;e<t-this.state.zoomValue;e++)this.props.parent.editor.zoomIn();else if(t<this.state.zoomValue)for(let e=0;e<this.state.zoomValue-t;e++)this.props.parent.editor.zoomOut();this.setState({zoomValue:t}),this.props.parent.forceUpdate()}renderCore(){return(0,r.jsxs)("div",Object.assign({className:"zoom"},{children:[(0,r.jsx)(b,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn borderless",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.props.view},"minus"),(0,r.jsx)("div",Object.assign({id:"zoomSlider"},{children:(0,r.jsx)("input",{className:"zoomSliderBar",type:"range",min:this.zoomMin,max:this.zoomMax,step:"1",value:this.state.zoomValue.toString(),onChange:this.zoomUpdate,"aria-valuemax":this.zoomMax,"aria-valuemin":this.zoomMin,"aria-valuenow":this.state.zoomValue})})),(0,r.jsx)(b,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn borderless",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.props.view},"plus")]}))}}n.ZoomSlider=m;n.SmallEditorToolbar=class extends g{constructor(e){super(e)}renderCore(){return(0,r.jsxs)("div",Object.assign({id:"headerToolbar",className:"smallEditorToolbar"},{children:[(0,r.jsx)(m,{parent:this.props.parent,view:super.getViewString(0),zoomMin:0,zoomMax:5}),(0,r.jsx)("div",Object.assign({className:"ui icon undo-redo-buttons"},{children:super.getUndoRedo(0)}))]}))}};class b extends a.StatelessUIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{onButtonClick:e,view:t}=this.props;e(t)}renderCore(){const e=this.props,{onClick:t,onButtonClick:n,role:o}=e,s=i(e,["onClick","onButtonClick","role"]);return(0,r.jsx)(a.Button,Object.assign({role:o||"menuitem"},s,{onClick:this.handleClick}))}}class y extends o.Component{constructor(e){super(e),this.onChange=e=>{this.setState({editValue:e.target.value});const{onChangeValue:t,view:n}=this.props;t(e.target.value,n)},this.onBlur=e=>{if(!this.state.editValue)return;const{onChangeValue:t,view:n}=this.props;t(e.target.value,n),this.setState({editValue:void 0})},this.onKeyDown=e=>{"Enter"!==e.key||e.metaKey||e.shiftKey||(e.target.blur(),e.stopPropagation())},this.state={editValue:void 0}}render(){const e=this.props,{onChange:t,onChangeValue:n,view:o}=e,s=i(e,["onChange","onChangeValue","view"]),{editValue:a}=this.state;return(0,r.jsx)("input",Object.assign({onChange:this.onChange,onBlur:this.onBlur,onKeyDown:this.onKeyDown,className:"mobile hide ui",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},s,{value:void 0!==a?a:this.props.value}))}}},{"./cmds":202,"./core":279,"./data":282,"./githubbutton":299,"./identity":307,"./sui":346,"./webusb":353,react:548,"react/jsx-runtime":549}],292:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.openDevTools=n.driveDeployAsync=n.initElectron=void 0;const i=e("./cmds"),r=e("./core"),o=window.pxtElectron;n.initElectron=function(e){if(!pxt.BrowserUtils.isPxtElectron())return;o.onTelemetry((e=>{pxt.tickEvent(e.event,e.data)})),o.onUpdateInstalled((()=>{r.infoNotification(lf("An update will take effect after the app restarts"))})),o.onDriveDeployResult((e=>{if(s)if(e)pxt.tickEvent("electron.drivedeploy.success"),s.resolve();else{pxt.tickEvent("electron.drivedeploy.failure");const e=new Error("electron drive deploy failed");s.reject(e)}else pxt.tickEvent("electron.drivedeploy.unknowndeployoperation")}));const t=new Promise((e=>{o.onCriticalUpdateFailed((()=>{pxt.tickEvent("electron.criticalupdate.failed"),e()}))}));o.onUpdateStatus((n=>{switch(pxt.debug(`Electron app update status: ${n}`),pxt.tickEvent(`electron.updatestatus.${n}`),"updating-critical"!==n&&"banned-without-update"!==n||e.stopSimulator(),n){case"update-available":case"ok":return;case"updating-critical":r.confirmAsync({header:lf("Critical update required"),body:lf("A critical update is installing. Please do not quit the app. It will automatically restart when the update has completed."),hideAgree:!0,disagreeLbl:lf("Ok"),disagreeClass:"green",size:"large"}).then((()=>{r.showLoading("pxt-electron-update",lf("Installing update..."))})),t.then((()=>{r.hideLoading("pxt-electron-update"),r.hideDialog(),r.confirmAsync({header:lf("Critical update failed"),body:lf("There was an error installing the critical update. Please ensure you are connected to the Internet and try again later."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}))}));break;case"banned-without-update":r.confirmAsync({header:lf("Critical update required"),body:lf("We have disabled this app for security reasons. Please ensure you are connected to the Internet and try again later. An update will be automatically installed as soon as it is available."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}));default:return}})),o.sendUpdateStatusCheck()};let s=null;n.driveDeployAsync=function(e){return pxt.BrowserUtils.isPxtElectron()?(s||(s=pxt.Util.defer(),o.sendDriveDeploy(e)),s.promise.catch((t=>(pxt.tickEvent("electron.drivedeploy.browserdownloadinstead"),i.browserDownloadDeployCoreAsync(e)))).finally((()=>{s=null}))):i.browserDownloadDeployCoreAsync(e)},n.openDevTools=function(){o&&o.sendOpenDevTools()}},{"./cmds":202,"./core":279}],293:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorList=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./sui"),s=e("./util");class a extends r.Component{constructor(e){super(e),this.state={isCollapsed:!0,errors:[],exception:null,blockErrors:[]},this.onCollapseClick=this.onCollapseClick.bind(this),this.onErrorsChanged=this.onErrorsChanged.bind(this),this.onBlockErrorsChanged=this.onBlockErrorsChanged.bind(this),this.onExceptionDetected=this.onExceptionDetected.bind(this),this.onErrorMessageClick=this.onErrorMessageClick.bind(this),this.onDisplayStateChange=this.onDisplayStateChange.bind(this),this.getCompilerErrors=this.getCompilerErrors.bind(this),this.generateStackTraces=this.generateStackTraces.bind(this),this.listBlockErrors=this.listBlockErrors.bind(this),e.isInBlocksEditor?e.listenToBlockErrorChanges("errorList",this.onBlockErrorsChanged):(e.listenToErrorChanges("errorList",this.onErrorsChanged),e.listenToExceptionChanges("errorList",this.onExceptionDetected))}render(){const{isCollapsed:e,errors:t,exception:n,blockErrors:r}=this.state,a=!!(null==t?void 0:t.length)||!!n||!!(null==r?void 0:r.length),l=(lf("Collapse Error List"),e?void 0:this.props.isInBlocksEditor?this.listBlockErrors(r):n?this.generateStackTraces(n):this.getCompilerErrors(t)),c=this.props.isInBlocksEditor?r.length:n?1:t.length;return(0,i.jsxs)("div",Object.assign({className:`errorList ${e?"errorListSummary":""} ${this.props.isInBlocksEditor?"errorListBlocks":""}`,hidden:!a},{children:[(0,i.jsxs)("div",Object.assign({className:"errorListHeader",role:"button","aria-label":lf("{0} error list",e?lf("Expand"):lf("Collapse")),onClick:this.onCollapseClick,onKeyDown:s.fireClickOnEnter,tabIndex:0},{children:[(0,i.jsx)("h4",{children:lf("Problems")}),(0,i.jsx)("div",Object.assign({className:"ui red circular label countBubble"},{children:c})),(0,i.jsx)("div",Object.assign({className:"toggleButton"},{children:(0,i.jsx)(o.Icon,{icon:"chevron "+(e?"up":"down")})}))]})),!e&&(0,i.jsxs)("div",Object.assign({className:"errorListInner"},{children:[n&&(0,i.jsxs)("div",Object.assign({className:"debuggerSuggestion",role:"button",onClick:this.props.startDebugger,onKeyDown:s.fireClickOnEnter,tabIndex:0},{children:[lf("Debug this project"),(0,i.jsx)(o.Icon,{className:"debug-icon",icon:"icon bug"})]})),l]}))]}))}onDisplayStateChange(){const{errors:e,exception:t,isCollapsed:n}=this.state,i=!((null==e?void 0:e.length)||t);this.props.onSizeChange&&this.props.onSizeChange(i?void 0:n?"errorListHeader":"errorListExpanded")}onCollapseClick(){pxt.tickEvent("errorlist.collapse",null,{interactiveConsent:!0}),this.setState({isCollapsed:!this.state.isCollapsed},this.onDisplayStateChange)}onErrorMessageClick(e,t){pxt.tickEvent("errorlist.goto",{errorIndex:t},{interactiveConsent:!0}),this.props.goToError(e)}onErrorsChanged(e){this.setState({errors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onBlockErrorsChanged(e){this.setState({blockErrors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onExceptionDetected(e,t){this.setState({isCollapsed:!1,exception:e,callLocations:t})}getCompilerErrors(e){const t=function(e){const t=new Map;let n=0;for(const i of e){const e=c(i);t.has(e)?t.get(e).count++:t.set(e,{index:n++,count:1,error:i})}const i=[];return t.forEach((e=>i.push(e))),i.sort(((e,t)=>e.index-t.index))}(e);return(0,i.jsx)("div",Object.assign({className:"ui selection list"},{children:t.map(((e,t)=>(0,i.jsx)(l,{index:t,error:e,revealError:this.onErrorMessageClick},function(e){return`${e.messageText}-${e.fileName}-${e.line}-${e.column}`}(e.error))))}))}generateStackTraces(e){return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",Object.assign({className:"exceptionMessage"},{children:pxt.Util.rlf(e.exceptionMessage)})),(0,i.jsx)("div",Object.assign({className:"ui selection list"},{children:(e.stackframes||[]).map(((e,t)=>{const n=this.state.callLocations[e.callLocationId];return n?(0,i.jsx)(l,{index:t,stackframe:e,location:n,revealError:this.onErrorMessageClick},t):null}))}))]})}listBlockErrors(e){return(0,i.jsx)("div",Object.assign({className:"ui selection list"},{children:(e||[]).map(((e,t)=>(0,i.jsx)(l,{index:t,blockError:e},`${t}-${e}`)))}))}}n.ErrorList=a;class l extends r.Component{constructor(e){super(e),this.onErrorListItemClick=this.onErrorListItemClick.bind(this)}render(){const{error:e,stackframe:t,location:n,blockError:r}=this.props,o=r?lf("{0}",r.message):t?function(e,t){return lf("at {0} (line {1})",e.funcInfo.functionName,t.line+1)}(t,n):c(e.error),a=t||r?1:e.count;return(0,i.jsxs)("div",Object.assign({className:"item "+(t?"stackframe":""),role:"button",onClick:r?void 0:this.onErrorListItemClick,onKeyDown:s.fireClickOnEnter,"aria-label":lf("Go to {0}: {1}",t?"":"error",o),tabIndex:0},{children:[o," ",a<=1?null:(0,i.jsx)("div",Object.assign({className:"ui gray circular label countBubble"},{children:a}))]}))}onErrorListItemClick(){const e=this.props.stackframe?this.props.location:this.props.error.error;this.props.revealError(e,this.props.index)}}function c(e){return lf("Line {0}: {1}",e.endLine?e.endLine+1:e.line+1,e.messageText)}},{"./sui":346,"./util":352,react:548,"react/jsx-runtime":549}],294:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resolveExtensionUrl=n.ExtensionManager=void 0;const i=e("./package");function r(e,t){const n=i.mainEditorPkg();t.resp=n.getAllFiles()}n.ExtensionManager=class{constructor(e){this.host=e,this.nameToExtId={},this.extIdToName={},this.streams={},this.messages={}}clear(){}streamingExtensions(){return Object.keys(this.streams)}messagesExtensions(){return Object.keys(this.messages)}handleExtensionMessage(e){this.handleRequestAsync(e).catch((e=>{}))}sendEvent(e,t){this.host.send(e,function(e){return{target:pxt.appTarget.id,type:"pxtpkgext",event:e}}(t))}getExtId(e){return this.nameToExtId[e]||(this.nameToExtId[e]=ts.pxtc.Util.guidGen(),this.extIdToName[this.nameToExtId[e]]=e),this.nameToExtId[e]}sendResponse(e){this.host.send(this.extIdToName[e.extId],e)}handleRequestAsync(e){var t;const n=function(e,t=!0){return{type:"pxtpkgext",id:e.id,extId:e.extId,success:t}}(e);switch(e.action){case"extinit":n.target=pxt.appTarget,this.sendResponse(n);break;case"extdatastream":return(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.messages)?this.operation(e.extId,n,((e,t)=>this.handleMessageStreamRequest(e,t))):this.operation(e.extId,n,((e,t)=>this.handleDataStreamRequest(e,t)));case"extusercode":return this.operation(e.extId,n,r);case"extreadcode":(function(e,t){const n=i.mainEditorPkg(),r=ts.pxtc.escapeIdentifier(e),o=n.getAllFiles();t.resp={json:o[r+".json"],code:o[r+".ts"],jres:o[r+".jres"],asm:o[r+".asm"]}})(this.extIdToName[e.extId],n),this.sendResponse(n);break;case"extwritecode":const o=()=>function(e,t,n){var r;const o=i.mainEditorPkg(),s=ts.pxtc.escapeIdentifier(e);function a(e,t){return void 0!==e&&(!o.files[s+t]||o.files[s+t].content!=e)}let l,c=!1;if(a(n.json,".json")&&(c=!0,o.setFile(s+".json",n.json)),a(n.code,".ts")&&(c=!0,o.setFile(s+".ts",n.code)),a(n.jres,".jres")&&(c=!0,o.setFile(s+".jres",n.jres)),a(n.asm,".asm")&&(c=!0,o.setFile(s+".asm",n.asm)),n.dependencies){const e=pxt.Util.jsonTryParse(null===(r=o.files[pxt.CONFIG_NAME])||void 0===r?void 0:r.content);(null==e?void 0:e.dependencies)&&(l=Object.keys(n.dependencies).filter((t=>!e.dependencies[t])),c=c||!!(null==l?void 0:l.length))}return c?o.updateConfigAsync((e=>{void 0!==n.json&&e.files.indexOf(s+".json")<0&&e.files.push(s+".json"),void 0!==n.code&&e.files.indexOf(s+".ts")<0&&e.files.push(s+".ts"),void 0!==n.jres&&e.files.indexOf(s+".jres")<0&&e.files.push(s+".jres"),void 0!==n.asm&&e.files.indexOf(s+".asm")<0&&e.files.push(s+".asm"),null==l||l.forEach((t=>e.dependencies[t]=n.dependencies[t]))})).then((()=>o.saveFilesAsync())):Promise.resolve()}(this.extIdToName[e.extId],0,e.body).then((()=>this.sendResponse(n))),s=function(e){var t;let n;if(null==e?void 0:e.dependencies){const r=i.mainEditorPkg(),o=pxt.Util.jsonTryParse(null===(t=null==r?void 0:r.files[pxt.CONFIG_NAME])||void 0===t?void 0:t.content);(null==o?void 0:o.dependencies)&&(n=Object.keys(e.dependencies).filter((e=>!o.dependencies[e])))}return n}(e.body);(null==s?void 0:s.length)?this.operation(e.extId,n,o):o()}return Promise.resolve()}operation(e,t,n){return Promise.resolve().then((()=>{n(this.extIdToName[e],t),this.sendResponse(t)})).catch((e=>{t.success=!1,t.error=e,this.sendResponse(t)}))}handleDataStreamRequest(e,t){this.streams[e]=!0}handleMessageStreamRequest(e,t){this.messages[e]=!0}},n.resolveExtensionUrl=async function(e){var t;const{config:n,installedVersion:i}=e,{extension:r}=n,o=await pxt.packagesConfigAsync(),s=pxt.github.parseRepoId(i),a=pxt.github.repoStatus(s,o);let l="",c=!1;const u=pxt.BrowserUtils.isLocalHost()&&/debugextensions=1/i.test(window.location.href),d=!u&&pxt.BrowserUtils.isLocalHost()&&/localeditorextensions=1/i.test(window.location.href)&&r.localUrl;return u?(l="http://localhost:3232/extension.html",c=!0):d?(l=r.localUrl,c=!0):r.url&&a===pxt.github.GitRepoStatus.Approved&&(null===(t=null==o?void 0:o.approvedEditorExtensionUrls)||void 0===t?void 0:t.indexOf(r.url))>-1&&(pxt.log(`extension url ${r.url} trusted`),l=r.url,c=!0),pxt.log(`extension ${n.name}: resolved ${l}`),{url:l,name:n.name,trusted:c}}},{"./package":325}],295:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Extensions=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./core"),s=e("./sui"),a=e("./extensionManager");class l extends r.Component{constructor(e){super(e),this.handleExtensionWrapperRef=e=>{this.extensionWrapper=e},this.state={visible:!1},this.manager=new a.ExtensionManager(this),window.addEventListener("message",this.processMessage.bind(this),!1),this.hide=this.hide.bind(this),this.updateDimensions=this.updateDimensions.bind(this)}unload(){const e=l.getCustomContent();e&&pxsim.U.removeChildren(e),this.manager.clear()}processSerialMessage(e){const t=this.manager.streamingExtensions();if(!(null==t?void 0:t.length))return;const n=e.data||"",i=e.id||"?",r={target:pxt.appTarget.id,type:"pxtpkgext",event:"extconsole",body:{source:i,sim:e.sim,data:n}};t.forEach((e=>this.send(e,r)))}processMessagePacketMessage(e){const t=this.manager.messagesExtensions();if(!(null==t?void 0:t.length))return;const n=e.data,i=e.channel,r=e.source,o={target:pxt.appTarget.id,type:"pxtpkgext",event:"extmessagepacket",body:{source:r,channel:i,data:n}};t.forEach((e=>this.send(e,o)))}processMessage(e){const t=e.data;"serial"===(null==t?void 0:t.type)?this.processSerialMessage(t):"messagepacket"===(null==t?void 0:t.type)&&this.processMessagePacketMessage(t)}hide(){this.setState({visible:!1}),l.getFrame(this.state.extension,!0).style.display="none",o.showLoading("reloadproject",lf("loading...")),this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"exthidden"}),this.props.parent.reloadHeaderAsync().then((()=>o.hideLoading("reloadproject")))}showExtensionAsync(e,t){this.setState({visible:!0,extension:e,url:t},(()=>{this.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extshown"})}))}initializeFrame(){const e=l.getFrame(this.state.extension,!0);e.style.display="block",e.src||(e.src=this.state.url+"#"+this.manager.getExtId(this.state.extension),e.onload=()=>{this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extloaded"})})}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.extension!=t.extension}updateDimensions(){if(this.extensionWrapper){const e=60,t=this.extensionWrapper.getAttribute("data-frame");if(t){const n=l.getFrame(t,!1),i=document.getElementsByClassName("extensiondialog")[0];i&&n&&(i.getBoundingClientRect(),n.width=`${window.innerWidth}px`,n.height=window.innerHeight-e+"px",n.style.top=`${e}px`,n.style.left="0px")}}}componentDidMount(){window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){setTimeout((()=>{this.updateDimensions()}),0)}UNSAFE_componentWillUpdate(e,t){t.extension&&t.visible&&l.getFrame(t.extension,!0)}handleExtensionRequest(e){this.manager.handleExtensionMessage(e)}send(e,t){const n=l.getFrame(e,!1);n?n.contentWindow.postMessage(t,"*"):console.warn(`Attempting to post message to unloaded extesnion ${e}`)}static getCustomContent(){return document.getElementById("custom-content")}static getFrame(e,t){let n=this.getCustomContent().getElementsByClassName(`extension-frame-${e}`)[0];return!n&&t&&(n=this.createFrame(e)),n}static createFrame(e){const t=this.getCustomContent(),n=document.createElement("iframe");return n.className=`extension-frame extension-frame-${e}`,n.allowFullscreen=!0,n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.frameBorder="0",n.style.display="none",t.appendChild(n),n}static hideAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex="10"}))}static showAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex=""}))}renderCore(){const{visible:e,extension:t}=this.state;return l.showAllFrames(),e&&this.initializeFrame(),(0,i.jsx)(s.Modal,Object.assign({isOpen:e,className:"extensiondialog",size:"fullscreen",closeIcon:!0,onClose:this.hide,dimmer:!0,modalDidOpen:this.updateDimensions,shouldFocusAfterRender:!1,onPositionChanged:this.updateDimensions,closeOnDimmerClick:!0},{children:(0,i.jsx)("div",{id:"extensionWrapper","data-frame":t,ref:this.handleExtensionWrapperRef})}))}}n.Extensions=l},{"./core":279,"./data":282,"./extensionManager":294,"./sui":346,"react/jsx-runtime":549}],296:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionsBrowser=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./core"),s=e("./workspace"),a=e("./package"),l=e("../../react-common/components/controls/Button"),c=e("../../react-common/components/controls/Input"),u=e("react"),d=e("../../react-common/components/extensions/ImportModal"),h=e("../../react-common/components/extensions/ExtensionCard"),p=e("../../react-common/components/controls/Modal"),f=pxtc.service.ExtensionType,g={name:"",loading:!0};var m,b;(b=m||(m={}))[b.Recommended=0]="Recommended",b[b.InDevelopment=1]="InDevelopment";n.ExtensionsBrowser=e=>{const[t,n]=(0,u.useState)(""),[b,y]=(0,u.useState)(!0),[v,_]=(0,u.useState)(W()),E=(0,u.useMemo)((()=>function(){let t=s.getHeaders();return/localdependencies=1/i.test(window.location.href)||(t=t.filter((e=>!!e.githubId))),e.header&&(t=t.filter((t=>t.id!=e.header.id))),t}()),[]),[T,x]=(0,u.useState)([]),[w,k]=(0,u.useState)(""),[S,C]=(0,u.useState)(m.Recommended),[A,I]=(0,u.useState)(!1),[O,N]=(0,u.useState)([]),[R,D]=(0,u.useState)(new Map),L=e=>{n(e||"")};function M(e){if(!e)return;const t=v;e.forEach((e=>{t.has(e.name.toLowerCase())||t.set(e.name.toLowerCase(),e)})),_(t)}function P(e){const t=pxt.github.parseRepoId(e);if(t)return v.get(t.fullName.toLowerCase());return v.get(e.toLowerCase())||void 0}async function B(t,n){try{e.hideExtensions(),o.showLoading("installingextension",lf("Adding extension...")),await a.mainEditorPkg().addDependencyAsync(Object.assign(Object.assign({},t),{isExtension:!0}),n,!1)&&(await pxt.Util.delay(200),await e.reloadHeaderAsync())}finally{o.hideLoading("installingextension")}}async function j(e){let t;try{o.showLoading("downloadingpackage",lf("downloading extension..."));const n=P(e.repo.fullName);if(n)t=await pxt.github.downloadLatestPackageAsync(n.repo);else{const n=await F([e.repo.fullName]);if(n&&n.length>0){const e=G(n[0]);M([e]),t=await pxt.github.downloadLatestPackageAsync(e.repo)}}}catch(e){o.handleNetworkError(e)}finally{o.hideLoading("downloadingpackage")}return await B(t.config,t.version)}async function F(e){const t=e.length<=1?"gh-search":"extension-search";return r.getAsync(`${t}:${e.join("|")}`)}async function $(e){if(!e.length)return[];const t=await F(e);if(!t)return[];const n=t.map((e=>G(e)));return M(n),n}function U(e){pxt.tickEvent("extensions.local"),s.getTextAsync(e.id).then((t=>B(JSON.parse(t[pxt.CONFIG_NAME]),"workspace:"+e.id)))}function H(t){switch(t.type){case f.Bundled:pxt.tickEvent("extensions.bundled",{name:t.name}),e.hideExtensions(),B(t.pkgConfig,"*");break;case f.Github:pxt.tickEvent("extensions.github",{name:t.repo.fullName,slug:t.repo.slug.toLowerCase(),tag:t.repo.tag,fileName:t.repo.fileName}),e.hideExtensions(),j(t);break;case f.ShareScript:pxt.tickEvent("extensions.sharescript",{name:t.scriptInfo.id}),e.hideExtensions(),async function(e){const t=await s.getPublishedScriptAsync(e.id),n=pxt.Util.jsonTryParse(t[pxt.CONFIG_NAME]);B(Object.assign(Object.assign({},n),{version:e.id}),`pub:${e.id}`)}(t.scriptInfo)}}function G(e){return{name:(t=e,t.name.replace(/^pxt-/,"")),type:f.Github,imageUrl:pxt.github.repoIconUrl(e),repo:e,description:e.description,fullName:e.fullName};var t}async function V(e){if(e==w)return k(""),void x([]);k(e),n("");const t=R.get(e),i=[],r=[];t.forEach((e=>{const t=P(e);t?r.push(t):i.push(e)}));const o=[];for(let e=0;e<i.length;e++)o.push(g);if(x([...r,...o]),i.length>0){const e=await $(i);x([...r,...e])}}function W(){const e=pxt.appTarget.bundledpkgs,n=new Map;return Object.keys(e).filter((e=>!/prj$/.test(e))).map((t=>JSON.parse(e[t]["pxt.json"]))).filter((e=>!e.hidden)).filter((e=>!/---/.test(e.name))).filter((e=>!e.searchOnly||0!=(null==t?void 0:t.length))).filter((e=>"core"!=e.name)).filter((e=>0==!!e.core)).filter((e=>!a.mainPkg.deps[e.name]||a.mainPkg.deps[e.name].cppOnly)).sort(((e,t)=>{if(e.core!=t.core)return e.core?-1:1;const n=pxt.isPkgBeta(e);if(n!=pxt.isPkgBeta(t))return n?1:-1;const i=void 0===e.weight?50:e.weight,r=void 0===t.weight?50:t.weight;return i!=r?-i+r:pxt.Util.strcmp(e.name,t.name)})).forEach((e=>n.set(e.name,function(e){return{name:e.name,imageUrl:e.icon,type:f.Bundled,learnMoreUrl:`/reference/${e.name}`,pkgConfig:e,description:e.description}}(e)))),n}function z(e){const{extensionInfo:t}=e,{description:n,fullName:r,imageUrl:o,learnMoreUrl:s,loading:a,name:l,repo:c,type:u}=t;return(0,i.jsx)(h.ExtensionCard,{title:l||r,description:n,imageUrl:o,extension:t,onClick:H,learnMoreUrl:s||(r?`/pkg/${r}`:void 0),loading:a,label:pxt.isPkgBeta(t)?lf("Beta"):void 0,showDisclaimer:u!=f.Bundled&&(null==c?void 0:c.status)!=pxt.github.GitRepoStatus.Approved})}let q,Y;(0,u.useEffect)((()=>{!async function(){var e,t;if(R.size>0)return;let n=await r.getAsync("target-config:");const i=null===(e=null==n?void 0:n.packages)||void 0===e?void 0:e.approvedRepoLib,o=null===(t=null==n?void 0:n.packages)||void 0===t?void 0:t.builtinExtensionsLib;let s=[];const a=R;(i||o)&&(i&&(s=s.concat(Object.keys(i))),o&&(s=s.concat(Object.keys(o))),s.forEach((e=>{var t;null===(t=((null==i?void 0:i[e])||(null==o?void 0:o[e])).tags)||void 0===t||t.forEach((t=>{a.has(t)||a.set(t,[]);const n=a.get(t);-1===n.indexOf(e)&&n.push(e)}))})),D(a))}(),async function(){var e;const t=W(),n=[];t.forEach((e=>{n.push(e)}));let i=await r.getAsync("target-config:");const o=[];(null===(e=null==i?void 0:i.packages)||void 0===e?void 0:e.approvedRepoLib)&&Object.keys(i.packages.approvedRepoLib).forEach((e=>{if(!i.packages.approvedRepoLib[e].preferred)return;const t=P(e);t?n.push(t):o.push(e)}));const s=[];for(let e=0;e<o.length;e++)s.push(g);N([...n,...s]);const a=await $(o);N([...n,...a])}()}),[]),(0,u.useEffect)((()=>{t&&""!=t&&async function(){var e;const n=/^\/@(.*)$/.exec(t);let i=null==n?void 0:n[1];if(i){let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),i=i.replace(/^\//,""),window.location.href=`${e}${i}`}k(""),y(!1),x([g,g,g,g]);const o=await F([t]),s=null!==(e=null==o?void 0:o.map((e=>G(e))))&&void 0!==e?e:[];W().forEach((e=>{e.name.toLowerCase().indexOf(t.toLowerCase())>-1&&s.unshift(e)}));const a=await async function(e){const t=pxt.Cloud.parseScriptId(e);if(!t)return;const n=await r.getAsync(`cloud-search:${t}`);return 404!=n.statusCode?Array.isArray(n)?n[0]:n:void 0}(t);var l;a&&s.unshift({name:(l=a).name,type:f.ShareScript,imageUrl:l.thumb?`${pxt.Cloud.apiRoot}/${l.id}/thumb`:void 0,description:l.description,scriptInfo:l}),M(s),x(s),y(!0)}()}),[t]),function(e){e[e.Tabbed=0]="Tabbed",e[e.Search=1]="Search",e[e.Tags=2]="Tags"}(q||(q={})),Y=""!=t?q.Search:""!=w?q.Tags:q.Tabbed;const K=R?Array.from(R.keys()):[];return(0,i.jsx)(p.Modal,Object.assign({title:lf("Extensions"),fullscreen:!0,className:"extensions-browser",onClose:e.hideExtensions,helpUrl:"/extensions"},{children:(0,i.jsxs)("div",Object.assign({className:"ui"},{children:[A&&(0,i.jsx)(d.ImportModal,{onCancelClick:()=>I(!1),onImportClick:async function(t){I(!1),e.hideExtensions();const n=P(t);n?j(n):M(await $([t]))}}),(0,i.jsxs)("div",Object.assign({className:"extension-search-header"},{children:[(0,i.jsx)(c.Input,{placeholder:lf("Search or enter project URL..."),ariaLabel:lf("Search or enter project URL..."),onEnterKey:L,onIconClick:L,preserveValueOnBlur:!0,icon:"fas fa-search"}),(0,i.jsx)("div",Object.assign({className:"extension-tags"},{children:K.map((e=>(0,i.jsx)(l.Button,{title:pxt.Util.rlf(e),label:pxt.Util.rlf(`{id:extension-tag}${e}`),onClick:()=>V(e),onKeydown:()=>V,className:"extension-tag "+(w==e?"selected":"")},e)))}))]})),(0,i.jsxs)("div",Object.assign({className:"extension-display"},{children:[(0,i.jsxs)("div",Object.assign({className:"extension-header"},{children:[(Y==q.Search||Y==q.Tags)&&(0,i.jsxs)("div",Object.assign({className:"breadcrumbs"},{children:[(0,i.jsx)(l.Button,{title:lf("Home"),label:lf("Home"),onClick:function(){k(""),n("")},className:"link-button"}),Y==q.Tags&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{children:"/"}),(0,i.jsx)("span",{children:w})]})]})),Y==q.Tabbed&&(0,i.jsxs)("div",Object.assign({className:"tab-header"},{children:[!!E.length&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.Button,{title:lf("Recommended Extensions"),label:lf("Recommended"),onClick:()=>{C(m.Recommended)},className:S==m.Recommended?"selected":""}),(0,i.jsx)(l.Button,{title:lf("Local GitHub Projects"),label:lf("Local"),onClick:()=>{C(m.InDevelopment)},className:S==m.InDevelopment?"selected":""})]}),!E.length&&!!O.length&&(0,i.jsx)("h2",{children:lf("Recommended")})]})),(0,i.jsx)("div",Object.assign({className:"import-button"},{children:(0,i.jsx)(l.Button,{ariaLabel:lf("Open file from your computer"),title:lf("Import File"),label:lf("Import File"),leftIcon:"fas fa-upload",className:"gray",onClick:function(){pxt.tickEvent("extensions.importfile",void 0,{interactiveConsent:!0}),e.hideExtensions(),e.importExtensionCallback()}})}))]})),Y==q.Search&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",Object.assign({className:"extension-cards"},{children:null==T?void 0:T.map(((e,t)=>(0,i.jsx)(z,{extensionInfo:e},t)))})),b&&0==T.length&&(0,i.jsx)("div",Object.assign({"aria-label":"Extension search results"},{children:(0,i.jsx)("p",{children:lf("We couldn't find any extensions matching '{0}'",t)})}))]}),Y==q.Tags&&(0,i.jsx)("div",Object.assign({className:"extension-cards"},{children:null==T?void 0:T.map(((e,t)=>(0,i.jsx)(z,{extensionInfo:e},t)))})),Y==q.Tabbed&&(0,i.jsxs)("div",Object.assign({className:"extension-cards"},{children:[S==m.Recommended&&O.map(((e,t)=>(0,i.jsx)(z,{extensionInfo:e},t))),S==m.InDevelopment&&E.map(((e,t)=>(0,i.jsx)(h.ExtensionCard,{title:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),imageUrl:e.icon,extension:e,onClick:U},`local:${t}`)))]}))]}))]}))}))}},{"../../react-common/components/controls/Button":146,"../../react-common/components/controls/Input":154,"../../react-common/components/controls/Modal":159,"../../react-common/components/extensions/ExtensionCard":167,"../../react-common/components/extensions/ImportModal":168,"./core":279,"./data":282,"./package":325,"./workspace":354,react:548,"react/jsx-runtime":549}],297:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.FileList=void 0;const r=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./package"),l=e("./core"),c=e("./util"),u="custom.ts",d=`\nenum MyEnum {\n    //% block="one"\n    One,\n    //% block="two"\n    Two\n}\n\n/**\n * ${lf("Custom blocks")}\n */\n//% weight=100 color=#0fbc11 icon=""\nnamespace custom {\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param n ${lf("describe parameter here")}, eg: 5\n     * @param s ${lf("describe parameter here")}, eg: "Hello"\n     * @param e ${lf("describe parameter here")}\n     */\n    //% block\n    export function foo(n: number, s: string, e: MyEnum): void {\n        // Add code here\n    }\n\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param value ${lf("describe value here")}, eg: 5\n     */\n    //% block\n    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n    }\n}\n`,h=e=>`\n/**\n* ${lf("Use this file to define custom functions and blocks.")}\n* ${lf("Read more at {0}",e+"blocks/custom")}\n*/\n`;class p extends o.Component{constructor(e){super(e),this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.handleCustomBlocksClick=this.handleCustomBlocksClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.setFile=this.setFile.bind(this),this.removeFile=this.removeFile.bind(this),this.addLocalizedFile=this.addLocalizedFile.bind(this),this.removePkg=this.removePkg.bind(this),this.updatePkg=this.updatePkg.bind(this),this.togglePkg=this.togglePkg.bind(this),this.navigateToError=this.navigateToError.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=e.parent.state.currFile;if(this.state.currentFile!=t){let e;a.allEditorPkgs().forEach((n=>{this.packageContainsFile(n,t)&&(e=n.getPkgId())})),this.setState({expandedPkg:e,currentFile:t})}}removePkg(e){l.confirmAsync({header:lf("Remove {0} extension",e.getPkgId()),body:lf("You are about to remove an extension from your project. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((t=>{t&&a.mainEditorPkg().removeDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync()))}))}setFile(e){this.props.parent.setSideFile(e)}removeFile(e){this.props.parent.removeFile(e)}addLocalizedFile(e,t){return this.props.parent.updateFileAsync(t,e.content,!0)}updatePkg(e){l.showLoading("update",lf("Updating...")),a.mainEditorPkg().updateDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>l.hideLoading("update")))}navigateToError(e){const t=e&&e.diagnostics&&e.diagnostics[0];t&&this.props.parent.navigateToError(t)}filesOf(e){const t=e.isTopLevel(),n=e.getLanguageRestrictions();let i=e.sortedFiles();t&&(i=i.filter((e=>{switch(n){case"javascript-only":return!/\.(blocks|py)$/.test(e.name);case"python-only":return!/\.(blocks|ts)$/.test(e.name);default:return!0}})));const o={};return i.forEach((e=>{const t=e.name.lastIndexOf("/"),n=t<0?"":e.name.slice(0,t);(o[n]||(o[n]=[])).push(e)})),Object.keys(o).map((t=>(0,r.jsx)(f,Object.assign({folder:t},{children:this.folderFilesOf(e,t,o[t])}),"folder-"+t))).reduce(((e,t)=>e.concat(t)),[])}folderFilesOf(e,t,n){const{currentFile:i}=this.state,o=this.props.parent.state.header,a=e.isTopLevel(),l=pxt.shell.isReadOnly(),c=a&&!l;return n.map((u=>{const d=this.getData("open-meta:"+u.getName()),h=!!o&&!!o.githubId,p=a&&h&&/\.md$/.test(u.name)&&!/^_locales\//.test(u.name),f=u.name.replace(/\.[a-z]+$/,""),m=!l&&p&&`#tutorial:${o.id}:${f}`,b=h&&pxt.github.parseRepoId(o.githubId),y=p&&b&&pxt.appTarget.appTheme.embedUrl&&`${window.location.origin}${window.location.pathname||""}#tutorial:github:${b.fullName}/${f}`,v=`_locales/${pxt.Util.userLanguage()}/${u.name}`,_=!l&&p&&pxt.Util.userLanguage()!==(pxt.appTarget.appTheme.defaultLocale||"en")&&!n.some((e=>e.name==v)),E=c&&(u.name!=pxt.CONFIG_NAME&&(h||u.name!=pxt.MAIN_TS)&&!u.isReadonly()||u.name===pxt.HISTORY_FILE),T=t.length?t.length+1:0;return(0,r.jsxs)(g,Object.assign({file:u,meta:d,onItemClick:this.setFile,onItemRemove:this.removeFile,onErrorClick:this.navigateToError,onItemLocalize:this.addLocalizedFile,isActive:i==u,hasDelete:E,previewUrl:m,shareUrl:y,addLocalizedFile:_&&v,className:(i==u?"active ":"")+(e.isTopLevel()?"":"nested ")+(t?"folderitem ":"")+"item"},{children:[u.name.slice(T),"",d.isGitModified?" ":"",d.isReadonly?(0,r.jsx)(s.Icon,{icon:"lock"}):null]}),"file-"+u.getName())}))}packageOf(e){var t;const n=this.state.expandedPkg,i=e.getPkgId(),o=!pxt.shell.isReadOnly()&&i!=pxt.appTarget.id&&"built"!=i&&"assets"!=i&&i!=pxt.appTarget.corepkg&&e.getKsPkg().config&&!e.getKsPkg().config.core&&e.getKsPkg().level<=1,s="github"==(null===(t=e.getKsPkg())||void 0===t?void 0:t.verProtocol()),a=o&&s,l=this.getData("open-pkg-meta:"+e.getPkgId());let c=s?e.getKsPkg().verArgument().split("#")[1]:void 0;return c&&c.length>20&&(c=c.substring(0,7)),[(0,r.jsxs)(m,Object.assign({pkg:e,isActive:n==i,onItemClick:this.togglePkg,hasDelete:o,onItemRemove:this.removePkg,version:c,hasRefresh:a,onItemRefresh:this.updatePkg},{children:[l.numErrors?(0,r.jsx)("span",Object.assign({className:"ui label red"},{children:l.numErrors})):null,i,n==i?(0,r.jsx)("div",Object.assign({role:"group",className:"menu"},{children:this.filesOf(e)})):void 0]}),"hd-"+i)]}packageContainsFile(e,t){return e.sortedFiles().filter((e=>e==t)).length>0}togglePkg(e){this.setState({expandedPkg:this.state.expandedPkg==e.getPkgId()?void 0:e.getPkgId()})}filesWithHeader(e){return e.isTopLevel()?this.filesOf(e):this.packageOf(e)}toggleVisibility(){this.props.parent.setState({showFiles:!this.props.parent.state.showFiles})}handleCustomBlocksClick(e){this.addCustomBlocksFile(),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}addProjectFile(){const e=a.mainEditorPkg(),t=/^[\w][\/\w\-\.]*$/;l.promptAsync({header:lf("Add new file?"),hasCloseIcon:!0,onInputValidation:e=>e?(e=e.trim(),t.test(e)?void 0:lf("Don't use spaces or special characters.")):lf("filename is empty."),body:lf("Please provide a name for your new file."),initialValue:e.files[u]?void 0:u}).then((e=>{if(!e)return Promise.resolve();const n=(e=e.replace(/\s+/g,"")).lastIndexOf(".");let i,r=e;-1!=n&&(r=e.slice(0,n),i=e.slice(n+1).toLowerCase());const o=a.mainPkg&&a.mainPkg.config,s=o&&o.languageRestriction;let c="ts",p="//",f=pxt.U.lf("Add your code here");if("python-only"===s&&(c="py",p="#"),i)switch(i){case"js":case"ts":break;case"py":"javascript-only"!==s&&(c="py",p="#");break;case"md":c="md",p="#",f=r;break;case"json":c="json",p=void 0;break;case"jres":c="jres",p=void 0;break;default:r=e}if(!r)return Promise.resolve();if(!t.test(r))return l.warningNotification(lf("Invalid file name")),Promise.resolve();const g=`${r}.${c}`;if(a.mainEditorPkg().sortedFiles().some((e=>e.name==g)))return l.warningNotification(lf("File already exists")),Promise.resolve();let m="";return g==u?m=h(pxt.appTarget.appTheme.homeUrl)+d:p&&(m=`${p} ${f}\n`),this.props.parent.updateFileAsync(g,m,!0)}))}addCustomBlocksFile(){this.props.parent.state.header.githubId||pxt.appTarget.appTheme.addNewTypeScriptFile?this.addProjectFile():l.confirmAsync({header:lf("Add custom blocks?"),body:lf("A new JavaScript file, custom.ts, will be added to your project. You can define custom functions and blocks in that file.")}).then((e=>{if(e)return this.props.parent.updateFileAsync(u,h(pxt.appTarget.appTheme.homeUrl)+d,!0)}))}renderCore(){const e=!!this.props.parent.state.showFiles,t=pxt.appTarget.appTheme,n=a.mainEditorPkg(),i=e&&!pxt.shell.isReadOnly()&&(!n.files[u]||pxt.appTarget.appTheme.addNewTypeScriptFile),o=this.getData("open-pkg-meta:"+n.getPkgId());return(0,r.jsxs)("div",Object.assign({role:"tree",className:`ui tiny vertical ${t.invertedMenu?"inverted":""} menu filemenu landscape only hidefullscreen`},{children:[(0,r.jsxs)("div",Object.assign({role:"treeitem","aria-selected":e,"aria-expanded":e,"aria-label":lf("File explorer toolbar"),className:"link item",onClick:this.toggleVisibility,tabIndex:0,onKeyDown:c.fireClickOnEnter},{children:[lf("Explorer"),(0,r.jsx)(s.Icon,{icon:`chevron ${e?"up":"down"} icon`}),i?(0,r.jsx)(s.Button,{className:"primary label",icon:"plus",title:lf("Add custom blocks?"),onClick:this.handleCustomBlocksClick,onKeyDown:this.handleButtonKeydown}):void 0,o.numErrors?(0,r.jsx)("span",Object.assign({className:"ui label red"},{children:o.numErrors})):null]}),"projectheader"),e?pxt.Util.concat(a.allEditorPkgs().map((e=>this.filesWithHeader(e)))):void 0]}))}}n.FileList=p;class f extends s.StatelessUIElement{constructor(e){super(e)}renderCore(){const{folder:e,children:t}=this.props;return e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",Object.assign({className:"folder item",role:"treeitem","aria-selected":!1,"aria-label":lf("Files in folder {0}",e)},{children:[(0,r.jsx)("i",{className:"folder open outline icon"}),e]})),t]}):t}}class g extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.handlePreview=this.handlePreview.bind(this),this.handleShare=this.handleShare.bind(this),this.handleAddLocale=this.handleAddLocale.bind(this)}handleClick(e){this.props.onErrorClick&&this.props.meta&&this.props.meta.numErrors&&this.props.meta.diagnostics&&this.props.meta.diagnostics[0]?this.props.onErrorClick(this.props.meta):this.props.onItemClick(this.props.file),e.stopPropagation()}handleRemove(e){pxt.tickEvent("explorer.file.remove"),e.preventDefault(),e.stopPropagation(),this.props.onItemRemove(this.props.file)}handlePreview(e){pxt.tickEvent("explorer.file.preview"),e.preventDefault(),e.stopPropagation(),window.open(this.props.previewUrl,"_blank")}handleShare(e){pxt.tickEvent("explorer.file.share"),e.preventDefault(),e.stopPropagation(),l.dialogAsync({header:lf("Share this tutorial"),body:lf("The URL will start the MakeCode editor in your tutorial."),copyable:this.props.shareUrl,hasCloseIcon:!0})}handleAddLocale(e){pxt.tickEvent("explorer.file.addlocale");const{addLocalizedFile:t,onItemLocalize:n}=this.props;n&&t&&n(this.props.file,t),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const{isActive:e,hasDelete:t,file:n,meta:i,previewUrl:o,shareUrl:a,addLocalizedFile:l,className:u}=this.props;return(0,r.jsxs)("a",Object.assign({onClick:this.handleClick,tabIndex:0,role:"treeitem","aria-selected":e,"aria-label":e?lf("{0}, it is the current opened file in the JavaScript editor",n.name):n.name,onKeyDown:c.fireClickOnEnter,className:u},{children:[this.props.children,t&&(0,r.jsx)(s.Button,{className:"primary label",icon:"trash",title:lf("Delete file {0}",n.name),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}),i&&i.numErrors?(0,r.jsx)("span",Object.assign({className:"ui label red button",role:"button",title:lf("Go to error")},{children:i.numErrors})):void 0,a&&(0,r.jsx)(s.Button,{className:"button primary label",icon:"share alternate",title:lf("Share"),onClick:this.handleShare,onKeyDown:c.fireClickOnEnter}),o&&(0,r.jsx)(s.Button,{className:"button primary label",icon:"flask",title:lf("Preview"),onClick:this.handlePreview,onKeyDown:c.fireClickOnEnter}),!!l&&(0,r.jsx)(s.Button,{className:"primary label",icon:"xicon globe",title:lf("Add localized file"),onClick:this.handleAddLocale,onKeyDown:this.handleButtonKeydown})]}))}}class m extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this)}handleClick(){this.props.onItemClick(this.props.pkg)}handleRefresh(e){e.stopPropagation(),this.props.onItemRefresh(this.props.pkg)}handleRemove(e){e.stopPropagation(),this.props.onItemRemove(this.props.pkg)}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const e=this.props,{onItemClick:t,onItemRemove:n,onItemRefresh:o,version:a,isActive:l,hasRefresh:u,hasDelete:d,pkg:h}=e,p=i(e,["onItemClick","onItemRemove","onItemRefresh","version","isActive","hasRefresh","hasDelete","pkg"]);return(0,r.jsxs)("div",Object.assign({className:"header link item",role:"treeitem","aria-selected":l,"aria-expanded":l,"aria-label":lf("{0}, {1}",h.getPkgId(),l?lf("expanded"):lf("collapsed")),onClick:this.handleClick,tabIndex:0,onKeyDown:c.fireClickOnEnter},p,{children:[(0,r.jsx)(s.Icon,{icon:`chevron ${l?"up":"down"} icon`}),u?(0,r.jsx)(s.Button,{className:"primary label",icon:"refresh",title:lf("Refresh extension {0}",h.getPkgId()),onClick:this.handleRefresh,onKeyDown:this.handleButtonKeydown,text:a||""}):a?(0,r.jsx)("span",Object.assign({className:"label",style:{background:"transparent"}},{children:a})):void 0,d?(0,r.jsx)(s.Button,{className:"primary label",icon:"trash",title:lf("Delete extension {0}",h.getPkgId()),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):void 0,this.props.children]}))}}},{"./core":279,"./data":282,"./package":325,"./sui":346,"./util":352,"react/jsx-runtime":549}],298:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.setApiAsync=void 0;const i=e("./core"),r=e("../../pxteditor");var o=pxt.Util,s=pxt.Cloud;let a=(e,t)=>o.requestAsync({url:"/api/"+e,headers:{Authorization:s.localToken},method:t?"POST":"GET",data:t||void 0}).then((e=>e.json)).catch(i.handleNetworkError);function l(e,t,n){let i={files:[],config:null,header:e,path:e.path,isDeleted:e.isDeleted};if(n){t||(t={});for(let e of Object.keys(n))n[e]!==t[e]&&i.files.push({name:e,mtime:null,content:n[e],prevContent:t[e]});for(let e of Object.keys(t))void 0===n[e]&&i.files.push({name:e,mtime:null,content:null,prevContent:t[e]})}let r=o.flatClone(n||{});return a("pkg/"+e.path,i).then((e=>r))}n.setApiAsync=function(e){a=e},n.provider={getAsync:function(e){return a("pkg/"+e.path).then((t=>{let n={header:e,text:{},version:null};for(let i of t.files)n.text[i.name]=i.content,e.modificationTime=Math.max(e.modificationTime,i.mtime/1e3|0);return e.recentUse=Math.max(e.recentUse,e.modificationTime),n.version=o.flatClone(n.text),n}))},setAsync:l,listAsync:async function(){let e=await a("list");for(let t of e.pkgs)if(t.header)t.header.path=t.path;else{let e=t.files.map((e=>e.mtime));e.sort(((e,t)=>t-e));let n=Math.round(e[0]/1e3)||o.nowSeconds();t.header=r.workspace.freshHeader(t.config.name,n),t.config.preferredEditor&&(t.header.editor=t.config.preferredEditor),t.header.path=t.path,await l(t.header,null)}return e.pkgs.map((e=>e.header))},resetAsync:function(){return pxt.BrowserUtils.isPxtElectron()?a("resetworkspace",{}).then((()=>{})):Promise.resolve()},deleteAsync:function(e,t){return e.isDeleted=!0,l(e,t,{})},saveScreenshotAsync:function(e,t,n){return a("screenshot/"+e.path,{screenshot:t,icon:n})},saveAssetAsync:function(e,t,n){return a("pkgasset/"+e,{encoding:"base64",name:t,data:btoa(ts.pxtc.Util.uint8ArrayToString(n))}).then((e=>{}))},listAssetsAsync:function(e){return a("pkgasset/"+e).then((e=>e.files))}}},{"../../pxteditor":134,"./core":279}],299:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GithubButton=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./package"),s=e("./workspace"),a=e("./util");class l extends r.UIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.createRepository=this.createRepository.bind(this)}handleButtonKeydown(e){e.stopPropagation()}createRepository(e){pxt.tickEvent("github.button.create",void 0,{interactiveConsent:!0}),this.props.parent.createGitHubRepositoryAsync()}handleClick(e){e.stopPropagation();const{header:t}=this.props.parent.state;if(!t)return;const{githubId:n}=t;if(!n)return;pxt.tickEvent("github.button.nav");const i=o.mainEditorPkg().lookupFile("this/"+pxt.github.GIT_JSON);i&&this.props.parent.setSideFile(i)}renderCore(){const e=this.props.parent.state.header;if(!e)return(0,i.jsx)("div",{});const{githubId:t}=e,n=pxt.github.parseRepoId(t),o="ui icon button editortools-btn editortools-github-btn";if(!n)return(0,i.jsx)(r.Button,{className:`${o} ${this.props.className||""}`,icon:"github",title:lf("create GitHub repository"),ariaLabel:lf("create GitHub repository"),onClick:this.createRepository},"githubcreatebtn");const l=this.getData("pkg-git-status:"+e.id),c=l&&this.getData("pkg-git-pull-status:"+e.id),u=c==s.PullStatus.BranchNotFound,d=c==s.PullStatus.GotChanges,h=l&&!!l.modified,p=n.project&&n.tag?`${n.project}${pxt.github.isDefaultBranch(n.tag)?"":`#${n.tag}`}`:n.fullName;let f=n.tag&&pxt.github.isDefaultBranch(n.tag)?"":`#${n.tag}`;f.length>20&&(f=f.slice(0,18)+"..");const g=u?lf("{0}: there is an issue with your GitHub connection.",p):d?lf("{0}: remote changes are ready to be pulled.",p):h?lf("{0}: review, commit & push local changes to GitHub.",p):lf("{0}: local changes are synchronized with GitHub.",p);return(0,i.jsxs)("div",Object.assign({role:"button",className:`${o}\n            ${this.props.className||""}`,title:g,onClick:this.handleClick,onKeyDown:a.fireClickOnEnter,tabIndex:0},{children:[(0,i.jsx)("i",{className:"github icon"}),(0,i.jsx)("span",Object.assign({className:"ui mobile hide"},{children:f})),(0,i.jsx)("span",Object.assign({className:"ui long mobile hide"},{children:(0,i.jsx)("i",{className:(u?"exclamation circle":d?"arrow alternate down":h?"arrow alternate up":"check")+" icon"})}))]}),"githubeditorbtn")}}n.GithubButton=l},{"./package":325,"./sui":346,"./util":352,"./workspace":354,"react/jsx-runtime":549}],300:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GithubProvider=n.PROVIDER_NAME=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./core"),s=e("./cloudsync"),a=e("./dialogs"),l=e("./workspace");n.PROVIDER_NAME="github";class c extends s.ProviderBase{constructor(){super(n.PROVIDER_NAME,lf("GitHub"),"icon github","https://api.github.com"),pxt.github.handleGithubNetworkError=(e,t)=>401==t.statusCode&&pxt.github.token?(pxt.log("github: invalid token"),this.clearToken(),"GET"==e.method):(403==t.statusCode?pxt.log("github: unauthorized access"):404==t.statusCode&&(t.needsWritePermission=!0),!1)}clearToken(){pxt.github.token=void 0,super.logout()}logout(){pxt.github.token=void 0,super.logout(),window.open("https://github.com/logout","_blank")}hasToken(){return this.loginCheck(),!!this.token()}loginCheck(){super.loginCheck();const e=this.token();pxt.github.token=e}loginAsync(e,t){return this.routedLoginAsync(void 0)}routedLoginAsync(e){this.loginCheck();let t=Promise.resolve();return this.token()||(t=t.then((()=>this.showLoginAsync(e)))),t.then((()=>({accessToken:this.token()})))}showLoginAsync(e){pxt.tickEvent("github.login.dialog");let t,n=!(pxt.appTarget&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name]),s=!1;const a=e=>{s=e,o.forceUpdate()};return o.confirmAsync({header:lf("Sign in with GitHub"),hasCloseIcon:!0,helpUrl:"/github",agreeLbl:lf("Sign in"),onLoaded:e=>{t=e},jsxd:()=>(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[(0,i.jsx)("p",{children:lf("You need to sign in with GitHub to use this feature.")}),(0,i.jsx)("p",{children:lf("You can host your code on GitHub and collaborate with friends on projects.")}),(0,i.jsx)("div",{children:(0,i.jsx)(r.PlainCheckbox,{label:lf("Remember me"),onChange:a})}),!n&&(0,i.jsxs)("p",Object.assign({className:"ui small"},{children:[lf("Looking to use a Developer token instead?"),(0,i.jsx)(r.Link,{className:"link",text:lf("Use Developer token"),onClick:l,href:"#"})]})),n&&(0,i.jsxs)("ol",{children:[(0,i.jsxs)("li",{children:[lf("Navigate to: "),(0,i.jsx)("a",Object.assign({href:"https://github.com/settings/tokens/new",target:"_blank",rel:"noopener noreferrer"},{children:lf("GitHub token generation page")}))]}),(0,i.jsx)("li",{children:lf("Put something like 'MakeCode {0}' in description",pxt.appTarget.name)}),(0,i.jsx)("li",{children:lf("Select either '{0}' or '{1}' scope, depending which repos you want to edit from here","repo","public_repo")}),(0,i.jsx)("li",{children:lf("Click generate token, copy it, and paste it below.")})]}),n&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)("label",Object.assign({id:"selectUrlToOpenLabel"},{children:lf("Paste GitHub token here:")})),(0,i.jsx)("input",{id:"githubTokenInput",type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:"ghp_ABC...",className:"ui blue fluid"})]}))]}))}).then((i=>{var r;if(i){if(n){const e=t.querySelector("#githubTokenInput"),n=null===(r=null==e?void 0:e.value)||void 0===r?void 0:r.trim();return this.saveAndValidateTokenAsync(n,s)}return this.oauthRedirectAsync(s,e)}return pxt.tickEvent("github.login.cancel"),Promise.resolve()}));function l(){n=!0,o.forceUpdate()}}authorizeAppAsync(e,t){return this.oauthRedirectAsync(e,t||window.location.hash,!0)}oauthRedirectAsync(e,t,n){o.showLoading("ghlogin",lf("Signing you into GitHub...")),t=(t||"").replace(/^#/,"");const i=s.setOauth(this.name,e,t?`#github:${t}`:void 0),r=window.location.href.replace(/#.*/,""),a=pxt.Cloud.getServiceUrl()+"/oauth/login?state="+i+(n?"&prompt=consent":"")+"&response_type=token&client_id=gh-token&redirect_uri="+encodeURIComponent(r);return window.location.href=a,pxt.Util.delay(1e3)}getUserInfoAsync(){return this.token()?pxt.github.authenticatedUserAsync().then((e=>{if(e)return{id:e.login,userName:e.login,name:e.name,photo:e.avatar_url,profile:`https://github.com/${e.login}`};pxt.log("unknown github user")})):Promise.resolve(void 0)}setNewToken(e,t){super.setNewToken(e,t),pxt.github.token=e}saveAndValidateTokenAsync(e,t){return o.showLoading("githubtokensave",lf("validating GitHub token...")),Promise.resolve().then((()=>(pxt.github.token=e,pxt.github.createRepoAsync(void 0,"").then((n=>{pxt.reportError("github","Succeeded creating undefined repo!"),o.infoNotification(lf("Something went wrong with validation; token stored")),this.setNewToken(e,t),pxt.tickEvent("github.token.wrong")}),(n=>{pxt.github.token="",a.showGithubTokenError(n)||(422==n.statusCode?o.infoNotification(lf("Token validated and stored")):o.infoNotification(lf("Token stored but not validated")),this.setNewToken(e,t),pxt.tickEvent("github.token.ok"))})).then((()=>s.syncAsync()))))).finally((()=>o.hideLoading("githubtokensave")))}async createRepositoryAsync(e,t){if(pxt.tickEvent("github.filelist.create.start"),await this.routedLoginAsync(`create-repository:${t.id}`),!this.token())return pxt.tickEvent("github.filelist.create.notoken"),!1;const n=await a.showCreateGithubRepoDialogAsync(e);if(!n)return!1;pxt.tickEvent("github.filelist.create.export");const i=pxt.github.parseRepoId(n);o.showLoading("creategithub",lf("preparing {0} repository...",i.project||i.fullName));try{return await l.exportToGithubAsync(t,n),!0}finally{o.hideLoading("creategithub")}}}n.GithubProvider=c},{"./cloudsync":201,"./core":279,"./dialogs":289,"./sui":346,"./workspace":354,"react/jsx-runtime":549}],301:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("./package"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./workspace"),c=e("./dialogs"),u=e("./coretsx"),d=e("./data"),h=e("./marked"),p=e("./compiler"),f=e("./cloudsync"),g=e("./tutorial"),m=e("./package"),b=e("./util"),y=e("../../pxtblocks");class v extends d.Component{constructor(e){super(e),this.diffCache={},this.goBack=this.goBack.bind(this),this.handlePullClick=this.handlePullClick.bind(this),this.handleBranchClick=this.handleBranchClick.bind(this),this.handleGithubError=this.handleGithubError.bind(this),this.handlePullRequest=this.handlePullRequest.bind(this),this.handleSignoutGithub=this.handleSignoutGithub.bind(this)}clearCacheDiff(e,t){t?delete this.diffCache[e+t.name]:this.diffCache={}}cachedDiff(e,t){let n=this.diffCache[e+t.name];return n&&n.file.file===t.file||(n={file:t},this.diffCache[e+t.name]=n),n}fastForwardMergeAsync(e,t,n){return n=n||t.title||lf("Merge pull request"),o.showLoading("github.merge",lf("merging pull request...")),pxt.github.mergeAsync(e.fullName,t.base,e.tag,`${n} (#${t.number})`).then((()=>this.switchProjectToBranchAsync(t.base))).then((()=>this.pullAsync())).then((()=>{o.hideLoading("github.merge"),o.infoNotification("Pull request merged successfully!")})).then((()=>this.handleGithubError)).finally((()=>o.hideLoading("github.merge"))).then((()=>{}))}async revertAllFilesAsync(){if(pxt.tickEvent("github.revertall",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert all local changes?"),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revertall",{ok:1}),this.setState({needsCommitMessage:!1});const{header:e}=this.props.parent.state;await l.revertAllAsync(e),await this.props.parent.reloadHeaderAsync()}async revertFileAsync(e,t,n,i){if(pxt.tickEvent("github.revert",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert changes to {0}?",e.name),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revert",{ok:1}),this.setState({needsCommitMessage:!1});let s=!1;const a=r.mainEditorPkg();if(null==e.gitFile){s=!0,await a.removeFileAsync(e.name);for(const e of i)await a.removeFileAsync(e.name)}else if(e.name==pxt.CONFIG_NAME){s=!0;const i=this.getGitJson(),r=this.parsedRepoId();for(let e of t){const t=pxt.github.lookupFile(r,i.commit,e);a.setFile(e,t&&t.blobContent||"// Cannot restore.")}for(let e of n)delete a.files[e];await e.file.setContentAsync(e.gitFile)}else{await e.file.setContentAsync(e.gitFile),a.files;for(const e of i)null==e.baseGitContent?(s=!0,await a.removeFileAsync(e.name)):await e.setContentAsync(e.baseGitContent)}s?await this.props.parent.reloadHeaderAsync():this.forceUpdate()}async saveGitJsonAsync(e){const t=r.mainEditorPkg().files[pxt.github.GIT_JSON];await t.setContentAsync(JSON.stringify(e,null,4))}async switchProjectToBranchAsync(e){const{header:t}=this.props.parent.state,n=this.getGitJson(),i=this.parsedRepoId();t.githubId=i.fullName+"#"+e,n.repo=t.githubId,await this.saveGitJsonAsync(n),r.invalidatePullRequestStatus(t)}async newBranchAsync(){await f.ensureGitHubTokenAsync();const e=this.parsedRepoId(),t=await pxt.github.getNewBranchNameAsync(e.slug,"patch-"),n=await o.promptAsync({header:lf("New branch name"),body:lf("Name cannot have spaces or special characters. Examples: {0}","my_feature, add-colors, fix_something"),agreeLbl:lf("Create"),initialValue:t,hasCloseIcon:!0,onInputValidation:e=>{if(/[^\w\-]/.test(e))return lf("Don't use spaces or special characters.")}});if(n){this.showLoading("github.branch",!0,lf("creating branch..."));try{const t=this.getGitJson();await pxt.github.createNewBranchAsync(e.slug,n,t.commit.sha),await this.switchProjectToBranchAsync(n),this.forceUpdate()}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}async switchBranchAsync(e){await this.setStateAsync({needsCommitMessage:!1});const t=this.parsedRepoId().tag;try{await this.switchProjectToBranchAsync(e),await this.pullAsync()}finally{this.state.needsCommitMessage&&await this.switchProjectToBranchAsync(t)}}async showSwitchBranchDialogAsync(){const e=this.parsedRepoId(),t=await pxt.github.listRefsExtAsync(e.slug,"heads"),n=Object.keys(t.refs).map((e=>({name:e,description:t.refs[e],onClick:async()=>{o.hideDialog(),await this.switchBranchAsync(e)}})));"master"!==e.tag&&"main"!==e.tag||n.unshift({name:lf("Create new branch"),description:lf("Based on {0}",e.tag),onClick:()=>(o.hideDialog(),this.newBranchAsync())}),await o.confirmAsync({header:lf("Switch to a different branch"),hasCloseIcon:!0,hideAgree:!0,jsx:(0,i.jsx)("div",Object.assign({className:"ui form"},{children:(0,i.jsx)("div",Object.assign({className:"ui relaxed divided list",role:"menu"},{children:n.map((e=>(0,i.jsxs)("div",Object.assign({className:"item link"},{children:[(0,i.jsx)("i",{className:"large github middle aligned icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsx)("a",Object.assign({onClick:e.onClick,role:"menuitem",className:"header",tabIndex:0,onKeyDown:b.fireClickOnEnter},{children:e.name})),(0,i.jsx)("div",Object.assign({className:"description"},{children:e.description}))]}))]}),e.name)))}))}))})}handleBranchClick(e){pxt.tickEvent("github.branch"),e.stopPropagation(),this.showSwitchBranchDialogAsync()}goBack(){pxt.tickEvent("github.backButton",void 0,{interactiveConsent:!0}),this.props.parent.openPreviousEditor()}handlePullClick(e){pxt.tickEvent("github.pull"),this.pullAsync()}async forkAsync(e){const t=this.parsedRepoId(),n=f.githubProvider().user();let r,s=!1;const l=e=>{s=e,o.forceUpdate()},c=()=>{pxt.tickEvent("github.authorize"),f.githubProvider().authorizeAppAsync(s)};e&&n&&t.owner!==n.userName&&await pxt.github.isOrgAsync(t.owner)&&(r=(0,i.jsxs)("div",Object.assign({className:"ui small"},{children:[lf("If you already have write permissions to this repository, you may have to authorize the MakeCode App in the {0} organization.",t.owner),(0,i.jsx)(a.PlainCheckbox,{label:lf("Remember me"),onChange:l}),(0,i.jsx)(a.Link,{className:"ui link",text:lf("Authorize MakeCode"),onClick:c,onKeyDown:b.fireClickOnEnter})]})));const u=e&&(0,i.jsxs)("div",Object.assign({className:"ui message warning"},{children:[lf("Oops, we could not write to {0}.",t.slug),r]})),d=(0,i.jsx)("p",{children:lf("Forking creates a copy of {0} under your account. You can submit your changes back via a pull request.",t.slug)});if(await o.confirmAsync({header:lf("Do you want to fork {0}?",t.slug),hasCloseIcon:!0,helpUrl:"/github/fork",jsx:(0,i.jsxs)("div",{children:[u,d]}),agreeLbl:"Fork",agreeIcon:"copy outline"})){this.showLoading("github.fork",!0,lf("forking repository (this may take a minute or two)..."));try{const e=this.getGitJson(),n=await pxt.github.forkRepoAsync(t.slug,e.commit.sha),{header:i}=this.props.parent.state;i.githubId=n,e.repo=i.githubId,await this.saveGitJsonAsync(e)}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}handleGithubError(e){const t=parseInt(e.statusCode);e.isOffline||0===t?o.warningNotification(lf("Please connect to internet and try again.")):e.needsWritePermission?(o.hideDialog(),this.forkAsync(!0)):e.isMergeConflictMarkerError?(pxt.tickEvent("github.commitwithconflicts"),o.warningNotification(lf("Please merge all conflicts before commiting changes."))):401==t?(f.githubProvider().clearToken(),this.forceUpdate(),o.warningNotification(lf("Please sign in to GitHub again."))):404==t?o.warningNotification(lf("GitHub resource not found; please check that it still exists.")):403==t?o.warningNotification(lf("GitHub rate limit exceeded, please wait and try again.")):(pxt.reportException(e),o.warningNotification(lf("Oops, something went wrong. Please try again.")))}async bumpAsync(){try{l.prepareConfigForGithub(r.mainPkg.readFile(pxt.CONFIG_NAME),!0)}catch(e){return void o.warningNotification(e.message)}let e=r.mainPkg.config.version;try{const t=this.parsedRepoId(),n=await pxt.github.listRefsAsync(t.slug,"tags");e=pxt.semver.sortLatestTags(n)[0]}catch(e){console.log(e)}const t=pxt.semver.parse(e,"0.0.0"),n=pxt.semver.parse(pxt.semver.stringify(t));n.major++,n.minor=0,n.patch=0;const s=pxt.semver.parse(pxt.semver.stringify(t));s.minor++,s.patch=0;const c=pxt.semver.parse(pxt.semver.stringify(t));c.patch++;let d="patch";function h(e){d=e.currentTarget.name,u.forceUpdate()}let p=!1;function f(e){p=!p,u.forceUpdate()}if(!await o.confirmAsync({header:lf("Pick a release version"),agreeLbl:lf("Create release"),disagreeLbl:lf("Cancel"),jsxd:()=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",Object.assign({className:"grouped fields"},{children:[(0,i.jsxs)("label",{children:[lf("Choose a release version that describes the changes you made to the code."),a.helpIconLink("/github/release#versioning",lf("Learn about version numbers."))]}),(0,i.jsx)("div",Object.assign({className:"field"},{children:(0,i.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,i.jsx)("input",{type:"radio",name:"patch",checked:"patch"==d,"aria-checked":"patch"==d,onChange:h}),(0,i.jsx)("label",{children:lf("{0}: patch (bug fixes or other non-user visible changes)",pxt.semver.stringify(c))})]}))})),(0,i.jsx)("div",Object.assign({className:"field"},{children:(0,i.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,i.jsx)("input",{type:"radio",name:"minor",checked:"minor"==d,"aria-checked":"minor"==d,onChange:h}),(0,i.jsx)("label",{children:lf("{0}: minor change (added function or optional parameters)",pxt.semver.stringify(s))})]}))})),(0,i.jsx)("div",Object.assign({className:"field"},{children:(0,i.jsxs)("div",Object.assign({className:"ui radio checkbox"},{children:[(0,i.jsx)("input",{type:"radio",name:"major",checked:"major"==d,"aria-checked":"major"==d,onChange:h}),(0,i.jsx)("label",{children:lf("{0}: major change (renamed functions, deleted parameters or functions)",pxt.semver.stringify(n))})]}))}))]})),(0,i.jsxs)("div",Object.assign({className:"grouped fields"},{children:[(0,i.jsx)("label",{children:lf("Advanced")}),(0,i.jsxs)("div",Object.assign({className:"field checkbox"},{children:[(0,i.jsx)("input",{type:"checkbox",name:"cachetutorial",checked:p,"aria-checked":p,onChange:f}),(0,i.jsx)("label",{children:lf("Optimize for tutorials by caching information about the markdown.")})]}))]}))]})}))return;let g=c;"major"==d?g=n:"minor"==d&&(g=s);const m=pxt.semver.stringify(g);this.showLoading("github.release.new",!0,lf("creating release..."));try{const{header:e}=this.props.parent.state;p&&await this.cacheTutorialInfo(e),await l.bumpAsync(e,m),r.mainPkg.config.version=m,await this.maybeReloadAsync(),this.hideLoading(),o.infoNotification(lf("GitHub release created."))}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}async cacheTutorialInfo(e){const t=/\.md$/,n=this.parsedRepoId();let i=await l.getTextAsync(e.id),r=Object.keys(i).filter((e=>e.match(t)));const o={};for(let e of r){const r=pxt.tutorial.parseTutorial(i[e]),s=pxt.BrowserUtils.getTutorialCodeHash(r.code),a=await g.getUsedBlocksAsync(r.code,e,r.language,!0);if(a){const i=e.replace(t,"");o[`https://github.com/${n.fullName}${"README"==i?"":"/"+i}`]={snippetBlocks:a.snippetBlocks,usedBlocks:a.usedBlocks,highlightBlocks:a.highlightBlocks,validateBlocks:a.validateBlocks,hash:s}}}i[pxt.TUTORIAL_INFO_FILE]=JSON.stringify(o);let s=pxt.Package.parseAndValidConfig(i[pxt.CONFIG_NAME]);return s.files.indexOf(pxt.TUTORIAL_INFO_FILE)<0&&(s.files.push(pxt.TUTORIAL_INFO_FILE),i[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(s)),await l.saveAsync(e,i),await this.commitAsync()}async showLoading(e,t,n){t&&await f.ensureGitHubTokenAsync(),pxt.tickEvent(e),await this.setStateAsync({loadingMessage:n}),o.showLoading("githubjson",n)}hideLoading(){this.state.loadingMessage&&(o.hideLoading("githubjson"),this.setState({loadingMessage:void 0}))}pkgConfigKey(e){const t=JSON.parse(e);return delete t.version,JSON.stringify(t)}async maybeReloadAsync(){const{header:e}=this.props.parent.state,t=await l.getTextAsync(e.id);r.mainEditorPkg().setFiles(t);const n=this.pkgConfigKey(t[pxt.CONFIG_NAME]);m.invalidatePullStatus(e),n!=this.state.previousCfgKey&&(await this.setStateAsync({previousCfgKey:n}),await this.props.parent.reloadHeaderAsync())}async pullAsync(){this.showLoading("github.pull",!1,lf("pulling changes from GitHub..."));const{header:e}=this.props.parent.state;try{switch(await l.pullAsync(this.props.parent.state.header)){case l.PullStatus.NoSourceControl:case l.PullStatus.UpToDate:break;case l.PullStatus.NeedsCommit:this.setState({needsCommitMessage:!0});break;case l.PullStatus.GotChanges:await this.maybeReloadAsync()}}catch(e){this.handleGithubError(e)}finally{m.invalidatePullStatus(e),this.hideLoading()}}getGitJson(){return r.mainPkg.readGitJson()}parsedRepoId(){const e=this.props.parent.state.header;return pxt.github.parseRepoId(e.githubId)}async commitCoreAsync(){const{parent:e}=this.props,{header:t}=e.state,n=t.githubId;if(await l.pullAsync(t),await l.hasMergeConflictMarkersAsync(t))return await this.maybeReloadAsync(),void o.warningNotification(lf("Merge conflicts found. Resolve them before commiting."));let i=await l.commitAsync(t,{message:this.state.description,blocksScreenshotAsync:()=>{var e;return this.props.parent.blocksScreenshotAsync(1,null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.embedBlocksInSnapshot)},blocksDiffScreenshotAsync:()=>{const e=r.mainEditorPkg().sortedFiles().find((e=>e.name==pxt.MAIN_BLOCKS)),t=y.diffXml(e.baseGitContent,e.content);return t&&t.ws?y.toPngAsync(t.ws,1):Promise.resolve(void 0)}});if(i){let e=await l.prAsync(t,i,this.state.description||lf("Commit conflict"));await c.showPRDialogAsync(n,e),await l.pullAsync(t)}else r.invalidatePagesStatus(t),r.invalidatePullRequestStatus(t),await this.maybeReloadAsync();this.setState({description:""})}async commitAsync(){let e=!0;this.setState({needsCommitMessage:!1}),this.showLoading("github.commit",!0,lf("commit and push changes to GitHub..."));try{await this.commitCoreAsync(),await this.maybeReloadAsync()}catch(t){e=!1,pxt.tickEvent("github.commit.fail"),this.handleGithubError(t)}finally{e&&pxt.tickEvent("github.commit.success"),this.hideLoading()}}setVisible(e){if(e===this.state.isVisible)return;const{header:t}=this.props.parent.state;e?(d.invalidateHeader("pkg-git-pr",t),this.setState({previousCfgKey:this.pkgConfigKey(r.mainEditorPkg().files[pxt.CONFIG_NAME].content)})):(this.clearCacheDiff(),this.setState({needsCommitMessage:!1}))}async handlePullRequest(){const e=this.parsedRepoId();if(!await o.confirmAsync({header:lf("Create pull request"),jsx:(0,i.jsx)("p",{children:lf("Pull requests let you tell others about changes you've pushed to a branch in a repository on GitHub.")}),helpUrl:"/github/pull-request",hasCloseIcon:!0}))return;const t=e.tag;this.showLoading("github.createpr",!0,lf("creating pull request..."));try{const e=this.parsedRepoId(),n=`\n### ${lf("How to use this pull request")}\n\n- [ ] ${lf("assign a reviewer (you can be your own reviewer)")}\n- [ ] ${lf("reviewer approves or requests changes")}\n- [ ] ${lf("apply requested changes if any")}\n- [ ] ${lf("merge once approved")}\n`,i=await pxt.github.createPRFromBranchAsync(e.slug,"master",e.tag,t,n);d.invalidateHeader("pkg-git-pr",this.props.parent.state.header),o.infoNotification(lf("Pull request created successfully!",i))}catch(e){422==e.statusCode?o.warningNotification(lf("Please commit changes before creating a pull request.")):this.handleGithubError(e)}finally{this.hideLoading()}}computeDiffFiles(){const e=r.mainEditorPkg().sortedFiles();return e.map((t=>{const n=t.publishedContent();if(t.baseGitContent!=n){const i={file:t,name:t.name,gitFile:t.baseGitContent,editorFile:n};if(/\.blocks$/.test(t.name)){const n=t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),r=e.find((e=>e.name==n));r&&(i.tsGitFile=r.baseGitContent,i.tsEditorFile=r.publishedContent())}return i}})).filter((e=>!!e))}async handleSignoutGithub(){pxt.tickEvent("github.signout"),this.props.parent.signOutGithub()}renderCore(){const e=this.getGitJson();if(!e)return(0,i.jsx)("div",{});const{header:t}=this.props.parent.state,n=r.mainPkg.getPreferredEditor()==pxt.BLOCKS_PROJECT_NAME,o=this.computeDiffFiles(),s=o.length>0,c=this.getData("pkg-git-pull-status:"+t.id),u=c==l.PullStatus.BranchNotFound||c==l.PullStatus.NoSourceControl,d=c==l.PullStatus.GotChanges,h=this.parsedRepoId(),p="master"===h.tag,f="main"===h.tag,g=this.getData("github:user"),m=`https://github.com/${h.slug}/${p&&!h.fileName?"":pxt.github.join("tree",h.tag||"master",h.fileName)}`,y=!pxt.github.token,v=this.getData("pkg-git-pr:"+t.id),S=null!==v&&(e.isFork||!p),A=S&&v&&v.number>0,I=S&&v&&v.number<=0,O=g&&g.id===h.owner;return(0,i.jsxs)("div",Object.assign({id:"githubArea"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui serialHeader"},{children:[(0,i.jsx)("div",Object.assign({className:"leftHeaderWrapper"},{children:(0,i.jsx)("div",Object.assign({className:"leftHeader"},{children:(0,i.jsx)(a.Button,{title:lf("Go back"),icon:"arrow left",text:lf("Go back"),textClass:"landscape only",tabIndex:0,onClick:this.goBack,onKeyDown:b.fireClickOnEnter})}))})),(0,i.jsxs)("div",Object.assign({className:"rightHeader"},{children:[(0,i.jsx)(a.Button,{icon:""+(u?"exclamation circle":d?"long arrow alternate down":"check"),className:!0===d?"positive":"",text:lf("Pull changes"),title:lf("Pull changes from GitHub to get your code up-to-date."),onClick:this.handlePullClick,onKeyDown:b.fireClickOnEnter}),!n&&O&&(0,i.jsx)(a.Link,{className:"ui item button desktop only",icon:"user plus",href:`https://github.com/${h.slug}/settings/collaboration`,target:"_blank",title:lf("Invite others to contributes to this GitHub repository.")}),(0,i.jsx)(a.Link,{className:"ui button",icon:"external alternate",href:m,title:lf("Open repository in GitHub."),target:"_blank",onKeyDown:b.fireClickOnEnter})]}))]})),(0,i.jsx)(E,{parent:this,needsToken:y,githubId:h,master:p,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),(0,i.jsxs)("div",Object.assign({className:"ui form"},{children:[A&&(0,i.jsx)(a.Link,{href:v.url,role:"button",className:"ui tiny basic button create-pr",target:"_blank",text:lf("Pull request (#{0})",v.number),icon:"external alternate"}),I&&(0,i.jsx)(a.Button,{className:"tiny basic create-pr",text:lf("Create pull request"),onClick:this.handlePullRequest}),(0,i.jsxs)("h3",Object.assign({className:"header"},{children:[(0,i.jsx)("i",{className:"large github icon"}),(0,i.jsx)("span",Object.assign({className:"repo-name"},{children:h.fullName})),(0,i.jsxs)("span",Object.assign({onClick:this.handleBranchClick,onKeyDown:b.fireClickOnEnter,tabIndex:0,role:"button",className:"repo-branch"},{children:["#"+h.tag,(0,i.jsx)("i",{className:"dropdown icon"})]}))]})),s&&(0,i.jsx)(T,{parent:this,needsToken:y,githubId:h,master:p,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),A&&!s&&(0,i.jsx)(x,{parent:this,needsToken:y,githubId:h,master:p,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),o&&(0,i.jsx)(_,{parent:this,diffFiles:o,cacheKey:e.commit.sha,allowRevert:!0,showWhitespaceDiff:!0,blocksMode:n,showConflicts:!0}),(0,i.jsx)(C,{parent:this,needsToken:y,githubId:h,master:p,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),(p||f)&&(0,i.jsx)(w,{parent:this,needsToken:y,githubId:h,master:p||f,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),!n&&(0,i.jsx)(k,{parent:this,needsToken:y,githubId:h,master:p,gs:e,isBlocks:n,needsCommit:s,user:g,pullStatus:c,pullRequest:v}),(0,i.jsx)("div",{})]})),(0,i.jsx)("div",Object.assign({className:"ui serialHeader"},{children:(0,i.jsx)("div",Object.assign({className:"rightHeader"},{children:g&&(0,i.jsx)(a.Button,{className:"ui button",icon:"fas fa-sign-out-alt",text:lf("Disconnect GitHub"),title:lf("Log out of GitHub"),onClick:this.handleSignoutGithub,onKeyDown:b.fireClickOnEnter})}))}))]}))}}class _ extends a.StatelessUIElement{constructor(e){super(e),this.revertAllFiles=this.revertAllFiles.bind(this)}lineDiff(e,t){const n=pxt.diff.compute(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:(0,i.jsx)("div",Object.assign({className:"inline-diff"},{children:(0,i.jsx)("code",{children:e})})),b:(0,i.jsx)("div",Object.assign({className:"inline-diff"},{children:(0,i.jsx)("code",{children:t})}))};const r=[],o=[];for(let e=0;e<n.length;){let t=e;const s=n[e][0];for(;n[t]&&n[t][0]==s;)t++;const a=n.slice(e,t).map((e=>e.slice(2))).join("");" "==s?(r.push((0,i.jsx)("code",Object.assign({className:"ch-common"},{children:a}),e)),o.push((0,i.jsx)("code",Object.assign({className:"ch-common"},{children:a}),e))):"-"==s?r.push((0,i.jsx)("code",Object.assign({className:"ch-removed"},{children:a}),e)):"+"==s?o.push((0,i.jsx)("code",Object.assign({className:"ch-added"},{children:a}),e)):pxt.Util.oops(),e=t}return{a:(0,i.jsx)("div",Object.assign({className:"inline-diff"},{children:r})),b:(0,i.jsx)("div",Object.assign({className:"inline-diff"},{children:o}))}}showDiff(e){const{cacheKey:t,blocksMode:n,showConflicts:o,showWhitespaceDiff:s}=this.props,l=this.props.parent.cachedDiff(t,e);if(l.diff&&l.file.gitFile==e.gitFile&&l.file.editorFile==e.editorFile)return l.diff;const c=/\.blocks$/.test(e.name),u=()=>{l.whitespace||(l.whitespace=!0,l.diff=d(),this.forceUpdate())},d=()=>{let r;return r=c?this.createBlocksDiffJSX(e):this.createTextDiffJSX(e,!l.whitespace),(0,i.jsxs)("div",Object.assign({className:"ui segments filediff"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui segment diffheader"},{children:[(!n||e.name!=pxt.MAIN_BLOCKS)&&(0,i.jsx)("span",{children:e.name}),!!l.revert&&(0,i.jsx)(a.Button,{className:"small",icon:"undo",text:lf("Revert"),ariaLabel:lf("Revert file"),title:lf("Revert file"),textClass:"landscape only",onClick:l.revert}),r.legendJSX,o&&!!r.conflicts&&(0,i.jsx)("p",{children:lf("Merge conflicts found. Resolve them before commiting.")}),!!l.revert&&!!h.length&&(0,i.jsx)("p",{children:lf("Reverting this file will also restore: {0}",h.join(", "))}),!!l.revert&&!!p.length&&(0,i.jsx)("p",{children:lf("Reverting this file will also remove: {0}",p.join(", "))}),!!l.revert&&!!f.length&&!n&&(0,i.jsx)("p",{children:lf("Reverting this file will also revert: {0}",f.map((e=>e.name)).join(", "))})]})),r.diffJSX?(0,i.jsx)("div",Object.assign({className:"ui segment diff"},{children:r.diffJSX})):(0,i.jsx)("div",Object.assign({className:"ui segment"},{children:(0,i.jsxs)("p",{children:[lf("Whitespace changes only."),s&&(0,i.jsx)(a.Link,{className:"link",text:lf("Show"),onClick:u})]})}))]}),`difffile${t}${e.name}`)};let h=[],p=[];if(e.name==pxt.CONFIG_NAME){const t=pxt.Package.parseAndValidConfig(e.gitFile),n=pxt.Package.parseAndValidConfig(e.editorFile);if(t&&n){const e=pxt.allPkgFiles(t),i=pxt.allPkgFiles(n);h=e.filter((e=>-1==i.indexOf(e))),p=i.filter((t=>-1==e.indexOf(t)))}}const f=[];if(l.file=e,this.props.allowRevert){const t=r.mainEditorPkg().files,i=n&&t[e.file.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];i&&i!=e.file&&f.push(i);for(const t of r.mainEditorPkg().getGeneratedFiles(e.file))f.push(t);l.revert=()=>this.props.parent.revertFileAsync(e,h,p,f)}return l.diff=d(),l.diff}createBlocksDiffJSX(e){const t=e.gitFile||"",n=e.editorFile;let r;if(n){let o;o=e.tsEditorFile&&y.needsDecompiledDiff(t,n)?`\n\`\`\`diffblocks\n${e.tsGitFile||""}\n---------------------\n${e.tsEditorFile}\n\`\`\`\n`:`\n\`\`\`diffblocksxml\n${t}\n---------------------\n${n}\n\`\`\`\n`,r=(0,i.jsx)(h.MarkedContent,{parent:this.props.parent.props.parent,markdown:o},`diffblocksxxml${e.name}`)}else r=(0,i.jsx)("div",Object.assign({className:"ui basic segment"},{children:lf("Your blocks were updated. Go back to the editor to view the changes.")}));return{diffJSX:r,legendJSX:(0,i.jsxs)("p",Object.assign({className:"legend"},{children:[(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"added icon"}),lf("added, changed or moved")]}),(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"deleted icon"}),lf("deleted")]}),(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"notchanged icon"}),lf("not changed")]}),a.helpIconLink("/github/diff#blocks",lf("Learn about reading differences in blocks code."))]})),conflicts:0}}createTextDiffJSX(e,t){const{showConflicts:n}=this.props,r=e.gitFile||"",o=e.editorFile||"",s={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},l=pxt.diff.compute(r,o,{ignoreWhitespace:!!t});if(!l)return pxt.tickEvent("github.diff.toobig"),{diffJSX:(0,i.jsx)("div",{children:lf("Too many differences to render diff.")}),conflicts:0};let c=0,u="",d=0,h=0,p="",f=null;const g=[];return l.forEach(((t,r)=>{const o=/^@@ -(\d+),\d+ \+(\d+),\d+/.exec(t);o?(d=parseInt(o[1])-1,h=parseInt(o[2])-1):("+"!=t[0]&&d++,"-"!=t[0]&&h++);const m=l[r+1]?l[r+1][0]:"",b=l[r+2]?l[r+2][0]:"",y=t.slice(2);let v=(0,i.jsx)("code",{children:y});if(f)v=f,f=null;else if(!("-"!=t[0]||" "!=p&&"@"!=p||"+"!=m||" "!=b&&"@"!=b&&""!=b)){const e=this.lineDiff(t.slice(2),l[r+1].slice(2));v=e.a,f=e.b}let _=p=t[0];if("+"==p&&/^<<<<<<<[^<]/.test(y)){c++,u="local",_="@",g.push((0,i.jsx)("tr",Object.assign({className:"conflict ui small header"},{children:(0,i.jsx)("td",Object.assign({colSpan:4,className:"ui small header"},{children:lf("Merge conflict")}))}),"conflictheader"+d+h)),g.push((0,i.jsx)("tr",Object.assign({className:"conflict ui description"},{children:(0,i.jsxs)("td",Object.assign({colSpan:4,className:"ui small description"},{children:[lf("Changes from GitHub are conflicting with local changes."),a.helpIconLink("/github/merge-conflict",lf("Learn about merge conflicts and resolution."))]}))}),"conflictdescr"+d+h));const t=Math.min(d,h),r=()=>this.handleMergeConflictResolution(e,t,!0,!1),o=()=>this.handleMergeConflictResolution(e,t,!1,!0),s=()=>this.handleMergeConflictResolution(e,t,!0,!0);n&&g.push((0,i.jsx)("tr",Object.assign({className:"conflict ui mergebtn"},{children:(0,i.jsxs)("td",Object.assign({colSpan:4,className:"ui"},{children:[(0,i.jsx)(a.Button,{className:"compact",text:lf("Keep local"),title:lf("Ignore the changes from GitHub."),onClick:r}),(0,i.jsx)(a.Button,{className:"compact",text:lf("Keep remote"),title:lf("Override local changes with changes from GitHub."),onClick:o}),(0,i.jsx)(a.Button,{className:"compact",text:lf("Keep both"),title:lf("Keep both local and remote changes."),onClick:s})]}))}),"merge"+d+h))}else"+"==p&&/^>>>>>>>[^>]/.test(y)?(u="footer",_="@"):"+"==p&&/^=======$/.test(y)&&(_="@",u="remote");const E="@"==_,T=`${u?"conflict":""} ${u} ${s[_]}`;g.push((0,i.jsxs)("tr",Object.assign({className:T},{children:[(0,i.jsx)("td",{className:"line-a","data-content":d}),(0,i.jsx)("td",{className:"line-b","data-content":h}),E?(0,i.jsx)("td",Object.assign({colSpan:2,className:"change"},{children:(0,i.jsx)("code",{children:t})})):(0,i.jsx)("td",{className:"marker","data-content":_}),E?void 0:(0,i.jsx)("td",Object.assign({className:"change"},{children:v}))]}),d+h)),"footer"==u&&(u="")})),{diffJSX:g.length?(0,i.jsx)("table",Object.assign({className:"diffview"},{children:(0,i.jsx)("tbody",{children:g})})):void 0,legendJSX:void 0,conflicts:c}}handleMergeConflictResolution(e,t,n,i){pxt.tickEvent("github.conflict.resolve",{local:n?1:0,remote:i?1:0},{interactiveConsent:!0});const r=pxt.diff.resolveMergeConflictMarker(e.file.content,t,n,i);e.file.setContentAsync(r).then((()=>this.props.parent.clearCacheDiff(this.props.cacheKey,e))).then((()=>this.props.parent.forceUpdate()))}revertAllFiles(){this.props.parent.revertAllFilesAsync()}renderCore(){const{diffFiles:e,blocksMode:t,allowRevert:n}=this.props,r=pxt.appTarget.appTheme,o=r.invertedMenu&&r.invertedMonaco,s=t&&!pxt.options.debug?e.filter((e=>/\.blocks$/.test(e.name))):e;return e.length?(0,i.jsxs)("div",Object.assign({className:"ui section"},{children:[(0,i.jsxs)("div",Object.assign({className:`ui ${o?"inverted ":""} diffheader segment`},{children:[lf("There are local changes."),n&&(0,i.jsx)(a.Button,{className:"small",icon:"undo",text:lf("Revert all"),ariaLabel:lf("Revert all changes"),title:lf("Revert all changes"),textClass:"landscape only",onClick:this.revertAllFiles})]})),s.map((e=>this.showDiff(e)))]})):(0,i.jsx)("div",Object.assign({className:`ui ${o?"inverted ":""}segment`},{children:lf("No local changes found.")}))}}class E extends a.StatelessUIElement{constructor(e){super(e),this.handleSwitchMasterBranch=this.handleSwitchMasterBranch.bind(this)}handleSwitchMasterBranch(e){pxt.tickEvent("github.branch.switch"),e.stopPropagation(),this.props.parent.switchBranchAsync("master")}renderCore(){const{needsCommitMessage:e}=this.props.parent.state,{pullStatus:t,pullRequest:n,githubId:r}=this.props,o="CLOSED"==(null==n?void 0:n.state),s="MERGED"==(null==n?void 0:n.state);return o||s?(0,i.jsxs)("div",Object.assign({className:"ui icon negative message"},{children:[(0,i.jsx)("i",{className:"exclamation circle icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[o&&lf("This Pull Request is closed!"),s&&lf("This pull request has been merged."),(0,i.jsx)("span",Object.assign({role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:b.fireClickOnEnter},{children:lf("Switch to master branch")}))]}))]})):t==l.PullStatus.NoSourceControl?(0,i.jsxs)("div",Object.assign({className:"ui icon warning message"},{children:[(0,i.jsx)("i",{className:"exclamation circle icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[lf("This repository was not found. It might have been deleted or you may not have rights to access it."),(0,i.jsx)(a.Link,{href:`https://github.com/${r.slug}`,text:lf("Go to GitHub")})]}))]})):t==l.PullStatus.BranchNotFound?(0,i.jsxs)("div",Object.assign({className:"ui icon warning message"},{children:[(0,i.jsx)("i",{className:"exclamation circle icon"}),(0,i.jsxs)("div",Object.assign({className:"content"},{children:[lf("This branch was not found, please pull again or switch to a different branch."),(0,i.jsx)("span",Object.assign({role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:b.fireClickOnEnter},{children:lf("Switch to master branch")}))]}))]})):e?(0,i.jsx)("div",Object.assign({className:"ui warning message"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:lf("You need to commit your changes before you can pull from GitHub.")}))})):(0,i.jsx)("div",{})}}class T extends a.StatelessUIElement{constructor(e){super(e),this.handleDescriptionChange=this.handleDescriptionChange.bind(this),this.handleCommitClick=this.handleCommitClick.bind(this)}handleDescriptionChange(e){this.props.parent.setState({description:e})}async handleCommitClick(e){pxt.tickEvent("github.commit"),e.stopPropagation(),await f.githubProvider().loginAsync(),pxt.github.token&&await this.props.parent.commitAsync()}renderCore(){const{description:e}=this.props.parent.state,t=e&&e.length>70?lf("Your description is getting long..."):void 0;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsx)(a.Input,{type:"text",placeholder:lf("Describe your changes."),value:this.props.parent.state.description,onChange:this.handleDescriptionChange,error:t})})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{className:"green",text:lf("Commit and push changes"),icon:"long arrow alternate up",onClick:this.handleCommitClick,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Save your changes in GitHub."),a.helpIconLink("/github/commit",lf("Learn about commiting and pushing code into GitHub."))]}))]}))]})}}class x extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPullRequestStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(r.invalidatePullRequestStatus(e),this.pullRequestStatus())}),1e4,!1),this.handleMergeClick=this.handleMergeClick.bind(this)}pullRequestStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pr:"+e.id);return"UNKNOWN"===(null==t?void 0:t.mergeable)&&"OPEN"===(null==t?void 0:t.state)&&this.scheduleRefreshPullRequestStatus(),t}handleMergeClick(e){pxt.tickEvent("github.pr.merge",null,{interactiveConsent:!0}),e.stopPropagation();const{githubId:t}=this.props,n=this.props.parent.props.parent.state.header,r=this.props.parent.getData("pkg-git-pr:"+n.id);o.promptAsync({header:lf("Squash and merge?"),jsx:(0,i.jsx)("p",{children:lf("Your changes will merged as a single commit into the base branch and you will switch back to the base branch.")}),agreeLbl:lf("Confirm merge"),helpUrl:"/github/pull-request",hasCloseIcon:!0,placeholder:lf("Describe your changes")}).then((e=>null===e?Promise.resolve():this.props.parent.fastForwardMergeAsync(t,r,e)))}renderCore(){const{gs:e,githubId:t}=this.props,n=this.pullRequestStatus(),r=!!e.mergeSha,o="MERGEABLE"===n.mergeable,s="OPEN"===n.state,l=s&&"UNKNOWN"===n.mergeable,c=r?"sync":o?"check":l?"circle outline":"exclamation triangle",u=r?"orange":o?"green":l?"orange":"grey",d=r?lf("A merge is in progress. Please resolve conflicts or cancel it"):o?lf("This branch has no conflicts with the base branch"):l?lf("Checking if your branch can be merged"):lf("This branch has conflicts that must be resolved");return s?(0,i.jsxs)("div",Object.assign({className:`ui ${u} segment`},{children:[(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsxs)("div",Object.assign({className:"ui"},{children:[(0,i.jsx)("i",{className:`icon ${u} inverted circular ${c}`}),d]}))})),!o&&!l&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Link,{className:"button",text:lf("Resolve conflicts"),href:`https://github.com/${t.slug}/pull/${n.number}/conflicts`,target:"_blank"}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Resolve merge conflicts in GitHub."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))]}))]})),o&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{className:u,text:lf("Squash and merge"),onClick:this.handleMergeClick,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Merge your changes as a single commit into the base branch."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))]}))]}))]})):(0,i.jsx)("div",{})}}class w extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPageStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(r.invalidatePagesStatus(e),this.pagesStatus())}),1e4,!1),this.handleBumpClick=this.handleBumpClick.bind(this)}handleBumpClick(e){pxt.tickEvent("github.releasezone.bump",void 0,{interactiveConsent:!0}),e.stopPropagation();const{needsCommit:t,master:n}=this.props,i=this.props.parent.props.parent.state.header;t?o.confirmAsync({header:lf("Commit your changes..."),body:lf("You need to commit your local changes to create a release."),agreeLbl:lf("Ok"),hideAgree:!0}):n?f.githubProvider().loginAsync().then((()=>pxt.github.token&&this.props.parent.bumpAsync())).finally((()=>r.invalidatePagesStatus(i))):o.confirmAsync({header:lf("Checkout the master branch..."),body:lf("You need to checkout the master branch to create a release."),agreeLbl:lf("Ok"),hideAgree:!0})}pagesStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pages:"+e.id);return t&&"building"==t.status&&this.scheduleRefreshPageStatus(),t}renderCore(){const{gs:e,needsCommit:t}=this.props,n=e.commit&&e.commit.tag,r=!!pxt.appTarget.appTheme.githubCompiledJs;if(t)return(0,i.jsx)("div",{});const o=this.pagesStatus(),s=o&&!!o.html_url,l=o&&"building"==o.status,c=!!pxt.appTarget.appTheme.invertedGitHub;return(0,i.jsxs)("div",Object.assign({className:`ui transparent ${c?"inverted":""} segment`},{children:[(0,i.jsx)("div",Object.assign({className:"ui header"},{children:lf("Release zone")})),!t&&!n&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{className:"basic",text:lf("Create release"),inverted:c,onClick:this.handleBumpClick,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Snapshot and publish your code."),a.helpIconLink("/github/release",lf("Learn more about extension releases."))]}))]})),!t&&n&&(0,i.jsx)("div",Object.assign({className:"ui field"},{children:(0,i.jsxs)("p",Object.assign({className:"inline-help"},{children:[lf("Current release: {0}",n),a.helpIconLink("/github/release",lf("Learn about releases."))]}))})),s&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Link,{className:"basic button",href:o.html_url,inverted:c,loading:l,text:lf("Open Pages"),target:"_blank"}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[l?lf("Pages building, it may take a few minutes."):r?lf("Commit & create release to update Pages."):lf("Commit to update Pages."),a.helpIconLink("/github/pages",lf("Learn about GitHub Pages."))]}))]}))]}))}}class k extends a.StatelessUIElement{constructor(e){super(e),this.handleForkClick=this.handleForkClick.bind(this),this.handleSaveClick=this.handleSaveClick.bind(this)}handleForkClick(e){pxt.tickEvent("github.extensionzone.fork",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.forkAsync(!1)}handleSaveClick(e){pxt.tickEvent("github.extensionzone.save",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.props.parent.saveAndCompile()}renderCore(){const{needsToken:e,githubId:t,gs:n,user:r}=this.props,o=this.props.parent.props.parent.state.header,s=!e&&n.commit&&!n.commit.tree.tree.some((e=>/^LICENSE/.test(e.path.toUpperCase())||/^COPYING/.test(e.path.toUpperCase()))),l=o&&`${window.location.href.replace(/#.*$/,"")}#testproject:${o.id}`,c=r&&r.id!=t.owner,u=!!pxt.appTarget.appTheme.invertedGitHub;return(0,i.jsxs)("div",Object.assign({className:`ui transparent ${u?"inverted":""} segment`},{children:[(0,i.jsx)("div",Object.assign({className:"ui header"},{children:lf("Extension zone")})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Link,{className:"basic button",href:l,inverted:u,text:lf("Test Extension"),target:`${pxt.appTarget.id}testproject`}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Open a test project that uses this extension."),a.helpIconLink("/github/test-extension",lf("Learn about testing extensions."))]}))]})),c&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{className:"basic",text:lf("Fork repository"),onClick:this.handleForkClick,inverted:u,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Fork your own copy of {0} to your account.",t.slug),a.helpIconLink("/github/fork",lf("Learn more about forking repositories."))]}))]})),s&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Link,{className:"basic button",href:`https://github.com/${t.slug}/community/license/new?branch=${t.tag}&template=mit`,inverted:u,text:lf("Add license"),target:"_blank"}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Your project doesn't seem to have a license."),a.helpIconLink("/github/license",lf("Learn more about licenses."))]}))]})),(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{className:"basic",text:lf("Save for offline"),onClick:this.handleSaveClick,inverted:u,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Export this extension to a file that can be imported without Internet."),a.helpIconLink("/github/offline",lf("Learn more about offline support for extensions."))]}))]}))]}))}}class S extends a.UIElement{constructor(e){super(e),this.handleRestore=this.handleRestore.bind(this)}loadDiffFilesAsync(){const{githubId:e,commit:t}=this.props;this.setState({loading:!0}),pxt.github.getCommitAsync(e.slug,t.sha).then((e=>this.computeDiffAsync(e))).then((e=>this.setState({diffFiles:e}))).finally((()=>this.setState({loading:!1})))}computeDiffAsync(e){const{githubId:t}=this.props,n=r.mainEditorPkg().sortedFiles(),i={};return Promise.all(n.map((n=>{const r=n.name;return pxt.github.lookupFile(t,e,r)?pxt.github.downloadTextAsync(t.fullName,e.sha,r).then((e=>{i[r]=e})):Promise.resolve()}))).then((()=>n.map((e=>{const t=e.name,r=i[t],o=/\.blocks$/.test(t),s=e.publishedContent();if(r===s)return;const a={file:e,name:e.name,gitFile:r,editorFile:s};if(o&&y.needsDecompiledDiff(r,s)){const t=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),r=n.find((e=>e.name==t)),o=i[t];r&&o&&(a.tsEditorFile=r.publishedContent(),a.tsGitFile=o)}return a})))).then((e=>e.filter((e=>!!e))))}handleRestore(e){e.stopPropagation(),pxt.tickEvent("github.restore",void 0,{interactiveConsent:!0});const{commit:t}=this.props;return o.confirmAsync({header:lf("Would you like to restore this commit?"),body:lf("You will restore your project to the point in time when this commit was made. Don't worry, you can undo this action by restoring to the previous commit."),agreeLbl:lf("Restore"),agreeClass:"green"}).then((e=>{e&&(o.showLoading("github.restore",lf("restoring commit...")),l.restoreCommitAsync(this.props.parent.props.parent.state.header,t).then((()=>(d.invalidate("gh-commits:*"),this.props.parent.props.parent.reloadHeaderAsync()))).finally((()=>o.hideLoading("github.restore"))))})),!1}renderCore(){const{parent:e,commit:t,expanded:n,onClick:r}=this.props,{diffFiles:o,loading:s}=this.state,l=new Date(Date.parse(t.author.date));return!n||o||s||this.loadDiffFilesAsync(),(0,i.jsx)("div",Object.assign({className:"ui item link",role:"button",onClick:r,onKeyDown:b.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[n&&(0,i.jsx)(a.Button,{loading:s,className:"right floated",text:lf("Restore"),onClick:this.handleRestore,onKeyDown:b.fireClickOnEnter}),(0,i.jsx)("div",Object.assign({className:"meta"},{children:(0,i.jsx)("span",{children:l.toLocaleTimeString()})})),(0,i.jsx)("div",Object.assign({className:"description"},{children:t.message})),n&&o&&(0,i.jsx)("div",Object.assign({className:"ui inverted segment"},{children:lf("Comparing selected commit with local files")})),n&&o&&(0,i.jsx)(_,{parent:e,blocksMode:!1,diffFiles:o,cacheKey:t.sha})]}))}))}}class C extends a.UIElement{constructor(e){super(e),this.handleLoadClick=this.handleLoadClick.bind(this)}handleLoadClick(){pxt.tickEvent("github.history.load",void 0,{interactiveConsent:!0});const{expanded:e}=this.state;this.setState({expanded:!e,selectedCommit:void 0,selectedDay:void 0})}renderCore(){const{githubId:e,gs:t,parent:n}=this.props,{selectedCommit:r,expanded:o,selectedDay:s}=this.state,l=!!pxt.appTarget.appTheme.invertedGitHub,c=o&&this.getData(`gh-commits:${e.slug}#${t.commit.sha}`),u=o&&!c,d={};return c&&c.forEach((e=>{const t=new Date(Date.parse(e.author.date)).toLocaleDateString();let n=d[t];n||(n=d[t]=[]),n.push(e)})),(0,i.jsxs)("div",Object.assign({className:`ui transparent ${l?"inverted":""} segment`},{children:[(0,i.jsx)("div",Object.assign({className:"ui header"},{children:lf("History")})),(u||!o)&&(0,i.jsxs)("div",Object.assign({className:"ui field"},{children:[(0,i.jsx)(a.Button,{loading:u,className:"basic",text:lf("View commits"),onClick:this.handleLoadClick,inverted:l,onKeyDown:b.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"inline-help"},{children:[lf("Restore your project to a previous commit."),a.helpIconLink("/github/history",lf("Learn more about history of commits."))]}))]})),c&&(0,i.jsx)("div",Object.assign({className:"ui items"},{children:Object.keys(d).map((t=>(0,i.jsx)("div",Object.assign({role:"button",className:"ui link item",onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectday"),this.setState({selectedDay:s===t?void 0:t,selectedCommit:void 0})},onKeyDown:b.fireClickOnEnter},{children:(0,i.jsxs)("div",Object.assign({className:"content"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui header"},{children:[t,(0,i.jsxs)("div",Object.assign({className:"ui label button"},{children:[(0,i.jsx)("i",{className:"long arrow alternate up icon"})," ",d[t].length]}))]})),t===s&&(0,i.jsx)("div",Object.assign({className:"ui divided items"},{children:d[t].map((t=>(0,i.jsx)(S,{onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectcommit",void 0,{interactiveConsent:!0});const{selectedCommit:n}=this.state;this.setState({selectedCommit:t==n?void 0:t})},commit:t,parent:n,githubId:e,expanded:r===t},"commit"+t.sha)))}))]}))}),"commitday"+t)))}))]}))}}class A extends s.Editor{constructor(e){super(e),this.parent=e,this.handleViewRef=e=>{this.view=e,this.view&&this.view.setVisible(this.isVisible)},this.handleViewRef=this.handleViewRef.bind(this)}getId(){return"githubEditor"}getCurrentSource(){return r.mainEditorPkg().files[pxt.github.GIT_JSON].content}hasHistory(){return!0}hasEditorToolbar(){return!1}setVisible(e){this.isVisible=e,this.view&&this.view.setVisible(e)}setHighContrast(e){}acceptsFile(e){return e.name===pxt.github.GIT_JSON}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>p.getBlocksAsync())).then((()=>this.parent.forceUpdate()))}display(){if(!this.isVisible)return;const e=this.parent.state.header;return e&&e.githubId?(0,i.jsx)(v,{ref:this.handleViewRef,parent:this.parent}):void 0}}n.Editor=A},{"../../pxtblocks":68,"./cloudsync":201,"./compiler":204,"./core":279,"./coretsx":280,"./data":282,"./dialogs":289,"./marked":313,"./package":325,"./srceditor":345,"./sui":346,"./tutorial":350,"./util":352,"./workspace":354,"react/jsx-runtime":549}],302:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebCam=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui"),s=e("./util");class a extends r.Component{constructor(e){super(e),this.handleVideoRef=e=>{this.video=e},this.state={hasPrompt:!0},this.handleDeviceClick=this.handleDeviceClick.bind(this),this.handleClose=this.handleClose.bind(this)}handleDeviceClick(e){this.setState({hasPrompt:!1}),pxt.debug("greenscreen: start"),this.deviceId=e,this.deviceId&&navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}},audio:!1}).then((e=>{pxt.debug("greenscreen: stream acquired");try{this.stream=e,this.video.srcObject=this.stream,this.video.play();const t=this.stream.getVideoTracks()[0];if(t){const e="environment"!==t.getSettings().facingMode;this.setState({userFacing:e})}}catch(e){pxt.debug("greenscreen: play failed"),console.error(e),this.stop()}}),(e=>{pxt.debug("greenscreen: get camera failed"),console.error(e),this.stop()}))}handleClose(){this.deviceId||this.props.close()}componentDidMount(){void 0!==typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia&&!pxt.BrowserUtils.isElectron()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((()=>navigator.mediaDevices.enumerateDevices())).then((e=>{this.setState({devices:e.filter((e=>"videoinput"==e.kind))})}),(e=>{pxt.debug("greenscreen: enumerate devices failed"),console.error(e)}))}componentWillUnmount(){this.stop()}stop(){if(this.deviceId=void 0,this.stream){try{const e=this.stream.getTracks();e&&e.forEach((e=>e.stop()))}catch(e){}this.stream=void 0}if(this.video)try{this.video.srcObject=void 0}catch(e){}}render(){const{hasPrompt:e,devices:t,userFacing:n}=this.state;return(0,i.jsxs)("div",Object.assign({className:"videoContainer"},{children:[(0,i.jsx)("video",{className:n?"flipx":"",autoPlay:!0,playsInline:!0,ref:this.handleVideoRef,width:"100%"}),e?(0,i.jsx)(o.Modal,Object.assign({isOpen:e,onClose:this.handleClose,closeIcon:!0,dimmer:!0,header:lf("Choose a camera")},{children:(0,i.jsxs)("div",Object.assign({className:"ui cards "+(t?"":"loading")},{children:[(0,i.jsx)(l,{icon:"green tint",onClick:this.handleDeviceClick,deviceId:"",header:lf("Green background")},"devicegreenscreen"),t&&t.map(((e,t)=>(0,i.jsx)(l,{icon:"video camera",onClick:this.handleDeviceClick,deviceId:e.deviceId,header:e.label||lf("camera {0}",t)},`device${t}`)))]}))})):void 0]}))}}n.WebCam=a;class l extends r.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{deviceId:e,onClick:t}=this.props;t(e)}renderCore(){const{header:e,icon:t}=this.props;return(0,i.jsxs)("div",Object.assign({role:"button",className:"ui card link",tabIndex:0,onClick:this.handleClick,onKeyDown:s.fireClickOnEnter},{children:[(0,i.jsx)("div",Object.assign({className:"imageicon"},{children:(0,i.jsx)(o.Icon,{icon:`${t} massive`})})),(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)("span",Object.assign({className:"header"},{children:e}))}))]}))}}},{"./data":282,"./sui":346,"./util":352,"react/jsx-runtime":549}],303:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HeaderBar=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui"),s=e("./auth"),a=e("./cmds"),l=e("./container"),c=e("./identity"),u=e("./package"),d=e("./projects"),h=e("./tutorial");class p extends r.Component{constructor(e){super(e),this.goHome=()=>{pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),"home"!==this.getView()&&this.props.parent.showExitAndSaveDialog()},this.showShareDialog=()=>{pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},this.launchFullEditor=()=>{pxt.tickEvent("sandbox.openfulleditor",void 0,{interactiveConsent:!0}),this.props.parent.launchFullEditor()},this.exitTutorial=()=>{const e=this.props.parent.state.tutorialOptions;pxt.tickEvent("menu.exitTutorial",{tutorial:null==e?void 0:e.tutorial},{interactiveConsent:!0}),this.props.parent.exitTutorial()},this.showReportAbuse=()=>{pxt.tickEvent("tutorial.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},this.toggleDebug=()=>{pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},this.brandIconClick=()=>{pxt.tickEvent("projects.brand",void 0,{interactiveConsent:!0}),this.goHome()},this.backButtonTouchStart=e=>{this.longpressTimer=setTimeout((()=>a.nativeHostLongpressAsync()),750),this.touchStartTime=(new Date).getTime()},this.backButtonTouchEnd=e=>{e.preventDefault(),this.touchStartTime&&(new Date).getTime()-this.touchStartTime<750&&a.nativeHostBackAsync(),this.touchStartTime=null,clearTimeout(this.longpressTimer)},this.onPlayWithFriendsClick=e=>{e.preventDefault(),pxt.tickEvent("menu.playwithfriends",void 0,{interactiveConsent:!0}),window.open(pxt.multiplayer.SHORT_LINK(),"_blank")},this.getView=()=>{const{home:e,debugging:t,tutorialOptions:n}=this.props.parent.state;return e?"home":pxt.shell.isSandboxMode()?"sandbox":pxt.shell.isTimeMachineEmbed()?"time-machine":t?"debugging":!pxt.BrowserUtils.useOldTutorialLayout()&&(null==n?void 0:n.tutorial)?"tutorial-tab":(null==n?void 0:n.tutorial)?"tutorial":"editor"},this.getSettingsMenu=e=>{const{greenScreen:t,accessibleBlocks:n,header:r}=this.props.parent.state;switch(e){case"home":return(0,i.jsx)(d.ProjectSettingsMenu,{parent:this.props.parent});case"tutorial-tab":case"editor":return(0,i.jsx)(l.SettingsMenu,{parent:this.props.parent,greenScreen:t,accessibleBlocks:n,showShare:!!r,inBlocks:this.props.parent.isBlocksActive()});default:return(0,i.jsx)("div",{})}}}getOrganizationLogo(e,t,n){return"time-machine"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsxs)("div",Object.assign({className:"ui item logo organization",role:"menuitem"},{children:[e.organizationWideLogo||e.organizationLogo?(0,i.jsx)("img",{className:"ui logo "+("home"!==n?"mobile hide":""),src:e.organizationWideLogo||e.organizationLogo,alt:lf("{0} Logo",e.organization)}):(0,i.jsx)("span",Object.assign({className:"name"},{children:e.organization})),e.organizationLogo&&"home"!==n&&(0,i.jsx)("img",{className:"ui image mobile only",src:e.organizationLogo,alt:lf("{0} Logo",e.organization)})]}))}getTargetLogo(e,t,n){return"time-machine"===n?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)("div",Object.assign({"aria-label":lf("{0} Logo",e.boardName),role:"menuitem",className:"ui item logo brand "+("sandbox"!==n&&"home"!==n?"mobile hide":""),onClick:this.brandIconClick},{children:e.useTextLogo?[(0,i.jsx)("span",Object.assign({className:"name"},{children:e.organizationText}),"org-name"),(0,i.jsx)("span",Object.assign({className:"name-short"},{children:e.organizationShortText||e.organizationText}),"org-name-short")]:e.logo||e.portraitLogo?(0,i.jsx)("img",{className:`ui ${e.logoWide?"small":""} logo`,src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):(0,i.jsx)("span",Object.assign({className:"name"},{children:e.boardName}))}))}getCenterLabel(e,t,n){var r,s,a,c,d,p,f;const g=!!u.mainEditorPkg().files[pxt.ASSETS_FILE],m=null===(s=null===(r=u.mainPkg)||void 0===r?void 0:r.config)||void 0===s?void 0:s.languageRestriction,b=!g&&("javascript-only"===m||"python-only"===m)||e.blocksOnly;switch(t){case"tutorial":const r=(null==n?void 0:n.tutorialActivityInfo)?n.tutorialActivityInfo[n.tutorialStepInfo[n.tutorialStep].activity].name:null,s=null===(a=null==n?void 0:n.metadata)||void 0===a?void 0:a.hideIteration;if(r)return(0,i.jsx)("div",Object.assign({className:"ui item"},{children:r}));if(!s)return(0,i.jsx)(h.TutorialMenu,{parent:this.props.parent});break;case"tutorial-tab":if(n&&((null===(d=null===(c=pxt.appTarget)||void 0===c?void 0:c.appTheme)||void 0===d?void 0:d.tutorialSimSidebarLayout)||pxt.BrowserUtils.isTabletSize())){const e=n.tutorialStep?n.tutorialStep+1:void 0,t=n.tutorialStepInfo?null===(p=n.tutorialStepInfo)||void 0===p?void 0:p.length:void 0;return(0,i.jsxs)("div",Object.assign({className:"tutorial-header-label"},{children:[(0,i.jsx)("div",Object.assign({className:"ui item tutorial-header-name-label"},{children:n.tutorialName})),e&&t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",Object.assign({className:"ui item tutorial-header-step-label"},{children:" - "}))," ",(0,i.jsx)("div",Object.assign({className:"ui item tutorial-header-step-label"},{children:lf("Step {0} of {1}",e,t,t)}))]})]}))}return(0,i.jsx)("div",{});case"debugging":return(0,i.jsx)(o.MenuItem,{className:"centered",icon:"large bug",name:"Debug Mode"});case"sandbox":case"editor":case"time-machine":if(!b)return(0,i.jsx)("div",Object.assign({className:"ui item link editor-menuitem",role:"menuitem"},{children:(0,i.jsx)(l.EditorSelector,{parent:this.props.parent,sandbox:"sandbox"===t,python:e.python,languageRestriction:m,headless:null===(f=pxt.appTarget.simulator)||void 0===f?void 0:f.headless})}));switch(m){case"python-only":return(0,i.jsx)(o.MenuItem,{className:"centered",icon:"xicon python",name:"Python"});case"javascript-only":return(0,i.jsx)(o.MenuItem,{className:"centered",icon:"xicon js",name:"JavaScript"})}}return(0,i.jsx)("div",{})}getExitButtons(e,t,n){var r,s;switch(t){case"debugging":return(0,i.jsx)(o.ButtonMenuItem,{className:"exit-debugmode-btn",role:"menuitem",icon:"external",text:lf("Exit Debug Mode"),textClass:"landscape only",onClick:this.toggleDebug});case"sandbox":if(!e.hideEmbedEdit)return(0,i.jsx)(o.Item,{role:"menuitem",icon:"external",textClass:"mobile hide",text:lf("Edit"),onClick:this.launchFullEditor});break;case"tutorial":case"tutorial-tab":const a=[];if(null==n?void 0:n.tutorialReportId){const e=lf("Unapproved Content");a.push((0,i.jsx)(o.Item,{role:"menuitem",icon:"exclamation triangle",className:"report-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.showReportAbuse},"tutorial-report"))}if(!e.lockedEditor&&!(null===(r=null==n?void 0:n.metadata)||void 0===r?void 0:r.hideIteration)&&("tutorial-tab"!==t||(null===(s=pxt.appTarget.simulator)||void 0===s?void 0:s.headless))){const e=lf("Exit tutorial");a.push((0,i.jsx)(o.Item,{role:"menuitem",icon:"sign out large",className:"exit-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.exitTutorial},"tutorial-exit"))}if(a.length)return a}return(0,i.jsx)("div",{})}renderCore(){var e,t;const n=pxt.appTarget.appTheme,r=this.getData(s.HIGHCONTRAST),u=this.getView(),{home:d,header:h,tutorialOptions:p}=this.props.parent.state,f=pxt.shell.isControllerMode(),g=a.isNativeHost(),m=s.hasIdentity(),b=this.props.parent.isPythonActive()?"Python":this.props.parent.isJavaScriptActive()?"JavaScript":"Blocks",y=!("editor"!==u&&"tutorial-tab"!==u||n.lockedEditor||f),v=("editor"===u||"tutorial-tab"===u)&&h&&(null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.sharing)&&!f,_="editor"===u&&(null===(t=n.docMenu)||void 0===t?void 0:t.length),E="tutorial"==u&&22*p.tutorialStepInfo.length>window.innerWidth/3;return(0,i.jsxs)("div",Object.assign({id:"mainmenu",className:`ui borderless fixed menu ${n.invertedMenu?"inverted":""} ${E?"thin":""}`,role:"menubar"},{children:[(0,i.jsxs)("div",Object.assign({className:"left menu"},{children:[g&&(0,i.jsx)(o.Item,{className:"icon nativeback",role:"menuitem",icon:"chevron left large",ariaLabel:lf("Back to application"),onClick:a.nativeHostBackAsync,onMouseDown:this.backButtonTouchStart,onMouseUp:this.backButtonTouchEnd,onMouseLeave:this.backButtonTouchEnd}),this.getOrganizationLogo(n,r,u),"tutorial"===u?(0,i.jsx)(o.Item,{className:"tutorialname",tabIndex:-1,textClass:"landscape only",text:p.tutorialName}):this.getTargetLogo(n,r,u)]})),!d&&(0,i.jsx)("div",Object.assign({className:"center menu"},{children:this.getCenterLabel(n,u,p)})),(0,i.jsxs)("div",Object.assign({className:"right menu"},{children:[this.getExitButtons(n,u,p),y&&(0,i.jsx)(o.Item,{className:"icon openproject "+(m?"mobile hide":""),role:"menuitem",title:lf("Home"),icon:"home large",ariaLabel:lf("Home screen"),onClick:this.goHome}),v&&(0,i.jsx)(o.Item,{className:"icon shareproject mobile hide",role:"menuitem",title:lf("Publish your game to create a shareable link"),icon:"share alternate large",ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),_&&(0,i.jsx)(l.DocsMenu,{parent:this.props.parent,editor:b}),this.getSettingsMenu(u),m&&("home"===u||"editor"===u||"tutorial-tab"===u)&&(0,i.jsx)(c.UserMenu,{parent:this.props.parent})]}))]}))}}n.HeaderBar=p},{"./auth":194,"./cmds":202,"./container":278,"./data":282,"./identity":307,"./package":325,"./projects":326,"./sui":346,"./tutorial":350,"react/jsx-runtime":549}],304:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.mkHIDBridgePacketIOAsync=n.shouldUse=n.HIDError=void 0;var i=pxt.Cloud,r=pxt.Util;let o;class s extends Error{constructor(e){super(e),this.message=e}}n.HIDError=s;let a={};function l(e){let t=r.lookup(a,e.result.path);t?t.onOOB(e):console.error("Dropping data for "+e.result.path)}n.shouldUse=function(){let e=pxt.appTarget.serial;return e&&e.useHF2&&pxt.BrowserUtils.isLocalHost()&&!!i.localToken},n.mkHIDBridgePacketIOAsync=function(){if(!o){if(!pxt.BrowserUtils.isLocalHost()||!i.localToken)return Promise.resolve(void 0);pxt.debug("initializing hid pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${i.localToken}/hid`,l)}let e=!1;pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(e=!0);let t=new c(e);return t.initAsync().then((()=>t))};class c{constructor(e=!1){this.rawMode=e,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onEvent=e=>{},this.onError=e=>{},this.onSerial=(e,t)=>{},this.connecting=!1,e&&(this.onEvent=e=>this.onData(e))}disposeAsync(){return Promise.resolve()}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.connected}onOOB(e){"serial"==e.op?this.onSerial(r.fromHex(e.result.data),e.result.isError):"event"==e.op&&this.onEvent(r.fromHex(e.result.data))}talksAsync(e){return o.opAsync("talk",{path:this.dev.path,cmds:e.map((e=>({cmd:e.cmd,data:e.data?r.toHex(e.data):""})))}).then((e=>e.map((e=>r.fromHex(e.data)))))}error(e){throw this.connected=!1,new s(r.lf("USB/HID error on device {0} ({1})",this.dev.product,e))}reconnectAsync(){return this.initAsync()}disconnectAsync(){return this.connected=!1,o.opAsync("disconnect",{path:this.dev.path}).finally((()=>{this.onConnectionChanged&&this.onConnectionChanged()}))}sendPacketAsync(e){if(this.rawMode)return o.opAsync("send",{path:this.dev.path,data:r.toHex(e),raw:!0});throw new Error("should use talksAsync()!")}sendSerialAsync(e,t){return o.opAsync("sendserial",{path:this.dev.path,data:r.toHex(e),isError:t})}initAsync(){return this.connected=!1,this.connecting=!0,o.opAsync("list",{}).then((e=>{let t=e.devices,n=t.filter((e=>16896==(65280&e.release)))[0];if(pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(n=t[0]),!n)throw new Error("No device connected");this.dev&&delete a[this.dev.path],this.dev=n,a[this.dev.path]=this})).then((()=>o.opAsync("init",{path:this.dev.path,raw:this.rawMode}))).then((()=>{this.connected=!0})).finally((()=>{this.connecting=!1,this.onConnectionChanged&&this.onConnectionChanged()}))}}},{}],305:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HintManager=n.HintTooltip=void 0;const i=e("react/jsx-runtime"),r=e("./data");class o extends r.Component{constructor(e){super(e)}UNSAFE_componentWillReceiveProps(e){e.pokeUser!=this.state.show&&this.setState({show:e.pokeUser})}renderCore(){return(0,i.jsx)("div",Object.assign({className:"tooltip "+(this.state.show?"show":""),role:"tooltip",onClick:this.props.onClick},{children:this.props.text}))}}n.HintTooltip=o;n.HintManager=class{constructor(){this.defaultDuration=1e4,this.defaultDisplayCount=3,this.hints={},this.seenHints={}}viewedHint(e){this.seenHints[e]=!0}clearViewedHints(){this.seenHints={}}addHint(e,t,n){this.hints[e]=pxt.Util.debounce((()=>{t(),this.stopPokeUserActivity()}),n||this.defaultDuration)}pokeUserActivity(e,t,n){(null==n||n<this.defaultDisplayCount)&&!this.seenHints[t]&&(this.stopPokeUserActivity(),this.timer=this.hints[e]())}stopPokeUserActivity(){clearTimeout(this.timer),this.timer=null}}},{"./data":282,"react/jsx-runtime":549}],306:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.initGitHubDb=n.copyProjectToLegacyEditorAsync=n.getObjectStoreAsync=n.HOSTCACHE_TABLE=n.GITHUB_TABLE=n.SCRIPT_TABLE=void 0;const i="texts",r="headers",o="id";let s;async function a(){return s||(s=(async()=>{try{await async function(){if(!await async function(){let e=!0;try{const t=new pxt.BrowserUtils.IDBWrapper("_pouch_pxt-"+pxt.storage.storageId(),1,((t,n)=>{e=!1,n.transaction.abort()}),null,!0);await t.openAsync()}catch(e){}return e}())return;const e=new pxt.BrowserUtils.IDBWrapper("_pouch_pxt-"+pxt.storage.storageId(),5,(()=>{}));await e.openAsync();const t=await e.getAllAsync(l),s=await async function(){const e=new pxt.BrowserUtils.IDBWrapper(`__pxt_idb_migration_${pxt.storage.storageId()}`,1,((e,t)=>{const s=t.result;s.createObjectStore(i,{keyPath:o}),s.createObjectStore(r,{keyPath:o}),s.createObjectStore(n.SCRIPT_TABLE,{keyPath:o}),s.createObjectStore(n.HOSTCACHE_TABLE,{keyPath:o}),s.createObjectStore(n.GITHUB_TABLE,{keyPath:o})}),(async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()}));try{await e.openAsync()}catch(e){return pxt.reportException(e),Promise.reject(e)}return e}();for(const e of t){const t=e._doc_id_rev,o=t.lastIndexOf("::"),a=(t.substring(o+2),t.indexOf("--"));let l=t.substring(0,a);const c=t.substring(a+2,o);let d,h=l.indexOf("-");switch(-1!==h&&(d=l.substring(0,h),l=l.substring(h+1)),pxtc.assert(c===e.id,"ID mismatch!"),l){case"header":l=r;break;case"text":l=i;break;case"script":l=n.SCRIPT_TABLE,d=d||p();break;case"github":l=n.GITHUB_TABLE,d=d||p();break;case"hostcache":l=n.HOSTCACHE_TABLE,d=d||p();break;default:console.warn("Unknown database table "+l);continue}if(await s.getAsync(l,g(d,c)))continue;await s.setAsync(l,{id:g(d,c)});const f=await u(d);await f.getAsync(l,c)||(delete e._doc_id_rev,await f.setAsync(l,e))}}()}catch(e){pxt.reportException(e),pxt.log("Unable to migrate pouchDB")}try{await async function(){const e=new pxt.BrowserUtils.IDBWrapper("__pxt_idb_workspace",1,((e,t)=>{const n=t.result;n.createObjectStore(i,{keyPath:o}),n.createObjectStore(r,{keyPath:o})}),(async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()}));try{await e.openAsync();const t=await h();await d(e,t,r,!0),await d(e,t,i,!0)}catch(e){pxt.reportException(e)}}()}catch(e){pxt.reportException(e),pxt.log("Unable to migrate old indexed db format")}try{await async function(){if(!p())return;const e=pxt.semver.parse(pxt.appTarget.versions.target).major-1,t=e<0?"":pxt.appTarget.appTheme.browserDbPrefixes[e],o=await h();if((await o.getAllAsync(r)).length)return;const s=await u(t);await d(s,o,r,!1),await d(s,o,i,!1),await d(s,o,n.SCRIPT_TABLE,!1),await d(s,o,n.HOSTCACHE_TABLE,!1),await d(s,o,n.GITHUB_TABLE,!1)}()}catch(e){pxt.reportException(e),pxt.log("Unable to migrate projects from other prefixes")}})()),s}n.SCRIPT_TABLE="script",n.GITHUB_TABLE="github",n.HOSTCACHE_TABLE="hostcache";const l="by-sequence";let c={};async function u(e="__default"){return c[e]||(c[e]=async function(){const t=new pxt.BrowserUtils.IDBWrapper(`__pxt_idb_workspace_${pxt.storage.storageId()}_${e}`,1,((e,t)=>{const s=t.result;s.createObjectStore(i,{keyPath:o}),s.createObjectStore(r,{keyPath:o}),s.createObjectStore(n.SCRIPT_TABLE,{keyPath:o}),s.createObjectStore(n.HOSTCACHE_TABLE,{keyPath:o}),s.createObjectStore(n.GITHUB_TABLE,{keyPath:o})}),(async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()}));try{await t.openAsync()}catch(e){return pxt.reportException(e),Promise.reject(e)}return t}()),c[e]}async function d(e,t,n,i){for(const r of await e.getAllAsync(n))i&&await t.getAsync(n,r.id)||await t.setAsync(n,r)}async function h(){return u(p())}function p(){if(!pxt.appTarget.appTheme.browserDbPrefixes)return;const e=pxt.semver.parse(pxt.appTarget.versions.target).major;return pxt.appTarget.appTheme.browserDbPrefixes[e]}async function f(e){return(await h()).getObjectStoreWrapper(e)}function g(e,t){return`${e}--${t}`}n.getObjectStoreAsync=f,n.copyProjectToLegacyEditorAsync=async function(e,t,n){const o=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[n],s=await u(o);await s.setAsync(r,e),await s.setAsync(i,{id:e.id,files:t,_rev:null})},n.initGitHubDb=function(){function e(){return f(n.GITHUB_TABLE)}pxt.github.db=new class{constructor(){this.mem=new pxt.github.MemoryGithubDb}latestVersionAsync(e,t){return this.mem.latestVersionAsync(e,t)}async loadConfigAsync(t,n){if("master"==n)return this.mem.loadConfigAsync(t,n);const i=`config-${t}-${n}`,r=await e();try{return(await r.getAsync(i)).config}catch(e){pxt.debug(`github offline cache miss ${i}`);const o=await this.mem.loadConfigAsync(t,n);try{await r.setAsync({id:i,config:o})}catch(e){}return o}}async loadPackageAsync(t,n){if(n||(pxt.debug("dep: default to master"),n="master"),"master"==n)return this.mem.loadPackageAsync(t,n);const i=`pkg-${t}-${n}`,r=await e();try{const e=await r.getAsync(i);return pxt.debug(`github offline cache hit ${i}`),e.package}catch(e){pxt.debug(`github offline cache miss ${i}`);const o=await this.mem.loadPackageAsync(t,n);try{await r.setAsync({id:i,package:o})}catch(e){}return o}}}},n.provider={getAsync:async function(e){const t=await h(),n=await t.getAsync(i,e.id);return{header:e,text:n.files,version:n._rev}},setAsync:async function(e,t,n){const o=await h();try{await s(o,e,t,n)}catch(i){if(409==i.status)return void pxt.debug("idb: set conflict (409)");pxt.reportException(i),pxt.log("idb: set failed, cleaning cache dbs"),await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync();try{await s(o,e,t,n)}catch(e){throw pxt.reportException(e,{ws:"idb"}),pxt.log("idb: we are out of space..."),e}}async function s(e,t,n,o){const s={id:t.id,files:o,_rev:n};o&&await e.setAsync(i,s),await e.setAsync(r,t)}},deleteAsync:async function(e,t){const n=await h();await n.deleteAsync(i,e.id),await n.deleteAsync(r,e.id)},listAsync:async function(){return await a(),(await h()).getAllAsync(r)},resetAsync:async function(){const e=await h();await e.deleteAllAsync(i),await e.deleteAllAsync(r)}}},{}],307:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CloudSaveStatus=n.UserMenu=n.LoginDialog=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./auth"),s=e("./data"),a=e("./cloud"),l=e("../../react-common/components/profile/SignInModal");class c extends o.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.signInAsync=async(e,t)=>{pxt.tickEvent("identity.loginClick",{provider:e.name,rememberMe:t.toString()}),await o.loginAsync(e.id,t,{hash:this.state.continuationHash,params:pxt.Util.parseQueryString(window.location.search)})},this.state={visible:!1,continuationHash:""}}async show(e){this.setState({visible:!0,continuationHash:e})}renderCore(){const{visible:e}=this.state;return(0,i.jsx)(i.Fragment,{children:e&&(0,i.jsx)(l.SignInModal,{onClose:this.hide,onSignIn:this.signInAsync})})}}n.LoginDialog=c;class u extends o.Component{constructor(e){super(e),this.handleDropdownClicked=()=>{const e=this.isLoggedIn(),t=this.getData("github:user");return!(!e&&!t&&(this.props.parent.showLoginDialog(this.props.continuationHash),1))},this.handleLoginClicked=()=>{this.props.parent.showLoginDialog(this.props.continuationHash)},this.handleLogoutClicked=async()=>{await o.logoutAsync()},this.handleProfileClicked=()=>{this.props.parent.showProfileDialog()},this.handleUnlinkGitHubClicked=()=>{pxt.tickEvent("menu.github.signout"),this.hide(),this.props.parent.signOutGithub()},this.state={}}encodedAvatarPic(e){var t,n,i,r;const o=null===(n=null===(t=null==e?void 0:e.idp)||void 0===t?void 0:t.picture)||void 0===n?void 0:n.mimeType,s=null===(r=null===(i=null==e?void 0:e.idp)||void 0===i?void 0:i.picture)||void 0===r?void 0:r.encoded;return o&&s?`data:${o};base64,${s}`:""}avatarPicUrl(){var e,t;const n=this.getUserProfile();return null!==(t=null===(e=null==n?void 0:n.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:this.encodedAvatarPic(n)}hide(){this.dropdown&&this.dropdown.hide()}renderCore(){const e=this.isLoggedIn(),t=this.getUserProfile(),n=lf("User Menu"),o=(0,i.jsxs)("div",Object.assign({className:"signin-button"},{children:[(0,i.jsx)("div",Object.assign({className:"ui text widedesktop only"},{children:lf("Sign In")})),r.genericContent({icon:"xicon cloud-user large"})]})),s=(0,i.jsx)("div",Object.assign({className:"avatar"},{children:(0,i.jsx)("img",{src:this.avatarPicUrl(),alt:lf("User Menu"),referrerPolicy:"no-referrer"})})),a=(0,i.jsx)("div",Object.assign({className:"avatar"},{children:(0,i.jsx)("span",Object.assign({className:"initials"},{children:pxt.auth.userInitials(t)}))})),l=this.avatarPicUrl()?s:a,c=this.getData("github:user");return(0,i.jsxs)(r.DropdownMenu,Object.assign({role:"menuitem",title:n,className:"item icon user-dropdown-menuitem "+(e?"logged-in-dropdown":"sign-in-dropdown"),titleContent:e?l:o,tabIndex:e?0:-1,onClick:this.handleDropdownClicked,ref:e=>this.dropdown=e},{children:[e?(0,i.jsx)(r.Item,{role:"menuitem",text:lf("My Profile"),onClick:this.handleProfileClicked}):void 0,e?(0,i.jsx)("div",{className:"ui divider"}):void 0,c?(0,i.jsxs)(r.Item,Object.assign({role:"menuitem",title:lf("Unlink {0} from GitHub",c.name),onClick:this.handleUnlinkGitHubClicked},{children:[(0,i.jsx)("div",Object.assign({className:"icon avatar",role:"presentation"},{children:(0,i.jsx)("img",{className:"circular image",src:c.photo,alt:lf("User picture")})})),(0,i.jsx)("span",{children:lf("Disconnect GitHub")})]})):void 0,c&&(0,i.jsx)("div",{className:"ui divider"}),e?void 0:(0,i.jsx)(r.Item,{role:"menuitem",text:lf("Sign in"),onClick:this.handleLoginClicked}),e?(0,i.jsx)(r.Item,{role:"menuitem",text:lf("Sign out"),onClick:this.handleLogoutClicked}):void 0]}))}}n.UserMenu=u;class d extends s.Component{static wouldRender(e){const t=a.getCloudTempMetadata(e).cloudStatus();return!!t&&"none"!==t.value&&o.hasIdentity()}renderCore(){if(!this.props.headerId)return null;const e=this.getData(`${a.HEADER_CLOUDSTATE}:${this.props.headerId}`).cloudStatus();if(!e||"none"===e.value||!o.hasIdentity())return null;const t="localEdits"===e.value,n=t||"syncing"===e.value;return(0,i.jsxs)("div",Object.assign({className:"cloudstatusarea"},{children:[!n&&(0,i.jsx)(r.Item,{role:"presentation",className:"ui tiny cloudicon xicon "+e.icon,title:e.tooltip,tabIndex:-1}),n&&(0,i.jsx)(r.Item,{role:"presentation",className:"ui tiny inline loader active cloudprogress"+(t?" indeterminate":""),title:e.tooltip,tabIndex:-1}),"none"!==e.value&&"synced"!==e.value&&(0,i.jsx)("span",Object.assign({className:"ui mobile hide no-select cloudtext",role:"note"},{children:e.shortStatus}))]}))}}n.CloudSaveStatus=d},{"../../react-common/components/profile/SignInModal":178,"./auth":194,"./cloud":200,"./data":282,"./sui":346,"react/jsx-runtime":549}],308:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=void 0;const i=e("./memoryworkspace"),r=e("../../pxteditor");let o;n.provider={getAsync:function(e){return i.provider.getAsync(e)},setAsync:function(e,t,n){return i.provider.setAsync(e,t,n).then((()=>{const t=n||i.projects[e.id]&&i.projects[e.id].text;return r.postHostMessageAsync({type:"pxthost",action:"workspacesave",project:{header:e,text:t},response:!1})})).then((()=>{}))},listAsync:function(){return r.postHostMessageAsync({type:"pxthost",action:"workspacesync",response:!0}).then((e=>((e.projects||[]).forEach(i.merge),o=e.editor,pxt.tickEvent("pxt.controller",{controllerId:e.controllerId}),i.provider.listAsync())))},resetAsync:function(){return i.provider.resetAsync().then((()=>r.postHostMessageAsync({type:"pxthost",action:"workspacereset",response:!0}))).then((()=>{}))},loadedAsync:function(){return r.postHostMessageAsync({type:"pxthost",action:"workspaceloaded",response:!0}).then((()=>{}))},getSyncState:function(){return o},fireEvent:function(e){r.postHostMessageAsync({type:"pxthost",action:"workspaceevent",response:!1,event:e})}}},{"../../pxteditor":134,"./memoryworkspace":314}],309:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ImmersiveReaderButton=n.launchImmersiveReaderAsync=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./core"),s=e("./auth"),a=e("@microsoft/immersive-reader-sdk");var l=pxt.Cloud;const c=e("./util");function u(e){const t=[function(e){return e.replace(/@boardname@/g,pxt.appTarget.appTheme.boardName||"device")},function(e){return e.replace(/(!\w*\[[^\]]*\]\w*\([^)]*\))/gu,"")},function(e){return e.replace(/\w*\[([^\]]*)\]\w*\([^)]*\)/gu,((e,t,n,i)=>lf("{0}",t)))},function(e){return e.replace(/`?`\|\|[\w|\s]+:(.+?)\|\|``?/gu,((e,t,n,i)=>lf('"{0}"',t)))},function(e){return e.replace(/``\|([^|]+)\|``/gu,((e,t,n,i)=>lf("{0}",t)))},function(e){return e.replace(pxt.tutorial.getMetadataRegex(),"")},function(e){return e.replace(/\*\*([^*^\s]+)\*\*|__([^\s^_]+)__/gu,((e,t,n,i,r)=>'"'+lf("{0}",t||n)+'"')).replace(/\*\*([^*]+)\*\*|__([^_]+)__/gu,((e,t,n,i,r)=>t?lf("{0}",t):lf("{0}",n)))},function(e){return e.replace(/\*([^*]+)\*|_([^_]+)_/gu,((e,t,n,i,r)=>lf("{0}",t||n)))},function(e){return e.replace(/[\r\n]{2,}/gmu,"<br />\n")},function(e){return e.replace(/^\* \* \*$|^- - -$|^<hr\/>$|---/gmu,"<br />")},function(e){return e.replace(/^>>/gu,"")},function(e){let t;try{t=new RegExp("\\p{Extended_Pictographic}","ug")}catch(e){}const n=[];return t?e.replace(t,((e,t,i,r)=>""==e?"":n.indexOf(e)<0?"":e)):e},function(e){return e.replace(/[]/gu,lf("{0}","A")).replace(/[]/gu,lf("{0}","B"))},function(e){return e.replace(/<(true|false|down|up|high|low|on|off|yes|no|win|lose)>/giu,((e,t,n,i)=>"`"+lf("{0}",t)+"`"))}];let n=e;return t.forEach((e=>{n=e(n)})),n}const d="immReaderToken";async function h(e,t){pxt.tickEvent("immersiveReader.launch",{tutorial:t.tutorial,tutorialStep:t.tutorialStep});const n=r.getData(s.READER)||"",i=r.getData(s.LANGUAGE)||"",c={chunks:[{content:u(e),mimeType:"text/html"}]},h={uiLang:i,onExit:()=>{pxt.tickEvent("immersiveReader.close",{tutorial:t.tutorial,tutorialStep:t.tutorialStep})},onPreferencesChanged:e=>{s.setImmersiveReaderPrefAsync(e)},preferences:n};try{let e=await function(){const e=pxt.storage.getLocal(d),t=pxt.Util.jsonTryParse(e);return!t||Date.now()/1e3>t.expiration?pxt.Cloud.privateGetAsync("immreader",!0).then((e=>(pxt.storage.setLocal(d,JSON.stringify(e)),e)),(e=>(pxt.storage.removeLocal(d),pxt.reportException(e),pxt.tickEvent("immersiveReader.error",{error:e.statusCode,message:e.message}),e.isOffline?Promise.reject(new Error("offline")):Promise.reject(new Error("token"))))):(pxt.tickEvent("immersiveReader.cachedToken"),Promise.resolve(t))}();if(await async function(){return pxt.Cloud.privateGetAsync("ping",!0)}(),!l.isOnline())throw new Error("offline");const t=pxt.Util.now();await a.launchAsync(e.token,e.subdomain,c,h);const n=pxt.Util.now()-t;pxt.tickEvent("immersiveReader.launch.finished",{elapsed:n})}catch(e){if(e.isOffline)o.warningNotification(lf("Immersive Reader cannot be used offline"));else switch(e.message){case"offline":o.warningNotification(lf("Immersive Reader cannot be used offline"));break;case"token":default:pxt.storage.removeLocal(d),o.warningNotification(lf("Immersive Reader could not be launched")),"string"==typeof e?pxt.tickEvent("immersiveReader.error",{message:e}):pxt.tickEvent("immersiveReader.error",{message:e.message,statusCode:e.statusCode})}pxt.reportException(e),a.close()}}n.launchImmersiveReaderAsync=h;class p extends r.Component{constructor(){super(...arguments),this.buttonClickHandler=async()=>{await h(this.props.content,this.props.tutorialOptions)}}render(){return(0,i.jsx)("div",{className:"immersive-reader-button ui item",onClick:this.buttonClickHandler,"aria-label":lf("Launch Immersive Reader"),role:"button",onKeyDown:c.fireClickOnEnter,tabIndex:0,title:lf("Launch Immersive Reader")})}}n.ImmersiveReaderButton=p},{"./auth":194,"./core":279,"./data":282,"./util":352,"@microsoft/immersive-reader-sdk":366,"react/jsx-runtime":549}],310:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Keymap=void 0;const i=e("react/jsx-runtime"),r=e("./data");class o extends r.Component{constructor(e){super(e),this.hideKeymap=()=>{this.props.parent.showKeymap(!1)},this.setData();const t=pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.boardName.toLowerCase();this.keymap=t&&o._data[t],this.state={above:!0}}renderCore(){return(0,i.jsxs)("div",Object.assign({className:"keymap "+(this.state.above?"above":""),ref:"keymap"},{children:[(0,i.jsx)("i",{className:"icon large close remove circle",role:"presentation",onClick:this.hideKeymap}),this.keymap&&this.keymap.map(((e,t)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("span",Object.assign({className:"keymap-title"},{children:e.title})),Object.keys(e.map).map(((t,n)=>(0,i.jsxs)("div",Object.assign({className:"keymap-row"},{children:[e.map[t].map(((e,t)=>(0,i.jsx)("div",Object.assign({className:"keymap-key"},{children:e}),t))),(0,i.jsx)("span",Object.assign({className:"keymap-name"},{children:t}))]}),n)))]},t)))]}))}setData(){o._data||(o._data={arcade:[{title:lf("player 1"),map:{[lf("up")]:["","W"],[lf("down")]:["","S"],[lf("left")]:["","A"],[lf("right")]:["","D"],a:["Z",lf("{id:keyboard symbol}space")],b:["X",lf("{id:keyboard symbol}enter")]}},{title:lf("player 2"),map:{[lf("up")]:["I"],[lf("down")]:["K"],[lf("left")]:["J"],[lf("right")]:["L"],[lf("a")]:["U"],[lf("b")]:["O"]}}]})}}n.Keymap=o},{"./data":282,"react/jsx-runtime":549}],311:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LanguagePicker=n.setInitialLang=n.initialLang=void 0;const i=e("react/jsx-runtime"),r=e("./codecard"),o=e("./sui"),s=e("./data"),a=e("./core"),l=["en"];n.setInitialLang=function(e){n.initialLang=pxt.Util.normalizeLanguageCode(e)[0]};class c extends s.Component{constructor(e){super(e),this.state={visible:!1},this.hide=this.hide.bind(this),this.changeLanguage=this.changeLanguage.bind(this),this.translateEditor=this.translateEditor.bind(this)}languageList(){return pxt.appTarget.appTheme.selectLanguage&&pxt.appTarget.appTheme.availableLocales&&pxt.appTarget.appTheme.availableLocales.length?pxt.appTarget.appTheme.availableLocales:l}translateEditor(){pxt.tickEvent("translate.editor.incontext",void 0,{interactiveConsent:!0}),a.confirmAsync({header:lf("Translate the editor"),jsx:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:lf("This editor uses crowd-sourced translation! If you wish to help with translation, make sure to register as a translator.")}),(0,i.jsx)("p",{children:lf("'Translate' will reload the editor with in-context translations. Close the editor when done.")})]}),helpUrl:"/translate",buttons:[{label:lf("Register"),icon:"xicon globe",className:lf("secondary"),title:lf("Register as a translator before starting the translation."),url:`https://crowdin.com/project/${pxt.appTarget.appTheme.crowdinProject}`}],agreeLbl:lf("Translate"),hasCloseIcon:!0}).then((e=>{if(e){pxt.tickEvent("translate.editor.incontext.translate");const e=window.location.href.indexOf("?")<0?"?":"&";window.location.href=window.location.pathname+(window.location.search||"")+e+"translate=1"+(window.location.hash||"")}}))}changeLanguage(e){pxt.Util.allLanguages[e]&&(e!==n.initialLang?(pxt.tickEvent("menu.lang.changelang",{lang:e}),a.setLanguage(e).then((()=>{this.props.parent.reloadEditor()}))):(pxt.tickEvent("menu.lang.samelang",{lang:e}),this.hide()))}hide(){this.setState({visible:!1})}show(){this.setState({visible:!0})}renderCore(){if(!this.state.visible)return(0,i.jsx)("div",{});const e=pxt.appTarget.appTheme,t=this.languageList(),n=t.length>4?"large":"small",r=!pxt.BrowserUtils.isIE()&&!pxt.shell.isReadOnly()&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.appTheme.crowdinProject,s=this.props.parent.createModalClasses();return(0,i.jsx)(o.Modal,Object.assign({isOpen:this.state.visible,className:s,size:n,onClose:this.hide,dimmer:!0,header:lf("Select Language"),closeIcon:!0,allowResetFocus:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsxs)("div",Object.assign({id:"langmodal"},{children:[(0,i.jsx)("div",Object.assign({id:"availablelocales",className:"ui cards centered",role:"list","aria-label":lf("List of available languages")},{children:t.map((e=>{const t=pxt.Util.allLanguages[e];return(0,i.jsx)(u,{langId:e,name:t.localizedName,ariaLabel:t.englishName,description:t.englishName,onClick:this.changeLanguage},e)}))})),e.crowdinProject?(0,i.jsxs)("div",Object.assign({className:"ui",id:"langmodalfooter"},{children:[(0,i.jsx)(o.Link,{"aria-label":lf("How do I add a new language?"),href:"/translate",text:lf("How do I add a new language?"),target:"_blank"}),r&&(0,i.jsx)(o.Button,{"aria-label":lf("Translate the editor"),onClick:this.translateEditor,text:lf("Translate the editor")})]})):void 0]}))}))}}n.LanguagePicker=c;class u extends o.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.langId)}renderCore(){const{name:e,ariaLabel:t,description:n}=this.props;return(0,i.jsx)(r.CodeCardView,{className:"card-selected langoption",name:e,ariaLabel:t,role:"listitem",description:n,onClick:this.handleClick})}}},{"./codecard":203,"./core":279,"./data":282,"./sui":346,"react/jsx-runtime":549}],312:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeAsync=void 0;const i=e("react/jsx-runtime"),r=e("./package"),o=e("./core"),s=e("./compiler"),a="instructions";function l(e){return function(e){return new Promise(((t,n)=>{window.addEventListener("message",(function e(n){const i=n.data;"ready"==i.type&&i.frameid==a&&(window.removeEventListener("message",e),t())})),e.src=pxt.webConfig.partsUrl+"#"+a}))}(e).then((()=>s.compileAsync({native:!0}))).then((t=>{const n=r.mainEditorPkg().header.name||lf("Untitled"),i=pxt.appTarget.simulator.boardDefinition,o=ts.pxtc.computeUsedParts(t).sort(),s=r.mainPkg.computePartDefinitions(o),a=t.usedArguments;let l={},c={};for(let e of t.configData||[])l[e.key+""]=e.value,c[e.name]=e.key;const u={cfg:l,cfgKey:c};return e.contentWindow.postMessage({type:"instructions",options:{name:n,boardDef:i,parts:o,partDefinitions:s,fnArgs:a,configData:u,print:!0}},"*"),e}))}n.makeAsync=function(){return o.dialogAsync({header:lf("Make"),size:"large",hasCloseIcon:!0,jsx:(0,i.jsx)("div",Object.assign({className:"ui container"},{children:(0,i.jsx)("div",Object.assign({id:"makecontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},{children:(0,i.jsx)("iframe",{id:"makeiframe",frameBorder:"0",sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}))})),onLoaded:e=>{l(e.querySelectorAll("#makeiframe")[0])}}).then((e=>{}))}},{"./compiler":204,"./core":279,"./package":325,"react/jsx-runtime":549}],313:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MarkedContent=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("marked"),s=e("./compiler"),a=e("dashjs"),l=e("dashjs"),c=e("../../react-common/components/util"),u=e("../../pxtblocks"),d=e("blockly");class h extends r.Component{constructor(){super(...arguments),this.semanticIconNames=["flipped","horizontally","vertically","rotated","counterclockwise","access","accessible","accusoft","add","address","adjust","adn","adversal","affiliatetheme","aid","alarm","ald","algolia","alien","align","all","alphabet","als","alt","alternate","alternative","amazon","ambulance","american","amex","amilia","amount","anchor","and","android","angellist","angle","angrycreative","angular","announcement","app","apper","apple","archive","area","arrow","arrows","ascending","asexual","asl","assistive","asterisk","asymmetrik","at","attach","attention","audible","audio","autoprefixer","avianex","aviato","awesome","aws","backward","badge","bag","balance","ball","ban","band","bandcamp","bar","barcode","bars","baseball","basket","basketball","bath","bathtub","battery","bed","beer","beginner","behance","bell","bicycle","bill","bimobject","binary","binoculars","birthday","bishop","bitbucket","bitcoin","bity","black","blackberry","blind","block","blogger","bluetooth","board","bold","bolt","bomb","book","bookmark","bowling","box","boxes","braille","branch","briefcase","broken","browser","brush","btc","bug","building","bullhorn","bullseye","bureau","buromobelexperte","bus","buysellads","cake","calculator","calendar","call","camera","camp","cancel","cap","captioning","car","card","caret","cart","cc","center","centercode","certificate","chain","chart","chat","check","checked","checkered","checkmark","chess","chevron","child","chrome","circle","clipboard","clock","clone","close","closed","cloud","cloudscale","cloudsmith","cloudversify","club","cny","cocktail","code","codepen","codiepie","coffee","cog","cogs","columns","combinator","comment","commenting","comments","commons","compass","compose","compress","computer","configure","connectdevelop","contao","content","control","conversation","copy","copyright","cord","cpanel","creative","credit","crop","crosshairs","css3","cube","cubes","currency","cursor","cut","cuttlefish","dashboard","dashcube","database","deaf","deafness","delete","delicious","deploydog","descending","description","deskpro","desktop","detective","deviantart","devices","diamond","digg","digital","diners","discord","discourse","discover","discussions","disk","dna","dochub","docker","doctor","dollar","dolly","dont","dot","double","down","download","draft2digital","dribbble","dribble","drive","drivers","dropbox","dropdown","dropper","drupal","dyalog","earlybirds","edge","edit","eercast","eject","elementor","ellipsis","ember","emergency","empire","empty","end","envelope","envira","erase","eraser","erlang","ethereum","etsy","eur","euro","excel","exchange","exclamation","expand","expeditedssl","explorer","express","external","extinguisher","eye","eyedropper","facebook","factory","fast","favorite","fax","feed","female","fi","fighter","file","film","filter","find","fire","firefox","first","firstdraft","five","flag","flask","flatbed","flickr","flipboard","fly","folder","font","fonticons","food","football","fork","forms","fort","forumbee","forward","four","foursquare","framework","free","freebsd","from","frown","full","futbol","gallery","game","gavel","gay","gbp","gem","gender","genderless","get","gg","ghost","gift","git","github","gitkraken","gitlab","gitter","gittip","glass","glide","globe","gofore","golf","goodreads","google","grab","graduation","graph","gratipay","grav","grid","gripfire","group","grunt","gulp","hacker","half","hand","handicap","handshake","hard","hash","hashtag","hat","hdd","header","heading","headphones","hearing","heart","heartbeat","height","help","helper","heterosexual","hide","high","hips","hire","history","hockey","home","homosexual","hooli","horizontal","hospital","hotel","hotjar","hourglass","houzz","html5","hubspot","hundred","hunt","id","idea","ils","image","images","imdb","in","in-cart","inbox","indent","industry","info","inr","instagram","intergender","international","internet","interpreting","intersex","ios","ioxhost","isle","italic","itunes","japan","jcb","jenkins","jet","joget","joomla","jpy","js","jsfiddle","justify","key","keyboard","keycdn","kickstarter","king","knight","korvue","krw","lab","language","laptop","laravel","large","lastfm","law","layout","leaf","leanpub","left","legal","lemon","lesbian","less","level","license","life","lightbulb","lightning","like","line","linechat","linkedin","linkify","linode","linux","lira","list","listening","lizard","location","lock","log","logout","long","low","lyft","magento","magic","magnet","magnify","mail","male","man","map","marker","mars","martini","mastercard","maxcdn","maximize","md","meanpath","medapps","medium","medkit","medrt","meetup","meh","mercury","messenger","microchip","microphone","microsoft","military","minimize","minus","mix","mixcloud","mizuni","mobile","modx","monero","money","monster","moon","motorcycle","mouse","move","ms","mule","music","mute","napster","neuter","new","news","newspaper","nintendo","node","non","notch","notched","note","npm","ns8","numbered","numeric","nutritionix","object","ocean","odnoklassniki","of","off","official","ol","on","one","open","opencart","openid","opera","optin","optinmonster","options","order","ordered","osi","other","out","outdent","outline","overflow","page4","pagelines","paint","palfed","pallet","paper","paperclip","paragraph","paste","patreon","pause","paw","pawn","pay","payment","paypal","pdf","peace","pen","pencil","percent","periscope","phabricator","phoenix","phone","photo","php","picture","pie","piece","pied","pills","pin","pinterest","piper","pixels","plane","play","playstation","play","plug","plus","pocket","podcast","point","pointer","pointing","pound","power","powerpoint","pp","print","privacy","product","protect","puck","pushed","puzzle","python","qq","qrcode","quarter","quarters","queen","question","quidditch","quinscape","quora","quote","radio","rain","random","ravelry","react","rebel","record","rectangle","recycle","reddit","redo","redriver","refresh","registered","remove","rendact","renren","repeat","reply","replyd","resize","resolving","restore","retro","retweet","right","ring","rmb","road","rock","rocket","rocketchat","rockrms","rook","rouble","rss","rub","ruble","rupee","s15","safari","sass","save","scale","schlix","scissors","scribd","search","searchengin","secret","selected","sellcast","sellsy","send","server","servicestack","setting","settings","share","shekel","sheqel","shield","ship","shipping","shirtsinbulk","shop","shopping","shower","shuffle","shutdown","shuttle","sidebar","sign","sign-in","sign-out","signal","signing","signs","signup","simple","simplybuilt","sistrix","sitemap","skyatlas","skype","slack","slash","sliders","slideshare","smile","snapchat","snowflake","soccer","sort","sound","soundcloud","space","speakap","spinner","spock","spoon","spotify","spy","square","stack","star","start","staylinked","steam","step","stethoscope","sticker","sticky","stop","stopwatch","store","strava","street","strikethrough","stripe","stroke","student","studiovinari","stumbleupon","subscript","subway","suitcase","sun","superpowers","superscript","supple","switch","symbol","sync","syringe","systems","table","tablet","tachometer","tack","tag","tags","talk","target","tasks","taxi","telegram","telephone","teletype","television","tencent","tennis","terminal","text","th","theme","themeisle","thermometer","thin","three","thumb","thumbs","thumbtack","ticket","tie","time","times","tint","tm","to","toggle","trademark","train","transgender","translate","trash","travel","treatment","tree","trello","triangle","tripadvisor","trophy","truck","try","tumblr","tv","twitch","twitter","two","uber","uikit","ul","umbrella","underline","undo","ungroup","unhide","uniregistry","universal","university","unlink","unlinkify","unlock","unmute","unordered","untappd","up","upload","usb","usd","user","users","ussunnah","utensil","utensils","vaadin","vcard","venus","vertical","viacoin","viadeo","viber","victory","video","view","vimeo","vine","visa","vision","vk","vnv","volleyball","volume","vuejs","wait","wallet","warehouse","warning","wechat","weibo","weight","weixin","whatsapp","wheelchair","whmcs","wi-fi","width","wifi","wikipedia","window","windows","winner","wizard","woman","won","word","wordpress","world","wpbeginner","wpexplorer","wpforms","wrench","write","xbox","xing","yahoo","yandex","yc","ycombinator","yelp","yen","yoast","youtube","zero","zip","zoom","zoom-in","zoom-out"],this.customIconNames=["blocks","js","python","toolbox","book-reader","photo-video","gamepad","function"],this.handleContentRef=e=>{e&&(this.contentRef=e,this.props.contentRef&&this.props.contentRef(e))}}static clearBlockSnippetCache(){this.blockSnippetCache={}}getBuiltinMacros(){const e={},t=pxt.appTarget.appTheme;return t.boardName&&(e.boardname=pxt.Util.htmlEscape(t.boardName)),t.boardNickname&&(e.boardnickname=pxt.Util.htmlEscape(t.boardNickname)),t.driveDisplayName&&(e.drivename=pxt.Util.htmlEscape(t.driveDisplayName)),t.homeUrl&&(e.homeurl=pxt.Util.htmlEscape(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?`<img aria-hidden="true" role="presentation" class="ui mini image" src="${t.docsLogo}" />`:"",e}startRenderLangSnippet(e){const{unboxSnippets:t}=this.props,n=e.parentElement,i=n.parentElement,r=document.createElement("div");return r.className=`ui ${t?"":"segment raised "}loading codewidget`,i.insertBefore(r,n),i.removeChild(n),r}finishRenderLangSnippet(e,t){if("string"==typeof t){let e=document.createElement("code");e.className="hljs",e.textContent=t,pxt.tutorial.highlight(e),t=e}e.appendChild(t),pxsim.U.removeClass(e,"loading")}cachedRenderLangSnippetAsync(e,t){const n=e.textContent,i=e.className,r=this.startRenderLangSnippet(e);return h.blockSnippetCache[i+n]?void this.finishRenderLangSnippet(r,h.blockSnippetCache[i+n]):t(n).then((e=>{h.blockSnippetCache[i+n]=e,this.finishRenderLangSnippet(r,h.blockSnippetCache[i+n])})).catch((e=>{pxt.reportException(e),this.finishRenderLangSnippet(r,lf("Something changed."))}))}renderSnippets(e){const{parent:t,unboxSnippets:n,onDidRender:i,blocksDiffOptions:r,textDiffOptions:o}=this.props;let a=[];function l(e){const t=e.svg;if(t){if("SVG"==t.tagName){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),n=e[2];let i=e[3];(n>480||i>128)&&(i=.8*i|0),t.setAttribute("height",`${i}px`)}return t}{const t=document.createElement("div");return t.className="ui basic segment",t.textContent=e.message||lf("No changes."),t}}function c(e,i){const r=e.textContent,o=document.createElement("div");pxsim.U.clear(e),e.appendChild(o),o.className=`ui ${n?"":"segment raised "} loading`;const s={type:"pxteditor",action:"renderblocks",ts:r,snippetMode:i},l=JSON.stringify(s);if(h.blockSnippetCache[l]){const e=h.blockSnippetCache[l],t=d.utils.xml.textToDom(u.serializeSvgString(e));o.appendChild(t),pxsim.U.removeClass(o,"loading")}else a.push(t.renderBlocksAsync(s).then((e=>{const t=e.svg;if(t){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),n=e[2];let i=e[3];(n>480||i>128)&&(i=.8*i|0),t.setAttribute("height",`${i}px`),pxt.BrowserUtils.isIE()||(h.blockSnippetCache[l]=d.Xml.domToText(t)),o.appendChild(t),pxsim.U.removeClass(o,"loading")}else{const e=document.createElement("span");e.textContent=lf("Oops, something went wrong trying to render this block snippet."),o.appendChild(e),pxsim.U.removeClass(o,"loading")}})))}pxt.Util.toArray(e.querySelectorAll("img")).forEach((e=>{a.push(new Promise(((t,n)=>{e.addEventListener("load",(()=>t()),!1),e.addEventListener("error",(()=>t()),!1)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-typescript,code.lang-python")).forEach((e=>{const t=e.textContent,n=this.startRenderLangSnippet(e);this.finishRenderLangSnippet(n,t)})),pxt.Util.toArray(e.querySelectorAll("code.lang-spy")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffspy")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:n,fileB:i}=pxt.diff.split(e);return pxt.Util.promiseMapAllSeries([n,i],(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))).then((e=>pxt.diff.render(e[0],e[1],o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})))})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diff,code.lang-diffpython")).forEach((e=>{a.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:t,fileB:n}=pxt.diff.split(e),i=pxt.diff.render(t,n,o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});return Promise.resolve(i)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-blocks")).forEach((e=>c(e,!1))),pxt.Util.toArray(e.querySelectorAll("code.lang-block")).forEach((e=>c(e,!0))),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocksxml")).forEach((e=>{const t=e.textContent,{fileA:n,fileB:i}=pxt.diff.split(t);a.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>l(u.diffXml(n,i,r)))))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocks")).forEach((e=>{const t=e.textContent,{fileA:n,fileB:i}=pxt.diff.split(t);a.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>s.getBlocksAsync())).then((e=>pxt.Util.promiseMapAllSeries([n,i],(t=>s.decompileBlocksSnippetAsync(t,e))))).then((e=>u.decompiledDiffAsync(n,e[0],i,e[1],r||{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}))).then((e=>l(e))))))})),(a=a.filter((e=>!!e))).length&&i&&Promise.all(a).then((()=>{pxt.log("markdowcontent: forcing update after async rendering"),i()}))}renderVideo(e){pxt.Util.toArray(e.querySelectorAll("iframe.yt-embed")).forEach((e=>{var t,n;let i=null!==(n=null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.defaultLocale)&&void 0!==n?n:"en";const r=e.getAttribute("src");let o=new URL(r);pxt.tickEvent("video.loaded",{player:"youtube",url:r}),o.searchParams.append("hl",i),e.setAttribute("src",o.toString())})),pxt.Util.toArray(e.querySelectorAll("Video.ams-embed")).forEach((e=>{let t=(0,a.MediaPlayer)().create();t.initialize(e,e.getAttribute("src"),!1);const n=e.getAttribute("src");let i=new URL(n);pxt.tickEvent("video.loaded",{player:"azure",url:n});const r=t.getVideoElement(),o=parseInt(i.searchParams.get("startTime"))||0,s=parseInt(i.searchParams.get("endTime"));if(s&&t.on(l.MediaPlayer.events.PLAYBACK_TIME_UPDATED,(e=>{s<=e.time&&(r.currentTime=o,t.pause())})),null==r?void 0:r.requestPictureInPicture){r.addEventListener("enterpictureinpicture",(()=>{r.setAttribute("data-pip-active","true")})),r.addEventListener("leavepictureinpicture",(()=>{r.setAttribute("data-pip-active",void 0),t.pause()}));const n=document.createElement("button");e.parentElement.appendChild(n),n.addEventListener("click",(()=>{pxt.tickEvent("video.pip.requested"),r.requestPictureInPicture()})),n.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e))),n.className="common-button",n.textContent=lf("Pop out video"),n.ariaLabel=lf("Open video in picture-in-picture mode"),n.title=n.ariaLabel}else if(pxt.BrowserUtils.isFirefox()){const t=document.createElement("button");e.parentElement.appendChild(t),t.addEventListener("click",(()=>{pxt.tickEvent("video.pip.firefoxHelp"),window.open("/firefox-picture-in-picture","_blank")})),t.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e))),t.className="common-button",t.textContent=lf("Pop out video"),t.ariaLabel=lf("Instructions on how to open video in picture-in-picture mode"),t.title=t.ariaLabel}t.on(l.MediaPlayer.events.PLAYBACK_STARTED,(e=>{pxt.tickEvent("video.playback.started",{player:"azure",url:n})}))}))}renderInlineBlocks(e){const t=pxt.Util.toArray(e.querySelectorAll(":not(pre) > code")).map((e=>{const t=e.innerText,n=/^(\|+)([^\|]+)\|+$/.exec(t);if(n){const t=/^(([^:.]*?)[:.])?(.*)$/.exec(n[2]),i=t[3].trim(),r=1==n[1].length,o=t[2]?t[2].trim().toLowerCase():"",s=/^([^()]+)\(([^()]+)\)$/.exec(o),a=pxt.Util.htmlEscape((null==s?void 0:s[1])||o),l=pxt.Util.htmlEscape((null==s?void 0:s[2])||o),c=r?`docs inlinebutton ui button ${pxt.Util.htmlEscape(i.toLowerCase())}-button`:`docs inlineblock ${a}`,u=document.createElement("span");return pxsim.U.clear(e),e.appendChild(u),u.className=c,u.textContent=pxt.U.rlf(i),u.setAttribute("data-ns",l),a!==l&&u.setAttribute("data-norecolor","true"),!r&&u}})).filter((e=>!!e));s.getBlocksAsync().then((e=>{var n,i;const r=Object.keys(e.apis.byQName).filter((t=>{var n;return 5===(null===(n=e.apis.byQName[t])||void 0===n?void 0:n.kind)}));for(const o of t){let t=o.getAttribute("data-ns");const s=r.find((e=>t.toLowerCase()==e.toLowerCase()));s&&t!==s&&(t=s);const a=e.apis.byQName[t];let l=null===(n=null==a?void 0:a.attributes)||void 0===n?void 0:n.color;if(/^logic$/i.test(t))t="logic",l=pxt.toolbox.getNamespaceColor(t);else if(/^functions?$/i.test(t))t="functions",l=pxt.toolbox.getNamespaceColor(t);else if(/^variables?$/i.test(t))t="variables",l=pxt.toolbox.getNamespaceColor(t);else if(/^arrays?$/i.test(t))t="arrays",l=pxt.toolbox.getNamespaceColor(t);else if(5!==(null==a?void 0:a.kind))continue;const u=(null===(i=null==a?void 0:a.attributes)||void 0===i?void 0:i.advanced)||"arrays"===t;o.classList.add("clickable"),o.tabIndex=0,o.ariaLabel=lf("Toggle the {0} category",t),o.title=o.ariaLabel,l&&!o.getAttribute("data-norecolor")&&(o.style.backgroundColor=l,o.style.borderColor=pxt.toolbox.fadeColor(l,.1,!1)),o.addEventListener("click",(e=>{const n='#maineditor > div:not([style*="display:none"]):not([style*="display: none"])';if(u){const e=`${n} .blocklyTreeRow[data-ns="advancedcollapsed"]`,t=document.querySelector(e);null==t||t.click()}const i=`${n} .blocklyTreeRow[data-ns="${t}"]`,r=document.querySelector(i);null==r||r.click()})),o.addEventListener("keydown",(e=>(0,c.fireClickOnEnter)(e)))}}))}renderBullets(e){const t=/^:([^:]+):/i;pxt.Util.toArray(e.querySelectorAll("li")).forEach((e=>{const n=e.innerHTML.match(t);if(null==n?void 0:n[1]){const t=document.createElement("p");pxt.Util.toArray(e.childNodes).forEach((e=>t.appendChild(e))),e.appendChild(t)}})),pxt.Util.toArray(e.querySelectorAll("li > p")).forEach((e=>{const n=e.innerText.match(t);if(null==n?void 0:n[1]){const i=pxt.Util.toArray(e.childNodes).find((e=>"#text"===e.nodeName));(null==i?void 0:i.nodeValue)&&(i.nodeValue=i.nodeValue.replace(t,""));const r=e.parentElement;r.className+=" formatted-bullet-li";const o=r.parentElement;o.classList.contains("formatted-bullet-ul")||(o.className+=" formatted-bullet-ul");const s=document.createElement("div");s.className="formatted-bullet";const a=document.createElement("i");let l=n[1].split(" "),c=l.filter((e=>this.semanticIconNames.indexOf(e)>=0));c.length?a.className=`ui icon ${c.join(" ")}`:(c=l.filter((e=>this.customIconNames.indexOf(e)>=0)),a.className=`ui xicon ${c.join(" ")}`),s.appendChild(a),r.insertBefore(s,e)}}))}renderAccordianHints(e){const t=/^\s*~hint\s*(.+)\n?([\s\S]*)/i,n=/([\s\S]*\n|^.*)hint~\s*/im;class i{constructor(){this.beginElement=null,this.summary=null,this.childNodes=[]}}let r=[],o=null;for(let s of e.childNodes)if(s instanceof HTMLElement){const e=s;if(null==o&&"p"===e.tagName.toLowerCase()){const n=e.innerHTML.match(t);if(n&&((o=new i).beginElement=e,o.summary=document.createElement("summary"),o.summary.append(n[1]),0!=n[2].length)){const e=document.createElement("p");e.append(n[2].replace("hint~","")),o.childNodes.push(e)}}null!=o&&(o.beginElement!=e&&o.childNodes.push(e),e.innerHTML.match(n)&&(e.innerHTML=e.innerHTML.replace("hint~",""),r.push(o),o=null))}else null!=o&&o.childNodes.push(s);r.forEach((e=>{const t=document.createElement("details");t.addEventListener("pointerdown",(()=>{const e=t.querySelectorAll("video");for(const t of e)t.getAttribute("data-pip-active")||t.pause()})),t.addEventListener("keydown",c.fireClickOnEnter),t.append(e.summary),e.childNodes.forEach((e=>{t.appendChild(e)})),e.beginElement.parentNode.replaceChild(t,e.beginElement)}))}renderOthers(e){pxt.Util.toArray(e.querySelectorAll(".lang-package,.lang-config,.lang-apis")).forEach((e=>{e.parentNode.removeChild(e)}))}renderMarkdown(e){const t=this.contentRef,n=this.getBuiltinMacros();if(!e)return;pxt.perf.measureStart("renderMarkdown"),e=e.replace(/@([a-z]+)@/gi,((e,t)=>n[t]||"unknown macro"));let i=new o.Renderer;pxt.docs.setupRenderer(i);const r=i.link;i.link=function(e,t,n){const o=/^[\/#]/.test(e)?"":"_blank";return r.call(i,e,t,n).replace(/^<a /,`<a ${o?`target="${o}"`:""} rel="nofollow noopener" `)},o.setOptions({renderer:i,sanitize:!0,sanitizer:pxt.docs.requireDOMSanitizer()}),e=e.replace(/<\s*script[^>]*>.*<\/\s*script[^>]*>/gi,"");const s=document.createElement("div");s.innerHTML=o(e),this.renderInlineBlocks(s),this.renderSnippets(s),this.renderBullets(s),this.renderAccordianHints(s),this.renderOthers(s),this.renderVideo(s),t.innerHTML="",t.append(...s.childNodes),pxt.perf.measureEnd("renderMarkdown")}componentDidMount(){const{markdown:e}=this.props;this.renderMarkdown(e)}UNSAFE_componentWillReceiveProps(e){const{markdown:t}=e;this.props.markdown!=e.markdown&&this.renderMarkdown(t)}renderCore(){const{className:e,tabIndex:t}=this.props;return(0,i.jsx)("div",{ref:this.handleContentRef,className:e||"",tabIndex:t})}}n.MarkedContent=h,h.blockSnippetCache={}},{"../../pxtblocks":68,"../../react-common/components/util":187,"./compiler":204,"./data":282,blockly:376,dashjs:388,marked:450,"react/jsx-runtime":549}],314:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.merge=n.projects=void 0;const i=e("../../pxteditor");var r=pxt.Util;n.projects={},n.merge=function(e){let t=e.header;t||(e.header=t=i.workspace.freshHeader(lf("Untitled"),r.nowSeconds()),e.text&&e.text[pxt.MAIN_BLOCKS]&&(e.header.editor=pxt.BLOCKS_PROJECT_NAME)),n.projects[e.header.id]=e},n.provider={getAsync:function(e){let t=n.projects[e.id];return Promise.resolve({header:e,text:t?t.text:{},version:null})},setAsync:function(e,t,i){return i&&(n.projects[e.id]={header:e,text:i}),Promise.resolve()},deleteAsync:function(e,t){return delete n.projects[e.id],Promise.resolve()},listAsync:function(){return Promise.resolve(r.values(n.projects).map((e=>e.header)))},resetAsync:function(){return n.projects={},Promise.resolve()}}},{"../../pxteditor":134}],315:[function(e,t,n){"use strict";function i(e,t){var n;if(!e)return t;if(!t)return e;const i=JSON.parse(e),r=JSON.parse(t),o={},s={},a={},l={},c={},u=r["*"].mimeType;for(const e of Object.keys(r)){if("*"===e)continue;const t=r[e];let n;a[e]=!0;let i=u,l=!1;"string"==typeof t?n=t:(n=t.data,i=t.mimeType,l=!!t.tilemapTile,t.displayName&&(s[t.displayName]=!0)),i!==pxt.TILEMAP_MIME_TYPE&&(o[i+l+n]=e)}for(const e of Object.keys(i)){if("*"===e)continue;const t=i[e];let n,d,h=u,p=!1,f=!1;"string"==typeof t?(n=t,f=!0):(n=t.data,d=t.displayName,h=t.mimeType,p=!!t.tilemapTile);const g=h+p+n;if(o[g]){p&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+o[g]);continue}if(!d)switch(h){case pxt.IMAGE_MIME_TYPE:d=p?`${pxt.sprite.TILE_NAMESPACE}.${pxt.sprite.TILE_PREFIX}`:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}`;break;case pxt.TILEMAP_MIME_TYPE:d="tilemap";break;case pxt.ANIMATION_MIME_TYPE:d=`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}`}if(d&&s[d]){let e=0;for(;s[d+e];)e++;s[d+=e]=!0}let m=e;if(a[m]){let t=0;for(;a[m+t];)t++;a[m+=t]=!0,p&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+m)}h!==pxt.TILEMAP_MIME_TYPE&&(o[g]=e);const b=Object.assign(Object.assign({},f?{}:i[e]),{data:n,displayName:d,mimeType:h});b.id&&(b.id=m),h===pxt.TILEMAP_MIME_TYPE?c[m]=b:r[m]=b}for(const e of Object.keys(c)){const t=c[e];t.tileset=null===(n=t.tileset)||void 0===n?void 0:n.map((e=>l[e]||e)),r[e]=t}return JSON.stringify(r)}function r(e,t){if(!e)return t;let n=pxt.U.jsonTryParse(t)||{};n["*"]||(n["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:pxt.sprite.IMAGES_NAMESPACE});let i=0;return function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*(img`[\s\da-f.#tngrpoyw]+`)\s*<\/field>/gim,((e,n)=>{var i;const r=null===(i=pxt.sprite.imageLiteralToBitmap(n))||void 0===i?void 0:i.data();return r&&t.push(r),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;n[`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${i}`];)i++;n[t]={data:pxt.sprite.base64EncodeBitmap(e),mimeType:pxt.IMAGE_MIME_TYPE,displayName:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${i}`},i++})),i=0,function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*\[((?:img`[\s\da-f.#tngrpoyw]+`,?)+)\]\s*<\/field>(?:.*<shadow type=\"timePicker\"><field name=\"ms\">(\d+)<\/field><\/shadow>)?/gim,((e,n,i)=>{const r=n.split(",").map((e=>{var t;return null===(t=pxt.sprite.imageLiteralToBitmap(e))||void 0===t?void 0:t.data()}));return t.push({frames:r.filter((e=>!!e)),interval:i||500}),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;n[`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_NAMESPACE}${i}`];)i++;n[t]={data:pxt.sprite.encodeAnimationString(e.frames,e.interval),mimeType:pxt.ANIMATION_MIME_TYPE,displayName:`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}${i}`},i++})),JSON.stringify(n)}Object.defineProperty(n,"__esModule",{value:!0}),n.appendTemporaryAssets=n.mergeProjectCode=void 0,n.mergeProjectCode=function(e,t,n){var o,s;const a=t[pxt.CONFIG_NAME],l=pxt.U.jsonTryParse(a),c=n?i(t[pxt.TILEMAP_JRES],e[pxt.TILEMAP_JRES]):i(e[pxt.TILEMAP_JRES],t[pxt.TILEMAP_JRES]),u=n?i(t[pxt.IMAGES_JRES],e[pxt.IMAGES_JRES]):i(r(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]),t[pxt.IMAGES_JRES]);return c&&(null===(o=null==l?void 0:l.files)||void 0===o?void 0:o.indexOf(pxt.TILEMAP_JRES))<0&&l.files.push(pxt.TILEMAP_JRES),u&&(null===(s=null==l?void 0:l.files)||void 0===s?void 0:s.indexOf(pxt.IMAGES_JRES))<0&&l.files.push(pxt.IMAGES_JRES),Object.assign(Object.assign({},t),{[pxt.MAIN_TS]:n?e[pxt.MAIN_TS]:t[pxt.MAIN_TS],[pxt.MAIN_PY]:n?e[pxt.MAIN_PY]:t[pxt.MAIN_PY],[pxt.MAIN_BLOCKS]:n?e[pxt.MAIN_BLOCKS]:t[pxt.MAIN_BLOCKS],[pxt.TILEMAP_JRES]:c,[pxt.IMAGES_JRES]:u,[pxt.CONFIG_NAME]:JSON.stringify(l)})},n.appendTemporaryAssets=r},{}],316:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rangeToSelection=n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("./package"),s=e("./core"),a=e("./toolboxeditor"),l=e("./compiler"),c=e("./monacoSnippets"),u=e("./monacopyhelper"),d=e("./simulator"),h=e("./toolbox"),p=e("./blocklyFieldView"),f=e("./monacoFieldEditorHost"),g=e("./data");var m=pxt.Util;const b=e("./monacoDebugger"),y=e("./debuggerToolbox"),v=e("./monacoEditAmendments"),_=e("./monacoFlyout"),E=e("./errorList"),T=e("./auth"),x=e("../../pxteditor"),w=e("../../pxtblocks");class k{constructor(e,t){this.editor=e,this.python=t,this.triggerCharacters=["(","."],this.kindMap={}}tsKindToMonacoKind(e){switch(e){case 1:return monaco.languages.CompletionItemKind.Method;case 2:return monaco.languages.CompletionItemKind.Property;case 3:return monaco.languages.CompletionItemKind.Function;case 4:return monaco.languages.CompletionItemKind.Variable;case 5:return monaco.languages.CompletionItemKind.Module;case 6:return monaco.languages.CompletionItemKind.Class;case 7:return monaco.languages.CompletionItemKind.Enum;case 8:return monaco.languages.CompletionItemKind.Class;case 9:return monaco.languages.CompletionItemKind.Interface;default:return monaco.languages.CompletionItemKind.Text}}provideCompletionItems(e,t,n,i){const r=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name,a=e.getWordUntilPosition(t),c=e.getOffsetAt({lineNumber:t.lineNumber,column:a.startColumn}),u=e.getOffsetAt({lineNumber:t.lineNumber,column:a.endColumn});return l.completionsAsync(s,r,c,u,o,pxt.options.light).then((n=>{function i(e){if(!e)return e;for(let t of n.namespace){if(!e.startsWith(t+"."))break;e=e.substr((t+".").length)}return e}let r=n.entries||[];return{suggestions:(r=r.filter((e=>"_"!=e.name.charAt(0)))).map(((r,o)=>{let s=this.python?r.pySnippetWithMarkers:r.snippetWithMarkers;const a=!!s,l=this.python?r.pySnippet:r.snippet;let c=a?s:l;c=i(c);let u=i(this.python?r.pyQName:r.qName),h=this.python?r.pyName:r.name,p=c&&c.indexOf("\n")>=0;if(this.python&&c&&p&&pxt.blocks.hasHandler(r))c=(0,v.amendmentToInsertSnippet)((0,v.createLineReplacementPyAmendment)(c));else if(c=c||u,n.isMemberCompletion&&c){const e=c.lastIndexOf(h);-1!==e&&(c=c.substr(e))}const f=n.isMemberCompletion?h:u,g=pxt.Util.rlf(r.attributes.jsDoc),m=pxt.Util.rlf(r.attributes.block),b=e.getWordAtPosition(t),y={startLineNumber:t.lineNumber,startColumn:b?b.startColumn:t.column,endColumn:t.column,endLineNumber:t.lineNumber},_=`${f},${g},${m}`.replace(/\s/g,","),E=this.tsKindToMonacoKind(r.kind);return{label:f,range:y,kind:E,documentation:g,detail:`(${monaco.languages.CompletionItemKind[E].toLowerCase()}) ${l||""}`,sortText:`${d(o)} ${c}`,filterText:_,insertText:c||void 0,insertTextRules:a?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0}}))}}));function d(e){return("000"+e).slice(-4)}}}class S{constructor(e,t){this.editor=e,this.python=t,this.signatureHelpTriggerCharacters=["(",","],this.isPython=!1,this.isPython=t}provideSignatureHelp(e,t,n,i){const r=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name;return l.syntaxInfoAsync("signature",s,r,o).then((e=>{let t=e.symbols?e.symbols[0]:null;if(!t||!t.parameters)return null;const n=pxt.Util.rlf(t.attributes.jsDoc);let i=t.parameters.map((e=>({label:`${e.name}: ${this.isPython?e.pyTypeString:e.type}`,documentation:pxt.Util.rlf(e.description)})));return{value:{signatures:[{label:`${this.isPython&&t.pyName?t.pyName:t.name}(${i.map((e=>e.label)).join(", ")})`,documentation:n,parameters:i}],activeSignature:0,activeParameter:e.auxResult},dispose:()=>{}}}))}}class C{constructor(e,t){this.editor=e,this.python=t}provideHover(e,t,n){if(this.editor.hasInsertionSnippet())return null;const i=e.getOffsetAt(t),r=e.getValue(),o=this.editor.currFile.name;return l.syntaxInfoAsync("symbol",o,i,r).then((t=>{let n,i=t.symbols?t.symbols[0]:null;if(i){const e=pxt.Util.rlf(i.attributes.jsDoc);n=[t.auxResult[0],e]}else t.auxResult&&(n=[t.auxResult.displayString,t.auxResult.documentation]);return n?{contents:n.map(A),range:monaco.Range.fromPositions(e.getPositionAt(t.beginPos),e.getPositionAt(t.endPos))}:null}))}}function A(e){return{value:e}}const I={comments:{lineComment:"#",blockComment:['"""','"""']},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:'r"',close:'"',notIn:["string","comment"]},{open:'R"',close:'"',notIn:["string","comment"]},{open:'u"',close:'"',notIn:["string","comment"]},{open:'U"',close:'"',notIn:["string","comment"]},{open:'f"',close:'"',notIn:["string","comment"]},{open:'F"',close:'"',notIn:["string","comment"]},{open:'b"',close:'"',notIn:["string","comment"]},{open:'B"',close:'"',notIn:["string","comment"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"r'",close:"'",notIn:["string","comment"]},{open:"R'",close:"'",notIn:["string","comment"]},{open:"u'",close:"'",notIn:["string","comment"]},{open:"U'",close:"'",notIn:["string","comment"]},{open:"f'",close:"'",notIn:["string","comment"]},{open:"F'",close:"'",notIn:["string","comment"]},{open:"b'",close:"'",notIn:["string","comment"]},{open:"B'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string"]}],onEnterRules:[{beforeText:/^\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async).*?:\s*$/,action:{indentAction:1}}]};class O{constructor(e,t){this.editor=e,this.python=t,this.isPython=!1,this.isPython=t}provideDocumentRangeFormattingEdits(e,t,n,i){return Promise.resolve().then((r=>this.isPython?u.provideDocumentRangeFormattingEdits(e,t,n,i):null))}}const N={cpp:"cpp",h:"cpp",json:"json",md:"markdown",py:"python",ts:"typescript",js:"javascript",svg:"xml",blocks:"xml",asm:"asm"};class R extends a.ToolboxEditor{constructor(e){super(e),this.fileType="text",this.giveFocusOnLoading=!0,this.foldFieldEditorRanges=!0,this.hasFieldEditors=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),this.highlightDecorations=[],this.errorChangesListeners={},this.exceptionChangesListeners={},this.userPreferencesSubscriber={subscriptions:[],onDataChanged:()=>{this.onUserPreferencesChanged()}},this.handleFlyoutWheel=e=>e.stopPropagation(),this.handleFlyoutScroll=e=>e.stopPropagation(),this.insertSnippet=(e,t,n=!1)=>{let i=this.editor.getPosition(),r=this.editor.getModel();if(e||(e=i),!e)return;let o,s=e.clone();"NewLineAfter"==(o=n?"Inline":1===e.column?"NewLineBefore":"NewLineAfter")&&(s=s.with(s.lineNumber,r.getLineMaxColumn(e.lineNumber)));const a=r.getLineContent(e.lineNumber);"Inline"===o||!a||("NewLineAfter"===o?t="\n"+t:t+="\n");const l=e=>{let t=e.match(/^\s*/)[0]||"";return t=t.replace("\t"," ".repeat(4)),Math.floor(t.length/4)},c=l(a);let u;if("NewLineAfter"===o){const t=Math.min(e.lineNumber+1,r.getLineCount()),n=l(r.getLineContent(t));u=Math.max(c,n)}else u="NewLineBefore"===o?c:0;const d=" ".repeat(4*u);if(d){let e=t.split("\n");t=(e=e.map((e=>e?d+e:e))).join("\n")}this.editor.pushUndoStop(),this.editor.executeEdits("",[{range:new monaco.Range(s.lineNumber,s.column,s.lineNumber,s.column),text:t||"",forceMoveMarkers:!0}]),this.beforeCompile(),this.editor.pushUndoStop(),this.editor.focus()},this.dragCurrentPos={x:0,y:0},this.onDragBlockThrottled=m.throttle((()=>{const{x:e,y:t}=this.dragCurrentPos;let n=this.editor.getTargetAtClientPoint(e,t);n&&n.position&&this.editor.getPosition()!=n.position&&this.editor.setPosition(n.position),this.editor.focus()}),200),this.onPointerMove=e=>{this.insertionSnippet&&(this.dragCurrentPos={x:pxt.BrowserUtils.getClientX(e),y:pxt.BrowserUtils.getClientY(e)},this.onDragBlockThrottled(e))},this.onPointerUp=e=>{let t=this.insertionSnippet;if(this.setInsertionSnippet(void 0),t){let n=pxtc.U.startsWith(t,"inline:1&");n&&(t=t.substring("inline:1&".length));let i=Promise.resolve(t);if(pxtc.U.startsWith(t,"qName:")){let e="python"==this.fileType,n=t.substring("qName:".length);i=(e?this.parent.saveFileAsync():Promise.resolve()).then((()=>l.snippetAsync(n,e)))}i.then((t=>{let i=this.editor.getTargetAtClientPoint(pxt.BrowserUtils.getClientX(e),pxt.BrowserUtils.getClientY(e)).position;pxt.tickEvent("monaco.toolbox.insertsnippet"),this.insertSnippet(i,t,n)}))}},this.moveFocusToToolbox=()=>{this.toolbox&&this.toolbox.focus()},this.revealBreakpointLocation=(e,t)=>{if(!this.breakpoints)return;const n=this.breakpoints.getLocationOfBreakpoint(e);n&&(this.highlightedBreakpoint=e,this.currFile.getTextFileName()!==n.fileName?(o.mainEditorPkg(),P(n.fileName)&&this.parent.setFile(P(n.fileName))):this.highilightStatementCore(n,!0),this.debuggerToolbox&&this.debuggerToolbox.setState({currentFrame:t}))},this.setInsertionSnippet=e=>{this.insertionSnippet=e},this.hasInsertionSnippet=()=>!!this.insertionSnippet,this.uniqueBlockId=0,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebugToolboxRef=e=>{e&&(this.debuggerToolbox=e,this.isDebugging()&&this.updateToolbox())},this.handleFlyoutRef=e=>{e&&(this.flyout=e)},this.setErrorListState=this.setErrorListState.bind(this),this.listenToErrorChanges=this.listenToErrorChanges.bind(this),this.listenToExceptionChanges=this.listenToExceptionChanges.bind(this),this.goToError=this.goToError.bind(this),this.startDebugger=this.startDebugger.bind(this),this.onUserPreferencesChanged=this.onUserPreferencesChanged.bind(this),g.subscribe(this.userPreferencesSubscriber,T.HIGHCONTRAST)}onUserPreferencesChanged(){const e=g.getData(T.HIGHCONTRAST);this.loadMonacoPromise&&this.defineEditorTheme(e,!0)}hasBlocks(){if(!this.currFile)return!0;let e=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME);return e&&null!=o.mainEditorPkg().files[e]}openBlocks(){this.openBlocksAsync()}async openBlocksAsync(){pxt.tickEvent("typescript.showBlocks");let e=Promise.resolve();if(!this.currFile){const e=o.mainEditorPkg();if(!e||!e.files[pxt.MAIN_TS])return;await this.loadFileAsync(e.files[pxt.MAIN_TS])}let t=e.then((()=>{const e="python"==this.fileType,t=e?"python":"typescript";pxt.tickEvent(`${t}.convertBlocks`);const n=o.mainEditorPkg();if(!this.hasBlocks()&&!n&&!n.files[pxt.MAIN_BLOCKS])return void pxt.debug("cancelling convertion to blocks, but main.blocks is missing");this.feWidget&&(this.feWidget.close(),this.activeRangeID=null);let i=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),r=e?this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME):this.currFile.name;if(!this.hasBlocks()){if(!n||!n.files[pxt.MAIN_BLOCKS])return void(n&&this.parent.setFile(n.files[pxt.MAIN_TS]));this.currFile=n.files[pxt.MAIN_TS],i=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),r=pxt.MAIN_TS}const a=(e,t=!1)=>(s.cancelAsyncLoading("switchtoblocks"),this.forceDiagnosticsUpdate(),this.showBlockConversionFailedDialog(e,t));let c,u;return this.parent.saveFileAsync().then((()=>this.parent.saveFileAsync())).then((()=>this.parent.loadBlocklyAsync())).then((()=>this.saveToTypeScriptAsync())).then((()=>l.getBlocksAsync())).then((e=>{if(u=e,w.cleanBlocks(),w.initializeAndInject(u),!w.validateAllReferencedBlocksExist(n.files[i].content))return[void 0,!0];const r=w.loadWorkspaceXml(n.files[i].content);return r?w.compileAsync(r,u).then((e=>{const o=e.source;return l.formatAsync(o,0).then((e=>l.formatAsync(this.editor.getValue(),0).then((o=>e.formatted==o.formatted?(pxt.debug(`${t} not changed, skipping decompile`),pxt.tickEvent(`${t}.noChanges`),this.parent.setFile(n.files[i]),[r,!1]):[r,!0]))))})):[r,!0]})).then((e=>{if(!e)return Promise.resolve();const t=e[0];return e[1]?l.compileAsync().then((e=>e.success?this.transpileToBlocksInternalAsync(this.currFile,u,t).then((e=>{if(!e.success){const t=e.failedResponse;this.currFile.diagnostics=t.diagnostics;let n=!1;return t.diagnostics.forEach((e=>n=n||9266===e.code)),a(i,n)}return c=e.outText,m.assert(!!c),n.setContentAsync(i,c).then((()=>this.parent.setFile(n.files[i])))})):a(i,!1))):Promise.resolve()})).catch((e=>{pxt.reportException(e),s.errorNotification(lf("Oops, something went wrong trying to convert your code."))}))}));return s.showLoadingAsync("switchtoblocks",lf("switching to blocks..."),t),e}showBlockConversionFailedDialog(e,t){const n="python"==this.fileType,i=n?"python":"typescript";let r,a,l=o.mainEditorPkg().files[e];return t&&pxt.tickEvent(`${i}.programTooLarge`),n?(r=t?lf("Your program is too large to convert into blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your Python code back to blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."),a=lf("Stay in Python")):(r=t?lf("Your program is too large to convert into blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your JavaScript code back to blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."),a=lf("Stay in JavaScript")),s.confirmAsync({header:t?lf("Program too large"):lf("Oops, there is a problem converting your code."),body:r,agreeLbl:lf("Discard and go to Blocks"),agreeClass:"cancel",agreeIcon:"cancel",disagreeLbl:a,disagreeClass:"positive",disagreeIcon:"checkmark",hideCancel:!l}).then((e=>{e?(pxt.tickEvent(`${i}.discardText`,void 0,{interactiveConsent:!0}),this.parent.saveBlocksToTypeScriptAsync().then((e=>{this.overrideFile(e),this.parent.setFile(l)}))):pxt.tickEvent(`${i}.keepText`,void 0,{interactiveConsent:!0})}))}transpileToBlocksInternalAsync(e,t,n){const i=o.mainEditorPkg(),r=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),s=e.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),a="py"===e.getExtension()?"py":"ts",c=e.content,u=i.getCachedTranspile(a,c,"blocks");return null!=u?Promise.resolve({success:!0,outText:u}):l.decompileAsync(r,t,n,s).then((e=>{if(!e.success)return{success:!1,failedResponse:e};const t=e.outfiles[s];return i.cacheTranspile(a,c,"blocks",t),{success:!0,outText:t}}))}decompileAsync(e){return l.decompileAsync(e)}setVisible(e){super.setVisible(e),e||this.onErrorChanges([])}display(){const e=pxt.appTarget.appTheme.errorList,t=pxt.BrowserUtils.isAndroid();return(0,i.jsxs)("div",Object.assign({id:"monacoEditorArea",className:"monacoEditorArea "+(t?"android":""),style:{direction:"ltr"}},{children:[this.isVisible&&(0,i.jsxs)("div",Object.assign({className:"monacoToolboxDiv "+(!this.toolbox||this.toolbox.state.visible||this.isDebugging()?"":"invisible")},{children:[(0,i.jsx)(h.Toolbox,{ref:this.handleToolboxRef,editorname:"monaco",parent:this}),(0,i.jsx)("div",{id:"monacoDebuggerToolbox"})]})),(0,i.jsxs)("div",Object.assign({id:"monacoEditorRightArea",className:"monacoEditorRightArea"},{children:[(0,i.jsx)("div",Object.assign({id:"monacoEditorInner"},{children:(0,i.jsx)(_.MonacoFlyout,{ref:this.handleFlyoutRef,fileType:this.fileType,blockIdMap:this.blockIdMap,moveFocusToParent:this.moveFocusToToolbox,insertSnippet:this.insertSnippet,setInsertionSnippet:this.setInsertionSnippet,parent:this.parent})})),e&&(0,i.jsx)(E.ErrorList,{isInBlocksEditor:!1,onSizeChange:this.setErrorListState,listenToErrorChanges:this.listenToErrorChanges,listenToExceptionChanges:this.listenToExceptionChanges,goToError:this.goToError,startDebugger:this.startDebugger})]}))]}))}listenToExceptionChanges(e,t){this.exceptionChangesListeners[e]=t}onExceptionDetected(e){for(let t of pxt.U.values(this.exceptionChangesListeners))t(e,this.callLocations)}listenToErrorChanges(e,t){this.errorChangesListeners[e]=t}goToError(e){let t,n;e.endLine&&e.endColumn?(t=e.endLine+1,n=e.endColumn+1):(t=e.line+1,n=e.column+e.length+1),this.editor.revealLineInCenter(t),this.editor.setPosition({column:n,lineNumber:t}),this.editor.focus()}startDebugger(){pxt.tickEvent("errorList.startDebugger",null,{interactiveConsent:!0}),this.parent.toggleDebugging()}onErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}showPackageDialog(){pxt.tickEvent("monaco.addpackage",void 0,{interactiveConsent:!0}),this.hideFlyout(),this.parent.showPackageDialog()}defineEditorTheme(e,t){const n=pxt.appTarget.appTheme.invertedMonaco;let i=[];if(!e&&t){const e={};this.getNamespaces().forEach((t=>{const n=this.getNamespaceAttrs(t),r=c.isBuiltin(t)?c.getBuiltinCategory(t).blocks.concat(this.nsMap[t]||[]):this.nsMap[t];if(n.color&&r){let s=o(n.color);r.forEach((e=>{i.push({token:`identifier.ts ${e.name}`,foreground:s})})),i.push({token:`identifier.ts ${t}`,foreground:s}),e[t]=n.color}})),i.push({token:"identifier.ts if",foreground:"5B80A5"}),i.push({token:"identifier.ts else",foreground:"5B80A5"}),i.push({token:"identifier.ts while",foreground:"5BA55B"}),i.push({token:"identifier.ts for",foreground:"5BA55B"});const t=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(t){const n=t.callName||"pauseUntil",r=t.color||e[t.category];r&&i.push({token:`identifier.ts ${n}`,foreground:o(r)})}}const r=pxt.appTarget.appTheme.monacoColors||{};function o(e){return e=pxt.toolbox.convertColor(e),(n?pxt.toolbox.fadeColor(e,.6,!0):e).replace("#","")}monaco.editor.defineTheme("pxtTheme",{base:e?"hc-black":n?"vs-dark":"vs",inherit:!0,rules:i,colors:e?{}:r}),monaco.editor.setTheme("pxtTheme")}saveToTypeScriptAsync(){return"python"==this.fileType?this.convertPythonToTypeScriptAsync(this.isDebugging()||this.parent.state.tracing):Promise.resolve(void 0)}convertPythonToTypeScriptAsync(e=!1){if(!this.currFile)return Promise.resolve(void 0);const t=this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);return l.py2tsAsync(e).then((e=>{var n;if(e.sourceMap){const i=o.mainEditorPkg(),r=e.outfiles[t],s=null===(n=i.files[this.currFile.getFileNameWithExtension("py")])||void 0===n?void 0:n.content;this.pythonSourceMap=r&&s?pxtc.BuildSourceMapHelpers(e.sourceMap,r,s):null}if(!e.diagnostics||!e.diagnostics.length)return e.outfiles[t]?e.outfiles[t]:""}))}setHighContrast(e){}beforeCompile(){}isIncomplete(){return!!(this.editor&&this.editor._view&&this.editor._view.contentWidgets._widgets["editor.widget.suggestWidget"].isVisible)||!(!this.editor||this.currFile.name!==pxt.CONFIG_NAME||m.jsonTryParse(this.getCurrentSource()))}resize(e){let t=document.getElementById("monacoEditorArea");if(!t)return;let n=t.getElementsByClassName("monacoToolboxDiv")[0];if(t&&this.editor){const e=n&&n.offsetWidth||0,i=this.parent.isJavaScriptActive()?this.parent.updateEditorLogo(e,this.getEditorColor()):0;if(this.editor.layout({width:t.offsetWidth-e,height:t.offsetHeight-i}),t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect();p.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height})}else p.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight});n&&(n.style.height="100%")}}setErrorListState(e){this.parent.state.errorListState!=e&&(this.resize(),this.parent.setState({errorListState:e}))}prepare(){this.isReady=!0}loadMonacoAsync(){return this.loadMonacoPromise||(this.loadMonacoPromise=this.createLoadMonacoPromise()),this.loadMonacoPromise}createLoadMonacoPromise(){this.extraLibs=Object.create(null),document.getElementById("monacoEditorArea");let e=document.getElementById("monacoEditorInner");return x.monaco.initMonacoAsync(e).then((e=>{if(this.editor=e,"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1&&!this.mobileKeyboardWidget&&(this.mobileKeyboardWidget=new L(this.editor)),this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.editor.addAction({id:"save",label:lf("Save"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.2,run:()=>Promise.resolve(this.parent.typecheckNow())}),this.editor.addAction({id:"runSimulator",label:lf("Run Simulator"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.21,run:()=>Promise.resolve(this.parent.runSimulator())}),pxt.appTarget.compile&&pxt.appTarget.compile.hasHex&&this.editor.addAction({id:"compileHex",label:lf("Download"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.22,run:()=>Promise.resolve(this.parent.compile())}),this.editor.addAction({id:"zoomIn",label:lf("Zoom In"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_ADD,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_EQUAL],run:()=>Promise.resolve(this.zoomIn())}),this.editor.addAction({id:"zoomOut",label:lf("Zoom Out"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_SUBTRACT,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_MINUS],run:()=>Promise.resolve(this.zoomOut())}),pxt.appTarget.appTheme.hasReferenceDocs){let e=this.editor.createContextKey("editorHasReference",!1);this.editor.addAction({id:"reference",label:lf("Help"),keybindingContext:"!editorReadonly && editorHasReference",precondition:"!editorReadonly && editorHasReference",contextMenuGroupId:"navigation",contextMenuOrder:.1,run:()=>Promise.resolve(this.loadReference())}),this.editor.onDidChangeCursorPosition((t=>{let n=this.editor.getModel().getWordUntilPosition(t.position);n&&""!=n.word?e.set(!0):e.reset()}))}this.editor.addAction({id:"jumptoolbox",label:lf("Jump to Toolbox"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KEY_T],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",run:()=>Promise.resolve(this.moveFocusToToolbox())}),this.editor.onDidLayoutChange((e=>{let t=this.getEditorFontSize();this.parent.settings.editorFontSize!=t&&(this.parent.settings.editorFontSize=t,this.forceDiagnosticsUpdate());const n=document.getElementById("monacoToolboxDiv");n&&(n.style.height=`${this.editor.getLayoutInfo().height}px`)}));const t=document.getElementById("monacoEditorInner");pxt.BrowserUtils.hasPointerEvents()?(t.onpointermove=this.onPointerMove,t.onpointerup=this.onPointerUp):(t.onmousemove=this.onPointerMove,t.onmouseup=this.onPointerUp,pxt.BrowserUtils.isTouchEnabled()&&(t.ontouchend=this.onPointerUp)),this.editor.onDidFocusEditorText((()=>{this.hideFlyout()})),monaco.languages.registerCompletionItemProvider("python",new k(this,!0)),monaco.languages.registerSignatureHelpProvider("python",new S(this,!0)),monaco.languages.registerHoverProvider("python",new C(this,!0)),monaco.languages.registerDocumentRangeFormattingEditProvider("python",new O(this,!0)),monaco.languages.setLanguageConfiguration("python",I),this.editorViewZones=[],this.setupFieldEditors(),this.editor.onMouseDown((e=>{e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&this.handleGutterClick(e)})),e.onDidChangeModelContent((t=>{this.fieldEditors&&this.fieldEditors.clearRanges(e)}))}))}undo(){this.editor&&this.editor.trigger("keyboard","undo",null)}redo(){this.editor&&this.editor.trigger("keyboard","redo",null)}zoomIn(){if(!this.editor)return;if(this.parent.settings.editorFontSize>=40)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e+1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}zoomOut(){if(!this.editor)return;if(this.parent.settings.editorFontSize<=10)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e-1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}loadReference(){m.assert(null!=this.editor);const e=this.editor.getModel(),t=e.getOffsetAt(this.editor.getPosition()),n=e.getValue(),i=this.currFile.name;l.syntaxInfoAsync("symbol",i,t,n).then((e=>{if(null==e?void 0:e.symbols)for(const t of e.symbols){const e=pxt.blocks.getHelpUrl(t);if(e)return void w.external.openHelpUrl(e)}s.warningNotification(m.lf("Help resource not found"))}))}setupFieldEditors(){this.hasFieldEditors&&!pxt.shell.isReadOnly()&&(this.fieldEditors||(this.fieldEditors=new f.FieldEditorManager(this.editor),monaco.languages.registerFoldingRangeProvider("typescript",this.fieldEditors),monaco.languages.registerFoldingRangeProvider("python",this.fieldEditors)),this.editor.onDidChangeCursorPosition((e=>{this.fieldEditors&&this.fieldEditors.setCursorLine(e.position.lineNumber)})),pxt.appTarget.appTheme.monacoFieldEditors.forEach((e=>{const t=x.getMonacoFieldEditor(e);t?this.fieldEditors.addFieldEditor(t):pxt.debug("Skipping unknown monaco field editor '"+e+"'")})))}closeFlyout(){this.editor&&this.hideFlyout()}hideFlyout(){this.flyout&&this.flyout.setState({groups:void 0}),this.toolbox&&this.toolbox.clearSelection(),this.parent.setState({hideEditorFloats:!1})}updateToolbox(){pxt.appTarget.appTheme.monacoToolbox&&!pxt.shell.isReadOnly()&&this.editor&&(this.editor.layout(),this.toolbox&&(this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}),this.shouldShowToolbox()?this.toolbox.show():this.toolbox.hide()),this.updateDebuggerToolbox())}updateDebuggerToolbox(){const e=document.getElementById("monacoDebuggerToolbox");if(!e||!this.blockInfo)return;const t=this.isDebugging();t&&this.flyout&&this.flyout.setState({groups:void 0});const n=t?(0,i.jsx)(y.DebuggerToolbox,{ref:this.handleDebugToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName,openLocation:this.revealBreakpointLocation,showCallStack:!0}):null;r.render(n,e)}getId(){return"monacoEditor"}getViewState(){return this.editor?this.editor.getPosition():{}}getCurrentSource(){return this.editor?this.editor.getValue():this.currSource}acceptsFile(e){return!0}setValue(e){this.editor.setValue(e)}overrideFile(e){m.assert(null!=this.editor),this.editor.setValue(e)}shouldShowToolbox(){const e=!this.currFile||this.currFile.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();return pxt.appTarget.appTheme.monacoToolbox&&!e&&("typescript"==this.fileType||"python"==this.fileType)}loadFileAsync(e,t){let n="text";this.currSource=e.content;let i=document.createElement("div");i.className="ui inverted loading dimmer active";let r=document.getElementById("monacoEditorRightArea"),s=document.getElementById("monacoEditorInner");return r.insertBefore(i,s),this.pythonSourceMap=null,this.loadMonacoAsync().then((()=>{if(!this.editor)return Promise.resolve();this.foldFieldEditorRanges=!0,this.updateFieldEditors();let i=e.getExtension();N.hasOwnProperty(i)&&(n=N[i]),this.fileType=n;const r=e.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();this.editor.updateOptions({readOnly:r});let s="pkg:"+e.getName(),a=monaco.editor.getModels().filter((e=>e.uri.toString()==s))[0];if(a||(a=monaco.editor.createModel(o.mainPkg.readFile(e.getName()),n,monaco.Uri.parse(s))),a&&this.editor.setModel(a),this.defineEditorTheme(t),this.currFile=e,this.shouldShowToolbox()?this.beginLoadToolbox(e,t):this.toolbox&&this.toolbox.hide(),this.setValue(e.content),this.setDiagnostics(e,this.snapshotState()),this.breakpoints){this.breakpoints.loadBreakpointsForFile(e,this.editor);const t=this.breakpoints.getLocationOfBreakpoint(this.highlightedBreakpoint);t&&t.fileName===e.getTextFileName()&&this.highilightStatementCore(t,!0)}return"markdown"==this.fileType&&this.parent.setSideMarkdown(e.content),this.currFile.setForceChangeCallback(((e,t)=>{e!=t&&(pxt.debug(`File changed (from ${e}, to ${t}). Reloading editor`),this.loadFileAsync(this.currFile))})),e.isReadonly()||a.onDidChangeContent((e=>{this.clearHighlightedStatements();let t=this.editorViewZones||[];this.editor.changeViewZones((function(e){t.forEach((t=>{e.removeZone(t)}))})),this.editorViewZones=[];const n=/[\u{201c}\u{201d}\u{2018}\u{2019}]/u;if(e.changes.some((e=>n.test(e.text)))){const t=e.changes.filter((e=>n.test(e.text))).map((e=>{const t=a.getPositionAt(e.rangeOffset),n=a.getPositionAt(e.rangeOffset+e.text.length);return{range:new monaco.Range(t.lineNumber,t.column,n.lineNumber,n.column),text:e.text.replace(/\u{201c}|\u{201d}/gu,'"').replace(/\u{2018}|\u{2019}/gu,"'")}}));this.editor.executeEdits("pxt",t)}this.updateDiagnostics(),this.changeCallback(),this.updateFieldEditors()})),this.resize(),this.hideFlyout(),this.extensions=o.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion))),this.giveFocusOnLoading&&this.editor.focus(),"python"===this.fileType&&(this.editAmendmentsListener=(0,v.listenForEditAmendments)(this.editor)),this.foldFieldEditorRangesAsync()})).finally((()=>{r.removeChild(i),this.parent.onEditorContentLoaded()}))}unloadFileAsync(){return this.toolbox&&this.toolbox.clearSearch(),this.currFile&&this.currFile.getName()=="this/"+pxt.CONFIG_NAME?this.parent.reloadHeaderAsync():(this.editAmendmentsListener&&(this.editAmendmentsListener.dispose(),this.editAmendmentsListener=void 0),Promise.resolve())}beginLoadToolbox(e,t){this.toolbox&&this.toolbox.showLoading(),l.getBlocksAsync().then((n=>{this.blockInfo=n,this.nsMap=this.partitionBlocks(),this.updateToolbox(),x.monaco.syncModels(o.mainPkg,this.extraLibs,e.getName(),e.isReadonly()),this.defineEditorTheme(t,!0)})),this.blockIdMap=c.blockIdMap()}snapshotState(){return this.editor&&this.editor.getModel()?this.editor.getModel().getLinesContent():null}setViewState(e){this.editor&&e&&0!==Object.keys(e).length&&(this.editor.setPosition(e),this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(e.lineNumber)}))}setBreakpointsMap(e,t){this.callLocations=t,this.isDebugging()?(this.breakpoints||(this.breakpoints=new b.BreakpointCollection(e,this.pythonSourceMap),this.breakpoints.loadBreakpointsForFile(this.currFile,this.editor)),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),this.feWidget&&this.feWidget.close(),this.editor&&this.editor.updateOptions({readOnly:!0})):(this.editor&&this.editor.updateOptions({readOnly:pxt.shell.isReadOnly()||this.currFile&&this.currFile.isReadonly()}),this.breakpoints&&(this.breakpoints.dispose(),this.breakpoints=void 0),this.updateFieldEditors())}setDiagnostics(e,t){this.editor&&this.currFile===e&&(this.diagSnapshot=t,this.forceDiagnosticsUpdate())}updateDiagnostics(){this.needsDiagUpdate()&&this.forceDiagnosticsUpdate()}getBreakpoints(){return this.breakpoints?this.breakpoints.getActiveBreakpoints():[]}getEditorFontSize(){return this.editor.getOptions().get(monaco.editor.EditorOption.fontInfo).fontSize}sendBreakpoints(){this.breakpoints&&d.driver.setBreakpoints(this.getBreakpoints())}needsDiagUpdate(){if(!this.annotationLines)return!1;let e=this.editor.getModel().getLinesContent();for(let t of this.annotationLines)if(this.diagSnapshot[t]!==e[t])return!0;return!1}forceDiagnosticsUpdate(){if("typescript"!=this.fileType&&"python"!=this.fileType)return;let e=this.currFile,t=[];if(e&&e.diagnostics){const n=monaco.editor.getModel(monaco.Uri.parse(`pkg:${e.getName()}`));for(let i of e.diagnostics){const e=e=>{t.push({severity:monaco.MarkerSeverity.Error,message:e,startLineNumber:i.line+1,startColumn:i.column+1,endLineNumber:null==i.endLine?r.lineNumber:i.endLine+1,endColumn:null==i.endColumn?r.column:i.endColumn})},r=n.getPositionAt(i.start+i.length);if("string"==typeof i.messageText)e(i.messageText);else{let t=i.messageText;for(;null!=t.next;)e(t.messageText),t=t.next}}monaco.editor.setModelMarkers(n,"typescript",t),this.onErrorChanges(e.diagnostics)}}showFieldEditor(e,t,n,i){this.feWidget&&this.feWidget.close(),this.feWidget=new f.ModalEditorHost(t,e,this.editor.getModel());const r=()=>{i&&(d.setDirty(),"typescript"==this.fileType&&o.mainEditorPkg().invalidateCachedTranspile("ts",this.getCurrentSource(),"blocks"))};this.feWidget.showAsync(this.fileType,this.editor).then((e=>{this.activeRangeID=null,e?this.editModelAsync(e.range,e.replacement).then((e=>this.indentRangeAsync(e))).then((()=>this.foldFieldEditorRangesAsync())).then(r):r()}))}updateFieldEditors(){this.fieldEditors&&this.fieldEditors.setFieldEditorsEnabled(this.hasFieldEditors&&this.editor&&!pxt.shell.isReadOnly()&&!this.isDebugging())}foldFieldEditorRangesAsync(){return this.foldFieldEditorRanges?this.editor.getAction("editor.foldAllBlockComments").run():Promise.resolve()}highlightStatement(e,t){var n;if(!e)return this.clearHighlightedStatements(),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null),!1;if(!this.editor)return!1;if(t&&(null===(n=this.breakpoints)||void 0===n?void 0:n.getLoadedBreakpoint(t.breakpointId))?e=this.breakpoints.getLoadedBreakpoint(t.breakpointId):"py"===this.currFile.getExtension()&&this.pythonSourceMap&&(e=this.pythonSourceMap.ts.locToLoc(e)),this.currFile.getTextFileName()!==e.fileName&&this.isDebugging()&&P(e.fileName))this.parent.setFile(P(e.fileName));else if(!this.highilightStatementCore(e,!!t))return!1;return this.highlightedBreakpoint=t?t.breakpointId:void 0,t&&this.isDebugging()&&this.debuggerToolbox&&(this.debuggerToolbox.setBreakpoint(t),this.resize()),!0}highilightStatementCore(e,t=!1){let n=this.editor.getModel().getPositionAt(e.start),i=this.editor.getModel().getPositionAt(e.start+e.length);return!(!n||!i||(this.highlightDecorations=this.editor.deltaDecorations(this.highlightDecorations,[{range:new monaco.Range(n.lineNumber,n.column,i.lineNumber,i.column),options:{inlineClassName:"highlight-statement"}}]),t&&this.editor.revealPositionInCenter(n),0))}clearHighlightedStatements(){this.editor&&this.highlightDecorations&&this.editor.deltaDecorations(this.highlightDecorations,[])}partitionBlocks(){const e={};this.topBlocks=[];const t=c.allBuiltinBlocksByName(),n=this;function i(e,t){n.subcategoryMap[e]||(n.subcategoryMap[e]={}),n.subcategoryMap[e][t]=!0}if(this.blockInfo.blocks.forEach((n=>{let r=(n.attributes.blockNamespace||n.namespace).split(".")[0];if(t[n.qName]||"TD_ID"==n.attributes.shim)return;e[r]||(e[r]=[]),e[r].push(n);const o=n.attributes.subcategory;n.attributes.advanced?i(r,lf("more")):o&&i(r,o),n.attributes.topblock&&this.topBlocks.push(n)})),c.getPauseUntil()){const t=pxt.appTarget.runtime.pauseUntilBlock.category;e[t]&&e[t].push(c.getPauseUntil())}return e}clearCaches(){super.clearCaches(),c.clearBuiltinBlockCache()}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}getBuiltinCategory(e){return c.getBuiltinCategory(e)}isBuiltIn(e){return c.isBuiltin(e)}getNamespaceAttrs(e){const t=c.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!c.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return c.getBuiltinCategory(e).removed}let n=pxt.appTarget.runtime||{};return n.loopsBlocks&&!t("loops")&&e.push("loops"),n.logicBlocks&&!t("logic")&&e.push("logic"),n.variablesBlocks&&!t("variables")&&e.push("variables"),n.mathBlocks&&!t("Math")&&e.push("Math"),n.functionBlocks&&!t("functions")&&e.push("functions"),n.listsBlocks&&!t("arrays")&&e.push("arrays"),n.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}moveFocusToFlyout(){if(this.flyout){let e=document.querySelector(".monacoBlock");e&&(e.focus(),e.click())}}getBlocksForCategory(e,t){return c.isBuiltin(e)?this.getBuiltinBlocks(e,t):this.filterBlocks(t,this.nsMap[e])}filterBlocks(e,t){return t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&0!=t.name.indexOf("_")&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory))))}getBuiltinBlocks(e,t){let n=c.getBuiltinCategory(e),i=n.blocks||[];return!n.custom&&this.nsMap[e]&&(i=i.concat(this.nsMap[e].filter((e=>!(e.attributes.blockHidden||e.attributes.deprecated&&!this.parent.isTutorial()))))),this.filterBlocks(t,i)}showFlyout(e){if(!this.editor)return;let{nameid:t,name:n,subns:i,color:r,icon:o,blocks:s}=e,a=[];if(this.flyout){if("search"==t)try{0==(s=this.getSearchBlocks()).length&&(n=lf("No search results...")),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})}catch(e){pxt.reportException(e),s=[],n=lf("No search results...")}else"topblocks"==t?0==(s=this.getTopBlocks()).length?n=lf("No basic results..."):(r=pxt.toolbox.getNamespaceColor("topblocks"),o=pxt.toolbox.getNamespaceIcon("topblocks"),n=lf("{id:category}Basic"),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})):a=this.getBlockGroups(e);this.flyout.setState({name:n||m.capitalize(i||t),selectedBlock:void 0,hide:!1,ns:t,color:r,icon:o,groups:a})}}showFlyoutHeadingLabel(e,t,n,i,r){}showFlyoutGroupLabel(e,t,n,i){}showFlyoutBlocks(e,t,n){}handleGutterClick(e){const t=e.target.position.lineNumber;if(this.isDebugging())this.breakpoints&&(this.breakpoints.toggleBreakpointAt(t),this.sendBreakpoints());else if(this.fieldEditors){const e=this.editor.getModel();if(e.getDecorationsInRange(new monaco.Range(t,e.getLineMinColumn(t),t,e.getLineMaxColumn(t))).length){const e=this.fieldEditors.getInfoForLine(t);if(e){if(this.feWidget&&null!=this.activeRangeID&&e.id===this.activeRangeID)return this.feWidget.close(),void(this.activeRangeID=null);this.activeRangeID=e.id;const t=this.fieldEditors.getFieldEditorById(e.owner);t&&this.showFieldEditor(e.range,new t.proto,t.heightInPixels||500,t.alwaysBuildOnClose)}}}}getSearchBlocks(){let e=[];const t=this.toolbox.getSearchBlocks(),n=this;function i(e){const t=n.blockInfo.apis.byQName[e];return(t?t.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(e)||"255"}return t.forEach((t=>{if(t.name){const n=this.blockInfo.apis.byQName[t.name];if(n){if(0==n.name.indexOf("_"))return;const t=(n.attributes.blockNamespace||n.namespace).split(".")[0];n.attributes.color=n.attributes.color||i(t),e.push(n)}else pxt.log("couldn't find non builtin search by qName: "+t.name)}else if(t.attributes.blockId==pxtc.PAUSE_UNTIL_TYPE){const t=c.getPauseUntil();if(t){const n=t.attributes.blockNamespace;t.attributes.color=i(n),e.push(t)}}else{const n=c.allBuiltinBlocks()[t.attributes.blockId];n?(n[0].attributes.blockNamespace=n[1],e.push(n[0])):pxt.log("couldn't find buildin search qName for block: "+t.attributes.blockId)}})),e}indentRangeAsync(e){const t=this.editor.getModel(),n=t.getLineFirstNonWhitespaceColumn(e.startLineNumber)-1,i=M(t.getOptions().indentSize+n),r=t.getValueInRange(e).split(/\n/),o=r.map(((e,t)=>0===t?e.trim():t===r.length-1?M(n)+e.trim():i+e.trim())).join(t.getEOL());return this.editModelAsync(e,o)}editModelAsync(e,t){return new Promise((n=>{const i=this.editor.getModel(),r=t.split("\n"),o=new monaco.Range(e.startLineNumber,e.startColumn,e.startLineNumber+r.length-1,r[r.length-1].length);let s=this.editor.onDidChangeModelContent((e=>{s&&(s.dispose(),s=void 0),this.editor.setSelection(o),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),n(o)}));i.pushEditOperations(this.editor.getSelections(),[{range:i.validateRange(e),text:t,forceMoveMarkers:!0}],(e=>[D(e[0].range)]))}))}isDebugging(){return this.parent.state.debugging}getEditorColor(){return pxt.appTarget.appTheme.monacoColors&&pxt.appTarget.appTheme.monacoColors["editor.background"]?pxt.appTarget.appTheme.monacoColors["editor.background"]:pxt.appTarget.appTheme.invertedMonaco?"#1e1e1e":"#ffffff"}}function D(e){return new monaco.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}n.Editor=R,n.rangeToSelection=D;class L{constructor(e){this.touchHandler=()=>{this.editor.focus()},this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._domNode.addEventListener("touchstart",this.touchHandler),this._domNode.addEventListener("focus",this.touchHandler),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),this._domNode.removeEventListener("touchstart",this.touchHandler),this._domNode.removeEventListener("focus",this.touchHandler)}getId(){return L.ID}getDomNode(){return this._domNode}getPosition(){return{preference:monaco.editor.OverlayWidgetPositionPreference.TOP_RIGHT_CORNER}}}function M(e){let t="";for(let n=0;n<e;n++)t+=" ";return t}function P(e){const t=o.mainEditorPkg();if(t.files[e])return t.files[e];return t.lookupFile(e)||void 0}L.ID="editor.contrib.ShowKeyboardWidget_pxt"},{"../../pxtblocks":68,"../../pxteditor":134,"./auth":194,"./blocklyFieldView":195,"./compiler":204,"./core":279,"./data":282,"./debuggerToolbox":287,"./errorList":293,"./monacoDebugger":317,"./monacoEditAmendments":318,"./monacoFieldEditorHost":319,"./monacoFlyout":320,"./monacoSnippets":321,"./monacopyhelper":322,"./package":325,"./simulator":338,"./toolbox":348,"./toolboxeditor":349,"react-dom":491,"react/jsx-runtime":549}],317:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BreakpointCollection=n.MonacoBreakpoint=void 0;class i{constructor(e,t){this.source=e,this.editor=t,this.active=!1;const n=this.editor.getModel(),i=n.getPositionAt(this.source.start),r=n.getPositionAt(this.source.start+this.source.length);r.lineNumber===i.lineNumber?this.range=new monaco.Range(i.lineNumber,i.column,r.lineNumber,r.column):this.range=new monaco.Range(i.lineNumber,i.column,i.lineNumber,n.getLineMaxColumn(i.lineNumber)),this.updateDecoration()}simulatorID(){return this.source.id}isActive(){return this.active}setActive(e){this.active!==e&&(this.active=e,this.updateDecoration())}toggle(){this.setActive(!this.active)}distanceFromLine(e){return Math.abs(this.range.startLineNumber-e)}dispose(){this.decoration&&(this.editor.deltaDecorations([this.decoration],[]),this.decoration=void 0)}updateDecoration(){const e=this.active?"monaco-breakpoint active":"monaco-breakpoint",t=this.active?pxt.U.lf("Remove breakpoint"):pxt.U.lf("Add breakpoint"),n=this.editor.deltaDecorations(this.decoration?[this.decoration]:[],[{range:this.range,options:{glyphMarginClassName:e,glyphMarginHoverMessage:{value:t}}}]);this.decoration=n[0]}}n.MonacoBreakpoint=i;n.BreakpointCollection=class{constructor(e,t){this.fileToBreakpoint={},this.activeBreakpoints=[],this.sourcemap=t;for(const t of e)this.fileToBreakpoint[t.fileName]||(this.fileToBreakpoint[t.fileName]=[]),this.fileToBreakpoint[t.fileName].push(t)}loadBreakpointsForFile(e,t){if(this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose())),!e)return;const n="py"===e.getExtension();let r=e.getTextFileName();n&&(r=e.getFileNameWithExtension("ts"));let o=this.fileToBreakpoint[r];if(n){if(!this.sourcemap)return;o=null==o?void 0:o.map((e=>{const t=this.sourcemap.ts.locToLoc(e);return Object.assign(Object.assign({},e),t)}))}o&&(this.loadedBreakpoints=o.map((e=>{const n=new i(e,t);return-1!=this.activeBreakpoints.indexOf(e.id)&&n.setActive(!0),n})))}toggleBreakpointAt(e){const t=this.getBreakpointForLine(e);t&&(t.toggle(),t.isActive()?this.activeBreakpoints.push(t.source.id):this.activeBreakpoints=this.activeBreakpoints.filter((e=>e!=t.source.id)))}refreshDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.updateDecoration()))}clearDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose()))}getActiveBreakpoints(){return this.activeBreakpoints}dispose(){this.loadedBreakpoints&&(this.loadedBreakpoints.forEach((e=>e.dispose())),this.loadedBreakpoints=void 0),this.activeBreakpoints=void 0,this.fileToBreakpoint=void 0}getLocationOfBreakpoint(e){const t=this.getLoadedBreakpoint(e);if(t)return t;for(const t of Object.keys(this.fileToBreakpoint)){const n=this.fileToBreakpoint[t];for(const t of n)if(t.id===e)return t}}getLoadedBreakpoint(e){if(this.loadedBreakpoints)for(const t of this.loadedBreakpoints)if(t.source.id===e)return t.source;return null}getBreakpointForLine(e){if(!this.loadedBreakpoints||!this.loadedBreakpoints.length)return;let t,n;for(const i of this.loadedBreakpoints){const r=i.distanceFromLine(e);(void 0===n||r<n)&&(t=i,n=r)}return n<5?t:void 0}}},{}],318:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.listenForEditAmendments=n.amendmentToInsertSnippet=n.createLineReplacementPyAmendment=void 0;const i=e("./monaco"),r=e("./monacopyhelper"),o="#AMENDMENT:";n.createLineReplacementPyAmendment=function(e,t="pass"){return{behavior:"replaceLine",insertText:e||"",selectText:t}},n.amendmentToInsertSnippet=function(e){return`#AMENDMENT:${JSON.stringify(e)}`},n.listenForEditAmendments=function(e){return e.onDidChangeModelContent((t=>{let n=function(e){if(1!=e.changes.length)return null;let t=e.changes[0];if(!(t.text.indexOf(o)>=0))return null;let n=t.text.split(o);if(2!=n.length)return null;n[0];let i=n[1],r=pxt.U.jsonTryParse(i);return r?Object.assign({range:t.range},r):null}(t);n&&function(e,t){const n=t.getModel();setTimeout((()=>{let o=e.range;"replaceLine"===e.behavior?o=Object.assign(Object.assign({},o),{endColumn:99999,startColumn:1}):e.behavior;const s=(0,r.fixIndentationInRange)(n,n.validateRange(o),e.insertText)[0];e.range=s.range,e.insertText=s.text;let a=null;if(e.selectText){let t=e.insertText.split(e.selectText);if(t.length>=2){let n=t[0].split("\n"),i=n[n.length-1],r=o.startLineNumber+n.length-1,s=i.length+1;a=new monaco.Range(r,s,r,s+e.selectText.length)}}let l=Object.assign(Object.assign({},e.range),{endColumn:99999}),c=[{range:n.validateRange(l),text:"",forceMoveMarkers:!1}];n.applyEdits(c),setTimeout((()=>{const r=t.onDidChangeModelContent((e=>{r.dispose(),a&&t.setSelection(a)}));let s=[{range:n.validateRange(o),text:e.insertText,forceMoveMarkers:!0}];n.pushEditOperations(t.getSelections(),s,(e=>[(0,i.rangeToSelection)(e[0].range)]))}),0)}),0)}(n,e)}))}},{"./monaco":316,"./monacopyhelper":322}],319:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.computeRanges=n.RangesCollector=n.FieldEditorManager=n.ModalEditorHost=n.ViewZoneEditorHost=void 0;const i=e("./compiler"),r=e("./package");n.ViewZoneEditorHost=class{constructor(e,t,n){this.fe=e,this.range=t,this.model=n,this.heightInPx=520,this.suppressMouseDown=!1,this.afterLineNumber=t.endLineNumber;const i=document.createElement("div");i.setAttribute("class","pxt-view-zone");const r=document.createElement("div");r.setAttribute("class","monaco-field-editor-frame"),i.appendChild(r),this.domNode=i,this.wrapper=r}getId(){return"pxt-monaco-field-editor"}contentDiv(){return this.content||(this.content=document.createElement("div"),this.wrapper.appendChild(this.content)),this.content}showAsync(e,t){return this.fileType=e,this.editor=t,i.getBlocksAsync().then((e=>(this.blocks=e,this.showViewZoneAsync()))).then((()=>(this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(this.afterLineNumber)}),this.fe.showEditorAsync(this.fileType,this.range,this)))).finally((()=>{this.close()}))}onComputedHeight(e){this.contentDiv().style.height=e+"px"}onDomNodeTop(e){this._deferredShow&&(this._deferredShow(),this._deferredShow=void 0)}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showViewZoneAsync(){return this._deferredShow?Promise.resolve():new Promise((e=>{this._deferredShow=e,this.editor.changeViewZones((e=>{this.id=e.addZone(this)}))}))}resizeViewZoneAsync(){return this.id?new Promise((e=>{this.editor.changeViewZones((e=>{e.layoutZone(this.id)}))})):Promise.resolve()}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}close(){this.fe.onClosed(),this.fe.dispose(),this.editor.changeViewZones((e=>{e.removeZone(this.id)}))}};n.ModalEditorHost=class{constructor(e,t,n){this.fe=e,this.range=t,this.model=n}contentDiv(){return null}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showAsync(e,t){return i.getBlocksAsync().then((t=>(this.blocks=t,this.fe.showEditorAsync(e,this.range,this))))}close(){this.fe.onClosed(),this.fe.dispose()}};n.FieldEditorManager=class{constructor(e){this.editor=e,this.fieldEditors=[],this.decorations={},this.liveRanges=[],this.fieldEditorsEnabled=!0,this.rangeID=0}setFieldEditorsEnabled(e){this.fieldEditorsEnabled=e,e||this.clearRanges(this.editor)}setCursorLine(e){if(this.fieldEditorsEnabled&&e!=this.currentCursorLine){const t=this.getInfoForLine(this.currentCursorLine);t&&this.reapplyDecorations(t.owner);const n=this.getInfoForLine(e);n&&this.reapplyDecorations(n.owner,e),this.currentCursorLine=e}}addFieldEditor(e){for(const t of this.fieldEditors)if(t.id===e.id)return;this.fieldEditors.push(e)}getDecorations(e){return this.decorations[e]||[]}allDecorations(){const e=[];return Object.keys(this.decorations).forEach((t=>e.push(...this.getDecorations(t)))),e}setDecorations(e,t){this.decorations[e]=t}clearRanges(e){e&&Object.keys(this.decorations).forEach((t=>{e.deltaDecorations(this.decorations[t],[])})),this.decorations={},this.liveRanges=[],this.rangeID=0}trackRange(e,t,n){return!this.getInfoForLine(t)&&(this.liveRanges.push({line:t,owner:e,range:n,id:this.rangeID++}),!0)}getFieldEditorById(e){for(const t of this.fieldEditors)if(t.id===e)return t}getInfoForLine(e){for(const t of this.liveRanges)if(t.line===e)return t}allRanges(){return this.liveRanges}allFieldEditors(){return this.fieldEditors}provideFoldingRanges(e,t,n){this.updateFieldEditorRanges(e);const i=this.liveRanges.map((e=>({start:e.range.startLineNumber,end:e.range.endLineNumber-1,kind:monaco.languages.FoldingRangeKind.Comment})));let r=a(e,!1);return i.forEach((e=>{r=r.filter((t=>t.start!=e.start))})),i.concat(r)}reapplyDecorations(e,t=-1){const n=this.fieldEditors.find((t=>t.id===e));if(!n)return;const i=this.decorations[e],r=this.liveRanges.filter((t=>t.owner===e)),o=this.editor.getModel(),s=[];for(const e of r){let i=n.glyphCssClass;e.line===t&&(i+=" pxt-monaco-glyph-highlight"),s.push({range:new monaco.Range(e.line,o.getLineMinColumn(e.line),e.line,o.getLineMaxColumn(e.line)),options:{glyphMarginClassName:i}})}this.setDecorations(n.id,this.editor.deltaDecorations(i,s))}updateFieldEditorRanges(e){this.clearRanges(this.editor),this.fieldEditorsEnabled&&this.allFieldEditors().sort(((e,t)=>(t.weight||0)-(e.weight||0))).forEach((t=>{const n=t.matcher,i=e.findMatches(n.searchString,!0,n.isRegex,n.matchCase,n.matchWholeWord?this.editor.getOptions().get(monaco.editor.EditorOption.wordSeparators):null,!1),r=[];i.forEach((i=>{let o=i.range;if(n.validateRange&&!(o=n.validateRange(o,e)))return;const s=o.startLineNumber;this.getInfoForLine(s)||(r.push({range:new monaco.Range(s,e.getLineMinColumn(s),s,e.getLineMaxColumn(s)),options:{glyphMarginClassName:t.glyphCssClass}}),this.trackRange(t.id,s,o))})),this.setDecorations(t.id,this.editor.deltaDecorations([],r))}))}};class o{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,n){let i=this._length;this._startIndexes[i]=e,this._endIndexes[i]=t,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(e){if(this._length<=this._foldingRangesLimit){let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=this._length-1,i=0;n>=0;n--,i++)e[i]=this._startIndexes[n],t[i]=this._endIndexes[n];return s(e,t)}{let t=0,n=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let i=this._indentOccurrences[e];if(i){if(i+t>this._foldingRangesLimit){n=e;break}t+=i}}const i=e.getOptions().tabSize;let r=new Uint32Array(this._foldingRangesLimit),o=new Uint32Array(this._foldingRangesLimit);for(let s=this._length-1,a=0;s>=0;s--){let c=this._startIndexes[s],u=l(e.getLineContent(c),i);(u<n||u===n&&t++<this._foldingRangesLimit)&&(r[a]=c,o[a]=this._endIndexes[s],a++)}return s(r,o)}}}function s(e,t){const n=[];for(let i=0;i<e.length;i++)n.push({start:e[i],end:t[i],kind:monaco.languages.FoldingRangeKind.Region});return n}function a(e,t,n,i=5e3){const r=e.getOptions().tabSize;let s,a=new o(i);n&&(s=new RegExp(`(${n.start.source})|(?:${n.end.source})`));let c=[],u=e.getLineCount()+1;c.push({indent:-1,endAbove:u,line:u});for(let n=e.getLineCount();n>0;n--){let i,o=e.getLineContent(n),u=l(o,r),d=c[c.length-1];if(-1!==u){if(s&&(i=o.match(s))){if(!i[1]){c.push({indent:-2,endAbove:n,line:n});continue}{let e=c.length-1;for(;e>0&&-2!==c[e].indent;)e--;if(e>0){c.length=e+1,d=c[e],a.insertFirst(n,d.line,u),d.line=n,d.indent=u,d.endAbove=n;continue}}}if(d.indent>u){do{c.pop(),d=c[c.length-1]}while(d.indent>u);let e=d.endAbove-1;e-n>=1&&a.insertFirst(n,e,u)}d.indent===u?d.endAbove=n:c.push({indent:u,endAbove:n,line:n})}else t&&(d.endAbove=n)}return a.toIndentRanges(e)}function l(e,t){let n=0,i=0,r=e.length;for(;i<r;){let r=e.charCodeAt(i);if(32===r)n++;else{if(9!==r)break;n=n-n%t+t}i++}return i===r?-1:n}n.RangesCollector=o,n.computeRanges=a},{"./compiler":204,"./package":325}],320:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MonacoFlyout=void 0;const i=e("react/jsx-runtime"),r=e("./compiler"),o=e("./core"),s=e("./workspace"),a=e("./data"),l=e("./auth"),c=e("../../pxteditor");class u extends a.Component{constructor(e){super(e),this.dragging=!1,this.getBlockClickHandler=e=>()=>{pxt.tickEvent("monaco.toolbox.itemclick",void 0,{interactiveConsent:!0}),this.setState({selectedBlock:e!=this.state.selectedBlock?e:void 0})},this.getBlockMouseOver=e=>()=>{pxt.tickEvent("monaco.toolbox.itemmouseover"),this.setState({hoverBlock:e!=this.state.hoverBlock?e:void 0})},this.getBlockMouseOut=e=>()=>{e==this.state.hoverBlock&&this.setState({hoverBlock:void 0})},this.getBlockDragStartHandler=(e,t,n)=>i=>{this.dragInfo={x:pxt.BrowserUtils.getClientX(i),y:pxt.BrowserUtils.getClientY(i),block:e,snippet:t,color:n}},this.isHorizontalDrag=e=>{const t=Math.abs(this.dragInfo.x-pxt.BrowserUtils.getClientX(e)),n=Math.abs(this.dragInfo.y-pxt.BrowserUtils.getClientY(e));return t>5&&n>5&&t>n},this.blockDragHandler=e=>{let t=document.getElementById("monacoDraggingBlock");if(this.dragInfo&&(t||this.isHorizontalDrag(e))){pxt.tickEvent("monaco.toolbox.itemdrag",void 0,{interactiveConsent:!0}),e.preventDefault(),e.stopPropagation();const n=this.dragInfo.block,i=n.parameters;if(this.dragging=!0,!t){const e=document.getElementById("root");e.style.overflow="hidden",(t=document.createElement("div")).id="monacoDraggingBlock",t.textContent=n.snippetOnly?n.snippet:`${this.getQName(n)||this.getSnippetName(n)}${i?`(${i.map((e=>e.name)).join(", ")})`:""}`,t.style.backgroundColor=this.dragInfo.color,e.appendChild(t),s.fireEvent({type:"create",editor:"ts",blockId:n.attributes.blockId});let r="";"void"!=n.retType&&(r="inline:1&"),this.props.setInsertionSnippet(this.dragInfo.snippet||r+"qName:"+n.qName)}t.style.top=`${pxt.BrowserUtils.getClientY(e)}px`,t.style.left=`${pxt.BrowserUtils.getClientX(e)}px`,this.setState({hide:!0})}},this.blockDragEndHandler=e=>{this.dragInfo=void 0,this.dragging=!1,this.props.setInsertionSnippet(void 0);const t=document.getElementById("monacoDraggingBlock");t&&t.remove(),document.getElementById("root").style.overflow=""},this.getKeyDownHandler=(e,t,n)=>i=>{const a=pxt.Util.isUserLanguageRtl(),l=o.keyCodeFromEvent(i),c=i.target;if(40==l){let e=c.nextElementSibling;c&&e&&(e.click(),e.focus())}else if(38==l){let e=c.previousElementSibling;c&&e&&(e.click(),e.focus())}else 37==l&&!a||38==l&&a?this.props.moveFocusToParent():27==l?(this.setState({groups:void 0}),this.props.moveFocusToParent()):13==l&&e&&(t?Promise.resolve(t):r.snippetAsync(e.qName,n)).then((t=>{this.props.insertSnippet(null,t,"void"!=e.retType),s.fireEvent({type:"create",editor:"ts",blockId:e.attributes.blockId})}))},this.getHelpButtonClickHandler=e=>()=>{pxt.debug(`${e} help icon clicked.`),s.fireEvent({type:"ui",editor:"ts",action:"groupHelpClicked",data:{group:e}})},this.wheelHandler=e=>{e.stopPropagation()},this.scrollHandler=e=>{this.positionDragHandle()},this.getFlyoutStyle=()=>{var e,t;return{display:(null===(e=this.state)||void 0===e?void 0:e.groups)&&!(null===(t=this.state)||void 0===t?void 0:t.hide)?"block":"none"}},this.getIconStyle=e=>({color:e}),this.getSelectedStyle=()=>({touchAction:pxt.BrowserUtils.hasPointerEvents()?"pan-y":void 0}),this.getBlockStyle=e=>({backgroundColor:e,border:this.getData(l.HIGHCONTRAST)?`2px solid ${e}`:"none",fontSize:`${this.props.parent.settings.editorFontSize}px`,lineHeight:`${this.props.parent.settings.editorFontSize+16}px`}),this.state={}}componentDidMount(){pxt.BrowserUtils.hasPointerEvents()?(document.addEventListener("pointermove",this.blockDragHandler),document.addEventListener("pointerup",this.blockDragEndHandler)):(document.addEventListener("mousemove",this.blockDragHandler),document.addEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.addEventListener("touchmove",this.blockDragHandler),document.addEventListener("touchend",this.blockDragEndHandler)))}componentWillUnmount(){pxt.BrowserUtils.hasPointerEvents()?(document.removeEventListener("pointermove",this.blockDragHandler),document.removeEventListener("pointerup",this.blockDragEndHandler)):(document.removeEventListener("mousemove",this.blockDragHandler),document.removeEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.removeEventListener("touchmove",this.blockDragHandler),document.removeEventListener("touchend",this.blockDragEndHandler)))}componentDidUpdate(){this.positionDragHandle()}getQName(e){return"python"==this.props.fileType&&e.pyQName?e.pyQName:e.qName}getSnippetName(e){return("python"==this.props.fileType?e.pySnippetName||e.pyName:void 0)||e.snippetName||e.name}getBlockDescription(e,t){let n=[],r=pxt.blocks.compileInfo(e),o=e.attributes._def&&e.attributes._def.parts,s=e.qName||e.name;const a="python"==this.props.fileType;return o?(t&&o.filter((e=>"param"==e.kind)).length>t.length&&t.unshift(null),o.forEach(((e,t)=>{switch(e.kind){case"label":n.push((0,i.jsx)("span",{children:e.text},s+t));break;case"break":n.push((0,i.jsx)("span",{children:" "},s+t));break;case"param":let o=null==r?void 0:r.definitionNameToParam[e.name],l=(null==o?void 0:o.defaultValue)||e.varName||(null==o?void 0:o.actualName)||e.name;a&&(null==o?void 0:o.defaultValue)&&(l=pxtc.tsSnippetToPySnippet(l)),n.push((0,i.jsx)("span",Object.assign({className:"argName"},{children:l}),s+t))}}))):n.push((0,i.jsx)("span",{children:this.getSnippetName(e)||e.name},s)),t&&t.find((e=>(null==e?void 0:e.type)&&e.type.indexOf("=>")>=0))&&(n.unshift((0,i.jsx)("span",{children:lf("run code ")},"prefix")),(null==r?void 0:r.handlerArgs)&&(n.push((0,i.jsx)("span",{children:" "},"handler_break")),r.handlerArgs.forEach((e=>{e.inBlockDef||n.push((0,i.jsx)("span",Object.assign({className:"argName"},{children:e.name}),`handler_${e.name}`))})))),n}positionDragHandle(){let e=document.querySelector(".monacoBlock.hover .blockHandle");if(e){let t=e.parentElement,n=document.getElementById("monacoFlyoutWrapper");e.style.height=`${t.clientHeight}px`,e.style.left=`${t.clientWidth}px`,e.style.top=t.offsetTop-n.scrollTop+"px"}let t=document.querySelector(".monacoBlock.expand .blockHandle");if(t){let e=t.parentElement,n=document.getElementById("monacoFlyoutWrapper");t.style.height=`${e.clientHeight+8}px`,t.style.left=e.clientWidth+4-1+"px",t.style.top=e.offsetTop-n.scrollTop+"px"}}getMonacoBlock(e,t,n){if(void 0===e.snippet)return;const{ns:r}=this.state,o=this.props.parent.state.editorState?this.props.parent.state.editorState.filters:void 0,s=o?o.namespaces&&null!=o.namespaces[r]?o.namespaces[r]:o.defaultState:void 0,a=this.props.blockIdMap&&this.props.blockIdMap[e.attributes.blockId];let l=o?o.defaultState:1;if(o&&o.fns&&void 0!==o.fns[e.name]?l=o.fns[e.name]:o&&o.blocks&&e.attributes.blockId&&(void 0!==o.blocks[e.attributes.blockId]||(null==a?void 0:a.some((e=>o.blocks[e]))))?l=o.blocks[e.attributes.blockId]:void 0!==s&&(l=s),0==l)return;const c=2==l,u="python"==this.props.fileType,d=u?e.pySnippet:e.snippet,h=e.parameters,p=e.attributes.color||n,f=this.getBlockDescription(e,h?h.slice():null),g=e.attributes.help,m=this.getQName(e)||this.getSnippetName(e),b=m==this.state.selectedBlock,y=m==this.state.hoverBlock,v=pxt.BrowserUtils.hasPointerEvents(),_=pxt.BrowserUtils.isTouchEnabled(),E=this.getBlockDragStartHandler(e,d,p),T=e.attributes.jsDoc.replace(/``/g,'"').split("* @param",1)[0];return(0,i.jsxs)("div",Object.assign({className:`monacoBlock ${c?"monacoDisabledBlock":""} ${b?"expand":""} ${y?"hover":""}`,style:this.getSelectedStyle(),title:e.attributes.jsDoc,tabIndex:0,role:"listitem",onClick:this.getBlockClickHandler(m),onMouseOver:this.getBlockMouseOver(m),onMouseOut:this.getBlockMouseOut(m),onKeyDown:this.getKeyDownHandler(e,d,u),onPointerDown:v?E:void 0,onMouseDown:v?void 0:E,onTouchStart:!v&&_?E:void 0},{children:[(0,i.jsx)("div",Object.assign({className:"blockHandle",style:this.getSelectedStyle()},{children:(0,i.jsx)("i",{className:"icon bars"})})),(0,i.jsx)("div",Object.assign({className:"monacoDraggableBlock",style:this.getBlockStyle(p)},{children:(0,i.jsx)("span",Object.assign({className:"blockName"},{children:f}))})),(0,i.jsxs)("div",Object.assign({className:"detail"},{children:[(0,i.jsx)("div",Object.assign({className:"description"},{children:T})),(0,i.jsxs)("div",Object.assign({className:"signature"},{children:[(0,i.jsx)("span",{children:d||`${m}(${h?h.map((e=>`${e.name}`)).join(", "):""})`}),g&&(0,i.jsx)("a",Object.assign({className:"blockHelp",href:`/reference/${g}`,target:"_blank",rel:"noopener noreferrer",role:"button"},{children:(0,i.jsx)("i",{className:"question circle outline icon","aria-label":lf("Open documentation")})}))]})),h&&(0,i.jsx)("div",Object.assign({className:"params"},{children:h.map(((e,t)=>(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"separator"}),(0,i.jsx)("span",Object.assign({className:"paramName"},{children:e.name})),e.description&&(0,i.jsx)("span",Object.assign({className:"paramDescription"},{children:e.description.replace(/``/g,'"')}))]},t)))}))]}))]}),`block_${m}_${t}`)}renderCore(){const{name:e,ns:t,color:n,icon:r,groups:o}=this.state,s=pxt.toolbox.convertColor(n||t&&pxt.toolbox.getNamespaceColor(t)||"255"),a=`blocklyTreeIcon${r?(t||r).toLowerCase():"Default"}`.replace(/\s/g,"");return(0,i.jsx)("div",Object.assign({id:"monacoFlyoutWidget",className:"monacoFlyout",style:this.getFlyoutStyle()},{children:(0,i.jsxs)("div",Object.assign({id:"monacoFlyoutWrapper",onScroll:this.scrollHandler,onWheel:this.wheelHandler,role:"list"},{children:[(0,i.jsxs)("div",Object.assign({className:"monacoFlyoutLabel monacoFlyoutHeading"},{children:[(0,i.jsx)("span",Object.assign({className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation",style:this.getIconStyle(s)},{children:r&&1===r.length?r:""})),(0,i.jsx)("div",Object.assign({className:"monacoFlyoutLabelText"},{children:pxtc.U.rlf(`{id:category}${e}`)}))]})),o&&o.map(((e,t)=>{let n=[];if(e.name!=pxt.DEFAULT_GROUP_NAME&&o.length>1&&n.push((0,i.jsxs)("div",Object.assign({className:"monacoFlyoutLabel blocklyFlyoutGroup",tabIndex:0,onKeyDown:this.getKeyDownHandler(),role:"separator"},{children:[e.icon&&(0,i.jsx)("span",Object.assign({className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation"},{children:e.icon})),(0,i.jsx)("div",Object.assign({className:"monacoFlyoutLabelText"},{children:pxtc.U.rlf(`{id:group}${e.name}`)})),e.hasHelp&&c.HELP_IMAGE_URI&&(0,i.jsx)("span",{children:(0,i.jsx)("img",{src:c.HELP_IMAGE_URI,onClick:this.getHelpButtonClickHandler(e.name),alt:lf("Click for help")})}),(0,i.jsx)("hr",{className:"monacoFlyoutLabelLine"})]}),`label_${t}`)),e.blocks){let t=e.blocks.map(((e,t)=>e.attributes.blockBuiltin?void pxt.log("ignoring built in block: "+e.attributes.blockId):this.getMonacoBlock(e,t,s))).filter((e=>void 0!==e));if(!(t&&t.length>0))return null;n=n.concat(t)}return n}))]}))}))}}n.MonacoFlyout=u},{"../../pxteditor":134,"./auth":194,"./compiler":204,"./core":279,"./data":282,"./workspace":354,"react/jsx-runtime":549}],321:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getToolboxDefinition=n.overrideToolbox=n.overrideCategory=n.clearBuiltinBlockCache=n.allBuiltinBlocksByName=n.allBuiltinBlocks=n.isBuiltin=n.getBuiltinCategory=n.blockIdMap=n.getPauseUntil=void 0;let i,r,o,s,a=null;function l(){return a||((a={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"loops_while",snippetName:"while",snippet:"while (true) {\n    \n}",pySnippet:"while True:\n    pass",attributes:{blockId:"device_while",weight:48,jsDoc:lf("Repeat code while condition is true")}},{name:"loops_for",snippetName:"for",snippet:"for (let i = 0; i < 5; i++) {\n    \n}",pySnippet:"for i in range(4):\n    pass",attributes:{blockId:"pxt_controls_for",weight:47,jsDoc:lf("Repeat code a number of times in a loop")}}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},a.logic={name:lf("{id:category}Logic"),nameid:"logic",blocks:[{name:"logic_if",snippetName:"if",snippet:"if (true) {\n    \n}",pySnippet:"if True:\n    pass",attributes:{blockId:"controls_if",weight:49,jsDoc:lf("Runs code if the condition is true")}},{name:"logic_if_else",snippetName:"if else",snippet:"if (true) {\n    \n} else {\n    \n}",pySnippet:"if True:\n    pass\nelse:\n    pass",attributes:{blockId:"controls_if",weight:48,jsDoc:lf("Runs code if the condition is true; else run other code")}},{name:"logic_and",snippetName:"and",snippet:"true && true",pySnippet:"True and True",attributes:{blockId:"logic_compare",weight:47,jsDoc:lf("Runs code if both specified conditions are true")}},{name:"logic_or",snippetName:"or",snippet:"true || false",pySnippet:"True or False",attributes:{blockId:"logic_compare",weight:46,jsDoc:lf("Runs code if either of two specified conditions is true")}}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},a.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:[{name:"var_let",snippetName:"let",snippet:"let item: number",pySnippet:"item = 0",pySnippetName:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_set",jsDoc:lf("Declares a variable named 'item'")}},{name:"var_equals",snippetName:"equals",snippet:"item = 0",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_get",jsDoc:lf("Assigns a value to a variable")}},{name:"var_change",snippetName:"change",snippet:"item += 1",pySnippet:"item += 1",snippetOnly:!0,attributes:{blockId:"variables_change",jsDoc:lf("Changes the value of item by 1")}}],attributes:{callingConvention:0,weight:50.07,icon:"variables",paramDefl:{}}},a.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"Math.plus",snippetName:"plus",snippet:"1 + 1",pySnippet:"1 + 1",snippetOnly:!0,attributes:{weight:90,blockId:"math_arithmetic",jsDoc:lf("Adds two numbers together")},retType:"number"},{name:"Math.minus",snippetName:"minus",snippet:"1 - 1",pySnippet:"1 - 1",snippetOnly:!0,attributes:{weight:89,blockId:"math_arithmetic",jsDoc:lf("Subtracts the value of one number from another")},retType:"number"},{name:"Math.multiply",snippetName:"multiply",snippet:"1 * 1",pySnippet:"1 * 1",snippetOnly:!0,attributes:{weight:88,blockId:"math_arithmetic",jsDoc:lf("Multiplies two numbers together")},retType:"number"},{name:"Math.divide",snippetName:"divide",snippet:"1 / 1",pySnippet:"1 / 1",snippetOnly:!0,attributes:{weight:87,blockId:"math_arithmetic",jsDoc:lf("Returns the quotient of one number divided by another")},retType:"number"},{name:"Math.remainder",snippetName:"remainder",snippet:"1 % 2",pySnippet:"1 % 2",snippetOnly:!0,attributes:{weight:80,blockId:"math_modulo",jsDoc:lf("Returns the remainder of one number divided by another")},retType:"number"},{name:"Math.max",snippetName:"max",snippet:"Math.max(1, 2)",pySnippet:"max(1, 2)",attributes:{weight:75,blockId:"math_op2",jsDoc:lf("Returns the largest of two numbers")},retType:"number"},{name:"Math.min",snippetName:"min",snippet:"Math.min(1, 2)",pySnippet:"min(1, 2)",attributes:{weight:74,blockId:"math_op2",jsDoc:lf("Returns the smallest of two numbers")},retType:"number"},{name:"Math.abs",snippetName:"abs",snippet:"Math.abs(-1)",pySnippet:"abs(-1)",attributes:{weight:70,blockId:"math_op3",jsDoc:lf("Returns the absolute value of a number")},retType:"number"},{name:"randint",snippetName:"randint",snippet:"randint(0, 10)",pySnippetName:"randint",pySnippet:"randint(0, 10)",attributes:{weight:65,blockId:"device_random",jsDoc:lf("Returns a random number between min and max")},retType:"number"}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},a.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[{name:"functionDef",snippetName:"function doSomething",snippet:"function doSomething() {\n    \n}",pySnippetName:"def do_something",pySnippet:"def do_something():\n    pass",attributes:{blockId:"function_definition",jsDoc:lf("Define a function")}},{name:"functionCall",snippetName:"doSomething",snippet:"doSomething()",pySnippetName:"do_something",pySnippet:"do_something()",attributes:{blockId:"function_call",jsDoc:lf("Call a function")}}],attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},a.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",custom:!0,blocks:[{name:"array_create",snippetName:"create",snippet:`let ${lf("{id:snippets}list")} = [1, 2, 3]`,pySnippet:`${lf("{id:snippets}list")} = [1, 2, 3]`,snippetOnly:!0,attributes:{weight:100,blockId:"lists_create_with",jsDoc:lf("Creates a new Array")},retType:"array"},{name:"array_length",snippetName:"length",snippet:`${lf("{id:snippets}list")}.length`,pySnippetName:"len",pySnippet:`len(${lf("{id:snippets}list")})`,snippetOnly:!0,attributes:{weight:99,blockId:"lists_length",jsDoc:lf("Returns the number of values in an Array")},retType:"number"},{name:"array_get",snippetName:"get",snippet:`${lf("{id:snippets}list")}[0]`,pySnippet:`${lf("{id:snippets}list")}[0]`,snippetOnly:!0,attributes:{weight:98,blockId:"lists_index_get",jsDoc:lf("Returns the value in the Array at the given index")}},{name:"array_set",snippetName:"set",snippet:`${lf("{id:snippets}list")}[0] = 1`,pySnippet:`${lf("{id:snippets}list")}[0] = 1`,snippetOnly:!0,attributes:{weight:97,blockId:"lists_index_set",jsDoc:lf("Overwrites the value in an Array at the given index")}},{name:"array_push",snippetName:"push",snippet:`${lf("{id:snippets}list")}.push(1)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(1)`,attributes:{weight:96,blockId:"array_push",jsDoc:lf("Adds a value to the end of an Array")}},{name:"arary_pop",snippetName:"pop",snippet:`${lf("{id:snippets}list")}.pop()`,pySnippetName:"pop",pySnippet:`${lf("{id:snippets}list")}.pop()`,attributes:{weight:95,blockId:"array_pop",jsDoc:lf("Removes and returns the value at the end of an Array")},retType:"object"},{name:"array_insertAt",snippetName:"insertAt",snippet:`${lf("{id:snippets}list")}.insertAt(0, 0)`,pySnippetName:"insert",pySnippet:`${lf("{id:snippets}list")}.insert(0, 0)`,attributes:{weight:50,blockId:"array_insertAt",jsDoc:lf("Inserts a value into the Array at the given index"),advanced:!0}},{name:"array_removeAt",snippetName:"removeAt",snippet:`${lf("{id:snippets}list")}.removeAt(0)`,attributes:{weight:49,blockId:"array_removeat",jsDoc:lf("Removes a value from the Array at the given index and returns it"),advanced:!0},retType:"object"},{name:"array_shift",snippetName:"shift",snippet:`${lf("{id:snippets}list")}.shift()`,attributes:{weight:48,blockId:"array_shift",jsDoc:lf("Removes and returns the value at the front of an Array"),advanced:!0}},{name:"array_unshift",snippetName:"unshift",snippet:`${lf("{id:snippets}list")}.unshift(0)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(0)`,attributes:{weight:47,blockId:"array_unshift",jsDoc:lf("Inserts a value at the beginning of an Array"),advanced:!0}},{name:"array_indexOf",snippetName:"indexOf",snippet:"[0, 1, 2].indexOf(1)",pySnippetName:"index",pySnippet:"[0, 1, 2].index(1)",attributes:{weight:46,jsDoc:lf("Returns the first index in the Array that contains the given value or -1 if it does not exist in the Array"),advanced:!0},retType:"number"},{name:"array_reverse",snippetName:"reverse",snippet:`${lf("{id:snippets}list")}.reverse()`,pySnippet:`${lf("{id:snippets}list")}.reverse()`,attributes:{weight:45,jsDoc:lf("Reverses the contents of an Array"),advanced:!0}}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},a.text={name:lf("{id:category}Text"),nameid:"text",custom:!0,blocks:[{name:"text_length",snippetName:"length",snippet:'"".length',pySnippetName:"len",pySnippet:'len("")',snippetOnly:!0,attributes:{blockId:"text_length",jsDoc:lf("Returns the number of characters in a string")},retType:"number"},{name:"text_concat",snippetName:"concat",snippet:'"" + 5',pySnippet:'"" + 5',snippetOnly:!0,attributes:{blockId:"text_join",jsDoc:lf("Combines a string with a number, boolean, string, or other object into one string")},retType:"string"},{name:"text_compare",snippetName:"compare",snippet:'"".compare("")',attributes:{blockId:"string_compare",jsDoc:lf("Compares one string against another alphabetically and returns a number")},retType:"number"},{name:"text_parseInt",snippetName:"parseInt",snippet:'parseInt("5")',pySnippetName:"int",pySnippet:'int("5")',attributes:{blockId:"string_parseint",jsDoc:lf("Converts a number written as text into a number")},retType:"number"},{name:"text_substr",snippetName:"substr",snippet:'"".substr(0, 0)',pySnippet:'""[0:1]',attributes:{blockId:"string_substr",jsDoc:lf("Returns the part of a string starting at a given index with the given length")},retType:"string"},{name:"text_charAt",snippetName:"charAt",snippet:'"".charAt(0)',pySnippetName:"str[0]",pySnippet:'""[0]',attributes:{blockId:"string_get",jsDoc:lf("Returns the character at the given index")},retType:"string"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},a.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!1,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),a}function c(){if(i)return i;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(e){const t=e.callName||"pauseUntil";let n=`${t}(() => true)`;e.namespace&&(n=`${e.namespace}.${n}`),i={name:"pause_until",snippetName:t,snippet:n,attributes:{blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight,jsDoc:lf("Pause execution of code until the given boolean expression is true"),advanced:!1}}}return i}function u(e){return l()[e]}function d(){o||(o={},s={},[u("loops"),u("logic"),u("Math"),u("text"),u("arrays"),u("variables"),u("functions")].forEach((e=>{e.blocks.forEach((t=>{t.type||t.snippet&&(t.attributes.blockId&&!o[t.attributes.blockId]&&(o[t.attributes.blockId]=[t,e.nameid]),s[t.name]||(s[t.name]=[t,e.nameid]))}))})))}function h(e,t){const n=u(e);if(t&&n&&(0===Object.keys(t).length&&(n.removed=!0),t.name&&(n.name=t.name),t.icon&&(n.attributes.icon=t.icon),void 0!==t.weight&&(n.attributes.weight=t.weight),void 0!==t.advanced&&(n.attributes.advanced=t.advanced),null!=t.groups&&(n.groups=t.groups),t.blocks)){let e=100;n.blocks=t.blocks.map(((t,n)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function p(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}n.getPauseUntil=c,n.blockIdMap=function(){if(!r){r={pxt_controls_for:["controls_repeat_ext"]};const e=pxt.appTarget.blockIdMap;e&&Object.keys(e).forEach((t=>r[t]=e[t]))}return r},n.getBuiltinCategory=u,n.isBuiltin=function(e){return!!l()[e]},n.allBuiltinBlocks=function(){d();const e=c();return e&&(o[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),o},n.allBuiltinBlocksByName=function(){d();const e=c();return e&&(s[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),s},n.clearBuiltinBlockCache=function(){o=void 0,s=void 0},n.overrideCategory=h,n.overrideToolbox=function(e){h("loops",e.loops),h("logic",e.logic),h("variables",e.variables),h("Math",e.maths),h("text",e.text),h("arrays",e.arrays),h("functions",e.functions)},n.getToolboxDefinition=function(){return{loops:p(u("loops")),logic:p(u("logic")),variables:p(u("variables")),maths:p(u("Math")),text:p(u("text")),arrays:p(u("arrays")),functions:p(u("functions"))}}},{}],322:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fixIndentationInRange=n.provideDocumentRangeFormattingEdits=void 0;function i(e){return e&&e.match(/^ */)[0].length||0}function r(e,t){return new Array(e+1).join(" ")+t.trim()}function o(e,t,n){return e.slice(t.getOffsetAt({lineNumber:n,column:0}),t.getOffsetAt({lineNumber:n+1,column:0}))}function s(e,t,n){const s=e.getValue(),a=e.getOffsetAt({lineNumber:t.startLineNumber,column:0}),l=e.getOffsetAt({lineNumber:t.startLineNumber,column:t.startColumn}),c=e.getOffsetAt({lineNumber:t.endLineNumber,column:t.endColumn});let u;u=n?(s.slice(a,l)+n).split("\n"):s.slice(a,c).split("\n");const d=a!==l&&!!s.substring(a,l).trim(),h=u.map(((e,t)=>e?t:-1)).filter((e=>e>=0));let p=t.startLineNumber-1,f=o(s,e,p);for(;!f&&p>0;)f=o(s,e,p-=1);let g=i(f);(function(e){return":"==(e=e.trim())[e.length-1]})(f)&&(g+=4),u[0]=d?u[0]:r(g,u[0]);for(let e=1;e<h.length;e++){let t=h[e],n=u[t],o=i(n);u[t]=r(g+o,n)}return[{text:u.join("\n"),range:t.setStartPosition(t.startLineNumber,0)}]}n.provideDocumentRangeFormattingEdits=function(e,t,n,i){return s(e,t)},n.fixIndentationInRange=s},{}],323:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NotificationBanner=n.GenericBanner=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui"),s=e("../../pxteditor");class a extends r.Component{constructor(e){super(e),this.delayTime=this.props.delayTime||0,this.doneSleeping=this.sleepDone(),this.bannerType=this.props.bannerType||"default",this.handleClick=this.handleClick.bind(this)}componentDidMount(){this.doneSleeping&&(this.timer=setTimeout((()=>this.show()),this.delayTime))}componentWillUnmount(){clearTimeout(this.timer)}sleepDone(){if(!this.props.sleepTime)return!0;const e=parseInt(pxt.storage.getLocal("lastBannerClosedTime")||"0");return pxt.Util.nowSeconds()-e>this.props.sleepTime}show(){pxt.tickEvent(`notificationBanner.${this.props.id}.show`),this.props.displayTime&&(this.timer=setTimeout((()=>this.hide("automatic")),this.delayTime+this.props.displayTime)),this.props.parent.setBannerVisible(!0),this.render()}hide(e){pxt.tickEvent(`notificationBanner.${this.props.id}.`+e+"Close"),pxt.storage.setLocal("lastBannerClosedTime",pxt.Util.nowSeconds().toString()),this.props.parent.setBannerVisible(!1),this.render()}handleClick(){this.hide("manual"),clearTimeout(this.timer)}renderCore(){return this.props.parent.state.bannerVisible&&this.doneSleeping?(0,i.jsxs)("div",Object.assign({id:"notificationBanner",className:`ui attached ${this.bannerType} message`},{children:[(0,i.jsx)("div",Object.assign({className:"bannerLeft"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:this.props.children}))})),(0,i.jsx)("div",Object.assign({className:"bannerRight"},{children:(0,i.jsx)(o.Icon,{icon:"close",tabIndex:0,onClick:this.handleClick})}))]})):(0,i.jsx)("div",{})}}n.GenericBanner=a;class l extends r.Component{constructor(e){super(e),this.state={},this.clearExperiments=this.clearExperiments.bind(this)}clearExperiments(){pxt.tickEvent("banner.experiments",void 0,{interactiveConsent:!0}),s.experiments.clear(),this.props.parent.reloadEditor()}renderCore(){const e=pxt.appTarget.appTheme,t=pxt.BrowserUtils.isElectron(),n="localhost"===location.hostname,r="/"!==location.pathname&&-1===(e.appPathNames||[]).indexOf(location.pathname),l=!n&&t&&r;if(s.experiments.someEnabled()&&!/experiments=1/.test(window.location.href)){const e=2e4;return(0,i.jsxs)(a,Object.assign({id:"experimentsbanner",parent:this.props.parent,bannerType:"negative",displayTime:e},{children:[(0,i.jsx)(o.Icon,{icon:"information circle"}),(0,i.jsx)("div",Object.assign({className:"header"},{children:lf("Experiments enabled.")})),(0,i.jsx)(o.Link,Object.assign({className:"link",ariaLabel:lf("Clear"),onClick:this.clearExperiments},{children:lf("Clear")}))]}))}if(l){const e=pxt.appTarget.appTheme.homeUrl+location.search+location.hash;return(0,i.jsxs)(a,Object.assign({id:"experimental",parent:this.props.parent,bannerType:"negative"},{children:[(0,i.jsx)(o.Icon,{icon:"warning circle"}),(0,i.jsx)("div",Object.assign({className:"header"},{children:lf("You are viewing an experimental version of the editor")})),(0,i.jsx)(o.Link,Object.assign({className:"link",ariaLabel:lf("Go back to live editor"),href:e},{children:lf("Take me back")}))]}))}return(0,i.jsx)("div",{})}}n.NotificationBanner=l},{"../../pxteditor":134,"./data":282,"./sui":346,"react/jsx-runtime":549}],324:[function(e,t,n){"use strict";function i(e){return{simulator:{targetQuery:"#boardview"},toolbox:{targetQuery:".blocklyToolboxDiv"},"monaco toolbox":{targetQuery:".monacoToolboxDiv"},workspace:{targetQuery:"#blocksEditor",sansQuery:".blocklyToolboxDiv",sansLocation:2},"monaco workspace":{targetQuery:"#monacoEditorRightArea"},share:{targetQuery:".shareproject"},download:{targetQuery:"#downloadArea"},"play button":{targetQuery:".big-play-button"},everything:{targetQuery:"#root"},nothing:{targetQuery:"nothing"}}[e]}async function r(e){const t=await pxt.Cloud.markdownAsync(e);return pxt.getSectionsFromMarkdownMetadata(t)}function o(e){switch(e){case"above":return 0;case"below":return 1;case"left":return 2;case"right":return 3;case"center":default:return 4}}Object.defineProperty(n,"__esModule",{value:!0}),n.getLocation=n.parseTourStepsAsync=n.loadTourStepsAsync=void 0,n.loadTourStepsAsync=r,n.parseTourStepsAsync=async function(e){var t,n;const s=[],a=await r(e);for(const e of a)if("double"===e.headerKind&&e.attributes&&e.attributes.title&&e.attributes.description&&e.attributes.location&&e.attributes.highlight){const r=e.attributes.title,a=e.attributes.description;let l=o(e.attributes.location.toLowerCase()),c=i(e.attributes.highlight.toLowerCase());if(c){if("nothing"!==c.targetQuery){const e=document.querySelector(c.targetQuery);if(!e||null===e.offsetParent||"none"===window.getComputedStyle(e).display)continue}}else c={targetQuery:"#root"},l=4,console.log(`Tour steps: "${e.attributes.highlight}" is not a valid element to highlight!`);const u={title:r,description:a,location:l,targetQuery:c.targetQuery,sansQuery:null!==(t=c.sansQuery)&&void 0!==t?t:void 0,sansLocation:null!==(n=c.sansLocation)&&void 0!==n?n:void 0};s.push(u)}return s},n.getLocation=o},{}],325:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getExtensionOfFileName=n.invalidatePagesStatus=n.invalidatePullRequestStatus=n.invalidatePullStatus=n.loadPkgAsync=n.notifySyncDone=n.allEditorPkgs=n.genFileName=n.mainEditorPkg=n.getEditorPkg=n.mainPkg=n.EditorPackage=n.File=n.setupAppTarget=void 0;const i=e("./workspace"),r=e("./data"),o=e("./core"),s=e("./compiler");var a=pxt.Util;const l=e("./idbworkspace");let c={ts:10,blocks:20,jres:25,json:30,md:40};n.setupAppTarget=function(e){pxt.setAppTarget(e)};const u=".g.";class d{constructor(e,t,n){this.epkg=e,this.name=t,this.content=n,this.inSyncWithEditor=!0}isReadonly(){return!this.epkg.header||this.isAutoGenerated()}getName(){return this.epkg.getPkgId()+"/"+this.name}getTextFileName(){return this.epkg.isTopLevel()?this.name:"pxt_modules/"+this.epkg.getPkgId()+"/"+this.name}getFileNameWithExtension(e){const t=this.getTextFileName();return t.substring(0,t.length-this.getExtension().length)+e}getExtension(){return y(this.name)}getVirtualFileName(e){const t=this.name.replace(/.*\./,""),n=t?this.name.slice(0,-t.length-1):this.name;if(/^blocks|py|ts$/.test(t))switch(e){case pxt.BLOCKS_PROJECT_NAME:return n+".blocks";case pxt.JAVASCRIPT_PROJECT_NAME:return n+".ts";case pxt.PYTHON_PROJECT_NAME:return n+".py";default:return void pxt.U.oops()}}weight(){return/^main\./.test(this.name)?5:/^_locales\//.test(this.name)?500:c.hasOwnProperty(this.getExtension())?c[this.getExtension()]:60}markDirty(){this.inSyncWithEditor=!1,this.updateStatus()}updateStatus(){r.invalidate("open-meta:"+this.getName())}setBaseGitContent(e){e!=this.baseGitContent&&(this.baseGitContent=e,this.updateStatus())}setContentAsync(e,t){if(a.assert(void 0!==e),this.inSyncWithEditor=!0,e!=this.content){let n=this.content;return this.content=e,this.updateStatus(),this.epkg.saveFileAsync(this.name).then((()=>{this.content==e&&this.updateStatus(),t&&this.forceChangeCallback&&this.forceChangeCallback(n,e),this.name==pxt.github.GIT_JSON&&this.epkg.updateGitJsonCache()}))}return this.updateStatus(),Promise.resolve()}setForceChangeCallback(e){this.forceChangeCallback=e}publishedContent(){let e=this.content;return this.name==pxt.CONFIG_NAME&&(e=i.prepareConfigForGithub(e)),e}isAutoGenerated(){return"this"===this.epkg.getPkgId()&&(this.name===pxt.TILEMAP_CODE||this.name===pxt.TILEMAP_JRES||this.name===pxt.IMAGES_CODE||this.name===pxt.IMAGES_JRES||this.name===pxt.TUTORIAL_INFO_FILE||this.name==pxt.ASSETS_FILE)}}n.File=d;class h{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={},this.onupdate=()=>{},this.saveScheduled=!1,this.savingNow=0,this.simStateSaveScheduled=!1,this.transpileCache=[],e&&"workspace"==e.verProtocol()&&(this.header=i.getHeader(e.verArgument()))}getSimState(){if(!this.simState){this.files[pxt.SIMSTATE_JSON]||this.setFile(pxt.SIMSTATE_JSON,"{}");const e=this.files[pxt.SIMSTATE_JSON];try{this.simState=JSON.parse(e.content)}catch(e){this.simState={}}}return this.simState}setSimState(e,t){const n=this.getSimState();n[e]!=t&&(null==t?delete n[e]:n[e]=t,this.simStateSaveScheduled||(this.simStateSaveScheduled=!0,setTimeout((()=>{if(this.simStateSaveScheduled=!1,!this.simState)return;const e=this.files[pxt.SIMSTATE_JSON];e&&e.setContentAsync(JSON.stringify(this.simState))}),2e3)))}getTopHeader(){return this.topPkg.header}getLanguageRestrictions(){const e=this.topPkg.ksPkg,t=e&&e.config;return t&&t.languageRestriction}getGeneratedFiles(e){if(e.name.indexOf(u)>-1){const t=e.name.substring(0,e.name.indexOf(u)+u.length);return a.values(this.files).filter((n=>n!==e&&pxt.U.startsWith(n.name,t)))}return[]}afterMainLoadAsync(){return this.assetsPkg?this.assetsPkg.loadAssetsAsync():Promise.resolve()}saveAssetAsync(e,t){return i.saveAssetAsync(this.header.id,e,t).then((()=>this.assetsPkg.loadAssetsAsync()))}loadAssetsAsync(){return"assets"!=this.id?Promise.resolve():i.listAssetsAsync(this.topPkg.header.id).then((e=>{let t=a.flatClone(this.files);for(let n of e){let e=n.name,i=a.lookup(this.files,e);i?delete t[e]:(i=new d(this,e,`File size: ${n.size}; URL: ${n.url}`),this.files[e]=i)}for(let e of Object.keys(t))delete this.files[e];let n="";for(let t of this.sortedFiles()){let i=e.filter((e=>e.name==t.name))[0];n+=`    export const ${t.name.replace(/\..*/,"").replace(/[^a-zA-Z0-9_]/g,"_")} = "${i.url}";\n`}let i=this.topPkg.lookupFile("assets.ts");if(i||n){n=`namespace assets {\n${n}}\n`;let e=this.topPkg.ksPkg.config;if(e.files.indexOf("assets.ts")<0&&(e.files.push("assets.ts"),this.topPkg.ksPkg.saveConfig()),i)return i.setContentAsync(n);this.topPkg.setFile("assets.ts",n)}return Promise.resolve()}))}makeTopLevel(){this.topPkg=this,this.outputPkg=new h(null,this),this.outputPkg.id="built",pxt.appTarget.runtime&&pxt.appTarget.runtime.assetExtensions&&(this.assetsPkg=new h(null,this),this.assetsPkg.id="assets")}updateConfigAsync(e){let t=this.files[pxt.CONFIG_NAME];if(t)try{let n=JSON.parse(t.content);return e(n),t.setContentAsync(pxt.Package.stringifyConfig(n)).then((()=>this.ksPkg.loadConfig()))}catch(e){}return null}async updateDepAsync(e){let t=this.ksPkg.resolveDep(e);if(!t||"github"!=t.verProtocol())return Promise.resolve();let n=pxt.github.parseRepoId(t.verArgument());if(!n)return;const i=await pxt.packagesConfigAsync(),r=await pxt.github.latestVersionAsync(n.slug,i,!0),s=a.values(this.ksPkg.dependencies()).map((e=>pxt.github.parseRepoId(e))).filter((e=>(null==e?void 0:e.slug)===n.slug)),l=await Promise.all(s.map((e=>(e.tag=r,pxt.github.pkgConfigAsync(e.fullName,e.tag,i).catch(o.handleNetworkError).then((t=>({ghid:e,cfg:t})))))));await this.updateConfigAsync((e=>l.forEach((({ghid:t,cfg:n})=>e.dependencies[n.name]=pxt.github.stringifyRepo(t))))),await this.saveFilesAsync()}removeDepAsync(e){return this.updateConfigAsync((t=>delete t.dependencies[e]))}setDependencyAsync(e,t){return this.updateConfigAsync((n=>n.dependencies[e]=t)).then((()=>this.saveFilesAsync()))}getKsPkg(){return this.ksPkg}getPkgId(){return this.ksPkg?this.ksPkg.id:this.id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFile(e,t,n){a.assert(!!e,"missing file name");let i=new d(this,e,t);return n&&(i.virtual=!0),this.files[e]=i,r.invalidate("open-meta:"),i}removeFileAsync(e){return delete this.files[e],r.invalidate("open-meta:"),this.updateConfigAsync((t=>{t.files=t.files.filter((t=>t!=e)),t.testFiles&&(t.testFiles=t.testFiles.filter((t=>t!=e)))}))}setContentAsync(e,t){a.assert(!!e,"missing file name");let n=this.files[e],i=Promise.resolve();return n||(n=new d(this,e,""),this.files[e]=n,i=i.then((()=>this.updateConfigAsync((t=>t.files.indexOf(e)<0?t.files.push(e):0))))),i.then((()=>n.setContentAsync(t)))}updateGitJsonCache(){const e=this.files[pxt.github.GIT_JSON];if(e){const t=JSON.parse(e.content),n=pxt.github.parseRepoId(t.repo);t.commit&&Object.keys(this.files).forEach((e=>{const i=pxt.github.lookupFile(n,t.commit,e);i&&null!=i.blobContent&&this.files[e].setBaseGitContent(i.blobContent)}))}}setFiles(e){this.files=a.mapMap(e,((e,t)=>new d(this,e,t))),r.invalidate("open-meta:"),this.updateGitJsonCache()}getAllFiles(){let e=a.mapMap(this.files,((e,t)=>t.content));return delete e[pxt.SERIAL_EDITOR_FILE],e}saveFileAsync(e){var t;if(!this.header)return Promise.resolve();const n=null===(t=this.files[e])||void 0===t?void 0:t.content;return e===pxt.CONFIG_NAME?this.saveFilesAsync():i.partialSaveAsync(this.header.id,e,n)}saveFilesAsync(){if(!this.header)return Promise.resolve();let e=this.files[pxt.CONFIG_NAME];if(e)try{let t=JSON.parse(e.content);this.header.name=t.name}catch(e){}return i.saveAsync(this.header,this.getAllFiles())}sortedFiles(){let e=a.values(this.files);return pxt.options.debug||(e=e.filter((e=>e.name!=pxt.github.GIT_JSON&&e.name!=pxt.SIMSTATE_JSON&&e.name!=pxt.SERIAL_EDITOR_FILE&&e.name!=pxt.PALETTES_FILE&&e.name!==pxt.HISTORY_FILE))),e.sort(((e,t)=>e.weight()-t.weight()||a.strcmp(e.name,t.name))),e}forEachFile(e){this.pkgAndDeps().forEach((t=>{a.values(t.files).forEach(e)}))}getMainFile(){return this.sortedFiles()[0]}pkgAndDeps(){if(this.topPkg!=this)return this.topPkg.pkgAndDeps();let e=this.ksPkg.deps,t=Object.keys(e),n=[];for(let i of t)/---/.test(i)||e[i].cppOnly||n.push(g(e[i]));return this.assetsPkg&&n.push(this.assetsPkg),n.push(this.outputPkg),n}filterFiles(e){return a.concat(this.pkgAndDeps().map((t=>a.values(t.files).filter(e))))}lookupFile(e){return 0===e.indexOf("pxt_modules/")&&(e=e.slice(12)),this.filterFiles((t=>t.getName()==e))[0]}async buildAssetsAsync(){var e;(null===(e=this.tilemapProject)||void 0===e?void 0:e.needsRebuild)&&(this.tilemapProject.needsRebuild=!1,await this.buildTilemapsAsync(),await this.buildImagesAsync())}buildTilemapsAsync(){const e=this.lookupFile("this/"+pxt.TILEMAP_CODE),t=this.lookupFile("this/"+pxt.TILEMAP_JRES),i=this.tilemapProject.getProjectTilesetJRes();if(!e&&1===Object.keys(i).length)return Promise.resolve();const r=pxt.emitTilemapsFromJRes(i),o=JSON.stringify(i,null,4);return(null==e?void 0:e.content)===r&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.TILEMAP_JRES,o).then((()=>this.setContentAsync(pxt.TILEMAP_CODE,r))).then((()=>{n.mainPkg.updateJRes(),s.refreshLanguageServiceApisInfo()}))}buildImagesAsync(){const e=this.lookupFile("this/"+pxt.IMAGES_CODE),t=this.lookupFile("this/"+pxt.IMAGES_JRES),i=this.tilemapProject.getProjectAssetsJRes();if(!e&&1===Object.keys(i).length)return Promise.resolve();const r=pxt.emitProjectImages(i),o=JSON.stringify(i,null,4);return(null==e?void 0:e.content)===r&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.IMAGES_JRES,o).then((()=>this.setContentAsync(pxt.IMAGES_CODE,r))).then((()=>{n.mainPkg.updateJRes(),s.refreshLanguageServiceApisInfo()}))}cacheTranspile(e,t,n,i){this.transpileCache.push({fromLanguage:e,fromText:t,toLanguage:n,toText:i}),this.transpileCache.length>10&&this.transpileCache.shift()}getCachedTranspile(e,t,n){for(const i of this.transpileCache){if(i.toLanguage===e&&i.fromLanguage===n&&p(e,i.toText,t))return i.fromText;if(i.fromLanguage===e&&i.toLanguage===n&&p(e,i.fromText,t))return i.toText}return null}invalidateCachedTranspile(e,t,n){for(let i=0;i<this.transpileCache.length;i++){const r=this.transpileCache[i],o=r.toLanguage===e&&r.fromLanguage===n&&p(e,r.toText,t),s=r.fromLanguage===e&&r.toLanguage===n&&p(e,r.fromText,t);if(o||s)return void this.transpileCache.splice(i,1)}}addDependencyAsync(e,t,n){return this.topPkg!==this?this.topPkg.addDependencyAsync(e,t):this.ksPkg.findConflictsAsync(e,t).then((i=>{let r=e.core?[]:i.filter((e=>this.ksPkg.isPackageInUse(e.pkg0.id))),s=Promise.resolve(!0);if(r.length)s=s.then((()=>o.confirmAsync({header:lf("Cannot add {0} extension",e.name),hideCancel:!0,agreeLbl:lf("Ok"),body:lf("Remove all the blocks from the {0} extension and try again.",r[0].pkg0.id)}))).then((()=>!1));else if(i.length){const t=1===i.length?lf("Extension {0} is incompatible with {1}. Remove {0} and add {1}?",i[0].pkg0.id,e.name):lf("Extensions {0} and {1} are incompatible with {2}. Remove them and add {2}?",i.slice(0,-1).map((e=>e.pkg0.id)).join(", "),i.slice(-1)[0].pkg0.id,e.name);s=s.then((()=>n?Promise.resolve(1):o.confirmAsync({header:lf("Some extensions will be removed"),agreeLbl:lf("Remove extension(s) and add {0}",e.name),agreeClass:"pink",body:t}))).then((e=>0!==e?Promise.all(i.map((e=>this.removeDepAsync(e.pkg0.id)))).then((()=>!0)):Promise.resolve(!1)))}return s.then((n=>n?this.setDependencyAsync(e.name,t).then((()=>!0)):Promise.resolve(!1)))}))}}function p(e,t,n){return t===n}n.EditorPackage=h;const f=new class{readFile(e,t){let n=g(e).files[t];return n?n.content:null}writeFile(e,t,n,i){if(t!=pxt.CONFIG_NAME&&!i)throw a.oops("trying to write "+e+" / "+t);{let r=g(e),o=r.files[t];if(o)o.setContentAsync(n,i);else{if(-1===e.config.files.indexOf(t))throw a.oops("trying to write file not listed in pxt.json "+e+" / "+t);r.files[t]=new d(r,t,n)}}}getHexInfoAsync(e){return pxt.hexloader.getHexInfoAsync(this,e).catch(o.handleNetworkError)}async cacheStoreAsync(e,t){const n=await v();try{await n.setAsync({id:e,val:t})}catch(t){pxt.tickEvent("cache.store.failed",{error:t.name}),pxt.log(`cache store failed for ${e}: ${t.name}`)}}async cacheGetAsync(e){const t=await v();try{return(await t.getAsync(e)).val}catch(e){return null}}downloadPackageAsync(e){let t=e.verProtocol(),r=g(e),o=t=>i.getTextAsync(t).then((n=>r.isTopLevel()||n?n?r.isTopLevel()&&r.header?i.recomputeHeaderFlagsAsync(r.header,n).then((()=>r.setFiles(n))):(r.setFiles(n),Promise.resolve()):Promise.reject(new Error(`Cannot find text for package '${t}' in the workspace.`)):(e.configureAsInvalidPackage(`cannot find '${t}' in the workspace.`),Promise.resolve())));if("pub"==t)return i.getPublishedScriptAsync(e.verArgument()).then((e=>r.setFiles(e)));if("github"==t)return i.getPublishedScriptAsync(e.version()).then((e=>r.setFiles(e)));if("workspace"==t)return o(e.verArgument());if("file"==t){let t=e.verArgument();return"."==t[0]&&(t=function(e){return e.replace(/\/+/g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\.\//g,"/")}(e.parent.verArgument()+"/"+t)),o(t)}if("embed"==t)return r.setFiles(pxt.getEmbeddedScript(e.verArgument())),Promise.resolve();if("pkg"==t){const t=n.mainPkg.readFile(e.verArgument().replace(/^\.\//,"")),i=ts.pxtc.Util.jsonTryParse(t);return i?r.setFiles(i):pxt.log(`failed to resolve ${e.version()}`),Promise.resolve()}return"invalid"==t?(pxt.log(`skipping invalid pkg ${e.id}`),Promise.resolve()):Promise.reject(`Cannot download ${e.version()}; unknown protocol`)}};function g(e){let t=e._editorPkg;if(t)return t;let i=null;e!=n.mainPkg&&(i=g(n.mainPkg));let r=new h(e,i);return e==n.mainPkg&&r.makeTopLevel(),e._editorPkg=r,r}function m(){return g(n.mainPkg)}function b(){return g(n.mainPkg).pkgAndDeps()}function y(e){let t=/\.([^\.]+)$/.exec(e);return t?t[1]:""}async function v(){return(0,l.getObjectStoreAsync)(l.HOSTCACHE_TABLE)}n.mainPkg=new pxt.MainPackage(f),n.getEditorPkg=g,n.mainEditorPkg=m,n.genFileName=function(e){let t=pxt.Util.sanitizeFileName(m().header.name);if(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");t=t.replace(e,"")}return t||(t="Untitled"),`${pxt.appTarget.nickname||pxt.appTarget.id}-${t}${e}`},n.allEditorPkgs=b,n.notifySyncDone=function(e){a.values(n.mainPkg.deps).filter((t=>"workspace"==t.verProtocol()&&e.hasOwnProperty(t.verArgument()))).length>0&&g(n.mainPkg).onupdate()},n.loadPkgAsync=function(e,t){return n.mainPkg=new pxt.MainPackage(f),n.mainPkg._verspec="workspace:"+e,f.downloadPackageAsync(n.mainPkg).catch(o.handleNetworkError).then((()=>ts.pxtc.Util.jsonTryParse(f.readFile(n.mainPkg,pxt.CONFIG_NAME)))).then((e=>e?n.mainPkg.installAllAsync(t).then((()=>m().afterMainLoadAsync())):(n.mainPkg.configureAsInvalidPackage(lf("invalid pxt.json file")),m().afterMainLoadAsync())))},r.mountVirtualApi("open-meta",{getSync:e=>{e=r.stripProtocol(e);const t=m(),n=t.lookupFile(e);if(!n)return{};const i=!(!t.header||!t.header.githubId||n.epkg!=t),o={isReadonly:n.isReadonly(),numErrors:n.numDiagnosticsOverride,isGitModified:i&&n.baseGitContent!=n.publishedContent()};return null==o.numErrors&&(o.numErrors=n.diagnostics?n.diagnostics.length:0,o.diagnostics=n.diagnostics),o}}),r.mountVirtualApi("open-pkg-meta",{getSync:e=>{e=r.stripProtocol(e);const t=b().filter((t=>t.getPkgId()==e))[0];if(!t||"built"==t.getPkgId())return{};const n=t.sortedFiles();let i=n.reduce(((e,t)=>e+(t.numDiagnosticsOverride||(t.diagnostics?t.diagnostics.length:0)||0)),0);const o=t.getKsPkg();o&&o.invalid()&&i++;const s={numErrors:i};return i&&(s.diagnostics=[],n.filter((e=>!!e.diagnostics)).forEach((e=>s.diagnostics.concat(e.diagnostics)))),s}}),r.mountVirtualApi("pkg-git-status",{getSync:e=>{e=r.stripProtocol(e);const t=b().find((t=>t.header&&t.header.id==e)),n={};if(t&&(n.id="this"==t.getPkgId()&&t.header&&t.header.githubId,n.id)){const e=t.sortedFiles();n.modified=!!e.find((e=>e.baseGitContent!=e.publishedContent()))}return n}}),n.invalidatePullStatus=function(e){r.invalidateHeader("pkg-git-pull-status",e)},r.mountVirtualApi("pkg-git-pull-status",{getAsync:e=>{e=r.stripProtocol(e);const t=b().find((t=>t.header&&t.header.id==e));return"this"==t.getPkgId()&&t.header&&t.header.githubId?i.pullAsync(t.header,!0).catch((e=>i.PullStatus.NoSourceControl)):Promise.resolve(i.PullStatus.NoSourceControl)},expirationTime:e=>36e5}),n.invalidatePullRequestStatus=function(e){r.invalidateHeader("pkg-git-pr",e)},r.mountVirtualApi("pkg-git-pr",{getAsync:e=>{const t={number:-1};e=r.stripProtocol(e);const n=b().find((t=>t.header&&t.header.id==e)),i=n.header,o="this"==n.getPkgId()&&i&&i.githubId;if(!o)return Promise.resolve(t);const s=pxt.github.parseRepoId(o);return s&&s.tag&&"master"!=s.tag?pxt.github.findPRNumberforBranchAsync(s.fullName,s.tag).catch((e=>t)):Promise.resolve(t)},expirationTime:e=>36e5}),n.invalidatePagesStatus=function(e){r.invalidateHeader("pkg-git-pages",e)},r.mountVirtualApi("pkg-git-pages",{getAsync:e=>{e=r.stripProtocol(e);const t=b().find((t=>t.header&&t.header.id==e)),n=t.header,i="this"==t.getPkgId()&&n&&n.githubId;if(!i)return Promise.resolve(void 0);const o=pxt.github.parseRepoId(i);return o?pxt.github.getPagesStatusAsync(o.fullName).catch((e=>{})):Promise.resolve(void 0)},expirationTime:e=>36e5}),r.mountVirtualApi("pkg-status",{getSync:e=>{e=r.stripProtocol(e);const t=b().find((t=>t.header&&t.header.id==e));return t&&t.savingNow?"saving":""}}),n.getExtensionOfFileName=y},{"./compiler":204,"./core":279,"./data":282,"./idbworkspace":306,"./workspace":354}],326:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ChooseHwDialog=n.NewProjectDialog=n.ExitAndSaveDialog=n.ImportDialog=n.ProjectsDetail=n.ProjectsCodeCard=n.ProjectsCarousel=n.ProjectSettingsMenu=n.Projects=void 0;const r=e("react/jsx-runtime"),o=e("react"),s=e("react-dom"),a=e("./data"),l=e("./sui"),c=e("./core"),u=e("./auth"),d=e("./codecard"),h=e("./carousel"),p=e("./dialogs"),f=e("./util");class g extends u.Component{constructor(e){super(e),this.state={visible:!1},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.chgHeader=this.chgHeader.bind(this),this.chgGallery=this.chgGallery.bind(this),this.importProject=this.importProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.setSelected=this.setSelected.bind(this)}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.selectedCategory!=t.selectedCategory||this.state.selectedIndex!=t.selectedIndex}setSelected(e,t){null==t||this.state.selectedCategory==e&&this.state.selectedIndex==t?this.setState({selectedCategory:void 0,selectedIndex:void 0}):this.setState({selectedCategory:e,selectedIndex:t})}componentDidUpdate(e,t){this.state.selectedCategory!==t.selectedCategory&&this.ensureSelectedItemVisible()}ensureSelectedItemVisible(){let e=this.refs.activeCarousel;if(e){let t=e.getCarouselDOM();this.scrollElementIntoViewIfNeeded(t)}}scrollElementIntoViewIfNeeded(e){let t=s.findDOMNode(this.refs.homeContainer);const n=e.getBoundingClientRect().top;t.parentElement.scrollTop=t.parentElement.scrollTop+n-30}showLanguagePicker(){pxt.tickEvent("projects.langpicker"),this.props.parent.showLanguagePicker()}showAboutDialog(){(0,p.showAboutDialogAsync)(this.props.parent)}chgHeader(e){pxt.tickEvent("projects.header"),c.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).catch((e=>(c.warningNotification(lf("Sorry, we could not load this project.")),pxt.reportException(e),this.props.parent.openHome(),Promise.reject(e)))).finally((()=>{c.hideLoading("changeheader")}))}chgGallery(e,t){k(this.props.parent,"projects",e,t)}importProject(){pxt.tickEvent("projects.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showScriptManager(){pxt.tickEvent("projects.showall.header",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}renderCore(){const{selectedCategory:e,selectedIndex:t}=this.state,n=pxt.appTarget.appTheme,{scriptManager:i}=n,o=this.getData("target-config:"),s=pxt.Util.userLanguage();let a={};o&&o.localizedGalleries&&o.localizedGalleries[s]&&pxt.Util.jsonCopyFrom(a,o.localizedGalleries[s]),o&&o.galleries&&pxt.Util.jsonCopyFrom(a,o.galleries);const c=l.cx(["ui segment bottom attached tab active tabsegment"]);return(0,r.jsxs)("div",Object.assign({ref:"homeContainer",className:c,role:"main"},{children:[(0,r.jsx)(b,{parent:this.props.parent}),(0,r.jsx)("h1",Object.assign({className:"accessible-hidden"},{children:lf("MakeCode Home")})),(0,r.jsxs)("div",Object.assign({className:"ui segment gallerysegment mystuff-segment",role:"region","aria-label":lf("My Projects")},{children:[(0,r.jsxs)("div",Object.assign({className:"ui heading"},{children:[(0,r.jsx)("div",Object.assign({className:"column",style:{zIndex:1},onClick:i&&this.showScriptManager,onKeyDown:i&&f.fireClickOnEnter},{children:i?(0,r.jsxs)("h2",Object.assign({className:"ui header myproject-header"},{children:[lf("My Projects"),(0,r.jsx)("span",Object.assign({className:"view-all-button",tabIndex:0,title:lf("View all projects"),role:"button"},{children:lf("View All")}))]})):(0,r.jsx)("h2",Object.assign({className:"ui header"},{children:lf("My Projects")}))})),(0,r.jsx)("div",Object.assign({className:"column right aligned",style:{zIndex:1}},{children:pxt.appTarget.compile||pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?(0,r.jsx)(l.Button,{icon:"upload",className:"import-dialog-btn",textClass:"landscape only",text:lf("Import"),title:lf("Import a project"),onClick:this.importProject},"import"):void 0}))]})),(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)(y,{parent:this.props.parent,name:"recent",onClick:this.chgHeader},"mystuff_carousel")}))]}),"mystuff_gallerysegment"),Object.keys(a).filter((e=>{const t=a[e];if("string"==typeof t)return!0;const n=t.experimentName;if(n&&!pxt.appTarget.appTheme[n])return!1;const i=t.locales;if(i&&i.indexOf(pxt.Util.userLanguage())<0)return!1;const r=t.testUrl||!!t.youTube&&"https://www.youtube.com/favicon.ico";return!r||!0===this.getData(`ping:${r.replace("@random@",Math.random().toString())}`)})).map((n=>{const i=a[n],o="string"==typeof i?i:i.url,s="string"==typeof i?void 0:i.shuffle;return(0,r.jsxs)("div",Object.assign({className:"ui segment gallerysegment",role:"region","aria-label":pxt.Util.rlf(n)},{children:[(0,r.jsxs)("h2",Object.assign({className:"ui header heading"},{children:[pxt.Util.rlf(n)," "]})),(0,r.jsx)("div",Object.assign({className:"content"},{children:(0,r.jsx)(y,{ref:""+(e==n?"activeCarousel":""),parent:this.props.parent,name:n,path:o,onClick:this.chgGallery,setSelected:this.setSelected,shuffle:s,selectedIndex:e==n?t:void 0},`${n}_carousel`)}))]}),`${n}_gallerysegment`)})),n.organizationUrl||n.organizationUrl||n.privacyUrl||n.copyrightText?(0,r.jsxs)("div",Object.assign({className:"ui horizontal small divided link list homefooter",role:"contentinfo"},{children:[n.organizationUrl&&n.organization?(0,r.jsx)("a",Object.assign({className:"item",target:"_blank",rel:"noopener noreferrer",href:n.organizationUrl},{children:n.organization})):void 0,n.selectLanguage?(0,r.jsx)(l.Link,{className:"item",icon:"xicon globe",text:lf("Language"),onClick:this.showLanguagePicker,onKeyDown:f.fireClickOnEnter,role:"button"}):void 0,n.termsOfUseUrl?(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:n.termsOfUseUrl,rel:"noopener noreferrer"},{children:lf("Terms of Use")})):void 0,n.privacyUrl?(0,r.jsx)("a",Object.assign({target:"_blank",className:"item",href:n.privacyUrl,rel:"noopener noreferrer"},{children:lf("Privacy")})):void 0,pxt.appTarget.versions?(0,r.jsx)(l.Link,{className:"item",text:`v${pxt.appTarget.versions.target}`,onClick:this.showAboutDialog,onKeyDown:f.fireClickOnEnter,role:"button"}):void 0,n.copyrightText?(0,r.jsx)("div",Object.assign({className:"ui item copyright"},{children:n.copyrightText})):void 0]})):void 0]}))}}n.Projects=g;class m extends a.Component{constructor(e){super(e),this.state={},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.signOutGithub=this.signOutGithub.bind(this)}showLanguagePicker(){pxt.tickEvent("home.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("home.togglecontrast",void 0,{interactiveConsent:!0}),this.hide(),c.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("home.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("home.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("home.reset",void 0,{interactiveConsent:!0}),this.props.parent.showResetDialog()}showReportAbuse(){pxt.tickEvent("home.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showAboutDialog(){pxt.tickEvent("home.about"),this.props.parent.showAboutDialog()}signOutGithub(){pxt.tickEvent("home.github.signout"),this.props.parent.signOutGithub()}hide(){var e;null===(e=this.dropdown)||void 0===e||e.hide()}renderCore(){const e=pxt.auth.hasIdentity(),t=this.getData(u.HIGHCONTRAST),n=pxt.appTarget.appTheme,i=!e&&this.getData("github:user"),o=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,s=n.selectLanguage||n.highContrast||i;return(0,r.jsxs)(l.DropdownMenu,Object.assign({role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem",ref:e=>this.dropdown=e},{children:[n.selectLanguage&&(0,r.jsx)(l.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}),n.highContrast&&(0,r.jsx)(l.Item,{role:"menuitem",text:t?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}),i&&(0,r.jsx)("div",{className:"ui divider"}),i&&(0,r.jsxs)("div",Object.assign({className:"ui item",title:lf("Unlink {0} from GitHub",i.name),role:"menuitem",onClick:this.signOutGithub},{children:[(0,r.jsx)("div",Object.assign({className:"avatar",role:"presentation"},{children:(0,r.jsx)("img",{className:"ui circular image",src:i.photo,alt:lf("User picture")})})),lf("Disconnect GitHub")]})),s&&(0,r.jsx)("div",{className:"ui divider"}),o?(0,r.jsx)(l.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,(0,r.jsx)(l.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),(0,r.jsx)(l.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),n.feedbackUrl?(0,r.jsx)("a",Object.assign({className:"ui item",href:n.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},{children:lf("Give Feedback")})):void 0]}))}}n.ProjectSettingsMenu=m;class b extends a.Component{constructor(e){super(e),this.carouselTimeout=void 0,this.handleRefreshCard=e=>{var t;if(pxt.debug("next hero carousel"),null===(t=this.prevGalleries)||void 0===t?void 0:t.length){const t=this.state.cardIndex,n=e?this.prevGalleries.length-1:1;this.setState({cardIndex:(t+n)%this.prevGalleries.length})}this.scheduleRefresh()},this.handleSetCardIndex=e=>{this.clearRefresh(),this.setState({cardIndex:e,paused:!0})},this.onPointerDown=e=>{this.dragStartX=e.clientX},this.onTouchstart=e=>{var t;(null===(t=e.touches)||void 0===t?void 0:t.length)&&(this.dragStartX=e.touches[0].clientX)},this.onPointerUp=e=>{this.handleRelease(e.clientX,e)},this.onTouchEnd=e=>{var t,n;this.handleRelease(null===(n=null===(t=e.changedTouches)||void 0===t?void 0:t[0])||void 0===n?void 0:n.clientX,e)},this.onKeyDown=e=>{switch(c.keyCodeFromEvent(e)){case 37:this.handleRefreshCard(!0),e.stopPropagation();break;case 39:this.handleRefreshCard(),e.stopPropagation()}},this.handleCardClick=()=>{const e=void 0!==this.state.cardIndex&&this.prevGalleries[this.state.cardIndex];e&&(pxt.tickEvent("hero.card.click",{gallery:pxt.appTarget.appTheme.homeScreenHeroGallery,card:e.name,cardIndex:this.state.cardIndex}),k(this.props.parent,"herobanner",e))},this.scheduleRefresh=()=>{const{paused:e}=this.state;e||(this.clearRefresh(),this.carouselTimeout=setTimeout(this.handleRefreshCard,9e3))},this.state={cardIndex:0}}handleRelease(e,t){if(void 0!==this.dragStartX&&void 0!==e){const n=this.dragStartX-e;this.dragStartX=void 0,Math.abs(n)>30&&(t.stopPropagation(),t.preventDefault(),this.handleRefreshCard(n<0))}}clearRefresh(){this.carouselTimeout&&(clearTimeout(this.carouselTimeout),this.carouselTimeout=void 0)}componentDidMount(){this.scheduleRefresh()}componentWillUnmount(){this.clearRefresh()}fetchGallery(){const e=pxt.appTarget.appTheme,t=e.homeScreenHeroGallery;let n,i;"string"==typeof e.homeScreenHero?i=e.homeScreenHero:e.homeScreenHero&&(n=e.homeScreenHero);const r=e.homeScreenHero&&Object.assign(Object.assign({},null!=n?n:{}),{imageUrl:i||(null==n?void 0:n.imageUrl),description:(null==n?void 0:n.description)&&pxt.U.rlf(n.description),name:(null==n?void 0:n.name)&&pxt.U.rlf(n.name),buttonLabel:(null==n?void 0:n.buttonLabel)&&pxt.U.rlf(n.buttonLabel)});if(this.prevGalleries||(this.prevGalleries=[],r&&this.prevGalleries.push(r)),!t)return this.prevGalleries;let o=this.getData(`gallery:${encodeURIComponent(t)}`);return o&&(o instanceof Error||(this.prevGalleries=pxt.Util.concat(o.map((e=>e.cards))).slice(0,5),r&&this.prevGalleries.unshift(r),this.prevGalleries.forEach((e=>{const t=encodeURI(e.largeImageUrl||e.imageUrl);if(!b.fetchedImages[t]){const e=new Image;e.src=t,b.fetchedImages[t]=e}})),this.scheduleRefresh())),this.prevGalleries}renderCore(){const e=pxt.appTarget.appTheme,{cardIndex:t}=this.state,n=!!e.homeScreenHeroGallery,i=this.fetchGallery(),o=i[t];if(!o)return null;const s=e=>()=>this.handleSetCardIndex(e),a=o.url,l=o.description||o.name,c=`url(${encodeURI(o.largeImageUrl||o.imageUrl)})`,u=o.buttonLabel||E(o.cardType,o.youTubeId,o.youTubePlaylistId),d=!!a||!!o.youTubeId||!!o.youTubePlaylistId;return(0,r.jsxs)("div",Object.assign({className:"ui segment getting-started-segment hero",style:{backgroundImage:c},onKeyDown:this.onKeyDown,onPointerDown:this.onPointerDown,onTouchStart:this.onTouchstart,onPointerUp:this.onPointerUp,onTouchEnd:this.onTouchEnd},{children:[(!!l||d||n)&&(0,r.jsx)("div",{className:"gradient-overlay"}),(0,r.jsxs)("div",Object.assign({className:"hero-banner-contents"},{children:[!!l&&(0,r.jsx)("div",Object.assign({className:"description"},{children:(0,r.jsx)("p",{children:l})})),d&&(0,r.jsx)("div",Object.assign({className:"action"},{children:w({url:a,youTubeId:o.youTubeId,youTubePlaylistId:o.youTubePlaylistId,scr:o},"large blue button",u,o.cardType,this.handleCardClick)})),n&&(0,r.jsx)("div",Object.assign({className:"dots"},{children:i.map(((e,n)=>(0,r.jsx)("button",{className:`ui button empty circular label  clear ${n===t&&"active"}`,onClick:s(n),"aria-label":lf("View {0} hero image",e.title||e.name),title:lf("View {0} hero image",e.title||e.name)},"dot"+n)))}),"cards")]}))]}))}}b.fetchedImages={};class y extends a.Component{constructor(e){super(e),this.prevGalleries=[],this.hasFetchErrors=!1,this.state={},this.closeDetail=this.closeDetail.bind(this),this.closeDetailOnEscape=this.closeDetailOnEscape.bind(this),this.reload=this.reload.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.handleCardClick=this.handleCardClick.bind(this)}componentDidMount(){this.props.parent.state.header&&this.latestProject&&this.latestProject.element&&this.latestProject.element.focus()}fetchGallery(e){let t=this.getData(`gallery:${encodeURIComponent(e)}`);if(t)if(t instanceof Error)this.hasFetchErrors=!0;else if(this.prevGalleries=pxt.Util.concat(t.map((e=>e.cards))),this.props.shuffle){const e=this.prevGalleries.pop(),t=(new Date).toDateString();this.prevGalleries.sort(((e,n)=>ts.pxtc.Util.codalHash16(e.name+t)-ts.pxtc.Util.codalHash16(n.name+t))),e&&this.prevGalleries.push(e)}return this.prevGalleries||[]}fetchLocalData(){return this.getData("headers:")||[]}newProject(e){pxt.tickEvent("projects.new",void 0,{interactiveConsent:!0}),pxt.appTarget.appTheme.nameProjectFirst||pxt.appTarget.appTheme.chooseLanguageRestrictionOnNewProject?this.props.parent.askForProjectCreationOptionsAsync().then((t=>{const{name:n,languageRestriction:i}=t;this.props.parent.newProject({name:n,languageRestriction:i,firstProject:e})})):this.props.parent.newProject({firstProject:e})}showScriptManager(){pxt.tickEvent("projects.showscriptmanager",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}closeDetail(){const{name:e}=this.props;pxt.tickEvent("projects.detail.close"),this.props.setSelected(e,void 0)}getCarouselDOM(){return s.findDOMNode(this.refs.carousel)}getDetailDOM(){return s.findDOMNode(this.refs.detailView)}closeDetailOnEscape(e){c.keyCodeFromEvent(e)==c.ESC_KEY&&(this.closeDetail(),document.removeEventListener("keydown",this.closeDetailOnEscape),e.preventDefault())}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&document.addEventListener("keydown",this.closeDetailOnEscape)}reload(){this.setState({})}handleCardClick(e,t,n){const{name:i}=this.props;!this.props.setSelected||t&&t.directOpen?this.props.onClick(t):(pxt.tickEvent("projects.detail.open",{name:null==t?void 0:t.name,url:null==t?void 0:t.url,cardType:null==t?void 0:t.cardType,editor:null==t?void 0:t.editor},{interactiveConsent:!0}),this.props.setSelected(i,n))}renderCore(){const{name:e,path:t,selectedIndex:n}=this.props,i=pxt.appTarget.appTheme;if(t){this.hasFetchErrors=!1;const e=this.fetchGallery(t);if(this.hasFetchErrors)return(0,r.jsx)("div",Object.assign({className:"ui carouselouter"},{children:(0,r.jsx)("div",Object.assign({role:"button",className:"carouselcontainer",tabIndex:0,onClick:this.reload},{children:(0,r.jsx)("p",Object.assign({className:"ui grey inverted segment"},{children:lf("Oops, please connect to the Internet and try again.")}))}))}));{const i=e[n],o=e.some((e=>e.tags&&0!=e.tags.length));return(0,r.jsxs)("div",{children:[(0,r.jsx)(h.Carousel,Object.assign({ref:"carousel",tickId:t,bleedPercent:20,selectedIndex:n},{children:e.map(((e,n)=>(0,r.jsx)(v,{className:"example",name:e.name,url:e.url,imageUrl:e.imageUrl,youTubeId:e.youTubeId,youTubePlaylistId:e.youTubePlaylistId,buttonLabel:e.buttonLabel,label:e.label,labelClass:e.labelClass,tags:e.tags,scr:e,index:n,onCardClick:this.handleCardClick,cardType:e.cardType,tallCard:o,tutorialStep:e.tutorialStep,tutorialLength:e.tutorialLength},t+(e.youTubeId||e.name||e.url))))})),i&&(0,r.jsxs)("div",Object.assign({ref:"detailView",className:"detailview"},{children:[(0,r.jsx)(l.CloseButton,{onClick:this.closeDetail}),(0,r.jsx)(_,{parent:this.props.parent,name:i.name,description:i.description,url:i.url,imageUrl:i.imageUrl,largeImageUrl:i.largeImageUrl,videoUrl:i.videoUrl,youTubeId:i.youTubeId,youTubePlaylistId:i.youTubePlaylistId,buttonLabel:i.buttonLabel,actionIcon:i.actionIcon,scr:i,onClick:this.props.onClick,cardType:i.cardType,tags:i.tags,otherActions:i.otherActions},"detail"+i.name)]}))]})}}{const e=this.fetchLocalData(),t=pxt.appTarget.appTheme&&!pxt.appTarget.appTheme.hideNewProjectButton,n=i.scriptManager&&e.length>y.NUM_PROJECTS_HOMESCREEN,o=u.hasIdentity()&&!u.loggedIn()&&pxt.storage.getLocal(u.HAS_USED_CLOUD),s=e.filter((e=>{var t,n;return!(null===(n=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.hideIteration)})).slice(0,y.NUM_PROJECTS_HOMESCREEN),a=!e||0==(null==e?void 0:e.length);return(0,r.jsxs)(h.Carousel,Object.assign({tickId:"myprojects",bleedPercent:20},{children:[t&&(0,r.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard newprojectcard",title:lf("Creates a new empty project"),onClick:()=>this.newProject(a),onKeyDown:f.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)(l.Icon,{icon:"huge add circle"}),(0,r.jsx)("span",Object.assign({className:"header"},{children:lf("New Project")}))]}))})),o&&(0,r.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard cloudprojectscard",title:lf("Sign in to see cloud projects"),onClick:e=>this.props.parent.showLoginDialog(),onKeyDown:f.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)(l.Icon,{icon:"huge xicon cloud-profile"}),(0,r.jsx)("span",Object.assign({className:"header"},{children:lf("Cloud Projects")}))]}))})),s.map(((e,t)=>{const n=e.tutorial?e.tutorial.tutorialStep:e.tutorialCompleted?e.tutorialCompleted.steps-1:void 0,i=e.tutorial?e.tutorial.tutorialStepInfo.length:e.tutorialCompleted?e.tutorialCompleted.steps:void 0,o=pxt.github.parseRepoId(e.githubId);return(0,r.jsx)(v,{cardType:"file",name:o&&pxt.github.join(o.project,o.fileName)||e.name,time:e.modificationTime,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,onCardClick:this.handleCardClick,tutorialStep:n,tutorialLength:i,projectId:e.id},"local"+e.id+e.recentUse)})),n&&(0,r.jsx)("div",Object.assign({role:"button",className:"ui card link buttoncard scriptmanagercard",title:lf("See all projects"),onClick:this.showScriptManager,onKeyDown:f.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[(0,r.jsx)(l.Icon,{icon:"huge right angle"}),(0,r.jsx)("span",Object.assign({className:"header"},{children:lf("See all projects")}))]}))}))]}))}}}n.ProjectsCarousel=y,y.NUM_PROJECTS_HOMESCREEN=8;class v extends l.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleLabelClick=this.handleLabelClick.bind(this)}handleClick(e){this.props.onCardClick(e,this.props.scr,this.props.index,this.props.id)}handleLabelClick(e){this.props.onLabelClick(e,this.props.scr,this.props.index,this.props.id)}renderCore(){let e=this.props,{scr:t,onCardClick:n,onLabelClick:o,onClick:s,cardType:a,imageUrl:l,className:c}=e,u=i(e,["scr","onCardClick","onLabelClick","onClick","cardType","imageUrl","className"]);return c=c||"",t&&"file"==a&&(t.githubId?c="file github "+c:t.extensionUnderTest?c="file test "+c:t.board?(c="file board "+c,l=pxt.bundledSvg(t.board)):c=t.editor?"file "+t.editor:"file "+c),(0,r.jsx)(d.CodeCardView,Object.assign({role:"button",className:c,imageUrl:l,cardType:a},u,{onClick:this.handleClick,onLabelClicked:o?this.handleLabelClick:void 0}))}}n.ProjectsCodeCard=v;class _ extends a.Component{constructor(e){super(e),this.state={},this.handleDetailClick=this.handleDetailClick.bind(this),this.handleOpenForumUrlInEditor=this.handleOpenForumUrlInEditor.bind(this),this.linkRef=o.createRef()}isLink(e){return T(this.props,e)}getUrl(){return x(this.props)}getClickLabel(e){const{youTubeId:t,youTubePlaylistId:n}=this.props;return E(e,t,n)}getActionEditor(e,t){switch(e){case"tutorial":case"example":return t&&t.editor?t.editor:"blocks";case"codeExample":return t&&t.editor?t.editor:"js";case"sharedExample":return null==t?void 0:t.editor;default:return null}}getActionIcon(e,t,n,i){const{youTubeId:o,youTubePlaylistId:s}=this.props;let a="file text";if(i)a=i;else switch(t){case"tutorial":case"example":a="xicon blocks",n&&(a=`xicon ${n}`);break;case"codeExample":a=`xicon ${n||"js"}`;break;case"sharedExample":a="pencil",n&&(a=`xicon ${n}`);break;case"forumUrl":a="comments";break;case"forumExample":a="pencil";break;case"template":default:(o||s)&&(a="youtube")}return this.isLink(t)&&"forumExample"!=t?(0,r.jsx)(l.Link,{role:"presentation",className:"link button attached",icon:a,href:this.getUrl(),target:"_blank",tabIndex:-1}):(0,r.jsx)(l.Item,{role:"presentation",className:"button attached",icon:a,onClick:e,tabIndex:-1})}getActionTitle(e){switch(e){case"py":return"Python";case"js":return"JavaScript";case"blocks":return lf("Blocks");default:return null}}getActionCard(e,t,n,i,o,s,a){const l=this.getActionEditor(t,o),c=this.getActionTitle(l);return(0,r.jsxs)("div",Object.assign({className:`card-action ui items ${l||""} ${a?"custom-icon":""}`},{children:[this.getActionIcon(n,t,l,a),c&&(0,r.jsx)("div",Object.assign({className:"card-action-title"},{children:c})),w(this.props,"button attached approve large",e,t,n,i,c,this.linkRef)]}),s)}handleDetailClick(){const{scr:e,onClick:t}=this.props;pxt.tickEvent("projects.actions.details",{name:e.name,url:e.url,cardType:e.cardType,editor:e.editor},{interactiveConsent:!0}),t(e)}handleActionClick(e){const{scr:t,onClick:n}=this.props;return pxt.tickEvent("projects.actions.click",{name:t.name,url:t.url,cardType:t.cardType,editor:t.editor},{interactiveConsent:!0}),()=>n(t,e)}handleOpenForumUrlInEditor(){pxt.tickEvent("projects.actions.forum",void 0,{interactiveConsent:!0});const{url:e}=this.props;pxt.discourse.extractSharedIdFromPostUrl(e).then((e=>{e?window.location.hash="pub:"+e:c.warningNotification(lf("Oops, we could not find the program in the forum."))})).catch(c.handleNetworkError)}isYouTubeOnline(){const{youTubeId:e,youTubePlaylistId:t}=this.props;return(e||t)&&this.getData("ping:https://www.youtube.com/favicon.ico")}componentDidMount(){this.linkRef&&this.linkRef.current&&this.linkRef.current.focus()}renderCore(){const{name:e,description:t,largeImageUrl:n,videoUrl:i,youTubeId:o,youTubePlaylistId:s,buttonLabel:a,actionIcon:c,cardType:d,tags:h,otherActions:p}=this.props,f=this.getData(u.HIGHCONTRAST),g=pxt.appTarget.appTheme.tagColors||{},m=t&&t.split("\n"),b=!f&&(n||o&&`https://img.youtube.com/vi/${o}/0.jpg`),y=!f&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS()&&i,v=!pxt.appTarget.appTheme.hideHomeDetailsVideo,_=pxt.youtube.watchUrl(o,s);let E;return E=a?ts.pxtc.Util.rlf(a):this.getClickLabel(d),(0,r.jsxs)("div",Object.assign({className:"ui grid stackable padded"},{children:[v&&(y||b)&&(0,r.jsx)("div",Object.assign({className:"imagewrapper"},{children:y?(0,r.jsx)("video",{className:"video",src:y,autoPlay:!0,controls:!1,loop:!0,playsInline:!0}):(0,r.jsx)("div",{className:"image",style:{backgroundImage:`url("${b}")`}})})),(0,r.jsx)("div",Object.assign({className:"column six wide"},{children:(0,r.jsxs)("div",Object.assign({className:"segment"},{children:[(0,r.jsxs)("div",Object.assign({className:"header"},{children:[" ",e," "]})),h&&(0,r.jsx)("div",Object.assign({className:"ui labels"},{children:h.map((e=>(0,r.jsx)("div",Object.assign({className:`ui ${g[e]||""} label`},{children:pxt.Util.rlf(e)}))))})),m&&m.map(((e,t)=>(0,r.jsx)("p",Object.assign({className:"detail"},{children:e}),`line${t}`))),!!d&&_&&this.isYouTubeOnline()&&(0,r.jsx)(l.Link,{href:_,target:"_blank",icon:"play",text:lf("Play Video Lesson"),className:"yt-button button attached approve large inverted",title:lf("Open YouTube video in new window")})]}))})),(0,r.jsx)("div",Object.assign({className:"actions column ten wide"},{children:(0,r.jsxs)("div",Object.assign({className:"segment"},{children:[this.getActionCard(E,d,this.handleDetailClick,!0,void 0,void 0,c),p&&p.map(((e,t)=>{let n=this.handleActionClick(e),i=e.cardType?this.getClickLabel(e.cardType):E;return this.getActionCard(i,e.cardType||d,n,!1,e,`action${t}`)})),"forumUrl"===d&&(!p||0==p.length)&&!pxt.BrowserUtils.isPxtElectron()&&this.getActionCard(lf("Open in Editor"),"forumExample",this.handleOpenForumUrlInEditor)]}))}))]}))}}function E(e,t,n){return"tutorial"==e?lf("Start Tutorial"):"codeExample"==e||"example"==e?lf("Open Example"):"forumUrl"==e?lf("Open in Forum"):"sharedExample"==e?lf("Open in Editor"):"template"==e?lf("New Project"):t?lf("Watch Video"):n?lf("Watch Playlist"):lf("Show Instructions")}function T(e,t){const{cardType:n,url:i,youTubeId:r,youTubePlaylistId:o}=e;return function(e){switch(e){case"file":case"example":case"codeExample":case"sharedExample":case"tutorial":case"side":case"template":case"package":case"hw":return!1;case"forumUrl":default:return!0}}(t||n)&&(r||o||i)}function x(e){const{url:t,youTubeId:n,youTubePlaylistId:i}=e;return!n&&!i||t?/^https:\/\//i.test(t)||/^\//i.test(t)?t:"":pxt.youtube.watchUrl(n,i)}function w(e,t,n,i,o,s,a,c){const u=T(e,i)&&"forumExample"!=i,d=u?lf("Open link in new window"):lf("Open in {0}",a||lf("Editor"));return u?(0,r.jsx)(l.Link,{href:x(e),refCallback:s?c:void 0,target:"_blank",text:n,className:t,title:d,ariaLabel:d,autoFocus:s}):(0,r.jsx)(l.Button,{text:n,className:t,onClick:o,onKeyDown:f.fireClickOnEnter,autoFocus:s,title:d,ariaLabel:d})}function k(e,t,n,i){let r=i&&i.editor||"blocks";"js"==r&&(r="ts");const o=i?i.url:n.url,s=(null==i?void 0:i.cardType)||n.cardType,a=r+"prj";switch(pxt.tickEvent(`${t}.gallery`,{name:n.name,cardType:s,editor:r}),s){case"template":const t=pxt.Util.clone(pxt.appTarget.blocksprj);t.config.dependencies={},l(n.name,o,!0,pxt.BLOCKS_PROJECT_NAME,t);break;case"example":l(n.name,o,!0,a);break;case"codeExample":l(n.name,o,!1,a);break;case"side":e.newEmptyProject(n.name,o);break;case"tutorial":e.startActivity({activity:"tutorial",path:o,title:n.name,editor:a});break;case"sharedExample":console.log("shared example");let i=pxt.github.normalizeRepoId(o)||pxt.Cloud.parseScriptId(o);i?window.location.hash="pub:"+i:c.errorNotification(lf("Sorry, the project url looks invalid."));break;case"link":window.open(/^https:\/\//i.test(o)||/^\//i.test(o)?o:"","_blank");break;default:const r=/^\/#tutorial:([a-z0A-Z0-9\-\/]+)$/.exec(o);if(r)e.startActivity({activity:"tutorial",path:r[1]});else{if(n.youTubeId&&!o)return;if(/^https:\/\//i.test(o))return;if(o){if(/^\//i.test(o))return;c.errorNotification(lf("Sorry, the project url looks invalid."))}else e.newEmptyProject(n.name.toLowerCase())}}function l(t,n,i,r,o){return e.startActivity({activity:"example",path:n,title:t,editor:r,importOptions:{path:n,name:t,loadBlocks:i,prj:o}})}}n.ProjectsDetail=_;class S extends a.Component{constructor(e){super(e),this.state={visible:!1},this.close=this.close.bind(this),this.importHex=this.importHex.bind(this),this.importUrl=this.importUrl.bind(this),this.cloneGithub=this.cloneGithub.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(){this.setState({visible:!0})}importHex(){pxt.tickEvent("projects.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog()}importUrl(){pxt.tickEvent("projects.importurl",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportUrlDialog()}async cloneGithub(){pxt.tickEvent("github.projects.clone",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportGithubDialog()}renderCore(){var e,t,n;const{visible:i}=this.state,o=pxt.appTarget.appTheme,s=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),a=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),c=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,u=this.props.parent.createModalClasses("importdialog"),h=o.githubEditor&&!pxt.BrowserUtils.isPxtElectron()&&(null===(n=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.cloud)||void 0===t?void 0:t.cloudProviders)||void 0===n?void 0:n.github),p=pxt.appTarget.compile&&!s&&!a;let f=p?1:0;f+=c?1:0;const g=1===(f+=h?1:0)?"one":2===f?"two":"three";return(0,r.jsx)(l.Modal,Object.assign({isOpen:i,className:u,size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Import"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsxs)("div",Object.assign({className:`ui ${g} cards`},{children:[p&&(0,r.jsx)(d.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",icon:"upload",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importHex},"import"),c&&(0,r.jsx)(d.CodeCardView,{ariaLabel:lf("Open a shared project URL or GitHub repo"),role:"button",icon:"cloud download",iconColor:"secondary",name:lf("Import URL..."),description:lf("Open a shared project URL or GitHub repo"),onClick:this.importUrl},"importurl"),h&&(0,r.jsx)(d.CodeCardView,{ariaLabel:lf("Clone or create your own GitHub repository"),role:"button",icon:"github",iconColor:"secondary",name:lf("Your GitHub Repo..."),description:lf("Clone or create your own GitHub repository"),onClick:this.cloneGithub},"importgithub")]}))}))}}n.ImportDialog=S;class C extends a.Component{constructor(e){super(e),this.state={visible:!1,emoji:""},this.hide=this.hide.bind(this),this.handleChange=this.handleChange.bind(this),this.save=this.save.bind(this),this.skip=this.skip.bind(this)}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("exitandsave.show",void 0,{interactiveConsent:!1}),this.setState({projectName:this.props.parent.state.projectName,visible:!0})}handleChange(e){this.setState({projectName:e,emoji:I(e)})}skip(){pxt.tickEvent("exitandsave.skip",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.openHome()}save(){const{projectName:e}=this.state;this.hide();let t=Promise.resolve();e&&this.props.parent.state.projectName!=e&&(pxt.tickEvent("exitandsave.projectrename",{length:e&&e.length},{interactiveConsent:!0}),t=t.then((()=>this.props.parent.updateHeaderNameAsync(e)))),t.then((()=>{this.props.parent.openHome()}))}renderCore(){const{visible:e,projectName:t}=this.state,n=pxt.BrowserUtils.isMobile(),i=[{label:lf("Save"),onclick:this.save,icon:"check",className:"approve positive"},{label:lf("Skip"),onclick:this.skip}],o=this.props.parent.createModalClasses("exitandsave"),s=lf("Give your project a name.");return(0,r.jsx)(l.Modal,Object.assign({isOpen:e,className:o,size:"tiny",onClose:this.hide,dimmer:!0,buttons:i,closeIcon:!0,header:lf("Project has no name {0}",this.state.emoji),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:s}),(0,r.jsx)("div",Object.assign({className:"ui form"},{children:(0,r.jsx)(l.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:s,autoComplete:!1,value:t||"",onChange:this.handleChange,onEnter:this.save,selectOnMount:!n,autoFocus:!n})}))]})}))}}n.ExitAndSaveDialog=C;class A extends a.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.show=()=>{pxt.tickEvent("newprojectdialog.show",void 0,{interactiveConsent:!1}),this.setState({name:"",emoji:"",visible:!0,languageRestriction:""})},this.handleTextChange=e=>{this.setState({name:e,emoji:I(e)})},this.handleLanguageChange=e=>{this.setState({languageRestriction:e})},this.save=()=>{const{name:e,languageRestriction:t}=this.state;this.hide(),this.createProjectCb&&this.createProjectCb({name:e,languageRestriction:t}),pxt.tickEvent("newprojectdialog.projectcreate",{language:t},{interactiveConsent:!0}),this.createProjectCb=null},this.onExpandedMenuHide=()=>{pxt.tickEvent("newprojectdialog.codeoptions.hide"),this.setState({languageRestriction:""})},this.onExpandedMenuShow=()=>{pxt.tickEvent("newprojectdialog.codeoptions.show")},this.state={visible:!1,emoji:"",languageRestriction:""}}promptUserAsync(){return this.show(),new Promise((e=>{this.createProjectCb=e}))}renderCore(){const{visible:e,name:t,emoji:n}=this.state,{python:i,chooseLanguageRestrictionOnNewProject:o}=pxt.appTarget.appTheme,s=[{label:lf("Create"),onclick:this.save,icon:"check",className:"approve positive"}],a=pxt.BrowserUtils.isMobile(),c=[{value:"",display:i?lf("Blocks, {0}, and {1}","JavaScript","Python"):lf("Blocks and {0}","JavaScript")},i&&{value:"python-only",display:lf("{0} Only","Python")},{value:"javascript-only",display:lf("{0} Only","JavaScript")}],u=this.props.parent.createModalClasses("newproject"),d=lf("Give your project a name.");return(0,r.jsxs)(l.Modal,Object.assign({isOpen:e,className:u,size:"tiny",onClose:this.hide,dimmer:!0,buttons:s,closeIcon:!0,header:lf("Create a Project {0}",n),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:d}),(0,r.jsx)("div",Object.assign({className:"ui form"},{children:(0,r.jsx)(l.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:d,autoComplete:!1,value:t||"",onChange:this.handleTextChange,onEnter:this.save,selectOnMount:!a,autoFocus:!a})}))]}),o&&(0,r.jsxs)("div",{children:[(0,r.jsx)("br",{}),(0,r.jsx)(l.ExpandableMenu,Object.assign({title:lf("Code options"),onShow:this.onExpandedMenuShow,onHide:this.onExpandedMenuHide},{children:(0,r.jsx)(l.Select,{options:c,onChange:this.handleLanguageChange,"aria-label":lf("Select Language")})}))]})]}))}}function I(e){const t=lf("Untitled");let n="";if(e&&-1===t.indexOf(e)){const t=["","","",""];n=t[Math.min(e.length,t.length)-1];const i=e.length>>1;if(i>t.length)for(let e=0;e<Math.min(2,i-t.length);++e)n+=t[t.length-1]}return n}n.NewProjectDialog=A;class O extends a.Component{constructor(e){super(e),this.prevGalleries=[],this.state={visible:!1,skipDownload:!1},this.close=this.close.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(e){this.setState({visible:!0,skipDownload:!!e})}setHwVariant(e,t){pxt.tickEvent("projects.choosehwvariant",{hwid:e.name,card:t?t.name:e.name},{interactiveConsent:!0}),this.hide(),pxt.setHwVariant(e.name,t?t.name:e.description||e.name);let n=this.props.parent;n.reloadHeaderAsync().then((()=>!this.state.skipDownload&&n.compile()))}renderCore(){var e;const{visible:t}=this.state;if(!t)return(0,r.jsx)("div",{});const n=pxt.getHwVariants();for(const e of n){e.card||(e.card={name:e.description});const t=e;e.card.onClick=()=>this.setHwVariant(t,null)}const i=this.getData("target-config:"),o=null===(e=null==i?void 0:i.hardwareOptions)||void 0===e?void 0:e.map((e=>{const t=Object.assign({},e),i=n.find((e=>e.name===t.variant));if(i)return t.onClick=()=>this.setHwVariant(i,t),t})).filter((e=>!!e));return(0,r.jsxs)(l.Modal,Object.assign({isOpen:t,className:"hardwaredialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Choose your hardware"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[(0,r.jsx)("div",Object.assign({className:"group"},{children:(0,r.jsxs)("div",Object.assign({className:"ui cards centered",role:"listbox"},{children:[null==o?void 0:o.map((e=>(0,r.jsx)(d.CodeCardView,{name:e.name,ariaLabel:e.name,description:pxt.Util.rlf(`{id:hardware-description}${e.description}`),imageUrl:e.imageUrl,learnMoreUrl:e.url,onClick:e.onClick},"card"+e.name))),n.map((e=>(0,r.jsx)(d.CodeCardView,{name:e.card.name,ariaLabel:e.card.name,description:e.card.description,imageUrl:e.card.imageUrl,learnMoreUrl:e.card.learnMoreUrl,onClick:e.card.onClick},"variant"+e.name)))]}))})),(0,r.jsxs)("p",{children:[(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),lf("No hardware? Or want to add some?")," ",(0,r.jsx)("a",Object.assign({className:"small",href:"/hardware",target:"_blank",rel:"noopener noreferrer","aria-label":lf("Learn more about hardware")},{children:lf("Learn more!")}))]})]}))}}n.ChooseHwDialog=O},{"./auth":194,"./carousel":199,"./codecard":203,"./core":279,"./data":282,"./dialogs":289,"./sui":346,"./util":352,react:548,"react-dom":491,"react/jsx-runtime":549}],327:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("./package"),o=e("./srceditor"),s=e("./sui"),a=e("./core"),l=e("./data");var c=pxt.Util;const u=e("./util");class d extends o.Editor{constructor(e){super(e),this.parent=e,this.config={},this.changeMade=!1,this.handleNameInputRef=e=>{this.nameInput=e},this.saveOnClick=e=>{this.save()},this.editSettingsText=this.editSettingsText.bind(this),this.save=this.save.bind(this),this.setFileName=this.setFileName.bind(this),this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this),this.goBack=this.goBack.bind(this)}goBack(){pxt.tickEvent("pxtjson.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}prepare(){this.isReady=!0}getId(){return"pxtJsonEditor"}hasEditorToolbar(){return!1}save(e){const t=this.config;if(this.isSaving=!0,!t.name)return a.errorNotification(lf("Please choose a project name. It can't be blank.")),void(this.isSaving=!1);r.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME).setContentAsync(pxt.Package.stringifyConfig(t)).then((()=>{r.mainPkg.config.name=t.name,this.parent.setState({projectName:t.name}),this.parent.forceUpdate(),c.nextTick(this.changeCallback),this.isSaving=!1,this.changeMade=!0,e||this.parent.openPreviousEditor(),a.resetFocus()}))}setFileName(e){this.config.name=e,this.parent.forceUpdate()}optionaldepConfig(){let e={};return r.mainPkg.sortedDeps().filter((e=>e.config&&e.config.yotta&&e.config.yotta.optionalConfig)).forEach((t=>c.jsonMergeFrom(e,t.config.yotta.optionalConfig))),e}isUserConfigActive(e){let t=this.optionaldepConfig();this.config.yotta&&this.config.yotta.config&&c.jsonMergeFrom(t,this.config.yotta.config),t=c.jsonFlatten(t);const n=c.jsonFlatten(e.config);return!Object.keys(n).some((e=>null===n[e]?!!t[e]:t[e]!==n[e]))}applyUserConfig(e){c.jsonFlatten(this.optionaldepConfig());const t=c.jsonFlatten(this.config.yotta?this.config.yotta.config:{}),n=c.jsonFlatten(e.config);this.isUserConfigActive(e)?Object.keys(n).forEach((e=>{delete t[e]})):Object.keys(n).forEach((e=>t[e]=n[e])),Object.keys(t).length?(this.config.yotta||(this.config.yotta={}),this.config.yotta.config=c.jsonUnFlatten(t)):this.config.yotta&&(delete this.config.yotta.config,Object.keys(this.config.yotta).length||delete this.config.yotta),this.save(!0)}display(){if(!this.isVisible)return;const e=this.config;let t=[];return r.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.isLoaded&&!!e.config&&!!e.config.yotta&&!!e.config.yotta.userConfigs)).forEach((e=>t=t.concat(e.config.yotta.userConfigs))),(0,i.jsxs)("div",Object.assign({className:"ui content"},{children:[(0,i.jsx)("div",Object.assign({className:"ui small header"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)(s.Button,Object.assign({autoFocus:!0,title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:u.fireClickOnEnter},{children:[(0,i.jsx)(s.Icon,{icon:"arrow left"}),(0,i.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]}))}))})),(0,i.jsxs)("div",Object.assign({className:"ui segment form text"},{children:[(0,i.jsx)(s.Input,{ref:this.handleNameInputRef,id:"fileNameInput",label:lf("Name"),ariaLabel:lf("Type a name for your project"),value:e.name||"",onChange:this.setFileName,autoComplete:!1}),t.map((e=>(0,i.jsx)(h,{uc:e,isUserConfigActive:this.isUserConfigActive,applyUserConfig:this.applyUserConfig},`userconfig-${e.description}`))),(0,i.jsxs)(s.Field,{children:[(0,i.jsx)(s.Button,{text:lf("Save"),className:"green "+(this.isSaving?"disabled":""),onClick:this.saveOnClick}),(0,i.jsx)(s.Button,{text:lf("Edit Settings As text"),onClick:this.editSettingsText})]})]}))]}))}isIncomplete(){return!this.changeMade}editSettingsText(){this.changeMade=!1,this.parent.editText()}getCurrentSource(){return pxt.Package.stringifyConfig(this.config)}acceptsFile(e){if(e.name!=pxt.CONFIG_NAME)return!1;if(e.isReadonly())return!1;try{return JSON.parse(e.content),!0}catch(e){return!1}}loadFileAsync(e){return this.config=JSON.parse(e.content),this.nameInput&&this.nameInput.clearValue(),this.setDiagnostics(e,this.snapshotState()),this.changeMade=!1,Promise.resolve()}unloadFileAsync(){var e;return this.changeMade&&!(null===(e=this.parent.state)||void 0===e?void 0:e.home)?this.parent.reloadHeaderAsync():Promise.resolve()}}n.Editor=d;class h extends l.Component{constructor(e){super(e),this.state={},this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this)}isUserConfigActive(){const{applyUserConfig:e,isUserConfigActive:t,uc:n}=this.props;return t(n)}applyUserConfig(){const{applyUserConfig:e,isUserConfigActive:t,uc:n}=this.props;e(n)}renderCore(){const{uc:e}=this.props,t=this.isUserConfigActive();return(0,i.jsx)(s.Checkbox,{inputLabel:pxt.Util.rlf(e.description),checked:t,onChange:this.applyUserConfig},`userconfig-${e.description}`)}}},{"./core":279,"./data":282,"./package":325,"./srceditor":345,"./sui":346,"./util":352,"react/jsx-runtime":549}],328:[function(e,t,n){"use strict";let i;Object.defineProperty(n,"__esModule",{value:!0}),n.renderAsync=void 0,n.renderAsync=function(e){return(i||(i=pxt.BrowserUtils.loadScriptAsync("qrcode/qrcode.min.js").then((()=>"undefined"!=typeof qrcode)).catch((e=>!1))),i).then((t=>{if(!t)return;const n=qrcode(0,"L");let i=/^(https.*\/)([0-9-]+)$/.exec(e);return i?(n.addData(i[1].toUpperCase(),"Alphanumeric"),n.addData(i[2].replace(/-/g,""),"Numeric")):(i=/^(https.*\/)(_[a-zA-Z0-9]+)$/.exec(e))?(n.addData(i[1].toUpperCase(),"Alphanumeric"),n.addData(i[2],"Byte")):n.addData(e,"Byte"),n.make(),n.createDataURL(5,5)})).catch((e=>{pxt.reportException(e)}))}},{}],329:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.loadGifEncoderAsync=n.GifEncoder=n.encodeBlobAsync=n.saveAsync=void 0;const i=e("./workspace"),r=e("./data");function o(e,t){let n=0,i=0,r=0,o=0;t.height>t.width?(n=0,o=(r=t.width)/e.width*e.height,i=(t.height-o)/2):(i=0,r=(o=t.height)/e.height*e.width,n=(t.width-r)/2),e.getContext("2d").drawImage(t,n,i,r,o,0,0,e.width,e.height)}function s(){return pxt.BrowserUtils.loadImageAsync(pxt.appTarget.appTheme.logo).then((e=>{const t=document.createElement("canvas");t.width=160,t.height=120;const n=t.getContext("2d"),i=pxt.appTarget.appTheme.accentColor;return i&&(n.fillStyle=i,n.fillRect(0,0,t.width,t.height)),o(t,e),t})).catch((()=>function(){const e=document.createElement("canvas");e.width=160,e.height=120;const t=e.getContext("2d");return t.fillStyle="#33b",t.fillRect(0,0,160,120),t.font="30px monospace",t.fillStyle="#fff",t.fillText(":(",60,70),Promise.resolve(e)}()))}n.saveAsync=function(e,t){return pxt.BrowserUtils.loadImageAsync(t).then((n=>{const s=function(e){let t=null;if(e&&e.width>0&&e.height>0){const n=document.createElement("canvas");n.width=305,n.height=200,o(n,e),t=n.toDataURL("image/jpeg",85)}return t}(n);return i.saveScreenshotAsync(e,t,s).then((()=>{r.invalidateHeader("header",e)}))}))},n.encodeBlobAsync=function(e,t,n){return(t?pxt.BrowserUtils.loadCanvasAsync(t):s()).catch((()=>s())).then((t=>function(e,t){const n=e.width,i=e.height,r=document.createElement("canvas");r.width=n+16+16,r.height=i+16+16+32;const o=r.getContext("2d");o.imageSmoothingEnabled=!1,o.fillStyle="white",o.fillRect(0,0,r.width,r.height),o.drawImage(e,16,16);const s=pxt.appTarget.thumbnailName||pxt.appTarget.name;if(s){const e=12;o.fillStyle="black",o.font="10px monospace",o.fillText(s,16,e,n-16)}if(t){const e=32+i+4;o.fillStyle="black",o.font="13px monospace",o.fillText(t,16,e,n-16)}{const e=32+i+4+16;o.fillStyle="#444",o.font="10px monospace";const t=pxt.appTarget.appTheme.homeUrl.replace(/^https:\/\//,"").replace(/\/$/,"");o.fillText(t,16,e,n)}return r}(t,e))).then((e=>pxt.Util.encodeBlobAsync(e,n).toDataURL("image/png")))};class a{constructor(e){this.options=e,this.scale=1,this.cancellationToken=new pxt.Util.CancellationToken,this.options.maxFrames||(this.options.maxFrames=64),e.scale&&(this.scale=e.scale)}start(){pxt.debug("gif: start encoder"),this.gif=new GIF(this.options),this.time=-1,this.cancellationToken=new pxt.Util.CancellationToken,this.cancellationToken.startOperation(),this.renderPromise=void 0}cancel(){if(pxt.debug("gif: cancel"),!this.cancellationToken.isCancelled()){if(this.cancellationToken.cancel(),this.gif&&this.gif.running)try{this.gif.abort()}catch(e){}this.clean()}}clean(){this.gif&&this.gif.freeWorkers&&(this.gif.freeWorkers.forEach((e=>e.terminate())),this.gif.freeWorkers=[]),this.gif=void 0,this.time=-1}addFrame(e,t){if(this.cancellationToken.isCancelled()||this.renderPromise)return!1;const n=pxt.Util.now();return this.time<0&&(this.time=n),void 0===t&&(t=n-this.time),1!=this.scale&&(e=pxt.BrowserUtils.scaleImageData(e,this.scale)),pxt.debug(`gif: frame ${t}ms`),this.gif.addFrame(e,{delay:t}),this.time=n,this.gif.frames.length>this.options.maxFrames}renderAsync(){if(this.cancellationToken.isCancelled())return Promise.resolve(void 0);const e=()=>this.renderGifAsync().then((t=>{if(this.cancellationToken.throwIfCancelled(),this.options.maxLength&&t.length>this.options.maxLength){const n=Math.floor(this.gif.frames.length*this.options.maxLength/t.length)-1;return pxt.log(`gif: size too large (${t.length/1e3|0}kb) reducing frames to ${n}`),n<=0?void pxt.log("gif: simulator image too large, cannot have a single frame"):(this.gif.frames=this.gif.frames.slice(0,n),e())}return pxt.log(`gif: rendered ${this.gif.frames.length} frames to ${t.length/1e3|0}kb`),t}));return pxt.debug(`gif: render ${this.gif.frames.length} frames`),this.renderPromise||(this.renderPromise=e().finally((()=>this.clean())).catch((e=>{pxt.debug("rendering failed"),pxt.debug(e)}))),this.renderPromise}renderGifAsync(){return this.cancellationToken.throwIfCancelled(),new Promise(((e,t)=>{this.gif.on("finished",(t=>{this.gif.running=!1,e(t)})),this.gif.on("abort",(()=>{pxt.debug("gif: abort"),e(void 0)})),this.gif.render()})).then((e=>ts.pxtc.Util.blobReadAsDataURL(e)))}}n.GifEncoder=a,n.loadGifEncoderAsync=function(){if(!pxt.webConfig.gifworkerjs)return Promise.resolve(void 0);const e={workers:1,dither:!1,workerScript:pxt.webConfig.gifworkerjs,quality:pxt.appTarget.appTheme.simGifQuality||16,transparent:pxt.appTarget.appTheme.simGifTransparent,maxFrames:pxt.appTarget.appTheme.simGifMaxFrames||64,maxLength:pxt.appTarget.appTheme.simScreenshotMaxUriLength||3e5,scale:2};return pxt.BrowserUtils.loadScriptAsync("gifjs/gif.js").then((()=>new a(e)))}},{"./data":282,"./workspace":354}],330:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ScriptManagerDialog=n.loadZipAsync=void 0;const r=e("react/jsx-runtime"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./workspace"),c=e("./compiler"),u=e("./components/searchInput"),d=e("./projects"),h=e("./util"),p=e("../../react-common/components/controls/Modal"),f=e("./dialogs"),g=e("../../react-common/components/util");let m;function b(){return m||(m=pxt.BrowserUtils.loadScriptAsync("zip.js/zip.min.js").then((()=>"undefined"!=typeof zip)).catch((e=>!1))),m}n.loadZipAsync=b;class y extends o.Component{constructor(e){super(e),this.handleKeyDown=e=>{const t=a.keyCodeFromEvent(e);(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey)&&65===t&&this.handleSelectAll(e)},this.handleAreaClick=()=>{this.setState({selected:{}})},this.handleSelectAll=e=>{let{selected:t}=this.state;const n=this.getSortedHeaders();n.length>0&&n.length==Object.keys(t).length?t={}:n.forEach(((e,n)=>{t[this.getId(e)]=1})),this.setState({selected:t}),e.stopPropagation(),e.preventDefault()},this.toggleSortName=e=>{let{sortedBy:t,sortedAsc:n}=this.state;n=!("name"==t&&!e&&n),this.setState({sortedBy:"name",sortedAsc:n})},this.toggleSortTime=e=>{let{sortedAsc:t,sortedBy:n}=this.state;t="time"==n&&!e&&!t,this.setState({sortedBy:"time",sortedAsc:t})},this.handleSortName=e=>{e.stopPropagation(),this.toggleSortName(!0)},this.handleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!0)},this.handleToggleSortName=e=>{e.stopPropagation(),this.toggleSortName(!1)},this.handleToggleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!1)},this.handleSwitchSortDirection=e=>{e.stopPropagation();const{sortedAsc:t}=this.state;this.setState({sortedAsc:!t})},this.handleDownloadAsync=async()=>{pxt.tickEvent("scriptmanager.downloadZip",void 0,{interactiveConsent:!0}),await b();const{selected:e}=this.state,t=new zip.ZipWriter(new zip.Data64URIWriter("application/zip")),n=this.getSortedHeaders().filter((t=>e[this.getId(t)]));let i=0;const r={},o=(e,t=2)=>{let n=e+"";for(;n.length<t;)n="0"+n;return n.substring(0,t)};this.setState({download:{completed:0,max:n.length}});const s=pxt.appTarget.nickname||pxt.appTarget.id;for(const a of n){const c=await l.getTextAsync(a.id);let u="blocksprj";try{u=JSON.parse(c["pxt.json"]).preferredEditor||"blocksprj"}catch(e){}const d={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,targetVersions:pxt.appTarget.versions,editor:u,name:a.name},source:JSON.stringify(c,null,2)},h=await pxt.lzmaCompressAsync(JSON.stringify(d,null,2));let p=a.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+={}\[\]~`\x00-\x1F]/g,"");if(p=p.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");p=p.replace(e,"")}p||(p="Untitled");const f=new Date(1e3*a.recentUse),g=`${f.getFullYear()}-${o(f.getMonth())}-${o(f.getDate())}`;let m=`${s}-${g}-${p}.mkcd`;if(r[m]){let e=2;do{m=`${s}-${g}-${p}${e}.mkcd`,e++}while(r[m])}if(r[m]=!0,await t.add(m,new zip.Uint8ArrayReader(h)),!this.state.download)return;i++,this.setState({download:{completed:i,max:n.length}})}const a=await t.close(),c=`makecode-${s}-project-download.zip`;pxt.BrowserUtils.browserDownloadDataUri(a,c),this.setState({download:null})},this.handleDownloadProgressClose=()=>{this.setState({download:null})},this.state={visible:!1,selected:{},markedNew:{},view:"grid",sortedBy:"time",sortedAsc:!1},this.close=this.close.bind(this),this.handleCardClick=this.handleCardClick.bind(this),this.handleDelete=this.handleDelete.bind(this),this.handleOpen=this.handleOpen.bind(this),this.handleOpenNewTab=this.handleOpenNewTab.bind(this),this.handleOpenNewLinkedTab=this.handleOpenNewLinkedTab.bind(this),this.handleDuplicate=this.handleDuplicate.bind(this),this.handleSwitchView=this.handleSwitchView.bind(this),this.handleSearch=this.handleSearch.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}hide(){this.setState({visible:!1,searchFor:void 0})}close(){this.setState({visible:!1,searchFor:void 0}),this.props.onClose&&this.props.onClose()}show(){this.setState({visible:!0}),c.projectSearchClear()}fetchLocalData(){return this.getData(`headers:${this.state.searchFor||""}`)}handleCardClick(e,t,n,i,r){const o=e.shiftKey,s=r&&!o||(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey);let{selected:a,multiSelect:l,multiSelectStart:c}=this.state;if(!o||!s){if(s)a[i]?delete a[i]:a[i]=1,a[i]&&(c=n);else if(o){const e=this.getSortedHeaders();a={};for(let t=Math.min(n,c);t<=Math.max(n,c);t++)a[this.getId(e[t])]=1;l=!0}else l&&(a={},l=!1);o||s||(1==Object.keys(a).length&&a[i]?delete a[i]:((a={})[i]=1,c=n)),this.setState({selected:a,multiSelect:l,multiSelectStart:c}),e.stopPropagation(),e.preventDefault()}}handleCheckboxClick(e,t,n,i){this.handleCardClick(e,t,n,i,!0),e.preventDefault(),e.stopPropagation()}handleDelete(){let{selected:e}=this.state;const t=this.getSortedHeaders(),n=Object.keys(e).length;a.confirmDelete(1==n?t.find((t=>Object.keys(e)[0].includes(t.id))).name:n.toString(),(()=>{const n=[];return t.forEach(((t,i)=>{e[this.getId(t)]&&(t.isDeleted=!0,n.push(l.forceSaveAsync(t,{})))})),this.setState({selected:{}}),Promise.all(n).then((()=>{o.clearCache()}))}),n>1)}handleOpen(){pxt.tickEvent("scriptmanager.open",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();a.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).then((()=>{a.hideLoading("changeheader")}))}handleOpenNewTab(){pxt.tickEvent("scriptmanager.newtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!1)}handleOpenNewLinkedTab(){pxt.tickEvent("scriptmanager.newlinkedtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!0)}handleDuplicate(){pxt.tickEvent("scriptmanager.dup",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader(),t={header:lf("Choose a new name for your project"),agreeLbl:lf("Duplicate"),agreeClass:"green approve positive",agreeIcon:"clone",initialValue:l.createDuplicateName(e),placeholder:lf("Enter your project name here"),size:"tiny"};return a.promptAsync(t).then((t=>{if(null===t)return!1;let n;return l.duplicateAsync(e,t).then((e=>(n=this.getId(e),l.saveAsync(e)))).then((()=>(o.invalidate(`headers:${this.state.searchFor}`),this.setState({selected:{},markedNew:{[n]:1},sortedBy:"time",sortedAsc:!1}),setTimeout((()=>{this.setState({markedNew:{}})}),5e3),!0)))}))}handleSwitchView(){const e="grid"==this.state.view?"list":"grid";this.setState({view:e})}handleSearch(e){this.setState({searchFor:e,selected:{}})}getSelectedHeader(){const{selected:e}=this.state;if(1!==Object.keys(e).length)return null;const t=Object.keys(e)[0];return this.fetchLocalData().find((e=>t.includes(e.id)))}getSortedHeaders(){const{sortedBy:e,sortedAsc:t,searchFor:n}=this.state,i=(this.fetchLocalData()||[]).filter((e=>{var t,n;return!(null===(n=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.hideIteration)}));return(null==n?void 0:n.trim())?i:i.sort(this.getSortingFunction(e,t))}getSortingFunction(e,t){return(n,i)=>"time"===e?t?n.modificationTime-i.modificationTime:i.modificationTime-n.modificationTime:t?n.name.localeCompare(i.name):i.name.localeCompare(n.name)}getId(e){return"local"+e.id+e.recentUse}renderCore(){const{visible:e,selected:t,markedNew:n,view:i,searchFor:o,sortedBy:a,sortedAsc:l,download:c}=this.state;if(!e)return(0,r.jsx)("div",{});const m="dark"==pxt.appTarget.appTheme.baseTheme;let b=this.getSortedHeaders()||[];b=b.filter((e=>!e.isDeleted));const y=!!(null==o?void 0:o.trim()),_=!!o||b.length>0,E=b.length>0&&b.length==Object.keys(t).length,T=pxt.appTarget.appTheme.openProjectNewTab&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS(),x=T&&pxt.appTarget.appTheme.openProjectNewDependentTab&&!/nestededitorsim=1/.test(window.location.href);let w;if(_){(w=[]).push((0,r.jsx)(u.SearchInput,{ariaMessage:lf("{0} result matching '{1}'",b.length,o),placeholder:lf("Search..."),className:"mobile hide",searchHandler:this.handleSearch,disabled:!1,style:{flexGrow:1},searchOnChange:!0},"search"));const e=Object.keys(t).length;if(e>0){if(1==e){const e=(0,r.jsx)(s.Button,{icon:"edit outline",className:"icon",text:lf("Open"),textClass:"landscape only",title:lf("Open Project"),onClick:this.handleOpen},"edit");T?w.push((0,r.jsxs)("div",Object.assign({className:"ui buttons"},{children:[e,(0,r.jsxs)(s.DropdownMenu,Object.assign({className:"floating button",icon:"dropdown"},{children:[(0,r.jsx)(s.Item,{icon:"external alternate",className:"icon",text:lf("New Tab"),title:lf("Open Project in a new tab"),onClick:this.handleOpenNewTab},"editnewtab"),x&&(0,r.jsx)(s.Item,{icon:"external alternate",className:"icon",text:lf("New Connected Tab"),title:lf("Open Project in a new tab with a connected simulator"),onClick:this.handleOpenNewLinkedTab},"editnewlinkedtab")]}))]}))):w.push(e),w.push((0,r.jsx)(s.Button,{icon:"clone outline",className:"icon",text:lf("Duplicate"),textClass:"landscape only",title:lf("Duplicate Project"),onClick:this.handleDuplicate},"clone"))}w.push((0,r.jsx)(s.Button,{icon:"trash",className:"icon red",text:lf("Delete"),textClass:"landscape only",title:lf("Delete Project"),onClick:this.handleDelete},"delete")),e>1&&w.push((0,r.jsx)(s.Button,{icon:"download",className:"icon",text:lf("Download Zip"),textClass:"landscape only",title:lf("Download Zip"),onClick:this.handleDownloadAsync},"download-zip")),w.push((0,r.jsx)("div",{className:"divider"},"divider"))}w.push((0,r.jsx)(s.Button,{icon:"grid"==i?"th list":"grid layout",className:"icon",title:`${"grid"==i?lf("List view"):lf("Grid view")}`,onClick:this.handleSwitchView},"view"))}let k=lf("Last Modified");return y?k=lf("Most Relevant"):"name"==a&&(k=lf("Name")),(0,r.jsxs)(s.Modal,Object.assign({isOpen:e,className:"scriptmanager",size:"fullscreen",onClose:this.close,dimmer:!0,header:lf("My Projects"),closeIcon:!0,headerActions:w,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:[_?void 0:(0,r.jsx)("div",Object.assign({className:"empty-content"},{children:(0,r.jsx)("h2",Object.assign({className:(0,g.classList)("ui center aligned header",m&&"inverted")},{children:(0,r.jsxs)("div",Object.assign({className:"content"},{children:[lf("It's empty in here"),(0,r.jsx)("div",Object.assign({className:"sub header"},{children:lf("Go back to create a new project")}))]}))}))})),_&&"grid"==i?(0,r.jsxs)("div",Object.assign({role:"button",className:"ui container fluid",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},{children:[(0,r.jsx)("div",Object.assign({className:"sort-by"},{children:(0,r.jsxs)("div",Object.assign({role:"menu",className:"ui compact buttons"},{children:[(0,r.jsxs)(s.DropdownMenu,Object.assign({role:"menuitem",text:k,title:lf("Sort by dropdown"),className:(0,g.classList)("inline button",m&&"inverted"),displayLeft:!0,disabled:y},{children:[(0,r.jsx)(s.Item,{role:"menuitem",icon:y||"name"!=a?void 0:"check",className:(0,g.classList)(!y&&"name"!=a&&"no-icon",m&&"inverted"),text:lf("Name"),tabIndex:-1,onClick:this.handleSortName}),(0,r.jsx)(s.Item,{role:"menuitem",icon:y||"time"!=a?void 0:"check",className:(0,g.classList)(!y&&"time"!=a&&"no-icon",m&&"inverted"),text:lf("Last Modified"),tabIndex:-1,onClick:this.handleSortTime})]})),(0,r.jsx)(s.Button,{role:"menuitem",icon:"arrow "+(l&&!y?"up":"down"),className:""+(m?"inverted":""),onClick:this.handleSwitchSortDirection,title:lf("Switch sort order to {0}",l?lf("descending"):lf("ascending")),disabled:y})]}))})),(0,r.jsx)("div",Object.assign({className:"ui cards"},{children:b.map(((e,i)=>{const o=this.getId(e),s=!!n[o],a=!!t[o],l=s&&!a;let c=`circle outline ${a?"check":""} ${a?"green":"grey"} ${m?"inverted":""}`;l&&(c=void 0);const u=l?"orange right ribbon label":"right corner label large selected-label",h=l?lf("New"):void 0;return(0,r.jsx)(d.ProjectsCodeCard,{id:o,cardType:"file",className:"file "+(s?"warning":a?"positive":""),name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:i,labelIcon:c,labelClass:u,label:h,onCardClick:this.handleCardClick,onLabelClick:this.handleCheckboxClick,projectId:e.id},o)}))}))]})):void 0,_&&"list"==i?(0,r.jsx)("div",Object.assign({role:"table",className:"ui container",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},{children:(0,r.jsxs)("table",Object.assign({className:"ui definition unstackable table "+(m?"inverted":"")},{children:[(0,r.jsx)("thead",Object.assign({className:"full-width"},{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",Object.assign({onClick:this.handleSelectAll,tabIndex:0,onKeyDown:h.fireClickOnEnter,title:E?lf("De-select all projects"):lf("Select all projects"),style:{cursor:"pointer"}},{children:(0,r.jsx)(s.Icon,{icon:"circle outline large "+(E?"check":"")})})),(0,r.jsxs)("th",Object.assign({onClick:this.handleToggleSortName,tabIndex:0,onKeyDown:h.fireClickOnEnter,title:lf("Sort by Name {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},{children:[lf("Name")," ",!y&&"name"==a&&(0,r.jsx)(s.Icon,{icon:"arrow "+(l?"up":"down")})]})),(0,r.jsxs)("th",Object.assign({onClick:this.handleToggleSortTime,tabIndex:0,onKeyDown:h.fireClickOnEnter,title:lf("Sort by Last Modified {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},{children:[lf("Last Modified")," ",y||"time"!=a?void 0:(0,r.jsx)(s.Icon,{icon:"arrow "+(l?"up":"down")})]}))]})})),(0,r.jsx)("tbody",{children:b.map(((e,i)=>{const o=this.getId(e),s=!!n[o],a=!!t[o],l=s&&!a;return(0,r.jsxs)(v,Object.assign({id:o,selected:a,onRowClicked:this.handleCardClick,index:i,scr:e,markedNew:l},{children:[(0,r.jsx)("td",{children:e.name}),(0,r.jsx)("td",{children:pxt.Util.timeSince(e.recentUse)})]}),o)}))})]}))})):void 0,c&&(0,r.jsx)(p.Modal,Object.assign({title:lf("Preparing your zip file..."),onClose:this.handleDownloadProgressClose},{children:(0,r.jsx)(f.ProgressBar,{percentage:c.completed/c.max*100})}))]}))}}n.ScriptManagerDialog=y;class v extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}handleClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id)}handleCheckboxClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id,!0),e.preventDefault(),e.stopPropagation()}renderCore(){const e=this.props,{scr:t,onRowClicked:n,onClick:o,selected:a,markedNew:l,children:c}=e,u=i(e,["scr","onRowClicked","onClick","selected","markedNew","children"]);return(0,r.jsxs)("tr",Object.assign({tabIndex:0},u,{onKeyDown:h.fireClickOnEnter,onClick:this.handleClick,style:{cursor:"pointer"},className:""+(l?"warning":a?"positive":"")},{children:[(0,r.jsx)("td",Object.assign({className:"collapsing",onClick:this.handleCheckboxClick},{children:(0,r.jsx)(s.Icon,{icon:"circle outline large "+(a?"check green":l?"black":"")})})),c]}))}}},{"../../react-common/components/controls/Modal":159,"../../react-common/components/util":187,"./compiler":204,"./components/searchInput":264,"./core":279,"./data":282,"./dialogs":289,"./projects":326,"./sui":346,"./util":352,"./workspace":354,"react/jsx-runtime":549}],331:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.ScriptSearch=n.ScriptSearchMode=void 0;const r=e("react/jsx-runtime"),o=e("react-dom"),s=e("./data"),a=e("./sui"),l=e("./package"),c=e("./core"),u=e("./codecard"),d=e("./electron"),h=e("./workspace"),p=e("./components/searchInput"),f=e("../../pxteditor");var g,m;(m=g=n.ScriptSearchMode||(n.ScriptSearchMode={}))[m.Extensions=0]="Extensions",m[m.Boards=1]="Boards",m[m.Experiments=2]="Experiments";class b extends s.Component{constructor(e){super(e),this.state={searchFor:"",visible:!1,mode:g.Extensions,closeIcon:!0},this.hide=this.hide.bind(this),this.handleSearch=this.handleSearch.bind(this),this.addUrl=this.addUrl.bind(this),this.addBundle=this.addBundle.bind(this),this.installGh=this.installGh.bind(this),this.addLocal=this.addLocal.bind(this),this.toggleExperiment=this.toggleExperiment.bind(this),this.importExtensionFile=this.importExtensionFile.bind(this),this.backOnHide=this.backOnHide.bind(this)}hide(e,t){this.setState({visible:!1}),!0===t&&this.props.parent.openPreviousEditor(),this.state.mode==g.Experiments&&this.state.experimentsState!==f.experiments.state()&&this.props.parent.reloadEditor()}afterHide(){const e=this.state.resolve;e&&(this.setState({resolve:void 0}),e())}showExtensions(e){this.setState({visible:!0,defaultSearch:e||"",searchFor:e||"",mode:g.Extensions,closeIcon:!0,features:void 0,resolve:void 0})}showBoardsAsync(e,t){return new Promise(((n,i)=>{this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:g.Boards,closeIcon:!!t,features:e,resolve:n})}))}showExperiments(){this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:g.Experiments,closeIcon:!0,experimentsState:f.experiments.state(),features:void 0,resolve:void 0})}fetchUrlData(){const e={data:[],status:s.FetchStatus.Complete};if(!this.state.searchFor||this.state.mode!=g.Extensions)return e;const t=pxt.Cloud.parseScriptId(this.state.searchFor);if(!t)return e;const n=this.getDataWithStatus(`cloud-search:${t}`);return(!n.data||n.data&&404===n.data.statusCode)&&(n.data=[]),Array.isArray(n.data)||(n.data=[n.data]),n}fetchGhData(){var e,t;const n={data:[],status:s.FetchStatus.Complete};if(this.state.mode!=g.Extensions)return n;const i=pxt.appTarget.cloud||{};if(!i.packages)return n;let r=i.githubPackages?this.state.searchFor:void 0;if(!r){const n=this.getDataWithStatus("target-config:"),i=n.data;if(n.status===s.FetchStatus.Complete&&(null===(e=null==i?void 0:i.packages)||void 0===e?void 0:e.approvedRepoLib)){const e=null===(t=null==i?void 0:i.packages)||void 0===t?void 0:t.approvedRepoLib,n=e&&Object.keys(e).filter((t=>!!e[t].preferred));n&&(r=n.join("|"))}}if(!r)return n;const o=this.getDataWithStatus(`gh-search:${r}`);return o.data&&404!==o.data.statusCode||(o.data=[]),o}fetchLocalRepositories(){if(this.state.mode!=g.Extensions)return[];let e=this.state.searchFor;const{header:t}=this.props.parent.state;let n=h.getHeaders();return/localdependencies=1/i.test(window.location.href)||(n=n.filter((e=>!!e.githubId))),t&&(n=n.filter((e=>e.id!=t.id))),e&&(e=e.toLocaleLowerCase(),n=n.filter((t=>t.name.toLocaleLowerCase().indexOf(e)>-1))),n}fetchBundled(){if(this.state.mode!=g.Boards&&this.state.mode!=g.Extensions)return[];const e=this.state.searchFor,t=pxt.appTarget.bundledpkgs,n=this.state.mode==g.Boards,i=this.state.features;return Object.keys(t).filter((e=>!/prj$/.test(e))).map((e=>JSON.parse(t[e]["pxt.json"]))).filter((e=>!e.hidden)).filter((t=>!(!e&&t.searchOnly))).filter((t=>!e||t.name.toLowerCase().indexOf(e.toLowerCase())>-1)).filter((e=>n||!l.mainPkg.deps[e.name]||l.mainPkg.deps[e.name].cppOnly)).filter((e=>!/---/.test(e.name))).filter((e=>n==!!e.core)).filter((e=>!i||i.every((t=>e.features&&e.features.indexOf(t)>-1))))}fetchExperiments(){return this.state.mode!=g.Experiments?[]:f.experiments.all()}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.mode!=t.mode}componentDidUpdate(){let e=o.findDOMNode(this.refs.searchInput);e&&e.focus()}handleSearch(e){const t=/^\/@(.*)$/.exec(e);let n=t&&t[1];if(n)if("devtools"===n&&pxt.BrowserUtils.isPxtElectron())d.openDevTools(),this.hide(),this.afterHide();else{let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),n=n.replace(/^\//,""),window.location.href=e+n}else this.setState({searchFor:e})}addUrl(e){return this.hide(null,this.backOnHide()),l.mainEditorPkg().setDependencyAsync(e.name,"pub:"+e.id).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>this.afterHide()))}addBundle(e){pxt.tickEvent("packages.bundled",{name:e.name}),this.hide(null,this.backOnHide()),this.addDepIfNoConflict(e,"*").finally((()=>this.afterHide()))}addLocal(e){pxt.tickEvent("packages.local"),this.hide(null,this.backOnHide()),h.getTextAsync(e.id).then((t=>{let n=JSON.parse(t[pxt.CONFIG_NAME]);return this.addDepIfNoConflict(n,"workspace:"+e.id)})).finally((()=>this.afterHide()))}async installGh(e){const t=pxt.github.parseRepoId(e.fullName);let n;pxt.tickEvent("packages.github",{name:e.fullName,slug:e.slug.toLowerCase(),tag:e.tag,fileName:t.fileName}),this.hide(null,this.backOnHide());try{c.showLoading("downloadingpackage",lf("downloading extension...")),n=await pxt.github.downloadLatestPackageAsync(e,!0)}catch(e){c.handleNetworkError(e)}finally{c.hideLoading("downloadingpackage")}return await this.addDepIfNoConflict(n.config,n.version)}async addDepIfNoConflict(e,t){try{this.hide(null,this.backOnHide()),c.showLoading("installingextension",lf("Adding extension...")),await l.mainEditorPkg().addDependencyAsync(e,t,this.state.mode==g.Boards)&&this.props.parent.reloadHeaderAsync()}finally{c.hideLoading("installingextension"),this.afterHide()}}toggleExperiment(e){f.experiments.toggle(e),pxt.tickEvent("experiments.toggle",{experiment:e.id,enabled:f.experiments.isEnabled(e)?1:0},{interactiveConsent:!0}),this.forceUpdate()}importExtensionFile(){pxt.tickEvent("extensions.import",void 0,{interactiveConsent:!0}),this.hide(null,this.backOnHide()),this.props.parent.showImportFileDialog({extension:!0})}backOnHide(){return this.props.parent.isPxtJsonEditor()}renderCore(){const{mode:e,closeIcon:t,visible:n,searchFor:i,experimentsState:o,defaultSearch:l}=this.state;if(!n)return(0,r.jsx)("div",{});const c=this.fetchBundled(),d=this.fetchGhData(),h=this.fetchUrlData(),m=this.fetchLocalRepositories(),b=this.fetchExperiments(),v=i&&(d.status===s.FetchStatus.Pending||h.status===s.FetchStatus.Pending),_=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),E=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),T=e==g.Extensions&&pxt.appTarget.appTheme.importExtensionFiles&&!_&&!E&&!i,x=window.location.href.replace(/\/(#|$|\?)/,"/beta$1"),w=e==g.Experiments&&x!=window.location.href;c.sort(((e,t)=>{if(e.core!=t.core)return e.core?-1:1;const n=pxt.isPkgBeta(e);if(n!=pxt.isPkgBeta(t))return n?1:-1;const i=void 0===e.weight?50:e.weight,r=void 0===t.weight?50:t.weight;return i!=r?-i+r:pxt.Util.strcmp(e.name,t.name)}));const k=e==g.Boards?lf("Boards"):e==g.Experiments?lf("Experiments"):lf("Extensions"),S=e==g.Boards?lf("Change development board"):e==g.Experiments?lf("Turn on and off experimental features"):lf("Add an extension to the project"),C=e==g.Boards?"/boards":e==g.Experiments?"/experiments":"/extensions",A=e==g.Experiments&&o!=f.experiments.state(),I=this.props.parent.createModalClasses("searchdialog"),O=e=>e.name.replace(/^pxt-/,""),N=lf("Search or enter project URL...");return(0,r.jsxs)(a.Modal,Object.assign({isOpen:n,dimmer:!0,className:I,size:"fullscreen",onClose:this.hide,closeIcon:t,header:k,helpUrl:C,closeOnDimmerClick:!0,closeOnEscape:!0,description:S},{children:[(0,r.jsxs)("div",Object.assign({className:"ui"},{children:[e==g.Experiments?(0,r.jsxs)("div",Object.assign({className:"ui message info"},{children:[(0,r.jsx)("div",Object.assign({className:"header"},{children:lf("WARNING: EXPERIMENTAL FEATURES AHEAD!")})),lf("Try out these features and tell us what you think!")]})):void 0,e==g.Extensions?(0,r.jsx)(p.SearchInput,{defaultValue:l,ariaMessage:lf("{0} result matching '{1}'",c.length+d.data.length+h.data.length,i),placeholder:N,"aria-label":N,searchHandler:this.handleSearch,inputClassName:"fluid",autoFocus:!0,disabled:v},"search"):void 0,v?(0,r.jsx)("div",{className:"ui medium active centered inline loader"}):(0,r.jsxs)("div",Object.assign({className:"ui cards centered","aria-label":lf("Extension search results")},{children:[h.data.map((e=>(0,r.jsx)(y,{name:e.name,description:e.description,url:"/"+e.id,scr:e,onCardClick:this.addUrl,role:"button"},"url"+e.id))),m.map((e=>(0,r.jsx)(y,{name:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),url:"https://github.com/"+e.githubId,imageUrl:e.icon,scr:e,onCardClick:this.addLocal,label:lf("Local"),title:lf("Local GitHub extension"),labelClass:"blue right ribbon",role:"button"},"local"+e.id))),c.map((e=>(0,r.jsx)(y,{name:e.name,description:e.description,imageUrl:e.icon,scr:e,onCardClick:this.addBundle,label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button"},"bundled"+e.name))),d.data.filter((e=>e.status==pxt.github.GitRepoStatus.Approved)).map((e=>(0,r.jsx)(y,{name:O(e),description:e.description,scr:e,onCardClick:this.installGh,url:"github:"+e.fullName,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button",learnMoreUrl:`/pkg/${e.fullName}`},"gha"+e.fullName))),d.data.filter((e=>e.status!=pxt.github.GitRepoStatus.Approved)).map((e=>(0,r.jsx)(y,{name:O(e),description:e.description||"",extracontent:lf("User-provided extension, not endorsed by Microsoft."),scr:e,onCardClick:this.installGh,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,url:"github:"+e.fullName,role:"button",learnMoreUrl:`/pkg/${e.fullName}`},"ghd"+e.fullName))),b.map((e=>(0,r.jsx)(y,{name:e.name,scr:e,imageUrl:`/static/experiments/${e.id.toLowerCase()}.png`,description:e.description,role:"button",label:f.experiments.isEnabled(e)?lf("Enabled"):lf("Disabled"),labelClass:f.experiments.isEnabled(e)?"green right ribbon":"grey right ribbon",onCardClick:this.toggleExperiment,feedbackUrl:e.feedbackUrl},"exp"+e.id))),T&&(0,r.jsx)(u.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",icon:"upload ui cardimage",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importExtensionFile},"import"),w&&(0,r.jsx)(u.CodeCardView,{ariaLabel:lf("Open the next version of the editor"),role:"button",className:"beta",icon:"lab ui cardimage",iconColor:"secondary",name:lf("Beta Editor"),label:lf("Beta"),labelClass:"red right ribbon",description:lf("Open the next version of the editor"),url:x},"beta")]})),i&&!v&&c.length+d.data.length+h.data.length===0?(0,r.jsx)("div",Object.assign({className:"ui items"},{children:(0,r.jsx)("div",Object.assign({className:"ui item"},{children:lf("We couldn't find any extensions matching '{0}'",i)}))})):void 0]})),A?(0,r.jsxs)("div",Object.assign({className:"ui warning message"},{children:[(0,r.jsx)("div",Object.assign({className:"header"},{children:lf("Experiments changed")})),lf("The editor will reload when leaving this page.")]})):void 0]}))}}n.ScriptSearch=b;class y extends a.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{scr:e,onCardClick:t}=this.props;t(e)}renderCore(){const e=this.props,{onCardClick:t,onClick:n,scr:o}=e,s=i(e,["onCardClick","onClick","scr"]);return(0,r.jsx)(u.CodeCardView,Object.assign({},s,{onClick:this.handleClick}))}}},{"../../pxteditor":134,"./codecard":203,"./components/searchInput":264,"./core":279,"./data":282,"./electron":292,"./package":325,"./sui":346,"./workspace":354,"react-dom":491,"react/jsx-runtime":549}],332:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResourceImporter=n.StartPauseButton=n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("smoothie"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./data"),c=e("../../react-common/components/controls/EditorToggle");var u=pxt.Util;const d=e("./util"),h=e("../../react-common/components/util");class p extends s.Editor{constructor(e){super(e),this.parent=e,this.savedMessageQueue=[],this.maxSavedMessages=1e3,this.charts=[],this.chartIdx=0,this.sourceMap={},this.serialInputDataBuffer="",this.maxSerialInputDataLength=255,this.isSim=!0,this.isCsvView=void 0,this.maxConsoleEntries=500,this.active=!0,this.rawDataBuffer="",this.maxBufferLength=1e5,this.csvHeaders=[],this.highContrast=!1,this.rawCsvBuf="",this.nextEntryIsOdd=!0,this.goToLatest=()=>{var e,t,n;const i=null===(e=this.csvRoot)||void 0===e?void 0:e.lastChild;i&&(null===(n=(t=i.lastChild.lastChild||i.firstChild.lastChild).scrollIntoView)||void 0===n||n.call(t),pxt.BrowserUtils.addClass(this.serialRoot,"hide-view-latest"))},this.handleStartPauseRef=e=>{this.startPauseButton=e},this.handleChartRootRef=e=>{this.chartRoot=e},this.handleConsoleRootRef=e=>{this.consoleRoot=e},this.handleCsvRootRef=e=>{this.csvRoot=e},this.handleSerialRootRef=e=>{this.serialRoot=e},this.toggleOptions=()=>[{label:lf("Console"),title:lf("Console"),focusable:!0,icon:"fas fa-terminal",onClick:()=>{this.setCsv(!1),this.parent.forceUpdate()},view:"console"},{label:lf("Data Log"),title:lf("Data Log"),focusable:!0,icon:"fas fa-table",onClick:()=>{this.setCsv(!0),this.parent.forceUpdate()},view:"datalog"}],this.getToggle=()=>{const e=this.toggleOptions();return(0,i.jsx)(c.EditorToggle,{id:"serial-editor-toggle",className:"slim tablet-compact",items:e,selected:e.findIndex((e=>e.view===(this.isCsvView?"datalog":"console")))})},this.shouldShowToggle=()=>this.receivedCsv&&this.receivedLog&&this.isSim,window.addEventListener("message",this.processEvent.bind(this),!1);const t=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme;this.lineColors=t&&t.lineColors||["#e00","#00e","#0e0"],this.hcLineColors=["#000"],this.currentLineColors=this.lineColors,this.goBack=this.goBack.bind(this),this.toggleRecording=this.toggleRecording.bind(this),this.downloadRaw=this.downloadRaw.bind(this),this.downloadRawText=this.downloadRawText.bind(this),this.downloadConsoleCSV=this.downloadConsoleCSV.bind(this),this.setCsv=this.setCsv.bind(this)}getId(){return"serialEditor"}hasHistory(){return!1}hasEditorToolbar(){return!1}setVisible(e){const t=o.getHighContrastOnce();t!==this.highContrast&&this.setHighContrast(t),this.isVisible=e,!this.isSim||!this.receivedCsv||void 0!==this.isCsvView&&this.receivedLog?!this.isCsvView||this.receivedCsv&&this.isSim||(this.setCsv(!1),this.parent.forceUpdate()):(this.setCsv(!this.receivedLog),this.parent.forceUpdate()),this.isCsvView?pxt.BrowserUtils.addClass(this.serialRoot,"csv-view"):pxt.BrowserUtils.removeClass(this.serialRoot,"csv-view"),this.isVisible?(this.processQueuedMessages(),this.startRecording()):(this.pauseRecording(),this.clear())}setHighContrast(e){e!==this.highContrast&&(this.highContrast=e,this.currentLineColors=e?this.hcLineColors:this.lineColors,this.clear())}acceptsFile(e){return e.name===pxt.SERIAL_EDITOR_FILE}setSim(e){this.isSim!=e&&(this.isSim=e,this.clear())}setCsv(e){this.isCsvView!=e&&(this.isCsvView=!!e,this.serialRoot&&(this.isCsvView?pxt.BrowserUtils.addClass(this.serialRoot,"csv-view"):pxt.BrowserUtils.removeClass(this.serialRoot,"csv-view")))}simStateChanged(){this.charts.forEach((e=>e.setRealtimeData(this.wantRealtimeData())))}wantRealtimeData(){return!this.isSim||this.parent.isSimulatorRunning()}saveMessageForLater(e){this.savedMessageQueue.push(e),this.savedMessageQueue.length>this.maxSavedMessages&&this.savedMessageQueue.shift()}processQueuedMessages(){this.savedMessageQueue.forEach((e=>this.processMessage(e))),this.savedMessageQueue=[]}processEvent(e){let t=e.data;"serial"===t.type?this.processEventCore(t):"bulkserial"===t.type&&t.data.forEach((e=>{this.processEventCore({type:"serial",data:e.data,receivedTime:e.time,sim:t.sim,id:t.id})}))}processEventCore(e){"clear"===e.csvType&&this.isCsvView?this.clear():(e.receivedTime=e.receivedTime||u.now(),e.csvType?this.receivedCsv=!0:this.receivedLog=!0,this.isVisible&&(this.isCsvView&&!this.receivedCsv?this.setCsv(!1):this.isCsvView||this.receivedLog||this.setCsv(!0)),this.active?this.processMessage(e):this.saveMessageForLater(e))}mapSource(e){if(!this.sourceMap[e]){const t=Object.keys(this.sourceMap).length+1;this.sourceMap[e]=lf("source")+t.toString()}return this.sourceMap[e]}processMessage(e){const t=!!e.sim,n=!!e.csvType;if(t!=this.isSim)return;const i=e.data||"",r=e.id||"?",o=e.receivedTime||u.now(),s=this.mapSource(r);if(this.shouldShowToggle()&&pxt.BrowserUtils.removeClass(this.serialRoot,"no-toggle"),n)this.appendRawCsvData(i),"headers"===e.csvType?this.processCsvHeaders(i,o):"row"===e.csvType&&this.processCsvRows(i,o);else{this.appendRawData(i);const e=this.chunkDataIntoLines(i);for(const t of e)this.processMessageLine(t,s,o)}}createTable(){const e=document.createElement("table");return e.appendChild(document.createElement("thead")),e.appendChild(document.createElement("tbody")),this.csvRoot.appendChild(e),this.nextEntryIsOdd=!0,e}processCsvHeaders(e,t){const n=this.createTable(),i=document.createElement("tr");i.title=lf("Received: {0}",new Date(t).toTimeString());for(const t of e.trim().split(",")){const e=document.createElement("th");e.appendChild(document.createTextNode(t)),i.appendChild(e)}this.addCsvRow(i,n.firstChild)}processCsvRows(e,t){let n=this.csvRoot.lastChild||this.createTable();const i=document.createElement("tr");i.title=lf("Received: {0}",new Date(t).toTimeString()),this.nextEntryIsOdd&&i.classList.add("odd"),this.nextEntryIsOdd=!this.nextEntryIsOdd;for(const t of e.trim().split(",")){const e=document.createElement("td");e.appendChild(document.createTextNode(t)),i.appendChild(e)}this.addCsvRow(i,n.lastChild)}addCsvRow(e,t){const n=t.getBoundingClientRect().bottom<=window.innerHeight;t.appendChild(e),this.checkCsvLineCount(),n?e.scrollIntoView():pxt.BrowserUtils.removeClass(this.serialRoot,"hide-view-latest")}checkCsvLineCount(){for(this.csvLineCount++;this.csvLineCount>this.maxConsoleEntries;){const e=this.csvRoot.firstChild,t=e.firstChild,n=e.lastChild;n.hasChildNodes()?(n.firstChild.remove(),this.csvLineCount--):n.hasChildNodes()&&(t.firstChild.remove(),this.csvLineCount--),n.hasChildNodes()||t.hasChildNodes()||e.remove()}}processMessageLine(e,t,n){if(/^\s*\{[^}]+\}\s*$/.test(e))try{const t=JSON.parse(e),i=parseInt(t.t),r=this.mapSource(t.s),o=t.n||"",s=parseFloat(t.v);isNaN(i)||isNaN(s)||this.appendGraphEntry(r,o,s,n)}catch(e){}else if(/^\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)(\s*,\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?))+\s*,?\s*$/.test(e))e.split(/\s*,\s*/).map((e=>parseFloat(e))).filter((e=>!isNaN(e))).forEach(((e,i)=>{const r="data."+(this.csvHeaders[i]||i);this.appendGraphEntry(t,r,e,n)}));else if(/^\s*[\s\w]+(\s*,\s*[\w\s]+)+\s*,?\s*$/.test(e))this.csvHeaders=e.split(/\s*,\s*/).map((e=>e.trim()));else{const i=/^\s*(([^:]+):)?\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)/i.exec(e);if(i){const e=i[2]||"",r=parseFloat(i[3]);isNaN(r)||this.appendGraphEntry(t,e,r,n)}}this.appendConsoleEntry(e)}appendRawData(e){this.rawDataBuffer+=e,this.rawDataBuffer.length>this.maxBufferLength&&this.rawDataBuffer.slice(this.rawDataBuffer.length/4)}appendRawCsvData(e){this.rawCsvBuf+=e,this.rawCsvBuf.length>this.maxBufferLength&&this.rawCsvBuf.slice(this.rawCsvBuf.length/4)}appendGraphEntry(e,t,n,i){let r=this.charts.find((n=>n.shouldContain(e,t)));r||((r=new m(e,t,this.chartIdx,this.currentLineColors)).setRealtimeData(this.wantRealtimeData()),this.chartIdx++,this.charts.push(r),this.chartRoot.appendChild(r.getElement()),pxt.BrowserUtils.removeClass(this.chartRoot,"nochart"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"nochart"),1==this.charts.length&&this.parent.forceUpdate()),r.addPoint(t,n,i)}chunkDataIntoLines(e){let t=[];for(let n=0;n<e.length;++n){const i=e[n];this.serialInputDataBuffer+=i,"\n"!==i&&this.serialInputDataBuffer.length<this.maxSerialInputDataLength||("\n"===i?(this.serialInputDataBuffer=this.serialInputDataBuffer.replace(/\s+$/,""),this.serialInputDataBuffer.length&&t.push(this.serialInputDataBuffer)):t.push(this.serialInputDataBuffer),this.serialInputDataBuffer="")}return t}appendConsoleEntry(e){if(e.length>=this.maxSerialInputDataLength){let t=document.createElement("span");t.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)}else{let t=document.createElement("div");t.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)}for(this.consoleRoot.scrollTop=this.consoleRoot.scrollHeight;this.consoleRoot.childElementCount>this.maxConsoleEntries;)this.consoleRoot.removeChild(this.consoleRoot.firstChild);this.consoleRoot&&this.consoleRoot.childElementCount>0&&(this.chartRoot&&pxt.BrowserUtils.removeClass(this.chartRoot,"noconsole"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"noconsole"))}pauseRecording(){this.active=!1,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.stop()))}startRecording(){this.active=!0,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.start()))}toggleRecording(){pxt.tickEvent("serial.toggleRecording",void 0,{interactiveConsent:!0}),this.active?this.pauseRecording():this.startRecording()}clearNode(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}clear(){this.chartRoot&&(this.clearNode(this.chartRoot),pxt.BrowserUtils.addClass(this.chartRoot,"noconsole"),pxt.BrowserUtils.addClass(this.chartRoot,"nochart")),this.consoleRoot&&(this.clearNode(this.consoleRoot),pxt.BrowserUtils.addClass(this.consoleRoot,"noconsole"),pxt.BrowserUtils.addClass(this.consoleRoot,"nochart")),this.isSim||this.setCsv(!1),this.charts=[],this.serialInputDataBuffer="",this.rawDataBuffer="",this.rawCsvBuf="",this.savedMessageQueue=[],this.sourceMap={},this.csvHeaders=[],this.savedMessageQueue=[],this.csvRoot&&this.clearNode(this.csvRoot),this.csvLineCount=0,pxt.BrowserUtils.addClass(this.serialRoot,"hide-view-latest"),this.isVisible||(this.receivedCsv=!1,this.receivedLog=!1,this.serialRoot&&pxt.BrowserUtils.addClass(this.serialRoot,"no-toggle"))}dataIsCsv(e,t){if(t.length<2)return!1;for(let n=0;n<t.length;++n)if(t[n].length!=e)return!1;for(let n=0;n<e;++n){let e=t[0][n][0];for(let i=1;i<t.length;++i)if(t[i][n][0]!=e)return!1}return!0}downloadConsoleCSV(){if(this.isCsvView)return void this.downloadRaw(this.rawCsvBuf,"csv","text/csv");const e=lf("{id:csvseparator}\t");let t=[];if(!this.charts.length||!this.charts.some((e=>Object.keys(e.datas).length>0)))return void o.confirmAsync({header:lf("No data to export"),hideAgree:!0,disagreeLbl:lf("Ok"),body:lf("You must generate some serial data before you can export it.")});this.charts.forEach((n=>{const i=[];Object.keys(n.datas).forEach((e=>i.push({name:e,line:n.datas[e]})));const r=i.map((e=>e.line)),o=r.length>0?r.map((e=>e.length)).reduce(((e,t)=>Math.max(e,t))):0;if(this.dataIsCsv(o,r)){let s=`time (${n.source})${e}`+i.map((e=>e.name)).join(e)+e;t[0]=t[0]?t[0]+e+s:s;for(let n=0;n<o;++n){const i=(r[0][n][0]-r[0][0][0])/1e3+e+r.map((e=>e[n][1])).join(e)+e;t[n+1]=t[n+1]?t[n+1]+e+i:i}}else{let s=i.map((t=>`time (${n.source})${e}${t.name}`)).join(e);t[0]=t[0]?t[0]+e+s:s;for(let n=0;n<o;++n){const i=r.map((t=>n<t.length?`${(t[n][0]-t[0][0])/1e3}${e}${t[n][1]}`:e)).join(e);t[n+1]=t[n+1]?t[n+1]+e+i:i}}})),t.unshift(`sep=${e}`);const n=t.join("\r\n");o.infoNotification(lf("Exporting data...."));const i=f();pxt.commands.browserDownloadAsync(u.toUTF8(n),pxt.appTarget.id+"-"+lf("{id:csvfilename}data")+"-"+i+".csv","text/csv")}downloadRaw(e,t="txt",n="text/plain"){o.infoNotification(lf("Exporting text...."));const i=f();pxt.BrowserUtils.isWindows()&&(e=e.replace(/([^\r])\n/g,"$1\r\n")),pxt.commands.browserDownloadAsync(u.toUTF8(e),pxt.appTarget.id+"-"+lf("{id:csvfilename}console")+"-"+i+`.${t}`,n)}downloadRawText(){this.downloadRaw(this.rawDataBuffer)}goBack(){pxt.tickEvent("serial.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}display(){var e;const t=(0,h.classList)(!this.shouldShowToggle()&&"no-toggle",this.isCsvView&&"csv-view","hide-view-latest");return(0,i.jsxs)("div",Object.assign({id:"serialArea",className:t,ref:this.handleSerialRootRef},{children:[(0,i.jsxs)("div",Object.assign({id:"serialHeader",className:"ui serialHeader"},{children:[(0,i.jsx)("div",Object.assign({className:"leftHeaderWrapper"},{children:(0,i.jsxs)("div",Object.assign({className:"leftHeader"},{children:[(0,i.jsxs)(a.Button,Object.assign({title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:d.fireClickOnEnter},{children:[(0,i.jsx)(a.Icon,{icon:"arrow left"}),(0,i.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]})),this.getToggle()]}))})),(0,i.jsxs)("div",Object.assign({className:"rightHeader"},{children:[(0,i.jsx)(a.Button,Object.assign({title:lf("Save raw text"),className:"ui icon button editorExport csv-hide",ariaLabel:lf("Save raw text"),onClick:this.downloadRawText},{children:(0,i.jsx)(a.Icon,{icon:"copy"})})),(0,i.jsx)(a.Button,Object.assign({title:lf("Export data"),className:"ui icon blue button editorExport",ariaLabel:lf("Export data"),onClick:this.downloadConsoleCSV},{children:(0,i.jsx)(a.Icon,{icon:"download"})})),(0,i.jsx)(g,{ref:this.handleStartPauseRef,active:this.active,toggle:this.toggleRecording}),(0,i.jsx)("span",Object.assign({className:"ui small header"},{children:this.isSim?lf("Simulator"):lf("Device")}))]}))]})),0==(null===(e=this.charts)||void 0===e?void 0:e.length)&&(0,i.jsx)("div",Object.assign({id:"serialPlaceholder",className:"ui segment"},{children:(0,i.jsx)("div",Object.assign({className:"ui bottom left attached no-select label seriallabel"},{children:lf("Values will be logged when the {0} sends data",this.isSim?lf("simulator"):lf("device"))}))})),(0,i.jsx)("div",{id:"serialCharts",ref:this.handleChartRootRef}),(0,i.jsx)("div",{id:"serialConsole",ref:this.handleConsoleRootRef}),(0,i.jsx)("div",{id:"serialCsv",ref:this.handleCsvRootRef}),(0,i.jsx)(a.Button,Object.assign({id:"serialCsvViewLatest",onClick:this.goToLatest},{children:lf("View latest row...")}))]}))}domUpdate(){}}function f(){return(new Date).toISOString().replace(/[^\d\w]/gi,"-")}n.Editor=p;class g extends l.PureComponent{constructor(e){super(e),this.state={active:this.props.active}}renderCore(){const{toggle:e}=this.props,{active:t}=this.state;return(0,i.jsx)(a.Button,Object.assign({title:t?lf("Pause recording"):lf("Start recording"),className:`ui left floated icon button ${t?"green":"red circular"} toggleRecord csv-hide`,onClick:e},{children:(0,i.jsx)(a.Icon,{icon:t?"pause icon":"circle icon"})}))}}n.StartPauseButton=g;class m{constructor(e,t,n,i){this.rootElement=document.createElement("div"),this.lines={},this.datas={};const o=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme,s={interpolation:"bezier",labels:{disabled:!1,fillStyle:"black",fontSize:14},responsive:!0,millisPerPixel:20,grid:{verticalSections:0,borderVisible:!1,millisPerLine:5e3,fillStyle:o&&o.gridFillStyle||"transparent",strokeStyle:o&&o.gridStrokeStyle||"#fff"},tooltip:!0,tooltipFormatter:(e,t)=>this.tooltip(e,t)};this.lineColors=i,this.chartIdx=n,this.chart=new r.SmoothieChart(s),this.rootElement.className="ui segment",this.source=e,this.variable=t.replace(/\..*$/,""),this.rootElement.appendChild(this.makeLabel()),this.rootElement.appendChild(this.makeCanvas())}tooltip(e,t){return t.map((e=>{const t=e.series.timeSeries.__name;return`<span>${t?t+": ":""}${e.value}</span>`})).join("<br/>")}getLine(e){let t=this.lines[e];if(!t){const n=this.lineColors[this.chartIdx++%this.lineColors.length];this.lines[e]=t=new r.TimeSeries,t.__name=u.htmlEscape(e.substring(this.variable.length+1)),this.chart.addTimeSeries(t,{strokeStyle:n,lineWidth:3}),this.datas[e]=[]}return t}makeLabel(){return this.label=document.createElement("div"),this.label.className="ui orange bottom left attached no-select label seriallabel",this.label.innerText=this.variable||"...",this.label}makeCanvas(){let e=document.createElement("canvas");return this.chart.streamTo(e),this.canvas=e,e}getCanvas(){return this.canvas}getElement(){return this.rootElement}shouldContain(e,t){return this.source==e&&this.variable==t.replace(/\..*$/,"")}addPoint(e,t,n){if(this.getLine(e).append(n,t),1==Object.keys(this.lines).length){const e=pxsim.Math_.roundWithPrecision(t,2).toString();this.label.innerText=this.variable?`${this.variable}: ${e}`:e}else this.label.innerText=this.variable||"";const i=this.datas[e];i.push([n,t]),i.length>4e3&&i.splice(0,i.length/4)}start(){this.chart.start()}stop(){this.chart.stop()}setRealtimeData(e){this.chart.options.nonRealtimeData=!e}}n.ResourceImporter=class{canImport(e){return"text/plain"==e.type}importAsync(e,t){return ts.pxtc.Util.fileReadAsTextAsync(t).then((e=>{if(!e)return void o.errorNotification(lf("Ooops, could not read file"));const n=e.split(/\n/g).map((e=>{const n=/^\s*(\d+)>/.exec(e);return n&&(e=e.substr(n[0].length)),{type:"serial",data:e+"\n",id:t.name,receivedTime:n?parseFloat(n[1]):void 0}}));if(!n.length)return;const i=u.now(),r=n.filter((e=>!!e.receivedTime));if(r.length){const e=r[r.length-1].receivedTime||0;r.forEach((t=>t.receivedTime+=i-e))}n.forEach((e=>window.postMessage(e,"*")))}))}}},{"../../react-common/components/controls/EditorToggle":151,"../../react-common/components/util":187,"./core":279,"./data":282,"./srceditor":345,"./sui":346,"./util":352,"react/jsx-runtime":549,smoothie:607}],333:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SerialIndicator=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./util");class s extends r.Component{constructor(e){super(e),this.state={active:!1}}componentDidMount(){window.addEventListener("message",this.setActive.bind(this))}componentWillUnmount(){window.addEventListener("message",this.setActive.bind(this))}setActive(e){let t=e.data;if(!this.state.active&&("serial"===t.type||"bulkserial"===t.type)&&!!t.sim===this.props.isSim){this.setState({active:!0});const e=this.props.parent;this.props.isSim?e.setState({simSerialActive:!0}):e.setState({deviceSerialActive:!0})}}active(){return!!this.state.active}clear(){this.setState({active:!1})}renderCore(){if(!this.active())return(0,i.jsx)("div",{});const e=this.props.isSim?lf("Simulator"):lf("Device");return(0,i.jsxs)("div",Object.assign({role:"button",title:lf("Open {0} data",e),className:"ui label circular",tabIndex:0,onClick:this.props.onClick,onKeyDown:o.fireClickOnEnter},{children:[(0,i.jsx)("div",Object.assign({className:"detail"},{children:(0,i.jsx)("img",{alt:lf("Animated bar chart"),className:"barcharticon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/Bars_black.gif")})})),(0,i.jsx)("span",{children:lf("Show data")}),(0,i.jsx)("div",Object.assign({className:"detail"},{children:e}))]}))}}n.SerialIndicator=s},{"./data":282,"./util":352,"react/jsx-runtime":549}],334:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ShareEditor=n.ShareMode=void 0;const i=e("react/jsx-runtime"),r=e("./auth"),o=e("./screenshot"),s=e("../../react-common/components/controls/Modal"),a=e("../../react-common/components/share/Share"),l=e("./components/SimRecorder");var c,u;(u=c=n.ShareMode||(n.ShareMode={}))[u.Code=0]="Code",u[u.Url=1]="Url",u[u.Editor=2]="Editor",u[u.Simulator=3]="Simulator";class d extends r.Component{constructor(e){super(e),this.state={pubId:void 0,visible:!1,screenshotUri:void 0,recordError:void 0,title:void 0},this.hide=this.hide.bind(this),this.setAdvancedMode=this.setAdvancedMode.bind(this),this.handleProjectNameChange=this.handleProjectNameChange.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.handleCreateGitHubRepository=this.handleCreateGitHubRepository.bind(this)}hide(){if(this.state.qrCodeExpanded){pxt.tickEvent("share.qrtoggle");const{qrCodeExpanded:e}=this.state;this.setState({qrCodeExpanded:!e})}else this.setState({visible:!1,screenshotUri:void 0,projectName:void 0,projectNameChanged:!1,recordError:void 0,qrCodeUri:void 0,title:void 0})}show(e,t="share"){const{header:n}=this.props.parent.state;if(!n)return;const i=pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails&&(pxt.appTarget.appTheme.simScreenshot||pxt.appTarget.appTheme.simGif);i&&this.renderInitialScreenshotAsync(),this.setState({thumbnails:i,visible:!0,mode:c.Code,pubId:void 0,sharingError:void 0,screenshotUri:void 0,qrCodeUri:void 0,qrCodeExpanded:!1,title:e,projectName:n.name,kind:t},i?()=>this.props.parent.startSimulator():void 0)}setThumbnailFrames(e){this.autoThumbnailFrames=e}UNSAFE_componentWillReceiveProps(e){const t={};this.state.projectNameChanged||e.parent.state.projectName==this.state.projectName||(t.projectName=e.parent.state.projectName),e.loading!=this.state.loading&&(t.loading=e.loading),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,n){return this.state.visible!=t.visible||this.state.mode!=t.mode||this.state.pubId!=t.pubId||this.state.sharingError!==t.sharingError||this.state.projectName!=t.projectName||this.state.projectNameChanged!=t.projectNameChanged||this.state.loading!=t.loading||this.state.screenshotUri!=t.screenshotUri||this.state.qrCodeUri!=t.qrCodeUri||this.state.qrCodeExpanded!=t.qrCodeExpanded||this.state.title!=t.title||this.state.kind!=t.kind}setAdvancedMode(e){this.setState({mode:e})}handleProjectNameChange(e){this.setState({projectName:e,projectNameChanged:!0})}restartSimulator(){pxt.tickEvent("share.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}handleCreateGitHubRepository(){pxt.tickEvent("share.github.create",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.createGitHubRepositoryAsync()}async renderInitialScreenshotAsync(){let e;if(this.autoThumbnailFrames){const t=await o.loadGifEncoderAsync();t.start();for(const e of this.autoThumbnailFrames)t.addFrame(e);e=await t.renderAsync()}else e=await this.props.parent.requestScreenshotAsync();e?this.setState({screenshotUri:e}):setTimeout((()=>{this.renderInitialScreenshotAsync()}),500)}renderCore(){const{parent:e}=this.props,{visible:t,projectName:n,title:o,screenshotUri:c}=this.state,{simScreenshot:u,simGif:d}=pxt.appTarget.appTheme,h=r.hasIdentity()&&this.isLoggedIn(),p=u||d,f=e.hasHeaderBeenPersistentShared();return t?(0,i.jsx)(s.Modal,Object.assign({title:lf("Share Project"),className:"sharedialog"+(p?" wide":""),parentElement:document.getElementById("root")||void 0,onClose:this.hide},{children:(0,i.jsx)(a.Share,{projectName:n,screenshotUri:c,isLoggedIn:h,publishAsync:async(t,n,i)=>e.publishAsync(t,n,i),hasProjectBeenPersistentShared:f,simRecorder:l.SimRecorderImpl,anonymousShareByDefault:e.getSharePreferenceForHeader(),setAnonymousSharePreference:t=>e.saveSharePreferenceForHeaderAsync(t),isMultiplayerGame:this.props.parent.state.isMultiplayerGame,kind:this.state.kind,onClose:this.hide})})):(0,i.jsx)(i.Fragment,{})}}n.ShareEditor=d},{"../../react-common/components/controls/Modal":159,"../../react-common/components/share/Share":183,"./auth":194,"./components/SimRecorder":231,"./screenshot":329,"react/jsx-runtime":549}],335:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SidebarTutorialCard=n.SidebarTutorialHint=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./marked"),s=e("./tutorial"),a=e("./util");class l extends s.TutorialHint{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialReady:n,tutorialStepInfo:s,tutorialStep:l,tutorialStepExpanded:c,metadata:u}=e,d=s[l],h=d.hintContentMd,p=d.showDialog,f=d.contentMd,g=this.props.parent.createModalClasses("hintdialog");let m=l<s.length-1?this.next:this.closeHint;const b=[{label:lf("Start"),onclick:m,className:"green"}];return(0,i.jsxs)("div",Object.assign({id:"callout",className:"callout-container"},{children:[(0,i.jsx)(r.Button,{className:"callout-hint ui circular label blue hintbutton",icon:"lightbulb outline",tabIndex:-1,onKeyDown:a.fireClickOnEnter}),p?(0,i.jsx)(r.Modal,Object.assign({isOpen:!0,className:g,closeIcon:!1,header:t,buttons:b,onClose:m,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsx)(o.MarkedContent,{markdown:f,parent:this.props.parent})})):(0,i.jsxs)("div",Object.assign({className:"callout-wrapper"},{children:[(0,i.jsx)("div",Object.assign({className:"callout-hint-header"},{children:"Hint:"})),(0,i.jsx)("div",Object.assign({className:"callout-hint-text"},{children:(0,i.jsx)(o.MarkedContent,{markdown:h,unboxSnippets:!0,parent:this.props.parent})}))]}))]}))}}n.SidebarTutorialHint=l;class c extends s.TutorialCard{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialStepInfo:n,tutorialStep:r}=e,s=n[r],c=!!n[r].hintContentMd||n[r].showDialog,u=s.headerContentMd,d=s.showDialog;let h="",p="";return c&&(h+=lf("Press Space or Enter to show a hint."),lf("Click to show a hint!")),(0,i.jsxs)("div",Object.assign({id:"sidebar"},{children:[(0,i.jsx)("div",Object.assign({className:"tutorialTitle"},{children:(0,i.jsx)("p",{children:t})})),(0,i.jsx)("div",Object.assign({ref:"tutorialmessage",className:"tutorialMessage",role:"alert","aria-label":h,tabIndex:c?0:-1,onKeyDown:c?a.fireClickOnEnter:void 0},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:!d&&(0,i.jsx)(o.MarkedContent,{className:"no-select",markdown:u,parent:this.props.parent,onDidRender:this.onMarkdownDidRender})}))})),c&&(0,i.jsx)(l,{parent:this.props.parent})]}))}}n.SidebarTutorialCard=c},{"./marked":313,"./sui":346,"./tutorial":350,"./util":352,"react/jsx-runtime":549}],336:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Sidepanel=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./filelist"),s=e("./keymap"),a=e("./serialindicator"),l=e("./simtoolbar"),c=e("./simulator"),u=e("./sui"),d=e("./components/SimulatorPresenceBar"),h=e("./components/tutorial/TutorialContainer"),p=e("../../react-common/components/controls/VerticalResizeContainer");class f extends r.Component{constructor(e){var t;super(e),this.tryShowSimulator=()=>{var e,t;const n=(null===(e=this.props.tutorialOptions)||void 0===e?void 0:e.tutorial)&&!pxt.BrowserUtils.useOldTutorialLayout(),i=!(null===(t=pxt.appTarget.simulator)||void 0===t?void 0:t.headless);(!n||this.props.tutorialSimSidebar)&&i&&this.showSimulator()},this.showSimulator=()=>{this.props.showMiniSim(!1),c.driver.focus()},this.handleSimSerialClick=()=>{this.props.openSerial(!0)},this.handleDeviceSerialClick=()=>{this.props.openSerial(!1)},this.handleSimOverlayClick=()=>{const{tutorialOptions:e,handleFullscreenButtonClick:t}=this.props;!e||pxt.BrowserUtils.useOldTutorialLayout()?t():this.tryShowSimulator()},this.handleSimPanelRef=e=>{this.simPanelRef=e,e&&"undefined"!=typeof ResizeObserver&&new ResizeObserver((()=>{var t,n;e.scrollHeight>e.clientHeight?null===(t=this.simPanelRef)||void 0===t||t.classList.remove("invisibleScrollbar"):null===(n=this.simPanelRef)||void 0===n||n.classList.add("invisibleScrollbar")})).observe(e)},this.setComponentHeight=(e,t)=>{e==this.state.height&&t==this.state.resized||this.setState({resized:this.state.resized||t,height:e})},this.onHostMultiplayerGameClick=e=>{e.preventDefault(),pxt.tickEvent("sidepanel.hostmultiplayergame"),this.props.parent.showShareDialog(void 0,"multiplayer")},this.onOpenInVSCodeClick=e=>{e.preventDefault(),pxt.tickEvent("sidepanel.openinvscode"),this.props.parent.showShareDialog(void 0,"vscode")},this.onResizeDrag=e=>{this.setComponentHeight(e,!0)},this.onResizeEnd=e=>{pxt.tickEvent("tutorial.resizeInstructions",{newSize:e})},(null===(t=e.tutorialOptions)||void 0===t?void 0:t.tutorial)&&!e.tutorialSimSidebar&&this.props.showMiniSim(!0)}UNSAFE_componentWillReceiveProps(e){var t,n;!e.tutorialSimSidebar&&(!this.props.tutorialOptions&&e.tutorialOptions||this.props.inHome&&!e.inHome&&e.tutorialOptions||(null===(t=this.props.tutorialOptions)||void 0===t?void 0:t.tutorial)&&(null===(n=e.tutorialOptions)||void 0===n?void 0:n.tutorial)&&this.props.tutorialOptions.tutorial!==e.tutorialOptions.tutorial)?this.props.showMiniSim(!0):(!this.props.inHome&&e.inHome||this.props.tutorialOptions&&!e.tutorialOptions)&&this.showSimulator()}componentDidUpdate(e,t){(this.state.height||t.height)&&this.state.height!=t.height&&this.props.setEditorOffset()}renderCore(){var e,t,n,r,c;const{parent:f,inHome:g,showKeymap:m,showSerialButtons:b,showFileList:y,showFullscreenButton:v,showHostMultiplayerGameButton:_,collapseEditorTools:E,simSerialActive:T,deviceSerialActive:x,tutorialOptions:w,handleHardwareDebugClick:k,onTutorialStepChange:S,onTutorialComplete:C}=this.props,A=!(null===(e=pxt.appTarget.simulator)||void 0===e?void 0:e.headless),I=f.isJavaScriptActive()&&(null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.appTheme)||void 0===n?void 0:n.showOpenInVscode),O="simulator-container "+(this.props.tutorialSimSidebar?"":" hidden"),N="editor-sidebar tutorial-container-outer"+(this.props.tutorialSimSidebar?" topInstructions":""),R=pxt.BrowserUtils.isTabletSize()||this.props.tutorialSimSidebar,D=R?`${this.state.height}px`:void 0;return(0,i.jsxs)("div",Object.assign({id:"simulator",className:"simulator"},{children:[!A&&(0,i.jsx)("div",{id:"boardview",className:"headless-sim",role:"region","aria-label":lf("Simulator"),tabIndex:-1}),(0,i.jsx)("div",Object.assign({id:"editorSidebar",className:"editor-sidebar",style:this.props.tutorialSimSidebar?void 0:{height:D}},{children:(0,i.jsx)("div",Object.assign({className:O},{children:(0,i.jsxs)("div",Object.assign({className:"ui items simPanel "+(_?"multiplayer-preview":""),ref:this.handleSimPanelRef},{children:[(0,i.jsx)("div",{id:"boardview",className:"ui vertical editorFloat",role:"region","aria-label":lf("Simulator"),tabIndex:g?-1:0}),_&&(0,i.jsx)("div",Object.assign({className:"ui item grid centered portrait multiplayer-presence"},{children:(0,i.jsx)(d.SimulatorPresenceBar,{})})),(0,i.jsx)(l.SimulatorToolbar,{parent:f,collapsed:E,simSerialActive:T,devSerialActive:x,showSimulatorSidebar:this.tryShowSimulator}),m&&(0,i.jsx)(s.Keymap,{parent:f}),(0,i.jsx)("div",Object.assign({className:"ui item portrait hide hidefullscreen"},{children:pxt.options.debug&&(0,i.jsx)(u.Button,{className:"teal",icon:"xicon chip",text:"Dev Debug",onClick:k},"hwdebugbtn")})),(0,i.jsx)("div",Object.assign({className:"ui item grid centered portrait hide hidefullscreen"},{children:I&&(0,i.jsx)(u.Button,{className:"teal hostmultiplayergame-button",icon:"icon share",text:lf("Open in VS Code"),ariaLabel:lf("Open in Visual Studio Code for Web"),onClick:this.onOpenInVSCodeClick})})),(0,i.jsx)("div",Object.assign({className:"ui item grid centered portrait hide hidefullscreen"},{children:_&&(0,i.jsx)(u.Button,{className:"teal hostmultiplayergame-button",icon:"xicon multiplayer",text:lf("Host multiplayer game"),ariaLabel:lf("Host multiplayer game"),onClick:this.onHostMultiplayerGameClick})})),b&&(0,i.jsxs)("div",Object.assign({id:"serialPreview",className:"ui editorFloat portrait hide hidefullscreen"},{children:[(0,i.jsx)(a.SerialIndicator,{ref:"simIndicator",isSim:!0,onClick:this.handleSimSerialClick,parent:f}),(0,i.jsx)(a.SerialIndicator,{ref:"devIndicator",isSim:!1,onClick:this.handleDeviceSerialClick,parent:f})]})),y&&(0,i.jsx)(o.FileList,{parent:f}),v&&(0,i.jsx)("div",{id:"miniSimOverlay",role:"button",title:lf("Open in fullscreen"),onClick:this.handleSimOverlayClick})]}))}))})),w&&(0,i.jsx)("div",Object.assign({className:this.props.tutorialSimSidebar?"topInstructionsWrapper":""},{children:(0,i.jsx)(p.VerticalResizeContainer,Object.assign({id:"tutorialWrapper",className:N,maxHeight:"500px",minHeight:"100px",initialHeight:D,resizeEnabled:R,onResizeDrag:this.onResizeDrag,onResizeEnd:this.onResizeEnd},{children:(0,i.jsx)(h.TutorialContainer,{parent:f,tutorialId:w.tutorial,name:w.tutorialName,steps:w.tutorialStepInfo,currentStep:w.tutorialStep,tutorialOptions:w,hideIteration:null===(r=w.metadata)||void 0===r?void 0:r.hideIteration,hasTemplate:!!w.templateCode,preferredEditor:null===(c=w.metadata)||void 0===c?void 0:c.preferredEditor,tutorialSimSidebar:this.props.tutorialSimSidebar,hasBeenResized:this.state.resized&&R,onTutorialStepChange:S,onTutorialComplete:C,setParentHeight:e=>this.setComponentHeight(e,!1)})}))}))]}))}}n.Sidepanel=f},{"../../react-common/components/controls/VerticalResizeContainer":165,"./components/SimulatorPresenceBar":232,"./components/tutorial/TutorialContainer":272,"./data":282,"./filelist":297,"./keymap":310,"./serialindicator":333,"./simtoolbar":337,"./simulator":338,"./sui":346,"react/jsx-runtime":549}],337:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PlayButton=n.SimulatorToolbar=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.state={},pxt.BrowserUtils.isIOS()&&this.props.parent.setMute("disabled"),this.toggleMute=this.toggleMute.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.openInstructions=this.openInstructions.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.openDeviceSimulator=this.openDeviceSimulator.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.takeScreenshot=this.takeScreenshot.bind(this),this.toggleDebug=this.toggleDebug.bind(this)}openInstructions(){pxt.tickEvent("simulator.make",void 0,{interactiveConsent:!0}),this.props.parent.openInstructions()}startStopSimulator(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}restartSimulator(){pxt.tickEvent("simulator.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}toggleDebug(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleMute(){pxt.tickEvent("simulator.mute",{view:"computer",muteTo:""+!this.props.parent.state.mute},{interactiveConsent:!0}),this.props.parent.toggleMute()}toggleSimulatorFullscreen(){pxt.tickEvent("simulator.fullscreen",{view:"computer",fullScreenTo:""+!this.props.parent.state.fullscreen},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen()}toggleSimulatorCollapse(){pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}openDeviceSerial(){pxt.tickEvent("simulator.fullscreen.serial.simulator",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openDeviceSerial()}openDeviceSimulator(){pxt.tickEvent("simulator.fullscreen.serial.device",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openSimSerial()}takeScreenshot(){pxt.tickEvent("simulator.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.downloadScreenshotAsync()}renderCore(){const{collapsed:e,devSerialActive:t,parent:n,simSerialActive:r}=this.props,s=n.state;if(!s.currFile||s.home)return(0,i.jsx)("div",{});const c=pxt.appTarget.appTheme,u=pxt.appTarget.simulator,d=pxt.shell.isSandboxMode(),h=!d&&s.showParts&&c.instructions,p=s.simState,f=3==p,g=2==p,m=1==p,b=s.fullscreen,y=!!s.tutorialOptions&&!!s.tutorialOptions.tutorial,v=y&&!pxt.BrowserUtils.useOldTutorialLayout(),_=n.isBlocksActive()||n.isJavaScriptActive()||n.isPythonActive(),E=!u.hideRestart,T=c.debugger&&!y&&!pxt.BrowserUtils.isIE(),x=s.debugging,w=!u.hideFullscreen&&!d,k=c.hasAudio,S=u.headless,C=!!c.simScreenshot,A=s.screenshoting?"loading":"",I=!g&&!m&&_,O=!x&&!g&&!m,N=!c.bigRunButton,R=lf("Open assembly instructions"),D=lf("Restart the simulator"),L=lf("Toggle debug mode"),M=lf("View simulator keyboard shortcuts"),P=b?lf("Exit fullscreen mode"):lf("Launch in fullscreen"),B=c.simScreenshotKey?lf("Take Screenshot (shortcut {0})",c.simScreenshotKey):lf("Take Screenshot"),j=e?lf("Show the simulator"):lf("Hide the simulator"),F=lf("Open simulator console"),$=lf("Open device console"),U=b&&(r||t);return(0,i.jsxs)("aside",Object.assign({className:"ui item grid centered simtoolbar"+(d?"":" portrait "),role:"complementary","aria-label":lf("Simulator toolbar")},{children:[(0,i.jsxs)("div",Object.assign({className:"ui icon tiny buttons",style:{padding:"0"}},{children:[h&&(0,i.jsx)(o.Button,{disabled:x,icon:"configure",className:"secondary",title:R,onClick:this.openInstructions}),!c.bigRunButton&&(0,i.jsx)(a,{parent:n,simState:s.simState,debugging:s.debugging}),w&&(0,i.jsx)(o.Button,{className:"fullscreen-button tablet only hidefullscreen",icon:"xicon fullscreen",title:P,onClick:this.toggleSimulatorFullscreen},"fullscreenbtn"),E&&(0,i.jsx)(o.Button,{disabled:!O,className:"restart-button",icon:"refresh",title:D,onClick:this.restartSimulator},"restartbtn"),T&&(0,i.jsx)(o.Button,{disabled:!I,className:"debug-button "+(x?"orange":""),icon:"icon bug",title:L,onClick:this.toggleDebug},"debugbtn"),k&&v&&(0,i.jsx)(l,{onClick:this.toggleMute,state:n.state.mute,className:"hidefullscreen tutorial"}),N&&(0,i.jsx)(o.Button,{className:"expand-button portrait only editortools-btn hidefullscreen",icon:""+(e?"play":"stop"),title:j,onClick:this.toggleSimulatorCollapse})]})),!S&&(0,i.jsxs)("div",Object.assign({className:"ui icon tiny buttons computer only",style:{padding:"0"}},{children:[k&&(0,i.jsx)(l,{onClick:this.toggleMute,state:n.state.mute}),u.keymap&&(0,i.jsx)(o.Button,{className:"keymap-button",icon:"keyboard",title:M,onClick:n.toggleKeymap},"keymap")]})),U&&(0,i.jsxs)("div",Object.assign({className:"ui item tiny buttons full-screen-console"},{children:[r&&(0,i.jsx)(o.Button,{icon:"list",className:"purple",title:F,onClick:this.openDeviceSimulator}),t&&(0,i.jsx)(o.Button,{icon:"usb",className:"purple",title:$,onClick:this.openDeviceSerial})]})),!S&&(0,i.jsxs)("div",Object.assign({className:"ui icon tiny buttons computer only",style:{padding:"0"}},{children:[C&&(0,i.jsx)(o.Button,{disabled:!f,className:`screenshot-button ${A}`,icon:"icon camera left",title:B,onClick:this.takeScreenshot},"screenshotbtn"),w&&(0,i.jsx)(o.Button,{className:"fullscreen-button",icon:"xicon "+(b?"fullscreencollapse":"fullscreen"),title:P,onClick:this.toggleSimulatorFullscreen},"fullscreenbtn")]}))]}))}}n.SimulatorToolbar=s;class a extends o.StatelessUIElement{constructor(e){super(e),this.startStopSimulator=()=>{pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}}renderCore(){const e=this.props.simState,t=3==e,n=2==e,r=1==e,s=!this.props.debugging&&!n&&!r,a=(()=>{switch(e){case 0:return lf("Start the simulator");case 1:case 2:return lf("Starting the simulator");case 3:return lf("Stop the simulator")}})();return(0,i.jsx)(o.Button,{disabled:!s,className:`play-button ${this.props.className||""} ${t?"stop":"play"}`,icon:t?"stop":"play green",title:a,onClick:this.startStopSimulator},"runbtn")}}n.PlayButton=a;const l=({onClick:e,state:t,className:n})=>{let r;switch(t){case"muted":r=lf("Unmute audio");break;case"unmuted":r=lf("Mute audio");break;case"disabled":r=lf("Click inside the simulator to enable audio")}return(0,i.jsx)(o.Button,{className:`${n||""} mute-button ${"muted"===t?"red":""}`,icon:""+("unmuted"!==t?"volume off":"volume up"),disabled:"disabled"===t,title:r,onClick:e})}},{"./data":282,"./sui":346,"react/jsx-runtime":549}],338:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dbgStepOut=n.dbgStepInto=n.dbgStepOver=n.dbgPauseResume=n.proxy=n.setTraceInterval=n.unhide=n.hide=n.suspend=n.stop=n.mute=n.run=n.setPending=n.setDirty=n.setState=n.init=n.setTranslations=n.simTranslations=n.driver=n.SLOW_TRACE_INTERVAL=n.FAST_TRACE_INTERVAL=void 0;const i=e("./core"),r=e("./coretsx");var o=pxt.U;const s=e("../../pxteditor");let a,l;n.FAST_TRACE_INTERVAL=100,n.SLOW_TRACE_INTERVAL=500;let c={};function u(e,t){(0,s.shouldPostHostMessages)()&&(0,s.postHostMessageAsync)({type:"pxthost",action:"simevent",subtype:e,exception:t})}n.setTranslations=function(e){n.simTranslations!==e&&(n.simTranslations=e,h())},n.init=function(e,t){var s,d,h,f;if(!e)return;pxsim.U.clear(e);const g=document.createElement("div");g.id="simulators",g.className="simulator",e.appendChild(g);const m=document.createElement("div");m.id="debugger",m.className="ui item landscape only",e.appendChild(m);const b=/nestededitorsim=1/i.test(window.location.href),y=null===(d=null===(s=/[\&\?]mp=(server|client)/i.exec(window.location.href))||void 0===s?void 0:s[1])||void 0===d?void 0:d.toLowerCase();let v=null;if(window.parent!==window){const e=new URLSearchParams(window.location.search).get("parentOrigin");if(e)try{v=new URL(e).origin}catch(t){console.error(`Invalid parent origin: ${e}`)}}let _={restart:()=>t.restartSimulator(),revealElement:e=>{if(pxt.options.light||n.driver.isLoanedSimulator(e))return;const t=pxt.appTarget.appTheme.simAnimationEnter||"fly right in";e.style.animationDuration="500ms";const i=`${t} visible transition animating`;pxsim.U.addClass(e,i),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,i),e.style.animationDuration="",pxt.BrowserUtils.isEdge()&&r.dialogIsShowing()&&(document.body.style.display="none",requestAnimationFrame((()=>{document.body.style.display="block"})))}))},removeElement:(e,t)=>{if(pxt.appTarget.simulator.headless)pxsim.U.addClass(e,"simHeadless"),t&&t();else{if(pxt.options.light)return t&&t(),void pxsim.U.remove(e);const n=pxt.appTarget.appTheme.simAnimationExit||"fly right out";e.style.animationDuration="500ms";const i=`${n} visible transition animating`;pxsim.U.addClass(e,i),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,"animating"),e.style.animationDuration="",t&&t(),pxsim.U.remove(e)}))}},unhideElement:e=>{pxsim.U.removeClass(e,"simHeadless")},onDebuggerBreakpoint:function(e){let t=!1;if(a){let n=0,i=e.breakpointId;for(;!t;){if(i){const n=l.breakpoints[i];t=a.highlightStatement(n,e)}if(!t){n++;const t=e.stackframes?e.stackframes[n]:void 0;if(!t)break;i=t.breakpointId}}}e.exceptionMessage||!a||t?(!t&&e.exceptionMessage&&(pxt.debug(`runtime error: ${e.exceptionMessage}`),pxt.debug(e.exceptionStack),a&&a.orphanException(e)),u("stopped",e.exceptionMessage)):n.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},onTraceMessage:function(e){let t=l.breakpoints[e.breakpointId];a&&a.highlightStatement(t,e)},onDebuggerWarning:function(e){for(let t of e.breakpointIds){let e=l.breakpoints[t];if(e&&!o.startsWith("pxt_modules/",e.fileName)){a&&a.highlightStatement(e);break}}},onDebuggerResume:function(){u("resumed"),a&&a.highlightStatement(null)},onStateChanged:function(e){e===pxsim.SimulatorState.Stopped?u("stopped"):e===pxsim.SimulatorState.Running&&this.onDebuggerResume(),t.onStateChanged(e)},onSimulatorReady:function(){pxt.perf.recordMilestone("simulator ready"),t.onSimulatorReady()},onSimulatorCommand:e=>{switch(e.command){case"setstate":t.setState(e.stateKey,e.stateValue);break;case"restart":t.restartSimulator();break;case"reload":p(!0),t.restartSimulator();break;case"modal":if(p(),!(pxt.shell.isSandboxMode()||e.displayOnceId&&c[e.displayOnceId])){const t={header:e.header,body:e.body,size:"large",copyable:e.copyable,disagreeLbl:lf("Close"),modalContext:e.modalContext},n=pxt.appTarget.simulator.trustedUrls,r=e.linkButtonHref&&n&&-1!==n.indexOf(e.linkButtonHref);r?t.agreeLbl=e.linkButtonLabel:t.hideAgree=!0,c[e.displayOnceId]=!0,i.confirmAsync(t).then((t=>{r&&1==t&&window.open(e.linkButtonHref,"_blank")}))}}},onTopLevelCodeEnd:()=>{u("toplevelfinished")},onMuteButtonStateChange:t.onMuteButtonStateChange,stoppedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.stoppedClass,invalidatedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.invalidatedClass,nestedEditorSim:b,parentOrigin:v,mpRole:y,messageSimulators:null===(f=null===(h=pxt.appTarget)||void 0===h?void 0:h.simulator)||void 0===f?void 0:f.messageSimulators};n.driver=new pxsim.SimulatorDriver(document.getElementById("simulators"),_),a=t};let d=!1;function h(){n.driver&&n.driver.setDirty()}function p(e,t){n.driver&&n.driver.stop(e,t)}n.setState=function(e,t){a&&a.editor!=e&&(a.editor=e,a.highlightStatement(null)),d=t},n.setDirty=h,n.setPending=function(){n.driver&&n.driver.setPending()},n.run=function(e,t,i,r,o){var s;const a=pxt.appTarget.simulator.boardDefinition,{js:c,fnArgs:d,parts:h,usedBuiltinParts:p,allParts:f}=pxtc.buildSimJsInfo(i);l=i;const{mute:g,highContrast:m,light:b,clickTrigger:y,storedState:v,autoRun:_}=r,E=pxt.BrowserUtils.isIpcRenderer()||void 0,T={};for(const t of e.sortedDeps())T[t.id]=t.version();const x=f&&f.indexOf("multiplayer")>=0?1:void 0;if(x){const e=document.getElementById("root");for(let t=1;t<=4;t++){const n=`--multiplayer-presence-icon-${t}`;null===(s=null==e?void 0:e.style)||void 0===s||s.removeProperty(n)}}const w=e.config.theme||pxt.appTarget.appTheme.matchWebUSBDeviceInSim&&pxt.packetio.isConnected()&&pxt.packetio.deviceVariant(),k={boardDefinition:a,mute:g,parts:h,builtinParts:p,debug:t,trace:o,fnArgs:d,highContrast:m,light:b,aspectRatio:h.length?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio,partDefinitions:e.computePartDefinitions(h),cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:n.simTranslations,refCountingDebug:pxt.options.debug,version:e.version(),clickTrigger:y,breakOnStart:t,storedState:v,autoRun:_,ipc:E,dependencies:T,activePlayer:x,theme:w};u("started"),n.driver.run(c,k)},n.mute=function(e){n.driver&&n.driver.mute(e)},n.stop=p,n.suspend=function(){n.driver&&n.driver.suspend()},n.hide=function(e){n.driver&&n.driver.hide(e)},n.unhide=function(){n.driver&&n.driver.unhide()},n.setTraceInterval=function(e){n.driver&&n.driver.setTraceInterval(e)},n.proxy=function(e){n.driver&&n.driver.postMessage(e)},n.dbgPauseResume=function(){n.driver.state==pxsim.SimulatorState.Paused?n.driver.resume(pxsim.SimulatorDebuggerCommand.Resume):n.driver.state==pxsim.SimulatorState.Running&&n.driver.resume(pxsim.SimulatorDebuggerCommand.Pause)},n.dbgStepOver=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepOver)},n.dbgStepInto=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},n.dbgStepOut=function(){n.driver.state==pxsim.SimulatorState.Paused&&n.driver.resume(pxsim.SimulatorDebuggerCommand.StepOut)}},{"../../pxteditor":134,"./core":279,"./coretsx":280}],339:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findRootBlock=n.findRootBlocks=n.isSnippetInputAnswerTypeDropdown=n.isSnippetInputAnswerTypeYesNo=n.isSnippetInputAnswerTypeNumber=n.isSnippetInputAnswerTypeOther=n.isSnippetInputAnswerSingular=n.initializeSnippetExtensions=n.SnippetBuilder=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("blockly"),s=e("../../pxtblocks"),a=e("./data"),l=e("./sui"),c=e("./marked"),u=e("./compiler"),d=e("react-dom"),h=e("./package"),p=e("./core"),f=e("./snippetBuilderInputHandler");class g extends a.Component{constructor(e){super(e),this.generateOutputMarkdown=pxt.Util.debounce((()=>{const{config:e,tsOutput:t}=this.state;let n=`\`\`\`${e.outputType}\n`;n+=this.replaceTokens(this.highlightEditedBlocks(t)),n+="\n```",this.setState({mdOutput:n})}),300,!1),this.onChange=e=>t=>{let n=this.getCurrentQuestion();this.setState((i=>{let r=Object.assign(Object.assign({},i.answers),{[e]:t});return{answers:r,tsOutput:this.updateOutput(n,r,i.tsOutput)}}),this.generateOutputMarkdown)},this.state={visible:!1,answers:{},history:[0],defaults:{},config:e.config,tsOutput:[e.config.initialOutput]},this.cleanup=this.cleanup.bind(this),this.hide=this.hide.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this),this.backPage=this.backPage.bind(this),this.nextPage=this.nextPage.bind(this),this.handleModalKeyDown=this.handleModalKeyDown.bind(this)}buildDefaults(){const{config:e}=this.state,t={};for(const n of e.questions){const{inputs:e}=n;for(const n of e)if(m(n)){const{defaultAnswer:e,answerToken:i}=n;t[i]=e}else{const{defaultAnswers:e,answerTokens:i}=n;for(let n=0;n<i.length;n++){const r=i[n],o=e[n];t[r]=o}}}this.setState({answers:t,defaults:t},this.generateOutputMarkdown)}toggleActionButton(){let e;e=this.isLastQuestion()?{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}:{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"},this.state.actions[1]!==e&&this.setState({actions:[this.state.actions[0],e]})}initializeActionButtons(){const e=[{label:lf("Back"),onclick:this.backPage,icon:"arrow left",className:"arrow left",labelPosition:"left"},{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"}];this.setState({actions:e})}componentDidMount(){this.buildDefaults()}replaceTokens(e){const{answers:t,defaults:n}=this.state;let i=e.join("\n");const r=Object.keys(n);for(let e of r){const r=t[e]||n[e];i=i.split(`$${e}`).join(r)}return i}highlightEditedBlocks(e){const t=this.getCurrentQuestion().inputs.reduce(((e,t)=>m(t)?pxt.Util.concat([e,[t.answerToken]]):pxt.Util.concat([e,t.answerTokens])),[]);return e.reduce(((e,n)=>{for(const i of t)if(-1!==n.indexOf(i))return pxt.Util.concat([e,["// @highlight",n]]);return pxt.Util.concat([e,[n]])}),[])}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("snippet.builder.show",null,{interactiveConsent:!0}),this.initializeActionButtons(),this.setState({visible:!0})}cleanup(){this.setState({answers:{},history:[0],tsOutput:[this.props.config.initialOutput]}),o.hideChaff()}cancel(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.cancel",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.hide(),this.cleanup()}injectBlocksToWorkspace(){const{tsOutput:e}=this.state,{mainWorkspace:t}=this.props,{outputBehavior:n}=this.state.config;u.getBlocksAsync().then((t=>u.decompileBlocksSnippetAsync(this.replaceTokens(e),t))).then((e=>{const i=b(o.utils.xml.textToDom(e.outfiles[pxt.MAIN_BLOCKS]));let r=t.getTopBlocks(!0);"replace"===n&&(r.forEach((e=>{e.dispose(!1)})),r=[]);let a=i.map((e=>{let t=r.filter((t=>e.getAttribute("type")===t.type));return t.length?{newB:e,exB:t[0]}:{newB:e,exB:null}})),l=a.filter((e=>!!e.exB)),c=a.filter((e=>!e.exB));l.forEach((function(e){let{newB:n,exB:i}=e;const r=y(n),s=o.Xml.domToBlock(r,t);i.getInput("HANDLER").connection.connect(s.previousConnection)})),c.forEach((function(e){let{newB:n}=e;o.Xml.domToBlock(n,t)})),r.length<=1&&s.flow(t,{useViewWidth:!0})})).catch((e=>{throw p.errorNotification(e),new Error("Failed to decompile snippet output")}))}confirm(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.back.page",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.injectBlocksToWorkspace(),o.hideChaff(),this.hide()}getCurrentPage(){const{history:e}=this.state;return e[e.length-1]}getCurrentQuestion(){const{config:e}=this.state;return e.questions[this.getCurrentPage()]}getNextQuestionNumber(){const{answers:e,defaults:t}=this.state,n=this.getCurrentQuestion();if(n.goto){const{parameters:i}=n.goto;if(i)for(const n of i){const{answer:i,token:r}=n;if(i&&r&&(i===e[r]||!e[r]&&i===t[r]))return n.question}return n.goto.question}return null}getNextQuestion(){const{config:e}=this.state,t=this.getNextQuestionNumber();return t?e.questions[t]:null}isLastQuestion(){return!this.getCurrentQuestion().goto}nextPage(){const{config:e,history:t}=this.state,n=this.getCurrentQuestion().goto;if(this.isLastQuestion())this.confirm();else if(n){const n=this.getNextQuestion();let i=this.updateOutput(n,this.state.answers,this.state.tsOutput);const r=this.getNextQuestionNumber();this.setState({history:[...t,r],tsOutput:i},this.toggleActionButton),pxt.tickEvent("snippet.builder.next.page",{snippet:e.name,page:r},{interactiveConsent:!0}),this.generateOutputMarkdown()}}backPage(){const{history:e,config:t}=this.state;e.length>1&&this.setState({history:e.slice(0,e.length-1)},(()=>{this.toggleActionButton(),pxt.tickEvent("snippet.builder.back.page",{snippet:t.name,page:this.getCurrentPage()},{interactiveConsent:!0}),this.generateOutputMarkdown()}))}handleModalKeyDown(e){13!==e.keyCode&&39!==e.keyCode||this.nextPage(),37===e.keyCode&&this.backPage()}updateOutput(e,t,n){let i=!1;if(e.outputConditionalOnAnswer){let n=e.outputConditionalOnAnswer;e.inputs.map((e=>m(e)?[e.answerToken]:e.answerTokens)).reduce(((e,t)=>[...e,...t]),[]).every((e=>t[e]!=n))&&(i=!0)}let r=!!e.output,o=r&&-1!==n.indexOf(e.output),s=n;return i||o||!r?i&&o&&(s=n.filter((t=>t!==e.output))):s=pxt.Util.concat([n,[e.output]]),s}renderCore(){const{visible:e,answers:t,config:n,mdOutput:r,actions:o,defaults:s}=this.state,{parent:a}=this.props,u=this.getCurrentQuestion();let d=0===this.getCurrentPage();return(0,i.jsx)(l.Modal,Object.assign({isOpen:e,className:"snippet-builder full-screen-no-bg "+(d?"no-back-btn":""),overlayClassName:"snippet-builder-modal-overlay",closeOnEscape:!0,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:o,header:n.name,onClose:this.cancel,onKeyDown:this.handleModalKeyDown},{children:(0,i.jsxs)("div",Object.assign({className:"snippet-builder-inner"},{children:[u&&(0,i.jsxs)("div",Object.assign({className:"snippet-question"},{children:[(0,i.jsxs)("div",Object.assign({className:"ui segment raised"},{children:[(0,i.jsx)("h3",{children:pxt.Util.rlf(u.title)}),(0,i.jsx)("div",Object.assign({className:"ui equal width grid"},{children:u.inputs.map(((e,n)=>(0,i.jsx)("span",Object.assign({className:"column"},{children:(0,i.jsx)(f.InputHandler,{onChange:m(e)?this.onChange(e.answerToken):this.onChange,input:e,value:m(e)?t[e.answerToken]:t[e.answerTokens[0]],onEnter:this.nextPage},m(e)?e.answerToken:e.answerTokens[0])}),`span-${n}`)))})),u.errorMessage&&(0,i.jsx)("p",Object.assign({className:"snippet-error"},{children:u.errorMessage}))]})),u.hint&&(0,i.jsx)("div",Object.assign({className:"snippet hint ui segment"},{children:pxt.Util.rlf(u.hint).split("\n").reduce(((e,t)=>[...e,e.length?(0,i.jsx)("br",{}):"",t]),[])}))]})),(0,i.jsx)("div",Object.assign({className:"snippet output-section"},{children:r&&(0,i.jsx)(c.MarkedContent,{className:"snippet-markdown-content",markdown:r,parent:a})}))]}))}))}}function m(e){return void 0!==e.answerToken}function b(e,t){let n=[];for(const i in e.children){const r=e.children[i];if("block"===r.tagName)if(t){const e=r.getAttribute("type");e&&e===t&&n.push(r)}else n.push(r);else{const e=y(r);e&&(n=n.concat(e))}}return n}function y(e,t){let n=b(e,t);return n.length?n[0]:null}n.SnippetBuilder=g,n.initializeSnippetExtensions=function(e,t,n,i){(function(){let e=pxt.Util.concat(h.allEditorPkgs().map((e=>e.sortedFiles()))),t=e.filter((e=>"pxtsnippets.json"===e.name)).map((e=>pxt.Util.jsonTryParse(e.content)));const n=e.filter((e=>e.name.endsWith(".snippetts")));return t=t.map((e=>e.map((e=>{if(e.initialOutput.startsWith("file:")){let t=e.initialOutput.slice("file:".length,e.initialOutput.length);if(1!=n.filter((e=>e.name===t)).length)return pxt.reportError("snippetbuilder",`invalid external .ts file path: ${t}`),null}return e})).filter((e=>!!e)))),pxt.Util.concat(t)})().filter((t=>t.namespace==e)).forEach((e=>{t.push({name:`SNIPPET${name}_BUTTON`,type:"button",attributes:{blockId:`SNIPPET${name}_BUTTON`,label:e.label?pxt.Util.rlf(e.label):pxt.Util.lf("Editor"),weight:101,group:e.group&&e.group},callback:()=>{!function(e,t,n){const i=document.createElement("div"),o=document.body.appendChild(i),s={parent:n,mainWorkspace:t,config:e};d.render(r.createElement(g,s),o).show()}(e,n,i)}})}))},n.isSnippetInputAnswerSingular=m,n.isSnippetInputAnswerTypeOther=function(e){return"number"!==e.type},n.isSnippetInputAnswerTypeNumber=function(e){return void 0!==e.max},n.isSnippetInputAnswerTypeYesNo=function(e){return"yesno"===e.type},n.isSnippetInputAnswerTypeDropdown=function(e){return void 0!==e.options},n.findRootBlocks=b,n.findRootBlock=y},{"../../pxtblocks":68,"./compiler":204,"./core":279,"./data":282,"./marked":313,"./package":325,"./snippetBuilderInputHandler":340,"./sui":346,blockly:376,react:548,"react-dom":491,"react/jsx-runtime":549}],340:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InputHandler=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./components/ImageEditor/ImageEditor"),s=e("./sui"),a=e("./snippetBuilderPositionPicker"),l=e("./snippetBuilder");class c extends r.Component{constructor(e){super(e),this.textOnChange=e=>this.props.onChange(e),this.variableNameOnChange=e=>this.props.onChange(ts.pxtc.escapeIdentifier(e)),this.state={isFocused:!1}}renderInput(){const{value:e,input:t,onChange:n}=this.props;switch(t.type){case"dropdown":return(0,i.jsx)(u,{input:t,value:e,onChange:n});case"yesno":return(0,i.jsx)(h,{input:t,onChange:n});case"spriteEditor":if(l.isSnippetInputAnswerTypeOther(t)){const t=pxt.sprite.imageLiteralToBitmap(e);return(0,i.jsx)(o.ImageEditor,{singleFrame:!0,asset:{internalID:0,type:"image",id:"",jresData:"",meta:{},bitmap:t.data()},onChange:n})}case"number":return(0,i.jsx)(d,{input:t,value:e,onChange:n,autoFocus:!0});case"positionPicker":if(!l.isSnippetInputAnswerSingular(t))return(0,i.jsx)(a.PositionPicker,{defaultX:parseInt(t.defaultAnswers[0]),defaultY:parseInt(t.defaultAnswers[1]),input:t,onChange:n});case"text":case"variableName":default:if(l.isSnippetInputAnswerTypeOther(t))return(0,i.jsx)(s.Input,{label:t.label&&t.label,value:e||"",onChange:"variableName"==t.type?this.variableNameOnChange:this.textOnChange,autoFocus:!0,selectOnMount:!0})}return null}renderCore(){return this.renderInput()}}n.InputHandler=c;class u extends r.Component{constructor(e){super(e),this.onChange=e=>()=>{const{onChange:t}=this.props;t(e)},this.onChange=this.onChange.bind(this)}renderCore(){const{value:e,input:t}=this.props;return l.isSnippetInputAnswerTypeDropdown(t)?(0,i.jsx)(s.DropdownMenu,Object.assign({className:"inline button",role:"menuitem",text:e.length?pxt.Util.rlf(t.options[e]):pxt.Util.rlf(t.options[Object.keys(t.options)[0]]),icon:"dropdown"},{children:Object.keys(t.options).map((e=>(0,i.jsx)(s.Item,{role:"menuitem",value:e,text:pxt.Util.rlf(t.options[e]),onClick:this.onChange(e)},t.options[e])))})):null}}class d extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;t(e.target.value)}renderCore(){const{input:e,value:t,autoFocus:n}=this.props;return l.isSnippetInputAnswerTypeNumber(e)?(0,i.jsxs)("div",Object.assign({className:"slider-outer"},{children:[(0,i.jsx)("span",{children:e.label&&e.label}),(0,i.jsxs)("div",{children:[(0,i.jsx)("input",{type:"range",autoFocus:n,className:"slider blocklyMockSlider",role:"slider",max:e.max,min:e.min,value:t,onChange:this.onChange,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":+t,style:{marginLeft:0}}),(0,i.jsx)(s.Input,{value:t,onChange:this.props.onChange,class:"snippet slider-input"})]})]})):null}}class h extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;return()=>t(e)}renderCore(){const{input:e}=this.props;return l.isSnippetInputAnswerTypeYesNo(e)?(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Button,{text:"Yes",title:"Yes",onClick:this.onChange("true")}),(0,i.jsx)(s.Button,{text:"No",title:"No",onClick:this.onChange("false")})]}):null}}},{"./components/ImageEditor/ImageEditor":212,"./data":282,"./snippetBuilder":339,"./snippetBuilderPositionPicker":341,"./sui":346,"react/jsx-runtime":549}],341:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PositionPicker=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./snippetBuilder"),s=e("./sui"),a=e("./snippetBuilderSimulatorDisplay");class l extends r.Component{constructor(e){super(e),this.onChange=e=>t=>{const{input:n,onChange:i}=this.props;if(!o.isSnippetInputAnswerSingular(n)){const r=this.state;let o=parseInt(t);if(isNaN(o)||o<0)return;this.setState({x:e?this.unScalePointX(o):r.x,y:e?r.y:this.unScalePointY(o)},(()=>{const t=this.getScaledPoints();e&&i(n.answerTokens[0])(t.x.toString()),e||i(n.answerTokens[1])(t.y.toString()),this.setState({dotVisible:!0})}))}},this.state={x:this.unScalePointX(this.props.defaultX||80),y:this.unScalePointY(this.props.defaultY||60),dotVisible:!1},this.setDot=this.setDot.bind(this),this.onChange=this.onChange.bind(this),this.setScale=this.setScale.bind(this)}componentWillUnmount(){window.removeEventListener("resize",this.setScale)}componentDidMount(){this.setScale(),window.addEventListener("resize",this.setScale)}setScale(){const e=window.innerHeight,t=window.innerWidth;let n=e>t?t/2100:e/1003;n<.71?n=.71:n>1.01&&(n=1.01),this.setState({scale:n})}getScale(e,t){const{scale:n}=this.state;return t*n/e}getXScale(){return this.getScale(160,309)}getYScale(){return this.getScale(120,227)}scalePoint(e,t){return isNaN(e)?0:Math.round(e/t)}scalePointX(e){return this.scalePoint(e,this.getXScale())}scalePointY(e){return this.scalePoint(e,this.getYScale())}unScalePoint(e,t){return isNaN(e)?0:Math.round(e*t)}unScalePointX(e){return this.unScalePoint(e,this.getXScale())}unScalePointY(e){return this.unScalePoint(e,this.getYScale())}getScaledPoints(){const{x:e,y:t}=this.state;return{x:this.scalePointX(e),y:this.scalePointY(t)}}scalePixel(e){const{scale:t}=this.state;return e*t+"px"}setDot(e){const{input:t,onChange:n}=this.props,i=e.nativeEvent.offsetX,r=e.nativeEvent.offsetY;this.setState({dotVisible:!0,x:Math.round(i),y:Math.round(r)},(()=>{if(!o.isSnippetInputAnswerSingular(t)){const e=this.getScaledPoints();n(t.answerTokens[0])(e.x.toString()),n(t.answerTokens[1])(e.y.toString())}}))}renderCore(){const{dotVisible:e,x:t,y:n,scale:r}=this.state,o=this.getScaledPoints();return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",Object.assign({className:"ui grid"},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)(s.Input,{class:"position-picker preview-input",value:o.x.toString(),onChange:this.onChange(!0)})})),(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)(s.Input,{class:"position-picker preview-input",value:o.y.toString(),onChange:this.onChange(!1)})}))]})),(0,i.jsx)(a.SimulatorDisplay,Object.assign({scale:r},{children:(0,i.jsx)("div",Object.assign({ref:"positionPickerContainer",className:"position-picker container",onClick:this.setDot,style:{left:this.scalePixel(28),top:this.scalePixel(28),width:this.scalePixel(309),height:this.scalePixel(227),margin:"8px",maxWidth:this.scalePixel(309),maxHeight:this.scalePixel(227)},role:"grid"},{children:e&&(0,i.jsx)("div",{className:"position-picker dot",style:{top:`${n}px`,left:`${t}px`}})}))}))]})}}n.PositionPicker=l},{"./data":282,"./snippetBuilder":339,"./snippetBuilderSimulatorDisplay":342,"./sui":346,"react/jsx-runtime":549}],342:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SimulatorDisplay=void 0;const i=e("react/jsx-runtime"),r=e("./data");class o extends r.Component{scalePixel(e,t){const{scale:n}=this.props;return`${e*n}${!t&&"px"}`}renderCore(){const{children:e,scale:t}=this.props,n=(0,i.jsx)("svg",Object.assign({height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:"0px",top:this.scalePixel(297.85)},visibility:"visible"},{children:(0,i.jsxs)("g",Object.assign({transform:"translate(18.80933368822642 18.80933368822642) scale(3.7618667376452843)"},{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23.813 24.362",width:"23.813",height:"24.362"},{children:[(0,i.jsx)("path",{fill:"#f290c1",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.32c3.171 0 3.348-.03 3.969-.65.618-.618.649-.804.649-3.855 0-2.426-.092-3.298-.378-3.584-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172z"}),(0,i.jsx)("path",{fill:"#f291bd",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.241c3.027-.001 3.29-.042 3.97-.627.719-.619.727-.66.727-3.855 0-2.446-.092-3.321-.378-3.607-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172zm1.799.534c.188-.002.635.288.992.645.626.626.649.781.649 4.234 0 2.368-.096 3.583-.283 3.583-.19 0-.263-1.135-.222-3.438.058-3.3.035-3.46-.552-3.969-.336-.292-.504-.532-.372-.534.131-.002.06-.12-.159-.26-.283-.184-.298-.258-.053-.261zm-4.488.525c.12 0 .22.178.22.397 0 .45-.019.466-.264.22-.247-.246-.22-.617.044-.617zm-.561 6.398c.044-.018.099.08.19.283.114.254.138.641.054.86-.169.44-.962.549-.962.132 0-.146.11-.265.246-.265s.293-.268.35-.595c.046-.261.078-.396.122-.415zM22.4 8.997c.24 0 .883.755.883 1.039 0 .387-.45.357-.704-.048-.25-.399-.356-.992-.18-.992zM.936 9.63c.027-.006.051 0 .071.02.082.081 0 .295-.18.474-.261.26-.292.23-.148-.148.074-.196.176-.327.257-.346zm21.876 2.83c.038-.01.107.097.234.315.151.26.234.595.185.745-.142.424-.477-.054-.468-.666.003-.254.01-.383.049-.394zm-22.071.88a.16.16 0 0 1 .053.02c.145.09.264.336.264.546 0 .21-.119.381-.264.381-.146 0-.265-.245-.265-.545 0-.262.091-.426.212-.403zm3.214 1.5c1.97-.026 4.558.11 4.762.355.137.166.27 1.781.296 3.59.03 2.222-.05 3.319-.25 3.385-.208.07-.296-.931-.296-3.363v-3.462H5.012c-2.294 0-3.4-.09-3.288-.271.089-.144 1.049-.218 2.231-.234zm5.258 7.66c.128.001.393.127.725.378.387.292.416.387.116.386-.218 0-.55-.176-.738-.388-.22-.25-.23-.375-.103-.375z"}),(0,i.jsx)("path",{fill:"#a3809c",d:"M12.012 0C7.81 0 7.938-.139 7.938 4.407v3.531H4.453c-4.58 0-4.453-.113-4.452 3.943 0 2.844.045 3.122.625 3.796.622.723.65.728 3.97.728h3.342v3.609c0 3.126.062 3.655.463 3.96.318.241 1.374.354 3.38.36 4.184.012 4.094.108 4.094-4.372v-3.557h3.271c3.182 0 3.29-.02 3.969-.698.675-.675.697-.798.69-3.77-.006-2.135-.116-3.214-.36-3.536-.302-.398-.821-.463-3.696-.463h-3.345V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416C15.875.199 15.22 0 12.012 0zm-.106.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.154-.112 1.996-.265 1.996-.15 0-.265-.75-.265-1.718 0-1.386-.111-1.846-.576-2.381-.56-.644-.678-.664-3.97-.664h-3.391V5.677c0-3.171-.029-3.348-.65-3.969-.547-.547-.902-.65-2.26-.65-1.359 0-1.714.103-2.261.65-.62.62-.65.798-.65 3.97v3.318h-3.32c-3.17 0-3.347.03-3.968.65-.568.568-.65.886-.65 2.532 0 1.28.122 2.005.379 2.261.29.29 1.21.378 3.969.378h3.59v3.394c0 3.205.034 3.425.612 3.968.45.422.944.576 1.852.576.682 0 1.24.119 1.24.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.579-.578-.65-.874-.65-2.711.001-1.787.084-2.16.627-2.79.62-.723.65-.728 3.968-.728h3.343V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zM9.782 11.668c.154.024.358.267.56.723.182.412.668.898 1.08 1.08.412.183.749.441.749.575 0 .133-.281.242-.625.242-.807 0-2.02-1.214-2.02-2.02 0-.426.102-.623.256-.6z"}),(0,i.jsx)("path",{fill:"#a8769a",d:"M12.06 0C7.84 0 7.939-.105 7.939 4.425v3.513H4.5c-4.598 0-4.5-.086-4.5 3.991 0 2.976.023 3.104.697 3.778.678.678.787.698 3.969.698h3.27v3.485c0 2.87.078 3.57.439 3.968.374.413.865.484 3.356.484 2.633 0 2.978-.057 3.53-.576.58-.543.613-.763.613-3.968v-3.394l3.241-.008c4.438-.011 4.697-.266 4.697-4.618 0-3.822-.02-3.84-4.234-3.84h-3.175V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.97-.657-1.172-3.814-1.172zm-.154.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381l-.034 1.653c-.018.91-.04 2.424-.047 3.366-.011 1.42-.117 1.817-.616 2.316-.33.33-.786.602-1.01.602-.225 0-.41.119-.41.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zm0 2.116c-.617 0-.793.117-.793.529 0 .291-.12.53-.265.53-.145 0-.265.237-.265.528 0 .291-.119.53-.264.53-.146 0-.265.238-.265.529 0 .29-.119.529-.264.529-.146 0-.28.208-.3.463-.019.254-.127.046-.24-.463l-.206-.926.042.926.042.926 2.646.147c1.455.081 2.735.17 2.844.199.251.064.26-1.072.013-1.714-.167-.433-.202-.419-.331.13-.128.541-.232.448-.877-.794-.402-.774-.73-1.557-.727-1.738.002-.192-.329-.331-.79-.331zm9.525 6.35c-.013.013.067.12.231.33.346.441.563.582.563.364 0-.055-.208-.264-.463-.463-.21-.165-.317-.245-.33-.231zm-14.874.021c-.772-.016-.951.065-.831.377.111.29-.285.596-1.455 1.125-1.343.607-1.608.834-1.609 1.387-.001.56.264.78 1.722 1.432 1.728.772 1.875 1.067.643 1.288-.364.065.35.115 1.588.11 1.237-.005 1.802-.055 1.257-.112l-.993-.104v-2.608c0-1.838.098-2.647.331-2.741.182-.073-.112-.143-.653-.154zm5.365.464c-.676.022-1.35.282-1.77.772-.651.756-.817 1.389-.364 1.389.144 0 .41-.238.592-.53.426-.68 1.271-.673 2.152.02.85.668.931 1.812.168 2.362-.29.21-.529.474-.529.587 0 .383.718.21 1.42-.342.93-.732.996-2.67.121-3.602-.434-.462-1.113-.678-1.79-.656zm5.23.044c-.229 0-.313 4.58-.089 4.804.071.071 1.017-.296 2.1-.816 1.73-.83 1.973-1.034 1.987-1.673.01-.4-.1-.728-.244-.728-.143 0-.997-.357-1.898-.793-.901-.437-1.737-.794-1.856-.794zm-15.98 3.386c-.034.018-.058.178-.062.45-.005.437.05.648.122.469.073-.18.077-.537.01-.794-.025-.097-.05-.136-.07-.125zm1.704 1.673a2.998 2.998 0 0 0-.558.046c-.329.063-.122.117.46.12.582.003.852-.049.599-.115a2.182 2.182 0 0 0-.501-.05zm10.134 2.282c-.297.002-.625.008-.97.02-1.538.051-2.515.193-2.515.364 0 .154.387 1.092.86 2.084.721 1.513.967 1.804 1.521 1.81.568.004.793-.279 1.588-2.005.51-1.105.956-2.083.993-2.174.028-.067-.585-.104-1.477-.099zm-3.946 4.427a.043.043 0 0 0-.03.012c-.062.063.037.296.221.517.472.57.6.501.216-.114-.155-.249-.325-.419-.407-.415z"}),(0,i.jsx)("path",{fill:"#2f99a1",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381v3.318c0 3.172-.029 3.349-.65 3.97-.356.356-.833.649-1.058.649-.224 0-.409.119-.409.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,i.jsx)("path",{fill:"#96266c",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.583.582.65.87.65 2.79s-.067 2.207-.65 2.79c-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.588.588-.854.647-2.843.633-1.965-.015-2.258-.083-2.79-.652-.553-.59-.596-.878-.596-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,i.jsx)("path",{fill:"#5b3b6a",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.797-.649-3.968-.649h-3.32v-3.61c0-3.126-.062-3.655-.463-3.96-.317-.24-1.364-.353-3.319-.36zm-.112.52c1.973 0 2.277.067 2.79.613.528.562.575.887.575 3.969v3.356h3.394c3.205 0 3.425.034 3.968.612.495.527.575.919.575 2.79 0 1.96-.064 2.243-.649 2.828-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.585.585-.865.649-2.863.649-1.974 0-2.278-.067-2.79-.613-.529-.562-.576-.886-.576-3.968v-3.357H5.074c-3.205 0-3.426-.034-3.969-.612-.498-.53-.576-.917-.576-2.863 0-2.072.053-2.296.664-2.827.605-.527.951-.577 3.969-.577h3.305V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.864-.65zm-.046 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.009.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.057-2.38.127s.444 1.027.987 2.125c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),(0,i.jsx)("path",{d:"M9.763 0c-.295.002-.765.24-1.176.65-.357.357-.65.714-.65.794 0 .323.437.111.794-.385.21-.291.594-.53.853-.53.258 0 .47-.118.47-.264 0-.182-.114-.265-.29-.265zm4.286 0c-.177 0-.29.083-.29.265 0 .146.187.265.415.265 1.002 0 1.172.63 1.172 4.346 0 2.218.101 3.591.265 3.591.163 0 .264-1.37.264-3.584 0-3.452-.023-3.607-.649-4.233-.41-.41-.882-.648-1.177-.65zM4.883 7.938c-3.452 0-3.608.024-4.233.65C.293 8.945 0 9.42 0 9.646c0 .225.12.409.265.409.145 0 .264-.188.264-.416 0-1.002.632-1.172 4.347-1.172 2.218 0 3.59-.101 3.59-.264 0-.164-1.37-.265-3.583-.265zm18.04.612a.168.168 0 0 0-.115.054c-.102.11-.037.253.145.318s.33.347.33.626.12.507.265.507c.146 0 .265-.188.265-.416 0-.459-.579-1.112-.89-1.089zM.265 13.76c-.485 0-.273.81.385 1.467.62.62.797.65 3.968.65h3.32v3.58c0 3.35.038 3.623.595 4.218.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.626-.626.65-.781.65-4.234v-3.584h3.391c3.291 0 3.41-.02 3.969-.663.603-.693.766-1.453.312-1.453-.145 0-.265.187-.265.416 0 1.001-.63 1.171-4.346 1.171h-3.591v3.591c0 3.716-.17 4.347-1.172 4.347-.228 0-.416.119-.416.264 0 .152-.793.265-1.852.265-1.058 0-1.852-.113-1.852-.265 0-.145-.186-.264-.415-.264-1.002 0-1.172-.631-1.172-4.347v-3.59h-3.59c-3.716 0-4.348-.17-4.348-1.172 0-.229-.119-.416-.264-.416z"})]})),(0,i.jsx)("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"0",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,i.jsx)("rect",{className:"controller-button-overlay",x:"15.875333333333332",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,i.jsx)("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"15.875333333333332",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),(0,i.jsx)("rect",{className:"controller-button-overlay",x:"0",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"})]}))})),r=(0,i.jsx)("svg",Object.assign({height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(240.8),top:this.scalePixel(297.85)},visibility:"visible"},{children:(0,i.jsxs)("g",Object.assign({transform:"translate(17.15858198888469 17.15858198888469) scale(3.4317163977769383)"},{children:[(0,i.jsxs)("g",Object.assign({transform:"translate(13.533000000000001 2.2554999999999996)"},{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},{children:[(0,i.jsx)("path",{fill:"#ff8135",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),(0,i.jsx)("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.146 7.611 1.146 7.611c.792-4.598 3.68-6.217 8.39-6.006 0 0-4.269-1.965-7.082 1.014z"}),(0,i.jsx)("path",{fill:"#af4282",d:"M8.745 9.825h1.423l-1.72-6.914H7.027L2.542 9.825h1.412c.444-.507.61-1.53 1.45-1.304H8.42l.326 1.304zm-.602-2.519H5.574c.621-.807 1.397-2.523 1.92-2.76l.649 2.76z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,i.jsx)("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})]})),(0,i.jsxs)("g",Object.assign({transform:"translate(0 13.533000000000001)"},{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},{children:[(0,i.jsx)("path",{fill:"#ff91c4",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),(0,i.jsx)("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.051 7.563 1.051 7.563c.793-4.597 3.823-6.169 8.533-5.958 0 0-4.317-1.965-7.13 1.014z"}),(0,i.jsx)("path",{fill:"#af4282",d:"M5.337 7.226c.909.088 1.876-.201 2.736.21.288.113.37.493.32.773-.143.515-.716.742-1.197.817-.607-.047-1.91.169-2.181-.227-.058-.371.217-.697.222-1.073l.1-.5zM5.88 4.49c.81.122 1.664-.209 2.444.123.263.119.537.35.451.67-.591 1.227-2.213.797-3.21.797l.315-1.59zm2.233-1.186h-3.28L3.45 10.22c1.523-.054 3.064.132 4.572-.152 1.117-.305 1.976-1.536 1.666-2.692-.146-.282-.515-.448-.562-.79.088-.354.606-.278.717-.652.452-.693.41-1.769-.288-2.287-.42-.274-.95-.333-1.442-.342z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,i.jsx)("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})]}))]}))})),o=(0,i.jsxs)("svg",Object.assign({visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(105.25),top:this.scalePixel(284)}},{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},{children:[(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806-.072.806.073 0 .17 1.912.36 5.969.36s6.334 0 6.334-.169c0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z",fill:"#f290c1"}),(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806.008.806.153 0 .17 1.418-.021 5.376-.021 3.85 0 6.693.297 6.795.132.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z",fill:"#f291bd"}),(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 1.076.04 1.076.185 0 .17 1.807.09 5.765.09 3.85 0 6.034.154 6.136-.011.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-3.218.34-4.26z",fill:"#a3809c"}),(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .386.232.542.241.535.03.73.005 1.13-.049.4-.055 3.114.04 6.344-.023l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.714-3.018.251-4.05zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0 .39.053.054-.311-.337-.364-1.171-1.011-1.289-1.011zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z",fill:"#a8769a"}),(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.703.965-2.624.965-1.153 0-2.28.064-2.28.217 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z",fill:"#2f99a1"}),(0,i.jsx)("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.016.103.855-.735c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635c-.845-.904-.755-2.749.118-3.62z",fill:"#5b3b6a"}),(0,i.jsx)("path",{d:"M16.673 1.587c-.12-.084-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65-13.228-.19-.698-.46c-.356-.357-.506-.943-.506-1.17 0-.224-.262-.297-.407-.297-.533 0-.005 1.371.833 2.25l.622.359 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.034-1.037-.153-1.12z"}),(0,i.jsx)("text",{style:{lineHeight:"1.25"},x:"2.765",y:"2.203",fontWeight:"400",fontSize:"5.333",fontFamily:"sans-serif",letterSpacing:"0",wordSpacing:"0"}),(0,i.jsx)("g",Object.assign({"aria-label":"reset",style:{lineHeight:1.25},fontWeight:"400",fontSize:"4.667",fontFamily:"Arial Rounded MT Bold",letterSpacing:"0",wordSpacing:"0",fill:"#5b3b6a"},{children:(0,i.jsx)("path",{d:"M3.417 3.587v.52c0 .125-.03.22-.088.284a.298.298 0 0 1-.226.093.285.285 0 0 1-.221-.095c-.058-.064-.087-.158-.087-.283V2.374c0-.28.101-.419.303-.419.104 0 .178.033.224.098a.54.54 0 0 1 .075.29c.074-.128.15-.225.228-.29a.478.478 0 0 1 .314-.098c.13 0 .258.033.38.098.124.065.185.152.185.26a.249.249 0 0 1-.08.19.242.242 0 0 1-.168.072.815.815 0 0 1-.166-.041.74.74 0 0 0-.23-.043.335.335 0 0 0-.224.073c-.058.047-.055.165-.087.26-.032.093-.101.158-.113.289-.013.129-.019.287-.019.474zM6.464 3.372H5.247c.002.142.03.266.084.374.057.108.13.19.221.244a.59.59 0 0 0 .306.082c.074 0 .094-.04.155-.057.062-.018.138-.093.196-.13.058-.037.11-.046.16-.088.048-.043.143-.053.22-.126a.204.204 0 0 1 .137-.041c.064 0 .115.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.798.798 0 0 1-.2.216c-.089.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.758-.05-.98-.278-.221-.228-.285-.6-.285-.99 0-.185.028-.355.082-.511.055-.158.135-.293.24-.406.105-.112.234-.198.387-.257.153-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.086.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zM5.247 3.02l1.049-.016c-.016-.212.006-.355-.094-.46a.51.51 0 0 0-.392-.16.5.5 0 0 0-.383.162c-.099.107-.159.265-.18.474zM9.506 3.671a.768.768 0 0 1-.125.442.776.776 0 0 1-.372.278c-.162.062-.36.093-.595.093-.223 0-.414-.034-.574-.102a.841.841 0 0 1-.353-.255.521.521 0 0 1-.114-.31.25.25 0 0 1 .257-.248c.066 0 .116.015.151.047a.524.524 0 0 1 .1.135c.064.11.076.146.165.2.266-.033.433.05.587.05.124 0 .067.053.146-.002.08-.056.12-.12.12-.191 0-.11-.041-.19-.125-.24a1.515 1.515 0 0 0-.407-.143 3.538 3.538 0 0 1-.524-.166.873.873 0 0 1-.322-.233.53.53 0 0 1-.12-.353c0-.125.037-.242.111-.353a.76.76 0 0 1 .328-.265c.146-.066.322-.1.527-.1.16 0 .305.017.433.05.129.034.236.079.32.135a.645.645 0 0 1 .197.187.361.361 0 0 1 .068.2.23.23 0 0 1-.073.176c-.047.045-.114.068-.203.068a.254.254 0 0 1-.164-.055 1.116 1.116 0 0 1-.152-.164.562.562 0 0 0-.167-.146.524.524 0 0 0-.26-.054.503.503 0 0 0-.28.073c-.074.047-.111.106-.111.177 0 .066.027.12.082.162.054.041.192.06.284.087.093.027.157.076.32.116.192.047.35.103.471.169a.767.767 0 0 1 .278.232c.064.088.096.19.096.303zM11.773 3.372l-1.121.064c.001.141-.066.202-.011.31.056.108.13.19.22.244a.59.59 0 0 0 .306.082.764.764 0 0 0 .203-.025.71.71 0 0 0 .18-.082c.058-.038.11-.078.16-.12l.189-.174a.204.204 0 0 1 .136-.041c.064 0 .116.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.797.797 0 0 1-.2.216c-.088.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.71-.113-.932-.341-.221-.228-.332-.537-.332-.928 0-.184.027-.354.082-.51.054-.158.134-.293.239-.406.105-.112.234-.198.387-.257.154-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.087.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zm-1.217-.353h1.128c-.015-.212-.073-.371-.173-.476-.099-.106-.182-.064-.344-.064-.155 0-.267.006-.367.114-.099.106-.222.217-.244.426zM12.842 2.01h.068v-.374c0-.1.003-.178.007-.235a.362.362 0 0 1 .046-.148.272.272 0 0 1 .104-.102.307.307 0 0 1 .367.048c.043.04.07.088.08.145.012.057-.006.36.002.464l.016.202h.228c.088 0 .155.021.2.064.048.04.071.094.071.16 0 .083-.033.141-.1.175-.065.033-.208-.048-.283.05l-.108.143c-.082.381 0 .762 0 1.144 0 .097-.005.03.001.082a.245.245 0 0 0 .055.128c.03.032.08.048.146.048a.82.82 0 0 0 .148-.019.729.729 0 0 1 .146-.02c.05 0 .095.02.134.061.041.04.062.09.062.149 0 .1-.055.177-.164.23-.11.053-.267.08-.472.08-.194 0-.342-.033-.442-.099a.46.46 0 0 1-.198-.27c-.03-.116-.101-.27-.093-.463.015-.398-.12-.343.047-1.194h-.082c-.09 0-.158-.022-.205-.064a.209.209 0 0 1-.07-.162c0-.065.024-.118.072-.16a.326.326 0 0 1 .217-.063z"})}))]})),(0,i.jsx)("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})]})),s=(0,i.jsxs)("svg",Object.assign({visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(192.75),top:this.scalePixel(284)}},{children:[(0,i.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},{children:[(0,i.jsx)("path",{fill:"#f290c1",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.293.265 6.35.265 4.057 0 6.35-.096 6.35-.265 0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z"}),(0,i.jsx)("path",{fill:"#f291bd",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z"}),(0,i.jsx)("path",{fill:"#a3809c",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-2.193.34-3.236z"}),(0,i.jsx)("path",{fill:"#a8769a",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .46.108.542.241.082.133.476.196.876.142.4-.055 3.368-.151 6.598-.214l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.793-2.239.172-3.272zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0-.07-.297-.407-.661-.337-.364-.71-.661-.828-.661zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z"}),(0,i.jsx)("path",{fill:"#2f99a1",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.989.917-2.91.917-1.153 0-1.994.112-1.994.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z"}),(0,i.jsx)("path",{fill:"#5b3b6a",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635C.284 3.72.31 2.05 1.183 1.179z"}),(0,i.jsx)("path",{d:"M16.673 1.587c-.146 0-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65H1.833l-.65-.65C.827 4.285.534 3.81.534 3.584c0-.225-.119-.409-.264-.409-.533 0-.243.831.595 1.709l.86.9 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.119-1.2-.264-1.2z"}),(0,i.jsx)("path",{fill:"#5b3b6a",d:"M3.773 1.723c-.1.007-.2.056-.304.175-.243.263-.34-.344-.645-.087-.219.159-.07.434-.108.658v1.597h.56c.051-.533-.12-1.11.123-1.61.36-.45 1.038.15.82.609.04.378-.212 1.192.456 1.001h.105c.056-.535-.13-1.11.133-1.612.335-.39.855.064.83.478.034.347-.282.99.169 1.135.545.15.278-.472.348-.78-.008-.428.044-.943-.287-1.27-.348-.327-.983-.361-1.302.025-.313.015-.599-.34-.898-.319zm4.12.001c-.599.022-1.183.496-1.174 1.125-.051.62.434 1.27 1.082 1.27.367.008.959.003 1.073-.427-.266-.54-.722.142-1.15-.112-.45-.06-.384-.634.083-.451.419.035.842-.01 1.263.007.127-.605-.26-1.348-.923-1.392a1.13 1.13 0 0 0-.255-.02zm1.927.028c-.04-.012-.09-.002-.154.047-.34.104-.115.567-.174.837v1.431h.555c.06-.543-.157-1.163.19-1.642.384-.399 1.11.097.933.6.106.316-.215.898.167 1.042h.393c-.056-.651.16-1.385-.237-1.963-.328-.396-1.002-.468-1.362-.076-.147.001-.19-.238-.311-.276zm2.315.054c.05.645-.141 1.359.213 1.944.299.387.96.513 1.314.132.25-.084.356.443.641.157.17-.234.03-.55.07-.826V1.806h-.555c-.06.543.156 1.163-.19 1.642-.385.398-1.11-.097-.933-.601-.106-.318.256-1.05-.27-1.041h-.29zm-4.228.424c.268-.015.542.11.618.389-.382.126-.79.025-1.183.054h-.028c.06-.275.324-.429.593-.443z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})]})),(0,i.jsx)("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})]}));return(0,i.jsxs)("div",Object.assign({className:"simulator-display",id:"wrap",style:{transform:`scale(${t})`,transformOrigin:"0 0",width:this.scalePixel(368),height:this.scalePixel(432.938)}},{children:[(0,i.jsx)("div",{className:"debug-stats",id:"debug-stats"}),(0,i.jsx)("div",{className:"screen-back",id:"screen-back"}),(0,i.jsxs)("div",Object.assign({id:"screen"},{children:[(0,i.jsx)("div",Object.assign({id:"paint-surface-container",style:{top:this.scalePixel(12),left:this.scalePixel(12)}},{children:(0,i.jsx)("canvas",{id:"paint-surface",width:"160",height:"120",className:"borders",style:{transform:`scale(${t})`,transformOrigin:"0 0",height:229,width:312,left:this.scalePixel(28),top:this.scalePixel(20),clipPath:"polygon(0px 5.33333px, 5.33333px 0px, 338.667px/1.2) 0px, 344px 5.33333px, 344px 256.667px, 338.667px 262px, 5.33333px 262px, 0px 256.667px)"}})})),(0,i.jsxs)("div",Object.assign({id:"controls",className:"no-focus"},{children:[n,r,o,s]})),e]})),(0,i.jsx)("div",{id:"instructions"})]}))}}n.SimulatorDisplay=o},{"./data":282,"react/jsx-runtime":549}],343:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tryInit=void 0;var i=pxt.Cloud,r=pxt.Util;let o,s={};function a(e){let t=r.lookup(s,e.result.socket);t?t.onOOB(e):console.error("Dropping data for "+e.result.socket)}n.tryInit=function(){pxt.BrowserUtils.isLocalHost()&&i.localToken&&(pxt.mkTCPSocket=(e,t)=>new l(e,t))};class l{constructor(e,t){this.host=e,this.port=t,this.onData=e=>{},this.onError=e=>{}}onOOB(e){if("data"==e.op){const t=r.stringToUint8Array(atob(e.result.data));this.onData(t)}else"close"==e.op&&(this.sockId=null,delete s[e.result.socket])}error(e){let t=new Error(r.lf("TCP error on socket {0}:{1} ({2})",this.host,this.port,e));throw this.onError(t),t}disconnectAsync(){return this.sockId?o.opAsync("close",{socket:this.sockId}).then((()=>{this.sockId=null})):Promise.resolve()}sendPacketAsync(e){return this.sockId||r.userError("Not connected"),o.opAsync("send",{socket:this.sockId,data:r.toHex(e),encoding:"hex"})}sendSerialAsync(e,t){return Promise.reject(new Error("No serial on socket"))}connectAsync(){return o||(pxt.BrowserUtils.isLocalHost()&&i.localToken||r.userError(lf("TCP sockets not available here")),pxt.debug("initializing tcp pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${i.localToken}/tcp`,a)),this.sockId?Promise.resolve():o.opAsync("open",{host:this.host,port:this.port}).then((e=>{e.socket||this.error(e.errorMessage),this.sockId=e.socket,s[this.sockId]=this}))}}},{}],344:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initTutorial=n.click=n.tutorialNext=n.tutorialStep=void 0;const i=e("./audio"),r={};function o(e){const t=(pxt.appTarget.appTheme.sounds||{})[e];if(pxt.options.light||!t)return Promise.resolve(void 0);let n=r[t];if(n)return Promise.resolve(n);const o=pxt.webConfig.commitCdnUrl+"sounds/"+t;return pxt.Util.requestAsync({url:o,headers:{Accept:"audio/"+t.slice(-3)},responseArrayBuffer:!0}).then((e=>i.loadAsync(e.buffer))).then((e=>r[t]=e))}function s(e){pxt.options.light||o(e).then((e=>e?i.play(e,.2):void 0))}n.tutorialStep=function(){s("tutorialStep")},n.tutorialNext=function(){s("tutorialNext")},n.click=function(){s("click")},n.initTutorial=function(){pxt.options.light||Promise.all([o("tutorialStep"),o("tutorialNext"),o("click")])}},{"./audio":193}],345:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;const i=e("react/jsx-runtime"),r=e("./core");n.Editor=class{constructor(e){this.parent=e,this.isVisible=!1,this.changeCallback=()=>{},this.isReady=!1}setVisible(e){this.isVisible=e}simStateChanged(){}onPageVisibilityChanged(e){}acceptsFile(e){return!1}getViewState(){return{}}getCurrentSource(){return this.currSource}getStyle(e){let t={display:this.isVisible?"block":"none"};return Object.assign(t,e)}getId(){return"editor"}displayOuter(e){return(0,i.jsx)("div",Object.assign({className:"full-abs",id:this.getId(),style:this.getStyle(e)},{children:this.display()}),this.getId())}display(){return null}beforeCompile(){}prepare(){this.isReady=!0}resize(e){}snapshotState(){return null}unloadFileAsync(){return Promise.resolve()}isIncomplete(){return!1}hasHistory(){return!0}hasUndo(){return!0}hasRedo(){return!0}undo(){}redo(){}zoomIn(){}zoomOut(){}setScale(e){}closeFlyout(){}clearCaches(){}loadFileAsync(e,t){return this.currSource=e.content,this.setDiagnostics(e,this.snapshotState()),Promise.resolve()}domUpdate(){}setDiagnostics(e,t){}setViewState(e){}saveToTypeScriptAsync(e=!1){return Promise.resolve(void 0)}highlightStatement(e,t){return!1}clearHighlightedStatements(){}setHighContrast(e){}hasEditorToolbar(){return!0}filterToolbox(e){}insertBreakpoint(){}updateBreakpoints(){}getBreakpoints(){return[]}updateToolbox(){}onExceptionDetected(e){r.warningNotification(lf("Program Error: {0}",null==e?void 0:e.exceptionMessage))}}},{"./core":279,"react/jsx-runtime":549}],346:[function(e,t,n){"use strict";var i=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};Object.defineProperty(n,"__esModule",{value:!0}),n.PlainCheckbox=n.ProgressCircle=n.Tooltip=n.Loader=n.Dimmer=n.Modal=n.Menu=n.MenuItem=n.Icon=n.Checkbox=n.Input=n.Field=n.helpIconLink=n.Link=n.CloseButton=n.Button=n.ButtonMenuItem=n.Item=n.Select=n.ExpandableMenu=n.DropdownMenu=n.StatelessUIElement=n.UIElement=n.genericContent=n.cx=n.appElement=void 0;const r=e("react/jsx-runtime"),o=e("react"),s=e("react-dom"),a=e("react-modal"),l=e("react-tooltip"),c=e("./data"),u=e("./core"),d=e("./auth"),h=e("./util");function p(e){return e.filter((e=>!!e&&""!=e.trim())).join(" ")}function f(e,t,n=!1){return`${e} ${n?"":t.icon&&t.text?"icon icon-and-text":t.icon?"icon":""} ${t.inverted?"inverted":""} ${t.className||""}`}function g(e){let t=[e.icon?(0,r.jsx)(n.Icon,{icon:e.icon+(e.text?" icon-and-text ":"")+(e.iconClass?" "+e.iconClass:"")},"iconkey"):null,e.text?(0,r.jsx)("span",Object.assign({className:"ui text"+(e.textClass?" "+e.textClass:"")},{children:e.text}),"textkey"):null];return e.icon&&e.rightIcon&&(t=t.reverse()),t}n.appElement=document.getElementById("content"),n.cx=p,n.genericContent=g;class m extends c.Component{}n.UIElement=m;class b extends c.PureComponent{}n.StatelessUIElement=b;n.DropdownMenu=class extends m{constructor(){super(...arguments),this.navigateToNextElement=(e,t,n)=>{const i=this.refs.dropdown,r=u.keyCodeFromEvent(e),o=e.currentTarget;40===r?(e.preventDefault(),e.stopPropagation(),n&&this.focus(n)):38===r?(e.preventDefault(),e.stopPropagation(),t?this.focus(t):(i.focus(),this.setState({open:!1}))):r!==u.SPACE_KEY&&r!==u.ENTER_KEY||(e.preventDefault(),e.stopPropagation(),o.click())},this.closeOnEscape=e=>{u.keyCodeFromEvent(e)===u.ESC_KEY&&(e.preventDefault(),this.refs.dropdown.focus(),this.isMouseDown=!0,this.hide())},this.handleClick=e=>{this.props.onClick&&!this.props.onClick()||this.toggle(),e.stopPropagation()},this.handleClose=()=>{this.isMouseDown=!1;const e=document.activeElement===this.refs.dropdown;this.setState({focus:e})},this.handleMouseDown=e=>{this.isMouseDown=!0,document.addEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleDocumentMouseUp=e=>{this.isMouseDown=!1,document.removeEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleFocus=e=>{const{focus:t}=this.state;t||this.setState({focus:!0})},this.handleBlur=e=>{this.isMouseDown||setTimeout((()=>{let e=this.isChildFocused();this.setState({focus:e})}),1)},this.captureMouseEvent=e=>{e.stopPropagation()},this.handleKeyDown=e=>{const t=u.keyCodeFromEvent(e);40===t?(e.preventDefault(),this.focusFirst=!0,this.show()):t!==u.SPACE_KEY&&t!==u.ENTER_KEY||(e.preventDefault(),this.toggle())}}show(){this.setState({open:!0,focus:!0})}hide(){this.setState({open:!1})}toggle(){this.state.open?this.hide():this.show()}focus(e){this.setActive(e),e.focus()}blur(e){this.isActive(e)&&pxt.BrowserUtils.removeClass(e,"active")}setActive(e){this.isActive(e)||pxt.BrowserUtils.addClass(e,"active")}isActive(e){return e&&pxt.BrowserUtils.containsClass(e,"active")}getChildren(){const e=this.refs.menu,t=[];for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];pxt.BrowserUtils.containsClass(i,"divider")||pxt.BrowserUtils.containsClass(i,"mobile")&&!pxt.BrowserUtils.isMobile()||t.push(i)}return t}isChildFocused(){return this.refs.menu.contains(document.activeElement)}componentDidMount(){const e=this.getChildren();for(let t=0;t<e.length;t++){const n=t>0?e[t-1]:void 0,i=e[t],r=t<e.length?e[t+1]:void 0;i.addEventListener("keydown",(e=>{this.navigateToNextElement(e,n,r)})),i.addEventListener("focus",(e=>{this.setActive(i)})),i.addEventListener("blur",(e=>{this.blur(i)})),t==e.length-1&&i.addEventListener("keydown",(e=>{const t=u.keyCodeFromEvent(e);e.shiftKey||t!==u.TAB_KEY||this.hide()}))}}componentDidUpdate(e,t){const n=this.getChildren();for(let e=0;e<n.length;e++)n[e].tabIndex=this.state.open?0:-1;if(t.open!=this.state.open&&this.state.open){const e=this.refs.dropdown,t=this.refs.menu;e.offsetLeft+t.offsetWidth>window.innerWidth&&pxt.BrowserUtils.addClass(t,"left")}!t.focus&&this.state.focus||t.focus&&!this.state.focus&&(this.isMouseDown||this.hide()),!t.open&&this.state.open?document.addEventListener("keydown",this.closeOnEscape):t.open&&!this.state.open&&(document.removeEventListener("keydown",this.closeOnEscape),this.handleClose()),this.focusFirst&&n.length>0&&(this.focus(n[0]),this.focusFirst=!1)}renderCore(){const{disabled:e,title:t,role:n,icon:i,className:o,titleContent:s,children:a,displayAbove:l,displayLeft:c,displayRight:u,dataTooltip:d}=this.props,{open:h}=this.state,f={role:n||"combobox","aria-disabled":e,"aria-haspopup":!!e,"aria-expanded":h},m={role:"menu","aria-label":lf("Dropdown menu {0}",t),"aria-hidden":!!h},b=p(["ui",h?"active visible":"","dropdown",i?"icon":"",o||"",l?"menuAbove":"",u?"menuRight":"",c?"menuLeft":"",e?"disabled":""]),y=p(["menu",h?"visible transition":""]);return(0,r.jsxs)("div",Object.assign({role:"listbox",ref:"dropdown",title:t},f,{id:this.props.id,className:b,"data-tooltip":d,onMouseDown:this.handleMouseDown,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0},{children:[s||g(this.props),(0,r.jsx)("div",Object.assign({ref:"menu"},m,{className:y,role:"menu",onMouseDown:this.captureMouseEvent,onClick:this.captureMouseEvent},{children:a}))]}))}};n.ExpandableMenu=class extends m{constructor(){super(...arguments),this.hide=()=>{this.setState({expanded:!1});const{onHide:e}=this.props;e&&e()},this.show=()=>{this.setState({expanded:!0});const{onShow:e}=this.props;e&&e()},this.toggleExpanded=()=>{const{expanded:e}=this.state;e?this.hide():this.show()}}render(){const{title:e,children:t}=this.props,{expanded:n}=this.state;return(0,r.jsxs)("div",Object.assign({className:"expandable-menu"},{children:[(0,r.jsx)(E,{className:"no-select menu-header",icon:"no-select chevron "+(n?"down":"right"),text:e,ariaExpanded:n,onClick:this.toggleExpanded,role:"button"}),n&&(0,r.jsx)("div",Object.assign({className:"expanded-items"},{children:t}))]}))}};n.Select=class extends m{constructor(e){super(e),this.handleOnChange=e=>{const{onChange:t}=this.props;this.setState({selected:e.target.value}),t&&t(e.target.value)};const{options:t}=e;this.state={selected:t[0]&&t[0].value+""}}render(){const{options:e,label:t,"aria-label":n}=this.props,{selected:i}=this.state;return(0,r.jsxs)("div",{children:[t&&`${t} `,(0,r.jsx)("select",Object.assign({value:i,className:"ui dropdown",onChange:this.handleOnChange,"aria-label":n},{children:e.map((e=>e&&(0,r.jsx)("option",Object.assign({"aria-selected":i===e.value,value:e.value},{children:e.display||e.value}),e.value)))}))]})}};class y extends c.Component{renderCore(){const{text:e,title:t,ariaLabel:n,ariaHidden:i}=this.props;return(0,r.jsxs)("div",Object.assign({className:f("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,"aria-label":this.props.role&&"presentation"!==this.props.role?n||t||e:"","aria-selected":this.props.active,"aria-hidden":i,title:t||e,tabIndex:this.props.tabIndex||0,"data-value":this.props.value,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onTouchStart:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onTouchEnd:this.props.onMouseUp,onMouseLeave:this.props.onMouseLeave,onKeyDown:this.props.onKeyDown||h.fireClickOnEnter},{children:[g(this.props),this.props.children]}),this.props.value)}}n.Item=y;n.ButtonMenuItem=class extends m{renderCore(){return(0,r.jsx)("div",Object.assign({className:f("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,title:this.props.title||this.props.text,tabIndex:this.props.tabIndex||0,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||h.fireClickOnEnter},{children:(0,r.jsxs)("div",Object.assign({className:f("ui button",this.props)},{children:[g(this.props),this.props.children]}))}),this.props.value)}};class v extends b{renderCore(){const{labelPosition:e,color:t,size:n,disabled:i,loading:o}=this.props,s=p([t,n,i||o?"disabled":"",o?"loading":"",f("ui button",this.props)]),a=(0,r.jsxs)("button",Object.assign({className:s,id:this.props.id,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,autoFocus:this.props.autoFocus},{children:[g(this.props),this.props.children]}));return this.props.tooltipId&&!pxt.BrowserUtils.isIOS()?(0,r.jsx)(I,Object.assign({id:this.props.tooltipId,content:this.props.tooltip||this.props.title,place:this.props.tooltipPlace,delayShow:this.props.tooltipDelayShow},{children:a})):a}}n.Button=v;class _ extends b{renderCore(){const{onClick:e}=this.props;return(0,r.jsx)("div",Object.assign({role:"button",className:"closeIcon",tabIndex:0,onClick:e,onKeyDown:h.fireClickOnEnter,"aria-label":lf("Close")},{children:(0,r.jsx)(n.Icon,{icon:"close remove circle"})}))}}n.CloseButton=_;class E extends b{renderCore(){return(0,r.jsxs)("a",Object.assign({className:f("ui",this.props)+(this.props.loading?" loading":"")+(this.props.disabled?" disabled":""),id:this.props.id,href:this.props.href,target:this.props.target,rel:this.props.rel||(this.props.target?"noopener noreferrer":""),download:this.props.download,ref:this.props.refCallback,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||h.fireClickOnEnter},{children:[g(this.props),this.props.children]}))}}n.Link=E,n.helpIconLink=function(e,t){return(0,r.jsx)(E,{className:"help-link",href:e,icon:"help circle",target:"_blank",role:"link",title:t})};class T extends c.Component{renderCore(){return(0,r.jsxs)("div",Object.assign({className:"field"},{children:[this.props.label?(0,r.jsx)("label",Object.assign({htmlFor:this.props.ariaLabel?void 0:this.props.htmlFor},{children:this.props.label})):null,this.props.ariaLabel&&this.props.htmlFor?(0,r.jsx)("label",Object.assign({htmlFor:this.props.htmlFor,className:"accessible-hidden"},{children:this.props.ariaLabel})):"",this.props.children]}))}}n.Field=T;class x extends c.Component{constructor(e){super(e),this.state={value:e.value},this.copy=this.copy.bind(this),this.handleClick=this.handleClick.bind(this),this.handleChange=this.handleChange.bind(this),this.handleEnterPressed=this.handleEnterPressed.bind(this)}componentDidMount(){const{selectOnMount:e,autoFocus:t}=this.props;e&&t&&this.refs.inputField.select()}UNSAFE_componentWillReceiveProps(e){this.setState({value:e.value})}clearValue(){this.setState({value:void 0})}copy(){this.setState({copied:!1});const e=this.props,t=s.findDOMNode(this);if(e.lines&&1!=e.lines){const e=t.getElementsByTagName("textarea")[0];e.focus(),e.setSelectionRange(0,9999)}else{const e=t.getElementsByTagName("input")[0];e.focus(),e.setSelectionRange(0,9999)}try{const e=document.execCommand("copy");pxt.debug("copy: "+e),this.setState({copied:!!e})}catch(e){this.setState({copied:!1})}}handleClick(e){this.props.selectOnClick&&e.target.setSelectionRange(0,9999)}handleChange(e){const t=e.target.value;this.props.readOnly||this.state&&this.state.value===t||this.setState({value:t,copied:!1}),this.props.onChange&&this.props.onChange(t)}handleEnterPressed(e){if(u.keyCodeFromEvent(e)===u.ENTER_KEY){const{onEnter:t}=this.props;t&&(e.preventDefault(),t())}}renderCore(){const e=this.props,{copy:t,error:n,ariaLabel:i,id:o,label:s,inputLabel:a,lines:l,autoFocus:c,placeholder:u,readOnly:d,autoComplete:h}=e,{value:p,copied:f}=this.state,g=t&&document.queryCommandSupported("copy")?(0,r.jsx)(v,{className:`ui right labeled ${f?"green":"primary"} icon button`,text:f?lf("Copied!"):lf("Copy"),icon:"copy",onClick:this.copy}):null;return(0,r.jsxs)(T,Object.assign({ariaLabel:i,htmlFor:o,label:s},{children:[(0,r.jsxs)("div",Object.assign({className:"ui input"+(e.inputLabel?" labelled":"")+(t?" action fluid":"")+(e.disabled?" disabled":"")},{children:[a?(0,r.jsx)("div",Object.assign({className:"ui label"},{children:a})):"",l&&1!=l?(0,r.jsx)("textarea",{id:o,className:"ui input "+(e.class||"")+(a?" labelled":""),rows:l,placeholder:u,value:p||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed}):(0,r.jsx)("input",{ref:"inputField",autoFocus:c,id:o,className:e.class||"",type:e.type||"text",placeholder:u,value:p||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed,autoComplete:h?"":"off",autoCorrect:h?"":"off",autoCapitalize:h?"":"off",spellCheck:h}),g]})),n?(0,r.jsx)("div",Object.assign({className:"ui yellow message"},{children:n})):void 0]}))}}n.Input=x;class w extends c.Component{constructor(e){super(e),this.state={},this.handleChange=this.handleChange.bind(this)}handleChange(e){this.props.onChange(e.currentTarget.checked)}renderCore(){const e=this.props;return(0,r.jsx)(T,Object.assign({label:e.label},{children:(0,r.jsxs)("div",Object.assign({className:"ui toggle checkbox"},{children:[(0,r.jsx)("input",{type:"checkbox",checked:e.checked,"aria-checked":e.checked,"aria-label":e.label||e.inputLabel,onChange:this.handleChange}),e.inputLabel?(0,r.jsx)("label",{children:e.inputLabel}):void 0]}))}))}}n.Checkbox=w;n.Icon=e=>{const{icon:t,className:n,onClick:o,onKeyDown:s,children:a}=e,l=i(e,["icon","className","onClick","onKeyDown","children"]);return(0,r.jsx)("i",Object.assign({className:`icon ${t} ${n||""}`,onClick:o,onKeyDown:s||h.fireClickOnEnter,"aria-hidden":!0,role:"presentation"},l,{children:a}))};class k extends c.Component{constructor(e){super(e),this.handleClick=e=>{const{onClick:t}=this.props;t&&t(e,this.props)}}renderCore(){const{active:e,children:t,className:i,color:o,content:s,fitted:a,header:l,icon:c,link:u,name:d,onClick:f,position:g,ariaControls:m,id:b,tabIndex:y,dataTooltip:v}=this.props,_=p([o,g,e?"active":"",!0===c||c&&!d&&!s?"icon":"",l?"header":"",u||f?"link":"",a?1==a?`${a}`:`fitted ${a}`:"","item",i]);return t?(0,r.jsx)("div",Object.assign({role:"menuitem",className:_,onClick:this.handleClick},{children:t})):(0,r.jsxs)("div",Object.assign({id:b,tabIndex:null!=y?y:-1,className:_,onClick:this.handleClick,onKeyDown:h.fireClickOnEnter,role:"tab","aria-controls":m,"aria-selected":e,"aria-label":`${s||d}`,"data-tooltip":v},{children:[c?(0,r.jsx)(n.Icon,{icon:c}):void 0,s||d]}),b)}}n.MenuItem=k;class S extends c.Component{constructor(e){super(e),this.handleKeyboardNavigation=e=>{const t=u.keyCodeFromEvent(e);let n=37===t||38===t,i=39===t||40===t;if(!n&&!i)return;let r,o=this.child(".item"),s=-1,a=0;for(;-1===s&&a<o.length;)pxt.BrowserUtils.containsClass(o[a],"active")&&(s=a),a++;-1!==s&&(n&&!pxt.Util.isUserLanguageRtl()||i&&pxt.Util.isUserLanguageRtl()?r=0===s?o[o.length-1]:o[s-1]:(i&&!pxt.Util.isUserLanguageRtl()||n&&pxt.Util.isUserLanguageRtl())&&(r=s===o.length-1?o[0]:o[s+1]),void 0!==r&&(r.click(),r.focus()))}}componentDidMount(){this.child(".item").forEach(((e,t)=>{e.onkeydown=this.handleKeyboardNavigation}))}renderCore(){const{attached:e,borderless:t,children:n,className:i,color:o,compact:s,fixed:a,floated:l,fluid:c,icon:u,inverted:d,pagination:h,pointing:f,secondary:g,size:m,stackable:b,tabular:y,text:v,vertical:_}=this.props,E=p(["ui",o,m,t?"borderless":"",s?"compact":"",c?"fluid":"",d?"inverted":"",h?"pagination":"",f?"pointing":"",g?"secondary":"",b?"stackable":"",v?"text":"",_?"vertical":"",e?1==e?"attached":`${e} attached `:"",l?1==l?"floated":`${l} floated`:"",u?1==u?"icon":`${u} icon`:"",y?1==y?"tabular":`${y} tabular`:"",a?`tabular ${y}`:"",i,"menu"]);return(0,r.jsx)("div",Object.assign({className:E,role:"tablist"},{children:n}))}}n.Menu=S;class C extends c.Component{constructor(e){super(e),this.setPositionAndClassNames=()=>{const{dimmer:e}=this.props;let t;e&&(t="dimmable dimmed","blurring"===e&&(t+=" blurring"));const n={},i=this.getRef();if(i){const{height:e}=i.getBoundingClientRect(),r=-Math.round(e/2),o=e>=window.innerHeight;this.state.marginTop!==r&&(n.marginTop=r),this.state.scrolling!==o&&(n.scrolling=o),o&&(t+=" scrolling")}this.state.mountClasses!==t&&(n.mountClasses=t),Object.keys(n).length>0&&(this.setState(n),this.props.onPositionChanged&&this.props.onPositionChanged(this.props)),this.animationRequestId=requestAnimationFrame(this.setPositionAndClassNames)},this.id=ts.pxtc.Util.guidGen(),this.state={},this.onRequestClose=this.onRequestClose.bind(this),this.afterOpen=this.afterOpen.bind(this)}afterOpen(){const{modalDidOpen:e}=this.props;this.setState({scrolling:!1}),this.setPositionAndClassNames(),e&&e(this.getRef())}onClose(){cancelAnimationFrame(this.animationRequestId)}getRef(){const e=this.refs.modal;return e&&e.node&&e.node.firstChild&&e.node.firstChild.firstChild}componentWillUnmount(){cancelAnimationFrame(this.animationRequestId)}onRequestClose(){const{onClose:e}=this.props;this.onClose(),e()}renderCore(){var e,t;const o=this.props,{isOpen:s,size:l,longer:c,basic:u,className:f,onClose:g,closeIcon:m,children:b,onKeyDown:y,header:T,headerIcon:x,headerClass:w,headerActions:k,helpUrl:S,description:C,closeOnDimmerClick:I,closeOnDocumentClick:O,closeOnEscape:N,shouldCloseOnEsc:R,shouldCloseOnOverlayClick:D,shouldFocusAfterRender:L,overlayClassName:M}=o,P=i(o,["isOpen","size","longer","basic","className","onClose","closeIcon","children","onKeyDown","header","headerIcon","headerClass","headerActions","helpUrl","description","closeOnDimmerClick","closeOnDocumentClick","closeOnEscape","shouldCloseOnEsc","shouldCloseOnOverlayClick","shouldFocusAfterRender","overlayClassName"]),{marginTop:B,scrolling:j,mountClasses:F}=this.state,$="fullscreen"==l,U=$&&!!m,H=p(["ui",l,c?"longer":"",u?"basic":"",j?"scrolling":"",m?"closable":"","modal transition visible active",f]),G=p([this.getData(d.HIGHCONTRAST)?"hc":"",F]),V={labelledby:T?this.id+"title":void 0,describedby:!$&&C?this.id+"description":this.id+"desc"},W={content:{marginTop:B}};return(0,r.jsxs)(a,Object.assign({isOpen:s,ref:"modal",appElement:n.appElement,onRequestClose:this.onRequestClose,onAfterOpen:this.afterOpen,shouldReturnFocusAfterClose:!0,shouldFocusAfterRender:L,shouldCloseOnEsc:R||N,shouldCloseOnOverlayClick:D||O||I,portalClassName:G,overlayClassName:`ui page modals dimmer transition ${M} ${s?"visible active":""}`,className:H,style:W,role:"dialog",aria:V},P,{children:[T||U||S?(0,r.jsxs)("div",Object.assign({id:this.id+"title",className:"header "+(w||"")},{children:[x&&(0,r.jsx)(n.Icon,{icon:x}),(0,r.jsx)("h3",Object.assign({className:"header-title",style:{margin:`0 ${S?"-20rem":"0"} 0 ${U?"-20rem":"0"}`}},{children:T})),U?(0,r.jsx)("div",Object.assign({className:"header-close"},{children:(0,r.jsxs)(v,Object.assign({className:"back-button large",title:lf("Go back"),onClick:g,tabIndex:0,onKeyDown:h.fireClickOnEnter},{children:[(0,r.jsx)(n.Icon,{icon:"arrow left"}),(0,r.jsx)("span",Object.assign({className:"ui text landscape only"},{children:lf("Go back")}))]}))})):void 0,S?(0,r.jsx)("div",Object.assign({className:"header-help"},{children:(0,r.jsx)("a",Object.assign({className:"ui icon help-button",href:S,target:"_docs",role:"link","aria-label":lf("Help on {0} dialog",T),title:lf("Help on {0} dialog",T)},{children:(0,r.jsx)(n.Icon,{icon:"help"})}))})):void 0]})):void 0,$&&k?(0,r.jsx)("div",Object.assign({className:"header-actions"},{children:k})):void 0,!$&&C?(0,r.jsx)("label",Object.assign({id:this.id+"description",className:"accessible-hidden"},{children:C})):void 0,(0,r.jsx)("div",Object.assign({id:this.id+"desc",className:`${c?"scrolling":""} ${k?"has-actions":""} content`},{children:b})),!$&&(this.props.actions&&this.props.actions.length||this.props.buttons&&this.props.buttons.length)?(0,r.jsxs)("div",Object.assign({className:"actions"},{children:[null===(e=this.props.actions)||void 0===e?void 0:e.map(((e,t)=>(0,r.jsx)("div",Object.assign({className:"left-action"},{children:e}),`action_left_${t}`))),null===(t=this.props.buttons)||void 0===t?void 0:t.map((e=>e.url?(0,r.jsx)(E,{icon:e.icon,text:e.label,title:e.title||e.label,className:`ui button approve ${e.icon?"icon right":""} ${e.label&&!e.urlButton?"labeled":""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,href:e.url,target:e.fileName?void 0:"_blank",download:e.fileName?pxt.Util.htmlEscape(e.fileName):void 0},`action_${e.label}`):(0,r.jsx)(A,Object.assign({},e,{labelPosition:e.labelPosition}),`action_${e.label}`)))]})):void 0,!$&&m&&(0,r.jsx)(_,{onClick:g})]}))}}n.Modal=C;class A extends c.PureComponent{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){!this.props.disabled&&this.props.onclick&&this.props.onclick()}renderCore(){const e=this.props;return(0,r.jsx)(v,{icon:e.icon,text:e.label,labelPosition:e.labelPosition,className:`approve ${e.icon?`icon ${e.labelPosition?e.labelPosition:"right"} labeled`:""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,onClick:this.handleClick,onKeyDown:h.fireClickOnEnter,ariaLabel:this.props.ariaLabel?this.props.ariaLabel:this.props.label,title:this.props.title})}}n.Dimmer=class extends m{render(){const e=this.props,{disabled:t,inverted:o,page:s,simple:l,closable:c,onClose:u,active:d,children:h}=e,f=i(e,["disabled","inverted","page","simple","closable","onClose","active","children"]),g=p(["ui dimmer",d?"active transition visible":"",t?"disabled":"",o?"inverted":"",s?"page":"",l?"simple":""]);return(0,r.jsx)(a,Object.assign({appElement:n.appElement,style:{content:{background:"none",border:"0"}},shouldCloseOnOverlayClick:c,onRequestClose:u,overlayClassName:g,role:"dialog"},f,{children:h}))}};n.Loader=class extends m{render(){const{active:e,children:t,disabled:n,inverted:i,size:o,className:s}=this.props,a=p(["ui loader",o,e?"active":"",n?"disabled":"",i?"inverted":"",t?"text":"",s]);return(0,r.jsx)("div",Object.assign({className:a},{children:t}))}};class I extends o.Component{constructor(e){super(e),this.state={}}render(){const e=this.props,{id:t,content:n,className:o}=e,s=i(e,["id","content","className"]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",Object.assign({"data-tip":"tooltip","data-for":t},{children:this.props.children})),(0,r.jsx)(l,Object.assign({id:t,className:`pxt-tooltip ${o||""}`,effect:"solid"},s,{children:n}))]})}}n.Tooltip=I;class O extends o.Component{constructor(e){super(e),this.radius=100/(2*Math.PI),this.view=2*this.radius+this.props.stroke}getPathStyle(){return{strokeWidth:this.props.stroke}}render(){let e=this.props,t=this.radius;return(0,r.jsx)("div",Object.assign({className:"progresscircle"},{children:(0,r.jsxs)("svg",Object.assign({viewBox:`0 0 ${this.view} ${this.view}`,"aria-labelledby":"circletitle",role:"img"},{children:[(0,r.jsxs)("title",Object.assign({id:"circletitle"},{children:["Currently on step ",e.progress," of ",e.steps]})),(0,r.jsx)("path",{style:this.getPathStyle(),strokeDasharray:`${Math.round(100*e.progress/e.steps)}, 100`,d:`M${this.view/2} ${e.stroke/2} a ${t} ${t} 0 0 1 0 ${2*t} a ${t} ${t} 0 0 1 0 -${2*t}`})]}))}))}}n.ProgressCircle=O;class N extends c.Component{constructor(e){super(e),this.state={isChecked:this.props.isChecked},this.setCheckedBit=this.setCheckedBit.bind(this)}setCheckedBit(){let e=!this.state.isChecked;this.props.onChange(e),this.setState({isChecked:e})}renderCore(){return(0,r.jsx)(w,{inputLabel:this.props.label,checked:this.state.isChecked,onChange:this.setCheckedBit})}}n.PlainCheckbox=N},{"./auth":194,"./core":279,"./data":282,"./util":352,react:548,"react-dom":491,"react-modal":505,"react-tooltip":540,"react/jsx-runtime":549}],347:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimeMachine=void 0;const i=e("react/jsx-runtime"),r=e("react"),o=e("./workspace"),s=e("../../react-common/components/controls/Tree"),a=e("react-dom"),l=e("../../react-common/components/controls/Button"),c=e("./core"),u=e("../../react-common/components/controls/FocusTrap"),d=e("../../react-common/components/util"),h=e("../../pxteditor/history");async function p(e,t,n){var i;const r=pxt.appTarget.versions.target;if(!n||n.timestamp<0)return{files:e,editorVersion:r};if("snapshot"===n.kind){const i=t.snapshots.find((e=>e.timestamp===n.timestamp));return f((0,h.applySnapshot)(e,i.text),i.editorVersion)}if("share"===n.kind){const e=t.shares.find((e=>e.timestamp===n.timestamp));return{files:await pxt.Cloud.downloadScriptFilesAsync(e.id),editorVersion:(null===(i=(await pxt.Cloud.downloadScriptMetaAsync(e.id)).versions)||void 0===i?void 0:i.target)||r}}let s=e;for(let e=0;e<t.entries.length;e++){const i=t.entries.length-1-e,r=t.entries[i];if(s=o.applyDiff(s,r),r.timestamp===n.timestamp)return f(s,i>0?t.entries[i-1].editorVersion:r.editorVersion)}return{files:s,editorVersion:r}}function f(e,t){e=Object.assign({},e);try{const n=JSON.parse(e[pxt.CONFIG_NAME]);n.targetVersions&&(n.targetVersions.target=t),e[pxt.CONFIG_NAME]=JSON.stringify(n,null,4)}catch(e){}return{files:e,editorVersion:t}}function g(e){return new Date(e).toLocaleTimeString(pxt.U.userLanguage(),{timeStyle:"short"})}function m(e){const t=new Date,n=t.getFullYear(),i=t.getMonth(),r=t.getDate(),o=new Date(e),s=o.getFullYear(),a=o.getMonth(),l=o.getDate(),c=Date.now()-e;return s!==n?o.toLocaleDateString(pxt.U.userLanguage(),{year:"numeric",month:"short",day:"numeric"}):i===a&&r===l?lf("Today"):c<1728e5?lf("Yesterday"):c<6912e5?lf("{0} days ago",Math.floor(c/864e5)):o.toLocaleDateString(pxt.U.userLanguage(),{month:"short",day:"numeric"})}function b(e){const t=(new Date).getFullYear(),n=new Date(e),i=n.getFullYear(),r=n.toLocaleDateString(pxt.U.userLanguage(),{year:i!==t?"numeric":void 0,month:"long",day:"numeric"}),o=g(e);return lf("{id:date,time}{0}, {1}",r,o)}function y(e){const t={},n=(e,n)=>{const i=new Date(e),r=new Date(i.toLocaleDateString(pxt.U.userLanguage(),{year:"numeric",month:"numeric",day:"numeric"})).getTime();t[r]||(t[r]=[]),t[r].push({label:g(e),timestamp:e,kind:n})};for(const t of e.entries)n(t.timestamp,"diff");for(const t of e.snapshots)n(t.timestamp,"snapshot");const i=Object.keys(t).sort(((e,t)=>parseInt(t)-parseInt(e)));for(const e of i){const n=t[e],i=[];for(const e of n){const t=i.findIndex((t=>t.label===e.label)),n=i[t];if(n)if(n.kind===e.kind)e.timestamp>n.timestamp&&i.splice(t,1,e);else{if("snapshot"===n.kind)continue;"diff"===n.kind&&i.splice(t,1,e)}else i.push(e)}t[e]=i}for(const t of e.shares)n(t.timestamp,"share");for(const e of i)t[e].sort(((e,t)=>t.timestamp-e.timestamp));const r={label:lf("Now"),timestamp:-1,kind:"snapshot"};return i.length&&function(e){const t=new Date,n=new Date(e);return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()&&t.getDate()==n.getDate()}(parseInt(i[0]))?t[i[0]].unshift(r):t[Date.now()]=[r],i.map((e=>({label:m(parseInt(e)),entries:t[e]})))}n.TimeMachine=e=>{var t;const{text:n,history:o,onProjectLoad:h,onProjectCopy:f}=e,[g,m]=r.useState(void 0),[v,_]=r.useState("loading"),[E,T]=r.useState(y(o)),x=r.useRef(),w=r.useRef(!1),k=r.useRef();r.useEffect((()=>{const e=x.current;let t,n=1;const i=[],r={},o=t=>{e.contentWindow.postMessage(t,"*")},s=e=>new Promise((s=>{const a=e=>{e.response=!0,e.id="time_machine_"+n++,r[e.id]={original:e,handler:s},o(e)};if(t){for(;i.length;)a(i.shift());e&&a(e)}else e&&i.push(e)})),a=e=>{const n=e.data;if("pxteditor"===n.type&&n.id&&r[n.id])return r[n.id].handler(n),void delete r[n.id];switch(n.action){case"newproject":t||(t=!0,_("loaded"),s());break;case"workspacesync":o({type:"pxthost",id:n.id,success:!0,projects:[]})}};let l,c=!1;const u=async e=>{if(c)l=e;else{if(c=!0,_("loading-project"),await s({type:"pxteditor",action:"importproject",project:{text:e}}),c=!1,l)return u(l),void(l=void 0);_("loaded-project")}};return k.current=u,window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}}),[]),r.useEffect((()=>{"loaded"===v&&k.current&&k.current(n)}),[v,k.current,n]),r.useEffect((()=>{T(y(o))}),[o]);const S=r.useCallback((async()=>{if(void 0===g)(0,c.hideDialog)();else{const{files:e,editorVersion:t}=await p(n,o,g);h(e,t,g.timestamp)}}),[g,h]),C=r.useCallback((async()=>{const{files:e,editorVersion:t}=await p(n,o,g);f(e,t,null==g?void 0:g.timestamp)}),[g,f]);let A=["timeMachine","controller","skillsMap","noproject","nocookiebanner"];(null===(t=pxt.appTarget)||void 0===t?void 0:t.appTheme.timeMachineQueryParams)&&(A=A.concat(pxt.appTarget.appTheme.timeMachineQueryParams));const I=A.map((e=>-1===e.indexOf("=")?`${e}=1`:e)).join("&"),O=`${window.location.origin+window.location.pathname}?${I}`;return(0,a.createPortal)((0,i.jsxs)(u.FocusTrap,Object.assign({className:"time-machine",onEscape:c.hideDialog},{children:[(0,i.jsxs)("div",Object.assign({className:"time-machine-header"},{children:[(0,i.jsx)("div",Object.assign({className:"time-machine-back-button"},{children:(0,i.jsx)(l.Button,{className:"menu-button",label:lf("Go Back"),title:lf("Go Back"),onClick:c.hideDialog,leftIcon:"fas fa-arrow-left"})})),(0,i.jsx)("div",Object.assign({className:"time-machine-actions-container"},{children:(0,i.jsxs)("div",Object.assign({className:"time-machine-actions"},{children:[(0,i.jsx)("div",Object.assign({className:"time-machine-label"},{children:g?b(g.timestamp):lf("Now")})),(0,i.jsx)(l.Button,{label:lf("Save a copy"),title:lf("Save a copy"),onClick:C}),(0,i.jsx)(l.Button,{label:lf("Restore"),title:lf("Restore"),onClick:S})]}))}))]})),(0,i.jsxs)("div",Object.assign({className:"time-machine-content"},{children:[(0,i.jsxs)("div",Object.assign({className:"time-machine-preview"},{children:[(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"common-spinner"})}),(0,i.jsx)("iframe",{style:{opacity:"loaded-project"!==v?0:1},ref:x,frameBorder:"0","aria-label":lf("Project preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",src:O})]})),(0,i.jsxs)("div",Object.assign({className:"time-machine-timeline"},{children:[(0,i.jsx)("h3",{children:lf("Version History")}),(0,i.jsx)("div",Object.assign({className:"time-machine-tree-container"},{children:(0,i.jsx)(s.Tree,{children:E.map(((e,t)=>(0,i.jsxs)(s.TreeItem,Object.assign({initiallyExpanded:0===t},{children:[(0,i.jsx)(s.TreeItemBody,{children:e.label}),(0,i.jsx)(s.Tree,Object.assign({role:"group"},{children:e.entries.map(((t,r)=>{const a=!g&&-1===t.timestamp||(null==g?void 0:g.kind)===t.kind&&(null==g?void 0:g.timestamp)===t.timestamp;let l;return l="share"===t.kind?lf("Select shared version from {0} at {1}",e.label,t.label):lf("Select project version from {0} at {1}",e.label,t.label),(0,i.jsx)(s.TreeItem,Object.assign({onClick:()=>(async e=>{if(k.current&&!w.current)if(-1===e.timestamp&&(e=void 0),m(e),void 0!==e){w.current=!0;try{const{files:t}=await p(n,o,e);k.current(t)}catch(t){"share"===e.kind?(0,c.warningNotification)(lf("Unable to fetch shared project. Are you offline?")):(0,c.warningNotification)(lf("Unable to restore project version. Try selecting a different version.")),m(void 0),k.current(n)}finally{w.current=!1}}else k.current(n)})(t),className:(0,d.classList)(a&&"selected",t.kind),title:l},{children:(0,i.jsxs)(s.TreeItemBody,{children:[t.label,"share"===t.kind&&(0,i.jsx)("i",{className:"fas fa-share-alt"})]})}),r)}))}))]}),t)))})}))]}))]}))]})),document.body)}},{"../../pxteditor/history":133,"../../react-common/components/controls/Button":146,"../../react-common/components/controls/FocusTrap":153,"../../react-common/components/controls/Tree":164,"../../react-common/components/util":187,"./core":279,"./workspace":354,react:548,"react-dom":491,"react/jsx-runtime":549}],348:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolboxStyle=n.ToolboxTrashIcon=n.ToolboxSearch=n.TreeGroup=n.TreeItem=n.TreeSeparator=n.TreeRow=n.CategoryItem=n.Toolbox=n.CategoryNameID=void 0;const i=e("react/jsx-runtime"),r=e("./data"),o=e("./sui"),s=e("./core"),a=e("./coretsx");var l=pxt.Util;const c=e("./util"),u=e("../../react-common/components/extensions/DeleteConfirmationModal"),d=e("blockly");var h;(h=n.CategoryNameID||(n.CategoryNameID={})).Loops="loops",h.Logic="logic",h.Variables="variables",h.Maths="Math",h.Functions="functions",h.Arrays="arrays",h.Text="text",h.Extensions="addpackage";const p="monaco";class f extends r.Component{constructor(e){super(e),this.handleRootElementRef=e=>{this.rootElement=e},this.state={categories:[],visible:!1,loading:!1,showAdvanced:!1,shouldAnimate:!pxt.shell.getToolboxAnimation()},this.setSelection=this.setSelection.bind(this),this.advancedClicked=this.advancedClicked.bind(this),this.recoverToolbox=this.recoverToolbox.bind(this),this.handleRemoveExtension=this.handleRemoveExtension.bind(this),this.deleteExtension=this.deleteExtension.bind(this),this.cancelDeleteExtension=this.cancelDeleteExtension.bind(this)}getElement(){return this.rootElement}hide(){this.setState({visible:!1})}showLoading(){this.setState({visible:!0,loading:!0})}show(){this.setState({visible:!0})}setSelectedItem(e){this.selectedItem=e}setPreviousItem(){if(this.selectedIndex>0){const e=--this.selectedIndex;let t=this.items[e];this.setSelection(t,e)}else if(this.state.showSearchBox){const e=this.refs.searchbox;e&&e.focus()}}setNextItem(){if(this.items.length-1>this.selectedIndex){const e=++this.selectedIndex;this.setSelection(this.items[e],e)}}setSearch(){const e=this.refs.searchbox;e&&e.focus()}clear(){this.clearSelection(),this.selectedIndex=0,this.selectedTreeRow=void 0}clearSelection(){this.setState({selectedItem:void 0,focusSearch:!1})}clearExpandedItem(){this.setState({expandedItem:void 0})}clearSearch(){this.setState({hasSearch:!1,searchBlocks:void 0,focusSearch:!1})}async handleRemoveExtension(e){this.setState({tryToDeleteNamespace:e})}setSelection(e,t,n){const{editorname:i,parent:r}=this.props,{nameid:o,subns:s,customClick:a}=e;pxt.tickEvent(`${i}.toolbox.click`,void 0,{interactiveConsent:!0});let l=s?o+s:o;if(this.state.selectedItem!=l||n){let n=!1;if(a&&(n=a(r)))return;n||(this.setState({selectedItem:l,expandedItem:o,focusSearch:!1}),this.selectedIndex=t,this.selectedTreeRow=e,e.advanced&&!this.state.showAdvanced&&this.showAdvanced(),a||this.showFlyout(e))}else this.clearSelection(),this.closeFlyout()}focus(){if(this.rootElement)if(this.selectedItem&&this.selectedItem.getTreeRow()){const e=this.selectedItem.props.treeRow,t=this.items.indexOf(e);this.setSelection(e,t,!0)}else this.selectFirstItem()}selectFirstItem(){this.items[0]&&this.setSelection(this.items[0],0,!0)}moveFocusToFlyout(){const{parent:e}=this.props;e.moveFocusToFlyout()}UNSAFE_componentWillReceiveProps(e){(this.props.editorname==p&&e.editorname!=p||e.editorname==p&&e.parent.parent.state.fullscreen&&this.state.shouldAnimate)&&(pxt.shell.setToolboxAnimation(),this.setState({shouldAnimate:!1}))}componentDidUpdate(e,t){t.visible==this.state.visible&&t.loading==this.state.loading&&t.showAdvanced==this.state.showAdvanced&&this.state.expandedItem==t.expandedItem||this.props.parent.resize(),this.state.hasSearch&&this.state.searchBlocks!=t.searchBlocks?this.refreshSearchItem():t.hasSearch&&!this.state.hasSearch&&"search"==this.state.selectedItem&&this.closeFlyout()}componentDidCatch(e,t){const{editorname:n}=this.props;pxt.tickEvent(`${n}.toolbox.crashed`,{error:e}),this.setState({hasError:!0})}componentWillUnmount(){this.props.editorname==p&&pxt.shell.setToolboxAnimation()}recoverToolbox(){this.setState({hasError:!1})}advancedClicked(){const{editorname:e}=this.props;pxt.tickEvent(`${e}.advanced`,void 0,{interactiveConsent:!0}),this.showAdvanced()}showAdvanced(){const{parent:e}=this.props;this.selectedItem&&this.selectedItem.props.treeRow&&this.selectedItem.props.treeRow.advanced&&(this.clear(),this.closeFlyout()),this.setState({showAdvanced:!this.state.showAdvanced})}getSearchBlocks(){const{parent:e}=this.props,{searchBlocks:t}=this.state;return t.map((e=>({name:e.qName,attributes:{blockId:e.id},builtinBlock:e.builtinBlock,builtinField:e.field})))}refreshSelection(){const{parent:e}=this.props;this.state.selectedItem&&this.selectedTreeRow&&(this.selectedTreeRow.customClick?this.selectedTreeRow.customClick(e):this.showFlyout(this.selectedTreeRow))}refreshSearchItem(){const e=_.getSearchTreeRow();this.showFlyout(e)}showFlyout(e){const{parent:t}=this.props;t.showFlyout(e)}async deleteExtension(e){this.setState({tryToDeleteNamespace:void 0}),await this.props.parent.parent.reloadHeaderAsync()}cancelDeleteExtension(){this.setState({tryToDeleteNamespace:void 0})}closeFlyout(){const{parent:e}=this.props;e.closeFlyout()}hasAdvancedCategories(){const{categories:e}=this.state;return e.some((e=>e.advanced))}getNonAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>!e.advanced))}getAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>e.advanced))}getAllCategoriesList(e){const{categories:t,hasSearch:n,expandedItem:i}=this.state,r=[];return n&&r.push(_.getSearchTreeRow()),t.forEach((t=>{r.push(t),t.subcategories&&(!e||e&&t.nameid==i)&&t.subcategories.forEach((e=>{r.push(e)}))})),r}shouldComponentUpdate(e,t){return this.state!=t}isRtl(){const{editorname:e}=this.props;return"monaco"!=e&&l.isUserLanguageRtl()}renderCore(){const{editorname:e,parent:t}=this.props,{showAdvanced:n,visible:r,loading:s,selectedItem:a,expandedItem:l,hasSearch:c,showSearchBox:d,hasError:h,tryToDeleteNamespace:p}=this.state;if(!r)return(0,i.jsx)("div",{style:{display:"none"}});const f=pxt.appTarget.appTheme,m=t.parent.state.tutorialOptions,y=!!m&&!!m.tutorial,v=!!f.topBlocks&&!y,E=y;if(s||h)return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",Object.assign({className:"blocklyTreeRoot"},{children:(0,i.jsx)("div",{className:"blocklyTreeRow",style:{opacity:0}})})),s?(0,i.jsx)("div",Object.assign({className:"ui active dimmer"},{children:(0,i.jsx)("div",{className:"ui loader indeterminate"})})):void 0,h?(0,i.jsxs)("div",Object.assign({className:"ui"},{children:[lf("Toolbox crashed.."),(0,i.jsx)(o.Button,{icon:"refresh",onClick:this.recoverToolbox,text:lf("Reload"),className:"fluid"})]})):void 0]});const x=this.hasAdvancedCategories();let w=this.getNonAdvancedCategories();const k=x?this.getAdvancedCategories():[];this.items=this.getAllCategoriesList();const S=_.getSearchTreeRow(),C={nameid:"topblocks",name:lf("{id:category}Basic"),color:pxt.toolbox.getNamespaceColor("topblocks"),icon:pxt.toolbox.getNamespaceIcon("topblocks")},A=pxt.appTarget.appTheme,I=o.cx(["pxtToolbox",A.invertedToolbox?"invertedToolbox":"",A.coloredToolbox?"coloredToolbox":""]);let O=0,N=0;const R=n?"advancedexpanded":"advancedcollapsed";return(0,i.jsxs)("div",Object.assign({ref:this.handleRootElementRef,className:I,id:`${e}EditorToolbox`},{children:[(0,i.jsx)(T,{categories:this.items}),E&&(0,i.jsx)("div",Object.assign({className:"toolbox-title"},{children:lf("Toolbox")})),d?(0,i.jsx)(_,{ref:"searchbox",parent:t,toolbox:this,editorname:e}):void 0,(0,i.jsx)("div",Object.assign({className:"blocklyTreeRoot"},{children:(0,i.jsxs)("div",Object.assign({role:"tree"},{children:[p?(0,i.jsx)(u.DeleteConfirmationModal,{ns:p,onCancelClick:this.cancelDeleteExtension,onDeleteClick:this.deleteExtension}):void 0,c?(0,i.jsx)(g,{toolbox:this,index:O++,selected:"search"==a,treeRow:S,onCategoryClick:this.setSelection},"search"):void 0,v?(0,i.jsx)(g,{toolbox:this,selected:"topblocks"==a,treeRow:C,onCategoryClick:this.setSelection},"topblocks"):void 0,w.map((e=>(0,i.jsx)(g,Object.assign({toolbox:this,index:O++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection,topRowIndex:N++,shouldAnimate:this.state.shouldAnimate,hasDeleteButton:e.allowDelete,onDeleteClick:this.handleRemoveExtension},{children:e.subcategories?e.subcategories.map((e=>(0,i.jsx)(g,{index:O++,toolbox:this,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection},e.nameid+e.subns))):void 0}),e.nameid))),x?(0,i.jsx)(b,{},"advancedseparator"):void 0,x?(0,i.jsx)(g,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.advancedTitle(),color:pxt.toolbox.getNamespaceColor("advanced"),icon:pxt.toolbox.getNamespaceIcon(R),advancedButtonState:R},onCategoryClick:this.advancedClicked,topRowIndex:N++}):void 0,n?k.map((e=>(0,i.jsx)(g,Object.assign({toolbox:this,index:O++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection},{children:e.subcategories?e.subcategories.map((e=>(0,i.jsx)(g,{toolbox:this,index:O++,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection},e.nameid))):void 0}),e.nameid))):void 0]}))}))]}))}}n.Toolbox=f;class g extends r.Component{constructor(e){super(e),this.handleTreeRowRef=e=>{this.treeRowElement=e},this.state={selected:e.selected},this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}getTreeRow(){return this.treeRowElement}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.selected&&(t.selected=e.selected),Object.keys(t).length>0&&this.setState(t)}componentDidUpdate(e,t){const{toolbox:n}=this.props;this.state.selected&&(this.props.toolbox.setSelectedItem(this),n.state.focusSearch||a.dialogIsShowing()||this.focusElement())}focusElement(){this.treeRowElement.focus()}handleClick(e){const{treeRow:t,onCategoryClick:n,index:i}=this.props;n&&n(t,i),e.preventDefault(),e.stopPropagation()}handleKeyDown(e){var t,n;const{toolbox:i}=this.props,r=l.isUserLanguageRtl(),o=d.getMainWorkspace(),a=o.keyboardAccessibilityMode,u=a&&(null===(n=null===(t=i.props.parent.navigationController)||void 0===t?void 0:t.navigation)||void 0===n?void 0:n.getState(o)),h=a?83:40,p=a?87:38,f=a?65:37,g=a?68:39,m=s.keyCodeFromEvent(e);a&&"toolbox"!=u?a&&"flyout"==u&&(m==f&&!r||m==g&&r)&&(this.focusElement(),e.stopPropagation()):m==h?this.nextItem():m==p?this.previousItem():m==g&&!r||m==f&&r?i.moveFocusToFlyout():27==m?i.closeFlyout():m==s.ENTER_KEY||m==s.SPACE_KEY?c.fireClickOnEnter.call(this,e):m==s.TAB_KEY||37==m||39==m||17==m||16==m||91==m||a||i.setSearch()}previousItem(){const{toolbox:e,childrenVisible:t}=this.props,n=e.props.editorname;pxt.tickEvent(`${n}.toolbox.keyboard.prev"`,void 0,{interactiveConsent:!0}),e.setPreviousItem()}nextItem(){const{toolbox:e,childrenVisible:t}=this.props,n=e.props.editorname;pxt.tickEvent(`${n}.toolbox.keyboard.next"`,void 0,{interactiveConsent:!0}),e.setNextItem()}renderCore(){const{toolbox:e,childrenVisible:t,hasDeleteButton:n}=this.props,{selected:r}=this.state;return(0,i.jsxs)(y,{children:[(0,i.jsx)(m,Object.assign({ref:this.handleTreeRowRef,isRtl:e.isRtl()},this.props,{selected:r,onClick:this.handleClick,onKeyDown:this.handleKeyDown,hasDeleteButton:n})),(0,i.jsx)(v,Object.assign({visible:t},{children:this.props.children}))]})}}n.CategoryItem=g;class m extends r.Component{constructor(e){super(e),this.baseAnimationDelay=1,this.animationDelay=.15,this.brandIcons={"":"usb","":"accessible-icon","":"adn","":"pied-piper-pp","":"steam","":"bluetooth-b","":"rebel","":"maxcdn","":"joomla","":"sellsy","":"connectdevelop","":"github-alt"},this.handleTreeRowRef=e=>{this.treeRow=e},this.state={},this.handleDeleteClick=this.handleDeleteClick.bind(this)}focus(){this.treeRow&&this.treeRow.focus()}getProperties(){const{treeRow:e}=this.props;return e}getMetaColor(){const{color:e}=this.props.treeRow;return pxt.toolbox.convertColor(e)||pxt.toolbox.getNamespaceColor("default")}handleDeleteClick(e){e.stopPropagation(),this.props.onDeleteClick(this.props.treeRow.nameid)}renderCore(){const{selected:e,onClick:t,onKeyDown:n,isRtl:r,topRowIndex:o,hasDeleteButton:s,onDeleteClick:a}=this.props,{nameid:u,advancedButtonState:d,subns:h,name:p,icon:f}=this.props.treeRow,g=pxt.appTarget.appTheme,m=this.getMetaColor(),b=g.blocklyOptions&&g.blocklyOptions.toolboxOptions&&g.blocklyOptions.toolboxOptions.invertedMultiplier||.3;let y={paddingLeft:"0px","--block-meta-color":m,"--block-faded-color":pxt.toolbox.fadeColor(m||"#ddd",b,!1)},v="blocklyTreeRow"+(e?" blocklyTreeSelected":"");o&&this.props.shouldAnimate&&(y.animationDelay=`${o*this.animationDelay+this.baseAnimationDelay}s`,v+=" blocklyTreeAnimate");let _=`blocklyTreeIcon${h?"more":f?(u||f).toLowerCase():"Default"}`.replace(/\s/g,""),E=h?pxt.toolbox.getNamespaceIcon("more"):f||pxt.toolbox.getNamespaceIcon("default");const T=E.length>1;let x={"--image-icon-url":T?`url("${l.pathJoin(pxt.webConfig.commitCdnUrl,encodeURI(f))}")!important`:void 0,display:"inline-block"};T&&(_+=" image-icon",E=void 0);const w=p||l.capitalize(h||u),k=d||u,S=!h&&Object.keys(this.brandIcons).includes(f)?"brandIcon":"";return(0,i.jsxs)("div",Object.assign({role:"button",ref:this.handleTreeRowRef,className:v,style:y,tabIndex:0,"data-ns":k,"aria-label":lf("Toggle category {0}",w),"aria-expanded":e,onClick:t,onContextMenu:t,onKeyDown:n||c.fireClickOnEnter},{children:[(0,i.jsx)("span",{className:"blocklyTreeIcon",role:"presentation"}),(0,i.jsx)("span",Object.assign({style:x,className:`blocklyTreeIcon ${_} ${S}`,role:"presentation"},{children:E})),(0,i.jsx)("span",Object.assign({className:"blocklyTreeLabel"},{children:w})),s?(0,i.jsx)("i",{className:"blocklyTreeButton icon times circle",onClick:this.handleDeleteClick}):void 0]}))}}n.TreeRow=m;class b extends r.Component{renderCore(){return(0,i.jsx)(y,{children:(0,i.jsx)("div",Object.assign({className:"blocklyTreeSeparator"},{children:(0,i.jsx)("span",{style:{display:"inline-block"},role:"presentation"})}))})}}n.TreeSeparator=b;class y extends r.Component{renderCore(){const{selected:e}=this.props;return(0,i.jsx)("div",Object.assign({role:"treeitem","aria-selected":e},{children:this.props.children}))}}n.TreeItem=y;class v extends r.Component{renderCore(){const{visible:e}=this.props;return this.props.children?(0,i.jsx)("div",Object.assign({role:"tree",style:{backgroundPosition:"0px 0px",display:e?"":"none"}},{children:this.props.children})):(0,i.jsx)("div",{})}}n.TreeGroup=v;class _ extends r.Component{constructor(e){super(e),this.search=l.debounce((()=>{this.searchImmediate()}),300,!1),this.state={},this.searchImmediate=this.searchImmediate.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleChange=this.handleChange.bind(this)}static getSearchTreeRow(){return{nameid:"search",name:lf("{id:category}Search"),color:pxt.toolbox.getNamespaceColor("search"),icon:pxt.toolbox.getNamespaceIcon("search")}}handleChange(){this.search()}handleKeyDown(e){const{toolbox:t}=this.props;40===("number"==typeof e.which?e.which:e.keyCode)&&t.selectFirstItem()}focus(){this.refs.searchInput.focus()}searchImmediate(){const{parent:e,toolbox:t,editorname:n}=this.props,i=this.refs.searchInput.value;let r="",o=!1;pxt.tickEvent(`${n}.search`,void 0,{interactiveConsent:!0}),e.searchAsync(i).then((e=>{r=0==e.length?lf("No search results..."):lf("{0} result matching '{1}'",e.length,i.toLowerCase()),o=""!=i;const n={};n.hasSearch=o,n.searchBlocks=e,n.focusSearch=!0,o&&(n.selectedItem="search"),t.setState(n),this.setState({searchAccessibilityLabel:r})}))}renderCore(){const{searchAccessibilityLabel:e}=this.state;return(0,i.jsx)("div",Object.assign({id:"blocklySearchArea"},{children:(0,i.jsxs)("div",Object.assign({id:"blocklySearchInput",className:"ui fluid icon input",role:"search"},{children:[(0,i.jsx)("input",{ref:"searchInput",type:"text",placeholder:lf("Search..."),onFocus:this.searchImmediate,onKeyDown:this.handleKeyDown,onChange:this.handleChange,id:"blocklySearchInputField",className:"blocklySearchInputField","aria-label":lf("Search"),autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),(0,i.jsx)("i",{className:"search icon",role:"presentation","aria-hidden":"true"}),(0,i.jsxs)("div",Object.assign({className:"accessible-hidden",id:"blocklySearchLabel","aria-live":"polite"},{children:[" ",e," "]}))]}))}))}}n.ToolboxSearch=_;class E extends r.Component{constructor(e){super(e)}getStyle(){let e={opacity:0,display:"none"};if(this.props.flyoutOnly){let t=document.querySelector(".blocklyFlyout");t&&(e.left=t.clientWidth/2,e.transform="translateX(-45%)")}return e}renderCore(){return(0,i.jsx)("div",Object.assign({id:"blocklyTrashIcon",style:this.getStyle()},{children:(0,i.jsx)("i",{className:"trash icon","aria-hidden":"true"})}))}}n.ToolboxTrashIcon=E;class T extends r.Component{renderCore(){const{categories:e}=this.props;return(0,i.jsx)("style",{children:e.filter((e=>!!e.color)).map((e=>`span.docs.inlineblock.${e.nameid.toLowerCase()} {\n                    background-color: ${e.color};\n                    border-color: ${pxt.toolbox.fadeColor(e.color,.1,!1)};\n                }`))})}}n.ToolboxStyle=T},{"../../react-common/components/extensions/DeleteConfirmationModal":166,"./core":279,"./coretsx":280,"./data":282,"./sui":346,"./util":352,blockly:376,"react/jsx-runtime":549}],349:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolboxEditor=void 0;const i=e("./srceditor"),r=e("./compiler");class o extends i.Editor{constructor(){super(...arguments),this.extensionsMap={},this.subcategoryMap={},this.topBlocks=[]}shouldShowBlock(e,t,n){var i;const r=this.parent.state.editorState&&this.parent.state.editorState.filters;if(r){const o=r.blocks&&(r.blocks[e]||this.blockIdMap&&(null===(i=this.blockIdMap[e])||void 0===i?void 0:i.some((e=>r.blocks[e])))),s=r.namespaces&&r.namespaces[t];if(null!=o&&0==o&&!n)return!1;if(null!=o)return!0;if(null!=s&&0==s)return!1;if(null!=s)return!0;if(null!=r.defaultState&&0==r.defaultState&&!n)return!1}return!0}shouldShowCustomCategory(e){const t=this.parent.state.editorState&&this.parent.state.editorState.filters;return!t||!("variables"!==e||t.blocks&&!t.blocks.variables_set&&!t.blocks.variables_get&&!t.blocks.variables_change||t.namespaces&&2===t.namespaces.variables)||!("functions"!==e||!(!t.blocks||t.blocks.function_definition||t.blocks.function_call||t.blocks.procedures_defnoreturn||t.blocks.procedures_callnoreturn)||t.namespaces&&2===t.namespaces.functions)}getSearchSubset(){if(!this.searchSubset&&this.blockInfo){this.searchSubset={};const e=this.searchSubset;let t=pxt.blocks.blockDefinitions();for(const n in t){const i=t[n];this.shouldShowBlock(n,i.category)&&(e[n]=!0)}this.blockInfo.blocks.forEach((t=>{let n=(t.attributes.blockNamespace||t.namespace).split(".")[0];t.attributes.debug&&!pxt.options.debug||t.attributes.blockHidden||t.attributes.deprecated&&null==this.parent.state.tutorialOptions||this.shouldShowBlock(t.attributes.blockId,n)&&(e[t.attributes.blockId]=!0)}))}return this.searchSubset}searchAsync(e){const t={term:e,subset:this.getSearchSubset()};return r.apiSearchAsync(t).then((e=>e)).then((t=>(pxt.debug("searching for: "+e),t)))}clearCaches(){super.clearCaches(),this.searchSubset=void 0,this.blockGroupsCache=void 0}getAllCategories(){return this.getToolboxCategories(!1).concat(this.getToolboxCategories(!0))}getToolboxCategories(e){if(!this.blockInfo)return[];let t=this;return function(e,n){return e.sort((([,e],[,t])=>(t&&t.weight||50)>=(e&&e.weight||50)?1:-1)).map((([e,i])=>{const r=t.isBuiltIn(e),o=r?t.getBuiltinCategory(e):void 0,s=t.getBlocksForCategory(e).filter((n=>t.shouldShowBlock(n.attributes.blockId,e))),a=t.extensionsMap[e],l=o&&o.customClick;let c;if((i.subcategories&&i.subcategories.length||t.subcategoryMap[e])&&(c=function(e,n,i){return n.map((n=>{const r=e[0],o=e[1],s=t.getBlocksForCategory(r,n).filter((e=>t.shouldShowBlock(e.attributes.blockId,r)));if(!s.length)return;const a=pxt.Util.rlf(`{id:subcategory}${n}`);return{nameid:r,name:a,subns:n,color:o.color,icon:o.icon,groups:o.groups,groupIcons:o.groupIcons,groupHelp:o.groupHelp,labelLineWidth:o.labelLineWidth,blocks:s,advanced:i}})).filter((e=>!!e))}([e,i],i.subcategories||Object.keys(t.subcategoryMap[e]),n)),!(s.length||a||l||c&&c.length))return;if(l&&!t.shouldShowCustomCategory(e))return;let u={nameid:e,name:i.block?i.block:void 0,color:i.color,icon:i.icon,groups:i.groups,groupIcons:i.groupIcons,groupHelp:i.groupHelp,labelLineWidth:i.labelLineWidth,blocks:s,subcategories:c,advanced:n};return r&&(u.name=o.name,u.icon=i.icon?pxt.toolbox.getNamespaceIcon(i.icon)||i.icon:pxt.toolbox.getNamespaceIcon(e),u.groups=o.groups||i.groups,u.customClick=o.customClick),u})).filter((e=>!!e))}(this.getNamespaces().map((e=>[e,t.getNamespaceAttrs(e)])).filter((([,n])=>!(n.deprecated&&null==t.parent.state.tutorialOptions)&&(e?n.advanced:!n.advanced))),e)}moveFocusToFlyout(){}abstractShowFlyout(e){const{nameid:t,name:n,subns:i,icon:r,color:o,labelLineWidth:s,blocks:a}=e,l=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if(!a||!a.length)return!1;pxt.appTarget.appTheme.hideFlyoutHeadings||this.showFlyoutHeadingLabel(t,n,i,r,o);let c=this.getBlockGroups(e);for(let e=0;e<c.length;++e){let n=c[e];n.blocks&&n.blocks.length&&(n.name==pxt.DEFAULT_GROUP_NAME||l||1==c.length||this.showFlyoutGroupLabel(n.name,n.icon,s,n.hasHelp?"help":""),this.showFlyoutBlocks(t,o,n.blocks))}return!0}getNamespaceAttrs(e){const t=this.blockInfo.apis.byQName[e];if(t)return t.attributes;if(this.extensionsMap[e]){const t=this.extensionsMap[e];return{weight:0,blockId:t.name,color:t.extension.color||"#7f8c8d",advanced:t.extension.advanced||!1,callingConvention:0,paramDefl:{}}}}getNamespaces(){const e=[];return this.extensions.forEach((t=>{const n=t.config,i=n.name,r=n.extension.namespace||i;this.extensionsMap[r]||(this.extensionsMap[r]=n),e.filter((e=>e==r))||e.push(i)})),e}getTopBlocks(){return this.topBlocks.sort(((e,t)=>{const n=e.attributes.topblockWeight||e.attributes.weight||50;return(t.attributes.topblockWeight||t.attributes.weight||50)>=n?1:-1}))}getBlockGroups(e){var t,n;const i=e.nameid+(e.subns||"");if(this.blockGroupsCache||(this.blockGroupsCache={}),!this.blockGroupsCache[i]){const{groups:r,groupIcons:o,groupHelp:s,blocks:a}=e;let l=r||[];a.forEach((e=>{let t=e.attributes&&e.attributes.group||pxt.DEFAULT_GROUP_NAME;l.indexOf(t)<0&&l.push(t)}));let c=[];if(l)for(let e=0;e<l.length;e++){let t=l[e],n=a.filter((e=>(e.attributes.group||pxt.DEFAULT_GROUP_NAME)==t)).sort(((e,t)=>(t.attributes.weight||50)+(t.attributes.advanced?0:1e3)>(e.attributes.weight||50)+(e.attributes.advanced?0:1e3)?1:-1));n&&n.length>0&&c.push({name:t,icon:o&&o[e]||"",hasHelp:s&&!!s[e],blocks:n})}if(null===(n=null===(t=this.parent.state)||void 0===t?void 0:t.editorState)||void 0===n?void 0:n.filters)return c;this.blockGroupsCache[i]=c}return this.blockGroupsCache[i]}}n.ToolboxEditor=o},{"./compiler":204,"./srceditor":345}],350:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkspaceHeader=n.TutorialCard=n.TutorialHint=n.TutorialStepCircle=n.TutorialMenuItemLink=n.TutorialMenuItem=n.TutorialMenu=n.getUsedBlocksAsync=void 0;const i=e("react/jsx-runtime"),r=e("react-dom"),o=e("blockly"),s=e("./data"),a=e("./sui"),l=e("./sounds"),c=e("./core"),u=e("./marked"),d=e("./compiler"),h=e("./hinttooltip"),p=e("./editortoolbar"),f=e("./immersivereader"),g=e("./util"),m=e("../../pxtblocks");function b(e,t,n,i,r=!1){const o={},s={},a={},l={};return d.getBlocksAsync().then((t=>(m.initializeAndInject(t),"python"==n?d.decompilePySnippetstoXmlAsync(e):d.decompileSnippetstoXmlAsync(e)))).then((n=>{var c;if((null==n?void 0:n.length)>0){let u;for(let i=0;i<n.length;i++){const r=n[i],d=pxt.BrowserUtils.getTutorialCodeHash([e[i]]);if(!(u=m.loadWorkspaceXml(r,!1,{keepMetaComments:!0})))throw pxt.debug(`used blocks xml failed to load\n${r}`),new Error("blocksXml failed to load");const h=u.getAllBlocks(!1);o[d]={},a[d]={},l[d]={};for(let n=0;n<h.length;++n){const r=h[n];"typescript_statement"==r.type?pxt.tickEvent("tutorial.usedblocks.greyblock",{tutorial:t,code:null===(c=e[i])||void 0===c?void 0:c.substring(0,2e3)}):r.isShadow()||(o[d][r.type]||(o[d][r.type]=0),o[d][r.type]=o[d][r.type]+1,s[r.type]=1);let u=r.getCommentText();for(u&&/@highlight/.test(u)&&(a[d][r.type]||(a[d][r.type]=0),a[d][r.type]=a[d][r.type]+1);u&&/@\S+/.test(u);){const e=u.match(/@(\S+)/)[1];u=u.replace(/@\S+/,""),l[d][e]||(l[d][e]=[]),l[d][e].push(r.type)}}}null==u||u.dispose(),pxt.options.debug&&pxt.debug(JSON.stringify(o,null,2));try{i&&!r&&i.setAsync(t,o,e,a,l)}catch(e){pxt.log("Unable to cache used blocks in DB")}pxt.tickEvent("tutorial.usedblocks.computed",{tutorial:t})}else if((null==e?void 0:e.length)>0)throw new Error("Failed to decompile");return{snippetBlocks:o,usedBlocks:s,highlightBlocks:a,validateBlocks:l}})).catch((e=>{throw pxt.reportException(e),new Error("Failed to decompile tutorial")}))}n.getUsedBlocksAsync=function(e,t,n,i=!1){var r;if(!e)return Promise.resolve(void 0);if((null===(r=pxt.appTarget)||void 0===r?void 0:r.tutorialInfo)&&!i){const n=pxt.BrowserUtils.getTutorialCodeHash(e);if(pxt.appTarget.tutorialInfo[n])return pxt.tickEvent("tutorial.usedblocks.cached",{tutorial:t}),Promise.resolve(pxt.appTarget.tutorialInfo[n])}return pxt.BrowserUtils.tutorialInfoDbAsync().then((r=>r.getAsync(t,e).then((o=>(null==o?void 0:o.blocks)&&Object.keys(o.blocks).length>0&&!i?(pxt.tickEvent("tutorial.usedblocks.indexeddb",{tutorial:t}),(null==o?void 0:o.snippets)||b(e,t,n,r,i),Promise.resolve({snippetBlocks:o.snippets,usedBlocks:o.blocks,highlightBlocks:o.highlightBlocks,validateBlocks:o.validateBlocks})):b(e,t,n,r,i))).catch((o=>b(e,t,n,r,i))))).catch((r=>b(e,t,n,null,i)))};class y extends s.Component{constructor(e){super(e);let t=this.props.parent.state.tutorialOptions;this.hasActivities=t&&t.tutorialActivityInfo&&t.tutorialActivityInfo.length>1}renderCore(){var e;let t=this.props.parent.state.tutorialOptions;const n=null===(e=t.tutorialStepInfo)||void 0===e?void 0:e[t.tutorialStep].headerContentMd,r=pxt.appTarget.appTheme.immersiveReader;return this.hasActivities?(0,i.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,i.jsx)(E,{parent:this.props.parent}),r&&(0,i.jsx)(f.ImmersiveReaderButton,{content:n,tutorialOptions:t})]})):t.tutorialStepInfo.length<8?(0,i.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,i.jsx)(v,{parent:this.props.parent}),r&&(0,i.jsx)(f.ImmersiveReaderButton,{content:n,tutorialOptions:t})]})):(0,i.jsxs)("div",Object.assign({className:"menu tutorial-menu"},{children:[(0,i.jsx)(v,{parent:this.props.parent,className:"mobile hide"}),(0,i.jsx)(E,{parent:this.props.parent,className:"mobile only"}),r&&(0,i.jsx)(f.ImmersiveReaderButton,{content:n,tutorialOptions:t})]}))}}n.TutorialMenu=y;class v extends s.Component{constructor(e){super(e),this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:n}=this.props.parent.state.tutorialOptions,r=n;if(!e)return(0,i.jsx)("div",{});function o(e){return t.length<8||0==e||e==t.length-1||Math.abs(e-r)<2?"":"mobile hide"}return(0,i.jsx)("div",Object.assign({className:`ui item ${this.props.className}`},{children:(0,i.jsx)("div",Object.assign({className:"ui item tutorial-menuitem",role:"menubar"},{children:t.map(((t,n)=>n==r?(0,i.jsx)("span",Object.assign({className:"step-label"},{children:(0,i.jsx)(_,Object.assign({index:n,className:`ui circular label ${r==n?"blue selected":"inverted"} ${e?"":"disabled"}`,ariaLabel:lf("Tutorial step {0}. This is the current step",n+1),onClick:this.openTutorialStep},{children:n+1}))}),"tutorialStep"+n):(0,i.jsx)("span",Object.assign({className:`ui step-label ${o(n)}`,"data-tooltip":`${n+1}`,"data-inverted":"","data-position":"bottom center"},{children:(0,i.jsx)(_,{index:n,className:`ui empty circular label ${e?"":"disabled"} clear`,ariaLabel:lf("Tutorial step {0}",n+1),onClick:this.openTutorialStep})}),"tutorialStep"+n)))}))}))}}n.TutorialMenuItem=v;class _ extends s.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.index)}}renderCore(){const{className:e,ariaLabel:t,index:n}=this.props;return(0,i.jsx)("a",Object.assign({className:e,role:"menuitem","aria-label":t,tabIndex:0,onClick:this.handleClick,onKeyDown:g.fireClickOnEnter},{children:this.props.children}))}}n.TutorialMenuItemLink=_;class E extends s.Component{constructor(e){super(e),this.handleNextClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep+1)},this.handlePrevClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep-1)},this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:n}=this.props.parent.state.tutorialOptions,r=n,o=e&&0!=r,s=e&&r!=t.length-1;return e?(0,i.jsx)("div",Object.assign({id:"tutorialsteps",className:`ui item ${this.props.className}`},{children:(0,i.jsxs)("div",Object.assign({className:"ui item",role:"menubar"},{children:[(0,i.jsx)(a.Button,{role:"button",icon:"left chevron",disabled:!o,className:"prevbutton left "+(o?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.handlePrevClick,onKeyDown:g.fireClickOnEnter}),(0,i.jsxs)("span",Object.assign({className:"step-label"},{children:[(0,i.jsx)(a.ProgressCircle,{progress:r+1,steps:t.length,stroke:4.5}),(0,i.jsx)("span",Object.assign({className:"ui circular label blue selected "+(e?"":"disabled"),"aria-label":lf("You are currently at tutorial step {0}.")},{children:n+1}))]}),"tutorialStep"+r),(0,i.jsx)(a.Button,{role:"button",icon:"right chevron",disabled:!s,rightIcon:!0,className:"nextbutton right "+(s?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.handleNextClick,onKeyDown:g.fireClickOnEnter})]}))})):(0,i.jsx)("div",{})}}n.TutorialStepCircle=E;class T extends s.Component{constructor(e){super(e),this.setRef=e=>{this.elementRef=e},this.next=this.next.bind(this),this.showHint=this.showHint.bind(this),this.closeHint=this.closeHint.bind(this)}next(){const e=this.props.parent.state.tutorialOptions,{tutorialStep:t,tutorial:n}=e;this.setState({visible:!1});const i=t+1;pxt.tickEvent("tutorial.hint.next",{tutorial:n,step:i}),this.props.parent.setTutorialStep(i)}showHint(e,t){e&&o.hideChaff(),this.setState({visible:e,showFullText:t})}closeHint(){this.showHint(!1,this.state.showFullText)}renderCore(){const{visible:e}=this.state,t=this.props.parent.state.tutorialOptions,{tutorialReady:n,tutorialStepInfo:r,tutorialStep:o,tutorialName:s}=t;if(!n)return(0,i.jsx)("div",{});const l=r[o],c=l.hintContentMd,d=l.contentMd,h=t.metadata.hideIteration,p=t.metadata.flyoutOnly,g=pxt.appTarget.appTheme.immersiveReader;if(l.showDialog){let n=o<r.length-1?this.next:this.closeHint,l=[];g&&l.push({className:"immersive-reader-button",onclick:async()=>{await f.launchImmersiveReaderAsync(d,t)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")}),l.push({label:h&&p?lf("Start"):lf("Ok"),onclick:n,icon:"check",className:"green"});const c=this.props.parent.createModalClasses("hintdialog");return(0,i.jsx)(a.Modal,Object.assign({isOpen:e,className:c,closeIcon:!1,header:s,buttons:l,onClose:n,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},{children:(0,i.jsx)(u.MarkedContent,{markdown:d,parent:this.props.parent})}))}return c?(0,i.jsx)("div",Object.assign({className:"tutorialhint no-select "+(e?"":"hidden"),ref:this.setRef},{children:(0,i.jsx)(u.MarkedContent,{markdown:this.state.showFullText?d:c,unboxSnippets:!0,parent:this.props.parent})})):(0,i.jsx)("div",{})}}n.TutorialHint=T;class x extends s.Component{constructor(e){super(e),this.closeLightboxOnEscape=e=>{27===c.keyCodeFromEvent(e)&&this.closeLightbox()},this.lastStep=-1;const t=this.props.parent.state.tutorialOptions;this.prevStep=t.tutorialStep,this.state={showSeeMore:!1,showHint:t.tutorialStepInfo[this.prevStep].showHint},this.toggleHint=this.toggleHint.bind(this),this.closeHint=this.closeHint.bind(this),this.hintOnClick=this.hintOnClick.bind(this),this.closeLightbox=this.closeLightbox.bind(this),this.tutorialCardKeyDown=this.tutorialCardKeyDown.bind(this),this.okButtonKeyDown=this.okButtonKeyDown.bind(this),this.previousTutorialStep=this.previousTutorialStep.bind(this),this.nextTutorialStep=this.nextTutorialStep.bind(this),this.finishTutorial=this.finishTutorial.bind(this),this.toggleExpanded=this.toggleExpanded.bind(this),this.onMarkdownDidRender=this.onMarkdownDidRender.bind(this),this.handleResize=this.handleResize.bind(this)}previousTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep-1;e.tutorialStep=t,pxt.tickEvent("tutorial.previous",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t)}nextTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep+1;e.tutorialStep=t,pxt.tickEvent("tutorial.next",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t)}finishTutorial(){this.closeLightbox(),this.removeHintOnClick(),this.props.parent.completeTutorialAsync()}closeLightbox(){l.tutorialNext(),document.documentElement.removeEventListener("keydown",this.closeLightboxOnEscape),this.props.parent.hideLightbox()}UNSAFE_componentWillUpdate(){document.documentElement.addEventListener("keydown",this.closeLightboxOnEscape)}tutorialCardKeyDown(e){if(c.keyCodeFromEvent(e)==c.TAB_KEY){e.preventDefault();const t=this.refs.tutorialok;r.findDOMNode(t).focus()}}okButtonKeyDown(e){c.keyCodeFromEvent(e)==c.TAB_KEY&&(e.preventDefault(),this.refs.tutorialmessage.focus())}componentDidUpdate(e,t){const n=this.props.parent.state.tutorialOptions,i=this.refs.tutorialmessage,r=this.props.parent.state.tutorialOptions.tutorialStep;if(r!=this.lastStep){const e=`fade ${r<this.lastStep?"right":"left"} in visible transition animating`;i.style.animationDuration="500ms",this.lastStep=r,pxsim.U.addClass(i,e),pxt.Util.delay(500).then((()=>pxsim.U.removeClass(i,e)))}this.prevStep!=r&&(this.setShowSeeMore(n.autoexpandStep),this.prevStep=r,this.setState({showHint:n.tutorialStepInfo[r].showDialog||n.tutorialStepInfo[r].showHint}))}handleResize(){const e=this.props.parent.state.tutorialOptions;this.setShowSeeMore(e.autoexpandStep)}componentDidMount(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep),this.resizeDebouncer=pxt.Util.debounce(this.handleResize,500),window.addEventListener("resize",this.resizeDebouncer)}onMarkdownDidRender(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep)}componentWillUnmount(){u.MarkedContent.clearBlockSnippetCache(),this.lastStep=-1,this.props.parent.stopPokeUserActivity(),this.removeHintOnClick(),window.removeEventListener("resize",this.resizeDebouncer)}removeHintOnClick(){document.removeEventListener("click",this.closeHint)}toggleExpanded(e){e.stopPropagation(),e.preventDefault();const t=this.props.parent.state.tutorialOptions,{tutorialStepExpanded:n}=t;return this.props.parent.setTutorialInstructionsExpanded(!n),!1}hasHint(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:n,tutorialStep:i}=e;return!!t&&(!!n[i].hintContentMd||n[i].showDialog)}hintOnClick(e){const t=this.props.parent.state.tutorialOptions;if(!t)return void pxt.reportError("tutorial","leaking hintonclick");e&&e.stopPropagation();const{tutorialStepInfo:n,tutorialStep:i}=t,r=n[i],o=i<n.length-1&&r&&!!r.showDialog;this.props.parent.clearUserPoke(),o||this.toggleHint()}expandedHintOnClick(e){e.stopPropagation()}setShowSeeMore(e){const t=this.refs.tutorialmessage;let n=!1;t&&t.firstElementChild&&t.firstElementChild.firstElementChild&&(n=t.clientHeight<=t.firstElementChild.firstElementChild.scrollHeight)&&(this.cardHeight=t.firstElementChild.firstElementChild.scrollHeight,e&&this.props.parent.setTutorialInstructionsExpanded(!0)),this.setState({showSeeMore:n}),this.props.parent.setEditorOffset()}getCardHeight(){return this.cardHeight}getExpandedCardStyle(e){return{[e]:`calc(${this.getCardHeight()}px + 2rem)`}}toggleHint(e){this.showHint(!this.state.showHint,e)}closeHint(e){this.showHint(!1)}showHint(e,t){if(this.removeHintOnClick(),this.closeLightbox(),!this.hasHint())return;const n=this.refs.tutorialhint;if(!n)return;const i=this.props.parent.state.tutorialOptions.tutorialStep;if(e){n.elementRef&&n.elementRef.addEventListener("click",this.expandedHintOnClick),this.setState({showHint:!0}),this.props.parent.stopPokeUserActivity();const e=this.props.parent.state.tutorialOptions;e.tutorialStepInfo[e.tutorialStep].showDialog||document.addEventListener("click",this.closeHint),pxt.tickEvent("tutorial.showhint",{tutorial:e.tutorial,step:e.tutorialStep}),this.props.parent.setHintSeen(i)}else n.elementRef&&n.elementRef.removeEventListener("click",this.expandedHintOnClick),this.setState({showHint:!1}),this.props.parent.pokeUserActivity();n.showHint(e,t)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:n,tutorialStep:r,tutorialStepExpanded:o,metadata:s}=e;if(!t)return(0,i.jsx)("div",{});const l=n[r],c=!!pxt.appTarget.appTheme.lockedEditor,d=r,p=n.length,f=s&&s.hideIteration,m=t&&0!=d&&!f,b=t&&d!=p-1&&!f,y=!c&&d==p-1&&!f,v=this.hasHint(),_=l.headerContentMd,E=l.showDialog,x=lf("Press Space or Enter to show a hint."),w=lf("Click to show a hint!");let k=this.hintOnClick;(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&this.state.showHint&&!E&&(k=null);const S=pxt.Util.isUserLanguageRtl();return(0,i.jsxs)("div",Object.assign({id:"tutorialcard",className:`ui ${o?"tutorialExpanded":""} ${t?"tutorialReady":""} ${this.state.showSeeMore?"seemore":""}  ${this.state.showHint?"":"showTooltip"} ${v?"hasHint":""}`,style:o?this.getExpandedCardStyle("height"):null},{children:[v&&this.state.showHint&&!E&&(0,i.jsx)("div",{className:"mask",role:"region",onClick:this.closeHint}),(0,i.jsxs)("div",Object.assign({className:"ui buttons"},{children:[m?(0,i.jsx)(a.Button,{icon:(S?"right":"left")+" chevron large",className:"prevbutton left attached "+(m?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.previousTutorialStep,onKeyDown:g.fireClickOnEnter}):void 0,(0,i.jsxs)("div",Object.assign({className:"ui segment attached tutorialsegment"},{children:[(0,i.jsx)("div",Object.assign({ref:"tutorialmessage",className:"tutorialmessage",role:"alert"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:!E&&(0,i.jsx)(u.MarkedContent,{className:"no-select",tabIndex:0,markdown:_,parent:this.props.parent,onDidRender:this.onMarkdownDidRender})}))})),(0,i.jsxs)("div",Object.assign({className:"avatar-container"},{children:[!E&&v&&(0,i.jsx)(a.Button,{className:"ui circular label blue hintbutton hidelightbox "+(this.props.pokeUser?"shake flash":""),icon:"lightbulb","aria-label":x,title:w,onClick:k,onKeyDown:g.fireClickOnEnter}),!E&&v&&(0,i.jsx)(h.HintTooltip,{ref:"hinttooltip",pokeUser:this.props.pokeUser,text:w,onClick:k}),(0,i.jsx)(T,{ref:"tutorialhint",parent:this.props.parent})]})),this.state.showSeeMore&&!o&&(0,i.jsx)(a.Button,{className:"fluid compact lightgrey",icon:"chevron down",tabIndex:0,text:lf("More..."),onClick:this.toggleExpanded,onKeyDown:g.fireClickOnEnter}),this.state.showSeeMore&&o&&(0,i.jsx)(a.Button,{className:"fluid compact lightgrey",icon:"chevron up",tabIndex:0,text:lf("Less..."),onClick:this.toggleExpanded,onKeyDown:g.fireClickOnEnter})]})),b?(0,i.jsx)(a.Button,{icon:(S?"left":"right")+" chevron large",className:"nextbutton right attached "+(b?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.nextTutorialStep,onKeyDown:g.fireClickOnEnter}):void 0,y?(0,i.jsx)(a.Button,{icon:"left checkmark",className:"orange right attached "+(t?"":"disabled"),text:lf("Finish"),ariaLabel:lf("Finish the tutorial."),onClick:this.finishTutorial,onKeyDown:g.fireClickOnEnter}):void 0]}))]}))}}n.TutorialCard=x;class w extends s.Component{constructor(e){super(e),this.flyoutWidth=0,this.flyoutTitle=lf("Toolbox"),this.workspaceWidth=0,this.handleResize=this.handleResize.bind(this),this.state={windowSize:window.innerWidth}}handleResize(){this.setState({windowSize:window.innerWidth})}componentDidMount(){window.addEventListener("resize",this.handleResize),window.addEventListener("wheel",this.handleResize),window.addEventListener("pointermove",this.handleResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("wheel",this.handleResize),window.removeEventListener("pointermove",this.handleResize)}UNSAFE_componentWillUpdate(){const e=document.querySelector(".blocklyFlyout");e&&(this.flyoutWidth=e.getBoundingClientRect().width);const t=document.querySelector("#blocksArea");t&&(this.workspaceWidth=t.clientWidth-this.flyoutWidth-4)}headerStyle(){return{width:this.flyoutWidth}}workspaceStyle(){return{width:this.workspaceWidth}}renderCore(){return(0,i.jsxs)("div",Object.assign({id:"headers"},{children:[(0,i.jsx)("div",Object.assign({id:"flyoutHeader",style:this.headerStyle()},{children:(0,i.jsx)("div",Object.assign({id:"flyoutHeaderTitle",className:"no-select"},{children:this.flyoutTitle}))})),(0,i.jsx)("div",Object.assign({id:"workspaceHeader",style:this.workspaceStyle()},{children:(0,i.jsx)(p.SmallEditorToolbar,{parent:this.props.parent})}))]}))}}n.WorkspaceHeader=w},{"../../pxtblocks":68,"./compiler":204,"./core":279,"./data":282,"./editortoolbar":291,"./hinttooltip":305,"./immersivereader":309,"./marked":313,"./sounds":344,"./sui":346,"./util":352,blockly:376,"react-dom":491,"react/jsx-runtime":549}],351:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ProfileDialog=void 0;const i=e("react/jsx-runtime"),r=e("./sui"),o=e("./core"),s=e("./auth"),a=e("./cloudsync"),l=e("../../react-common/components/profile/Profile"),c=e("../../react-common/components/util");class u extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.handleTabClick=e=>{this.setState({location:e})},this.onLogoutClicked=()=>{pxt.tickEvent("pxt.profile.signout"),s.logoutAsync()},this.onDeleteProfileClicked=()=>{pxt.tickEvent("pxt.profile.delete"),this.deleteProfileAsync()},this.onEmailCheckClicked=e=>{this.setState({emailSelected:c.CheckboxStatus.Waiting}),s.setEmailPrefAsync(e).then((t=>{var n;t.success?(o.infoNotification(lf("Settings saved")),this.setState({emailSelected:(null===(n=t.res)||void 0===n?void 0:n.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected})):(o.errorNotification(lf("Oops, something went wrong")),this.setState({emailSelected:e?c.CheckboxStatus.Unselected:c.CheckboxStatus.Selected}))}))},this.deleteProfileAsync=async()=>{this.getData(s.USER_PROFILE),await o.confirmAsync({header:lf("Delete Profile"),body:lf("Are you sure? This cannot be reversed! Your cloud-saved projects will be converted to local projects on this device."),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Confirm"),disagreeLbl:lf("Back to safety"),disagreeIcon:"arrow right",confirmationCheckbox:lf("I understand this is permanent. No undo.")})&&(await s.deleteProfileAsync(),this.hide(),o.infoNotification(lf("Profile deleted!")))};const t=s.userPreferences();this.state={visible:e.visible,location:"my-stuff",emailSelected:(null==t?void 0:t.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected},pxt.targetConfigAsync().then((e=>{this.setState({notification:e.profileNotification})}))}show(e){e=null!=e?e:"my-stuff",this.setState({visible:!0,location:e})}avatarPicUrl(){var e,t,n,i;const r=this.getUserProfile();return null!==(t=null===(e=null==r?void 0:r.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:null===(i=null===(n=null==r?void 0:r.idp)||void 0===n?void 0:n.picture)||void 0===i?void 0:i.dataUrl}renderCore(){var e,t,n;if(!this.isLoggedIn())return null;const s=this.getUserProfile(),c=this.getUserPreferences(),{emailSelected:u}=(a.githubProvider().user(),this.state),d=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.appTheme)||void 0===t?void 0:t.condenseProfile;return(0,i.jsx)(r.Modal,Object.assign({isOpen:this.state.visible,className:"ui profiledialog",size:d?"small":"fullscreen",onClose:this.hide,dimmer:!0,closeIcon:!0,header:null===(n=null==s?void 0:s.idp)||void 0===n?void 0:n.displayName,closeOnDimmerClick:!1,closeOnDocumentClick:!1,closeOnEscape:!1},{children:(0,i.jsx)(l.Profile,{user:{profile:s,preferences:c},signOut:this.onLogoutClicked,deleteProfile:this.onDeleteProfileClicked,notification:this.state.notification,showModalAsync:o.dialogAsync,onClickedEmail:this.onEmailCheckClicked,checkedEmail:u})}))}}n.ProfileDialog=u},{"../../react-common/components/profile/Profile":177,"../../react-common/components/util":187,"./auth":194,"./cloudsync":201,"./core":279,"./sui":346,"react/jsx-runtime":549}],352:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fireClickOnEnter=void 0,n.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}},{}],353:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.userPrefersDownloadFlagSet=n.clearUserPrefersDownloadFlag=n.showDeviceForgottenDialog=n.renderUnpairDialog=n.webUsbPairLegacyDialogAsync=n.webUsbPairThemedDialogAsync=n.webUsbPairDialogAsync=void 0;const i=e("react/jsx-runtime"),r=e("./core"),o=e("./cmds");let s=!1;async function a(e,t,n){const c=u();n||h();const p=()=>s?pxt.commands.WebUSBPairResult.UserRejected:pxt.commands.WebUSBPairResult.Failed;if(!await function(e){var t,n,r;const o=d().connectDeviceImage,s=u();return l({hideClose:!0,confirmAsync:e,jsxd:()=>o?(0,i.jsx)("img",{alt:lf("Image connecting {0} to a computer",s),className:"ui medium rounded image webusb-connect-image",src:o}):(0,i.jsx)("div",Object.assign({className:"ui one column grid padded download-dialog"},{children:(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)("div",Object.assign({className:"description"},{children:lf("First, make sure your {0} is connected to your computer with a USB cable.",s)}))}))}))}))})),buttonLabel:lf("Next"),buttonIcon:null===(r=null===(n=null===(t=pxt.appTarget)||void 0===t?void 0:t.appTheme)||void 0===n?void 0:n.downloadDialogTheme)||void 0===r?void 0:r.deviceIcon,header:lf("1. Connect your {0} to your computer",s),tick:"downloaddialog.button.connectusb"})}(t))return p();let f=pxt.packetio.isConnected();if(!f&&pxt.packetio.isConnecting()){const t=Date.now(),n=2500;r.showLoading("attempting-reconnect",lf("Reconnecting to your {0}",c));try{await pxt.Util.promiseTimeout(n,(async()=>{for(;!pxt.packetio.isConnected()&&Date.now()<t+n;)await pxt.Util.delay(30);f=pxt.packetio.isConnected()})())}catch(e){}r.hideLoading("attempting-reconnect")}let g=f;if(!f){const o=await function(e,t){var n,r,o;const s=u(),a=d().selectDeviceImage,c=a?"two":"one";return l({confirmAsync:e,jsxd:()=>(0,i.jsxs)("div",Object.assign({className:`ui ${c} column grid padded download-dialog`},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[lf("Press the Pair button below."),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),lf("A window will appear in the top of your browser."),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),lf("Select the {0} device and click Connect.",s)]}))}))}))})),a&&(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,i.jsx)("img",{alt:lf("Image selecting {0} from a list of WebUSB devices",s),className:"ui large rounded image",src:a})}))}))}))]})),buttonLabel:lf("Pair"),buttonIcon:null===(o=null===(r=null===(n=pxt.appTarget)||void 0===n?void 0:n.appTheme)||void 0===r?void 0:r.downloadDialogTheme)||void 0===o?void 0:o.deviceIcon,showDownloadAsFileButton:t,header:lf("2. Pair your {0} to your browser",s),tick:"downloaddialog.button.pickusbdevice",doNotHideOnAgree:!0})}(t,n);if(f=pxt.packetio.isConnected())r.hideDialog();else{if(!o)return p();{let t;try{g=await e()}catch(e){t=e.message}r.hideDialog(),pxt.packetio.isConnected()?g=!0:t&&(r.errorNotification(lf("Pairing error: {0}",t)),g=!1)}}}if(g&&!pxt.packetio.isConnected()){r.showLoading("attempting-connection",lf("Connecting to your {0}",c));try{g=await o.maybeReconnectAsync(!1,!0)}catch(e){g=!1}r.hideLoading("attempting-connection")}if(g)await function(e,t){var n;const r=u(),o=d().connectionSuccessImage,s=o?"two":"one";return l({confirmAsync:e,jsxd:()=>(0,i.jsxs)("div",Object.assign({className:`ui ${s} column grid padded download-dialog`},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsx)("div",Object.assign({className:"description"},{children:lf("Your {0} is connected! Pressing 'Download' will now automatically copy your code to your {0}.",r)}))}))}))})),o&&(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,i.jsx)("img",{alt:lf("Image of {0}",r),className:"ui medium rounded image",src:o})}))}))}))]})),buttonLabel:t?lf("Download"):lf("Done"),buttonIcon:null===(n=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===n?void 0:n.deviceSuccessIcon,header:lf("Connected to {0}",r),tick:"downloaddialog.button.webusbsuccess",help:void 0,headerIcon:"large circle check purple"})}(t,n);else if(await function(e,t){var n,r,o;const s=u(),a=lf("Try Again"),c=lf("Help"),h=lf("Download as File");return l({confirmAsync:e,jsxd:()=>(0,i.jsx)("div",{children:(0,i.jsxs)("div",Object.assign({className:"ui content download-troubleshoot-header"},{children:[lf("We couldn't find your {0}.",s),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),lf('Click "{0}" for more info, "{1}" to retry pairing, or "{2}" for drag-and-drop flashing.',c,a,h)]}))}),buttonLabel:a,buttonIcon:null===(o=null===(r=null===(n=pxt.appTarget)||void 0===n?void 0:n.appTheme)||void 0===r?void 0:r.downloadDialogTheme)||void 0===o?void 0:o.deviceIcon,header:lf("Failed to connect"),tick:"downloaddialog.button.webusbfailed",help:d().troubleshootWebUSBHelpURL,headerIcon:"exclamation triangle purple",showDownloadAsFileButton:t})}(t,n))return a(e,t,n);return g?pxt.commands.WebUSBPairResult.Success:p()}async function l({confirmAsync:e,jsxd:t,buttonLabel:n,buttonIcon:i,header:r,tick:o,help:a,headerIcon:l,showDownloadAsFileButton:c,hideClose:u,doNotHideOnAgree:d}){let h,p=!1;const f=d&&new Promise(((e,t)=>{h=e})),g=[{label:n,className:"primary",icon:i,labelPosition:"left",onclick:()=>{pxt.tickEvent(o),p=!0,d&&h()},noCloseOnClick:d}];c&&g.unshift({label:lf("Download as File"),className:"secondary",icon:pxt.appTarget.appTheme.downloadIcon||"xicon file-download",labelPosition:"left",onclick:()=>{pxt.tickEvent("downloaddialog.button.webusb.preferdownload"),s=!0,p=!1}});const m=e({header:r,jsxd:t,hasCloseIcon:!u,hideCancel:u,hideAgree:!0,className:"downloaddialog",helpUrl:a,bigHelpButton:!!a,headerIcon:l?l+" header-inline-icon":void 0,buttons:g});return d?(await Promise.race([f,m]),null==h||h()):await m,p}function c(e,t){let n=!1;const o=pxt.appTarget.appTheme.boardName||lf("device"),s=pxt.appTarget.appTheme.usbDocs,a=()=>{var e,t;const r=n&&function(){var e,t,n;const i=null===(n=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.simulator)||void 0===t?void 0:t.boardDefinition)||void 0===n?void 0:n.id;if(i){const e=pxt.appTarget.bundledpkgs[i];if(e){const t=pxt.Package.parseAndValidConfig(e[pxt.CONFIG_NAME]);if(t)return t.firmwareUrl}}}();return(null===(e=pxt.commands)||void 0===e?void 0:e.renderUsbPairDialog)?null===(t=pxt.commands)||void 0===t?void 0:t.renderUsbPairDialog(r,n):(0,i.jsxs)("div",Object.assign({className:`ui ${r?"four":"three"} column grid stackable`},{children:[r&&(0,i.jsx)("div",Object.assign({className:"column firmware"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[lf("Update Firmware"),(0,i.jsx)("br",{}),(0,i.jsx)("a",Object.assign({href:r,target:"_blank",rel:"noopener noreferrer"},{children:lf("Check your firmware version and update if needed")}))]}))}))}))})),(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[(0,i.jsx)("span",Object.assign({className:"ui yellow circular label"},{children:"1"})),lf("Connect {0} to your computer with a USB cable",o),(0,i.jsx)("br",{})]}))}))}))})),(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[(0,i.jsx)("span",Object.assign({className:"ui blue circular label"},{children:"2"})),lf("Select the device in the pairing dialog")]}))}))}))})),(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[(0,i.jsx)("span",Object.assign({className:"ui blue circular label"},{children:"3"})),lf('Press "Connect"')]}))}))}))}))]}))};return new Promise(((i,o)=>{const l=u(),c=()=>({header:lf("Connect to your {0}",l),jsxd:a,hasCloseIcon:!0,hideAgree:!0,helpUrl:s,className:"downloaddialog",buttons:[{label:lf("Connect device"),icon:"usb",className:"primary",onclick:()=>{r.showLoading("pair",lf('Select your {0} and press "Connect".',l)),e().finally((()=>{r.hideLoading("pair"),r.hideDialog()})).then((e=>{e||n?i(e?pxt.commands.WebUSBPairResult.Success:pxt.commands.WebUSBPairResult.Failed):(n=!0,r.forceUpdate(),t(c()))})).catch((e=>{pxt.reportException(e),r.errorNotification(lf("Pairing error: {0}",e.message)),i(0)}))}}]});t(c())}))}function u(){return pxt.appTarget.appTheme.boardName||lf("device")}function d(){return pxt.appTarget.appTheme.downloadDialogTheme||{}}function h(){s=!1}n.webUsbPairDialogAsync=async function(e,t,n){return pxt.appTarget.appTheme.downloadDialogTheme?a(e,t,n):c(e,t)},n.webUsbPairThemedDialogAsync=a,n.webUsbPairLegacyDialogAsync=c,n.renderUnpairDialog=function(){const e=u(),t=lf("How to unpair your {0}",e),n=d().browserUnpairImage;return{header:t,jsx:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:lf("You can unpair your {0} if the WebUSB download is malfunctioning.",e)}),(0,i.jsx)("p",{children:lf("Click on the icon on the left side of the address bar and uncheck your device.")}),n&&(0,i.jsx)("img",{className:"ui image centered medium",src:n,alt:lf("A gif showing how to unpair the {0}",e)})]}),helpUrl:pxt.appTarget.appTheme.usbDocs&&pxt.appTarget.appTheme.usbDocs+"/webusb#unpair"}},n.showDeviceForgottenDialog=async function(e){const t=u(),n=d().usbDeviceForgottenImage,r=n?"two":"one";await l({confirmAsync:e,jsxd:()=>(0,i.jsxs)("div",Object.assign({className:`ui ${r} column grid padded download-dialog`},{children:[(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"content"},{children:(0,i.jsxs)("div",Object.assign({className:"description"},{children:[lf("Your {0} has been disconnected.",t),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),lf("Unplug it from your computer and disconnect any battery to fully reset it.")]}))}))}))})),n&&(0,i.jsx)("div",Object.assign({className:"column"},{children:(0,i.jsx)("div",Object.assign({className:"ui"},{children:(0,i.jsx)("div",Object.assign({className:"image download-dialog-image"},{children:(0,i.jsx)("img",{alt:lf("Image of {0} being disconnected",t),className:"ui medium rounded image",src:n})}))}))}))]})),buttonLabel:lf("Done"),header:lf("{0} disconnected",t),tick:"downloaddialog.button.webusbforgotten",help:void 0})},n.clearUserPrefersDownloadFlag=h,n.userPrefersDownloadFlagSet=function(){return s}},{"./cmds":202,"./core":279,"react/jsx-runtime":549}],354:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.syncAsync=n.installByIdAsync=n.downloadFilesByIdAsync=n.importGithubAsync=n.initializeGithubRepoAsync=n.prepareConfigForGithub=n.recomputeHeaderFlagsAsync=n.exportToGithubAsync=n.mergeUpstreamAsync=n.restoreCommitAsync=n.commitAsync=n.bumpAsync=n.bumpedVersion=n.prAsync=n.hasMergeConflictMarkersAsync=n.revertAllAsync=n.pullAsync=n.hasPullAsync=n.PullStatus=n.getPublishedScriptAsync=n.fixupFileNames=n.saveScreenshotAsync=n.createDuplicateName=n.duplicateAsync=n.installAsync=n.importAsync=n.applyDiff=n.saveAsync=n.partialSaveAsync=n.forceSaveAsync=n.persistentPublishAsync=n.anonymousPublishAsync=n.updateShareHistoryAsync=n.saveSnapshotAsync=n.getTextAsync=n.initAsync=n.getLastCloudSync=n.getHeaderLastCloudSync=n.isHeaderSessionOutdated=n.acquireHeaderSession=n.computeSessionId=n.isHeadersSessionOutdated=n.getHeader=n.restoreFromBackupAsync=n.makeBackupAsync=n.getHeaders=n.setupWorkspace=n.copyProjectToLegacyEditor=n.gitsha=n.getWorkspaceType=void 0,n.dbgHdrToString=n.fireEvent=n.isBrowserWorkspace=n.listAssetsAsync=n.saveAssetAsync=n.loadedAsync=n.resetAsync=void 0;const i=e("./db"),r=e("./core"),o=e("./data"),s=e("./browserworkspace"),a=e("./fileworkspace"),l=e("./memoryworkspace"),c=e("./iframeworkspace"),u=e("./cloudsync"),d=e("./idbworkspace"),h=e("./compiler"),p=e("./auth"),f=e("./cloud"),g=e("diff-match-patch"),m=e("../../pxteditor");var b=pxt.Util,y=pxt.Cloud;const v=e("../../pxtblocks"),_=e("crypto-js/sha1");let E,T,x=[],w=new b.PromiseQueue;function k(e){return x.find((t=>t.header.id==e||t.header.path==e))}function S(e,t="utf-8"){if("base64"==t){const t=atob(e);return _("blob "+t.length+"\0"+t)+""}return _("blob "+b.toUTF8(e).length+"\0"+e)+""}async function C(e){pxt.log(`workspace: error '${e}', switching from ${T} to memory workspace`);const t=pxt.appTarget.appTheme.disableMemoryWorkspaceWarning||E===l.provider||pxt.shell.isSandboxMode()||pxt.shell.isReadOnly()||pxt.BrowserUtils.isIFrame();pxt.tickEvent("workspace.syncerror",{ws:T,reason:e,expected:t?1:0}),t||await r.confirmAsync({header:lf("Warning! Project Auto-Save Disabled"),body:lf("We are unable to save your projects at this time. You can still manually save your project via direct download, or sharing your project."),agreeLbl:lf("Continue"),headerIcon:"warning",agreeClass:"cancel",agreeIcon:"cancel",helpUrl:"/browsers/no-auto-save",className:"auto-save-disabled-warning",hasCloseIcon:!0}),E=l.provider,T="mem"}function A(e=!1,t=!0,n){var i;R();const r=null!=n?n:null===(i=p.userProfile())||void 0===i?void 0:i.id;let o=x.map((e=>e.header)).filter((t=>(e||!t.isDeleted)&&!t.isBackup&&(!t.cloudUserId||t.cloudUserId===r)));return t&&(o=o.filter((e=>!!e.isSkillmapProject===pxt.BrowserUtils.isSkillmapEditor()))),o.sort(((e,t)=>{const n=e.cloudUserId?Math.min(e.cloudLastSyncTime,e.modificationTime):e.modificationTime;return(t.cloudUserId?Math.min(t.cloudLastSyncTime,t.modificationTime):t.modificationTime)-n})),o}function I(e){R();let t=k(e);return t&&!t.header.isDeleted?t.header:null}n.getWorkspaceType=function(){return T},n.gitsha=S,n.copyProjectToLegacyEditor=async function(e,t){if(!me())return Promise.reject("Copy operation only works in browser workspace");const n=await $(e.id),i=pxt.Util.clone(e);delete i._id,delete i._rev,i.id=pxt.Util.guidGen();try{await s.copyProjectToLegacyEditor(i,n,t)}catch(e){pxt.reportException(e),pxt.log("Unable to port project to PouchDB")}return await d.copyProjectToLegacyEditorAsync(i,n,t),i},n.setupWorkspace=function(e){switch(b.assert(!E,"workspace set twice"),pxt.log(`workspace: ${e}`),T=null!=e?e:"browser",e){case"fs":case"file":E=a.provider;break;case"mem":case"memory":E=l.provider;break;case"iframe":E=c.provider;break;case"pouch":E=s.provider;break;case"idb":case"browser":default:E=d.provider}},n.getHeaders=A,n.makeBackupAsync=function(e,t){let n=b.flatClone(e);return n.id=b.guidGen(),delete n._rev,delete n._id,n.isBackup=!0,K(n,t).then((()=>(e.backupRef=n.id,V(n)))).then((()=>n))},n.restoreFromBackupAsync=function(e){if(!e.backupRef||e.isDeleted)return Promise.resolve();const t=e.backupRef;return $(t).then((t=>(delete e.backupRef,V(e,t)))).then((()=>{const e=I(t);return e.isDeleted=!0,V(e)})).catch((()=>(delete e.backupRef,V(e))))},n.getHeader=I;let O="";function N(){return pxt.storage.getLocal("workspacesessionid")!=O}function R(){return N()?ge().then((()=>{})):Promise.resolve()}function D(e){return e.length+" "+e.map((e=>e.modificationTime)).reduce(((e,t)=>Math.max(e,t)),0).toString()}function L(){O=D(x.map((e=>e.header))),N()&&(pxt.storage.setLocal("workspacesessionid",O),pxt.debug(`workspace: refreshed headers session to ${O}`),o.invalidate("header:*"),o.invalidate("text:*"))}n.isHeadersSessionOutdated=N,n.computeSessionId=D;const M=pxt.Util.guidGen();function P(e){e&&pxt.storage.removeLocal("workspaceheadersessionid:"+e.id)}function B(e){if(!e)return!1;const t=pxt.storage.getLocal("workspaceheadersessionid:"+e.id);return t&&t!=M}function j(e){B(e)&&(pxt.tickEvent("workspace.conflict.header"),r.errorNotification(lf("This project is already opened elsewhere.")),pxt.debug(`saved session ID: ${pxt.storage.getLocal("workspaceheadersessionid:"+e.id)}`),pxt.debug(`our session ID: ${M}`),pxt.Util.assert(!1,"trying to access outdated session"))}function F(e){return e.cloudLastSyncTime||0}async function $(e,t=!1){await R();const n=k(e);return n?n.text&&!t?n.text:w.enqueue(e,(async()=>{const e=await E.getAsync(n.header),i=J(e.text);return t?i:(n.text||(n.text=i),n.version=e.version,n.text)})):null}async function U(e){await H(e,((e,t)=>{m.history.updateShareHistory(e,Date.now(),t.pubVersions||[])}))}async function H(e,t){await R();const n=k(e);n&&await w.enqueue(e,(async()=>{const e=await E.getAsync(n.header),i=e.header;t(e.text,i);const r=await E.setAsync(i,e.version,e.text);n.version=r,o.invalidate("text:"+i.id),o.invalidate("pkg-git-status:"+i.id),o.invalidateHeader("header",i),L()}))}function G(e,t,n,i){let r,o;if(i){const e=/^data:(image\/(png|gif));base64,([a-zA-Z0-9+/]+=*)$/.exec(i);e&&(r=e[3],o=e[1])}return{id:e.id,shareId:e.pubPermalink,name:e.name,target:e.target,targetVersion:e.targetVersion,description:n.description||lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:e.editor,header:JSON.stringify(f.excludeLocalOnlyMetadataFields(e)),text:JSON.stringify(t),meta:{versions:pxt.appTarget.versions,blocksHeight:n.blocksHeight,blocksWidth:n.blocksWidth},thumbnailBuffer:r,thumbnailMimeType:o}}function V(e,t,n){return P(e),W(e,t,n)}async function W(e,t,n){var i;if(pxt.debug(`workspace.saveAsync ${ve(e)}`),e.isDeleted&&P(e),j(e),b.assert(e.target==pxt.appTarget.id),e.temporary)return Promise.resolve();let r=k(e.id);const s=!r;s&&(r={header:e,text:t,version:null},x.push(r));const a=!n&&!t,l=!n&&(e.isDeleted||t&&(()=>{if(s)return!0;const n=function(e,t){const n=e.header||{},i=t.header||{},r=e.text||{},o=t.text||{},s=b.unique([...Object.keys(n),...Object.keys(i)],(e=>e)).filter((e=>((e,t)=>JSON.stringify(e)!==JSON.stringify(t))(n[e],i[e]))),a=s.filter((e=>e in n&&!(e in i))).map((e=>({kind:"del",key:e,oldVal:n[e]}))),l=s.filter((e=>!(e in n)&&e in i)).map((e=>({kind:"add",key:e,newVal:i[e]}))),c=s.filter((e=>e in n&&e in i)).map((e=>({kind:"mod",key:e,oldVal:n[e],newVal:i[e]}))),u=b.unique([...Object.keys(r),...Object.keys(o)],(e=>e)).filter((e=>r[e]!==o[e]));return{header:[...a,...l,...c],files:[...u.filter((e=>e in r&&!(e in o)&&!!t.text)).map((e=>({kind:"del",key:e,oldVal:r[e].length}))),...u.filter((e=>!(e in r)&&e in o)).map((e=>({kind:"add",key:e,newVal:o[e].length}))),...u.filter((e=>e in r&&e in o)).map((e=>({kind:"mod",key:e,oldVal:r[e].length,newVal:o[e].length})))]}}(r,{header:e,text:t}),i=[ie,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE],o=["recentUse","modificationTime","cloudCurrent","_rev","_id","cloudVersion"],a={header:n.header.filter((e=>o.indexOf(e.key)<0)),files:n.files.filter((e=>i.indexOf(e.key)<0))},l=a.header.length>0||a.files.length>0;return l&&(pxt.debug("user changes:"),pxt.debug(function(e){const t=e=>"\t"+e,n=e=>`${e.kind} ${e.key}: (${e.oldVal||""}) => (${e.newVal||""})`;let i="";const r=e.header.filter((e=>"del"===e.kind)),o=e.header.filter((e=>"add"===e.kind)),s=e.header.filter((e=>"mod"===e.kind));i+=`HEADER (+${o.length}-${r.length}~${s.length})`,i+="\n",i+=e.header.map(n).map(t).join("\n"),i+="\n";const a=e.files.filter((e=>"del"===e.kind)),l=e.files.filter((e=>"add"===e.kind)),c=e.files.filter((e=>"mod"===e.kind));return i+=`FILES (+${l.length}-${a.length}~${c.length})`,i+="\n",i+=e.files.map(n).map(t).join("\n"),i+"\n"}(a))),l})());if((a||l)&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.modificationTime=b.nowSeconds(),e.targetVersion=e.targetVersion||"0.0.0",p.hasIdentity()&&p.loggedIn()&&(e.cloudUserId=null===(i=p.userProfile())||void 0===i?void 0:i.id)),n||(e.recentUse=b.nowSeconds()),s||(Object.assign(r.header,e),Object.keys(r.header).filter((t=>void 0===e[t])).forEach((e=>delete r.header[e])),e=r.header),t&&(r.text=t),(t||e.isDeleted)&&(e.saveId=null),t&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition){const n=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);n&&n.dependencies&&(e.board=Object.keys(n.dependencies).filter((e=>!!pxt.bundledSvg(e)))[0])}return w.enqueue(e.id,(async()=>{var n,i;let a;await function(e){return void 0!==e.version?Promise.resolve():E.getAsync(e.header).then((t=>{e.version=t.version}))}(r);let c=t?r.text:null;if(pxt.appTarget.appTheme.timeMachine)try{const t=await E.getAsync(e);t&&(c||(null===(n=t.header.pubVersions)||void 0===n?void 0:n.length)===(null===(i=e.pubVersions)||void 0===i?void 0:i.length)||(c=Object.assign({},t.text)),c&&m.history.updateHistory(t.text,c,Date.now(),e.pubVersions||[],q,Y))}catch(e){pxt.reportException(e),console.warn("Unable to update project history",e)}try{a=await E.setAsync(e,r.version,c)}catch(t){await C("write failed"),a=await E.setAsync(e,t.version,c)}!a&&t&&pxt.debug("write rejected due to version conflict!"),t&&(r.version=a),l&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.saveId=null),(t||e.isDeleted)&&(o.invalidate("text:"+e.id),o.invalidate("pkg-git-status:"+e.id)),o.invalidateHeader("header",e),s&&o.invalidate("headers:"),L()}))}n.acquireHeaderSession=function(e){e&&pxt.storage.setLocal("workspaceheadersessionid:"+e.id,M)},n.isHeaderSessionOutdated=B,n.getHeaderLastCloudSync=F,n.getLastCloudSync=function(){var e;if(!p.loggedIn())return 0;const t=null===(e=p.userProfile())||void 0===e?void 0:e.id,n=A(!0).filter((e=>e.cloudUserId&&e.cloudUserId===t));return n.length?Math.min(...n.map(F)):0},n.initAsync=function(){return E||(E=d.provider,T="browser"),ge().then((e=>function(){const e=x.map((e=>e.header)),t={};return e.filter((e=>e.backupRef)).forEach((e=>t[e.backupRef]=!0)),Promise.all(e.filter((e=>e.isBackup&&!t[e.id])).map((e=>(e.isDeleted=!0,V(e)))))}().then((()=>e)))).then((e=>(pxt.perf.recordMilestone("workspace init finished"),e)))},n.getTextAsync=$,n.saveSnapshotAsync=async function(e){await H(e,(e=>{m.history.pushSnapshotOnHistory(e,Date.now())}))},n.updateShareHistoryAsync=U,n.anonymousPublishAsync=async function(e,t,n,i){j(e);const r={};e.saveId=r;const o=G(e,t,n,i);pxt.debug(`publishing script; ${o.text.length} bytes`);const s=await y.privatePostAsync("scripts",o,!0);return e.pubVersions||(e.pubVersions=[]),e.pubVersions.push({id:s.id,type:"snapshot"}),s.shortid&&(s.id=s.shortid),e.pubId=s.shortid,e.pubCurrent=e.saveId===r,e.meta=s.meta,pxt.debug(`published; id /${e.pubId}`),await W(e),await U(e.id),s},n.persistentPublishAsync=async function(e,t,n,i){j(e);const r={};e.saveId=r;const o=G(e,t,n,i);pxt.debug(`publishing script; ${o.text.length} bytes`);const{shareID:s,scr:a}=await f.shareAsync(e.id,o);return e.pubVersions||(e.pubVersions=[]),e.pubVersions.push({id:a.id,type:"permalink"}),e.pubId=s,e.pubCurrent=e.saveId===r,e.pubPermalink=s,e.meta=a.meta,pxt.debug(`published; id /${e.pubId}`),await W(e),await U(e.id),e},n.forceSaveAsync=V,n.partialSaveAsync=async function(e,t,n){const i=k(e);if(!i)return pxt.log("Failed to save to unknown project: "+e),void pxt.tickEvent("workspace.invalidSaveToUnknownProject");const r=Object.assign({},await $(e));return r[t]=n,W(i.header,r)},n.saveAsync=W;const z=new g.diff_match_patch;function q(e,t){return z.patch_make(e,t)}function Y(e,t){return z.patch_apply(e,t)[0]}function K(e,t,n=!1){return e.path=function(e){let t=e.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(t||(t="Untitled"),k(t)){let e=2;for(;k(t+"-"+e);)e++;t+="-"+e}return t}(e),V(e,t,n)}function Z(e,t,n=!1){b.assert(e.target==pxt.appTarget.id);const i=e;n||(i.id=ts.pxtc.Util.guidGen()),i.recentUse=b.nowSeconds(),i.modificationTime=i.recentUse;const r=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);return r&&r.preferredEditor&&(i.editor=r.preferredEditor,pxt.shell.setEditorLanguagePref(r.preferredEditor)),pxt.github.cacheProjectDependenciesAsync(r).then((()=>K(i,t))).then((()=>i))}function X(e){let t=e.name.indexOf("#")>-1?e.name.substring(0,e.name.lastIndexOf("#")).trim():e.name,n=b.toDictionary(x.filter((e=>!e.header.isDeleted)),(e=>e.header.name)),i=2;for(;n.hasOwnProperty(t+" #"+i);)i++;return t+" #"+i}function J(e){return e?(["kind.json","yelm.json"].forEach((t=>{!e[pxt.CONFIG_NAME]&&e[t]&&(e[pxt.CONFIG_NAME]=e[t],delete e[t])})),e):e}n.applyDiff=function(e,t){return m.history.applyDiff(e,t,Y)},n.importAsync=K,n.installAsync=Z,n.duplicateAsync=async function(e,t,n){const i=n||await $(e.id);t||(t=X(e));let r=b.flatClone(e);const o=b.flatClone(i);r.id=b.guidGen(),r.name=t;const s=JSON.parse(i[pxt.CONFIG_NAME]);return s.name=r.name,o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(s),delete r._rev,delete r._id,delete r.githubCurrent,delete r.githubId,delete r.githubTag,delete r.pubVersions,delete r.pubPermalink,delete r.anonymousSharePreference,r.pubId="",r.pubCurrent=!1,r.cloudVersion&&pxt.tickEvent("identity.duplicatingCloudProject"),K(r=f.excludeLocalOnlyMetadataFields(r),o).then((()=>r))},n.createDuplicateName=X,n.saveScreenshotAsync=function(e,t,n){return j(e),E.saveScreenshotAsync?E.saveScreenshotAsync(e,t,n):Promise.resolve()},n.fixupFileNames=J;const Q=new b.PromiseQueue;async function ee(e){pxt.github.isGithubId(e)&&(e=pxt.github.normalizeRepoId(e));const t=await pxt.packagesConfigAsync(),n=encodeURIComponent(pxt.github.upgradedPackageId(t,e));return await Q.enqueue(n,(async()=>{let i;const o=await async function(){return d.getObjectStoreAsync(d.SCRIPT_TABLE)}();try{i=(await o.getAsync(n)).files}catch(s){i=pxt.github.isGithubId(e)?(await pxt.github.downloadPackageAsync(e,t)).files:await y.downloadScriptFilesAsync(e).catch(r.handleNetworkError);try{await o.setAsync({id:n,files:i})}catch(e){pxt.log("Unable to cache script in DB")}}return J(i)}))}var te,ne;n.getPublishedScriptAsync=ee,(ne=te=n.PullStatus||(n.PullStatus={}))[ne.NoSourceControl=0]="NoSourceControl",ne[ne.UpToDate=1]="UpToDate",ne[ne.GotChanges=2]="GotChanges",ne[ne.NeedsCommit=3]="NeedsCommit",ne[ne.BranchNotFound=4]="BranchNotFound";const ie=pxt.github.GIT_JSON;async function re(e,t=!1){let n=await $(e.id);await de(e,n);let i=n[ie];if(!i)return te.NoSourceControl;let r=JSON.parse(i),o=pxt.github.parseRepoId(r.repo);const s=o.tag,a=await pxt.github.getRefAsync(o.slug,s);if(!a){const e=await pxt.github.listRefsAsync(o.slug,"heads");return e&&e.length?te.BranchNotFound:te.NoSourceControl}if(a==r.commit.sha)return te.UpToDate;if(t)return te.GotChanges;try{return await ue(e,{repo:r.repo,sha:a,files:n,tryDiff3:!0}),te.GotChanges}catch(e){if(e.isMergeError)return te.NeedsCommit;throw e}}function oe(e){let t=pxt.semver.parse(e.version,"0.0.0");return t.patch++,pxt.semver.stringify(t)}n.hasPullAsync=async function(e){return await re(e,!0)==te.GotChanges},n.pullAsync=re,n.revertAllAsync=async function(e){const t=(await $(e.id))[ie];if(!t)return te.NoSourceControl;const n=JSON.parse(t),i=pxt.github.parseRepoId(e.githubId),r=n.commit,o=pxt.github.lookupFile(i,r,pxt.CONFIG_NAME),s=pxt.Package.parseAndValidConfig(o&&o.blobContent);if(!s)return te.NoSourceControl;const a={};a[ie]=t,a[pxt.CONFIG_NAME]=o.blobContent;for(const e of s.files.concat(s.testFiles)){const t=pxt.github.lookupFile(i,r,e);if(!t||void 0===t.blobContent)return pxt.log(`cannot revert ${e}, corrupted based commit`),te.NoSourceControl;a[e]=t.blobContent}return await V(e,a),te.UpToDate},n.hasMergeConflictMarkersAsync=async function(e){const t=await $(e.id);return!!Object.keys(t).find((e=>pxt.diff.hasMergeConflictMarker(t[e])))},n.prAsync=async function(e,t,n){let i=pxt.github.parseRepoId(e.githubId);const r=await pxt.github.getNewBranchNameAsync(i.slug,"merge-");await pxt.github.createNewBranchAsync(i.slug,r,t);const o=await pxt.github.createPRFromBranchAsync(i.slug,i.tag,r,n);let s=await pxt.github.getRefAsync(i.slug,i.tag);return await ue(e,{repo:e.githubId,sha:s,files:{}}),o},n.bumpedVersion=oe,n.bumpAsync=async function(e,t=""){j(e);const n=await $(e.id),i=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]);i.version=t||oe(i);const r="v"+i.version;if(i.dependencies){const t=pxt.github.parseRepoId(e.githubId);Object.keys(i.dependencies).forEach((e=>{const n=i.dependencies[e],r=/^github:/.test(n)&&pxt.github.parseRepoId(n);r&&t.slug===r.slug&&(i.dependencies[e]=`github:${pxt.github.join(t.slug,r.fileName)}`,pxt.debug(`patching dep ${e} to ${i.dependencies[e]}`))}))}return n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(i),await W(e,n),await le(e,{message:i.version,createRelease:r,binaryJs:!0})};const se="assets/js/binary.js",ae="assets/version.txt";async function le(e,t={}){await u.ensureGitHubTokenAsync();let n=await $(e.id),i=n[ie];i||b.userError(lf("Not a git extension."));let r=JSON.parse(i),s=pxt.github.parseRepoId(r.repo),a=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]),l={base_tree:r.commit.tree.sha,tree:[]};const c=t.filenamesToCommit||pxt.allPkgFiles(a),d=[ie,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE];for(const e of c.filter((e=>d.indexOf(e)<0))){const t=n[e];await y(e,t)}if(0==l.tree.length&&b.userError(lf("Nothing to commit!")),pxt.appTarget.appTheme.githubCompiledJs&&t.binaryJs&&(!s.tag||"master"==s.tag)){const e=a.version||"0.0.0",t={jsMetaVersion:e},n=await h.compileAsync(t);if(n&&n.success&&n.outfiles[pxtc.BINARY_JS]&&(await y(se,n.outfiles[pxtc.BINARY_JS]),await y(ae,e),!a.disableTargetTemplateFiles)){const e=pxt.template.targetTemplateFiles();if(e)for(const t of Object.keys(e))await y(t,e[t])}}let p=await pxt.github.createObjectAsync(s.slug,"tree",l),f={message:t.message||lf("Update {0}",l.tree.map((e=>e.path)).filter((e=>!/\.github\/makecode\//.test(e))).join(", ")),parents:[r.commit.sha],tree:p};r.mergeSha&&f.parents.push(r.mergeSha);let g=await pxt.github.createObjectAsync(s.slug,"commit",f),m=g;return await pxt.github.fastForwardAsync(s.slug,s.tag,g)||(m=await pxt.github.mergeAsync(s.slug,s.tag,g)),null==m?g:(o.invalidate("gh-commits:*"),await ue(e,{repo:r.repo,sha:m,files:n,saveTag:t.createRelease}),t.createRelease&&(await pxt.github.createReleaseAsync(s.slug,t.createRelease,m),await pxt.github.enablePagesAsync(s.slug),await pxt.github.listRefsAsync(s.slug,"tags",!0,!0)),"");async function y(e,n){const i={content:n,encoding:"utf-8"};e==pxt.CONFIG_NAME&&(i.content=he(i.content,!!t.createRelease));const o=/^data:([^;]+);base64,/.exec(n);o&&(i.encoding="base64",i.content=n.substr(o[0].length));const a=S(i.content,i.encoding),c=pxt.github.lookupFile(s,r.commit,e);let u;if(!c||c.sha!=a){if("utf-8"==i.encoding&&pxt.diff.hasMergeConflictMarker(i.content))throw function(){const e=new Error("Merge conflict marker error");return e.isMergeConflictMarkerError=!0,e}();u=await pxt.github.createObjectAsync(s.slug,"blob",i),"utf-8"==i.encoding&&b.assert(u==a,`sha not matching ${u} != ${a}`);const t=pxt.github.join(s.fileName,e);l.tree.push({path:t,mode:"100644",type:"blob",sha:u,url:void 0})}return u}}function ce(){const e=new Error("Merge error");return e.isMergeError=!0,e}async function ue(e,t){var n;const{repo:i,sha:r,files:o,justJSON:s}=t,a=pxt.github.parseRepoId(i),l=await pxt.github.getCommitAsync(a.slug,r);let c=JSON.parse(o[ie]||"{}");c.commit||(c={repo:i,commit:null});const u={};let d=0,h=!1;const p=async e=>{u[e]=!0;const n=pxt.github.lookupFile(a,l,e),i=pxt.github.lookupFile(a,c.commit,e),p=null!=o[e]&&(!i||i.blobContent!=o[e]);if(!n)return t.tryDiff3&&p?o[e]:(s||(o[e]=""),"");let f=i?i.blobContent:o[e];if(null!=f&&S(f)==n.sha)return n.blobContent=f,t.tryDiff3||t.justJSON||(o[e]=f),f;if(f=await pxt.github.downloadTextAsync(a.fullName,r,e),n.blobContent=f,S(f)!=n.sha&&S(`\ufeff${f}`)!==n.sha&&b.userError(lf("Corrupt SHA1 on download of '{0}'.",e)),t.tryDiff3&&p)if(e==pxt.CONFIG_NAME){if(!(f=pxt.diff.mergeDiff3Config(o[e],i.blobContent,n.blobContent)))throw ce()}else if(/\.blocks$/.test(e)){const t=v.mergeXml(o[e],i.blobContent,n.blobContent);h=h||!t,f=t||""}else if(e==se||e==ae||e==pxt.TUTORIAL_INFO_FILE||e==pxt.ASSETS_FILE)f=o[e];else{const t=pxt.diff.diff3(o[e],i.blobContent,n.blobContent,lf("local changes"),lf("remote changes (pulled from Github)"));if(!t)throw ce();if(d+=t.numConflicts,t.numConflicts&&!/\.ts$/.test(e))throw ce();f=t.merged}return s||(o[e]=f),f},f=pxt.Package.parseAndValidConfig(o[pxt.CONFIG_NAME]),g=await p(pxt.CONFIG_NAME);let m=pxt.Package.parseAndValidConfig(g);if(m||(e&&b.userError(lf("Invalid pxt.json file.")),pxt.debug("github: reconstructing pxt.json"),m=pxt.diff.reconstructConfig(a,o,l,pxt.appTarget.blocksprj||pxt.appTarget.tsprj),a.fileName&&a.project&&(m.dependencies[a.project]=`github:${a.slug}`),o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m)),f){let e=0;Object.keys(m.dependencies).filter((e=>/^github:/.test(m.dependencies[e])&&f.dependencies[e])).forEach((t=>{if(pxt.github.parseRepoId(m.dependencies[t])){const n=f.dependencies[t];m.dependencies[t]=n,e++}})),e&&(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m))}for(const e of pxt.allPkgFiles(m).slice(1))await p(e);if(m.name||(m.name=a.fileName&&a.project?`${a.project}-${a.fileName}`:a.project||a.fullName,m.name=m.name.replace(/pxt-/gi,"").replace(/\//g,"-").replace(/-+/,"-").replace(/[^\w\-]/g,""),s||(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m))),!s){if(h&&d)throw ce();for(let e of Object.keys(o))"."==e[0]||u[e]||delete o[e]}l.tag=t.saveTag,c.mergeSha=void 0,c.commit=l,o[ie]=JSON.stringify(c,null,4);const y=(null===(n=m.targetVersions)||void 0===n?void 0:n.targetId)===pxt.appTarget.id&&m.targetVersions.target?m.targetVersions.target:pxt.appTarget.versions.target;return e?(e.name=m.name,await V(e,o)):e=await Z({name:m.name,githubId:i,pubId:"",pubCurrent:!1,meta:{},editor:pxt.BLOCKS_PROJECT_NAME,target:pxt.appTarget.id,targetVersion:y},o),e}async function de(e,t){j(e),e.githubCurrent=!1;const n=JSON.parse(t[ie]||"{}");if(e.githubId=n&&n.repo,e.githubTag=n&&n.commit&&n.commit.tag,!e.githubId)return;if(!n.commit||!n.commit.tree)return;const i=pxt.github.parseRepoId(e.githubId);let r=!0,o=!1;for(let e of Object.keys(t)){if(e==ie||e==pxt.SIMSTATE_JSON||e==pxt.SERIAL_EDITOR_FILE)continue;let s=pxt.github.lookupFile(i,n.commit,e);if(!s||"blob"!=s.type){r=!1;continue}null==s.blobContent&&(o=!0);let a=t[e];e==pxt.CONFIG_NAME&&(a=he(a)),a&&s.sha!=S(a)&&(r=!1)}if(e.githubCurrent=r,o&&await ue(e,{repo:n.repo,sha:n.commit.sha,files:t,justJSON:!0}),null==n.isFork){const i=pxt.github.parseRepoId(n.repo),r=await pxt.github.repoAsync(i.fullName,null);r&&(n.isFork=!!r.fork,t[ie]=JSON.stringify(n,null,4),await W(e,t))}}function he(e,t){const n=pxt.Package.parseAndValidConfig(e);if(!n)return e;delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths;const i=n.supportedTargets||[];i.indexOf(pxt.appTarget.id)<0&&(i.push(pxt.appTarget.id),i.sort(),n.supportedTargets=i),n.targetVersions=Object.assign(Object.assign({},n.targetVersions),{target:pxt.appTarget.versions.target,targetId:pxt.appTarget.id});const r=Object.keys(n.dependencies).filter((e=>/^(file|workspace):/.test(n.dependencies[e])));for(const e of r)o(e);return pxt.Package.stringifyConfig(n);function o(e){const i=n.dependencies[e],r=I(i.substring(i.indexOf(":")+1));if(r)if(r.githubId){const i=pxt.github.parseRepoId(r.githubId);t&&!/^v\d+/.test(r.githubTag)&&b.userError(lf("You need to create a release for dependency {0}.",e));const o=r.githubTag||i.tag;n.dependencies[e]=`github:${i.fullName}#${o}`}else t&&b.userError(lf("Dependency {0} is a local project.",e))}}async function pe(e,t,n,i){await u.ensureGitHubTokenAsync();let r=pxt.github.parseRepoId(t),o=r.fullName.replace(/.*\//,""),s=await $(e.id);const a=pxt.template.packageFiles(o);if(pxt.template.packageFilesFixup(a,{repo:r.fullName,repoowner:r.owner,reponame:r.project,repotag:r.tag}),n)b.jsonMergeFrom(s,a);else{pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])||delete s[pxt.CONFIG_NAME];let e=a[pxt.README_FILE];const t=s[pxt.README_FILE];(e||t)&&(e=[t,e].filter((e=>!!e)).join("\n\n")),b.jsonMergeFrom(a,s),s=a,e&&(s[pxt.README_FILE]=e)}const l=pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME]),c=l.files;c.filter((e=>/\.ts$/.test(e))).length||Object.keys(s).filter((e=>/\.(blocks|ts|py|asm|md|json)$/.test(e))).filter((e=>e!=pxt.CONFIG_NAME)).forEach((e=>c.push(e)));const d=l.testFiles||(l.testFiles=[]);s["test.ts"]&&d.indexOf("test.ts")<0&&d.push("test.ts"),s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(l),await V(e,s),await le(e,{message:lf("Initial files for MakeCode project"),filenamesToCommit:Object.keys(s),binaryJs:i}),s=await $(e.id);const h=pxt.allPkgFiles(pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])),p=[ie,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE,pxt.CONFIG_NAME];Object.keys(s).filter((e=>p.indexOf(e)<0&&h.indexOf(e)<0)).forEach((e=>delete s[e])),await W(e,s);try{await pxt.github.enablePagesAsync(r.slug)}catch(e){pxt.reportException(e)}return e}let fe;function ge(){return pxt.debug("workspace: sync"),fe||(fe=E.listAsync().catch((e=>C("sync failed").then((()=>E.listAsync())))).then((e=>{const t=b.toDictionary(x||[],(e=>e.header.id));x=e.map((e=>{let n=t[e.id];return n?JSON.stringify(n.header)!==JSON.stringify(e)&&(b.jsonCopyFrom(n.header,e),n.text=void 0,n.version=void 0,o.invalidateHeader("header",e),o.invalidateHeader("text",e),o.invalidateHeader("pkg-git-status",e),o.invalidate("gh-commits:*")):n={header:e,text:void 0,version:void 0},n})),u.syncAsync()})).then((()=>(L(),E.getSyncState?E.getSyncState():null))).finally((()=>{fe=void 0})))}function me(){return E===d.provider}n.commitAsync=le,n.restoreCommitAsync=async function(e,t){await u.ensureGitHubTokenAsync();const n=await $(e.id),i=n[ie],r=JSON.parse(i),o=pxt.github.parseRepoId(r.repo),s=new Date(Date.parse(t.committer.date)),a={message:lf("Restore '{0} {1}'",s.toLocaleString(),t.message),parents:[r.commit.sha],tree:t.tree.sha},l=await pxt.github.createObjectAsync(o.slug,"commit",a);await pxt.github.fastForwardAsync(o.slug,o.tag,l),await ue(e,{repo:r.repo,sha:l,files:n})},n.mergeUpstreamAsync=async function(e,t){return Promise.resolve()},n.exportToGithubAsync=async function(e,t){const n=pxt.github.parseRepoId(t),i=pxt.template.packageFiles(e.name);await pxt.github.putFileAsync(n.fullName,".gitignore",i[".gitignore"]);const r=await pxt.github.getRefAsync(n.slug,n.tag),o=await pxt.github.getCommitAsync(n.slug,r),s=await $(e.id);s[ie]=JSON.stringify({repo:t,commit:o});const a=s[pxt.MAIN_BLOCKS];if(a){const e=v.loadWorkspaceXml(a,!0);if(e){const t=v.saveWorkspaceXml(e,!0);t&&(s[pxt.MAIN_BLOCKS]=t)}}await V(e,s),await pe(e,t,!1,!0)},n.recomputeHeaderFlagsAsync=de,n.prepareConfigForGithub=he,n.initializeGithubRepoAsync=pe,n.importGithubAsync=async function(e){const t=pxt.github.normalizeRepoId(e,"master").replace(/^github:/,""),n=pxt.github.parseRepoId(t);let i="",o=!1,s=!1;try{i=await pxt.github.getRefAsync(n.slug,n.tag);const e=await pxt.github.getCommitAsync(n.slug,i),t=pxt.github.join(n.fileName,pxt.CONFIG_NAME);if(!e.tree.tree.find((e=>e.path==t))){if(pxt.debug("github: detected import non-makecode project"),pxt.shell.isReadOnly()&&b.userError(lf("This repository looks empty.")),o=!0,s=!1,!await r.confirmAsync({header:n.fileName?lf("Add a nested extension to existing GitHub repository?"):lf("Initialize GitHub repository for MakeCode?"),body:n.fileName?lf("We need to add a few files under the /{0} folder to your GitHub repository https://github.com/{1} to create the nested extension.",n.fileName,n.slug):lf("We need to add a few files to your GitHub repository https://github.com/{0} to make it work with MakeCode.",n.fullName),agreeLbl:lf("Ok"),hasCloseIcon:!0,helpUrl:"/github/import"}))return Promise.resolve(void 0);await u.ensureGitHubTokenAsync()}}catch(e){409==e.statusCode?(pxt.debug("github: detected import empty project"),pxt.shell.isReadOnly()&&b.userError(lf("This repository looks empty.")),await u.ensureGitHubTokenAsync(),await pxt.github.putFileAsync(n.fullName,".gitignore","# Initial\n"),o=!0,s=!0,i=await pxt.github.getRefAsync(n.slug,n.tag)):404==e.statusCode&&(r.errorNotification(lf("Sorry, that repository looks invalid.")),b.userError(lf("No such repository or branch.")))}const a=await ue(null,{repo:t,sha:i,files:{}});return a&&o&&await pe(a,t,s,!1),a},n.downloadFilesByIdAsync=function(e){return y.privateGetAsync(e,!0).then((e=>ee(e.id)))},n.installByIdAsync=function(e){return y.privateGetAsync(e,!0).then((t=>ee(t.id).then((n=>Z({name:t.name,pubId:e,pubCurrent:!0,meta:t.meta,editor:t.editor,target:t.target,targetVersion:t.targetVersion||t.meta&&t.meta.versions&&t.meta.versions.target},n)))))},n.syncAsync=ge,n.resetAsync=function(){return x=[],E.resetAsync().then(u.resetAsync).then(i.destroyAsync).then(pxt.BrowserUtils.clearTranslationDbAsync).then(pxt.BrowserUtils.clearTutorialInfoDbAsync).then(h.clearApiInfoDbAsync).then((()=>{pxt.storage.clearLocal(),o.clearCache(),y.localToken&&pxt.storage.setLocal("local_token",y.localToken)})).then((()=>ge())).then((()=>{}))},n.loadedAsync=function(){return E.loadedAsync?E.loadedAsync():Promise.resolve()},n.saveAssetAsync=function(e,t,n){return E.saveAssetAsync?E.saveAssetAsync(e,t,n):Promise.reject(new Error(lf("Assets not supported here.")))},n.listAssetsAsync=function(e){return E.listAssetsAsync?E.listAssetsAsync(e):Promise.resolve([])},n.isBrowserWorkspace=me,n.fireEvent=function(e){if(E.fireEvent)return E.fireEvent(e)};const be={};let ye=1;function ve(e){return e?`${e.name} ${e.id.substr(0,4)}..v${function(e){return e?(be[e]||(be[e]="#"+ye,ye+=1),be[e]):"#0"}(e.cloudVersion)}@${e.modificationTime%100}-${b.timeSince(e.modificationTime)}`:"#null"}n.dbgHdrToString=ve,o.mountVirtualApi("header",{getSync:e=>"*"==(e=o.stripProtocol(e))?A():I(e)}),o.mountVirtualApi("headers",{getAsync:e=>{e=o.stripProtocol(e);const t=A();return e?h.projectSearchAsync({term:e,headers:t}).then((e=>e)).then((e=>{const n=[];for(const i of e)n.push(t.find((e=>e.id===i.id)));return n.filter((e=>!!e))})):Promise.resolve(t)},expirationTime:e=>5e3,onInvalidated:()=>{h.projectSearchClear()}}),o.mountVirtualApi("text",{getAsync:e=>{const t=/^[\w\-]+:([^\/]+)(\/(.*))?/.exec(e);return $(t[1]).then((e=>t[3]?e[t[3]]:e))}})},{"../../pxtblocks":68,"../../pxteditor":134,"./auth":194,"./browserworkspace":198,"./cloud":200,"./cloudsync":201,"./compiler":204,"./core":279,"./data":282,"./db":283,"./fileworkspace":298,"./idbworkspace":306,"./iframeworkspace":308,"./memoryworkspace":314,"crypto-js/sha1":387,"diff-match-patch":396}],355:[function(e,t,n){var i=e("./toPropertyKey.js");t.exports=function(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":362}],356:[function(e,t,n){function i(){return t.exports=i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,i.apply(this,arguments)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},{}],357:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],358:[function(e,t,n){var i=e("./typeof.js").default;function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=i(e)&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":363}],359:[function(e,t,n){var i=e("./defineProperty.js");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./defineProperty.js":355}],360:[function(e,t,n){t.exports=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r},t.exports.__esModule=!0,t.exports.default=t.exports},{}],361:[function(e,t,n){var i=e("./typeof.js").default;t.exports=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":363}],362:[function(e,t,n){var i=e("./typeof.js").default,r=e("./toPrimitive.js");t.exports=function(e){var t=r(e,"string");return"symbol"==i(t)?t:t+""},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":361,"./typeof.js":363}],363:[function(e,t,n){function i(e){return t.exports=i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},{}],364:[function(e,t,n){
/*! For license information please see index.js.LICENSE.txt */
!function(i,r){if("object"==typeof n&&"object"==typeof t)t.exports=r(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],r);else{var o=r("object"==typeof n?e("blockly/core"):i.Blockly);for(var s in o)("object"==typeof n?n:i)[s]=o[s]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{i.r(r),i.d(r,{Constants:()=>e,FlyoutCursor:()=>a,FlyoutCursorPluginInfo:()=>u,LineCursor:()=>d,LineCursorPluginInfo:()=>f,Navigation:()=>g,NavigationController:()=>y});var e={};i.r(e),i.d(e,{LOGGING_MSG_TYPE:()=>o,SHORTCUT_NAMES:()=>n,STATE:()=>t});const t={WORKSPACE:"workspace",FLYOUT:"flyout",TOOLBOX:"toolbox"},n={PREVIOUS:"previous",NEXT:"next",IN:"in",OUT:"out",INSERT:"insert",MARK:"mark",DISCONNECT:"disconnect",TOOLBOX:"toolbox",EXIT:"exit",TOGGLE_KEYBOARD_NAV:"toggle_keyboard_nav",COPY:"keyboard_nav_copy",CUT:"keyboard_nav_cut",PASTE:"keyboard_nav_paste",DELETE:"keyboard_nav_delete",MOVE_WS_CURSOR_UP:"workspace_up",MOVE_WS_CURSOR_DOWN:"workspace_down",MOVE_WS_CURSOR_LEFT:"workspace_left",MOVE_WS_CURSOR_RIGHT:"workspace_right"},o={ERROR:"error",WARN:"warn",LOG:"log"};var s=i(573);class a extends s.Cursor{constructor(){super()}next(){const e=this.getCurNode();if(!e)return null;const t=e.next();return t&&this.setCurNode(t),t}in(){return null}prev(){const e=this.getCurNode();if(!e)return null;const t=e.prev();return t&&this.setCurNode(t),t}out(){return null}}const l=s.registry.Type.CURSOR,c="FlyoutCursor";s.registry.register(l,c,a);const u={[l]:c};class d extends s.BasicCursor{constructor(){super()}next(){const e=this.getCurNode();if(!e)return null;let t=this.getNextNode_(e,this.validLineNode);return t&&(t.getType()==s.ASTNode.types.INPUT||t.getType()==s.ASTNode.types.NEXT)&&t.getLocation().targetBlock()&&(t=this.getNextNode_(t,this.validLineNode)),t&&this.setCurNode(t),t}in(){const e=this.getCurNode();if(!e)return null;const t=this.getNextNode_(e,this.validInLineNode);return t&&this.setCurNode(t),t}prev(){const e=this.getCurNode();if(!e)return null;let t=this.getPreviousNode_(e,this.validLineNode);return t&&(t.getType()==s.ASTNode.types.INPUT||t.getType()==s.ASTNode.types.NEXT)&&t.getLocation().targetBlock()&&(t=this.getPreviousNode_(t,this.validLineNode)),t&&this.setCurNode(t),t}out(){const e=this.getCurNode();if(!e)return null;const t=this.getPreviousNode_(e,this.validInLineNode);return t&&this.setCurNode(t),t}validLineNode(e){if(!e)return!1;let t=!1;const n=e.getLocation(),i=e&&e.getType();return i==s.ASTNode.types.BLOCK?null===n.outputConnection&&(t=!0):(i==s.ASTNode.types.INPUT&&n.type==s.NEXT_STATEMENT||i==s.ASTNode.types.NEXT)&&(t=!0),t}validInLineNode(e){if(!e)return!1;let t=!1;const n=e.getLocation(),i=e&&e.getType();return(i==s.ASTNode.types.FIELD||i==s.ASTNode.types.INPUT&&n.type==s.INPUT_VALUE)&&(t=!0),t}}const h="LineCursor",p=s.registry.Type.CURSOR;s.registry.register(p,h,d);const f={[p]:h};class g{constructor(){this.workspaceStates={},this.loggingCallback=null,this.WS_MOVE_DISTANCE=40,this.MARKER_NAME="local_marker_1",this.DEFAULT_WS_COORDINATE=new s.utils.Coordinate(100,100),this.WS_COORDINATE_ON_DELETE=new s.utils.Coordinate(100,100),this.wsChangeWrapper=this.workspaceChangeListener.bind(this),this.flyoutChangeWrapper=this.flyoutChangeListener.bind(this),this.workspaces=[]}addWorkspace(e){this.workspaces.push(e);const t=e.getFlyout();e.getMarkerManager().registerMarker(this.MARKER_NAME,new s.Marker),e.addChangeListener(this.wsChangeWrapper),t&&this.addFlyout(t)}removeWorkspace(e){const t=this.workspaces.indexOf(e),n=e.getFlyout();e.getCursor()&&this.disableKeyboardAccessibility(e),t>-1&&this.workspaces.splice(t,1),e.getMarkerManager()&&e.getMarkerManager().unregisterMarker(this.MARKER_NAME),e.removeChangeListener(this.wsChangeWrapper),n&&this.removeFlyout(n)}setState(e,t){this.workspaceStates[e.id]=t}getState(e){return this.workspaceStates[e.id]}getMarker(e){return e.getMarker(this.MARKER_NAME)}addFlyout(e){const t=e.getWorkspace();t.addChangeListener(this.flyoutChangeWrapper);const n=s.registry.getClass(l,c);t.getMarkerManager().setCursor(new n)}removeFlyout(e){e.getWorkspace().removeChangeListener(this.flyoutChangeWrapper)}workspaceChangeListener(e){const t=s.Workspace.getById(e.workspaceId);if(t&&t.keyboardAccessibilityMode)switch(e.type){case s.Events.DELETE:this.handleBlockDeleteByDrag(t,e);break;case s.Events.BLOCK_CHANGE:"mutation"===e.element&&this.handleBlockMutation(t,e);break;case s.Events.CLICK:this.handleWorkspaceClick(t,e);break;case s.Events.TOOLBOX_ITEM_SELECT:this.handleToolboxCategoryClick(t,e);break;case s.Events.BLOCK_CREATE:this.handleBlockCreate(t,e)}}flyoutChangeListener(e){const t=s.Workspace.getById(e.workspaceId),n=t.targetWorkspace,i=n.getFlyout();if(n&&n.keyboardAccessibilityMode&&!i.autoClose)if(e.type===s.Events.CLICK&&"block"===e.targetType){const i=t.getBlockById(e.blockId);this.handleBlockClickInFlyout(n,i)}else if(e.type===s.Events.SELECTED){const i=t.getBlockById(e.newElementId);this.handleBlockClickInFlyout(n,i)}}handleBlockCreate(e,n){this.getState(e)===t.FLYOUT&&(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleBlockMutation(e,t){const n=t.blockId,i=e.getCursor();if(i){const e=i.getCurNode(),t=e?e.getSourceBlock():null;t&&t.id===n&&i.setCurNode(s.ASTNode.createBlockNode(t))}}handleWorkspaceClick(e,n){this.getState(e)!==t.WORKSPACE&&(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleToolboxCategoryClick(e,n){const i=this.getState(e);n.newItem&&i!==t.TOOLBOX?this.focusToolbox(e):n.newItem||(this.resetFlyout(e,!!e.getToolbox()),this.setState(e,t.WORKSPACE))}handleBlockDeleteByDrag(e,t){const n=t.blockId,i=t.ids,r=e.getCursor();if(!r||!r.getCurNode()||!r.getCurNode().getSourceBlock())return;const o=r.getCurNode().getSourceBlock();(o.id===n||i.indexOf(o.id)>-1)&&r.setCurNode(s.ASTNode.createWorkspaceNode(e,this.WS_COORDINATE_ON_DELETE))}handleBlockClickInFlyout(e,n){n&&(n.isShadow()&&(n=n.getParent()),this.getFlyoutCursor(e).setCurNode(s.ASTNode.createStackNode(n)),this.setState(e,t.FLYOUT))}moveCursorOnBlockDelete(e,t){if(!e||!e.getCursor())return;const n=e.getCursor(),i=n.getCurNode(),r=i?i.getSourceBlock():null;if(r===t)if(r.getParent()){const e=r.previousConnection||r.outputConnection;e&&n.setCurNode(s.ASTNode.createConnectionNode(e.targetConnection))}else n.setCurNode(s.ASTNode.createWorkspaceNode(r.workspace,r.getRelativeToSurfaceXY()));else r&&t.getChildren(!1).indexOf(r)>-1&&n.setCurNode(s.ASTNode.createWorkspaceNode(r.workspace,r.getRelativeToSurfaceXY()))}focusToolbox(e){const n=e.getToolbox();if(n&&(this.setState(e,t.TOOLBOX),this.resetFlyout(e,!1),this.getMarker(e).getCurNode()||this.markAtCursor(e),!n.getSelectedItem())){const e=n.getToolboxItems();for(let t,i=0;t=e[i];i++)if(t.isSelectable()){n.selectItemByPosition(i);break}}}focusFlyout(e){const n=e.getFlyout();if(this.setState(e,t.FLYOUT),this.getMarker(e).getCurNode()||this.markAtCursor(e),n&&n.getWorkspace()){const t=n.getWorkspace().getTopBlocks(!0);if(t.length>0){const n=s.ASTNode.createStackNode(t[0]);this.getFlyoutCursor(e).setCurNode(n)}}}focusWorkspace(e){e.hideChaff();const n=!!e.getToolbox();this.resetFlyout(e,n),this.setState(e,t.WORKSPACE),this.setCursorOnWorkspaceFocus(e)}setCursorOnWorkspaceFocus(e){const t=e.getTopBlocks(!0),n=e.getCursor(),i=new s.utils.Coordinate(this.DEFAULT_WS_COORDINATE.x/e.scale,this.DEFAULT_WS_COORDINATE.y/e.scale);if(t.length>0)n.setCurNode(s.ASTNode.createTopNode(t[0]));else{const t=s.ASTNode.createWorkspaceNode(e,i);n.setCurNode(t)}}getFlyoutCursor(e){const t=e.getFlyout();return t?t.getWorkspace().getCursor():null}insertFromFlyout(e){const t=this.createNewBlock(e);if(!t)return;const n=this.getMarker(e).getCurNode();this.tryToConnectMarkerAndCursor(e,n,s.ASTNode.createBlockNode(t))||this.warn("Something went wrong while inserting a block from the flyout."),this.focusWorkspace(e),e.getCursor().setCurNode(s.ASTNode.createTopNode(t)),this.removeMark(e)}createNewBlock(e){const t=e.getFlyout();if(!t||!t.isVisible())return this.warn("Trying to insert from the flyout when the flyout does not  exist or is not visible"),null;const n=this.getFlyoutCursor(e).getCurNode().getLocation();if(!n.isEnabled())return this.warn("Can't insert a disabled block."),null;const i=t.createBlock(n);return i.render(),i.setConnectionTracking(!0),i}resetFlyout(e,t){this.getFlyoutCursor(e)&&(this.getFlyoutCursor(e).hide(),t&&e.getFlyout().hide())}connectMarkerAndCursor(e){const t=this.getMarker(e).getCurNode(),n=e.getCursor().getCurNode();return!(!t||!n)&&this.tryToConnectMarkerAndCursor(e,t,n)}tryToConnectMarkerAndCursor(e,t,n){if(!this.logConnectionWarning(t,n))return!1;const i=t.getType(),r=n.getType(),o=n.getLocation(),a=t.getLocation();if(t.isConnection()&&n.isConnection()){const e=o,t=a;return this.connect(e,t)}if(t.isConnection()&&(r==s.ASTNode.types.BLOCK||r==s.ASTNode.types.STACK)){const e=o,t=a;return this.insertBlock(e,t)}if(i==s.ASTNode.types.WORKSPACE){const e=n?n.getSourceBlock():null;return this.moveBlockToWorkspace(e,t)}return this.warn("Unexpected state in tryToConnectMarkerAndCursor."),!1}logConnectionWarning(e,t){if(!e)return this.warn("Cannot insert with no marked node."),!1;if(!t)return this.warn("Cannot insert with no cursor node."),!1;const n=e.getType(),i=t.getType();return n==s.ASTNode.types.FIELD?(this.warn("Should not have been able to mark a field."),!1):n==s.ASTNode.types.BLOCK?(this.warn("Should not have been able to mark a block."),!1):n==s.ASTNode.types.STACK?(this.warn("Should not have been able to mark a stack."),!1):i==s.ASTNode.types.FIELD?(this.warn("Cannot attach a field to anything else."),!1):i!=s.ASTNode.types.WORKSPACE||(this.warn("Cannot attach a workspace to anything else."),!1)}moveBlockToWorkspace(e,t){return!!e&&(e.isShadow()?(this.warn("Cannot move a shadow block to the workspace."),!1):(e.getParent()&&e.unplug(!1),e.moveTo(t.getWsCoordinate()),!0))}disconnectChild(e,t){const n=e.getSourceBlock(),i=t.getSourceBlock();let r;n.getRootBlock()===i.getRootBlock()&&(n.getDescendants(!1).indexOf(i)>-1?(r=this.getInferiorConnection(t),r&&r.disconnect()):(r=this.getInferiorConnection(e),r&&r.disconnect()))}connect(e,t){if(!e||!t)return!1;const n=this.getInferiorConnection(e),i=this.getSuperiorConnection(t),r=this.getSuperiorConnection(e),o=this.getInferiorConnection(t);if(n&&i&&this.moveAndConnect(n,i))return!0;if(r&&o&&this.moveAndConnect(r,o))return!0;if(this.moveAndConnect(e,t))return!0;{const n=e.getConnectionChecker(),i=n.canConnectWithReason(e,t,!1);return this.warn("Connection failed with error: "+n.getErrorMessage(i,e,t)),!1}}getInferiorConnection(e){const t=e.getSourceBlock();return e.isSuperior()?t.previousConnection?t.previousConnection:t.outputConnection?t.outputConnection:null:e}getSuperiorConnection(e){return e.isSuperior()?e:e.targetConnection?e.targetConnection:null}moveAndConnect(e,t){if(!e||!t)return!1;const n=e.getSourceBlock();if(e.getConnectionChecker().canConnect(e,t,!1)&&!t.getSourceBlock().isShadow()){if(this.disconnectChild(e,t),!t.isSuperior()){const i=n.getRootBlock(),r={x:t.x-e.x,y:t.y-e.y},o=e.getOffsetInBlock().clone();i.positionNearConnection(e,r,o)}return t.connect(e),!0}return!1}insertBlock(e,t){switch(t.type){case s.PREVIOUS_STATEMENT:if(this.connect(e.nextConnection,t))return!0;break;case s.NEXT_STATEMENT:if(this.connect(e.previousConnection,t))return!0;break;case s.INPUT_VALUE:if(this.connect(e.outputConnection,t))return!0;break;case s.OUTPUT_VALUE:for(let n=0;n<e.inputList.length;n++){const i=e.inputList[n].connection;if(i&&i.type===s.INPUT_VALUE&&this.connect(i,t))return!0}if(e.outputConnection&&this.connect(e.outputConnection,t))return!0}return this.warn("This block can not be inserted at the marked location."),!1}disconnectBlocks(e){const t=e.getCursor().getCurNode();if(!t.isConnection())return void this.log("Cannot disconnect blocks when the cursor is not on a connection");const n=t.getLocation();if(!n.isConnected())return void this.log("Cannot disconnect unconnected connection");const i=n.isSuperior()?n:n.targetConnection,r=n.isSuperior()?n.targetConnection:n;if(r.getSourceBlock().isShadow())return void this.log("Cannot disconnect a shadow block");i.disconnect(),r.bumpAwayFrom(i),i.getSourceBlock().getRootBlock().bringToFront();const o=s.ASTNode.createConnectionNode(i);e.getCursor().setCurNode(o)}markAtCursor(e){this.getMarker(e).setCurNode(e.getCursor().getCurNode())}removeMark(e){const t=this.getMarker(e);t.setCurNode(null),t.hide()}enableKeyboardAccessibility(e){this.workspaces.indexOf(e)>-1&&!e.keyboardAccessibilityMode&&(e.keyboardAccessibilityMode=!0,this.focusWorkspace(e))}disableKeyboardAccessibility(e){this.workspaces.indexOf(e)>-1&&e.keyboardAccessibilityMode&&(e.keyboardAccessibilityMode=!1,e.getCursor().hide(),this.getMarker(e).hide(),this.getFlyoutCursor(e)&&this.getFlyoutCursor(e).hide())}log(e){this.loggingCallback?this.loggingCallback(o.LOG,e):console.log(e)}warn(e){this.loggingCallback?this.loggingCallback(o.WARN,e):console.warn(e)}error(e){this.loggingCallback?this.loggingCallback(o.ERROR,e):console.error(e)}moveWSCursor(e,t,n){const i=e.getCursor(),r=e.getCursor().getCurNode();if(r.getType()!==s.ASTNode.types.WORKSPACE)return!1;const o=r.getWsCoordinate(),a=t*this.WS_MOVE_DISTANCE+o.x,l=n*this.WS_MOVE_DISTANCE+o.y;return i.setCurNode(s.ASTNode.createWorkspaceNode(e,new s.utils.Coordinate(a,l))),!0}handleEnterForWS(e){const t=e.getCursor().getCurNode(),n=t.getType();n==s.ASTNode.types.FIELD?t.getLocation().showEditor():t.isConnection()||n==s.ASTNode.types.WORKSPACE?this.markAtCursor(e):n==s.ASTNode.types.BLOCK?this.warn("Cannot mark a block."):n==s.ASTNode.types.STACK&&this.warn("Cannot mark a stack.")}paste(e,t){let n=!1;s.Events.setGroup(!0);const i=s.clipboard.paste(e,t);return i&&(n=this.insertPastedBlock(t,i)),s.Events.setGroup(!1),n}insertPastedBlock(e,t){let n=!1;const i=e.getMarker(this.MARKER_NAME).getCurNode();return i&&(n=this.tryToConnectMarkerAndCursor(e,i,s.ASTNode.createBlockNode(t))),n}dispose(){for(const e of this.workspaces)this.removeWorkspace(e)}}const m=s.Gesture.prototype.doWorkspaceClick_;s.Gesture.prototype.doWorkspaceClick_=function(e){m.call(this,e);const t=this.creatorWorkspace_;if(e.shiftKey&&t.keyboardAccessibilityMode){const n=new s.utils.Coordinate(e.clientX,e.clientY),i=s.utils.svgMath.screenToWsCoordinates(t,n),r=s.ASTNode.createWorkspaceNode(t,i);t.getCursor().setCurNode(r)}};const b=s.Gesture.prototype.doBlockClick_;s.Gesture.prototype.doBlockClick_=function(e){b.call(this,e),!this.targetBlock_.isInFlyout&&this.mostRecentEvent_.shiftKey&&this.targetBlock_.workspace.keyboardAccessibilityMode&&this.creatorWorkspace_.getCursor().setCurNode(s.ASTNode.createTopNode(this.targetBlock_))};class y{copyData=null;copyWorkspace=null;constructor(e){this.navigation=e||new g}init(){this.addShortcutHandlers(),this.registerDefaults()}addShortcutHandlers(){s.FieldColour&&(s.FieldColour.prototype.onShortcut=this.fieldColourHandler),s.FieldDropdown&&(s.FieldDropdown.prototype.onShortcut=this.fieldDropdownHandler),s.Toolbox&&(s.Toolbox.prototype.onShortcut=this.toolboxHandler)}removeShortcutHandlers(){s.FieldColour&&(s.FieldColour.prototype.onShortcut=null),s.FieldDropdown&&(s.FieldDropdown.prototype.onShortcut=null),s.Toolbox&&(s.Toolbox.prototype.onShortcut=null)}fieldColourHandler(e){if(this.picker_)switch(e.name){case n.PREVIOUS:return this.moveHighlightBy_(0,-1),!0;case n.NEXT:return this.moveHighlightBy_(0,1),!0;case n.OUT:return this.moveHighlightBy_(-1,0),!0;case n.IN:return this.moveHighlightBy_(1,0),!0;default:return!1}return s.Field.prototype.onShortcut.call(this,e)}fieldDropdownHandler(e){if(this.menu_)switch(e.name){case n.PREVIOUS:return this.menu_.highlightPrevious(),!0;case n.NEXT:return this.menu_.highlightNext(),!0;default:return!1}return s.Field.prototype.onShortcut.call(this,e)}toolboxHandler(e){if(!this.selectedItem_)return!1;switch(e.name){case n.PREVIOUS:return this.selectPrevious_();case n.OUT:return this.selectParent_();case n.NEXT:return this.selectNext_();case n.IN:return this.selectChild_();default:return!1}}addWorkspace(e){this.navigation.addWorkspace(e)}removeWorkspace(e){this.navigation.removeWorkspace(e)}enable(e){this.navigation.enableKeyboardAccessibility(e)}disable(e){this.navigation.disableKeyboardAccessibility(e)}fieldShortcutHandler(e,t){const n=e.getCursor();if(!n||!n.getCurNode())return!1;const i=n.getCurNode();return i.getType()===s.ASTNode.types.FIELD&&i.getLocation().onShortcut(t)}registerPrevious(){const e={name:n.PREVIOUS,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,n,i)=>{const r=e.getFlyout(),o=e.getToolbox();let s=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return s=this.fieldShortcutHandler(e,i),s||(e.getCursor().prev(),s=!0),s;case t.FLYOUT:return s=this.fieldShortcutHandler(e,i),s||(r.getWorkspace().getCursor().prev(),s=!0),s;case t.TOOLBOX:return!(!o||"function"!=typeof o.onShortcut)&&o.onShortcut(i);default:return!1}}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.W,e.name)}registerToggleKeyboardNav(){const e={name:n.TOGGLE_KEYBOARD_NAV,callback:e=>(e.keyboardAccessibilityMode?this.navigation.disableKeyboardAccessibility(e):this.navigation.enableKeyboardAccessibility(e),!0)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.K,[s.utils.KeyCodes.CTRL,s.utils.KeyCodes.SHIFT]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerOut(){const e={name:n.OUT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,n,i)=>{const r=e.getToolbox();let o=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return o=this.fieldShortcutHandler(e,i),o||(e.getCursor().out(),o=!0),o;case t.FLYOUT:return this.navigation.focusToolbox(e),!0;case t.TOOLBOX:return!(!r||"function"!=typeof r.onShortcut)&&r.onShortcut(i);default:return!1}}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.A,e.name)}registerNext(){const e={name:n.NEXT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,n,i)=>{const r=e.getToolbox(),o=e.getFlyout();let s=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return s=this.fieldShortcutHandler(e,i),s||(e.getCursor().next(),s=!0),s;case t.FLYOUT:return s=this.fieldShortcutHandler(e,i),s||(o.getWorkspace().getCursor().next(),s=!0),s;case t.TOOLBOX:return!(!r||"function"!=typeof r.onShortcut)&&r.onShortcut(i);default:return!1}}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.S,e.name)}registerIn(){const e={name:n.IN,preconditionFn:e=>e.keyboardAccessibilityMode,callback:(e,n,i)=>{const r=e.getToolbox();let o=!1;switch(this.navigation.getState(e)){case t.WORKSPACE:return o=this.fieldShortcutHandler(e,i),o||(e.getCursor().in(),o=!0),o;case t.TOOLBOX:return o=!(!r||"function"!=typeof r.onShortcut)&&r.onShortcut(i),o||this.navigation.focusFlyout(e),!0;default:return!1}}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.D,e.name)}registerInsert(){const e={name:n.INSERT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&this.navigation.connectMarkerAndCursor(e)};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.I,e.name)}registerMark(){const e={name:n.MARK,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>{switch(this.navigation.getState(e)){case t.WORKSPACE:return this.navigation.handleEnterForWS(e),!0;case t.FLYOUT:return this.navigation.insertFromFlyout(e),!0;default:return!1}}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.ENTER,e.name)}registerDisconnect(){const e={name:n.DISCONNECT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&(this.navigation.disconnectBlocks(e),!0)};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.X,e.name)}registerToolboxFocus(){const e={name:n.TOOLBOX,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.getState(e)===t.WORKSPACE&&(e.getToolbox()?this.navigation.focusToolbox(e):this.navigation.focusFlyout(e),!0)};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.T,e.name)}registerExit(){const e={name:n.EXIT,preconditionFn:e=>e.keyboardAccessibilityMode,callback:e=>{switch(this.navigation.getState(e)){case t.FLYOUT:case t.TOOLBOX:return this.navigation.focusWorkspace(e),!0;default:return!1}}};s.ShortcutRegistry.registry.register(e,!0),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.ESC,e.name,!0),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.E,e.name,!0)}registerWorkspaceMoveLeft(){const e={name:n.MOVE_WS_CURSOR_LEFT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,-1,0)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.A,[s.utils.KeyCodes.SHIFT]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveRight(){const e={name:n.MOVE_WS_CURSOR_RIGHT,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,1,0)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.D,[s.utils.KeyCodes.SHIFT]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveUp(){const e={name:n.MOVE_WS_CURSOR_UP,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,0,-1)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.W,[s.utils.KeyCodes.SHIFT]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerWorkspaceMoveDown(){const e={name:n.MOVE_WS_CURSOR_DOWN,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly,callback:e=>this.navigation.moveWSCursor(e,0,1)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.S,[s.utils.KeyCodes.SHIFT]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name)}registerCopy(){const e={name:n.COPY,preconditionFn:e=>{if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return!s.Gesture.inProgress()&&e&&e.isDeletable()&&e.isMovable()}}return!1},callback:e=>{const t=e.getCursor().getCurNode().getSourceBlock();return e.hideChaff(),this.copyData=t.toCopyData(),this.copyWorkspace=t.workspace,!!this.copyData}};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.C,[s.utils.KeyCodes.CTRL]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const i=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.C,[s.utils.KeyCodes.ALT]);s.ShortcutRegistry.registry.addKeyMapping(i,e.name,!0);const r=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.C,[s.utils.KeyCodes.META]);s.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0)}registerPaste(){const e={name:n.PASTE,preconditionFn:e=>e.keyboardAccessibilityMode&&!e.options.readOnly&&!s.Gesture.inProgress(),callback:()=>!(!this.copyData||!this.copyWorkspace)&&this.navigation.paste(this.copyData,this.copyWorkspace)};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.V,[s.utils.KeyCodes.CTRL]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const i=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.V,[s.utils.KeyCodes.ALT]);s.ShortcutRegistry.registry.addKeyMapping(i,e.name,!0);const r=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.V,[s.utils.KeyCodes.META]);s.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0)}registerCut(){const e={name:n.CUT,preconditionFn:e=>{if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return!s.Gesture.inProgress()&&e&&e.isDeletable()&&e.isMovable()&&!e.workspace.isFlyout}}return!1},callback:e=>{const t=e.getCursor().getCurNode().getSourceBlock();return this.copyData=t.toCopyData(),this.copyWorkspace=t.workspace,this.navigation.moveCursorOnBlockDelete(e,t),t.checkAndDelete(),!0}};s.ShortcutRegistry.registry.register(e);const t=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.X,[s.utils.KeyCodes.CTRL]);s.ShortcutRegistry.registry.addKeyMapping(t,e.name,!0);const i=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.X,[s.utils.KeyCodes.ALT]);s.ShortcutRegistry.registry.addKeyMapping(i,e.name,!0);const r=s.ShortcutRegistry.registry.createSerializedKey(s.utils.KeyCodes.X,[s.utils.KeyCodes.META]);s.ShortcutRegistry.registry.addKeyMapping(r,e.name,!0)}registerDelete(){const e={name:n.DELETE,preconditionFn:function(e){if(e.keyboardAccessibilityMode&&!e.options.readOnly){const t=e.getCursor().getCurNode();if(t&&t.getSourceBlock()){const e=t.getSourceBlock();return e&&e.isDeletable()}}return!1},callback:(e,t)=>{const n=e.getCursor().getCurNode().getSourceBlock();return t.preventDefault(),!s.Gesture.inProgress()&&(this.navigation.moveCursorOnBlockDelete(e,n),n.checkAndDelete(),!0)}};s.ShortcutRegistry.registry.register(e),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.DELETE,e.name,!0),s.ShortcutRegistry.registry.addKeyMapping(s.utils.KeyCodes.BACKSPACE,e.name,!0)}registerDefaults(){this.registerPrevious(),this.registerNext(),this.registerIn(),this.registerOut(),this.registerDisconnect(),this.registerExit(),this.registerInsert(),this.registerMark(),this.registerToolboxFocus(),this.registerToggleKeyboardNav(),this.registerWorkspaceMoveDown(),this.registerWorkspaceMoveLeft(),this.registerWorkspaceMoveUp(),this.registerWorkspaceMoveRight(),this.registerCopy(),this.registerPaste(),this.registerCut(),this.registerDelete()}dispose(){const e=Object.values(n);for(const t of e)s.ShortcutRegistry.registry.unregister(t);this.removeShortcutHandlers(),this.navigation.dispose()}}})(),r})()))},{"blockly/core":375}],365:[function(e,t,n){
/*! For license information please see index.js.LICENSE.txt */
!function(i,r){if("object"==typeof n&&"object"==typeof t)t.exports=r(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],r);else{var o=r("object"==typeof n?e("blockly/core"):i.Blockly);for(var s in o)("object"==typeof n?n:i)[s]=o[s]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{i.r(r),i.d(r,{WorkspaceSearch:()=>n});var e=i(573);const t=function(){let e=!1;return function(){if(e)return;e=!0;const t=document.createElement("style");t.id="blockly-ws-search-style";const n=document.createTextNode("path.blocklyPath.blockly-ws-search-highlight {\n    fill: #000;\n  }\n  path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {\n    fill: grey;\n  }\n  .blockly-ws-search-close-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;\n  }\n  .blockly-ws-search-next-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;\n  }\n  .blockly-ws-search-previous-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;\n  }\n  .blockly-ws-search {\n    background: #fff;\n    border: solid lightgrey 0.5px;\n    box-shadow: 0px 10px 20px grey;\n    justify-content: center;\n    padding: 0.25em;\n    position: absolute;\n    z-index: 70;\n  }\n  .blockly-ws-search-input input {\n    border: none;\n  }\n  .blockly-ws-search button {\n    border: none;\n  }\n  .blockly-ws-search-actions {\n    display: flex;\n  }\n  .blockly-ws-search-container {\n    display: flex;\n  }\n  .blockly-ws-search-content {\n    display: flex;\n  }");t.appendChild(n),document.head.insertBefore(t,document.head.firstChild)}}();class n{constructor(e){this.workspace=e,this.id="workspaceSearch",this.htmlDiv=null,this.actionDiv=null,this.inputElement=null,this.textInputPlaceholder="Search",this.blocks=[],this.currentBlockIndex=-1,this.searchText="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents=[]}init(){this.workspace.getComponentManager().addComponent({component:this,weight:0,capabilities:[e.ComponentManager.Capability.POSITIONABLE]}),t(),this.createDom(),this.setVisible(!1),this.workspace.resize()}dispose(){for(const t of this.boundEvents)e.browserEvents.unbind(t);this.boundEvents.length=0,this.htmlDiv&&(this.htmlDiv.remove(),this.htmlDiv=null),this.actionDiv=null,this.inputElement=null}createDom(){const t=this.workspace.getInjectionDiv();this.addEvent(t,"keydown",this,(e=>this.onWorkspaceKeyDown(e))),this.htmlDiv=document.createElement("div"),e.utils.dom.addClass(this.htmlDiv,"blockly-ws-search");const n=document.createElement("div");e.utils.dom.addClass(n,"blockly-ws-search-container");const i=document.createElement("div");e.utils.dom.addClass(i,"blockly-ws-search-content"),n.appendChild(i);const r=document.createElement("div");e.utils.dom.addClass(r,"blockly-ws-search-input"),this.inputElement=this.createTextInput(),this.addEvent(this.inputElement,"keydown",this,(e=>this.onKeyDown(e))),this.addEvent(this.inputElement,"input",this,(()=>this.onInput())),this.addEvent(this.inputElement,"click",this,(()=>{this.searchAndHighlight(this.searchText,this.preserveSelected),this.inputElement.select()})),r.appendChild(this.inputElement),i.appendChild(r),this.actionDiv=document.createElement("div"),e.utils.dom.addClass(this.actionDiv,"blockly-ws-search-actions"),i.appendChild(this.actionDiv);const o=this.createNextBtn();o&&this.addActionBtn(o,(()=>this.next()));const s=this.createPreviousBtn();s&&this.addActionBtn(s,(()=>this.previous()));const a=this.createCloseBtn();a&&(this.addBtnListener(a,(()=>this.close())),n.appendChild(a)),this.htmlDiv.appendChild(n),t.insertBefore(this.htmlDiv,this.workspace.getParentSvg())}addEvent(t,n,i,r){const o=e.browserEvents.conditionalBind(t,n,i,r);this.boundEvents.push(o)}addActionBtn(e,t){this.addBtnListener(e,t),this.actionDiv.appendChild(e)}createTextInput(){const e=document.createElement("input");return e.type="text",e.setAttribute("placeholder",this.textInputPlaceholder),e}createNextBtn(){return this.createBtn("blockly-ws-search-next-btn","Find next")}createPreviousBtn(){return this.createBtn("blockly-ws-search-previous-btn","Find previous")}createCloseBtn(){return this.createBtn("blockly-ws-search-close-btn","Close search bar")}createBtn(t,n){const i=document.createElement("button");return e.utils.dom.addClass(i,t),i.setAttribute("aria-label",n),i}addBtnListener(e,t){this.addEvent(e,"click",this,t),this.addEvent(e,"keydown",this,(e=>{"Enter"===e.key?(t(e),e.preventDefault()):"Escape"===e.key&&this.close(),e.stopPropagation()}))}getBoundingRectangle(){return null}position(t,n){this.workspace.RTL?this.htmlDiv.style.left=t.absoluteMetrics.left+"px":t.toolboxMetrics.position===e.TOOLBOX_AT_RIGHT?this.htmlDiv.style.right=t.toolboxMetrics.width+"px":this.htmlDiv.style.right="0",this.htmlDiv.style.top=t.absoluteMetrics.top+"px"}onInput(){if(this.searchOnInput){const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onKeyDown(e){if("Escape"===e.key)this.close();else if("Enter"===e.key)if(this.searchOnInput)this.next();else{const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onWorkspaceKeyDown(e){(e.ctrlKey||e.metaKey)&&"f"===e.key&&(this.open(),e.preventDefault(),e.stopPropagation())}previous(){this.setCurrentBlock(this.currentBlockIndex-1)}next(){this.setCurrentBlock(this.currentBlockIndex+1)}setSearchPlaceholder(e){this.textInputPlaceholder=e,this.inputElement&&this.inputElement.setAttribute("placeholder",this.textInputPlaceholder)}setCurrentBlock(e){if(!this.blocks.length)return;let t=this.blocks[this.currentBlockIndex];t&&this.unhighlightCurrentSelection(t),this.currentBlockIndex=(e%this.blocks.length+this.blocks.length)%this.blocks.length,t=this.blocks[this.currentBlockIndex],this.highlightCurrentSelection(t),this.workspace.centerOnBlock(t.id,!1)}open(){this.setVisible(!0),this.inputElement.focus(),this.searchText&&this.searchAndHighlight(this.searchText)}close(){this.setVisible(!1),this.workspace.markFocused(),this.clearBlocks()}setVisible(e){this.htmlDiv.style.display=e?"flex":"none"}searchAndHighlight(e,t){const n=this.blocks[this.currentBlockIndex];this.searchText=e.trim(),this.clearBlocks(),this.blocks=this.getMatchingBlocks(this.workspace,this.searchText,this.caseSensitive),this.highlightSearchGroup(this.blocks);let i=0;t&&(i=this.blocks.indexOf(n),i=i>-1?i:0),this.setCurrentBlock(i)}getSearchPool(e){return e.getAllBlocks(!0).filter((e=>{const t=e.getSurroundParent();return!t||!t.isCollapsed()}))}isBlockMatch(e,t,n){let i="";if(e.isCollapsed())i=e.toString();else{const t=[];e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{t.push(e.getText())}))})),i=t.join(" ").trim()}return n||(i=i.toLowerCase()),i.indexOf(t)>-1}getMatchingBlocks(e,t,n){return t?(this.caseSensitive||(t=t.toLowerCase()),this.getSearchPool(e).filter((e=>this.isBlockMatch(e,t,n)))):[]}clearBlocks(){this.unhighlightSearchGroup(this.blocks);const e=this.blocks[this.currentBlockIndex];e&&this.unhighlightCurrentSelection(e),this.currentBlockIndex=-1,this.blocks=[]}highlightCurrentSelection(t){const n=t.pathObject.svgPath;e.utils.dom.addClass(n,"blockly-ws-search-current")}unhighlightCurrentSelection(t){const n=t.pathObject.svgPath;e.utils.dom.removeClass(n,"blockly-ws-search-current")}highlightSearchGroup(t){t.forEach((t=>{const n=t.pathObject.svgPath;e.utils.dom.addClass(n,"blockly-ws-search-highlight")}))}unhighlightSearchGroup(t){t.forEach((t=>{const n=t.pathObject.svgPath;e.utils.dom.removeClass(n,"blockly-ws-search-highlight")}))}}})(),r})()))},{"blockly/core":375}],366:[function(e,t,n){var i,r;i=window,r=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=void 0,function(e){e[e.Disable=0]="Disable",e[e.Enable=1]="Enable"}(t.CookiePolicy||(t.CookiePolicy={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=t.launchAsync=t.close=t.renderButtons=void 0;var i=n(2);Object.defineProperty(t,"renderButtons",{enumerable:!0,get:function(){return i.renderButtons}});var r=n(3);Object.defineProperty(t,"close",{enumerable:!0,get:function(){return r.close}}),Object.defineProperty(t,"launchAsync",{enumerable:!0,get:function(){return r.launchAsync}});var o=n(0);Object.defineProperty(t,"CookiePolicy",{enumerable:!0,get:function(){return o.CookiePolicy}}),"undefined"!=typeof window&&window.addEventListener("load",(function(){var e;window.hasOwnProperty("Promise")||((e=document.createElement("script")).src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/promise-polyfill.min.js",document.head.appendChild(e)),i.renderButtons()}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderButtons=void 0;var i={af:"Indompelende leser",am:"    ",ar:" ",as:" ",az:"mmersiv Oxuyucu",be:" ",bg:" ",bn:" ","bn-bd":" ",bs:"Koncentrirani italac",ca:"Lector immersiu",cs:"Asistivn teka","cy-gb":"Darllenydd Ymdrwythol",da:"Forenklet lser",de:"Plastischer Reader",el:"  ",en:"Immersive Reader",es:"Lector inmersivo",et:"Svaluger",eu:"Irakurgailu murgiltzailea",fa:" ",fi:"Syventv lukuohjelma",fil:"Immersive Reader",fr:"Lecteur immersif","ga-ie":"Litheoir tumthach",gd:"An leughadair r-nsach",gl:"Lector avanzado",gu:" ",ha:"Mai karatu Mai barbazawa",he:"  ",hi:" ",hr:"Stopljeni ita",hu:"Modern olvas",hy:" ",id:"Pembaca Imersif",ig:"g Kenziptara",is:"Agengilegt lestrarumhverfi",it:"Strumento di lettura immersiva",ja:" ",ka:" ",kk:"  ",km:"",kn:" ",ko:" ",kok:"  ","ku-arab":" ",ky:" ",lb:"Immersive Reader",lo:"",lt:"traukianti skaitytuv",lv:"Trskata lastjs",mi:"Ppnui Rumaki",mk:" ",ml:" ",mn:" ",mr:" ",ms:"Pembaca Imersif",mt:"Qarrej Immersiv",ne:" ",nl:"Insluitende lezer","nn-no":"Engasjerande lesar",no:"Engasjerende leser",nso:"Go Bala ka Mongwalo o Mokoto",or:" ",pa:" ","pa-arab":"   ",pl:"Czytnik immersyjny",prs:" ",pt:"Leitura Avanada",quc:"Nim ucholajil sik'inel uwach",quz:"Wankisqa awiq",ro:"Immersive Reader",ru:"  ",rw:"Insakazasoma",sd:" ",si:"  ",sk:"Imerzn taka",sl:"Potopni bralnik",sq:"Lexuesi kredhs","sr-cyrl-ba":" ","sr-cyrl-rs":" ","sr-latn-rs":"Koncentrisani italac",sv:"Avancerad lsare",sw:"Kisomaji cha Kuzamisha",ta:" ",te:"   ","tg-cyrl-tj":" ",th:"",ti:"   ",tk:"Giilein okajy",tn:"Sebadi sa Imesife",tr:"Tam Ekran Okuyucu",tt:"   ","ug-cn":" ",uk:"  ",ur:"  ",uz:"Immersiv mutolaa vositasi",vi:"Trnh c Chn thc",wo:"Jngukaay bu Rafet",xh:"Isifundi Esikhulu",yo:"w Almtn",zh:"","zh-hant":"",zu:"Isifundi Sokuzizwisa"};function r(e){var t=document.createElement("img");t.src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/immersive-reader-icon.svg";var n=e.getAttribute("data-icon-px-size")||"20";t.style.height=t.style.width=n+"px",t.style.verticalAlign="middle",t.style.marginTop="-2px";var i=e.getAttribute("data-locale")||"en";t.alt=a(i),e.appendChild(t)}function o(e){var t=document.createElement("span");t.style.marginLeft="8px",e.appendChild(t)}function s(e){var t=document.createElement("span"),n=e.getAttribute("data-locale")||"en";t.textContent=a(n),e.appendChild(t)}function a(e){return e=e.toLowerCase(),i[e]?i[e]:"zh-hk"===e||"zh-mo"===e||"zh-tw"===e?i["zh-hant"]:(e=e.substring(0,e.lastIndexOf("-")),i[e]?i[e]:(e=e.substring(0,e.lastIndexOf("-")),i[e]?i[e]:i.en))}t.renderButtons=function(e){var t=document.createElement("style");t.innerHTML=".immersive-reader-button{cursor:pointer;display:inline-block;padding:5px;} .immersive-reader-button:hover{background:rgba(0,0,0,.05);border-radius:2px",document.head.appendChild(t);var n=[].slice.call(document.getElementsByClassName("immersive-reader-button"));e&&e.elements&&(n=e.elements);for(var i=0,l=n;i<l.length;i++){var c=l[i];c.setAttribute("role","button");var u=c.getAttribute("data-locale")||"en";switch(c.setAttribute("aria-label",a(u)),c.getAttribute("data-button-style")||"icon"){case"icon":r(c);break;case"text":s(c);break;case"iconAndText":r(c),o(c),s(c)}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.isValidSubdomain=t.close=t.launchAsync=void 0;var r=n(0),o=n(4),s={};s[o.ErrorCode.TokenExpired]="The access token supplied is expired.",s[o.ErrorCode.Throttled]="You have exceeded your quota.",s[o.ErrorCode.ServerError]="An error occurred when calling the server to process the text.",s[o.ErrorCode.InvalidSubdomain]="The subdomain supplied is invalid.";var a=!1;function l(e){return!!e&&new RegExp("^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])$").test(e)}t.launchAsync=function(e,t,n,c){return a?Promise.reject("Immersive Reader is already launching"):new Promise((function(u,d){if(e)if(n)if(n.chunks)if(n.chunks.length)if(l(t)||c&&c.customDomain){a=!0;var h=Date.now();(c=i({uiZIndex:1e3,timeout:15e3,useWebview:!1,allowFullscreen:!0,hideExitButton:!1,cookiePolicy:r.CookiePolicy.Disable},c)).uiZIndex&&"number"==typeof c.uiZIndex||(c.uiZIndex=1e3);var p=null,f=document.createElement("div"),g=c.useWebview?document.createElement("webview"):document.createElement("iframe");g.allow="autoplay";var m=document.createElement("style");m.innerHTML="body{height:100%;overflow:hidden;}";var b=function(){p&&(window.clearTimeout(p),p=null)},y=function(){document.body.contains(f)&&document.body.removeChild(f),window.removeEventListener("message",_),b(),m.parentNode&&m.parentNode.removeChild(m)},v=function(){if(y(),c.onExit)try{c.onExit()}catch(e){}};y();var _=function(i){if(i&&i.data&&"string"==typeof i.data)if("ImmersiveReader-ReadyForContent"===i.data){b();var r={cogSvcsAccessToken:e,cogSvcsSubdomain:t,request:n,launchToPostMessageSentDurationInMs:Date.now()-h,disableFirstRun:c.disableFirstRun,readAloudOptions:c.readAloudOptions,translationOptions:c.translationOptions,displayOptions:c.displayOptions,sendPreferences:!!c.onPreferencesChanged,preferences:c.preferences};g.contentWindow.postMessage(JSON.stringify({messageType:"Content",messageValue:r}),"*")}else if("ImmersiveReader-Exit"===i.data)v();else if(i.data.startsWith("ImmersiveReader-LaunchResponse:")){var l=null,p=null,m=null;try{m=JSON.parse(i.data.substring("ImmersiveReader-LaunchResponse:".length))}catch(e){}m&&m.success?l={container:f,sessionId:m.sessionId,charactersProcessed:m.meteredContentSize}:p=m&&!m.success?{code:m.errorCode,message:s[m.errorCode],sessionId:m.sessionId}:{code:o.ErrorCode.ServerError,message:s[o.ErrorCode.ServerError]},a=!1,l?(b(),u(l)):p&&(v(),d(p))}else if(i.data.startsWith("ImmersiveReader-Preferences:")&&c.onPreferencesChanged&&"function"==typeof c.onPreferencesChanged)try{c.onPreferencesChanged(i.data.substring("ImmersiveReader-Preferences:".length))}catch(e){}};window.addEventListener("message",_),p=window.setTimeout((function(){y(),a=!1,d({code:o.ErrorCode.Timeout,message:"Page failed to load after timeout ("+c.timeout+" ms)"})}),c.timeout),c.allowFullscreen&&g.setAttribute("allowfullscreen",""),g.style.cssText="position: static; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0",c.useWebview&&g.addEventListener("loadstop",(function(){g.contentWindow.postMessage(JSON.stringify({messageType:"WebviewHost"}),"*")}));var E=(c.customDomain?c.customDomain:"https://"+t+".cognitiveservices.azure.com/immersivereader/webapp/v1.0/")+"reader?exitCallback=ImmersiveReader-Exit&sdkPlatform=js&sdkVersion=1.1.0";E+="&cookiePolicy="+(c.cookiePolicy===r.CookiePolicy.Enable?"enable":"disable"),c.hideExitButton&&(E+="&hideExitButton=true"),c.uiLang&&(E+="&omkt="+c.uiLang),g.src=E,f.style.cssText="position: fixed; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0; -webkit-perspective: 1px; z-index: "+c.uiZIndex+"; background: white; overflow: hidden",f.appendChild(g),document.body.appendChild(f),document.head.appendChild(m)}else d({code:o.ErrorCode.InvalidSubdomain,message:s[o.ErrorCode.InvalidSubdomain]});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be empty"});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Content must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Token must not be null"})}))},t.close=function(){window.postMessage("ImmersiveReader-Exit","*")},t.isValidSubdomain=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,function(e){e.BadArgument="BadArgument",e.Timeout="Timeout",e.TokenExpired="TokenExpired",e.Throttled="Throttled",e.ServerError="ServerError",e.InvalidSubdomain="InvalidSubdomain"}(t.ErrorCode||(t.ErrorCode={}))}])},"object"==typeof n&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.ImmersiveReader=r():i.ImmersiveReader=r()},{}],367:[function(e,t,n){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var n=[],i=-1;++i<t;)n[i]=arguments[i];return e.call(this,n)}return e.call(this,[])}}},{}],368:[function(e,t,n){(function(n){(function(){"use strict";var i=e("object.assign/polyfill")();function r(e,t){if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0}function o(e){return n.Buffer&&"function"==typeof n.Buffer.isBuffer?n.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var s=e("util/"),a=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function d(e){return!o(e)&&"function"==typeof n.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var h=t.exports=y,p=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(s.isFunction(e)){if(c)return e.name;var t=e.toString().match(p);return t&&t[1]}}function g(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function m(e){if(c||!s.isFunction(e))return s.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function b(e,t,n,i,r){throw new h.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function y(e,t){e||b(e,!0,t,"==",h.ok)}function v(e,t,n,i){if(e===t)return!0;if(o(e)&&o(t))return 0===r(e,t);if(s.isDate(e)&&s.isDate(t))return e.getTime()===t.getTime();if(s.isRegExp(e)&&s.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(d(e)&&d(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var a=(i=i||{actual:[],expected:[]}).actual.indexOf(e);return-1!==a&&a===i.expected.indexOf(t)||(i.actual.push(e),i.expected.push(t),function(e,t,n,i){if(null==e||null==t)return!1;if(s.isPrimitive(e)||s.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=_(e),o=_(t);if(r&&!o||!r&&o)return!1;if(r)return v(e=l.call(e),t=l.call(t),n);var a,c,u=x(e),d=x(t);if(u.length!==d.length)return!1;for(u.sort(),d.sort(),c=u.length-1;c>=0;c--)if(u[c]!==d[c])return!1;for(c=u.length-1;c>=0;c--)if(!v(e[a=u[c]],t[a],n,i))return!1;return!0}(e,t,n,i))}return n?e===t:e==t}function _(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function E(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function T(e,t,n,i){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(i=n,n=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&b(r,n,"Missing expected exception"+i);var o="string"==typeof i,a=!e&&r&&!n;if((!e&&s.isError(r)&&o&&E(r,n)||a)&&b(r,n,"Got unwanted exception"+i),e&&r&&n&&!E(r,n)||!e&&r)throw r}h.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return g(m(e.actual),128)+" "+e.operator+" "+g(m(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||b;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,r=f(t),o=i.indexOf("\n"+r);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1)}this.stack=i}}},s.inherits(h.AssertionError,Error),h.fail=b,h.ok=y,h.equal=function(e,t,n){e!=t&&b(e,t,n,"==",h.equal)},h.notEqual=function(e,t,n){e==t&&b(e,t,n,"!=",h.notEqual)},h.deepEqual=function(e,t,n){v(e,t,!1)||b(e,t,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,n){v(e,t,!0)||b(e,t,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,n){v(e,t,!1)&&b(e,t,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,n,i){v(t,n,!0)&&b(t,n,i,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,n){e!==t&&b(e,t,n,"===",h.strictEqual)},h.notStrictEqual=function(e,t,n){e===t&&b(e,t,n,"!==",h.notStrictEqual)},h.throws=function(e,t,n){T(!0,e,t,n)},h.doesNotThrow=function(e,t,n){T(!1,e,t,n)},h.ifError=function(e){if(e)throw e},h.strict=i((function e(t,n){t||b(t,!0,n,"==",e)}),h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var x=Object.keys||function(e){var t=[];for(var n in e)a.call(e,n)&&t.push(n);return t}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object.assign/polyfill":470,"util/":624}],369:[function(e,t,n){"use strict";n.byteLength=function(e){var t=c(e),n=t[0],i=t[1];return 3*(n+i)/4-i},n.toByteArray=function(e){var t,n,i=c(e),s=i[0],a=i[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),u=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],s=0,a=n-r;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));return 1===r?(t=e[n-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),o.join("")};for(var i=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)i[a]=s[a],r[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function d(e,t,n){for(var i,r=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(u(i));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],370:[function(e,t,n){var i,r;i=this,r=function(e){return e},"function"==typeof define&&define.amd?define(["./blockly_compressed"],r):"object"==typeof n?t.exports=e("./blockly_compressed"):i.Blockly=i.Blockly},{"./blockly_compressed":371}],371:[function(e,t,n){(function(e){(function(){var i,r;i=this,r=function(){var t,n,i,r,o,s,a,l,c,u,d,h,p,f,g,m,b,y,v,_,E,T,x,w,k,S,C,A,I,O,N,R,D,L,M,P,B,j,F,$,U,H,G,V,W,z,q,Y,K,Z,X,J,Q,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,de,he,pe,fe,ge,me,be,ye,ve,_e,Ee,Te,xe,we,ke,Se,Ce,Ae,Ie,Oe,Ne,Re,De,Le,Me,Pe,Be,je,Fe,$e,Ue,He,Ge,Ve,We,ze,qe,Ye,Ke,Ze,Xe,Je,Qe,et,tt,nt,it,rt,ot,st,at,lt,ct,ut,dt,ht,pt,ft,gt,mt,bt,yt,vt,_t,Et,Tt,xt,wt,kt,St,Ct,At,It,Ot,Nt,Rt,Dt,Lt,Mt,Pt,Bt,jt,Ft,$t,Ut,Ht,Gt,Vt,Wt,zt,qt,Yt,Kt,Zt,Xt,Jt,Qt,en,tn,nn,rn,on,sn,an,ln,cn,un,dn,hn,pn,fn,gn,mn,bn,yn,vn,_n,En,Tn,xn,wn,kn,Sn,Cn,An,In,On,Nn,Rn,Dn,Ln,Mn,Pn,Bn,jn,Fn,$n,Un,Hn,Gn,Vn,Wn,zn,qn,Yn,Kn,Zn,Xn,Jn,Qn,ei,ti,ni,ii,ri,oi,si,ai,li,ci,ui,di,hi,pi,fi,gi,mi,bi,yi,vi,_i,Ei,Ti,xi,wi,ki,Si,Ci,Ai,Ii,Oi,Ni,Ri,Di,Li,Mi,Pi,Bi,ji,Fi,$i,Ui,Hi,Gi,Vi,Wi,zi,qi,Yi,Ki,Zi,Xi,Ji,Qi,er,tr,nr,ir,rr,or,sr,ar,lr,cr,ur,dr,hr,pr,fr,gr,mr,br,yr,vr,_r,Er,Tr,xr,wr,kr,Sr,Cr,Ar,Ir,Or,Nr,Rr,Dr,Lr,Mr,Pr,Br,jr,Fr,$r,Ur,Hr,Gr,Vr,Wr,zr,qr,Yr,Kr,Zr,Xr,Jr,Qr,eo,to,no,io,ro,oo,so,ao,lo,co,uo,ho,po,fo,go,mo,bo,yo,vo,_o,Eo,To,xo,wo,ko,So,Co,Ao,Io,Oo,No,Ro,Do,Lo,Mo,Po,Bo,jo,Fo,$o,Uo,Ho,Go,Vo,Wo,zo,qo,Yo,Ko,Zo,Xo,Jo,Qo,es,ts,ns,is,rs,os,ss,as,ls,cs,us,ds,hs,ps,fs,gs,ms,bs,ys,vs,_s,Es,Ts,xs,ws,ks,Ss,Cs,As,Is,Os,Ns,Rs,Ds,Ls,Ms={};t=function(e,t,i,r){if(!(e instanceof $s)&&"string"!=typeof e||""===`${e}`.trim())throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),"string"!=typeof t||""===t.trim())throw Error('Invalid name "'+t+'". The name must be a non-empty string.');const o=t.toLowerCase();if(!i)throw Error("Can not register a null value");let s=Ps[e],a=js[e];if(s||(s=Ps[e]=Object.create(null),a=js[e]=Object.create(null)),n(e,i),!r&&s[o])throw Error('Name "'+o+'" with type "'+e+'" already registered.');s[o]=i,a[o]=t},n=function(e,t){switch(e){case String($s.FIELD):if("function"!=typeof t.fromJson)throw Error('Type "'+e+'" must have a fromJson function')}},i=function(e,t){e=`${e}`.toLowerCase(),t=t.toLowerCase();const n=Ps[e];n&&n[t]?(delete Ps[e][t],delete js[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},r=function(e,t,n){e=`${e}`.toLowerCase(),t=t.toLowerCase();const i=Ps[e];if(!i||!i[t]){if(t="Unable to find ["+t+"]["+e+"] in the registry.",n)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null}return i[t]},o=function(e,t){return e=`${e}`.toLowerCase(),t=t.toLowerCase(),!!(e=Ps[e])&&!!e[t]},s=function(e,t,n){return r(e,t,n)},a=function(e,t,n){return r(e,t,n)},l=function(e,t,n){e=`${e}`.toLowerCase();var i=Ps[e];if(!i){if(i=`Unable to find [${e}] in the registry.`,n)throw Error(`${i} You must require or register a ${e} plugin.`);return console.warn(i),null}if(!t)return i;e=js[e],n=Object.create(null);for(const t of Object.keys(i))n[e[t]]=i[t];return n},c=function(e,t,n){return"function"==typeof(t=t.plugins[String(e)]||Fs)?t:s(e,t,n)},u=function(e){return Ws[e]||null},d=function(){const e=[];for(const t in Ws)e.push(Ws[t]);return e},h=function(e){Ws[e.id]=e},p=function(e){delete Ws[e.id]},f=function(){return Hs},g=function(e){Hs=e},m=function(){return zs},b=function(e){zs=e},y=function(){return Gs},v=function(e){Gs=e},_=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const t=e.getParentSvg(),n=e.getCachedParentSvgSize();var i=t.parentElement;if(i instanceof HTMLElement){var r=i.offsetWidth;i=i.offsetHeight,n.width!==r&&(t.setAttribute("width",r+"px"),e.setCachedParentSvgSize(r,null)),n.height!==i&&(t.setAttribute("height",i+"px"),e.setCachedParentSvgSize(null,i)),e.resize()}},E=function(e,t){const n=Object.create(null),i=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=i.indexOf(e),i.splice(e,i.length-e));for(let e,t=0;e=i[t];t++)n[e.type]?n[e.type]++:n[e.type]=1;return n},T=function(e){return function(){this.jsonInit(e)}},x=function(e){Ys.defineBlocksWithJsonArrayInternal(e)},w=function(e){Ms.defineBlocks$$module$build$src$core$common(Ms.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},Ms.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];if(!i){console.warn(`Block definition #${n} in JSON array is ${i}. Skipping`);continue}const r=i.type;r?t[r]={init:T(i)}:console.warn(`Block definition #${n} in JSON array is missing a type attribute. Skipping.`)}return t},Ms.defineBlocks$$module$build$src$core$common=function(e){for(const t of Object.keys(e)){const n=e[t];t in Vs&&console.warn(`Block definiton "${t}" overwrites previous definition.`),Vs[t]=n}},k=function(){return"blockly-"+(pa++).toString(36)},S=function(){return ha.genUid()},C=function(e){Xs=e},A=function(){return Xs},I=function(e){ua.fireInternal(e)},O=function(e){if(L()){if(!ca.length)try{requestAnimationFrame((()=>{setTimeout(N,0)}))}catch(e){setTimeout(N,0)}ca.push(e)}},N=function(){var e=R(ca,!0);ca.length=0;for(let n,i=0;n=e[i];i++)if(n.workspaceId){var t=u(n.workspaceId);t&&t.fireChangeListener(n)}e=new Set(e.map((e=>e.workspaceId)));for(const n of e){if(!n)continue;if(!(e=u(n)))continue;let i;for(t=(e=e.getUndoStack()).length;0<t;t--){const n=e[t-1];if(""===n.group)break;if(void 0===i)i=n.group;else if(n.group!==i)break}i&&t!=e.length-1&&(t=e.splice(t,e.length-t),t=R(t,!0),e.push(...t))}},R=function(e,t){e=e.slice(),t||e.reverse();const n=[],i=Object.create(null);for(let t,s=0;t=e[s];s++)if(!t.isNull()){var r=[t.isUiEvent?ta:t.type,t.blockId,t.workspaceId].join(" "),o=i[r];const e=o?o.event:null;o?t.type===Ms.MOVE$$module$build$src$core$events$utils&&o.index===s-1?(r=t,e.newParentId=r.newParentId,e.newInputName=r.newInputName,e.newCoordinate=r.newCoordinate,r.reason&&(e.reason?(r=new Set(r.reason.concat(e.reason)),e.reason=Array.from(r)):e.reason=r.reason),o.index=s):t.type===Ms.CHANGE$$module$build$src$core$events$utils&&t.element===e.element&&t.name===e.name?e.newValue=t.newValue:t.type===ra?(o=t,e.viewTop=o.viewTop,e.viewLeft=o.viewLeft,e.scale=o.scale,e.oldScale=o.oldScale):t.type===na&&e.type===ia||(i[r]={event:t,index:s},n.push(t)):(i[r]={event:t,index:s},n.push(t))}e=n.filter((function(e){return!e.isNull()})),t||e.reverse();for(let t,n=1;t=e[n];n++)t.type===Ms.CHANGE$$module$build$src$core$events$utils&&"mutation"===t.element&&e.unshift(e.splice(n,1)[0]);return e},D=function(){for(let e,t=0;e=ca[t];t++)e.recordUndo=!1},Ms.disable$$module$build$src$core$events$utils=function(){Js++},Ms.enable$$module$build$src$core$events$utils=function(){Js--},L=function(){return 0===Js},Ms.getGroup$$module$build$src$core$events$utils=function(){return Zs},Ms.setGroup$$module$build$src$core$events$utils=function(e){ua.setGroupInternal(e)},M=function(e){Zs="boolean"==typeof e?e?S():"":e},P=function(e){const t=[];e=e.getDescendants(!1);for(let n,i=0;n=e[i];i++)t[i]=n.id;return t},B=function(e,t){const n=j(e.type);if(!n)throw Error("Unknown event type.");return n.fromJson(e,t)},j=function(e){const t=s($s.EVENT,e);if(!t)throw Error(`Event type ${e} not found in registry.`);return t},F=function(e){if((e.type===Ms.MOVE$$module$build$src$core$events$utils||e.type===Ms.CREATE$$module$build$src$core$events$utils)&&e.workspaceId){var t=u(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){const n=Xs;try{Xs=!1;const i=e.getParent();if(i&&i.isEnabled()){const t=e.getDescendants(!1);for(let e,n=0;e=t[n];n++)e.setEnabled(!0)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())do{e.setEnabled(!1),e=e.getNextBlock()}while(e)}finally{Xs=n}}}},$=function(e,t){U(),Ma=setTimeout((function(){t&&t.handleRightClick(e)}),Na)},U=function(){Ma&&(clearTimeout(Ma),Ma=0)},H=function(){Da=null},G=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&W(e)},V=function(e){return`${e.pointerId}`},W=function(e){const t=V(e);return Da?Da===t:"pointerdown"===e.type&&(Da=t,!0)},z=function(e,t,n,i,r){function o(e){(r||G(e))&&(n?i.call(n,e):i(e))}const s=[];if(t in La)for(let n=0;n<La[t].length;n++){const i=La[t][n];e.addEventListener(i,o,!1),s.push([e,i,o])}else e.addEventListener(t,o,!1),s.push([e,t,o]);return s},q=function(e,t,n,i){function r(e){n?i.call(n,e):i(e)}const o=[];if(t in La)for(let n=0;n<La[t].length;n++){const i=La[t][n];e.addEventListener(i,r,!1),o.push([e,i,r])}else e.addEventListener(t,r,!1),o.push([e,t,r]);return o},Y=function(e){const t=e[e.length-1][2];for(;e.length;){const[t,n,i]=e.pop();t.removeEventListener(n,i,!1)}return t},K=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||"true"===e.target.getAttribute("data-is-text-input"))return!0;if(e.target instanceof HTMLInputElement)return"text"===(e=e.target).type||"number"===e.type||"email"===e.type||"password"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type;if(e.target instanceof HTMLTextAreaElement)return!0}return!1},Z=function(e){return!(!e.ctrlKey||!Ha)||2===e.button},X=function(e,t,n){const i=t.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,n||(n=t.getScreenCTM().inverse()),i.matrixTransform(n)},J=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*Wa,y:e.deltaY*Wa};case 2:return{x:e.deltaX*za,y:e.deltaY*za}}},Q=function(e,t){return-1!==(t=e.indexOf(t))&&(e.splice(t,1),!0)},ee=function(e){if(Xa)throw Error("CSS already injected");Ja+="\n"+e},te=function(e,t){Xa||(Xa=!0,e&&(e=t.replace(/[\\/]$/,""),t=Ja.replace(/<<<PATH>>>/g,e),Ja="",(e=document.createElement("style")).id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},ne=function(e,t,n,i){e=e+" was deprecated in "+t+" and will be deleted in "+n+".",i&&(e+="\nUse "+i+" instead."),tl.has(e)||(tl.add(e),console.warn(e))},ie=function(e,t,n){e=document.createElementNS(rl,`${e}`);for(const n in t)e.setAttribute(n,`${t[n]}`);return n&&n.appendChild(e),e},re=function(e,t){return!(t=t.split(" ")).every((t=>e.classList.contains(t)))&&(e.classList.add(...t),!0)},oe=function(e,t){e.classList.remove(...t.split(" "))},se=function(e,t){return!(t=t.split(" ")).every((t=>!e.classList.contains(t)))&&(e.classList.remove(...t),!0)},ae=function(e,t){return e.classList.contains(t)},le=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},ce=function(e,t){const n=t.nextSibling;if(!(t=t.parentNode))throw Error("Reference node has no parent.");n?t.insertBefore(e,n):t.appendChild(e)},ue=function(e,t){return ne("Blockly.utils.dom.containsNode","version 10","version 11",'Use native "contains" DOM method'),e.contains(t)},de=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},he=function(){ll++,al||(al=Object.create(null))},pe=function(){--ll||(al=null)},fe=function(e){const t=e.textContent+"\n"+e.className.baseVal;let n;if(al&&(n=al[t]))return n;try{n=e.getComputedTextLength()}catch(t){return 8*e.textContent.length}return al&&(al[t]=n),n},ge=function(e,t,n,i){return me(e,t+"pt",n,i)},me=function(e,t,n,i){const r=e.textContent;var o;return e=r+"\n"+e.className.baseVal,al&&(o=al[e])||(cl||((o=document.createElement("canvas")).className="blocklyComputeCanvas",document.body.appendChild(o),cl=o.getContext("2d")),cl.font=n+" "+t+" "+i,o=r?cl.measureText(r).width:0,al&&(al[e]=o)),o},be=function(e,t,n,i){const r=document.createElement("span");r.style.font=n+" "+t+" "+i,r.textContent=e,(e=document.createElement("div")).style.width="1px",e.style.height="0",(t=document.createElement("div")).style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(r),t.appendChild(e),document.body.appendChild(t),n={height:0,baseline:0};try{t.style.alignItems="baseline",n.baseline=e.offsetTop-r.offsetTop,t.style.alignItems="flex-end",n.height=e.offsetTop-r.offsetTop}finally{document.body.removeChild(t)}return n},ye=function(e){return fl.getSizeInternal(e)},ve=function(e){if("none"!==Ee(e,"display"))return _e(e);const t=e.style,n=t.display,i=t.visibility,r=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";const o=e.offsetWidth;return e=e.offsetHeight,t.display=n,t.position=r,t.visibility=i,new pl(o,e)},_e=function(e){return new pl(e.offsetWidth,e.offsetHeight)},Ee=function(e,t){return(e=window.getComputedStyle(e))[t]||e.getPropertyValue(t)},Te=function(e){const t=new el(0,0);e=e.getBoundingClientRect();var n=document.documentElement;return n=new el(window.pageXOffset||n.scrollLeft,window.pageYOffset||n.scrollTop),t.x=e.left+n.x,t.y=e.top+n.y,t},xe=function(){const e=document.body,t=document.documentElement;return new el(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},we=function(e){const t=parseFloat(Ee(e,"borderLeftWidth")),n=parseFloat(Ee(e,"borderRightWidth")),i=parseFloat(Ee(e,"borderTopWidth"));return e=parseFloat(Ee(e,"borderBottomWidth")),new hl(i,e,t,n)},ke=function(e,t,n){e=Se(e,t,n),t.scrollLeft=e.x,t.scrollTop=e.y},Se=function(e,t,n){var i=Te(e),r=Te(t),o=we(t);const s=i.x-r.x-o.left;return i=i.y-r.y-o.top,r=_e(e),e=t.clientWidth-r.width,r=t.clientHeight-r.height,o=t.scrollLeft,t=t.scrollTop,n?(o+=s-e/2,t+=i-r/2):(o+=Math.min(s,Math.max(s-e,0)),t+=Math.min(i,Math.max(i-r,0))),new el(o,t)},Ce=function(e){const t=new el(0,0);var n=e.x&&e.getAttribute("x");const i=e.y&&e.getAttribute("y");return n&&(t.x=parseInt(n)),i&&(t.y=parseInt(i)),(n=(n=e.getAttribute("transform"))&&n.match(ml))&&(t.x+=Number(n[1]),n[3]&&(t.y+=Number(n[3]))),(e=e.getAttribute("style"))&&-1<e.indexOf("translate")&&(e=e.match(bl))&&(t.x+=Number(e[1]),e[3]&&(t.y+=Number(e[3]))),t},Ae=function(e){let t=0,n=0;for(;e;){const i=Ce(e);if(t+=i.x,n+=i.y,-1!==(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;e=e.parentNode}return new el(t,n)},Ie=function(){const e=xe();return new hl(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},Oe=function(){const e=document.documentElement,t=window;return new el(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},Ne=function(e,t){var n=t.x;t=t.y;const i=e.getInjectionDiv().getBoundingClientRect();return n=new el(n-i.left,t-i.top),t=e.getOriginOffsetInPixels(),el.difference(n,t).scale(1/e.scale)},Re=function(e,t){var n=t.scale(e.scale);t=n.x,n=n.y;const i=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new el(t+i.left+e.x,n+i.top+e.y)},De=function(e){({document:Tl=Tl,DOMParser:xl=xl,XMLSerializer:wl=wl}=e),_l=new xl,El=new wl},Ms.createElement$$module$build$src$core$utils$xml=function(e){return Tl.createElementNS(kl,e)},Ms.createTextNode$$module$build$src$core$utils$xml=function(e){return Tl.createTextNode(e)},Ms.textToDom$$module$build$src$core$utils$xml=function(e){let t=_l.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=_l.parseFromString(e,"text/html"))&&t.body.firstChild&&"xml"===t.body.firstChild.nodeName.toLowerCase())return t.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},Le=function(e){return Me(El.serializeToString(e))},Me=function(e){return e.replace(Sl,(e=>`&#${e.charCodeAt(0)};`))},Pe=function(e){return e?((e instanceof Element||"string"==typeof e)&&(e=We(e),e=He(e)),Be(e),e):null},Be=function(e){const t=e.kind;if(e=e.contents,t&&t!==Ol&&t!==Il)throw Error("Invalid toolbox kind "+t+". Please supply either "+Ol+" or "+Il);if(!e)throw Error("Toolbox must have a contents attribute.")},je=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:Ge(e):[]},Fe=function(e){return Ll.hasCategoriesInternal(e)},$e=function(e){if(!e)return!1;const t=e.kind;return t?t===Il:!!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length},Ue=function(e){return!(!e||!e.contents||!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length)},He=function(e){const t={contents:Ge(e)};return e instanceof Node&&Ve(e,t),t},Ge=function(e){const t=[];let n=e.childNodes;n||(n=e);for(let i,r=0;i=n[r];r++){if(!i.tagName)continue;e={};const n=i.tagName.toUpperCase();e.kind=n,"BLOCK"===n?e.blockxml=i:i.childNodes&&0<i.childNodes.length&&(e.contents=Ge(i)),Ve(i,e),t.push(e)}return t},Ve=function(e,t){for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];-1<i.nodeName.indexOf("css-")?(t.cssconfig=t.cssconfig||{},t.cssconfig[i.nodeName.replace("css-","")]=i.value):t[i.nodeName]=i.value}},We=function(e){let t=null;if(e)if("string"==typeof e){if("xml"!==(t=Ms.textToDom$$module$build$src$core$utils$xml(e)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},ze=function(e,t,n,i,r,o){const s=o.scrollbar&&o.scrollbar.canScrollVertically();return e.horizontal===Rl.LEFT?(n=r.absoluteMetrics.left+n,s&&o.RTL&&(n+=vl.scrollbarThickness)):(n=r.absoluteMetrics.left+r.viewMetrics.width-t.width-n,s&&!o.RTL&&(n-=vl.scrollbarThickness)),e.vertical===Nl.TOP?e=r.absoluteMetrics.top+i:(e=r.absoluteMetrics.top+r.viewMetrics.height-t.height-i,o.scrollbar&&o.scrollbar.canScrollHorizontally()&&(e-=vl.scrollbarThickness)),new hl(e,e+t.height,n,n+t.width)},qe=function(e,t){return{horizontal:t.toolboxMetrics.position===Al.LEFT||e.horizontalLayout&&!e.RTL?Rl.RIGHT:Rl.LEFT,vertical:t.toolboxMetrics.position===Al.BOTTOM?Nl.TOP:Nl.BOTTOM}},Ye=function(e,t,n,i){const r=e.left,o=e.right-e.left,s=e.bottom-e.top;for(let a=0;a<i.length;a++){const l=i[a];e.intersects(l)&&(e=n===Dl.UP?l.top-s-t:l.bottom+t,e=new hl(e,e+s,r,r+o),a=-1)}return e},Ke=function(e,t){Vl(e,t)},Ze=function(e){Vl=e},Xe=function(e,t){ql.confirmInternal(e,t)},Je=function(e,t){Wl(e,t)},Qe=function(e){Wl=e},et=function(e,t,n){zl(e,t,n)},tt=function(e){zl=e},nt=function(e){return void 0!==e.getVariableModel},it=function(e){return void 0!==e.getProcedureDef},rt=function(e){return void 0!==e.getProcedureCall&&void 0!==e.renameProcedure},Ms.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let n=0;n<e.length;n++){const i=e[n].getVarModels();if(i)for(let e=0;e<i.length;e++){const n=i[e];n.getId()&&t.add(n)}}return Array.from(t.values())},Ms.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let i,r=0;i=e[r];r++){var n=i.getDeveloperVariables;if(n){n=n();for(let e=0;e<n.length;e++)t.add(n[e])}}return Array.from(t.values())},ot=function(e){let t=[];const n=document.createElement("button");return n.setAttribute("text","%{BKY_NEW_VARIABLE}"),n.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){ut(e.getTargetWorkspace())})),t.push(n),e=st(e),t.concat(e)},st=function(e){const t=[];if(0<(e=e.getVariablesOfType("")).length){var n=e[e.length-1];if(Vs.variables_set){var i=Ms.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","variables_set"),i.setAttribute("gap",Vs.math_change?"8":"24"),i.appendChild(bt(n)),t.push(i)}if(Vs.math_change&&((i=Ms.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","math_change"),i.setAttribute("gap",Vs.variables_get?"20":"8"),i.appendChild(bt(n)),n=Ms.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),i.appendChild(n),t.push(i)),Vs.variables_get){e.sort(Jl.compareByName);for(let i,r=0;i=e[r];r++)(n=Ms.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get"),n.setAttribute("gap","8"),n.appendChild(bt(i)),t.push(n)}}return t},at=function(e){return ec.generateUniqueNameInternal(e)},lt=function(e){return ct(Ql.charAt(0),e.getAllVariableNames())},ct=function(e,t){if(!t.length)return e;const n=Ql;let i="",r=n.indexOf(e);for(;;){let o=!1;for(let n=0;n<t.length;n++)if(t[n].toLowerCase()===e){o=!0;break}if(!o)break;++r===n.length&&(r=0,i=`${Number(i)+1}`),e=n.charAt(r)+i}return e},ut=function(e,t,n){const i=n||"";!function n(r){dt(Ms.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,r,(function(r){if(r){var o=pt(r,e);if(o){if(o.type===i)var s=Ms.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",o.name);else s=(s=Ms.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",o.name).replace("%2",o.type);Ke(s,(function(){n(r)}))}else e.createVariable(r,i),t&&t(r)}else t&&t(null)}))}("")},Ms.renameVariable$$module$build$src$core$variables=function(e,t,n){!function i(r){const o=Ms.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",t.name);dt(o,r,(function(r){if(r){var o=ht(r,t.type,e),s=ft(t.name,r,e);if(o||s){var a="";o?a=Ms.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",o.name).replace("%2",o.type):s&&(a=Ms.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",r).replace("%2",s)),Ke(a,(function(){i(r)}))}else e.renameVariableById(t.getId(),r),n&&n(r)}else n&&n(null)}))}("")},dt=function(e,t,n){et(e,t,(function(e){e&&((e=e.replace(/[\s\xa0]+/g," ").trim())===Ms.Msg$$module$build$src$core$msg.RENAME_VARIABLE||e===Ms.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(e=null),n(e)}))},ht=function(e,t,n){n=n.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let i,r=0;i=n[r];r++)if(i.name.toLowerCase()===e&&i.type!==t)return i;return null},pt=function(e,t){t=t.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let n,i=0;n=t[i];i++)if(n.name.toLowerCase()===e)return n;return null},ft=function(e,t,n){return n.getProcedureMap().getProcedures().length?gt(e,t,n):mt(e,t,n)},gt=function(e,t,n){e=e.toLowerCase(),t=t.toLowerCase(),n=n.getProcedureMap().getProcedures();for(const r of n){var i=r.getParameters().filter(nt).map((e=>e.getVariableModel().name));if(i&&(n=i.some((t=>t.toLowerCase()===e)),i=i.some((e=>e.toLowerCase()===t)),n&&i))return r.getName()}return null},mt=function(e,t,n){e=e.toLowerCase(),t=t.toLowerCase(),n=n.getAllBlocks(!1);for(const r of n){if(!it(r))continue;var i=(n=r.getProcedureDef())[1];const o=i.some((t=>t.toLowerCase()===e));if(i=i.some((e=>e.toLowerCase()===t)),o&&i)return n[0]}return null},bt=function(e){const t=Ms.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.type),e=Ms.createTextNode$$module$build$src$core$utils$xml(e.name),t.appendChild(e),t},Ms.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,n,i){let r=Ms.getVariable$$module$build$src$core$variables(e,t,n,i);return r||(r=yt(e,t,n,i)),r},Ms.getVariable$$module$build$src$core$variables=function(e,t,n,i){const r=e.getPotentialVariableMap();let o=null;if(t&&(!(o=e.getVariableById(t))&&r&&(o=r.getVariableById(t)),o))return o;if(n){if(void 0===i)throw Error("Tried to look up a variable by name without a type");!(o=e.getVariable(n,i))&&r&&(o=r.getVariable(n,i))}return o},yt=function(e,t,n,i){const r=e.getPotentialVariableMap();return n||(n=at(e.isFlyout?e.targetWorkspace:e)),r?r.createVariable(n,i,t):e.createVariable(n,i,t)},vt=function(e,t){e=e.getAllVariables();const n=[];if(t.length!==e.length)for(let i=0;i<e.length;i++){const r=e[i];-1===t.indexOf(r)&&n.push(r)}return n},_t=function(e,n){t($s.PASTER,e,n)},Et=function(e){i($s.PASTER,e)},Tt=function(e){return St(e),kt()?(Ct(),Promise.resolve()):(cc||(cc=new Promise((e=>{uc=e,dc=window.requestAnimationFrame((()=>{Ct(),e()}))}))),cc)},xt=function(){return cc||Promise.resolve()},wt=function(e){e||window.cancelAnimationFrame(dc),Ct(e),!e&&uc&&uc()},kt=function(){return Ba},St=function(e){lc.add(e);const t=e.getParent();t?St(t):ac.add(e)},Ct=function(e){const t=e?new Set([e]):new Set([...ac].map((e=>e.workspace))),n=[...ac].filter(It).filter((e=>t.has(e.workspace)));for(var i of n)Ot(i);for(const e of t)e.resizeContents();for(const e of n)i=e.getRelativeToSurfaceXY(),e.updateComponentLocations(i);for(const e of n)At(e);e||(cc=null)},At=function(e){ac.delete(e),lc.delete(e);for(const t of e.getChildren(!1))At(t)},It=function(e){return!e.isDisposed()&&!e.getParent()},Ot=function(e){if(lc.has(e)){for(const t of e.getChildren(!1))Ot(t);e.renderEfficiently()}},Nt=function(e,t){const n=Ms.createElement$$module$build$src$core$utils$xml("xml");var i=Rt(Ms.allUsedVarModels$$module$build$src$core$variables(e));i.hasChildNodes()&&n.appendChild(i),i=e.getTopComments(!0);for(let e=0;e<i.length;e++)n.appendChild(i[e].toXmlWithXY(t));for(e=e.getTopBlocks(!0),i=0;i<e.length;i++)n.appendChild(Dt(e[i],t));return n},Rt=function(e){const t=Ms.createElement$$module$build$src$core$utils$xml("variables");for(let n=0;n<e.length;n++){const i=e[n],r=Ms.createElement$$module$build$src$core$utils$xml("variable");r.appendChild(Ms.createTextNode$$module$build$src$core$utils$xml(i.name)),i.type&&r.setAttribute("type",i.type),r.id=i.getId(),t.appendChild(r)}return t},Dt=function(e,t){if(e.isInsertionMarker()&&!(e=e.getChildren(!1)[0]))return new DocumentFragment;let n=0;if(e.workspace.RTL&&(n=e.workspace.getWidth()),t=Pt(e,t),tn(t)){const i=e.getRelativeToSurfaceXY();t.setAttribute("x",String(Math.round(e.workspace.RTL?n-i.x:i.x))),t.setAttribute("y",String(Math.round(i.y)))}return t},Lt=function(e){if(e.isSerializable()){const t=Ms.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name",e.name||""),e.toXml(t)}return null},Mt=function(e,t){for(let n=0;n<e.inputList.length;n++){const i=e.inputList[n];for(let e=0;e<i.fieldRow.length;e++){const n=Lt(i.fieldRow[e]);n&&t.appendChild(n)}}},Pt=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?Pt(t):new DocumentFragment;const n=Ms.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(n.setAttribute("type",e.type),t||(n.id=e.id),e.mutationToDom){var i=e.mutationToDom();i&&(i.hasChildNodes()||i.hasAttributes())&&n.appendChild(i)}if(Mt(e,n),i=e.getCommentText()){var r=e.getIcon(Ul.COMMENT),o=r.getBubbleSize();r=r.bubbleIsVisible();var s=Ms.createElement$$module$build$src$core$utils$xml("comment");s.appendChild(Ms.createTextNode$$module$build$src$core$utils$xml(i)),s.setAttribute("pinned",`${r}`),s.setAttribute("h",String(o.height)),s.setAttribute("w",String(o.width)),n.appendChild(s)}for(e.data&&((i=Ms.createElement$$module$build$src$core$utils$xml("data")).appendChild(Ms.createTextNode$$module$build$src$core$utils$xml(e.data)),n.appendChild(i)),i=0;i<e.inputList.length;i++){var a=void 0;if(r=!0,(o=e.inputList[i]).type!==Ms.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&o.type!==Ms.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){s=o.connection.targetBlock(),o.type===Ms.inputTypes$$module$build$src$core$inputs$input_types.VALUE?a=Ms.createElement$$module$build$src$core$utils$xml("value"):o.type===Ms.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(a=Ms.createElement$$module$build$src$core$utils$xml("statement"));const e=o.connection.getShadowDom();!e||s&&s.isShadow()||a.appendChild(Bt(e,t)),s&&(s=Pt(s,t)).nodeType===il.ELEMENT_NODE&&(a.appendChild(s),r=!1),a.setAttribute("name",o.name),r||n.appendChild(a)}}let l;return void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&n.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&n.setAttribute("collapsed","true"),e.isEnabled()||n.setAttribute("disabled","true"),e.isDeletable()||e.isShadow()||n.setAttribute("deletable","false"),e.isMovable()||e.isShadow()||n.setAttribute("movable","false"),e.isEditable()||n.setAttribute("editable","false"),(a=e.getNextBlock())&&(i=Pt(a,t)).nodeType===il.ELEMENT_NODE&&((l=Ms.createElement$$module$build$src$core$utils$xml("next")).appendChild(i),n.appendChild(l)),!(e=e.nextConnection&&e.nextConnection.getShadowDom())||a&&a.isShadow()||l.appendChild(Bt(e,t)),n},Bt=function(e,t){let n,i=e=e.cloneNode(!0);for(;i;)if(t&&"shadow"===i.nodeName&&i.removeAttribute("id"),i.firstChild)i=i.firstChild;else{for(;i&&!i.nextSibling;){let e;n=i,i=i.parentNode,n.nodeType===il.TEXT_NODE&&""===n.data.trim()&&(null==(e=i)?void 0:e.firstChild)!==n&&le(n)}i&&(n=i,i=i.nextSibling,n.nodeType===il.TEXT_NODE&&""===n.data.trim()&&le(n))}return e},jt=function(e){return Le(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Ft=function(e){e=jt(e).split("<");let t="";for(let n=1;n<e.length;n++){const i=e[n];"/"===i[0]&&(t=t.substring(2)),e[n]=t+"<"+i,"/"!==i[0]&&"/>"!==i.slice(-2)&&(t+="  ")}return(e=(e=e.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},$t=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=Ms.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},Ms.domToWorkspace$$module$build$src$core$xml=function(e,t){let n=0;t.RTL&&(n=t.getWidth());const i=[];he();const r=Ms.getGroup$$module$build$src$core$events$utils();r||Ms.setGroup$$module$build$src$core$events$utils(!0),t.setResizesEnabled&&t.setResizesEnabled(!1);let o=!0;try{for(let r,s=0;r=e.childNodes[s];s++){const e=r.nodeName.toLowerCase(),s=r;if("block"===e||"shadow"===e&&!A()){const e=Ht(s,t);let r;i.push(e.id);const a=parseInt(null!=(r=s.getAttribute("x"))?r:"10",10);let l;const c=parseInt(null!=(l=s.getAttribute("y"))?l:"10",10);isNaN(a)||isNaN(c)||e.moveBy(t.RTL?n-a:a,c,["create"]),o=!1}else{if("shadow"===e)throw TypeError("Shadow block cannot be a top-level block.");if("comment"===e)t.rendered?sc.fromXmlRendered(s,t,n):nc.fromXml(s,t);else if("variables"===e){if(!o)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");Gt(s,t),o=!1}}}}finally{Ms.setGroup$$module$build$src$core$events$utils(r),t.setResizesEnabled&&t.setResizesEnabled(!0),t.rendered&&wt(),pe()}return I(new(j(aa))(t)),i},Ut=function(e,t){if(!t.getBlocksBoundingBox)return Ms.domToWorkspace$$module$build$src$core$xml(e,t);var n=t.getBlocksBoundingBox();if(e=Ms.domToWorkspace$$module$build$src$core$xml(e,t),n&&n.top!==n.bottom){var i=n.bottom;n=t.RTL?n.right:n.left;var r=1/0;let o=-1/0,s=1/0;for(let n=0;n<e.length;n++){const i=t.getBlockById(e[n]).getRelativeToSurfaceXY();i.y<s&&(s=i.y),i.x<r&&(r=i.x),i.x>o&&(o=i.x)}for(i=i-s+10,n=t.RTL?n-o:n-r,r=0;r<e.length;r++)t.getBlockById(e[r]).moveBy(n,i,["create"])}return e},Ms.domToBlock$$module$build$src$core$xml=function(e,t){return e=Ht(e,t),t.rendered&&wt(),e},Ht=function(e,t){Ms.disable$$module$build$src$core$events$utils();var n=t.getAllVariables();let i;try{if(i=Jt(e,t),t.rendered){const e=i,n=i.getDescendants(!1);e.setConnectionTracking(!1);for(let e=n.length-1;0<=e;e--)n[e].initSvg();for(let e=n.length-1;0<=e;e--)n[e].queueRender();setTimeout((function(){e.disposed||e.setConnectionTracking(!0)}),1),t.resizeContents()}else{const e=i.getDescendants(!1);for(let t=e.length-1;0<=t;t--)e[t].initModel()}}finally{Ms.enable$$module$build$src$core$events$utils()}if(L()){for(e=vt(t,n),t=0;t<e.length;t++)n=e[t],I(new(j(ea))(n));I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(i))}return i},Gt=function(e,t){for(let i=0;i<e.children.length;i++){var n=e.children[i];const r=n.getAttribute("type"),o=n.getAttribute("id");if(!(n=n.textContent))break;t.createVariable(n,r,o)}},Vt=function(e){const t={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let n=0;n<e.children.length;n++){const i=e.children[n];if(i.nodeType!==il.TEXT_NODE)switch(i.nodeName.toLowerCase()){case"mutation":t.mutation.push(i);break;case"comment":t.comment.push(i);break;case"data":t.data.push(i);break;case"title":case"field":t.field.push(i);break;case"value":case"statement":t.input.push(i);break;case"next":t.next.push(i);break;default:console.warn("Ignoring unknown tag: "+i.nodeName)}}return t},Wt=function(e,t){let n=!1;for(let i=0;i<e.length;i++){const r=e[i];t.domToMutation&&(t.domToMutation(r),t.initSvg&&(n=!0))}return n},zt=function(e,t){for(let i=0;i<e.length;i++){var n=e[i];const r=n.textContent,o="true"===n.getAttribute("pinned");let s;const a=parseInt(null!=(s=n.getAttribute("w"))?s:"50",10);let l;n=parseInt(null!=(l=n.getAttribute("h"))?l:"50",10),t.setCommentText(r);const c=t.getIcon(Ul.COMMENT);isNaN(a)||isNaN(n)||c.setBubbleSize(new pl(a,n)),c.setBubbleVisible(o),setTimeout((()=>c.setBubbleVisible(o)),1)}},qt=function(e,t){for(let n=0;n<e.length;n++)t.data=e[n].textContent},Yt=function(e,t){for(let n=0;n<e.length;n++){const i=e[n],r=i.getAttribute("name");r?Qt(t,r,i):console.warn(`Ignoring unnamed field in block ${t.type}`)}},Kt=function(e){let t=null,n=null;for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];tn(r)&&("block"===r.nodeName.toLowerCase()?t=r:"shadow"===r.nodeName.toLowerCase()&&(n=r))}return{childBlockElement:t,childShadowElement:n}},Zt=function(e,t,n,i){for(let o=0;o<e.length;o++){var r=e[o];const s=r.getAttribute("name"),a=s?n.getInput(s):null;if(!a){console.warn("Ignoring non-existent input "+s+" in block "+i);break}if((r=Kt(r)).childBlockElement){if(!a.connection)throw TypeError("Input connection does not exist.");Jt(r.childBlockElement,t,a.connection,!1)}if(r.childShadowElement){let e;null==(e=a.connection)||e.setShadowDom(r.childShadowElement)}}},Xt=function(e,t,n){for(let i=0;i<e.length;i++){const r=Kt(e[i]);if(r.childBlockElement){if(!n.nextConnection)throw TypeError("Next statement does not exist.");if(n.nextConnection.isConnected())throw TypeError("Next statement is already connected.");Jt(r.childBlockElement,t,n.nextConnection,!0)}r.childShadowElement&&n.nextConnection&&n.nextConnection.setShadowDom(r.childShadowElement)}},Jt=function(e,t,n,i){var r;const o=e.getAttribute("type");if(!o)throw TypeError("Block type unspecified: "+e.outerHTML);var s=null!=(r=e.getAttribute("id"))?r:void 0;r=t.newBlock(o,s),s=Vt(e);const a=Wt(s.mutation,r);if(zt(s.comment,r),qt(s.data,r),n)if(i){if(!r.previousConnection)throw TypeError("Next block does not have previous statement.");n.connect(r.previousConnection)}else if(r.outputConnection)n.connect(r.outputConnection);else{if(!r.previousConnection)throw TypeError("Child block does not have output or previous statement.");n.connect(r.previousConnection)}if(Yt(s.field,r),Zt(s.input,t,r,o),Xt(s.next,t,r),a&&r.initSvg(),(t=e.getAttribute("inline"))&&r.setInputsInline("true"===t),(t=e.getAttribute("disabled"))&&r.setEnabled("true"!==t&&"disabled"!==t),(t=e.getAttribute("deletable"))&&r.setDeletable("true"===t),(t=e.getAttribute("movable"))&&r.setMovable("true"===t),(t=e.getAttribute("editable"))&&r.setEditable("true"===t),(t=e.getAttribute("collapsed"))&&r.setCollapsed("true"===t),"shadow"===e.nodeName.toLowerCase()){for(e=r.getChildren(!1),t=0;t<e.length;t++)if(!e[t].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");r.setShadow(!0)}return r},Qt=function(e,t,n){const i=e.getField(t);i?i.fromXml(n):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},en=function(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("next"===n.nodeName.toLowerCase()){e.removeChild(n);break}}},tn=function(e){return e.nodeType===il.ELEMENT_NODE},nn=function(e){return void 0!==e.saveState&&void 0!==e.loadState},rn=function(e,n){t($s.SERIALIZER,e,n)},on=function(e){i($s.SERIALIZER,e)},sn=function(e,{addCoordinates:t=!1,addInputBlocks:n=!0,addNextBlocks:i=!0,doFullSerialization:r=!0,saveIds:o=!0}={}){if(e.isInsertionMarker())return null;const s={type:e.type,id:o?e.id:void 0};return t&&ln(e,s),an(e,s),cn(e,s,r),un(e,s,r),dn(e,s,r),n&&hn(e,s,r,o),i&&pn(e,s,r,o),s},an=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.enabled=!1),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},ln=function(e,t){const n=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(n.RTL?n.getWidth()-e.x:e.x),t.y=Math.round(e.y)},cn=function(e,t,n){e.saveExtraState?null!==(e=e.saveExtraState(n))&&(t.extraState=e):e.mutationToDom&&null!==(e=e.mutationToDom())&&(t.extraState=jt(e).replace(' xmlns="https://developers.google.com/blockly/xml"',""))},un=function(e,t,n){const i=Object.create(null);for(const t of e.getIcons())nn(t)&&(e=t.saveState(n))&&(i[t.getType().toString()]=e);Object.keys(i).length&&(t.icons=i)},dn=function(e,t,n){const i=Object.create(null);for(let t=0;t<e.inputList.length;t++){const r=e.inputList[t];for(let e=0;e<r.fieldRow.length;e++){const t=r.fieldRow[e];t.isSerializable()&&(i[t.name]=t.saveState(n))}}Object.keys(i).length&&(t.fields=i)},hn=function(e,t,n,i){const r=Object.create(null);for(let t=0;t<e.inputList.length;t++){const o=e.inputList[t];if(!o.connection)continue;const s=fn(o.connection,n,i);s&&(r[o.name]=s)}Object.keys(r).length&&(t.inputs=r)},pn=function(e,t,n,i){e.nextConnection&&(e=fn(e.nextConnection,n,i))&&(t.next=e)},fn=function(e,t,n){const i=e.getShadowState(!0);if(e=e.targetBlock(),!i&&!e)return null;const r=Object.create(null);return i&&(r.shadow=i),e&&!e.isShadow()&&(r.block=sn(e,{doFullSerialization:t,saveIds:n})),r},gn=function(e,t,{recordUndo:n=!1}={}){return e=mn(e,t,{recordUndo:n}),t.rendered&&wt(),e},mn=function(e,t,{parentConnection:n,isShadow:i=!1,recordUndo:r=!1}={}){const o=A();let s;C(r),(r=Ms.getGroup$$module$build$src$core$events$utils())||Ms.setGroup$$module$build$src$core$events$utils(!0),Ms.disable$$module$build$src$core$events$utils();try{s=bn(e,t,{parentConnection:n,isShadow:i})}finally{Ms.enable$$module$build$src$core$events$utils()}if(L()&&I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(s)),Ms.setGroup$$module$build$src$core$events$utils(r),C(o),t.rendered){const e=s;setTimeout((()=>{e.disposed||e.setConnectionTracking(!0)}),1)}return s},bn=function(e,t,{parentConnection:n,isShadow:i=!1}={}){if(!e.type)throw new gc(e);const r=t.newBlock(e.type,e.id);return r.setShadow(i),yn(r,e),vn(r,e),_n(r,e),En(n,r,e),Tn(r,e),xn(r,e),wn(r,e),kn(r,e),Cn(r,t.rendered),r},yn=function(e,t){let n=void 0===t.x?0:t.x;t=void 0===t.y?0:t.y;const i=e.workspace;n=i.RTL?i.getWidth()-n:n,e.moveBy(n,t)},vn=function(e,t){t.collapsed&&e.setCollapsed(!0),!1===t.deletable&&e.setDeletable(!1),!1===t.movable&&e.setMovable(!1),!1===t.editable&&e.setEditable(!1),!1===t.enabled&&e.setEnabled(!1),void 0!==t.inline&&e.setInputsInline(t.inline),void 0!==t.data&&(e.data=t.data)},_n=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation(Ms.textToDom$$module$build$src$core$utils$xml(t.extraState)))},En=function(e,t,n){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new yc(n);if(e.type===Ms.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var i=t.outputConnection;if(!i)throw new mc("output",t,n)}else if(!(i=t.previousConnection))throw new mc("previous",t,n);if(!e.connect(i)){const r=t.workspace.connectionChecker;throw new bc(r.getErrorMessage(r.canConnectWithReason(i,e,!1),i,e),e.type===Ms.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,n)}}},Tn=function(e,t){if(t.icons){var n=Object.keys(t.icons);for(const r of n){n=t.icons[r];var i=e.getIcon(r);if(!i){if(!(i=s($s.ICON,r,!1)))throw new vc(r,e,t);i=new i(e),e.addIcon(i)}nn(i)&&i.loadState(n)}}},xn=function(e,t){if(t.fields){var n=Object.keys(t.fields);for(let i=0;i<n.length;i++){const r=n[i],o=t.fields[r],s=e.getField(r);s?s.loadState(o):console.warn(`Ignoring non-existant field ${r} in block ${e.type}`)}}},wn=function(e,t){if(t.inputs){var n=Object.keys(t.inputs);for(let i=0;i<n.length;i++){const r=n[i],o=e.getInput(r);if(!o||!o.connection)throw new mc(r,e,t);Sn(o.connection,t.inputs[r])}}},kn=function(e,t){if(t.next){if(!e.nextConnection)throw new mc("next",e,t);Sn(e.nextConnection,t.next)}},Sn=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&bn(t.block,e.getSourceBlock().workspace,{parentConnection:e})},Cn=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const t of e.getIcons())t.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},An=function(e){const t=e.workspace,n=Ms.config$$module$build$src$core$config.snapRadius,i=e.getRelativeToSurfaceXY(),r=new el(0,0),o=t.getAllBlocks(!1).filter((t=>t.id!=e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;In(el.sum(i,r),o)||On(e,r,n);)t.RTL?r.translate(-n,2*n):r.translate(n,2*n);e.moveTo(el.sum(i,r))},In=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},On=function(e,t,n){return e.getConnections_(!1).some((e=>!!e.closest(n,t).connection))},Nn=function(e){return ne("Blockly.clipboard.copy","v11","v12","myCopyable.toCopyData()"),Mc.copyInternal(e)},Rn=function(e){const t=e.toCopyData();let n;return Dc=t,Lc=null!=(n=e.workspace)?n:null,t},Dn=function(e,t,n){return e&&t?Ln(e,t,n):Dc&&Lc?Ln(Dc,Lc):null},Ln=function(e,t,n){let i,r,o;return t=null!=(i=t.getRootWorkspace())?i:t,null!=(o=null==(r=a($s.PASTER,e.paster,!1))?void 0:r.paste(e,t,n))?o:null},Mn=function(e){return ne("Blockly.clipboard.duplicate","v11","v12","Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)"),Mc.duplicateInternal(e)},Pn=function(e){const t=e.toCopyData();return t?Dn(t,e.workspace):null},Bn=function(e,t){e.setAttribute($c,t)},jn=function(e,t,n){Array.isArray(n)&&(n=n.join(" ")),e.setAttribute(Fc+t,`${n}`)},Fn=function(){return Hc},$n=function(e){if(Hc=e,null===e){let e;null==(e=document.querySelector("."+qc))||e.remove()}},Un=function(){document.querySelector("."+qc)||((Hc=document.createElement("div")).className=qc,(y()||document.body).appendChild(Hc))},Hn=function(e,t,n){Gn(),Wc=e,zc=n,(e=Hc)&&(e.style.direction=t?"rtl":"ltr",e.style.display="block",t=f(),Yc=t.getRenderer().getClassName(),Kc=t.getTheme().getClassName(),Yc&&re(e,Yc),Kc&&re(e,Kc))},Gn=function(){if(Vn()){Wc=null;var e=Hc;e&&(e.style.display="none",e.style.left="",e.style.top="",zc&&zc(),zc=null,e.textContent="",Yc&&(se(e,Yc),Yc=""),Kc&&(se(e,Kc),Kc=""),f().markFocused())}},Vn=function(){return!!Wc},Wn=function(e){Wc===e&&Gn()},zn=function(e,t,n){Hc.style.left=e+"px",Hc.style.top=t+"px",Hc.style.height=n+"px"},qn=function(e,t,n,i){const r=Kn(e,t,n);e=Yn(e,t,n,i),0>r?zn(e,0,n.height+r):zn(e,r,n.height)},Yn=function(e,t,n,i){return i?Math.min(Math.max(t.right-n.width,e.left),e.right-n.width):Math.max(Math.min(t.left,e.right-n.width),e.left)},Kn=function(e,t,n){return t.bottom+n.height>=e.bottom?t.top-n.height:t.bottom},Zn=function(e){return!(null==e||!e.repositionForWindowResize)},Xn=function(){Zn(Wc)&&Wc.repositionForWindowResize()||Gn()},Jn=function(){return Xc},Qn=function(e){Xc=e},ei=function(e,t,n){if(Hn(Jc,n,si),t.length){var i=ti(t,n);Qc=i,ni(i,e,n),setTimeout((function(){i.focus()}),1),Xc=null}else oi()},ti=function(e,t){const n=new Gc;n.setRole(Bc.MENU);for(let i=0;i<e.length;i++){const r=e[i],o=new Vc(r.text);o.setRightToLeft(t),o.setRole(Bc.MENUITEM),n.addChild(o),o.setEnabled(r.enabled),r.enabled&&o.onAction((function(){oi(),requestAnimationFrame((()=>{setTimeout((()=>{r.callback(r.scope)}),0)}))}),{})}return n},ni=function(e,t,n){const i=Ie();t=new hl(t.clientY+i.top,t.clientY+i.top,t.clientX+i.left,t.clientX+i.left),ii(e);const r=e.getSize();n&&(t.left+=r.width,t.right+=r.width,i.left+=r.width,i.right+=r.width),qn(i,t,r,n),e.focus()},ii=function(e){var t=Fn();if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),re(t,"blocklyContextMenu"),z(t,"contextmenu",null,ri),e.focus()},ri=function(e){e.preventDefault(),e.stopPropagation()},oi=function(){Wn(Jc),Xc=null},si=function(){Qc&&(Qc.dispose(),Qc=null)},Ms.callbackFactory$$module$build$src$core$contextmenu=function(e,t){return()=>{let n;Ms.disable$$module$build$src$core$events$utils();try{n=t instanceof Element?Ht(t,e.workspace):mn(t,e.workspace);const i=e.getRelativeToSurfaceXY();i.x=e.RTL?i.x-Ms.config$$module$build$src$core$config.snapRadius:i.x+Ms.config$$module$build$src$core$config.snapRadius,i.y+=2*Ms.config$$module$build$src$core$config.snapRadius,n.moveBy(i.x,i.y)}finally{Ms.enable$$module$build$src$core$events$utils()}return L()&&!n.isShadow()&&I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(n)),n.select(),n}},ai=function(e){return{text:Ms.Msg$$module$build$src$core$msg.REMOVE_COMMENT,enabled:!0,callback:function(){Ms.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),Ms.setGroup$$module$build$src$core$events$utils(!1)}}},li=function(e){return{text:Ms.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,enabled:!0,callback:function(){const t=e.toCopyData();t&&Dn(t,e.workspace)}}},ci=function(e,t){const n={enabled:!0};return n.text=Ms.Msg$$module$build$src$core$msg.ADD_COMMENT,n.callback=function(){const n=new sc(e,Ms.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT,sc.DEFAULT_SIZE,sc.DEFAULT_SIZE);var i=e.getInjectionDiv().getBoundingClientRect();i=new el(t.clientX-i.left,t.clientY-i.top);const r=e.getOriginOffsetInPixels();(i=el.difference(i,r)).scale(1/e.scale),n.moveBy(i.x,i.y),e.rendered&&(n.initSvg(),n.render(),n.select())},n},ui=function(e){return e*Math.PI/180},di=function(e){return 180*e/Math.PI},hi=function(e,t,n){if(n<e){const t=n;n=e,e=t}return Math.max(e,Math.min(t,n))},pi=function(){document.querySelector(".blocklyDropDownDiv")||((ou=document.createElement("div")).className="blocklyDropDownDiv",(y()||document.body).appendChild(ou),(su=document.createElement("div")).className="blocklyDropDownContent",ou.appendChild(su),(au=document.createElement("div")).className="blocklyDropDownArrow",ou.appendChild(au),ou.style.opacity="0",ou.style.transition="transform "+hu+"s, opacity "+hu+"s",ou.addEventListener("focusin",(function(){re(ou,"blocklyFocused")})),ou.addEventListener("focusout",(function(){se(ou,"blocklyFocused")})))},fi=function(e){bu=e},gi=function(){return yu},mi=function(){return su},bi=function(){su.textContent="",su.style.width=""},yi=function(e,t){ou.style.backgroundColor=e,ou.style.borderColor=t},vi=function(e,t,n,i){return xi(Ei(t),e,n,i)},_i=function(e,t,n){return vu=!0,xi(Ti(e),e,t,n)},Ei=function(e){var t=e.getSvgRoot();const n=e.workspace.scale,i=e.height*n;return e=e.width*n,t=Te(t),new hl(t.y,t.y+i,t.x,t.x+e)},Ti=function(e){return e=e.getScaledBBox(),new hl(e.top,e.bottom,e.left,e.right)},xi=function(e,t,n,i){const r=e.left+(e.right-e.left)/2,o=e.bottom;e=e.top,i&&(e+=i);let s=(i=t.getSourceBlock()).workspace;for(;s.options.parentWorkspace;)s=s.options.parentWorkspace;return fi(s.getParentSvg().parentNode),wi(t,i.RTL,r,o,r,e,n)},wi=function(e,t,n,i,r,o,s){return yu=e,fu=s||null,ou.style.direction=t?"rtl":"ltr",e=f(),gu=e.getRenderer().getClassName(),mu=e.getTheme().getClassName(),gu&&re(ou,gu),mu&&re(ou,mu),Di(n,i,r,o)},ki=function(e,t,n,i){return{initialX:(e=Ai(e,n.left,n.right,i.width)).divX,initialY:t,finalX:e.divX,finalY:t+du,arrowX:e.arrowX,arrowY:-(lu/2+cu),arrowAtTop:!0,arrowVisible:!0}},Si=function(e,t,n,i){return{initialX:(e=Ai(e,n.left,n.right,i.width)).divX,initialY:t-i.height,finalX:e.divX,finalY:t-i.height-du,arrowX:e.arrowX,arrowY:i.height-2*cu-lu/2,arrowAtTop:!1,arrowVisible:!0}},Ci=function(e,t,n){return{initialX:(e=Ai(e,t.left,t.right,n.width)).divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Ai=function(e,t,n,i){return t=hi(t,e-i/2,n-i),{arrowX:e=hi(n=uu,e=e-lu/2-t,i-n-lu),divX:t}},Ii=function(){return!!yu},Oi=function(e,t){return yu===e&&(t?Ri():Ni(),!0)},Ni=function(){ou.style.transform="translate(0, 0)",ou.style.opacity="0",pu=setTimeout((function(){Ri()}),1e3*hu),fu&&(fu(),fu=null)},Ri=function(){Ii()&&(pu&&clearTimeout(pu),ou.style.transform="",ou.style.left="",ou.style.top="",ou.style.opacity="0",ou.style.display="none",ou.style.backgroundColor="",ou.style.borderColor="",fu&&(fu(),fu=null),bi(),yu=null,gu&&(se(ou,gu),gu=""),mu&&(se(ou,mu),mu=""),f().markFocused())},Di=function(e,t,n,i){(e=_u.getPositionMetrics(e,t,n,i)).arrowVisible?(au.style.display="",au.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",au.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):au.style.display="none",t=Math.floor(e.initialX),n=Math.floor(e.initialY),i=Math.floor(e.finalX);const r=Math.floor(e.finalY);return ou.style.left=t+"px",ou.style.top=n+"px",ou.style.display="block",ou.style.opacity="1",ou.style.transform="translate("+(i-t)+"px,"+(r-n)+"px)",!!e.arrowAtTop},Li=function(){if(yu){var e=yu.getSourceBlock();const t=(e=vu?Ti(yu):Ei(e)).left+(e.right-e.left)/2;Di(t,e.bottom,t,e.top)}else Ni()},Mi=function(e){if(!(100<e.getDescendants(!1).length)){var t=e.workspace,n=e.getSvgRoot();t.getAudioManager().play("delete");var i=t.getSvgXY(n);(n=n.cloneNode(!0)).setAttribute("transform","translate("+i.x+","+i.y+")"),t.getParentSvg().appendChild(n),Pi(n,{x:i.x,y:i.y,width:e.width,height:e.height},t.RTL,new Date,t.scale)}},Pi=function(e,t,n,i,r){const o=((new Date).getTime()-i.getTime())/150;1<o?le(e):(e.setAttribute("transform","translate("+(t.x+(n?-1:1)*t.width*r/2*o)+","+(t.y+t.height*r*o)+") scale("+(1-o)*r+")"),setTimeout(Pi,10,e,t,n,i,r))},Bi=function(e){var t=e.workspace;const n=t.scale;if(t.getAudioManager().play("click"),!(1>n)){var i=t.getSvgXY(e.getSvgRoot());e.outputConnection?(i.x+=(e.RTL?3:-3)*n,i.y+=13*n):e.previousConnection&&(i.x+=(e.RTL?-23:23)*n,i.y+=3*n);var r=ie(dl.CIRCLE,{cx:i.x,cy:i.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());e=ie(dl.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*n},r),t=ie(dl.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},r),e.beginElement(),t.beginElement(),setTimeout((()=>{le(r)}),150)}},ji=function(e){if($i(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),xu=e,Fi(e,t,new Date)}},Fi=function(e,t,n){const i=((new Date).getTime()-n.getTime())/200;let r="";1>=i&&(r=`skewX(${Math.round(Math.sin(i*Math.PI*3)*(1-i)*t)})`,Tu=setTimeout(Fi,10,e,t,n)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${r}`)},$i=function(){xu&&(Tu&&(clearTimeout(Tu),Tu=null),xu.getSvgRoot().setAttribute("transform",xu.getTranslation()),xu=null)},Ui=function(e,t){return ne("Blockly.utils.string.startsWith()","April 2022","April 2023","Use built-in string.startsWith"),e.startsWith(t)},Hi=function(e){return e.length?e.reduce((function(e,t){return e.length<t.length?e:t})).length:0},Gi=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let n,i=0;for(t=t||Hi(e),n=0;n<t;n++){for(var r=e[0][n],o=1;o<e.length;o++)if(r!==e[o][n])return i;" "===r&&(i=n+1)}for(r=1;r<e.length;r++)if((o=e[r][n])&&" "!==o)return i;return t},Vi=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let n,i=0;for(t=t||Hi(e),n=0;n<t;n++){for(var r=e[0].substr(-n-1,1),o=1;o<e.length;o++)if(r!==e[o].substr(-n-1,1))return i;" "===r&&(i=n+1)}for(r=1;r<e.length;r++)if((o=e[r].charAt(e[r].length-n-1))&&" "!==o)return i;return t},Ms.wrap$$module$build$src$core$utils$string=function(e,t){e=e.split("\n");for(let n=0;n<e.length;n++)e[n]=Wi(e[n],t);return e.join("\n")},Wi=function(e,t){if(e.length<=t)return e;const n=e.trim().split(/\s+/);for(var i=0;i<n.length;i++)n[i].length>t&&(t=n[i].length);var r=-1/0;let o,s=1;do{i=r,o=e,e=[],r=n.length/s;let a=1;for(let t=0;t<n.length-1;t++)a<(t+1.5)/r?(a++,e[t]=!0):e[t]=!1;e=qi(n,e,t),r=zi(n,e,t),e=Yi(n,e),s++}while(r>i);return o},zi=function(e,t,n){const i=[0],r=[];for(var o=0;o<e.length;o++)i[i.length-1]+=e[o].length,!0===t[o]?(i.push(0),r.push(e[o].charAt(e[o].length-1))):!1===t[o]&&i[i.length-1]++;for(e=Math.max(...i),t=0,o=0;o<i.length;o++)t-=2*Math.pow(Math.abs(n-i[o]),1.5),t-=Math.pow(e-i[o],1.5),-1!==".?!".indexOf(r[o])?t+=n/3:-1!==",;)]}".indexOf(r[o])&&(t+=n/4);return 1<i.length&&i[i.length-1]<=i[i.length-2]&&(t+=.5),t},qi=function(e,t,n){let i,r=zi(e,t,n);for(let o=0;o<t.length-1;o++){if(t[o]===t[o+1])continue;const s=[].concat(t);s[o]=!s[o],s[o+1]=!s[o+1];const a=zi(e,s,n);a>r&&(r=a,i=s)}return i?qi(e,i,n):t},Yi=function(e,t){const n=[];for(let i=0;i<e.length;i++)n.push(e[i]),void 0!==t[i]&&n.push(t[i]?"\n":" ");return n.join("")},Ms.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},Ki=function(e){Au=e},Zi=function(){return Au},Xi=function(){return Iu},Ji=function(){return Gu},Qi=function(e){if(e=er(e)){for(e=e.tooltip;"function"==typeof e;)e=e();if("string"!=typeof e)throw Error("Tooltip function must return a string.");return e}return""},er=function(e){for(;e&&e.tooltip;){if("string"==typeof e.tooltip||"function"==typeof e.tooltip)return e;e=e.tooltip}return null},tr=function(){document.querySelector(".blocklyTooltipDiv")||((Gu=document.createElement("div")).className="blocklyTooltipDiv",(y()||document.body).appendChild(Gu))},nr=function(e){e.mouseOverWrapper_=q(e,"pointerover",null,rr),e.mouseOutWrapper_=q(e,"pointerout",null,or),e.addEventListener("pointermove",sr,!1)},ir=function(e){e&&(Y(e.mouseOverWrapper_),Y(e.mouseOutWrapper_),e.removeEventListener("pointermove",sr))},rr=function(e){Ou||(e=er(e.currentTarget),Pu!==e&&(lr(),Bu=null,Pu=e),clearTimeout(Ru))},or=function(e){Ou||(Ru=setTimeout((function(){Bu=Pu=null,lr()}),1),clearTimeout(Du),Du=0)},sr=function(e){if(Pu&&Pu.tooltip&&!Ou)if(Iu){const t=Lu-e.pageX;e=Mu-e.pageY,Math.sqrt(t*t+e*e)>$u&&lr()}else Bu!==Pu&&(clearTimeout(Du),Lu=e.pageX,Mu=e.pageY,Du=setTimeout(fr,Uu))},ar=function(){Bu=Pu=null,lr()},lr=function(){Iu&&(Iu=!1,Gu&&(Gu.style.display="none")),Du&&(clearTimeout(Du),Du=0)},cr=function(){lr(),Ou=!0},ur=function(){Ou=!1},dr=function(){Gu&&Pu&&("function"==typeof Au?Au(Gu,Pu):hr())},hr=function(){var e=Qi(Pu);e=(e=Ms.wrap$$module$build$src$core$utils$string(e,Nu)).split("\n");for(let t=0;t<e.length;t++){const n=document.createElement("div");n.appendChild(document.createTextNode(e[t])),Gu.appendChild(n)}},pr=function(e){const t=document.documentElement.clientWidth,n=document.documentElement.clientHeight;let i=Lu;i=e?i-(ju+Gu.offsetWidth):i+ju;let r=Mu+Fu;return r+Gu.offsetHeight>n+window.scrollY&&(r-=Gu.offsetHeight+2*Fu),e?i=Math.max(Hu-window.scrollX,i):i+Gu.offsetWidth>t+window.scrollX-2*Hu&&(i=t-Gu.offsetWidth-2*Hu),{x:i,y:r}},fr=function(){if(!Ou&&(Bu=Pu,Gu)){Gu.textContent="",dr();var e=Pu.RTL;Gu.style.direction=e?"rtl":"ltr",Gu.style.display="block",Iu=!0;var{x:t,y:n}=pr(e);Gu.style.left=t+"px",Gu.style.top=n+"px"}},gr=function(e,t){for(const n in t)e[n]=null!==t[n]&&"object"==typeof t[n]?gr(e[n]||Object.create(null),t[n]):t[n];return e},mr=function(e){return void 0!==e.bubbleIsVisible&&void 0!==e.setBubbleVisible},br=function(){return ed},yr=function(e){ed=e},vr=function(){return td},_r=function(e){td=e},Er=function(e){e=`${e}`.toLowerCase().trim();var t=nd[e];if(t)return t;if(t="#"===(t="0x"===e.substring(0,2)?"#"+e.substring(2):e)[0]?t:"#"+t,/^#[0-9a-f]{6}$/.test(t))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var n=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return n&&(e=Number(n[1]),t=Number(n[2]),n=Number(n[3]),0<=e&&256>e&&0<=t&&256>t&&0<=n&&256>n)?Tr(e,t,n):null},Tr=function(e,t,n){return t=e<<16|t<<8|n,16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},xr=function(e){return(e=Er(e))?[(e=parseInt(e.substr(1),16))>>16,e>>8&255,255&e]:[0,0,0]},wr=function(e,t,n){let i=0,r=0,o=0;if(0===t)o=r=i=n;else{const s=Math.floor(e/60),a=e/60-s;e=n*(1-t);const l=n*(1-t*a);switch(t=n*(1-t*(1-a)),s){case 1:i=l,r=n,o=e;break;case 2:i=e,r=n,o=t;break;case 3:i=e,r=l,o=n;break;case 4:i=t,r=e,o=n;break;case 5:i=n,r=e,o=l;break;case 6:case 0:i=n,r=t,o=e}}return Tr(Math.floor(i),Math.floor(r),Math.floor(o))},kr=function(e,t,n){return(e=Er(e))&&(t=Er(t))?(e=xr(e),t=xr(t),Tr(Math.round(t[0]+n*(e[0]-t[0])),Math.round(t[1]+n*(e[1]-t[1])),Math.round(t[2]+n*(e[2]-t[2])))):null},Sr=function(e){return wr(e,ed,255*td)},Cr=function(e,t,n){const i=[];var r=e.split("");r.push("");var o=0;e=[];let s=null;for(let c=0;c<r.length;c++){var a=r[c];if(0===o)if("%"===a)(o=e.join(""))&&i.push(o),e.length=0,o=1;else if(n&&"\n"===a){const t=e.join("");t&&i.push(t),e.length=0,i.push(a)}else e.push(a);else if(1===o)"%"===a?(e.push(a),o=0):t&&"0"<=a&&"9">=a?(o=2,s=a,(a=e.join(""))&&i.push(a),e.length=0):"{"===a?o=3:(e.push("%",a),o=0);else if(2===o)if("0"<=a&&"9">=a)s+=a;else{var l=void 0;i.push(parseInt(null!=(l=s)?l:"",10)),c--,o=0}else 3===o&&(""===a?(e.splice(0,0,"%{"),c--,o=0):"}"!==a?e.push(a):(o=e.join(""),/[A-Z]\w*/i.test(o)&&(a=(a=o.toUpperCase()).startsWith("BKY_")?a.substring(4):null)&&a in Ms.Msg$$module$build$src$core$msg?"string"==typeof(o=Ms.Msg$$module$build$src$core$msg[a])?Array.prototype.push.apply(i,Cr(o,t,n)):t?i.push(`${o}`):i.push(o):i.push("%{"+o+"}"),o=e.length=0))}for((t=e.join(""))&&i.push(t),l=[],e.length=0,r=0;r<i.length;r++)"string"!=typeof i[r]||n&&"\n"===i[r]?((t=e.join(""))&&l.push(t),e.length=0,l.push(i[r])):e.push(i[r]);return(t=e.join(""))&&l.push(t),e.length=0,l},Ar=function(e){return Cr(e,!0,!0)},Ir=function(e){return"string"!=typeof e?e:(e=Cr(e,!1,!1)).length?String(e[0]):""},Or=function(e){let t=!0;const n=Ms.Msg$$module$build$src$core$msg,i=e.match(/%{BKY_[A-Z]\w*}/gi);if(i)for(let r=0;r<i.length;r++)void 0===n[i[r].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+i[r]+" in "+e),t=!1);return t},Nr=function(e){const t="string"==typeof e?Ir(e):e;var n=Number(t);if(!isNaN(n)&&0<=n&&360>=n)return{hue:n,hex:wr(n,br(),255*vr())};if(n=Er(t))return{hue:null,hex:n};throw n='Invalid colour: "'+t+'"',e!==t&&(n+=' (from "'+e+'")'),Error(n)},Rr=function(e){return void 0!==e.getProcedureModel&&void 0!==e.doProcedureUpdate&&void 0!==e.isProcedureDef},Dr=function(e){return void 0!==e.startPublishing&&void 0!==e.stopPublishing},Lr=function(e,n){t($s.FIELD,e,n)},Mr=function(e){i($s.FIELD,e)},Ms.fromJson$$module$build$src$core$field_registry=function(e){return ud.fromJsonInternal(e)},Pr=function(e){const t=a($s.FIELD,e.type);if(t){if("function"!=typeof t.fromJson)throw new TypeError("returned Field was not a IRegistrableField");return t.fromJson(e)}return console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null},Br=function(e){let t=!1;const n=e.map((([e,n])=>"string"==typeof e?[Ir(e),n]:(t=!0,[null!==e.alt?Object.assign({},e,{alt:Ir(e.alt)}):Object.assign({},e),n])));if(t||2>e.length)return{options:n};var i=n.map((([e])=>e)),r=Hi(i);e=Gi(i,r);const o=Vi(i,r);return!e&&!o||r<=e+o?{options:n}:(r=e?i[0].substring(0,e-1):void 0,i=o?i[0].substr(1-o):void 0,{options:jr(n,e,o),prefix:r,suffix:i})},jr=function(e,t,n){return e.map((([e,i])=>[e.substring(t,e.length-n),i]))},Fr=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)?"string"!=typeof i[1]?(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option id must be a string. Found "+i[1]+" in: ",i)):i[0]&&"string"!=typeof i[0]&&"string"!=typeof i[0].src&&(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must have a string label or image description. Found"+i[0]+" in: ",i)):(t=!0,console.error("Invalid option["+n+"]: Each FieldDropdown option must be an array. Found: ",i))}if(t)throw TypeError("Found invalid FieldDropdown options.")},Ms.register$$module$build$src$core$extensions=function(e,t){if("string"!=typeof e||""===e.trim())throw Error('Error: Invalid extension name "'+e+'"');if(bd[e])throw Error('Error: Extension "'+e+'" is already registered.');if("function"!=typeof t)throw Error('Error: Extension "'+e+'" must be a function');bd[e]=t},Ms.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||"object"!=typeof t)throw Error('Error: Mixin "'+e+'" must be a object');Ms.register$$module$build$src$core$extensions(e,(function(){this.mixin(t)}))},Ms.registerMutator$$module$build$src$core$extensions=function(e,t,n,i){const r='Error when registering mutator "'+e+'": ';Yr(r,t);const o=zr(t,r);if(n&&"function"!=typeof n)throw Error(r+'Extension "'+e+'" is not a function');Ms.register$$module$build$src$core$extensions(e,(function(){o&&this.setMutator(new Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon(i||[],this)),this.mixin(t),n&&n.apply(this)}))},$r=function(e){Ur(e)?delete bd[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},Ur=function(e){return!!bd[e]},Hr=function(e,t,n){const i=bd[e];if("function"!=typeof i)throw Error('Error: Extension "'+e+'" not found.');let r;if(n?Gr(e,t):r=Kr(t),i.apply(t),n)Yr('Error after applying mutator "'+e+'": ',t);else if(!Zr(r,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},Gr=function(e,t){if(Kr(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},Vr=function(e,t){return qr(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},Wr=function(e,t){return qr(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},zr=function(e,t){return qr(e.compose,e.decompose,t+" compose/decompose")},qr=function(e,t,n){if(e&&t){if("function"!=typeof e||"function"!=typeof t)throw Error(n+" must be a function");return!0}if(!e&&!t)return!1;throw Error(n+"Must have both or neither functions")},Yr=function(e,t){const n=Vr(t,e),i=Wr(t,e);if(!n&&!i)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");zr(t,e)},Kr=function(e){const t=[];return void 0!==e.domToMutation&&t.push(e.domToMutation),void 0!==e.mutationToDom&&t.push(e.mutationToDom),void 0!==e.saveExtraState&&t.push(e.saveExtraState),void 0!==e.loadExtraState&&t.push(e.loadExtraState),void 0!==e.compose&&t.push(e.compose),void 0!==e.decompose&&t.push(e.decompose),t},Zr=function(e,t){if((t=Kr(t)).length!==e.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0},Xr=function(e){if("object"!=typeof document)throw Error("runAfterPageLoad() requires browser document.");if("complete"===document.readyState)e();else{const t=setInterval((function(){"complete"===document.readyState&&(clearInterval(t),e())}),10)}},Ms.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,t){const n=[];return function(){-1===n.indexOf(this.type)&&(Jr(this,e,t),n.push(this.type)),this.setTooltip(function(){const n=String(this.getFieldValue(e));return Ir(t[n])}.bind(this))}},Jr=function(e,t,n){var i=e.getField(t);if(i instanceof hd&&!i.isOptionListDynamic()){i=i.getOptions();for(const[,r]of i)void 0===n[r]&&console.warn(`No tooltip mapping for value ${r} of field ${t} of block type ${e.type}.`)}},Ms.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,t){return function(){this.setTooltip(function(){const n=this.getField(t);return Ir(e).replace("%1",n?n.getText():"")}.bind(this))}},Qr=function(){const e=this.tooltip;this.setTooltip(function(){const t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||e}.bind(this))},eo=function(e,t){return" "+e+","+t+" "},to=function(e,t){return" "+e+t.join("")},no=function(e,t){return" M "+e+","+t+" "},io=function(e,t){return" m "+e+","+t+" "},ro=function(e,t){return" l "+e+","+t+" "},oo=function(e){return" l"+e.join("")},so=function(e,t){return" "+e+" "+t+" "},ao=function(e,t,n,i){return e+" "+n+" "+n+" "+t+i},lo=function(e,n){t($s.ICON,e.toString(),n)},co=function(e){i($s.ICON,e)},uo=function(e){const t=e.getProcedureMap().getProcedures().filter((e=>!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!1]));e.getBlocksByType("procedures_defnoreturn",!1).forEach((e=>{!Rr(e)&&it(e)&&t.push(e.getProcedureDef())}));const n=e.getProcedureMap().getProcedures().filter((e=>!!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!0]));return e.getBlocksByType("procedures_defreturn",!1).forEach((e=>{!Rr(e)&&it(e)&&n.push(e.getProcedureDef())})),t.sort(ho),n.sort(ho),[t,n]},ho=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},Ms.findLegalName$$module$build$src$core$procedures=function(e,t){if(t.isInFlyout)return e;for(e=e||Ms.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!po(e,t.workspace,t);){const t=e.match(/^(.*?)(\d+)$/);e=t?t[1]+(parseInt(t[2])+1):e+"2"}return e},po=function(e,t,n){return!fo(e,t,n)},fo=function(e,t,n){for(const i of t.getAllBlocks(!1))if(i!==n&&it(i)&&Ms.Names$$module$build$src$core$names.equals(i.getProcedureDef()[0],e))return!0;n=n&&Rr(n)?null==n?void 0:n.getProcedureModel():void 0;for(const i of t.getProcedureMap().getProcedures())if(i!==n&&Ms.Names$$module$build$src$core$names.equals(i.getName(),e))return!0;return!1},Ms.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new sd;e=e.trim();const n=Ms.findLegalName$$module$build$src$core$procedures(e,t);Rr(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(n);const i=this.getValue();if(i!==e&&i!==n)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){const r=e[t];r.renameProcedure&&r.renameProcedure(i,n)}return n},go=function(e){function t(e,t){for(let r=0;r<e.length;r++){var i=e[r][0];const o=e[r][1],s=Ms.createElement$$module$build$src$core$utils$xml("block");s.setAttribute("type",t),s.setAttribute("gap","16");const a=Ms.createElement$$module$build$src$core$utils$xml("mutation");for(a.setAttribute("name",i),s.appendChild(a),i=0;i<o.length;i++){const e=Ms.createElement$$module$build$src$core$utils$xml("arg");e.setAttribute("name",o[i]),a.appendChild(e)}n.push(s)}}const n=[];if(Vs.procedures_defnoreturn){var i=Ms.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_defnoreturn"),i.setAttribute("gap","16");var r=Ms.createElement$$module$build$src$core$utils$xml("field");r.setAttribute("name","NAME"),r.appendChild(Ms.createTextNode$$module$build$src$core$utils$xml(Ms.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),i.appendChild(r),n.push(i)}return Vs.procedures_defreturn&&((i=Ms.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defreturn"),i.setAttribute("gap","16"),(r=Ms.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),r.appendChild(Ms.createTextNode$$module$build$src$core$utils$xml(Ms.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),i.appendChild(r),n.push(i)),Vs.procedures_ifreturn&&((i=Ms.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_ifreturn"),i.setAttribute("gap","16"),n.push(i)),n.length&&n[n.length-1].setAttribute("gap","24"),t((e=uo(e))[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),n},mo=function(e){var t=[],n=e.getBlocksByType("procedures_mutatorarg",!1);for(let e,i=0;e=n[i];i++)t.push(e.getFieldValue("NAME"));n=Ms.createElement$$module$build$src$core$utils$xml("xml");const i=Ms.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_mutatorarg");const r=Ms.createElement$$module$build$src$core$utils$xml("field");r.setAttribute("name","NAME"),t=ct(Ms.DEFAULT_ARG$$module$build$src$core$procedures,t),t=Ms.createTextNode$$module$build$src$core$utils$xml(t),r.appendChild(t),i.appendChild(r),n.appendChild(i),e.updateToolbox(n)},bo=function(e){if(e.type===ia&&"mutator"===e.bubbleType&&e.isOpen&&e.blockId){var t=(e=u(e.workspaceId).getBlockById(e.blockId)).type;"procedures_defnoreturn"!==t&&"procedures_defreturn"!==t||(e=e.getIcon(Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),mo(e),e.addChangeListener(yo))}},yo=function(e){e.type!==Ms.CREATE$$module$build$src$core$events$utils&&e.type!==Ms.DELETE$$module$build$src$core$events$utils&&e.type!==Ms.CHANGE$$module$build$src$core$events$utils&&e.type!==Qs||(e=u(e.workspaceId),mo(e))},vo=function(e,t){return t.getAllBlocks(!1).filter((t=>_o(t,e)||rt(t)&&Ms.Names$$module$build$src$core$names.equals(t.getProcedureCall(),e)))},_o=function(e,t){return Rr(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&Ms.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},Ms.mutateCallers$$module$build$src$core$procedures=function(e){const t=A();var n=e.getProcedureDef()[0];const i=e.mutationToDom(!0);e=vo(n,e.workspace);for(let o,s=0;o=e[s];s++){n=(n=o.mutationToDom())&&Le(n),o.domToMutation&&o.domToMutation(i);var r=o.mutationToDom();n!==(r=r&&Le(r))&&(C(!1),I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(o,"mutation",null,n,r)),C(t))}},Ms.getDefinition$$module$build$src$core$procedures=function(e,t){for(const n of t.getAllBlocks(!1))if(Rr(n)&&n.isProcedureDef()&&Ms.Names$$module$build$src$core$names.equals(n.getProcedureModel().getName(),e)||it(n)&&Ms.Names$$module$build$src$core$names.equals(n.getProcedureDef()[0],e))return n;return null},Eo=function(e){return e.isDynamic},To=function(e){return void 0!==e.pathDown&&void 0!==e.pathUp},xo=function(e){return void 0!==e.pathLeft&&void 0!==e.pathRight},wo=function(e){let t=e.outputConnection;return(!t||e.previousConnection&&e.previousConnection.isConnected())&&(t=e.previousConnection),t},ko=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t,t.targetConnection=e},So=function(e,t){let n=null;const i=null==(t=t.outputConnection)?void 0:t.getConnectionChecker();for(let r,o=0;r=e.inputList[o];o++){const e=r.connection;let o;if(e&&null!=(o=i)&&o.canConnect(t,e,!1)){if(n)return null;n=e}}return n},Co=function(e,t){let n;for(;n=So(e,t);)if(!(e=n.targetBlock())||e.isShadow())return n;return null},Ao=function(e,n){t($s.RENDERER,e,n)},Io=function(e){i($s.RENDERER,e)},Oo=function(e,t,n){return(e=new(s($s.RENDERER,e))(e)).init(t,n),e},No=function(e){ut(e.getTargetWorkspace(),void 0,"String")},Ro=function(e){ut(e.getTargetWorkspace(),void 0,"Number")},Do=function(e){ut(e.getTargetWorkspace(),void 0,"Colour")},Lo=function(e){let t=[],n=document.createElement("button");return n.setAttribute("text",Ms.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(n),(n=document.createElement("button")).setAttribute("text",Ms.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(n),(n=document.createElement("button")).setAttribute("text",Ms.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(n),e.registerButtonCallback("CREATE_VARIABLE_STRING",No),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",Ro),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Do),e=Mo(e),t.concat(e)},Mo=function(e){const t=[];if(0<(e=e.getAllVariables()).length){if(Vs.variables_set_dynamic){var n=e[e.length-1];const i=Ms.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","variables_set_dynamic"),i.setAttribute("gap","24"),i.appendChild(bt(n)),t.push(i)}if(Vs.variables_get_dynamic){e.sort(Jl.compareByName);for(let i,r=0;i=e[r];r++)(n=Ms.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get_dynamic"),n.setAttribute("gap","8"),n.appendChild(bt(i)),t.push(n)}}return t},Po=function(e){e.resizeContents()},Bo=function(e){return void 0!==e.toCopyData},jo=function(){rp.registry.register({name:$h.ESCAPE,preconditionFn:e=>!e.options.readOnly,callback:e=>(e.hideChaff(),!0),keyCodes:[vd.ESC]})},Fo=function(){rp.registry.register({name:$h.DELETE,preconditionFn(e){const t=m();return!e.options.readOnly&&null!=t&&t.isDeletable()},callback:(e,t)=>(t.preventDefault(),!zu.inProgress()&&(m().checkAndDelete(),!0)),keyCodes:[vd.DELETE,vd.BACKSPACE]})},$o=function(){const e=rp.registry.createSerializedKey(vd.C,[vd.CTRL]),t=rp.registry.createSerializedKey(vd.C,[vd.ALT]),n=rp.registry.createSerializedKey(vd.C,[vd.META]);rp.registry.register({name:$h.COPY,preconditionFn(e){const t=m();return!e.options.readOnly&&!zu.inProgress()&&null!=t&&t.isDeletable()&&t.isMovable()&&Bo(t)},callback:(e,t)=>(t.preventDefault(),e.hideChaff(),!(!(t=m())||!Bo(t)||(op=t.toCopyData(),sp=e,!op))),keyCodes:[e,t,n]})},Uo=function(){const e=rp.registry.createSerializedKey(vd.X,[vd.CTRL]),t=rp.registry.createSerializedKey(vd.X,[vd.ALT]),n=rp.registry.createSerializedKey(vd.X,[vd.META]);rp.registry.register({name:$h.CUT,preconditionFn(e){const t=m();return!e.options.readOnly&&!zu.inProgress()&&null!=t&&t instanceof Fh&&t.isDeletable()&&t.isMovable()&&!t.workspace.isFlyout},callback(e){const t=m();return!(!t||!Bo(t)||(op=t.toCopyData(),sp=e,t.checkAndDelete(),0))},keyCodes:[e,t,n]})},Ho=function(){const e=rp.registry.createSerializedKey(vd.V,[vd.CTRL]),t=rp.registry.createSerializedKey(vd.V,[vd.ALT]),n=rp.registry.createSerializedKey(vd.V,[vd.META]);rp.registry.register({name:$h.PASTE,preconditionFn:e=>!e.options.readOnly&&!zu.inProgress(),callback:()=>!(!op||!sp||!Dn(op,sp)),keyCodes:[e,t,n]})},Go=function(){const e=rp.registry.createSerializedKey(vd.Z,[vd.CTRL]),t=rp.registry.createSerializedKey(vd.Z,[vd.ALT]),n=rp.registry.createSerializedKey(vd.Z,[vd.META]);rp.registry.register({name:$h.UNDO,preconditionFn:e=>!e.options.readOnly&&!zu.inProgress(),callback:e=>(e.hideChaff(),e.undo(!1),!0),keyCodes:[e,t,n]})},Vo=function(){const e=rp.registry.createSerializedKey(vd.Z,[vd.SHIFT,vd.CTRL]),t=rp.registry.createSerializedKey(vd.Z,[vd.SHIFT,vd.ALT]),n=rp.registry.createSerializedKey(vd.Z,[vd.SHIFT,vd.META]),i=rp.registry.createSerializedKey(vd.Y,[vd.CTRL]);rp.registry.register({name:$h.REDO,preconditionFn:e=>!zu.inProgress()&&!e.options.readOnly,callback:e=>(e.hideChaff(),e.undo(!0),!0),keyCodes:[e,t,n,i]})},Wo=function(){jo(),Fo(),$o(),Uo(),Ho(),Go(),Vo()},zo=function(e){const t={id:e.getId(),name:e.getName(),returnTypes:e.getReturnTypes()};return e.getParameters().length?(t.parameters=e.getParameters().map((e=>qo(e))),t):t},qo=function(e){const t={id:e.getId(),name:e.getName()};return e.getTypes().length?(t.types=e.getTypes(),t):t},Yo=function(e,t,n,i){if(e=new e(i,n.name,n.id).setReturnTypes(n.returnTypes),!n.parameters)return e;for(const[r,o]of n.parameters.entries())e.insertParameter(Ko(t,o,i),r);return e},Ko=function(e,t,n){return e=new e(n,t.name,t.id),t.types&&e.setTypes(t.types),e},Zo=function(e){const t=Object.create(null),n=l($s.SERIALIZER,!0);for(const i in n){let r;const o=null==(r=n[i])?void 0:r.save(e);o&&(t[i]=o)}return t},Xo=function(e,t,{recordUndo:n=!1}={}){var i=l($s.SERIALIZER,!0);if(i){i=Object.entries(i).sort(((e,t)=>t[1].priority-e[1].priority));var r=A();C(n),(n=Ms.getGroup$$module$build$src$core$events$utils())||Ms.setGroup$$module$build$src$core$events$utils(!0),he(),t instanceof Ch&&t.setResizesEnabled(!1);for(const[,e]of i.reverse()){let n;null==(n=e)||n.clear(t)}for(let[n,r]of i.reverse())if(e[n]){let i;null==(i=r)||i.load(e[n],t)}t instanceof Ch&&t.setResizesEnabled(!0),pe(),I(new(j(aa))(t)),Ms.setGroup$$module$build$src$core$events$utils(n),C(r)}},Jo=function(e,t,n){const i=n.getBoundingRectangle(),r=i.right-i.left,o=hi(t.top,i.top,t.top+t.height-(i.bottom-i.top))-i.top;let s=t.left;return t=t.left+t.width-r,e.RTL?s=Math.min(t,s):t=Math.max(s,t),!(!(e=hi(s,i.left,t)-i.left)&&!o||(n.moveBy(e,o,["inbounds"]),0))},Qo=function(e){return t=>{var n,i=e.getMetricsManager();if(i.hasFixedEdges()&&!e.isDragging())if(-1!==la.indexOf(null!=(n=t.type)?n:"")){n=i.getScrollMetrics(!0);const r=es(e,t);r&&(i=Ms.getGroup$$module$build$src$core$events$utils()||!1,Ms.setGroup$$module$build$src$core$events$utils(t.group),Jo(e,n,r)&&!t.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),Ms.setGroup$$module$build$src$core$events$utils(i))}else t.type===ra&&t.scale&&t.oldScale&&t.scale>t.oldScale&&ts(e)}},es=function(e,t){let n=null;switch(t.type){case Ms.CREATE$$module$build$src$core$events$utils:case Ms.MOVE$$module$build$src$core$events$utils:(n=e.getBlockById(t.blockId))&&(n=n.getRootBlock());break;case oa:case sa:n=e.getCommentById(t.commentId)}return n},ts=function(e){var t=e.getMetricsManager();if(t.hasFixedEdges()&&!e.isDragging()){t=t.getScrollMetrics(!0);var n=e.getTopBoundedElements();for(let i,r=0;i=n[r];r++)Jo(e,t,i)}},ns=function(e,t){const n=[];for(const i of e.getIcons())mr(i)&&!i.bubbleIsVisible()||(n.push({location:t,icon:i}),i.onLocationChange(t));for(const i of e.getChildren(!1))n.push(...ns(i,el.sum(t,i.relativeCoords)));return n},is=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.UNDO,preconditionFn:e=>0<e.workspace.getUndoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!1)},scopeType:tu.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},rs=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.REDO,preconditionFn:e=>0<e.workspace.getRedoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!0)},scopeType:tu.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},os=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.CLEAN_UP,preconditionFn:e=>e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden",callback(e){e.workspace.cleanUp()},scopeType:tu.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},ss=function(e,t){function n(t){r--,t.setCollapsed(e),0===r&&Ms.setGroup$$module$build$src$core$events$utils(!1)}let i=0,r=0;Ms.setGroup$$module$build$src$core$events$utils(!0);for(let e=0;e<t.length;e++){let o=t[e];for(;o;)r++,setTimeout(n.bind(null,o),i),o=o.getNextBlock(),i+=10}},as=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.COLLAPSE_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let n=e[t];for(;n;){if(!n.isCollapsed())return"enabled";n=n.getNextBlock()}}return"disabled"}return"hidden"},callback(e){ss(!0,e.workspace.getTopBlocks(!0))},scopeType:tu.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},ls=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.EXPAND_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let n=e[t];for(;n;){if(n.isCollapsed())return"enabled";n=n.getNextBlock()}}return"disabled"}return"hidden"},callback(e){ss(!1,e.workspace.getTopBlocks(!0))},scopeType:tu.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},cs=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else{e=e.getChildren(!1);for(let n=0;n<e.length;n++)cs(e[n],t)}},us=function(e){const t=[];e=e.getTopBlocks(!0);for(let n=0;n<e.length;n++)cs(e[n],t);return t},ds=function(e,t){t?Ms.setGroup$$module$build$src$core$events$utils(t):(Ms.setGroup$$module$build$src$core$events$utils(!0),t=Ms.getGroup$$module$build$src$core$events$utils());const n=e.shift();n&&(n.isDeadOrDying()?ds(e,t):(n.dispose(!1,!0),setTimeout(ds,10,e,t))),Ms.setGroup$$module$build$src$core$events$utils(!1)},hs=function(){tu.registry.register({displayText:e=>e.workspace?1===(e=us(e.workspace).length)?Ms.Msg$$module$build$src$core$msg.DELETE_BLOCK:Ms.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`):"",preconditionFn:e=>e.workspace&&0<us(e.workspace).length?"enabled":"disabled",callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=us(e.workspace);2>t.length?ds(t):Xe(Ms.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),(function(e){e&&ds(t)}))}},scopeType:tu.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},ps=function(){is(),rs(),os(),as(),ls(),hs()},fs=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden",callback(e){if(e.block){var t=e.block.toCopyData();t&&Dn(t,e.block.workspace)}},scopeType:tu.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},gs=function(){tu.registry.register({displayText:e=>e.block.hasIcon(Sd.TYPE)?Ms.Msg$$module$build$src$core$msg.REMOVE_COMMENT:Ms.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden",callback(e){(e=e.block).hasIcon(Sd.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:tu.ScopeType.BLOCK,id:"blockComment",weight:2})},ms=function(){tu.registry.register({displayText:e=>e.block.getInputsInline()?Ms.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:Ms.Msg$$module$build$src$core$msg.INLINE_INPUTS,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.isMovable()&&!e.isCollapsed())for(let t=1;t<e.inputList.length;t++)if(!(e.inputList[t-1]instanceof jp||e.inputList[t]instanceof jp))return"enabled";return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:tu.ScopeType.BLOCK,id:"blockInline",weight:3})},bs=function(){tu.registry.register({displayText:e=>e.block.isCollapsed()?Ms.Msg$$module$build$src$core$msg.EXPAND_BLOCK:Ms.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden",callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:tu.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},ys=function(){tu.registry.register({displayText:e=>e.block.isEnabled()?Ms.Msg$$module$build$src$core$msg.DISABLE_BLOCK:Ms.Msg$$module$build$src$core$msg.ENABLE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.disable&&e.isEditable()?e.getInheritedDisabled()?"disabled":"enabled":"hidden",callback(e){e=e.block;const t=Ms.getGroup$$module$build$src$core$events$utils();t||Ms.setGroup$$module$build$src$core$events$utils(!0),e.setEnabled(!e.isEnabled()),Ms.setGroup$$module$build$src$core$events$utils(t)},scopeType:tu.ScopeType.BLOCK,id:"blockDisable",weight:5})},vs=function(){tu.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),1===e?Ms.Msg$$module$build$src$core$msg.DELETE_BLOCK:Ms.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn:e=>!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden",callback(e){e.block&&e.block.checkAndDelete()},scopeType:tu.ScopeType.BLOCK,id:"blockDelete",weight:6})},_s=function(){tu.registry.register({displayText:()=>Ms.Msg$$module$build$src$core$msg.HELP,preconditionFn:e=>("function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden",callback(e){e.block.showHelp()},scopeType:tu.ScopeType.BLOCK,id:"blockHelp",weight:7})},Es=function(){fs(),gs(),ms(),bs(),ys(),vs(),_s()},Ts=function(){ps(),Es()},xs=function(e,t){var n=null;let i;if(n="string"==typeof e?document.getElementById(e)||document.querySelector(e):e,!document.contains(n)&&document!==(null==(i=n)?void 0:i.ownerDocument))throw Error("Error: container is not in current document");e=new Ju(t||{}),(t=document.createElement("div")).className="injectionDiv",t.tabIndex=0,jn(t,jc.LABEL,Ms.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),n.appendChild(t),n=ws(t,e);const r=ks(t,n,e);return Ss(r),g(r),_(r),t.addEventListener("focusin",(function(){g(r)})),r},ws=function(e,t){e.setAttribute("dir","LTR"),te(t.hasCss,t.pathToMedia),e=ie(dl.SVG,{xmlns:rl,"xmlns:html":ol,"xmlns:xlink":sl,version:"1.1",class:"blocklySvg",tabindex:"0"},e);const n=ie(dl.DEFS,{},e),i=String(Math.random()).substring(2);return t.gridPattern=qu.createDom(i,t.gridOptions,n),e},ks=function(e,t,n){n.parentWorkspace=null;const i=(n=new Ch(n)).options;n.scale=i.zoomOptions.startScale,t.appendChild(n.createDom("blocklyMainBackground",e));var r=n.getRenderer().getClassName();return r&&re(e,r),(r=n.getTheme().getClassName())&&re(e,r),!i.hasCategories&&i.languageTree&&(e=n.addFlyout(dl.SVG),ce(e,t)),i.hasTrashcan&&n.addTrashcan(),i.zoomOptions&&i.zoomOptions.controls&&n.addZoomControls(),n.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),n.translate(0,0),n.addChangeListener(Qo(n)),_(n),Un(),pi(),tr(),n},Ss=function(e){const t=e.options;var n=e.getParentSvg();if(z(n.parentNode,"contextmenu",null,(function(e){K(e)||e.preventDefault()})),n=z(window,"resize",null,(function(){lr(),e.hideComponents(!0),Li(),Xn(),_(e),ts(e)})),e.setResizeHandlerWrapper(n),As(),t.languageTree){n=e.getToolbox();const i=e.getFlyout(!0);n?n.init():i&&(i.init(e),i.show(t.languageTree),"function"==typeof i.scrollToStart&&i.scrollToStart())}t.hasTrashcan&&e.trashcan.init(),t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(),t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new pp(e,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.horizontal,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),t.hasSounds&&Is(t.pathToMedia,e)},Cs=function(e){const t=f();t&&!(K(e)||t.rendered&&!t.isVisible())&&rp.registry.onKeyDown(t,e)},As=function(){cf||(z(document,"scroll",null,(function(){const e=d();for(let t,n=0;t=e[n];n++)t instanceof Ch&&t.updateInverseScreenCTM()})),z(document,"keydown",null,Cs),q(document,"touchend",null,U),q(document,"touchcancel",null,U),$a&&z(window,"orientationchange",document,(function(){_(f())}))),cf=!0},Is=function(e,t){function n(){for(;r.length;){const e=r.pop();e&&Y(e)}i.preload()}const i=t.getAudioManager();i.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),i.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),i.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const r=[];r.push(z(document,"pointermove",null,n,!0)),r.push(z(document,"touchstart",null,n,!0))},Os=function(e){return void 0!==e.getType&&void 0!==e.initView&&void 0!==e.dispose&&void 0!==e.getWeight&&void 0!==e.getSize&&void 0!==e.applyColour&&void 0!==e.hideForInsertionMarker&&void 0!==e.updateEditable&&void 0!==e.updateCollapsed&&void 0!==e.isShownWhenCollapsed&&void 0!==e.setOffsetInBlock&&void 0!==e.onLocationChange&&void 0!==e.onClick},Ns=function(e){return void 0!==e.paste},Rs=function(e){return e.isSelectable()},Ds=function(e){f().hideChaff(e)},(Ls=Ls||{}).scope={},Ls.ASSUME_ES5=!1,Ls.ASSUME_NO_NATIVE_MAP=!1,Ls.ASSUME_NO_NATIVE_SET=!1,Ls.SIMPLE_FROUND_POLYFILL=!1,Ls.ISOLATE_POLYFILLS=!1,Ls.FORCE_POLYFILL_PROMISE=!1,Ls.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,Ls.defineProperty=Ls.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},Ls.getGlobal=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e];for(var n=0;n<t.length;++n){var i=t[n];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},Ls.global=Ls.getGlobal(this),Ls.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),Ls.TRUST_ES6_POLYFILLS=!Ls.ISOLATE_POLYFILLS||Ls.IS_SYMBOL_NATIVE,Ls.polyfills={},Ls.propertyToPolyfillSymbol={},Ls.POLYFILL_PREFIX="$jscp$",Ls.polyfill=function(e,t,n,i){t&&(Ls.ISOLATE_POLYFILLS?Ls.polyfillIsolated(e,t,n,i):Ls.polyfillUnisolated(e,t,n,i))},Ls.polyfillUnisolated=function(e,t,n,i){for(n=Ls.global,e=e.split("."),i=0;i<e.length-1;i++){var r=e[i];if(!(r in n))return;n=n[r]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&Ls.defineProperty(n,e,{configurable:!0,writable:!0,value:t})},Ls.polyfillIsolated=function(e,t,n,i){var r=e.split(".");e=1===r.length,i=r[0],i=!e&&i in Ls.polyfills?Ls.polyfills:Ls.global;for(var o=0;o<r.length-1;o++){var s=r[o];if(!(s in i))return;i=i[s]}r=r[r.length-1],null!=(t=t(n=Ls.IS_SYMBOL_NATIVE&&"es6"===n?i[r]:null))&&(e?Ls.defineProperty(Ls.polyfills,r,{configurable:!0,writable:!0,value:t}):t!==n&&(void 0===Ls.propertyToPolyfillSymbol[r]&&(n=1e9*Math.random()>>>0,Ls.propertyToPolyfillSymbol[r]=Ls.IS_SYMBOL_NATIVE?Ls.global.Symbol(r):Ls.POLYFILL_PREFIX+n+"$"+r),Ls.defineProperty(i,Ls.propertyToPolyfillSymbol[r],{configurable:!0,writable:!0,value:t})))},Ls.polyfill("globalThis",(function(e){return e||Ls.global}),"es_2020","es3"),Ls.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},Ls.arrayIterator=function(e){return{next:Ls.arrayIteratorImpl(e)}},Ls.initSymbol=function(){},Ls.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},Ls.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r},Ls.polyfill("Array.prototype.values",(function(e){return e||function(){return Ls.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),Ls.polyfill("Array.prototype.flat",(function(e){return e||function(e){e=void 0===e?1:e;var t=[];return Array.prototype.forEach.call(this,(function(n){Array.isArray(n)&&0<e?(n=Array.prototype.flat.call(n,e-1),t.push.apply(t,n)):t.push(n)})),t}}),"es9","es5"),Ls.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Ls.polyfill("Object.entries",(function(e){return e||function(e){var t,n=[];for(t in e)Ls.owns(e,t)&&n.push([t,e[t]]);return n}}),"es8","es3"),Ls.polyfill("Object.values",(function(e){return e||function(e){var t,n=[];for(t in e)Ls.owns(e,t)&&n.push(e[t]);return n}}),"es8","es3");var Ps=Object.create(null),Bs={typeMap:Ps},js=Object.create(null),Fs="default",$s=class{constructor(e){this.name=e}toString(){return this.name}};$s.CONNECTION_CHECKER=new $s("connectionChecker"),$s.CONNECTION_PREVIEWER=new $s("connectionPreviewer"),$s.CURSOR=new $s("cursor"),$s.EVENT=new $s("event"),$s.FIELD=new $s("field"),$s.INPUT=new $s("input"),$s.RENDERER=new $s("renderer"),$s.TOOLBOX=new $s("toolbox"),$s.THEME=new $s("theme"),$s.TOOLBOX_ITEM=new $s("toolboxItem"),$s.FLYOUTS_VERTICAL_TOOLBOX=new $s("flyoutsVerticalToolbox"),$s.FLYOUTS_HORIZONTAL_TOOLBOX=new $s("flyoutsHorizontalToolbox"),$s.METRICS_MANAGER=new $s("metricsManager"),$s.BLOCK_DRAGGER=new $s("blockDragger"),$s.SERIALIZER=new $s("serializer"),$s.ICON=new $s("icon"),$s.PASTER=new $s("paster");var Us={DEFAULT:Fs,TEST_ONLY:Bs};Us.Type=$s,Us.getAllItems=l,Us.getClass=s,Us.getClassFromOptions=c,Us.getObject=a,Us.hasItem=o,Us.register=t,Us.unregister=i;var Hs,Gs,Vs=Object.create(null),Ws=Object.create(null),zs=null,qs=[],Ys={defineBlocksWithJsonArrayInternal:w},Ks={TEST_ONLY:Ys};Ks.createBlockDefinitionsFromJsonArray=Ms.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Ks.defineBlocks=Ms.defineBlocks$$module$build$src$core$common,Ks.defineBlocksWithJsonArray=x,Ks.draggingConnections=qs,Ks.getAllWorkspaces=d,Ks.getBlockTypeCounts=E,Ks.getMainWorkspace=f,Ks.getParentContainer=y,Ks.getSelected=m,Ks.getWorkspaceById=u,Ks.registerWorkspace=h,Ks.setMainWorkspace=g,Ks.setParentContainer=v,Ks.setSelected=b,Ks.svgResize=_,Ks.unregisterWorkpace=p;var Zs,Xs,Js,Qs,ea,ta,na,ia,ra,oa,sa,aa,la,ca,ua,da,ha={genUid:()=>{const e="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length,t=[];for(let n=0;20>n;n++)t[n]="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.random()*e);return t.join("")}},pa=0,fa={TEST_ONLY:ha};fa.genUid=S,fa.getNextUniqueId=k,Zs="",Xs=!0,Js=0,Ms.CREATE$$module$build$src$core$events$utils="create",Ms.CREATE$$module$build$src$core$events$utils,Ms.DELETE$$module$build$src$core$events$utils="delete",Ms.DELETE$$module$build$src$core$events$utils,Ms.CHANGE$$module$build$src$core$events$utils="change",Ms.CHANGE$$module$build$src$core$events$utils,Qs="block_field_intermediate_change",Ms.MOVE$$module$build$src$core$events$utils="move",Ms.MOVE$$module$build$src$core$events$utils,ea="var_create",ta="ui",na="click",ia="bubble_open",ra="viewport_change",oa="comment_create",sa="comment_move",aa="finished_loading",la=[Ms.CREATE$$module$build$src$core$events$utils,Ms.MOVE$$module$build$src$core$events$utils,oa,sa],ua={FIRE_QUEUE:ca=[],fireNow:N,fireInternal:O,setGroupInternal:M},(da={BLOCK_CHANGE:Ms.CHANGE$$module$build$src$core$events$utils,BLOCK_CREATE:Ms.CREATE$$module$build$src$core$events$utils,BLOCK_DELETE:Ms.DELETE$$module$build$src$core$events$utils,BLOCK_DRAG:"drag",BLOCK_FIELD_INTERMEDIATE_CHANGE:Qs,BLOCK_MOVE:Ms.MOVE$$module$build$src$core$events$utils,BUBBLE_OPEN:ia,BUMP_EVENTS:la,CHANGE:Ms.CHANGE$$module$build$src$core$events$utils,CLICK:na,COMMENT_CHANGE:"comment_change",COMMENT_CREATE:oa,COMMENT_DELETE:"comment_delete",COMMENT_MOVE:sa,CREATE:Ms.CREATE$$module$build$src$core$events$utils,DELETE:Ms.DELETE$$module$build$src$core$events$utils,FINISHED_LOADING:aa,MARKER_MOVE:"marker_move",MOVE:Ms.MOVE$$module$build$src$core$events$utils,SELECTED:"selected",TEST_ONLY:ua,THEME_CHANGE:"theme_change",TOOLBOX_ITEM_SELECT:"toolbox_item_select",TRASHCAN_OPEN:"trashcan_open",UI:ta,VAR_CREATE:ea,VAR_DELETE:"var_delete",VAR_RENAME:"var_rename",VIEWPORT_CHANGE:ra}).clearPendingUndo=D,da.disable=Ms.disable$$module$build$src$core$events$utils,da.disableOrphans=F,da.enable=Ms.enable$$module$build$src$core$events$utils,da.filter=R,da.fire=I,da.fromJson=B,da.get=j,da.getDescendantIds=P,da.getGroup=Ms.getGroup$$module$build$src$core$events$utils,da.getRecordUndo=A,da.isEnabled=L,da.setGroup=Ms.setGroup$$module$build$src$core$events$utils,da.setRecordUndo=C;var ga,ma,ba=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=Ms.getGroup$$module$build$src$core$events$utils(),this.recordUndo=A()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,n){return n.isBlank=!1,n.group=e.group||"",n.workspaceId=t.id,n}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=u(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},ya=class extends ba{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=void 0===e,this.workspaceId=e||""}},va=class extends ya{constructor(e,t,n){null===(t=e?e.workspace.id:t)&&(t=void 0),super(t),this.type=na,this.blockId=e?e.id:void 0,this.targetType=n}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new va)).targetType=e.targetType,t.blockId=e.blockId,t}};(ma=ga||(ga={})).BLOCK="block",ma.WORKSPACE="workspace",ma.ZOOM_CONTROLS="zoom_controls",t($s.EVENT,na,va);var _a={};_a.Click=va,_a.ClickTarget=ga;var Ea,Ta,xa,wa,ka,Sa,Ca,Aa,Ia,Oa,Na=750,Ra="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Da=null,La={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},Ma=0,Pa={TOUCH_ENABLED:Ra,TOUCH_MAP:La};Pa.checkTouchIdentifier=W,Pa.clearTouchIdentifier=H,Pa.getTouchIdentifierFromEvent=V,Pa.longStart=$,Pa.longStop=U,Pa.shouldHandleEvent=G,function(e){function t(e){return-1!==n.indexOf(e.toUpperCase())}const n=(Ea=e).toUpperCase();Ta=t("JavaFX"),xa=t("WebKit"),wa=t("Gecko")&&!xa,ka=t("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,Sa=t("iPad")||t("Macintosh")&&0<e,Ca=t("iPhone")&&!Sa,Aa=t("Macintosh"),Ia=Sa||ka&&!t("Mobile")||t("Silk"),Oa=!Ia&&(Ca||ka)}(globalThis.navigator&&globalThis.navigator.userAgent||"");var Ba=Ta,ja=wa,Fa=ka,$a=Sa,Ua=Ca,Ha=Aa,Ga=Oa,Va={ANDROID:Fa,GECKO:ja,IPAD:$a,IPHONE:Ua,JavaFx:Ba,MAC:Ha,MOBILE:Ga,raw:Ea},Wa=40,za=125,qa={};qa.bind=q,qa.conditionalBind=z,qa.getScrollDeltaPixels=J,qa.isRightButton=Z,qa.isTargetInput=K,qa.mouseToSvg=X,qa.unbind=Y;var Ya={};Ya.removeElem=Q;var Ka=class{constructor(e){this.name_=e}toString(){return this.name_}};Ka.POSITIONABLE=new Ka("positionable"),Ka.DRAG_TARGET=new Ka("drag_target"),Ka.DELETE_AREA=new Ka("delete_area"),Ka.AUTOHIDEABLE=new Ka("autohideable");var Za=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){const n=e.component.id;var i;if(!t&&this.componentData.has(n))throw Error('Plugin "'+n+'" with capabilities "'+(null==(i=this.componentData.get(n))?void 0:i.capabilities)+'" already added.');for(this.componentData.set(n,e),t=[],i=0;i<e.capabilities.length;i++){const r=String(e.capabilities[i]).toLowerCase();if(t.push(r),this.capabilityToComponentIds.has(r)){let e;null==(e=this.capabilityToComponentIds.get(r))||e.push(n)}else this.capabilityToComponentIds.set(r,[n])}this.componentData.get(n).capabilities=t}removeComponent(e){const t=this.componentData.get(e);if(t){for(let n=0;n<t.capabilities.length;n++){const i=String(t.capabilities[n]).toLowerCase();Q(this.capabilityToComponentIds.get(i),e)}this.componentData.delete(e)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');var n,i;this.hasCapability(e,t)?console.warn('Plugin "'+e+'already has capability "'+t+'"'):(t=`${t}`.toLowerCase(),null==(n=this.componentData.get(e))||n.capabilities.push(t),null==(i=this.capabilityToComponentIds.get(t))||i.push(e))}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=`${t}`.toLowerCase(),Q(this.componentData.get(e).capabilities,t),Q(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+"doesn't have capability \""+t+'" to remove')}hasCapability(e,t){return t=`${t}`.toLowerCase(),this.componentData.has(e)&&-1!==this.componentData.get(e).capabilities.indexOf(t)}getComponent(e){let t;return null==(t=this.componentData.get(e))?void 0:t.component}getComponents(e,t){if(e=`${e}`.toLowerCase(),!(e=this.capabilityToComponentIds.get(e)))return[];const n=[];if(t){const t=[];e.forEach((e=>{t.push(this.componentData.get(e))})),t.sort((function(e,t){return e.weight-t.weight})),t.forEach((function(e){n.push(e.component)}))}else e.forEach((e=>{n.push(this.componentData.get(e).component)}));return n}};Za.Capability=Ka;var Xa=!1,Ja='\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don\'t allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n',Qa={};Qa.inject=te,Qa.register=ee;var el=class{constructor(e,t){this.x=e,this.y=t}clone(){return new el(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t||!(!e||!t)&&e.x===t.x&&e.y===t.y}static distance(e,t){const n=e.x-t.x;return e=e.y-t.y,Math.sqrt(n*n+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new el(e.x-t.x,e.y-t.y)}static sum(e,t){return new el(e.x+t.x,e.y+t.y)}},tl=new Set,nl={};nl.warn=ne;var il,rl="http://www.w3.org/2000/svg",ol="http://www.w3.org/1999/xhtml",sl="http://www.w3.org/1999/xlink";!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"}(il||(il={}));var al=null,ll=0,cl=null,ul={HTML_NS:ol};ul.NodeType=il,ul.SVG_NS=rl,ul.XLINK_NS=sl,ul.addClass=re,ul.containsNode=ue,ul.createSvgElement=ie,ul.getFastTextWidth=ge,ul.getFastTextWidthWithSizeString=me,ul.getTextWidth=fe,ul.hasClass=ae,ul.insertAfter=ce,ul.measureFontMetrics=be,ul.removeClass=se,ul.removeClasses=oe,ul.removeNode=le,ul.setCssTransform=de,ul.startTextWidthCache=he,ul.stopTextWidthCache=pe;var dl=class{constructor(e){this.tagName=e}toString(){return this.tagName}};dl.ANIMATE=new dl("animate"),dl.CIRCLE=new dl("circle"),dl.CLIPPATH=new dl("clipPath"),dl.DEFS=new dl("defs"),dl.FECOMPOSITE=new dl("feComposite"),dl.FECOMPONENTTRANSFER=new dl("feComponentTransfer"),dl.FEFLOOD=new dl("feFlood"),dl.FEFUNCA=new dl("feFuncA"),dl.FEGAUSSIANBLUR=new dl("feGaussianBlur"),dl.FEPOINTLIGHT=new dl("fePointLight"),dl.FESPECULARLIGHTING=new dl("feSpecularLighting"),dl.FILTER=new dl("filter"),dl.FOREIGNOBJECT=new dl("foreignObject"),dl.G=new dl("g"),dl.IMAGE=new dl("image"),dl.LINE=new dl("line"),dl.PATH=new dl("path"),dl.PATTERN=new dl("pattern"),dl.POLYGON=new dl("polygon"),dl.RECT=new dl("rect"),dl.SVG=new dl("svg"),dl.TEXT=new dl("text"),dl.TSPAN=new dl("tspan");var hl=class{constructor(e,t,n,i){this.top=e,this.bottom=t,this.left=n,this.right=i}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)}},pl=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t||!(!e||!t)&&e.width===t.width&&e.height===t.height}},fl={getSizeInternal:ve},gl={TEST_ONLY:fl};gl.getBorderBox=we,gl.getComputedStyle=Ee,gl.getContainerOffsetToScrollInto=Se,gl.getPageOffset=Te,gl.getSize=ye,gl.getViewportPageOffset=xe,gl.scrollIntoContainerView=ke;var ml=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,bl=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,yl={TEST_ONLY:{XY_REGEX:ml,XY_STYLE_REGEX:bl}};yl.getDocumentScroll=Oe,yl.getInjectionDivXY=Ae,yl.getRelativeXY=Ce,yl.getViewportBBox=Ie,yl.screenToWsCoordinates=Ne,yl.wsToScreenCoordinates=Re;var vl=class{constructor(e,t,n,i,r){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new el(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new el(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=n||!1,this.margin=void 0!==r?r:vl.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),i&&(e+=" "+i),this.outerSvg=ie(dl.SVG,{class:e}),i=ie(dl.G,{},this.outerSvg),this.svgBackground=ie(dl.RECT,{class:"blocklyScrollbarBackground"},i),e=Math.floor((vl.scrollbarThickness-5)/2),this.svgHandle=ie(dl.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},i),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),ce(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=z(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=z(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=vl.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),Y(this.onMouseDownBarWrapper_),Y(this.onMouseDownHandleWrapper_),le(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,de(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){(e||(e=this.workspace.getMetrics()))&&(this.oldHostMetrics&&vl.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics()))}requiresViewResize(e){return!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=vl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=vl.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-vl.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewWidth/e.scrollWidth;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth;var n=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/t*n,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=n/t}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=vl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-vl.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewHeight/e.scrollHeight;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight;var n=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/t*n,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=n/t}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),H(),this.cleanUp(),Z(e))e.stopPropagation();else{var t=X(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());t=this.horizontal?t.x:t.y;var n=Ae(this.svgHandle);n=this.horizontal?n.x:n.y;var i=this.handlePosition,r=.95*this.handleLength;t<=n?i-=r:t>=n+this.handleLength&&(i+=r),this.setHandlePosition(this.constrainHandlePosition(i)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),Z(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=z(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=z(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){H(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(Y(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(Y(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(t||void 0===t)&&this.updateMetrics()}setOrigin(e,t){this.origin=new el(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}};vl.scrollbarThickness=Ra?25:15,vl.DEFAULT_SCROLLBAR_MARGIN=.5;var _l={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},El={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:Tl,DOMParser:xl,XMLSerializer:wl}=globalThis;xl&&(_l=new xl),wl&&(El=new wl);var kl="https://developers.google.com/blockly/xml",Sl=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,Cl={NAME_SPACE:kl};Cl.createElement=Ms.createElement$$module$build$src$core$utils$xml,Cl.createTextNode=Ms.createTextNode$$module$build$src$core$utils$xml,Cl.domToText=Le,Cl.injectDependencies=De,Cl.textToDom=Ms.textToDom$$module$build$src$core$utils$xml;var Al,Il="categoryToolbox",Ol="flyoutToolbox";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(Al||(Al={}));var Nl,Rl,Dl,Ll={hasCategoriesInternal:$e},Ml={};Ml.Position=Al,Ml.TEST_ONLY=Ll,Ml.convertFlyoutDefToJsonArray=je,Ml.convertToolboxDefToJson=Pe,Ml.hasCategories=Fe,Ml.isCategoryCollapsible=Ue,Ml.parseToolboxTree=We,function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(Nl||(Nl={})),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(Rl||(Rl={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Dl||(Dl={}));var Pl={};Pl.bumpDirection=Dl,Pl.bumpPositionRect=Ye,Pl.getCornerOppositeToolbox=qe,Pl.getStartPositionRect=ze,Pl.horizontalPosition=Rl,Pl.verticalPosition=Nl;var Bl=96,jl=124,Fl="sprites.png",$l=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=ie(dl.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[Za.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&le(this.svgGroup);for(const e of this.boundEvents)Y(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new hl(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){if(this.initialized){var n,i=qe(this.workspace,e),r=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(r+=this.LARGE_SPACING+this.HEIGHT),e=ze(i,new pl(this.WIDTH,r),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),i=i.vertical,t=Ye(e,this.MARGIN_VERTICAL,i===Nl.TOP?Dl.DOWN:Dl.UP,t),i===Nl.TOP){var o,s=this.SMALL_SPACING+this.HEIGHT;null==(o=this.zoomInGroup)||o.setAttribute("transform","translate(0, "+s+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(s+this.LARGE_SPACING+this.HEIGHT)+")")}else{let e;o=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0,null==(e=this.zoomInGroup)||e.setAttribute("transform","translate(0, "+o+")"),o=o+this.SMALL_SPACING+this.HEIGHT,null==(s=this.zoomOutGroup)||s.setAttribute("transform","translate(0, "+o+")")}this.top=t.top,this.left=t.left,null==(n=this.svgGroup)||n.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=ie(dl.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const t=ie(dl.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);ie(dl.RECT,{width:32,height:32},t),ie(dl.IMAGE,{width:Bl,height:jl,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(sl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(z(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=ie(dl.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const t=ie(dl.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);ie(dl.RECT,{width:32,height:32},t),ie(dl.IMAGE,{width:Bl,height:jl,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(sl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(z(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),H(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=ie(dl.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const t=ie(dl.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);ie(dl.RECT,{width:32,height:32},t),ie(dl.IMAGE,{width:Bl,height:jl,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(sl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(z(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),H(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(j(na))(null,this.workspace.id,"zoom_controls");I(e)}};ee("\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n");var Ul=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};Ul.MUTATOR=new Ul("mutator"),Ul.WARNING=new Ul("warning"),Ul.COMMENT=new Ul("comment"),function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"}(Ms.inputTypes$$module$build$src$core$inputs$input_types||(Ms.inputTypes$$module$build$src$core$inputs$input_types={})),Ms.inputTypes$$module$build$src$core$inputs$input_types;var Hl,Gl,Vl=function(e,t){window.alert(e),t&&t()},Wl=function(e,t){t(window.confirm(e))},zl=function(e,t,n){n(window.prompt(e,t))},ql={confirmInternal:Je},Yl={TEST_ONLY:ql};Yl.alert=Ke,Yl.confirm=Xe,Yl.prompt=et,Yl.setAlert=Ze,Yl.setConfirm=Qe,Yl.setPrompt=tt,Ms.Msg$$module$build$src$core$msg=Object.create(null),Hl=function(e){Object.keys(e).forEach((function(t){Ms.Msg$$module$build$src$core$msg[t]=e[t]}))},Gl={Msg:Ms.Msg$$module$build$src$core$msg,setLocale:Hl};var Kl={};Kl.isLegacyProcedureCallBlock=rt,Kl.isLegacyProcedureDefBlock=it;var Zl=class extends ba{constructor(e){super(),this.isBlank=void 0===e,e&&(this.varId=e.getId(),this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Zl)).varId=e.varId,t}},Xl=class extends Zl{constructor(e){super(e),this.type=ea,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Xl)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.createVariable(this.varName,this.varType,this.varId):t.deleteVariableById(this.varId)}};t($s.EVENT,ea,Xl);var Jl=class{constructor(e,t,n,i){this.workspace=e,this.name=t,this.type=n||"",this.id_=i||S()}getId(){return this.id_}static compareByName(e,t){return e.name.localeCompare(t.name,void 0,{sensitivity:"base"})}},Ql="ijkmnopqrstuvwxyzabcdefgh",ec={generateUniqueNameInternal:lt},tc={CATEGORY_NAME:"VARIABLE",TEST_ONLY:ec,VAR_LETTER_OPTIONS:Ql};tc.allDeveloperVariables=Ms.allDeveloperVariables$$module$build$src$core$variables,tc.allUsedVarModels=Ms.allUsedVarModels$$module$build$src$core$variables,tc.createVariableButtonHandler=ut,tc.flyoutCategory=ot,tc.flyoutCategoryBlocks=st,tc.generateUniqueName=at,tc.generateUniqueNameFromOptions=ct,tc.generateVariableFieldDom=bt,tc.getAddedVariables=vt,tc.getOrCreateVariablePackage=Ms.getOrCreateVariablePackage$$module$build$src$core$variables,tc.getVariable=Ms.getVariable$$module$build$src$core$variables,tc.nameUsedWithAnyType=pt,tc.nameUsedWithConflictingParam=ft,tc.promptName=dt,tc.renameVariable=Ms.renameVariable$$module$build$src$core$variables;var nc=class{constructor(e,t,n,i,r){this.workspace=e,this.editable=this.movable=this.deletable=!0,this.disposed_=!1,this.isComment=!0,this.id=r&&!e.getCommentById(r)?r:S(),e.addTopComment(this),this.xy_=new el(0,0),this.height_=n,this.width_=i,this.RTL=e.RTL,this.content_=t,nc.fireCreateEvent(this)}dispose(){this.disposed_||(L()&&I(new(j("comment_delete"))(this)),this.workspace.removeTopComment(this),this.disposed_=!0)}getHeight(){return this.height_}setHeight(e){this.height_=e}getWidth(){return this.width_}setWidth(e){this.width_=e}getRelativeToSurfaceXY(){return new el(this.xy_.x,this.xy_.y)}moveBy(e,t){const n=new(j(sa))(this);this.xy_.translate(e,t),n.recordNew(),I(n)}isDeletable(){return this.deletable&&!(this.workspace&&this.workspace.options.readOnly)}setDeletable(e){this.deletable=e}isMovable(){return this.movable&&!(this.workspace&&this.workspace.options.readOnly)}setMovable(e){this.movable=e}isEditable(){return this.editable&&!(this.workspace&&this.workspace.options.readOnly)}setEditable(e){this.editable=e}getContent(){return this.content_}setContent(e){this.content_!==e&&(I(new(j("comment_change"))(this,this.content_,e)),this.content_=e)}toXmlWithXY(e){return(e=this.toXml(e)).setAttribute("x",String(Math.round(this.xy_.x))),e.setAttribute("y",String(Math.round(this.xy_.y))),e.setAttribute("h",String(this.height_)),e.setAttribute("w",String(this.width_)),e}toXml(e){const t=Ms.createElement$$module$build$src$core$utils$xml("comment");return e||(t.id=this.id),t.textContent=this.getContent(),t}static fireCreateEvent(e){if(L()){const t=Ms.getGroup$$module$build$src$core$events$utils();t||Ms.setGroup$$module$build$src$core$events$utils(!0);try{I(new(j(oa))(e))}finally{Ms.setGroup$$module$build$src$core$events$utils(t)}}}static fromXml(e,t){var n=nc.parseAttributes(e);return t=new nc(t,n.content,n.h,n.w,n.id),n=e.getAttribute("x"),e=e.getAttribute("y"),n=n?parseInt(n,10):NaN,e=e?parseInt(e,10):NaN,isNaN(n)||isNaN(e)||t.moveBy(n,e),nc.fireCreateEvent(t),t}static parseAttributes(e){const t=e.getAttribute("h"),n=e.getAttribute("w"),i=e.getAttribute("x"),r=e.getAttribute("y"),o=e.getAttribute("id");if(!o)throw Error("No ID present in XML comment definition.");let s;return{id:o,h:t?parseInt(t):100,w:n?parseInt(n):100,x:i?parseInt(i):NaN,y:r?parseInt(r):NaN,content:null!=(s=e.textContent)?s:""}}},ic=class extends ya{constructor(e,t,n){super(n),this.type="selected",this.oldElementId=null!=e?e:void 0,this.newElementId=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new ic)).oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}};t($s.EVENT,"selected",ic);var rc={};rc.register=_t,rc.unregister=Et;var oc=class{paste(e,t,n){const i=e.commentState;if(n)i.setAttribute("x",`${n.x}`),i.setAttribute("y",`${n.y}`);else{var r;let e;n=parseInt(null!=(r=i.getAttribute("x"))?r:"0")+50,r=parseInt(null!=(e=i.getAttribute("y"))?e:"0")+50,i.setAttribute("x",`${n}`),i.setAttribute("y",`${r}`)}return sc.fromXmlRendered(e.commentState,t)}};oc.TYPE="workspace-comment",_t(oc.TYPE,new oc);var sc=class extends nc{constructor(e,t,n,i,r){super(e,t,n,i,r),this.onMouseMoveWrapper=this.onMouseUpWrapper=null,this.eventsInit=!1,this.deleteIconBorder=this.deleteGroup=this.resizeGroup=this.foreignObject=this.svgHandleTarget=this.svgRectTarget=this.textarea=null,this.rendered=this.autoLayout=this.focused=!1,this.svgGroup=ie(dl.G,{class:"blocklyComment"}),this.workspace=e,this.svgRect_=ie(dl.RECT,{class:"blocklyCommentRect",x:0,y:0,rx:3,ry:3}),this.svgGroup.appendChild(this.svgRect_),this.render()}dispose(){this.disposed_||(m()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),L()&&I(new(j("comment_delete"))(this)),le(this.svgGroup),Ms.disable$$module$build$src$core$events$utils(),super.dispose(),Ms.enable$$module$build$src$core$events$utils())}initSvg(e){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");this.workspace.options.readOnly||this.eventsInit||(z(this.svgRectTarget,"pointerdown",this,this.pathMouseDown),z(this.svgHandleTarget,"pointerdown",this,this.pathMouseDown)),this.eventsInit=!0,this.updateMovable(),this.getSvgRoot().parentNode||this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot()),!e&&this.textarea&&this.textarea.select()}pathMouseDown(e){const t=this.workspace.getGesture(e);t&&t.handleBubbleStart(e,this)}showContextMenu(e){throw Error("The implementation of showContextMenu should be monkey-patched in by blockly.ts")}select(){if(m()!==this){var e=null;if(m()){e=m().id,Ms.disable$$module$build$src$core$events$utils();try{m().unselect()}finally{Ms.enable$$module$build$src$core$events$utils()}}e=new(j("selected"))(e,this.id,this.workspace.id),I(e),b(this),this.addSelect()}}unselect(){if(m()===this){var e=new(j("selected"))(this.id,null,this.workspace.id);I(e),b(null),this.removeSelect(),this.blurFocus()}}addSelect(){re(this.svgGroup,"blocklySelected"),this.setFocus()}removeSelect(){re(this.svgGroup,"blocklySelected"),this.blurFocus()}addFocus(){re(this.svgGroup,"blocklyFocused")}removeFocus(){se(this.svgGroup,"blocklyFocused")}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,n=0,i=this.getSvgRoot();if(i)do{const e=Ce(i);t+=e.x,n+=e.y,i=i.parentNode}while(i&&!e.hasLayer(i)&&null!==i);return this.xy_=new el(t,n)}moveBy(e,t){const n=new(j(sa))(this),i=this.getRelativeToSurfaceXY();this.translate(i.x+e,i.y+t),this.xy_=new el(i.x+e,i.y+t),n.recordNew(),I(n),this.workspace.resizeContents()}translate(e,t){this.xy_=new el(e,t),this.getSvgRoot().setAttribute("transform","translate("+e+","+t+")")}moveDuringDrag(e){e=`translate(${e.x}, ${e.y})`,this.getSvgRoot().setAttribute("transform",e)}moveTo(e,t){this.translate(e,t)}clearTransformAttributes(){this.getSvgRoot().removeAttribute("transform")}getBoundingRectangle(){var e=this.getRelativeToSurfaceXY();const t=this.getHeightWidth(),n=e.y,i=e.y+t.height;let r;return this.RTL?(r=e.x-t.width,e=e.x):(r=e.x,e=e.x+t.width),new hl(n,i,r,e)}updateMovable(){this.isMovable()?re(this.svgGroup,"blocklyDraggable"):se(this.svgGroup,"blocklyDraggable")}setMovable(e){super.setMovable(e),this.updateMovable()}setEditable(e){super.setEditable(e),this.textarea&&(this.textarea.readOnly=!e)}setDragging(e){e?re(this.getSvgRoot(),"blocklyDragging"):se(this.getSvgRoot(),"blocklyDragging")}getSvgRoot(){return this.svgGroup}getContent(){return this.textarea?this.textarea.value:this.content_}setContent(e){super.setContent(e),this.textarea&&(this.textarea.value=e)}setDeleteStyle(e){e?re(this.svgGroup,"blocklyDraggingDelete"):se(this.svgGroup,"blocklyDraggingDelete")}setAutoLayout(e){}toXmlWithXY(e){let t=0;this.workspace.RTL&&(t=this.workspace.getWidth()),e=this.toXml(e);const n=this.getRelativeToSurfaceXY();return e.setAttribute("x",String(Math.round(this.workspace.RTL?t-n.x:n.x))),e.setAttribute("y",String(Math.round(n.y))),e.setAttribute("h",String(this.getHeight())),e.setAttribute("w",String(this.getWidth())),e}toCopyData(){return{paster:oc.TYPE,commentState:this.toXmlWithXY()}}getHeightWidth(){return{width:this.getWidth(),height:this.getHeight()}}render(){if(!this.rendered){var e=this.getHeightWidth(),t=this.createEditor();this.svgGroup.appendChild(t),this.svgHandleTarget=ie(dl.RECT,{class:"blocklyCommentHandleTarget",x:0,y:0}),this.svgGroup.appendChild(this.svgHandleTarget),this.svgRectTarget=ie(dl.RECT,{class:"blocklyCommentTarget",x:0,y:0,rx:3,ry:3}),this.svgGroup.appendChild(this.svgRectTarget),this.addResizeDom(),this.isDeletable()&&this.addDeleteDom(),this.setSize(e.width,e.height),this.textarea.value=this.content_,this.rendered=!0,this.resizeGroup&&z(this.resizeGroup,"pointerdown",this,this.resizeMouseDown),this.isDeletable()&&(z(this.deleteGroup,"pointerdown",this,this.deleteMouseDown),z(this.deleteGroup,"pointerout",this,this.deleteMouseOut),z(this.deleteGroup,"pointerup",this,this.deleteMouseUp))}}createEditor(){this.foreignObject=ie(dl.FOREIGNOBJECT,{x:0,y:sc.TOP_OFFSET,class:"blocklyCommentForeignObject"});const e=document.createElementNS(ol,"body");e.setAttribute("xmlns",ol),e.className="blocklyMinimalBody";const t=document.createElementNS(ol,"textarea");return t.className="blocklyCommentTextarea",t.setAttribute("dir",this.RTL?"RTL":"LTR"),t.readOnly=!this.isEditable(),e.appendChild(t),this.textarea=t,this.foreignObject.appendChild(e),z(t,"wheel",this,(function(e){e.stopPropagation()})),z(t,"change",this,(function(e){this.setContent(t.value)})),this.foreignObject}addResizeDom(){this.resizeGroup=ie(dl.G,{class:this.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.svgGroup),ie(dl.POLYGON,{points:"0,8 8,8 8,0"},this.resizeGroup),ie(dl.LINE,{class:"blocklyResizeLine",x1:8/3,y1:7,x2:7,y2:8/3},this.resizeGroup),ie(dl.LINE,{class:"blocklyResizeLine",x1:16/3,y1:7,x2:7,y2:16/3},this.resizeGroup)}addDeleteDom(){this.deleteGroup=ie(dl.G,{class:"blocklyCommentDeleteIcon"},this.svgGroup),this.deleteIconBorder=ie(dl.CIRCLE,{class:"blocklyDeleteIconShape",r:"7",cx:"7.5",cy:"7.5"},this.deleteGroup),ie(dl.LINE,{x1:"5",y1:"10",x2:"10",y2:"5",stroke:"#fff","stroke-width":"2"},this.deleteGroup),ie(dl.LINE,{x1:"5",y1:"5",x2:"10",y2:"10",stroke:"#fff","stroke-width":"2"},this.deleteGroup)}resizeMouseDown(e){this.unbindDragEvents(),Z(e)||(this.workspace.startDrag(e,new el(this.workspace.RTL?-this.width_:this.width_,this.height_)),this.onMouseUpWrapper=z(document,"pointerup",this,this.resizeMouseUp),this.onMouseMoveWrapper=z(document,"pointermove",this,this.resizeMouseMove),this.workspace.hideChaff()),e.stopPropagation()}deleteMouseDown(e){this.deleteIconBorder&&re(this.deleteIconBorder,"blocklyDeleteIconHighlighted"),e.stopPropagation()}deleteMouseOut(e){this.deleteIconBorder&&se(this.deleteIconBorder,"blocklyDeleteIconHighlighted")}deleteMouseUp(e){this.dispose(),e.stopPropagation()}unbindDragEvents(){this.onMouseUpWrapper&&(Y(this.onMouseUpWrapper),this.onMouseUpWrapper=null),this.onMouseMoveWrapper&&(Y(this.onMouseMoveWrapper),this.onMouseMoveWrapper=null)}resizeMouseUp(e){H(),this.unbindDragEvents()}resizeMouseMove(e){this.autoLayout=!1,e=this.workspace.moveDrag(e),this.setSize(this.RTL?-e.x:e.x,e.y)}resizeComment(){const e=this.getHeightWidth(),t=sc.TOP_OFFSET;let n,i;if(null==(n=this.foreignObject)||n.setAttribute("width",String(e.width)),null==(i=this.foreignObject)||i.setAttribute("height",String(e.height-t)),this.RTL){let t;null==(t=this.foreignObject)||t.setAttribute("x",String(-e.width))}this.textarea&&(this.textarea.style.width=e.width-4+"px",this.textarea.style.height=e.height-4-t+"px")}setSize(e,t){let n,i,r,o;if(e=Math.max(e,45),t=Math.max(t,20+sc.TOP_OFFSET),this.width_=e,this.height_=t,this.svgRect_.setAttribute("width",`${e}`),this.svgRect_.setAttribute("height",`${t}`),null==(n=this.svgRectTarget)||n.setAttribute("width",`${e}`),null==(i=this.svgRectTarget)||i.setAttribute("height",`${t}`),null==(r=this.svgHandleTarget)||r.setAttribute("width",`${e}`),null==(o=this.svgHandleTarget)||o.setAttribute("height",String(sc.TOP_OFFSET)),this.RTL){let e;this.svgRect_.setAttribute("transform","scale(-1 1)"),null==(e=this.svgRectTarget)||e.setAttribute("transform","scale(-1 1)")}if(this.resizeGroup)if(this.RTL){let n;this.resizeGroup.setAttribute("transform","translate("+(8-e)+","+(t-8)+") scale(-1 1)"),null==(n=this.deleteGroup)||n.setAttribute("transform","translate("+(8-e)+",-8) scale(-1 1)")}else{let n;this.resizeGroup.setAttribute("transform","translate("+(e-8)+","+(t-8)+")"),null==(n=this.deleteGroup)||n.setAttribute("transform","translate("+(e-8)+",-8)")}this.resizeComment()}setFocus(){this.focused=!0,setTimeout((()=>{this.disposed_||(this.textarea.focus(),this.addFocus(),this.svgRectTarget&&re(this.svgRectTarget,"blocklyCommentTargetFocused"),this.svgHandleTarget&&re(this.svgHandleTarget,"blocklyCommentHandleTargetFocused"))}),0)}blurFocus(){this.focused=!1,setTimeout((()=>{this.disposed_||(this.textarea.blur(),this.removeFocus(),this.svgRectTarget&&se(this.svgRectTarget,"blocklyCommentTargetFocused"),this.svgHandleTarget&&se(this.svgHandleTarget,"blocklyCommentHandleTargetFocused"))}),0)}static fromXmlRendered(e,t,n){let i;Ms.disable$$module$build$src$core$events$utils();try{const r=nc.parseAttributes(e);if(i=new sc(t,r.content,r.h,r.w,r.id),t.rendered&&(i.initSvg(!0),i.render()),!isNaN(r.x)&&!isNaN(r.y))if(t.RTL){const e=n||t.getWidth();i.moveBy(e-r.x,r.y)}else i.moveBy(r.x,r.y)}finally{Ms.enable$$module$build$src$core$events$utils()}return nc.fireCreateEvent(i),i}};sc.DEFAULT_SIZE=100,sc.TOP_OFFSET=10,ee("\n.blocklyCommentForeignObject {\n  position: relative;\n  z-index: 0;\n}\n\n.blocklyCommentRect {\n  fill: #E7DE8E;\n  stroke: #bcA903;\n  stroke-width: 1px;\n}\n\n.blocklyCommentTarget {\n  fill: transparent;\n  stroke: #bcA903;\n}\n\n.blocklyCommentTargetFocused {\n  fill: none;\n}\n\n.blocklyCommentHandleTarget {\n  fill: none;\n}\n\n.blocklyCommentHandleTargetFocused {\n  fill: transparent;\n}\n\n.blocklyFocused>.blocklyCommentRect {\n  fill: #B9B272;\n  stroke: #B9B272;\n}\n\n.blocklySelected>.blocklyCommentTarget {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCommentDeleteIcon {\n  cursor: pointer;\n  fill: #000;\n  display: none;\n}\n\n.blocklySelected > .blocklyCommentDeleteIcon {\n  display: block;\n}\n\n.blocklyDeleteIconShape {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1px;\n}\n\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\n  stroke: #fc3;\n}\n");var ac=new Set,lc=new WeakSet,cc=null,uc=null,dc=0,hc={};hc.finishQueuedRenders=xt,hc.queueRender=Tt,hc.triggerQueuedRenders=wt;var pc={};pc.appendDomToWorkspace=Ut,pc.blockToDom=Pt,pc.blockToDomWithXY=Dt,pc.clearWorkspaceAndLoadFromXml=$t,pc.deleteNext=en,pc.domToBlock=Ms.domToBlock$$module$build$src$core$xml,pc.domToBlockInternal=Ht,pc.domToPrettyText=Ft,pc.domToText=jt,pc.domToVariables=Gt,pc.domToWorkspace=Ms.domToWorkspace$$module$build$src$core$xml,pc.variablesToDom=Rt,pc.workspaceToDom=Nt;var fc=class extends Error{},gc=class extends fc{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},mc=class extends fc{constructor(e,t,n){super(`The block ${t.toDevString()} is missing a(n) ${e}\nconnection`),this.block=t,this.state=n}},bc=class extends fc{constructor(e,t,n,i){super(`The block ${n.toDevString()} could not connect its\n${t} to its parent, because: ${e}`),this.childBlock=n,this.childState=i}},yc=class extends fc{constructor(e){super("Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren"),this.state=e}},vc=class extends fc{constructor(e,t,n){super(`Cannot add an icon of type '${e}' to the block ${t.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=t,this.state=n}},_c={};_c.BadConnectionCheck=bc,_c.DeserializationError=fc,_c.MissingBlockType=gc,_c.MissingConnection=mc,_c.RealChildOfShadow=yc,_c.UnregisteredIcon=vc;var Ec={};Ec.register=rn,Ec.unregister=on;var Tc=class{constructor(){this.priority=50}save(e){const t=[];for(const n of e.getTopBlocks(!1))(e=sn(n,{addCoordinates:!0,doFullSerialization:!1}))&&t.push(e);return t.length?{languageVersion:0,blocks:t}:null}load(e,t){e=e.blocks;for(const n of e)gn(n,t,{recordUndo:A()})}clear(e){for(const t of e.getTopBlocks(!1))t.dispose(!1)}};rn("blocks",new Tc);var xc={};xc.BlockSerializer=Tc,xc.append=gn,xc.appendInternal=mn,xc.save=sn;var wc=class extends ba{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new wc)).blockId=e.blockId,t}},kc=class extends wc{constructor(e){super(e),this.type=Ms.CREATE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Dt(e),this.ids=P(e),this.json=sn(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=jt(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new kc)).xml=Ms.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!Sc(t,this.ids))if(e)gn(this.json,t);else for(e=0;e<this.ids.length;e++){const n=this.ids[e],i=t.getBlockById(n);i?i.dispose(!1):n===this.blockId&&console.warn("Can't uncreate non-existent block: "+n)}}},Sc=function(e,t){return t.map((t=>e.getBlockById(t))).filter((e=>e&&e.isShadow())).length===t.length};t($s.EVENT,Ms.CREATE$$module$build$src$core$events$utils,kc);var Cc=class extends ya{constructor(e,t){super(t),this.type="theme_change",this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Cc)).themeName=e.themeName,t}};t($s.EVENT,"theme_change",Cc);var Ac,Ic=class extends ya{constructor(e,t,n,i,r){super(i),this.type=ra,this.viewTop=e,this.viewLeft=t,this.scale=n,this.oldScale=r}toJson(){const e=super.toJson();if(void 0===this.viewTop)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.viewLeft)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.scale)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.oldScale)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Ic)).viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}};t($s.EVENT,ra,Ic),Ms.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:28,connectingSnapRadius:28,currentConnectionPreference:8,bumpDelay:250},Ms.config$$module$build$src$core$config,function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"}(Ac||(Ac={}));var Oc=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(e,t){if(!this.connections.length)return-1;const n=this.calculateIndexForYPos(t);if(n>=this.connections.length)return-1;t=e.y;let i=n;for(;0<=i&&this.connections[i].y===t;){if(this.connections[i]===e)return i;i--}for(i=n;i<this.connections.length&&this.connections[i].y===t;){if(this.connections[i]===e)return i;i++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,n=this.connections.length;for(;t<n;){const i=Math.floor((t+n)/2);if(this.connections[i].y<e)t=i+1;else{if(!(this.connections[i].y>e)){t=i;break}n=i}}return t}removeConnection(e,t){if(-1===(e=this.findIndexOfConnection(e,t)))throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,t){function n(e){const n=r-i[e].x,s=o-i[e].y;return Math.sqrt(n*n+s*s)<=t&&l.push(i[e]),s<t}const i=this.connections,r=e.x,o=e.y;e=0;let s=i.length-2,a=s;for(;e<a;)i[a].y<o?e=a:s=a,a=Math.floor((e+s)/2);const l=[];if(s=e=a,i.length){for(;0<=e&&n(e);)e--;do{s++}while(s<i.length&&n(s))}return l}isInYRange(e,t,n){return Math.abs(this.connections[e].y-t)<=n}searchForClosest(e,t,n){if(!this.connections.length)return{connection:null,radius:t};const i=e.y,r=e.x;e.x=r+n.x,e.y=i+n.y;var o=this.calculateIndexForYPos(e.y);n=null;let s,a=t,l=o-1;for(;0<=l&&this.isInYRange(l,e.y,t);)s=this.connections[l],this.connectionChecker.canConnect(e,s,!0,a)&&(n=s,a=s.distanceFrom(e)),l--;for(;o<this.connections.length&&this.isInYRange(o,e.y,t);)s=this.connections[o],this.connectionChecker.canConnect(e,s,!0,a)&&(n=s,a=s.distanceFrom(e)),o++;return e.x=r,e.y=i,{connection:n,radius:a}}static init(e){const t=[];return t[Ac.INPUT_VALUE]=new Oc(e),t[Ac.OUTPUT_VALUE]=new Oc(e),t[Ac.NEXT_STATEMENT]=new Oc(e),t[Ac.PREVIOUS_STATEMENT]=new Oc(e),t}},Nc=class{paste(e,t,n){if(!t.isCapacityAvailable(e.typeCounts))return null;let i;n&&(e.blockState.x=n.x,e.blockState.y=n.y),Ms.disable$$module$build$src$core$events$utils();try{i=gn(e.blockState,t),An(i)}finally{Ms.enable$$module$build$src$core$events$utils()}return i?(L()&&!i.isShadow()&&I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(i)),i.select(),i):i}};Nc.TYPE="block",_t(Nc.TYPE,new Nc);var Rc={};Rc.BlockPaster=Nc,Rc.moveBlockToNotConflict=An;var Dc=null,Lc=null,Mc={duplicateInternal:Pn,copyInternal:Rn},Pc={};Pc.BlockPaster=Nc,Pc.TEST_ONLY=Mc,Pc.copy=Nn,Pc.duplicate=Mn,Pc.paste=Dn,Pc.registry=rc;var Bc,jc,Fc="aria-",$c="role";!function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem"}(Bc||(Bc={})),function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin"}(jc||(jc={}));var Uc={};Uc.Role=Bc,Uc.State=jc,Uc.setRole=Bn,Uc.setState=jn;var Hc,Gc=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const t=document.createElement("div");t.className="blocklyMenu goog-menu blocklyNonSelectable",t.tabIndex=0,this.roleName&&Bn(t,this.roleName),this.element=t;for(let e,n=0;e=this.menuItems[n];n++)t.appendChild(e.createDom());return this.mouseOverHandler=z(t,"pointerover",this,this.handleMouseOver,!0),this.clickHandler=z(t,"pointerup",this,this.handleClick,!0),this.mouseEnterHandler=z(t,"pointerenter",this,this.handleMouseEnter,!0),this.mouseLeaveHandler=z(t,"pointerleave",this,this.handleMouseLeave,!0),this.onKeyDownHandler=z(t,"keydown",this,this.handleKeyEvent),e.appendChild(t),t}getElement(){return this.element}focus(){const e=this.getElement();e&&(e.focus({preventScroll:!0}),re(e,"blocklyFocused"))}blur(){const e=this.getElement();e&&(e.blur(),se(e,"blocklyFocused"))}setRole(e){this.roleName=e}dispose(){this.mouseOverHandler&&(Y(this.mouseOverHandler),this.mouseOverHandler=null),this.clickHandler&&(Y(this.clickHandler),this.clickHandler=null),this.mouseEnterHandler&&(Y(this.mouseEnterHandler),this.mouseEnterHandler=null),this.mouseLeaveHandler&&(Y(this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.onKeyDownHandler&&(Y(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e,t=0;e=this.menuItems[t];t++)e.dispose();this.element=null}getMenuItem(e){const t=this.getElement();for(;e&&e!==t;){if(e.classList.contains("blocklyMenuItem"))for(let t,n=0;t=this.menuItems[n];n++)if(t.getElement()===e)return t;e=e.parentElement}return null}setHighlighted(e){var t=this.highlightedItem;t&&(t.setHighlighted(!1),this.highlightedItem=null),e&&(e.setHighlighted(!0),this.highlightedItem=e,t=this.getElement(),ke(e.getElement(),t),jn(t,jc.ACTIVEDESCENDANT,e.getId()))}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){let n;for(e+=t;n=this.menuItems[e];){if(n.isEnabled()){this.setHighlighted(n);break}e+=t}}handleMouseOver(e){(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){const t=this.openingCoords;if(this.openingCoords=null,t&&"number"==typeof e.clientX){const n=new el(e.clientX,e.clientY);if(1>el.distance(t,n))return}(e=this.getMenuItem(e.target))&&e.performAction()}handleMouseEnter(e){this.focus()}handleMouseLeave(e){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),t=ye(e);return t.height=e.scrollHeight,t}},Vc=class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=k(),this.element=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const t=document.createElement("div");if(t.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var n=document.createElement("div");n.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",t.appendChild(n)}return n=this.content,"string"==typeof this.content&&(n=document.createTextNode(this.content)),t.appendChild(n),e.appendChild(t),this.roleName&&Bn(e,this.roleName),jn(e,jc.SELECTED,this.checkable&&this.checked||!1),jn(e,jc.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return null!=(e=this.opt_value)?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const t=this.getElement();t&&this.isEnabled()&&(e?(re(t,"blocklyMenuItemHighlight"),re(t,"goog-menuitem-highlight")):(se(t,"blocklyMenuItemHighlight"),se(t,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(e,t){this.actionHandler=e.bind(t)}},Wc=null,zc=null,qc="blocklyWidgetDiv",Yc="",Kc="",Zc={};Zc.createDom=Un,Zc.getDiv=Fn,Zc.hide=Gn,Zc.hideIfOwner=Wn,Zc.isVisible=Vn,Zc.positionWithAnchor=qn,Zc.repositionForWindowResize=Xn,Zc.show=Hn,Zc.testOnly_setDiv=$n;var Xc=null,Jc={},Qc=null,eu={};eu.callbackFactory=Ms.callbackFactory$$module$build$src$core$contextmenu,eu.commentDeleteOption=ai,eu.commentDuplicateOption=li,eu.dispose=si,eu.getCurrentBlock=Jn,eu.hide=oi,eu.setCurrentBlock=Qn,eu.show=ei,eu.workspaceCommentOption=ci;var tu=class{constructor(){this.registry_=new Map,this.reset()}reset(){this.registry_.clear()}register(e){if(this.registry_.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registry_.set(e.id,e)}unregister(e){if(!this.registry_.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registry_.delete(e)}getItem(e){let t;return null!=(t=this.registry_.get(e))?t:null}getContextMenuOptions(e,t){const n=[];for(const r of this.registry_.values())if(e===r.scopeType){var i=r.preconditionFn(t);"hidden"!==i&&(i={text:"function"==typeof r.displayText?r.displayText(t):r.displayText,enabled:"enabled"===i,callback:r.callback,scope:t,weight:r.weight},n.push(i))}return n.sort((function(e,t){return e.weight-t.weight})),n}};!function(e){var t=e.ScopeType||(e.ScopeType={});t.BLOCK="block",t.WORKSPACE="workspace",e.registry=new e}(tu||(tu={}));var nu=tu.ScopeType,iu={};iu.ContextMenuRegistry=tu,iu.ScopeType=nu;var ru={};ru.clamp=hi,ru.toDegrees=di,ru.toRadians=ui;var ou,su,au,lu=16,cu=1,uu=12,du=16,hu=.25,pu=null,fu=null,gu="",mu="",bu=null,yu=null,vu=null,_u={getBoundsInfo:function(){const e=Te(bu),t=ye(bu);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,n,i){const r=_u.getBoundsInfo(),o=ye(ou);return t+o.height<r.bottom?ki(e,t,r,o):i-o.height>r.top?Si(n,i,r,o):t+o.height<document.documentElement.clientHeight?ki(e,t,r,o):i-o.height>document.documentElement.clientTop?Si(n,i,r,o):Ci(e,r,o)}},Eu={ANIMATION_TIME:hu,ARROW_HORIZONTAL_PADDING:uu,ARROW_SIZE:lu,BORDER_SIZE:cu,PADDING_Y:du,TEST_ONLY:_u};Eu.clearContent=bi,Eu.createDom=pi,Eu.getContentDiv=mi,Eu.getOwner=gi,Eu.getPositionX=Ai,Eu.hide=Ni,Eu.hideIfOwner=Oi,Eu.hideWithoutAnimation=Ri,Eu.isVisible=Ii,Eu.repositionForWindowResize=Li,Eu.setBoundsElement=fi,Eu.setColour=yi,Eu.show=wi,Eu.showPositionedByBlock=vi,Eu.showPositionedByField=_i;var Tu=null,xu=null,wu={};wu.connectionUiEffect=Bi,wu.disconnectUiEffect=ji,wu.disconnectUiStop=$i,wu.disposeUiEffect=Mi;var ku=class{constructor(e,t){this.bubble=e,this.workspace=t,this.dragTarget_=null,this.wouldDeleteBubble_=!1,this.startXY_=this.bubble.getRelativeToSurfaceXY()}startBubbleDrag(){let e;Ms.getGroup$$module$build$src$core$events$utils()||Ms.setGroup$$module$build$src$core$events$utils(!0),this.workspace.setResizesEnabled(!1),this.bubble.setAutoLayout&&this.bubble.setAutoLayout(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}dragBubble(e,t){t=this.pixelsToWorkspaceUnits_(t),t=el.sum(this.startXY_,t),this.bubble.moveDuringDrag(t),t=this.dragTarget_,this.dragTarget_=this.workspace.getDragTarget(e),e=this.wouldDeleteBubble_,this.wouldDeleteBubble_=this.shouldDelete_(this.dragTarget_),e!==this.wouldDeleteBubble_&&this.updateCursorDuringBubbleDrag_(),this.dragTarget_!==t&&(t&&t.onDragExit(this.bubble),this.dragTarget_&&this.dragTarget_.onDragEnter(this.bubble)),this.dragTarget_&&this.dragTarget_.onDragOver(this.bubble)}shouldDelete_(e){return!(!e||!this.workspace.getComponentManager().hasCapability(e.id,Za.Capability.DELETE_AREA))&&e.wouldDelete(this.bubble,!1)}updateCursorDuringBubbleDrag_(){this.bubble.setDeleteStyle(this.wouldDeleteBubble_)}endBubbleDrag(e,t){if(this.dragBubble(e,t),this.dragTarget_&&this.dragTarget_.shouldPreventMove(this.bubble)?e=this.startXY_:(e=this.pixelsToWorkspaceUnits_(t),e=el.sum(this.startXY_,e)),this.bubble.moveTo(e.x,e.y),this.dragTarget_&&this.dragTarget_.onDrop(this.bubble),this.wouldDeleteBubble_)this.fireMoveEvent_(),this.bubble.dispose();else{if(this.bubble.setDragging){let e;this.bubble.setDragging(!1),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.bubble,100)}this.fireMoveEvent_()}this.workspace.setResizesEnabled(!0),Ms.setGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent_(){if(this.bubble instanceof sc){const e=new(j(sa))(this.bubble);e.setOldCoordinate(this.startXY_),e.recordNew(),I(e)}}pixelsToWorkspaceUnits_(e){return e=new el(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}},Su=[];Su[Ac.INPUT_VALUE]=Ac.OUTPUT_VALUE,Su[Ac.OUTPUT_VALUE]=Ac.INPUT_VALUE,Su[Ac.NEXT_STATEMENT]=Ac.PREVIOUS_STATEMENT,Su[Ac.PREVIOUS_STATEMENT]=Ac.NEXT_STATEMENT;var Cu={};Cu.commonWordPrefix=Gi,Cu.commonWordSuffix=Vi,Cu.isNumber=Ms.isNumber$$module$build$src$core$utils$string,Cu.shortestStringLength=Hi,Cu.startsWith=Ui,Cu.wrap=Ms.wrap$$module$build$src$core$utils$string;var Au=void 0,Iu=!1,Ou=!1,Nu=50,Ru=0,Du=0,Lu=0,Mu=0,Pu=null,Bu=null,ju=0,Fu=10,$u=10,Uu=750,Hu=5,Gu=null,Vu={HOVER_MS:Uu,LIMIT:Nu,MARGINS:Hu,OFFSET_X:ju,OFFSET_Y:Fu,RADIUS_OK:$u};Vu.bindMouseEvents=nr,Vu.block=cr,Vu.createDom=tr,Vu.dispose=ar,Vu.getCustomTooltip=Zi,Vu.getDiv=Ji,Vu.getTooltipOfObject=Qi,Vu.hide=lr,Vu.isVisible=Xi,Vu.setCustomTooltip=Ki,Vu.unbindMouseEvents=ir,Vu.unblock=ur;var Wu=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace.isMovableVertically(),this.startScrollXY_=new el(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){m()&&m().unselect()}endDrag(e){this.drag(e)}drag(e){if(e=el.sum(this.startScrollXY_,e),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(e.x,this.workspace.scrollY);else{if(!this.verticalScrollEnabled_)throw new TypeError("Invalid state.");this.workspace.scroll(this.workspace.scrollX,e.y)}}},zu=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new el(0,0),this.startWorkspace_=this.targetBlock=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.flyout=this.workspaceDragger=this.blockDragger=this.bubbleDragger=null,this.isMultiTouch_=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new el(0,0),this.healStack=!1}dispose(){H(),ur(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)Y(e);this.boundEvents.length=0,this.blockDragger&&this.blockDragger.dispose(),this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const t=new el(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(),U()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=el.difference(e,this.mouseDownXY),!this.hasExceededDragRadius&&(this.hasExceededDragRadius=el.magnitude(this.currentDragDeltaXY)>(this.flyout?Ms.config$$module$build$src$core$config.flyoutDragRadius:Ms.config$$module$build$src$core$config.dragRadius))}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||null==(e=this.flyout)||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error("Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined");return!(this.flyout.isScrollable()&&!this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)||(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),Ms.getGroup$$module$build$src$core$events$utils()||Ms.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),this.targetBlock.select(),0))}updateIsDraggingBubble(){return!!this.startBubble&&(this.startDraggingBubble(),!0)}updateIsDraggingBlock(){if(!this.targetBlock)return!1;if(this.flyout){if(this.updateIsDraggingFromFlyout())return this.startDraggingBlock(),!0}else if(this.targetBlock.isMovable())return this.startDraggingBlock(),!0;return!1}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.workspaceDragger=new Wu(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(){if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.updateIsDraggingBubble()||this.updateIsDraggingBlock()||this.updateIsDraggingWorkspace()}startDraggingBlock(){this.blockDragger=new(c($s.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(this.targetBlock,this.startWorkspace_),this.blockDragger.startDrag(this.currentDragDeltaXY,this.healStack),this.blockDragger.drag(this.mostRecentEvent,this.currentDragDeltaXY)}startDraggingBubble(){if(!this.startBubble)throw Error("Cannot update dragging the bubble because the start bubble is undefined");if(!this.startWorkspace_)throw Error("Cannot update dragging the bubble because the start workspace is undefined");this.bubbleDragger=new ku(this.startBubble,this.startWorkspace_),this.bubbleDragger.startBubbleDrag(),this.bubbleDragger.dragBubble(this.mostRecentEvent,this.currentDragDeltaXY)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,K(e)?this.cancel():(this.gestureHasStarted=!0,$i(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=gi(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,cr(),this.targetBlock&&this.targetBlock.select(),Z(e)?this.handleRightClick(e):("pointerdown"===e.type.toLowerCase()&&"mouse"!==e.pointerType&&$(e,this),this.mouseDownXY=new el(e.clientX,e.clientY),this.healStack=e.altKey||e.ctrlKey||e.metaKey,this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(z(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(z(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(z(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&U())}handleMove(e){this.isDragging()&&G(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.blockDragger?this.blockDragger.drag(this.mostRecentEvent,this.currentDragDeltaXY):this.bubbleDragger&&this.bubbleDragger.dragBubble(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),U())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!G(e))return;if(this.updateFromEvent(e),U(),this.isEnding_)return void console.log("Trying to end a gesture recursively.");this.isEnding_=!0,this.bubbleDragger?this.bubbleDragger.endBubbleDrag(e,this.currentDragDeltaXY):this.blockDragger?this.blockDragger.endDrag(e,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()?this.doBubbleClick():this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e)}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=V(e);this.cachedPoints.set(t,this.getTouchPoint(e));var n=Array.from(this.cachedPoints.keys());2===n.length&&(t=this.cachedPoints.get(n[0]),n=this.cachedPoints.get(n[1]),this.startDistance=el.distance(t,n),this.isMultiTouch_=!0,e.preventDefault())}handleTouchMove(e){const t=V(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&2===this.cachedPoints.size?this.handlePinch(e):this.handleMove(e)}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),n=this.cachedPoints.get(t[0]);if(t=this.cachedPoints.get(t[1]),n=el.distance(n,t)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(t=0<(t=n-this.previousScale)?5*t:6*t,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const i=this.startWorkspace_,r=X(e,i.getParentSvg(),i.getInverseScreenCTM());i.zoom(r.x,r.y,t)}this.previousScale=n,e.preventDefault()}handleTouchEnd(e){e=V(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new el(e.pageX,e.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(U(),this.bubbleDragger?this.bubbleDragger.endBubbleDrag(this.mostRecentEvent,this.currentDragDeltaXY):this.blockDragger?this.blockDragger.endDrag(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.doStart(e)}fireWorkspaceClick(e){I(new(j(na))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}doBubbleClick(){this.startBubble instanceof sc&&(this.startBubble.setFocus(),this.startBubble.select())}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");this.targetBlock.isEnabled()&&(Ms.getGroup$$module$build$src$core$events$utils()||Ms.setGroup$$module$build$src$core$events$utils(!0),this.flyout.createBlock(this.targetBlock).scheduleSnapAndBump())}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");const e=new(j(na))(this.startBlock,this.startWorkspace_.id,"block");I(e)}this.bringBlockToFront(),Ms.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){e=this.creatorWorkspace,m()&&m().unselect(),this.fireWorkspaceClick(this.startWorkspace_||e)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):this.targetBlock=e}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isBlockClick(){return!(!this.startBlock||this.hasExceededDragRadius||this.isFieldClick()||this.isIconClick())}isFieldClick(){return!!this.startField&&this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose))}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!(this.startBlock||this.startBubble||this.startField||this.hasExceededDragRadius)}isDragging(){return!!this.workspaceDragger||!!this.blockDragger||!!this.bubbleDragger}hasStarted(){return this.gestureHasStarted}getInsertionMarkers(){return this.blockDragger?this.blockDragger.getInsertionMarkers():[]}getCurrentDragger(){let e,t;return null!=(t=null!=(e=this.blockDragger)?e:this.workspaceDragger)?t:this.bubbleDragger}static inProgress(){const e=d();for(let t,n=0;t=e[n];n++)if(t.currentGesture_)return!0;return!1}},qu=class{constructor(e,t){let n,i,r;this.pattern=e,this.scale=1,this.spacing=null!=(n=t.spacing)?n:0,this.length=null!=(i=t.length)?i:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling,this.snapToGrid=null!=(r=t.snap)&&r}setSpacing(e){this.spacing=e,this.update(this.scale)}setLength(e){this.length=e,this.update(this.scale)}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getSpacing(){return this.spacing}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e;this.pattern.setAttribute("width",`${t}`),this.pattern.setAttribute("height",`${t}`);let n=(t=Math.floor(this.spacing/2)+.5)-this.length/2,i=t+this.length/2;t*=e,n*=e,i*=e,this.setLineAttributes(this.line1,e,n,i,t,t),this.setLineAttributes(this.line2,e,t,t,n,i)}setLineAttributes(e,t,n,i,r,o){e&&(e.setAttribute("stroke-width",`${t}`),e.setAttribute("x1",`${n}`),e.setAttribute("y1",`${r}`),e.setAttribute("x2",`${i}`),e.setAttribute("y2",`${o}`))}moveTo(e,t){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${t}`)}static createDom(e,t,n){let i,r;if(e=ie(dl.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},n),0<(null!=(i=t.length)?i:1)&&0<(null!=(r=t.spacing)?r:0)){let n;ie(dl.LINE,{stroke:t.colour},e),null!=(n=t.length)&&n&&ie(dl.LINE,{stroke:t.colour},e)}else ie(dl.LINE,{},e);return e}},Yu=class{constructor(e){this.workspace=e,this.cursorSvg_=this.cursor_=null,this.markers=new Map,this.markerSvg_=null}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),t.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,t)),this.setMarkerSvg(t.getDrawer().createDom()),this.markers.set(e,t)}unregisterMarker(e){const t=this.markers.get(e);if(!t)throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.");t.dispose(),this.markers.delete(e)}getCursor(){return this.cursor_}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=e)&&(e=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom()))}setCursorSvg(e){e?(this.workspace.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null}setMarkerSvg(e){e?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(e)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const e=Object.keys(this.markers);for(let t,n=0;t=e[n];n++)this.unregisterMarker(t);this.markers.clear(),this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};Yu.LOCAL_MARKER="local_marker_1";var Ku={};Ku.deepMerge=gr;var Zu=class{constructor(e,n,i,r){this.name=e,this.startHats=!1,this.blockStyles=n||Object.create(null),this.categoryStyles=i||Object.create(null),this.componentStyles=r||Object.create(null),this.fontStyle=Object.create(null),t($s.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(!(e=this.componentStyles[e]))return null;if("string"==typeof e){const t=this.getComponentStyle(e);if(t)return t}return`${e}`}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();const n=new Zu(e);let i=t.base;if(i){if("string"==typeof i){let e;i=null!=(e=a($s.THEME,i))?e:void 0}i instanceof Zu&&(gr(n,i),n.name=e)}return gr(n.blockStyles,t.blockStyles),gr(n.categoryStyles,t.categoryStyles),gr(n.componentStyles,t.componentStyles),gr(n.fontStyle,t.fontStyle),null!==t.startHats&&(n.startHats=t.startHats),n}},Xu=new Zu("classic",{colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},{colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}}),Ju=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,n=!1;var i=!1,r=!1,o=!1,s=!1,a=!1;const l=!!e.readOnly;var c;l||(t=Pe(null!=(c=e.toolbox)?c:null),n=Fe(t),i=void 0===(i=e.trashcan)?n:i,r=void 0===(r=e.collapse)?n:r,o=void 0===(o=e.comments)?n:o,s=void 0===(s=e.disable)?n:s,a=void 0===(a=e.sounds)||a),c=e.maxTrashcanContents,i?void 0===c&&(c=32):c=0;const u=!!e.rtl;let d=e.horizontalLayout;void 0===d&&(d=!1);var h="end"!==e.toolboxPosition;h=d?h?Al.TOP:Al.BOTTOM:h===u?Al.RIGHT:Al.LEFT;let p=e.css;void 0===p&&(p=!0);let f="https://blockly-demo.appspot.com/static/media/";e.media?f=e.media.endsWith("/")?e.media:e.media+"/":"path"in e&&(ne("path","Nov 2014","Jul 2023","media"),f=e.path+"media/");const g=e.oneBasedIndex,m=e.renderer||"geras",b=e.plugins||{};let y,v,_,E=e.modalInputs;void 0===E&&(E=!0),this.RTL=u,this.oneBasedIndex=void 0===g||g,this.collapse=r,this.comments=o,this.disable=s,this.readOnly=l,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=null!=(y=e.maxInstances)?y:null,this.modalInputs=E,this.pathToMedia=f,this.hasCategories=n,this.moveOptions=Ju.parseMoveOptions_(e,n),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=i,this.maxTrashcanContents=c,this.hasSounds=a,this.hasCss=p,this.horizontalLayout=d,this.languageTree=t,this.gridOptions=Ju.parseGridOptions_(e),this.zoomOptions=Ju.parseZoomOptions_(e),this.toolboxPosition=h,this.theme=Ju.parseThemeOptions_(e),this.renderer=m,this.rendererOverrides=null!=(v=e.rendererOverrides)?v:null,this.parentWorkspace=null!=(_=e.parentWorkspace)?_:null,this.plugins=b}static parseMoveOptions_(e,t){const n=e.move||{},i={};return void 0===n.scrollbars&&void 0===e.scrollbars?i.scrollbars=t:"object"==typeof n.scrollbars?(i.scrollbars={horizontal:!!n.scrollbars.horizontal,vertical:!!n.scrollbars.vertical},i.scrollbars.horizontal&&i.scrollbars.vertical?i.scrollbars=!0:i.scrollbars.horizontal||i.scrollbars.vertical||(i.scrollbars=!1)):i.scrollbars=!!n.scrollbars||!!e.scrollbars,i.wheel=i.scrollbars&&void 0!==n.wheel?!!n.wheel:"object"==typeof i.scrollbars,i.drag=!(!i.scrollbars||void 0!==n.drag&&!n.drag),i}static parseZoomOptions_(e){e=e.zoom||{};const t={};return t.controls=void 0!==e.controls&&!!e.controls,t.wheel=void 0!==e.wheel&&!!e.wheel,t.startScale=void 0===e.startScale?1:Number(e.startScale),t.maxScale=void 0===e.maxScale?3:Number(e.maxScale),t.minScale=void 0===e.minScale?.3:Number(e.minScale),t.scaleSpeed=void 0===e.scaleSpeed?1.2:Number(e.scaleSpeed),t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions_(e){e=e.grid||{};const t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=void 0===e.length?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions_(e){return"string"==typeof(e=e.theme||Xu)?a($s.THEME,e):e instanceof Zu?e:Zu.defineTheme(e.name||"builtin"+k(),e)}},Qu=class extends wc{constructor(e,t,n,i,r){super(e),this.type=Ms.CHANGE$$module$build$src$core$events$utils,e&&(this.element=t,this.name=n||void 0,this.oldValue=i,this.newValue=r)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Qu)).element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");var n=t.getIcon(Ul.MUTATOR);switch(n&&mr(n)&&n.bubbleIsVisible()&&n.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":t.setEnabled(!e);break;case"inline":t.setInputsInline(!!e);break;case"mutation":n=Qu.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation(Ms.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),I(new Qu(t,"mutation",null,n,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?jt(e):""}};t($s.EVENT,Ms.CHANGE$$module$build$src$core$events$utils,Qu);var ed=.45,td=.65,nd={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},id={};id.blend=kr,id.getHsvSaturation=br,id.getHsvValue=vr,id.hexToRgb=xr,id.hsvToHex=wr,id.hueToHex=Sr,id.names=nd,id.parse=Er,id.rgbToHex=Tr,id.setHsvSaturation=yr,id.setHsvValue=_r;var rd={};rd.checkMessageReferences=Or,rd.parseBlockColour=Nr,rd.replaceMessageReferences=Ir,rd.tokenizeInterpolation=Ar;var od=class{constructor(e,t,n){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new pl(0,0),e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){e.tooltip&&this.setTooltip(Ir(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=ie(dl.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=ie(dl.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=ie(dl.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");nr(e),this.mouseDownWrapper_=z(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return null!==(e=this.saveLegacyState(od))?e:this.getValue()}loadState(e){this.loadLegacyState(od,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?((e=Ms.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",this.name||""),Le(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml&&(this.fromXml(Ms.textToDom$$module$build$src$core$utils$xml(t)),!0)}dispose(){let e;Oi(this),Wn(this),null!=(e=this.getSourceBlock())&&e.isDeadOrDying()||le(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(re(e,"blocklyEditableText"),se(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(re(e,"blocklyNonEditableText"),se(e,"blocklyEditableText"),e.style.cursor=""))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==od.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var t=this.fieldGroup_;t&&(t.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const t=this.getConstants();let n=2*(e=void 0!==e?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING),i=t.FIELD_TEXT_HEIGHT,r=0;this.textElement_&&(n+=r=ge(this.textElement_,t.FIELD_TEXT_FONTSIZE,t.FIELD_TEXT_FONTWEIGHT,t.FIELD_TEXT_FONTFAMILY)),this.isFullBlockField()||(i=Math.max(i,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=i,this.size_.width=n,this.positionTextElement_(e,r),this.positionBorderRect_()}positionTextElement_(e,t){if(this.textElement_){var n,i=this.getConstants(),r=this.size_.height/2;this.textElement_.setAttribute("x",String(null!=(n=this.getSourceBlock())&&n.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(i.FIELD_TEXT_BASELINE_CENTER?r:r-i.FIELD_TEXT_HEIGHT/2+i.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0===this.size_.width&&(this.render_(),0!==this.size_.width&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new pl(0,0)}getScaledBBox(){let e;var t=this.getSourceBlock();if(!t)throw new sd;if(this.isFullBlockField()){var n=this.sourceBlock_.getHeightWidth();const i=t.workspace.scale;e=this.getAbsoluteXY_(),t=(n.width+1)*i,n=(n.height+1)*i,ja?(e.x+=1.5*i,e.y+=1.5*i):(e.x-=.5*i,e.y-=.5*i)}else n=this.borderRect_.getBoundingClientRect(),e=Te(this.borderRect_),t=n.width,n=n.height;return new hl(e.y,e.y+n,e.x,e.x+t)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+""),e=e.replace(/\s/g,od.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+=""),e):od.NBSP}getText(){const e=this.getText_();return String(null!==e?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.queueRender(),this.sourceBlock_.bumpNeighbours())}setValue(e,t=!0){if(null!==e){var n,i=this.doClassValidation_(e);(e=this.processValidation_(e,i))instanceof Error||(i=null==(n=this.getValidator())?void 0:n.call(this,e),(n=this.processValidation_(e,i))instanceof Error||(e=this.sourceBlock_)&&e.disposed||((i=this.getValue())===n?this.doValueUpdate_(n):(this.doValueUpdate_(n),t&&e&&L()&&I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(e,"field",this.name||null,i,n)),this.isDirty_&&this.forceRerender())))}}processValidation_(e,t){return null===t?(this.doValueInvalid_(e),this.isDirty_&&this.forceRerender(),Error()):void 0===t?e:t}getValue(){return this.value_}doClassValidation_(e){return null==e?null:e}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||""===e||(e=this.sourceBlock_);const t=this.getClickTarget_();t?t.tooltip=e:this.tooltip_=e}getTooltip(){const e=this.getClickTarget_();return Qi(e||{tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return Te(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const t=this.getSourceBlock();if(!t)throw new sd;const n=t.inputList;for(let i=0;i<t.inputList.length;i++){const t=n[i],r=t.fieldRow;for(let n=0;n<r.length;n++)if(r[n]===this){e=t;break}}return e}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(e){return!1}setCursorSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.cursorSvg_=e}else this.cursorSvg_=null}setMarkerSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.markerSvg_=e}else this.markerSvg_=null}updateMarkers_(){var e=this.getSourceBlock();if(!e)throw new sd;(e=e.workspace).keyboardAccessibilityMode&&this.cursorSvg_&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg_&&e.getMarker(Yu.LOCAL_MARKER).draw()}};od.NBSP="",od.SKIP_SETUP=Symbol("SKIP_SETUP");var sd=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},ad={};ad.Field=od,ad.UnattachedFieldError=sd,Ms.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.name:null:(console.warn("Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());"),null)}populateVariables(e){e=Ms.allUsedVarModels$$module$build$src$core$variables(e);for(let t=0;t<e.length;t++)this.getName(e[t].getId(),Ms.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let n=e;t===Ms.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(n=e),e=n.toLowerCase();const i=t===Ms.NameType$$module$build$src$core$names.VARIABLE||t===Ms.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(t)||this.db.set(t,new Map);const r=this.db.get(t);return r.has(e)?i+r.get(e):(t=this.getDistinctName(n,t),r.set(e,t.substr(i.length)),t)}getUserNames(e){let t;return(e=null==(t=this.db.get(e))?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let n,i,r,o=null;for(;this.dbReverse.has(e+(null!=(n=o)?n:""))||this.reservedWords.has(e+(null!=(i=o)?i:""));)o=o?o+1:2;return e+=null!=(r=o)?r:"",this.dbReverse.add(e),(t===Ms.NameType$$module$build$src$core$names.VARIABLE||t===Ms.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!=="0123456789".indexOf(e[0])&&(e="my_"+e)):e=Ms.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},function(e){(e=e.NameType||(e.NameType={})).DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}(Ms.Names$$module$build$src$core$names||(Ms.Names$$module$build$src$core$names={})),Ms.NameType$$module$build$src$core$names=Ms.Names$$module$build$src$core$names.NameType,Ms.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=Ms.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,{NameType:Ms.NameType$$module$build$src$core$names}.Names=Ms.Names$$module$build$src$core$names;var ld=class extends Map{constructor(){super()}set(e,t){return this.get(e)===t||(super.set(e,t),Dr(t)&&t.startPublishing()),this}delete(e){const t=this.get(e);return(e=super.delete(e))?(Dr(t)&&t.stopPublishing(),e):e}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},cd=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new el(0,0),this.workspaceLocation=new el(0,0),this.svgRoot=null,this.tooltip=e}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var t=this.sourceBlock;this.svgRoot=ie(dl.G,{class:"blocklyIconGroup"}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),z(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,nr(this.svgRoot)}}dispose(){ir(this.svgRoot),le(this.svgRoot)}getWeight(){return-1}getSize(){return new pl(0,0)}setTooltip(e){this.tooltip=null!=e?e:this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",mr(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;null==(e=this.svgRoot)||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=el.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}setVisible(e){ne("setVisible","v10","v11","setBubbleVisible"),mr(this)&&this.setBubbleVisible(e)}},ud={fromJsonInternal:Pr},dd={TEST_ONLY:ud};dd.fromJson=Ms.fromJson$$module$build$src$core$field_registry,dd.register=Lr,dd.unregister=Mr;var hd=class extends od{constructor(e,t,n){super(od.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==od.SKIP_SETUP&&(Array.isArray(e)?(Fr(e),e=Br(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],n&&this.configure_(n),this.setValue(this.selectedOption[1]),t&&this.setValidator(t))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(hd,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=ie(dl.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&re(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null!=(e=this.getSourceBlock())&&e.isShadow())}createTextArrow_(){let e,t;this.arrow=ie(dl.TSPAN,{},this.textElement_),this.arrow.appendChild(document.createTextNode(null!=(e=this.getSourceBlock())&&e.RTL?hd.ARROW_CHAR+" ":" "+hd.ARROW_CHAR)),null!=(t=this.getSourceBlock())&&t.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=ie(dl.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(sl,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new sd;this.dropdownCreate(),this.menu_.openingCoords=e&&"number"==typeof e.clientX?new el(e.clientX,e.clientY):null,bi(),e=this.menu_.render(mi()),re(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),yi(t,this.sourceBlock_.style.colourTertiary)),_i(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),ke(this.selectedMenuItem.getElement(),mi(),!0)),this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new sd;const t=new Gc;t.setRole(Bc.LISTBOX),this.menu_=t;const n=this.getOptions(!1);this.selectedMenuItem=null;for(let r=0;r<n.length;r++){const[o,s]=n[r];if("object"==typeof o){var i=new Image(o.width,o.height);i.src=o.src,i.alt=o.alt||""}else i=o;(i=new Vc(i,s)).setRole(Bc.OPTION),i.setRightToLeft(e.RTL),i.setCheckable(!0),t.addChild(i),i.setChecked(s===this.value_),s===this.value_&&(this.selectedMenuItem=i),i.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){Oi(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||(this.generatedOptions=this.menuGenerator_(),Fr(this.generatedOptions)),this.generatedOptions)}doClassValidation_(e){return this.getOptions(!0).some((t=>t[1]===e))?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let t,n=0;t=e[n];n++)t[1]===this.value_&&(this.selectedOption=t)}applyColour(){const e=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",e.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow&&(this.sourceBlock_.isShadow()?this.arrow.style.fill=e.colourSecondary:this.arrow.style.fill=e.colourPrimary)}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];e&&"object"==typeof e?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const t=this.getSourceBlock();if(!t)throw new sd;this.imageElement.style.display="",this.imageElement.setAttributeNS(sl,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const n=Number(e.height);e=Number(e.width);var i=!!this.borderRect_;const r=Math.max(i?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,n+pd);let o;i=i?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.svgArrow?this.positionSVGArrow(e+i,r/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):ge(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=e+o+2*i,this.size_.height=r;let s=0;t.RTL?this.imageElement.setAttribute("x",`${i+o}`):(s=e+o,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${i}`)),this.imageElement.setAttribute("y",String(r/2-n/2)),this.positionTextElement_(s+i,e+o)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();re(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var t=!!this.borderRect_;e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const n=ge(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let i=0;this.svgArrow&&(i=this.positionSVGArrow(n+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=n+i+2*t,this.size_.height=e,this.positionTextElement_(t,n)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const n=this.getSourceBlock();if(!n)throw new sd;const i=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,r=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(n.RTL?i:e+r)+","+t+")"),o+r}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];return"object"==typeof e?e.alt:e}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}};hd.CHECKMARK_OVERHANG=25,hd.MAX_MENU_HEIGHT_VH=.45,hd.ARROW_CHAR="";var pd=10;Lr("field_dropdown",hd);var fd,gd=class{constructor(e,t,n){this.workspace=e,this.anchor=t,this.ownerRect=n,this.size=new pl(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.svgRoot=ie(dl.G,{},e.getBubbleCanvas()),e=ie(dl.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=ie(dl.PATH,{},e),this.background=ie(dl.RECT,{class:"blocklyDraggable",x:0,y:0,rx:fd.BORDER_WIDTH,ry:fd.BORDER_WIDTH},e),this.contentContainer=ie(dl.G,{},this.svgRoot),z(this.background,"pointerdown",this,this.onMouseDown)}dispose(){le(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,fd.MIN_SIZE),e.height=Math.max(e.height,fd.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let t;null==(t=this.workspace.getGesture(e))||t.handleBubbleStart(e,this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new hl(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),n=this.getOptimalRelativeLeft(t),i=this.getOptimalRelativeTop(t);const r={x:n,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},o={x:-this.size.width-30,y:i};i={x:e.getWidth(),y:i};var s={x:n,y:e.getHeight()};n=e.getWidth()<e.getHeight()?i:s,e=e.getWidth()<e.getHeight()?s:i,i=this.getOverlap(r,t),s=this.getOverlap(o,t);const a=this.getOverlap(n,t);t=this.getOverlap(e,t),i===(t=Math.max(i,s,a,t))?(this.relativeLeft=r.x,this.relativeTop=r.y):s===t?(this.relativeLeft=o.x,this.relativeTop=o.y):a===t?(this.relativeLeft=n.x,this.relativeTop=n.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var n=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(n+this.size.width,t.left+t.width)-Math.max(n,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var n=this.anchor.x-t;n-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):n>e.right&&(t=-(e.right-this.anchor.x))}else{const i=(n=t+this.anchor.x)+this.size.width;n<e.left?t=e.left-this.anchor.x:i>e.right&&(t=e.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const n=this.anchor.y+t,i=n+this.size.height;return n<(e=this.getWorkspaceViewRect(e)).top?t=e.top-this.anchor.y:i>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let n=e.top+e.height,i=e.left;return e=e.left+e.width,n-=this.getScrollbarThickness(),this.workspace.RTL?i-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new hl(t,n,i,e)}getScrollbarThickness(){return vl.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var t=this.size.width/2,n=this.size.height/2,i=-this.relativeLeft,r=-this.relativeTop;if(t===i&&n===r)e.push("M "+t+","+n);else{r-=n,i-=t,this.workspace.RTL&&(i*=-1);var o=Math.sqrt(r*r+i*i),s=Math.acos(i/o);0>r&&(s=2*Math.PI-s);var a=s+Math.PI/2;a>2*Math.PI&&(a-=2*Math.PI);var l=Math.sin(a);const c=Math.cos(a);let u=(this.size.width+this.size.height)/fd.TAIL_THICKNESS;u=Math.min(u,this.size.width,this.size.height)/4,i=t+(a=1-fd.ANCHOR_RADIUS/o)*i,r=n+a*r,a=t+u*c;const d=n+u*l;t-=u*c,n-=u*l,(l=s+(l=ui(this.workspace.RTL?-fd.TAIL_ANGLE:fd.TAIL_ANGLE)))>2*Math.PI&&(l-=2*Math.PI),s=Math.sin(l)*o/fd.TAIL_BEND,o=Math.cos(l)*o/fd.TAIL_BEND,e.push("M"+a+","+d),e.push("C"+(a+o)+","+(d+s)+" "+i+","+r+" "+i+","+r),e.push("C"+i+","+r+" "+(t+o)+","+(n+s)+" "+t+","+n)}let c;e.push("z"),null==(c=this.tail)||c.setAttribute("d",e.join(" "))}bringToFront(){let e;const t=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==t?void 0:t.lastChild)===this.svgRoot||(null==t||t.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new el(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}};fd=gd,gd.BORDER_WIDTH=6,gd.DOUBLE_BORDER=2*fd.BORDER_WIDTH,gd.MIN_SIZE=fd.DOUBLE_BORDER,gd.TAIL_THICKNESS=1,gd.TAIL_ANGLE=20,gd.TAIL_BEND=4,gd.ANCHOR_RADIUS=8;var md=class extends gd{constructor(e,t,n,i){let r,o;super(t,n,i),this.workspace=t,this.anchor=n,this.ownerRect=i,this.autoLayout=!0,t=new Ju(e),this.validateWorkspaceOptions(t),this.svgDialog=ie(dl.SVG,{x:gd.BORDER_WIDTH,y:gd.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Ju(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(dl.G),this.miniWorkspace.getCanvas()),null==(e=this.miniWorkspace.getFlyout())||e.init(this.miniWorkspace),null==e||e.show(t.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this)),null==(r=this.miniWorkspace.getFlyout())||null==(o=r.getWorkspace())||o.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const t=e.getRelativeToSurfaceXY();if(20>t.y&&e.moveBy(0,20-t.y),e.RTL){let n=-20;const i=this.miniWorkspace.getFlyout();i&&(n-=i.getWidth()),t.x>n&&e.moveBy(n-t.x,0)}else 20>t.x&&e.moveBy(20-t.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),t=this.calculateWorkspaceSize();Math.abs(e.width-t.width)<md.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<md.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${t.width}px`),this.svgDialog.setAttribute("height",`${t.height}px`),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new pl(t.width+gd.DOUBLE_BORDER,t.height+gd.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+md.MARGIN;e=e.height+md.MARGIN;const n=this.miniWorkspace.getFlyout();if(n){const i=n.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,i.height+20),t+=n.getWidth()}return new pl(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let t;if(e=null==(t=this.miniWorkspace.getFlyout())?void 0:t.getWorkspace())for(const t of e.getAllBlocks(!1))t.setStyle(t.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};md.MINIMUM_VIEW_CHANGE=10,md.MARGIN=3*gd.DOUBLE_BORDER,Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends cd{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),ie(dl.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),ie(dl.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),ie(dl.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),re(this.svgRoot,"blockly-icon-mutator"))}dispose(){let e;super.dispose(),null==(e=this.miniWorkspaceBubble)||e.dispose()}getWeight(){return Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new pl(17,17)}applyColour(){let e,t;super.applyColour(),null==(e=this.miniWorkspaceBubble)||e.setColour(this.sourceBlock.style.colourPrimary),null==(t=this.miniWorkspaceBubble)||t.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.miniWorkspaceBubble)||t.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){if(this.bubbleIsVisible()!==e){if(e){let e;this.miniWorkspaceBubble=new md(this.getMiniWorkspaceConfig(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.applyColour(),this.createRootBlock(),this.addSaveConnectionsListener(),null==(e=this.miniWorkspaceBubble)||e.addWorkspaceChangeListener(this.createMiniWorkspaceChangeListener())}else{let e;null==(e=this.miniWorkspaceBubble)||e.dispose(),this.miniWorkspaceBubble=null,this.saveConnectionsListener&&this.sourceBlock.workspace.removeChangeListener(this.saveConnectionsListener),this.saveConnectionsListener=null}I(new(j(ia))(this.sourceBlock,e,"mutator"))}}getMiniWorkspaceConfig(){let e;const t={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:null!=(e=this.sourceBlock.workspace.options.rendererOverrides)?e:void 0};return this.flyoutBlockTypes.length&&(t.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map((e=>({kind:"block",type:e})))}),t}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new hl(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");for(var e of(this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace()),this.rootBlock.getDescendants(!1)))e.queueRender();let t,n,i,r;this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1),e=null!=(r=null==(t=this.miniWorkspaceBubble)||null==(n=t.getWorkspace())||null==(i=n.getFlyout())?void 0:i.getWidth())?r:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+16):16,16)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout((()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()}),0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||e.type===Ms.CREATE$$module$build$src$core$events$utils||e.type===Ms.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=Ms.getGroup$$module$build$src$core$events$utils();e||Ms.setGroup$$module$build$src$core$events$utils(!0);var t=Qu.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var n=Qu.getExtraBlockState_(this.sourceBlock);t!==n&&I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"mutation",null,t,n)),Ms.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return null==(e=this.miniWorkspaceBubble)?void 0:e.getWorkspace()}static reconnect(e,t,n){return ne("MutatorIcon.reconnect","v10","v11","connection.reconnect"),!!e&&e.reconnect(t,n)}static findParentWs(e){return ne("MutatorIcon.findParentWs","v10","v11","workspace.getRootWorkspace"),e.getRootWorkspace()}},Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=Ul.MUTATOR,Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon;var bd=Object.create(null),yd={allExtensions:bd};Ms.register$$module$build$src$core$extensions("parent_tooltip_when_inline",Qr);var vd,_d={TEST_ONLY:yd};_d.apply=Hr,_d.buildTooltipForDropdown=Ms.buildTooltipForDropdown$$module$build$src$core$extensions,_d.buildTooltipWithFieldText=Ms.buildTooltipWithFieldText$$module$build$src$core$extensions,_d.isRegistered=Ur,_d.register=Ms.register$$module$build$src$core$extensions,_d.registerMixin=Ms.registerMixin$$module$build$src$core$extensions,_d.registerMutator=Ms.registerMutator$$module$build$src$core$extensions,_d.runAfterPageLoad=Xr,_d.unregister=$r,function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"}(vd||(vd={}));var Ed={};Ed.arc=ao,Ed.curve=to,Ed.line=oo,Ed.lineOnAxis=so,Ed.lineTo=ro,Ed.moveBy=io,Ed.moveTo=no,Ed.point=eo;var Td={};Td.Coordinate=el,Td.KeyCodes=vd,Td.Rect=hl,Td.Size=pl,Td.Svg=dl,Td.aria=Uc,Td.array=Ya,Td.browserEvents=qa,Td.colour=id,Td.deprecation=nl,Td.dom=ul,Td.extensions=_d,Td.idGenerator=fa,Td.math=ru,Td.object=Ku,Td.parsing=rd,Td.string=Cu,Td.style=gl,Td.svgMath=yl,Td.svgPaths=Ed,Td.toolbox=Ml,Td.userAgent=Va,Td.xml=Cl;var xd={};xd.register=lo,xd.unregister=co;var wd=class extends gd{constructor(e,t,n,i){super(t,n,i),this.text=e,this.workspace=t,this.anchor=n,this.ownerRect=i,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(e){this.text=e,le(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createSpans(t,e),this.workspace.RTL&&this.rightAlignSpans(t.getBBox().width,e),t}createParagraph(e){return ie(dl.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:gd.BORDER_WIDTH},e)}createSpans(e,t){return t.split("\n").map((t=>{const n=ie(dl.TSPAN,{dy:"1em",x:gd.BORDER_WIDTH},e);return t=document.createTextNode(t),n.appendChild(t),n}))}rightAlignSpans(e,t){for(const n of t)n.setAttribute("text-anchor","end"),n.setAttribute("x",`${e+gd.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new pl(e.width+2*gd.BORDER_WIDTH,e.height+2*gd.BORDER_WIDTH),!0)}},kd=class extends gd{constructor(e,t,n){super(e,t,n),this.workspace=e,this.anchor=t,this.ownerRect=n,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new pl(160+gd.DOUBLE_BORDER,80+gd.DOUBLE_BORDER),this.MIN_SIZE=new pl(45+gd.DOUBLE_BORDER,20+gd.DOUBLE_BORDER),({inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer)),this.resizeGroup=this.createResizeHandle(this.svgRoot),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}createEditor(e){e=ie(dl.FOREIGNOBJECT,{x:gd.BORDER_WIDTH,y:gd.BORDER_WIDTH},e);const t=document.createElementNS(ol,"body");t.setAttribute("xmlns",ol),t.className="blocklyMinimalBody";const n=document.createElementNS(ol,"textarea");return n.className="blocklyCommentTextarea",n.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),t.appendChild(n),e.appendChild(t),this.bindTextAreaEvents(n),setTimeout((()=>{n.focus()}),0),{inputRoot:e,textArea:n}}bindTextAreaEvents(e){z(e,"wheel",this,(e=>{e.stopPropagation()})),z(e,"focus",this,this.onStartEdit,!0),z(e,"change",this,this.onTextChange)}createResizeHandle(e){e=ie(dl.G,{class:this.workspace.RTL?"blocklyResizeSW":"blocklyResizeSE"},e);const t=2*gd.BORDER_WIDTH;return ie(dl.POLYGON,{points:`0,${t} ${t},${t} ${t},0`},e),ie(dl.LINE,{class:"blocklyResizeLine",x1:t/3,y1:t-1,x2:t-1,y2:t/3},e),ie(dl.LINE,{class:"blocklyResizeLine",x1:2*t/3,y1:t-1,x2:t-1,y2:2*t/3},e),z(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const n=e.width-gd.DOUBLE_BORDER,i=e.height-gd.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${n}`),this.inputRoot.setAttribute("height",`${i}`),this.textArea.style.width=n-4+"px",this.textArea.style.height=i-4+"px",this.workspace.RTL?this.resizeGroup.setAttribute("transform",`translate(${gd.DOUBLE_BORDER}, ${i}) scale(-1 1)`):this.resizeGroup.setAttribute("transform",`translate(${n}, ${i})`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(e){this.bringToFront(),Z(e)||(this.workspace.startDrag(e,new el(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=z(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=z(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){H(),this.resizePointerUpListener&&(Y(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(Y(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new pl(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}};ee("\n.blocklyCommentTextarea {\n  background-color: #fef49c;\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n");var Sd=class extends cd{constructor(e){super(e),this.sourceBlock=e,this.textBubble=this.textInputBubble=null,this.text="",this.bubbleSize=new pl(160,80),this.bubbleVisiblity=!1}getType(){return Sd.TYPE}initView(e){this.svgRoot||(super.initView(e),ie(dl.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),ie(dl.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),ie(dl.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),re(this.svgRoot,"blockly-icon-comment"))}dispose(){let e,t;super.dispose(),null==(e=this.textInputBubble)||e.dispose(),null==(t=this.textBubble)||t.dispose()}getWeight(){return Sd.WEIGHT}getSize(){return new pl(17,17)}applyColour(){super.applyColour();const e=this.sourceBlock.style.colourPrimary;let t,n;null==(t=this.textInputBubble)||t.setColour(e),null==(n=this.textBubble)||n.setColour(e)}updateEditable(){super.updateEditable(),this.bubbleIsVisible()&&(this.setBubbleVisible(!1),this.setBubbleVisible(!0))}onLocationChange(e){let t,n;super.onLocationChange(e),e=this.getAnchorLocation(),null==(t=this.textInputBubble)||t.setAnchorLocation(e),null==(n=this.textBubble)||n.setAnchorLocation(e)}setText(e){const t=this.text;let n,i;I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,t,e)),this.text=e,null==(n=this.textInputBubble)||n.setText(this.text),null==(i=this.textBubble)||i.setText(this.text)}getText(){return this.text}setBubbleSize(e){let t;this.bubbleSize=e,null==(t=this.textInputBubble)||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){let t,n,i,r;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new pl(null!=(n=e.width)?n:160,null!=(i=e.height)?i:80),this.bubbleVisiblity=null!=(r=e.pinned)&&r,setTimeout((()=>this.setBubbleVisible(this.bubbleVisiblity)),1)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){e&&(this.textBubble||this.textInputBubble)||(e||this.textBubble||this.textInputBubble)&&(this.bubbleVisiblity=e,this.sourceBlock.rendered&&!this.sourceBlock.isInFlyout&&(e?(this.sourceBlock.isEditable()?this.showEditableBubble():this.showNonEditableBubble(),this.applyColour()):this.hideBubble(),I(new(j(ia))(this.sourceBlock,e,"comment"))))}showEditableBubble(){this.textInputBubble=new kd(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener((()=>this.onTextChange())),this.textInputBubble.addSizeChangeListener((()=>this.onSizeChange()))}showNonEditableBubble(){this.textBubble=new wd(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect())}hideBubble(){let e,t;null==(e=this.textInputBubble)||e.dispose(),this.textInputBubble=null,null==(t=this.textBubble)||t.dispose(),this.textBubble=null}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new hl(e.y,e.y+e.height,e.x,e.x+e.width)}};Sd.TYPE=Ul.COMMENT,Sd.WEIGHT=3,lo(Sd.TYPE,Sd);var Cd=class extends cd{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return Cd.TYPE}initView(e){this.svgRoot||(super.initView(e),ie(dl.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),ie(dl.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),ie(dl.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),re(this.svgRoot,"blockly-icon-warning"))}dispose(){let e;super.dispose(),null==(e=this.textBubble)||e.dispose()}getWeight(){return Cd.WEIGHT}getSize(){return new pl(17,17)}applyColour(){let e;super.applyColour(),null==(e=this.textBubble)||e.setColour(this.sourceBlock.style.colourPrimary)}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.textBubble)||t.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){if(this.textMap.get(t)===e)return this;let n;return e?this.textMap.set(t,e):this.textMap.delete(t),null==(n=this.textBubble)||n.setText(this.getText()),this}getText(){return[...this.textMap.values()].join("\n")}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){if(this.bubbleIsVisible()!==e){if(e)this.textBubble=new wd(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.applyColour();else{let e;null==(e=this.textBubble)||e.dispose(),this.textBubble=null}I(new(j(ia))(this.sourceBlock,e,"warning"))}}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new hl(e.y,e.y+e.height,e.x,e.x+e.width)}};Cd.TYPE=Ul.WARNING,Cd.WEIGHT=2;var Ad=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},Id={};Id.DuplicateIconType=Ad;var Od,Nd={};Nd.CommentIcon=Sd,Nd.Icon=cd,Nd.IconType=Ul,Nd.MutatorIcon=Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon,Nd.WarningIcon=Cd,Nd.exceptions=Id,Nd.registry=xd,Ms.DEFAULT_ARG$$module$build$src$core$procedures="x",(Od={CATEGORY_NAME:"PROCEDURE",DEFAULT_ARG:Ms.DEFAULT_ARG$$module$build$src$core$procedures}).ObservableProcedureMap=ld,Od.allProcedures=uo,Od.findLegalName=Ms.findLegalName$$module$build$src$core$procedures,Od.flyoutCategory=go,Od.getCallers=vo,Od.getDefinition=Ms.getDefinition$$module$build$src$core$procedures,Od.isNameUsed=fo,Od.isProcedureBlock=Rr,Od.mutateCallers=Ms.mutateCallers$$module$build$src$core$procedures,Od.mutatorOpenListener=bo,Od.rename=Ms.rename$$module$build$src$core$procedures;var Rd=new class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return e.type&this.FIELD}isHat(e){return e.type&this.HAT}isIcon(e){return e.type&this.ICON}isSpacer(e){return e.type&this.SPACER}isInRowSpacer(e){return e.type&this.IN_ROW_SPACER}isInput(e){return e.type&this.INPUT}isExternalInput(e){return e.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(e){return e.type&this.INLINE_INPUT}isStatementInput(e){return e.type&this.STATEMENT_INPUT}isPreviousConnection(e){return e.type&this.PREVIOUS_CONNECTION}isNextConnection(e){return e.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(e){return e.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(e){return e.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(e){return e.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(e){return e.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(e){return e.type&this.RIGHT_SQUARE_CORNER}isCorner(e){return e.type&this.CORNER}isJaggedEdge(e){return e.type&this.JAGGED_EDGE}isRow(e){return e.type&this.ROW}isBetweenRowSpacer(e){return e.type&this.BETWEEN_ROW_SPACER}isTopRow(e){return e.type&this.TOP_ROW}isBottomRow(e){return e.type&this.BOTTOM_ROW}isTopOrBottomRow(e){return e.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(e){return e.type&this.INPUT_ROW}},Dd=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=Rd.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},Ld=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=Rd.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Rd.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const t=this.elements[e];if(Rd.isSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(Rd.isSpacer(t))return t}return null}},Md=class extends Ld{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=Rd.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,n=0;for(let i=0;i<this.elements.length;i++){const r=this.elements[i];t+=r.width,Rd.isSpacer(r)||(Rd.isNextConnection(r)?n=Math.max(n,r.height):e=Math.max(e,r.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+n,this.descenderHeight=n,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},Pd=class extends Dd{constructor(e,t){super(e),this.connectionModel=t,this.type|=Rd.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},Bd=class extends Pd{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=Rd.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},jd=class extends Bd{constructor(e,t){super(e,t),this.height=0,this.type|=Rd.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Fd=class extends Dd{constructor(e,t,n){super(e),this.field=t,this.parentInput=n,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=Rd.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},$d=class extends Dd{constructor(e){super(e),this.type|=Rd.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},Ud=class extends Dd{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.isVisible=mr(t)&&t.bubbleIsVisible(),this.type|=Rd.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},Hd=class extends Dd{constructor(e,t){super(e),this.type=this.type|Rd.SPACER|Rd.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},Gd=class extends Bd{constructor(e,t){super(e,t),this.type|=Rd.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},Vd=class extends Bd{constructor(e,t){super(e,t),this.type|=Rd.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},Wd=class extends Ld{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=Rd.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let t=0;t<this.elements.length;t++){const n=this.elements[t];this.width+=n.width,Rd.isInput(n)&&n instanceof Bd&&(Rd.isStatementInput(n)&&n instanceof Vd?e+=n.connectedBlockWidth:Rd.isExternalInput(n)&&n instanceof jd&&0!==n.connectedBlockWidth&&(e+=n.connectedBlockWidth-n.connectionWidth)),Rd.isSpacer(n)||(this.height=Math.max(this.height,n.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},zd=class extends Dd{constructor(e){super(e),this.type|=Rd.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},qd=class extends Pd{constructor(e,t){super(e,t),this.type|=Rd.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},Yd=class extends Pd{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=Rd.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},Kd=class extends Pd{constructor(e,t){super(e,t),this.type|=Rd.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},Zd=class extends Dd{constructor(e,t){super(e),this.type=(t&&"left"!==t?Rd.RIGHT_ROUND_CORNER:Rd.LEFT_ROUND_CORNER)|Rd.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},Xd=class extends Ld{constructor(e,t,n){super(e),this.height=t,this.width=n,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|Rd.SPACER|Rd.BETWEEN_ROW_SPACER,this.elements=[new Hd(this.constants_,n)]}measure(){}},Jd=class extends Dd{constructor(e,t){super(e),this.type=(t&&"left"!==t?Rd.RIGHT_SQUARE_CORNER:Rd.LEFT_SQUARE_CORNER)|Rd.CORNER,this.width=this.height=this.constants_.NO_PADDING}},Qd=class extends Ld{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=Rd.TOP_ROW}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,n=e.getPreviousBlock();return!!e.outputConnection||t||!!n&&n.getNextBlock()===e}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,n=0;for(let i=0;i<this.elements.length;i++){const r=this.elements[i];t+=r.width,Rd.isSpacer(r)||(Rd.isHat(r)&&r instanceof $d?n=Math.max(n,r.ascenderHeight):e=Math.max(e,r.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+n,this.capline=this.ascenderHeight=n,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},eh=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=io(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const t=e.blockStyles;for(const e in t)this.blockStyles[e]=this.validatedBlockStyle_(t[e]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=void 0!==e.startHats?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=be("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&0===e.indexOf("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const t={};return e&&Object.assign(t,e),e=Nr(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?Nr(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?Nr(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return kr("#fff",e,.6)||e}generateTertiaryColour_(e){return kr("#fff",e,.3)||e}dispose(){this.embossFilter&&le(this.embossFilter),this.disabledPattern&&le(this.disabledPattern),this.debugFilter&&le(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH;return{height:e,width:t,path:oo([eo(t,e/4),eo(2*-t,e/2),eo(t,e/4)])}}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:to("c",[eo(30,-e),eo(70,-e),eo(t,0)])}}makePuzzleTab(){function e(e){const i=-(e=e?-1:1);var r=n/2;const o=r+2.5,s=r+.5,a=eo(-t,e*r);return r=eo(t,e*r),to("c",[eo(0,e*o),eo(-t,i*s),a])+to("s",[eo(t,2.5*i),r])}const t=this.TAB_WIDTH,n=this.TAB_HEIGHT,i=e(!0),r=e(!1);return{type:this.SHAPES.PUZZLE,width:t,height:n,pathDown:r,pathUp:i}}makeNotch(){function e(e){return oo([eo(e*i,n),eo(3*e,0),eo(e*i,-n)])}const t=this.NOTCH_WIDTH,n=this.NOTCH_HEIGHT,i=(t-3)/2,r=e(1),o=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:n,pathLeft:r,pathRight:o}}makeInsideCorners(){const e=this.CORNER_RADIUS;return{width:e,height:e,pathTop:ao("a","0 0,0",e,eo(-e,e)),pathBottom:ao("a","0 0,0",e,eo(e,e))}}makeOutsideCorners(){const e=this.CORNER_RADIUS,t=io(0,e)+ao("a","0 0,1",e,eo(e,-e)),n=ao("a","0 0,1",e,eo(e,e)),i=ao("a","0 0,1",e,eo(-e,-e));return{topLeft:t,topRight:n,bottomRight:ao("a","0 0,1",e,eo(-e,e)),bottomLeft:i,rightHeight:e}}shapeFor(e){switch(e.type){case Ac.INPUT_VALUE:case Ac.OUTPUT_VALUE:return this.PUZZLE_TAB;case Ac.PREVIOUS_STATEMENT:case Ac.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,n){this.injectCSS_(t,n),this.defs=ie(dl.DEFS,{},e),e=ie(dl.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),ie(dl.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=ie(dl.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),ie(dl.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),ie(dl.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),ie(dl.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=ie(dl.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),ie(dl.RECT,{width:10,height:10,fill:"#aaa"},e),ie(dl.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const e=ie(dl.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=ie(dl.FECOMPONENTTRANSFER,{result:"outBlur"},e);ie(dl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ie(dl.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),ie(dl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const n=t.join("\n");this.cssNode?this.cssNode.firstChild.textContent=n:((t=document.createElement("style")).id=e,e=document.createTextNode(n),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect,`,`${e} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},th={};th.ConstantProvider=eh,th.isDynamicShape=Eo,th.isNotch=xo,th.isPuzzleTab=To;var nh=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}hideHiddenIcons_(){ne("hideHiddenIcons_","v10","v11")}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=io(e.xPos,this.info_.startY);for(let e,n=0;e=t[n];n++)Rd.isLeftRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:Rd.isRightRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:Rd.isPreviousConnection(e)&&e instanceof Pd?this.outlinePath_+=e.shape.pathLeft:Rd.isHat(e)?this.outlinePath_+=this.constants_.START_HAT.path:Rd.isSpacer(e)&&(this.outlinePath_+=so("h",e.width));this.outlinePath_+=so("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+so("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const t=e.getLastInput();this.positionExternalValueConnection_(e);const n=Eo(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=so("H",t.xPos+t.width)+n+so("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t=e.getLastInput();if(t){var n=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+so("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var i=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=so("H",n)+t+so("v",i)+this.constants_.INSIDE_CORNERS.pathBottom+so("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=so("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,t=e.elements;this.positionNextConnection_();let n=0,i="";for(let r,o=t.length-1;r=t[o];o--)Rd.isNextConnection(r)&&r instanceof Pd?i+=r.shape.pathRight:Rd.isLeftSquareCorner(r)?i+=so("H",e.xPos):Rd.isLeftRoundedCorner(r)?i+=this.constants_.OUTSIDE_CORNERS.bottomLeft:Rd.isRightRoundedCorner(r)?(i+=this.constants_.OUTSIDE_CORNERS.bottomRight,n=this.constants_.OUTSIDE_CORNERS.rightHeight):Rd.isSpacer(r)&&(i+=so("h",-1*r.width));this.outlinePath_+=so("V",e.baseline-n),this.outlinePath_+=i}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const t=e.connectionOffsetY+e.height;e=Eo(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=so("V",t)+e}this.outlinePath_+="z"}drawInternals_(){for(let e,t=0;e=this.info_.rows[t];t++)for(let t,n=0;t=e.elements[n];n++)Rd.isInlineInput(t)?this.drawInlineInput_(t):(Rd.isIcon(t)||Rd.isField(t))&&this.layoutField_(t)}layoutField_(e){const t=e.centerline-e.height/2;let n=e.xPos;var i="";this.info_.RTL&&(n=-(n+e.width),e.flipRtl&&(n+=e.width,i="scale(-1 1)")),Rd.isIcon(e)?((i=e.icon).setOffsetInBlock(new el(n,t)),this.info_.isInsertionMarker&&i.hideForInsertionMarker()):((e=e.field.getSvgRoot()).setAttribute("transform","translate("+n+","+t+")"+i),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const t=e.width,n=e.height,i=e.connectionOffsetY,r=e.connectionHeight+i;this.inlinePath_+=no(e.xPos+e.connectionWidth,e.centerline-n/2)+so("v",i)+e.shape.pathDown+so("v",n-r)+so("h",t-e.connectionWidth)+so("v",-n)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let n=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(n*=-1),e.connectionModel.setOffsetInBlock(n,t+e.connectionOffsetY)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let n=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(n*=-1),t.connectionModel.setOffsetInBlock(n,e.yPos)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let n=e.xPos+e.width;this.info_.RTL&&(n*=-1),t.connectionModel.setOffsetInBlock(n,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,n=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-n:n,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const t of e.elements)if(t instanceof Pd)if(t.highlighted)this.drawConnectionHighlightPath(t);else{let e,n;null==(n=(e=this.block_.pathObject).removeConnectionHighlight)||n.call(e,t.connectionModel)}}drawConnectionHighlightPath(e){const t=e.connectionModel;e=t.type===Ac.INPUT_VALUE||t.type===Ac.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const n=t.getSourceBlock();let i,r;null==(r=(i=n.pathObject).addConnectionHighlight)||r.call(i,t,e,t.getOffsetInBlock(),n.RTL)}getExpressionConnectionHighlightPath(e){let t="";return Eo(e.shape)?t=e.shape.pathDown(e.height):To(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,io(0,-e)+so("v",e)+t+so("v",e)}getStatementConnectionHighlightPath(e){if(!xo(e.shape))throw Error("Statement connections should have notch shapes");const t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return io(-t,0)+so("h",t)+e.shape.pathLeft+so("h",t)}};!function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}(Ms.Align$$module$build$src$core$inputs$align||(Ms.Align$$module$build$src$core$inputs$align={})),Ms.Align$$module$build$src$core$inputs$align;var ih=class extends od{constructor(e,t,n){super(od.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==od.SKIP_SETUP&&(n?this.configure_(n):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&re(this.getTextElement(),this.class)}doClassValidation_(e){return null==e?null:`${e}`}setClass(e){this.textElement_&&(this.class&&se(this.textElement_,this.class),e&&re(this.textElement_,e)),this.class=e}static fromJson(e){return new this(Ir(e.text),void 0,e)}};Lr("field_label",ih),ih.prototype.DEFAULT_VALUE="";var rh=class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=Ms.Align$$module$build$src$core$inputs$input.LEFT,this.visible=!0,this.type=Ms.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,n){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return t||""===t&&n?("string"==typeof t&&(t=Ms.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t})),t.setSourceBlock(this.sourceBlock),this.sourceBlock.rendered&&(t.init(),t.applyColour()),t.name=n,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered&&(this.sourceBlock.queueRender(),this.sourceBlock.bumpNeighbours()),e):e}removeField(e,t){for(let t,n=0;t=this.fieldRow[n];n++)if(t.name===e)return t.dispose(),this.fieldRow.splice(n,1),this.sourceBlock.rendered&&(this.sourceBlock.queueRender(),this.sourceBlock.bumpNeighbours()),!0;if(t)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let t=[];if(this.visible===e)return t;this.visible=e;for(let t,n=0;t=this.fieldRow[n];n++)t.setVisible(e);if(this.connection){var n=this.connection;e?t=n.startTrackingAll():n.stopTrackingAll(),(n=n.targetBlock())&&(n.getSvgRoot().style.display=e?"block":"none")}return t}markDirty(){for(let e,t=0;e=this.fieldRow[t];t++)e.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){if(this.sourceBlock.workspace.rendered)for(let e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()}dispose(){for(let e,t=0;e=this.fieldRow[t];t++)e.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}};!function(e){(e=e.Align||(e.Align={}))[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}(rh||(rh={})),Ms.Align$$module$build$src$core$inputs$input=rh.Align,{Align:Ms.Align$$module$build$src$core$inputs$input}.Input=rh;var oh=class extends rh{constructor(e,t){super(e,t),this.name=e,this.type=Ms.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},sh=class extends rh{constructor(e,t){super(e,t),this.name=e,this.type=Ms.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},ah=class extends rh{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=Ms.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(Ac.NEXT_STATEMENT)}};Ms.ValueInput$$module$build$src$core$inputs$value_input=class extends rh{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=Ms.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(Ac.INPUT_VALUE)}},Ms.ValueInput$$module$build$src$core$inputs$value_input;var lh=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new Yd(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new Qd(this.constants_),this.bottomRow=new Md(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new Wd(this.constants_);this.inputRows.push(e);var t=this.block_.getIcons();for(let n,i=0;n=t[i];i++){const t=new Ud(this.constants_,n);this.isCollapsed&&!n.isShownWhenCollapsed()||e.elements.push(t)}t=void 0;for(let n,i=0;n=this.block_.inputList[i];i++)if(n.isVisible()){this.shouldStartNewRow_(n,t)&&(this.rows.push(e),e=new Wd(this.constants_),this.inputRows.push(e));for(let t,i=0;t=n.fieldRow[i];i++)e.elements.push(new Fd(this.constants_,t,n));this.addInput_(n,e),t=n}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new zd(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let n=this.topRow.hasLeftSquareCorner(this.block_)?Jd:Zd;this.topRow.elements.push(new n(this.constants_)),t?(e=new $d(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new Kd(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof ah&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,n=this.topRow.hasRightSquareCorner(this.block_)?Jd:Zd,this.topRow.elements.push(new n(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ah?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new Jd(this.constants_)):this.bottomRow.elements.push(new Zd(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new qd(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new Jd(this.constants_,"right")):this.bottomRow.elements.push(new Zd(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Gd(this.constants_,e)),t.hasInlineInput=!0):e instanceof ah?(t.elements.push(new Vd(this.constants_,e)),t.hasStatement=!0):e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new jd(this.constants_,e)),t.hasExternalInput=!0):(e instanceof oh||e instanceof sh)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),null===t.align&&(t.align=e.align)}shouldStartNewRow_(e,t){return!!t&&(t instanceof sh||e instanceof ah||t instanceof ah||(e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input||e instanceof oh||t instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input)&&!this.isInline)}addElemSpacing_(){for(let e,t=0;e=this.rows[t];t++){const t=e.elements;if(e.elements=[],e.startsWithElemSpacer()&&e.elements.push(new Hd(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let n=0;n<t.length-1;n++){e.elements.push(t[n]);const i=this.getInRowSpacing_(t[n],t[n+1]);e.elements.push(new Hd(this.constants_,i))}e.elements.push(t[t.length-1]),e.endsWithElemSpacer()&&e.elements.push(new Hd(this.constants_,this.getInRowSpacing_(t[t.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&Rd.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&Rd.isInput(e)&&!t){if(Rd.isExternalInput(e))return this.constants_.NO_PADDING;if(Rd.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Rd.isStatementInput(e))return this.constants_.NO_PADDING}return e&&Rd.isLeftSquareCorner(e)&&t&&(Rd.isPreviousConnection(t)||Rd.isNextConnection(t))?t.notchOffset:e&&Rd.isLeftRoundedCorner(e)&&t&&(Rd.isPreviousConnection(t)||Rd.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,t=0,n=0;for(let r,o=0;r=this.rows[o];o++){if(r.measure(),t=Math.max(t,r.width),r.hasStatement){var i=r.getLastInput();let t,n;i=r.width-(null!=(n=null==(t=i)?void 0:t.width)?n:0),e=Math.max(e,i)}n=Math.max(n,r.widthWithConnectedBlocks)}this.statementEdge=e,this.width=t;for(let e,t=0;e=this.rows[t];t++)e.hasStatement&&(e.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(t,n),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let t,n=0;t=this.rows[n];n++)if(t.hasStatement)this.alignStatementRow_(t);else{var e=t.width;0<(e=this.getDesiredRowWidth_(t)-e)&&this.addAlignmentPadding_(t,e),Rd.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){const n=e.getFirstSpacer(),i=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===Ms.Align$$module$build$src$core$inputs$align.LEFT&&i)i.width+=t;else if(e.align===Ms.Align$$module$build$src$core$inputs$align.CENTRE&&n&&i)n.width+=t/2,i.width+=t/2;else if(e.align===Ms.Align$$module$build$src$core$inputs$align.RIGHT&&n)n.width+=t;else{if(!i)return;i.width+=t}e.width+=t}alignStatementRow_(e){const t=e.getLastInput();if(t){var n=e.width-t.width,i=this.statementEdge;0<(n=i-n)&&this.addAlignmentPadding_(e,n),n=e.width,i=this.getDesiredRowWidth_(e),t.width+=i-n,t.height=Math.max(t.height,e.height),e.width+=i-n,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let t=0;t<e.length;t++)this.rows.push(e[t]),t!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}makeSpacerRow_(e,t){var n=this.getSpacerRowHeight_(e,t);const i=this.getSpacerRowWidth_(e,t);return n=new Xd(this.constants_,n,i),e.hasStatement&&(n.followsStatement=!0),t.hasStatement&&(n.precedesStatement=!0),n}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return Rd.isSpacer(t)?e.yPos+t.height/2:Rd.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,Rd.isNextConnection(t)?e+t.height/2:e-t.height/2):Rd.isTopRow(e)?Rd.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(e){let t=e.xPos;for(let n,i=0;n=e.elements[i];i++)Rd.isSpacer(n)&&(n.height=e.height),n.xPos=t,n.centerline=this.getElemCenterline_(e,n),t+=n.width}finalize_(){let e=0,t=0;for(let n,i=0;n=this.rows[i];i++)n.yPos=t,n.xPos=this.startX,t+=n.height,e=Math.max(e,n.widthWithConnectedBlocks),this.recordElemPositions_(n);if(this.outputConnection&&this.block_.nextConnection){const t=this.block_.nextConnection.targetBlock();t&&(e=Math.max(e,t.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline,this.bottomRow.baseline=t-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let t;if((null==(t=this.outputConnection)?void 0:t.connectionModel)===e)return this.outputConnection;for(const t of this.rows)for(const n of t.elements)if(n instanceof Pd&&n.connectionModel===e)return n;return null}},ch=class{constructor(e,t,n){if(this.wsCoordinate=null,!t)throw Error("Cannot create a node without a location.");this.type=e,this.isConnectionLocation=ch.isConnectionType(e),this.location=t,this.processParams(n||null)}processParams(e){e&&e.wsCoordinate&&(this.wsCoordinate=e.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var e=this.location.getParentInput();const t=e.getSourceBlock();for(e=t.inputList.indexOf(e),e+=1;e<t.inputList.length;e++){const n=t.inputList[e],i=n.fieldRow;for(let e=0;e<i.length;e++){const t=i[e];if(t.isClickable()||ch.NAVIGATE_ALL_FIELDS)return ch.createFieldNode(t)}if(n.connection)return ch.createInputNode(n)}return null}findNextForField(){var e=this.location,t=e.getParentInput();const n=e.getSourceBlock();if(!n)throw Error("The current AST location is not associated with a block");var i=n.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)+1;i<n.inputList.length;i++){const r=(t=n.inputList[i]).fieldRow;for(;e<r.length;){if(r[e].isClickable()||ch.NAVIGATE_ALL_FIELDS)return ch.createFieldNode(r[e]);e++}if(e=0,t.connection)return ch.createInputNode(t)}return null}findPrevForInput(){const e=this.location.getParentInput(),t=e.getSourceBlock();for(var n=t.inputList.indexOf(e);0<=n;n--){var i=t.inputList[n];if(i.connection&&i!==e)return ch.createInputNode(i);for(let e=(i=i.fieldRow).length-1;0<=e;e--){const t=i[e];if(t.isClickable()||ch.NAVIGATE_ALL_FIELDS)return ch.createFieldNode(t)}}return null}findPrevForField(){var e=this.location;const t=e.getParentInput(),n=e.getSourceBlock();if(!n)throw Error("The current AST location is not associated with a block");var i=n.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)-1;0<=i;i--){var r=n.inputList[i];if(r.connection&&r!==t)return ch.createInputNode(r);for(r=r.fieldRow;-1<e;){if(r[e].isClickable()||ch.NAVIGATE_ALL_FIELDS)return ch.createFieldNode(r[e]);e--}0<=i-1&&(e=n.inputList[i-1].fieldRow.length-1)}return null}navigateBetweenStacks(e){var t=this.getLocation();if(t.getSourceBlock){var n=t.getSourceBlock();n&&(t=n)}if(!t||t.isDeadOrDying())return null;n=t.getRootBlock(),t=n.workspace.getTopBlocks(!0);for(let i=0;i<t.length;i++)if(n.id===t[i].id)return-1===(e=i+(e?1:-1))||e===t.length?null:ch.createStackNode(t[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")}findTopASTNodeForBlock(e){const t=wo(e);return t?ch.createConnectionNode(t):ch.createBlockNode(e)}getOutAstNodeForBlock(e){if(!e)return null;e=e.getTopStackBlock();const t=wo(e);return t&&t.targetConnection&&t.targetConnection.getParentInput()?ch.createInputNode(t.targetConnection.getParentInput()):ch.createStackNode(e)}findFirstFieldOrInput(e){e=e.inputList;for(let t=0;t<e.length;t++){const n=e[t],i=n.fieldRow;for(let e=0;e<i.length;e++){const t=i[e];if(t.isClickable()||ch.NAVIGATE_ALL_FIELDS)return ch.createFieldNode(t)}if(n.connection)return ch.createInputNode(n)}return null}getSourceBlock(){return this.getType()===ch.types.BLOCK||this.getType()===ch.types.STACK?this.getLocation():this.getType()===ch.types.WORKSPACE?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case ch.types.STACK:return this.navigateBetweenStacks(!0);case ch.types.OUTPUT:return ch.createBlockNode(this.location.getSourceBlock());case ch.types.FIELD:return this.findNextForField();case ch.types.INPUT:return this.findNextForInput();case ch.types.BLOCK:const e=this.location.nextConnection;if(!e)break;return ch.createConnectionNode(e);case ch.types.PREVIOUS:return ch.createBlockNode(this.location.getSourceBlock());case ch.types.NEXT:return ch.createConnectionNode(this.location.targetConnection)}return null}in(){switch(this.type){case ch.types.WORKSPACE:const e=this.location.getTopBlocks(!0);if(0<e.length)return ch.createStackNode(e[0]);break;case ch.types.STACK:return this.findTopASTNodeForBlock(this.location);case ch.types.BLOCK:return this.findFirstFieldOrInput(this.location);case ch.types.INPUT:return ch.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case ch.types.STACK:return this.navigateBetweenStacks(!1);case ch.types.FIELD:return this.findPrevForField();case ch.types.INPUT:return this.findPrevForInput();case ch.types.BLOCK:var e=wo(this.location);if(!e)break;return ch.createConnectionNode(e);case ch.types.PREVIOUS:if((e=this.location.targetConnection)&&!e.getParentInput())return ch.createConnectionNode(e);break;case ch.types.NEXT:return ch.createBlockNode(this.location.getSourceBlock())}return null}out(){switch(this.type){case ch.types.STACK:var e=this.location,t=e.getRelativeToSurfaceXY();return t=new el(t.x,t.y+ch.DEFAULT_OFFSET_Y),ch.createWorkspaceNode(e.workspace,t);case ch.types.OUTPUT:return(t=(e=this.location).targetConnection)?ch.createConnectionNode(t):ch.createStackNode(e.getSourceBlock());case ch.types.FIELD:if(!(e=this.location.getSourceBlock()))throw Error("The current AST location is not associated with a block");return ch.createBlockNode(e);case ch.types.INPUT:return ch.createBlockNode(this.location.getSourceBlock());case ch.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case ch.types.PREVIOUS:case ch.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(e){switch(e){case ch.types.PREVIOUS:case ch.types.NEXT:case ch.types.INPUT:case ch.types.OUTPUT:return!0}return!1}static createFieldNode(e){return e?new ch(ch.types.FIELD,e):null}static createConnectionNode(e){if(!e)return null;const t=e.type;return t===Ac.INPUT_VALUE||t===Ac.NEXT_STATEMENT&&e.getParentInput()?ch.createInputNode(e.getParentInput()):t===Ac.NEXT_STATEMENT?new ch(ch.types.NEXT,e):t===Ac.OUTPUT_VALUE?new ch(ch.types.OUTPUT,e):t===Ac.PREVIOUS_STATEMENT?new ch(ch.types.PREVIOUS,e):null}static createInputNode(e){return e&&e.connection?new ch(ch.types.INPUT,e.connection):null}static createBlockNode(e){return e?new ch(ch.types.BLOCK,e):null}static createStackNode(e){return e?new ch(ch.types.STACK,e):null}static createWorkspaceNode(e,t){return t&&e?new ch(ch.types.WORKSPACE,e,{wsCoordinate:t}):null}static createTopNode(e){const t=wo(e);return t?ch.createConnectionNode(t):ch.createBlockNode(e)}};ch.NAVIGATE_ALL_FIELDS=!1,ch.DEFAULT_OFFSET_Y=-20,function(e){(e=e.types||(e.types={})).FIELD="field",e.BLOCK="block",e.INPUT="input",e.OUTPUT="output",e.NEXT="next",e.PREVIOUS="previous",e.STACK="stack",e.WORKSPACE="workspace"}(ch||(ch={}));var uh=class extends ya{constructor(e,t,n,i){let r=e?e.workspace.id:void 0;i&&i.getType()===ch.types.WORKSPACE&&(r=i.getLocation().id),super(r),this.type="marker_move",this.blockId=null==e?void 0:e.id,this.oldNode=n||void 0,this.newNode=i,this.isCursor=t}toJson(){const e=super.toJson();if(void 0===this.isCursor)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new uh)).isCursor=e.isCursor,t.blockId=e.blockId,t.oldNode=e.oldNode,t.newNode=e.newNode,t}};t($s.EVENT,"marker_move",uh);var dh=class{constructor(e,t,n){this.workspace=e,this.marker=n,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=t,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=n.colour||e}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return"cursor"===this.marker.type}createDom(){const e=this.isCursor()?"blocklyCursor":"blocklyMarker";return this.svgGroup_=ie(dl.G,{class:e}),this.createDomInternal_(),this.svgGroup_}setParent_(e){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent=e}draw(e,t){if(t){this.constants_=this.workspace.getRenderer().getConstants();var n=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||n,this.applyColour_(t),this.showAtLocation_(t),this.fireMarkerEvent(e,t),void 0!==(e=this.currentMarkerSvg.childNodes[0])&&e.beginElement&&e.beginElement()}else this.hide()}showAtLocation_(e){const t=e.getLocation().type;e.getType()===ch.types.BLOCK?this.showWithBlock_(e):e.getType()===ch.types.OUTPUT?this.showWithOutput_(e):t===Ac.INPUT_VALUE?this.showWithInput_(e):t===Ac.NEXT_STATEMENT?this.showWithNext_(e):e.getType()===ch.types.PREVIOUS?this.showWithPrevious_(e):e.getType()===ch.types.FIELD?this.showWithField_(e):e.getType()===ch.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()===ch.types.STACK&&this.showWithStack_(e)}showWithBlockPrevOutput(e){const t=(e=e.getSourceBlock()).width;var n=e.height,i=.75*n;const r=this.constants_.CURSOR_BLOCK_PADDING;e.previousConnection?(n=this.constants_.shapeFor(e.previousConnection),this.positionPrevious_(t,r,i,n)):e.outputConnection?(i=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(t,n,i)):this.positionBlock_(t,r,i),this.setParent_(e),this.showCurrent_()}showWithBlock_(e){this.showWithBlockPrevOutput(e)}showWithPrevious_(e){this.showWithBlockPrevOutput(e)}showWithOutput_(e){this.showWithBlockPrevOutput(e)}showWithCoordinates_(e){var t=e.getWsCoordinate();e=t.x,t=t.y,this.workspace.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,t,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(e){const t=(e=e.getLocation()).getSize().width,n=e.getSize().height;this.positionRect_(0,0,t,n),this.setParent_(e),this.showCurrent_()}showWithInput_(e){const t=(e=e.getLocation()).getSourceBlock();this.positionInput_(e),this.setParent_(t),this.showCurrent_()}showWithNext_(e){var t=e.getLocation();e=t.getSourceBlock();let n=0;t=t.getOffsetInBlock().y;const i=e.getHeightWidth().width;this.workspace.RTL&&(n=-i),this.positionLine_(n,t,i),this.setParent_(e),this.showCurrent_()}showWithStack_(e){var t=(e=e.getLocation()).getHeightWidth();const n=t.width+this.constants_.CURSOR_STACK_PADDING;t=t.height+this.constants_.CURSOR_STACK_PADDING;const i=-this.constants_.CURSOR_STACK_PADDING/2,r=-this.constants_.CURSOR_STACK_PADDING/2;let o=i;this.workspace.RTL&&(o=-(n+i)),this.positionRect_(o,r,n,t),this.setParent_(e),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(e,t,n){if(e=io(-t,n)+so("V",-t)+so("H",e+2*t)+so("V",n),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(e){const t=e.getOffsetInBlock().x,n=e.getOffsetInBlock().y;e=no(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+t+","+n+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(e,t,n){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${e}`),this.markerSvgLine_.setAttribute("y",`${t}`),this.markerSvgLine_.setAttribute("width",`${n}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(e,t,n){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");e=io(e,0)+so("h",-(e-n.width))+so("v",this.constants_.TAB_OFFSET_FROM_TOP)+n.pathDown+so("V",t)+so("H",e),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(e,t,n,i){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");e=io(-t,n)+so("V",-t)+so("H",this.constants_.NOTCH_OFFSET_LEFT)+i.pathLeft+so("H",e+2*t)+so("V",n),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(e,t,n,i){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${e}`),this.markerSvgRect_.setAttribute("y",`${t}`),this.markerSvgRect_.setAttribute("width",`${n}`),this.markerSvgRect_.setAttribute("height",`${i}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(e){e.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(e,t){const n=t.getSourceBlock();e=new(j("marker_move"))(n,this.isCursor(),e,t),I(e)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=ie(dl.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=ie(dl.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=ie(dl.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=ie(dl.PATH,{transform:""},this.markerSvg_),this.markerBlock_=ie(dl.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();ie(dl.ANIMATE,e,this.markerSvgLine_),ie(dl.ANIMATE,e,this.markerInput_),ie(dl.ANIMATE,Object.assign({},e,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(e){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",e),this.markerInput_.firstElementChild.setAttribute("values",e),this.markerBlock_.firstElementChild.setAttribute("values",e))}dispose(){this.svgGroup_&&le(this.svgGroup_)}},hh=class{constructor(e,t,n){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=n,this.style=t,this.svgRoot=e,this.svgPath=ie(dl.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?re(this.svgRoot,e):se(this.svgRoot,e))}updateHighlighted(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,n,i){if(this.connectionHighlights.has(e)){if(this.currentHighlightMatchesNew(e,t,n))return;this.removeConnectionHighlight(e)}t=ie(dl.PATH,{class:"blocklyHighlightedConnectionPath",d:t,transform:`translate(${n.x}, ${n.y})`+(i?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(e,t)}currentHighlightMatchesNew(e,t,n){let i;const r=null==(i=this.connectionHighlights.get(e))?void 0:i.getAttribute("d");return e=this.highlightOffsets.get(e),r===t&&el.equals(e,n)}removeConnectionHighlight(e){const t=this.connectionHighlights.get(e);t&&(le(t),this.connectionHighlights.delete(e))}},ph=class{constructor(e,t){this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e}connect_(e){const t=Ac.INPUT_VALUE,n=this.getSourceBlock();var i=e.getSourceBlock();let r,o;if(e.isConnected()&&e.disconnectInternal(!1),this.isConnected()){const e=this.stashShadowState(),t=this.targetBlock();t.isShadow()?t.dispose(!1):(this.disconnectInternal(),r=t),this.applyShadowState(e)}L()&&(o=new(j(Ms.MOVE$$module$build$src$core$events$utils))(i)).setReason(["connect"]),ko(this,e),i.setParent(n),o&&(o.recordNew(),I(o)),r&&(e=this.type===t?r.outputConnection:r.previousConnection)&&((i=ph.getConnectionForOrphanedConnection(i,e))?e.connect(i):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===Ac.INPUT_VALUE||this.type===Ac.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const t=Ms.getGroup$$module$build$src$core$events$utils();t||Ms.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),Ms.setGroup$$module$build$src$core$events$utils(t)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:t,childConnection:n}=this.getParentAndChildConnections();if(!t||!n)throw Error("Source connection not connected.");const i=Ms.getGroup$$module$build$src$core$events$utils();let r;i||Ms.setGroup$$module$build$src$core$events$utils(!0),L()&&(r=new(j(Ms.MOVE$$module$build$src$core$events$utils))(n.getSourceBlock())).setReason(["disconnect"]);const o=this.targetConnection;o&&(o.targetConnection=null),this.targetConnection=null,e&&n.getSourceBlock().setParent(null),r&&(r.recordNew(),I(r)),n.getSourceBlock().isShadow()||t.respawnShadow_(),Ms.setGroup$$module$build$src$core$events$utils(i)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){return!(this.getSourceBlock().isDeadOrDying()||(t=null==(n=e.getInput(t))?void 0:n.connection,(n=this.targetBlock())&&n!==e||!t||t.targetConnection===this||(t.isConnected()&&t.disconnect(),t.connect(this),0)));var n}targetBlock(){if(this.isConnected()){let e,t;return null!=(t=null==(e=this.targetConnection)?void 0:e.getSourceBlock())?t:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Pt(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?sn(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const t=this.sourceBlock_.inputList;for(let n=0;n<t.length;n++)if(t[n].connection===this){e=t[n];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var t="Output Connection of ";else if(e.previousConnection===this)t="Previous Connection of ";else if(e.nextConnection===this)t="Next Connection of ";else{t=null;for(let n,i=0;n=e.inputList[i];i++)if(n.connection===this){t=n;break}if(!t)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";t='Input "'+t.name+'" connection on '}return t+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,(e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.getSourceBlock().isDeadOrDying()||(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock()))):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock()))}createShadowBlock(e){var t=this.getSourceBlock();const n=this.getShadowState(),i=this.getShadowDom();if(t.isDeadOrDying()||!n&&!i)return null;if(n)return mn(n,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(i){if(t=Ht(i,t.workspace),e)if(this.type===Ac.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else{if(this.type!==Ac.NEXT_STATEMENT)throw Error("Cannot connect a shadow block to a previous/output connection");if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}return t}return null}serializeShadow(e){e&&(this.shadowDom=Pt(e),this.shadowState=sn(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===Ac.OUTPUT_VALUE)return Co(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);const n=t.getConnectionChecker();return e&&n.canConnect(t,e,!1)?e:null}};ph.CAN_CONNECT=0,ph.REASON_SELF_CONNECTION=1,ph.REASON_WRONG_TYPE=2,ph.REASON_TARGET_NULL=3,ph.REASON_CHECKS_FAILED=4,ph.REASON_DIFFERENT_WORKSPACES=5,ph.REASON_SHADOW_PARENT=6,ph.REASON_DRAG_CHECKS_FAILED=7,ph.REASON_PREVIOUS_AND_OUTPUT=8;var fh=class{constructor(e){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,b(e),this.topBlock=e,this.workspace=e.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){Ms.disable$$module$build$src$core$events$utils(),this.hidePreview(),Ms.enable$$module$build$src$core$events$utils();var{local:e,closest:t}=this.activeCandidate;if(e.connect(t),this.topBlock.rendered){const n=e.isSuperior()?t:e,i=this.topBlock.getRootBlock();xt().then((()=>{Bi(n.getSourceBlock()),setTimeout((()=>{i.bringToFront()}),0)}))}}}update(e,t){const n=this.getCandidate(e);((this.wouldDeleteBlock=this.shouldDelete(!!n,t))||this.shouldUpdatePreviews(n,e))&&(Ms.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(n),this.maybeShowPreview(n),Ms.enable$$module$build$src$core$events$utils())}createMarkerBlock(e){var t=e.type;let n;Ms.disable$$module$build$src$core$events$utils();try{if((n=this.workspace.newBlock(t)).setInsertionMarker(!0),e.saveExtraState){var i=e.saveExtraState(!0);i&&n.loadExtraState&&n.loadExtraState(i)}else if(e.mutationToDom){const t=e.mutationToDom();t&&n.domToMutation&&n.domToMutation(t)}for(t=0;t<e.inputList.length;t++){const r=e.inputList[t];if("_TEMP_COLLAPSED_INPUT"===r.name)continue;const o=n.inputList[t];if(!o)throw Error("The insertion marker manager tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","an input"));for(i=0;i<r.fieldRow.length;i++){const e=r.fieldRow[i],t=o.fieldRow[i];if(!t)throw Error("The insertion marker manager tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","a field"));t.setValue(e.getValue())}}for(const e of n.getDescendants(!1))e.setInsertionMarker(!0);n.setCollapsed(e.isCollapsed()),n.setInputsInline(e.getInputsInline()),n.initSvg(),n.getSvgRoot().setAttribute("visibility","hidden")}finally{Ms.enable$$module$build$src$core$events$utils()}return n}initAvailableConnections(){const e=this.topBlock.getConnections_(!1),t=this.topBlock.lastConnectionInStack(!0);return t&&t!==this.topBlock.nextConnection&&(e.push(t),this.lastOnStack=t),e}shouldUpdatePreviews(e,t){if(!e)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:n,closest:i}=this.activeCandidate;if(i===e.closest&&n===e.local)return!1;const r=n.x+t.x-i.x;return t=n.y+t.y-i.y,e.radius<Math.sqrt(r*r+t*t)-Ms.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(e){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let t=this.getStartRadius(),n=null;for(let i=0;i<this.availableConnections.length;i++){const r=this.availableConnections[i],o=r.closest(t,e);o.connection&&(n={closest:o.connection,local:r,radius:o.radius},t=o.radius)}return n}getStartRadius(){return this.activeCandidate?Ms.config$$module$build$src$core$config.connectingSnapRadius:Ms.config$$module$build$src$core$config.snapRadius}shouldDelete(e,t){return!(!t||!this.workspace.getComponentManager().hasCapability(t.id,Za.Capability.DELETE_AREA))&&t.wouldDelete(this.topBlock,e)}maybeShowPreview(e){if(!this.wouldDeleteBlock&&e){var t,n=e.closest;n===(null==(t=this.activeCandidate)?void 0:t.closest)||n.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=e,this.showPreview(this.activeCandidate))}}showPreview(e){const t=this.workspace.getRenderer();switch(t.getConnectionPreviewMethod(e.closest,e.local,this.topBlock)){case fh.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(e);break;case fh.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(e);break;case fh.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(e)}t.shouldHighlightConnection(e.closest)&&e.closest.highlight()}maybeHidePreview(e){if(e){if(this.activeCandidate){const t=this.activeCandidate.local!==e.local;(this.activeCandidate.closest!==e.closest||t||this.wouldDeleteBlock)&&this.hidePreview()}}else this.hidePreview();this.activeCandidate=this.markerConnection=null}hidePreview(){let e;const t=null==(e=this.activeCandidate)?void 0:e.closest;t&&t.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(t)&&t.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(e){const{local:t,closest:n}=e;let i,r=(e=this.lastOnStack&&t===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!r)throw Error("Cannot show the insertion marker because there is no insertion marker block");try{i=r.getMatchingConnection(t.getSourceBlock(),t)}catch(n){if(e&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),r=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),r=this.firstMarker=this.createMarkerBlock(this.topBlock)),!r)throw Error("Cannot show the insertion marker because there is no insertion marker block");i=r.getMatchingConnection(t.getSourceBlock(),t)}if(!i)throw Error("Cannot show the insertion marker because there is no associated connection");if(i===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");r.queueRender(),wt(),i.connect(n);const o={x:n.x-i.x,y:n.y-i.y},s=i.getOffsetInBlock().clone(),a=i;xt().then((()=>{let e,t;null==(e=r)||e.positionNearConnection(a,o,s),null==(t=r)||t.getSvgRoot().setAttribute("visibility","visible")})),this.markerConnection=i}hideInsertionMarker(){if(this.markerConnection){var e,t=this.markerConnection,n=t.getSourceBlock(),i=n.outputConnection;if(null!=(e=n.previousConnection)&&e.targetConnection||null!=i&&i.targetConnection)n.unplug(!0);else{let e;null==(e=t.targetBlock())||e.unplug(!1)}if(t.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(t=n.getSvgRoot())&&t.setAttribute("visibility","hidden")}}showInsertionInputOutline(e){e=e.closest,this.highlightedBlock=e.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(e,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(e){if(this.fadedBlock=e.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const e=[];return this.firstMarker&&e.push(this.firstMarker),this.lastMarker&&e.push(this.lastMarker),e}disposeInsertionMarker(e){if(e){Ms.disable$$module$build$src$core$events$utils();try{e.dispose()}finally{Ms.enable$$module$build$src$core$events$utils()}}}};!function(e){(e=e.PREVIEW_TYPE||(e.PREVIEW_TYPE={}))[e.INSERTION_MARKER=0]="INSERTION_MARKER",e[e.INPUT_OUTLINE=1]="INPUT_OUTLINE",e[e.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"}(fh||(fh={}));var gh=fh.PREVIEW_TYPE,mh={};mh.InsertionMarkerManager=fh,mh.PreviewType=gh;var bh=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName())}refreshDom(e,t){const n=this.getConstants();n.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=n.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new eh}makeRenderInfo_(e){return new lh(this,e)}makeDrawer_(e,t){return new nh(e,t)}makeMarkerDrawer(e,t){return new dh(e,this.getConstants(),t)}makePathObject(e,t){return new hh(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,n){return!!ph.getConnectionForOrphanedConnection(e,n===Ac.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}getConnectionPreviewMethod(e,t,n){return ne("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Ac.OUTPUT_VALUE||t.type===Ac.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(n,e.targetBlock(),t.type)?fh.PREVIEW_TYPE.INSERTION_MARKER:fh.PREVIEW_TYPE.REPLACEMENT_FADE:fh.PREVIEW_TYPE.INSERTION_MARKER}render(e){const t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},yh={};yh.BottomRow=Md,yh.Connection=Pd,yh.ConstantProvider=eh,yh.Drawer=nh,yh.ExternalValueInput=jd,yh.Field=Fd,yh.Hat=$d,yh.Icon=Ud,yh.InRowSpacer=Hd,yh.InlineInput=Gd,yh.InputConnection=Bd,yh.InputRow=Wd,yh.JaggedEdge=zd,yh.MarkerSvg=dh,yh.Measurable=Dd,yh.NextConnection=qd,yh.OutputConnection=Yd,yh.PathObject=hh,yh.PreviousConnection=Kd,yh.RenderInfo=lh,yh.Renderer=bh,yh.RoundCorner=Zd,yh.Row=Ld,yh.SpacerRow=Xd,yh.SquareCorner=Jd,yh.StatementInput=Vd,yh.TopRow=Qd,yh.Types=Rd,yh.init=Oo,yh.register=Ao,yh.unregister=Io;var vh=class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces_=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(t&&(t=t.getClassName())&&se(e,t),(t=this.theme.getClassName())&&re(e,t));for(let e,t=0;e=this.subscribedWorkspaces_[t];t++)e.refreshTheme();for(const[n,i]of this.componentDB)for(const r of i){e=r.element,t=r.propertyName;const i=this.theme&&this.theme.getComponentStyle(n);e.style.setProperty(t,i||"")}for(const e of this.subscribedWorkspaces_)e.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces_.push(e)}unsubscribeWorkspace(e){if(!Q(this.subscribedWorkspaces_,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,n){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:n}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(n,t||"")}unsubscribe(e){if(e)for(const[t,n]of this.componentDB){for(let t=n.length-1;0<=t;t--)n[t].element===e&&n.splice(t,1);n.length||this.componentDB.delete(t)}}dispose(){this.subscribedWorkspaces_.length=0,this.componentDB.clear()}},_h={CATEGORY_NAME:"VARIABLE_DYNAMIC"};_h.flyoutCategory=Lo,_h.flyoutCategoryBlocks=Mo,_h.onCreateVariableButtonClick_Colour=Do,_h.onCreateVariableButtonClick_Number=Ro,_h.onCreateVariableButtonClick_String=No;var Eh=class{canConnect(e,t,n,i){return this.canConnectWithReason(e,t,n,i)===ph.CAN_CONNECT}canConnectWithReason(e,t,n,i){const r=this.doSafetyChecks(e,t);return r!==ph.CAN_CONNECT?r:this.doTypeChecks(e,t)?n&&!this.doDragChecks(e,t,i||0)?ph.REASON_DRAG_CHECKS_FAILED:ph.CAN_CONNECT:ph.REASON_CHECKS_FAILED}getErrorMessage(e,t,n){switch(e){case ph.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case ph.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case ph.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case ph.REASON_TARGET_NULL:return"Target connection is null.";case ph.REASON_CHECKS_FAILED:return"Connection checks failed. "+t+" expected "+t.getCheck()+", found "+n.getCheck();case ph.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case ph.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case ph.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return ph.REASON_TARGET_NULL;let n,i,r;return e.isSuperior()?(n=e.getSourceBlock(),i=t.getSourceBlock(),r=t):(i=e.getSourceBlock(),n=t.getSourceBlock(),r=e,e=t),n===i?ph.REASON_SELF_CONNECTION:r.type!==Su[e.type]?ph.REASON_WRONG_TYPE:n.workspace!==i.workspace?ph.REASON_DIFFERENT_WORKSPACES:n.isShadow()&&!i.isShadow()?ph.REASON_SHADOW_PARENT:r.type===Ac.OUTPUT_VALUE&&i.previousConnection&&i.previousConnection.isConnected()||r.type===Ac.PREVIOUS_STATEMENT&&i.outputConnection&&i.outputConnection.isConnected()?ph.REASON_PREVIOUS_AND_OUTPUT:ph.CAN_CONNECT}doTypeChecks(e,t){if(e=e.getCheck(),t=t.getCheck(),!e||!t)return!0;for(let n=0;n<e.length;n++)if(-1!==t.indexOf(e[n]))return!0;return!1}doDragChecks(e,t,n){if(e.distanceFrom(t)>n||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case Ac.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case Ac.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case Ac.INPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;case Ac.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return-1===qs.indexOf(t)}canConnectToPrevious_(e,t){return!(e.targetConnection||-1!==qs.indexOf(t)||t.targetConnection&&(!(e=t.targetBlock()).isInsertionMarker()||e.getPreviousBlock()))}};t($s.CONNECTION_CHECKER,Fs,Eh);var Th=class extends Zl{constructor(e){super(e),this.type="var_delete",e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Th)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.deleteVariableById(this.varId):t.createVariable(this.varName,this.varType,this.varId)}};t($s.EVENT,"var_delete",Th);var xh=class extends Zl{constructor(e,t){super(e),this.type="var_rename",e&&(this.oldName=e.name,this.newName=void 0===t?"":t)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new xh)).oldName=e.oldName,t.newName=e.newName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");e?t.renameVariableById(this.varId,this.newName):t.renameVariableById(this.varId,this.oldName)}};t($s.EVENT,"var_rename",xh);var wh=class{constructor(e){this.workspace=e,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(;0<e.length;)this.deleteVariable(e[0]);if(0!==this.variableMap.size)throw Error("Non-empty variable map")}renameVariable(e,t){if(e.name!==t){var n=this.getVariable(t,e.type),i=this.workspace.getAllBlocks(!1),r=Ms.getGroup$$module$build$src$core$events$utils();r||Ms.setGroup$$module$build$src$core$events$utils(!0);try{n&&n.getId()!==e.getId()?this.renameVariableWithConflict_(e,t,n,i):this.renameVariableAndUses_(e,t,i)}finally{Ms.setGroup$$module$build$src$core$events$utils(r)}}}renameVariableById(e,t){const n=this.getVariableById(e);if(!n)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(n,t)}renameVariableAndUses_(e,t,n){for(I(new(j("var_rename"))(e,t)),e.name=t,t=0;t<n.length;t++)n[t].updateVarName(e)}renameVariableWithConflict_(e,t,n,i){const r=e.type;for(t!==n.name&&this.renameVariableAndUses_(n,t,i),t=0;t<i.length;t++)i[t].renameVarById(e.getId(),n.getId());I(new(j("var_delete"))(e)),Q(this.variableMap.get(r),e)}createVariable(e,t,n){var i=this.getVariable(e,t);if(i){if(n&&i.getId()!==n)throw Error('Variable "'+e+'" is already in use and its id is "'+i.getId()+'" which conflicts with the passed in id, "'+n+'".');return i}if(n&&this.getVariableById(n))throw Error('Variable id, "'+n+'", is already in use.');return i=n||S(),t=t||"",i=new Jl(this.workspace,e,t,i),(e=this.variableMap.get(t)||[]).push(i),this.variableMap.delete(t),this.variableMap.set(t,e),I(new(j(ea))(i)),i}deleteVariable(e){const t=e.getId(),n=this.variableMap.get(e.type);if(n)for(let i=0;i<n.length;i++)if(n[i].getId()===t){n.splice(i,1),I(new(j("var_delete"))(e)),0===n.length&&this.variableMap.delete(e.type);break}}deleteVariableById(e){const t=this.getVariableById(e);if(t){var n=t.name;const i=this.getVariableUsesById(e);for(let t,r=0;t=i[r];r++)if("procedures_defnoreturn"===t.type||"procedures_defreturn"===t.type)return e=String(t.getFieldValue("NAME")),n=Ms.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",n).replace("%2",e),void Ke(n);1<i.length?(n=Ms.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(i.length)).replace("%2",n),Xe(n,(e=>{e&&t&&this.deleteVariableInternal(t,i)}))):this.deleteVariableInternal(t,i)}else console.warn("Can't delete non-existent variable: "+e)}deleteVariableInternal(e,t){const n=Ms.getGroup$$module$build$src$core$events$utils();n||Ms.setGroup$$module$build$src$core$events$utils(!0);try{for(let e=0;e<t.length;e++)t[e].dispose(!0);this.deleteVariable(e)}finally{Ms.setGroup$$module$build$src$core$events$utils(n)}}getVariable(e,t){if(t=this.variableMap.get(t||""))for(let n,i=0;n=t[i];i++)if(Ms.Names$$module$build$src$core$names.equals(n.name,e))return n;return null}getVariableById(e){for(const t of this.variableMap.values())for(const n of t)if(n.getId()===e)return n;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?e.slice():[]}getVariableTypes(e){const t=new Set(this.variableMap.keys());if(e&&e.getPotentialVariableMap())for(const n of e.getPotentialVariableMap().variableMap.keys())t.add(n);return t.has("")||t.add(""),Array.from(t.values())}getAllVariables(){let e=[];for(const t of this.variableMap.values())e=e.concat(t);return e}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map((e=>e.name))}getVariableUsesById(e){const t=[],n=this.workspace.getAllBlocks(!1);for(let i=0;i<n.length;i++){const r=n[i].getVarModels();if(r)for(let o=0;o<r.length;o++)r[o].getId()===e&&t.push(n[i])}return t}},kh=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new ld,this.potentialVariableMap=null,this.id=S(),h(this),this.options=e||new Ju({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(c($s.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new wh(this)}dispose(){this.listeners.length=0,this.clear(),p(this)}sortObjects_(e,t){const n=Math.sin(ui(kh.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),t=t.getRelativeToSurfaceXY(),e.y+n*e.x-(t.y+n*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!Q(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){Q(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects_.bind(this)),e.filter((function(e){return!e.isInsertionMarker()}))):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!Q(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}getAllBlocks(e=!1){if(e){var t=this.getTopBlocks(!0);e=[];for(let n=0;n<t.length;n++)e.push(...t[n].getDescendants(!0))}else for(e=this.getTopBlocks(!1),t=0;t<e.length;t++)e.push(...e[t].getChildren(!1));return e.filter((function(e){return!e.isInsertionMarker()}))}clear(){this.isClearing=!0;try{const e=Ms.getGroup$$module$build$src$core$events$utils();for(e||Ms.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();Ms.setGroup$$module$build$src$core$events$utils(e),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){this.variableMap.renameVariableById(e,t)}createVariable(e,t,n){return this.variableMap.createVariable(e,t,n)}getVariableUsesById(e){return this.variableMap.getVariableUsesById(e)}deleteVariableById(e){this.variableMap.deleteVariableById(e)}getVariable(e,t){return this.variableMap.getVariable(e,t)}getVariableById(e){return this.variableMap.getVariableById(e)}getVariablesOfType(e){return this.variableMap.getVariablesOfType(e)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(void 0!==this.options.maxInstances[e]?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(const n in e){if(e[n]>this.remainingCapacityOfType(n))return!1;t+=e[n]}return!(t>this.remainingCapacity())}hasBlockLimits(){return 1/0!==this.options.maxBlocks||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,n=e?this.undoStack_:this.redoStack_;const i=t.pop();if(i){for(var r=[i];t.length&&i.group&&i.group===t[t.length-1].group;){const e=t.pop();e&&r.push(e)}for(t=0;t<r.length;t++)n.push(r[t]);r=R(r,e),C(!1);try{for(n=0;n<r.length;n++)r[n].run(e)}finally{C(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,D()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){Q(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let t=0;t<this.listeners.length;t++)(0,this.listeners[t])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let t;return null!=(t=this.commentDB.get(e))?t:null}allInputsFilled(e){const t=this.getTopBlocks(!1);for(let n=0;n<t.length;n++)if(!t[n].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new wh(this)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return u(e)}static getAll(){return d()}};kh.SCAN_ANGLE=3;var Sh=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound_=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,t){if(e.length){try{var n=new globalThis.Audio}catch(e){return}for(let t=0;t<e.length;t++){const r=e[t],o=r.match(/\.(\w+)$/);if(o&&n.canPlayType("audio/"+o[1])){var i=new globalThis.Audio(r);break}}i&&this.sounds.set(t,i)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const t=e.play();if(void 0!==t?t.then(e.pause).catch((function(){})):e.pause(),$a||Ua)break}}play(e,t){if(!this.muted){var n=this.sounds.get(e);n?(e=new Date,null!==this.lastSound_&&e.getTime()-this.lastSound_.getTime()<100||(this.lastSound_=e,(n=$a||Fa?n:n.cloneNode()).volume=void 0===t?1:t,n.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},Ch=class extends kh{constructor(e){let t;super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.isVisible_=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.dragDeltaXY=null,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox_=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(c($s.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||Ch.setTopLevelWorkspaceMetrics_,this.componentManager=new Za,this.connectionDBList=Oc.init(this.connectionChecker),this.audioManager=new Sh(e.parentWorkspace),this.grid=this.options.gridPattern?new qu(this.options.gridPattern,e.gridOptions):null,this.markerManager=new Yu(this),tc&&ot&&this.registerToolboxCategoryCallback("VARIABLE",ot),_h&&Lo&&this.registerToolboxCategoryCallback("VARIABLE_DYNAMIC",Lo),Od&&go&&(this.registerToolboxCategoryCallback("PROCEDURE",go),this.addChangeListener(bo)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new vh(this,this.options.theme||Xu),this.themeManager_.subscribeWorkspace(this),this.renderer=Oo(this.options.renderer||"geras",this.getTheme(),null!=(t=this.options.rendererOverrides)?t:void 0),this.cachedParentSvgSize=new pl(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(e){this.markerManager.setCursorSvg(e)}setMarkerSvg(e){this.markerManager.setMarkerSvg(e)}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=Xu),this.themeManager_.setTheme(e)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter((function(e){return!!e.getStyleName()}))),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);const e=new(j("theme_change"))(this.getTheme().name,this.id);I(e)}updateBlockStyles_(e){for(let t,n=0;t=e[n];n++){const e=t.getStyleName();e&&t.setStyle(e)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(e){let t=0,n=0,i=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(i=this.scale);do{const r=Ce(e);e!==this.getCanvas()&&e!==this.getBubbleCanvas()||(i=1),t+=r.x*i,n+=r.y*i,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new el(t,n)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new pl(e.width,e.height)}getOriginOffsetInPixels(){return Ae(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if(-1!==(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=null!=t?t:null),this.svgGroup_=ie(dl.G,{class:"blocklyWorkspace"}),e&&(this.svgBackground_=ie(dl.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"===e&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e)),e=this.createLayer(50),re(e,"blocklyBlockCanvas"),e=this.createLayer(100),re(e,"blocklyBubbleCanvas")}createDragLayer(e){const t=ie(dl.SVG,{class:"blocklyBlockDragSurface",xmlns:rl,"xmlns:html":ol,"xmlns:xlink":sl,version:"1.1"});return e.append(t),ie(dl.G,{},t)}translateLayers(e,t){let n;e=`translate(${e.x}, ${e.y}) scale(${t})`,null==(n=this.dragLayer)||n.setAttribute("transform",e);for(const[,t]of this.layers)t.setAttribute("transform",e)}moveToDragLayer(e){let t;null==(t=this.dragLayer)||t.appendChild(e.getSvgRoot())}moveOffDragLayer(e,t){this.append(e,t)}append(e,t){let n;this.layers.has(t)||this.createLayer(t),null==(n=this.layers.get(t))||n.appendChild(e.getSvgRoot())}createLayer(e){const t=this.workspace.getSvgGroup(),n=ie(dl.G,{});let i=!1;const r=[...this.layers].sort(((e,t)=>e[0]-t[0]));for(const[o,s]of r)if(e<o){t.insertBefore(n,s),i=!0;break}return i||t.appendChild(n),this.layers.set(e,n),n}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(50)}getBubbleLayer(){return this.layers.get(100)}}(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(z(this.svgGroup_,"pointerdown",this,this.onMouseDown_,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),z(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(c($s.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=c($s.CURSOR,this.options))&&this.markerManager.setCursor(new e),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&le(this.svgGroup_),this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&le(e.parentNode)}this.resizeHandlerWrapper&&(Y(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=Ch.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new $l(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}addFlyout(e){const t=new Ju({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(c($s.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(t):new(c($s.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position(),this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(Za.Capability.POSITIONABLE,!0),t=this.getMetricsManager().getUiMetrics(),n=[];for(let i,r=0;i=e[r];r++){i.position(t,n);const e=i.getBoundingRectangle();e&&n.push(e)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const e=Oe();el.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations_())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){const n=this.getParentSvg();null!=e&&(this.cachedParentSvgSize.width=e,n.setAttribute("data-cached-width",`${e}`)),null!=t&&(this.cachedParentSvgSize.height=t,n.setAttribute("data-cached-height",`${t}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if("svg"===e.tagName){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(L()){var e=this.scale,t=-this.scrollY,n=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(t-this.oldTop)&&1>Math.abs(n-this.oldLeft))){var i=new(j(ra))(t,n,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=t,this.oldLeft=n,I(i)}}}translate(e,t){let n,i;null==(n=this.layerManager)||n.translateLayers(new el(e,t),this.scale),null==(i=this.grid)||i.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.isVisible_=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox_&&this.toolbox_.setVisible(e),e||this.hideChaff(!0))}render(){for(var e=this.getAllBlocks(!1),t=e.length-1;0<=t;t--)e[t].queueRender();if(this.currentGesture_)for(e=this.currentGesture_.getInsertionMarkers(),t=0;t<e.length;t++)e[t].queueRender();xt().then((()=>{this.markerManager.updateMarkers()}))}highlightBlock(e,t){if(void 0===t){for(let e,t=0;e=this.highlightedBlocks[t];t++)e.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=void 0===t||t)?-1===this.highlightedBlocks.indexOf(e)&&this.highlightedBlocks.push(e):Q(this.highlightedBlocks,e),e.setHighlighted(t))}paste(e){if(ne("Blockly.WorkspaceSvg.prototype.paste","v10","v11","Blockly.clipboard.paste"),!this.rendered||!e.type&&!e.tagName)return null;this.currentGesture_&&this.currentGesture_.cancel();const t=Ms.getGroup$$module$build$src$core$events$utils();let n;t||Ms.setGroup$$module$build$src$core$events$utils(!0);try{n=e.type?this.pasteBlock_(null,e):"comment"===e.tagName.toLowerCase()?this.pasteWorkspaceComment_(e):this.pasteBlock_(e,null)}finally{Ms.setGroup$$module$build$src$core$events$utils(t)}return n}pasteBlock_(e,t){let n;Ms.disable$$module$build$src$core$events$utils();try{let i=0,r=0;if(e){let t,o;n=Ht(e,this),i=parseInt(null!=(t=e.getAttribute("x"))?t:"0"),this.RTL&&(i=-i),r=parseInt(null!=(o=e.getAttribute("y"))?o:"0")}else t&&(n=gn(t,this),i=t.x||10,this.RTL&&(i=this.getWidth()-i),r=t.y||10);if(!isNaN(i)&&!isNaN(r)){let e;do{e=!1;const t=this.getAllBlocks(!1);for(let n,o=0;n=t[o];o++){const t=n.getRelativeToSurfaceXY();if(1>=Math.abs(i-t.x)&&1>=Math.abs(r-t.y)){e=!0;break}}if(!e){const t=n.getConnections_(!1);for(let n,o=0;n=t[o];o++)if(n.closest(Ms.config$$module$build$src$core$config.snapRadius,new el(i,r)).connection){e=!0;break}}e&&(i=this.RTL?i-Ms.config$$module$build$src$core$config.snapRadius:i+Ms.config$$module$build$src$core$config.snapRadius,r+=2*Ms.config$$module$build$src$core$config.snapRadius)}while(e);n.moveTo(new el(i,r))}}finally{Ms.enable$$module$build$src$core$events$utils()}return L()&&!n.isShadow()&&I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(n)),n.select(),n}pasteWorkspaceComment_(e){let t;Ms.disable$$module$build$src$core$events$utils();try{t=sc.fromXmlRendered(e,this);let n,i,r=parseInt(null!=(n=e.getAttribute("x"))?n:"0"),o=parseInt(null!=(i=e.getAttribute("y"))?i:"0");isNaN(r)||isNaN(o)||(this.RTL&&(r=-r),t.moveBy(r+50,o+50))}finally{Ms.enable$$module$build$src$core$events$utils()}return L()&&nc.fireCreateEvent(t),t.select(),t}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()}renameVariableById(e,t){super.renameVariableById(e,t),this.refreshToolboxSelection()}deleteVariableById(e){super.deleteVariableById(e),this.refreshToolboxSelection()}createVariable(e,t,n){return e=super.createVariable(e,t,n),this.refreshToolboxSelection(),e}recordDragTargets(){const e=this.componentManager.getComponents(Za.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let t,n=0;t=e[n];n++){const e=t.getClientRect();e&&this.dragTargetAreas.push({component:t,clientRect:e})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let t,n=0;t=this.dragTargetAreas[n];n++)if(t.clientRect.contains(e.clientX,e.clientY))return t.component;return null}onMouseDown_(e){const t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){(e=X(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,this.dragDeltaXY=el.difference(t,e)}moveDrag(e){return(e=X(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,el.sum(this.dragDeltaXY,e)}isDragging(){return null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel_(e){if(zu.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,n=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||n){var i=J(e);if(Ha)var r=e.metaKey;t&&(e.ctrlKey||r||!n)?(i=-i.y/50,t=X(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,i)):(t=this.scrollX-i.x,n=this.scrollY-i.y,e.shiftKey&&!i.x&&(t=this.scrollX-i.y,n=this.scrollY),this.scroll(t,n)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new hl(0,0,0,0);const t=e[0].getBoundingRectangle();for(let i=1;i<e.length;i++){var n=e[i];n.isInsertionMarker&&n.isInsertionMarker()||((n=n.getBoundingRectangle()).top<t.top&&(t.top=n.top),n.bottom>t.bottom&&(t.bottom=n.bottom),n.left<t.left&&(t.left=n.left),n.right>t.right&&(t.right=n.right))}return t}cleanUp(){this.setResizesEnabled(!1),Ms.setGroup$$module$build$src$core$events$utils(!0);const e=this.getTopBlocks(!0);let t=0;for(let n,i=0;n=e[i];i++){if(!n.isMovable())continue;const e=n.getRelativeToSurfaceXY();n.moveBy(-e.x,t-e.y,["cleanup"]),n.snapToGrid(),t=n.getRelativeToSurfaceXY().y+n.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}Ms.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.options.readOnly&&!this.isFlyout){var t=tu.registry.getContextMenuOptions(tu.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(t,e),ei(e,t,this.RTL)}}updateToolbox(e){if(e=Pe(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(Fe(e)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox_.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(g(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,n){n=Math.pow(this.options.zoomOptions.scaleSpeed,n);const i=this.scale*n;if(this.scale!==i){i>this.options.zoomOptions.maxScale?n=this.options.zoomOptions.maxScale/this.scale:i<this.options.zoomOptions.minScale&&(n=this.options.zoomOptions.minScale/this.scale);var r=this.getCanvas().getCTM(),o=this.getParentSvg().createSVGPoint();o.x=e,o.y=t,e=(o=o.matrixTransform(r.inverse())).x,t=o.y,r=r.translate(e*(1-n),t*(1-n)).scale(n),this.scrollX=r.e,this.scrollY=r.f,this.setScale(i)}}zoomCenter(e){var t=this.getMetrics();let n;this.flyout?(n=t.svgWidth?t.svgWidth/2:0,t=t.svgHeight?t.svgHeight/2:0):(n=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop),this.zoom(n,t,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var n=this.getBlocksBoundingBox(),i=n.right-n.left+40;if(n=n.bottom-n.top+40,i){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),n+=this.flyout.getHeight()/this.scale):(t+=this.flyout.getWidth(),i+=this.flyout.getWidth()/this.scale)),t/=i,e/=n,Ms.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(t,e)),this.scrollCenter()}finally{Ms.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){re(this.getCanvas(),"blocklyCanvasTransitioning"),re(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){se(this.getCanvas(),"blocklyCanvasTransitioning"),se(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),t=(e.scrollWidth-e.viewWidth)/2,n=(e.scrollHeight-e.viewHeight)/2;t=-t-e.scrollLeft,n=-n-e.scrollTop,this.scroll(t,n)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){if(this.isMovable()){var n=e?this.getBlockById(e):null;if(n){e=n.getRelativeToSurfaceXY(),n=t?{height:n.height,width:n.width}:n.getHeightWidth();var i=this.scale;t=(e.x+(this.RTL?-1:1)*n.width/2)*i,e=(e.y+n.height/2)*i,n=this.getMetrics(),this.scroll(-(t-n.viewWidth/2),-(e-n.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(e,t){this.hideChaff(!0);const n=this.getMetrics();e=Math.min(e,-n.scrollLeft),t=Math.min(t,-n.scrollTop);const i=n.scrollTop+Math.max(0,n.scrollHeight-n.viewHeight);e=Math.max(e,-(n.scrollLeft+Math.max(0,n.scrollWidth-n.viewWidth))),t=Math.max(t,-i),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+n.scrollLeft),-(t+n.scrollTop),!1),e+=n.absoluteLeft,t+=n.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){Q(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){let t;return null!=(t=this.flyoutButtonCallbacks.get(e))?t:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){const t="pointerdown"===e.type,n=this.currentGesture_;return n?t&&n.hasStarted()?(console.warn("Tried to start the same gesture twice."),n.cancel(),null):n:t?this.currentGesture_=new zu(e,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){lr(),Gn(),Ri(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(Za.Capability.AUTOHIDEABLE,!0).forEach((t=>t.autoHide(e)))}static setTopLevelWorkspaceMetrics_(e){const t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),"number"==typeof e.y&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}},Ah={};Ah.WorkspaceSvg=Ch,Ah.resizeSvgContents=Po;var Ih=class extends ya{constructor(e,t){super(t),this.type="trashcan_open",this.isOpen=e}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Ih)).isOpen=e.isOpen,t}};t($s.EVENT,"trashcan_open",Ih);var Oh=class extends wc{constructor(e){if(super(e),this.type=Ms.DELETE$$module$build$src$core$events$utils,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Dt(e),this.ids=P(e),this.wasShadow=e.isShadow(),this.oldJson=sn(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(void 0===this.wasShadow)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=jt(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Oh)).oldXml=Ms.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||"shadow"===t.oldXml.tagName.toLowerCase(),t.oldJson=e.oldJson,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const n=this.ids[e],i=t.getBlockById(n);i?i.dispose(!1):n===this.blockId&&console.warn("Can't delete non-existent block: "+n)}else gn(this.oldJson,t)}};t($s.EVENT,Ms.DELETE$$module$build$src$core$events$utils,Oh);var Nh=class{constructor(e,t,n){if(this.data=null,this.disposed=!1,this.hue_=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.outputShape_=null,this.isInsertionMarker_=this.disposing=!1,this.onchangeWrapper_=this.helpUrl=this.rendered=null,this.statementInputCount=0,this.workspace=e,this.id=n&&!e.getBlockById(n)?n:S(),e.setBlockById(this.id,this),this.xy_=new el(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,!(n=Vs[t])||"object"!=typeof n)throw TypeError("Invalid block definition for type: "+t);Object.assign(this,n)}e.addTopBlock(this),e.addTypedBlock(this),new.target===Nh&&this.doInit_()}doInit_(){const e=Ms.getGroup$$module$build$src$core$events$utils();e||Ms.setGroup$$module$build$src$core$events$utils(!0);const t=A();try{"function"==typeof this.init&&(C(!1),this.init(),C(t)),L()&&I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(this))}finally{Ms.setGroup$$module$build$src$core$events$utils(e),C(t)}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)}dispose(e){this.isDeadOrDying()||(this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(e),L()&&I(new(j(Ms.DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopBlock(this),this.disposeInternal())}disposeInternal(){this.isDeadOrDying()||(this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.disposing=!0,"function"==typeof this.destroy&&this.destroy(),this.childBlocks_.forEach((e=>e.disposeInternal())),this.inputList.forEach((e=>e.dispose())),this.inputList.length=0,this.getConnections_(!0).forEach((e=>e.dispose())),this.disposed=!0)}isDeadOrDying(){return this.disposing||this.disposed}initModel(){for(const e of this.inputList)for(const t of e.fieldRow)t.initModel&&t.initModel()}unplug(e){this.outputConnection&&this.unplugFromRow_(e),this.previousConnection&&this.unplugFromStack_(e)}unplugFromRow_(e){let t,n=null;null!=(t=this.outputConnection)&&t.isConnected()&&(n=this.outputConnection.targetConnection,this.outputConnection.disconnect()),n&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow()&&(null==(e=e.targetConnection)||e.disconnect(),this.workspace.connectionChecker.canConnect(e,n,!1)?n.connect(e):null==e||e.onFailedConnect(n))}getOnlyValueConnection_(){let e=null;for(let t=0;t<this.inputList.length;t++){const n=this.inputList[t].connection;if(n&&n.type===Ac.INPUT_VALUE&&n.targetConnection){if(e)return null;e=n}}return e}unplugFromStack_(e){let t=null;var n;if(null!=(n=this.previousConnection)&&n.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),n=this.getNextBlock(),e&&n&&!n.isShadow()){let n,i;null==(e=null!=(i=null==(n=this.nextConnection)?void 0:n.targetConnection)?i:null)||e.disconnect(),t&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let t,n=0;t=this.inputList[n];n++)t.connection&&e.push(t.connection);return e}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){const n=t.targetBlock();if(!n||e&&n.isShadow())return t;t=n.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let t,n=0;t=this.inputList[n];n++)if(t.connection&&t.connection.targetBlock()===e)return t;return null}getSurroundParent(){let e,t=this;do{if(e=t,!(t=t.getParent()))return null}while(t.getNextBlock()===e);return t}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;do{t=(e=t).parentBlock_}while(t);return e}getTopStackBlock(){let e,t=this;do{e=t.getPreviousBlock()}while(e&&e.getNextBlock()===t&&(t=e));return t}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let n,i=0;n=this.inputList[i];i++)if(n.connection){var t=n.connection.targetBlock();t&&e.push(t)}return(t=this.getNextBlock())&&e.push(t),e}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),n=!!t;if(n&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!n&&e)throw Error("Block not connected to new parent.");if(n&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?Q(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const t=[this],n=this.getChildren(e);for(let i,r=0;i=n[r];r++)t.push(...i.getDescendants(e));return t}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable_}setDeletable(e){this.deletable_=e}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable_}setMovable(e){this.movable_=e}isDuplicatable(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(E(this,!0))}isShadow(){return this.isShadow_}setShadow(e){this.isShadow_=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable_}setEditable(e){this.editable_=e;for(let e,t=0;e=this.inputList[t];t++)for(let t,n=0;t=e.fieldRow[n];n++)t.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,t){const n=this.getConnections_(!0);if(e=e.getConnections_(!0),n.length!==e.length)throw Error("Connection lists did not match in length.");for(let i=0;i<e.length;i++)if(e[i]===t)return n[i];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return Qi(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(e){e=Nr(e),this.hue_=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=e,this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)}getField(e){if("string"!=typeof e)throw TypeError("Block.prototype.getField expects a string with the field name but received "+(void 0===e?"nothing":e+" of type "+typeof e)+" instead");for(let t,n=0;t=this.inputList[n];n++)for(let n,i=0;n=t.fieldRow[i];i++)if(n.name===e)return n;return null}getVars(){const e=[];for(let t,n=0;t=this.inputList[n];n++)for(let n,i=0;n=t.fieldRow[i];i++)n.referencesVariables()&&e.push(n.getValue());return e}getVarModels(){const e=[];for(let t,n=0;t=this.inputList[n];n++)for(let n,i=0;n=t.fieldRow[i];i++)if(n.referencesVariables()){const t=this.workspace.getVariableById(n.getValue());t&&e.push(t)}return e}updateVarName(e){for(let t,n=0;t=this.inputList[n];n++)for(let n,i=0;n=t.fieldRow[i];i++)n.referencesVariables()&&e.getId()===n.getValue()&&n.refreshVariableName()}renameVarById(e,t){for(let n,i=0;n=this.inputList[i];i++)for(let i,r=0;i=n.fieldRow[r];r++)i.referencesVariables()&&e===i.getValue()&&i.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){const n=this.getField(t);if(!n)throw Error('Field "'+t+'" not found.');n.setValue(e)}setPreviousStatement(e,t){if(e)void 0===t&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(Ac.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(Ac.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)void 0===t&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(Ac.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof oh&&this.inputList[e]instanceof oh)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof oh)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof sh)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return!this.disabled}setEnabled(e){if(this.isEnabled()!==e){const t=this.disabled;this.disabled=!e,I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this,"disabled",null,t,!e))}}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(e.disabled)return!0;e=e.getSurroundParent()}return!1}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let e=2;e<t.length;e++)"("===t[e-2]&&")"===t[e]&&(t[e-2]=t[e-1],t.splice(e-1,2));let n="";return t=(t=t.reduce(((e,t)=>(e=e+("("===n||")"===t?"":" ")+t,n=t[t.length-1],e)),"")).trim()||"???",e&&t.length>e&&(t=t.substring(0,e-3)+"..."),t}toTokens(e="?"){const t=[];for(const i of this.inputList)if("_TEMP_COLLAPSED_INPUT"!=i.name){for(const e of i.fieldRow)t.push(e.getText());if(i.connection){const r=i.connection.targetBlock();if(r){var n=i.connection;let o=n.getCheck();!o&&n.targetConnection&&(o=n.targetConnection.getCheck()),(n=!!o&&(-1!==o.indexOf("Boolean")||-1!==o.indexOf("Number")))&&t.push("("),t.push(...r.toTokens(e)),n&&t.push(")")}else t.push(e)}}return t}appendValueInput(e){return this.appendInput(new Ms.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new ah(e,this))}appendDummyInput(e=""){return this.appendInput(new oh(e,this))}appendEndRowInput(e=""){return this.appendInput(new sh(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=s($s.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var n=0;e["args"+n];){if(void 0===e["message"+n])throw Error(t+`args${n} must have a corresponding message (message${n}).`);n++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle_(e,t):this.jsonInitColour_(e,t),n=0;void 0!==e["message"+n];)this.interpolate_(e["message"+n],e["args"+n]||[],e["implicitAlign"+n]||e["lastDummyAlign"+n],t),n++;if(void 0!==e.inputsInline&&(Ms.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),Ms.enable$$module$build$src$core$events$utils()),void 0!==e.output&&this.setOutput(!0,e.output),void 0!==e.outputShape&&this.setOutputShape(e.outputShape),void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement),void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement),void 0!==e.tooltip&&(n=Ir(e.tooltip),this.setTooltip(n)),void 0!==e.enableContextMenu&&(this.contextMenu=!!e.enableContextMenu),void 0!==e.suppressPrefixSuffix&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),void 0!==e.helpUrl&&(n=Ir(e.helpUrl),this.setHelpUrl(n)),"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),void 0!==e.mutator&&Hr(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)Hr(e[t],this,!1)}jsonInitColour_(e,t){if("colour"in e)if(void 0===e.colour)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch(n){console.warn(t+"Illegal colour value: ",e)}}}jsonInitStyle_(e,t){e=e.style;try{this.setStyle(e)}catch(n){console.warn(t+"Style does not exist: ",e)}}mixin(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(const n in e)void 0!==this[n]&&t.push(n);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate_(e,t,n,i){e=Ar(e),this.validateTokens_(e,t.length),t=this.interpolateArguments_(e,t,n),n=[];for(let r,o=0;r=t[o];o++)if(this.isInputKeyword_(r.type)){if(e=this.inputFromJson_(r,i)){for(let t,i=0;t=n[i];i++)e.appendField(t[0],t[1]);n.length=0}}else(e=this.fieldFromJson_(r))&&n.push([e,r.name])}validateTokens_(e,t){const n=[];let i=0;for(let r=0;r<e.length;r++){const o=e[r];if("number"==typeof o){if(1>o||o>t)throw Error('Block "'+this.type+'": Message index %'+o+" out of range.");if(n[o])throw Error('Block "'+this.type+'": Message index %'+o+" duplicated.");n[o]=!0,i++}}if(i!==t)throw Error('Block "'+this.type+'": Message does not reference all '+t+" arg(s).")}interpolateArguments_(e,t,n){const i=[];for(let o=0;o<e.length;o++){var r=e[o];if("number"==typeof r&&(r=t[r-1]),"string"==typeof r)if("\n"===r)r={type:"input_end_row"},n&&(r.align=n);else if(!(r=this.stringToFieldJson_(r)))continue;i.push(r)}return(e=i.length)&&!this.isInputKeyword_(i[e-1].type)&&(e={type:"input_dummy"},n&&(e.align=n),i.push(e)),i}fieldFromJson_(e){const t=Ms.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?"string"==typeof e.alt?(e=this.stringToFieldJson_(e.alt))?this.fieldFromJson_(e):null:this.fieldFromJson_(e.alt):t}inputFromJson_(e,t){var n={LEFT:Ms.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:Ms.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:Ms.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:Ms.Align$$module$build$src$core$inputs$align.CENTRE};let i;switch(e.type){case"input_value":i=this.appendValueInput(e.name);break;case"input_statement":i=this.appendStatementInput(e.name);break;case"input_dummy":i=this.appendDummyInput(e.name);break;case"input_end_row":i=this.appendEndRowInput(e.name);break;default:i=this.appendInputFromRegistry(e.type,e.name)}return i?(e.check&&i.setCheck(e.check),e.align&&(void 0===(n=n[e.align.toUpperCase()])?console.warn(t+"Illegal align value: ",e.align):i.setAlign(n)),i):null}isInputKeyword_(e){return"input_value"===e||"input_statement"===e||"input_dummy"===e||"input_end_row"===e||o($s.INPUT,e)}stringToFieldJson_(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,t){if(e!==t){var n=-1,i=t?-1:this.inputList.length;for(let r,o=0;r=this.inputList[o];o++)if(r.name===e){if(n=o,-1!==i)break}else if(t&&r.name===t&&(i=o,-1!==n))break;if(-1===n)throw Error('Named input "'+e+'" not found.');if(-1===i)throw Error('Reference input "'+t+'" not found.');this.moveNumberedInputBefore(n,i)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");const n=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,n)}removeInput(e,t){for(let t,n=0;t=this.inputList[n];n++)if(t.name===e)return t instanceof ah&&this.statementInputCount--,t.dispose(),this.inputList.splice(n,1),!0;if(t)return!1;throw Error("Input not found: "+e)}getInput(e){for(let t,n=0;t=this.inputList[n];n++)if(t.name===e)return t;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,t;return null!=(t=null==(e=this.getIcon(Sd.TYPE))?void 0:e.getText())?t:null}setCommentText(e){var t;let n;const i=null!=(n=null==(t=this.getIcon(Sd.TYPE))?void 0:t.getText())?n:null;i!==e&&(null!==e?((t=this.getIcon(Sd.TYPE))||(t=this.addIcon(new Sd(this))),Ms.disable$$module$build$src$core$events$utils(),t.setText(e),Ms.enable$$module$build$src$core$events$utils()):this.removeIcon(Sd.TYPE),I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this,"comment",null,i,e)))}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new Ad(e);return this.icons.push(e),this.icons.sort(((e,t)=>e.getWeight()-t.getWeight())),e}removeIcon(e){if(!this.hasIcon(e))return!1;let t;return null==(t=this.getIcon(e))||t.dispose(),this.icons=this.icons.filter((t=>!t.getType().equals(e))),!0}hasIcon(e){return this.icons.some((t=>t.getType().equals(e)))}getIcon(e){return e instanceof Ul?this.icons.find((t=>t.getType().equals(e))):this.icons.find((t=>t.getType().toString()===e))}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy_}moveBy(e,t,n){if(this.parentBlock_)throw Error("Block has parent");const i=new(j(Ms.MOVE$$module$build$src$core$events$utils))(this);n&&i.setReason(n),this.xy_.translate(e,t),i.recordNew(),I(i)}makeConnection_(e){return new ph(this,e)}allInputsFilled(e){if(void 0===e&&(e=!0),!e&&this.isShadow())return!1;for(let n,i=0;n=this.inputList[i];i++)if(n.connection){var t=n.connection.targetBlock();if(!t||!t.allInputsFilled(e))return!1}return!(t=this.getNextBlock())||t.allInputsFilled(e)}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};Nh.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",Nh.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD";var Rh=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(e){this.drawer=e}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(e){const t=this.curNode;this.curNode=e,this.drawer&&this.drawer.draw(t,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},Dh=class extends Rh{constructor(){super(),this.type="cursor"}next(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()===ch.types.NEXT||e.getType()===ch.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e}in(){var e=this.getCurNode();if(!e)return null;let t,n;return e.getType()!==ch.types.PREVIOUS&&e.getType()!==ch.types.OUTPUT||(e=e.next()),(e=null!=(n=null==(t=e)?void 0:t.in())?n:null)&&this.setCurNode(e),e}prev(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()===ch.types.NEXT||e.getType()===ch.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e}out(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()===ch.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null}};t($s.CURSOR,Fs,Dh);var Lh=class extends Dh{constructor(){super()}next(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null}in(){return this.next()}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null}out(){return this.prev()}getNextNode_(e,t){if(!e)return null;const n=e.in()||e.next();return t(n)?n:n?this.getNextNode_(n,t):t(e=this.findSiblingOrParent(e.out()))?e:e?this.getNextNode_(e,t):null}getPreviousNode_(e,t){if(!e)return null;let n=e.prev();return t(n=n?this.getRightMostChild(n):e.out())?n:n?this.getPreviousNode_(n,t):null}validNode_(e){let t=!1;return(e=e&&e.getType())!==ch.types.OUTPUT&&e!==ch.types.INPUT&&e!==ch.types.FIELD&&e!==ch.types.NEXT&&e!==ch.types.PREVIOUS&&e!==ch.types.WORKSPACE||(t=!0),t}findSiblingOrParent(e){return e?e.next()||this.findSiblingOrParent(e.out()):null}getRightMostChild(e){if(!e.in())return e;for(e=e.in();e&&e.next();)e=e.next();return this.getRightMostChild(e)}};Lh.registrationName="basicCursor",t($s.CURSOR,Lh.registrationName,Lh);var Mh=class extends Lh{validNode_(e){let t=!1;const n=e&&e.getType();return e&&(e=e.getLocation(),n===ch.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(t=!0)),t}},Ph=class extends ph{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[Su[t]],this.offsetInBlock=new el(0,0),this.trackedState=Ph.TrackedState.WILL_TRACK}dispose(){let e,t;super.dispose(),this.trackedState===Ph.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),null==(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)||t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e){if(!this.sourceBlock_.workspace.isDragging()){var t=this.sourceBlock_.getRootBlock();if(!t.isInFlyout){var n=!1;if(!t.isMovable()){if(!(t=e.getSourceBlock().getRootBlock()).isMovable())return;e=this,n=!0}var i=m()==t;i||t.addSelect();var r=e.x+Ms.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.x,o=e.y+Ms.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.y;n&&(o=-o),t.RTL&&(r=e.x-Ms.config$$module$build$src$core$config.snapRadius-Math.floor(10*Math.random())-this.x),t.moveBy(r,o,["bump"]),i||t.removeSelect()}}}moveTo(e,t){let n=!1;return this.trackedState===Ph.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Ph.TrackedState.TRACKED,n=!0):this.trackedState===Ph.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),n=!0),this.x=e,this.y=t,n}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const t=this.targetBlock();e&&t&&(e=el.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Ph.TrackedState.TRACKED||!e&&this.trackedState===Ph.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Ph.TrackedState.TRACKED):(this.trackedState===Ph.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Ph.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let t=0;t<e.length;t++){const n=e[t],i=n.getConnections_(!0);for(let e=0;e<i.length;e++)i[e].setTracking(!1);for(const e of n.getIcons())mr(e)&&e.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==Ac.INPUT_VALUE&&this.type!==Ac.NEXT_STATEMENT)return e;const t=this.targetBlock();if(t){let n;t.isCollapsed()?(n=[],t.outputConnection&&n.push(t.outputConnection),t.nextConnection&&n.push(t.nextConnection),t.previousConnection&&n.push(t.previousConnection)):n=t.getConnections_(!0);for(let t=0;t<n.length;t++)e.push(...n[t].startTrackingAll());e.length||(e=[t])}return e}onFailedConnect(e){const t=this.getSourceBlock();if(A()){const n=Ms.getGroup$$module$build$src$core$events$utils();setTimeout(function(){t.isDisposed()||t.getParent()||(Ms.setGroup$$module$build$src$core$events$utils(n),this.bumpAwayFrom(e),Ms.setGroup$$module$build$src$core$events$utils(!1))}.bind(this),Ms.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:t,childConnection:n}=this.getParentAndChildConnections();if(t&&n){var i=t.getSourceBlock(),r=n.getSourceBlock();super.disconnectInternal(e),i.rendered&&i.queueRender(),r.rendered&&(r.updateDisabled(),r.queueRender(),r.getSvgRoot().style.display="block")}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock();const n=t.rendered,i=e.rendered;n&&t.updateDisabled(),i&&e.updateDisabled(),n&&i&&(this.type===Ac.NEXT_STATEMENT||this.type===Ac.PREVIOUS_STATEMENT?e.queueRender():t.queueRender()),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||((this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())}setCheck(e){return super.setCheck(e),this.sourceBlock_.rendered&&this.sourceBlock_.queueRender(),this}};!function(e){(e=e.TrackedState||(e.TrackedState={}))[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"}(Ph||(Ph={}));var Bh=Ph.TrackedState,jh={};jh.RenderedConnection=Ph,jh.TrackedState=Bh;var Fh=class extends Nh{constructor(e,t,n){super(e,t,n),this.width=this.height=0,this.warningTextDb=new Map,this.warning=this.mutator=null,this.eventsInit_=this.renderIsInProgress_=this.visuallyDisabled=this.rendered=!1,this.translation="",this.bumpNeighboursPid=0,this.dragging=!1,this.relativeCoords=new el(0,0),this.workspace=e,this.svgGroup_=ie(dl.G,{}),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style),(e=this.pathObject.svgPath).tooltip=this,nr(e),this.svgGroup_.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");for(let e,t=0;e=this.inputList[t];t++)e.init();for(var e of this.getIcons())e.initView(this.createIconPointerDownListener(e)),e.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()),e=this.getSvgRoot(),this.workspace.options.readOnly||this.eventsInit_||!e||z(e,"pointerdown",this,this.onMouseDown_),this.eventsInit_=!0,e.parentNode||this.workspace.getCanvas().appendChild(e)}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()&&this.getParent())this.getParent().select();else if(m()!==this){var e=null;if(m()){e=m().id,Ms.disable$$module$build$src$core$events$utils();try{m().unselect()}finally{Ms.enable$$module$build$src$core$events$utils()}}e=new(j("selected"))(e,this.id,this.workspace.id),I(e),b(this),this.addSelect()}}unselect(){if(m()===this){var e=new(j("selected"))(this.id,null,this.workspace.id);e.workspaceId=this.workspace.id,I(e),b(null),this.removeSelect()}}setParent(e){const t=this.parentBlock_;if(e!==t){he(),super.setParent(e),pe();var n=this.getSvgRoot();if(!this.workspace.isClearing&&n){var i=this.getRelativeToSurfaceXY();e?e.getSvgRoot().appendChild(n):t&&((e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(n,e):this.workspace.getCanvas().appendChild(n),this.translate(i.x,i.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,n=0,i=this.getSvgRoot();if(i)do{const e=Ce(i);t+=e.x,n+=e.y,i=i.parentNode}while(i&&!e.hasLayer(i));return new el(t,n)}moveBy(e,t,n){if(this.parentBlock_)throw Error("Block has parent");const i=L();let r=null;i&&(r=new(j(Ms.MOVE$$module$build$src$core$events$utils))(this),n&&r.setReason(n)),e=new el(e,t),t=this.getRelativeToSurfaceXY(),e=el.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),i&&r&&(r.recordNew(),I(r)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new el(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){const n=this.getRelativeToSurfaceXY();this.moveBy(e.x-n.x,e.y-n.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!(this.isDeadOrDying()||this.workspace.isDragging()||this.getParent()||this.isInFlyout)){var e=this.workspace.getGrid();if(e&&e.shouldSnap()){var t=e.getSpacing(),n=t/2,i=this.getRelativeToSurfaceXY();e=Math.round(Math.round((i.x-n)/t)*t+n-i.x),t=Math.round(Math.round((i.y-n)/t)*t+n-i.y),(e||t)&&this.moveBy(e,t,["snap"])}}}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY(),t=this.getHeightWidth();let n,i;return this.RTL?(n=e.x-t.width,i=e.x):(n=e.x,i=e.x+t.width),new hl(e.y,e.y+t.height,n,i)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e,t=0;e=this.inputList[t];t++)e.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed_())}updateCollapsed_(){var e=this.isCollapsed();const t="_TEMP_COLLAPSED_INPUT",n="_TEMP_COLLAPSED_FIELD";for(let n,i=0;n=this.inputList[i];i++)n.name!==t&&n.setVisible(!e);for(var i of this.getIcons())i.updateCollapsed();e?(e=this.toString(30),(i=this.getField(n))?i.setValue(e):(this.getInput(t)||this.appendDummyInput(t)).appendField(new ih(e),n)):(this.updateDisabled(),this.removeInput(t))}tab(e,t){const n=new Mh;n.setCurNode(ch.createFieldNode(e)),e=n.getCurNode(),t?n.next():n.prev(),(t=n.getCurNode())&&t!==e&&(t.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(t))}onMouseDown_(e){const t=this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)}showHelp(){const e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const e=tu.registry.getContextMenuOptions(tu.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e}showContextMenu(e){const t=this.generateContextMenu();t&&t.length&&(ei(e,t,this.RTL),Qn(this))}updateComponentLocations(e){if(this.rendered){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const t of this.getChildren(!1))t.updateComponentLocations(el.sum(e,t.relativeCoords))}}updateConnectionLocations(e){for(const t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(const t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(const t of this.inputList)for(const n of t.fieldRow)n.onLocationChange(e)}setDragging(e){(this.dragging=e)?(this.translation="",qs.push(...this.getConnections_(!0)),re(this.svgGroup_,"blocklyDragging")):(qs.length=0,se(this.svgGroup_,"blocklyDragging"));for(let t=0;t<this.childBlocks_.length;t++)this.childBlocks_[t].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e=this.getIcons();for(let t=0;t<e.length;t++)e[t].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(e,t){this.isDeadOrDying()||(ar(),oi(),t&&this.rendered&&(this.unplug(e),Mi(this)),super.dispose(!!e),le(this.svgGroup_))}disposeInternal(){this.isDeadOrDying()||(super.disposeInternal(),this.rendered=!1,m()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach((e=>clearTimeout(e))),this.warningTextDb.clear(),this.getIcons().forEach((e=>e.dispose())))}checkAndDelete(){this.workspace.isFlyout||(Ms.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),Ms.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:Nc.TYPE,blockState:sn(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:E(this,!0)}}applyColour(){this.pathObject.applyColour(this);const e=this.getIcons();for(let t=0;t<e.length;t++)e[t].applyColour();for(let e,t=0;e=this.inputList[t];t++)for(let t,n=0;t=e.fieldRow[n];n++)t.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let e;null==(e=this.getNextBlock())||e.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const e of this.getChildren(!1))e.updateDisabled()}}getCommentIcon(){let e;return ne("getCommentIcon","v10","v11","getIcon"),null!=(e=this.getIcon(Sd.TYPE))?e:null}setWarningText(e,t=""){if(t)this.warningTextDb.has(t)&&(clearTimeout(this.warningTextDb.get(t)),this.warningTextDb.delete(t));else{for(var n of this.warningTextDb.values())clearTimeout(n);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(t,setTimeout((()=>{this.isDeadOrDying()||(this.warningTextDb.delete(t),this.setWarningText(e,t))}),100));else if(this.isInFlyout&&(e=null),n=this.getIcon(Cd.TYPE),e){let i=this.getSurroundParent(),r=null;for(;i;)i.isCollapsed()&&(r=i),i=i.getSurroundParent();r&&r.setWarningText(Ms.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,Fh.COLLAPSED_WARNING_ID),n?n.addMessage(e,t):this.addIcon(new Cd(this).addMessage(e,t))}else n&&(t?(n.addMessage("",t),n.getText()||this.removeIcon(Cd.TYPE)):this.removeIcon(Cd.TYPE))}setMutator(e){this.removeIcon(Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof Cd&&(this.warning=e),e instanceof Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),this.rendered&&(e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),wt(),this.bumpNeighbours()),e}createIconPointerDownListener(e){return t=>{this.isDeadOrDying()||(t=this.workspace.getGesture(t))&&t.setStartIcon(e)}}removeIcon(e){const t=super.removeIcon(e);return e.equals(Cd.TYPE)&&(this.warning=null),e.equals(Ms.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.rendered&&(this.queueRender(),wt(),this.bumpNeighbours()),t}setEnabled(e){this.isEnabled()!==e&&(super.setEnabled(e),this.rendered&&!this.getInheritedDisabled()&&this.updateDisabled())}setHighlighted(e){this.rendered&&this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const t=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,!t)throw Error("Invalid style name: "+e);this.hat=t.hat,this.pathObject.setStyle(t),this.colour_=t.colourPrimary,this.style=t,this.applyColour()}bringToFront(e=!1){let t=this;if(!t.isDeadOrDying())do{const n=t.getSvgRoot(),i=n.parentNode,r=i.childNodes;if(r[r.length-1]!==n&&i.appendChild(n),e)break;t=t.getParent()}while(t)}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setNextStatement(e,t){super.setNextStatement(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setOutput(e,t){super.setOutput(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setInputsInline(e){super.setInputsInline(e),this.rendered&&(this.queueRender(),this.bumpNeighbours())}removeInput(e,t){return e=super.removeInput(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours()),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}appendInput(e){return super.appendInput(e),this.rendered&&(this.queueRender(),this.bumpNeighbours()),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var n=this.inputList[t].connection;n&&(n.setTracking(e),(n=n.targetBlock())&&n.setConnectionTracking(e))}}getConnections_(e){const t=[];if((e||this.rendered)&&(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_))for(let e,n=0;e=this.inputList[n];n++)e.connection&&t.push(e.connection);return t}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Ph(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){if(!this.bumpNeighboursPid){var e=Ms.getGroup$$module$build$src$core$events$utils();this.bumpNeighboursPid=setTimeout((()=>{const t=Ms.getGroup$$module$build$src$core$events$utils();Ms.setGroup$$module$build$src$core$events$utils(e),this.getRootBlock().bumpNeighboursInternal(),Ms.setGroup$$module$build$src$core$events$utils(t),this.bumpNeighboursPid=0}),Ms.config$$module$build$src$core$config.bumpDelay)}}bumpNeighboursInternal(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const t of this.getConnections_(!1)){if(t.isSuperior()){let e;null==(e=t.targetBlock())||e.bumpNeighboursInternal()}for(const n of t.neighbours(Ms.config$$module$build$src$core$config.snapRadius))n.getSourceBlock().getRootBlock()!==e&&(t.isConnected()&&n.isConnected()||(t.isSuperior()?n.bumpAwayFrom(t):t.bumpAwayFrom(n)))}}scheduleSnapAndBump(){const e=Ms.getGroup$$module$build$src$core$events$utils();setTimeout((()=>{Ms.setGroup$$module$build$src$core$events$utils(e),this.snapToGrid(),Ms.setGroup$$module$build$src$core$events$utils(!1)}),Ms.config$$module$build$src$core$config.bumpDelay/2),this.bumpNeighbours()}positionNearConnection(e,t,n){if(e.type===Ac.NEXT_STATEMENT||e.type===Ac.INPUT_VALUE){let i=t.x;t=t.y,i+=n.x-e.getOffsetInBlock().x,t+=n.y-e.getOffsetInBlock().y,this.moveBy(i,t)}}getChildren(e){return super.getChildren(e)}queueRender(){return Tt(this)}render(){this.queueRender(),wt()}renderEfficiently(){this.rendered=!0,he(),this.isCollapsed()&&this.updateCollapsed_(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),pe(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const e of this.inputList){const t=e.connection;t&&t.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(Yu.LOCAL_MARKER).draw();for(const e of this.inputList)for(const t of e.fieldRow)t.updateMarkers_()}setCursorSvg(e){this.pathObject.setCursorSvg(e)}setMarkerSvg(e){this.pathObject.setMarkerSvg(e)}getHeightWidth(){let e=this.height,t=this.width;var n=this.getNextBlock();if(n){n=n.getHeightWidth();const i=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=n.height-i,t=Math.max(t,n.width)}return{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}};Fh.INLINE=-1,Fh.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var $h,Uh=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},Hh=class extends Uh{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e,t){return e instanceof Fh?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e&&!t)):this.updateWouldDelete_(e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},Gh=class extends Hh{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=new Ju({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===Al.TOP?Al.BOTTOM:Al.TOP,this.flyout=new(c($s.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===Al.RIGHT?Al.LEFT:Al.RIGHT,this.flyout=new(c($s.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){let e;this.svgGroup=ie(dl.G,{class:"blocklyTrash"});const t=String(Math.random()).substring(2);e=ie(dl.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup),ie(dl.RECT,{width:Vh,height:Wh,y:zh},e);const n=ie(dl.IMAGE,{width:Bl,x:-Zh,height:jl,y:-Xh,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup);return n.setAttributeNS(sl,"xlink:href",this.workspace.options.pathToMedia+Fl),e=ie(dl.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup),ie(dl.RECT,{width:Vh,height:zh},e),this.svgLid=ie(dl.IMAGE,{width:Bl,x:-Zh,height:jl,y:-Xh,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup),this.svgLid.setAttributeNS(sl,"xlink:href",this.workspace.options.pathToMedia+Fl),q(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),q(this.svgGroup,"pointerup",this,this.click),q(n,"pointerover",this,this.mouseOver),q(n,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(ce(this.flyout.createDom(dl.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[Za.Capability.AUTOHIDEABLE,Za.Capability.DELETE_AREA,Za.Capability.DRAG_TARGET,Za.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&le(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map((function(e){return JSON.parse(e)})),t=this.workspace.getParentSvg().style;t.cursor="wait",setTimeout((()=>{let n,i;null==(n=this.flyout)||n.show(e),t.cursor="",null==(i=this.workspace.scrollbar)||i.setVisible(!1)}),10),this.fireUiEvent(!0)}}closeFlyout(){var e,t;this.contentsIsOpen()&&(null==(e=this.flyout)||e.hide(),null==(t=this.workspace.scrollbar)||t.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){if(this.initialized){var n,i=qe(this.workspace,e);e=ze(i,new pl(Vh,Wh+zh),Yh,qh,e,this.workspace),t=Ye(e,qh,i.vertical===Nl.TOP?Dl.DOWN:Dl.UP,t),this.top=t.top,this.left=t.left,null==(n=this.svgGroup)||n.setAttribute("transform","translate("+this.left+","+this.top+")")}}getBoundingRectangle(){return new hl(this.top,this.top+Wh+zh,this.left,this.left+Vh)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const t=e.top+Xh-Kh;return e=e.left+Zh-Kh,new hl(t,t+zh+Wh+2*Kh,e,e+Vh+2*Kh)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=ep;var t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*ip),t=tp+this.lidOpen*(np-tp),this.svgGroup&&(this.svgGroup.style.opacity=`${t}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),Qh/e))}setLidAngle(e){const t=this.workspace.toolboxPosition===Al.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let n;null==(n=this.svgLid)||n.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:Vh-4)+","+(zh-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*ip)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(j("trashcan_open"))(e,this.workspace.id),I(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||e.type!==Ms.DELETE$$module$build$src$core$events$utils||e.type!==Ms.DELETE$$module$build$src$core$events$utils||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),-1===this.contents.indexOf(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(Jh)}}}cleanBlockJson(e){return function e(t){if(t){if(delete t.id,delete t.x,delete t.y,delete t.enabled,t.icons&&t.icons.comment){var n=t.icons.comment;delete n.height,delete n.width,delete n.pinned}for(var i in n=t.inputs){var r=n[i];const t=r.block;r=r.shadow,t&&e(t),r&&e(r)}t.next&&(t=(i=t.next).block,i=i.shadow,t&&e(t),i&&e(i))}}(e=JSON.parse(JSON.stringify(e))),Object.assign({},{kind:"BLOCK"},e)}},Vh=47,Wh=44,zh=16,qh=20,Yh=20,Kh=10,Zh=0,Xh=32,Jh=.1,Qh=80,ep=4,tp=.4,np=.8,ip=45,rp=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),(t=e.keyCodes)&&0<t.length)for(let n=0;n<t.length;n++)this.addKeyMapping(t[n],e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,n){e=`${e}`;const i=this.keyMap.get(e);if(i&&!n)throw Error(`Shortcut named "${t}" collides with shortcuts "${i}"`);i&&n?i.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,n){const i=this.keyMap.get(e);if(!i)return n||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1;const r=i.indexOf(t);return-1<r?(i.splice(r,1),0===i.length&&this.keyMap.delete(e),!0):(n||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){this.keyMap.clear();for(const t in e)this.keyMap.set(t,e[t])}getKeyMap(){const e=Object.create(null);for(const[t,n]of this.keyMap)e[t]=n;return e}getRegistry(){const e=Object.create(null);for(const[t,n]of this.shortcuts)e[t]=n;return gr(Object.create(null),e)}onKeyDown(e,t){var n=this.serializeKeyEvent_(t);if(!(n=this.getShortcutNamesByKeyCode(n)))return!1;for(let i,r=0;i=n[r];r++){const n=this.shortcuts.get(i);let r,o;if(null==(r=n)||!r.preconditionFn||null!=(o=n)&&o.preconditionFn(e)){let i,r;if(null!=(i=n)&&i.callback&&null!=(r=n)&&r.callback(e,t,n))return!0}}return!1}getShortcutNamesByKeyCode(e){return this.keyMap.get(e)||[]}getKeyCodesByShortcutName(e){const t=[];for(const[n,i]of this.keyMap)-1<i.indexOf(e)&&t.push(n);return t}serializeKeyEvent_(e){let t="";for(const n in rp.modifierKeys)e.getModifierState(n)&&(""!==t&&(t+="+"),t+=n);return""!==t&&e.keyCode?t=t+"+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers_(e){for(let t,n=0;t=e[n];n++)if(!(t in rp.modifierKeys))throw Error(t+" is not a valid modifier key.")}createSerializedKey(e,t){let n="";if(t){this.checkModifiers_(t);for(const e in rp.modifierKeys)-1<t.indexOf(rp.modifierKeys[e])&&(""!==n&&(n+="+"),n+=e)}return""!==n&&e?n=n+"+"+e:e&&(n=`${e}`),n}};rp.registry=new rp,function(e){(e=e.modifierKeys||(e.modifierKeys={}))[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(rp||(rp={})),function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"}($h||($h={}));var op=null,sp=null;Wo();var ap={};ap.names=$h,ap.registerCopy=$o,ap.registerCut=Uo,ap.registerDefaultShortcuts=Wo,ap.registerDelete=Fo,ap.registerEscape=jo,ap.registerPaste=Ho,ap.registerRedo=Vo,ap.registerUndo=Go;var lp={ProcedureSerializer:class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=75}save(e){return(e=e.getProcedureMap().getProcedures().map((e=>zo(e)))).length?e:null}load(e,t){const n=t.getProcedureMap();for(const i of e)n.add(Yo(this.procedureModelClass,this.parameterModelClass,i,t))}clear(e){e.getProcedureMap().clear()}}};lp.loadParameter=Ko,lp.loadProcedure=Yo,lp.saveParameter=qo,lp.saveProcedure=zo;var cp=class{constructor(){this.priority=100}save(e){const t=[];for(const n of e.getAllVariables())e={name:n.name,id:n.getId()},n.type&&(e.type=n.type),t.push(e);return t.length?t:null}load(e,t){for(const n of e)t.createVariable(n.name,n.type,n.id)}clear(e){e.getVariableMap().clear()}};rn("variables",new cp);var up={};up.VariableSerializer=cp;var dp={};dp.load=Xo,dp.save=Zo;var hp={blocks:xc,exceptions:_c,priorities:{BLOCKS:50,PROCEDURES:75,VARIABLES:100},procedures:lp,registry:Ec,variables:up,workspaces:dp},pp=class{constructor(e,t,n,i,r){this.workspace=e,this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null,n=void 0===n||n;const o=(t=void 0===t||t)&&n;t&&(this.hScroll=new vl(e,!0,o,i,r)),n&&(this.vScroll=new vl(e,!1,o,i,r)),o&&(this.corner_=ie(dl.RECT,{height:vl.scrollbarThickness,width:vl.scrollbarThickness,class:"blocklyScrollbarBackground"}),ce(this.corner_,e.getBubbleCanvas()))}dispose(){le(this.corner_),this.oldHostMetrics_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var t=!1,n=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===e.viewWidth&&this.oldHostMetrics_.viewHeight===e.viewHeight&&this.oldHostMetrics_.absoluteTop===e.absoluteTop&&this.oldHostMetrics_.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===e.scrollWidth&&this.oldHostMetrics_.viewLeft===e.viewLeft&&this.oldHostMetrics_.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===e.scrollHeight&&this.oldHostMetrics_.viewTop===e.viewTop&&this.oldHostMetrics_.scrollTop===e.scrollTop||(n=!0)):n=t=!0,t||n){try{Ms.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&n&&this.vScroll.resize(e)}finally{Ms.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==e.viewWidth||this.oldHostMetrics_.absoluteLeft!==e.absoluteLeft){let e;null==(e=this.corner_)||e.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!==e.viewHeight||this.oldHostMetrics_.absoluteTop!==e.absoluteTop){let e;null==(e=this.corner_)||e.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics_=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,n){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),(n||void 0===n)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},fp=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,n=0;return e&&(t=e.getWidth(),n=e.getHeight()),new pl(t,n)}getFlyoutMetrics(e){return{width:(e=this.getDimensionsPx_(this.workspace_.getFlyout(e))).width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;const n=this.getToolboxMetrics(),i=this.getFlyoutMetrics(),r=!!this.workspace_.getToolbox();var o;const s=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=r?n.position:i.position)===Al.TOP;return o===Al.LEFT&&(r&&(e+=n.width),s&&(e+=i.width)),a&&(r&&(t+=n.height),s&&(t+=i.height)),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const t=this.getSvgMetrics(),n=this.getToolboxMetrics(),i=this.getFlyoutMetrics(),r=!!this.workspace_.getToolbox();var o;const s=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=r?n.position:i.position)===Al.LEFT||o===Al.RIGHT;return o!==Al.TOP&&o!==Al.BOTTOM||(r&&(t.height-=n.height),s&&(t.height-=i.height)),a&&(r&&(t.width-=n.width),s&&(t.width-=i.width)),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const t=this.workspace_.isMovableHorizontally(),n=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const i={};return n||(i.top=e.top,i.bottom=e.top+e.height),t||(i.left=e.left,i.right=e.left+e.width),i}getPaddedContent_(e,t){const n=t.top+t.height,i=t.left+t.width,r=e.width,o=r/2,s=(e=e.height)/2;return{top:Math.min(t.top-s,n-e),bottom:Math.max(n+s,t.top+e),left:Math.min(t.left-o,i-r),right:Math.max(i+o,t.left+r)}}getScrollMetrics(e,t,n){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var i=n||this.getContentMetrics();n=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,i),i=void 0!==n.top?n.top:t.top;const r=void 0!==n.left?n.left:t.left;return{top:i/e,left:r/e,width:((void 0!==n.right?n.right:t.right)-r)/e,height:((void 0!==n.bottom?n.bottom:t.bottom)-i)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),n=this.getSvgMetrics(),i=this.getAbsoluteMetrics(),r=this.getViewMetrics(),o=this.getContentMetrics(),s=this.getScrollMetrics(!1,r,o);return{contentHeight:o.height,contentWidth:o.width,contentTop:o.top,contentLeft:o.left,scrollHeight:s.height,scrollWidth:s.width,scrollTop:s.top,scrollLeft:s.left,viewHeight:r.height,viewWidth:r.width,viewTop:r.top,viewLeft:r.left,absoluteTop:i.top,absoluteLeft:i.left,svgHeight:n.height,svgWidth:n.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}};t($s.METRICS_MANAGER,Fs,fp);var gp=class extends ba{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=aa,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};t($s.EVENT,aa,gp);var mp=class extends ya{constructor(e,t,n){super(e?e.workspace.id:void 0),this.type="drag",e&&(this.blockId=e.id,this.isStart=t,this.blocks=n)}toJson(){const e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new mp)).isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}};t($s.EVENT,"drag",mp);var bp={};bp.bumpIntoBounds=Jo,bp.bumpIntoBoundsHandler=Qo,bp.bumpTopObjectsIntoBounds=ts;var yp=class{constructor(e,t){this.connectionCandidate=this.dragTarget_=null,this.wouldDeleteBlock_=!1,this.dragIconData_=[],this.draggingBlock_=e,this.workspace_=t,this.connectionPreviewer=new(c($s.CONNECTION_PREVIEWER,this.workspace_.options))(e),this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY(),this.dragIconData_=ns(e,this.startXY_)}dispose(){this.dragIconData_.length=0,this.connectionPreviewer.dispose()}startDrag(e,t){let n;Ms.getGroup$$module$build$src$core$events$utils()||Ms.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent_(),this.draggingBlock_.bringToFront(!0),he(),this.workspace_.setResizesEnabled(!1),$i(),this.shouldDisconnect_(t)&&this.disconnectBlock_(t,e),this.draggingBlock_.setDragging(!0),null==(n=this.workspace_.getLayerManager())||n.moveToDragLayer(this.draggingBlock_)}shouldDisconnect_(e){return!!(this.draggingBlock_.getParent()||e&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())}disconnectBlock_(e,t){this.draggingBlock_.unplug(e),e=this.pixelsToWorkspaceUnits_(t),e=el.sum(this.startXY_,e),this.draggingBlock_.translate(e.x,e.y),ji(this.draggingBlock_)}fireDragStartEvent_(){const e=new(j("drag"))(this.draggingBlock_,!0,this.draggingBlock_.getDescendants(!1));I(e)}drag(e,t){const n=this.draggingBlock_;this.moveBlock(n,t),this.updateDragTargets(e,n),this.wouldDeleteBlock_=this.wouldDeleteBlock(e,n,t),this.updateCursorDuringBlockDrag_(),this.updateConnectionPreview(n,t)}moveBlock(e,t){t=this.pixelsToWorkspaceUnits_(t),t=el.sum(this.startXY_,t),e.moveDuringDrag(t)}updateDragTargets(e,t){if(e=this.workspace_.getDragTarget(e),this.dragTarget_!==e){let n;null==(n=this.dragTarget_)||n.onDragExit(t),null==e||e.onDragEnter(t)}null==e||e.onDragOver(t),this.dragTarget_=e}wouldDeleteBlock(e,t,n){return!(!(e=this.workspace_.getDragTarget(e))||!this.workspace_.getComponentManager().hasCapability(e.id,Za.Capability.DELETE_AREA))&&e.wouldDelete(t,!!this.getConnectionCandidate(t,n))}updateConnectionPreview(e,t){const n=this.connectionCandidate,i=this.getConnectionCandidate(e,t);if(i){this.connectionCandidate=t=n&&this.currCandidateIsBetter(n,t,i)?n:i;var{local:r,neighbour:o}=t;r.type!==Ac.OUTPUT_VALUE&&r.type!==Ac.PREVIOUS_STATEMENT||!o.isConnected()||o.targetBlock().isInsertionMarker()||this.orphanCanConnectAtEnd(e,o.targetBlock(),r.type)?this.connectionPreviewer.previewConnection(r,o):this.connectionPreviewer.previewReplacement(r,o,o.targetBlock())}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(e,t,n){return!!ph.getConnectionForOrphanedConnection(e,n===Ac.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,n){const{local:i,neighbour:r}=e;e=new el(i.x,i.y);const o=new el(r.x,r.y);return t=el.distance(el.sum(e,t),o),n.distance>t-Ms.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let n=Ms.config$$module$build$src$core$config.snapRadius,i=null;for(const r of e){const{connection:e,radius:o}=r.closest(n,t);e&&(i={local:r,neighbour:e,distance:o},n=o)}return i}getLocalConnections(e){const t=e.getConnections_(!1),n=e.lastConnectionInStack(!0);return n&&n!==e.nextConnection&&t.push(n),t}endDrag(e,t){if(this.drag(e,t),this.fireDragEndEvent_(),pe(),$i(),this.connectionPreviewer.hidePreview(),e=null,this.dragTarget_&&this.dragTarget_.shouldPreventMove(this.draggingBlock_)||(e=this.getNewLocationAfterDrag_(t).delta),this.dragTarget_&&this.dragTarget_.onDrop(this.draggingBlock_),!this.maybeDeleteBlock_()){let t;null==(t=this.workspace_.getLayerManager())||t.moveOffDragLayer(this.draggingBlock_,50),this.draggingBlock_.setDragging(!1),e?this.updateBlockAfterMove_():Jo(this.draggingBlock_.workspace,this.workspace_.getMetricsManager().getScrollMetrics(!0),this.draggingBlock_)}this.connectionPreviewer.dispose(),this.workspace_.setResizesEnabled(!0),Ms.setGroup$$module$build$src$core$events$utils(!1)}getNewLocationAfterDrag_(e){return{delta:e=this.pixelsToWorkspaceUnits_(e),newLocation:el.sum(this.startXY_,e)}}maybeDeleteBlock_(){return!!this.wouldDeleteBlock_&&(this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0),qs.length=0,!0)}updateBlockAfterMove_(){this.fireMoveEvent_(),this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.draggingBlock_.queueRender(),this.draggingBlock_.scheduleSnapAndBump()}applyConnections(e){const{local:t,neighbour:n}=e;if(t.connect(n),this.draggingBlock_.rendered){const e=t.isSuperior()?n:t,i=this.draggingBlock_.getRootBlock();xt().then((()=>{Bi(e.getSourceBlock()),setTimeout((()=>{i.bringToFront()}),0)}))}}fireDragEndEvent_(){const e=new(j("drag"))(this.draggingBlock_,!1,this.draggingBlock_.getDescendants(!1));I(e)}updateToolboxStyle_(e){const t=this.workspace_.getToolbox();if(t){const n=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";e&&"function"==typeof t.removeStyle?t.removeStyle(n):e||"function"!=typeof t.addStyle||t.addStyle(n)}}fireMoveEvent_(){if(!this.draggingBlock_.isDeadOrDying()){var e=new(j(Ms.MOVE$$module$build$src$core$events$utils))(this.draggingBlock_);e.setReason(["drag"]),e.oldCoordinate=this.startXY_,e.recordNew(),I(e)}}updateCursorDuringBlockDrag_(){this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_)}pixelsToWorkspaceUnits_(e){return e=new el(e.x/this.workspace_.scale,e.y/this.workspace_.scale),this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale),e}dragIcons_(){ne("Blockly.BlockDragger.prototype.dragIcons_","v10","v11")}getInsertionMarkers(){return this.workspace_.getAllBlocks().filter((e=>e.isInsertionMarker()))}};t($s.BLOCK_DRAGGER,Fs,yp);var vp={};vp.Bubble=gd,vp.MiniWorkspaceBubble=md,vp.TextBubble=wd,vp.TextInputBubble=kd;var _p=class extends wc{constructor(e,t,n,i){super(e),this.type=Qs,this.recordUndo=!1,e&&(this.name=t,this.oldValue=n,this.newValue=i)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new _p)).name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};t($s.EVENT,Qs,_p);var Ep=class extends wc{constructor(e){super(e),this.type=Ms.MOVE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Ep)).oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(n=e.oldCoordinate.split(","),t.oldCoordinate=new el(Number(n[0]),Number(n[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(n=e.newCoordinate.split(","),t.newCoordinate=new el(Number(n[0]),Number(n[1]))),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}recordNew(){const e=this.currentLocation_();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation_(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t=e.getBlockById(this.blockId);if(!t)throw Error("The block associated with the block move event could not be found");e={};const n=t.getParent();return n?(e.parentId=n.id,(t=n.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&el.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var n=t.getBlockById(this.blockId);if(n){var i=e?this.newParentId:this.oldParentId,r=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,i){var o=t.getBlockById(i);if(!o)return void console.warn("Can't connect to non-existent block: "+i)}if(n.getParent()&&n.unplug(),e)r=n.getRelativeToSurfaceXY(),n.moveBy(e.x-r.x,e.y-r.y,this.reason);else{let e,i;(!(t=n.outputConnection)||n.previousConnection&&n.previousConnection.isConnected())&&(t=n.previousConnection),n=null==(i=t)?void 0:i.type,r?(n=o.getInput(r))&&(e=n.connection):n===Ac.PREVIOUS_STATEMENT&&(e=o.nextConnection),e&&t?t.connect(e):console.warn("Can't connect to non-existent input: "+r)}}else console.warn("Can't move non-existent block: "+this.blockId)}};t($s.EVENT,Ms.MOVE$$module$build$src$core$events$utils,Ep);var Tp,xp=class extends ya{constructor(e,t,n){super(e?e.workspace.id:void 0),this.type=ia,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=n)}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new xp)).isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}};!function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"}(Tp||(Tp={})),t($s.EVENT,ia,xp);var wp={};wp.BubbleOpen=xp,wp.BubbleType=Tp;var kp=class extends ba{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=Ms.getGroup$$module$build$src$core$events$utils(),this.recordUndo=A())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new kp)).commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){var n=e.getEventWorkspace_();if(t){if(t=Ms.createElement$$module$build$src$core$utils$xml("xml"),!e.xml)throw Error("Ecountered a comment event without proper xml");t.appendChild(e.xml),Ms.domToWorkspace$$module$build$src$core$xml(t,n)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(n=n.getCommentById(e.commentId))?n.dispose():console.warn("Can't uncreate non-existent comment: "+e.commentId)}}},Sp=class extends kp{constructor(e,t,n){super(e),this.type="comment_change",e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===n?"":n)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Sp)).oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var n=e?this.newContents_:this.oldContents_;if(!n){if(e)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson")}t.setContent(n)}else console.warn("Can't change non-existent comment: "+this.commentId)}};t($s.EVENT,"comment_change",Sp);var Cp=class extends kp{constructor(e){super(e),this.type=oa,e&&(this.xml=e.toXmlWithXY())}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");return e.xml=jt(this.xml),e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Cp)).xml=Ms.textToDom$$module$build$src$core$utils$xml(e.xml),t}run(e){kp.CommentCreateDeleteHelper(this,e)}};t($s.EVENT,oa,Cp);var Ap=class extends kp{constructor(e){super(e),this.type="comment_delete",e&&(this.xml=e.toXmlWithXY())}run(e){kp.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");return e.xml=jt(this.xml),e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Ap)).xml=Ms.textToDom$$module$build$src$core$utils$xml(e.xml),t}};t($s.EVENT,"comment_delete",Ap);var Ip=class extends kp{constructor(e){super(e),this.type=sa,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,t,n){return t=super.fromJson(e,t,null!=n?n:new Ip),n=e.oldCoordinate.split(","),t.oldCoordinate_=new el(Number(n[0]),Number(n[1])),n=e.newCoordinate.split(","),t.newCoordinate_=new el(Number(n[0]),Number(n[1])),t}isNull(){return el.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newCoordinate_:this.oldCoordinate_))throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");var n=t.getRelativeToSurfaceXY();t.moveBy(e.x-n.x,e.y-n.y)}else console.warn("Can't move non-existent comment: "+this.commentId)}};t($s.EVENT,sa,Ip);var Op=class extends ya{constructor(e,t,n){super(n),this.type="toolbox_item_select",this.oldItem=null!=e?e:void 0,this.newItem=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,n){return(t=super.fromJson(e,t,null!=n?n:new Op)).oldItem=e.oldItem,t.newItem=e.newItem,t}};t($s.EVENT,"toolbox_item_select",Op),Ms.CHANGE$$module$build$src$core$events$utils,Ms.CREATE$$module$build$src$core$events$utils,Ms.DELETE$$module$build$src$core$events$utils,Ms.MOVE$$module$build$src$core$events$utils,Ms.CHANGE$$module$build$src$core$events$utils,Ms.CREATE$$module$build$src$core$events$utils,Ms.DELETE$$module$build$src$core$events$utils,Ms.MOVE$$module$build$src$core$events$utils,Ms.disable$$module$build$src$core$events$utils,Ms.enable$$module$build$src$core$events$utils,Ms.getGroup$$module$build$src$core$events$utils,Ms.setGroup$$module$build$src$core$events$utils;var Np={};Np.Abstract=ba,Np.BLOCK_CHANGE=Ms.CHANGE$$module$build$src$core$events$utils,Np.BLOCK_CREATE=Ms.CREATE$$module$build$src$core$events$utils,Np.BLOCK_DELETE=Ms.DELETE$$module$build$src$core$events$utils,Np.BLOCK_DRAG="drag",Np.BLOCK_FIELD_INTERMEDIATE_CHANGE=Qs,Np.BLOCK_MOVE=Ms.MOVE$$module$build$src$core$events$utils,Np.BUBBLE_OPEN=ia,Np.BUMP_EVENTS=la,Np.BlockBase=wc,Np.BlockChange=Qu,Np.BlockCreate=kc,Np.BlockDelete=Oh,Np.BlockDrag=mp,Np.BlockFieldIntermediateChange=_p,Np.BlockMove=Ep,Np.BubbleOpen=xp,Np.BubbleType=Tp,Np.CHANGE=Ms.CHANGE$$module$build$src$core$events$utils,Np.CLICK=na,Np.COMMENT_CHANGE="comment_change",Np.COMMENT_CREATE=oa,Np.COMMENT_DELETE="comment_delete",Np.COMMENT_MOVE=sa,Np.CREATE=Ms.CREATE$$module$build$src$core$events$utils,Np.Click=va,Np.ClickTarget=ga,Np.CommentBase=kp,Np.CommentChange=Sp,Np.CommentCreate=Cp,Np.CommentDelete=Ap,Np.CommentMove=Ip,Np.DELETE=Ms.DELETE$$module$build$src$core$events$utils,Np.FINISHED_LOADING=aa,Np.FinishedLoading=gp,Np.MARKER_MOVE="marker_move",Np.MOVE=Ms.MOVE$$module$build$src$core$events$utils,Np.MarkerMove=uh,Np.SELECTED="selected",Np.Selected=ic,Np.THEME_CHANGE="theme_change",Np.TOOLBOX_ITEM_SELECT="toolbox_item_select",Np.TRASHCAN_OPEN="trashcan_open",Np.ThemeChange=Cc,Np.ToolboxItemSelect=Op,Np.TrashcanOpen=Ih,Np.UI=ta,Np.UiBase=ya,Np.VAR_CREATE=ea,Np.VAR_DELETE="var_delete",Np.VAR_RENAME="var_rename",Np.VIEWPORT_CHANGE=ra,Np.VarBase=Zl,Np.VarCreate=Xl,Np.VarDelete=Th,Np.VarRename=xh,Np.ViewportChange=Ic,Np.clearPendingUndo=D,Np.disable=Ms.disable$$module$build$src$core$events$utils,Np.disableOrphans=F,Np.enable=Ms.enable$$module$build$src$core$events$utils,Np.filter=R,Np.fire=I,Np.fromJson=B,Np.get=j,Np.getDescendantIds=P,Np.getGroup=Ms.getGroup$$module$build$src$core$events$utils,Np.getRecordUndo=A,Np.isEnabled=L,Np.setGroup=Ms.setGroup$$module$build$src$core$events$utils,Np.setRecordUndo=C;var Rp=class extends eh{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&le(this.selectedGlowFilter),this.replacementGlowFilter&&le(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:to("c",[eo(25,-e),eo(71,-e),eo(t,0)])}}makeHexagonal(){function e(e,n,i){var r=e/2;return ro(-(i=i?-1:1)*(r=r>t?t:r),e=(n?-1:1)*e/2)+ro(i*r,e)}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeRounded(){function e(e,t,i){const r=e>n?e-n:0,o=i===t?"0":"1";return ao("a","0 0,"+o,e=(e>n?n:e)/2,eo((i?1:-1)*e,(t?-1:1)*e))+so("v",(t?-1:1)*r)+ao("a","0 0,"+o,e,eo((i?-1:1)*e,(t?-1:1)*e))}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,n=2*t;return{type:this.SHAPES.ROUND,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeSquared(){function e(e,n,i){e-=2*t;const r=i===n?"0":"1";return ao("a","0 0,"+r,t,eo((i?1:-1)*t,(n?-1:1)*t))+so("v",(n?-1:1)*e)+ao("a","0 0,"+r,t,eo((i?-1:1)*t,(n?-1:1)*t))}const t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:e=>t,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case Ac.INPUT_VALUE:case Ac.OUTPUT_VALUE:if(null!==(e=e.getSourceBlock().getOutputShape()))switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&-1!==t.indexOf("Boolean")?this.HEXAGONAL:(t&&-1!==t.indexOf("Number")||t&&t.indexOf("String"),this.ROUNDED);case Ac.PREVIOUS_STATEMENT:case Ac.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(e){return to("c",[eo(e*r/2,0),eo(e*r*3/4,s/2),eo(e*r,s)])+oo([eo(e*r,o)])+to("c",[eo(e*r/4,s/2),eo(e*r/2,s),eo(e*r,s)])+so("h",e*i)+to("c",[eo(e*r/2,0),eo(e*r*3/4,-s/2),eo(e*r,-s)])+oo([eo(e*r,-o)])+to("c",[eo(e*r/4,-s/2),eo(e*r/2,-s),eo(e*r,-s)])}const t=this.NOTCH_WIDTH,n=this.NOTCH_HEIGHT,i=t/3,r=i/3,o=n/2,s=o/2,a=e(1),l=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:n,pathLeft:a,pathRight:l}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=ao("a","0 0,0",e,eo(-e,e)),n=ao("a","0 0,1",e,eo(-e,e));return{width:e,height:e,pathTop:t,pathBottom:ao("a","0 0,0",e,eo(e,e)),rightWidth:e,rightHeight:e,pathTopRight:n,pathBottomRight:ao("a","0 0,1",e,eo(e,e))}}generateSecondaryColour_(e){return kr("#000",e,.15)||e}generateTertiaryColour_(e){return kr("#000",e,.25)||e}createDom(e,t,n){super.createDom(e,t,n),e=ie(dl.DEFS,{},e),t=ie(dl.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ie(dl.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),n=ie(dl.FECOMPONENTTRANSFER,{result:"outBlur"},t),ie(dl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},n),ie(dl.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),ie(dl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=ie(dl.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),ie(dl.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=ie(dl.FECOMPONENTTRANSFER,{result:"outBlur"},e),ie(dl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),ie(dl.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),ie(dl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),ie(dl.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text,`,`${e} .blocklyNonEditableText>g>text,`,`${e} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .goog-menuitem,`,`${e}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .goog-menuitem-content {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Dp=class extends nh{constructor(e,t){super(e,t)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(Rd.isSpacer(e)){const i=e.precedesStatement;var t=e.followsStatement;if(i||t){const r=this.constants_.INSIDE_CORNERS;var n=r.rightHeight;return n=e.height-(i?n:0),t=t?r.pathBottomRight:"",e=0<n?so("V",e.yPos+n):"",void(this.outlinePath_+=t+e+(i?r.pathTopRight:""))}}this.outlinePath_+=so("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=io(e.xPos,this.info_.startY),this.outlinePath_+=so("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=so("V",e.baseline),this.outlinePath_+=so("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=no(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){const t=e.width-2*e.connectionWidth,n=e.height;return so("h",t)+e.shape.pathRightDown(n)+so("h",-t)+e.shape.pathUp(n)+"z"}drawStatementInput_(e){var t=e.getLastInput();const n=t.xPos+t.notchOffset+t.shape.width,i=this.constants_.INSIDE_CORNERS,r=t.shape.pathRight+so("h",-(t.notchOffset-i.width))+i.pathTop,o=e.height-2*i.height;t=i.pathBottom+so("h",t.notchOffset-i.width)+(t.connectedBottomNextConnection?"":t.shape.pathLeft),this.outlinePath_+=so("H",n)+r+so("v",o)+t+so("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const t=e.connectionModel;if(t.type===Ac.NEXT_STATEMENT||t.type===Ac.PREVIOUS_STATEMENT||t.type===Ac.OUTPUT_VALUE&&!e.isDynamicShape)super.drawConnectionHighlightPath(e);else{e=t.type===Ac.INPUT_VALUE?no(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):no(e.width,-e.height/2)+e.shape.pathDown(e.height);var n,i,r=t.getSourceBlock();null==(i=(n=r.pathObject).addConnectionHighlight)||i.call(n,t,e,t.getOffsetInBlock(),r.RTL)}}},Lp=class extends od{constructor(e,t,n,i,r,o,s){if(super(od.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",n=Number(Ir(n)),t=Number(Ir(t)),isNaN(n)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(0>=n||0>=t)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new pl(t,n+Lp.Y_PADDING),this.imageHeight=n,"function"==typeof r&&(this.clickHandler=r),e!==od.SKIP_SETUP&&(s?this.configure_(s):(this.flipRtl=!!o,this.altText=Ir(i)||""),this.setValue(Ir(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=Ir(e.alt))}initView(){this.imageElement=ie(dl.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(sl,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return"string"!=typeof e?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(sl,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};Lp.Y_PADDING=1,Lr("field_image",Lp),Lp.prototype.DEFAULT_VALUE="";var Mp=class extends od{constructor(e,t,n){super(od.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),void 0!==e.spellcheck&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new sd;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new sd;let t;return this.fullBlockClickTarget_=!(null==(t=this.getConstants())||!t.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.htmlInput_.getAttribute("data-untyped-default-value"),this.sourceBlock_&&L()&&I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new sd;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.style.colourTertiary)):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(se(e,"blocklyInvalidInput"),jn(e,jc.INVALID,!1)):(re(e,"blocklyInvalidInput"),jn(e,jc.INVALID,!0))}if(!(e=this.getSourceBlock()))throw new sd;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,t=!1){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(Ga||Fa||$a)?this.showPromptEditor_():this.showInlineEditor_(t)}showPromptEditor_(){et(Ms.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),(e=>{null!==e&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)}))}showInlineEditor_(e){const t=this.getSourceBlock();if(!t)throw new sd;Hn(this,t.RTL,this.widgetDispose_.bind(this)),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new sd;Ms.setGroup$$module$build$src$core$events$utils(!0);const t=Fn();var n=this.getClickTarget_();if(!n)throw Error("A click target has not been set.");re(n,"editing"),(n=document.createElement("input")).className="blocklyHtmlInput",n.setAttribute("spellcheck",this.spellcheck_);const i=this.workspace_.getScale();var r=this.getConstants().FIELD_TEXT_FONTSIZE*i+"pt";return t.style.fontSize=r,n.style.fontSize=r,r=Mp.BORDERRADIUS*i+"px",this.isFullBlockField()&&(r=((r=this.getScaledBBox()).bottom-r.top)/2+"px",e=e.getParent()?e.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,n.style.border=1*i+"px solid "+e,t.style.borderRadius=r,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*i+"px")),n.style.borderRadius=r,t.appendChild(n),n.value=n.defaultValue=this.getEditorText_(this.value_),n.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(n),n}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&L()&&null!==this.valueWhenEditorWasOpened_&&this.valueWhenEditorWasOpened_!==this.value_&&(I(new(j(Ms.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),Ms.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=Fn().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,!(e=this.getClickTarget_()))throw Error("A click target has not been set.");se(e,"editing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper_=z(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=z(e,"input",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(Y(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(Y(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(e){"Enter"===e.key?(Gn(),Ri()):"Escape"===e.key?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),Gn(),Ri()):"Tab"===e.key&&(Gn(),Ri(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())}onHtmlInputChange_(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&L()&&this.value_!==e&&I(new(j(Qs))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){var e=this.getSourceBlock();if(!e)throw new sd;const t=Fn(),n=this.getScaledBBox();t.style.width=n.right-n.left+"px",t.style.height=n.bottom-n.top+"px",e=new el(e.RTL?n.right-t.offsetWidth:n.left,n.top),t.style.left=e.x+"px",t.style.top=e.y+"px"}repositionForWindowResize(){const e=this.getSourceBlock();return e instanceof Fh&&(Jo(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),e)||this.resizeEditor_(),!0)}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};Mp.BORDERRADIUS=4;var Pp=class extends Mp{constructor(e,t,n){super(e,t,n)}doClassValidation_(e){return void 0===e?null:`${e}`}static fromJson(e){return new this(Ir(e.text),void 0,e)}};Lr("field_input",Pp),Pp.prototype.DEFAULT_VALUE="";var Bp=class extends Md{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},jp=class extends Vd{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},Fp=class extends Dd{constructor(e){super(e),this.width=this.height=0,this.type|=Rd.getType("RIGHT_CONNECTION")}},$p=class extends Qd{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},Up=class extends lh{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new $p(this.constants_),this.bottomRow=new Bp(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new Fp(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return!!t&&(t instanceof sh||e instanceof ah||t instanceof ah||(e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input||e instanceof oh||e instanceof sh)&&(!this.isInline||this.isMultiRow))}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&Rd.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&Rd.isLeftRoundedCorner(e)&&t&&(Rd.isPreviousConnection(t)||Rd.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&Rd.isLeftSquareCorner(e)&&t&&Rd.isHat(t)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){if(Rd.isTopRow(e)&&Rd.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const n=Rd.isInputRow(e)&&e.hasStatement,i=Rd.isInputRow(t)&&t.hasStatement;return i||n?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),i&&n?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):Rd.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):Rd.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,t){const n=this.width-this.startX;return Rd.isInputRow(e)&&e.hasStatement||Rd.isInputRow(t)&&t.hasStatement?Math.max(n,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):n}getElemCenterline_(e,t){if(e.hasStatement&&!Rd.isSpacer(t)&&!Rd.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(Rd.isInlineInput(t)&&t instanceof Bd){const n=t.connectedBlock;if(n&&n.outputConnection&&n.nextConnection)return e.yPos+n.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof oh||e instanceof sh)&&t.hasDummyInput&&t.align===Ms.Align$$module$build$src$core$inputs$align.LEFT&&e.align===Ms.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof ah)return t.elements.push(new jp(this.constants_,e)),t.hasStatement=!0,void(null===t.align&&(t.align=e.align));super.addInput_(e,t)}addAlignmentPadding_(e,t){if(this.rightAlignedDummyInputs.get(e)){let n;for(let t=0;t<e.elements.length;t++){const i=e.elements[t];if(Rd.isSpacer(i)&&(n=i),Rd.isField(i)&&i instanceof Fd&&i.parentInput===this.rightAlignedDummyInputs.get(e))break}if(n)return n.width+=t,void(e.width+=t)}super.addAlignmentPadding_(e,t)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let t=e;for(let r=2;r<this.rows.length-1;r+=2){var n=this.rows[r-1];const o=this.rows[r];var i=this.rows[r+1];if(n=2===r?!!this.topRow.hasPreviousConnection:!!n.followsStatement,i=r+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!i.precedesStatement,Rd.isInputRow(o)&&o.hasStatement){let n,i;o.measure(),t=o.width-(null!=(i=null==(n=o.getLastInput())?void 0:n.width)?i:0)+e}else if(n&&(2===r||i)&&Rd.isInputRow(o)&&!o.hasStatement){i=o.xPos,n=null;for(let e=0;e<o.elements.length;e++){const r=o.elements[e];Rd.isSpacer(r)&&(n=r),n&&(Rd.isField(r)||Rd.isInput(r))&&i<t&&!(Rd.isField(r)&&r instanceof Fd&&(r.field instanceof ih||r.field instanceof Lp))&&(n.width+=t-i),i+=r.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,n=0;n<this.rows.length;n++){const e=this.rows[n];e.yPos=t,t+=e.height}this.height=t,n=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(n),n=e.width(n),this.outputConnection.height=t,this.outputConnection.width=n,this.outputConnection.startX=n,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(n),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=n,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=n,this.width+=n+e,this.widthWithChildren+=n+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,t=0;t<this.rows.length;t++){var n=this.rows[t];if(!Rd.isInputRow(n))continue;e=n.elements[n.elements.length-2];let i=this.getNegativeSpacing_(n.elements[1]),r=this.getNegativeSpacing_(e);e=i+r;const o=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<o&&(i=(e=this.width-o)/2,r=e/2),n.elements.unshift(new Hd(this.constants_,-i)),n.elements.push(new Hd(this.constants_,-r))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,t=0;t<this.rows.length;t++)n=this.rows[t],Rd.isTopOrBottomRow(n)&&(n.elements[1].width-=e),n.width-=e,n.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const t=this.outputConnection.width;var n=this.outputConnection.shape.type;const i=this.constants_;if(1<this.inputRows.length)switch(n){case i.SHAPES.ROUND:return n=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,t-(n=this.height/2>n?n:this.height/2)*(1-Math.sin(Math.acos((n-this.constants_.SMALL_PADDING)/n)));default:return 0}if(Rd.isInlineInput(e)&&e instanceof Bd){const r=e.connectedBlock;return null==(e=r?r.pathObject.outputShapeType:e.shape.type)||r&&r.outputConnection&&(r.statementInputCount||r.nextConnection)||n===i.SHAPES.HEXAGONAL&&n!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[n][e]}return Rd.isField(e)&&e instanceof Fd?n===i.SHAPES.ROUND&&e.field instanceof Pp?t-2.75*i.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[n][0]:Rd.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let i=2;i<this.rows.length-1;i+=2){const r=this.rows[i-1],o=this.rows[i],s=this.rows[i+1];var e=2===i,t=i+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!s.precedesStatement;if(e?this.topRow.hasPreviousConnection:r.followsStatement){var n=o.elements[1];if(n=3===o.elements.length&&n instanceof Fd&&(n.field instanceof ih||n.field instanceof Lp),!e&&n)r.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.SMALL_PADDING,o.height-=this.constants_.MEDIUM_PADDING;else if(e||t){if(t){for(e=!1,t=0;t<o.elements.length;t++)if((n=o.elements[t])instanceof Bd&&Rd.isInlineInput(n)&&n.connectedBlock&&!n.connectedBlock.isShadow()&&40<=n.connectedBlock.getHeightWidth().height){e=!0;break}e&&(r.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.SMALL_PADDING)}}else r.height+=this.constants_.SMALL_PADDING}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},Hp=class extends dh{constructor(e,t,n){super(e,t,n),this.markerCircle=null}showWithInputOutput(e){const t=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle(e.x,e.y),this.setParent_(t),this.showCurrent_()}showWithOutput_(e){this.showWithInputOutput(e)}showWithInput_(e){this.showWithInputOutput(e)}showWithBlock_(e){const t=(e=e.getLocation()).getHeightWidth();this.positionRect_(0,0,t.width,t.height),this.setParent_(e),this.showCurrent_()}positionCircle(e,t){let n,i;null==(n=this.markerCircle)||n.setAttribute("cx",`${e}`),null==(i=this.markerCircle)||i.setAttribute("cy",`${t}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=ie(dl.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();ie(dl.ANIMATE,e,this.markerCircle)}return this.markerSvg_}applyColour_(e){let t,n;if(super.applyColour_(e),null==(t=this.markerCircle)||t.setAttribute("fill",this.colour_),null==(n=this.markerCircle)||n.setAttribute("stroke",this.colour_),this.isCursor()){let t;e=this.colour_+";transparent;transparent;",null==(t=this.markerCircle)||t.firstElementChild.setAttribute("values",e)}}},Gp=class extends hh{constructor(e,t,n){super(e,t,n),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=n}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const t=e.getParent();e.isShadow()&&t&&this.svgPath.setAttribute("stroke",t.style.colourTertiary);for(const e of this.outlines.values())e.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){(e=this.getOutlinePath(e)).setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,ie(dl.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,n;null==(t=this.outlines.get(e))||null==(n=t.parentNode)||n.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},Vp=class extends bh{constructor(e){super(e)}makeConstants_(){return new Rp}makeRenderInfo_(e){return new Up(this,e)}makeDrawer_(e,t){return new Dp(e,t)}makeMarkerDrawer(e,t){return new Hp(e,this.getConstants(),t)}makePathObject(e,t){return new Gp(e,t,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(e,t,n){return ne("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Ac.OUTPUT_VALUE?e.isConnected()?fh.PREVIEW_TYPE.REPLACEMENT_FADE:fh.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(e,t,n)}};Ao("zelos",Vp);var Wp={};Wp.BottomRow=Bp,Wp.ConstantProvider=Rp,Wp.Drawer=Dp,Wp.MarkerSvg=Hp,Wp.PathObject=Gp,Wp.RenderInfo=Up,Wp.Renderer=Vp,Wp.RightConnectionShape=Fp,Wp.StatementInput=jp,Wp.TopRow=$p,Ts();var zp={};zp.registerCleanup=os,zp.registerCollapse=as,zp.registerCollapseExpandBlock=bs,zp.registerComment=gs,zp.registerDefaultOptions=Ts,zp.registerDelete=vs,zp.registerDeleteAll=hs,zp.registerDisable=ys,zp.registerDuplicate=fs,zp.registerExpand=ls,zp.registerHelp=_s,zp.registerInline=ms,zp.registerRedo=rs,zp.registerUndo=is;var qp,Yp=class extends Mp{constructor(e,t,n){super(od.SKIP_SETUP),this.clockwise=Yp.CLOCKWISE,this.offset=Yp.OFFSET,this.wrap=Yp.WRAP,this.round=Yp.ROUND,this.boundEvents=[],this.symbol_=this.gauge=this.line=null,e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){switch(super.configure_(e),e.mode){case qp.COMPASS:this.clockwise=!0,this.offset=90;break;case qp.PROTRACTOR:this.clockwise=!1,this.offset=0}e.clockwise&&(this.clockwise=e.clockwise),e.offset&&(this.offset=e.offset),e.wrap&&(this.wrap=e.wrap),e.round&&(this.round=e.round)}initView(){super.initView(),this.symbol_=ie(dl.TSPAN,{}),this.symbol_.appendChild(document.createTextNode("")),this.getTextElement().appendChild(this.symbol_)}render_(){super.render_(),this.updateGraph()}showEditor_(e){super.showEditor_(e,Ga||Fa||$a),e=this.dropdownCreate(),mi().appendChild(e),this.sourceBlock_ instanceof Fh&&yi(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary),_i(this,this.dropdownDispose.bind(this)),this.updateGraph()}dropdownCreate(){const e=ie(dl.SVG,{xmlns:rl,"xmlns:html":ol,"xmlns:xlink":sl,version:"1.1",height:2*Yp.HALF+"px",width:2*Yp.HALF+"px"});e.style.touchAction="none";const t=ie(dl.CIRCLE,{cx:Yp.HALF,cy:Yp.HALF,r:Yp.RADIUS,class:"blocklyAngleCircle"},e);this.gauge=ie(dl.PATH,{class:"blocklyAngleGauge"},e),this.line=ie(dl.LINE,{x1:Yp.HALF,y1:Yp.HALF,class:"blocklyAngleLine"},e);for(let t=0;360>t;t+=15)ie(dl.LINE,{x1:Yp.HALF+Yp.RADIUS,y1:Yp.HALF,x2:Yp.HALF+Yp.RADIUS-(0==t%45?10:5),y2:Yp.HALF,class:"blocklyAngleMarks",transform:"rotate("+t+","+Yp.HALF+","+Yp.HALF+")"},e);return this.boundEvents.push(z(e,"click",this,this.hide)),this.boundEvents.push(z(t,"pointerdown",this,this.onMouseMove_,!0)),this.boundEvents.push(z(t,"pointermove",this,this.onMouseMove_,!0)),e}dropdownDispose(){for(const e of this.boundEvents)Y(e);this.boundEvents.length=0,this.line=this.gauge=null}hide(){Oi(this),Gn()}onMouseMove_(e){var t=this.gauge.ownerSVGElement.getBoundingClientRect();const n=e.clientX-t.left-Yp.HALF;e=e.clientY-t.top-Yp.HALF,t=Math.atan(-e/n),isNaN(t)||(t=di(t),0>n?t+=180:0<e&&(t+=360),t=this.clockwise?this.offset+360-t:360-(this.offset-t),this.displayMouseOrKeyboardValue(t))}displayMouseOrKeyboardValue(e){if(this.round&&(e=Math.round(e/this.round)*this.round),(e=this.wrapValue(e))!==this.value_){const t=this.value_;this.setEditorValue_(e,!1),this.sourceBlock_&&L()&&this.value_!==t&&I(new(j(Qs))(this.sourceBlock_,this.name||null,t,this.value_))}}updateGraph(){if(this.gauge&&this.line){var e=Number(this.getText())+this.offset,t=ui(e%360);e=["M ",Yp.HALF,",",Yp.HALF];var n=Yp.HALF,i=Yp.HALF;if(!isNaN(t)){const r=Number(this.clockwise),o=ui(this.offset),s=Math.cos(o)*Yp.RADIUS,a=Math.sin(o)*-Yp.RADIUS;r&&(t=2*o-t),n+=Math.cos(t)*Yp.RADIUS,i-=Math.sin(t)*Yp.RADIUS,t=Math.abs(Math.floor((t-o)/Math.PI)%2),r&&(t=1-t),e.push(" l ",s,",",a," A ",Yp.RADIUS,",",Yp.RADIUS," 0 ",t," ",r," ",n,",",i," z")}this.gauge.setAttribute("d",e.join("")),this.line.setAttribute("x2",`${n}`),this.line.setAttribute("y2",`${i}`)}}onHtmlInputKeyDown_(e){super.onHtmlInputKeyDown_(e);var t=this.getSourceBlock();if(!t)throw new sd;let n=0;switch(e.key){case"ArrowLeft":n=t.RTL?1:-1;break;case"ArrowRight":n=t.RTL?-1:1;break;case"ArrowDown":n=-1;break;case"ArrowUp":n=1}n&&(t=this.getValue(),this.displayMouseOrKeyboardValue(t+n*this.round),e.preventDefault(),e.stopPropagation())}doClassValidation_(e){return e=Number(e),isNaN(e)||!isFinite(e)?null:this.wrapValue(e)}wrapValue(e){return 0>(e%=360)&&(e+=360),e>this.wrap&&(e-=360),e}static fromJson(e){return new this(e.angle,void 0,e)}};Yp.HALF=50,Yp.RADIUS=Yp.HALF-1,Yp.CLOCKWISE=!1,Yp.OFFSET=0,Yp.WRAP=360,Yp.ROUND=15,Lr("field_angle",Yp),Yp.prototype.DEFAULT_VALUE=0,ee("\n.blocklyAngleCircle {\n  stroke: #444;\n  stroke-width: 1;\n  fill: #ddd;\n  fill-opacity: 0.8;\n}\n\n.blocklyAngleMarks {\n  stroke: #444;\n  stroke-width: 1;\n}\n\n.blocklyAngleGauge {\n  fill: #f88;\n  fill-opacity: 0.8;\n  pointer-events: none;\n}\n\n.blocklyAngleLine {\n  stroke: #f00;\n  stroke-width: 2;\n  stroke-linecap: round;\n  pointer-events: none;\n}\n"),function(e){e.COMPASS="compass",e.PROTRACTOR="protractor"}(qp||(qp={}));var Kp={};Kp.FieldAngle=Yp,Kp.Mode=qp;var Zp=class extends od{constructor(e,t,n){super(od.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=Zp.CHECK_CHAR,e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(Zp);return null!==e?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();re(e,"blocklyCheckbox"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||Zp.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool_(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(e){return"string"==typeof e?"TRUE"===e:!!e}static fromJson(e){return new this(e.checked,void 0,e)}};Zp.CHECK_CHAR="",Lr("field_checkbox",Zp),Zp.prototype.DEFAULT_VALUE=!1;var Xp=class extends od{constructor(e,t,n){super(od.SKIP_SETUP),this.highlightedIndex=this.picker=null,this.boundEvents=[],this.SERIALIZABLE=!0,this.CURSOR="default",this.isDirty_=!1,this.titles=this.colours=null,this.columns=0,e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.colourOptions&&(this.colours=e.colourOptions),e.colourTitles&&(this.titles=e.colourTitles),e.columns&&(this.columns=e.columns)}initView(){this.size_=new pl(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT),this.createBorderRect_(),this.getBorderRect().style.fillOpacity="1",this.getBorderRect().setAttribute("stroke","#fff"),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new sd;const t=this.getConstants();return e.isSimpleReporter()&&!(null==t||!t.FIELD_COLOUR_FULL_BLOCK)}applyColour(){const e=this.getSourceBlock();if(!e)throw new sd;if(this.fieldGroup_){var t=this.borderRect_;if(!t)throw Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getValue()),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}}getSize(){let e;return null!=(e=this.getConstants())&&e.FIELD_COLOUR_FULL_BLOCK&&(this.render_(),this.isDirty_=!1),super.getSize()}render_(){super.render_();const e=this.getSourceBlock();if(!e)throw new sd;e.applyColour()}updateSize_(e){var t=this.getConstants();this.isFullBlockField()?(e=2*(null!=e?e:0),t=t.FIELD_TEXT_HEIGHT):(e=t.FIELD_COLOUR_DEFAULT_WIDTH,t=t.FIELD_COLOUR_DEFAULT_HEIGHT),this.size_.height=t,this.size_.width=e,this.positionBorderRect_()}doClassValidation_(e){return"string"!=typeof e?null:Er(e)}getText(){let e=this.value_;return/^#(.)\1(.)\2(.)\3$/.test(e)&&(e="#"+e[1]+e[3]+e[5]),e}setColours(e,t){return this.colours=e,t&&(this.titles=t),this}setColumns(e){return this.columns=e,this}showEditor_(){this.dropdownCreate(),mi().appendChild(this.picker),_i(this,this.dropdownDispose.bind(this)),this.picker.focus({preventScroll:!0})}onClick(e){null!==(e=(e=e.target)&&e.getAttribute("data-colour"))&&(this.setValue(e),Oi(this))}onKeyDown(e){let t=!0;var n;switch(e.key){case"ArrowUp":this.moveHighlightBy(0,-1);break;case"ArrowDown":this.moveHighlightBy(0,1);break;case"ArrowLeft":this.moveHighlightBy(-1,0);break;case"ArrowRight":this.moveHighlightBy(1,0);break;case"Enter":(n=this.getHighlighted())&&null!==(n=n.getAttribute("data-colour"))&&this.setValue(n),Ri();break;default:t=!1}t&&e.stopPropagation()}moveHighlightBy(e,t){if(this.highlightedIndex){var n=this.colours||Xp.COLOURS,i=this.columns||Xp.COLUMNS,r=this.highlightedIndex%i,o=Math.floor(this.highlightedIndex/i);r+=e,o+=t,0>e?0>r&&0<o?(r=i-1,o--):0>r&&(r=0):0<e?r>i-1&&o<Math.floor(n.length/i)-1?(r=0,o++):r>i-1&&r--:0>t?0>o&&(o=0):0<t&&o>Math.floor(n.length/i)-1&&(o=Math.floor(n.length/i)-1),this.setHighlightedCell(this.picker.childNodes[o].childNodes[r],o*i+r)}}onMouseMove(e){const t=(e=e.target)&&Number(e.getAttribute("data-index"));null!==t&&t!==this.highlightedIndex&&this.setHighlightedCell(e,t)}onMouseEnter(){let e;null==(e=this.picker)||e.focus({preventScroll:!0})}onMouseLeave(){var e;null==(e=this.picker)||e.blur(),(e=this.getHighlighted())&&se(e,"blocklyColourHighlighted")}getHighlighted(){if(!this.highlightedIndex)return null;const e=this.columns||Xp.COLUMNS,t=this.picker.childNodes[Math.floor(this.highlightedIndex/e)];return t?t.childNodes[this.highlightedIndex%e]:null}setHighlightedCell(e,t){const n=this.getHighlighted();n&&se(n,"blocklyColourHighlighted"),re(e,"blocklyColourHighlighted"),this.highlightedIndex=t,(e=e.getAttribute("id"))&&this.picker&&jn(this.picker,jc.ACTIVEDESCENDANT,e)}dropdownCreate(){const e=this.columns||Xp.COLUMNS,t=this.colours||Xp.COLOURS,n=this.titles||Xp.TITLES,i=this.getValue(),r=document.createElement("table");let o;r.className="blocklyColourTable",r.tabIndex=0,r.dir="ltr",Bn(r,Bc.GRID),jn(r,jc.EXPANDED,!0),jn(r,jc.ROWCOUNT,Math.floor(t.length/e)),jn(r,jc.COLCOUNT,e);for(let s=0;s<t.length;s++){0==s%e&&(o=document.createElement("tr"),Bn(o,Bc.ROW),r.appendChild(o));const a=document.createElement("td");o.appendChild(a),a.setAttribute("data-colour",t[s]),a.title=n[s]||t[s],a.id=k(),a.setAttribute("data-index",`${s}`),Bn(a,Bc.GRIDCELL),jn(a,jc.LABEL,t[s]),jn(a,jc.SELECTED,t[s]===i),a.style.backgroundColor=t[s],t[s]===i&&(a.className="blocklyColourSelected",this.highlightedIndex=s)}this.boundEvents.push(z(r,"pointerdown",this,this.onClick,!0)),this.boundEvents.push(z(r,"pointermove",this,this.onMouseMove,!0)),this.boundEvents.push(z(r,"pointerenter",this,this.onMouseEnter,!0)),this.boundEvents.push(z(r,"pointerleave",this,this.onMouseLeave,!0)),this.boundEvents.push(z(r,"keydown",this,this.onKeyDown,!1)),this.picker=r}dropdownDispose(){for(const e of this.boundEvents)Y(e);this.boundEvents.length=0,this.highlightedIndex=this.picker=null}static fromJson(e){return new this(e.colour,void 0,e)}};Xp.COLOURS="#ffffff #cccccc #c0c0c0 #999999 #666666 #333333 #000000 #ffcccc #ff6666 #ff0000 #cc0000 #990000 #660000 #330000 #ffcc99 #ff9966 #ff9900 #ff6600 #cc6600 #993300 #663300 #ffff99 #ffff66 #ffcc66 #ffcc33 #cc9933 #996633 #663333 #ffffcc #ffff33 #ffff00 #ffcc00 #999900 #666600 #333300 #99ff99 #66ff99 #33ff33 #33cc00 #009900 #006600 #003300 #99ffff #33ffff #66cccc #00cccc #339999 #336666 #003333 #ccffff #66ffff #33ccff #3366ff #3333ff #000099 #000066 #ccccff #9999ff #6666cc #6633ff #6600cc #333399 #330099 #ffccff #ff99ff #cc66cc #cc33cc #993399 #663366 #330033".split(" "),Xp.TITLES=[],Xp.COLUMNS=7,Xp.prototype.DEFAULT_VALUE=Xp.COLOURS[0],Lr("field_colour",Xp),ee("\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: 0.5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n");var Jp=class extends ih{constructor(e,t,n){super(String(null!=e?e:""),t,n),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(Ir(e.text),void 0,e)}};Lr("field_label_serializable",Jp);var Qp=class extends Pp{constructor(e,t,n){super(od.SKIP_SETUP),this.textGroup=null,this.maxLines_=1/0,this.isOverflowedY_=!1,e!==od.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.maxLines&&this.setMaxLines(e.maxLines)}toXml(e){return e.textContent=this.getValue().replace(/\n/g,"&#10;"),e}fromXml(e){this.setValue(e.textContent.replace(/&#10;/g,"\n"))}saveState(){const e=this.saveLegacyState(Qp);return null!==e?e:this.getValue()}loadState(e){this.loadLegacyState(od,e)||this.setValue(e)}initView(){this.createBorderRect_(),this.textGroup=ie(dl.G,{class:"blocklyEditableText"},this.fieldGroup_)}getDisplayText_(){const e=this.getSourceBlock();if(!e)throw new sd;let t=this.getText();if(!t)return od.NBSP;const n=t.split("\n");t="";const i=this.isOverflowedY_?this.maxLines_:n.length;for(let e=0;e<i;e++){let r=n[e];r.length>this.maxDisplayLength?r=r.substring(0,this.maxDisplayLength-4)+"...":this.isOverflowedY_&&e===i-1&&(r=r.substring(0,r.length-3)+"..."),t+=r=r.replace(/\s/g,od.NBSP),e!==i-1&&(t+="\n")}return e.RTL&&(t+=""),t}doValueUpdate_(e){super.doValueUpdate_(e),null!==this.value_&&(this.isOverflowedY_=this.value_.split("\n").length>this.maxLines_)}render_(){var e=this.getSourceBlock();if(!e)throw new sd;for(var t,n=this.textGroup;t=n.firstChild;)n.removeChild(t);t=this.getDisplayText_().split("\n");let i=0;for(let e=0;e<t.length;e++){const r=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;ie(dl.TEXT,{class:"blocklyText blocklyMultilineText",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:i+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},n).appendChild(document.createTextNode(t[e])),i+=r}this.isBeingEdited_&&(n=this.htmlInput_,this.isOverflowedY_?re(n,"blocklyHtmlTextAreaInputOverflowedY"):se(n,"blocklyHtmlTextAreaInputOverflowedY")),this.updateSize_(),this.isBeingEdited_&&(e.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),e=this.htmlInput_,this.isTextValid_?(se(e,"blocklyInvalidInput"),jn(e,jc.INVALID,!1)):(re(e,"blocklyInvalidInput"),jn(e,jc.INVALID,!0)))}updateSize_(){var e=this.textGroup.childNodes;const t=this.getConstants().FIELD_TEXT_FONTSIZE,n=this.getConstants().FIELD_TEXT_FONTWEIGHT,i=this.getConstants().FIELD_TEXT_FONTFAMILY;let r=0,o=0;for(var s=0;s<e.length;s++){var a=ge(e[s],t,n,i);a>r&&(r=a),o+=this.getConstants().FIELD_TEXT_HEIGHT+(0<s?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}if(this.isBeingEdited_){for(e=String(this.value_).split("\n"),s=ie(dl.TEXT,{class:"blocklyText blocklyMultilineText"}),a=0;a<e.length;a++){e[a].length>this.maxDisplayLength&&(e[a]=e[a].substring(0,this.maxDisplayLength)),s.textContent=e[a];const o=ge(s,t,n,i);o>r&&(r=o)}r+=this.htmlInput_.offsetWidth-this.htmlInput_.clientWidth}this.borderRect_&&(o+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING,r+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",`${r}`),this.borderRect_.setAttribute("height",`${o}`)),this.size_.width=r,this.size_.height=o,this.positionBorderRect_()}showEditor_(e,t){super.showEditor_(e,t),this.forceRerender()}widgetCreate_(){const e=Fn(),t=this.workspace_.getScale(),n=document.createElement("textarea");n.className="blocklyHtmlInput blocklyHtmlTextAreaInput",n.setAttribute("spellcheck",String(this.spellcheck_));var i=this.getConstants().FIELD_TEXT_FONTSIZE*t+"pt";e.style.fontSize=i,n.style.fontSize=i,n.style.borderRadius=Pp.BORDERRADIUS*t+"px",i=this.getConstants().FIELD_BORDER_RECT_X_PADDING*t;const r=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*t/2;return n.style.padding=r+"px "+i+"px "+r+"px "+i+"px",i=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,n.style.lineHeight=i*t+"px",e.appendChild(n),n.value=n.defaultValue=this.getEditorText_(this.value_),n.setAttribute("data-untyped-default-value",String(this.value_)),n.setAttribute("data-old-value",""),ja?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),this.bindInputEvents_(n),n}setMaxLines(e){"number"==typeof e&&0<e&&e!==this.maxLines_&&(this.maxLines_=e,this.forceRerender())}getMaxLines(){return this.maxLines_}onHtmlInputKeyDown_(e){"Enter"!==e.key&&super.onHtmlInputKeyDown_(e)}static fromJson(e){return new this(Ir(e.text),void 0,e)}};Lr("field_multilinetext",Qp),ee("\n.blocklyHtmlTextAreaInput {\n  font-family: monospace;\n  resize: none;\n  overflow: hidden;\n  height: 100%;\n  text-align: left;\n}\n\n.blocklyHtmlTextAreaInputOverflowedY {\n  overflow-y: scroll;\n}\n");var ef=class extends Mp{constructor(e,t,n,i,r,o){super(od.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==od.SKIP_SETUP&&(o?this.configure_(o):this.setConstraints(t,n,i),this.setValue(e),r&&this.setValidator(r))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,n){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(n),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);-1!==t.indexOf("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const n=t.indexOf(".");this.decimalPlaces=-1===n?e?0:null:t.length-n-1}getPrecision(){return this.precision_}doClassValidation_(e){return null===e?null:(e=(e=(e=`${e}`.replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e)?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),null!==this.decimalPlaces&&(e=Number(e.toFixed(this.decimalPlaces))),e))}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,jn(e,jc.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,jn(e,jc.VALUEMAX,this.max_)),e}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};Lr("field_number",ef),ef.prototype.DEFAULT_VALUE=0;var tf=class extends hd{constructor(e,t,n,i,r){super(od.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=tf.dropdownCreate,this.defaultVariableName="string"==typeof e?e:"",this.size_=new pl(0,0),e!==od.SKIP_SETUP&&(r?this.configure_(r):this.setTypes(n,i),t&&this.setValidator(t))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new sd;this.variable||(e=Ms.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new sd;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!==e.type)}fromXml(e){var t=this.getSourceBlock();if(!t)throw new sd;const n=e.getAttribute("id"),i=e.textContent,r=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(t=Ms.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,n,i,r),null!==r&&r!==t.type)throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.type+", and does not match variable field that references it: "+jt(e)+".");this.setValue(t.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.name,this.variable.type&&e.setAttribute("variabletype",this.variable.type),e}saveState(e){var t=this.saveLegacyState(tf);return null!==t||(this.initModel(),t={id:this.variable.getId()},e&&(t.name=this.variable.name,t.type=this.variable.type)),t}loadState(e){const t=this.getSourceBlock();if(!t)throw new sd;this.loadLegacyState(tf,e)||(e=Ms.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(null===e)return null;var t=this.getSourceBlock();if(!t)throw new sd;return(t=Ms.getVariable$$module$build$src$core$variables(t.workspace,e))?(t=t.type,this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const t=this.getSourceBlock();if(!t)throw new sd;this.variable=Ms.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const t=this.getVariableTypes();if(!t)return!0;for(let n=0;n<t.length;n++)if(e===t[n])return!0;return!1}getVariableTypes(){var e=this.variableTypes;if(null===e&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(0===(e=e||[""]).length)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e}setTypes(e=null,t=""){if(Array.isArray(e)){let n=!1;for(let i=0;i<e.length;i++)e[i]===t&&(n=!0);if(!n)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else if(null!==e)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=t,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if("RENAME_VARIABLE_ID"===e)return void Ms.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);if("DELETE_VARIABLE_ID"===e)return void this.sourceBlock_.workspace.deleteVariableById(this.variable.getId())}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(Ir(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let t=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var n=this.getVariableTypes(),i=0;i<n.length;i++){const e=this.sourceBlock_.workspace.getVariablesOfType(n[i]);t=t.concat(e)}for(t.sort(Jl.compareByName),n=[],i=0;i<t.length;i++)n[i]=[t[i].name,t[i].getId()];return n.push([Ms.Msg$$module$build$src$core$msg.RENAME_VARIABLE,"RENAME_VARIABLE_ID"]),Ms.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&n.push([Ms.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),"DELETE_VARIABLE_ID"]),n}};Lr("field_variable",tf);var nf=class{constructor(e,t,n,i){this.workspace=e,this.targetWorkspace=t,this.isLabel_=i,this.onMouseUpWrapper=null,this.height=this.width=0,this.svgText=this.svgGroup=null,this.text=n.text,this.position=new el(0,0),this.callbackKey=n.callbackKey||n.callbackkey,this.cssClass=n["web-class"]||null,this.info=n}createDom(){var e=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";let t;this.cssClass&&(e+=" "+this.cssClass),this.svgGroup=ie(dl.G,{class:e},this.workspace.getCanvas()),this.isLabel_||(t=ie(dl.RECT,{class:"blocklyFlyoutButtonShadow",rx:nf.BORDER_RADIUS,ry:nf.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=ie(dl.RECT,{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:nf.BORDER_RADIUS,ry:nf.BORDER_RADIUS},this.svgGroup);const n=ie(dl.TEXT,{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var i=Ir(this.text);this.workspace.RTL&&(i+=""),n.textContent=i,this.isLabel_&&(this.svgText=n,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const r=Ee(n,"fontSize"),o=Ee(n,"fontWeight"),s=Ee(n,"fontFamily");if(this.width=me(n,r,o,s),i=be(i,r,o,s),this.height=i.height,!this.isLabel_){let e,n;this.width+=2*nf.TEXT_MARGIN_X,this.height+=2*nf.TEXT_MARGIN_Y,null==(e=t)||e.setAttribute("width",String(this.width)),null==(n=t)||n.setAttribute("height",String(this.height))}return e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),n.setAttribute("x",String(this.width/2)),n.setAttribute("y",String(this.height/2-i.height/2+i.baseline)),this.updateTransform(),this.onMouseUpWrapper=z(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}isLabel(){return this.isLabel_}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}dispose(){this.onMouseUpWrapper&&Y(this.onMouseUpWrapper),this.svgGroup&&le(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isLabel_&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isLabel_||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isLabel_||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};nf.TEXT_MARGIN_X=5,nf.TEXT_MARGIN_Y=2,nf.BORDER_RADIUS=4,ee("\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n");var rf,of=class extends fp{constructor(e,t){super(e),this.flyout_=t}getBoundingBox_(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch(t){e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const t=this.getBoundingBox_();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,n){return t=n||this.getContentMetrics(),n=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*n)/e,width:(t.width+t.left+n)/e,top:0,left:0}}};!function(e){e.BLOCK="block",e.BUTTON="button"}(rf||(rf={}));var sf=class extends Hh{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.isVisible_=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new Ch(e),this.workspace_.setMetricsManager(new of(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.id=S(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=ie(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=ie(dl.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new pp(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(z(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(z(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:1,capabilities:[Za.Capability.AUTOHIDEABLE,Za.Capability.DELETE_AREA,Za.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)Y(e);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&le(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}isVisible(){return this.isVisible_}setVisible(e){const t=e!==this.isVisible();this.isVisible_=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}updateDisplay(){let e,t;e=!!this.containerVisible&&this.isVisible(),this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none"),null==(t=this.workspace_.scrollbar)||t.setContainerVisible(e)}positionAt_(e,t,n,i){let r,o;null==(r=this.svgGroup_)||r.setAttribute("width",`${e}`),null==(o=this.svgGroup_)||o.setAttribute("height",`${t}`),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&de(this.svgGroup_,"translate("+n+"px,"+i+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(n,i),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const e of this.listeners)Y(e);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),"string"==typeof e&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=je(e),e=this.createFlyoutInfo(e),wt(this.workspace_),this.layout_(e.contents,e.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(e){const t=[],n=[];this.permanentlyDisabled.length=0;const i=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const r of e){if("custom"in r){e=this.getDynamicCategoryContents(r.custom),e=je(e);const{contents:i,gaps:o}=this.createFlyoutInfo(e);t.push(...i),n.push(...o)}switch(r.kind.toUpperCase()){case"BLOCK":e=r;const o=this.createFlyoutBlock(e);t.push({type:rf.BLOCK,block:o}),this.addBlockGap(e,n,i);break;case"SEP":this.addSeparatorGap(r,n,i);break;case"LABEL":e=this.createButton(r,!0),t.push({type:rf.BUTTON,button:e}),n.push(i);break;case"BUTTON":e=this.createButton(r,!1),t.push({type:rf.BUTTON,button:e}),n.push(i)}}return{contents:t,gaps:n}}getDynamicCategoryContents(e){if("function"!=typeof(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}createButton(e,t){return new nf(this.workspace_,this.targetWorkspace,e,t)}createFlyoutBlock(e){let t;return e.blockxml?(e="string"==typeof e.blockxml?Ms.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,(t=this.getRecycledBlock(e.getAttribute("type")))||(t=Ht(e,this.workspace_))):(t=this.getRecycledBlock(e.type))||(void 0===e.enabled&&(e.enabled="true"!==e.disabled&&!0!==e.disabled),t=mn(e,this.workspace_)),t.isEnabled()||this.permanentlyDisabled.push(t),t}getRecycledBlock(e){let t=-1;for(let n=0;n<this.recycledBlocks.length;n++)if(this.recycledBlocks[n].type===e){t=n;break}return-1===t?void 0:this.recycledBlocks.splice(t,1)[0]}addBlockGap(e,t,n){let i;e.gap?i=parseInt(String(e.gap)):e.blockxml&&(e="string"==typeof e.blockxml?Ms.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,i=parseInt(e.getAttribute("gap"))),t.push(!i||isNaN(i)?n:i)}addSeparatorGap(e,t,n){e=parseInt(String(e.gap)),!isNaN(e)&&0<t.length?t[t.length-1]=e:t.push(n)}clearOldBlocks(){var e=this.workspace_.getTopBlocks(!1);for(let t,n=0;t=e[n];n++)this.blockIsRecyclable_(t)?this.recycleBlock(t):t.dispose(!1,!1);for(e=0;e<this.mats.length;e++){const t=this.mats[e];t&&(ir(t),le(t))}this.mats.length=0;for(let e,t=0;e=this.buttons_[t];t++)e.dispose();let t;this.buttons_.length=0,null==(t=this.workspace_.getPotentialVariableMap())||t.clear()}emptyRecycledBlocks(){for(let e=0;e<this.recycledBlocks.length;e++)this.recycledBlocks[e].dispose();this.recycledBlocks=[]}blockIsRecyclable_(e){return!1}recycleBlock(e){const t=e.getRelativeToSurfaceXY();e.moveBy(-t.x,-t.y),this.recycledBlocks.push(e)}addBlockListeners_(e,t,n){this.listeners.push(z(e,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(z(n,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(q(e,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(q(e,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()}))),this.listeners.push(q(n,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(q(n,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()})))}blockMouseDown(e){return t=>{const n=this.targetWorkspace.getGesture(t);n&&(n.setStartBlock(e),n.handleFlyoutStart(t,this))}}onMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()}createBlock(e){let t=null;Ms.disable$$module$build$src$core$events$utils();var n=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{Ms.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=vt(this.targetWorkspace,n),L()){for(Ms.setGroup$$module$build$src$core$events$utils(!0),n=0;n<e.length;n++){const t=e[n];I(new(j(ea))(t))}I(new(j(Ms.CREATE$$module$build$src$core$events$utils))(t))}return this.autoClose?this.hide():this.filterForCapacity(),t}initFlyoutButton_(e,t,n){const i=e.createDom();e.moveTo(t,n),e.show(),this.listeners.push(z(i,"pointerdown",this,this.onMouseDown)),this.buttons_.push(e)}createRect_(e,t,n,i,r){return(t=ie(dl.RECT,{"fill-opacity":0,x:t,y:n,height:i.height,width:i.width})).tooltip=e,nr(t),this.workspace_.getCanvas().insertBefore(t,e.getSvgRoot()),this.rectMap_.set(e,t),this.mats[r]=t}moveRectToBlock_(e,t){const n=t.getHeightWidth();e.setAttribute("width",String(n.width)),e.setAttribute("height",String(n.height)),t=t.getRelativeToSurfaceXY(),e.setAttribute("y",String(t.y)),e.setAttribute("x",String(this.RTL?t.x-n.width:t.x))}filterForCapacity(){const e=this.workspace_.getTopBlocks(!1);for(let t,n=0;t=e[n];n++)if(-1===this.permanentlyDisabled.indexOf(t)){const e=this.targetWorkspace.isCapacityAvailable(E(t));for(;t;)t.setEnabled(e),t=t.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return!!this.workspace_.scrollbar&&this.workspace_.scrollbar.isVisible()}placeNewBlock(e){var t=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const n=sn(e);return t.setResizesEnabled(!1),t=gn(n,t),this.positionNewBlock(e,t),t}positionNewBlock(e,t){const n=this.targetWorkspace;var i=n.getOriginOffsetInPixels(),r=this.workspace_.getOriginOffsetInPixels();(e=e.getRelativeToSurfaceXY()).scale(this.workspace_.scale),r=el.sum(r,e),(i=el.difference(r,i)).scale(1/n.scale),t.moveTo(new el(i.x,i.y))}};sf.FlyoutItemType=rf;var af=class extends sf{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),n=t.getScrollMetrics(),i=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.x&&(this.workspace_.scrollX=-(n.left+(n.width-i.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),n=e.getViewMetrics();e=e.getToolboxMetrics();const i=this.toolboxPosition_===Al.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?i?e.height:n.height-this.height_:i?0:n.height:i?0:n.height+t.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const n=this.toolboxPosition_===Al.TOP,i=["M 0,"+(n?0:this.CORNER_RADIUS)];n?(i.push("h",e+2*this.CORNER_RADIUS),i.push("v",t),i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),i.push("h",-e),i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),i.push("h",e),i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),i.push("v",t),i.push("h",-e-2*this.CORNER_RADIUS)),i.push("z"),this.svgBackground_.setAttribute("d",i.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setX(this.RTL?1/0:0)}wheel_(e){var t=J(e);if(t=t.x||t.y){const e=this.workspace_.getMetricsManager(),n=e.getScrollMetrics();let i;t=e.getViewMetrics().left-n.left+t,null==(i=this.workspace_.scrollbar)||i.setX(t),Gn(),Ri()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;const n=this.MARGIN;let i=n+this.tabWidth_;this.RTL&&(e=e.reverse());for(let a,l=0;a=e[l];l++)if("block"===a.type){var r=a.block,o=r.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=r.getSvgRoot();const e=r.getHeightWidth();var s=r.outputConnection?this.tabWidth_:0;s=this.RTL?i+e.width:i-s,r.moveBy(s,n),s=this.createRect_(r,s,n,e,l),i+=e.width+t[l],this.addBlockListeners_(o,r,s)}else"button"===a.type&&(r=a.button,this.initFlyoutButton_(r,i,n),i+=r.width+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_===Al.TOP?new hl(-1e9,t+e.height,-1e9,1e9):new hl(t,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;const t=this.workspace_.getTopBlocks(!1);for(let n,i=0;n=t[i];i++)e=Math.max(e,n.getHeightWidth().height);const n=this.buttons_;for(let t,i=0;t=n[i];i++)e=Math.max(e,t.height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=vl.scrollbarThickness,this.height_!==e){for(let e,n=0;e=t[n];n++)this.rectMap_.has(e)&&this.moveRectToBlock_(this.rectMap_.get(e),e);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Al.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};t($s.FLYOUTS_HORIZONTAL_TOOLBOX,Fs,af);var lf=class extends sf{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),n=t.getScrollMetrics(),i=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.y&&(this.workspace_.scrollY=-(n.top+(n.height-i.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),n=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Al.LEFT?e.width:n.width-this.width_:this.toolboxPosition_===Al.LEFT?0:n.width:this.toolboxPosition_===Al.LEFT?0:n.width+t.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const n=this.toolboxPosition_===Al.RIGHT;var i=e+this.CORNER_RADIUS;(i=["M "+(n?i:0)+",0"]).push("h",n?-e:e),i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),i.push("v",Math.max(0,t)),i.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),i.push("h",n?e:-e),i.push("z"),this.svgBackground_.setAttribute("d",i.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setY(0)}wheel_(e){var t=J(e);if(t.y){const e=this.workspace_.getMetricsManager(),n=e.getScrollMetrics();let i;t=e.getViewMetrics().top-n.top+t.y,null==(i=this.workspace_.scrollbar)||i.setY(t),Gn(),Ri()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;var n=this.MARGIN;const i=this.RTL?n:n+this.tabWidth_;for(let a,l=0;a=e[l];l++)if("block"===a.type){var r=a.block,o=r.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=r.getSvgRoot();const e=r.getHeightWidth();var s=r.outputConnection?i-this.tabWidth_:i;r.moveBy(s,n),s=this.createRect_(r,this.RTL?s-e.width:s,n,e,l),this.addBlockListeners_(o,r,s),n+=e.height+t[l]}else"button"===a.type&&(r=a.button,this.initFlyoutButton_(r,i,n),n+=r.height+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_===Al.LEFT?new hl(-1e9,1e9,-1e9,t+e.width):new hl(-1e9,1e9,t,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;var t=this.workspace_.getTopBlocks(!1);for(let i,r=0;i=t[r];r++){var n=i.getHeightWidth().width;i.outputConnection&&(n-=this.tabWidth_),e=Math.max(e,n)}for(let t,n=0;t=this.buttons_[n];n++)e=Math.max(e,t.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=vl.scrollbarThickness,this.width_!==e){for(let i,r=0;i=t[r];r++){if(this.RTL){n=i.getRelativeToSurfaceXY().x;let t=e/this.workspace_.scale-this.MARGIN;i.outputConnection||(t-=this.tabWidth_),i.moveBy(t-n,0)}this.rectMap_.has(i)&&this.moveRectToBlock_(this.rectMap_.get(i),i)}if(this.RTL)for(let n,i=0;n=this.buttons_[i];i++)t=n.getPosition().y,n.moveTo(e/this.workspace_.scale-n.width-this.MARGIN-this.tabWidth_,t);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Al.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};lf.registryName="verticalFlyout",t($s.FLYOUTS_VERTICAL_TOOLBOX,Fs,lf),Ms.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=f());var t=[];this.init(e),e=e.getTopBlocks(!0);for(let n,i=0;n=e[i];i++){let e=this.blockToCode(n);Array.isArray(e)&&(e=e[0]),e&&(n.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!n.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,n)+e),this.STATEMENT_SUFFIX&&!n.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,n))),t.push(e))}return t=t.join("\n"),(t=(t=(t=this.finish(t)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)}allNestedComments(e){const t=[];e=e.getDescendants(!0);for(let n=0;n<e.length;n++){const i=e[n].getCommentText();i&&t.push(i)}return t.length&&t.push(""),t.join("\n")}blockToCode(e,t){if(!1===this.isInitialized&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var n=this.forBlock[e.type];if(!n&&this[e.type]&&(ne("block generator functions on CodeGenerator objects","10.0","11.0","the .forBlock[blockType] dictionary"),n=this[e.type]),"function"!=typeof n)throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(n=n.call(e,e,this),Array.isArray(n)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,n[0],t),n[1]]}if("string"==typeof n)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(n=this.injectId(this.STATEMENT_PREFIX,e)+n),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(n+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,n,t);if(null===n)return"";throw SyntaxError("Invalid code generated: "+n)}valueToCode(e,t,n){if(isNaN(n))throw TypeError("Expecting valid order from block: "+e.type);var i=e.getInputTargetBlock(t);if(!i)return"";if(""===(t=this.blockToCode(i)))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${i.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+i.type);if(!e)return"";i=!1;var r=Math.floor(n);const o=Math.floor(t);if(r<=o&&(r!==o||0!==r&&99!==r))for(i=!0,r=0;r<this.ORDER_OVERRIDES.length;r++)if(this.ORDER_OVERRIDES[r][0]===n&&this.ORDER_OVERRIDES[r][1]===t){i=!1;break}return i&&(e="("+e+")"),e}statementToCode(e,t){if(e=e.getInputTargetBlock(t),"string"!=typeof(t=this.blockToCode(e)))throw TypeError("Expecting code from statement block: "+(e&&e.type));return t&&(t=this.prefixLines(t,this.INDENT)),t}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,t){if(!this.definitions_[e]){const n=this.nameDB_.getDistinctName(e,Ms.NameType$$module$build$src$core$names.PROCEDURE);let i;for(this.functionNames_[e]=n,Array.isArray(t)&&(t=t.join("\n")),t=t.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,n);i!==t;)i=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0");t=t.replace(/\0/g,this.INDENT),this.definitions_[e]=t}return this.functionNames_[e]}getVariableName(e){return this.getName(e,Ms.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,Ms.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,t)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,n){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},Ms.CodeGenerator$$module$build$src$core$generator;var cf=!1,uf={};uf.Align=Ms.Align$$module$build$src$core$inputs$align,uf.DummyInput=oh,uf.EndRowInput=sh,uf.Input=rh,uf.StatementInput=ah,uf.ValueInput=Ms.ValueInput$$module$build$src$core$inputs$value_input,uf.inputTypes=Ms.inputTypes$$module$build$src$core$inputs$input_types;var df=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,n){Ms.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=n,n.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{Ms.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){Ms.disable$$module$build$src$core$events$utils();try{this.hidePreview();const n=e.getSourceBlock(),i=this.createInsertionMarker(n),r=this.getMatchingConnection(n,i,e);if(!r)throw Error("Could not create insertion marker to preview connection");i.queueRender(),wt(),r.connect(t);const o={x:t.x-r.x,y:t.y-r.y},s=r.getOffsetInBlock().clone();xt().then((()=>{null==i||i.positionNearConnection(r,o,s),null==i||i.getSvgRoot().setAttribute("visibility","visible")})),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.markerConn=r,this.draggedConn=e,this.staticConn=t}finally{Ms.enable$$module$build$src$core$events$utils()}}}createInsertionMarker(e){const t=this.workspace.newBlock(e.type);if(t.setInsertionMarker(!0),e.saveExtraState){var n=e.saveExtraState(!0);n&&t.loadExtraState&&t.loadExtraState(n)}else e.mutationToDom&&(n=e.mutationToDom())&&t.domToMutation&&t.domToMutation(n);for(n=0;n<e.inputList.length;n++){const i=e.inputList[n];if("_TEMP_COLLAPSED_INPUT"===i.name)continue;const r=t.inputList[n];if(!r)throw Error("The insertion marker previewer tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","an input"));for(let e=0;e<i.fieldRow.length;e++){const t=i.fieldRow[e],n=r.fieldRow[e];if(!n)throw Error("The insertion marker previewer tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","a field"));n.setValue(t.getValue())}}for(const e of t.getDescendants(!1))e.setInsertionMarker(!0);return t.setCollapsed(e.isCollapsed()),t.setInputsInline(e.getInputsInline()),t.initSvg(),t.getSvgRoot().setAttribute("visibility","hidden"),t}getMatchingConnection(e,t,n){if(e=e.getConnections_(!0),t=t.getConnections_(!0),e.length!==t.length)return null;for(let i=0;i<e.length;i++)if(e[i]===n)return t[i];return null}hidePreview(){Ms.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{Ms.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const t=e.getSourceBlock(),n=t.outputConnection;let i;if(null!=(i=t.previousConnection)&&i.targetConnection||null!=n&&n.targetConnection)t.unplug(!0);else{let t;null==(t=e.targetBlock())||t.unplug(!1)}t.dispose()}dispose(){this.hidePreview()}};t($s.CONNECTION_PREVIEWER,Fs,df);var hf=class extends eh{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},pf=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+"\n"+this.inlineSteps_}drawTopCorner(e){this.steps_+=io(e.xPos,this.info_.startY);for(let t,n=0;t=e.elements[n];n++)Rd.isLeftSquareCorner(t)?this.steps_+=this.highlightConstants_.START_POINT:Rd.isLeftRoundedCorner(t)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):Rd.isPreviousConnection(t)?this.steps_+=this.notchPaths_.pathLeft:Rd.isHat(t)?this.steps_+=this.startPaths_.path(this.RTL_):Rd.isSpacer(t)&&0!==t.width&&(this.steps_+=so("H",t.xPos+t.width-this.highlightOffset));this.steps_+=so("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+so("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const t=e.getLastInput();if(this.RTL_){const n=e.height-t.connectionHeight;this.steps_+=no(t.xPos+t.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+so("v",n)}else this.steps_+=no(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const t=e.getLastInput();if(t)if(this.RTL_){const n=e.height-2*this.insideCornerPaths_.height;this.steps_+=no(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+so("v",n)+this.insideCornerPaths_.pathBottom(this.RTL_)+ro(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=no(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+ro(e.width-t.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const t=e.xPos+e.width-this.highlightOffset;e instanceof Xd&&e.followsStatement&&(this.steps_+=so("H",t)),this.RTL_&&(this.steps_+=so("H",t),e.height>this.highlightOffset&&(this.steps_+=so("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=so("V",e.baseline-this.highlightOffset);else{const t=this.info_.bottomRow.elements[0];Rd.isLeftSquareCorner(t)?this.steps_+=no(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):Rd.isLeftRoundedCorner(t)&&(this.steps_+=no(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=no(this.info_.startX,e):(this.steps_+=no(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=so("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,Rd.isLeftRoundedCorner(e.elements[0])?this.steps_+=so("V",this.outsideCornerPaths_.height):this.steps_+=so("V",e.capline+this.highlightOffset))}drawInlineInput(e){const t=this.highlightOffset,n=e.xPos+e.connectionWidth;var i=e.centerline-e.height/2;const r=e.width-e.connectionWidth,o=i+t;this.RTL_?(i=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=no(n-t,o)+so("v",i)+this.puzzleTabPaths_.pathDown(this.RTL_)+so("v",e)+so("h",r)):this.inlineSteps_+=no(e.xPos+e.width+t,o)+so("v",e.height)+so("h",-r)+no(n,i+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},ff=class extends nh{constructor(e,t){super(e,t),this.highlighter_=new pf(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=so("H",e.xPos+e.width)+so("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let n=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(n*=-1),e.connectionModel.setOffsetInBlock(n,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let n=e.xPos+e.statementEdge+t.notchOffset;n=this.info_.RTL?-1*n:n+this.constants_.DARK_PATH_OFFSET,t.connectionModel.setOffsetInBlock(n,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let n=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(n*=-1),t.connectionModel.setOffsetInBlock(n,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,n=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-n:n)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},gf=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=io(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,n=(1-Math.SQRT1_2)*(e+t)-t,i=io(n,n)+ao("a","0 0,0",e,eo(-n-t,e-n)),r=ao("a","0 0,0",e+t,eo(e+t,e+t)),o=io(n,-n)+ao("a","0 0,0",e+t,eo(e-n,n+t));return{width:e+t,height:e,pathTop:e=>e?i:"",pathBottom:e=>e?r:o}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,n=(1-Math.SQRT1_2)*(e-t)+t,i=io(n,n)+ao("a","0 0,1",e-t,eo(e-n,-n+t)),r=io(t,e)+ao("a","0 0,1",e-t,eo(e,-e+t)),o=-n,s=io(n,o)+ao("a","0 0,1",e-t,eo(-n+t,-o-e));return{height:e,topLeft:e=>e?i:r,bottomLeft:()=>s}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,n=io(-2,3.4-t)+ro(-.45*e,-2.1),i=so("v",2.5)+io(.97*-e,2.5)+to("q",[eo(.05*-e,10),eo(.3*e,9.5)])+io(.67*e,-1.9)+so("v",2.5),r=so("v",-1.5)+io(-.92*e,-.5)+to("q",[eo(-.19*e,-5.5),eo(0,-11)])+io(.92*e,1),o=io(-5,t-.7)+ro(.46*e,-2.1);return{width:e,height:t,pathUp:e=>e?n:r,pathDown:e=>e?i:o}}makeNotch(){return{pathLeft:so("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:ro(5.1,2.6)+io(-10.2,6.8)+ro(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,t=io(25,-8.7)+to("c",[eo(29.7,-6.2),eo(57.2,-.5),eo(75,8.7)]),n=to("c",[eo(17.8,-9.2),eo(45.3,-14.9),eo(75,-8.7)])+no(100.5,e+.5);return{path:e=>e?t:n}}},mf=class extends Gd{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},bf=class extends Vd{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},yf=class extends lh{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ah||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new mf(this.constants_,e)),t.hasInlineInput=!0):e instanceof ah?(t.elements.push(new bf(this.constants_,e)),t.hasStatement=!0):e instanceof Ms.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new jd(this.constants_,e)),t.hasExternalInput=!0):(e instanceof oh||e instanceof sh)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||null!==t.align||(t.align=e.align)}addElemSpacing_(){let e=!1;for(let t,n=0;t=this.rows[n];n++)t.hasExternalInput&&(e=!0);for(let n,i=0;n=this.rows[i];i++){var t=n.elements;if(n.elements=[],n.startsWithElemSpacer()&&n.elements.push(new Hd(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let e=0;e<t.length-1;e++){n.elements.push(t[e]);const i=this.getInRowSpacing_(t[e],t[e+1]);n.elements.push(new Hd(this.constants_,i))}n.elements.push(t[t.length-1]),n.endsWithElemSpacer()&&(t=this.getInRowSpacing_(t[t.length-1],null),e&&n.hasDummyInput&&(t+=this.constants_.TAB_WIDTH),n.elements.push(new Hd(this.constants_,t)))}}}getInRowSpacing_(e,t){if(!e)return t&&Rd.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Rd.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Rd.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Rd.isInput(e)&&(!t||Rd.isStatementInput(t)))return Rd.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:Rd.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Rd.isHat(e)?this.constants_.NO_PADDING:Rd.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Rd.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Rd.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Rd.isInput(e)&&!t){if(Rd.isExternalInput(e))return this.constants_.NO_PADDING;if(Rd.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Rd.isStatementInput(e))return this.constants_.NO_PADDING}if(!Rd.isInput(e)&&t&&Rd.isInput(t)){if(Rd.isField(e)&&e.isEditable){if(Rd.isInlineInput(t)||Rd.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Rd.isInlineInput(t)||Rd.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Rd.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Rd.isIcon(e)&&t&&!Rd.isInput(t))return this.constants_.LARGE_PADDING;if(Rd.isInlineInput(e)&&t&&Rd.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Rd.isLeftSquareCorner(e)&&t){if(Rd.isHat(t))return this.constants_.NO_PADDING;if(Rd.isPreviousConnection(t))return t.notchOffset;if(Rd.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(Rd.isLeftRoundedCorner(e)&&t){if(Rd.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(Rd.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return Rd.isField(e)&&t&&Rd.isField(t)&&e.isEditable===t.isEditable||t&&Rd.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Rd.isTopRow(e)&&Rd.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Rd.isTopRow(e)||Rd.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Rd.isSpacer(t))return e.yPos+t.height/2;if(Rd.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Rd.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Rd.isTopRow(e))return Rd.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let n=e.yPos;return Rd.isField(t)||Rd.isIcon(t)?(n+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(n+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):n=Rd.isInlineInput(t)?n+t.height/2:n+e.height/2,n}alignRowElements_(){if(this.isInline){var e=0,t=new WeakMap,n=null;for(let i,r=this.rows.length-1;i=this.rows[r];r--)t.set(i,e),Rd.isInputRow(i)&&(i.hasStatement&&this.alignStatementRow_(i),n&&n.hasStatement&&i.width<n.width?t.set(i,n.width):e=i.hasStatement?i.width:Math.max(e,i.width),n=i);e=0;for(let i,r=0;i=this.rows[r];r++)i.hasStatement?e=this.getDesiredRowWidth_(i):Rd.isSpacer(i)?i.width=Math.max(e,t.get(i)):(n=i.width,0<(e=Math.max(e,t.get(i))-n)&&this.addAlignmentPadding_(i,e),e=i.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,t=0;for(let i,r=0;i=this.rows[r];r++){i.yPos=t,i.xPos=this.startX,t+=i.height,e=Math.max(e,i.widthWithConnectedBlocks);var n=t-this.topRow.ascenderHeight;i===this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,t+=n),this.recordElemPositions_(i)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(n=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,n.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=t+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},vf=class extends hh{constructor(e,t,n){super(e,t,n),this.constants=n,this.colourDark="#000000",this.svgPathDark=ie(dl.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=ie(dl.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=kr("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},_f=class extends bh{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t){super.refreshDom(e,t),this.getHighlightConstants().init()}makeConstants_(){return new hf}makeRenderInfo_(e){return new yf(this,e)}makeDrawer_(e,t){return new ff(e,t)}makePathObject(e,t){return new vf(e,t,this.getConstants())}makeHighlightConstants_(){return new gf(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};Ao("geras",_f);var Ef={};Ef.ConstantProvider=hf,Ef.Drawer=ff,Ef.HighlightConstantProvider=gf,Ef.Highlighter=pf,Ef.InlineInput=mf,Ef.PathObject=vf,Ef.RenderInfo=yf,Ef.Renderer=_f,Ef.StatementInput=bf;var Tf=class extends eh{constructor(){super(),ne("Blockly.minimalist.ConstantProvider","v10","v11","Blockly.blockRendering.ConstantProvider")}},xf=class extends nh{constructor(e,t){super(e,t),ne("Blockly.minimalist.Drawer","v10","v11","Blockly.blockRendering.Drawer")}},wf=class extends lh{constructor(e,t){super(e,t),ne("Blockly.minimalist.RenderInfo","v10","v11","Blockly.blockRendering.RenderInfo")}getRenderer(){return this.renderer_}},kf=class extends bh{constructor(e){super(e),ne("Blockly.minimalist.Renderer","v10","v11","Blockly.blockRendering.Renderer")}makeConstants_(){return new Tf}makeRenderInfo_(e){return new wf(this,e)}makeDrawer_(e,t){return new xf(e,t)}};Ao("minimalist",kf);var Sf={};Sf.ConstantProvider=Tf,Sf.Drawer=xf,Sf.RenderInfo=wf,Sf.Renderer=kf;var Cf=class extends lh{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){const i=this.rows[t];var n=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new Hd(this.constants_,this.getInRowSpacing_(null,n[0]))),n.length){for(let e=0;e<n.length-1;e++){i.elements.push(n[e]);const t=this.getInRowSpacing_(n[e],n[e+1]);i.elements.push(new Hd(this.constants_,t))}i.elements.push(n[n.length-1]),i.endsWithElemSpacer()&&(n=this.getInRowSpacing_(n[n.length-1],null),e&&i.hasDummyInput&&(n+=this.constants_.TAB_WIDTH),i.elements.push(new Hd(this.constants_,n)))}}}getInRowSpacing_(e,t){if(!e)return t&&Rd.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&Rd.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&Rd.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!Rd.isInput(e)&&!t)return Rd.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:Rd.isIcon(e)?2*this.constants_.LARGE_PADDING+1:Rd.isHat(e)?this.constants_.NO_PADDING:Rd.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:Rd.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:Rd.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(Rd.isInput(e)&&!t){if(Rd.isExternalInput(e))return this.constants_.NO_PADDING;if(Rd.isInlineInput(e))return this.constants_.LARGE_PADDING;if(Rd.isStatementInput(e))return this.constants_.NO_PADDING}if(!Rd.isInput(e)&&t&&Rd.isInput(t)){if(Rd.isField(e)&&e.isEditable){if(Rd.isInlineInput(t)||Rd.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(Rd.isInlineInput(t)||Rd.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(Rd.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(Rd.isIcon(e)&&t&&!Rd.isInput(t))return this.constants_.LARGE_PADDING;if(Rd.isInlineInput(e)&&t&&Rd.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(Rd.isLeftSquareCorner(e)&&t){if(Rd.isHat(t))return this.constants_.NO_PADDING;if(Rd.isPreviousConnection(t)||Rd.isNextConnection(t))return t.notchOffset}return Rd.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:Rd.isField(e)&&t&&Rd.isField(t)&&e.isEditable===t.isEditable||t&&Rd.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return Rd.isTopRow(e)&&Rd.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:Rd.isTopRow(e)||Rd.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(Rd.isSpacer(t))return e.yPos+t.height/2;if(Rd.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,Rd.isNextConnection(t)?e+t.height/2:e-t.height/2;if(Rd.isTopRow(e))return Rd.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let n=e.yPos;return Rd.isField(t)&&e.hasStatement?n+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):n+e.height/2}finalize_(){let e=0,t=0;for(var n=0;n<this.rows.length;n++){const r=this.rows[n];r.yPos=t,r.xPos=this.startX,t+=r.height,e=Math.max(e,r.widthWithConnectedBlocks);var i=t-this.topRow.ascenderHeight;r===this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,t+=i),this.recordElemPositions_(r)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(n=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,n.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}},Af=class extends bh{constructor(e){super(e)}makeRenderInfo_(e){return new Cf(this,e)}};Ao("thrasos",Af);var If={};If.RenderInfo=Cf,If.Renderer=Af;var Of=new Zu("zelos",{colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},{colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}}),Nf={Classic:Xu,Zelos:Of},Rf=class{constructor(e,t,n){this.id_=e.toolboxitemid||k(),this.level_=(this.parent_=n||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}},Df=class extends Rf{constructor(e,t,n){super(e,t,n),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),"true"===this.toolboxItemDef_.hidden&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(n)}}parseCategoryDef_(e){this.name_="name"in e?Ir(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),Bn(this.htmlDiv_,Bc.TREEITEM),jn(this.htmlDiv_,jc.SELECTED,!1),jn(this.htmlDiv_,jc.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),Bn(this.iconDom_,Bc.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&jn(this.htmlDiv_,jc.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&re(e,t),e}createRowContainer_(){const e=document.createElement("div");var t=this.cssConfig_.row;return t&&re(e,t),t=Df.nestedPadding*this.getLevel()+"px",this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){const e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&re(e,t),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&re(e,t)}return e.style.display="inline-block",e}createLabelDom_(e){const t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&re(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=Df.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle_(t);if(e)return this.parseColour_(e)}return""}getColourfromStyle_(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour_(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour_(e){if(null==(e=Ir(e))||""===e)return"";var t=Number(e);return isNaN(t)?(t=Er(e))?t:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):Sr(t)}openIcon_(e){if(e){var t=this.cssConfig_.closedicon;t&&oe(e,t),(t=this.cssConfig_.openicon)&&re(e,t)}}closeIcon_(e){if(e){var t=this.cssConfig_.openicon;t&&oe(e,t),(t=this.cssConfig_.closedicon)&&re(e,t)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(!(e=e.getParent()).isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var t=this.cssConfig_.selected;if(e){const e=this.parseColour_(Df.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||e,t&&re(this.rowDiv_,t)}else this.rowDiv_.style.backgroundColor="",t&&se(this.rowDiv_,t);jn(this.htmlDiv_,jc.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_="string"==typeof e?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:je(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){le(this.htmlDiv_)}};Df.registrationName="category",Df.nestedPadding=19,Df.borderWidth=8,Df.defaultBackgroundColour="#57e",ee('\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n'),t($s.TOOLBOX_ITEM,Df.registrationName,Df);var Lf=class extends Rf{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv_=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&re(e,t),this.htmlDiv_=e}getDiv(){return this.htmlDiv_}dispose(){le(this.htmlDiv_)}};Lf.registrationName="sep",ee('\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n'),t($s.TOOLBOX_ITEM,Lf.registrationName,Lf);var Mf=class extends Df{constructor(e,t,n){super(e,t,n),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxContents",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const t=e.contents;if(t){this.flyoutItems_=[],e=!0;for(let n=0;n<t.length;n++){const i=t[n];!o($s.TOOLBOX_ITEM,i.kind)||i.kind.toLowerCase()===Lf.registrationName&&e?(this.flyoutItems_.push(i),e=!0):(this.createToolboxItem_(i),e=!1)}}}}createToolboxItem_(e){let t=e.kind;"CATEGORY"===t.toUpperCase()&&Ue(e)&&(t=Mf.registrationName),e=new(s($s.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded("true"===this.toolboxItemDef_.expanded||!0===this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),Bn(this.subcategoriesDiv_,Bc.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),jn(this.htmlDiv_,jc.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&re(e,t),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const t=document.createElement("div");t.style.display="none";var n=this.cssConfig_.contents;for(n&&re(t,n),n=0;n<e.length;n++){const i=e[n];i.init();const r=i.getDiv();if(t.appendChild(r),i.getClickTarget){let e;null==(e=i.getClickTarget())||e.setAttribute("id",i.getId())}}return t}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let e;null==(e=this.parentToolbox_.getFlyout())||e.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}jn(this.htmlDiv_,jc.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const t=this.getChildToolboxItems();for(let n=0;n<t.length;n++)t[n].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};Mf.registrationName="collapsibleCategory",t($s.TOOLBOX_ITEM,Mf.registrationName,Mf);var Pf=class extends Hh{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout_=e.options.horizontalLayout,this.RTL=e.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const t=e.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),ce(this.flyout_.createDom("svg"),t),this.setVisible(!0),this.flyout_.init(e),this.render(this.toolboxDef_),(e=e.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[Za.Capability.AUTOHIDEABLE,Za.Capability.DELETE_AREA,Za.Capability.DRAG_TARGET]})}createDom_(e){e=e.getParentSvg();const t=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,Bn(this.contentsDiv_,Bc.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),re(e,"blocklyToolboxDiv"),re(e,"blocklyNonSelectable"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return re(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=z(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=z(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){if(Z(e)||e.target===this.HtmlDiv)f().hideChaff(!1);else{var t=e.target.getAttribute("id");t&&(t=this.getToolboxItemById(t)).isSelectable()&&(this.setSelectedItem(t),t.onClick(e)),f().hideChaff(!0)}H()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext_();break;case"ArrowUp":t=this.selectPrevious_();break;case"ArrowLeft":t=this.selectParent_();break;case"ArrowRight":t=this.selectChild_();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}!t&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(t=this.selectedItem_.onKeyDown(e)),t&&e.preventDefault()}createFlyout_(){const e=this.workspace_,t=new Ju({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?c($s.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):c($s.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e;for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t&&t.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const t=document.createDocumentFragment();for(let n=0;n<e.length;n++)this.createToolboxItem_(e[n],t);this.contentsDiv_.appendChild(t)}createToolboxItem_(e,t){var n=e.kind;"CATEGORY"===n.toUpperCase()&&Ue(e)&&(n=Mf.registrationName),(n=s($s.TOOLBOX_ITEM,n.toLowerCase()))&&((e=new n(e,this)).init(),this.addToolboxItem_(e),(n=e.getDiv())&&t.appendChild(n),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible()){e=e.getChildToolboxItems();for(let t=0;t<e.length;t++)this.addToolboxItem_(e[t])}}getToolboxItems(){return this.contents_}addStyle(e){e&&this.HtmlDiv&&re(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&se(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const t=e.top,n=t+e.height,i=e.left;return e=i+e.width,this.toolboxPosition===Al.TOP?new hl(-1e7,n,-1e7,1e7):this.toolboxPosition===Al.BOTTOM?new hl(t,1e7,-1e7,1e7):this.toolboxPosition===Al.LEFT?new hl(-1e7,1e7,-1e7,e):new hl(-1e7,1e7,i,1e7)}wouldDelete(e,t){return e instanceof Fh?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contentMap_[e]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout_?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===Al.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===Al.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const e=this.workspace_,t=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition===Al.LEFT?e.scrollX+t.width:e.scrollX,this.toolboxPosition===Al.TOP?e.scrollY+t.height:e.scrollY),_(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t.refreshTheme&&t.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(e){const t=this.selectedItem_;!e&&!t||e&&!Rs(e)||(this.shouldDeselectItem_(t,e)&&null!==t&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&null!==e&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent_(t,e))}shouldDeselectItem_(e,t){return null!==e&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return null!==t&&t!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),jn(this.contentsDiv_,jc.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),jn(this.contentsDiv_,jc.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e]).isSelectable()&&this.setSelectedItem(e)}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout_.show(t.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(e,t){const n=e&&e.getName();let i=t&&t.getName();e===t&&(i=null),e=new(j("toolbox_item_select"))(n,i,this.workspace_.id),I(e)}selectParent_(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext_():e.toggleExpanded(),!0}selectNext_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[++e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[--e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout_.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)Y(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),le(this.HtmlDiv))}};ee('\n.blocklyToolboxDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url("<<<PATH>>>/handclosed.cur"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n'),t($s.TOOLBOX,Fs,Pf);var Bf=Ms.Align$$module$build$src$core$inputs$align.LEFT,jf=Ms.Align$$module$build$src$core$inputs$align.CENTRE,Ff=Ms.Align$$module$build$src$core$inputs$align.RIGHT,$f=Ac.INPUT_VALUE,Uf=Ac.OUTPUT_VALUE,Hf=Ac.NEXT_STATEMENT,Gf=Ac.PREVIOUS_STATEMENT,Vf=Ms.inputTypes$$module$build$src$core$inputs$input_types.DUMMY,Wf=Al.TOP,zf=Al.BOTTOM,qf=Al.LEFT,Yf=Al.RIGHT;kh.prototype.newBlock=function(e,t){return new Nh(this,e,t)},Ch.prototype.newBlock=function(e,t){return new Fh(this,e,t)},Ch.newTrashcan=function(e){return new Gh(e)},sc.prototype.showContextMenu=function(e){if(!this.workspace.options.readOnly){var t=[];this.isDeletable()&&this.isMovable()&&(t.push(li(this)),t.push(ai(this))),ei(e,t,this.RTL)}},md.prototype.newWorkspaceSvg=function(e){return new Ch(e)},Ms.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=(e=uo(e))[0].concat(e[1]);for(let t=0;t<e.length;t++)this.getName(e[t][0],Ms.Names$$module$build$src$core$names.NameType.PROCEDURE)};var Kf=Ac,Zf={ALIGN_CENTRE:jf,ALIGN_LEFT:Bf,ALIGN_RIGHT:Ff};return Zf.ASTNode=ch,Zf.BasicCursor=Lh,Zf.Block=Nh,Zf.BlockDragger=yp,Zf.BlockSvg=Fh,Zf.Blocks=Vs,Zf.Bubble=gd,Zf.BubbleDragger=ku,Zf.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD",Zf.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",Zf.COLLAPSE_CHARS=30,Zf.CodeGenerator=Ms.CodeGenerator$$module$build$src$core$generator,Zf.CollapsibleToolboxCategory=Mf,Zf.ComponentManager=Za,Zf.Connection=ph,Zf.ConnectionChecker=Eh,Zf.ConnectionDB=Oc,Zf.ConnectionType=Ac,Zf.ContextMenu=eu,Zf.ContextMenuItems=zp,Zf.ContextMenuRegistry=tu,Zf.Css=Qa,Zf.Cursor=Dh,Zf.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID",Zf.DRAG_STACK=!0,Zf.DUMMY_INPUT=Vf,Zf.DeleteArea=Hh,Zf.DragTarget=Uh,Zf.DropDownDiv=Eu,Zf.Events=Np,Zf.Extensions=_d,Zf.Field=od,Zf.FieldAngle=Yp,Zf.FieldCheckbox=Zp,Zf.FieldColour=Xp,Zf.FieldDropdown=hd,Zf.FieldImage=Lp,Zf.FieldLabel=ih,Zf.FieldLabelSerializable=Jp,Zf.FieldMultilineInput=Qp,Zf.FieldNumber=ef,Zf.FieldTextInput=Pp,Zf.FieldVariable=tf,Zf.Flyout=sf,Zf.FlyoutButton=nf,Zf.FlyoutMetricsManager=of,Zf.Generator=Ms.CodeGenerator$$module$build$src$core$generator,Zf.Gesture=zu,Zf.Grid=qu,Zf.HorizontalFlyout=af,Zf.INPUT_VALUE=$f,Zf.Input=rh,Zf.InsertionMarkerManager=fh,Zf.InsertionMarkerPreviewer=df,Zf.Marker=Rh,Zf.MarkerManager=Yu,Zf.Menu=Gc,Zf.MenuItem=Vc,Zf.MetricsManager=fp,Zf.Msg=Ms.Msg$$module$build$src$core$msg,Zf.NEXT_STATEMENT=Hf,Zf.Names=Ms.Names$$module$build$src$core$names,Zf.OPPOSITE_TYPE=Su,Zf.OUTPUT_VALUE=Uf,Zf.Options=Ju,Zf.PREVIOUS_STATEMENT=Gf,Zf.PROCEDURE_CATEGORY_NAME="PROCEDURE",Zf.Procedures=Od,Zf.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID",Zf.RenderedConnection=Ph,Zf.Scrollbar=vl,Zf.ScrollbarPair=pp,Zf.ShortcutItems=ap,Zf.ShortcutRegistry=rp,Zf.TOOLBOX_AT_BOTTOM=zf,Zf.TOOLBOX_AT_LEFT=qf,Zf.TOOLBOX_AT_RIGHT=Yf,Zf.TOOLBOX_AT_TOP=Wf,Zf.TabNavigateCursor=Mh,Zf.Theme=Zu,Zf.ThemeManager=vh,Zf.Themes=Nf,Zf.Toolbox=Pf,Zf.ToolboxCategory=Df,Zf.ToolboxItem=Rf,Zf.ToolboxSeparator=Lf,Zf.Tooltip=Vu,Zf.Touch=Pa,Zf.Trashcan=Gh,Zf.UnattachedFieldError=sd,Zf.VARIABLE_CATEGORY_NAME="VARIABLE",Zf.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC",Zf.VERSION="10.4.1",Zf.VariableMap=wh,Zf.VariableModel=Jl,Zf.Variables=tc,Zf.VariablesDynamic=_h,Zf.VerticalFlyout=lf,Zf.WidgetDiv=Zc,Zf.Workspace=kh,Zf.WorkspaceAudio=Sh,Zf.WorkspaceComment=nc,Zf.WorkspaceCommentSvg=sc,Zf.WorkspaceDragger=Wu,Zf.WorkspaceSvg=Ch,Zf.Xml=pc,Zf.ZoomControls=$l,Zf.blockAnimations=wu,Zf.blockRendering=yh,Zf.browserEvents=qa,Zf.bubbles=vp,Zf.bumpObjects=bp,Zf.clipboard=Pc,Zf.common=Ks,Zf.config=Ms.config$$module$build$src$core$config,Zf.connectionTypes=Kf,Zf.constants={COLLAPSED_FIELD_NAME:"_TEMP_COLLAPSED_FIELD",COLLAPSED_INPUT_NAME:"_TEMP_COLLAPSED_INPUT"},Zf.defineBlocksWithJsonArray=x,Zf.dialog=Yl,Zf.fieldRegistry=dd,Zf.geras=Ef,Zf.getMainWorkspace=f,Zf.getSelected=m,Zf.hasBubble=mr,Zf.hideChaff=Ds,Zf.icons=Nd,Zf.inject=xs,Zf.inputTypes=Ms.inputTypes$$module$build$src$core$inputs$input_types,Zf.inputs=uf,Zf.isCopyable=Bo,Zf.isIcon=Os,Zf.isObservable=Dr,Zf.isPaster=Ns,Zf.isSerializable=nn,Zf.isVariableBackedParameterModel=nt,Zf.minimalist=Sf,Zf.procedures=Od,Zf.registry=Us,Zf.renderManagement=hc,Zf.serialization=hp,Zf.setLocale=Hl,Zf.setParentContainer=v,Zf.svgResize=_,Zf.thrasos=If,Zf.uiPosition=Pl,Zf.utils=Td,Zf.zelos=Wp,Object.defineProperties(Zf,{HSV_SATURATION:{get:function(){return ne("Blockly.HSV_SATURATION","version 10","version 11","Blockly.utils.colour.getHsvSaturation()"),br()},set:function(e){ne("Blockly.HSV_SATURATION","version 10","version 11","Blockly.utils.colour.setHsvSaturation()"),yr(e)}},HSV_VALUE:{get:function(){return ne("Blockly.HSV_VALUE","version 10","version 11","Blockly.utils.colour.getHsvValue()"),vr()},set:function(e){ne("Blockly.HSV_VALUE","version 10","version 11","Blockly.utils.colour.setHsvValue()"),_r(e)}}}),"Blockly"in globalThis||(globalThis.Blockly={Msg:Gl}),Zf.__namespace__=Ms,Zf},"function"==typeof define&&define.amd?define([],r):"object"==typeof n?t.exports=r():i.Blockly=r()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],372:[function(e,t,n){var i,r;i=this,r=function(e){return e},"function"==typeof define&&define.amd?define(["./blocks_compressed"],r):"object"==typeof n?t.exports=e("./blocks_compressed"):i.BlocklyBlocks=i.BlocklyBlocks},{"./blocks_compressed":373}],373:[function(e,t,n){var i,r;i=this,r=function(e){var t=e.__namespace__,n=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),i={customContextMenu:function(e){if(this.isInFlyout)"variables_get_dynamic"!==this.type&&"variables_get_reporter_dynamic"!==this.type||(i={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:r(this)},s=this.getField("VAR").getText(),s={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",s),enabled:!0,callback:o(this)},e.unshift(i),e.unshift(s));else{if("variables_get_dynamic"===this.type)var n="variables_set_dynamic",i=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else n="variables_get_dynamic",i=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var s=this.getField("VAR");n={type:n,fields:{VAR:s.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:i.replace("%1",s.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,n)})}},onchange:function(e){e=this.getFieldValue("VAR"),e=t.getVariable$$module$build$src$core$variables(this.workspace,e),"variables_get_dynamic"===this.type?this.outputConnection.setCheck(e.type):this.getInput("VALUE").connection.setCheck(e.type)}},r=function(e){return function(){const n=e.workspace,i=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(n,i)}},o=function(e){return function(){const t=e.workspace,n=e.getField("VAR").getVariable();t.deleteVariableById(n.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",i),t.defineBlocks$$module$build$src$core$common(n);var s={blocks:n},a=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),l={customContextMenu:function(e){if(this.isInFlyout)"variables_get"!==this.type&&"variables_get_reporter"!==this.type||(i={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:c(this)},r=this.getField("VAR").getText(),r={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",r),enabled:!0,callback:u(this)},e.unshift(i),e.unshift(r));else{if("variables_get"===this.type)var n="variables_set",i=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else n="variables_get",i=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var r=this.getField("VAR");n={type:n,fields:{VAR:r.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:i.replace("%1",r.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,n)})}}},c=function(e){return function(){const n=e.workspace,i=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(n,i)}},u=function(e){return function(){const t=e.workspace,n=e.getField("VAR").getVariable();t.deleteVariableById(n.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",l),t.defineBlocks$$module$build$src$core$common(a);var d={blocks:a},h=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_multiline",message0:"%1 %2",args0:[{type:"field_image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAARCAYAAADpPU2iAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAdhgAAHYYBXaITgQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMS42/U4J6AAAAP1JREFUOE+Vks0KQUEYhjmRIja4ABtZ2dm5A3t3Ia6AUm7CylYuQRaUhZSlLZJiQbFAyRnPN33y01HOW08z8873zpwzM4F3GWOCruvGIE4/rLaV+Nq1hVGMBqzhqlxgCys4wJA65xnogMHsQ5lujnYHTejBBCK2mE4abjCgMGhNxHgDFWjDSG07kdfVa2pZMf4ZyMAdWmpZMfYOsLiDMYMjlMB+K613QISRhTnITnsYg5yUd0DETmEoMlkFOeIT/A58iyK5E18BuTBfgYXfwNJv4P9/oEBerLylOnRhygmGdPpTTBZAPkde61lbQe4moWUvYUZYLfUNftIY4zwA5X2Z9AYnQrEAAAAASUVORK5CYII=",width:12,height:17,alt:""},{type:"field_multilinetext",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),p={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var n=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",`${n}`),n=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",`${n}`),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},updateAt_:function(e,n){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),n?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),2===e&&t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL));const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==n){const n=this.getSourceBlock();return n.updateAt_(e,i),n.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(i,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}};h.text_getSubstring=p,h.text_changeCase={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},h.text_trim={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},h.text_print={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var f={updateType_:function(e){this.outputConnection.setCheck("NUMBER"===e?"Number":"String")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("type",this.getFieldValue("TYPE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("type"))}};h.text_prompt_ext=Object.assign({},f,{init:function(){var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendValueInput("TEXT").appendField(e,"TYPE"),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});var g=Object.assign({},f,{init:function(){this.mixin(m);var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendDummyInput().appendField(e,"TYPE").appendField(this.newQuote_(!0)).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});h.text_prompt=g,h.text_count={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},h.text_replace={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},h.text_reverse={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var m={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(e){for(let t,n=0;t=this.inputList[n];n++)for(let n,i=0;n=t.fieldRow[i];i++)if(e===n.name)return t.insertFieldAt(i,this.newQuote_(!0)),void t.insertFieldAt(i+2,this.newQuote_(!1));console.warn('field named "'+e+'" not found in '+this.toDevString())},newQuote_:function(e){return e=this.RTL?!e:e,t.fromJson$$module$build$src$core$field_registry({type:"field_image",src:e?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:e?"":""})}},b={itemCount_:0,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",`${this.itemCount_}`),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("text_create_join_container");t.initSvg();let n=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("text_create_join_item");t.initSvg(),n.connect(t.previousConnection),n=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const n=this.getInput("ADD"+t).connection.targetConnection;n&&-1===e.indexOf(n)&&n.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let n;null==(n=e[t])||n.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const n=this.getInput("ADD"+t);e.valueConnection_=n&&n.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const n=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&n.appendField(t.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};t.register$$module$build$src$core$extensions("text_append_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var y={isAt_:!1,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("at",`${this.isAt_}`),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),e&&(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=e}};t.register$$module$build$src$core$extensions("text_indexOf_tooltip",(function(){this.setTooltip((()=>t.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))})),t.register$$module$build$src$core$extensions("text_quotes",(function(){this.mixin(m),this.quoteField_("TEXT")})),t.registerMixin$$module$build$src$core$extensions("quote_image_mixin",m),t.registerMutator$$module$build$src$core$extensions("text_join_mutator",b,(function(){this.mixin(m),this.itemCount_=2,this.updateShape_(),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))})),t.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",y,(function(){this.getField("WHERE").setValidator((function(e){e="FROM_START"===e||"FROM_END"===e;const t=this.getSourceBlock();e!==t.isAt_&&t.updateAt_(e)})),this.updateAt_(!0),this.setTooltip((()=>{var e=this.getFieldValue("WHERE");let n=t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return("FROM_START"===e||"FROM_END"===e)&&(e="FROM_START"===e?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(n+="  "+e.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),n}))})),t.defineBlocks$$module$build$src$core$common(h);var v={blocks:h},_={},E={setStatements_:function(e){this.hasStatements_!==e&&(e?(this.appendStatementInput("STACK").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=e)},updateParams_:function(){let e="";this.arguments_.length&&(e=t.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),t.disable$$module$build$src$core$events$utils();try{this.setFieldValue(e,"PARAMS")}finally{t.enable$$module$build$src$core$events$utils()}},mutationToDom:function(e){const n=t.createElement$$module$build$src$core$utils$xml("mutation");e&&n.setAttribute("name",this.getFieldValue("NAME"));for(let i=0;i<this.argumentVarModels_.length;i++){const r=t.createElement$$module$build$src$core$utils$xml("arg"),o=this.argumentVarModels_[i];r.setAttribute("name",o.name),r.setAttribute("varid",o.getId()),e&&this.paramIds_&&r.setAttribute("paramId",this.paramIds_[i]),n.appendChild(r)}return this.hasStatements_||n.setAttribute("statements","false"),n},domToMutation:function(e){this.arguments_=[],this.argumentVarModels_=[];for(let i,r=0;i=e.childNodes[r];r++)if("arg"===i.nodeName.toLowerCase()){var n=i;const e=n.getAttribute("name");n=n.getAttribute("varid")||n.getAttribute("varId"),this.arguments_.push(e),null!==(n=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,n,e,""))?this.argumentVarModels_.push(n):console.log(`Failed to create a variable named "${e}", ignoring.`)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_("false"!==e.getAttribute("statements"))},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const e=Object.create(null);if(this.argumentVarModels_.length){e.params=[];for(let t=0;t<this.argumentVarModels_.length;t++)e.params.push({name:this.argumentVarModels_[t].name,id:this.argumentVarModels_[t].getId()})}return this.hasStatements_||(e.hasStatements=!1),e},loadExtraState:function(e){if(this.arguments_=[],this.argumentVarModels_=[],e.params)for(let i=0;i<e.params.length;i++){var n=e.params[i];n=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,n.id,n.name,""),this.arguments_.push(n.name),this.argumentVarModels_.push(n)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(!1!==e.hasStatements)},decompose:function(e){const n=t.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_mutatorcontainer");var i=t.createElement$$module$build$src$core$utils$xml("statement");i.setAttribute("name","STACK"),n.appendChild(i);for(let e=0;e<this.arguments_.length;e++){const n=t.createElement$$module$build$src$core$utils$xml("block");n.setAttribute("type","procedures_mutatorarg");var r=t.createElement$$module$build$src$core$utils$xml("field");r.setAttribute("name","NAME");const o=t.createTextNode$$module$build$src$core$utils$xml(this.arguments_[e]);r.appendChild(o),n.appendChild(r),r=t.createElement$$module$build$src$core$utils$xml("next"),n.appendChild(r),i.appendChild(n),i=r}return e=t.domToBlock$$module$build$src$core$xml(n,e),"procedures_defreturn"===this.type?e.setFieldValue(this.hasStatements_,"STATEMENTS"):e.removeInput("STATEMENT_INPUT"),t.mutateCallers$$module$build$src$core$procedures(this),e},compose:function(e){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let n=e.getInputTargetBlock("STACK");for(;n&&!n.isInsertionMarker();){var i=n.getFieldValue("NAME");this.arguments_.push(i),i=this.workspace.getVariable(i,""),this.argumentVarModels_.push(i),this.paramIds_.push(n.id),n=n.nextConnection&&n.nextConnection.targetBlock()}if(this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),null!==(e=e.getFieldValue("STATEMENTS"))&&(e="TRUE"===e,this.hasStatements_!==e))if(e){var r;this.setStatements_(!0),null==(r=this.statementConnection_)||r.reconnect(this,"STACK"),this.statementConnection_=null}else r=this.getInput("STACK").connection,(this.statementConnection_=r.targetConnection)&&((r=r.targetBlock()).unplug(),r.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(e,n){var i=this.workspace.getVariableById(e);if(""===i.type){i=i.name,n=this.workspace.getVariableById(n);var r=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e&&(this.arguments_[t]=n.name,this.argumentVarModels_[t]=n,r=!0);r&&(this.displayRenamedVar_(i,n.name),t.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(e){const n=e.name;let i,r=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e.getId()&&(i=this.arguments_[t],this.arguments_[t]=n,r=!0);r&&(this.displayRenamedVar_(i,n),t.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(e,n){this.updateParams_();var i=this.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(i&&i.bubbleIsVisible()){i=i.getWorkspace().getAllBlocks(!1);for(let r,o=0;r=i[o];o++)"procedures_mutatorarg"===r.type&&t.Names$$module$build$src$core$names.equals(e,r.getFieldValue("NAME"))&&r.setFieldValue(n,"NAME")}},customContextMenu:function(e){if(!this.isInFlyout){var n=this.getFieldValue("NAME"),i={type:this.callType_,extraState:{name:n,params:this.arguments_}};if(e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",n),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)}),!this.isCollapsed())for(n=0;n<this.argumentVarModels_.length;n++){const r={type:"variables_get",fields:{VAR:{name:(i=this.argumentVarModels_[n]).name,id:i.getId(),type:i.type}}};e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",i.name),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,r)})}}}};_.procedures_defnoreturn=Object.assign({},E,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),_.procedures_defreturn=Object.assign({},E,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(t.Align$$module$build$src$core$inputs$input.RIGHT).appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var T={init:function(){this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};_.procedures_mutatorcontainer=T;var x={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:t.DEFAULT_ARG$$module$build$src$core$procedures});e.setValidator(this.validator_),e.oldShowEditorFn_=e.showEditor_,e.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,e.onFinishEditing_=this.deleteIntermediateVars_,e.createdVariables_=[],e.onFinishEditing_("x")},validator_:function(e){var t=this.getSourceBlock();const n=t.workspace.getRootWorkspace();if(!(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;const i=(t.workspace.targetWorkspace||t.workspace).getAllBlocks(!1),r=e.toLowerCase();for(let e=0;e<i.length;e++){if(i[e].id===this.getSourceBlock().id)continue;const t=i[e].getFieldValue("NAME");if(t&&t.toLowerCase()===r)return null}return t.isInFlyout||((t=n.getVariable(e,""))&&t.name!==e&&n.renameVariableById(t.getId(),e),t||(t=n.createVariable(e,""))&&this.createdVariables_&&this.createdVariables_.push(t)),e},deleteIntermediateVars_:function(e){const t=this.getSourceBlock().workspace.getRootWorkspace();if(t)for(let n=0;n<this.createdVariables_.length;n++){const i=this.createdVariables_[n];i.name!==e&&t.deleteVariableById(i.getId())}}};_.procedures_mutatorarg=x;var w={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,n){t.Names$$module$build$src$core$names.equals(e,this.getProcedureCall())&&(this.setFieldValue(n,"NAME"),this.setTooltip((this.outputConnection?t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",n)))},setProcedureParameters_:function(e,n){var i=t.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((i=(i=i&&i.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&i.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),e.join("\n")===this.arguments_.join("\n"))this.quarkIds_=n;else{if(n.length!==e.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let e=0;e<this.arguments_.length;e++){var r=this.getInput("ARG"+e);r&&(r=r.connection.targetConnection,this.quarkConnections_[this.quarkIds_[e]]=r,i&&r&&-1===n.indexOf(this.quarkIds_[e])&&(r.disconnect(),r.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(e),this.argumentVarModels_=[],e=0;e<this.arguments_.length;e++)i=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[e],""),this.argumentVarModels_.push(i);if(this.updateShape_(),this.quarkIds_=n)for(n=0;n<this.arguments_.length;n++)if((e=this.quarkIds_[n])in this.quarkConnections_){let t;null!=(t=this.quarkConnections_[e])&&t.reconnect(this,"ARG"+n)||delete this.quarkConnections_[e]}}},updateShape_:function(){for(var e=0;e<this.arguments_.length;e++){var n=this.getField("ARGNAME"+e);if(n){t.disable$$module$build$src$core$events$utils();try{n.setValue(this.arguments_[e])}finally{t.enable$$module$build$src$core$events$utils()}}else n=t.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[e]}),this.appendValueInput("ARG"+e).setAlign(t.Align$$module$build$src$core$inputs$input.RIGHT).appendField(n,"ARGNAME"+e).init()}for(e=this.arguments_.length;this.getInput("ARG"+e);e++)this.removeInput("ARG"+e);(e=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||(e.appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"),e.init()):this.getField("WITH")&&e.removeField("WITH"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("name",this.getProcedureCall());for(let n=0;n<this.arguments_.length;n++){const i=t.createElement$$module$build$src$core$utils$xml("arg");i.setAttribute("name",this.arguments_[n]),e.appendChild(i)}return e},domToMutation:function(e){var t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t),t=[];const n=[];for(let i,r=0;i=e.childNodes[r];r++)"arg"===i.nodeName.toLowerCase()&&(t.push(i.getAttribute("name")),n.push(i.getAttribute("paramId")));this.setProcedureParameters_(t,n)},saveExtraState:function(){const e=Object.create(null);return e.name=this.getProcedureCall(),this.arguments_.length&&(e.params=this.arguments_),e},loadExtraState:function(e){if(this.renameProcedure(this.getProcedureCall(),e.name),e=e.params){const t=[];t.length=e.length,t.fill(null),this.setProcedureParameters_(e,t)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&e.recordUndo)if(e.type===t.CREATE$$module$build$src$core$events$utils&&-1!==e.ids.indexOf(this.id)){var n=this.getProcedureCall();if(!(n=t.getDefinition$$module$build$src$core$procedures(n,this.workspace))||n.type===this.defType_&&JSON.stringify(n.getVars())===JSON.stringify(this.arguments_)||(n=null),!n){t.setGroup$$module$build$src$core$events$utils(e.group),e=t.createElement$$module$build$src$core$utils$xml("xml"),(n=t.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type",this.defType_);var i=this.getRelativeToSurfaceXY(),r=i.y+2*t.config$$module$build$src$core$config.snapRadius;n.setAttribute("x",`${i.x+t.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),n.setAttribute("y",`${r}`),i=this.mutationToDom(),n.appendChild(i),(i=t.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),r=this.getProcedureCall();const o=t.findLegalName$$module$build$src$core$procedures(r,this);r!==o&&this.renameProcedure(r,o),i.appendChild(t.createTextNode$$module$build$src$core$utils$xml(r)),n.appendChild(i),e.appendChild(n),t.domToWorkspace$$module$build$src$core$xml(e,this.workspace),t.setGroup$$module$build$src$core$events$utils(!1)}}else e.type===t.DELETE$$module$build$src$core$events$utils?(n=this.getProcedureCall(),t.getDefinition$$module$build$src$core$procedures(n,this.workspace)||(t.setGroup$$module$build$src$core$events$utils(e.group),this.dispose(!0),t.setGroup$$module$build$src$core$events$utils(!1))):e.type===t.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element&&(n=this.getProcedureCall(),(n=t.getDefinition$$module$build$src$core$procedures(n,this.workspace))&&n.id===e.blockId&&((n=t.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),t.setGroup$$module$build$src$core$events$utils(e.group),e.newValue?(this.previousEnabledState_=this.isEnabled(),this.setEnabled(!1)):this.setEnabled(this.previousEnabledState_),t.setGroup$$module$build$src$core$events$utils(n)))},customContextMenu:function(e){if(this.workspace.isMovable()){var n=this.getProcedureCall(),i=this.workspace;e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const e=t.getDefinition$$module$build$src$core$procedures(n,i);e&&(i.centerOnBlock(e.id),e.select())}})}}};_.procedures_callnoreturn=Object.assign({},w,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},defType_:"procedures_defnoreturn"}),_.procedures_callreturn=Object.assign({},w,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},defType_:"procedures_defreturn"});var k={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("value",String(Number(this.hasReturnValue_))),e},domToMutation:function(e){this.hasReturnValue_="1"===e.getAttribute("value"),this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(e){if(!(this.workspace.isDragging&&this.workspace.isDragging()||e.type!==t.MOVE$$module$build$src$core$events$utils)){var n=!1,i=this;do{if(-1!==this.FUNCTION_TYPES.indexOf(i.type)){n=!0;break}i=i.getSurroundParent()}while(i);n?("procedures_defnoreturn"===i.type&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):"procedures_defreturn"!==i.type||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),this.isInFlyout||(i=t.getGroup$$module$build$src$core$events$utils(),t.setGroup$$module$build$src$core$events$utils(e.group),this.setEnabled(n),t.setGroup$$module$build$src$core$events$utils(i))}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};_.procedures_ifreturn=k,t.defineBlocks$$module$build$src$core$common(_);var S={blocks:_},C=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["","PI"],["e","E"],["","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt()","SQRT1_2"],["","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]);t.register$$module$build$src$core$extensions("math_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"}));var A={mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),n="DIVISIBLE_BY"===this.getFieldValue("PROPERTY");return e.setAttribute("divisor_input",String(n)),e},domToMutation:function(e){e="true"===e.getAttribute("divisor_input"),this.updateShape_(e)},updateShape_:function(e){const t=this.getInput("DIVISOR");e?t||this.appendValueInput("DIVISOR").setCheck("Number"):t&&this.removeInput("DIVISOR")}};t.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",A,(function(){this.getField("PROPERTY").setValidator((function(e){e="DIVISIBLE_BY"===e,this.getSourceBlock().updateShape_(e)}))})),t.register$$module$build$src$core$extensions("math_change_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var I={updateType_:function(e){"MODE"===e?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("op",this.getFieldValue("OP")),e},domToMutation:function(e){if(null===(e=e.getAttribute("op")))throw new TypeError("xmlElement had no op attribute");this.updateType_(e)}};t.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",I,(function(){this.getField("OP").setValidator(function(e){this.updateType_(e)}.bind(this))})),t.defineBlocks$$module$build$src$core$common(C);var O={blocks:C},N=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]);t.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",{WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"})),t.register$$module$build$src$core$extensions("controls_flow_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",{BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"}));var R={customContextMenu:function(e){if(!this.isInFlyout){var n=this.getField("VAR"),i=n.getVariable().name;this.isCollapsed()||null===i||(n={type:"variables_get",fields:{VAR:n.saveState(!0)}},e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",i),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,n)}))}}};t.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",R),t.register$$module$build$src$core$extensions("controls_for_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),t.register$$module$build$src$core$extensions("controls_forEach_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var D=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),L={getSurroundLoop:function(){let e=this;do{if(D.has(e.type))return e;e=e.getSurroundParent()}while(e);return null},onchange:function(e){var n=this.workspace;if(n.isDragging&&!n.isDragging()&&e.type===t.MOVE$$module$build$src$core$events$utils&&(n=!!this.getSurroundLoop(),this.setWarningText(n?null:t.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout)){const i=t.getGroup$$module$build$src$core$events$utils();t.setGroup$$module$build$src$core$events$utils(e.group),this.setEnabled(n),t.setGroup$$module$build$src$core$events$utils(i)}}};t.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",L),t.defineBlocks$$module$build$src$core$common(N);var M={blocks:N,loopTypes:D},P=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["","NEQ"],["<","LT"],["","LTE"],[">","GT"],["","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]);t.register$$module$build$src$core$extensions("logic_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"}));var B={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=t.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&e.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=Object.create(null);return this.elseifCount_&&(e.elseIfCount=this.elseifCount_),this.elseCount_&&(e.hasElse=!0),e},loadExtraState:function(e){this.elseifCount_=e.elseIfCount||0,this.elseCount_=e.hasElse?1:0,this.updateShape_()},decompose:function(e){const t=e.newBlock("controls_if_if");t.initSvg();let n=t.nextConnection;for(let t=1;t<=this.elseifCount_;t++){const t=e.newBlock("controls_if_elseif");t.initSvg(),n.connect(t.previousConnection),n=t.nextConnection}return this.elseCount_&&((e=e.newBlock("controls_if_else")).initSvg(),n.connect(e.previousConnection)),t},compose:function(e){e=e.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const t=[null],n=[null];let i=null;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":this.elseifCount_++,t.push(e.valueConnection_),n.push(e.statementConnection_);break;case"controls_if_else":this.elseCount_++,i=e.statementConnection_;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(t,n,i)},saveConnections:function(e){e=e.nextConnection.targetBlock();let t=1;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":var n=this.getInput("IF"+t);const i=this.getInput("DO"+t);e.valueConnection_=n&&n.connection.targetConnection,e.statementConnection_=i&&i.connection.targetConnection,t++;break;case"controls_if_else":n=this.getInput("ELSE"),e.statementConnection_=n&&n.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}},rebuildShape_:function(){const e=[null],t=[null];let n=null;this.getInput("ELSE")&&(n=this.getInput("ELSE").connection.targetConnection);for(let n=1;this.getInput("IF"+n);n++){const i=this.getInput("IF"+n),r=this.getInput("DO"+n);e.push(i.connection.targetConnection),t.push(r.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(e,t,n)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var e=1;this.getInput("IF"+e);e++)this.removeInput("IF"+e),this.removeInput("DO"+e);for(e=1;e<=this.elseifCount_;e++)this.appendValueInput("IF"+e).setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+e).appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(e,t,n){for(let n=1;n<=this.elseifCount_;n++){let i,r;null==(i=e[n])||i.reconnect(this,"IF"+n),null==(r=t[n])||r.reconnect(this,"DO"+n)}null==n||n.reconnect(this,"ELSE")}};t.registerMutator$$module$build$src$core$extensions("controls_if_mutator",B,null,["controls_if_elseif","controls_if_else"]),t.register$$module$build$src$core$extensions("controls_if_tooltip",(function(){this.setTooltip(function(){return this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4:"":t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1}.bind(this))}));var j={onchange:function(e){this.prevBlocks_||(this.prevBlocks_=[null,null]);var n=this.getInputTargetBlock("A");const i=this.getInputTargetBlock("B");n&&i&&!this.workspace.connectionChecker.doTypeChecks(n.outputConnection,i.outputConnection)&&(t.setGroup$$module$build$src$core$events$utils(e.group),(e=this.prevBlocks_[0])!==n&&(n.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("A").connection.connect(e.outputConnection)),(n=this.prevBlocks_[1])!==i&&(i.unplug(),!n||n.isDisposed()||n.isShadow()||this.getInput("B").connection.connect(n.outputConnection)),this.bumpNeighbours(),t.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}};t.register$$module$build$src$core$extensions("logic_compare",(function(){this.mixin(j)}));var F={prevParentConnection_:null,onchange:function(e){const n=this.getInputTargetBlock("THEN"),i=this.getInputTargetBlock("ELSE"),r=this.outputConnection.targetConnection;if((n||i)&&r)for(let o=0;2>o;o++){const s=1===o?n:i;s&&!s.workspace.connectionChecker.doTypeChecks(s.outputConnection,r)&&(t.setGroup$$module$build$src$core$events$utils(e.group),r===this.prevParentConnection_?(this.unplug(),r.getSourceBlock().bumpNeighbours()):(s.unplug(),s.bumpNeighbours()),t.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=r}};t.registerMixin$$module$build$src$core$extensions("logic_ternary",F),t.defineBlocks$$module$build$src$core$common(P);var $=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),U={init:function(){this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",String(this.itemCount_)),e},domToMutation:function(e){if(!(e=e.getAttribute("items")))throw new TypeError("element did not have items");this.itemCount_=parseInt(e,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("lists_create_with_container");t.initSvg();let n=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("lists_create_with_item");if(t.initSvg(),!t.previousConnection)throw Error("itemBlock has no previousConnection");n.connect(t.previousConnection),n=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const n=this.getInput("ADD"+t).connection.targetConnection;n&&-1===e.indexOf(n)&&n.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let n;null==(n=e[t])||n.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const n=this.getInput("ADD"+t);let i;e.valueConnection_=null==(i=n)?void 0:i.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const n=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&n.appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};$.lists_create_with=U;var H={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};$.lists_create_with_container=H;var G={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};$.lists_create_with_item=G;var V={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),!(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})))throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(e,"END"),this.setInputsInline(!0),this.setTooltip((()=>t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))}};$.lists_indexOf=V;var W={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((function(e){e="REMOVE"===e,this.getSourceBlock().updateStatement_(e)})),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),n=this.getFieldValue("WHERE");let i="";switch(e+" "+n){case"GET FROM_START":case"GET FROM_END":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":i=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return"FROM_START"!==n&&"FROM_END"!==n||(i+="  "+("FROM_START"===n?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("statement",String(!this.outputConnection));const n=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(n)),e},domToMutation:function(e){const t="true"===e.getAttribute("statement");this.updateStatement_(t),e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(e){e.isStatement?this.updateStatement_(!0):"string"==typeof e&&this.domToMutation(t.textToDom$$module$build$src$core$utils$xml(e))},updateStatement_:function(e){e!==!this.outputConnection&&(this.unplug(!0,!0),e?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const n=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});n.setValidator((function(t){const n="FROM_START"===t||"FROM_END"===t;if(n!==e){const e=this.getSourceBlock();return e.updateAt_(n),e.setFieldValue(t,"WHERE"),null}})),this.getInput("AT").appendField(n,"WHERE"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};$.lists_getIndex=W;var z={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),n=this.getFieldValue("WHERE");let i="";switch(e+" "+n){case"SET FROM_START":case"SET FROM_END":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":i=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return"FROM_START"!==n&&"FROM_END"!==n||(i+="  "+t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),n=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(n)),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const n=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});n.setValidator((function(t){const n="FROM_START"===t||"FROM_END"===t;if(n!==e){const e=this.getSourceBlock();return e.updateAt_(n),e.setFieldValue(t,"WHERE"),null}})),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(n,"WHERE")}};$.lists_setIndex=z;var q={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var n=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",String(n)),n=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",String(n)),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e,n){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),n?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e);const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==n){const n=this.getSourceBlock();return n.updateAt_(e,i),n.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(i,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};$.lists_getSublist=q,$.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},$.lists_split={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!e)throw Error("field_dropdown not found");e.setValidator((e=>{this.updateType_(e)})),this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(e,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip((()=>{const e=this.getFieldValue("MODE");if("SPLIT"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if("JOIN"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+e)}))},updateType_:function(e){if(this.getFieldValue("MODE")!==e){const e=this.getInput("INPUT").connection;e.setShadowDom(null);const t=e.targetBlock();t&&(e.disconnect(),t.isShadow()?t.dispose(!1):this.bumpNeighbours())}"SPLIT"===e?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("mode",this.getFieldValue("MODE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("mode"))},saveExtraState:function(){return null},loadExtraState:function(){}},t.defineBlocks$$module$build$src$core$common($);var Y={blocks:$},K=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"colour_picker",message0:"%1",args0:[{type:"field_colour",name:"COLOUR",colour:"#ff0000"}],output:"Colour",helpUrl:"%{BKY_COLOUR_PICKER_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_PICKER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"colour_random",message0:"%{BKY_COLOUR_RANDOM_TITLE}",output:"Colour",helpUrl:"%{BKY_COLOUR_RANDOM_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RANDOM_TOOLTIP}"},{type:"colour_rgb",message0:"%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3",args0:[{type:"input_value",name:"RED",check:"Number",align:"RIGHT"},{type:"input_value",name:"GREEN",check:"Number",align:"RIGHT"},{type:"input_value",name:"BLUE",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_RGB_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RGB_TOOLTIP}"},{type:"colour_blend",message0:"%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} %1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3",args0:[{type:"input_value",name:"COLOUR1",check:"Colour",align:"RIGHT"},{type:"input_value",name:"COLOUR2",check:"Colour",align:"RIGHT"},{type:"input_value",name:"RATIO",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_BLEND_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_BLEND_TOOLTIP}"}]);t.defineBlocks$$module$build$src$core$common(K);var Z={blocks:K},X={blocks:Object.assign({},K,$,P,N,C,_,a,n),colour:Z,lists:Y,loops:M,math:O,procedures:S,texts:v,variables:d,variablesDynamic:s};return X.__namespace__=t,X},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],r):"object"==typeof n?t.exports=r(e("./blockly_compressed.js")):i.Blockly.libraryBlocks=r(i.Blockly)},{"./blockly_compressed.js":371}],374:[function(e,t,n){var i,r;i=this,r=function(e,t,n,i){"use strict";return e.setLocale(t),e},"function"==typeof define&&define.amd?define(["./core-browser","./msg/en","./blocks","./javascript"],r):"object"==typeof n?t.exports=r(e("./core-browser"),e("./msg/en"),e("./blocks"),e("./javascript")):i.Blockly=r(i.Blockly,i.En,i.BlocklyBlocks,i.BlocklyJS)},{"./blocks":372,"./core-browser":375,"./javascript":377,"./msg/en":379}],375:[function(e,t,n){var i,r;i=this,r=function(e){"use strict";return e},"function"==typeof define&&define.amd?define(["./blockly"],r):"object"==typeof n?t.exports=r(e("./blockly")):i.Blockly=r(i.Blockly)},{"./blockly":370}],376:[function(e,t,n){var i,r;i=this,r=function(e){return e},"function"==typeof define&&define.amd?define(["./browser"],r):"object"==typeof n?t.exports=e("./node"):i.Blockly=i.Blockly},{"./node":374}],377:[function(e,t,n){var i,r;i=this,r=function(e,t){return t},"function"==typeof define&&define.amd?define(["./core","./javascript_compressed.js"],r):"object"==typeof n?t.exports=r(e("./core"),e("./javascript_compressed.js")):i.BlocklyJavaScript=r(i.Blockly,i.BlocklyJavaScript)},{"./core":375,"./javascript_compressed.js":378}],378:[function(e,t,n){var i,r;i=this,r=function(e){var t,n,i=e.__namespace__,r=function(e,n){var i=0;let r="";n.STATEMENT_PREFIX&&(r+=n.injectId(n.STATEMENT_PREFIX,e));do{const o=n.valueToCode(e,"IF"+i,t.NONE)||"false";let s=n.statementToCode(e,"DO"+i);n.STATEMENT_SUFFIX&&(s=n.prefixLines(n.injectId(n.STATEMENT_SUFFIX,e),n.INDENT)+s),r+=(0<i?" else ":"")+"if ("+o+") {\n"+s+"}",i++}while(e.getInput("IF"+i));return(e.getInput("ELSE")||n.STATEMENT_SUFFIX)&&(i=n.statementToCode(e,"ELSE"),n.STATEMENT_SUFFIX&&(i=n.prefixLines(n.injectId(n.STATEMENT_SUFFIX,e),n.INDENT)+i),r+=" else {\n"+i+"}"),r+"\n"},o=function(e,n){let r;r=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):n.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let o=n.statementToCode(e,"DO");o=n.addLoopTrap(o,e),e="";const s=n.nameDB_.getDistinctName("count",i.NameType$$module$build$src$core$names.VARIABLE);let a=r;return r.match(/^\w+$/)||i.isNumber$$module$build$src$core$utils$string(r)||(e+="var "+(a=n.nameDB_.getDistinctName("repeat_end",i.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+"for (var "+s+" = 0; "+s+" < "+a+"; "+s+"++) {\n"+o+"}\n"},s=function(e,n){const i=e.getFieldValue("OP");let r;if("NEG"===i)return"-"===(e=n.valueToCode(e,"NUM",t.UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_NEGATION];switch(e="SIN"===i||"COS"===i||"TAN"===i?n.valueToCode(e,"NUM",t.DIVISION)||"0":n.valueToCode(e,"NUM",t.NONE)||"0",i){case"ABS":r="Math.abs("+e+")";break;case"ROOT":r="Math.sqrt("+e+")";break;case"LN":r="Math.log("+e+")";break;case"EXP":r="Math.exp("+e+")";break;case"POW10":r="Math.pow(10,"+e+")";break;case"ROUND":r="Math.round("+e+")";break;case"ROUNDUP":r="Math.ceil("+e+")";break;case"ROUNDDOWN":r="Math.floor("+e+")";break;case"SIN":r="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":r="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":r="Math.tan("+e+" / 180 * Math.PI)"}if(r)return[r,t.FUNCTION_CALL];switch(i){case"LOG10":r="Math.log("+e+") / Math.log(10)";break;case"ASIN":r="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":r="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":r="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+i)}return[r,t.DIVISION]},a=function(e,n){const i=n.getProcedureName(e.getFieldValue("NAME"));var r="";n.STATEMENT_PREFIX&&(r+=n.injectId(n.STATEMENT_PREFIX,e)),n.STATEMENT_SUFFIX&&(r+=n.injectId(n.STATEMENT_SUFFIX,e)),r&&(r=n.prefixLines(r,n.INDENT));let o="";n.INFINITE_LOOP_TRAP&&(o=n.prefixLines(n.injectId(n.INFINITE_LOOP_TRAP,e),n.INDENT));const s=n.statementToCode(e,"STACK");let a=n.valueToCode(e,"RETURN",t.NONE)||"",l="";s&&a&&(l=r),a&&(a=n.INDENT+"return "+a+";\n");const c=[],u=e.getVars();for(let e=0;e<u.length;e++)c[e]=n.getVariableName(u[e]);return r="function "+i+"("+c.join(", ")+") {\n"+r+o+s+l+a+"}",r=n.scrub_(e,r),n.definitions_["%"+i]=r,null},l=function(e,n){return n="window.prompt("+(e.getField("TEXT")?n.quote_(e.getFieldValue("TEXT")):n.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(n="Number("+n+")"),[n,t.FUNCTION_CALL]},c=function(e,n){return[n.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,n){const i=n.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return n.getVariableName(e.getFieldValue("VAR"))+" = "+i+";\n"};(n=t||(t={}))[n.ATOMIC=0]="ATOMIC",n[n.NEW=1.1]="NEW",n[n.MEMBER=1.2]="MEMBER",n[n.FUNCTION_CALL=2]="FUNCTION_CALL",n[n.INCREMENT=3]="INCREMENT",n[n.DECREMENT=3]="DECREMENT",n[n.BITWISE_NOT=4.1]="BITWISE_NOT",n[n.UNARY_PLUS=4.2]="UNARY_PLUS",n[n.UNARY_NEGATION=4.3]="UNARY_NEGATION",n[n.LOGICAL_NOT=4.4]="LOGICAL_NOT",n[n.TYPEOF=4.5]="TYPEOF",n[n.VOID=4.6]="VOID",n[n.DELETE=4.7]="DELETE",n[n.AWAIT=4.8]="AWAIT",n[n.EXPONENTIATION=5]="EXPONENTIATION",n[n.MULTIPLICATION=5.1]="MULTIPLICATION",n[n.DIVISION=5.2]="DIVISION",n[n.MODULUS=5.3]="MODULUS",n[n.SUBTRACTION=6.1]="SUBTRACTION",n[n.ADDITION=6.2]="ADDITION",n[n.BITWISE_SHIFT=7]="BITWISE_SHIFT",n[n.RELATIONAL=8]="RELATIONAL",n[n.IN=8]="IN",n[n.INSTANCEOF=8]="INSTANCEOF",n[n.EQUALITY=9]="EQUALITY",n[n.BITWISE_AND=10]="BITWISE_AND",n[n.BITWISE_XOR=11]="BITWISE_XOR",n[n.BITWISE_OR=12]="BITWISE_OR",n[n.LOGICAL_AND=13]="LOGICAL_AND",n[n.LOGICAL_OR=14]="LOGICAL_OR",n[n.CONDITIONAL=15]="CONDITIONAL",n[n.ASSIGNMENT=16]="ASSIGNMENT",n[n.YIELD=17]="YIELD",n[n.COMMA=18]="COMMA",n[n.NONE=99]="NONE";var d=class extends i.CodeGenerator$$module$build$src$core$generator{constructor(e="JavaScript"){super(e),this.ORDER_OVERRIDES=[[t.FUNCTION_CALL,t.MEMBER],[t.FUNCTION_CALL,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.MEMBER,t.FUNCTION_CALL],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.MULTIPLICATION,t.MULTIPLICATION],[t.ADDITION,t.ADDITION],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.isInitialized=!1;for(const n in t)"string"!=typeof(e=t[n])&&(this["ORDER_"+n]=e);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new i.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var n=i.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<n.length;e++)t.push(this.nameDB_.getName(n[e],i.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=i.allUsedVarModels$$module$build$src$core$variables(e),n=0;n<e.length;n++)t.push(this.nameDB_.getName(e[n].getId(),i.NameType$$module$build$src$core$names.VARIABLE));t.length&&(this.definitions_.variables="var "+t.join(", ")+";"),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' +\n")}scrub_(e,t,n=!1){let r="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=i.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),r+=this.prefixLines(o+"\n","// "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===i.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(r+=this.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),r+t+(n?"":this.blockToCode(e))}getAdjusted(e,n,r=0,o=!1,s=t.NONE){e.workspace.options.oneBasedIndex&&r--;const a=e.workspace.options.oneBasedIndex?"1":"0";let l=s;return 0<r?l=t.ADDITION:0>r?l=t.SUBTRACTION:o&&(l=t.UNARY_NEGATION),e=this.valueToCode(e,n,l)||a,0!==r||o?i.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+r),o&&(e=String(-Number(e))),e):(0<r?e=`${e} + ${r}`:0>r&&(e=`${e} - ${-r}`),o&&(e=r?`-(${e})`:`-${e}`),Math.floor(s)>=Math.floor(l)&&(e=`(${e})`),e):e}},h={};h.JavascriptGenerator=d,h.Order=t;var p={colour_blend:function(e,n){const i=n.valueToCode(e,"COLOUR1",t.NONE)||"'#000000'",r=n.valueToCode(e,"COLOUR2",t.NONE)||"'#000000'";return e=n.valueToCode(e,"RATIO",t.NONE)||.5,[n.provideFunction_("colourBlend",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+"("+i+", "+r+", "+e+")",t.FUNCTION_CALL]},colour_picker:function(e,n){return[n.quote_(e.getFieldValue("COLOUR")),t.ATOMIC]},colour_random:function(e,n){return[n.provideFunction_("colourRandom",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * Math.pow(2, 24));\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`)+"()",t.FUNCTION_CALL]},colour_rgb:function(e,n){const i=n.valueToCode(e,"RED",t.NONE)||0,r=n.valueToCode(e,"GREEN",t.NONE)||0;return e=n.valueToCode(e,"BLUE",t.NONE)||0,[n.provideFunction_("colourRgb",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+"("+i+", "+r+", "+e+")",t.FUNCTION_CALL]}},f=function(e,t,n){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+n:"LAST"===t?e+".length - 1":n},g={lists_create_empty:function(e,n){return["[]",t.ATOMIC]},lists_create_with:function(e,n){const i=Array(e.itemCount_);for(let r=0;r<e.itemCount_;r++)i[r]=n.valueToCode(e,"ADD"+r,t.NONE)||"null";return["["+i.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,n){const i=e.getFieldValue("MODE")||"GET",r=e.getFieldValue("WHERE")||"FROM_START";var o=n.valueToCode(e,"VALUE","RANDOM"===r?t.NONE:t.MEMBER)||"[]";switch(r){case"FIRST":if("GET"===i)return[o+"[0]",t.MEMBER];if("GET_REMOVE"===i)return[o+".shift()",t.MEMBER];if("REMOVE"===i)return o+".shift();\n";break;case"LAST":if("GET"===i)return[o+".slice(-1)[0]",t.MEMBER];if("GET_REMOVE"===i)return[o+".pop()",t.MEMBER];if("REMOVE"===i)return o+".pop();\n";break;case"FROM_START":if(e=n.getAdjusted(e,"AT"),"GET"===i)return[o+"["+e+"]",t.MEMBER];if("GET_REMOVE"===i)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===i)return o+".splice("+e+", 1);\n";break;case"FROM_END":if(e=n.getAdjusted(e,"AT",1,!0),"GET"===i)return[o+".slice("+e+")[0]",t.FUNCTION_CALL];if("GET_REMOVE"===i)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===i)return o+".splice("+e+", 1);";break;case"RANDOM":if(o=n.provideFunction_("listsGetRandomItem",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`)+"("+o+", "+("GET"!==i)+")","GET"===i||"GET_REMOVE"===i)return[o,t.FUNCTION_CALL];if("REMOVE"===i)return o+";\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,n){var i={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},r=n.valueToCode(e,"LIST",t.MEMBER)||"[]";const o=e.getFieldValue("WHERE1"),s=e.getFieldValue("WHERE2");if("FIRST"===o&&"LAST"===s)r+=".slice(0)";else if(r.match(/^\w+$/)||"FROM_END"!==o&&"FROM_START"===s){switch(o){case"FROM_START":i=n.getAdjusted(e,"AT1");break;case"FROM_END":i=r+".length - "+(i=n.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":i="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(s){case"FROM_START":n=n.getAdjusted(e,"AT2",1);break;case"FROM_END":n=r+".length - "+(n=n.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":n=r+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}r=r+".slice("+i+", "+n+")"}else{const t=n.getAdjusted(e,"AT1");e=n.getAdjusted(e,"AT2"),r=n.provideFunction_("subsequence"+i[o]+i[s],`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===o||"FROM_START"===o?", at1":""}${"FROM_END"===s||"FROM_START"===s?", at2":""}) {\n  var start = ${f("sequence",o,"at1")};\n  var end = ${f("sequence",s,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+r+("FROM_END"===o||"FROM_START"===o?", "+t:"")+("FROM_END"===s||"FROM_START"===s?", "+e:"")+")"}return[r,t.FUNCTION_CALL]},lists_indexOf:function(e,n){const i="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",r=n.valueToCode(e,"FIND",t.NONE)||"''";return n=(n.valueToCode(e,"VALUE",t.MEMBER)||"[]")+"."+i+"("+r+")",e.workspace.options.oneBasedIndex?[n+" + 1",t.ADDITION]:[n,t.FUNCTION_CALL]},lists_isEmpty:function(e,n){return["!"+(n.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.LOGICAL_NOT]},lists_length:function(e,n){return[(n.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.MEMBER]},lists_repeat:function(e,n){return[n.provideFunction_("listsRepeat",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`)+"("+(n.valueToCode(e,"ITEM",t.NONE)||"null")+", "+(e=n.valueToCode(e,"NUM",t.NONE)||"0")+")",t.FUNCTION_CALL]},lists_reverse:function(e,n){return[(n.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]")+".slice().reverse()",t.FUNCTION_CALL]},lists_setIndex:function(e,n){function r(){if(o.match(/^\w+$/))return"";const e=n.nameDB_.getDistinctName("tmpList",i.NameType$$module$build$src$core$names.VARIABLE),t="var "+e+" = "+o+";\n";return o=e,t}let o=n.valueToCode(e,"LIST",t.MEMBER)||"[]";const s=e.getFieldValue("MODE")||"GET";var a=e.getFieldValue("WHERE")||"FROM_START";const l=n.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(a){case"FIRST":if("SET"===s)return o+"[0] = "+l+";\n";if("INSERT"===s)return o+".unshift("+l+");\n";break;case"LAST":if("SET"===s)return r()+(o+"[")+o+".length - 1] = "+l+";\n";if("INSERT"===s)return o+".push("+l+");\n";break;case"FROM_START":if(e=n.getAdjusted(e,"AT"),"SET"===s)return o+"["+e+"] = "+l+";\n";if("INSERT"===s)return o+".splice("+e+", 0, "+l+");\n";break;case"FROM_END":if(e=n.getAdjusted(e,"AT",1,!1,t.SUBTRACTION),a=r(),"SET"===s)return a+(o+"[")+o+".length - "+e+"] = "+l+";\n";if("INSERT"===s)return a+(o+".splice(")+o+".length - "+e+", 0, "+l+");\n";break;case"RANDOM":if(e=r(),e+="var "+(a=n.nameDB_.getDistinctName("tmpX",i.NameType$$module$build$src$core$names.VARIABLE))+" = Math.floor(Math.random() * "+o+".length);\n","SET"===s)return e+(o+"[")+a+"] = "+l+";\n";if("INSERT"===s)return e+(o+".splice(")+a+", 0, "+l+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,n){const i=n.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]",r="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[i+".slice().sort("+(n=n.provideFunction_("listsGetSortCompare",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return String(a) > String(b) ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `))+'("'+e+'", '+r+"))",t.FUNCTION_CALL]},lists_split:function(e,n){let i=n.valueToCode(e,"INPUT",t.MEMBER);if(n=n.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))i||(i="''"),e="split";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);i||(i="[]"),e="join"}return[i+"."+e+"("+n+")",t.FUNCTION_CALL]}},m={};m.controls_if=r,m.controls_ifelse=r,m.logic_boolean=function(e,n){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},m.logic_compare=function(e,n){const i={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],r="=="===i||"!="===i?t.EQUALITY:t.RELATIONAL;return[(n.valueToCode(e,"A",r)||"0")+" "+i+" "+(e=n.valueToCode(e,"B",r)||"0"),r]},m.logic_negate=function(e,n){const i=t.LOGICAL_NOT;return["!"+(n.valueToCode(e,"BOOL",i)||"true"),i]},m.logic_null=function(e,n){return["null",t.ATOMIC]},m.logic_operation=function(e,n){const i="AND"===e.getFieldValue("OP")?"&&":"||",r="&&"===i?t.LOGICAL_AND:t.LOGICAL_OR;let o=n.valueToCode(e,"A",r);return e=n.valueToCode(e,"B",r),o||e?(n="&&"===i?"true":"false",o||(o=n),e||(e=n)):e=o="false",[o+" "+i+" "+e,r]},m.logic_ternary=function(e,n){return[(n.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(n.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=n.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var b={controls_flow_statements:function(e,t){let n="";if(t.STATEMENT_PREFIX&&(n+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(n+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const i=e.getSurroundLoop();i&&!i.suppressPrefixSuffix&&(n+=t.injectId(t.STATEMENT_PREFIX,i))}switch(e.getFieldValue("FLOW")){case"BREAK":return n+"break;\n";case"CONTINUE":return n+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,n){var r=n.getVariableName(e.getFieldValue("VAR")),o=n.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",s=n.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const a=n.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let l=n.statementToCode(e,"DO");if(l=n.addLoopTrap(l,e),i.isNumber$$module$build$src$core$utils$string(o)&&i.isNumber$$module$build$src$core$utils$string(s)&&i.isNumber$$module$build$src$core$utils$string(a))e="for ("+r+" = "+o+"; "+r+((n=Number(o)<=Number(s))?" <= ":" >= ")+s+"; "+r,e=1===(r=Math.abs(Number(a)))?e+(n?"++":"--"):e+(n?" += ":" -= ")+r,e+=") {\n"+l+"}\n";else{e="";let t=o;o.match(/^\w+$/)||i.isNumber$$module$build$src$core$utils$string(o)||(e+="var "+(t=n.nameDB_.getDistinctName(r+"_start",i.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),o=s,s.match(/^\w+$/)||i.isNumber$$module$build$src$core$utils$string(s)||(e+="var "+(o=n.nameDB_.getDistinctName(r+"_end",i.NameType$$module$build$src$core$names.VARIABLE))+" = "+s+";\n"),e+="var "+(s=n.nameDB_.getDistinctName(r+"_inc",i.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=i.isNumber$$module$build$src$core$utils$string(a)?e+(Math.abs(Number(a))+";\n"):e+"Math.abs("+a+");\n",e+="if ("+t+" > "+o+") {\n",e=(e+=n.INDENT+s+" = -"+s+";\n")+"}\nfor ("+r+" = "+t+"; "+s+" >= 0 ? "+r+" <= "+o+" : "+r+" >= "+o+"; "+r+" += "+s+") {\n"+l+"}\n"}return e},controls_forEach:function(e,n){const r=n.getVariableName(e.getFieldValue("VAR"));var o=n.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let s=n.statementToCode(e,"DO");s=n.addLoopTrap(s,e),e="";let a=o;return o.match(/^\w+$/)||(e+="var "+(a=n.nameDB_.getDistinctName(r+"_list",i.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),e+"for (var "+(o=n.nameDB_.getDistinctName(r+"_index",i.NameType$$module$build$src$core$names.VARIABLE))+" in "+a+") {\n"+(s=n.INDENT+r+" = "+a+"["+o+"];\n"+s)+"}\n"}};b.controls_repeat=o,b.controls_repeat_ext=o,b.controls_whileUntil=function(e,n){const i="UNTIL"===e.getFieldValue("MODE");let r=n.valueToCode(e,"BOOL",i?t.LOGICAL_NOT:t.NONE)||"false",o=n.statementToCode(e,"DO");return i&&(r="!"+r),"while ("+r+") {\n"+(o=n.addLoopTrap(o,e))+"}\n"};var y={math_arithmetic:function(e,n){var i={ADD:[" + ",t.ADDITION],MINUS:[" - ",t.SUBTRACTION],MULTIPLY:[" * ",t.MULTIPLICATION],DIVIDE:[" / ",t.DIVISION],POWER:[null,t.NONE]}[e.getFieldValue("OP")];const r=i[0];i=i[1];const o=n.valueToCode(e,"A",i)||"0";return e=n.valueToCode(e,"B",i)||"0",r?[o+r+e,i]:["Math.pow("+o+", "+e+")",t.FUNCTION_CALL]},math_atan2:function(e,n){const i=n.valueToCode(e,"X",t.NONE)||"0";return["Math.atan2("+(n.valueToCode(e,"Y",t.NONE)||"0")+", "+i+") / Math.PI * 180",t.DIVISION]},math_change:function(e,n){const i=n.valueToCode(e,"DELTA",t.ADDITION)||"0";return(e=n.getVariableName(e.getFieldValue("VAR")))+" = (typeof "+e+" === 'number' ? "+e+" : 0) + "+i+";\n"},math_constant:function(e,n){return{PI:["Math.PI",t.MEMBER],E:["Math.E",t.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.DIVISION],SQRT2:["Math.SQRT2",t.MEMBER],SQRT1_2:["Math.SQRT1_2",t.MEMBER],INFINITY:["Infinity",t.ATOMIC]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,n){return["Math.min(Math.max("+(n.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(n.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=n.valueToCode(e,"HIGH",t.NONE)||"Infinity")+")",t.FUNCTION_CALL]},math_modulo:function(e,n){return[(n.valueToCode(e,"DIVIDEND",t.MODULUS)||"0")+" % "+(e=n.valueToCode(e,"DIVISOR",t.MODULUS)||"0"),t.MODULUS]},math_number:function(e,n){return e=Number(e.getFieldValue("NUM")),[String(e),0<=e?t.ATOMIC:t.UNARY_NEGATION]},math_number_property:function(e,n){var i={EVEN:[" % 2 === 0",t.MODULUS,t.EQUALITY],ODD:[" % 2 === 1",t.MODULUS,t.EQUALITY],WHOLE:[" % 1 === 0",t.MODULUS,t.EQUALITY],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MODULUS,t.EQUALITY],PRIME:[null,t.NONE,t.FUNCTION_CALL]};const r=e.getFieldValue("PROPERTY"),[o,s,a]=i[r];return i=n.valueToCode(e,"NUMBER_TO_CHECK",s)||"0",[e="PRIME"===r?n.provideFunction_("mathIsPrime",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+i+")":"DIVISIBLE_BY"===r?i+" % "+(e=n.valueToCode(e,"DIVISOR",t.MODULUS)||"0")+" === 0":i+o,a]},math_on_list:function(e,n){var i=e.getFieldValue("OP");switch(i){case"SUM":e=n.valueToCode(e,"LIST",t.MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":e="Math.min.apply(null, "+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MAX":e="Math.max.apply(null, "+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"AVERAGE":e=(i=n.provideFunction_("mathMean",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`))+"("+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MEDIAN":e=(i=n.provideFunction_("mathMedian",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`))+"("+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MODE":e=(i=n.provideFunction_("mathModes",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n        modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`))+"("+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"STD_DEV":e=(i=n.provideFunction_("mathStandardDeviation",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance = variance / n;\n  return Math.sqrt(variance);\n}\n`))+"("+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"RANDOM":e=(i=n.provideFunction_("mathRandomList",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`))+"("+(e=n.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+i)}return[e,t.FUNCTION_CALL]},math_random_float:function(e,n){return["Math.random()",t.FUNCTION_CALL]},math_random_int:function(e,n){const i=n.valueToCode(e,"FROM",t.NONE)||"0";return e=n.valueToCode(e,"TO",t.NONE)||"0",[n.provideFunction_("mathRandomInt",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`)+"("+i+", "+e+")",t.FUNCTION_CALL]}};y.math_round=s,y.math_single=s,y.math_trig=s;var v={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,n){const i=n.getProcedureName(e.getFieldValue("NAME")),r=[],o=e.getVars();for(let i=0;i<o.length;i++)r[i]=n.valueToCode(e,"ARG"+i,t.NONE)||"null";return[i+"("+r.join(", ")+")",t.FUNCTION_CALL]}};v.procedures_defnoreturn=a,v.procedures_defreturn=a,v.procedures_ifreturn=function(e,n){let i="if ("+(n.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return n.STATEMENT_SUFFIX&&(i+=n.prefixLines(n.injectId(n.STATEMENT_SUFFIX,e),n.INDENT)),e.hasReturnValue_?(e=n.valueToCode(e,"VALUE",t.NONE)||"null",i+=n.INDENT+"return "+e+";\n"):i+=n.INDENT+"return;\n",i+"}\n"};var _=/^\s*'([^']|\\')*'\s*$/,E=function(e){return _.test(e)?[e,t.ATOMIC]:["String("+e+")",t.FUNCTION_CALL]},T=function(e,t,n){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+n:"LAST"===t?e+".length - 1":n},x={text:function(e,n){return[n.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,n){const i=n.getVariableName(e.getFieldValue("VAR"));return e=n.valueToCode(e,"TEXT",t.NONE)||"''",i+" += "+E(e)[0]+";\n"},text_changeCase:function(e,n){const i={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=n.valueToCode(e,"TEXT",i?t.MEMBER:t.NONE)||"''",[i?e+i:n.provideFunction_("textToTitleCase",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`)+"("+e+")",t.FUNCTION_CALL]},text_charAt:function(e,n){const i=e.getFieldValue("WHERE")||"FROM_START",r=n.valueToCode(e,"VALUE","RANDOM"===i?t.NONE:t.MEMBER)||"''";switch(i){case"FIRST":return[r+".charAt(0)",t.FUNCTION_CALL];case"LAST":return[r+".slice(-1)",t.FUNCTION_CALL];case"FROM_START":return[r+".charAt("+(e=n.getAdjusted(e,"AT"))+")",t.FUNCTION_CALL];case"FROM_END":return[r+".slice("+(e=n.getAdjusted(e,"AT",1,!0))+").charAt(0)",t.FUNCTION_CALL];case"RANDOM":return[n.provideFunction_("textRandomLetter",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`)+"("+r+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,n){const i=n.valueToCode(e,"TEXT",t.NONE)||"''";return e=n.valueToCode(e,"SUB",t.NONE)||"''",[n.provideFunction_("textCount",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`)+"("+i+", "+e+")",t.FUNCTION_CALL]},text_getSubstring:function(e,n){var i={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const r=e.getFieldValue("WHERE1"),o=e.getFieldValue("WHERE2");var s="FROM_END"!==r&&"LAST"!==r&&"FROM_END"!==o&&"LAST"!==o,a=n.valueToCode(e,"STRING",s?t.MEMBER:t.NONE)||"''";if("FIRST"===r&&"LAST"===o)return[a,t.NONE];if(a.match(/^'?\w+'?$/)||s){switch(r){case"FROM_START":i=n.getAdjusted(e,"AT1");break;case"FROM_END":i=a+".length - "+(i=n.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":i="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(o){case"FROM_START":n=n.getAdjusted(e,"AT2",1);break;case"FROM_END":n=a+".length - "+(n=n.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":n=a+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}a=a+".slice("+i+", "+n+")"}else s=n.getAdjusted(e,"AT1"),e=n.getAdjusted(e,"AT2"),a=n.provideFunction_("subsequence"+i[r]+i[o],`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===r||"FROM_START"===r?", at1":""}${"FROM_END"===o||"FROM_START"===o?", at2":""}) {\n  var start = ${T("sequence",r,"at1")};\n  var end = ${T("sequence",o,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+a+("FROM_END"===r||"FROM_START"===r?", "+s:"")+("FROM_END"===o||"FROM_START"===o?", "+e:"")+")";return[a,t.FUNCTION_CALL]},text_indexOf:function(e,n){const i="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",r=n.valueToCode(e,"FIND",t.NONE)||"''";return n=(n.valueToCode(e,"VALUE",t.MEMBER)||"''")+"."+i+"("+r+")",e.workspace.options.oneBasedIndex?[n+" + 1",t.ADDITION]:[n,t.FUNCTION_CALL]},text_isEmpty:function(e,n){return["!"+(n.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.LOGICAL_NOT]},text_join:function(e,n){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return e=n.valueToCode(e,"ADD0",t.NONE)||"''",E(e);case 2:var i=n.valueToCode(e,"ADD0",t.NONE)||"''";return e=n.valueToCode(e,"ADD1",t.NONE)||"''",[E(i)[0]+" + "+E(e)[0],t.ADDITION];default:i=Array(e.itemCount_);for(let r=0;r<e.itemCount_;r++)i[r]=n.valueToCode(e,"ADD"+r,t.NONE)||"''";return["["+i.join(",")+"].join('')",t.FUNCTION_CALL]}},text_length:function(e,n){return[(n.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.MEMBER]},text_multiline:function(e,n){return e=n.multiline_quote_(e.getFieldValue("TEXT")),n=-1!==e.indexOf("+")?t.ADDITION:t.ATOMIC,[e,n]},text_print:function(e,n){return"window.alert("+(n.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};x.text_prompt=l,x.text_prompt_ext=l,x.text_replace=function(e,n){const i=n.valueToCode(e,"TEXT",t.NONE)||"''",r=n.valueToCode(e,"FROM",t.NONE)||"''";return e=n.valueToCode(e,"TO",t.NONE)||"''",[n.provideFunction_("textReplace",`\nfunction ${n.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n                 .replace(/\\x08/g, '\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`)+"("+i+", "+r+", "+e+")",t.FUNCTION_CALL]},x.text_reverse=function(e,n){return[(n.valueToCode(e,"TEXT",t.MEMBER)||"''")+".split('').reverse().join('')",t.FUNCTION_CALL]},x.text_trim=function(e,n){const i={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(n.valueToCode(e,"TEXT",t.MEMBER)||"''")+i,t.FUNCTION_CALL]};var w={};w.variables_get=c,w.variables_set=u;var k={};k.variables_get_dynamic=c,k.variables_set_dynamic=u;var S=new d,C=Object.assign({},p,g,m,b,y,v,x,w,k);for(const e in C)S.forBlock[e]=C[e];var A={};return A.JavascriptGenerator=d,A.Order=t,A.javascriptGenerator=S,A.__namespace__=i,A},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],r):"object"==typeof n?t.exports=r(e("./blockly_compressed.js")):(i.javascript=r(i.Blockly),i.Blockly.JavaScript=i.javascript.javascriptGenerator)},{"./blockly_compressed.js":371}],379:[function(e,t,n){!function(e,i){if("function"==typeof define&&define.amd)define([],i);else if("object"==typeof n)t.exports=i();else{var r=i();for(var o in r)e.Blockly.Msg[o]=r[o]}}(this,(function(){"use strict";var e=e||{Msg:Object.create(null)};return e.Msg.ADD_COMMENT="Add Comment",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",e.Msg.CHANGE_VALUE_TITLE="Change value:",e.Msg.CLEAN_UP="Clean up Blocks",e.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",e.Msg.COLLAPSE_ALL="Collapse Blocks",e.Msg.COLLAPSE_BLOCK="Collapse Block",e.Msg.COLOUR_BLEND_COLOUR1="colour 1",e.Msg.COLOUR_BLEND_COLOUR2="colour 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="ratio",e.Msg.COLOUR_BLEND_TITLE="blend",e.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",e.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="random colour",e.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",e.Msg.COLOUR_RGB_BLUE="blue",e.Msg.COLOUR_RGB_GREEN="green",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="red",e.Msg.COLOUR_RGB_TITLE="colour with",e.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",e.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",e.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",e.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",e.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",e.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",e.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",e.Msg.CONTROLS_IF_MSG_ELSE="else",e.Msg.CONTROLS_IF_MSG_ELSEIF="else if",e.Msg.CONTROLS_IF_MSG_IF="if",e.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",e.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",e.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",e.Msg.CONTROLS_REPEAT_INPUT_DO="do",e.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",e.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",e.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",e.Msg.DELETE_BLOCK="Delete Block",e.Msg.DELETE_VARIABLE="Delete the '%1' variable",e.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",e.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",e.Msg.DIALOG_CANCEL="Cancel",e.Msg.DIALOG_OK="OK",e.Msg.DISABLE_BLOCK="Disable Block",e.Msg.DUPLICATE_BLOCK="Duplicate",e.Msg.DUPLICATE_COMMENT="Duplicate Comment",e.Msg.ENABLE_BLOCK="Enable Block",e.Msg.EXPAND_ALL="Expand Blocks",e.Msg.EXPAND_BLOCK="Expand Block",e.Msg.EXTERNAL_INPUTS="External Inputs",e.Msg.HELP="Help",e.Msg.INLINE_INPUTS="Inline Inputs",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",e.Msg.LISTS_GET_INDEX_FIRST="first",e.Msg.LISTS_GET_INDEX_FROM_END="# from end",e.Msg.LISTS_GET_INDEX_FROM_START="#",e.Msg.LISTS_GET_INDEX_GET="get",e.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",e.Msg.LISTS_GET_INDEX_LAST="last",e.Msg.LISTS_GET_INDEX_RANDOM="random",e.Msg.LISTS_GET_INDEX_REMOVE="remove",e.Msg.LISTS_GET_INDEX_TAIL="",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",e.Msg.LISTS_GET_SUBLIST_END_LAST="to last",e.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",e.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",e.Msg.LISTS_GET_SUBLIST_TAIL="",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",e.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",e.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",e.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",e.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",e.Msg.LISTS_INLIST="in list",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",e.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="length of %1",e.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",e.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",e.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",e.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",e.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",e.Msg.LISTS_SET_INDEX_INPUT_TO="as",e.Msg.LISTS_SET_INDEX_INSERT="insert at",e.Msg.LISTS_SET_INDEX_SET="set",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",e.Msg.LISTS_SORT_ORDER_DESCENDING="descending",e.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",e.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",e.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",e.Msg.LOGIC_BOOLEAN_FALSE="false",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",e.Msg.LOGIC_BOOLEAN_TRUE="true",e.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="not %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",e.Msg.LOGIC_NULL_TOOLTIP="Returns null.",e.Msg.LOGIC_OPERATION_AND="and",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="or",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",e.Msg.LOGIC_TERNARY_CONDITION="test",e.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",e.Msg.LOGIC_TERNARY_IF_FALSE="if false",e.Msg.LOGIC_TERNARY_IF_TRUE="if true",e.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",e.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",e.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",e.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",e.Msg.MATH_CHANGE_TITLE="change %1 by %2",e.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",e.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",e.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707), or  (infinity).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",e.Msg.MATH_DIVISION_SYMBOL="",e.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",e.Msg.MATH_IS_EVEN="is even",e.Msg.MATH_IS_NEGATIVE="is negative",e.Msg.MATH_IS_ODD="is odd",e.Msg.MATH_IS_POSITIVE="is positive",e.Msg.MATH_IS_PRIME="is prime",e.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",e.Msg.MATH_IS_WHOLE="is whole",e.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",e.Msg.MATH_MODULO_TITLE="remainder of %1  %2",e.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",e.Msg.MATH_MULTIPLICATION_SYMBOL="",e.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",e.Msg.MATH_NUMBER_TOOLTIP="A number.",e.Msg.MATH_ONLIST_HELPURL="",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",e.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",e.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",e.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",e.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",e.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",e.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",e.Msg.MATH_ROUND_OPERATOR_ROUND="round",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",e.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",e.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",e.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",e.Msg.MATH_SINGLE_OP_ROOT="square root",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",e.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",e.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",e.Msg.NEW_NUMBER_VARIABLE="Create number variable...",e.Msg.NEW_STRING_VARIABLE="Create string variable...",e.Msg.NEW_VARIABLE="Create variable...",e.Msg.NEW_VARIABLE_TITLE="New variable name:",e.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",e.Msg.ORDINAL_NUMBER_SUFFIX="",e.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",e.Msg.PROCEDURES_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CREATE_DO="Create '%1'",e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",e.Msg.PROCEDURES_DEFNORETURN_TITLE="to",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFRETURN_RETURN="return",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",e.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",e.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",e.Msg.REDO="Redo",e.Msg.REMOVE_COMMENT="Remove Comment",e.Msg.RENAME_VARIABLE="Rename variable...",e.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="to %1 append text %2",e.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",e.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",e.Msg.TEXT_CHARAT_FIRST="get first letter",e.Msg.TEXT_CHARAT_FROM_END="get letter # from end",e.Msg.TEXT_CHARAT_FROM_START="get letter #",e.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",e.Msg.TEXT_CHARAT_LAST="get last letter",e.Msg.TEXT_CHARAT_RANDOM="get random letter",e.Msg.TEXT_CHARAT_TAIL="",e.Msg.TEXT_CHARAT_TITLE="in text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",e.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",e.Msg.TEXT_GET_SUBSTRING_TAIL="",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",e.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",e.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",e.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",e.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",e.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="length of %1",e.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="print %1",e.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",e.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",e.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",e.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",e.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",e.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",e.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",e.Msg.TODAY="Today",e.Msg.UNDO="Undo",e.Msg.UNNAMED_KEY="unnamed",e.Msg.VARIABLES_DEFAULT_NAME="item",e.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",e.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",e.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",e.Msg.VARIABLES_SET="set %1 to %2",e.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",e.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",e.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",e.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_HELPURL=e.Msg.LISTS_INDEX_OF_HELPURL,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.MATH_HUE="230",e.Msg.LOOPS_HUE="120",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.VARIABLES_HUE="330",e.Msg.TEXTS_HUE="160",e.Msg.PROCEDURES_HUE="290",e.Msg.COLOUR_HUE="20",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg}))},{}],380:[function(e,t,n){},{}],381:[function(e,t,n){(function(t){(function(){"use strict";var t=e("base64-js"),i=e("ieee754"),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),i=s(n),r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if($(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if($(e,ArrayBuffer)||e&&$(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&($(e,SharedArrayBuffer)||e&&$(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return a.from(i,t,n);var r=function(e){if(a.isBuffer(e)){var t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||U(e.length)?s(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),s(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),n=s(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,a.prototype),i}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||$(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(r)return i?-1:B(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function m(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),U(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var o,s=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var u=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var d=!0,h=0;h<l;h++)if(c(e,o+h)!==c(t,h)){d=!1;break}if(d)return o}return-1}function v(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(t.substr(2*s,2),16);if(U(a))return s;e[n+s]=a}return s}function _(e,t,n,i){return F(B(t,e.length-n),e,n,i)}function E(e,t,n,i){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function T(e,t,n,i){return F(j(t),e,n,i)}function x(e,t,n,i){return F(function(e,t){for(var n,i,r,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function w(e,n,i){return 0===n&&i===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,i))}function k(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,s,a,l,c=e[r],u=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=d}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=S));return n}(i)}n.kMaxLength=o,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if($(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),$(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if($(o,Uint8Array))r+o.length>i.length?a.from(o).copy(i,r):Uint8Array.prototype.set.call(i,o,r);else{if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r)}r+=o.length}return i},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(e,t,n,i,r){if($(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0),l=Math.min(o,s),c=this.slice(i,r),u=e.slice(t,n),d=0;d<l;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function I(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=H[e[o]];return r}function O(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length-1;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function D(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,r,o){return t=+t,n>>>=0,o||D(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function M(e,t,n,r,o){return t=+t,n>>>=0,o||D(e,0,n,8),i.write(e,t,n,r,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,a.prototype),i},a.prototype.readUintLE=a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},a.prototype.readUintBE=a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUint8=a.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return M(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return M(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var r=e.charCodeAt(0);("utf8"===i&&r<128||"latin1"===i)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:a.from(e,i),l=s.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%l]}return this};var P=/[^+/0-9A-Za-z-_]/g;function B(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],s=0;s<i;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function $(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function U(e){return e!=e}var H=function(){for(var e=new Array(256),t=0;t<16;++t)for(var n=16*t,i=0;i<16;++i)e[n+i]="0123456789abcdef"[t]+"0123456789abcdef"[i];return e}()}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":369,buffer:381,ieee754:421}],382:[function(e,t,n){"use strict";var i=e("get-intrinsic"),r=e("./"),o=r(i("String.prototype.indexOf"));t.exports=function(e,t){var n=i(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?r(n):n}},{"./":383,"get-intrinsic":413}],383:[function(e,t,n){"use strict";var i=e("function-bind"),r=e("get-intrinsic"),o=e("set-function-length"),s=e("es-errors/type"),a=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),c=r("%Reflect.apply%",!0)||i.call(l,a),u=e("es-define-property"),d=r("%Math.max%");t.exports=function(e){if("function"!=typeof e)throw new s("a function is required");var t=c(i,l,arguments);return o(t,1+d(0,e.length-(arguments.length-1)),!0)};var h=function(){return c(i,a,arguments)};u?u(t.exports,"apply",{value:h}):t.exports.apply=h},{"es-define-property":400,"es-errors/type":406,"function-bind":411,"get-intrinsic":413,"set-function-length":606}],384:[function(e,t,n){!function(){"use strict";var e={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=r(e,i(n)))}return e}function i(t){if("string"==typeof t||"number"==typeof t)return t;if("object"!=typeof t)return"";if(Array.isArray(t))return n.apply(null,t);if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]"))return t.toString();var i="";for(var o in t)e.call(t,o)&&t[o]&&(i=r(i,o));return i}function r(e,t){return t?e?e+" "+t:e+t:e}void 0!==t&&t.exports?(n.default=n,t.exports=n):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return n})):window.classNames=n}()},{}],385:[function(e,t,n){function i(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===i(e)},n.isObject=function(e){return"object"==typeof e&&null!==e},n.isDate=function(e){return"[object Date]"===i(e)},n.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("buffer").Buffer.isBuffer},{buffer:381}],386:[function(e,t,n){var i,r;i=this,r=function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},o=r.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var o=0;o<r;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[i+o>>>2]|=s<<24-(i+o)%4*8}else for(o=0;o<r;o+=4)t[i+o>>>2]=n[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=function(t){t=t;var n=987654321,i=4294967295;return function(){var r=((n=36969*(65535&n)+(n>>16)&i)<<16)+(t=18e3*(65535&t)+(t>>16)&i)&i;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=r(4294967296*(n||e.random()));n=987654071*a(),i.push(4294967296*a()|0)}return new s.init(i,t)}}),a=i.enc={},l=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var o=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new s.init(n,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,c=e.min(4*l,r);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(i,u);var d=i.splice(0,l);n.sigBytes-=c}return new s.init(d,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(r.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math);return e},"object"==typeof n?t.exports=n=r():"function"==typeof define&&define.amd?define([],r):i.CryptoJS=r()},{}],387:[function(e,t,n){var i,r;i=this,r=function(e){var t,n,i,r,o,s,a;return n=(t=e).lib,i=n.WordArray,r=n.Hasher,o=t.algo,s=[],a=o.SHA1=r.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],o=n[2],a=n[3],l=n[4],c=0;c<80;c++){if(c<16)s[c]=0|e[t+c];else{var u=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=u<<1|u>>>31}var d=(i<<5|i>>>27)+l+s[c];d+=c<20?1518500249+(r&o|~r&a):c<40?1859775393+(r^o^a):c<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,l=a,a=o,o=r<<30|r>>>2,r=i,i=d}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(i+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=r._createHelper(a),t.HmacSHA1=r._createHmacHelper(a),e.SHA1},"object"==typeof n?t.exports=n=r(e("./core")):"function"==typeof define&&define.amd?define(["./core"],r):r(i.CryptoJS)},{"./core":386}],388:[function(e,t,n){(function(e,i){(function(){var r,o;r=self,o=function(){return function(){var t={4593:function(e,t){var n,i,r,o,l,c={};n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t=0,i=[],r=0|e.length/3;0<r--;){var o=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,i.push(n.charAt(63&o>>18)),i.push(n.charAt(63&o>>12)),i.push(n.charAt(63&o>>6)),i.push(n.charAt(63&o))}return 2==e.length-t?(o=(e[t]<<16)+(e[t+1]<<8),i.push(n.charAt(63&o>>18)),i.push(n.charAt(63&o>>12)),i.push(n.charAt(63&o>>6)),i.push("=")):1==e.length-t&&(o=e[t]<<16,i.push(n.charAt(63&o>>18)),i.push(n.charAt(63&o>>12)),i.push("==")),i.join("")},r=function(){for(var e=[],t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),o=function(e){for(var t=0,n=[],i=0|e.length/4;0<i--;){var o=(r[e.charCodeAt(t)]<<18)+(r[e.charCodeAt(t+1)]<<12)+(r[e.charCodeAt(t+2)]<<6)+r[e.charCodeAt(t+3)];n.push(255&o>>16),n.push(255&o>>8),n.push(255&o),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},c.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},c.encodeASCII=function(e){var t=l.encode(e);return i(t)},c.decodeASCII=function(e){var t=o(e);return l.decode(t)},c.encode=function(e){var t=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?(t.push(192|i>>6),t.push(128|63&i)):i<65536?(t.push(224|i>>12),t.push(128|63&i>>6),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|63&i>>12),t.push(128|63&i>>6),t.push(128|63&i))}return t}(e);return i(t)},c.decode=function(e){return function(e){for(var t=[],n=0;n<e.length;){var i=e[n++];i<128||(i<224?(i=(31&i)<<6,i|=63&e[n++]):i<240?(i=(15&i)<<12,i|=(63&e[n++])<<6,i|=63&e[n++]):(i=(7&i)<<18,i|=(63&e[n++])<<12,i|=(63&e[n++])<<6,i|=63&e[n++])),t.push(String.fromCharCode(i))}return t.join("")}(o(e))},t.decode=c.decode,t.decodeArray=c.decodeArray,t.encode=c.encode,t.encodeASCII=c.encodeASCII},452:function(e,t){!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},i=15,r=32,o={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},a={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],u={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},d=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},h=function(e,t,n,i,r){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=i||"black",this.flash=r||!1};h.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var p=function(e,t,n,i,r,o){this.uchar=e||" ",this.penState=new h(t,n,i,r,o)};p.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var f=function(){this.chars=[];for(var e=0;e<r;e++)this.chars.push(new p);this.pos=0,this.currPenState=new h};f.prototype={equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(u.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>r&&(u.log("ERROR","Too large cursor position "+this.pos),this.pos=r)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=r?u.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<r;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<r;n++){var i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var g=function(){this.rows=[];for(var e=0;e<i;e++)this.rows.push(new f);this.currRow=14,this.nrRollUpRows=null,this.reset()};g.prototype={reset:function(){for(var e=0;e<i;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<i;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){u.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){u.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var i=e.indent,r=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[r].penState.foreground}var o={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(o)},setBkgData:function(e){u.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){u.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),u.log("INFO","Rolling up")}else u.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",r=-1,o=0;o<i;o++){var s=this.rows[o].getTextString();s&&(r=o+1,e?t.push("Row "+r+': "'+s+'"'):t.push(s.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new g,this.nonDisplayedMemory=new g,this.lastOutputScreen=new g,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,u.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";u.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(u.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){u.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){u.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){u.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){u.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){u.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){u.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){u.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){u.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){u.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){u.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){u.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(u.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,u.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){u.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}u.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=u.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var b=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};b.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,i,r,o=!1;this.lastTime=e,u.setTime(e);for(var s=0;s<t.length;s+=2)i=127&t[s],r=127&t[s+1],i>=16&&i<=31&&i===this.lastCmdA&&r===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,u.log("DEBUG","Repeated command ("+d([i,r])+") is dropped")):0!==i||0!==r?(u.log("DATA","["+d([t[s],t[s+1]])+"] -> ("+d([i,r])+")"),(n=this.parseCmd(i,r))||(n=this.parseMidrow(i,r)),n||(n=this.parsePAC(i,r)),n||(n=this.parseBackgroundAttributes(i,r)),n||(o=this.parseChars(i,r))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(o):u.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:o?this.dataCounters.char+=2:(this.dataCounters.other+=2,u.log("WARNING","Couldn't parse cleaned data "+d([i,r])+" orig: "+d([t[s],t[s+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var n;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var i=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?i.cc_RCL():33===t?i.cc_BS():34===t?i.cc_AOF():35===t?i.cc_AON():36===t?i.cc_DER():37===t?i.cc_RU(2):38===t?i.cc_RU(3):39===t?i.cc_RU(4):40===t?i.cc_FON():41===t?i.cc_RDC():42===t?i.cc_TR():43===t?i.cc_RTD():44===t?i.cc_EDM():45===t?i.cc_CR():46===t?i.cc_ENM():47===t&&i.cc_EOC():i.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return u.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[n-1];return i.insertChars([32]),i.cc_MIDROW(t),u.log("DEBUG","MIDROW ("+d([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,i;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,i=64<=t&&t<=95?1===n?o[e]:a[e]:1===n?s[e]:l[e];var r=this.interpretPAC(i,t);return this.channels[n-1].setPAC(r),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n,i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=1==(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i},parseChars:function(e,t){var i,r=null,o=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),17<=s&&s<=19?(i=17===s?t+80:18===s?t+112:t+144,u.log("INFO","Special char '"+n(i)+"' in channel "+r),o=[i],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(o=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null),o){var a=d(o);u.log("DEBUG","Char codes =  "+a.join(","))}return o},parseBackgroundAttributes:function(e,t){var n,i,r;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(i=Math.floor((t-32)/2),n.background=c[i],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),r=e<24?1:2,this.channels[r-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=u,e.PenState=h,e.CaptionScreen=g,e.Cea608Parser=b,e.findCea608Nalus=function(e,t,n){for(var i=0,r=t,o=[],s=function(e,t,n,i){if(4!==e||t<8)return null;var r=n.getUint8(i),o=n.getUint16(i+1),s=n.getUint32(i+3),a=n.getUint8(i+7);return 181==r&&49==o&&1195456820==s&&3==a};r<t+n;){if(i=e.getUint32(r),6==(31&e.getUint8(r+4)))for(var a=r+5,l=-1;a<r+4+i-1;){l=0;for(var c=255;255===c;)l+=c=e.getUint8(a),a++;var u=0;for(c=255;255===c;)u+=c=e.getUint8(a),a++;s(l,u,e,a)&&o.push([a,u]),a+=u}r+=i+4}return o},e.extractCea608DataFromRange=function(e,t){var n=t[0],i=[[],[]];n+=8;var r=31&e.getUint8(n);n+=2;for(var o=0;o<r;o++){var s=e.getUint8(n),a=4&s,l=3&s;n++;var c=e.getUint8(n);n++;var u=e.getUint8(n);n++,a&&(127&c)+(127&u)!=0&&(0===l?(i[0].push(c),i[0].push(u)):1===l&&(i[1].push(c),i[1].push(u)))}return i}}(t)},8416:function(e,t,n){"use strict";var i=n(1139),r=n(5448),o=n(6398),s=n(2032),a=(n(5530),"undefined"!=typeof window&&window||n.g),l=a.dashjs;l||(l=a.dashjs={}),l.MediaPlayer=i.Z,l.FactoryMaker=r.Z,l.Debug=o.Z,l.Version=(0,s.e)()},6398:function(e,t,n){"use strict";var i=n(5595),r=n(8512),o=n(5448),s=1,a=2,l=3,c=4,u=5;function d(e){e=e||{};var t,n,o,d,h=this.context,p=(0,i.Z)(h).getInstance(),f=e.settings,g=[];function m(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function b(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[s,this].concat(t))}function y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[a,this].concat(t))}function v(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[l,this].concat(t))}function _(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[c,this].concat(t))}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];T.apply(void 0,[u,this].concat(t))}function T(e,t){var i="",s=null;n&&(s=(new Date).getTime(),i+="["+(s-d)+"]"),o&&t&&t.getClassName&&(i+="["+t.getClassName()+"]",t.getType&&(i+="["+t.getType()+"]")),i.length>0&&(i+=" ");for(var a=arguments.length,l=new Array(a>2?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];Array.apply(null,l).forEach((function(e){i+=e+" "})),g[e]&&f&&f.get().debug.logLevel>=e&&g[e](i),f&&f.get().debug.dispatchEvent&&p.trigger(r.Z.LOG,{message:i,level:e})}return t={getLogger:function(e){return{fatal:b.bind(e),error:y.bind(e),warn:v.bind(e),info:_.bind(e),debug:E.bind(e)}},setLogTimestampVisible:function(e){n=e},setCalleeNameVisible:function(e){o=e}},n=!0,o=!0,d=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(g[s]=m(window.console.error),g[a]=m(window.console.error),g[l]=m(window.console.warn),g[c]=m(window.console.info),g[u]=m(window.console.debug)),t}d.__dashjs_factory_name="Debug";var h=o.Z.getSingletonFactory(d);h.LOG_LEVEL_NONE=0,h.LOG_LEVEL_FATAL=s,h.LOG_LEVEL_ERROR=a,h.LOG_LEVEL_WARNING=l,h.LOG_LEVEL_INFO=c,h.LOG_LEVEL_DEBUG=u,o.Z.updateSingletonFactory(d.__dashjs_factory_name,h),t.Z=h},5595:function(e,t,n){"use strict";var i=n(5448),r=n(8825);function o(){var e={};function t(t,n,i){var r=-1;return e[t]?(e[t].some((function(e,t){if(e&&e.callback===n&&(!i||i===e.scope))return r=t,!0})),r):r}return{on:function(n,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!n)throw new Error("event type cannot be null or undefined");if(!i||"function"!=typeof i)throw new Error("listener must be a function: "+i);var s=o.priority||0;if(!(t(n,i,r)>=0)){e[n]=e[n]||[];var a={callback:i,scope:r,priority:s};r&&r.getStreamId&&(a.streamId=r.getStreamId()),r&&r.getType&&(a.mediaType=r.getType()),o&&o.mode&&(a.mode=o.mode),e[n].some((function(t,i){if(t&&s>t.priority)return e[n].splice(i,0,a),!0}))||e[n].push(a)}},off:function(n,i,r){if(n&&i&&e[n]){var o=t(n,i,r);o<0||(e[n][o]=null)}},trigger:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,i.streamId&&(n.streamId=i.streamId),i.mediaType&&(n.mediaType=i.mediaType),e[t].filter((function(e){return!(!e||i.streamId&&e.streamId&&e.streamId!==i.streamId||i.mediaType&&e.mediaType&&e.mediaType!==i.mediaType||i.mode&&e.mode&&e.mode!==i.mode||!e.mode&&i.mode&&i.mode===r.Z.EVENT_MODE_ON_RECEIVE)})).forEach((function(e){return e&&e.callback.call(e.scope,n)}))}},reset:function(){e={}}}}o.__dashjs_factory_name="EventBus";var s=i.Z.getSingletonFactory(o);s.EVENT_PRIORITY_LOW=0,s.EVENT_PRIORITY_HIGH=5e3,i.Z.updateSingletonFactory(o.__dashjs_factory_name,s),t.Z=s},5448:function(e,t){"use strict";var n=function(){var e,t=[],n={},i={};function r(e,n){for(var i in t){var r=t[i];if(r.context===e&&r.name===n)return r.instance}return null}function o(e,t){return t[e]}function s(e,t,n){e in n&&(n[e]=t)}function a(t,n,i){var r,o=t.__dashjs_factory_name,s=n[o];if(s){var a=s.instance;if(!s.override)return a.apply({context:n,factory:e},i);for(var l in r=t.apply({context:n},i),a=a.apply({context:n,factory:e,parent:r},i))r.hasOwnProperty(l)&&(r[l]=a[l])}else r=t.apply({context:n},i);return r.getClassName=function(){return o},r}return e={extend:function(e,t,n,i){!i[e]&&t&&(i[e]={instance:t,override:n})},getSingletonInstance:r,setSingletonInstance:function(e,n,i){for(var r in t){var o=t[r];if(o.context===e&&o.name===n)return void(t[r].instance=i)}t.push({name:n,context:e,instance:i})},deleteSingletonInstances:function(e){t=t.filter((function(t){return t.context!==e}))},getSingletonFactory:function(e){var i=o(e.__dashjs_factory_name,n);return i||(i=function(n){var i;return void 0===n&&(n={}),{getInstance:function(){return i||(i=r(n,e.__dashjs_factory_name)),i||(i=a(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:i})),i}}},n[e.__dashjs_factory_name]=i),i},getSingletonFactoryByName:function(e){return o(e,n)},updateSingletonFactory:function(e,t){s(e,t,n)},getClassFactory:function(e){var t=o(e.__dashjs_factory_name,i);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return a(e,t,arguments)}}},i[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return o(e,i)},updateClassFactory:function(e,t){s(e,t,i)}}}();t.Z=n},1264:function(e,t,n){"use strict";var i=n(5448),r=n(703),o=n(6398),s=n(3393),a=n(7855),l=n(5595),c=n(8512);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(){var e,t,n=this.context,i=(0,l.Z)(n).getInstance(),h={"streaming.delay.liveDelay":c.Z.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":c.Z.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX},p={debug:{logLevel:o.Z.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:s.Z.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:s.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:s.Z.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:s.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:(e={},d(e,a.w.MPD_TYPE,500),d(e,a.w.XLINK_EXPANSION_TYPE,500),d(e,a.w.MEDIA_SEGMENT_TYPE,1e3),d(e,a.w.INIT_SEGMENT_TYPE,1e3),d(e,a.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),d(e,a.w.INDEX_SEGMENT_TYPE,1e3),d(e,a.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),d(e,a.w.LICENSE,1e3),d(e,a.w.OTHER_TYPE,1e3),d(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},d(t,a.w.MPD_TYPE,3),d(t,a.w.XLINK_EXPANSION_TYPE,1),d(t,a.w.MEDIA_SEGMENT_TYPE,3),d(t,a.w.INIT_SEGMENT_TYPE,3),d(t,a.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),d(t,a.w.INDEX_SEGMENT_TYPE,3),d(t,a.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),d(t,a.w.LICENSE,3),d(t,a.w.OTHER_TYPE,3),d(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:s.Z.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:s.Z.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},abrRulesParameters:{abandonRequestsRule:{graceTimeThreshold:500,abandonMultiplier:1.8,minLengthToAverage:5}},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:s.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:s.Z.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},f=r.Z.clone(p);return{get:function(){return f},update:function(e){"object"===u(e)&&function e(t,n,o){for(var s in t)t.hasOwnProperty(s)&&(n.hasOwnProperty(s)?"object"!==u(t[s])||t[s]instanceof Array||null===t[s]?(n[s]=r.Z.clone(t[s]),h[o+s]&&i.trigger(h[o+s])):e(t[s],n[s],o.slice()+s+"."):console.error("Settings parameter "+o+s+" is not supported"))}(e,f,"")},reset:function(){f=r.Z.clone(p)}}}h.__dashjs_factory_name="Settings";var p=i.Z.getSingletonFactory(h);t.Z=p},703:function(e,t,n){"use strict";var i=n(3875),r=n.n(i),o=n(1067);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"mixin",value:function(t,n,i){var r,o={};if(t)for(var a in n)n.hasOwnProperty(a)&&(r=n[a],a in t&&(t[a]===r||a in o&&o[a]===r)||("object"===s(t[a])&&null!==t[a]?t[a]=e.mixin(t[a],r,i):t[a]=i(r)));return t}},{key:"clone",value:function(t){if(!t||"object"!==s(t))return t;var n;if(t instanceof Array){n=[];for(var i=0,r=t.length;i<r;++i)i in t&&n.push(e.clone(t[i]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach((function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),i=0,r=n.length;i<r;i++){var o=n[i],s=o.indexOf(": ");s>0&&(t[o.substring(0,s)]=o.substring(s+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var n=new URL(e),i=new URL(t);if(n.protocol=i.protocol,n.origin!==i.origin)return t;var o=r().relative(n.pathname.substr(0,n.pathname.lastIndexOf("/")),i.pathname.substr(0,i.pathname.lastIndexOf("/"))),s=0===o.length?1:0;return o+=i.pathname.substr(i.pathname.lastIndexOf("/")+s,i.pathname.length-1),i.pathname.length<o.length?i.pathname:o}catch(e){return t}}},{key:"parseUserAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=null===e&&"undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return(0,o.UAParser)(t)}catch(e){return{}}}},{key:"stringHasProtocol",value:function(e){return/(http(s?)):\/\//i.test(e)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e,t),e}();t.Z=a},2032:function(e,t,n){"use strict";function i(){return"4.7.4"}n.d(t,{e:function(){return i}})},2230:function(e,t){"use strict";var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,i=!!t&&t.publicOnly;for(var r in e)!e.hasOwnProperty(r)||this[r]&&!n||i&&-1===e[r].indexOf("public_")||(this[r]=e[r])}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();t.Z=n},4351:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,e);var t,n,i=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function a(){var e;return function(e,t){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CMSD_STATIC_HEADER="cmsdStaticHeader",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",e.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",e.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",e.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",e.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",e.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",e}return a}(n(8342).Z);t.Z=a},8512:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,e);var t,n,i=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),i.apply(this,arguments)}return a}(n(4351).Z));t.Z=a},8342:function(e,t){"use strict";var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,i=!!t&&t.publicOnly;for(var r in e)!e.hasOwnProperty(r)||this[r]&&!n||i&&-1===e[r].indexOf("public_")||(this[r]=e[r])}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();t.Z=n},9326:function(e,t,n){"use strict";var i=n(3186),r=n(7855),o=n(5448),s=n(8825),a=n(7387),l=n(1553);function c(e){var t,n,o,c,u,d=(e=e||{}).eventBus,h=e.debug,p=e.urlUtils,f=e.type,g=e.streamInfo,m=e.segmentsController,b=e.timelineConverter,y=e.baseURLController;function v(){return f}function _(){o=null}function E(e,t,n){var i,r,o=y.resolve(n.path),s={};return o&&t!==o.url&&p.isRelative(t)?(i=o.url,r=o.serviceLocation,s=o.queryParams,t&&(i=p.resolve(t,i))):i=t,!p.isRelative(i)&&(e.url=i,e.serviceLocation=r,e.queryParams=s,!0)}function T(e,t){if(null==t)return null;var n=new i.Z,o=t.representation,s=o.adaptation.period.mpd.manifest.Period_asArray[o.adaptation.period.index].AdaptationSet_asArray[o.adaptation.index].Representation_asArray[o.index].bandwidth,l=t.media;return l=(0,a.vi)(l,"Number",t.replacementNumber),l=(0,a.vi)(l,"Time",t.replacementTime),l=(0,a.vi)(l,"Bandwidth",s),l=(0,a.Aj)(l,o.id),l=(0,a.eR)(l),n.mediaType=v(),n.type=r.w.MEDIA_SEGMENT_TYPE,n.range=t.mediaRange,n.startTime=t.presentationStartTime,n.mediaStartTime=t.mediaStartTime,n.duration=t.duration,n.timescale=o.timescale,n.availabilityStartTime=t.availabilityStartTime,n.availabilityEndTime=t.availabilityEndTime,n.availabilityTimeComplete=o.availabilityTimeComplete,n.wallStartTime=t.wallStartTime,n.quality=o.index,n.index=t.index,n.mediaInfo=e,n.adaptationIndex=o.adaptation.index,n.representationId=o.id,E(n,l,o)?n:void 0}function x(e,t,i){var r=null;if(!t||!t.segmentInfoType)return r;var s=m.getSegmentByTime(t,i);return s&&(o=s,n.debug("Index for time "+i+" is "+s.index),r=T(e,s)),r}function w(e,t,i){var r=null,s=m.getSegmentByIndex(t,i,o?o.mediaStartTime:-1);if(s)r=T(e,s),o=s;else{if(c&&!u)return n.debug(v()+" No segment found at index: "+i+". Wait for next loop"),null;u=!0}return r}function k(){n.debug("Dynamic stream complete"),u=!0}return t={getCurrentIndex:function(){return o?o.index:-1},getInitRequest:function(e,t){return t?function(e,t,n){var o=new i.Z,s=t.adaptation.period,l=s.start;if(o.mediaType=n,o.type=r.w.INIT_SEGMENT_TYPE,o.range=t.range,o.availabilityStartTime=b.calcAvailabilityStartTimeFromPresentationTime(l,t,c),o.availabilityEndTime=b.calcAvailabilityEndTimeFromPresentationTime(l+s.duration,t,c),o.quality=t.index,o.mediaInfo=e,o.representationId=t.id,E(o,t.initialization,t))return o.url=(0,a.vi)(o.url,"Bandwidth",t.bandwidth),o}(e,t,v()):null},getNextSegmentRequest:function(e,t){return t&&t.segmentInfoType?w(e,t,o?o.index+1:0):null},getNextSegmentRequestIdempotent:function(e,t){var n=o?o.index+1:0,i=m.getSegmentByIndex(t,n,o?o.mediaStartTime:-1);return i?T(e,i):null},getSegmentRequestForTime:x,getStreamId:function(){return g.id},getStreamInfo:function(){return g},getType:v,getValidTimeAheadOfTargetTime:function(e,t,n,i){try{if(isNaN(e)||!t||!n)return NaN;if(e<0&&(e=0),isNaN(i)&&(i=.5),x(t,n,e))return e;if(n.adaptation.period.start+n.adaptation.period.duration<e)return NaN;for(var r=isFinite(n.adaptation.period.duration)?n.adaptation.period.start+n.adaptation.period.duration:e+30,o=Math.min(e+i,r),s=NaN,a=null;o<=r;){var l=null;if(o<=r&&(l=x(t,n,o)),l){s=o,a=l;break}o+=i}if(a){var c=a.startTime+a.duration;return e>a.startTime&&c-e>i?e:!isNaN(a.startTime)&&e<a.startTime&&s>a.startTime?a.startTime+.001:Math.min(c-i,s)}return s}catch(e){return NaN}},initialize:function(e){c=e,u=!1,m.initialize(e)},isLastSegmentRequested:function(e,t){if(!e||!o)return!1;if(u)return!0;if(!isFinite(e.adaptation.period.duration))return!1;if(o.presentationStartTime+o.duration>t)return!1;if(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(o.index)&&o.index>=e.mediaFinishedInformation.numberOfSegments-1){if(!c||e.segmentInfoType===l.Z.SEGMENT_TEMPLATE)return!0;if(c&&e.segmentInfoType===l.Z.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)return!0}return!!(c&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.Z.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&o&&!isNaN(o.mediaStartTime)&&!isNaN(o.duration)&&o.mediaStartTime+o.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},repeatSegmentRequest:function(e,t){return t&&t.segmentInfoType?w(e,t,o?o.index:0):null},reset:function(){_(),d.off(s.Z.DYNAMIC_TO_STATIC,k,t)}},n=h.getLogger(t),_(),d.on(s.Z.DYNAMIC_TO_STATIC,k,t),t}c.__dashjs_factory_name="DashHandler",t.Z=o.Z.getClassFactory(c)},1553:function(e,t){"use strict";var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.ESSENTIAL_PROPERTY_ASARRAY="EssentialProperty_asArray",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.SUPPLEMENTAL_PROPERTY_ASARRAY="SupplementalProperty_asArray",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.INBAND="inband",this.TYPE="type",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.VIEWPOINT_ASARRAY="Viewpoint_asArray",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.DVB_URL="dvb:url",this.DVB_MIMETYPE="dvb:mimeType",this.DVB_FONTFAMILY="dvb:fontFamily",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PATCH_LOCATION_AS_ARRAY="PatchLocation_asArray",this.LOCATION="Location",this.LOCATION_AS_ARRAY="Location_asArray",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.CLIENT_REQUIREMENT="clientRequirement",this.TTL="ttl",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},this.PRODUCER_REFERENCE_TIME_TYPE={ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},this.SEGMENT_ALIGNMENT="segmentAlignment",this.SUB_SEGMENT_ALIGNMENT="subsegmentAlignment"}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}());t.Z=n},7802:function(e,t,n){"use strict";var i=n(5448),r=n(1724),o=n(3636),s=n(1736),a=n(5246);function l(e){e=e||{};var t,n,i=this.context,l=e.dashConstants,c=e.type,u=e.segmentBaseController;function d(e){return e?e.segments?n[l.SEGMENT_BASE]:n[e.segmentInfoType]:null}return t={initialize:function(t){n[l.SEGMENT_TIMELINE]=(0,r.Z)(i).create(e,t),n[l.SEGMENT_TEMPLATE]=(0,o.Z)(i).create(e,t),n[l.SEGMENT_LIST]=(0,s.Z)(i).create(e,t),n[l.SEGMENT_BASE]=(0,a.Z)(i).create(e,t)},updateInitData:function(e,t){return t?Promise.resolve():u.getSegmentBaseInitSegment({representation:e,mediaType:c})},updateSegmentData:function(e,t){return t?Promise.resolve():u.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:c})},getSegmentByIndex:function(e,t,n){var i=d(e);return i?i.getSegmentByIndex(e,t,n):null},getSegmentByTime:function(e,t){var n=d(e);return n?n.getSegmentByTime(e,t):null},getMediaFinishedInformation:function(e){var t=d(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},n={},t}l.__dashjs_factory_name="SegmentsController";var c=i.Z.getClassFactory(l);t.Z=c},1736:function(e,t,n){"use strict";var i=n(5448),r=n(3393),o=n(7387);function s(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function s(e,r){if(i(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,a=s.SegmentURL_asArray.length,l=e&&!isNaN(e.startNumber)?e.startNumber:1,c=Math.max(l-1,0),u=Math.max(r-c,0),d=null;if(u<a){var h=s.SegmentURL_asArray[u];(d=(0,o.NF)(n,t,e,r))&&(d.replacementTime=(l+r-1)*e.segmentDuration,d.media=h.media?h.media:"",d.mediaRange=h.mediaRange,d.indexRange=h.indexRange)}return d}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var o=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(o/r))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,i=e&&!isNaN(e.startNumber)?e.startNumber:1,r=Math.max(i-1,0);return t.numberOfSegments=r+n.SegmentURL_asArray.length,t}}}s.__dashjs_factory_name="ListSegmentsGetter";var a=i.Z.getClassFactory(s);t.Z=a},5246:function(e,t,n){"use strict";var i=n(5448),r=n(3393);function o(e){var t=(e=e||{}).timelineConverter;function n(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function i(e,t){if(n(),!e)return null;var i,r=e.segments?e.segments.length:-1;if(t<r&&(i=e.segments[t])&&i.index===t)return i;for(var o=0;o<r;o++)if((i=e.segments[o])&&i.index===t)return i;return null}return{getSegmentByIndex:i,getSegmentByTime:function(e,t){n();var r=function(e,t){if(!e)return-1;var n,i,r,o,s,a=e.segments,l=a?a.length:null,c=-1;if(a&&l>0)for(s=0;s<l;s++)if(r=(i=a[s]).presentationStartTime,t+(n=(o=i.duration)/2)>=r&&t-n<r+o){c=i.index;break}return c}(e,t);return i(e,r)},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments?(t.numberOfSegments=e.segments.length,t):t}}}o.__dashjs_factory_name="SegmentBaseGetter";var s=i.Z.getClassFactory(o);t.Z=s},7387:function(e,t,n){"use strict";n.d(t,{Aj:function(){return s},NF:function(){return u},TJ:function(){return d},eR:function(){return o},vi:function(){return a}});var i=n(2011);function r(e,t){for(;e.length<t;)e="0"+e;return e}function o(e){return e?e.split("$$").join("$"):e}function s(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)}function a(e,t,n){var i,o,s,a,l,c,u=t.length,d="%0".length;if(!e)return e;for(;;){if((i=e.indexOf("$"+t))<0)return e;if((o=e.indexOf("$",i+u))<0)return e;if((s=e.indexOf("%0",i+u))>i&&s<o)switch(a=e.charAt(o-1),l=parseInt(e.substring(s+d,o-1),10),a){case"d":case"i":case"u":c=r(n.toString(),l);break;case"x":c=r(n.toString(16),l);break;case"X":c=r(n.toString(16),l).toUpperCase();break;case"o":c=r(n.toString(8),l);break;default:return e}else c=n;e=e.substring(0,i)+c+e.substring(o+1)}}function l(e,t,n,r,o,s,a,l){var c,u=new i.Z;return u.representation=e,u.duration=t,u.presentationStartTime=n,u.mediaStartTime=r,u.availabilityStartTime=o.calcAvailabilityStartTimeFromPresentationTime(s,e,a),u.availabilityEndTime=o.calcAvailabilityEndTimeFromPresentationTime(s+t,e,a),u.wallStartTime=o.calcWallTimeForSegment(u,a),u.replacementNumber=(c=l,u.representation.startNumber+c),u.index=l,u}function c(e,t,n,i){var r=t.adaptation.period;if(isFinite(r.duration)&&r.start+r.duration<=n.presentationStartTime)return!1;if(i){if("INF"===t.availabilityTimeOffset)return!0;var o=e.getClientReferenceTime();return n.availabilityStartTime.getTime()<=o&&(!isFinite(n.availabilityEndTime)||n.availabilityEndTime.getTime()>=o)}return!0}function u(e,t,n,i){var r,o,s;r=n.segmentDuration,isNaN(r)&&(r=n.adaptation.period.duration),o=parseFloat((n.adaptation.period.start+i*r).toFixed(5)),s=parseFloat((o+r).toFixed(5));var a=l(n,r,o,e.calcMediaTimeFromPresentationTime(o,n),e,s,t,i);return c(e,n,a,t)?a:null}function d(e,t,n,i,r,o,s,u,d,h){var p,f,g=i/o,m=r/o;return p=e.calcPresentationTimeFromMediaTime(g,n),c(e,n,f=l(n,m,p,g,e,p+m,t,d),t)?(f.replacementTime=h||i,s=a(s,"Number",f.replacementNumber),s=a(s,"Time",f.replacementTime),f.media=s,f.mediaRange=u,f):null}},3636:function(e,t,n){"use strict";var i=n(5448),r=n(3393),o=n(7387);function s(e,t){var n=(e=e||{}).timelineConverter;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(r.Z.MISSING_CONFIG_ERROR)}function s(e,r){if(i(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;r=Math.max(r,0);var a=(0,o.NF)(n,t,e,r);if(a){a.replacementTime=Math.round((r-1)*e.segmentDuration*e.timescale,10);var l=s.media;l=(0,o.vi)(l,"Number",a.replacementNumber),l=(0,o.vi)(l,"Time",a.replacementTime),a.media=l}return a}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(i(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var o=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(o/r))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.segmentDuration;return isNaN(n)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/n),t}}}s.__dashjs_factory_name="TemplateSegmentsGetter";var a=i.Z.getClassFactory(s);t.Z=a},1724:function(e,t,n){"use strict";var i=n(5448),r=n(3393),o=n(7387);function s(e,t){var n=(e=e||{}).timelineConverter,i=e.dashMetrics;function s(){if(!n)throw new Error(r.Z.MISSING_CONFIG_ERROR)}function a(e,t){var n,i,r,o,s,a,c,u=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=u.SegmentTimeline,h=u.SegmentURL_asArray,p=0,f=-1;c=e.timescale;var g=!1;for(r=0,o=(n=d.S_asArray).length;r<o&&!g;r++)for(a=0,(i=n[r]).hasOwnProperty("r")&&(a=i.r),i.hasOwnProperty("t")&&(p=i.t),a<0&&(a=l(e,n[r+1],i,c,p/c)),s=0;s<=a&&!g;s++)(g=t(p,u,h,i,c,++f,r))&&(e.segmentDuration=i.d/c),p+=i.d}function l(e,t,r,o,s){var a;if(t&&t.hasOwnProperty("t"))a=t.t/o;else try{var l=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var c=i.getCurrentDVRInfo();l=isNaN(c.end)?0:c.end}else l=e.adaptation.period.start+e.adaptation.period.duration;a=n.calcMediaTimeFromPresentationTime(l,e),e.segmentDuration=r.d/o}catch(e){a=0}return Math.max(Math.ceil((a-s)/(r.d/o))-1,0)}return{getSegmentByIndex:function(e,i,r){if(s(),!e)return null;var l=null,c=!1;return a(e,(function(i,s,a,u,d,h,p){if(c||r<0){var f=s.media,g=u.mediaRange;return a&&(f=a[p].media||"",g=a[p].mediaRange),l=(0,o.TJ)(n,t,e,i,u.d,d,f,g,h,u.tManifest),!0}return i>=r*d-.5*u.d&&(c=!0),!1})),l},getSegmentByTime:function(e,i){if(s(),!e)return null;void 0===i&&(i=null);var r=null,l=n.calcMediaTimeFromPresentationTime(i,e);return a(e,(function(i,s,a,c,u,d,h){var p=parseFloat((l*u).toPrecision(15));if(p<i+c.d&&p>=i){var f=s.media,g=c.mediaRange;return a&&(f=a[h].media||"",g=a[h].mediaRange),r=(0,o.TJ)(n,t,e,i,c.d,u,f,g,d,c.tManifest),!0}return!1})),r},getMediaFinishedInformation:function(e){if(!e)return 0;var t,n,i,r,o,s,a,c=(e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList).SegmentTimeline,u=0,d=0,h=0;for(a=e.timescale,r=(t=c.S_asArray).length,i=0;i<r;i++)for(s=0,(n=t[i]).hasOwnProperty("r")&&(s=n.r),n.hasOwnProperty("t")&&(d=(u=n.t)/a),s<0&&(s=l(e,t[i+1],n,a,d)),o=0;o<=s;o++)h++,d=(u+=n.d)/a;return{numberOfSegments:h,mediaTimeOfLastSignaledSegment:d}}}}s.__dashjs_factory_name="TimelineSegmentsGetter";var a=i.Z.getClassFactory(s);t.Z=a},2011:function(e,t){"use strict";t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},2610:function(e,t){"use strict";t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}},1139:function(e,t,n){"use strict";n.d(t,{Z:function(){return Oo}});var i=n(452),r=n.n(i),o=n(3393),s=n(1553),a=n(3860),l=n(5595),c=n(8512),u=n(5448),d=n(6398),h=n(8825);function p(){var e,t,n,i,r,s,u,p,f,g,m,b,y,v,_,E,T,x,w,k,S,C,A,I,O,N=this.context,R=(0,l.Z)(N).getInstance();function D(){B(),v=!1,g=0,m=0,T=0,A=!1,x=!0,w=!1,I=!1,k=NaN,E=NaN,u&&(R.off(c.Z.DATA_UPDATE_COMPLETED,J,e),R.off(c.Z.LOADING_PROGRESS,ye,e),R.off(c.Z.MANIFEST_UPDATED,Te,e),R.off(c.Z.STREAMS_COMPOSED,xe,e),R.off(h.Z.PLAYBACK_ENDED,ge,e),R.off(h.Z.STREAM_INITIALIZING,_e,e),R.off(h.Z.REPRESENTATION_SWITCH,Ee,e),R.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),X(),u.removeEventListener("canplay",Q),u.removeEventListener("canplaythrough",ee),u.removeEventListener("play",ne),u.removeEventListener("waiting",ie),u.removeEventListener("playing",re),u.removeEventListener("pause",oe),u.removeEventListener("error",me),u.removeEventListener("seeking",se),u.removeEventListener("seeked",ae),u.removeEventListener("timeupdate",le),u.removeEventListener("progress",ce),u.removeEventListener("ratechange",ue),u.removeEventListener("loadedmetadata",de),u.removeEventListener("loadeddata",he),u.removeEventListener("stalled",ve),u.removeEventListener("ended",pe),u.removeEventListener("volumechange",fe)),f=null,u=null,b=null,y=null}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return parseFloat((M(e)-U()).toFixed(5))}function M(e){var t=e||b;return t.start+t.duration}function P(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b&&u&&u.getElement()?(e&&y&&$(U()),u.play()):v=!0}function B(){b&&u&&u.pause()}function j(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];b&&u&&u.getElement()&&e!==(isNaN(k)?u.getTime():k)&&((S=!0===i)||(k=e),t.info("Requesting seek to time: "+e+(S?" (internal)":"")),y&&r&&$(e),u.setCurrentTime(e,n))}function F(){if(b&&u&&y){var e=n&&n.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,t=r.getCurrentDVRInfo(e);return t&&t.range?t.range.end:0}}function $(e){var t=new Date(p.getClientReferenceTime()),n=s.getRegularPeriods()[0],i=p.calcPresentationTimeFromWallTime(t,n);g=i-e}function U(){return b&&u?u.getTime():null}function H(){return b&&u?u.isPaused():null}function G(){return b&&u?u.isSeeking():null}function V(){return b&&u?u.isStalled():null}function W(){return b&&u?u.getPlaybackRate():null}function z(){return b&&u?u.getEnded():null}function q(){return y}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!H()&&y&&0!==u.getReadyState()&&!G()&&!A){e||(e=n.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO);var i=U(),r=K(i,e);!isNaN(r)&&r!==i&&!G()&&(V()||C||1===u.getReadyState())&&(t.debug("UpdateCurrentTime: Seek to actual time: ".concat(r," from currentTime: ").concat(i)),j(r,!1,!1))}}function K(e,t){var n=r.getCurrentDVRInfo(t),i=n?n.range:null;return i?e>i.end?Math.max(i.end-g,i.start):e>0&&e+.25<i.start&&Math.abs(e-i.start)<31536e4?w?Math.max(i.end-g,i.start):i.start:e:NaN}function Z(){null===f&&(f=setInterval((function(){!function(){if(R.trigger(c.Z.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),q()){var e=Date.now();(isNaN(E)||e>E+O.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(n.addDVRMetric(),H()?function(){var e=Date.now();(!_||e>_+500)&&(_=e,le())}():Y(),E=e)}}()}),O.get().streaming.wallclockTimeUpdateInterval))}function X(){clearInterval(f),f=null}function J(e){var t=s.convertRepresentationToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&b.id===n.id&&(b=n)}function Q(){R.trigger(c.Z.CAN_PLAY)}function ee(){R.trigger(c.Z.CAN_PLAY_THROUGH)}function te(e){e.streamId===n.getActiveStreamInfo().id&&(C=e.state===a.Z.BUFFER_EMPTY,O.get().streaming.buffer.setStallState&&u.setStallState(e.mediaType,e.state===a.Z.BUFFER_EMPTY))}function ne(){t.info("Native video element event: play"),Y(),Z(),R.trigger(c.Z.PLAYBACK_STARTED,{startTime:U()})}function ie(){t.info("Native video element event: waiting"),R.trigger(c.Z.PLAYBACK_WAITING,{playingTime:U()})}function re(){t.info("Native video element event: playing"),S=!1,R.trigger(c.Z.PLAYBACK_PLAYING,{playingTime:U()})}function oe(){t.info("Native video element event: pause"),R.trigger(c.Z.PLAYBACK_PAUSED,{ended:z()})}function se(){if(!S){var e=U();isNaN(k)||k===e||(e=k),k=NaN,t.info("Seeking to: "+e),Z(),R.trigger(c.Z.PLAYBACK_SEEKING,{seekTime:e,streamId:b.id})}}function ae(){t.info("Native video element event: seeked"),S=!1,R.trigger(c.Z.PLAYBACK_SEEKED)}function le(){b&&R.trigger(c.Z.PLAYBACK_TIME_UPDATED,{timeToEnd:L(),time:U(),streamId:b.id})}function ce(){R.trigger(c.Z.PLAYBACK_PROGRESS,{streamId:b.id})}function ue(){var e=W();t.info("Native video element event: ratechange: ",e),R.trigger(c.Z.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function de(){t.info("Native video element event: loadedmetadata"),R.trigger(c.Z.PLAYBACK_METADATA_LOADED),Z()}function he(){t.info("Native video element event: loadeddata"),R.trigger(c.Z.PLAYBACK_LOADED_DATA)}function pe(){t.info("Native video element event: ended"),B(),X();var e=n?n.getActiveStreamInfo():null;e&&R.trigger(c.Z.PLAYBACK_ENDED,{isLast:e.isLast})}function fe(){R.trigger(c.Z.PLAYBACK_VOLUME_CHANGED)}function ge(e){if(f&&e.isLast){t.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var n=e.seekTime?e.seekTime:M();u.setCurrentTime(n),B(),X()}}function me(e){var t=e.target||e.srcElement;R.trigger(c.Z.PLAYBACK_ERROR,{error:t.error})}function be(){y=!1}function ye(e){if(!1===e.stream&&w&&!isNaN(e.request.duration)){var n=1.2*e.request.duration;n>g&&(t.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",n.toFixed(2)),g=n,m=n)}}function ve(e){R.trigger(c.Z.PLAYBACK_STALLED,{e:e})}function _e(e){var n;(n=e.mediaInfo)&&n.supplementalProperties&&n.supplementalProperties[o.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&"true"===n.supplementalProperties[o.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME].value&&(t.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),w=!0)}function Ee(e){var t=n.getActiveStreamInfo();e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===o.Z.VIDEO||e.mediaType===o.Z.AUDIO)&&(x=e.currentRepresentation.availabilityTimeComplete,(w=!x)&&!I&&(I=!0))}function Te(){A=!0}function xe(){A=!1}return e={initialize:function(t,n){b=t,!0!==n&&(u.addEventListener("canplay",Q),u.addEventListener("canplaythrough",ee),u.addEventListener("play",ne),u.addEventListener("waiting",ie),u.addEventListener("playing",re),u.addEventListener("pause",oe),u.addEventListener("error",me),u.addEventListener("seeking",se),u.addEventListener("seeked",ae),u.addEventListener("timeupdate",le),u.addEventListener("progress",ce),u.addEventListener("ratechange",ue),u.addEventListener("loadedmetadata",de),u.addEventListener("loadeddata",he),u.addEventListener("stalled",ve),u.addEventListener("ended",pe),u.addEventListener("volumechange",fe),y=b.manifestInfo.isDynamic,C=!1,S=!1,R.on(c.Z.DATA_UPDATE_COMPLETED,J,e),R.on(c.Z.LOADING_PROGRESS,ye,e),R.on(c.Z.MANIFEST_UPDATED,Te,e),R.on(c.Z.STREAMS_COMPOSED,xe,e),R.on(h.Z.PLAYBACK_ENDED,ge,e,{priority:l.Z.EVENT_PRIORITY_HIGH}),R.on(h.Z.STREAM_INITIALIZING,_e,e),R.on(h.Z.REPRESENTATION_SWITCH,Ee,e),R.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),R.on(h.Z.DYNAMIC_TO_STATIC,be,e),v&&(v=!1,P()))},setConfig:function(e){e&&(e.streamController&&(n=e.streamController),e.serviceDescriptionController&&(i=e.serviceDescriptionController),e.dashMetrics&&(r=e.dashMetrics),e.adapter&&(s=e.adapter),e.videoModel&&(u=e.videoModel),e.timelineConverter&&(p=e.timelineConverter),e.settings&&(O=e.settings))},getTimeToStreamEnd:L,getBufferLevel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;return n.getActiveStreamProcessors().forEach((function(n){if(!e||0===e.length||-1===e.indexOf(n.getType())){var i=n.getBufferLevel();t=null===t?i:Math.min(t,i)}})),t},getPlaybackStalled:function(){return C},getTime:U,getLowLatencyModeEnabled:function(){return w},getInitialCatchupModeActivated:function(){return I},getIsManifestUpdateInProgress:function(){return A},getPlaybackRate:W,getPlayedRanges:function(){return b&&u?u.getPlayedRanges():null},getEnded:z,getIsDynamic:q,getStreamController:function(){return n},computeAndSetLiveDelay:function(e,t){var n,r,o,a=!isNaN(e)&&isFinite(e)?e:NaN,l=s.getSuggestedPresentationDelay(),c=i.getServiceDescriptionSettings();return n=isNaN(O.get().streaming.delay.liveDelay)?null===O.get().streaming.delay.liveDelayFragmentCount||isNaN(O.get().streaming.delay.liveDelayFragmentCount)||isNaN(a)?c&&!isNaN(c.liveDelay)&&c.liveDelay>0?c.liveDelay:!0===O.get().streaming.delay.useSuggestedPresentationDelay&&null!==l&&!isNaN(l)&&l>0?l:isNaN(a)?t&&!isNaN(t.minBufferTime)?4*t.minBufferTime:4*b.manifestInfo.minBufferTime:4*a:a*O.get().streaming.delay.liveDelayFragmentCount:O.get().streaming.delay.liveDelay,null!==(o=s.getAvailabilityStartTime())&&(T=o),r=t&&t.dvrWindowSize>0?Math.min(n,t.dvrWindowSize):n,g=r,m=r,r},getLiveDelay:function(){return g},getOriginalLiveDelay:function(){return m},getCurrentLiveLatency:function(){if(!y||isNaN(T))return NaN;var e=U();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*p.getClientTimeOffset();return Math.max(((t-T-1e3*e)/1e3).toFixed(3),0)},play:P,isPaused:H,isStalled:V,pause:B,isSeeking:G,getStreamEndTime:M,seek:j,seekToOriginalLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=F();0!==i&&j(i-(g=m),e,t,n)},seekToCurrentLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=F();0!==i&&j(i-g,e,t,n)},reset:D,updateCurrentTime:Y,getAvailabilityStartTime:function(){return T}},t=(0,d.Z)(N).getInstance().getLogger(e),D(),e}p.__dashjs_factory_name="PlaybackController";var f=u.Z.getSingletonFactory(p),g=n(3186),m="loading",b="executed",y="failed";function v(e){var t,n,i,r,o=(e=e||{}).eventBus,s=e.events,a=e.dashMetrics,l=e.fragmentLoader,c=e.debug,u=e.streamInfo,d=e.type;function h(e){var t;return!!e&&(t=!1,i.some((function(n){if(i=e,r=n,!isNaN(i.index)&&i.startTime===r.startTime&&i.adaptationIndex===r.adaptationIndex&&i.type===r.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,n)||function(e,t){return e.action===g.Z.ACTION_COMPLETE&&e.action===t.action}(e,n))return t=!0;var i,r})),t)}function p(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function f(e){i=i.filter((function(t){var n=p(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n}))}function v(e,t){t<=e+.5||(i=i.filter((function(n){var i=p(n);return isNaN(n.startTime)||n.startTime>=t-i||isNaN(n.duration)||n.startTime+n.duration<=e+i})))}function _(e,t,n){for(var i=e.length-1;i>=0;i--){var r=e[i],o=r.startTime,s=o+r.duration;if(n=isNaN(n)?p(r):n,!isNaN(o)&&!isNaN(s)&&t+n>=o&&t-n<s||isNaN(o)&&isNaN(t))return r}return null}function E(e,t){a.addSchedulingInfo(e,t),a.addRequestsQueue(e.mediaType,r,i)}function T(e){e.sender===l&&(r.splice(r.indexOf(e.request),1),e.response&&!e.error&&i.push(e.request),E(e.request,e.error?y:b),o.trigger(s.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:u.id,mediaType:d}))}function x(e){e.sender===l&&o.trigger(s.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:u.id,mediaType:d})}function w(e){e.sender===l&&o.trigger(s.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:u.id,mediaType:d})}function k(){i=[],r=[]}return t={getStreamId:function(){return u.id},getType:function(){return d},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach((function(t){var o=function(e){var t;switch(e){case m:t=r;break;case b:t=i;break;default:t=[]}return t}(t);n=n.concat(function(e,t){return t.hasOwnProperty("time")?[_(e,t.time,t.threshold)]:e.filter((function(e){for(var n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0}))}(o,e))})),n},isFragmentLoaded:h,isFragmentLoadedOrPending:function(e){var t,n=!1,i=0;if(!(n=h(e)))for(i=0;i<r.length;i++)t=r[i],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n},removeExecutedRequestsBeforeTime:f,removeExecutedRequestsAfterTime:function(e){i=i.filter((function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e}))},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var n=0,i=0,r=e.length;i<r;i++)v(n,e.start(i)),n=e.end(i);t>0&&v(n,t)}else f()},abortRequests:function(){n.debug("abort requests"),l.abort(),r=[]},executeRequest:function(e){e.action===g.Z.ACTION_DOWNLOAD?(E(e,m),r.push(e),function(e){o.trigger(s.FRAGMENT_LOADING_STARTED,{request:e},{streamId:u.id,mediaType:d}),l.load(e)}(e)):n.warn("Unknown request action.")},reset:function(){o.off(s.LOADING_COMPLETED,T,this),o.off(s.LOADING_DATA_PROGRESS,x,this),o.off(s.LOADING_ABANDONED,w,this),l&&l.reset(),k()},resetInitialSettings:k,addExecutedRequest:function(e){i.push(e)}},n=c.getLogger(t),k(),o.on(s.LOADING_COMPLETED,T,t),o.on(s.LOADING_DATA_PROGRESS,x,t),o.on(s.LOADING_ABANDONED,w,t),t}v.__dashjs_factory_name="FragmentModel";var _=u.Z.getClassFactory(v);_.FRAGMENT_MODEL_LOADING=m,_.FRAGMENT_MODEL_EXECUTED=b,_.FRAGMENT_MODEL_CANCELED="canceled",_.FRAGMENT_MODEL_FAILED=y,u.Z.updateClassFactory(v.__dashjs_factory_name,_);var E=_,T=n(5459);function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var S=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=k(t);if(n){var r=k(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){var e;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return r}(n(2230).Z)),C=n(1264),A=n(7855);function I(e){var t,n,i,r,s,a,l=this.context,u=(0,C.Z)(l).getInstance(),h=e.textController,p=e.eventBus,f=[],g=[],m=!1,b=e.mediaSource,y=null;function v(e){return new Promise((function(t){R((function(){r.changeType&&r.changeType(e),t()}))}))}function _(e){return r=h.getTextSourceBuffer(e),Promise.resolve()}function E(){if("function"==typeof r.addEventListener)try{r.addEventListener("updateend",O,!1),r.addEventListener("error",N,!1),r.addEventListener("abort",N,!1)}catch(e){a=setInterval(O,50)}else a=setInterval(O,50)}function x(e){return new Promise((function(t){r&&u.get().streaming.buffer.useAppendWindow?R((function(){try{if(!r)return void t();var n=b.duration,o=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(n=e.start+e.duration),e&&!isNaN(e.start)&&(o=e.start),r.appendWindowEnd===n&&r.appendWindowStart===o||(r.appendWindowStart=0,r.appendWindowEnd=n+.01,r.appendWindowStart=Math.max(o-.1,0),i.debug("Updated append window for ".concat(s.type,". Set start to ").concat(r.appendWindowStart," and end to ").concat(r.appendWindowEnd))),t()}catch(e){i.warn("Failed to set append window"),t()}})):t()}))}function w(e){return new Promise((function(t){r?R((function(){try{r.timestampOffset===e||isNaN(e)||(r.timestampOffset=e,i.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(e){t()}})):t()}))}function k(){if(!m&&g.length>0){m=!0;var e=g[0];g.splice(0,1);var t=function(){m=!1,g.length>0&&k.call(this),e&&e.data&&e.data.segmentType&&e.data.segmentType!==A.w.INIT_SEGMENT_TYPE&&delete e.data.bytes,e.promise.resolve({chunk:e.data})};try{y=e.request,0===e.data.bytes.byteLength?t.call(this):(r.appendBuffer?r.appendBuffer(e.data.bytes):r.append(e.data.bytes,e.data),R(t.bind(this)))}catch(t){i.fatal('SourceBuffer append failed "'+t+'"'),g.length>0?k():m=!1,delete e.data.bytes,e.promise.reject({chunk:e.data,error:new T.Z(t.code,t.message)})}}}function I(){f.length>0&&(r.updating||(f.shift()(),I()))}function O(){r.updating||I()}function N(e){var t,i,r=e.target||{};t=c.Z.SOURCE_BUFFER_ERROR,i={error:r,lastRequestAppended:y}||{},p.trigger(t,i,{streamId:s.streamInfo.id,mediaType:n})}function R(e){f.push(e),r.updating||I()}return t={getType:function(){return n},getAllBufferRanges:function(){try{return r.buffered}catch(e){return i.error("getAllBufferRanges exception: "+e.message),null}},getBuffer:function(){return r},append:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(i,r){e?(g.push({data:e,promise:{resolve:i,reject:r},request:n}),R(k.bind(t))):r({chunk:e,error:new T.Z(S.APPEND_ERROR_CODE,S.APPEND_ERROR_MESSAGE)})}))},remove:function(e){return new Promise((function(t,n){var i=e.start,o=e.end;i>=0&&o>i?R((function(){try{r.remove(i,o),R((function(){t({from:i,to:o,unintended:!1}),e.resolve&&e.resolve()}))}catch(t){n({from:i,to:o,unintended:!1,error:new T.Z(S.REMOVE_ERROR_CODE,S.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(t)}})):t()}))},abort:function(){return new Promise((function(e){try{g=[],"open"===b.readyState?R((function(){try{r&&r.abort(),e()}catch(t){e()}})):r&&r.setTextTrack&&"ended"===b.readyState?(r.abort(),e()):e()}catch(t){e()}}))},reset:function(){if(r){try{f=[],function(){try{"function"==typeof r.removeEventListener&&(r.removeEventListener("updateend",O,!1),r.removeEventListener("error",N,!1),r.removeEventListener("abort",N,!1)),clearInterval(a)}catch(e){i.error(e)}}(),m=!1,g=[],r.getClassName&&"TextSourceBuffer"===r.getClassName()||(i.debug("Removing sourcebuffer from media source"),b.removeSourceBuffer(r))}catch(e){}r=null}y=null},updateTimestampOffset:w,initializeForStreamSwitch:function(e,t,i){n=(s=e).type;var o=s.codec;r=i.getBuffer(),E();var a=[];return a.push(new Promise((function(e){R((function(){var t=r.appendWindowStart,n=r.appendWindowEnd;r&&(r.abort(),r.appendWindowStart=t,r.appendWindowEnd=n),e()}))}))),a.push(x(s.streamInfo)),u.get().streaming.buffer.useChangeTypeForTrackSwitch&&a.push(v(o)),t&&void 0!==t.MSETimeOffset&&a.push(w(t.MSETimeOffset)),Promise.all(a)},initializeForFirstUse:function(e,t,i){n=(s=t).type;var a=s.codec;try{if(a.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return _(e);r=b.addSourceBuffer(a),E();var l=[];return l.push(x(s.streamInfo)),i&&void 0!==i.MSETimeOffset&&l.push(w(i.MSETimeOffset)),Promise.all(l)}catch(t){return s.type==o.Z.TEXT&&!s.isFragmented||-1!==a.indexOf('codecs="stpp')||-1!==a.indexOf('codecs="vtt')||-1!==a.indexOf("text/vtt")?_(e):Promise.reject(t)}},updateAppendWindow:x,changeType:v},i=(0,d.Z)(l).getInstance().getLogger(t),t}I.__dashjs_factory_name="SourceBufferSink";var O=u.Z.getClassFactory(I);function N(e){var t,n,i,r=this.context,o=[],s=e;function a(e,t){return o=o.filter((function(n){return!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))})),Promise.resolve()}return t={getAllBufferRanges:function(){for(var e=[],t=0;t<o.length;t++){var n=o[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}var i={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(i,"length",{get:function(){return e.length}}),i},append:function(e){return"InitializationSegment"!==e.segmentType?(o.push(e),o.sort((function(e,t){return e.start-t.start})),i=null):i=e,n.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),s&&s({chunk:e}),Promise.resolve()},remove:a,abort:function(){return Promise.resolve()},discharge:function(e,t){var n=function(e,t){return o.filter((function(n){return(isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e)}))}(e,t);return i&&(n.push(i),i=null),a(e,t),n},reset:function(){o=[],i=null,s=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},n=(0,d.Z)(r).getInstance().getLogger(t),t}N.__dashjs_factory_name="PreBufferSink";var R=u.Z.getClassFactory(N);function D(){var e={};return{save:function(t){var n=t.streamId,i=t.representationId;e[n]=e[n]||{},e[n][i]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}D.__dashjs_factory_name="InitCache";var L=u.Z.getSingletonFactory(D),M=.01,P="BufferController";function B(e){e=e||{};var t,n,i,r,s,u,p,f,g,m,b,y,v,_,x,w,k,C,I,N,D,B=this.context,j=(0,l.Z)(B).getInstance(),F=e.errHandler,$=e.fragmentModel,U=e.representationController,H=e.adapter,G=e.textController,V=e.abrController,W=e.playbackController,z=e.streamInfo,q=e.type,Y=e.settings;function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,i){u=e,g&&t&&"function"==typeof g.discharge?(m=g,X(t).then((function(){n()})).catch((function(e){i(e)}))):n()}))}function Z(e){return H.convertRepresentationToRepresentationInfo(U.getRepresentationForQuality(e))}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(n,i){C&&e?u?(b=!1,J(e,t).then((function(e){n(e)})).catch((function(e){i(e)}))):(b=!0,function(){var e=this;return new Promise((function(t,n){var i=V.getQualityFor(q,z.id);g=R(B).create(ie.bind(e)),ve(Z(i)).then((function(){t(g)})).catch((function(){n()}))}))}().then((function(e){n(e)})).catch((function(e){i(e)}))):n(null)}))}function J(e,t){return new Promise((function(i,r){var s=V.getQualityFor(q,z.id);g=O(B).create({mediaSource:u,textController:G,eventBus:j}),function(e,t,n){var i=Z(s);return t&&t[q]&&(q===o.Z.VIDEO||q===o.Z.AUDIO)?g.initializeForStreamSwitch(e,i,t[q]):g.initializeForFirstUse(z,e,i)}(e,t).then((function(){return ve(Z(s))})).then((function(){i(g)})).catch((function(e){n.fatal("Caught error on create SourceBuffer: "+e),F.error(new T.Z(S.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,S.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+q)),r(e)}))}))}function Q(e){Y.get().streaming.cacheInitSegments&&(n.info("Init fragment finished loading saving to",q+"'s init cache"),C.save(e.chunk)),n.debug("Append Init fragment",q," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),te(e.chunk)}function ee(e){te(e.chunk,e.request)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;g&&(g.append(e,t).then((function(e){ie(e)})).catch((function(e){ie(e)})),e.mediaInfo.type===o.Z.VIDEO&&Ce(c.Z.VIDEO_CHUNK_RECEIVED,{chunk:e}))}function ne(e){if(e&&e.length>0)for(var t=0,i=e.length;t<i;t++)n.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",W.getTime())}function ie(e){if(e.error)return 22===e.error.code&&function(){if(k=!0,s=.8*we(),n.warn("Quota exceeded, Critical Buffer: "+s),s>0){var e=Math.max(.2*s,1),t=s-e,i=Math.min(Y.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),r=Math.min(Y.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),o={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(i.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(r.toFixed(5))}}};Y.update(o)}}(),void(22!==e.error.code&&Se()||(n.warn("Clearing playback buffer to overcome quota exceed situation"),Ce(c.Z.QUOTA_EXCEEDED,{criticalBufferLevel:s,quotaExceededTime:e.chunk.start}),me(ge())));if(g&&(ue(),k=!1,(_=e.chunk)&&_.endFragment)){_&&!isNaN(_.index)&&(p=Math.max(_.index,p),de());var t=g.getAllBufferRanges();_.segmentType===A.w.MEDIA_SEGMENT_TYPE&&(ne(t),se(),function(){if(!isNaN(D)&&!b)if(q===o.Z.AUDIO||q===o.Z.VIDEO){var e=W.getTime(),t=ce(e,0),n=ce(D,0);if(t&&n&&t.start===n.start)D=NaN;else{var i=U.getCurrentRepresentation().segmentDuration,r=ce(D,i);r&&(Y.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-D)>i?D<=r.end&&W.seek(Math.max(D,r.start),!1,!0):e<r.start&&W.seek(r.start,!1,!0))}}else D=NaN}());var i=!1;y&&(y.indexOf(_)>0&&(i=!0),y=null),_&&!i&&Ce(c.Z.BYTES_APPENDED_END_FRAGMENT,{quality:_.quality,startTime:_.start,index:_.index,bufferedRanges:t,segmentType:_.segmentType,mediaType:q})}}function re(){return new Promise((function(e,t){var n=oe();if(!n||0===n.length)return se(),void e();me(n).then((function(){e()})).catch((function(e){t(e)}))}))}function oe(e){var t=[],i=g.getAllBufferRanges();if(!i||0===i.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:i.start(0),end:i.end(i.length-1)+.5});else{var r=function(e,t){var n=Y.get().streaming.buffer.bufferToKeep,i=t.start(0);if(e-i>n){var r=Math.max(0,e-n),o=$.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,time:e,threshold:M})[0];if(o&&(r=Math.min(o.startTime,r)),r>0)return{start:i,end:r}}return null}(e,i),o=function(e,t){var i=t.end(t.length-1)+.5,r=ke(e),o=z.manifestInfo.duration>=Y.get().streaming.buffer.longFormContentDurationThreshold?Y.get().streaming.buffer.bufferTimeAtTopQualityLongForm:Y.get().streaming.buffer.bufferTimeAtTopQuality,s=isNaN(r)?e:Math.min(r,e+o);if(s>=t.end(t.length-1))return null;var a=$.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,time:e,threshold:M})[0];if(a&&(s=Math.max(a.startTime+a.duration,s)),Y.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var l=0;l<t.length;l++)if(t.start(l)<=e&&e<=t.end(l)&&t.start(l)<=s&&s<=t.end(l)){var c=s;s=l+1<t.length?t.start(l+1):t.end(l)+1,n.debug("Buffered range ["+t.start(l)+", "+t.end(l)+"] overlaps with targetTime "+e+" and range to be pruned ["+c+", "+i+"], using ["+s+", "+i+"] instead"+(s<i?"":" (no actual pruning)"));break}return s<t.end(t.length-1)?{start:s,end:i}:null}(e,i);r&&t.push(r),o&&t.push(o)}return t}function se(){(!N||q===o.Z.TEXT&&G.isTextEnabled())&&ue()}function ae(){he()}function le(){he(),D=NaN}function ce(e,t){if(!g)return null;var n,i,r=g.getAllBufferRanges(),o=0,s=0,a=null,l=null,c=0,u=isNaN(t)?.15:t;if(null!=r){for(i=0,n=r.length;i<n;i++)if(o=r.start(i),s=r.end(i),null===a)c=Math.abs(o-e),(e>=o&&e<s||c<=u)&&(a=o,l=s);else{if(!((c=o-l)<=u))break;l=s}if(null!==a)return{start:a,end:l}}return null}function ue(){if(W){var e=W.getTime()||0;b&&(e=isNaN(D)?0:D);var t=Y.get().streaming.gaps.jumpGaps&&!isNaN(Y.get().streaming.gaps.smallGapLimit)?Y.get().streaming.gaps.smallGapLimit:NaN;r=Math.max(function(e,t){var n;return Y.get().streaming.gaps.jumpGaps&&(t=Y.get().streaming.gaps.smallGapLimit),null===(n=ce(e,t))?0:n.end-e}(e,t),0),Ce(c.Z.BUFFER_LEVEL_UPDATED,{mediaType:q,bufferLevel:r}),he()}}function de(){var e=p>=f-1,t=W.getTimeToStreamEnd(z)-r<1e-5;!e&&!t||i||(xe(!0),n.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(z.id," and type ").concat(q)))}function he(){q!==o.Z.AUDIO&&q!==o.Z.VIDEO||((!W.getLowLatencyModeEnabled()&&r<Y.get().streaming.buffer.stallThreshold||0===r)&&!i?pe(a.Z.BUFFER_EMPTY):(i||r>=Y.get().streaming.buffer.stallThreshold||W.getLowLatencyModeEnabled()&&r>0)&&pe(a.Z.BUFFER_LOADED))}function pe(e){v===e||e===a.Z.BUFFER_EMPTY&&0===W.getTime()||q===o.Z.TEXT&&!G.isTextEnabled()||(v=e,Ce(c.Z.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Ce(e===a.Z.BUFFER_LOADED?c.Z.BUFFER_LOADED:c.Z.BUFFER_EMPTY),n.debug(e===a.Z.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function fe(){g&&q!==o.Z.TEXT&&(i||me(ge()))}function ge(){var e=[],t=g.getAllBufferRanges();if(!t||0===t.length)return e;var n=W.getTime(),i=Math.max(0,n-Y.get().streaming.buffer.bufferToKeep),r=$.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,time:n,threshold:M})[0];if(r)i=Math.min(r.startTime,i);else if(0===n&&W.getIsDynamic())return[];if(t.start(0)<=i){for(var o={start:0,end:i},s=0;s<t.length&&t.end(s)<=i;s++)o.end=t.end(s);o.start<o.end&&e.push(o)}return e}function me(e){return new Promise((function(t,n){if(e&&g&&0!==e.length){var i=[];e.forEach((function(e){i.push(function(e){return new Promise((function(t,n){e.resolve=t,e.reject=n,I.push(e)}))}(e))})),w||be(),Promise.all(i).then((function(){t()})).catch((function(e){n(e)}))}else t()}))}function be(){try{if(0===I.length||!g)return n.debug("Nothing to prune, halt pruning"),I=[],void(w=!1);var e=g.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return n.debug("SourceBuffer is empty (or does not exist), halt pruning"),I=[],void(w=!1);var t=I.shift();n.debug("".concat(q,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),w=!0,W.getTime()<t.end&&xe(!1),g.remove(t).then((function(e){ye(e)})).catch((function(e){ye(e)}))}catch(e){w=!1}}function ye(e){n.debug("onRemoved buffer from:",e.from,"to",e.to),g&&(ne(g.getAllBufferRanges()),0===I.length&&(w=!1,ue()),e.unintended&&(n.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),Ce(c.Z.SEEK_TARGET,{time:e.from})),w?be():(N?N=!1:ue(),Ce(c.Z.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:Se(),quotaExceeded:k})))}function ve(e){return new Promise((function(t){e&&void 0!==e.MSETimeOffset&&g&&g.updateTimestampOffset?g.updateTimestampOffset(e.MSETimeOffset).then((function(){t()})).catch((function(){t()})):t()}))}function _e(){return g&&!i?g.updateAppendWindow(z):Promise.resolve()}function Ee(){++x*(Y.get().streaming.wallclockTimeUpdateInterval/1e3)>=Y.get().streaming.buffer.bufferPruningInterval&&(x=0,fe())}function Te(){he()}function xe(e){(i=e)?Ce(c.Z.BUFFERING_COMPLETED):f=Number.POSITIVE_INFINITY}function we(){try{var e,t,n=g.getAllBufferRanges(),i=0;if(!n)return i;for(t=0,e=n.length;t<e;t++)i+=n.end(t)-n.start(t);return i}catch(e){return 0}}function ke(e){try{var t=e,n=g.getAllBufferRanges();if(!n||0===n.length)return NaN;for(var i=0;t===e&&i<n.length;){var r=n.start(i),o=n.end(i);t>=r&&t<=o&&(t=o),i+=1}return t===e?NaN:t}catch(e){}}function Se(){var e=we();return isNaN(e)||e<s}function Ce(e,t){var n=t||{};j.trigger(e,n,{streamId:z.id,mediaType:q})}function Ae(e,t){if(s=Number.POSITIVE_INFINITY,v=void 0,f=Number.POSITIVE_INFINITY,p=0,_=null,i=!1,w=!1,k=!1,r=0,x=0,I=[],D=NaN,b=!1,g){var n=g;g=null,e||t||n.abort().then((function(){n.reset(t),n=null}))}N=!1}return t={initialize:function(e){K(e),j.on(c.Z.INIT_FRAGMENT_LOADED,Q,t),j.on(c.Z.MEDIA_FRAGMENT_LOADED,ee,t),j.on(c.Z.WALLCLOCK_TIME_UPDATED,Ee,t),j.on(h.Z.PLAYBACK_PLAYING,le,t),j.on(h.Z.PLAYBACK_PROGRESS,se,t),j.on(h.Z.PLAYBACK_TIME_UPDATED,se,t),j.on(h.Z.PLAYBACK_RATE_CHANGED,Te,t),j.on(h.Z.PLAYBACK_STALLED,ae,t)},getStreamId:function(){return z.id},getType:function(){return q},getBufferControllerType:function(){return P},createBufferSink:X,dischargePreBuffer:function(){if(g&&m&&"function"==typeof m.discharge){var e=m.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+q+"PreBuffer discharge, adding buffer for:",i=0;i<e.length;i++)t+=" start: "+e.start(i)+", end: "+e.end(i)+";";n.debug(t)}else n.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");y=[];for(var r=m.discharge(),o=null,s=0;s<r.length;s++){var a=r[s];if(a.segmentType!==A.w.INIT_SEGMENT_TYPE){var l=C.extract(a.streamId,a.representationId);l&&o!==l&&(y.push(l),g.append(l),o=l)}y.push(a),g.append(a)}m.reset(),m=null}},getBuffer:function(){return g},getBufferLevel:function(){return r},getRangeAt:ce,hasBufferAtTime:function(e){try{var t=g.getAllBufferRanges();if(!t||0===t.length)return!1;for(var i=0;i<t.length;){var r=t.start(i),o=t.end(i);if(e>=r&&e<=o)return!0;i+=1}return!1}catch(e){return n.error(e),!1}},pruneBuffer:fe,setMediaSource:K,getMediaSource:function(){return u},appendInitSegmentFromCache:function(e){var t=C.extract(z.id,e);return!!t&&(n.info("Append Init fragment",q," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),te(t),!0)},getIsBufferingCompleted:function(){return i},setIsBufferingCompleted:xe,getIsPruningInProgress:function(){return w},reset:function(e,t){j.off(c.Z.INIT_FRAGMENT_LOADED,Q,this),j.off(c.Z.MEDIA_FRAGMENT_LOADED,ee,this),j.off(c.Z.WALLCLOCK_TIME_UPDATED,Ee,this),j.off(h.Z.PLAYBACK_PLAYING,le,this),j.off(h.Z.PLAYBACK_PROGRESS,se,this),j.off(h.Z.PLAYBACK_TIME_UPDATED,se,this),j.off(h.Z.PLAYBACK_RATE_CHANGED,Te,this),j.off(h.Z.PLAYBACK_STALLED,ae,this),Ae(e,t)},prepareForPlaybackSeek:function(){return i&&xe(!1),g.abort()},prepareForReplacementTrackSwitch:function(e){return new Promise((function(t,n){g.abort().then((function(){return _e()})).then((function(){return Y.get().streaming.buffer.useChangeTypeForTrackSwitch?g.changeType(e):Promise.resolve()})).then((function(){return re()})).then((function(){xe(!1),t()})).catch((function(e){n(e)}))}))},prepareForNonReplacementTrackSwitch:function(e){return new Promise((function(t,n){_e().then((function(){return Y.get().streaming.buffer.useChangeTypeForTrackSwitch?g.changeType(e):Promise.resolve()})).then((function(){t()})).catch((function(e){n(e)}))}))},prepareForForceReplacementQualitySwitch:function(e){return new Promise((function(t,n){g.abort().then((function(){return _e()})).then((function(){return re()})).then((function(){return ve(e)})).then((function(){xe(!1),t()})).catch((function(e){n(e)}))}))},updateAppendWindow:_e,getAllRangesWithSafetyFactor:oe,getContinuousBufferTimeForTargetTime:ke,clearBuffers:me,pruneAllSafely:re,updateBufferTimestampOffset:ve,setSeekTarget:function(e){D=e},segmentRequestingCompleted:function(e){isNaN(e)||(f=e,de())}},n=(0,d.Z)(B).getInstance().getLogger(t),C=L(B).getInstance(),Ae(),t}B.__dashjs_factory_name=P;var j=u.Z.getClassFactory(B),F="NotFragmentedTextBufferController";function $(e){e=e||{};var t,n,i,r,o,s,a=this.context,u=(0,l.Z)(a).getInstance(),d=e.textController,h=e.errHandler,p=e.streamInfo,f=e.type;function g(e){r=e}function m(e){var t,i;n!==e&&(n=e)&&(t=c.Z.BUFFERING_COMPLETED,i={},u.trigger(t,i,{streamId:p.id,mediaType:f}))}function b(e){e.chunk.bytes&&!n&&(s.save(e.chunk),o.append(e.chunk),m(!0))}return t={initialize:function(e){g(e)},getStreamId:function(){return p.id},getType:function(){return f},getBufferControllerType:function(){return F},createBufferSink:function(e){return new Promise((function(t,n){try{(o=O(a).create({mediaSource:r,textController:d,eventBus:u})).initializeForFirstUse(p,e),i||(o.getBuffer()&&"function"==typeof o.getBuffer().initialize&&o.getBuffer().initialize(),i=!0),t(o)}catch(e){h.error(new T.Z(S.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,S.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+f)),n(e)}}))},dischargePreBuffer:function(){},getBuffer:function(){return o},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:g,getMediaSource:function(){return r},appendInitSegmentFromCache:function(e){return null!==s.extract(p.id,e)},getIsBufferingCompleted:function(){return n},setIsBufferingCompleted:m,getIsPruningInProgress:function(){return!1},reset:function(e){u.off(c.Z.INIT_FRAGMENT_LOADED,b,t),!e&&o&&(o.abort(),o.reset(),o=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return n=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},i=!1,r=null,n=!1,s=L(a).getInstance(),u.on(c.Z.INIT_FRAGMENT_LOADED,b,t),t}$.__dashjs_factory_name=F;var U=u.Z.getClassFactory($);function H(e){e=e||{};var t,n,i,r,s,u,p,f,g,m,b,y,v,_=this.context,T=(0,l.Z)(_).getInstance(),x=e.dashMetrics,w=e.mediaPlayerModel,k=e.fragmentModel,S=e.abrController,C=e.playbackController,A=e.textController,I=e.type,O=e.bufferController,N=e.representationController,R=e.settings;function D(){y=!0}function L(){y=!1}function M(e){if(!O.getIsBufferingCompleted()){P();var t=isNaN(e)?0:e;s=setTimeout(B,t)}}function P(){s&&(clearTimeout(s),s=null)}function B(){try{if(function(){try{return I===o.Z.TEXT&&!A.isTextEnabled()||C.isPaused()&&(!C.getStreamController().getInitialPlayback()||!C.getStreamController().getAutoPlay())&&!R.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}())return void P();if(function(){try{return!!y&&N.getCurrentRepresentationInfo()&&(isNaN(g)||m||(e=n.id,t=S.getMaxAllowedIndexFor(I,e),!(!isNaN(f)&&f==t||(i.info("Top quality "+I+" index has changed from "+f+" to "+t),f=t,0)))||function(){var e=N.getCurrentRepresentationInfo();return!I||!e||x.getCurrentBufferLevel(I)<j()}())}catch(e){return!1}var e,t}()){var e=!1;v&&(e=S.checkPlaybackQuality(I,n.id)),e||(r=N.getCurrentRepresentationInfo(),b||r.quality!==g||m?(m?(i.debug("Switch track for "+I+", representation id = "+r.id),m=!1):i.debug("Quality has changed, get init request for representationid = "+r.id),T.trigger(c.Z.INIT_FRAGMENT_NEEDED,{representationId:r.id,sender:t},{streamId:n.id,mediaType:I}),v=!1,b=!1):(i.debug("Media segment needed for ".concat(I," and stream id ").concat(n.id)),T.trigger(c.Z.MEDIA_FRAGMENT_NEEDED,{},{streamId:n.id,mediaType:I}),v=!0))}else M(C.getLowLatencyModeEnabled()?R.get().streaming.scheduling.lowLatencyTimeout:R.get().streaming.scheduling.defaultTimeout)}catch(e){M(C.getLowLatencyModeEnabled()?R.get().streaming.scheduling.lowLatencyTimeout:R.get().streaming.scheduling.defaultTimeout)}var r}function j(){var e=NaN,t=N.getCurrentRepresentationInfo();return I&&t?e=I===o.Z.TEXT?function(){try{if(A.isTextEnabled()){var e=N.getCurrentRepresentationInfo();if(isNaN(e.fragmentDuration)){var t=x.getCurrentSchedulingInfo(a.Z.SCHEDULING_INFO);return t?t.duration:0}return e.fragmentDuration}return 0}catch(e){return 0}}():I===o.Z.AUDIO&&u?function(){try{var e=x.getCurrentBufferLevel(o.Z.VIDEO),t=N.getCurrentRepresentationInfo();return isNaN(t.fragmentDuration)?e+1:Math.max(e+1,t.fragmentDuration)}catch(e){return 0}}():function(){try{var e=N.getCurrentRepresentationInfo().mediaInfo.streamInfo;return S.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=R.get().streaming.buffer.longFormContentDurationThreshold?R.get().streaming.buffer.bufferTimeAtTopQualityLongForm:R.get().streaming.buffer.bufferTimeAtTopQuality:w.getStableBufferTime()}catch(e){return w.getStableBufferTime()}}():e}function F(){$(!0)}function $(e){if(C&&k){var t=k.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,time:C.getTime(),threshold:0})[0];t&&C.getTime()>=t.startTime&&((!p.mediaInfo||t.mediaInfo.type===p.mediaInfo.type&&t.mediaInfo.index!==p.mediaInfo.index)&&e&&T.trigger(c.Z.TRACK_CHANGE_RENDERED,{mediaType:I,oldMediaInfo:p.mediaInfo,newMediaInfo:t.mediaInfo,streamId:n.id}),t.quality===p.quality&&t.adaptationIndex===p.adaptationIndex||!e||(i.debug("Quality change rendered for streamId ".concat(n.id," and type ").concat(I)),T.trigger(c.Z.QUALITY_CHANGE_RENDERED,{mediaType:I,oldQuality:p.quality,newQuality:t.quality,streamId:n.id})),p={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function U(){k.abortRequests(),P()}function H(){R.get().streaming.scheduling.scheduleWhilePaused||M()}function G(e){x.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function V(){v=!0,r=0,g=NaN,p={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},f=NaN,m=!1,b=!1,y=!0}return t={initialize:function(e){u=e,T.on(c.Z.URL_RESOLUTION_FAILED,U,t),T.on(h.Z.PLAYBACK_STARTED,H,t),T.on(h.Z.PLAYBACK_RATE_CHANGED,G,t),T.on(h.Z.PLAYBACK_TIME_UPDATED,F,t),T.on(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,D,t),T.on(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,L,t)},getType:function(){return I},getStreamId:function(){return n.id},setTimeToLoadDelay:function(e){r=e},getTimeToLoadDelay:function(){return r},setSwitchTrack:function(e){m=e},getSwitchTrack:function(){return m},startScheduleTimer:M,clearScheduleTimer:P,reset:function(){T.off(c.Z.URL_RESOLUTION_FAILED,U,t),T.off(h.Z.PLAYBACK_STARTED,H,t),T.off(h.Z.PLAYBACK_RATE_CHANGED,G,t),T.off(h.Z.PLAYBACK_TIME_UPDATED,F,t),T.off(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,D,t),T.off(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,L,t),P(),$(!1),V(),n=null},getBufferTarget:j,getPlaybackController:function(){return C},setCheckPlaybackQuality:function(e){v=e},setInitSegmentRequired:function(e){b=e},setLastInitializedQuality:function(e){g=e}},i=(0,d.Z)(_).getInstance().getLogger(t),V(),n=e.streamInfo,t}H.__dashjs_factory_name="ScheduleController";var G=u.Z.getClassFactory(H),V=n(7387);function W(e){var t,n,i,r,s,a,l=(e=e||{}).eventBus,c=e.events,u=e.abrController,d=e.dashMetrics,p=e.playbackController,f=e.timelineConverter,g=e.type,m=e.streamInfo,b=e.dashConstants,y=e.segmentsController,v=e.isDynamic,_=e.adapter;function E(){return g}function T(){return i}function x(){return a}function w(){n=null,i=!0,r=[],s=null}function k(e){return new Promise((function(t,n){var i=e.hasInitialization(),o=e.hasSegments(),s=[];s.push(y.updateInitData(e,i)),s.push(y.updateSegmentData(e,o)),Promise.all(s).then((function(n){var i;n[0]&&!n[0].error&&(e=function(e,t){return t&&!t.error&&t.representation?t.representation:e}(e,n[0])),n[1]&&!n[1].error&&(e=function(e,t){if(t&&!t.error){var n,i,r,o,s=t.segments,a=[],l=0;for(n=0,i=s?s.length:0;n<i;n++)r=s[n],(o=(0,V.TJ)(f,v,e,r.startTime,r.duration,r.timescale,r.media,r.mediaRange,l))&&(a.push(o),o=null,l++);return a.length>0&&(e.segments=a),e}}(e,n[1])),(i=e).mediaFinishedInformation=y.getMediaFinishedInformation(i),function(e){if(T()){var t,n,i=d.getCurrentManifestUpdate(),o=!1;if(i){for(var s=0;s<i.representationInfo.length;s++)if((t=i.representationInfo[s]).index===e.index&&t.mediaType===E()){o=!0;break}o||d.addManifestUpdateRepresentationInfo(e,E())}if(function(){for(var e=0,t=r.length;e<t;e++){var n=r[e].segmentInfoType;if(!r[e].hasInitialization()||(n===b.SEGMENT_BASE||n===b.BASE_URL)&&!r[e].segments)return!1}return!0}()){u.setPlaybackQuality(g,m,(n=a,r.indexOf(n)));var l=d.getCurrentDVRInfo(g);l&&d.updateManifestUpdateInfo({latency:l.range.end-p.getTime()}),d.getCurrentRepresentationSwitch(x().adaptation.type)||S(),A()}}}(e),t()})).catch((function(e){n(e)}))}))}function S(){!function(){if(!(u&&d&&p&&f))throw new Error(o.Z.MISSING_CONFIG_ERROR)}();var e=new Date,t=x(),n=1e3*p.getTime();t&&d.addRepresentationSwitch(t.adaptation.type,e,n,t.id),l.trigger(h.Z.REPRESENTATION_SWITCH,{mediaType:g,streamId:m.id,currentRepresentation:t,numberOfRepresentations:r.length},{streamId:m.id,mediaType:g})}function C(e){return null==e||e>=r.length?null:r[e]}function A(e){i=!1,l.trigger(c.DATA_UPDATE_COMPLETED,{data:n,currentRepresentation:a,error:e},{streamId:m.id,mediaType:g})}function I(e){a=e,s=_.convertRepresentationToRepresentationInfo(a)}function O(e){if(e.newDuration){var t=x();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return t={getStreamId:function(){return m.id},getType:E,getData:function(){return n},isUpdating:T,updateData:function(e,t,s,a,l){return new Promise((function(c,u){if(i=!0,r=t,n=e,I(C(l)),s!==o.Z.VIDEO&&s!==o.Z.AUDIO&&(s!==o.Z.TEXT||!a))return A(),void c();for(var d=[],h=0,p=r.length;h<p;h++){var f=r[h];d.push(k(f))}Promise.all(d).then((function(){I(C(l)),c()})).catch((function(e){u(e)}))}))},getCurrentRepresentation:x,getCurrentRepresentationInfo:function(){return s},getRepresentationForQuality:C,prepareQualityChange:function(e){I(C(e)),S()},reset:function(){l.off(h.Z.MANIFEST_VALIDITY_CHANGED,O,t),w()}},w(),l.on(h.Z.MANIFEST_VALIDITY_CHANGED,O,t),t}W.__dashjs_factory_name="RepresentationController";var z=u.Z.getClassFactory(W),q=n(3106),Y=n(9326),K=n(7473),Z=n(2594);function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var J=function e(){X(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};J.INITIAL_PLAYOUT_START_REASON="initial_playout",J.SEEK_START_REASON="seek",J.RESUME_FROM_PAUSE_START_REASON="resume",J.METRICS_COLLECTION_START_REASON="metrics_collection_start";var Q=function e(){X(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};Q.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",Q.REBUFFERING_REASON="rebuffering",Q.USER_REQUEST_STOP_REASON="user_request",Q.END_OF_PERIOD_STOP_REASON="end_of_period",Q.END_OF_CONTENT_STOP_REASON="end_of_content",Q.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",Q.FAILURE_STOP_REASON="failure";var ee=n(7802);function te(){return{ntpToUTC:function(e){var t=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(t.getTime()+e).getTime()}}}te.__dashjs_factory_name="TimeUtils";var ne=u.Z.getSingletonFactory(te);function ie(e){e=e||{};var t,n,i,r,u,p,f,g,m,b,y,v,_,x,w,k=this.context,C=(0,l.Z)(k).getInstance(),I=e.streamInfo,O=e.type,N=e.errHandler,R=e.mimeType,D=e.timelineConverter,L=e.adapter,M=e.manifestModel,P=e.mediaPlayerModel,B=e.fragmentModel,F=e.abrController,$=e.playbackController,H=e.mediaController,V=e.textController,W=e.dashMetrics,X=e.settings,J=e.boxParser,te=e.segmentBlacklistController;function ie(){return I.id}function re(){return O}function oe(){return L.getIsTextTrack(g.getData())}function se(){u=[],r=null,x=0,m=!1,b=!1,y=!1,w=null}function ae(e){return!isNaN(e)&&!isNaN(I.duration)&&isFinite(I.duration)&&e>=I.start+I.duration}function le(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if($.getIsManifestUpdateInProgress())he();else if((!oe()||V.isTextEnabled())&&p&&e.representationId&&!p.appendInitSegmentFromCache(e.representationId)){var n=g.getCurrentRepresentation();if(0===n.range)return void ce();var i=v?v.getInitRequest(r,n):null;i?B.executeRequest(i):t&&(f.setInitSegmentRequired(!0),he())}}function ce(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if($.getIsManifestUpdateInProgress()||p.getIsPruningInProgress())he();else{var n=function(){var e,t=Ce();if(isNaN(x)||re()===o.Z.TEXT&&!V.isTextEnabled())return null;if(v){var n=g&&t?g.getRepresentationForQuality(t.quality):null;e=m?v.getSegmentRequestForTime(r,n,x):b?v.repeatSegmentRequest(r,n):v.getNextSegmentRequest(r,n)}return e}();n?(m=!1,b=!1,ue(n)):de(t)}}function ue(e){isNaN(e.startTime+e.duration)||(x=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+f.getTimeToLoadDelay(),f.setTimeToLoadDelay(0),function(e){var t=e.url;return e.range&&(t=t.concat("_",e.range)),te.contains(t)}(e)?(n.warn("Fragment request url ".concat(e.url," for stream id ").concat(I.id," and media type ").concat(O," is on the ignore list and will be skipped")),he()):(n.debug("Next fragment request url for stream id ".concat(I.id," and media type ").concat(O," is ").concat(e.url)),B.executeRequest(e))}function de(e){var t,o=g.getCurrentRepresentation();if(!X.get().streaming.gaps.enableSeekFix||!m&&0!==$.getTime()||(i?i&&o.segmentInfoType===s.Z.SEGMENT_TIMELINE&&(t=v.getValidTimeAheadOfTargetTime(x,r,o,X.get().streaming.gaps.threshold)):t=v.getValidTimeAheadOfTargetTime(x,r,o,X.get().streaming.gaps.threshold),isNaN(t)||t===x)){if(v.isLastSegmentRequested(o,x)){var a=v.getCurrentIndex();return n.debug("Segment requesting for stream ".concat(I.id," has finished")),C.trigger(c.Z.STREAM_REQUESTING_COMPLETED,{segmentIndex:a},{streamId:I.id,mediaType:O}),p.segmentRequestingCompleted(a),void f.clearScheduleTimer()}e&&he()}else $.isSeeking()||0===$.getTime()?(n.warn("Adjusting playback time ".concat(t," because of gap in the manifest. Seeking by ").concat(t-x)),$.seek(t,!1,!1)):(n.warn("Adjusting buffering time ".concat(t," because of gap in the manifest. Adjusting time by ").concat(t-x)),Le(t),e&&he())}function he(){f.startScheduleTimer($.getLowLatencyModeEnabled()?X.get().streaming.scheduling.lowLatencyTimeout:X.get().streaming.scheduling.defaultTimeout)}function pe(e){e.error||p.getIsBufferingCompleted()||p.updateBufferTimestampOffset(e.currentRepresentation)}function fe(e){W.addBufferState(O,e.state,f.getBufferTarget()),e.state!==a.Z.BUFFER_EMPTY||$.isSeeking()||(n.info("Buffer is empty! Stalling!"),W.pushPlayListTraceMetrics(new Date,Q.REBUFFERING_REASON))}function ge(e){B.syncExecutedRequestsWithBufferedRange(p.getBuffer().getAllBufferRanges(),I.duration),e.quotaExceeded&&e.from>$.getTime()&&Le(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&f.startScheduleTimer()}function me(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),n.warn("Blacklisting segment with url ".concat(t)),te.add(t)}}function be(e){if(n.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(e.streamId)),e.segmentType===A.w.INIT_SEGMENT_TYPE){var t=e.quality;f.setLastInitializedQuality(t),n.info("["+O+"] lastInitializedRepresentationInfo changed to "+e.quality)}w?ye(w):f.startScheduleTimer(0)}function ye(e){var t=B.getRequests({state:E.FRAGMENT_MODEL_LOADING});if(t&&t.length>0)return n.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),void(w=e);p.updateBufferTimestampOffset(e).then((function(){f.setCheckPlaybackQuality(!1),r.segmentAlignment||r.subSegmentAlignment?f.startScheduleTimer():Re(),w=null,y=!1})).catch((function(){w=null,y=!1}))}function ve(e){n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),$.isSeeking()||f.getSwitchTrack()||y||(n.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?f.setInitSegmentRequired(!0):Le(e.request.startTime+e.request.duration/2),f.startScheduleTimer(0))}function _e(e){n.info("OnFragmentLoadingCompleted for stream id "+I.id+" and media type "+O+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),oe()&&f.startScheduleTimer(0),e.error&&e.request.serviceLocation&&function(e){n.info("Fragment loading completed with an error"),e&&e.request&&e.request.type&&(e.request.type===A.w.INIT_SEGMENT_TYPE?le({representationId:e.request.representationId,sender:{}},!1):e.request.type===A.w.MEDIA_SEGMENT_TYPE&&(Le(e.request.startTime+e.request.duration/2),ce({},!1)))}(e)}function Ee(){Le($.getTime()),Se().startScheduleTimer()}function Te(e){var t=e.currentTrackInfo;if(t){var n=u.find((function(e){return e.index===t.index&&e.lang===t.lang}));n&&ke(n).then((function(){p.setIsBufferingCompleted(!1),Le($.getTime()),f.setInitSegmentRequired(!0),f.startScheduleTimer()}))}}function xe(e){Le(e.quotaExceededTime),f.clearScheduleTimer()}function we(){return p?p.getBuffer():null}function ke(e){e===r||e&&r&&e.type!==r.type||(r=e);var t=L.getRealAdaptation(I,r),n=L.getVoRepresentations(r);if(g){var s,a=g.getData(),l=F.getMaxAllowedIndexFor(O,I.id),c=F.getMinAllowedIndexFor(O,I.id),u=null;return null!==a&&a.id===t.id||O===o.Z.TEXT?s=F.getQualityFor(O,I.id):(u=F.getThroughputHistory().getAverageThroughput(O,i)||F.getInitialBitrateFor(O,I.id),s=F.getQualityForBitrate(r,u,I.id)),void 0!==c&&s<c&&(s=c),s>l&&(s=l),g.updateData(t,n,O,r.isFragmented,s)}return Promise.resolve()}function Se(){return f}function Ce(e){var t;return void 0!==e?((0,q.SE)(e),t=g?g.getRepresentationForQuality(e):null):t=g?g.getCurrentRepresentation():null,L.convertRepresentationToRepresentationInfo(t)}function Ae(){return!!p&&p.getIsBufferingCompleted()}function Ie(e){if(X.get().streaming.enableManifestTimescaleMismatchFix){var t=e.chunk,n=t.bytes,i=Ce(t.quality),r=g&&i?g.getRepresentationForQuality(i.quality):null;i&&r&&(r.timescale=J.getMediaTimescaleFromMoov(n))}}function Oe(e){var t=e.chunk,n=t.bytes,i=t.quality,r=Ce(i),o=g&&r?g.getRepresentationForQuality(r.quality):null;if(r&&o){var a;if(X.get().streaming.parseInbandPrft&&e.request.type===A.w.MEDIA_SEGMENT_TYPE){var l=function(e,t){var n=e.getBoxes("prft"),i=[];return n.forEach((function(e){i.push(function(e,t){var n="unknown";switch(e.flags){case 0:n=s.Z.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:n=s.Z.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:n=s.Z.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}var i=1e3*e.ntp_timestamp_sec+e.ntp_timestamp_frac/Math.pow(2,32)*1e3;return{type:n,ntpTimestamp:i=ne(k).getInstance().ntpToUTC(i),mediaTime:e.media_time/t}}(e,t))})),i}(a=a||J.parse(n),o.timescale);l&&l.length&&C.trigger(h.Z.INBAND_PRFT,{data:l},{streamId:I.id,mediaType:O})}var u=L.getEventsFor(r.mediaInfo,null,I),d=L.getEventsFor(r,o,I);if(u&&u.length>0||d&&d.length>0){var p=B.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,quality:i,index:t.index})[0],f=function(e,t,n,i){try{for(var r={},o=[],s=n.concat(i),a=0,l=s.length;a<l;a++)r[s[a].schemeIdUri+"/"+s[a].value]=s[a];var c=e.getBoxes("emsg");if(!c||0===c.length)return o;for(var u=e.getBox("sidx"),d=!u||isNaN(u.earliest_presentation_time)||isNaN(u.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:u.earliest_presentation_time/u.timescale,h=Math.max(d,0),p=g.getCurrentRepresentation(),f=0,m=c.length;f<m;f++){var b=L.getEvent(c[f],r,h,p);b&&o.push(b)}return o}catch(e){return[]}}(a=a||J.parse(n),p,u,d);C.trigger(c.Z.INBAND_EVENTS,{events:f},{streamId:I.id})}}}function Ne(){var e=$.getTime();X.get().streaming.buffer.flushBufferAtTrackSwitch&&$.seek(e+.001,!1,!0),Le(e),p.setSeekTarget(e),f.startScheduleTimer()}function Re(){var e=$.getTime(),t=p.getContinuousBufferTimeForTargetTime(e);Le(isNaN(t)?e:t),f.startScheduleTimer()}function De(e){e&&!isNaN(e.time)&&(Le(e.time),p.setSeekTarget(e.time))}function Le(e){x=e,m=!0}return t={initialize:function(n,r,a){_=(0,ee.Z)(k).create({events:c.Z,eventBus:C,streamInfo:I,timelineConverter:D,dashConstants:s.Z,segmentBaseController:e.segmentBaseController,type:O}),v=(0,Y.Z)(k).create({streamInfo:I,type:O,timelineConverter:D,dashMetrics:W,mediaPlayerModel:P,baseURLController:e.baseURLController,errHandler:N,segmentsController:_,settings:X,boxParser:J,events:c.Z,eventBus:C,errors:S,debug:(0,d.Z)(k).getInstance(),requestModifier:(0,K.Z)(k).getInstance(),dashConstants:s.Z,constants:o.Z,urlUtils:(0,Z.Z)(k).getInstance()}),i=I.manifestInfo.isDynamic,v.initialize(i),F.registerStreamType(O,t),g=z(k).create({streamInfo:I,type:O,abrController:F,dashMetrics:W,playbackController:$,timelineConverter:D,dashConstants:s.Z,events:c.Z,eventBus:C,errors:S,isDynamic:i,adapter:L,segmentsController:_}),(p=function(e,t){return e?e!==o.Z.TEXT||t?j(k).create({streamInfo:I,type:e,mediaPlayerModel:P,manifestModel:M,fragmentModel:B,errHandler:N,mediaController:H,representationController:g,adapter:L,textController:V,abrController:F,playbackController:$,settings:X}):U(k).create({streamInfo:I,type:e,mimeType:R,fragmentModel:B,textController:V,errHandler:N,settings:X}):(N.error(new T.Z(S.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,S.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}(O,a))&&p.initialize(n),(f=G(k).create({streamInfo:I,type:O,mimeType:R,adapter:L,dashMetrics:W,mediaPlayerModel:P,fragmentModel:B,abrController:F,playbackController:$,textController:V,mediaController:H,bufferController:p,representationController:g,settings:X})).initialize(r),x=0,m=!1,b=!1},getStreamId:ie,getType:re,isUpdating:function(){return!!g&&g.isUpdating()},getBufferController:function(){return p},dischargePreBuffer:function(){p.dischargePreBuffer()},getFragmentModel:function(){return B},getScheduleController:Se,getRepresentationController:function(){return g},getRepresentationInfo:Ce,getBufferLevel:function(){return p?p.getBufferLevel():0},isBufferingCompleted:Ae,createBufferSinks:function(e){var t=we();return t?Promise.resolve(t):p?p.createBufferSink(r,e):Promise.resolve(null)},updateStreamInfo:function(e){return I=e,Ae()?Promise.resolve():p.updateAppendWindow()},getStreamInfo:function(){return I},selectMediaInfo:ke,clearMediaInfoArray:function(){u=[]},addMediaInfo:function(e){-1===u.indexOf(e)&&u.push(e)},prepareTrackSwitch:function(){return new Promise((function(e){n.debug("Preparing track switch for type ".concat(O));var t=O===o.Z.TEXT||X.get().streaming.trackSwitchMode[O]===o.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&$.getTimeToStreamEnd(I)>X.get().streaming.buffer.stallThreshold;if(p.getIsBufferingCompleted()&&!t)return p.prepareForNonReplacementTrackSwitch(r.codec).then((function(){C.trigger(c.Z.BUFFERING_COMPLETED,{},{streamId:I.id,mediaType:O})})).catch((function(){C.trigger(c.Z.BUFFERING_COMPLETED,{},{streamId:I.id,mediaType:O})})),void e();f.clearScheduleTimer(),f.setSwitchTrack(!0),t?(C.trigger(c.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:O,streamId:I.id},{mediaType:O,streamId:I.id}),B.abortRequests(),p.prepareForReplacementTrackSwitch(r.codec).then((function(){var e=Ce();return p.updateBufferTimestampOffset(e)})).then((function(){Ne(),e()})).catch((function(){Ne(),e()}))):p.prepareForNonReplacementTrackSwitch(r.codec).then((function(){Re(),e()})).catch((function(){Re(),e()}))}))},prepareQualityChange:function(e){w&&n.warn("Canceling queued representation switch to ".concat(w.quality," for ").concat(O)),n.debug("Preparing quality switch for type ".concat(O));var t=e.newQuality;y=!0,f.clearScheduleTimer(),g.prepareQualityChange(t);var i=Ce(t);e.reason&&e.reason.forceReplace?function(e){B.abortRequests(),C.trigger(c.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:O,streamId:I.id},{mediaType:O,streamId:I.id}),f.setCheckPlaybackQuality(!1),p.prepareForForceReplacementQualitySwitch(e).then((function(){Ne(),w=null,y=!1})).catch((function(){Ne(),w=null,y=!1}))}(i):e&&e.reason&&e.reason.forceAbandon?function(e){p.updateBufferTimestampOffset(e).then((function(){B.abortRequests(),b=!0,f.setCheckPlaybackQuality(!1),f.startScheduleTimer(),y=!1,w=null})).catch((function(){w=null,y=!1}))}(i):X.get().streaming.buffer.fastSwitchEnabled?function(e){var t=$.getTime(),n=1.5*(isNaN(e.fragmentDuration)?1:e.fragmentDuration),i=B.getRequests({state:E.FRAGMENT_MODEL_EXECUTED,time:t+n,threshold:0})[0];if(i&&!oe()){var r=p.getBufferLevel(),o=F.getAbandonmentStateFor(I.id,O);i.quality<e.quality&&r>=n&&o!==a.Z.ABANDON_LOAD?p.updateBufferTimestampOffset(e).then((function(){B.abortRequests(),Le(t+n),f.setCheckPlaybackQuality(!1),f.startScheduleTimer(),y=!1})).catch((function(){y=!1})):ye(e)}else ye(e)}(i):ye(i),W.pushPlayListTraceMetrics(new Date,Q.REPRESENTATION_SWITCH_STOP_REASON),W.createPlaylistTraceMetrics(i.id,1e3*$.getTime(),$.getPlaybackRate())},getMediaInfo:function(){return r},getMediaSource:function(){return p.getMediaSource()},setMediaSource:function(e){return p.setMediaSource(e,r)},getBuffer:we,setExplicitBufferingTime:Le,finalisePlayList:function(e,t){W.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=Ce(),t=g&&e?g.getRepresentationForQuality(e.quality):null;return v.getNextSegmentRequestIdempotent(r,t)},prepareInnerPeriodPlaybackSeeking:function(e){return new Promise((function(t){if(p.hasBufferAtTime(e.seekTime))return p.pruneBuffer(),ae(p.getContinuousBufferTimeForTargetTime(e.seekTime))&&p.setIsBufferingCompleted(!0),void t();f.clearScheduleTimer(),B.abortRequests(),p.prepareForPlaybackSeek().then((function(){var t=p.getAllRangesWithSafetyFactor(e.seekTime);return p.clearBuffers(t)})).then((function(){var n=p.getContinuousBufferTimeForTargetTime(e.seekTime);if(ae(n))p.setIsBufferingCompleted(!0),t();else{var i=isNaN(n)?e.seekTime:n;Le(i),p.setSeekTarget(i);var r=[];r.push(p.updateAppendWindow());var o=Ce();r.push(p.updateBufferTimestampOffset(o)),Promise.all(r).then((function(){f.setInitSegmentRequired(!0),f.setCheckPlaybackQuality(!1),f.startScheduleTimer(),t()}))}})).catch((function(e){n.error(e)}))}))},prepareOuterPeriodPlaybackSeeking:function(){return new Promise((function(e,t){try{f.clearScheduleTimer(),B.abortRequests(),p.prepareForPlaybackSeek().then((function(){return p.pruneAllSafely()})).then((function(){e()}))}catch(e){t(e)}}))},reset:function(e,n){v&&v.reset(),p&&(p.reset(e,n),p=null),f&&(f.reset(),f=null),g&&(g.reset(),g=null),_&&(_=null),F&&F.unRegisterStreamType(ie(),O),C.off(c.Z.DATA_UPDATE_COMPLETED,pe,t),C.off(c.Z.INIT_FRAGMENT_NEEDED,le,t),C.off(c.Z.MEDIA_FRAGMENT_NEEDED,ce,t),C.off(c.Z.INIT_FRAGMENT_LOADED,Ie,t),C.off(c.Z.MEDIA_FRAGMENT_LOADED,Oe,t),C.off(c.Z.BUFFER_LEVEL_STATE_CHANGED,fe,t),C.off(c.Z.BUFFER_CLEARED,ge,t),C.off(c.Z.SEEK_TARGET,De,t),C.off(c.Z.FRAGMENT_LOADING_ABANDONED,ve,t),C.off(c.Z.FRAGMENT_LOADING_COMPLETED,_e,t),C.off(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Ee,t),C.off(c.Z.SET_NON_FRAGMENTED_TEXT,Te,t),C.off(c.Z.QUOTA_EXCEEDED,xe,t),C.off(c.Z.SOURCE_BUFFER_ERROR,me,t),C.off(c.Z.BYTES_APPENDED_END_FRAGMENT,be,t),se(),O=null,I=null}},n=(0,d.Z)(k).getInstance().getLogger(t),se(),C.on(c.Z.DATA_UPDATE_COMPLETED,pe,t,{priority:l.Z.EVENT_PRIORITY_HIGH}),C.on(c.Z.INIT_FRAGMENT_NEEDED,le,t),C.on(c.Z.MEDIA_FRAGMENT_NEEDED,ce,t),C.on(c.Z.INIT_FRAGMENT_LOADED,Ie,t),C.on(c.Z.MEDIA_FRAGMENT_LOADED,Oe,t),C.on(c.Z.BUFFER_LEVEL_STATE_CHANGED,fe,t),C.on(c.Z.BUFFER_CLEARED,ge,t),C.on(c.Z.SEEK_TARGET,De,t),C.on(c.Z.FRAGMENT_LOADING_ABANDONED,ve,t),C.on(c.Z.FRAGMENT_LOADING_COMPLETED,_e,t),C.on(c.Z.QUOTA_EXCEEDED,xe,t),C.on(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Ee,t),C.on(c.Z.SET_NON_FRAGMENTED_TEXT,Te,t),C.on(c.Z.SOURCE_BUFFER_ERROR,me,t),C.on(c.Z.BYTES_APPENDED_END_FRAGMENT,be,t),t}ie.__dashjs_factory_name="StreamProcessor";var re=u.Z.getClassFactory(ie),oe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},se=n(9032);function ae(e,t){if(e){if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ce(e){e=e||{};var t,n=this.context,i=e.requestModifier,r=e.lowLatencyThroughputModel,s=e.boxParser,a=(0,C.Z)(n).getInstance();function l(e){var n,l=new Date,d=e.request,h=new Headers;if(d.range&&h.append("Range","bytes="+d.range),e.headers)for(var p in e.headers){var f=e.headers[p];f&&h.append(p,f)}d.requestStartDate||(d.requestStartDate=l),i&&i.modifyRequestHeader&&i.modifyRequestHeader({setRequestHeader:function(e,t){h.append(e,t)}},{url:e.url}),"function"==typeof window.AbortController&&(n=new AbortController,e.abortController=n,n.signal.onabort=e.onabort);var g={method:e.method,headers:h,credentials:e.withCredentials?"include":void 0,signal:n?n.signal:void 0},m=a.get().streaming.abr.fetchThroughputCalculationMode,b=Date.now(),y=0;new Promise((function(e){if(m===o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&r&&(y=r.getThroughputCapacityDelayMS(d,1e3*t.getCurrentBufferLevel(d.mediaType))))return setTimeout(e,y);e()})).then((function(){var n=Date.now();fetch(e.url,g).then((function(i){e.response||(e.response={}),e.response.status=i.status,e.response.statusText=i.statusText,e.response.responseURL=i.url,i.ok||e.onerror();var a,l="",h=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=ae(e))){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(i.headers.keys());try{for(h.s();!(a=h.n()).done;){var p=a.value;l+=p+": "+i.headers.get(p)+"\r\n"}}catch(e){h.e(e)}finally{h.f()}if(e.response.responseHeaders=l,!i.body)return i.arrayBuffer().then((function(t){e.response.response=t;var n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()}));var f,g,v,_=parseInt(i.headers.get("Content-Length"),10),E=0,T=!1,x=new Uint8Array,w=0;if(m===o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&r){var k=n,S=0,C=function(e){if(Array.isArray(e))return e}(v=i.body.tee())||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),2!==n.length);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}(v)||ae(v,2)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),A=C[0],I=C[1];f=A.getReader(),g=[],f.read().then((function i(o){var s=o.value,a=o.done;if(S=Date.now(),s&&s.length){var c=S-k,u=s.length;g.push({chunkDownloadTimeRelativeMS:S-n,chunkDownloadDurationMS:c,chunkBytes:u,kbps:Math.round(8*u/(c/1e3)),bufferLevel:t.getCurrentBufferLevel(d.mediaType)})}if(a){var h=S-n,p=g.reduce((function(e,t){return e+t.chunkBytes}),0);return r.addMeasurement(d,h,g,b,y,l),void e.progress({loaded:p,total:p,lengthComputable:!0,time:r.getEstimatedDownloadDurationMS(d),stream:!0})}return k=Date.now(),f.read().then(i)})),e.reader=I.getReader()}else e.reader=i.body.getReader();var O=[],N=[],R=[],D=!0;c(e,(function t(n){var i=n.value;if(n.done){if(x){if(m!==o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var r=null,a=null;m===o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(r=function(e,t){try{var n,i;n=e.filter((function(t,n){return n<e.length-1})),i=t.filter((function(e,n){return n<t.length-1}));var r=[];if(n.length>1){for(var o=0,s=0,a=0;a<n.length;a++)if(n[a]&&i[a]){var l=i[a].ts-n[a].ts;if(l>1)r.push(8*i[a].bytes/l),s=0;else{0===s&&(s=n[a].ts,o=0);var c=i[a].ts-s;c>1?(o+=i[a].bytes,r.push(8*o/c),s=0):o+=i[a].bytes}}if(r.length>0)return r.reduce((function(e,t){return e+t}),0)/r.length}return null}catch(e){return null}}(N,R))&&(a=8*E/r):m===o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(a=u(O,E)),e.progress({loaded:E,total:isNaN(_)?E:_,lengthComputable:!0,time:a,stream:!0})}e.response.response=x.buffer}return e.onload(),void e.onend()}if(i&&i.length>0){x=function(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(x,i),E+=i.length,O.push({ts:Date.now(),bytes:i.length}),m===o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&D&&s.findLastTopIsoBoxCompleted(["moof"],x,w).found&&(D=!1,N.push({ts:performance.now(),bytes:i.length}));var l=s.findLastTopIsoBoxCompleted(["moov","mdat"],x,w);if(l.found){var d,h=l.lastCompletedOffset+l.size;m!==o.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||D||(D=!0,R.push({ts:performance.now(),bytes:x.length})),h===x.length?(d=x,x=new Uint8Array):(d=new Uint8Array(x.subarray(0,h)),x=x.subarray(h)),e.progress({data:d.buffer,lengthComputable:!1,noTrace:!0}),w=0}else w=l.lastCompletedOffset,T||(e.progress({lengthComputable:!1,noTrace:!0}),T=!0)}c(e,t)}))})).catch((function(t){e.onerror&&e.onerror(t)}))}))}function c(e,t){e.reader.read().then(t).catch((function(t){e.onerror&&200===e.response.status&&e.onerror(t)}))}function u(e,t){try{if((e=e.filter((function(n){return n.bytes>t/4/e.length}))).length>1){var n=0,i=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach((function(t,r){var o=e[r+1];if(o){var s=o.ts-t.ts;n+=s<i?s:0}})),n}return null}catch(e){return null}}return{load:function(e){i&&i.modifyRequest?(0,K.k)(e,i).then((function(){return l(e)})):l(e)},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:u,setup:function(e){t=e.dashMetrics}}}ce.__dashjs_factory_name="FetchLoader";var ue=u.Z.getClassFactory(ce),de=n(1180),he=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.frameRate=null}var t;return(t=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==s.Z.BASE_URL&&this.segmentInfoType!==s.Z.SEGMENT_BASE&&!this.indexRange}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),pe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},fe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};fe.DEFAULT_ID="defaultId";var ge=fe,me=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},be=n(2610),ye=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},ve=function e(t,n,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvbPriority=i||1,this.dvbWeight=r||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}};ve.DEFAULT_DVB_PRIORITY=1,ve.DEFAULT_DVB_WEIGHT=1;var _e=ve,Ee=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0},Te=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null},xe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0},we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri=null,this.value=null,this.id=null}var t;return(t=[{key:"init",value:function(e){return e&&(this.schemeIdUri=e.schemeIdUri?e.schemeIdUri:null,this.value=e.value?e.value:null,this.id=e.id?e.id:null,e[s.Z.DVB_URL]&&(this.dvbUrl=e[s.Z.DVB_URL]),e[s.Z.DVB_MIMETYPE]&&(this.dvbMimeType=e[s.Z.DVB_MIMETYPE]),e[s.Z.DVB_FONTFAMILY]&&(this.dvbFontFamily=e[s.Z.DVB_FONTFAMILY])),this}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),ke=n(3101),Se=n.n(ke);function Ce(){return{areEqual:function(e,t){return Se()(e,t)}}}Ce.__dashjs_factory_name="ObjectUtils";var Ae=u.Z.getSingletonFactory(Ce),Ie=n(7803),Oe=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||null,this.queryParams={}},Ne=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=n||null,this.ttl=i||NaN,this.queryParams={}};function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){Le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Pe(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Pe(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function je(){var e,t,n,i,r=this.context,a=(0,Z.Z)(r).getInstance(),l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function c(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var n=v(e.Representation_asArray[0]);if(n&&n.length>0&&Ie.Y.indexOf(n[0].schemeIdUri)>=0)return t===o.Z.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===o.Z.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var i=t===o.Z.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var r=e.Representation_asArray[0].codecs;if(i.test(r))return!0}if(e.hasOwnProperty(s.Z.MIME_TYPE))return i.test(e.mimeType);if(e.Representation_asArray)for(var a,l=0;l<e.Representation_asArray.length;l++)if((a=e.Representation_asArray[l]).hasOwnProperty(s.Z.MIME_TYPE))return i.test(a.mimeType);return!1}function u(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)||e.hasOwnProperty(s.Z.SEGMENT_TIMELINE)||e.hasOwnProperty(s.Z.SEGMENT_LIST)||e.hasOwnProperty(s.Z.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)||t.hasOwnProperty(s.Z.SEGMENT_TIMELINE)||t.hasOwnProperty(s.Z.SEGMENT_LIST)||t.hasOwnProperty(s.Z.SEGMENT_BASE))return!0}return!1}function h(e){return c(e,o.Z.VIDEO)}function p(e){return c(e,o.Z.TEXT)}function f(e){return c(e,o.Z.IMAGE)}function g(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort((function(e,t){return e.bandwidth-t.bandwidth})),e}function m(e,t){return e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function b(e){return e&&e.Period_asArray?e.Period_asArray:[]}function y(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===s.Z.DYNAMIC),t}function v(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}})):null}function _(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],n=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:n.t-t.t}function E(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=ge.DEFAULT_ID+"_"+t;return e.hasOwnProperty(s.Z.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function x(e,t,n){var i,r=[];if(!e)return r;for(i=0;i<e.length;i++){var a=new Ee;if(a.timescale=1,a.representation=t,!e[i].hasOwnProperty(o.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");a.schemeIdUri=e[i].schemeIdUri,e[i].hasOwnProperty(s.Z.TIMESCALE)&&(a.timescale=e[i].timescale),e[i].hasOwnProperty(s.Z.VALUE)&&(a.value=e[i].value),r.push(a),a.period=n}return r}function w(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],i=!1;return n.some((function(n){if(n){var r=new _e,o=n.__text||n;return a.isRelative(o)&&(i=!0,e.baseUri&&(o=a.resolve(o,e.baseUri))),r.url=o,n.hasOwnProperty(s.Z.SERVICE_LOCATION)&&n.serviceLocation.length?r.serviceLocation=n.serviceLocation:r.serviceLocation=o,n.hasOwnProperty(s.Z.DVB_PRIORITY)&&(r.dvbPriority=n[s.Z.DVB_PRIORITY]),n.hasOwnProperty(s.Z.DVB_WEIGHT)&&(r.dvbWeight=n[s.Z.DVB_WEIGHT]),n.hasOwnProperty(s.Z.AVAILABILITY_TIME_OFFSET)&&(r.availabilityTimeOffset=n[s.Z.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(s.Z.AVAILABILITY_TIME_COMPLETE)&&(r.availabilityTimeComplete="false"!==n[s.Z.AVAILABILITY_TIME_COMPLETE]),t.push(r),i}})),t}function k(e){var t=new xe;return t.serverUrl=e.__text,e.hasOwnProperty(s.Z.DEFAULT_SERVICE_LOCATION)&&(t.defaultServiceLocation=e[s.Z.DEFAULT_SERVICE_LOCATION],t.defaultServiceLocationArray=t.defaultServiceLocation.split(" ")),e.hasOwnProperty(s.Z.QUERY_BEFORE_START)&&(t.queryBeforeStart="true"===e[s.Z.QUERY_BEFORE_START].toLowerCase()),e.hasOwnProperty(s.Z.CLIENT_REQUIREMENT)&&(t.clientRequirement="false"!==e[s.Z.CLIENT_REQUIREMENT].toLowerCase()),t}return e={getIsTypeOf:c,getIsText:p,getIsFragmented:u,getProducerReferenceTimesForAdaptation:function(e){var t=e&&e.hasOwnProperty(s.Z.PRODUCERREFERENCETIME_ASARRAY)?e[s.Z.PRODUCERREFERENCETIME_ASARRAY]:[];(e&&e.hasOwnProperty(s.Z.REPRESENTATION_ASARRAY)?e[s.Z.REPRESENTATION_ASARRAY]:[]).forEach((function(e){var n;e.hasOwnProperty(s.Z.PRODUCERREFERENCETIME_ASARRAY)&&t.push.apply(t,function(e){if(Array.isArray(e))return Be(e)}(n=e[s.Z.PRODUCERREFERENCETIME_ASARRAY])||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||Pe(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}));var n=[];return t.forEach((function(e){var t=new Te;e.hasOwnProperty(s.Z.ID)&&(t[s.Z.ID]=e[s.Z.ID],e.hasOwnProperty(s.Z.WALL_CLOCK_TIME)&&(t[s.Z.WALL_CLOCK_TIME]=e[s.Z.WALL_CLOCK_TIME],e.hasOwnProperty(s.Z.PRESENTATION_TIME)&&(t[s.Z.PRESENTATION_TIME]=e[s.Z.PRESENTATION_TIME],e.hasOwnProperty(s.Z.INBAND)&&(t[s.Z.INBAND]="false"!==e[s.Z.INBAND]),e.hasOwnProperty(s.Z.TYPE)&&(t[s.Z.TYPE]=e[s.Z.TYPE]),n.push(t))))})),n},getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(s.Z.LANG)&&(t=e.lang),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.VIEWPOINT_ASARRAY)&&e[s.Z.VIEWPOINT_ASARRAY].length?e[s.Z.VIEWPOINT_ASARRAY].map((function(e){return(new we).init(e)})):[]},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ROLE_ASARRAY)&&e[s.Z.ROLE_ASARRAY].length?e[s.Z.ROLE_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ACCESSIBILITY_ASARRAY)&&e[s.Z.ACCESSIBILITY_ASARRAY].length?e[s.Z.ACCESSIBILITY_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map((function(e){return(new we).init(e)})):[]},getAdaptationForIndex:function(e,t,n){var i=m(t,n);return i.length>0&&l(e)?i[e]:null},getIndexForAdaptation:function(e,t,n){if(!e)return-1;for(var i=m(t,n),o=0;o<i.length;o++)if(Ae(r).getInstance().areEqual(i[o],e))return o;return-1},getAdaptationForId:function(e,t,n){var i,r,o=m(t,n);for(i=0,r=o.length;i<r;i++)if(o[i].hasOwnProperty(s.Z.ID)&&o[i].id===e)return o[i];return null},getAdaptationsForType:function(e,t,n){var i,r,o=m(e,t),s=[];for(i=0,r=o.length;i<r;i++)c(o[i],n)&&s.push(g(o[i]));return s},getRealPeriods:b,getRealPeriodForIndex:function(e,t){var n=b(t);return n.length>0&&l(e)?n[e]:null},getCodec:function(e,t,n){var i=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var r=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];r&&(i=r.mimeType+';codecs="'+r.codecs+'"',n&&void 0!==r.width&&(i+=';width="'+r.width+'";height="'+r.height+'"'))}return i&&(i=i.replace(/\sprofiles=[^;]*/g,"")),i},getSelectionPriority:function(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(e){return 1}},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(s.Z.CENC_DEFAULT_KID)?e[s.Z.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(s.Z.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:y,getId:function(e){return e&&e[s.Z.ID]||null},hasProfile:function(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n},getDuration:function(e){return e&&e.hasOwnProperty(s.Z.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN;return e&&e.hasOwnProperty(s.Z.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.PUBLISH_TIME)?new Date(e[s.Z.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=g(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map((function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}}))},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,n,i,r,o=[],a=function(e){if(e&&e.period&&l(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return g(t.AdaptationSet_asArray[e.index])}}(e);if(a&&a.Representation_asArray){if(e&&e.period&&l(e.period.index)){var c=w(e.period.mpd.manifest);c&&(n=c[0])}for(var d=0,h=a.Representation_asArray.length;d<h;++d){var f=a.Representation_asArray[d],m=new he;if(m.index=d,m.adaptation=e,f.hasOwnProperty(s.Z.ID)&&(m.id=f.id),f.hasOwnProperty(s.Z.CODECS)&&(m.codecs=f.codecs),f.hasOwnProperty(s.Z.MIME_TYPE)&&(m.mimeType=f[s.Z.MIME_TYPE]),f.hasOwnProperty(s.Z.CODEC_PRIVATE_DATA)&&(m.codecPrivateData=f.codecPrivateData),f.hasOwnProperty(s.Z.BANDWITH)&&(m.bandwidth=f.bandwidth),f.hasOwnProperty(s.Z.WIDTH)&&(m.width=f.width),f.hasOwnProperty(s.Z.HEIGHT)&&(m.height=f.height),f.hasOwnProperty(s.Z.SCAN_TYPE)&&(m.scanType=f.scanType),f.hasOwnProperty(s.Z.MAX_PLAYOUT_RATE)&&(m.maxPlayoutRate=f.maxPlayoutRate),f.hasOwnProperty(s.Z.SEGMENT_BASE)?(t=f.SegmentBase,m.segmentInfoType=s.Z.SEGMENT_BASE):f.hasOwnProperty(s.Z.SEGMENT_LIST)?(t=f.SegmentList).hasOwnProperty(s.Z.SEGMENT_TIMELINE)?m.segmentInfoType=s.Z.SEGMENT_TIMELINE:m.segmentInfoType=s.Z.SEGMENT_LIST:f.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)?((t=f.SegmentTemplate).hasOwnProperty(s.Z.SEGMENT_TIMELINE)?m.segmentInfoType=s.Z.SEGMENT_TIMELINE:m.segmentInfoType=s.Z.SEGMENT_TEMPLATE,t.hasOwnProperty(s.Z.INITIALIZATION_MINUS)&&(m.initialization=t.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):m.segmentInfoType=s.Z.BASE_URL,m.essentialProperties=v(f),t){if(t.hasOwnProperty(s.Z.INITIALIZATION)){var b=t.Initialization;b.hasOwnProperty(s.Z.SOURCE_URL)&&(m.initialization=b.sourceURL),b.hasOwnProperty(s.Z.RANGE)&&(m.range=b.range)}else p(a)&&u(a)&&a.mimeType&&-1===a.mimeType.indexOf("application/mp4")&&(m.range=0);t.hasOwnProperty(s.Z.TIMESCALE)&&(m.timescale=t.timescale),t.hasOwnProperty(s.Z.DURATION)?m.segmentDuration=t.duration/m.timescale:f.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)&&(t=f.SegmentTemplate).hasOwnProperty(s.Z.SEGMENT_TIMELINE)&&(m.segmentDuration=_(t.SegmentTimeline)/m.timescale),t.hasOwnProperty(s.Z.MEDIA)&&(m.media=t.media),t.hasOwnProperty(s.Z.START_NUMBER)&&(m.startNumber=t.startNumber),t.hasOwnProperty(s.Z.INDEX_RANGE)&&(m.indexRange=t.indexRange),t.hasOwnProperty(s.Z.PRESENTATION_TIME_OFFSET)&&(m.presentationTimeOffset=t.presentationTimeOffset/m.timescale),t.hasOwnProperty(s.Z.AVAILABILITY_TIME_OFFSET)?m.availabilityTimeOffset=t.availabilityTimeOffset:n&&void 0!==n.availabilityTimeOffset&&(m.availabilityTimeOffset=n.availabilityTimeOffset),t.hasOwnProperty(s.Z.AVAILABILITY_TIME_COMPLETE)?m.availabilityTimeComplete="false"!==t.availabilityTimeComplete:n&&void 0!==n.availabilityTimeComplete&&(m.availabilityTimeComplete=n.availabilityTimeComplete)}m.MSETimeOffset=(r=(i=m).presentationTimeOffset,i.adaptation.period.start-r),m.path=[e.period.index,e.index,d],o.push(m)}}return o},getAdaptationsForPeriod:function(e){var n,i,r,a=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,u=[];if(a&&a.AdaptationSet_asArray)for(r=0;r<a.AdaptationSet_asArray.length;r++)i=a.AdaptationSet_asArray[r],n=new pe,i.hasOwnProperty(s.Z.ID)&&(n.id=i.id),n.index=r,n.period=e,c(i,o.Z.MUXED)?n.type=o.Z.MUXED:c(i,o.Z.AUDIO)?n.type=o.Z.AUDIO:h(i)?n.type=o.Z.VIDEO:p(i)?n.type=o.Z.TEXT:f(i)?n.type=o.Z.IMAGE:t.warn("Unknown Adaptation stream type"),u.push(n);return u},getRegularPeriods:function(e){var i,r,a=!!e&&y(e.manifest),l=[],c=null,u=null,d=null,h=null;for(r=0,i=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;r<i;r++)(u=e.manifest.Period_asArray[r]).hasOwnProperty(s.Z.START)?(h=new ge).start=u.start:null!==c&&c.hasOwnProperty(s.Z.DURATION)&&null!==d?(h=new ge).start=parseFloat((d.start+d.duration).toFixed(5)):0!==r||a||((h=new ge).start=0),null!==d&&isNaN(d.duration)&&(null!==h?d.duration=parseFloat((h.start-d.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==h&&(h.id=E(u,r),h.index=r,h.mpd=e,u.hasOwnProperty(s.Z.DURATION)&&(h.duration=u.duration),d&&(d.nextPeriodId=h.id),l.push(h),c=u,d=h),u=null,h=null;return 0===l.length||null!==d&&isNaN(d.duration)&&(d.duration=parseFloat((function(e){!function(){if(!n||!n.hasOwnProperty("error"))throw new Error(o.Z.MISSING_CONFIG_ERROR)}();var t,i=y(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:i?t=Number.POSITIVE_INFINITY:n.error(new T.Z(S.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}(d)-d.start).toFixed(5))),l},getMpd:function(e){var t=new me;return e&&(t.manifest=e,e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(s.Z.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(s.Z.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(s.Z.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(s.Z.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(s.Z.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(s.Z.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(s.Z.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t,n,r=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,a=r?r.Period_asArray:null,c=a&&e&&l(e.index)?a[e.index].EventStream_asArray:null,u=[];if(c)for(t=0;t<c.length;t++){var d=new Ee;if(d.period=e,d.timescale=1,!c[t].hasOwnProperty(o.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(d.schemeIdUri=c[t][o.Z.SCHEME_ID_URI],c[t].hasOwnProperty(s.Z.TIMESCALE)&&(d.timescale=c[t][s.Z.TIMESCALE]),c[t].hasOwnProperty(s.Z.VALUE)&&(d.value=c[t][s.Z.VALUE]),c[t].hasOwnProperty(s.Z.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=c[t][s.Z.PRESENTATION_TIME_OFFSET]),n=0;c[t].Event_asArray&&n<c[t].Event_asArray.length;n++){var h=c[t].Event_asArray[n],p=new ye;p.presentationTime=0,p.eventStream=d,h.hasOwnProperty(s.Z.PRESENTATION_TIME)&&(p.presentationTime=h.presentationTime);var f=d.presentationTimeOffset?d.presentationTimeOffset/d.timescale:0;p.calculatedPresentationTime=p.presentationTime/d.timescale+e.start-f,h.hasOwnProperty(s.Z.DURATION)&&(p.duration=h.duration/d.timescale),h.hasOwnProperty(s.Z.ID)?p.id=h.id:p.id=null,h.Signal&&h.Signal.Binary?p.messageData=i.decodeArray(h.Signal.Binary.toString()):p.messageData=h.messageData||h.__cdata||h.__text,u.push(p)}}return u},getEssentialPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.ESSENTIAL_PROPERTY_ASARRAY)){var n,i=Me(e.EssentialProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(o.Z.SCHEME_ID_URI)&&(t[r[o.Z.SCHEME_ID_URI]]=De({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getEssentialPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ESSENTIAL_PROPERTY_ASARRAY)&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((function(e){return(new we).init(e)})):[]},getEssentialPropertiesForRepresentation:v,getEventStreamForAdaptationSet:function(e,t,n){var i,r,o;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(r=e.Period_asArray[t.period.index])&&r.AdaptationSet_asArray&&l(t.index)&&(o=r.AdaptationSet_asArray[t.index])&&(i=o.InbandEventStream_asArray),x(i,null,n)},getEventStreamForRepresentation:function(e,t,n){var i,r,o,s;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index])&&r.AdaptationSet_asArray&&l(t.adaptation.index)&&(o=r.AdaptationSet_asArray[t.adaptation.index])&&o.Representation_asArray&&l(t.index)&&(s=o.Representation_asArray[t.index])&&(i=s.InbandEventStream_asArray),x(i,t,n)},getUTCTimingSources:function(e){var t=y(e),n=!!e&&e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME),i=e?e.UTCTiming_asArray:null,r=[];return(t||n)&&i&&i.forEach((function(e){var t=new be.Z;e.hasOwnProperty(o.Z.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(s.Z.VALUE)&&(t.value=e.value.toString(),r.push(t)))})),r},getBaseURLsFromElement:w,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getContentSteering:function(e){if(e&&e.hasOwnProperty(s.Z.CONTENT_STEERING_AS_ARRAY))return k(e[s.Z.CONTENT_STEERING_AS_ARRAY][0])},getLocation:function(e){return e&&e.hasOwnProperty(s.Z.LOCATION_AS_ARRAY)?e[s.Z.LOCATION_AS_ARRAY].map((function(e){var t=e.__text||e,n=e.hasOwnProperty(s.Z.SERVICE_LOCATION)?e[s.Z.SERVICE_LOCATION]:null;return new Oe(t,n)})):[]},getPatchLocation:function(e){return e&&e.hasOwnProperty(s.Z.PATCH_LOCATION_AS_ARRAY)?e[s.Z.PATCH_LOCATION_AS_ARRAY].map((function(e){var t=e.__text||e,n=e.hasOwnProperty(s.Z.SERVICE_LOCATION)?e[s.Z.SERVICE_LOCATION]:null,i=e.hasOwnProperty(s.Z.TTL)?1e3*parseFloat(e[s.Z.TTL]):NaN;return new Ne(t,n,i)})):[]},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(s.Z.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(s.Z.SERVICE_DESCRIPTION)){var n,i=Me(e.ServiceDescription_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=null,a=null,l=null,c=null,u=null,d=null,h=null;for(var p in r)r.hasOwnProperty(p)&&(p===s.Z.ID?o=r[p]:p===s.Z.SERVICE_DESCRIPTION_SCOPE?a=r[p].schemeIdUri:p===s.Z.SERVICE_DESCRIPTION_LATENCY?l={target:parseInt(r[p].target),max:parseInt(r[p].max),min:parseInt(r[p].min),referenceId:parseInt(r[p].referenceId)}:p===s.Z.SERVICE_DESCRIPTION_PLAYBACK_RATE?c={max:parseFloat(r[p].max),min:parseFloat(r[p].min)}:p===s.Z.SERVICE_DESCRIPTION_OPERATING_QUALITY?u={mediaType:r[p].mediaType,max:parseInt(r[p].max),min:parseInt(r[p].min),target:parseInt(r[p].target),type:r[p].type,maxQualityDifference:parseInt(r[p].maxQualityDifference)}:p===s.Z.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH?d={mediaType:r[p].mediaType,max:parseInt(r[p].max),min:parseInt(r[p].min),target:parseInt(r[p].target)}:p===s.Z.CONTENT_STEERING&&(h=k(r[p])));t.push({id:o,schemeIdUri:a,latency:l,playbackRate:c,operatingQuality:u,operatingBandwidth:d,contentSteering:h})}}catch(e){i.e(e)}finally{i.f()}}return t},getSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(s.Z.SEGMENT_ALIGNMENT))&&"true"===e[s.Z.SEGMENT_ALIGNMENT]},getSubSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(s.Z.SUB_SEGMENT_ALIGNMENT))&&"true"===e[s.Z.SUB_SEGMENT_ALIGNMENT]},getSupplementalPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var n,i=Me(e.SupplementalProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(o.Z.SCHEME_ID_URI)&&(t[r[o.Z.SCHEME_ID_URI]]=De({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getSupplementalPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map((function(e){return(new we).init(e)})):[]},getSupplementalPropertiesForRepresentation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var n,i=Me(e.SupplementalProperty_asArray);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.hasOwnProperty(o.Z.SCHEME_ID_URI)&&(t[r[o.Z.SCHEME_ID_URI]]=De({},r))}}catch(e){i.e(e)}finally{i.f()}}return t},getSupplementalPropertiesAsArrayForRepresentation:function(e){return e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map((function(e){return(new we).init(e)})):[]},setConfig:function(e){e&&(e.errHandler&&(n=e.errHandler),e.BASE64&&(i=e.BASE64))}},t=(0,d.Z)(r).getInstance().getLogger(e),e}je.__dashjs_factory_name="DashManifestModel";var Fe=u.Z.getSingletonFactory(je),$e=n(703);function Ue(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Ge(){var e,t,n,i,r,s,a,c,u,d,p=this.context,f=(0,l.Z)(p).getInstance(),g=(0,C.Z)(p).getInstance();function m(){n={pr:1,nor:null,st:null,sf:null,sid:"".concat($e.Z.generateUuid()),cid:null},u={},c={},d={},y()}function b(){y()}function y(){if(s){var e=s.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(a=t.getProcessors())}}}function v(e,t){var n,i={},r=Ue(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;e[o]&&(i[o]=e[o])}}catch(e){r.e(e)}finally{r.f()}return i}function _(e){var t=g.get().streaming.cmcd.enabledKeys;return e.filter((function(e){return t.includes(e)}))}function E(e){try{return e.type===A.w.MPD_TYPE?((l=T()).ot="m",l):e.type===A.w.MEDIA_SEGMENT_TYPE?(t=e.mediaType,d.hasOwnProperty(t)||(d[t]=!1),c.hasOwnProperty(t)||(c[t]=!1),u.hasOwnProperty(t)||(u[t]=!1),function(e){var t,l=T(),h=function(e){try{var t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}(e),p=function(e){try{return isNaN(e.duration)?NaN:Math.round(1e3*e.duration)}catch(e){return null}}(e),f=function(e){try{return 100*parseInt(i.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),m=function(e){try{var t=n.pr,i=r.getCurrentBufferLevel(e);return isNaN(t)||isNaN(i)?null:100*parseInt(i/t*10)}catch(e){return null}}(e.mediaType),b=x(e.mediaType),y=function(e){try{var t=i.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),v=n.pr,_=function(e){if(a&&0!==a.length){var t,n=Ue(a);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.getType()===e)return i.probeNextRequest()}}catch(e){n.e(e)}finally{n.f()}}}(e.mediaType);e.mediaType===o.Z.VIDEO&&(t="v"),e.mediaType===o.Z.AUDIO&&(t="a"),e.mediaType===o.Z.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?"tt":"c");var E=g.get().streaming.cmcd.rtp;return E||(E=function(e){try{var t=s.getPlaybackRate();t||(t=1);var n=e.quality,i=e.mediaType,r=e.mediaInfo,o=e.duration;if(!r)return NaN;var a=x(i);0===a&&(a=500);var l=r.bitrateList[n].bandwidth*o/1e3/(a/t/1e3),c=g.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(g.get().streaming.cmcd.rtpSafetyFactor)?g.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(l*c/100)+1)}catch(e){return NaN}}(e)),isNaN(E)||(l.rtp=E),_&&(e.url!==_.url?l.nor=encodeURIComponent($e.Z.getRelativeUrl(e.url,_.url)):_.range&&(l.nrr=_.range)),h&&(l.br=h),t&&(l.ot=t),isNaN(p)||(l.d=p),isNaN(f)||(l.mtp=f),isNaN(m)||(l.dl=m),isNaN(b)||(l.bl=b),isNaN(y)||(l.tb=y),isNaN(v)||1===v||(l.pr=v),u[e.mediaType]&&(l.bs=!0,u[e.mediaType]=!1),!c[e.mediaType]&&d[e.mediaType]||(l.su=!0,c[e.mediaType]=!1,d[e.mediaType]=!0),l}(e)):e.type===A.w.INIT_SEGMENT_TYPE?function(){var e=T();return e.ot="i",e.su=!0,e}():e.type===A.w.OTHER_TYPE||e.type===A.w.XLINK_EXPANSION_TYPE?function(){var e=T();return e.ot="o",e}():e.type===A.w.LICENSE?function(e){var t=T();return t.ot="k",t}():null}catch(e){return null}var t,l}function T(){var e={},t=g.get().streaming.cmcd.cid?g.get().streaming.cmcd.cid:n.cid;return e.v=1,e.sid=g.get().streaming.cmcd.sid?g.get().streaming.cmcd.sid:n.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(n.pr)||1===n.pr||null===n.pr||(e.pr=n.pr),n.st&&(e.st=n.st),n.sf&&(e.sf=n.sf),e}function x(e){try{var t=r.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function w(e){try{n.pr=e.playbackRate}catch(e){}}function k(t){try{var i=e.getIsDynamic(t.data)?"l":"v",r=t.protocol&&"MSS"===t.protocol?"s":"d";n.st="".concat(i),n.sf="".concat(r)}catch(e){}}function S(e){try{e.state&&e.mediaType&&e.state===h.Z.BUFFER_EMPTY&&(u[e.mediaType]||(u[e.mediaType]=!0),c[e.mediaType]||(c[e.mediaType]=!0))}catch(e){}}function I(){for(var e in u)u.hasOwnProperty(e)&&(u[e]=!0);for(var t in c)c.hasOwnProperty(t)&&(c[t]=!0)}function O(e){try{if(!e)return null;var t=Object.keys(e).sort((function(e,t){return e.localeCompare(t)})),n=t.length,i=t.reduce((function(t,i,r){return"v"===i&&1===e[i]||("string"==typeof e[i]&&"ot"!==i&&"sf"!==i&&"st"!==i?t+="".concat(i,"=").concat(JSON.stringify(e[i])):t+="".concat(i,"=").concat(e[i]),r<n-1&&(t+=",")),t}),"");return(i=i.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(e){return null}}return t={getQueryParameter:function(e){try{if(g.get().streaming.cmcd&&g.get().streaming.cmcd.enabled){var t=E(e),n=O(function(e){try{var t=g.get().streaming.cmcd.enabledKeys;return Object.keys(e).filter((function(e){return t.includes(e)})).reduce((function(t,n){return t[n]=e[n],t}),{})}catch(t){return e}}(t));return f.trigger(de.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(g.get().streaming.cmcd&&g.get().streaming.cmcd.enabled){var t=E(e),n=v(t,_(["br","d","ot","tb"])),i=v(t,_(["bl","dl","mtp","nor","nrr","su"])),r=v(t,_(["bs","rtp"])),o=v(t,_(["cid","pr","sf","sid","st","v"])),s={"CMCD-Object":O(n),"CMCD-Request":O(i),"CMCD-Status":O(r),"CMCD-Session":O(o)};return f.trigger(de.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:s}),s}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(i=e.abrController),e.dashMetrics&&(r=e.dashMetrics),e.playbackController&&(s=e.playbackController))},reset:function(){f.off(h.Z.PLAYBACK_RATE_CHANGED,w,this),f.off(h.Z.MANIFEST_LOADED,k,this),f.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,S,t),f.off(h.Z.PLAYBACK_SEEKED,I,t),m()},initialize:function(){f.on(h.Z.PLAYBACK_RATE_CHANGED,w,t),f.on(h.Z.MANIFEST_LOADED,k,t),f.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,S,t),f.on(h.Z.PLAYBACK_SEEKED,I,t),f.on(h.Z.PERIOD_SWITCH_COMPLETED,b,t)}},e=Fe(p).getInstance(),m(),t}Ge.__dashjs_factory_name="CmcdModel";var Ve=u.Z.getSingletonFactory(Ge);function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){ze=function(e,t){return new o(e,void 0,t)};var n=qe(RegExp),i=RegExp.prototype,r=new WeakMap;function o(e,t,i){var o=n.call(this,e,t);return r.set(o,i||r.get(e)),o}function s(e,t){var n=r.get(t);return Object.keys(n).reduce((function(t,i){return t[i]=e[n[i]],t}),Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(o,n),o.prototype.exec=function(e){var t=i.exec.call(this,e);return t&&(t.groups=s(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=r.get(this);return i[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var o=this;return i[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==We(e[e.length-1])&&e.push(s(e,o)),t.apply(this,e)}))}return i[Symbol.replace].call(this,e,t)},ze.apply(this,arguments)}function qe(e){var t="function"==typeof Map?new Map:void 0;return(qe=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Ye(e,arguments,Ze(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Ke(i,e)})(e)}function Ye(e,t,n){return(Ye=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&Ke(r,n.prototype),r}).apply(null,arguments)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Xe="static",Je="dynamic",Qe="stream",et=["mb","st","sf","v"],tt={video:"v",audio:"a",text:"tt",stream:Qe},nt=/^[-0-9]/;function it(){var e,t,n,i,r=this.context,o=(0,l.Z)(r).getInstance();function s(){n={},i={}}function a(e){e&&Object.keys(e).forEach((function(t){et.includes(t)||delete e[t]}))}function u(e){return!e||"false"!==e.toLowerCase()&&(nt.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}function h(e){try{for(var n={},i=e.split(","),r=0;r<i.length;r++){var o=i[r].split("="),s=o[0],a=u(o[1]);n[s]=a}return n}catch(e){t.error("Failed to parse CMSD-Static response header value:",e)}}function p(e){try{for(var n={},i=e.split(","),r=i[i.length-1].split(";"),o=1;o<r.length;o++){var s=r[o].split("="),a=s[0],l=u(s[1]);n[a]=l}return n}catch(e){return t.error("Failed to parse CMSD-Dynamic response header value:",e),[]}}function f(e){return tt[e]||"o"}function g(e,t,r){var o=e===Xe?n:i,s=o[t]||{},a=o[Qe]||{};return s[r]||a[r]}return e={setConfig:function(){},initialize:function(){},reset:function(){s()},parseResponseHeaders:function(e,t){for(var r=null,s=null,l=e.split("\r\n"),u=l.length-1;u>=0;u--){var d=l[u].match(ze(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(d&&d.groups){var g=d.groups.key.toLowerCase(),m=d.groups.value;switch(g){case"cmsd-static":r=h(m),o.trigger(c.Z.CMSD_STATIC_HEADER,r);break;case"cmsd-dynamic":s||(s=p(m))}}}var b=Qe;return r&&r.ot?b=r.ot:t&&(b=f(t)),a(n[b]),a(i[b]),r&&(n[b]=Object.assign(n[b]||{},r)),s&&(i[b]=Object.assign(i[b]||{},s)),{static:r,dynamic:s}},getMaxBitrate:function(e){var t=f(e);return g(Je,t,"mb")||-1},getEstimatedThroughput:function(e){var t=f(e);return g(Je,t,"etp")||null},getResponseDelay:function(e){var t=f(e);return g(Je,t,"rd")||null},getRoundTripTime:function(e){var t=f(e);return g(Je,t,"rtt")||null}},t=(0,d.Z)(r).getInstance().getLogger(e),s(),e}it.__dashjs_factory_name="CmsdModel";var rt=u.Z.getSingletonFactory(it);function ot(){var e,t,n=this.context,i={};function r(){t=(0,d.Z)(n).getInstance().getLogger(e)}function o(e){for(var t={},n=0,i=0,r=0,o=0,s=e.length,a=0;a<s;++a)n+=e[a].chunkDownloadTimeRelativeMS,i+=e[a].bufferLevel,r+=e[a].chunkDownloadTimeRelativeMS*e[a].bufferLevel,o+=e[a].chunkDownloadTimeRelativeMS*e[a].chunkDownloadTimeRelativeMS;return t.m=(r-n*i/s)/(o-n*n/s),t.b=i/s-t.m*n/s,function(e){return t.m*e+t.b}}function s(e){var t,n=!0,i=e.reduce((function(e,t){return e+t.bufferLevelAtSegmentEnd}),0)/e.length;return e.forEach((function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(n=!1),e.bufferLevelAtSegmentEnd/i<.8&&(n=!1),t?t>e.bitrate&&(n=!1):t=e.bitrate})),n}return e={setup:r,addMeasurement:function(e,t,n,r,s){e&&e.mediaType&&!i[e.mediaType]&&(i[e.mediaType]=[]);var a=e.mediaInfo.bitrateList.find((function(t){return t.id===e.representationId}));i[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:r,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:n.reduce((function(e,t){return e+t.chunkDownloadDurationMS}),0),segmentBytes:n.reduce((function(e,t){return e+t.chunkBytes}),0),bitrate:a&&a.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:n,fetchDownloadDurationMS:t,throughputCapacityDelayMS:s,getEstimatedBufferLevel:o(n.slice(1))}),i[e.mediaType].length>10&&i[e.mediaType].shift()},getThroughputCapacityDelayMS:function(e,t){var n=i[e.mediaType]&&i[e.mediaType].slice(-3);return!n||n.length<3?0:s(n)?t/4>250?250:t/4:0},getEstimatedDownloadDurationMS:function(e){var n=i[e.mediaType].slice(-1).pop(),r=i[e.mediaType].slice(-3),o=n.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;n.bufferLevelAtSegmentStart=n.getEstimatedBufferLevel(o/2),n.bufferLevelAtSegmentEnd=n.getEstimatedBufferLevel(o);var a=s(r),l=a?.6:.8;if(n.isBufferStable&&1.05*n.segDurationMS<n.fetchDownloadDurationMS)return n.fetchDownloadDurationMS;if(!a||n.segDurationMS<n.fetchDownloadDurationMS)return.8*n.fetchDownloadDurationMS;if(n.adjustedAvailabilityStartTimeMS<=n.requestTimeMS+n.throughputCapacityDelayMS-n.segDurationMS)return.8*n.fetchDownloadDurationMS;for(var c=n.requestTimeMS+n.throughputCapacityDelayMS-n.adjustedAvailabilityStartTimeMS,u=0,d=0,h=0,p=0;p<n.chunkMeasurements.length;p++){var f=n.chunkMeasurements[p];if(c<d+f.chunkDownloadDurationMS)break;d+=f.chunkDownloadDurationMS,u+=f.chunkBytes,h++}if(c<0&&t.warn("request time was before adjusted availibitly start time"),u&&d&&h>.2*n.chunkMeasurements.length){var g=u/d,m=n.segmentBytes/g;return n.fetchDownloadDurationMS<m?n.fetchDownloadDurationMS*l:m*l}var b=n.bitrate;return n.bitrateList.some((function(e){if(e.bandwidth>n.bitrate)return b=e.bandwidth,!0})),b===n.bitrate?n.fetchDownloadDurationMS*l:l*n.segmentBytes*8*1e3/b}},r(),e}ot.__dashjs_factory_name="LowLatencyThroughputModel";var st=u.Z.getSingletonFactory(ot),at=n(5717);function lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ct(e){e=e||{};var t,n,i,r,s,a,u,h,p,f,g,m=this.context,b=e.errHandler,y=e.dashMetrics,v=e.mediaPlayerModel,_=e.requestModifier,E=e.boxParser,x=e.errors,w=e.requestTimeout||0,k=(0,l.Z)(m).getInstance(),S=(0,C.Z)(m).getInstance();return t={load:function(e){e.request?function e(t,l){var d,g=t.request,x=[],C=!0,I=!0,O=new Date,N=O,R=0,D=null,L=null;if(!_||!y||!b)throw new Error("config object is not correct or missing");var M,P=function(e){g.requestStartDate=O,g.requestEndDate=new Date,g.firstByteDate=g.firstByteDate||O,g.fileLoaderType=L;var t=d.response?d.response.responseURL:null,n=d.response?d.response.status:null,i=d.response&&d.response.getAllResponseHeaders?d.response.getAllResponseHeaders():d.response?d.response.responseHeaders:null,r=i&&S.get().streaming.cmsd&&S.get().streaming.cmsd.enabled?u.parseResponseHeaders(i,g.mediaType):null;y.addHttpRequest(g,t,n,i,e?x:null,r)},B=function(e){I=!1,P(e),g.type===A.w.MPD_TYPE&&(y.addManifestUpdate(g),k.trigger(c.Z.MANIFEST_LOADING_FINISHED,{request:g}))},j=function(){if(D&&(clearTimeout(D),D=null),-1!==n.indexOf(d)&&(n.splice(n.indexOf(d),1),I))if(B(!1),l>0){try{S.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&g.type===A.w.MEDIA_SEGMENT_TYPE&&v.getRetryAttemptsForType(A.w.MEDIA_SEGMENT_TYPE)===l&&k.trigger(c.Z.ATTEMPT_BACKGROUND_SYNC)}catch(e){}l--;var i={config:t};r.push(i),i.timeout=setTimeout((function(){-1!==r.indexOf(i)&&(r.splice(r.indexOf(i),1),e(t,l))}),v.getRetryIntervalsForType(g.type))}else{if(g.type===A.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;b.error(new T.Z(s[g.type],g.url+" is not available",{request:g,response:d.response})),t.error&&t.error(g,"error",d.response.statusText,d.response),t.complete&&t.complete(g,d.response.statusText)}};g.hasOwnProperty("availabilityTimeComplete")&&!1===g.availabilityTimeComplete&&window.fetch&&"arraybuffer"===g.responseType&&g.type===A.w.MEDIA_SEGMENT_TYPE?((M=ue(m).create({requestModifier:_,lowLatencyThroughputModel:p,boxParser:E})).setup({dashMetrics:y}),L=o.Z.FILE_LOADER_TYPES.FETCH):(M=(0,se.Z)(m).create({requestModifier:_}),L=o.Z.FILE_LOADER_TYPES.XHR);var F=null,$=_.modifyRequestURL?_.modifyRequestURL(g.url):g.url;if(S.get().streaming.cmcd&&S.get().streaming.cmcd.enabled){var U=S.get().streaming.cmcd.mode;if(U===o.Z.CMCD_MODE_QUERY){var H=function(e){try{var t=[],n=a.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}(g);$=$e.Z.addAditionalQueryParameterToUrl($,H)}else U===o.Z.CMCD_MODE_HEADER&&(F=a.getHeaderParameters(g))}var G=h.getXHRWithCredentialsForType(g.type);if(g.queryParams){var V=Object.keys(g.queryParams).map((function(e){return{key:e,value:g.queryParams[e]}}));$=$e.Z.addAditionalQueryParameterToUrl($,V)}g.url=$,d={url:$,method:A.w.GET,withCredentials:G,request:g,onload:function(){d.response.status>=200&&d.response.status<=299&&(B(!0),t.success&&t.success(d.response.response,d.response.statusText,d.response.responseURL),t.complete&&t.complete(g,d.response.statusText))},onend:j,onerror:j,progress:function(e){var n=new Date;C&&(C=!1,(!e.lengthComputable||e.lengthComputable&&e.total!==e.loaded)&&(g.firstByteDate=n)),e.lengthComputable&&(g.bytesLoaded=e.loaded,g.bytesTotal=e.total),e.noTrace||(x.push({s:N,d:e.time?e.time:n.getTime()-N.getTime(),b:[e.loaded?e.loaded-R:0]}),N=n,R=e.loaded),D&&(clearTimeout(D),D=null),S.get().streaming.fragmentRequestProgressTimeout>0&&(D=setTimeout((function(){f.warn("Abort request "+d.url+" due to progress timeout"),d.response.onabort=null,d.loader.abort(d),j()}),S.get().streaming.fragmentRequestProgressTimeout)),t.progress&&e&&t.progress(e)},onabort:function(){P(!0),D&&(clearTimeout(D),D=null),t.abort&&t.abort(g)},ontimeout:function(e){var t;if(e.lengthComputable){var n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";f.warn(t)},loader:M,timeout:w,headers:F};var W=(new Date).getTime();if(isNaN(g.delayLoadingTime)||W>=g.delayLoadingTime)n.push(d),M.load(d);else{var z={httpRequest:d};i.push(z),z.delayTimeout=setTimeout((function(){if(-1!==i.indexOf(z)){i.splice(i.indexOf(z),1);try{O=new Date,N=O,n.push(z.httpRequest),M.load(z.httpRequest)}catch(e){z.httpRequest.onerror()}}}),g.delayLoadingTime-W)}}(e,v.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){r.forEach((function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)})),r=[],i.forEach((function(e){return clearTimeout(e.delayTimeout)})),i=[],n.forEach((function(e){e.request.type!==A.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))})),n=[]}},f=(0,d.Z)(m).getInstance().getLogger(t),n=[],i=[],r=[],a=Ve(m).getInstance(),u=rt(m).getInstance(),p=st(m).getInstance(),h=(0,at.Z)(m).getInstance(),lt(g={},A.w.MPD_TYPE,x.DOWNLOAD_ERROR_ID_MANIFEST_CODE),lt(g,A.w.XLINK_EXPANSION_TYPE,x.DOWNLOAD_ERROR_ID_XLINK_CODE),lt(g,A.w.INIT_SEGMENT_TYPE,x.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),lt(g,A.w.MEDIA_SEGMENT_TYPE,x.DOWNLOAD_ERROR_ID_CONTENT_CODE),lt(g,A.w.INDEX_SEGMENT_TYPE,x.DOWNLOAD_ERROR_ID_CONTENT_CODE),lt(g,A.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,x.DOWNLOAD_ERROR_ID_CONTENT_CODE),lt(g,A.w.OTHER_TYPE,x.DOWNLOAD_ERROR_ID_CONTENT_CODE),s=g,t}ct.__dashjs_factory_name="HTTPLoader";var ut=u.Z.getClassFactory(ct);function dt(){var e;function t(){e={}}function n(){t()}return n(),{getLoader:function(t){for(var n in e)if(e.hasOwnProperty(n)&&t.startsWith(n))return e[n];return ut},registerLoader:function(t,n){e[t]=n},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:n}}dt.__dashjs_factory_name="SchemeLoaderFactory";var ht=u.Z.getSingletonFactory(dt);function pt(e){e=e||{};var t,n,i=this.context;return t=ht(i).getInstance(),{load:function(r){if(!n){var o=t.getLoader(r&&r.request?r.request.url:null);n=o(i).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}n.load(r)},abort:function(){n&&n.abort()}}}pt.__dashjs_factory_name="URLLoader";var ft=u.Z.getClassFactory(pt);function gt(e){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(r,g.Z);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=bt(t);if(n){var r=bt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==gt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(e){var t;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(t=i.call(this,e)).checkForExistenceOnly=!0,t}return r}();function vt(e){e=e||{};var t,n,i=this.context,r=e.eventBus,s=e.events,a=e.urlUtils,l=e.errors,c=e.streamId;return t={checkForExistence:function(e){var t=function(t){r.trigger(s.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var i=new yt(e.url);n.load({request:i,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var i=function(n,i){r.trigger(s.LOADING_COMPLETED,{request:e,response:n||null,error:i||null,sender:t})};e?n.load({request:e,progress:function(n){r.trigger(s.LOADING_PROGRESS,{request:e,stream:n.stream,streamId:c}),n.data&&r.trigger(s.LOADING_DATA_PROGRESS,{request:e,response:n.data||null,error:null,sender:t})},success:function(e){i(e)},error:function(e,t,n){i(void 0,new T.Z(l.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,n,t))},abort:function(e){e&&r.trigger(s.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:t})}}):i(void 0,new T.Z(l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){n&&n.abort()},reset:function(){n&&(n.abort(),n=null)}},n=ft(i).create({errHandler:e.errHandler,errors:l,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:a,constants:o.Z,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),t}vt.__dashjs_factory_name="FragmentLoader";var _t=u.Z.getClassFactory(vt);function Et(){return{modifyResponseAsync:function(e){return Promise.resolve(e)}}}Et.__dashjs_factory_name="SegmentResponseModifier";var Tt=u.Z.getSingletonFactory(Et);function xt(e){e=e||{};var t,n,i,r=this.context,s=(0,l.Z)(r).getInstance(),a=e.errHandler,u=e.mediaPlayerModel,p=e.dashMetrics,f=(0,d.Z)(r).getInstance(),g=Tt(r).getInstance(),m=e.streamInfo;function b(){return m.id}function y(){for(var e in i)i[e].reset();i={}}function v(e){if(e.sender){var t=e.request,i=e.response,r=t.isInitializationRequest(),a=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===o.Z.AUDIO||t.mediaType===o.Z.VIDEO||t.mediaType===o.Z.TEXT&&t.mediaInfo.isFragmented)&&s.trigger(c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:e.request.serviceLocation}),i&&a){var l=function(e,t,n,i){var r=new oe;return r.streamId=n,r.mediaInfo=t.mediaInfo,r.segmentType=t.type,r.start=t.startTime,r.duration=t.duration,r.end=r.start+r.duration,r.bytes=e,r.index=t.index,r.quality=t.quality,r.representationId=t.representationId,r.endFragment=i,r}(i,t,m.id,e.type!==c.Z.FRAGMENT_LOADING_PROGRESS);g.modifyResponseAsync(l).then((function(e){s.trigger(r?c.Z.INIT_FRAGMENT_LOADED:c.Z.MEDIA_FRAGMENT_LOADED,{chunk:e,request:t},{streamId:a.id,mediaType:t.mediaType})})).catch((function(e){n.error(e),s.trigger(r?c.Z.INIT_FRAGMENT_LOADED:c.Z.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:a.id,mediaType:t.mediaType})}))}else n.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getStreamId:b,getModel:function(t){var n=i[t];return n||(n=E(r).create({streamInfo:m,type:t,dashMetrics:p,fragmentLoader:_t(r).create({dashMetrics:p,mediaPlayerModel:u,errHandler:a,requestModifier:(0,K.Z)(r).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:s,events:c.Z,errors:S,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:b()}),debug:f,eventBus:s,events:c.Z}),i[t]=n),n},reset:function(){s.off(h.Z.FRAGMENT_LOADING_COMPLETED,v,this),s.off(h.Z.FRAGMENT_LOADING_PROGRESS,v,this),y()}},n=f.getLogger(t),y(),s.on(h.Z.FRAGMENT_LOADING_COMPLETED,v,t),s.on(h.Z.FRAGMENT_LOADING_PROGRESS,v,t),t}xt.__dashjs_factory_name="FragmentController";var wt=u.Z.getClassFactory(xt),kt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},St=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};function Ct(e){var t,n,i=this.context,r=e.streamInfo;function s(e){n.setTrackByIndex(e)}function a(){n&&n.reset()}return t={getStreamId:function(){return r.id},initialize:function(){n.addTracks();var e=n.getTracks();e&&e.length>0&&s(0)},provide:function(e,t){if("function"==typeof t){var i,r,o=n.getCurrentTrack();if(!o||o.segmentDuration<=0||null==e)t(null);else{(r=n.getThumbnailRequestForTime(e))&&(o.segmentDuration=r.duration),i=e%o.segmentDuration;var s=Math.floor(i*o.tilesHor*o.tilesVert/o.segmentDuration),a=new kt;if(a.width=Math.floor(o.widthPerTile),a.height=Math.floor(o.heightPerTile),a.x=Math.floor(s%o.tilesHor)*o.widthPerTile,a.y=Math.floor(s/o.tilesHor)*o.heightPerTile,"readThumbnail"in o)return o.readThumbnail(e,(function(e){a.url=e,t(a)}));if(r)a.url=r.url,o.segmentDuration=NaN;else{var l=Math.floor(e/o.segmentDuration);a.url=function(e,t){var n=l+e.startNumber,i=(0,V.vi)(e.templateUrl,"Number",n);return i=(0,V.vi)(i,"Time",(n-1)*e.segmentDuration*e.timescale),i=(0,V.vi)(i,"Bandwidth",e.bandwidth),(0,V.eR)(i)}(o)}t(a)}}},setTrackByIndex:s,getCurrentTrackIndex:function(){return n.getCurrentTrackIndex()},getBitrateList:function(){var e=n.getTracks(),t=0;return e.map((function(e){var n=new St;return n.mediaType=o.Z.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n}))},reset:a},a(),n=(0,Ie.Z)(i).create({streamInfo:r,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),t}Ct.__dashjs_factory_name="ThumbnailController";var At=u.Z.getClassFactory(Ct),It=n(7417);function Ot(e){var t;e=e||{};var n=[],i=(0,l.Z)(this.context).getInstance(),r=e.updateEventName,o=e.addBlacklistEventName;function s(e){-1===n.indexOf(e)&&(n.push(e),i.trigger(r,{entry:e}))}return t={add:s,contains:function(e){return!!(n.length&&e&&e.length)&&-1!==n.indexOf(e)},reset:function(){n=[]}},o&&i.on(o,(function(e){s(e.entry)}),t),t}Ot.__dashjs_factory_name="BlackListController";var Nt=u.Z.getClassFactory(Ot),Rt=[o.Z.VIDEO,o.Z.AUDIO,o.Z.TEXT,o.Z.MUXED,o.Z.IMAGE];function Dt(e){e=e||{};var t,n,i,r,a,u,h,p,f,g,m,b,y,v,_,E,x,w,k=this.context,C=(0,l.Z)(k).getInstance(),A=(0,Z.Z)(k).getInstance(),I=e.manifestModel,O=e.mediaPlayerModel,N=e.dashMetrics,R=e.manifestUpdater,D=e.adapter,L=e.timelineConverter,M=e.capabilities,P=e.errHandler,B=e.abrController,j=e.playbackController,F=e.eventController,$=e.mediaController,U=e.protectionController,H=e.textController,G=e.videoModel,V=e.streamInfo,W=e.settings;function z(e,t){return new Promise((function(r,s){ne(),g=!0,oe();var a=G.getElement(),l=[];Rt.forEach((function(t){(t!==o.Z.TEXT||e)&&(t!==o.Z.VIDEO||!a||a&&/^VIDEO$/i.test(a.nodeName))&&l.push(q(t,e))})),Promise.all(l).then((function(){return e=t,new Promise((function(t){var n={},r=i.map((function(t){return t.createBufferSinks(e)}));Promise.all(r).then((function(e){e.forEach((function(e){e&&(n[e.getType()]=e)})),t(n)})).catch((function(){t(n)}))}));var e})).then((function(t){if(g=!1,0===i.length){var o="No streams to play.";P.error(new T.Z(S.MANIFEST_ERROR_ID_NOSTREAMS_CODE,o,I.getValue())),n.fatal(o)}else se();e&&H.createTracks(V),r(t)})).catch((function(e){s(e)}))}))}function q(t,r){var a,l=D.getAllMediaInfoForType(V,t),u=[],d=null;if(!l||0===l.length)return n.info("No "+t+" data."),Promise.resolve();t===o.Z.VIDEO&&(h=!0),t===o.Z.AUDIO&&(p=!0);for(var f=0,g=l.length;f<g;f++)d=l[f],t===o.Z.TEXT&&d.isEmbedded&&(H.addEmbeddedTrack(V,d),u.push(d)),Y(d)&&$.addTrack(d);if(u.length>0&&($.setInitialMediaSettingsForType(t,V),H.addMediaInfosToBuffer(V,t,u)),0===(l=l.filter((function(e){return!e.isEmbedded}))).length)return Promise.resolve();if(t===o.Z.IMAGE)return(b=At(k).create({streamInfo:V,adapter:D,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:E,eventBus:C,events:c.Z,dashConstants:s.Z,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})).initialize(),Promise.resolve();C.trigger(c.Z.STREAM_INITIALIZING,{streamInfo:V,mediaInfo:d}),$.setInitialMediaSettingsForType(t,V);var v=function(t,n){var r=t&&t.length>0?t[0]:null,s=m.getModel(r?r.type:null),a=r?r.type:null,l=r?r.mimeType:null,c=r?r.isFragmented:null,u=re(k).create({streamInfo:V,type:a,mimeType:l,timelineConverter:L,adapter:D,manifestModel:I,mediaPlayerModel:O,fragmentModel:s,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:B,playbackController:j,mediaController:$,textController:H,errHandler:P,settings:W,boxParser:_,segmentBlacklistController:y});u.initialize(n,h,c),i.push(u);for(var d=0;d<t.length;d++)u.addMediaInfo(t[d]);return a===o.Z.TEXT&&H.addMediaInfosToBuffer(V,a,t,s),u}(l,r);return(a=$.getCurrentTrackFor(t,V.id))?(B.updateTopQualityIndex(a),v.selectMediaInfo(t===o.Z.TEXT&&a.isEmbedded?l[0]:a)):Promise.resolve()}function Y(e){var t,i=e?e.type:null;return i===o.Z.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",n.fatal(t),P.error(new T.Z(S.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,I.getValue())),!1):!(i!==o.Z.TEXT&&i!==o.Z.IMAGE&&e.contentProtection&&!M.supportsEncryptedMedia()&&(P.error(new T.Z(S.CAPABILITY_MEDIAKEYS_ERROR_CODE,S.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function K(e){for(var t=i?i.length:0,n=0;n<t;n++){var r=i[n].getFragmentModel();r.abortRequests(),r.resetInitialSettings(),i[n].reset(!1,e)}H&&H.deactivateStream(V),i=[],a=!1,u=!1,me(!1),J(!1),C.trigger(c.Z.STREAM_DEACTIVATED,{streamInfo:V})}function X(e){K(e),r=!1,h=!1,p=!1,f={},g=!1,x=!1,w=[]}function J(e){x=e}function Q(){return V?V.start:NaN}function ee(){return V?V.id:null}function te(){return V}function ne(){if(!G||!B)throw new Error(o.Z.MISSING_CONFIG_ERROR)}function ie(e){e.error&&(P.error(e.error),n.fatal(e.error.message))}function oe(){if(F){var e=D.getEventsFor(V);e&&e.length>0&&F.addInlineEvents(e,V.id)}}function se(){for(var e=i.length,t=f.audio||f.video?new T.Z(S.DATA_UPDATE_FAILED_ERROR_CODE,S.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,n=0;n<e;n++)if(i[n].isUpdating()||g)return;if(U){U.clearMediaInfoArray();for(var s=0;s<e&&i[s];s++){var a=i[s].getType(),l=i[s].getMediaInfo();if(a===o.Z.AUDIO||a===o.Z.VIDEO||a===o.Z.TEXT&&l.isFragmented){var u=i[s].getMediaInfo();u&&U.initializeForMedia(u)}}U.handleKeySystemFromManifest()}t?P.error(t):r||(r=!0,G.waitForReadyState(o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){C.trigger(c.Z.STREAM_INITIALIZED,{streamInfo:V})})))}function ae(){var e=he(),t=e.length;if(0!==t){for(var i=0;i<t;i++)if(!e[i].isBufferingCompleted()&&(e[i].getType()===o.Z.AUDIO||e[i].getType()===o.Z.VIDEO))return void n.debug("onBufferingCompleted - One streamProcessor has finished but",e[i].getType(),"one is not buffering completed");n.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),u=!0,C.trigger(c.Z.STREAM_BUFFERING_COMPLETED,{streamInfo:V},{streamInfo:V})}else n.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function le(e){f[e.mediaType]=e.error,se()}function ce(e){F&&F.addInbandEvents(e.events,V.id)}function ue(e){return e&&e.type?de(e.type):null}function de(e){return e?he().filter((function(t){return t.getType()===e}))[0]:null}function he(){for(var e,t,n=[],r=0;r<i.length;r++)(e=(t=i[r]).getType())!==o.Z.AUDIO&&e!==o.Z.VIDEO&&e!==o.Z.TEXT||n.push(t);return n}function pe(e,t){var n=te(),i=t.getStreamInfo();if(!i||!n)return!0;var r=D.getAdaptationForType(i.index,e,i),o=D.getAdaptationForType(n.index,e,n);return r&&o?!(!fe(o)&&fe(r)):!r&&!o}function fe(e){return!!e&&!!(e.ContentProtection||e.Representation_asArray&&e.Representation_asArray.length>0&&e.Representation_asArray[0].ContentProtection)}function ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var i=e.getStreamInfo(),r=n?n.getStreamInfo():te();if(!i||!r)return!1;var o=D.getAdaptationForType(i.index,t,i),s=D.getAdaptationForType(r.index,t,r);if(!o||!s)return!o&&!s;var a=o&&s&&o.mimeType===s.mimeType,l=s.Representation_asArray.map((function(e){return e.codecs})),c=o.Representation_asArray.map((function(e){return e.codecs})),u=c.some((function(e){return l.indexOf(e)>-1})),d=c.some((function(e){return l.some((function(t){return M.codecRootCompatibleWithCodec(t,e)}))}));return u||d&&a}function me(e){v=e}function be(){return v}return t={initialize:function(){C.on(c.Z.BUFFERING_COMPLETED,ae,t),C.on(c.Z.DATA_UPDATE_COMPLETED,le,t),C.on(c.Z.INBAND_EVENTS,ce,t),U&&(C.on(c.Z.KEY_ERROR,ie,t),C.on(c.Z.SERVER_CERTIFICATE_UPDATED,ie,t),C.on(c.Z.LICENSE_REQUEST_COMPLETE,ie,t),C.on(c.Z.KEY_SYSTEM_SELECTED,ie,t),C.on(c.Z.KEY_SESSION_CREATED,ie,t),C.on(c.Z.KEY_STATUSES_CHANGED,ie,t)),H.initializeForStream(V),C.trigger(c.Z.STREAM_UPDATED,{streamInfo:V})},getStreamId:function(){return V?V.id:null},activate:function(e,t){return new Promise((function(n,i){if(!a)return be()?(a=!0,C.trigger(c.Z.STREAM_ACTIVATED,{streamInfo:V}),void n(t)):void function(e,t){return z(e,t)}(e,t).then((function(e){a=!0,C.trigger(c.Z.STREAM_ACTIVATED,{streamInfo:V}),n(e)})).catch((function(e){i(e)}));n(t)}))},deactivate:K,getIsActive:function(){return a},getDuration:function(){return V?V.duration:NaN},getStartTime:Q,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return p},getHasVideoTrack:function(){return h},startPreloading:function(e,t){return new Promise((function(r,o){be()?o():(n.info("[startPreloading] Preloading next stream with id ".concat(ee())),me(!0),z(e,t).then((function(){for(var e=0;e<i.length&&i[e];e++)i[e].setExplicitBufferingTime(Q()),i[e].getScheduleController().startScheduleTimer();r()})).catch((function(){me(!1),o()})))}))},initializeForTextWithMediaSource:function(e){return new Promise((function(t,n){q(o.Z.TEXT,e).then((function(){return(e=de(o.Z.TEXT))?e.createBufferSinks():Promise.resolve();var e})).then((function(){H.createTracks(V),t()})).catch((function(e){n(e)}))}))},getThumbnailController:function(){return b},getBitrateListFor:function(e){if(ne(),e===o.Z.IMAGE)return b?b.getBitrateList():[];var t=function(e){for(var t=null,n=0;n<i.length;n++)if((t=i[n]).getType()===e)return t.getMediaInfo();return null}(e);return B.getBitrateList(t)},updateData:function(e){return new Promise((function(t){g=!0,V=e,F&&oe();for(var n=[],r=0,o=i.length;r<o;r++){var s=i[r],a=s.getMediaInfo();n.push(s.updateStreamInfo(V));var l=D.getAllMediaInfoForType(V,s.getType());if(l=l.filter((function(e){return!e.isEmbedded}))){s.clearMediaInfoArray();for(var u=0;u<l.length;u++){var d=l[u];s.addMediaInfo(l[u]),D.areMediaInfosEqual(a,d)&&(B.updateTopQualityIndex(d),n.push(s.selectMediaInfo(d)))}}}Promise.all(n).then((function(){for(n=[];w.length>0;){var e=w.pop(),t=e.newMediaInfo,i=ue(e.oldMediaInfo);if(!i)return;n.push(i.prepareTrackSwitch()),n.push(i.selectMediaInfo(t))}return Promise.all(n)})).then((function(){g=!1,se(),C.trigger(c.Z.STREAM_UPDATED,{streamInfo:V}),t()}))}))},reset:function(e){m&&(m.reset(),m=null),B&&V&&B.clearDataForStream(V.id),y&&(y.reset(),y=null),X(e),V=null,C.off(c.Z.DATA_UPDATE_COMPLETED,le,t),C.off(c.Z.BUFFERING_COMPLETED,ae,t),C.off(c.Z.INBAND_EVENTS,ce,t),U&&(C.off(c.Z.KEY_ERROR,ie,t),C.off(c.Z.SERVER_CERTIFICATE_UPDATED,ie,t),C.off(c.Z.LICENSE_REQUEST_COMPLETE,ie,t),C.off(c.Z.KEY_SYSTEM_SELECTED,ie,t),C.off(c.Z.KEY_SESSION_CREATED,ie,t),C.off(c.Z.KEY_STATUSES_CHANGED,ie,t))},getProcessors:he,setMediaSource:function(e){return new Promise((function(t,r){for(var o=[],s=0;s<i.length;)Y(i[s].getMediaInfo())?(o.push(i[s].setMediaSource(e)),s++):(i[s].reset(),i.splice(s,1));Promise.all(o).then((function(){for(var e=0;e<i.length;e++)i[e].dischargePreBuffer();if(0===i.length){var r="No streams to play.";P.error(new T.Z(S.MANIFEST_ERROR_ID_NOSTREAMS_CODE,r+"nostreams",I.getValue())),n.fatal(r)}t()})).catch((function(e){n.error(e),r(e)}))}))},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ge(e,o.Z.VIDEO,t)&&ge(e,o.Z.AUDIO,t)},isProtectionCompatible:function(e){return!e||pe(o.Z.VIDEO,e)&&pe(o.Z.AUDIO,e)},getPreloaded:be,getIsEndedEventSignaled:function(){return x},setIsEndedEventSignaled:J,getAdapter:function(){return D},getHasFinishedBuffering:function(){return u},setPreloaded:me,startScheduleControllers:function(){for(var e=i.length,t=0;t<e&&i[t];t++)i[t].getScheduleController().startScheduleTimer()},prepareTrackChange:function(e){if(a&&V){u=!1;var t=e.newMediaInfo,i=I.getValue();D.setCurrentMediaInfo(V.id,t.type,t);var r=ue(t);if(r){var s=j.getTime();n.info("Stream -  Process track changed at current time "+s),i.refreshManifestOnSwitchTrack?(w.push(e),R.getIsUpdating()||(n.debug("Stream -  Refreshing manifest for switch track"),R.refreshManifest())):r.selectMediaInfo(t).then((function(){t.type!==o.Z.VIDEO&&t.type!==o.Z.AUDIO||B.updateTopQualityIndex(t),r.prepareTrackSwitch()}))}}},prepareQualityChange:function(e){var t=de(e.mediaType);t&&t.prepareQualityChange(e)}},function(){try{E=(0,d.Z)(k).getInstance(),n=E.getLogger(t),X(),_=(0,It.Z)(k).getInstance(),y=Nt(k).create({updateEventName:c.Z.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SEGMENT_LOCATION_BLACKLIST_ADD}),m=wt(k).create({streamInfo:V,mediaPlayerModel:O,dashMetrics:N,errHandler:P,settings:W,boxParser:_,dashConstants:s.Z,urlUtils:A})}catch(e){throw e}}(),t}Dt.__dashjs_factory_name="Stream";var Lt=u.Z.getClassFactory(Dt),Mt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||null,this.type=A.w.CONTENT_STEERING_TYPE,this.responseType="json"},Pt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]};function Bt(){var e,t,n,i,r,o,a,l,c,u,p,f,g,m,b,y=this.context,v=(0,Z.Z)(y).getInstance();function _(e){k(e,"baseUrl")}function E(e){k(e,"location")}function T(e){if(e&&e.request&&e.request.serviceLocation&&e.request.requestStartDate&&e.request.requestEndDate&&!isNaN(e.request.bytesTotal)){var t=e.request.serviceLocation,n=e.request.requestEndDate.getTime()-e.request.requestStartDate.getTime();w(t,parseInt(8*e.request.bytesTotal/n*1e3))}}function x(e){e&&e.httpRequest&&e.httpRequest._serviceLocation&&!isNaN(e.throughput)&&w(e.httpRequest._serviceLocation,1e3*e.throughput)}function w(e,t){r[e]||(r[e]=[]),r[e].push(t),r[e].length>4&&r[e].shift()}function k(e,t){if(e&&e.request&&e.request.serviceLocation){var n=e.request.serviceLocation;-1===i[t].all.indexOf(n)&&i[t].all.push(n),i[t].current=n}}function C(){var e=p.getValue(),t=b.getContentSteering(e);return t||(t=g.getServiceDescriptionSettings().contentSteering),t}function A(){return new Promise((function(e){try{var o=C();if(!o||!o.serverUrl)return void e();var l=function(e){var t=e.serverUrl;n&&n.reloadUri&&(t=v.isRelative(n.reloadUri)?v.resolve(n.reloadUri,e.serverUrl):n.reloadUri);var o=[],s=i.baseUrl.all.concat(i.location.all);if(s.length>0){var a=s.map((function(e){return{serviceLocation:e,throughput:function(e){if(!e||!r[e]||0===r[e].length)return-1;var t=r[e].reduce((function(e,t){return e+t}))/r[e].length;return parseInt(t)}(e)}}));a.sort((function(e,t){return t.throughput-e.throughput}));var l="",c="";a.forEach((function(e,t){0!==t&&(l="".concat(l,","),e.throughput>-1&&(c="".concat(c,","))),l="".concat(l).concat(e.serviceLocation),e.throughput>-1&&(c="".concat(c).concat(e.throughput))})),o.push({key:"_DASH_pathway",value:'"'.concat(l,'"')}),o.push({key:"_DASH_throughput",value:c})}return $e.Z.addAditionalQueryParameterToUrl(t,o)}(o),c=new Mt(l);a.load({request:c,success:function(t){!function(e){e&&e[s.Z.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(e[s.Z.CONTENT_STEERING_RESPONSE.VERSION])&&((n=new Pt).version=e[s.Z.CONTENT_STEERING_RESPONSE.VERSION],e[s.Z.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(e[s.Z.CONTENT_STEERING_RESPONSE.TTL])&&(n.ttl=e[s.Z.CONTENT_STEERING_RESPONSE.TTL]),e[s.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(n.reloadUri=e[s.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]),e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(n.pathwayPriority=e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(n.pathwayClones=e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],n.pathwayClones=n.pathwayClones.filter((function(e){return function(e){return e[s.Z.CONTENT_STEERING_RESPONSE.BASE_ID]&&e[s.Z.CONTENT_STEERING_RESPONSE.ID]&&e[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&e[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.HOST]}(e)}))),N())}(t),m.trigger(h.Z.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:n,url:l}),e()},error:function(i,r,o,s){!function(e,i){try{switch(t.warn("Error fetching data from content steering server",e),i.status){case 410:break;case 429:var r=i&&i.getResponseHeader?i.getResponseHeader("retry-after"):null;null!==r&&(n||(n={}),n.ttl=parseInt(r)),N();break;default:N()}}catch(e){t.error(e)}}(i,s),e(i)},complete:function(){i.baseUrl.all=I(i.baseUrl),i.location.all=I(i.location)}})}catch(t){e(t)}}))}function I(e){return e.all&&0!==e.all.length&&e.current?e.all.filter((function(t){return t===e.current})):[]}function O(e){try{var i=[];return e&&0!==e.length&&n&&n.pathwayClones&&0!==n.pathwayClones.length?(n.pathwayClones.forEach((function(t){var n=e.filter((function(e){return t[s.Z.CONTENT_STEERING_RESPONSE.BASE_ID]===e.serviceLocation})),r=null;if(n&&n.length>0&&(r=n[0]),r){var o=new URL(r.url),a=t[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.HOST];a=$e.Z.stringHasProtocol(a)?a:"".concat(o.protocol,"//").concat(a);var l={synthesizedUrl:"".concat(a).concat(o.pathname),serviceLocation:t[s.Z.CONTENT_STEERING_RESPONSE.ID],queryParams:t[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.PARAMS],reference:r};i.push(l)}})),i):i}catch(e){return t.error(e),[]}}function N(){n&&n.ttl&&!isNaN(n.ttl)&&(o&&clearTimeout(o),o=setTimeout((function(){A()}),1e3*n.ttl))}function R(){o&&clearTimeout(o),o=null}function D(){n=null,r={},i={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},R()}return e={reset:function(){D(),m.off(h.Z.FRAGMENT_LOADING_STARTED,_,e),m.off(h.Z.MANIFEST_LOADING_STARTED,E,e),m.off(h.Z.MANIFEST_LOADING_FINISHED,T,e),m.off(h.Z.THROUGHPUT_MEASUREMENT_STORED,x,e)},setConfig:function(e){e&&(e.adapter&&(b=e.adapter),e.errHandler&&(l=e.errHandler),e.dashMetrics&&(c=e.dashMetrics),e.mediaPlayerModel&&(u=e.mediaPlayerModel),e.requestModifier&&(f=e.requestModifier),e.manifestModel&&(p=e.manifestModel),e.serviceDescriptionController&&(g=e.serviceDescriptionController),e.eventBus&&(m=e.eventBus))},loadSteeringData:A,getCurrentSteeringResponseData:function(){return n},shouldQueryBeforeStart:function(){var e=C();return!!e&&e.queryBeforeStart},getSteeringDataFromManifest:C,stopSteeringRequestTimer:R,getSynthesizedBaseUrlElements:function(e){try{return O(e).map((function(e){var t=new _e(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t.dvbPriority=e.reference.dvbPriority,t.dvbWeight=e.reference.dvbWeight,t.availabilityTimeOffset=e.reference.availabilityTimeOffset,t.availabilityTimeComplete=e.reference.availabilityTimeComplete,t}))}catch(e){return t.error(e),[]}},getSynthesizedLocationElements:function(e){try{return O(e).map((function(e){var t=new Oe(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t}))}catch(e){return t.error(e),[]}},initialize:function(){a=ft(y).create({errHandler:l,dashMetrics:c,mediaPlayerModel:u,requestModifier:f,errors:S}),m.on(h.Z.FRAGMENT_LOADING_STARTED,_,e),m.on(h.Z.MANIFEST_LOADING_STARTED,E,e),m.on(h.Z.MANIFEST_LOADING_FINISHED,T,e),m.on(h.Z.THROUGHPUT_MEASUREMENT_STORED,x,e)}},t=(0,d.Z)(y).getInstance().getLogger(e),D(),e}Bt.__dashjs_factory_name="ContentSteeringController";var jt=u.Z.getSingletonFactory(Bt);function Ft(){var e,t,n,i=this.context,r=(0,C.Z)(i).getInstance();return e={select:function(e){if(!e||0===e.length)return null;var i=null;return r.get().streaming.applyContentSteering&&(i=function(e){var i=n.getCurrentSteeringResponseData();return i&&i.pathwayPriority&&i.pathwayPriority.length>0?function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0,r=null,o=function(){var o=e[i],s=n.findIndex((function(e){return e.serviceLocation&&e.serviceLocation===o}));if(-1!==s&&!t.contains(n[s].serviceLocation))return r=n[s],"break";i+=1};i<e.length&&"break"!==o(););return r}(i.pathwayPriority,e):null}(e)),i||(i=function(e){return e[0]}(e)),i},setConfig:function(e){e.blacklistController&&(t=e.blacklistController),e.contentSteeringController&&(n=e.contentSteeringController)},reset:function(){t.reset()}},t=Nt(i).create({updateEventName:c.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),n=jt(i).getInstance(),e}Ft.__dashjs_factory_name="LocationSelector";var $t=u.Z.getClassFactory(Ft);function Ut(){var e,t,n,i,r,o,a,u,p,f,g,m,b,y,v=this.context,_=(0,l.Z)(v).getInstance(),E=(0,Z.Z)(v).getInstance();function T(){n=NaN,a=!1,r=!0,o=!1,x()}function x(){null!==i&&(clearTimeout(i),i=null)}function w(e){x(),o||(isNaN(e)&&!isNaN(n)&&(e=1e3*n),isNaN(e)||(t.debug("Refresh manifest in "+e+" milliseconds."),i=setTimeout(A,e)))}function k(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a=!0;var t=p.getValue(),n=t.url,i=null,r=g.getPatchLocation(t),o=f.select(r),s=null;if(o&&!e)n=o.url,i=o.serviceLocation,s=o.queryParams;else{var l=function(e){var t=g.getLocation(e),n=b.getSynthesizedLocationElements(t);return t.concat(n)}(t),c=f.select(l);c&&(n=c.url,i=c.serviceLocation,s=c.queryParams)}E.isRelative(n)&&(n=E.resolve(n,t.url)),u.load(n,i,s)}function C(e){if(e){if(g.getIsPatch(e)){var i=e;e=p.getValue();var l=g.isPatchValid(e,i),u=l;if(l){var d=g.getPublishTime(e);u=g.applyPatchToManifest(e,i);var h=g.getPublishTime(e);u=d.getTime()!=h.getTime()}if(!u)return t.debug("Patch provided is invalid, performing full manifest refresh"),void k(!0);e.loadedTime=new Date}}else(e=p.getValue()).loadedTime=new Date;if(p.getValue()&&p.getValue().type===s.Z.DYNAMIC&&e.type===s.Z.STATIC)return _.trigger(c.Z.DYNAMIC_TO_STATIC),a=!1,void(o=!0);p.setValue(e);var f=new Date,m=(f.getTime()-e.loadedTime.getTime())/1e3;1e3*(n=g.getManifestUpdatePeriod(e,m))>2147483647&&(n=2147483.647),_.trigger(c.Z.MANIFEST_UPDATED,{manifest:e}),t.info("Manifest has been refreshed at "+f+"["+f.getTime()/1e3+"] "),r||w()}function A(){r||(a?w(y.get().streaming.manifestUpdateRetryInterval):k())}function I(e){e.error?e.error.code===S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&m.error(e.error):C(e.manifest)}function O(){r=!1,w()}function N(){(r=!y.get().streaming.scheduling.scheduleWhilePaused)&&x()}function R(){a=!1}return e={initialize:function(){T(),_.on(c.Z.STREAMS_COMPOSED,R,this),_.on(h.Z.PLAYBACK_STARTED,O,this),_.on(h.Z.PLAYBACK_PAUSED,N,this),_.on(c.Z.INTERNAL_MANIFEST_LOADED,I,this)},setManifest:function(e){C(e)},refreshManifest:k,getIsUpdating:function(){return a},setConfig:function(e){e&&(e.manifestModel&&(p=e.manifestModel),e.adapter&&(g=e.adapter),e.manifestLoader&&(u=e.manifestLoader),e.errHandler&&(m=e.errHandler),e.locationSelector&&(f=e.locationSelector),e.settings&&(y=e.settings),e.contentSteeringController&&(b=e.contentSteeringController))},reset:function(){_.off(h.Z.PLAYBACK_STARTED,O,this),_.off(h.Z.PLAYBACK_PAUSED,N,this),_.off(c.Z.STREAMS_COMPOSED,R,this),_.off(c.Z.INTERNAL_MANIFEST_LOADED,I,this),T()}},t=(0,d.Z)(v).getInstance().getLogger(e),f=$t(v).create(),e}Ut.__dashjs_factory_name="ManifestUpdater";var Ht=u.Z.getClassFactory(Ut);function Gt(){var e,t,n,i,r,o,s,a,u,h,p,f,g,m,b,y,v=this.context,_=(0,l.Z)(v).getInstance(),E=(0,Z.Z)(v).getInstance();function x(){a=[],u=[],h=null,p=null,g=null,f=NaN,n=!1,i=!1,m=r.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function w(){r.get().streaming.utcSynchronization.enabled&&!n&&!i&&g&&g.value&&g.schemeIdUri&&!isNaN(f)&&!isNaN(r.get().streaming.utcSynchronization.backgroundAttempts)&&(p&&(Date.now()-p)/1e3<30||(a=[],i=!0,function e(t){try{if(t<=0)return void B();var n=Date.now();o[g.schemeIdUri](g.value,(function(i){var r=Date.now(),o=k(n,r,i);a.push(o),e(t-1)}),(function(){B()}))}catch(t){B()}}(isNaN(r.get().streaming.utcSynchronization.backgroundAttempts)?2:r.get().streaming.utcSynchronization.backgroundAttempts)))}function k(e,t,n){return n-(t-(t-e)/2)}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&r.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?function(){var e=s.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?P(!0):P(!1,t-Date.now())}():P(t,e)}function I(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t,n,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10),i[6]&&(parseInt(i[6],10)||0),i[7]&&1e3*parseFloat(i[7])||0),i[9]&&i[10]&&(n=60*parseInt(i[9],10)+parseInt(i[10],10),t+=("+"===i[8]?-1:1)*n*60*1e3),new Date(t).getTime()}(e)),t}function O(e){return Date.parse(e)}function N(e){return Date.parse(e)}function R(e,t,n){n()}function D(e,t,n){var i=I(e);isNaN(i)?n():t(i)}function L(e,t,n,i,r){var o,s,a=!1,l=new XMLHttpRequest,c=r?A.w.HEAD:A.w.GET,u=t.match(/\S+/g);if(t=u.shift(),o=function(){a||(a=!0,u.length?L(e,u.join(" "),n,i,r):i())},s=function(){var t,i;200===l.status&&(t=r?l.getResponseHeader("Date"):l.response,i=e(t),isNaN(i)||(n(i),a=!0))},E.isRelative(t)){var d=y.resolve();d&&(t=E.resolve(t,d.url))}l.open(c,t),l.timeout=5e3,l.onload=s,l.onloadend=o,l.send()}function M(e,t,n){L(N,e,t,n,!0)}function P(e,i){if(isNaN(f)||isNaN(i)||e||function(e){try{var n,i=j(e),o=isNaN(m)?30:m,s=isNaN(r.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:r.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,a=isNaN(r.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:r.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,l=isNaN(r.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:r.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;i?(n=Math.min(o*s,a),t.debug("Increasing timeBetweenSyncAttempts to ".concat(n))):(n=Math.max(o/s,l),t.debug("Decreasing timeBetweenSyncAttempts to ".concat(n))),m=n}catch(e){}}(i),!e&&!isNaN(i)){h=Date.now(),n=!1;var o=isNaN(f);f=i,o&&w(),t.debug("Completed UTC sync. Setting client - server offset to ".concat(i))}e&&(g=null,n=!1,b.error(new T.Z(S.TIME_SYNC_FAILED_ERROR_CODE,S.TIME_SYNC_FAILED_ERROR_MESSAGE))),_.trigger(c.Z.UPDATE_TIME_SYNC_OFFSET,{offset:i}),_.trigger(c.Z.TIME_SYNCHRONIZATION_COMPLETED)}function B(){if(a&&0!==a.length){var e=a.reduce((function(e,t){return e+t}),0)/a.length;j(e)?t.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(t.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),f=e,_.trigger(c.Z.UPDATE_TIME_SYNC_OFFSET,{offset:f})),i=!1,p=Date.now()}}function j(e){try{if(isNaN(f))return!0;var t=r.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(r.get().streaming.utcSynchronization.maximumAllowedDrift)?r.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=f-t&&e<=f+t}catch(e){return!0}}return e={initialize:function(){x(),o={"urn:mpeg:dash:utc:http-head:2014":M,"urn:mpeg:dash:utc:http-xsdate:2014":L.bind(null,I),"urn:mpeg:dash:utc:http-iso:2014":L.bind(null,O),"urn:mpeg:dash:utc:direct:2014":D,"urn:mpeg:dash:utc:http-head:2012":M,"urn:mpeg:dash:utc:http-xsdate:2012":L.bind(null,I),"urn:mpeg:dash:utc:http-iso:2012":L.bind(null,O),"urn:mpeg:dash:utc:direct:2012":D,"urn:mpeg:dash:utc:http-ntp:2014":R,"urn:mpeg:dash:utc:ntp:2014":R,"urn:mpeg:dash:utc:sntp:2014":R}},attemptSync:function(e,t){u=e,n||(function(e){try{if(!e||!r.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(m)?30:m;return!(h&&t&&!isNaN(t))||(Date.now()-h)/1e3>=t}catch(e){return!0}}(t)?(n=!0,function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||0;if(!u||0===u.length||t>=u.length)C();else{var n=u[t];if(n)if(o.hasOwnProperty(n.schemeIdUri)){var i=(new Date).getTime();o[n.schemeIdUri](n.value,(function(e){var t=(new Date).getTime(),r=k(i,t,e);g=n,C(r)}),(function(){e(t+1)}))}else e(t+1);else C()}}()):_.trigger(c.Z.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(s=e.dashMetrics),e.baseURLController&&(y=e.baseURLController),e.errHandler&&(b=e.errHandler),e.settings&&(r=e.settings))},reset:function(){x(),_.off(c.Z.ATTEMPT_BACKGROUND_SYNC,w,e)}},t=(0,d.Z)(v).getInstance().getLogger(e),_.on(c.Z.ATTEMPT_BACKGROUND_SYNC,w,e),e}Gt.__dashjs_factory_name="TimeSyncController";var Vt=u.Z.getSingletonFactory(Gt);Vt.HTTP_TIMEOUT_MS=5e3,u.Z.updateSingletonFactory(Gt.__dashjs_factory_name,Vt);var Wt=Vt;function zt(){var e,t,n,i,r,o=this.context,s=(0,l.Z)(o).getInstance();return e={attachMediaSource:function(e){var n=window.URL.createObjectURL(t);return e.setSource(n),"managedMediaSource"===i&&(e.setDisableRemotePlayback(!0),t.addEventListener("startstreaming",(function(){s.trigger(h.Z.MANAGED_MEDIA_SOURCE_START_STREAMING)})),t.addEventListener("endstreaming",(function(){s.trigger(h.Z.MANAGED_MEDIA_SOURCE_END_STREAMING)}))),n},createMediaSource:function(){var e="WebKitMediaSource"in window,n="MediaSource"in window;return"ManagedMediaSource"in window?(t=new ManagedMediaSource,i="managedMediaSource",r.info("Created ManagedMediaSource")):n?(t=new MediaSource,i="mediaSource",r.info("Created MediaSource")):e&&(t=new WebKitMediaSource,r.info("Created WebkitMediaSource")),t},detachMediaSource:function(e){e.setSource(null)},setConfig:function(e){e&&e.settings&&(n=e.settings)},setDuration:function e(i){t&&"open"===t.readyState&&(null===i&&isNaN(i)||t.duration!==i&&(i!==1/0||n.get().streaming.buffer.mediaSourceDurationInfinity||(i=Math.pow(2,32)),function(e){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating)return!0;return!1}(t)?setTimeout(e.bind(null,i),50):(r.info("Set MediaSource duration:"+i),t.duration=i)))},setSeekable:function(e,n){t&&"function"==typeof t.setLiveSeekableRange&&"function"==typeof t.clearLiveSeekableRange&&"open"===t.readyState&&e>=0&&e<n&&(t.clearLiveSeekableRange(),t.setLiveSeekableRange(e,n))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,n=0;n<t.length;n++){if(t[n].updating)return;if(0===t[n].buffered.length)return}r.info("call to mediaSource endOfStream"),e.endOfStream()}}},r=(0,d.Z)(o).getInstance().getLogger(e),e}zt.__dashjs_factory_name="MediaSourceController";var qt=u.Z.getSingletonFactory(zt);function Yt(){var e,t,n,i,r,o,s,a,c,u,p,f="urn:mpeg:dash:event:2012",g="discarded",m="updated",b="added",y=this.context,v=(0,l.Z)(y).getInstance();function _(){if(!s||!a)throw new Error("setConfig function has to be called previously")}function E(){p=!1,n={},i={},r=null,u=!1,o=Date.now()/1e3}function T(){try{if(!u){u=!0;var e=a.getTime(),r=e-o;r=o>0?Math.max(0,r):0,x(i,r,e),x(n,r,e),w(i),w(n),o=e,u=!1}}catch(e){u=!1,t.error(e)}}function x(e,n,i){try{A(e,(function(r){if(void 0!==r){var o=isNaN(r.duration)?0:r.duration;r.calculatedPresentationTime<=i&&r.calculatedPresentationTime+n+o>=i?O(r,h.Z.EVENT_MODE_ON_START):(I(i,o+n,r.calculatedPresentationTime)||function(e){try{var n=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>n}catch(e){return t.error(e),!1}}(r))&&(t.debug("Removing event ".concat(r.id," from period ").concat(r.eventStream.period.id," as it is expired or invalid")),function(e,n){try{var i=n.eventStream.schemeIdUri,r=n.eventStream.period.id,o=n.eventStream.value,s=n.id;e[r][i]=e[r][i].filter((function(e){return o&&e.eventStream.value&&e.eventStream.value!==o||e.id!==s})),0===e[r][i].length&&delete e[r][i]}catch(e){t.error(e)}}(e,r))}}))}catch(e){t.error(e)}}function w(e){try{for(var n in e)e.hasOwnProperty(n)&&0===Object.keys(e[n]).length&&delete e[n]}catch(e){t.error(e)}}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.eventStream.schemeIdUri,r=e.eventStream.value,o=e.id,s=g;t[i]||(t[i]=[]);var a=t[i].findIndex((function(e){return(!r||e.eventStream.value&&e.eventStream.value===r)&&e.id===o}));if(-1===a)t[i].push(e),e.triggeredReceivedEvent=!1,e.triggeredStartEvent=!1,s=b;else if(n){var l=t[i][a];e.triggeredReceivedEvent=l.triggeredReceivedEvent,e.triggeredStartEvent=l.triggeredStartEvent,t[i][a]=e,s=m}return s}function S(e){try{if(1==e.eventStream.value){var n,i=e.calculatedPresentationTime;n=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,v.trigger(h.Z.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:i,newDuration:n,newManifestValidAfter:NaN},{mode:h.Z.EVENT_MODE_ON_START})}}catch(e){t.error(e)}}function C(e){try{var n=a.getTime();A(e,(function(e){var t=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.duration)?e.eventStream.period.duration:NaN,i=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.start)?e.eventStream.period.start:NaN;if(!isNaN(t)&&!isNaN(i)){var r=e.calculatedPresentationTime;Math.abs(r-n)<300&&O(e,h.Z.EVENT_MODE_ON_START)}}))}catch(e){t.error(e)}}function A(e,n){try{if(e)for(var i=Object.keys(e),r=0;r<i.length;r++)for(var o=e[i[r]],s=Object.keys(o),a=0;a<s.length;a++)o[s[a]].forEach((function(e){void 0!==e&&n(e)}))}catch(e){t.error(e)}}function I(e,n,i){try{return e-n>i}catch(e){return t.error(e),!1}}function O(e,n){try{var i=a.getTime(),r=e.id;if(n===h.Z.EVENT_MODE_ON_RECEIVE&&!e.triggeredReceivedEvent)return t.debug("Received event ".concat(r)),e.triggeredReceivedEvent=!0,void v.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n});e.triggeredStartEvent||(e.eventStream.schemeIdUri===f&&1==e.eventStream.value?0===e.duration&&0===e.presentationTimeDelta||(t.debug("Starting manifest refresh event ".concat(r," at ").concat(i)),function(){try{_(),s.refreshManifest()}catch(e){t.error(e)}}()):"urn:mpeg:dash:event:callback:2015"===e.eventStream.schemeIdUri&&1==e.eventStream.value?(t.debug("Starting callback event ".concat(r," at ").concat(i)),function(e){try{(0,se.Z)(y).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){t.error(e)}}(e.messageData)):(t.debug("Starting event ".concat(r," from period ").concat(e.eventStream.period.id," at ").concat(i)),v.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n})),e.triggeredStartEvent=!0)}catch(e){t.error(e)}}return e={addInlineEvents:function(e,i){try{if(_(),n[i]||(n[i]={}),e)for(var r=0;r<e.length;r++){var o=e[r];if(!I(a.getTime(),isNaN(o.duration)?0:o.duration,o.calculatedPresentationTime)){var s=k(o,n[i],!0);s===b?(t.debug("Added inline event with id ".concat(o.id," from period ").concat(i)),O(o,h.Z.EVENT_MODE_ON_RECEIVE)):s===m&&t.debug("Updated inline event with id ".concat(o.id," from period ").concat(i))}}}catch(e){throw e}},addInbandEvents:function(e,n){try{_(),i[n]||(i[n]={});for(var r=0;r<e.length;r++){var o=e[r];I(a.getTime(),isNaN(o.duration)?0:o.duration,o.calculatedPresentationTime)||(k(o,i[n],!1)===b?(o.eventStream.schemeIdUri===f&&S(o),t.debug("Added inband event with id ".concat(o.id," from period ").concat(n)),O(o,h.Z.EVENT_MODE_ON_RECEIVE)):t.debug("Inband event with scheme_id_uri ".concat(o.eventStream.schemeIdUri,", value ").concat(o.eventStream.value,", period id ").concat(n," and event id ").concat(o.id," was ignored because it has been added before.")))}T()}catch(e){throw e}},getInbandEvents:function(){return i},getInlineEvents:function(){return n},start:function(){try{_(),t.debug("Start Event Controller");var e=c.get().streaming.eventControllerRefreshDelay;p||isNaN(e)||(p=!0,r=setInterval(T,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(s=e.manifestUpdater),e.playbackController&&(a=e.playbackController),e.settings&&(c=e.settings)}catch(e){throw e}},reset:function(){(function(){try{null!==r&&p&&(clearInterval(r),r=null,p=!1,function(){try{C(i),C(n)}catch(e){t.error(e)}}())}catch(e){throw e}})(),E()}},t=(0,d.Z)(y).getInstance().getLogger(e),E(),e}Yt.__dashjs_factory_name="EventController";var Kt=u.Z.getSingletonFactory(Yt),Zt={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}};function Xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Jt(){var e,t,n,i,r,s,u,p,f,g,m,b,y,v,_,E,x,w,k,C,A,I,O,N,R,D,M,P,B,j,F,$,U,H,G,V,W,z,q,Y,K,Z,X,ee,te,ne,ie,re,oe=this.context,se=(0,l.Z)(oe).getInstance();function ae(){if(!(s&&s.hasOwnProperty("load")&&A&&A.hasOwnProperty("initialize")&&A.hasOwnProperty("reset")&&A.hasOwnProperty("getClientTimeOffset")&&u&&C&&f&&U))throw new Error(o.Z.MISSING_CONFIG_ERROR)}function le(){!function(){try{var e=p.getStreamsInfo();if(!O&&0===e.length)throw new Error("There are no periods in the MPD");O&&e.length>0&&f.updateManifestUpdateInfo({currentTime:U.getTime(),buffered:$.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:A.getClientTimeOffset()}),I.length>0&&function(e){0!==e.length?I=I.filter((function(n){var i=e.filter((function(e){return e.id===n.getId()})).length>0||n.getId()===O.getId();return i||(t.debug("Removing stream ".concat(n.getId())),n.reset(!0)),i})):t.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.")}(e);for(var n=[],i=0,r=e.length;i<r;i++){var o=e[i];n.push(ue(o)),f.addManifestUpdateStreamInfo(o)}Promise.all(n).then((function(){return new Promise((function(t,n){O?t():de(e,t,n)}))})).then((function(){se.trigger(c.Z.STREAMS_COMPOSED),Ne()})).catch((function(e){throw e}))}catch(e){C.error(new T.Z(S.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+" nostreamscomposed",u.getValue())),j=!0,Ze()}}()}function ce(){te=!0}function ue(e){var t=qe(e.id);return t?t.updateData(e):(t=Lt(oe).create({manifestModel:u,mediaPlayerModel:G,dashMetrics:f,manifestUpdater:r,adapter:p,timelineConverter:A,capabilities:n,capabilitiesFilter:i,errHandler:C,baseURLController:y,segmentBaseController:v,textController:R,abrController:E,playbackController:U,eventController:w,mediaController:x,protectionController:N,videoModel:$,streamInfo:e,settings:ee}),I.push(t),t.initialize(),Promise.resolve())}function de(e,n,i){try{xe();var r=f.getCurrentDVRInfo().range;if(r.end<r.start){ne&&clearTimeout(ne);var o=Math.min(1e3*(-1*(r.end-r.start)+2),2147483647);return t.debug("Waiting for ".concat(o," ms before playback can start")),se.trigger(c.Z.AST_IN_FUTURE,{delay:o}),void(ne=setTimeout((function(){de(e,n,i)}),o))}ee.get().streaming.applyProducerReferenceTime&&H.calculateProducerReferenceTimeOffsets(e);var s=e[0].manifestInfo;if(ee.get().streaming.applyServiceDescription&&H.applyServiceDescription(s),p.getIsDynamic()){var a=Fe(e,s);U.computeAndSetLiveDelay(a,s)}(ee.get().streaming.applyContentSteering&&b.shouldQueryBeforeStart()?b.loadSteeringData():Promise.resolve()).then((function(){var e=u.getValue();e&&y.update(e),he(),n()})).catch((function(e){t.error(e),he(),n()}))}catch(e){i(e)}}function he(){var e=function(){var e;if(p.getIsDynamic()){var n=f.getCurrentDVRInfo();e=(n&&n.range?n.range.end:0)-U.getOriginalLiveDelay();var i=n?n.range:null;if(i){if(isNaN(ie)&&-1===ie.toString().indexOf("posix:")){var r=Pe(!0);isNaN(r)||(t.info("Start time from URI parameters: ".concat(r)),e=Math.min(e,r))}else{t.info("Start time provided by the app: ".concat(ie));var o=Be(!0,ie);isNaN(o)||(e=Math.min(e,o))}var s=ee.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;e=Math.max(e,i.start+s)}}else if(e=Je()[0].getStreamInfo().start,isNaN(ie)){var a=Pe(!1);isNaN(a)||(t.info("Start time from URI parameters: ".concat(a)),e=Math.max(e,a))}else{t.info("Start time provided by the app: ".concat(ie));var l=Be(!1,ie);isNaN(l)||(e=Math.max(e,l))}return e}(),n=Te(e),i=null!==n?n:I[0];se.trigger(c.Z.INITIAL_STREAM_SWITCH,{startTime:e}),pe(i,null,e),Y||(Y=setInterval((function(){!P&&U.getTimeToStreamEnd()<=0&&!U.isSeeking()&&se.trigger(c.Z.PLAYBACK_ENDED,{isLast:ze().isLast})}),200))}function pe(e,n,i){try{if(P||!e||n===e&&e.getIsActive())return;P=!0,se.trigger(c.Z.PERIOD_SWITCH_STARTED,{fromStreamInfo:n?n.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var r=!1;O=e,n&&(r=_e(e,n),n.deactivate(r)),i=isNaN(i)?!r&&n?e.getStreamInfo().start:NaN:i,t.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(i,", current playback time is ").concat(U.getTime(),". Seamless period switch is set to ").concat(r)),Z=Z.filter((function(e){return e.getId()!==O.getId()})),U.initialize(ze(),!!n),$.getElement()?fe(i,r,!1):ge(i,r)}catch(e){P=!1}}function fe(e,n){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function o(){if(F&&"open"===F.readyState){t.debug("MediaSource is open!"),window.URL.revokeObjectURL(i),F.removeEventListener("sourceopen",o),F.removeEventListener("webkitsourceopen",o),Me();var s=f.getCurrentDVRInfo();g.setSeekable(s.range.start,s.range.end),r?(isNaN(e)||U.seek(e,!0,!0),O.setMediaSource(F).then((function(){O.initializeForTextWithMediaSource(F)}))):ge(e,n)}}function s(){F.addEventListener("sourceopen",o,!1),F.addEventListener("webkitsourceopen",o,!1),i=g.attachMediaSource($),t.debug("MediaSource attached to element.  Waiting on open...")}F?n?ge(e,n):(g.detachMediaSource($),s()):(F=g.createMediaSource(),s())}function ge(e,t){O.activate(F,t?K:void 0,e).then((function(t){if(t){var n=Object.keys(t);n.length>0&&t[n[0]].getBuffer().changeType&&(X=!0),K=t}isNaN(e)||(se.trigger(c.Z.SEEK_TARGET,{time:e},{streamId:O.getId()}),U.seek(e,!1,!0),O.startScheduleControllers()),P=!1,se.trigger(c.Z.PERIOD_SWITCH_COMPLETED,{toStreamInfo:ze()})}))}function me(e){var t=Te(e.seekTime);t&&t!==O?t&&t!==O&&(be(),function(e,t){var n=e&&!isNaN(e.seekTime)?e.seekTime:NaN,i=O.getProcessors().map((function(t){return t.prepareOuterPeriodPlaybackSeeking(e)}));Promise.all(i).then((function(){pe(t,O,n)})).catch((function(e){C.error(e)}))}(e,t)):(be(),function(e){O.getProcessors().forEach((function(t){return t.prepareInnerPeriodPlaybackSeeking(e)})),Ge(Q.USER_REQUEST_STOP_REASON)}(e)),Ve(J.SEEK_START_REASON)}function be(){ye()}function ye(){Z&&Z.length>0&&(Z.forEach((function(e){e.deactivate(!0)})),Z=[])}function ve(e){if(e.newMediaInfo.streamInfo.id===O.getId()){if(ye(),ee.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&e.oldMediaInfo&&e.oldMediaInfo.codec!==e.newMediaInfo.codec){var t=U.getTime();return O.deactivate(!1),void fe(t,!1,!1)}O.prepareTrackChange(e)}}function _e(e,t){try{return ee.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||te)&&(X&&ee.get().streaming.buffer.useChangeTypeForTrackSwitch||t.isMediaCodecCompatible(e,t))}catch(e){return!1}}function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;F&&!e.getPreloaded()&&_e(e,t)&&e.startPreloading(F,K).then((function(){Z.push(e)}))}function Te(e){if(isNaN(e))return null;for(var t=I.length,n=0;n<t;n++){var i=I[n];if(e<parseFloat((i.getStartTime()+i.getDuration()).toFixed(5)))return i}return null}function xe(){try{var e=p.getIsDynamic(),t=p.getStreamsInfo()[0].manifestInfo,n=U.getTime(),i=A.calcTimeShiftBufferWindow(I,e),r=De();if(void 0===i.start||void 0===i.end)return;r&&0!==r.length?r.forEach((function(e){f.addDVRInfo(e.getType(),n,t,i)})):f.addDVRInfo(o.Z.VIDEO,n,t,i)}catch(e){}}function we(e){if(z&&M){var t=G.getInitialBufferLevel(),n=[o.Z.TEXT];(isNaN(t)||t<=U.getBufferLevel(n)||p.getIsDynamic()&&t>U.getLiveDelay())&&(z=!1,Ve(J.INITIAL_PLAYOUT_START_REASON),U.play())}e&&e.mediaType&&f.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function ke(e){e.streamInfo.id===O.getId()&&e.reason&&e.reason.forceReplace&&ye(),qe(e.streamInfo.id).prepareQualityChange(e)}function Se(){if(p.getIsDynamic()&&0!==U.getOriginalLiveDelay()&&O){var e=p.getStreamsInfo();if(e.length>0){var t=e[0].manifestInfo,n=Fe(e,t);U.computeAndSetLiveDelay(n,t)}}}function Ce(){if(Ue()){var e=$.getPlaybackQuality();e&&f.addDroppedFrames(e)}}function Ae(){t.debug("[onPlaybackStarted]"),!z&&W&&Ve(J.RESUME_FROM_PAUSE_START_REASON),z&&(z=!1),q&&(q=!1,ee.get().streaming.applyContentSteering&&!b.shouldQueryBeforeStart()&&b.loadSteeringData()),W=!1}function Ie(e){t.debug("[onPlaybackPaused]"),e.ended||(W=!0,Ge(Q.USER_REQUEST_STOP_REASON))}function Oe(e){t.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var n=e.streamInfo.isLast;F&&n?(t.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),g.signalEndOfStream(F)):Ne()}function Ne(){if(O&&O.getHasFinishedBuffering())for(var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||O||null;if(t){var n=t.getStreamInfo();return I.filter((function(e){var t=e.getStreamInfo();return t.start>n.start&&n.id!==t.id}))}}catch(e){return[]}}(O),t=0;t<e.length;){var n=e[t],i=0===t?O:e[t-1];!n.getPreloaded()&&i.getHasFinishedBuffering()&&F&&Ee(n,i),t+=1}}function Re(){Y&&(clearInterval(Y),Y=null)}function De(){return O?O.getProcessors():[]}function Le(e){if(O&&!O.getIsEndedEventSignaled()){O.setIsEndedEventSignaled(!0);var n=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||O||null;if(!e)return null;for(var t=e.getStreamInfo(),n=t.start,i=0,r=-1,o=NaN;i<I.length;){var s=I[i].getStreamInfo(),a=s.start-n;a>0&&(isNaN(o)||a<o)&&t.id!==s.id&&(o=a,r=i),i+=1}return r>=0?I[r]:null}();n?(t.debug("StreamController onEnded, found next stream with id ".concat(n.getStreamInfo().id,". Switching from ").concat(O.getStreamInfo().id," to ").concat(n.getStreamInfo().id)),pe(n,O,NaN)):(t.debug("StreamController no next stream found"),O.setIsEndedEventSignaled(!1)),Ge(n?Q.END_OF_PERIOD_STOP_REASON:Q.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&(Re(),b.stopSteeringRequestTimer())}function Me(e){var t=e||ze().manifestInfo.duration;g.setDuration(t)}function Pe(e){var t=_.getURIFragmentData();if(!t||!t.t)return NaN;var n=Je()[0].getStreamInfo().start;return t.t=t.t.split(",")[0],je(e,t.t,n)}function Be(e,t){var n=0;return e||(n=Je()[0].getStreamInfo().start),je(e,t,n)}function je(e,t,n){var i=p.getRegularPeriods()[0],r=t.toString(),o=-1!==r.indexOf("posix:")?"now"===r.substring(6)?Date.now()/1e3:parseFloat(r.substring(6)):NaN;return e&&!isNaN(o)?A.calcPresentationTimeFromWallTime(new Date(1e3*o),i):parseFloat(r)+n}function Fe(e,t){try{var n=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var i=e[0],r=[o.Z.VIDEO,o.Z.AUDIO,o.Z.TEXT].reduce((function(e,t){var n=p.getMediaInfoForType(i,t);return n&&!1!==n.isFragmented&&e.push(n),e}),[]).reduce((function(e,t){var n=p.getVoRepresentations(t);return n&&n.length>0&&n.forEach((function(t){t&&e.push(t)})),e}),[]).reduce((function(e,t){var n=p.convertRepresentationToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e}),[]);n=Math.max.apply(Math,function(e){if(Array.isArray(e))return Xt(e)}(s=r)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return Xt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xt(e,t):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return isFinite(n)?n:NaN}catch(e){return NaN}var s}function $e(e){if(e.error)j=!0,Ze();else{t.info("Manifest updated... updating data system wide.");var n=e.manifest;p.updatePeriods(n);var r=p.getUTCTimingSources();!p.getIsDynamic()||r&&0!==r.length||se.trigger(h.Z.CONFORMANCE_VIOLATION,{level:Zt.LEVELS.WARNING,event:Zt.EVENTS.NO_UTC_TIMING_ELEMENT});var o=p.getIsDynamic()?r.concat(V.getUTCTimingSources()):r;i.filterUnsupportedFeatures(n).then((function(){y.initialize(n),m.attemptSync(o,p.getIsDynamic())}))}}function Ue(){return!!O&&O.getHasVideoTrack()}function He(){return!!O&&O.getHasAudioTrack()}function Ge(e,t){t=t||new Date,De().forEach((function(n){n.finalisePlayList(t,e)})),f.addPlayList()}function Ve(e){f.createPlaylistMetrics(1e3*U.getTime(),e)}function We(e){if(e.error){var n="";switch(e.error.code){case 1:n="MEDIA_ERR_ABORTED";break;case 2:n="MEDIA_ERR_NETWORK";break;case 3:n="MEDIA_ERR_DECODE",re.counts.mediaErrorDecode+=1;break;case 4:n="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:n="MEDIA_ERR_ENCRYPTED";break;default:n="UNKNOWN"}"MEDIA_ERR_DECODE"===n&&ee.get().errors.recoverAttempts.mediaErrorDecode>=re.counts.mediaErrorDecode?function(){t.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=U.getTime();O.deactivate(!1),t.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),fe(e,!1,!1)}():(B=!0,e.error.message&&(n+=" ("+e.error.message+")"),e.error.msExtendedCode&&(n+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t.fatal("Video Element Error: "+n),e.error&&t.fatal(e.error),C.error(new T.Z(e.error.code,n)),Ze())}}function ze(){return O?O.getStreamInfo():null}function qe(e){for(var t=0,n=I.length;t<n;t++)if(I[t].getId()===e)return I[t];return null}function Ye(e){isNaN(e.newDuration)||Me(e.newDuration)}function Ke(){I=[],ie=NaN,N=null,P=!1,O=null,B=!1,j=!1,z=!0,q=!0,W=!1,M=!0,Y=null,te=!1,X=!1,Z=[],ne=null,re={counts:{mediaErrorDecode:0}}}function Ze(){ae(),m.reset(),Ge(B||j?Q.FAILURE_STOP_REASON:Q.USER_REQUEST_STOP_REASON);for(var t=0,n=I?I.length:0;t<n;t++)I[t].reset(B);se.off(h.Z.PLAYBACK_TIME_UPDATED,Ce,e),se.off(h.Z.PLAYBACK_SEEKING,me,e),se.off(h.Z.PLAYBACK_ERROR,We,e),se.off(h.Z.PLAYBACK_STARTED,Ae,e),se.off(h.Z.PLAYBACK_PAUSED,Ie,e),se.off(h.Z.PLAYBACK_ENDED,Le,e),se.off(h.Z.METRIC_ADDED,Xe,e),se.off(h.Z.MANIFEST_VALIDITY_CHANGED,Ye,e),se.off(h.Z.BUFFER_LEVEL_UPDATED,we,e),se.off(h.Z.QUALITY_CHANGE_REQUESTED,ke,e),c.Z.KEY_SESSION_UPDATED&&se.off(c.Z.KEY_SESSION_UPDATED,ce,e),se.off(c.Z.MANIFEST_UPDATED,$e,e),se.off(c.Z.STREAM_BUFFERING_COMPLETED,Oe,e),se.off(c.Z.TIME_SYNCHRONIZATION_COMPLETED,le,e),se.off(c.Z.CURRENT_TRACK_CHANGED,ve,e),se.off(c.Z.SETTING_UPDATED_LIVE_DELAY,Se,e),se.off(c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Se,e),y.reset(),r.reset(),w.reset(),f.clearAllCurrentMetrics(),u.setValue(null),s.reset(),A.reset(),k.reset(),F&&(g.detachMediaSource($),F=null),$=null,N&&(N=null,D=null,u.getValue()&&se.trigger(c.Z.PROTECTION_DESTROYED,{data:u.getValue().url})),Re(),se.trigger(c.Z.STREAM_TEARDOWN_COMPLETE),Ke()}function Xe(e){if(e.metric===a.Z.DVR_INFO){var t=He()?o.Z.AUDIO:o.Z.VIDEO;e.mediaType===t&&g.setSeekable(e.value.range.start,e.value.range.end)}}function Je(){return I}return e={initialize:function(t,n){ae(),M=t,D=n,A.initialize(),(r=Ht(oe).create()).setConfig({manifestModel:u,adapter:p,manifestLoader:s,errHandler:C,settings:ee,contentSteeringController:b}),r.initialize(),(w=Kt(oe).getInstance()).setConfig({manifestUpdater:r,playbackController:U,settings:ee}),w.start(),m.setConfig({dashMetrics:f,baseURLController:y,errHandler:C,settings:ee}),m.initialize(),g.setConfig({settings:ee}),N&&(se.trigger(c.Z.PROTECTION_CREATED,{controller:N}),N.setMediaElement($.getElement()),D&&N.setProtectionData(D)),se.on(h.Z.PLAYBACK_TIME_UPDATED,Ce,e),se.on(h.Z.PLAYBACK_SEEKING,me,e),se.on(h.Z.PLAYBACK_ERROR,We,e),se.on(h.Z.PLAYBACK_STARTED,Ae,e),se.on(h.Z.PLAYBACK_PAUSED,Ie,e),se.on(h.Z.PLAYBACK_ENDED,Le,e),se.on(h.Z.METRIC_ADDED,Xe,e),se.on(h.Z.MANIFEST_VALIDITY_CHANGED,Ye,e),se.on(h.Z.BUFFER_LEVEL_UPDATED,we,e),se.on(h.Z.QUALITY_CHANGE_REQUESTED,ke,e),c.Z.KEY_SESSION_UPDATED&&se.on(c.Z.KEY_SESSION_UPDATED,ce,e),se.on(c.Z.MANIFEST_UPDATED,$e,e),se.on(c.Z.STREAM_BUFFERING_COMPLETED,Oe,e),se.on(c.Z.TIME_SYNCHRONIZATION_COMPLETED,le,e),se.on(c.Z.CURRENT_TRACK_CHANGED,ve,e),se.on(c.Z.SETTING_UPDATED_LIVE_DELAY,Se,e),se.on(c.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Se,e)},getActiveStreamInfo:ze,addDVRMetric:xe,hasVideoTrack:Ue,hasAudioTrack:He,getStreamById:qe,getStreamForTime:Te,getTimeRelativeToStreamId:function(e,t){for(var n=null,i=0,r=0,o=null,s=0;s<I.length;s++){if(r=(n=I[s]).getStartTime(),o=n.getDuration(),Number.isFinite(r)&&(i=r),n.getId()===t)return e-i;Number.isFinite(o)&&(i+=o)}return null},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;ae(),ie=t,s.load(e)},loadWithManifest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;(function(){if(!r||!r.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")})(),ie=t,r.setManifest(e)},getActiveStreamProcessors:De,setConfig:function(e){e&&(e.capabilities&&(n=e.capabilities),e.capabilitiesFilter&&(i=e.capabilitiesFilter),e.manifestLoader&&(s=e.manifestLoader),e.manifestModel&&(u=e.manifestModel),e.mediaPlayerModel&&(G=e.mediaPlayerModel),e.customParametersModel&&(V=e.customParametersModel),e.protectionController&&(N=e.protectionController),e.adapter&&(p=e.adapter),e.dashMetrics&&(f=e.dashMetrics),e.errHandler&&(C=e.errHandler),e.timelineConverter&&(A=e.timelineConverter),e.videoModel&&($=e.videoModel),e.playbackController&&(U=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(b=e.contentSteeringController),e.textController&&(R=e.textController),e.abrController&&(E=e.abrController),e.mediaController&&(x=e.mediaController),e.settings&&(ee=e.settings),e.baseURLController&&(y=e.baseURLController),e.uriFragmentModel&&(_=e.uriFragmentModel),e.segmentBaseController&&(v=e.segmentBaseController),e.manifestUpdater&&(r=e.manifestUpdater))},setProtectionData:function(e){D=e,N&&N.setProtectionData(D)},getIsStreamSwitchInProgress:function(){return P},switchToVideoElement:function(e){O&&(U.initialize(ze()),fe(e,!1,!0))},getHasMediaOrInitialisationError:function(){return B||j},getStreams:Je,getActiveStream:function(){return O},getInitialPlayback:function(){return z},getAutoPlay:function(){return M},refreshManifest:function(){r.getIsUpdating()||r.refreshManifest()},reset:Ze},t=(0,d.Z)(oe).getInstance().getLogger(e),m=Wt(oe).getInstance(),g=qt(oe).getInstance(),k=L(oe).getInstance(),Ke(),e}Jt.__dashjs_factory_name="StreamController";var Qt=u.Z.getSingletonFactory(Jt);function en(){var e,t,n,i,r,s,a,u,h,p,f,g,m=this.context,b=(0,l.Z)(m).getInstance();function y(){g.debug("Stopping the gap controller"),r&&(clearInterval(r),r=null),function(){b.off(c.Z.WALLCLOCK_TIME_UPDATED,x,this),b.off(c.Z.INITIAL_STREAM_SWITCH,T,this),b.off(c.Z.PLAYBACK_SEEKING,v,this),b.off(c.Z.BUFFER_REPLACEMENT_STARTED,_,e),b.off(c.Z.TRACK_CHANGE_RENDERED,E,e)}(),r=null,s=NaN,i=0,p=null,f={}}function v(){p&&(clearTimeout(p),p=null)}function _(e){try{if(e.streamId!==u.getActiveStreamInfo().id||e.mediaType!==o.Z.VIDEO&&e.mediaType!==o.Z.AUDIO)return;e.streamId===u.getActiveStreamInfo().id&&(f[e.mediaType]=!0)}catch(e){g.error(e)}}function E(e){e&&e.mediaType&&(f[e.mediaType]=!1)}function T(){r||function(){try{r||(g.debug("Starting the gap controller"),r=setInterval((function(){w()&&k(a.getTime())}),100))}catch(e){}}()}function x(){if(w(n.get().streaming.gaps.enableSeekFix)&&++i>=10){var e=a.getTime();t===e?k(e,!0):(t=e,s=NaN),i=0}}function w(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u.getActiveStream())return!1;var t=Object.keys(f).some((function(e){return f[e]})),i=!!e&&function(){var e=u.getActiveStream(),t=parseFloat((e.getStartTime()+e.getDuration()).toFixed(5));return a.getTime()+n.get().streaming.gaps.threshold>=t}();return!t&&n.get().streaming.gaps.jumpGaps&&u.getActiveStreamProcessors().length>0&&(!a.isSeeking()||i)&&!a.isPaused()&&!u.getIsStreamSwitchInProgress()&&!u.getHasMediaOrInitialisationError()}function k(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.get().streaming.gaps.enableStallFix,o=n.get().streaming.gaps.stallSeek,l=n.get().streaming.gaps.smallGapLimit,c=n.get().streaming.gaps.jumpLargeGaps,d=h.getBufferRange(),f=NaN,m=!1;if(t=function(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var i=NaN,r=0;isNaN(i)&&r<e.length;){var o=r>0?e.end(r-1):0;t<e.start(r)&&o-t<n.get().streaming.gaps.threshold&&(i=r),r+=1}return i}catch(e){return null}}(d,e),!isNaN(t)){var b=d.start(t),y=b-e;y>0&&(y<=l||c)&&(f=b)}var v=a.getTimeToStreamEnd();if(isNaN(f)&&i&&isFinite(v)&&!isNaN(v)&&v<l&&(f=parseFloat(a.getStreamEndTime().toFixed(5)),m=!0),r&&isNaN(f)&&i&&isNaN(t)&&function(e,t){for(var n=0,i=e.length;n<i;n++)if(t>=e.start(n)&&t<=e.end(n))return!0;return!1}(d,e)&&(0===o?(g.warn("Toggle play pause to break stall"),h.pause(),h.play()):(g.warn("Jumping ".concat(o,"s to break stall")),f=e+o)),f>0&&s!==f&&f>e&&!p){var _=f-e;if(m){var E=u.getStreamForTime(f),T=E&&!!E.getPreloaded();g.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(f,". Gap duration: ").concat(_)),a.seek(f,!0,T)}else{var x=a.getIsDynamic(),w=t>0?d.end(t-1):e,k=x?1e3*Math.max(0,_-.1):0;p=window.setTimeout((function(){a.seek(f,!0,!0),g.warn("Jumping gap occuring in period ".concat(u.getActiveStream().getStreamId()," starting at ").concat(w," and ending at ").concat(f,". Jumping by: ").concat(f-w)),p=null}),k)}s=f}}return e={reset:y,setConfig:function(e){e&&(e.settings&&(n=e.settings),e.playbackController&&(a=e.playbackController),e.streamController&&(u=e.streamController),e.videoModel&&(h=e.videoModel))},initialize:function(){!function(){b.on(c.Z.WALLCLOCK_TIME_UPDATED,x,this),b.on(c.Z.INITIAL_STREAM_SWITCH,T,this),b.on(c.Z.PLAYBACK_SEEKING,v,this),b.on(c.Z.BUFFER_REPLACEMENT_STARTED,_,e),b.on(c.Z.TRACK_CHANGE_RENDERED,E,e)}()}},g=(0,d.Z)(m).getInstance().getLogger(e),y(),e}en.__dashjs_factory_name="GapController";var tn=u.Z.getSingletonFactory(en);function nn(){var e,t,n,i,r,s,u,p,f,g,m=this.context,b=(0,l.Z)(m).getInstance();function y(){t=!1;var e=$e.Z.parseUserAgent();n=e&&e.browser&&e.browser.name&&"safari"===e.browser.name.toLowerCase()}function v(){t=!1}function _(e){if(e.streamId===s.getActiveStreamInfo().id&&f){var t=u.getLiveDelay();u.getBufferLevel()>t/2&&(f=!1)}}function E(e){e.streamId===s.getActiveStreamInfo().id&&(f=e.state===a.Z.BUFFER_EMPTY)}function T(){p.getCatchupModeEnabled()||i.setPlaybackRate(1)}function x(){u.getIsDynamic()&&p.getCatchupModeEnabled()&&(p.getCatchupPlaybackRates().max>0||p.getCatchupPlaybackRates().min<0)&&!u.isPaused()&&!u.isSeeking()&&function(){try{return!(!u.getTime()>0||t)&&(k()===o.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t){try{return Math.abs(w())>0||e<t}catch(e){return!1}}(u.getBufferLevel(),r.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(w())>0}catch(e){return!1}}())}catch(e){return!1}}()&&function(){if(!t&&i){var e,s=i.getPlaybackRate(),a=p.getCatchupPlaybackRates(),l=u.getBufferLevel(),c=w(),d=p.getCatchupMaxDrift();if(!isNaN(d)&&d>0&&c>d)g.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),t=!0,u.seekToCurrentLive(!0,!1);else{var h=u.getCurrentLiveLatency(),m=u.getLiveDelay();e=k()===o.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t,n,i,r){var o;if(r<i){var s=Math.abs(e.min),a=5*(r-i);o=1-s+2*s/(1+Math.pow(Math.E,-a)),g.debug("[LoL+ playback control_buffer-based] bufferLevel: "+r+", newRate: "+o)}else{if(Math.abs(t-n)<=.02*n)o=1;else{var l=t-n,c=l<0?Math.abs(e.min):e.max,u=5*l;o=1-c+2*c/(1+Math.pow(Math.E,-u))}g.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+o)}return o}(a,h,m,r.get().streaming.liveCatchup.playbackBufferMin,l):function(e,t,n,i){if(f)return 1;var r=h-n,o=r<0?Math.abs(e.min):e.max,s=5*r,a=1-o+2*o/(1+Math.pow(Math.E,-s));return u.getPlaybackStalled()&&i<=n/2&&r>0&&(a=1),a}(a,0,m,l);var b=n?.25:.02/(.5/a.max);e&&Math.abs(s-e)>=b&&(g.debug("[CatchupController]: Setting playback rate to ".concat(e)),i.setPlaybackRate(e))}}}()}function w(){return u.getCurrentLiveLatency()-u.getLiveDelay()}function k(){var e=r.get().streaming.liveCatchup.playbackBufferMin;return r.get().streaming.liveCatchup.mode!==o.Z.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?o.Z.LIVE_CATCHUP_MODE_DEFAULT:o.Z.LIVE_CATCHUP_MODE_LOLP}function S(){p.getCatchupPlaybackRates(!0)}return e={reset:function(){b.off(h.Z.BUFFER_LEVEL_UPDATED,_,e),b.off(h.Z.BUFFER_LEVEL_STATE_CHANGED,E,e),b.off(h.Z.PLAYBACK_PROGRESS,x,e),b.off(h.Z.PLAYBACK_TIME_UPDATED,x,e),b.off(h.Z.PLAYBACK_SEEKED,v,e),b.off(c.Z.SETTING_UPDATED_CATCHUP_ENABLED,T,e),b.off(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,S,e),b.off(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,S,e),b.off(h.Z.STREAM_INITIALIZED,S,e),y(),i.setPlaybackRate(1,!0)},setConfig:function(e){e&&(e.settings&&(r=e.settings),e.videoModel&&(i=e.videoModel),e.streamController&&(s=e.streamController),e.playbackController&&(u=e.playbackController),e.mediaPlayerModel&&(p=e.mediaPlayerModel))},initialize:function(){b.on(h.Z.BUFFER_LEVEL_UPDATED,_,e),b.on(h.Z.BUFFER_LEVEL_STATE_CHANGED,E,e),b.on(h.Z.PLAYBACK_PROGRESS,x,e),b.on(h.Z.PLAYBACK_TIME_UPDATED,x,e),b.on(h.Z.PLAYBACK_SEEKED,v,e),b.on(c.Z.SETTING_UPDATED_CATCHUP_ENABLED,T,e),b.on(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,S,e),b.on(c.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,S,e),b.on(h.Z.STREAM_INITIALIZED,S,e),S()}},g=(0,d.Z)(m).getInstance().getLogger(e),y(),e}nn.__dashjs_factory_name="CatchupController";var rn=u.Z.getSingletonFactory(nn),on=[o.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME],sn="video",an="audio";function ln(){var e,t,n,i,r,a=this.context;function l(){t={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null},n=[]}function c(e,n,r){try{t[e][n]=r/1e3}catch(e){i.error(e)}}return e={getServiceDescriptionSettings:function(){return t},getProducerReferenceTimeOffsets:function(){return n},calculateProducerReferenceTimeOffsets:function(e){try{var t=[];if(e&&e.length>0){var a=[o.Z.VIDEO,o.Z.AUDIO,o.Z.TEXT],l=r.getAvailabilityStartTime()/1e3;e.forEach((function(e){var n=a.reduce((function(t,n){return t.concat(r.getAllMediaInfoForType(e,n))}),[]).reduce((function(t,n){return r.getProducerReferenceTimes(e,n).forEach((function(i){var o=r.getVoRepresentations(n);if(o&&o.length>0&&o[0].adaptation&&o[0].segmentInfoType===s.Z.SEGMENT_TEMPLATE){var a=o[0],c=new Date(i[s.Z.WALL_CLOCK_TIME]).getTime()/1e3-(i[s.Z.PRESENTATION_TIME]/a[s.Z.TIMESCALE]-a[s.Z.PRESENTATION_TIME_OFFSET]+e.start),u=l-c;t.push({id:i[s.Z.ID],to:u})}})),t}),[]);t=t.concat(n)}))}n=t}catch(e){i.error(e),n=[]}},applyServiceDescription:function(e){if(e&&e.serviceDescriptions){var r=e.serviceDescriptions.filter((function(e){return on.includes(e.schemeIdUri)})),s=e.serviceDescriptions.filter((function(e){return null==e.schemeIdUri})),a=r.length>0?r[r.length-1]:s[s.length-1];a&&(a.latency&&a.latency.target>0&&function(e){var r;if(e.schemeIdUri,o.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME,r=function(e){return{liveDelay:e.latency.target/1e3,maxDrift:!isNaN(e.latency.max)&&e.latency.max>e.latency.target?(e.latency.max-e.latency.target+500)/1e3:NaN,referenceId:e.latency.referenceId||NaN}}(e),n.length>0){var s=function(e){var t,i=0,r=n.filter((function(t){return t.id===e.referenceId}));return 0===r.length?(i=n.length>0?n[0].to:0,t=n[0].id||NaN):(i=r[0].to||0,t=r[0].id||NaN),{to:i,id:t}}(r),a=s.to,l=s.id;t.liveDelay=r.liveDelay-a,t.liveCatchup.maxDrift=r.maxDrift,i.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(a," from ProducerReferenceTime element with id ").concat(l,".\n                Live Delay: ").concat(r.liveDelay-a,", Live catchup max drift: ").concat(r.maxDrift,"\n            "))}else t.liveDelay=r.liveDelay,t.liveCatchup.maxDrift=r.maxDrift,i.debug("Found latency properties coming from service description: Live Delay: ".concat(r.liveDelay,", Live catchup max drift: ").concat(r.maxDrift))}(a),a.playbackRate&&function(e){var n=e.playbackRate.min?Math.round(1e3*(e.playbackRate.min-1))/1e3:NaN,r=e.playbackRate.max?Math.round(1e3*(e.playbackRate.max-1))/1e3:NaN;t.liveCatchup.playbackRate.min=n,t.liveCatchup.playbackRate.max=r,i.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(n)),i.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(r))}(a),a.operatingQuality,a.operatingBandwidth&&function(e){if(e&&e.operatingBandwidth&&e.operatingBandwidth.mediaType&&"all"!==e.operatingBandwidth.mediaType){var t={};t.minBandwidth=e.operatingBandwidth.min,t.maxBandwidth=e.operatingBandwidth.max,t.targetBandwidth=e.operatingBandwidth.target;var n=[];e.operatingBandwidth.mediaType===sn||e.operatingBandwidth.mediaType===an?n.push(e.operatingBandwidth.mediaType):"any"===e.operatingBandwidth.mediaType&&(n.push(an),n.push(sn)),n.forEach((function(e){isNaN(t.minBandwidth)||c("minBitrate",e,t.minBandwidth),isNaN(t.maxBandwidth)||c("maxBitrate",e,t.maxBandwidth),isNaN(t.targetBandwidth)||c("initialBitrate",e,t.targetBandwidth)}))}}(a),a.contentSteering&&function(e){t.contentSteering=e.contentSteering}(a))}},reset:function(){l()},setConfig:function(e){e&&e.adapter&&(r=e.adapter)}},i=(0,d.Z)(a).getInstance().getLogger(e),l(),e}ln.__dashjs_factory_name="ServiceDescriptionController";var cn=u.Z.getSingletonFactory(ln),un=n(3973),dn=n.n(un),hn=n(3039);function pn(){var e,t,n,i,r,s,a,u,h=this.context,p=(0,l.Z)(h).getInstance();function f(e,t){return e&&n[t]&&n[t][e]?n[t][e].list:[]}function g(e,t){return e&&n[t]&&n[t][e]?n[t][e].current:null}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var r=e.type,a=e.streamInfo.id,l=g(r,a);if(n[a]&&n[a][r]&&(n[a][r].current=e,n[a][r].current&&(r!==o.Z.TEXT&&!v(e,l)||r===o.Z.TEXT&&e.isFragmented)&&p.trigger(c.Z.CURRENT_TRACK_CHANGED,{oldMediaInfo:l,newMediaInfo:e,switchMode:i.get().streaming.trackSwitchMode[r]},{streamId:a}),!t)){var d=function(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration,codec:e.codec};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);if(!d||!n[a][r].storeLastSettings)return;d.roles&&(d.role=d.roles[0],delete d.roles),d.accessibility&&(d.accessibility=d.accessibility[0]),d.audioChannelConfiguration&&(d.audioChannelConfiguration=d.audioChannelConfiguration[0]),s[r]=d,u.setSavedMediaSettings(r,d)}}}function b(e,t){e&&t&&(r[e]=t)}function y(e){return e?r[e]:null}function v(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=e.id===t.id,i=e.viewpoint===t.viewpoint,r=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),o=e.lang===t.lang,s=e.codec===t.codec,a=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),c=e.accessibility.toString()===t.accessibility.toString(),u=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),h=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return n&&s&&i&&r&&o&&a&&l&&c&&u&&d&&h}function _(){n={},s={},r={audio:null,video:null,text:null}}function E(e,t,n){var i=[];return e.forEach((function(e){t(n,e)&&i.push(e)})),0!==i.length?i:e}function T(e,t){try{return!e.lang||e.lang instanceof RegExp?t.lang.match(e.lang):""!==t.lang&&(0,hn.extendedFilter)(t.lang,dn()(e.lang)).length>0}catch(e){return!1}}function x(e,t){return void 0===e.index||null===e.index||t.index===e.index}function w(e,t){return!e.viewpoint||e.viewpoint===t.viewpoint}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!e.role||!!t.roles.filter((function(t){return t===e.role}))[0]||t.type===o.Z.AUDIO&&n}function S(e,t){return e.accessibility?!!t.accessibility.filter((function(t){return t===e.accessibility}))[0]:!t.accessibility.length}function C(e,t){return!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0]}function A(e,t){return!e.codec||e.codec===t.codec}function I(e){var t,n=0,i=[];return e.forEach((function(e){(t=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))))>n?(n=t,i=[e]):t===n&&i.push(e)})),i}function O(e){var t,n=1/0,i=[];return e.forEach((function(e){var r=e.bitrateList.reduce((function(e,t){var n=Math.max(1,t.width*t.height);return e+t.bandwidth/n}),0);(t=r/e.bitrateList.length)<n?(n=t,i=[e]):t===n&&i.push(e)})),i}function N(e){var t,n=0,i=[];return e.forEach((function(e){(t=e.representationCount)>n?(n=t,i=[e]):t===n&&i.push(e)})),i}function R(e,n){if(e===o.Z.TEXT)return n[0];var r,s=i.get().streaming.selectionModeForInitialTrack,l=a.getCustomInitialTrackSelectionFunction();if(l&&"function"==typeof l)r=l(n);else switch(s){case o.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:r=function(e){var t,n,i=(t=0,n=[],e.forEach((function(e){isNaN(e.selectionPriority)||(e.selectionPriority>t?(t=e.selectionPriority,n=[e]):e.selectionPriority===t&&n.push(e))})),n);return i.length>1&&(i=I(i)),i.length>1&&(i=N(i)),i}(n);break;case o.Z.TRACK_SELECTION_MODE_HIGHEST_BITRATE:r=function(e){var t=I(n);return t.length>1&&(t=N(t)),t}();break;case o.Z.TRACK_SELECTION_MODE_FIRST_TRACK:r=D(n);break;case o.Z.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:r=function(e){var t=O(n);return t.length>1&&(t=I(t)),t}();break;case o.Z.TRACK_SELECTION_MODE_WIDEST_RANGE:r=function(e){var t=N(e);return t.length>1&&(t=I(e)),t}(n);break;default:t.warn("Track selection mode ".concat(s," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),r=D(n)}return r.length>0?r[0]:n[0]}function D(e){return e[0]}return e={setInitialMediaSettingsForType:function(e,t){var n=s[e]||y(e),i=f(e,t.id),r=[];n||((n=u.getSavedMediaSettings(e))&&delete n.codec,b(e,n)),i&&0!==i.length&&(n&&(r=E(r=Array.from(i),T,n),r=E(r,x,n),r=E(r,w,n),e===o.Z.AUDIO&&s[e]||(r=E(r,k,n)),r=E(r,S,n),r=E(r,C,n),r=E(r,A,n)),0===r.length?m(R(e,i),!0):r.length>1?m(R(e,r)):m(r[0]))},addTrack:function(e){if(e){var t=e.type;if((r=t)===o.Z.AUDIO||r===o.Z.VIDEO||r===o.Z.TEXT||r===o.Z.IMAGE){var r,s,a=e.streamInfo.id;n[a]||(n[a]={audio:{list:[],storeLastSettings:s=i.get().streaming.saveLastMediaSettingsForCurrentStreamingSession,current:null},video:{list:[],storeLastSettings:s,current:null},text:{list:[],storeLastSettings:s,current:null},image:{list:[],storeLastSettings:s,current:null}});for(var l=n[a][t].list,c=0,u=l.length;c<u;++c)if(v(l[c],e))return;l.push(e)}}},getTracksFor:f,getCurrentTrackFor:g,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,i=e.streamInfo.id;return n[i]&&n[i][t]&&v(n[i][t].current,e)},setTrack:m,selectInitialTrack:R,setInitialSettings:b,getInitialSettings:y,getTracksWithHighestBitrate:I,getTracksWithHighestEfficiency:O,getTracksWithWidestRange:N,isTracksEqual:v,matchSettings:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var i=!1;if(e.lang){if(e.lang instanceof RegExp)i=t.lang.match(e.lang);else if(""!==t.lang){var r=dn()(e.lang);r&&(i=(0,hn.extendedFilter)(t.lang,r).length>0)}}else i=!0;var s=void 0===e.index||null===e.index||t.index===e.index,a=!e.viewpoint||e.viewpoint===t.viewpoint,l=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0],c=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],u=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return i&&s&&a&&(l||t.type===o.Z.AUDIO&&n)&&c&&u}catch(e){return!1}},matchSettingsLang:T,matchSettingsIndex:x,matchSettingsViewPoint:w,matchSettingsRole:k,matchSettingsAccessibility:S,matchSettingsAudioChannelConfig:C,saveTextSettingsDisabled:function(){u.setSavedMediaSettings(o.Z.TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(u=e.domStorage),e.settings&&(i=e.settings),e.customParametersModel&&(a=e.customParametersModel))},reset:_},t=(0,d.Z)(h).getInstance().getLogger(e),_(),e}pn.__dashjs_factory_name="MediaController";var fn=u.Z.getSingletonFactory(pn);u.Z.updateSingletonFactory(pn.__dashjs_factory_name,fn);var gn=fn,mn=NaN,bn=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:n||mn},this.children=[]};function yn(){var e,t,n,i,r=this.context,o=Ae(r).getInstance();function s(e,t,n){var i=a(n);e[t]?o.areEqual(i,e[t].data.baseUrls)||(e[t].data.baseUrls=i,e[t].data.selectedIdx=mn):e[t]=new bn(i)}function a(e){var t=n.getBaseURLsFromElement(e),r=i.getSynthesizedBaseUrlElements(t);return r&&r.length>0&&(t=t.concat(r)),t}function l(){t=new bn}return e={reset:l,update:function(e){!function(e){!function(){if(!n||!n.hasOwnProperty("getBaseURLsFromElement")||!n.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var i=a(e);o.areEqual(i,t.data.baseUrls)||(t.data.baseUrls=i,t.data.selectedIdx=mn),e&&e.Period_asArray&&e.Period_asArray.forEach((function(e,i){s(t.children,i,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach((function(e,r){s(t.children[i].children,r,e),e.Representation_asArray&&e.Representation_asArray.sort(n.getRepresentationSortFunction()).forEach((function(e,n){s(t.children[i].children[r].children,n,e)}))}))}))}(e)},getForPath:function(e){var n=t,i=[n.data];return e&&e.forEach((function(e){(n=n.children[e])&&i.push(n.data)})),i.filter((function(e){return e.baseUrls.length}))},invalidateSelectedIndexes:function(e){!function e(n,i){var r=i||t;n(r.data),r.children&&r.children.forEach((function(t){return e(n,t)}))}((function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=mn)}))},setConfig:function(e){e.adapter&&(n=e.adapter),e.contentSteeringController&&(i=e.contentSteeringController)},getBaseUrls:function(e){return a(e)}},l(),e}yn.__dashjs_factory_name="BaseURLTreeModel";var vn=u.Z.getClassFactory(yn);function _n(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t,n,i=0,r=[],o=0;if((n=e.sort((function(e,t){var n=e.dvbPriority-t.dvbPriority;return isNaN(n)?0:n})).filter((function(e,t,n){return!t||n[0].dvbPriority&&e.dvbPriority&&n[0].dvbPriority===e.dvbPriority}))).length)return n.length>1&&(n.forEach((function(e){i+=e.dvbWeight,r.push(i)})),t=Math.floor(Math.random()*(i-1)),r.every((function(e,n){return o=n,!(t<e)}))),n[o]}((n=[],e.filter((function(e){return!t.contains(e.serviceLocation)||(e.dvbPriority&&n.push(e.dvbPriority),!1)})).filter((function(e){return!n.length||!e.dvbPriority||-1===n.indexOf(e.dvbPriority)}))));var n}}}_n.__dashjs_factory_name="DVBSelector";var En=u.Z.getClassFactory(_n);function Tn(e){var t=(e=e||{}).blacklistController;return{select:function(e){var n,i=0;return e&&e.some((function(e,n){return i=n,!t.contains(e.serviceLocation)}))&&(n=e[i]),n}}}Tn.__dashjs_factory_name="BasicSelector";var xn=u.Z.getClassFactory(Tn);function wn(){var e,t,n,i=this.context;function r(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=0,r=NaN,o=function(){var o=e[i],s=t.findIndex((function(e){return e.serviceLocation&&e.serviceLocation===o}));if(-1!==s&&!n.contains(t[s].serviceLocation))return r=s,"break";i+=1};i<e.length&&"break"!==o(););return r}return e={selectBaseUrlIndex:function(e){var n=NaN;if(isNaN(e.selectedIdx)){var i=t.getSteeringDataFromManifest();i&&i.defaultServiceLocationArray.length>0&&(n=r(i.defaultServiceLocationArray,e.baseUrls))}var o=t.getCurrentSteeringResponseData();return e.baseUrls&&e.baseUrls.length&&o&&o.pathwayPriority&&o.pathwayPriority.length&&(n=r(o.pathwayPriority,e.baseUrls)),n},setConfig:function(e){e.blacklistController&&(n=e.blacklistController),e.contentSteeringController&&(t=e.contentSteeringController)}},t=jt(i).getInstance(),e}wn.__dashjs_factory_name="ContentSteeringSelector";var kn=u.Z.getClassFactory(wn);function Sn(){var e,t,n,i,r,o,s=this.context,a=(0,l.Z)(s).getInstance(),u=(0,C.Z)(s).getInstance();function d(){t.reset()}return e={chooseSelector:function(e){(0,q.PS)(e,"boolean"),o=e?i:n},select:function(e){if(e){if(u.get().streaming.applyContentSteering){var t=r.selectBaseUrlIndex(e);isNaN(t)||-1===t||(e.selectedIdx=t)}if(!isNaN(e.selectedIdx))return e.baseUrls[e.selectedIdx];var i=o.select(e.baseUrls);return i?(e.selectedIdx=e.baseUrls.indexOf(i),i):(a.trigger(c.Z.URL_RESOLUTION_FAILED,{error:new T.Z(S.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,S.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(o===n&&d()))}},reset:d,setConfig:function(e){e.selector&&(o=e.selector),e.contentSteeringSelector&&(r=e.contentSteeringSelector)}},t=Nt(s).create({updateEventName:c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),n=xn(s).create({blacklistController:t}),i=En(s).create({blacklistController:t}),(r=kn(s).create()).setConfig({blacklistController:t}),o=n,e}Sn.__dashjs_factory_name="BaseURLSelector";var Cn=u.Z.getClassFactory(Sn);function An(){var e,t,n,i,r,o=this.context,s=(0,l.Z)(o).getInstance(),a=(0,Z.Z)(o).getInstance();function u(e){n.update(e),i.chooseSelector(t.getIsDVB(e)),s.trigger(h.Z.BASE_URLS_UPDATED,{baseUrls:d(e)})}function d(e){return n.getBaseUrls(e)}return e={reset:function(){n.reset(),i.reset()},initialize:function(e){n.setConfig({adapter:t,contentSteeringController:r}),u(e)},resolve:function(e){var t=n.getForPath(e).reduce((function(e,t){var n=i.select(t);return n?(a.isRelative(n.url)?e.url=a.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e.queryParams=n.queryParams,e):new _e}),new _e);if(!a.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(n=e.baseURLTreeModel),e.baseURLSelector&&(i=e.baseURLSelector),e.adapter&&(t=e.adapter),e.contentSteeringController&&(r=e.contentSteeringController)},getBaseUrls:d,update:u},n=vn(o).create(),i=Cn(o).create(),s.on(c.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,(function(e){n.invalidateSelectedIndexes(e.entry)}),e),e}An.__dashjs_factory_name="BaseURLController";var In=u.Z.getClassFactory(An);function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nn(e,t){return(Nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rn(e){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nn(e,t)}(r,g.Z);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=Rn(t);if(n){var r=Rn(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==On(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(e,t){var n;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(n=i.call(this)).url=e||null,n.type=t||null,n.mediaType=o.Z.STREAM,n.responseType="",n}return r}();function Ln(e){e=e||{};var t=this.context,n=(0,l.Z)(t).getInstance(),i=ft(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:S});return{load:function(e,t,r){var o=function(i,o){t.resolved=!0,t.resolvedContent=i||null,n.trigger(c.Z.XLINK_ELEMENT_LOADED,{element:t,resolveObject:r,error:i||o?null:new T.Z(S.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,S.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)o(null,!0);else{var s=new Dn(e,A.w.XLINK_EXPANSION_TYPE);i.load({request:s,success:function(e){o(e)},error:function(){o(null)}})}},reset:function(){i&&(i.abort(),i=null)}}}Ln.__dashjs_factory_name="XlinkLoader";var Mn=u.Z.getClassFactory(Ln),Pn=function(e){function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function i(e,t,n,i){for(var r=0;r<e.length;r++){var o=e[r];if("string"==typeof o){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if("function"==typeof o&&o(t,n,i))break}return r!=e.length}function r(t,n,r){"property"===e.arrayAccessForm&&(t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]),!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function o(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),i=t[5].split(".");if(n.setHours(t[3],t[4],i[0]),i.length>1&&n.setMilliseconds(i[1]),t[6]&&t[7]){var r=60*t[6]+Number(t[7]);r=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*r:r),n.setMinutes(n.getMinutes()-r-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function s(t,n,r,o){return!(1==n&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,t,r,o)}function a(n,l){if(9==n.nodeType){for(var c=new Object,u=n.childNodes,d=0;d<u.length;d++)1==(p=u[d]).nodeType&&(e.ignoreRoot?c=a(p):(c={})[f=t(p)]=a(p));return c}if(1==n.nodeType){(c=new Object).__cnt=0;var h=[];for(u=n.childNodes,d=0;d<u.length;d++){var p,f=t(p=u[d]);if(8!=p.nodeType){var g=l+"."+f;if(s(c,p.nodeType,f,g))if(c.__cnt++,null==c[f]){var m=a(p,g);("#text"!=f||/[^\s]/.test(m))&&((b={})[f]=m,h.push(b)),c[f]=m,r(c,f,g)}else{var b;null!=c[f]&&(c[f]instanceof Array||(c[f]=[c[f]],r(c,f,g))),m=a(p,g),("#text"!=f||/[^\s]/.test(m))&&((b={})[f]=m,h.push(b)),c[f][c[f].length]=m}}}c.__children=h;for(var y=t(n),v=0;v<n.attributes.length;v++){var _=n.attributes[v];c.__cnt++;for(var E=_.value,T=0,x=e.matchers.length;T<x;T++){var w=e.matchers[T];w.test(_,y)&&(E=w.converter(_.value))}c[e.attributePrefix+_.name]=E}var k=n.prefix;return null!=k&&""!=k&&(c.__cnt++,c.__prefix=k),null!=c["#text"]&&(c.__text=c["#text"],c.__text instanceof Array&&(c.__text=c.__text.join("\n")),e.stripWhitespaces&&(c.__text=c.__text.trim()),delete c["#text"],"property"==e.arrayAccessForm&&delete c["#text_asArray"],c.__text=function(t,n,r){if(e.datetimeAccessFormPaths.length>0){var s=r.split(".#")[0];return i(e.datetimeAccessFormPaths,t,n,s)?o(t):t}return t}(c.__text,f,l+"."+f)),null!=c["#cdata-section"]&&(c.__cdata=c["#cdata-section"],delete c["#cdata-section"],"property"==e.arrayAccessForm&&delete c["#cdata-section_asArray"]),0==c.__cnt&&"text"==e.emptyNodeForm?c="":1==c.__cnt&&null!=c.__text?c=c.__text:1!=c.__cnt||null==c.__cdata||e.keepCData?c.__cnt>1&&null!=c.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==c.__text||""==c.__text.trim())&&delete c.__text:c=c.__cdata,delete c.__cnt,!e.enableToStringFunc||null==c.__text&&null==c.__cdata||(c.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),c}if(3==n.nodeType||4==n.nodeType)return n.nodeValue}function l(t,i,r,o){var s="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var a=0;a<r.length;a++){var l=r[a],c=t[l];e.escapeMode&&(c=n(c)),s+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?s+='"'+c+'"':s+="'"+c+"'"}return s+(o?"/>":">")}function c(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function u(t,n){return"property"==e.arrayAccessForm&&(r="_asArray",-1!==(i=n.toString()).indexOf(r,i.length-r.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var i,r}function d(e){var t=0;if(e instanceof Object)for(var n in e)u(e,n)||t++;return t}function h(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||i(e.jsonPropertiesFilter,t,n,r)}function p(t){var n=[];if(t instanceof Object)for(var i in t)-1==i.toString().indexOf("__")&&0==i.toString().indexOf(e.attributePrefix)&&n.push(i);return n}function f(t){var i="";return t instanceof Object?i+=function(t){var i="";return null!=t.__cdata&&(i+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?i+=n(t.__text):i+=t.__text),i}(t):null!=t&&(e.escapeMode?i+=n(t):i+=t),i}function g(e,t){return""===e?t:e+"."+t}function m(e,t,n,i){var r="";if(0==e.length)r+=l(e,t,n,!0);else for(var o=0;o<e.length;o++)r+=l(e[o],t,p(e[o]),!1),r+=b(e[o],g(i,t)),r+=c(e[o],t);return r}function b(e,t){var n="";if(d(e)>0)for(var i in e)if(!u(e,i)&&(""==t||h(e,i,g(t,i)))){var r=e[i],o=p(r);null==r||null==r?n+=l(r,i,o,!0):r instanceof Object?r instanceof Array?n+=m(r,i,o,t):r instanceof Date?(n+=l(r,i,o,!1),n+=r.toISOString(),n+=c(r,i)):d(r)>0||null!=r.__text||null!=r.__cdata?(n+=l(r,i,o,!1),n+=b(r,g(t,i)),n+=c(r,i)):n+=l(r,i,o,!0):(n+=l(r,i,o,!1),n+=f(r),n+=c(r,i))}return n+f(e)}void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1),this.parseXmlString=function(e){var t;if(window.ActiveXObject||window,void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?o(e):e},this.xml2json=function(e){return a(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return b(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Bn="onLoad";function jn(e){e=e||{};var t,n,i,r,o,a,u=this.context,d=(0,l.Z)(u).getInstance(),h=(0,Z.Z)(u).getInstance();function p(e,t,n){var i,r,o={};o.elements=e,o.type=t,o.resolveType=n,0===o.elements.length&&g(o);for(var s=0;s<o.elements.length;s++)i=o.elements[s],r=h.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,a.load(r,i,o)}function f(e){var t,n,i="";if(t=e.element,n=e.resolveObject,t.resolvedContent){var r=0;0===t.resolvedContent.indexOf("<?xml")&&(r=t.resolvedContent.indexOf("?>")+2),i=t.resolvedContent.substr(0,r)+"<response>"+t.resolvedContent.substr(r)+"</response>",t.resolvedContent=o.xml_str2json(i)}(function(e){var t;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(n)&&g(n)}function g(e){var t,n,o=[];if(function(e){var t,n,o,s,a,l,c=[];for(s=e.elements.length-1;s>=0;s--){if(n=(t=e.elements[s]).type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(a=0;a<t.resolvedContent[n].length;a++)o=t.resolvedContent[n][a],c.push(o)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],c.push(t.originalContent);for(t.parentElement[n].splice(t.index,1),l=0;l<c.length;l++)t.parentElement[n].splice(t.index+l,0,c[l]);c=[]}e.elements.length>0&&i.run(r)}(e),"onActuate"===e.resolveType&&d.trigger(c.Z.XLINK_READY,{manifest:r}),e.resolveType===Bn)switch(e.type){case s.Z.PERIOD:for(t=0;t<r[s.Z.PERIOD+"_asArray"].length;t++)(n=r[s.Z.PERIOD+"_asArray"][t]).hasOwnProperty(s.Z.ADAPTATION_SET+"_asArray")&&(o=o.concat(m(n[s.Z.ADAPTATION_SET+"_asArray"],n,s.Z.ADAPTATION_SET,Bn))),n.hasOwnProperty(s.Z.EVENT_STREAM+"_asArray")&&(o=o.concat(m(n[s.Z.EVENT_STREAM+"_asArray"],n,s.Z.EVENT_STREAM,Bn)));p(o,s.Z.ADAPTATION_SET,Bn);break;case s.Z.ADAPTATION_SET:d.trigger(c.Z.XLINK_READY,{manifest:r})}}function m(e,t,n,i){var r,o,s,a=[];for(o=e.length-1;o>=0;o--)(r=e[o]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===r["xlink:href"]&&e.splice(o,1);for(o=0;o<e.length;o++)(r=e[o]).hasOwnProperty("xlink:href")&&r.hasOwnProperty("xlink:actuate")&&r["xlink:actuate"]===i&&(s=b(r["xlink:href"],t,n,o,i,r),a.push(s));return a}function b(e,t,n,i,r,o){return{url:e,parentElement:t,type:n,index:i,resolveType:r,originalContent:o,resolvedContent:null,resolved:!1}}return t={resolveManifestOnLoad:function(e){o=new Pn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:n}),(r=e).Period_asArray?p(m(r.Period_asArray,r,s.Z.PERIOD,Bn),s.Z.PERIOD,Bn):d.trigger(c.Z.XLINK_READY,{manifest:r})},setMatchers:function(e){e&&(n=e)},setIron:function(e){e&&(i=e)},reset:function(){d.off(c.Z.XLINK_ELEMENT_LOADED,f,t),a&&(a.reset(),a=null)}},d.on(c.Z.XLINK_ELEMENT_LOADED,f,t),a=Mn(u).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),t}jn.__dashjs_factory_name="XlinkController";var Fn=u.Z.getClassFactory(jn);function $n(e){return($n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Un(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,i){for(var r=0,o=e.length;r<o;++r){var s=e[r];if(n[s.name])if(i[s.name]){if(s.merge){var a=n[s.name],l=i[s.name];"object"===$n(a)&&"object"===$n(l)?t(a,l):i[s.name]=a+l}}else i[s.name]=n[s.name]}}function i(e,t){for(var r=0,o=e.children.length;r<o;++r){var s=e.children[r],a=t[s.name+"_asArray"];if(a)for(var l=0,c=a.length;l<c;++l){var u=a[l];n(e.properties,t,u),i(s,u)}}}return{run:function(t){if(null===t||"object"!==$n(t))return t;if(t.Period_asArray&&"period"in e)for(var n=e.period,r=t.Period_asArray,o=0,s=r.length;o<s;++o){var a=r[o];if(i(n,a),"adaptationset"in e){var l=a.AdaptationSet_asArray;if(l)for(var c=e.adaptationset,u=0,d=l.length;u<d;++u)i(c,l[u])}}return t}}}Un.__dashjs_factory_name="ObjectIron";var Hn=u.Z.getClassFactory(Un),Gn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=n}var t;return(t=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function Vn(e){return(Vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zn(e,t){return(zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qn(e){return(qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zn(e,t)}(r,Gn);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=qn(t);if(n){var r=qn(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==Vn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),i.call(this,(function(e,t){var n,i=(Wn(n={},s.Z.MPD,[s.Z.ID,s.Z.PROFILES]),Wn(n,s.Z.PERIOD,[s.Z.ID]),Wn(n,s.Z.BASE_URL,[s.Z.SERVICE_LOCATION,s.Z.BYTE_RANGE]),Wn(n,s.Z.SEGMENT_BASE,[s.Z.INDEX_RANGE]),Wn(n,s.Z.INITIALIZATION,[s.Z.RANGE]),Wn(n,s.Z.REPRESENTATION_INDEX,[s.Z.RANGE]),Wn(n,s.Z.SEGMENT_LIST,[s.Z.INDEX_RANGE]),Wn(n,s.Z.BITSTREAM_SWITCHING,[s.Z.RANGE]),Wn(n,s.Z.SEGMENT_URL,[s.Z.MEDIA_RANGE,s.Z.INDEX_RANGE]),Wn(n,s.Z.SEGMENT_TEMPLATE,[s.Z.INDEX_RANGE,s.Z.MEDIA,s.Z.INDEX,s.Z.INITIALIZATION_MINUS,s.Z.BITSTREAM_SWITCHING_MINUS]),Wn(n,s.Z.ASSET_IDENTIFIER,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.EVENT_STREAM,[s.Z.VALUE]),Wn(n,s.Z.ADAPTATION_SET,[s.Z.PROFILES,s.Z.MIME_TYPE,s.Z.SEGMENT_PROFILES,s.Z.CODECS,s.Z.CONTENT_TYPE]),Wn(n,s.Z.FRAME_PACKING,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.AUDIO_CHANNEL_CONFIGURATION,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.CONTENT_PROTECTION,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.ESSENTIAL_PROPERTY,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.SUPPLEMENTAL_PROPERTY,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.INBAND_EVENT_STREAM,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.ACCESSIBILITY,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.ROLE,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.RATING,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.VIEWPOINT,[s.Z.VALUE,s.Z.ID]),Wn(n,s.Z.CONTENT_COMPONENT,[s.Z.CONTENT_TYPE]),Wn(n,s.Z.REPRESENTATION,[s.Z.ID,s.Z.DEPENDENCY_ID,s.Z.MEDIA_STREAM_STRUCTURE_ID]),Wn(n,s.Z.SUBSET,[s.Z.ID]),Wn(n,s.Z.METRICS,[s.Z.METRICS_MINUS]),Wn(n,s.Z.REPORTING,[s.Z.VALUE,s.Z.ID]),n);if(i.hasOwnProperty(t)){var r=i[t];return void 0!==r&&r.indexOf(e.name)>=0}return!1}),(function(e){return String(e)}))}return r}();function Kn(e){return(Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zn(e,t){return(Zn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xn(e){return(Xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Jn=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,Qn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zn(e,t)}(r,Gn);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=Xn(t);if(n){var r=Xn(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==Kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),i.call(this,(function(e){for(var t=[s.Z.MIN_BUFFER_TIME,s.Z.MEDIA_PRESENTATION_DURATION,s.Z.MINIMUM_UPDATE_PERIOD,s.Z.TIMESHIFT_BUFFER_DEPTH,s.Z.MAX_SEGMENT_DURATION,s.Z.MAX_SUBSEGMENT_DURATION,s.Z.SUGGESTED_PRESENTATION_DELAY,s.Z.START,o.Z.START_TIME,s.Z.DURATION],n=t.length,i=0;i<n;i++)if(e.nodeName===t[i])return Jn.test(e.value);return!1}),(function(e){var t=Jn.exec(e),n=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n}))}return r}();function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t){return(ti=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ni(e){return(ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ii=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,ri=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ti(e,t)}(r,Gn);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=ni(t);if(n){var r=ni(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),i.call(this,(function(e){return ii.test(e.value)}),(function(e){var t,n=ii.exec(e);if(t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&parseInt(n[6],10)||0,n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]){var i=60*parseInt(n[9],10)+parseInt(n[10],10);t+=("+"===n[8]?-1:1)*i*60*1e3}return new Date(t)}))}return r}();function oi(e){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function si(e,t){return(si=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ai(e){return(ai=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var li=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,ci=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&si(e,t)}(r,Gn);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=ai(t);if(n){var r=ai(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==oi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),i.call(this,(function(e){return li.test(e.value)}),(function(e){return parseFloat(e)}))}return r}();function ui(e){return(ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function di(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hi(e,t){return(hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pi(e){return(pi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var fi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(r,Gn);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=pi(t);if(n){var r=pi(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==ui(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),i.call(this,(function(e,t){var n,i=(di(n={},s.Z.ADAPTATION_SET,[s.Z.LANG]),di(n,s.Z.REPRESENTATION,[s.Z.LANG]),di(n,s.Z.CONTENT_COMPONENT,[s.Z.LANG]),di(n,s.Z.LABEL,[s.Z.LANG]),di(n,s.Z.GROUP_LABEL,[s.Z.LANG]),n);if(i.hasOwnProperty(t)){var r=i[t];return void 0!==r&&r.indexOf(e.name)>=0}return!1}),(function(e){return dn()(e)||String(e)}))}return r}(),gi=function(){function e(t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._merge=(n=t)&&n.length&&n.charAt(0)===n.charAt(0).toUpperCase()}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),mi=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=i||[],Array.isArray(n)&&n.forEach((function(e){r._properties.push(new gi(e))}))}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function bi(e){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yi(e,t){return(yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vi(e){return(vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _i=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yi(e,t)}(r,mi);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=vi(t);if(n){var r=vi(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==bi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){!function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var e=[s.Z.PROFILES,s.Z.WIDTH,s.Z.HEIGHT,s.Z.SAR,s.Z.FRAMERATE,s.Z.AUDIO_SAMPLING_RATE,s.Z.MIME_TYPE,s.Z.SEGMENT_PROFILES,s.Z.CODECS,s.Z.MAXIMUM_SAP_PERIOD,s.Z.START_WITH_SAP,s.Z.MAX_PLAYOUT_RATE,s.Z.CODING_DEPENDENCY,s.Z.SCAN_TYPE,s.Z.FRAME_PACKING,s.Z.AUDIO_CHANNEL_CONFIGURATION,s.Z.CONTENT_PROTECTION,s.Z.ESSENTIAL_PROPERTY,s.Z.ESSENTIAL_PROPERTY+"_asArray",s.Z.SUPPLEMENTAL_PROPERTY,s.Z.INBAND_EVENT_STREAM];return i.call(this,s.Z.ADAPTATION_SET,e,[new mi(s.Z.REPRESENTATION,e,[new mi(s.Z.SUB_REPRESENTATION,e)])])}return r}();function Ei(e){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ti(e,t){return(Ti=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xi(e){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ti(e,t)}(r,mi);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=xi(t);if(n){var r=xi(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==Ei(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){!function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var e=[s.Z.SEGMENT_BASE,s.Z.SEGMENT_TEMPLATE,s.Z.SEGMENT_LIST];return i.call(this,s.Z.PERIOD,e,[new mi(s.Z.ADAPTATION_SET,e,[new mi(s.Z.REPRESENTATION,e)])])}return r}();function ki(e){e=e||{};var t,n,i,r,o,s=this.context,a=e.debug;return t={parse:function(e){var t,i=window.performance.now();if(!(t=r.xml_str2json(e)))throw new Error("parsing the manifest failed");var s=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach((function(e){return o.run(e)})),t.replace_asArray&&t.replace_asArray.forEach((function(e){return o.run(e)}))):(t=t.MPD,o.run(t));var a=window.performance.now();return n.info("Parsing complete: ( xml2json: "+(s-i).toPrecision(3)+"ms, objectiron: "+(a-s).toPrecision(3)+"ms, total: "+((a-i)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return i},getIron:function(){return o}},n=a.getLogger(t),i=[new Qn,new ri,new ci,new fi,new Yn],r=new Pn({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:i}),o=Hn(s).create({adaptationset:new _i,period:new wi}),t}ki.__dashjs_factory_name="DashParser";var Si=u.Z.getClassFactory(ki);function Ci(e){e=e||{};var t,n,i,r,a,u=this.context,d=e.debug,h=e.settings,p=(0,l.Z)(u).getInstance(),f=(0,Z.Z)(u).getInstance(),g=e.mssHandler,m=e.errHandler;function b(e){p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function y(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(g&&(t=g.createMssParser(),g.createMssFragmentProcessor(),g.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?Si(u).create({debug:d}):t}return t={load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new Date,l=new Dn(e,A.w.MPD_TYPE);t&&(l.serviceLocation=t),o&&(l.queryParams=o),l.requestStartDate||(l.requestStartDate=s),p.trigger(c.Z.MANIFEST_LOADING_STARTED,{request:l}),i.load({request:l,success:function(t,i,o){var s,l,u;if(r)if(o&&o!==e?(l=f.parseBaseUrl(o),s=o):(f.isRelative(e)&&(e=f.resolve(e,window.location.href)),l=f.parseBaseUrl(e)),"No Content"!=i)if(null===a&&(a=y(t)),null!==a){r.setMatchers(a.getMatchers()),r.setIron(a.getIron());try{u=a.parse(t)}catch(t){return void p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}if(u){if(u.url=s||e,u.originalUrl||(u.originalUrl=u.url),h&&h.get().streaming.enableManifestDurationMismatchFix&&u.mediaPresentationDuration&&u.Period_asArray.length>1){var d=u.Period_asArray.reduce((function(e,t){return e+t.duration}),0);!isNaN(d)&&u.mediaPresentationDuration>d&&(n.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),u.mediaPresentationDuration=d)}u.baseUri=l,u.loadedTime=new Date,r.resolveManifestOnLoad(u),p.trigger(c.Z.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})}else p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,S.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,n,i){p.trigger(c.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new T.Z(S.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,S.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(i))})}})},reset:function(){p.off(c.Z.XLINK_READY,b,t),g&&g.reset(),r&&(r.reset(),r=null),i&&(i.abort(),i=null)}},n=d.getLogger(t),p.on(c.Z.XLINK_READY,b,t),i=ft(u).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:f,constants:o.Z,dashConstants:s.Z,errors:S,requestTimeout:e.settings.get().streaming.manifestRequestTimeout}),r=Fn(u).create({errHandler:m,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),a=null,t}Ci.__dashjs_factory_name="ManifestLoader";var Ai=u.Z.getClassFactory(Ci);function Ii(){var e=this.context,t=(0,l.Z)(e).getInstance();return{error:function(e){t.trigger(c.Z.ERROR,{error:e})}}}Ii.__dashjs_factory_name="ErrorHandler";var Oi=u.Z.getSingletonFactory(Ii),Ni=n(1715);function Ri(){var e,t,n,i,r,s,a=this.context,u=(0,l.Z)(a).getInstance();function h(e,i){if(!i||!i.Period_asArray||0===i.Period_asArray.length)return Promise.resolve();var r=[];return i.Period_asArray.forEach((function(i){r.push(function(e,i){return new Promise((function(r){if(e&&e.AdaptationSet_asArray&&0!==e.AdaptationSet_asArray.length){var a=[];e.AdaptationSet_asArray.forEach((function(e){t.getIsTypeOf(e,i)&&a.push(function(e,i){return new Promise((function(r){if(e.Representation_asArray&&0!==e.Representation_asArray.length){var a=[],l=[];e.Representation_asArray.forEach((function(r,s){var c=function(e,t,n){switch(i){case o.Z.VIDEO:return function(e,t){return{codec:n,width:e.width||null,height:e.height||null,framerate:e.frameRate||null,bitrate:e.bandwidth||null}}(t);case o.Z.AUDIO:return function(e,t){var n=e.audioSamplingRate||null;return{codec:t,bitrate:e.bandwidth||null,samplerate:n}}(t,n);default:return null}}(0,r,t.getCodec(e,s,!1));l.push(c),a.push(n.supportsCodec(c,i))})),Promise.all(a).then((function(t){e.Representation_asArray=e.Representation_asArray.filter((function(e,n){return t[n]||s.debug("[Stream] Codec ".concat(l[n].codec," not supported ")),t[n]})),r()})).catch((function(){r()}))}else r()}))}(e,i))})),Promise.all(a).then((function(){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||(u.trigger(c.Z.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:e}),s.warn("AdaptationSet has been removed because of no supported Representation")),t})),r()})).catch((function(){r()}))}else r()}))}(i,e))})),Promise.all(r)}return e={setConfig:function(e){e&&(e.adapter&&(t=e.adapter),e.capabilities&&(n=e.capabilities),e.settings&&(i=e.settings),e.customParametersModel&&(r=e.customParametersModel))},filterUnsupportedFeatures:function(e){return new Promise((function(a){var l=[];l.push(h(o.Z.VIDEO,e)),l.push(h(o.Z.AUDIO,e)),Promise.all(l).then((function(){i.get().streaming.capabilities.filterUnsupportedEssentialProperties&&function(e){e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){var i=t.getEssentialPropertiesForRepresentation(e);if(i&&i.length>0)for(var r=0;r<i.length;){if(!n.supportsEssentialProperty(i[r]))return s.debug("[Stream] EssentialProperty not supported: "+i[r].schemeIdUri),!1;r+=1}return!0})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}))}(e),function(e){var t=r.getCustomCapabilitiesFilters();t&&0!==t.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach((function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter((function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((function(e){return!t.some((function(t){return!t(e)}))})),e.Representation_asArray&&e.Representation_asArray.length>0)}))}))}(e),a()})).catch((function(){a()}))}))}},s=(0,d.Z)(a).getInstance().getLogger(e),e}Ri.__dashjs_factory_name="CapabilitiesFilter";var Di=u.Z.getSingletonFactory(Ri),Li=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function Mi(){var e;return{initialize:function(t){if(e=new Li,!t)return null;var n=t.indexOf("#");if(-1!==n)for(var i=t.substr(n+1).split("&"),r=0,o=i.length;r<o;++r){var s=i[r],a=s.indexOf("=");if(-1!==a){var l=s.substring(0,a);e.hasOwnProperty(l)&&(e[l]=s.substr(a+1))}}},getURIFragmentData:function(){return e}}}Mi.__dashjs_factory_name="URIFragmentModel";var Pi=u.Z.getSingletonFactory(Mi);function Bi(){var e,t=this.context,n=(0,l.Z)(t).getInstance();return{getValue:function(){return e},setValue:function(t){e=t,t&&n.trigger(c.Z.MANIFEST_LOADED,{data:t})}}}Bi.__dashjs_factory_name="ManifestModel";var ji=u.Z.getSingletonFactory(Bi),Fi=-.5;function $i(){var e,t,n,i,r=this.context,o=(0,C.Z)(r).getInstance();function s(e,n){return isNaN(e)?0:e>0?(n&&t.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e<Fi?(n&&t.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(Fi,": ").concat(-50,"% playback speed.")),Fi):e}function a(e,n){return isNaN(e)?0:e<0?(n&&t.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e>1?(n&&t.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):e}function l(){var e=o.get().streaming.buffer.stableBufferTime>0?o.get().streaming.buffer.stableBufferTime:o.get().streaming.buffer.fastSwitchEnabled?20:12,t=n.getLiveDelay();return!isNaN(t)&&t>0?Math.min(e,t):e}return e={getCatchupMaxDrift:function(){if(!isNaN(o.get().streaming.liveCatchup.maxDrift)&&o.get().streaming.liveCatchup.maxDrift>0)return o.get().streaming.liveCatchup.maxDrift;var e=i.getServiceDescriptionSettings();return e&&e.liveCatchup&&!isNaN(e.liveCatchup.maxDrift)&&e.liveCatchup.maxDrift>0?e.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==o.get().streaming.liveCatchup.enabled?o.get().streaming.liveCatchup.enabled:n.getInitialCatchupModeActivated()},getStableBufferTime:l,getInitialBufferLevel:function(){var e=o.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(l(),e)},getRetryAttemptsForType:function(e){var t=isNaN(o.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:o.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return n.getLowLatencyModeEnabled()?o.get().streaming.retryAttempts[e]*t:o.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(o.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:o.get().streaming.retryIntervals.lowLatencyReductionFactor;return n.getLowLatencyModeEnabled()?o.get().streaming.retryIntervals[e]/t:o.get().streaming.retryIntervals[e]},getCatchupPlaybackRates:function(e){var t=o.get().streaming.liveCatchup.playbackRate;if(!isNaN(t.min)||!isNaN(t.max))return{min:s(t.min,e),max:a(t.max,e)};var n=i.getServiceDescriptionSettings();if(n&&n.liveCatchup&&(!isNaN(n.liveCatchup.playbackRate.min)||!isNaN(n.liveCatchup.playbackRate.max))){var r=n.liveCatchup.playbackRate;return{min:s(r.min,e),max:a(r.max,e)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(e,t){try{var n=o.get().streaming.abr[e][t];if(!isNaN(n)&&-1!==n)return n;var r=i.getServiceDescriptionSettings();return r&&r[e]&&!isNaN(r[e][t])?r[e][t]:-1}catch(e){return-1}},setConfig:function(e){e.playbackController&&(n=e.playbackController),e.serviceDescriptionController&&(i=e.serviceDescriptionController)},reset:function(){}},t=(0,d.Z)(r).getInstance().getLogger(e),e}$i.__dashjs_factory_name="MediaPlayerModel";var Ui=u.Z.getSingletonFactory($i),Hi=n(1767);function Gi(e){var t=(e=e||{}).abrController,n=e.switchHistory,i=e.droppedFramesHistory,r=e.currentRequest,o=e.useBufferOccupancyABR,s=e.useL2AABR,a=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,c=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,u=e.videoModel?e.videoModel:null;function d(){return c?c.mediaInfo:null}return{getMediaType:function(){var e=d();return e?e.type:null},getMediaInfo:d,getDroppedFramesHistory:function(){return i},getCurrentRequest:function(){return r},getSwitchHistory:function(){return n},getStreamInfo:function(){var e=d();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return c},useBufferOccupancyABR:function(){return o},useL2AABR:function(){return s},useLoLPABR:function(){return a},getVideoModel:function(){return u}}}Gi.__dashjs_factory_name="RulesContext";var Vi=u.Z.getClassFactory(Gi),Wi=n(2068);function zi(){var e=[],t=[];return{push:function(n){n.newValue===Wi.Z.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});var i=n.newValue-n.oldValue,r=i<0?1:0,o=r?-i:0,s=r?0:1;if(e[n.oldValue].drops+=r,e[n.oldValue].dropSize+=o,e[n.oldValue].noDrops+=s,t.push({idx:n.oldValue,noDrop:s,drop:r,dropSize:o}),t.length>8){var a=t.shift();e[a.idx].drops-=a.drop,e[a.idx].dropSize-=a.dropSize,e[a.idx].noDrops-=a.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}zi.__dashjs_factory_name="SwitchRequestHistory";var qi=u.Z.getClassFactory(zi);function Yi(){var e={},t={},n={};return{push:function(i,r,o){if(r){e[i]||(e[i]=[],t[i]=0,n[i]=0);var s=o&&o.droppedVideoFrames?o.droppedVideoFrames:0,a=o&&o.totalVideoFrames?o.totalVideoFrames:0,l=s-t[i];t[i]=s;var c=a-n[i];n[i]=a;var u=e[i];isNaN(r)||(u[r]?(u[r].droppedVideoFrames+=l,u[r].totalVideoFrames+=c):u[r]={droppedVideoFrames:l,totalVideoFrames:c})}},getFrameHistory:function(t){return e[t]},clearForStream:function(i){try{delete e[i],delete t[i],delete n[i]}catch(e){}},reset:function(){e={},t={},n={}}}}Yi.__dashjs_factory_name="DroppedFramesHistory";var Ki=u.Z.getClassFactory(Yi);function Zi(e){var t,n,i,r,s,a=this.context,c=(e=e||{}).settings,u=(0,l.Z)(a).getInstance();function d(e,t,n,i){var r=Math.pow(.5,n/i.fast);e.fastEstimate=(1-r)*t+r*e.fastEstimate;var o=Math.pow(.5,n/i.slow);e.slowEstimate=(1-o)*t+o*e.slowEstimate,e.totalWeight+=n}function p(e,a,l){return c.get().streaming.abr.movingAverageMethod!==o.Z.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var n=e?s.throughputHalfLife:s.latencyHalfLife,o=e?i[t]:r[t];if(!o||o.totalWeight<=0)return NaN;var a=o.fastEstimate/(1-Math.pow(.5,o.totalWeight/n.fast)),l=o.slowEstimate/(1-Math.pow(.5,o.totalWeight/n.slow));return e?Math.min(a,l):Math.max(a,l)}(e,a):function(e,i,r){var o=function(e,i,r){var o,s;if(e?(o=t[i],s=r?3:4):(o=n[i],s=4),o){if(s>=o.length)s=o.length;else if(e)for(var a=1;a<s;++a){var l=o[o.length-a]/o[o.length-a-1];if((l>=1.3||l<=1/1.3)&&(s+=1)===o.length)break}}else s=0;return s}(e,i,l),s=(e?t:n)[i];return 0!==o&&s&&0!==s.length?(s=s.slice(-o)).reduce((function(e,t){return e+t}))/s.length:NaN}(e,a)}function f(e,t){return p(!0,e,t)}function g(e){t[e]=t[e]||[],n[e]=n[e]||[],i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},r[e]=r[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function m(){t={},n={},i={},r={}}var b={push:function(e,a,l){if(a.trace&&a.trace.length){var p,f=a.tresponse.getTime()-a.trequest.getTime()||1,m=a._tfinish.getTime()-a.tresponse.getTime()||1,b=a.trace.reduce((function(e,t){return e+t.b[0]}),0),y=0;if(0!==(p=a._fileLoaderType&&a._fileLoaderType===o.Z.FILE_LOADER_TYPES.FETCH?a.trace.reduce((function(e,t){return e+t.d}),0):l?m:f+m)&&(y=Math.round(8*b/p)),a.cmsd){var v=a.cmsd.dynamic&&a.cmsd.dynamic.etp?a.cmsd.dynamic.etp:null;if(v){var _=c.get().streaming.cmsd.abr.etpWeightRatio;_>0&&_<=1&&(y=y*(1-_)+v*_)}}if(g(e),function(e,t,n){return e===o.Z.VIDEO?n<c.get().streaming.cacheLoadThresholds[o.Z.VIDEO]:e===o.Z.AUDIO?n<c.get().streaming.cacheLoadThresholds[o.Z.AUDIO]:void 0}(e,0,m)){if(t[e].length>0&&!t[e].hasCachedEntries)return;t[e].hasCachedEntries=!0}else t[e]&&t[e].hasCachedEntries&&function(e){delete t[e],delete n[e],delete i[e],delete r[e],g(e)}(e);t[e].push(y),u.trigger(h.Z.THROUGHPUT_MEASUREMENT_STORED,{throughput:y,mediaType:e,httpRequest:a}),t[e].length>20&&t[e].shift(),n[e].push(f),n[e].length>20&&n[e].shift(),d(i[e],y,.001*m,s.throughputHalfLife),d(r[e],f,1,s.latencyHalfLife)}},getAverageThroughput:f,getSafeAverageThroughput:function(e,t){var n=f(e,t);return isNaN(n)||(n*=c.get().streaming.abr.bandwidthSafetyFactor),n},getAverageLatency:function(e){return p(!1,e)},reset:m};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},m(),b}Zi.__dashjs_factory_name="ThroughputHistory";var Xi=u.Z.getClassFactory(Zi);function Ji(){var e,t,n,i,r,s,u,p,f,g,m,b,y,v,_,T,x,w,k,S,C,I,O,N,R,D,L,M=this.context,P=(0,d.Z)(M).getInstance(),B=(0,l.Z)(M).getInstance();function j(){r={},s={},p={},u={},S={},O={},N={},R={},void 0===g&&(g=!1),C&&C.reset(),k=void 0,C=void 0,I=void 0,clearTimeout(f),f=null}function F(t){var r=t.request.mediaType,o=t.streamId;if(r&&o&&u[o]&&L.get().streaming.abr.autoSwitchBitrate[r]){var s=u[o][r];if(s){var l=Vi(M).create({abrController:e,streamProcessor:s,currentRequest:t.request,useBufferOccupancyABR:O[r],useL2AABR:N[r],useLoLPABR:R[r],videoModel:v}),c=n.shouldAbandonFragment(l,o);c.quality>Wi.Z.NO_CHANGE&&s.getFragmentModel().getRequests({state:E.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(p[o][r].state=a.Z.ABANDON_LOAD,S[o][r].reset(),S[o][r].push({oldValue:V(r,o),newValue:c.quality,confidence:1,reason:c.reason}),W(r,i.getActiveStreamInfo(),c.quality,c.reason),clearTimeout(f),f=setTimeout((function(){p[o][r].state=a.Z.ALLOW_LOAD,f=null}),L.get().streaming.abandonLoadTimeout))}}}function $(e){e.mediaType===o.Z.VIDEO&&(void 0!==k&&C.push(e.streamId,k,v.getPlaybackQuality()),k=e.newQuality)}function U(e){var n,i;e.metric!==a.Z.HTTP_REQUEST||!e.value||e.value.type!==A.w.MEDIA_SEGMENT_TYPE||e.mediaType!==o.Z.AUDIO&&e.mediaType!==o.Z.VIDEO||I.push(e.mediaType,e.value,L.get().streaming.abr.useDeadTimeLatency),e.metric!==a.Z.BUFFER_LEVEL||e.mediaType!==o.Z.AUDIO&&e.mediaType!==o.Z.VIDEO||(n=e.mediaType,i=.001*e.value.level,L.get().streaming.abr.ABRStrategy===o.Z.ABR_STRATEGY_DYNAMIC&&function(e,n){try{var i=_.getStableBufferTime(),r=i,o=.5*i,s=O[e],a=n>(s?o:r);O[e]=a,a!==s&&(a?t.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+n.toFixed(3)+")."):t.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+n.toFixed(3)+")."))}catch(e){t.error(e)}}(n,i))}function H(e,n){try{var i;return r[n]=r[n]||{},r[n].hasOwnProperty(e)||(r[n][e]=0),i=function(e,t,n){if(t!==o.Z.VIDEO||!L.get().streaming.abr.limitBitrateByPortal||!u[n]||!u[n][t])return e;g||X();var i=u[n][t].getStreamInfo(),r=y.getAdaptationForType(i.index,t,i).Representation_asArray,s=e;if(m>0&&b>0){for(;s>0&&r[s]&&m<r[s].width&&m-r[s-1].width<r[s].width-m;)s-=1;for(;s<r.length-1&&r[s].width===r[s+1].width;)s+=1}return s}(i=function(e,t,n){var i=r[n][t],o=L.get().streaming.abr.maxRepresentationRatio[t];return isNaN(o)||o>=1||o<0?e:Math.min(e,Math.round(i*o))}(i=function(e,t){var n=r[t][e],i=n;if(!u[t]||!u[t][e])return i;var o=G(e,t);void 0!==o&&(i=Math.max(n,o));var s=function(e,t){try{var n=_.getAbrBitrateParameter("maxBitrate",e);return n>-1?K(u[t][e].getMediaInfo(),n,t):void 0}catch(e){return}}(e,t);return void 0!==s&&(i=Math.min(i,s)),i}(e,n),e,n),e,n),L.get().streaming.cmsd.enabled&&L.get().streaming.cmsd.abr.applyMb&&(i=function(e,n,i){if("video"!==n)return e;var r=x.getMaxBitrate(n);if(r<0)return e;var o=Y(i,"audio",V("audio",i));r-=o?o.bitrate/1e3:0;var s=K(u[i][n].getMediaInfo(),r,i);return t.debug("Stream ID: "+i+" ["+n+"] Apply max bit rate from CMSD: "+r),Math.min(e,s)}(i,e,n)),i}catch(e){return}}function G(e,t){try{return function(e,t){try{var n=_.getAbrBitrateParameter("minBitrate",e);if(n>-1){var i=u[t][e].getMediaInfo(),r=Z(i),o=K(i,n,t);return r[o]&&o<r.length-1&&r[o].bitrate<1e3*n&&o++,o}return}catch(e){return}}(e,t)}catch(e){return}}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return t||(t=i.getActiveStreamInfo().id),e&&u[t]&&u[t][e]&&t?(s[t]=s[t]||{},s[t].hasOwnProperty(e)||(s[t][e]=0),s[t][e]):0}catch(e){return 0}}function W(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var r=t.id,o=V(e,r);(0,q.SE)(n);var s=H(e,r);n!==o&&n>=0&&n<=s&&z(e,o,n,s,i,r)}}function z(e,n,i,r,o,a){if(e&&u[a]&&u[a][e]){var l=u[a][e].getStreamInfo(),d=l&&l.manifestInfo&&l.manifestInfo.isDynamic,h=D.getCurrentBufferLevel(e);t.info("Stream ID: "+a+" ["+e+"] switch from "+n+" to "+i+"/"+r+" (buffer: "+h+") "+(o?JSON.stringify(o):".")),s[a]=s[a]||{},s[a][e]=i;var p=Y(a,e,i);B.trigger(c.Z.QUALITY_CHANGE_REQUESTED,{oldQuality:n,newQuality:i,reason:o,streamInfo:l,bitrateInfo:p,maxIdx:r,mediaType:e},{streamId:l.id,mediaType:e});var f=I.getAverageThroughput(e,d);isNaN(f)||w.setSavedBitrateSettings(e,f)}}function Y(e,t,n){if(t&&u&&u[e]&&u[e][t]){var i=Z(u[e][t].getMediaInfo());return i[n]?i[n]:null}return null}function K(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=e&&e.type?u[n][e.type].getRepresentationInfo():null;if(L.get().streaming.abr.useDeadTimeLatency&&i&&r&&r.fragmentDuration){i/=1e3;var o=r.fragmentDuration;if(i>o)return 0;t*=1-i/o}for(var s=Z(e),a=s.length-1;a>=0;a--)if(1e3*t>=s[a].bitrate)return a;return 0}function Z(e){var t=[];if(!e||!e.bitrateList)return t;for(var n,i=e.bitrateList,r=e.type,o=0,s=i.length;o<s;o++)(n=new St).mediaType=r,n.qualityIndex=o,n.bitrate=i[o].bandwidth,n.width=i[o].width,n.height=i[o].height,n.scanType=i[o].scanType,t.push(n);return t}function X(){if(v){var e=L.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;m=v.getClientWidth()*e,b=v.getClientHeight()*e}}return e={initialize:function(){C=Ki(M).create(),I=Xi(M).create({settings:L}),(n=(0,Hi.Z)(M).create({dashMetrics:D,customParametersModel:T,mediaPlayerModel:_,settings:L})).initialize(),B.on(h.Z.QUALITY_CHANGE_RENDERED,$,e),B.on(h.Z.METRIC_ADDED,U,e),B.on(c.Z.LOADING_PROGRESS,F,e)},isPlayingAtTopQuality:function(e){var t=e?e.id:null,n=V(o.Z.AUDIO,t),i=V(o.Z.VIDEO,t);return n===H(o.Z.AUDIO,t)&&i===H(o.Z.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,n=e.streamInfo.id,i=e.representationCount-1;return r[n]=r[n]||{},r[n][t]=i,i},clearDataForStream:function(e){C&&C.clearForStream(e),u[e]&&delete u[e],S[e]&&delete S[e],p[e]&&delete p[e]},getThroughputHistory:function(){return I},getBitrateList:Z,getQualityForBitrate:K,getTopBitrateInfoFor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=i.getActiveStreamInfo().id),e&&u&&u[t]&&u[t][e]){var n=H(e,t),r=Z(u[t][e].getMediaInfo());return r[n]?r[n]:null}return null},getMinAllowedIndexFor:G,getMaxAllowedIndexFor:H,getInitialBitrateFor:function(e,t){if(function(){if(!w||!w.hasOwnProperty("getSavedBitrateSettings"))throw new Error(o.Z.MISSING_CONFIG_ERROR)}(),e===o.Z.TEXT)return NaN;var n=w.getSavedBitrateSettings(e),i=_.getAbrBitrateParameter("initialBitrate",e),r=L.get().streaming.abr.initialRepresentationRatio[e];if(-1===i)if(r>-1){var s=u[t][e].getStreamInfo(),a=y.getAdaptationForType(s.index,e,s).Representation_asArray;i=Array.isArray(a)?a[Math.max(Math.round(a.length*r)-1,0)].bandwidth/1e3:0}else i=isNaN(n)?e===o.Z.VIDEO?1e3:100:n;return i},getQualityFor:V,getAbandonmentStateFor:function(e,t){return p[e]&&p[e][t]?p[e][t].state:null},setPlaybackQuality:W,checkPlaybackQuality:function(t,i){try{if(!(t&&u&&u[i]&&u[i][t]))return!1;if(C){var r=v.getPlaybackQuality();r&&C.push(i,k,r)}if(!L.get().streaming.abr.autoSwitchBitrate[t])return!1;var o=V(t,i),s=Vi(M).create({abrController:e,switchHistory:S[i][t],droppedFramesHistory:C,streamProcessor:u[i][t],currentValue:o,useBufferOccupancyABR:O[t],useL2AABR:N[t],useLoLPABR:R[t],videoModel:v}),l=G(t,i),c=H(t,i),d=n.getMaxQuality(s),h=d.quality;return void 0!==l&&(h>Wi.Z.NO_CHANGE?h:o)<l&&(h=l),h>c&&(h=c),S[i][t].push({oldValue:o,newValue:h}),h>Wi.Z.NO_CHANGE&&h!==o&&(p[i][t].state===a.Z.ALLOW_LOAD||h<o)&&(z(t,o,h,c,d.reason,i),!0)}catch(e){return!1}},setElementSize:X,setWindowResizeEventCalled:function(e){g=e},registerStreamType:function(e,t){var n=t.getStreamInfo().id;u[n]||(u[n]={}),S[n]||(S[n]={}),p[n]||(p[n]={}),S[n][e]=qi(M).create(),u[n][e]=t,p[n][e]={},p[n][e].state=a.Z.ALLOW_LOAD,function(e){var t=L.get().streaming.abr.ABRStrategy;t===o.Z.ABR_STRATEGY_L2A?(O[e]=!1,R[e]=!1,N[e]=!0):t===o.Z.ABR_STRATEGY_LoLP?(O[e]=!1,R[e]=!0,N[e]=!1):t===o.Z.ABR_STRATEGY_BOLA?(O[e]=!0,R[e]=!1,N[e]=!1):t===o.Z.ABR_STRATEGY_THROUGHPUT?(O[e]=!1,R[e]=!1,N[e]=!1):t===o.Z.ABR_STRATEGY_DYNAMIC&&(O[e]=!(!O||!O[e])&&O[e],R[e]=!1,N[e]=!1)}(e),e===o.Z.VIDEO&&X()},unRegisterStreamType:function(e,t){try{u[e]&&u[e][t]&&delete u[e][t],S[e]&&S[e][t]&&delete S[e][t],p[e]&&p[e][t]&&delete p[e][t]}catch(e){}},setConfig:function(e){e&&(e.streamController&&(i=e.streamController),e.domStorage&&(w=e.domStorage),e.mediaPlayerModel&&(_=e.mediaPlayerModel),e.customParametersModel&&(T=e.customParametersModel),e.cmsdModel&&(x=e.cmsdModel),e.dashMetrics&&(D=e.dashMetrics),e.adapter&&(y=e.adapter),e.videoModel&&(v=e.videoModel),e.settings&&(L=e.settings))},reset:function(){j(),B.off(c.Z.LOADING_PROGRESS,F,e),B.off(h.Z.QUALITY_CHANGE_RENDERED,$,e),B.off(h.Z.METRIC_ADDED,U,e),n&&n.reset()}},t=P.getLogger(e),j(),e}Ji.__dashjs_factory_name="AbrController";var Qi=u.Z.getSingletonFactory(Ji);Qi.QUALITY_DEFAULT=0,u.Z.updateSingletonFactory(Ji.__dashjs_factory_name,Qi);var er=Qi,tr=new Map([[o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function nr(){var e,t,n,i,r,s,a,u,h=this.context,p=(0,l.Z)(h).getInstance(),f=[];function g(){n&&(n.playbackRate=1,n.removeEventListener("canplay",g))}function m(){return f.length>0}function b(){if(n&&m()&&0===n.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),n.dispatchEvent(e)}}function y(e,t){n&&n.addEventListener(e,t)}function v(e,t){n&&n.removeEventListener(e,t)}function _(){return n?n.readyState:NaN}function E(){return n?n.buffered:null}function T(e,t,i,r,o){if(n)for(var s=0;s<n.textTracks.length;s++)if(n.textTracks[s].kind===e&&(!t||n.textTracks[s].label==t)&&n.textTracks[s].language===i&&n.textTracks[s].isTTML===r&&n.textTracks[s].isEmbedded===o)return n.textTracks[s];return null}function x(e,t){return e===o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||_()>=e?(t(),null):function(e,t){var n=function n(){v(e,n),t(e)};return y(e,n),{func:n,event:e}}(tr.get(e),t)}return e={addEventListener:y,addTextTrack:function(e,t,i,r,o){if(!n)return null;var s=T(e,t,i,r,o);return s||((s=n.addTextTrack(e,t,i)).isEmbedded=o,s.isTTML=r),s},appendChild:function(e){n&&(n.appendChild(e),void 0!==e.isTTML&&(n.textTracks[n.textTracks.length-1].isTTML=e.isTTML,n.textTracks[n.textTracks.length-1].isEmbedded=e.isEmbedded))},getBufferRange:E,getClientHeight:function(){return n?n.clientHeight:NaN},getClientWidth:function(){return n?n.clientWidth:NaN},getElement:function(){return n},getEnded:function(){return n?n.ended:null},getPlaybackQuality:function(){if(!n)return null;var e="webkitDroppedFrameCount"in n&&"webkitDecodedFrameCount"in n,t=null;return"getVideoPlaybackQuality"in n?t=n.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDroppedFrameCount+n.webkitDecodedFrameCount,creationTime:new Date}),t},getPlaybackRate:function(){return n?n.playbackRate:null},getPlayedRanges:function(){return n?n.played:null},getReadyState:_,getSource:function(){return n?n.src:null},getTTMLRenderingDiv:function(){return s},getTextTrack:T,getTextTracks:function(){return n?n.textTracks:[]},getTime:function(){return n?isNaN(i)?n.currentTime:i:null},getVideoHeight:function(){return n?n.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(n){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(n){var e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return n?n.videoWidth:NaN},getVttRenderingDiv:function(){return a},initialize:function(){p.on(c.Z.PLAYBACK_PLAYING,b,this)},isPaused:function(){return n?n.paused:null},isSeeking:function(){return n?n.seeking||!isNaN(i):null},isStalled:m,pause:function(){n&&(n.pause(),n.autoplay=!1)},play:function(){if(n){n.autoplay=!0;var e=n.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch((function(e){"NotAllowedError"===e.name&&p.trigger(c.Z.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing (".concat(e,")"))}))}},removeChild:function(e){n&&n.removeChild(e)},removeEventListener:v,reset:function(){clearTimeout(u),p.off(c.Z.PLAYBACK_PLAYING,b,this)},setCurrentTime:function(e,t){n&&(r&&r.func&&r.event&&v(r.event,r.func),i=e,r=x(o.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(function(){if(n)if(n.currentTime!==i)try{i=t?function(e){var t=E(),n=e,i=9999999999;if(t)for(var r=0;r<t.length;r++){var o=t.start(r),s=t.end(r),a=Math.abs(o-e),l=Math.abs(s-e);if(e>=o&&e<=s)return e;a<i&&(i=a,n=o),l<i&&(i=l,n=s)}return n}(i):i,isNaN(i)||(n.currentTime=i),i=NaN}catch(e){0===n.readyState&&e.code===e.INVALID_STATE_ERR&&(u=setTimeout((function(){n.currentTime=i,i=NaN}),400))}else i=NaN})))},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(n=e)&&(n.preload="auto")},setPlaybackRate:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n&&(!t&&n.readyState<=2&&e>0?n.addEventListener("canplay",g):n.playbackRate=e)},setSource:function(e){n&&(e?n.src=e:(n.removeAttribute("src"),n.load()))},setStallState:function(e,t){!function(e,t){t?function(e){null!==e&&n&&!n.seeking&&-1===f.indexOf(e)&&f.push(e)}(e):function(e){var t=f.indexOf(e);null!==e&&-1!==t&&f.splice(t,1)}(e)}(e,t)},setTTMLRenderingDiv:function(e){(s=e).style.position="absolute",s.style.display="flex",s.style.overflow="hidden",s.style.pointerEvents="none",s.style.top=0,s.style.left=0},setVttRenderingDiv:function(e){a=e},waitForReadyState:x,setDisableRemotePlayback:function(e){n&&(n.disableRemotePlayback=e)}},t=(0,d.Z)(h).getInstance().getLogger(e),i=NaN,e}nr.__dashjs_factory_name="VideoModel";var ir=u.Z.getSingletonFactory(nr),rr=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],or="dashjs_?_bitrate",sr="dashjs_?_settings",ar="localStorage",lr="lastBitrate",cr="lastMediaSettings";function ur(e){e=e||{};var t,n,i,r=this.context,s=e.settings;function a(e){if(void 0!==i)return i;var t;i=!1;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return n.warn("DOMStorage access denied: "+e.message),i}if(!t||e!==ar&&"sessionStorage"!==e)return i;try{t.setItem("1","1"),t.removeItem("1"),i=!0}catch(e){n.warn("DOMStorage is supported, but cannot be used: "+e.message)}return i}function l(){return 6e5*Math.round((new Date).getTime()/6e5)}function c(e,t){return a(e)&&s.get().streaming[t+"CachingInfo"].enabled}function u(){if(!s)throw new Error(o.Z.MISSING_CONFIG_ERROR)}return t={getSavedBitrateSettings:function(e){if(u(),!s.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var t=NaN;if(c(ar,lr)){var i=or.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(i))||{},o=(new Date).getTime()-parseInt(r.timestamp,10)>=s.get().streaming.lastBitrateCachingInfo.ttl||!1,a=parseFloat(r.bitrate);isNaN(a)||o?o&&localStorage.removeItem(i):(t=a,n.debug("Last saved bitrate for "+e+" was "+a))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(c(ar,lr)&&t){var i=or.replace(/\?/,e);try{localStorage.setItem(i,JSON.stringify({bitrate:t.toFixed(3),timestamp:l()}))}catch(e){n.error(e.message)}}},getSavedMediaSettings:function(e){if(u(),!s.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var t=null;if(c(ar,cr)){var n=sr.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(n))||{},r=(new Date).getTime()-parseInt(i.timestamp,10)>=s.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=i.settings,r&&(localStorage.removeItem(n),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(c(ar,cr)){var i=sr.replace(/\?/,e);try{localStorage.setItem(i,JSON.stringify({settings:t,timestamp:l()}))}catch(e){n.error(e.message)}}}},n=(0,d.Z)(r).getInstance().getLogger(t),a(ar)&&rr.forEach((function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){n.error(e.message)}}})),t}ur.__dashjs_factory_name="DOMStorage";var dr=u.Z.getSingletonFactory(ur),hr=n(2032),pr=n(2011);function fr(){var e,t,n,i,r,o,s,a,l,c,u,d,h,p=this.context;function f(e,n,r,o){var s=null,l=e?h.resolve(e.path):null,c=o||{init:!0,url:l?l.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:n};t.debug("Start searching for initialization.");var u=y(c);a.load({request:u,success:function(t){if(c.bytesLoaded=c.range.end,!(s=i.findInitRange(t)))return c.range.end=c.bytesLoaded+c.bytesToLoad,f(e,n,r,c);e.range=s,r(e)},error:function(){r(e)}}),t.debug("Perform init search: "+c.url)}function m(e,n,r,o,s,l){if(r&&(void 0===r.start||void 0===r.end)){var c=r?r.toString().split("-"):null;r=c?{start:parseFloat(c[0]),end:parseFloat(c[1])}:null}s=s||b;var u=null,d=null,p=!!r,f=e?h.resolve(e.path):null,g={init:!1,url:f?f.url:void 0,range:p?r:{start:0,end:1500},searching:!p,bytesLoaded:l?l.bytesLoaded:0,bytesToLoad:1500,mediaType:n},v=y(g);a.load({request:v,success:function(r){var a=g.bytesToLoad,l=r.byteLength;if(g.bytesLoaded=g.range.end-g.range.start,u=i.parse(r),(d=u.getBox("sidx"))&&d.isComplete){var c,h,p=d.references;if(null!=p&&p.length>0&&(c=1===p[0].reference_type),c){var f,b,y,v;t.debug("Initiate multiple SIDX load."),g.range.end=g.range.start+d.size;var _=[],E=0,T=(d.offset||g.range.start)+d.size,x=function(t){t?(_=_.concat(t),++E>=b&&(_.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),s(_,e,o))):s(null,e,o)};for(f=0,b=p.length;f<b;f++)y=T,v=T+p[f].referenced_size-1,T+=p[f].referenced_size,m(e,n,{start:y,end:v},o,x,g)}else t.debug("Parsing segments from SIDX. representation "+n+" - id: "+e.id+" for range : "+g.range.start+" - "+g.range.end),h=function(e,t){for(var n,i,r,o,s=e.references,a=s.length,l=e.timescale,c=e.earliest_presentation_time,u=t.range.start+e.offset+e.first_offset+e.size,d=[],h=0;h<a;h++)r=s[h].subsegment_duration,o=s[h].referenced_size,(n=new pr.Z).duration=r,n.startTime=c,n.timescale=l,i=u+o-1,n.mediaRange=u+"-"+i,d.push(n),c+=r,u+=o;return d}(d,g),s(h,e,o)}else{if(d)g.range.start=d.offset||g.range.start,g.range.end=g.range.start+(d.size||a);else{if(l<g.bytesLoaded)return void s(null,e,o);var w=u.getLastBox();w&&w.size?(g.range.start=w.offset+w.size,g.range.end=g.range.start+a):g.range.end+=a}m(e,n,g.range,o,null,g)}},error:function(){s(null,e,o)}}),t.debug("Perform SIDX load for type ".concat(n," : ").concat(g.url," with range ").concat(g.range.start," - ").concat(g.range.end))}function b(e,t,n){n({segments:e,representation:t,error:e?void 0:new T.Z(l.SEGMENT_BASE_LOADER_ERROR_CODE,l.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function y(e){if(e.url){var t=new g.Z;return t.setInfo(e),t}}return e={setConfig:function(a){a.baseURLController&&(h=a.baseURLController),a.dashMetrics&&(o=a.dashMetrics),a.mediaPlayerModel&&(s=a.mediaPlayerModel),a.errHandler&&(n=a.errHandler),a.boxParser&&(i=a.boxParser),a.debug&&(t=a.debug.getLogger(e)),a.requestModifier&&(r=a.requestModifier),a.errors&&(l=a.errors),a.urlUtils&&(d=a.urlUtils),a.constants&&(c=a.constants),a.dashConstants&&(u=a.dashConstants)},initialize:function(){a=ft(p).create({errHandler:n,dashMetrics:o,mediaPlayerModel:s,requestModifier:r,boxParser:i,errors:l,urlUtils:d,constants:c,dashConstants:u})},loadInitialization:function(e,t){return new Promise((function(n){f(e,t,n)}))},loadSegments:function(e,t,n){return new Promise((function(i){m(e,t,n,i)}))},reset:function(){a&&(a.abort(),a=null)}}}fr.__dashjs_factory_name="SegmentBaseLoader";var gr=u.Z.getSingletonFactory(fr);function mr(e){var t;e=e||{};var n=new DataView(e.data),i=0;function r(e,t){var r=!0,o=0;if(void 0===t&&(t=!1),e.tag>16777215?(n.getUint32(i)!==e.tag&&(r=!1),o=4):e.tag>65535?(256*n.getUint16(i)+n.getUint8(i+2)!==e.tag&&(r=!1),o=3):e.tag>255?(n.getUint16(i)!==e.tag&&(r=!1),o=2):(n.getUint8(i)!==e.tag&&(r=!1),o=1),!r&&e.required&&!t)throw new Error("required tag not found");return r&&(i+=o),r}function o(e){var t=1,r=128,o=-1,s=0,a=n.getUint8(i),l=0;for(l=0;l<8;l+=1){if((a&r)===r){s=void 0===e?a&~r:a,o=l;break}r>>=1}for(l=0;l<o;l+=1,t+=1)s=s<<8|255&n.getUint8(i+t);return i+=t,s}return t={getPos:function(){return i},setPos:function(e){i=e},consumeTag:r,consumeTagAndSize:function(e,t){var n=r(e,t);return n&&o(),n},parseTag:function(e){var n;return r(e),n=o(),t[e.parse](n)},skipOverElement:function(e,t){var n,s=r(e,t);return s&&(n=o(),i+=n),s},getMatroskaCodedNum:o,getMatroskaFloat:function(e){var t;switch(e){case 4:t=n.getFloat32(i),i+=4;break;case 8:t=n.getFloat64(i),i+=8}return t},getMatroskaUint:function(e){if(e>4)return function(e){for(var t=Math.floor(Number.MAX_SAFE_INTEGER/256),r=0,o=0;o<e;o+=1){if(r>t)throw new Error("Value exceeds safe integer limit");r*=256;var s=n.getUint8(i+o);if(r>Number.MAX_SAFE_INTEGER-s)throw new Error("Value exceeds safe integer limit");r+=s}return i+=e,r}(e);for(var t=0,r=0;r<e;r+=1)t<<=8,t|=255&n.getUint8(i+r);return i+=e,t>>>0},moreData:function(){return i<n.byteLength}}}mr.__dashjs_factory_name="EBMLParser";var br=u.Z.getClassFactory(mr);function yr(){var e,t,n,i,r,s,a,l,c,u,d=this.context;function h(e){var t=new g.Z;return t.setInfo(e),t}return e={setConfig:function(n){if(!(n.baseURLController&&n.dashMetrics&&n.mediaPlayerModel&&n.errHandler))throw new Error(o.Z.MISSING_CONFIG_ERROR);u=n.baseURLController,s=n.dashMetrics,a=n.mediaPlayerModel,i=n.errHandler,c=n.errors,t=n.debug.getLogger(e),r=n.requestModifier},initialize:function(){l=ft(d).create({errHandler:i,dashMetrics:s,mediaPlayerModel:a,requestModifier:r,errors:c})},loadInitialization:function(e,n){return new Promise((function(i){var r=null,o=e?u.resolve(e.path):null,s=e?e.range.split("-"):null,a={range:{start:s?parseFloat(s[0]):null,end:s?parseFloat(s[1]):null},request:r,url:o?o.url:void 0,init:!0,mediaType:n};t.info("Start loading initialization."),r=h(a),l.load({request:r,success:function(){i(e)},error:function(){i(e)}}),t.debug("Perform init load: "+a.url)}))},loadSegments:function(e,i,r){return new Promise((function(o){var s=null,a=e?u.resolve(e.path):null,p=a?a.url:void 0;s=h({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:s,url:p,init:!1,mediaType:i}),t.debug("Parsing ebml header"),l.load({request:s,success:function(i){!function(e,i,r,o){if(e&&0!==e.byteLength){var s,a,c,u,p=br(d).create({data:e}),f=r?r.split("-"):null,g=null,m={url:i,range:{start:f?parseFloat(f[0]):null,end:f?parseFloat(f[1]):null},request:g};for(t.debug("Parse EBML header: "+m.url),p.skipOverElement(n.EBML),p.consumeTag(n.Segment),c=p.getMatroskaCodedNum(),c+=p.getPos(),u=p.getPos();p.moreData()&&!p.consumeTagAndSize(n.Segment.Info,!0);)if(!(p.skipOverElement(n.Segment.SeekHead,!0)||p.skipOverElement(n.Segment.Tracks,!0)||p.skipOverElement(n.Segment.Cues,!0)||p.skipOverElement(n.Void,!0)))throw new Error("no valid top level element found");for(;void 0===s;){var b=p.getMatroskaCodedNum(!0),y=p.getMatroskaCodedNum();b===n.Segment.Info.Duration.tag?s=p[n.Segment.Info.Duration.parse](y):p.setPos(p.getPos()+y)}g=h(m),l.load({request:g,success:function(e){a=function(e,i,r,o){var s,a,l,c,u,h,p,f;for(l=[],u=0,h=(a=function(e){var t,i,r=[],o=br(d).create({data:e});for(o.consumeTagAndSize(n.Segment.Cues);o.moreData()&&o.consumeTagAndSize(n.Segment.Cues.CuePoint,!0);){for((t={}).CueTime=o.parseTag(n.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];o.moreData()&&o.consumeTag(n.Segment.Cues.CuePoint.CueTrackPositions,!0);){var s=o.getMatroskaCodedNum(),a=o.getPos();if((i={}).Track=o.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===i.Track)throw new Error("Cue track cannot be 0");i.ClusterPosition=o.parseTag(n.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(i),o.setPos(a+s)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");r.push(t)}if(0===r.length)throw new Error("mandatory cuepoint not found");return r}(e)).length;u<h;u+=1)c=new pr.Z,s=u<a.length-1?a[u+1].CueTime-a[u].CueTime:o-a[u].CueTime,c.duration=s,c.startTime=a[u].CueTime,c.timescale=1e3,p=a[u].CueTracks[0].ClusterPosition+i,f=u<a.length-1?a[u+1].CueTracks[0].ClusterPosition+i-1:r-1,c.mediaRange=p+"-"+f,l.push(c);return t.debug("Parsed cues: "+l.length+" cues."),l}(e,u,c,s),o(a)},error:function(){t.error("Download Error: Cues "+m.url),o(null)}}),t.debug("Perform cues load: "+m.url+" bytes="+m.range.start+"-"+m.range.end)}else o(null)}(i,p,r,(function(t){o({segments:t,representation:e,error:t?void 0:new T.Z(c.SEGMENT_BASE_LOADER_ERROR_CODE,c.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}))},error:function(){o({representation:e,error:new T.Z(c.SEGMENT_BASE_LOADER_ERROR_CODE,c.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})}))},reset:function(){l&&(l.abort(),l=null)}},n={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}yr.__dashjs_factory_name="WebmSegmentBaseLoader";var vr=u.Z.getSingletonFactory(yr);function _r(e){e=e||{};var t,n,i,r=this.context,o=e.eventBus,s=e.events,a=e.dashMetrics,l=e.mediaPlayerModel,c=e.errHandler,u=e.baseURLController,d=e.debug,h=e.boxParser,p=e.requestModifier,f=e.errors;function g(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}return t={initialize:function(){n.initialize(),i.initialize()},getSegmentBaseInitSegment:function(e){return g(e.representation.mimeType)?i.loadInitialization(e.representation,e.mediaType):n.loadInitialization(e.representation,e.mediaType)},getSegmentList:function(e){return g(e.mimeType)?i.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):n.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)},reset:function(){n.reset(),i.reset()}},n=gr(r).getInstance(),i=vr(r).getInstance(),n.setConfig({baseURLController:u,dashMetrics:a,mediaPlayerModel:l,errHandler:c,eventBus:o,events:s,errors:f,debug:d,boxParser:h,requestModifier:p}),i.setConfig({baseURLController:u,dashMetrics:a,mediaPlayerModel:l,errHandler:c,eventBus:o,events:s,errors:f,debug:d,requestModifier:p}),t}_r.__dashjs_factory_name="SegmentBaseController";var Er=u.Z.getSingletonFactory(_r),Tr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},xr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.viewpointsWithSchemeIdUri=null,this.accessibility=null,this.accessibilitiesWithSchemeIdUri=null,this.audioChannelConfiguration=null,this.audioChannelConfigurationsWithSchemeIdUri=null,this.roles=null,this.rolesWithSchemeIdUri=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={},this.supplementalPropertiesAsArray=[],this.essentialProperties={},this.essentialPropertiesAsArray=[],this.segmentAlignment=!1,this.subSegmentAlignment=!1},wr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},kr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null,this.serviceDescriptions=[],this.protocol=null},Sr=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==t[0],this.path=t.split("/").filter((function(e){return 0!==e.length})).map((function(e){var t={name:e},i=e.indexOf("[");if(-1!=i){t.name=e.substring(0,i);var r=e.substring(i+1,e.length-1);n.valid=n.valid&&-1==r.indexOf("[");var o=r.indexOf("=");-1!=o?(t.attribute={name:r.substring(1,o),value:r.substring(o+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(r,10)-1}return t}))}var t;return(t=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"findsTextReplace",value:function(){return"text()"===this.path[this.path.length-1].name}},{key:"getMpdTarget",value:function(e,t){for(var n=null,i=e,r=1,o="MPD";r<this.path.length&&null!==i;){n=i;var s=this.path[r];if(o=s.name,r!==this.path.length-1||!o.startsWith("@")&&"text()"!==o){var a=n[o+"_asArray"]||[];0===a.length&&n[o]&&a.push(n[o]),s.position?i=a[s.position]||null:s.attribute?function(){var e=s.attribute;i=a.filter((function(t){return t[e.name]==e.value}))[0]||null}():i=a[0]||null}r++}return null===i?null:o.startsWith("@")?{name:o.substring(1),leaf:i,target:i}:"text()"===o?{name:"__text",leaf:i,target:i}:{name:o,leaf:i,target:t?n:i}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),Cr=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.xpath=n,this.value=i,this.position=null}var t;return(t=[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();function Ar(){var e,t,n=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(s.Z.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.PUBLISH_TIME)?new Date(e[s.Z.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.ORIGINAL_PUBLISH_TIME)?new Date(e[s.Z.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[s.Z.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map((function(e){var n=Object.keys(e)[0];if("add"!==n&&"remove"!==n&&"replace"!==n)return t.warn("Ignoring node of invalid action: ".concat(n)),null;var i=e[n],r=i.sel;if("add"===n&&i.type){if(!i.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: ".concat(i.type,"=").concat(i.__text)),null;r="".concat(r,"/").concat(i.type)}var o=new Sr(r);if(!o.isValid())return t.warn("Ignoring action with invalid selector: ".concat(n," - ").concat(r)),null;var s=null;o.findsAttribute()||o.findsTextReplace()?s=i.__text||"":"remove"!==n&&(s=i.__children.reduce((function(e,t){var n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e}),{}));var a=new Cr(n,o,s);return"add"===n&&(a.position=i.pos),a})).filter((function(e){return!!e})):[]}},t=(0,d.Z)(n).getInstance().getLogger(e),e}Ar.__dashjs_factory_name="PatchManifestModel";var Ir=u.Z.getSingletonFactory(Ar);function Or(){var e,t,n,i,r,o,a,l=this.context;function c(e,n,o){var a,l=t.getAdaptationsForType(i[0].mpd.manifest,e,n);if(!l||0===l.length)return null;if(l.length>1&&o){var c=h(o,n);if(r[o.id]&&r[o.id][n])for(var d=0,p=l.length;d<p;d++)if(u(r[o.id][n],c[d]))return l[d];for(var f=0,g=l.length;f<g;f++)if(a=l[f],t.getRolesForAdaptation(a).filter((function(e){return e.value===s.Z.MAIN}))[0])return l[f]}return l[0]}function u(e,t){if(!e||!t)return!1;var n=e.id===t.id,i=e.codec===t.codec,r=e.viewpoint===t.viewpoint,o=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),s=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),c=e.accessibility.toString()===t.accessibility.toString(),u=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),h=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return n&&i&&r&&o&&s&&a&&l&&c&&u&&d&&h}function d(e,n,i,r,s,a){var l,c,u,d,h,p,f=[];if(!r||0===r.length)return[];var g=t.getAdaptationsForPeriod(n);for(d=0,p=r.length;d<p;d++)if(l=r[d],c=v(g[u=t.getIndexForAdaptation(l,e,i.index)]),a){var m=c.accessibility.length;for(h=0;h<m;h++)if(c){var b=c.accessibility[h];if(0===b.indexOf("cea-608:")){var y=b.substring(8).split(";");if("CC"===y[0].substring(0,2))for(h=0;h<y.length;h++)c||(c=v.call(this,g[u])),_(c,y[h].substring(0,3),y[h].substring(4)),f.push(c),c=null;else for(h=0;h<y.length;h++)c||(c=v.call(this,g[u])),_(c,"CC"+(h+1),y[h]),f.push(c),c=null}else 0===b.indexOf("cea-608")&&(_(c,o.CC1,"eng"),f.push(c),c=null)}}else s===o.IMAGE?(c.type=o.IMAGE,f.push(c),c=null):c&&f.push(c);return f}function h(e,n,r){var s=i,a=r,l=[];if(a)T(),s=p(a);else{if(!(i.length>0))return l;a=i[0].mpd.manifest}var c=y(e,s),u=t.getAdaptationsForType(a,e?e.index:null,n);return l=d(a,c,e,u,n),n===o.TEXT&&(u=t.getAdaptationsForType(a,e?e.index:null,o.VIDEO),l=l.concat(d(a,c,e,u,n,!0))),l}function p(e){var n=f(e);return t.getRegularPeriods(n)}function f(e){var n=m(e);return t.getMpd(n)}function g(){i=[],r={}}function m(e){return e||(i.length>0?i[0].mpd.manifest:null)}function b(e){try{var n=y(e.streamInfo,i),r=t.getAdaptationsForPeriod(n);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&r?r[e.index]:null}catch(e){return null}}function y(e,t){for(var n=t.length,i=0;i<n;i++){var r=t[i];if(e&&e.id===r.id)return r}return null}function v(e){if(!e)return null;var n,i,r,o,s,l=new xr,c=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(l.id=e.id,l.index=e.index,l.type=e.type,l.streamInfo=E(e.period),l.representationCount=t.getRepresentationCount(c),l.labels=t.getLabelsForAdaptation(c),l.lang=t.getLanguageForAdaptation(c),l.segmentAlignment=t.getSegmentAlignment(c),l.subSegmentAlignment=t.getSubSegmentAlignment(c),n=t.getViewpointForAdaptation(c),l.viewpoint=n.length?n[0].value:void 0,l.viewpointsWithSchemeIdUri=n,s=t.getAccessibilityForAdaptation(c),l.accessibility=s.map((function(e){var t=e.value,n=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==a&&(n=t?"cea-608:"+t:"cea-608",l.embeddedCaptions=!0),n})),l.accessibilitiesWithSchemeIdUri=s,i=t.getAudioChannelConfigurationForAdaptation(c),l.audioChannelConfiguration=i.map((function(e){return e.value})),l.audioChannelConfigurationsWithSchemeIdUri=i,0===l.audioChannelConfiguration.length&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0&&(r=t.getAudioChannelConfigurationForRepresentation(c.Representation_asArray[0]),l.audioChannelConfiguration=r.map((function(e){return e.value})),l.audioChannelConfigurationsWithSchemeIdUri=r),o=t.getRolesForAdaptation(c),l.roles=o.map((function(e){return e.value})),l.rolesWithSchemeIdUri=o,l.codec=t.getCodec(c),l.mimeType=t.getMimeType(c),l.contentProtection=t.getContentProtectionData(c),l.bitrateList=t.getBitrateListForAdaptation(c),l.selectionPriority=t.getSelectionPriority(c),l.contentProtection){var u=l.contentProtection.map((function(e){return t.getKID(e)})).filter((function(e){return null!==e}));if(u.length){var d=u[0];l.contentProtection.forEach((function(e){e.keyId=d}))}}if(l.isText=t.getIsText(c),l.supplementalProperties=t.getSupplementalPropertiesForAdaptation(c),(!l.supplementalProperties||0===Object.keys(l.supplementalProperties).length)&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0){var h=c.Representation_asArray.map((function(e){return t.getSupplementalPropertiesForRepresentation(e)}));h.every((function(e){return JSON.stringify(e)===JSON.stringify(h[0])}))&&(l.supplementalProperties=h[0])}if(l.supplementalPropertiesAsArray=t.getSupplementalPropertiesAsArrayForAdaptation(c),(!l.supplementalPropertiesAsArray||0===l.supplementalPropertiesAsArray.length)&&Array.isArray(c.Representation_asArray)&&c.Representation_asArray.length>0){var p=c.Representation_asArray.map((function(e){return t.getSupplementalPropertiesAsArrayForRepresentation(e)}));p.every((function(e){return JSON.stringify(e)===JSON.stringify(p[0])}))&&(l.supplementalPropertiesAsArray=p[0])}return l.essentialProperties=t.getEssentialPropertiesForAdaptation(c),l.essentialPropertiesAsArray=t.getEssentialPropertiesAsArrayForAdaptation(c),l.isFragmented=t.getIsFragmented(c),l.isEmbedded=!1,l}function _(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=o.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1;var i=dn()(n);e.lang=i||n,e.roles=["caption"],e.rolesWithSchemeIdUri=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function E(e){var n,i,r=new wr;return r.id=e.id,r.index=e.index,r.start=e.start,r.duration=e.duration,r.manifestInfo=(n=e.mpd,(i=new kr).dvrWindowSize=n.timeShiftBufferDepth,i.loadedTime=n.manifest.loadedTime,i.availableFrom=n.availabilityStartTime,i.minBufferTime=n.manifest.minBufferTime,i.maxFragmentDuration=n.maxSegmentDuration,i.duration=t.getDuration(n.manifest),i.isDynamic=t.getIsDynamic(n.manifest),i.serviceDescriptions=t.getServiceDescriptions(n.manifest),i.protocol=n.manifest.protocol,i),r.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(r.start+r.duration-r.manifestInfo.duration)<1,r}function T(){if(!o)throw new Error("setConfig function has to be called previously")}function x(e){return i.length>0?i[0].mpd.manifest.Period_asArray[e]:null}function w(e,t,n){var i,r,o,s,a;if(e)for(i=e.AdaptationSet_asArray,s=0;s<i.length;s+=1)for(o=i[s].Representation_asArray,a=0;a<o.length;a+=1)if(t===(r=o[a]).id)return n?a:r;return null}return e={getBandwidthForRepresentation:function(e,t){var n;return(n=w(x(t),e))?n.bandwidth:null},getIndexForRepresentation:function(e,t){return function(e,t){var n=w(e,t,!0);return null!==n?n:-1}(x(t),e)},getMaxIndexForBufferType:function(e,n){return function(e,n){var i,r,o,s;if(!e||!n)return-1;for(r=e.AdaptationSet_asArray,s=0;s<r.length;s+=1)if(o=(i=r[s]).Representation_asArray,t.getIsTypeOf(i,n))return o.length;return-1}(x(n),e)},convertRepresentationToRepresentationInfo:function(e){if(e){var n=new Tr,i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],r=t.getRepresentationFor(e.index,i);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(r),n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.mediaInfo=v(e.adaptation),n}return null},getStreamsInfo:function(e,t){var n=[],r=i;if(e&&(T(),r=p(e)),r.length>0){(!t||t>r.length)&&(t=r.length);for(var o=0;o<t;o++)n.push(E(r[o]))}return n},getMediaInfoForType:function(e,n){if(0===i.length||!e)return null;var r=y(e,i);if(!r)return null;var o=t.getAdaptationsForPeriod(r),s=c(e.index,n,e);return s?v(o[t.getIndexForAdaptation(s,i[0].mpd.manifest,e.index)]):null},getAllMediaInfoForType:h,getAdaptationForType:c,getRealAdaptation:function(e,n){var r,o,s=y(e,i);return r=n?n.id:null,i.length>0&&s&&(o=r?t.getAdaptationForId(r,i[0].mpd.manifest,s.index):t.getAdaptationForIndex(n?n.index:null,i[0].mpd.manifest,s.index)),o},getProducerReferenceTimes:function(e,n){var r,o,s=y(e,i);return r=n?n.id:null,i.length>0&&s&&(o=r?t.getAdaptationForId(r,i[0].mpd.manifest,s.index):t.getAdaptationForIndex(n?n.index:null,i[0].mpd.manifest,s.index)),o?t.getProducerReferenceTimesForAdaptation(o):[]},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,i[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){var n=b(e);return t.getRepresentationsForAdaptation(n)},getEventsFor:function(e,n,r){var o=[];if(i.length>0){var s=i[0].mpd.manifest;if(e instanceof wr){var a=y(e,i);o=t.getEventsForPeriod(a)}else if(e instanceof xr){var l=y(r,i);o=t.getEventStreamForAdaptationSet(s,b(e),l)}else if(e instanceof Tr){var c=y(r,i);o=t.getEventStreamForRepresentation(s,n,c)}}return o},getEvent:function(e,t,n,i){try{if(!e||!t||isNaN(n)||!i)return null;var r=e.scheme_id_uri,o=e.value;if(!t[r+"/"+o])return null;var s,a=new ye,l=e.timescale||1,c=i.adaptation.period.start,u=t[r+"/"+o],d=isNaN(i.presentationTimeOffset)?isNaN(u.presentationTimeOffset)?0:u.presentationTimeOffset:i.presentationTimeOffset,h=e.presentation_time_delta/l;s=0===e.version?c+n-d+h:c-d+h;var p=e.event_duration/l,f=e.id,g=e.message_data;return a.eventStream=u,a.eventStream.value=o,a.eventStream.timescale=l,a.duration=p,a.id=f,a.calculatedPresentationTime=s,a.messageData=g,a.presentationTimeDelta=h,a}catch(e){return null}},getMpd:f,setConfig:function(e){e&&(e.constants&&(o=e.constants),e.cea608parser&&(a=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;T(),i=p(e)},getIsTextTrack:function(e){return t.getIsText(e)},getUTCTimingSources:function(){var e=m();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=i.length>0?i[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var n=f(e);return t.getAvailabilityStartTime(n)},getIsTypeOf:function(e,n){return t.getIsTypeOf(e,n)},getIsDynamic:function(e){var n=m(e);return t.getIsDynamic(n)},getDuration:function(e){var n=m(e);return t.getDuration(n)},getRegularPeriods:p,getContentSteering:function(e){return t.getContentSteering(e)},getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var n=t.getPatchLocation(e),i=t.getPublishTime(e);return n&&0!==n.length&&i?n.filter((function(e){return isNaN(e.ttl)||i.getTime()+e.ttl>(new Date).getTime()})):[]},getManifestUpdatePeriod:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,n)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return n.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,n,i){return t.getCodec(e,n,i)},getPeriodById:function(e){if(!e||0===i.length)return null;var t=i.filter((function(t){return t.id===e}));return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,n){r[e]=r[e]||{},r[e][t]=r[e][t]||{},r[e][t]=n},isPatchValid:function(e,i){var r=t.getId(e),o=n.getMpdId(i),s=t.getPublishTime(e),a=n.getPublishTime(i),l=n.getOriginalPublishTime(i);return!!(r&&o&&r==o&&s&&l&&s.getTime()==l.getTime()&&a&&s.getTime()<a.getTime())},applyPatchToManifest:function(e,t){n.getPatchOperations(t).forEach((function(t){var n=t.getMpdTarget(e);if(null!==n){var i=n.name,r=n.target,o=n.leaf;if(t.xpath.findsAttribute()||"__text"===i)switch(t.action){case"add":case"replace":r[i]=t.value;break;case"remove":delete r[i]}else{var s=(r[i+"_asArray"]||[]).indexOf(o),a="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete r[i],-1!=s)){var l=r[i+"_asArray"];l.splice(s,1),l.length>1?r[i]=l:1==l.length?r[i]=l[0]:delete r[i+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach((function(e){var n=t.value[e],o=r[e+"_asArray"]||[];if(0===o.length&&r[e]&&o.push(r[e]),0===o.length)o=n;else{var l=o.length;l=e==i&&-1!=s?s+(a?0:1)+("replace"==t.action?-1:0):a?0:o.length,o.splice.apply(o,[l,0].concat(n))}r[e+"_asArray"]=o,r[e]=1==o.length?o[0]:o}))}}}))},areMediaInfosEqual:u,reset:g},t=Fe(l).getInstance(),n=Ir(l).getInstance(),g(),e}Or.__dashjs_factory_name="DashAdapter";var Nr=u.Z.getSingletonFactory(Or),Rr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"round10",value:function(e,t){return function(e,t,n){return void 0===n||0==+n?Math[e](t):(n=+n,null===(t=+t)||isNaN(t)||"number"!=typeof n||n%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}("round",e,t)}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e,t),e}(),Dr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},Lr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},Mr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},Pr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=a.Z.BUFFER_EMPTY},Br=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},jr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function Fr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var $r=function e(){Fr(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},Ur=function e(){Fr(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},Hr=function e(){Fr(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},Gr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},Vr=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function Wr(e){var t,n,i=(e=e||{}).settings,r=this.context,s=(0,l.Z)(r).getInstance();function u(){s.trigger(c.Z.METRICS_CHANGED)}function d(e){s.trigger(c.Z.METRIC_CHANGED,{mediaType:e}),u()}function h(e,t,n){s.trigger(c.Z.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),d(e)}function p(e,t,n){s.trigger(c.Z.METRIC_ADDED,{mediaType:e,metric:t,value:n}),d(e)}function f(e,t){var i=null;return e?(n.hasOwnProperty(e)?i=n[e]:t||(i=new Dr,n[e]=i),i):i}function g(e,t,n){var r=f(e);null!==r&&(r[t].push(n),r[t].length>i.get().streaming.metrics.maxListDepth&&r[t].shift())}function m(e,t,n){g(e,t,n),p(e,t,n)}return t={clearCurrentMetricsForType:function(e){delete n[e],d(e)},clearAllCurrentMetrics:function(){n={},u()},getMetricsFor:f,addHttpRequest:function e(t,n,i,r,o,s,l,c,u,d,h,p,f,g,b,y,v){var _=new A.w;null!=s&&s!==r&&(e(t,null,i,r,o,null,null,c,u,null,null,null,f,null,null,y,v),_.actualurl=s),_.tcpid=n,_.type=i,_.url=r,_.range=c,_.trequest=u,_.tresponse=d,_.responsecode=p,_.cmsd=v,_._tfinish=h,_._stream=t,_._mediaduration=f,_._quality=o,_._responseHeaders=g,_._serviceLocation=l,_._fileLoaderType=y,b?b.forEach((function(e){!function(e,t,n,i){var r=new A.O;r.s=t,r.d=n,r.b=i,e.trace.push(r),e.interval||(e.interval=0),e.interval+=n}(_,e.s,e.d,e.b)})):(delete _.interval,delete _.trace),m(t,a.Z.HTTP_REQUEST,_)},addRepresentationSwitch:function(e,t,n,i,r){var o=new Lr;o.t=t,o.mt=n,o.to=i,r?o.lto=r:delete o.lto,m(e,a.Z.TRACK_SWITCH,o)},addBufferLevel:function(e,t,n){var i=new Mr;i.t=t,i.level=n,m(e,a.Z.BUFFER_LEVEL,i)},addBufferState:function(e,t,n){var i=new Pr;i.target=n,i.state=t,m(e,a.Z.BUFFER_STATE,i)},addDVRInfo:function(e,t,n,i){var r=new Br;r.time=t,r.range=i,r.manifestInfo=n,m(e,a.Z.DVR_INFO,r)},addDroppedFrames:function(e,t){var n=new jr,i=f(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,i.length>0&&i[i.length-1]==n||m(e,a.Z.DROPPED_FRAMES,n))},addSchedulingInfo:function(e,t,n,i,r,o,s,l,c){var u=new Gr;u.mediaType=e,u.t=t,u.type=n,u.startTime=i,u.availabilityStartTime=r,u.duration=o,u.quality=s,u.range=l,u.state=c,m(e,a.Z.SCHEDULING_INFO,u)},addRequestsQueue:function(e,t,n){var i=new Vr;i.loadingRequests=t,i.executedRequests=n,f(e).RequestsQueue=i,p(e,a.Z.REQUESTS_QUEUE,i)},addManifestUpdate:function(e,t,n,i,r,s,l,c,u,d){var h=new $r;h.mediaType=e,h.type=t,h.requestTime=n,h.fetchTime=i,h.availabilityStartTime=r,h.presentationStartTime=s,h.clientTimeOffset=l,h.currentTime=c,h.buffered=u,h.latency=d,g(o.Z.STREAM,a.Z.MANIFEST_UPDATE,h),p(e,a.Z.MANIFEST_UPDATE,h)},updateManifestUpdateInfo:function(e,t){if(e){for(var n in t)e[n]=t[n];h(e.mediaType,a.Z.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,i,r){if(e){var o=new Ur;o.id=t,o.index=n,o.start=i,o.duration=r,e.streamInfo.push(o),h(e.mediaType,a.Z.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,n,i,r,o,s,l){if(e&&e.representationInfo){var c=new Hr;c.id=t,c.index=n,c.streamIndex=i,c.mediaType=r,c.startNumber=s,c.fragmentInfoType=l,c.presentationTimeOffset=o,e.representationInfo.push(c),h(e.mediaType,a.Z.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach((function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,m(o.Z.STREAM,a.Z.PLAY_LIST,e)},addDVBErrors:function(e){m(o.Z.STREAM,a.Z.DVB_ERRORS,e)}},n={},t}Wr.__dashjs_factory_name="MetricsModel";var zr=u.Z.getSingletonFactory(Wr);function qr(e){e=e||{};var t,n,i,r,s=this.context,l=e.metricsModel;function c(e){var t=l.getMetricsFor(e,!0);if(!t)return null;var n,i=t.HttpList,r=null;if(!i||i.length<=0)return null;for(n=i.length-1;n>=0;){if(i[n].responsecode){r=i[n];break}n--}return r}function u(e){var t=l.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function d(e,t){if(!e)return null;var n=e[t];return n&&0!==n.length?n[n.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return d(l.getMetricsFor(e,!0),a.Z.TRACK_SWITCH)},getCurrentBufferState:function(e){return d(l.getMetricsFor(e,!0),a.Z.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=d(l.getMetricsFor(e,!0),a.Z.BUFFER_LEVEL);return t?Rr.round10(t.level/1e3,-3):0},getCurrentHttpRequest:c,getHttpRequests:u,getCurrentDroppedFrames:function(){return d(l.getMetricsFor(o.Z.VIDEO,!0),a.Z.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return d(l.getMetricsFor(e,!0),a.Z.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return d(e?l.getMetricsFor(e,!0):l.getMetricsFor(o.Z.VIDEO,!0)||l.getMetricsFor(o.Z.AUDIO,!0),a.Z.DVR_INFO)},getCurrentManifestUpdate:function(){return d(l.getMetricsFor(o.Z.STREAM),a.Z.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){if(!t)return null;var n={},i=c(e);i&&(n=$e.Z.parseHttpHeaders(i._responseHeaders));var r=n[t.toLowerCase()];return void 0===r?null:r},getLatestMPDRequestHeaderValueByID:function(e){if(!e)return null;var t,n,i,r={};for(i=(t=u(o.Z.STREAM)).length-1;i>=0;i--)if((n=t[i]).type===A.w.MPD_TYPE){r=$e.Z.parseHttpHeaders(n._responseHeaders);break}var s=r[e.toLowerCase()];return void 0===s?null:s},addRepresentationSwitch:function(e,t,n,i,r){l.addRepresentationSwitch(e,t,n,i,r)},addDVRInfo:function(e,t,n,i){l.addDVRInfo(e,t,n,i)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();l.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();l.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var n=this.getCurrentManifestUpdate();l.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){l.addManifestUpdate(o.Z.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,n,i,r,o){l.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,i,r,e.fileLoaderType,o)},addSchedulingInfo:function(e,t){l.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,n){l.addRequestsQueue(e,t,n)},addBufferLevel:function(e,t,n){l.addBufferLevel(e,t,n)},addBufferState:function(e,t,n){l.addBufferState(e,t,n)},addDroppedFrames:function(e){l.addDroppedFrames(o.Z.VIDEO,e)},addPlayList:function(){r&&(l.addPlayList(r),r=null)},addDVBErrors:function(e){l.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(r=new J).start=new Date,r.mstart=e,r.starttype=t},createPlaylistTraceMetrics:function(e,t,r){!0===n&&(n=!1,(i=new Q).representationid=e,i.start=new Date,i.mstart=t,i.playbackspeed=null!==r?r.toString():null)},updatePlayListTraceMetrics:function(e){if(i)for(var t in i)i[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===n&&r&&i&&i.start){var o=i.start,s=e.getTime()-o.getTime();i.duration=s,i.stopreason=t,r.trace.push(i),n=!0}},clearAllCurrentMetrics:function(){l.clearAllCurrentMetrics()}},l=l||zr(s).getInstance({settings:e.settings}),n=!0,i=null,r=null,t}qr.__dashjs_factory_name="DashMetrics";var Yr=u.Z.getSingletonFactory(qr);function Kr(){var e,t,n,i,r=this.context,a=(0,l.Z)(r).getInstance(),u=(0,C.Z)(r).getInstance();function d(e){i=e}function p(e,t,n,i){var r,o=t.adaptation.period.mpd,s=o.availabilityStartTime;if(i)r=n&&o.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(s.getTime()+1e3*(e+o.timeShiftBufferDepth)):o.availabilityEndTime;else if(n){var a=t.availabilityTimeOffset;r=new Date(s.getTime()+1e3*(e-a))}else r=s;return r}function f(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*i)/1e3}function g(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function m(e){var n={start:NaN,end:NaN},i=e[0].getAdapter().getRegularPeriods()[0],r=f(new Date,i);if(!e||0===e.length)return{range:n,now:r};e.forEach((function(e){var i=e.getAdapter(),a=i.getMediaInfoForType(e.getStreamInfo(),o.Z.VIDEO)||i.getMediaInfoForType(e.getStreamInfo(),o.Z.AUDIO),l=i.getVoRepresentations(a)[0],c={start:NaN,end:NaN};if(l)if(l.segmentInfoType===s.Z.SEGMENT_TIMELINE)c=function(e){var n,i,r,o,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],a=t.getRepresentationFor(e.index,s),l=a.SegmentTemplate||a.SegmentList,c=l.SegmentTimeline,u=l.timescale,d=c.S_asArray,h={start:0,end:0},p=d[0].t,f=!isNaN(p),m=f?p:0,b=0;for(f&&(h.start=g(m/u,e)),r=0,o=d.length;r<o;r++)i=0,(n=d[r]).hasOwnProperty("r")&&(i=n.r),b+=n.d*(1+i);return h.end=g((m+b)/u,e),h}(l);else{var u=l.adaptation.period;c.start=u.start,c.end=Math.max(r,u.start+u.duration)}!isNaN(c.start)&&(isNaN(n.start)||n.start>c.start)&&(n.start=c.start),!isNaN(c.end)&&(isNaN(n.end)||n.end<c.end)&&(n.end=c.end)})),n.end=Math.min(r,n.end);var a=y(e,n.end,!0);return n.end=isNaN(a)?n.end:a,n.start=i&&i.mpd&&i.mpd.timeShiftBufferDepth&&!isNaN(i.mpd.timeShiftBufferDepth)&&!isNaN(n.end)?Math.max(n.end-i.mpd.timeShiftBufferDepth,n.start):n.start,n.start=y(e,n.start),{range:n,now:r}}function b(e,t){n=e-t.end}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var i=0,r=!1,o=NaN;!r&&i<e.length;){var s=e[i].getStreamInfo();s.start<=t&&(!isFinite(s.duration)||s.start+s.duration>=t)?(o=t,r=!0):!n&&s.start>t&&(isNaN(o)||s.start<o)?o=s.start:n&&s.start+s.duration<t&&(isNaN(o)||s.start+s.duration>o)&&(o=s.start+s.duration),i+=1}return o}catch(e){return t}}function v(e){void 0===e.offset||isNaN(e.offset)||d(e.offset/1e3)}function _(){i=0,n=0}function E(){a.off(c.Z.UPDATE_TIME_SYNC_OFFSET,v,this),_()}return e={initialize:function(){_(),a.on(c.Z.UPDATE_TIME_SYNC_OFFSET,v,this)},getClientTimeOffset:function(){return i},setClientTimeOffset:d,getClientReferenceTime:function(){return Date.now()-1e3*n+1e3*i},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return p(e,t,n)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return p(e,t,n,!0)},calcPresentationTimeFromWallTime:f,calcPresentationTimeFromMediaTime:g,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcWallTimeForSegment:function(e,t){var n,i,r;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,i=e.presentationStartTime+n,r=new Date(e.availabilityStartTime.getTime()+1e3*i)),r},calcTimeShiftBufferWindow:function(e,t){if(!t)return function(e){var t={start:NaN,end:NaN},n=0,i=NaN;return e.forEach((function(e){var t=e.getStreamInfo();n+=t.duration,(isNaN(i)||t.start<i)&&(i=t.start)})),t.start=i,t.end=i+n,t}(e);if(u.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var n=m(e);return b(n.now,n.range),n.range}return function(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var n=e[0].getAdapter().getRegularPeriods()[0],i=f(new Date,n),r=n.mpd.timeShiftBufferDepth,o=isNaN(r)?0:i-r;if(t.start=y(e,o),t.end=!isNaN(t.start)&&i<t.start?i:y(e,i,!0),!isNaN(r)&&t.end<i-r&&(t.end=NaN),u.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var s=m(e);if(s.range.end<t.start)return a.trigger(h.Z.CONFORMANCE_VIOLATION,{level:Zt.LEVELS.WARNING,event:Zt.EVENTS.INVALID_DVR_WINDOW}),b(s.now,s.range),s.range}return t}(e)},reset:E},t=Fe(r).getInstance(),E(),e}Kr.__dashjs_factory_name="TimelineConverter";var Zr=u.Z.getSingletonFactory(Kr),Xr=n(4593),Jr=n(6934);function Qr(e){return(Qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eo(e,t){return(eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function to(e){return(to=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var no=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&eo(e,t)}(r,xr);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=to(t);if(n){var r=to(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==Qr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){var e;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}return r}(),io=n(2295);function ro(){var e=0;function t(e){for(var t="",n=0;n<e.length;++n)t+=e[n].uchar;return t.length-t.replace(/^\s+/,"").length}function n(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function i(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function r(e,t){var n=e.videoHeight/15;return t?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?i(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?i(t.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function o(e){return e.replace(/^\s+/g,"")}function s(e){return e.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(i,a,l,c){var u,d,h=null,p=!1,f=-1,g={start:a,end:l,spans:[]},m="style_cea608_white_black",b={},y={},v=[];for(u=0;u<15;++u){var _=c.rows[u],E="",T=null;if(!1===_.isEmpty()){var x=t(_.chars);null===h&&(h={x:x,y1:u,y2:u+1,p:[]}),x!==f&&p&&(h.p.push(g),g={start:a,end:l,spans:[]},h.y2=u,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===b.hasOwnProperty(h.name)?(v.push(h),b[h.name]=h):b[h.name].p.contat(h.p),h={x:x,y1:u,y2:u+1,p:[]});for(var w=0;w<_.chars.length;++w){var k=_.chars[w],S=k.penState;if(null===T||!S.equals(T)){E.trim().length>0&&(g.spans.push({name:m,line:E,row:u}),E="");var C="style_cea608_"+S.foreground+"_"+S.background;S.underline&&(C+="_underline"),S.italics&&(C+="_italics"),y.hasOwnProperty(C)||(y[C]=JSON.parse(JSON.stringify(S))),T=S,m=C}E+=k.uchar}E.trim().length>0&&g.spans.push({name:m,line:E,row:u}),p=!0,f=x}else p=!1,f=-1,h&&(h.p.push(g),g={start:a,end:l,spans:[]},h.y2=u,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===b.hasOwnProperty(h.name)?(v.push(h),b[h.name]=h):b[h.name].p.contat(h.p),h=null)}h&&(h.p.push(g),h.y2=u+1,h.name="region_"+h.x+"_"+h.y1+"_"+h.y2,!1===b.hasOwnProperty(h.name)?(v.push(h),b[h.name]=h):b[h.name].p.contat(h.p),h=null);var A=[];for(u=0;u<v.length;++u){var I=v[u],O="sub_cea608_"+e++,N=document.createElement("div");N.id=O;var R=n(I);N.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+R;var D=document.createElement("div");D.className="paragraph bodyStyle",D.style.cssText=r(i);var L=document.createElement("div");L.className="cueUniWrapper",L.style.cssText="unicode-bidi: normal; direction: ltr;";for(var M=0;M<I.p.length;++M){var P=I.p[M],B=0;for(d=0;d<P.spans.length;++d){var j=P.spans[d];if(j.line.length>0){if(0!==d&&B!=j.row){var F=document.createElement("br");F.className="lineBreak",L.appendChild(F)}var $=!1;B===j.row&&($=!0),B=j.row;var U=y[j.name],H=document.createElement("span");H.className="spanPadding "+j.name+" customSpanColor",H.style.cssText=r(i,U),0!==d&&$?d===P.spans.length-1?H.textContent=s(j.line):H.textContent=j.line:P.spans.length>1&&d<P.spans.length-1&&j.row===P.spans[d+1].row?H.textContent=o(j.line):H.textContent=j.line.trim(),L.appendChild(H)}}}D.appendChild(L),N.appendChild(D);var G={bodyStyle:["%",90]};for(var V in y)y.hasOwnProperty(V)&&(G[V]=["%",90]);A.push({type:"html",start:a,end:l,cueHTMLElement:N,cueID:O,cellResolution:[32,15],isFromCEA608:!0,fontSize:G,lineHeight:{},linePadding:{}})}return A}}}ro.__dashjs_factory_name="EmbeddedTextHtmlRender";var oo=u.Z.getSingletonFactory(ro);function so(e){var t,n,i,s,a,u,h,p,f,g,m,b,y,v,_,E,x,w=e.errHandler,k=e.manifestModel,C=e.mediaController,I=e.videoModel,O=e.textTracks,N=e.vttParser,R=e.vttCustomRenderingParser,D=e.ttmlParser,L=e.streamInfo,M=e.settings,P=this.context,B=(0,l.Z)(P).getInstance(),j=!1;function F(){u=null,p=NaN,f=[],g=null,h=!1,a=[],s=null}function $(e){var t=new no;for(var n in e)t[n]=e[n];t.labels=e.labels,t.defaultTrack=function(e){var t=!1;return b.length>1&&e.isEmbedded?t=e.id&&e.id===o.Z.CC1:1===b.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===b.length&&(t=e.index===a[0].index),t}(e),t.isFragmented=e.isFragmented,t.isEmbedded=!!e.isEmbedded,t.isTTML=function(e){return e.codec&&e.codec.search(o.Z.STPP)>=0||e.mimeType&&e.mimeType.search(o.Z.TTML)>=0}(e),t.kind=function(e,t){var n=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return n===t.caption||n===t.subtitle?n:t.caption}(e,{subtitle:"subtitles",caption:"captions"}),O.addTextTrack(t)}function U(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&G(t.bytes,t)}function H(e){m=e}function G(e,a){var l=a.mediaInfo,c=l.type,d=l.mimeType,f=l.codec||d;f?-1!==l.codec.indexOf("application/mp4")?function(e,r,a){var l;if("InitializationSegment"===r.segmentType)h=!0,p=i.getMediaTimescaleFromMoov(e);else{if(!h)return;(l=i.getSamplesInfo(e).sampleList).length>0&&(g=l[0].cts-r.start*p),a.search(o.Z.STPP)>=0?function(e,i,r){var a,l;for(s=null!==s?s:z(r),a=0;a<i.length;a++){var c=i[a],d=c.cts,h=W(),f=h+d/p,g=f+c.duration/p;t.buffered.add(f,g);var b=new DataView(e,c.offset,c.subSizes[0]),y=Jr.Utils.dataViewToString(b,o.Z.UTF8),v=[],_=c.offset+c.subSizes[0];for(l=1;l<c.subSizes.length;l++){var E=new Uint8Array(e,_,c.subSizes[l]),T=String.fromCharCode.apply(null,E);v.push(T),_+=c.subSizes[l]}try{var x=k.getValue().ttmlTimeIsRelative?d/p:0,w=s.parse(y,x,d/p,(d+c.duration)/p,v);O.addCaptions(m,h,w)}catch(e){u.removeExecutedRequestsBeforeTime(),this.remove(),n.error("TTML parser error: "+e.message)}}}(e,l,a):function(e,i){var r,o,s,a=[];for(r=0;r<i.length;r++){var l=i[r];l.cts-=g;var c=W()+l.cts/p,u=c+l.duration/p;t.buffered.add(c,u);var d=e.slice(l.offset,l.offset+l.size),h=Jr.parseBuffer(d);for(o=0;o<h.boxes.length;o++){var f=h.boxes[o];if(n.debug("VTT box1: "+f.type),"vtte"!==f.type&&"vttc"===f.type){n.debug("VTT vttc boxes.length = "+f.boxes.length);var b={styles:{}};for(s=0;s<f.boxes.length;s++){var y=f.boxes[s];if(n.debug("VTT box2: "+y.type),"payl"===y.type)b.start=l.cts/p,b.end=(l.cts+l.duration)/p,b.data=y.cue_text;else if("sttg"===y.type&&y.settings&&""!==y.settings)try{var v=y.settings.split(" ");b.styles=N.getCaptionStyles(v)}catch(e){}}b&&b.data&&(a.push(b),n.debug("VTT  ".concat(b.start," - ").concat(b.end," :  ").concat(b.data)))}}}a.length>0&&O.addCaptions(m,0,a)}(e,l)}}(e,a,f):c===o.Z.VIDEO?function(e,t){var o,s;if(t.segmentType===A.w.INIT_SEGMENT_TYPE)0===y&&(y=i.getMediaTimescaleFromMoov(e));else if(t.segmentType===A.w.MEDIA_SEGMENT_TYPE){if(0===y)return void n.warn("CEA-608: No timescale for embeddedTextTrack yet");var a=(s=i.getSamplesInfo(e)).lastSequenceNumber,l=Math.trunc(t.start),c=Math.trunc(t.end);if(E[0]||E[1]||function(){for(var e,t=0;t<b.length;t++){if(-1===(e=O.getTrackIdxForId(b[t].id)))return void n.warn("CEA-608: data before track is ready.");var i=V(e);E[t]=new(r().Cea608Parser)(t+1,{newCue:i},null)}}(),y){if(function(e,t,n,i,r){return null!==e&&null!==t&&null!==_&&null!==l&&(t===e?_!==l:t!==e+n)}(v,a,s.numSequences))for(o=0;o<E.length;o++)E[o]&&E[o].reset();for(var u=function(e,t){if(0===t.length)return null;for(var n={splits:[],fields:[[],[]]},i=new DataView(e),o=0;o<t.length;o++)for(var s=t[o],a=r().findCea608Nalus(i,s.offset,s.size),l=null,c=0,u=0;u<a.length;u++)for(var d=r().extractCea608DataFromRange(i,a[u]),h=0;h<2;h++)if(d[h].length>0){s.cts!==l?c=0:c+=1;var p=W();n.fields[h].push([s.cts+p*y,d[h],c]),l=s.cts}return n.fields.forEach((function(e){e.sort((function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]}))})),n}(e,s.sampleList),d=0;d<E.length;d++){var h=u.fields[d],p=E[d];if(p)for(o=0;o<h.length;o++)p.addData(h[o][0]/y,h[o][1])}v=a,_=c}}}(e,a):function(e,n,i){var r,s,a=new DataView(e,0,e.byteLength);s=Jr.Utils.dataViewToString(a,o.Z.UTF8);try{r=z(i).parse(s,0),O.addCaptions(O.getCurrentTrackIdx(),0,r),t.buffered&&t.buffered.add(n.start,n.end)}catch(e){w.error(new T.Z(S.TIMED_TEXT_ERROR_ID_PARSE_CODE,S.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,s))}}(e,a,f):n.error("No text type defined")}function V(e){return function(t,n,i){var r;(r=I.getTTMLRenderingDiv()?x.createHTMLCaptionsFromScreen(I.getElement(),t,n,i):[{start:t,end:n,data:i.getDisplayText(),styles:{}}])&&O.addCaptions(e,0,r)}}function W(){return isNaN(t.timestampOffset)?0:t.timestampOffset}function z(e){var t;return e.search(o.Z.VTT)>=0?t=M.get().streaming.text.webvtt.customRenderingEnabled&&R?R:N:(e.search(o.Z.TTML)>=0||e.search(o.Z.STPP)>=0)&&(t=D),t}function q(e){b.forEach((function(t){var n=O.getTrackIdxForId(t.id);n>=0&&O.deleteCuesFromTrackIdx(n,e.from,e.to)}))}return t={initialize:function(){j||(b=[],m=null,y=0,E=[],v=null,_=null,j=!0,x=oo(P).getInstance(),B.on(c.Z.VIDEO_CHUNK_RECEIVED,U,t),B.on(c.Z.BUFFER_CLEARED,q,t))},addMediaInfos:function(e,n,i){if(a=a.concat(n),e===o.Z.TEXT&&n[0].isFragmented&&!n[0].isEmbedded){u=i,t.buffered=(0,io.Z)(P).create(),f=C.getTracksFor(o.Z.TEXT,L.id).filter((function(e){return e.isFragmented}));for(var r=C.getCurrentTrackFor(o.Z.TEXT,L.id),s=0;s<f.length;s++)if(f[s]===r){H(s);break}}for(var l=0;l<n.length;l++)$(n[l])},resetMediaInfos:function(){a=[]},getStreamId:function(){return L.id},append:G,abort:function(){},addEmbeddedTrack:function(e){if(j&&e)if(e.id===o.Z.CC1||e.id===o.Z.CC3){for(var t=0;t<b.length;t++)if(b[t].id===e.id)return;b.push(e)}else n.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){B.off(c.Z.VIDEO_CHUNK_RECEIVED,U,t),B.off(c.Z.BUFFER_CLEARED,q,t),O&&O.deleteAllTextTracks(),j=!1,b=[],E=[null,null],v=null,_=null},getConfig:function(){return{fragmentModel:u,fragmentedTracks:f,videoModel:I}},setCurrentFragmentedTrackIdx:H,remove:function(e,n){void 0===e&&e===n&&(e=t.buffered.start(0),n=t.buffered.end(t.buffered.length-1)),t.buffered.remove(e,n),O.deleteCuesFromTrackIdx(m,e,n)},reset:function(){F(),a=[],i=null}},n=(0,d.Z)(P).getInstance().getLogger(t),i=(0,It.Z)(P).getInstance(),F(),t}so.__dashjs_factory_name="TextSourceBuffer";var ao=u.Z.getClassFactory(so),lo=n(4403);function co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var uo=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function ho(e){var t,n,i,r,s,a,u,p,f,g,m,b,y,v,_,E,T,x,w,k,S=this.context,C=(0,l.Z)(S).getInstance(),A=e.videoModel,I=e.streamInfo,O=e.settings;function N(e,t){var n=A.getClientWidth(),i=A.getClientHeight(),r=A.getVideoWidth(),o=A.getVideoHeight(),s=A.getVideoRelativeOffsetTop(),a=A.getVideoRelativeOffsetLeft();if(0!==r&&0!==o){var l=r/o,c=!1;e.isFromCEA608&&(l=3.5/3,c=!0);var d=function(e,t,n,i,r,o){var s=0,a=0;e/t>n/i?s=(a=t)/i*n:a=(s=e)/n*i;var l,c,u=0,d=0;return s/a>r?(d=a,u=a*r):(u=s,d=s/r),l=(e-u)/2,c=(t-d)/2,o?{x:l+.1*u,y:c+.1*d,w:.8*u,h:.8*d}:{x:l,y:c,w:u,h:d}}.call(this,n,i,r,o,l,c),b=d.w,y=d.h,E=d.x,x=d.y;if(b!=f||y!=g||E!=u||x!=p||t){if(u=E+a,p=x+s,f=b,g=y,m){var w=m.style;w&&(w.left=u+"px",w.top=p+"px",w.width=f+"px",w.height=g+"px",w.zIndex=v&&document[v]||_?T:null,C.trigger(h.Z.CAPTION_CONTAINER_RESIZE))}var k=e.activeCues;if(k)for(var S=k.length,I=0;I<S;++I){var O=k[I];O.scaleCue(O)}}}}function R(e){var t,n,i,r,o,s=f,a=g;if(e.cellResolution){var l=[s/e.cellResolution[0],a/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){n=(e.linePadding[t]*l[0]).toString();for(var c=document.getElementsByClassName("spanPadding"),u=0;u<c.length;u++)c[u].style.cssText=c[u].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n),c[u].style.cssText=c[u].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?i=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(i=e.fontSize[t][1]),n=(i*l[1]).toString(),o="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var d=0;d<o.length;d++)o[d].style.cssText=o[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?r=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(r=e.lineHeight[t][1]),n=(r*l[1]).toString(),o=document.getElementsByClassName(t);for(var h=0;h<o.length;h++)o[h].style.cssText=o[h].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}}}if(e.isd){var p=document.getElementById(e.cueID);p&&m.removeChild(p),L(e)}}function D(e,t){var n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,i=/^#(.*)$/;if(n.test(t)){var r=n.exec(t),o=parseInt(r[4],10)-1;return"data:image/png;base64,"+btoa(e.images[o])}if(i.test(t)){var s=i.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[s]}return t}function L(e){if(m){Q.call(this);var t=document.createElement("div");m.appendChild(t),E=(0,lo.renderHTML)(e.isd,t,(function(t){return D(e,t)}),m.clientHeight,m.clientWidth,O.get().streaming.text.imsc.displayForcedOnlyMode,(function(e){n.info("renderCaption :",e)}),E,O.get().streaming.text.imsc.enableRollUp),t.id=e.cueID,C.trigger(h.Z.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:a})}}function M(e,t){return!!t&&t.endTime>=e.startTime}function P(e,t){return!!O.get().streaming.text.extendSegmentedCues&&!!function(e,t,n){for(var i=0;i<n.length;i++){var r=n[i];if(JSON.stringify(e[r])!==JSON.stringify(t[r]))return!1}return!0}(t,e,uo)&&(t.endTime=Math.max(t.endTime,e.endTime),!0)}function B(e,t,i){var r=q(e),s=O.get().streaming.text.dispatchForManualRendering;if(r&&Array.isArray(i)&&0!==i.length)for(var a=0;a<i.length;a++){var l=null,c=i[a];r.cellResolution=c.cellResolution,r.isFromCEA608=c.isFromCEA608,isNaN(c.start)||isNaN(c.end)||(s?l=j(c,t):G(c)&&m?l=U(c,t,r):c.data&&(l=H(c,t,r)));try{if(l){if(!K(r,l))if(O.get().streaming.text.webvtt.customRenderingEnabled)r.manualCueList||(r.manualCueList=[]),r.manualCueList.push(l);else{var u=void 0;r.cues&&0!==r.cues.length&&(u=r.cues[r.cues.length-1]),M(l,u)?P(l,u)||(u.isd&&(u.onexit=function(){}),r.mode!==o.Z.TEXT_DISABLED&&r.addCue(l)):r.mode!==o.Z.TEXT_DISABLED&&r.addCue(l)}var d=O.get().streaming.buffer.bufferToKeep;X(r,0,A.getTime()-d)}else n.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(e){throw J(r),r.addCue(l),e}}}function j(e,t){var n=V(e,t);return n.onenter=function(){G(e)&&k&&k.cueID!==n.cueID&&$(k),delete n.type,k=n,F(n)},n.onexit=function(){$(n),k=null},n}function F(e){C.trigger(h.Z.CUE_ENTER,e)}function $(e){C.trigger(h.Z.CUE_EXIT,{cueID:e.cueID})}function U(e,t,i){var r=this,s=V(e,t);return m.style.left=u+"px",m.style.top=p+"px",m.style.width=f+"px",m.style.height=g+"px",s.onenter=function(){var e=this;i.mode===o.Z.TEXT_SHOWING&&(this.isd?(w?requestAnimationFrame((function(){return L(e)})):L(this),n.debug("Cue enter id:"+this.cueID)):(m.appendChild(this.cueHTMLElement),R.call(r,this),C.trigger(h.Z.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:a})))},s.onexit=function(){if(m)for(var e=m.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(n.debug("Cue exit id:"+e[t].id),m.removeChild(e[t]),--t)},s}function H(e,t,i){var r=V(e,t);if(r.isActive=!1,e.styles)try{void 0!==e.styles.align&&"align"in r&&(r.align=e.styles.align),void 0!==e.styles.line&&"line"in r&&(r.line=e.styles.line),void 0!==e.styles.snapToLines&&"snapToLines"in r&&(r.snapToLines=e.styles.snapToLines),void 0!==e.styles.position&&"position"in r&&(r.position=e.styles.position),void 0!==e.styles.size&&"size"in r&&(r.size=e.styles.size)}catch(e){n.error(e)}return r.onenter=function(){i.mode===o.Z.TEXT_SHOWING&&C.trigger(h.Z.CAPTION_RENDERED,{currentTrackIdx:a})},r}function G(e){return"html"===e.type}function V(e,t){return G(e)?function(e,t){var n=new i(e.start+t,e.end+t,"");return n.cueHTMLElement=e.cueHTMLElement,n.isd=e.isd,n.images=e.images,n.embeddedImages=e.embeddedImages,n.cueID=e.cueID,n.scaleCue=R.bind(self),n.cellResolution=e.cellResolution,n.lineHeight=e.lineHeight,n.linePadding=e.linePadding,n.fontSize=e.fontSize,n.isd&&function e(t,n){n&&n.forEach((function(n){n.kind&&"image"===n.kind&&(n.src=D(t,n.src)),e(t,n.contents)}))}(n,n.isd.contents),n}(e,t):function(e,t){var n=new i(e.start-t,e.end-t,e.data);return n.cueID="".concat(n.startTime,"_").concat(n.endTime),n}(e,t)}function W(e){if(b)for(var t=b.childNodes,n=0;n<t.length;++n)t[n].id===e.cueID&&(b.removeChild(t[n]),--n)}function z(){var e,t=[],n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?co(e,t):void 0}}(e))){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(A.getTextTracks());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.manualMode===o.Z.TEXT_SHOWING&&t.push(i)}}catch(e){n.e(e)}finally{n.f()}return t}function q(e){return e>=0&&r[e]?A.getTextTrack(r[e].kind,r[e].id,r[e].lang,r[e].isTTML,r[e].isEmbedded):null}function Y(e){var t=this;if(e!==a){var n=q(a=e);(function(e){Q.call(this),e&&"html"===e.renderingType?function(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,i=A.getElement();try{i&&(i.id?t.insertRule("#"+i.id+"::cue {background: transparent}",0):0!==i.classList.length?t.insertRule("."+i.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){n.info(""+e.message)}}}.call(this):function(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}.call(this)}).call(this,n),y&&(clearInterval(y),y=null),n&&"html"===n.renderingType&&(N.call(this,n,!0),window.ResizeObserver?(x=new window.ResizeObserver((function(){N.call(t,n,!0)}))).observe(A.getElement()):y=setInterval(N.bind(this,n),500))}}function K(e,t){if(!e.cues)return!1;for(var n=0;n<e.cues.length;n++)if(e.cues[n].startTime===t.startTime&&e.cues[n].endTime===t.endTime)return!0;return!1}function Z(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!e&&(isNaN(t)||(i?e.startTime:e.endTime)>=t)&&(isNaN(n)||(i?e.endTime:e.startTime)<=n)}function X(e,t,n){var i,r;if(!(n<t)&&e&&(e.cues||e.manualCueList)){var o=e.cues&&e.cues.length>0?"native":"custom",s="native"===o?e.cues:e.manualCueList;if(!s||0===s.length)return;for(var a=s.length-1;a>=0;a--)!Z(s[a],t,n,!0)||(i=s[a],r=A.getTime(),i.startTime>=r&&i.endTime<=r)||("native"===o?e.removeCue(s[a]):(W(s[a]),delete e.manualCueList[a]))}}function J(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e&&(e.cues||e.manualCueList)){var r=e.cues&&e.cues.length>0?"native":"custom",o="native"===r?e.cues:e.manualCueList;if(!o||0===o.length)return;for(var s=o.length-1;s>=0;s--)Z(o[s],t,n,i)&&("native"===r?(o[s].onexit&&o[s].onexit(),e.removeCue(o[s])):(W(o[s]),delete e.manualCueList[s]))}}function Q(){if(m)for(;m.firstChild;)m.removeChild(m.firstChild)}return t={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(i=window.VTTCue||window.TextTrackCue,r=[],s=[],a=-1,u=0,p=0,f=0,g=0,m=null,b=null,y=null,_=!1,T=2147483647,E=null,w="requestAnimationFrame"in window,void 0!==document.fullscreenElement?v="fullscreenElement":void 0!==document.webkitIsFullScreen?v="webkitIsFullScreen":document.msFullscreenElement?v="msFullscreenElement":document.mozFullScreen&&(v="mozFullScreen"))},getStreamId:function(){return I.id},addTextTrack:function(e){r.push(e)},addCaptions:B,createTracks:function(){var e=O.get().streaming.text.dispatchForManualRendering;r.sort((function(e,t){return e.index-t.index})),m=A.getTTMLRenderingDiv(),b=A.getVttRenderingDiv();for(var t,n,i,l,u,d,p=-1,f=0;f<r.length;f++){var g=(n=(t=r[f]).kind,i=void 0!==t.id?t.id:t.lang,l=t.lang,u=t.isTTML,d=t.isEmbedded,A.addTextTrack(n,i,l,u,d));s.push(g),r[f].defaultTrack&&(g.default=!0,p=f);var y=q(f);y&&(y.mode=o.Z.TEXT_SHOWING,m&&(r[f].isTTML||r[f].isEmbedded)?y.renderingType="html":y.renderingType="default"),B(f,0,r[f].captionData),C.trigger(h.Z.TEXT_TRACK_ADDED)}if(Y.call(this,p),p>=0){C.on(h.Z.PLAYBACK_METADATA_LOADED,(function e(){var t=q(p);t&&"html"===t.renderingType&&N.call(this,t,!0),C.off(h.Z.PLAYBACK_METADATA_LOADED,e,this)}),this);for(var v=0;v<r.length;v++){var _=q(v);_&&(_.mode=v!==p||e?o.Z.TEXT_HIDDEN:o.Z.TEXT_SHOWING,_.manualMode=v===p?o.Z.TEXT_SHOWING:o.Z.TEXT_HIDDEN)}}C.trigger(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,{index:a,tracks:r,streamId:I.id})},getCurrentTrackIdx:function(){return a},setCurrentTrackIdx:Y,getTrackIdxForId:function(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].id===e){t=n;break}return t},getCurrentTrackInfo:function(){return r[a]},setModeForTrackIdx:function(e,t){var n=q(e);n&&n.mode!==t&&(n.mode=t),n&&n.manualMode!==t&&(n.manualMode=t)},deleteCuesFromTrackIdx:function(e,t,n){var i=q(e);i&&J(i,t,n)},deleteAllTextTracks:function(){for(var e=s?s.length:0,t=0;t<e;t++){var n=q(t);n&&J.call(this,n,I.start,I.start+I.duration,!1)}s=[],r=[],y&&(clearInterval(y),y=null),x&&A&&(x.unobserve(A.getElement()),x=null),a=-1,Q.call(this)},manualCueProcessing:function(e){var t=z();if(t&&t.length>0){var n=t[0].manualCueList;n&&n.length>0&&n.forEach((function(t){t.startTime<=e&&t.endTime>=e&&!t.isActive?(t.isActive=!0,O.get().streaming.text.dispatchForManualRendering?F(t):WebVTT.processCues(window,[t],b,t.cueID)):t.isActive&&(t.startTime>e||t.endTime<e)&&(t.isActive=!1,O.get().streaming.text.dispatchForManualRendering?$(t):W(t))}))}},disableManualTracks:function(){var e=z();if(e&&e.length>0){var t=e[0].manualCueList;t&&t.length>0&&t.forEach((function(e){if(e.isActive)if(e.isActive=!1,O.get().streaming.text.dispatchForManualRendering)$(e);else if(b)for(var t=b.childNodes,n=0;n<t.length;++n)t[n].id===e.cueID&&(b.removeChild(t[n]),--n)}))}}},n=(0,d.Z)(S).getInstance().getLogger(t),t}ho.__dashjs_factory_name="TextTracks";var po=u.Z.getClassFactory(ho);function fo(){var e,t,n,i,r,o,s=this.context;function a(e){var t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function l(e){var t=e.split(i),n=t[1].split(o);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:c(n)}}function c(e){var t={};return e.forEach((function(e){if(e.split(/:/).length>1){var n=e.split(/:/)[1],i=!1;n&&-1!=n.search(/%/)&&(i=!0,n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line="auto"===n?n:parseInt(n,10),i&&(t.snapToLines=!1)),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}})),t}function u(e,t){for(var n,r=t,o="",s="";""!==e[r]&&r<e.length;)r++;if((n=r-t)>1)for(var a=0;a<n;a++){if((s=e[t+a]).match(i)){o="";break}o+=s,a!==n-1&&(o+="\n")}else(s=e[t]).match(i)||(o=s);return o}return e={parse:function(e){var o,s,c=[];if(!e)return c;o=(e=e.split(n)).length,s=-1;for(var d=0;d<o;d++){var h=e[d];if(h.length>0&&"WEBVTT"!==h&&h.match(i)){var p=l(h),f=p.cuePoints,g=p.styles,m=u(e,d+1),b=a(f[0].replace(r,"")),y=a(f[1].replace(r,""));!isNaN(b)&&!isNaN(y)&&b>=s&&y>b?""!==m?(s=b,c.push({start:b,end:y,data:m,styles:g})):t.error("Skipping cue due to empty/malformed cue text"):t.error("Skipping cue due to incorrect cue timing")}}return c},getCaptionStyles:c},t=(0,d.Z)(s).getInstance().getLogger(e),n=/(?:\r\n|\r|\n)/gm,i=/-->/,r=/(^[\s]+|[\s]+$)/g,o=/\s\b/g,e}fo.__dashjs_factory_name="VTTParser";var go=u.Z.getSingletonFactory(fo);function mo(){var e,t;return e={parse:function(e){var n=[];return t.oncue=function(e){e.start=e.startTime,e.end=e.endTime,e.data=e.text,e.styles={align:e.align,line:e.line,position:e.position,size:e.size},n.push(e)},t.parse(e),n}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(e){}}(),e}mo.__dashjs_factory_name="VttCustomRenderingParser";var bo=u.Z.getSingletonFactory(mo);function yo(){var e,t,n=this.context,i=(0,l.Z)(n).getInstance(),r=0;return e={parse:function(e,n,o,s,a){var l,u,d,p="",f=[],g={},m={},b="",y="",v={onOpenTag:function(e,n,r){if(r[" imagetype"]&&!r[" imageType"]&&(i.trigger(h.Z.CONFORMANCE_VIOLATION,{level:Zt.LEVELS.ERROR,event:Zt.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),r[" imageType"]=r[" imagetype"]),"image"===n&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!r[" imageType"]||"PNG"!==r[" imageType"].value)return void t.warn("smpte-tt imageType != PNG. Discarded");b=r["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){b&&(m[b]=y.trim()),y="",b=""},onText:function(e){b&&(y+=e)}};if(!e)throw p="no ttml data to parse",new Error(p);g.data=e,i.trigger(c.Z.TTML_TO_PARSE,g);var _=(0,lo.fromXML)(g.data,(function(e){p=e}),v);i.trigger(c.Z.TTML_PARSED,{ttmlString:g.data,ttmlDoc:_});var E,T=_.getMediaTimeEvents();for(d=0;d<T.length;d++){var x=(0,lo.generateISD)(_,T[d],(function(e){p=e}));x.contents.some((function(e){return e.contents.length}))&&(l=T[d]+n)<(u=T[d+1]+n)&&f.push({start:l,end:u,type:"html",cueID:(E="cue_TTML_"+r,r++,E),isd:x,images:a,embeddedImages:m})}if(""!==p)throw t.error(p),new Error(p);return f}},t=(0,d.Z)(n).getInstance().getLogger(e),e}yo.__dashjs_factory_name="TTMLParser";var vo=u.Z.getSingletonFactory(yo);function _o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Eo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_o(Object(n),!0).forEach((function(t){To(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function To(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function wo(e){var t,n,i,r=this.context,s=(0,l.Z)(r).getInstance(),a=(0,Z.Z)(r).getInstance(),c=e.adapter,u=e.baseURLController;function p(e,t){var n,r,s=!1;if(u.resolve()){var l=c.getVoRepresentations(e);l&&l.length>0&&(n=u.resolve(l[0].path).url)}var d=e.essentialPropertiesAsArray.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===o.Z.FONT_DOWNLOAD_DVB_SCHEME})),h=e.supplementalPropertiesAsArray.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===o.Z.FONT_DOWNLOAD_DVB_SCHEME}));d.length>0?(s=!0,r=d):r=h,r.forEach((function(r){if(function(e){return!(!(e.value&&"1"===e.value&&e.dvbUrl&&e.dvbUrl.length>0&&e.dvbFontFamily&&e.dvbFontFamily.length>0&&e.dvbMimeType)||e.dvbMimeType!==o.Z.OFF_MIMETYPE&&e.dvbMimeType!==o.Z.WOFF_MIMETYPE)}(r)){var l=(c=r.dvbUrl,u=n,a.isPathAbsolute(c)?c:a.isRelative(c)?u?a.resolve(c,u):a.resolve(c):c);i.push({fontFamily:r.dvbFontFamily,url:l,mimeType:r.dvbMimeType,trackId:e.id,streamId:t,isEssential:s,status:"unloaded",fontFace:new FontFace(r.dvbFontFamily,"url(".concat(l,")"),{display:"swap"})})}var c,u}))}function f(e,t){var n=i[e];i[e]=Eo(Eo({},n),{},{status:t})}function g(){i=[]}return t={addFontsFromTracks:function(e,t){if(e&&Array.isArray(e)&&t)for(var n=0;n<e.length;n++)p(e[n],t)},downloadFonts:function(){for(var e=function(e){var t=i[e];document.fonts.add(t.fontFace),s.trigger(h.Z.DVB_FONT_DOWNLOAD_ADDED,t),t.fontFace.load().then((function(){f(e,"loaded"),s.trigger(h.Z.DVB_FONT_DOWNLOAD_COMPLETE,t)}),(function(i){f(e,"error"),n.debug("Font download error: ",i),s.trigger(h.Z.DVB_FONT_DOWNLOAD_FAILED,t)}))},t=0;t<i.length;t++)e(t)},getFonts:function(){return i},getFontsForTrackId:function(e){return i.filter((function(t){return t.trackId&&t.trackId===e}))},reset:function(){!function(){var e,t=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return xo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xo(e,t):void 0}}(e))){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(i);try{for(t.s();!(e=t.n()).done;){var r=e.value,o=document.fonts.delete(r.fontFace);n.debug("Removal of fontFamily: ".concat(r.fontFamily," was ").concat(o?"successful":"unsuccessful"))}}catch(e){t.e(e)}finally{t.f()}}(),g()}},n=(0,d.Z)(r).getInstance().getLogger(t),g(),t}wo.__dashjs_factory_name="DVBFonts";var ko=u.Z.getClassFactory(wo);function So(e){var t,n,i,r,s,a,u,p,f,g,m,b,y,v,_=this.context,E=e.adapter,T=e.errHandler,x=e.manifestModel,w=e.mediaController,k=e.baseURLController,S=e.videoModel,C=e.settings;function A(e){if(v.error("Could not download ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);r[e.streamId].setModeForTrackIdx(t,o.Z.TEXT_DISABLED)}}function I(e){if(v.debug("Successfully downloaded ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);t===r[e.streamId].getCurrentTrackIdx()?r[e.streamId].setModeForTrackIdx(t,o.Z.TEXT_SHOWING):r[e.streamId].setModeForTrackIdx(t,o.Z.TEXT_HIDDEN)}}function O(e){var t=e.tracks,i=e.index,s=e.streamId;if(!1===C.get().streaming.text.defaultEnabled&&!D()||b)L(s,-1);else{var a=w.getCurrentTrackFor(o.Z.TEXT,s);if(a){var l={lang:a.lang,role:a.roles[0],index:a.index,codec:a.codec,accessibility:a.accessibility[0]};t.some((function(e,t){if(w.matchSettings(l,e))return L(s,t),i=t,!0}))}f=!1}n[s].lastEnabledIndex=i,p.trigger(h.Z.TEXT_TRACKS_ADDED,{enabled:D(),index:i,tracks:t,streamId:s}),m=!0,y.addFontsFromTracks(t,s),y.getFonts().forEach((function(e){if(e.isEssential){var t=r[e.streamId].getTrackIdxForId(e.trackId);r[e.streamId].setModeForTrackIdx(t,o.Z.TEXT_DISABLED)}})),y.downloadFonts()}function N(e){try{var t=e.streamId;if(!r[t]||isNaN(e.time))return;r[t].manualCueProcessing(e.time)}catch(e){}}function R(e){try{var t=e.streamId;if(!r[t])return;r[t].disableManualTracks()}catch(e){}}function D(){var e=!0;return f&&!g&&(e=!1),e}function L(e,t){(f=-1===t)&&w&&w.saveTextSettingsDisabled();var n=M(e);if(n!==t&&r[e]){r[e].disableManualTracks();var s=r[e].getCurrentTrackInfo(),a=s?S.getTextTrack(s.kind,s.id,s.lang,s.isTTML,s.isEmbedded):null;a&&a.mode!==o.Z.TEXT_DISABLED&&r[e].setModeForTrackIdx(n,o.Z.TEXT_HIDDEN),r[e].setCurrentTrackIdx(t),s=r[e].getCurrentTrackInfo();var l=C.get().streaming.text.dispatchForManualRendering;s&&!l&&s.mode!==o.Z.TEXT_DISABLED&&r[e].setModeForTrackIdx(t,o.Z.TEXT_SHOWING),s&&s.isFragmented&&!s.isEmbedded?function(e,t,n){if(i[e])for(var s=i[e].getConfig().fragmentedTracks,a=0;a<s.length;a++){var l=s[a];if(t.lang===l.lang&&(l.id?t.id===l.id:t.index===l.index)){var u=w.getCurrentTrackFor(o.Z.TEXT,e);(l.id?u.id!==l.id:u.index!==l.index)?(r[e].deleteCuesFromTrackIdx(n),i[e].setCurrentFragmentedTrackIdx(a)):-1===n&&p.trigger(c.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:o.Z.TEXT})}}}(e,s,n):s&&!s.isFragmented&&function(e,t){p.trigger(c.Z.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:t},{streamId:e,mediaType:o.Z.TEXT})}(e,s),w.setTrack(s)}}function M(e){return r[e].getCurrentTrackIdx()}function P(){i={},r={},n={},f=!0,m=!1,b=!1}return t={deactivateStream:function(e){if(e){var t=e.id;i[t]&&i[t].resetMediaInfos(),r[t]&&r[t].deleteAllTextTracks()}},initialize:function(){y=ko(_).create({adapter:E,baseURLController:k}),p.on(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,O,t),p.on(c.Z.DVB_FONT_DOWNLOAD_FAILED,A,t),p.on(c.Z.DVB_FONT_DOWNLOAD_COMPLETE,I,t),C.get().streaming.text.webvtt.customRenderingEnabled&&(p.on(c.Z.PLAYBACK_TIME_UPDATED,N,t),p.on(c.Z.PLAYBACK_SEEKING,R,t))},initializeForStream:function(e){var t=e.id,o=po(_).create({videoModel:S,settings:C,streamInfo:e});o.initialize(),r[t]=o;var l=ao(_).create({errHandler:T,adapter:E,dvbFonts:y,manifestModel:x,mediaController:w,videoModel:S,textTracks:o,vttParser:s,vttCustomRenderingParser:a,ttmlParser:u,streamInfo:e,settings:C});l.initialize(),i[t]=l,n[t]={},n[t].lastEnabledIndex=-1},createTracks:function(e){var t=e.id;r[t]&&r[t].createTracks()},getTextSourceBuffer:function(e){var t=e.id;if(i&&i[t])return i[t]},getAllTracksAreDisabled:function(){return f},addEmbeddedTrack:function(e,t){var n=e.id;i[n]&&i[n].addEmbeddedTrack(t)},enableText:function(e,t){return(0,q.PS)(t,"boolean"),D()!==t&&(t&&L(e,n[e].lastEnabledIndex),t||(n[e].lastEnabledIndex=M(e),m?L(e,-1):b=!0)),!0},isTextEnabled:D,setTextTrack:L,getCurrentTrackIdx:M,enableForcedTextStreaming:function(e){return(0,q.PS)(e,"boolean"),g=e,!0},addMediaInfosToBuffer:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=e.id;i[o]&&i[o].addMediaInfos(t,n,r)},reset:function(){y.reset(),P(),p.off(c.Z.TEXT_TRACKS_QUEUE_INITIALIZED,O,t),p.off(c.Z.DVB_FONT_DOWNLOAD_FAILED,A,t),p.off(c.Z.DVB_FONT_DOWNLOAD_COMPLETE,I,t),C.get().streaming.text.webvtt.customRenderingEnabled&&(p.off(c.Z.PLAYBACK_TIME_UPDATED,N,t),p.off(c.Z.PLAYBACK_SEEKING,R,t)),Object.keys(i).forEach((function(e){i[e].resetEmbedded(),i[e].reset()}))}},g=!1,m=!1,b=!1,s=go(_).getInstance(),a=bo(_).getInstance(),u=vo(_).getInstance(),p=(0,l.Z)(_).getInstance(),v=(0,d.Z)(_).getInstance().getLogger(t),P(),t}So.__dashjs_factory_name="TextController";var Co=u.Z.getClassFactory(So);function Ao(){var e,t,n,i,p,g,m,b,y,v,_,E,x,w,k,I,O,N,R,D,L,M,P,B,j,F,$,U,H,G,V,W,z,Y,X,J,Q,ee,te,ne="You must first call initialize() and set a source before calling this method",ie="You must first call initialize() and set a valid source and view before calling this method",re="You must first call attachView() to set the video element before calling this method",oe="You must first call attachSource() with a valid source before calling this method",se="MediaPlayer not initialized!",ae=this.context,le=(0,l.Z)(ae).getInstance(),ce=(0,C.Z)(ae).getInstance(),ue=(0,d.Z)(ae).getInstance({settings:ce});function de(){ke(null),xe(null),i=null,w&&(w.reset(),w=null),k&&(k.reset(),k=null),D&&D.reset(),ce.reset(),O&&(O.reset(),O=null)}function he(){return!!n&&!!J.getElement()}function pe(){return(0,hr.e)()}function fe(){if(!m)throw ie;return U.isPaused()}function ge(){if(!m)throw ie;return U.getIsDynamic()}function me(e){var t=j&&j.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,n=W.getCurrentDVRInfo(t);if(!n)return 0;var i=U.getOriginalLiveDelay(),r=n.range.start+e;return r>n.range.end-i&&(r=n.range.end-i),r}function be(e){if(!m)throw ie;var t=Te().currentTime;if(void 0!==e)t=j.getTimeRelativeToStreamId(t,e);else if(U.getIsDynamic()){var n=j&&j.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,i=W.getCurrentDVRInfo(n);t=null===i||0===t?0:Math.max(0,t-i.range.start)}return t}function ye(){if(!m)throw ie;var e=Te().duration;if(U.getIsDynamic()){var t=j&&j.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,n=W.getCurrentDVRInfo(t);e=n?n.range.end-n.range.start:0}return e}function ve(e){(0,q.PS)(e,"boolean"),b=e}function _e(){D.restoreDefaultUTCTimingSources()}function Ee(){return W}function Te(){if(!J.getElement())throw re;return J.getElement()}function xe(e){if(!p)throw se;J.setElement(e),e&&(Ie(),function(){if(!k){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(ae).create();k=t.createMetricsReporting({debug:ue,eventBus:le,mediaElement:Te(),adapter:N,dashMetrics:W,mediaPlayerModel:R,events:c.Z,constants:o.Z,metricsConstants:a.Z})}}}(),function(){if(!I){var e=dashjs.MssHandler;"function"==typeof e&&(S.extend(e.errors),I=e(ae).create({eventBus:le,mediaPlayerModel:R,dashMetrics:W,manifestModel:z,playbackController:U,streamController:j,protectionController:w,baseURLController:M,errHandler:L,events:c.Z,constants:o.Z,debug:ue,initSegmentType:A.w.INIT_SEGMENT_TYPE,BASE64:Xr,ISOBoxer:Jr,settings:ce}))}}(),j&&j.switchToVideoElement(y)),m&&Ce(),Re(y)}function we(e){if(!g)throw ne;var t=j.getActiveStreamInfo();return t?x.getTracksFor(e,t.id):[]}function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!p)throw se;"string"==typeof e&&Q.initialize(e),null==t&&(t=NaN),isNaN(t)||(t=Math.max(0,t)),y=t,n=e,(g||m)&&Ce(),he()&&Re(y)}function Se(){if(!g)throw ne;var e=j.getActiveStreamInfo();return e?j.getStreamById(e.id):null}function Ce(){m=!1,g=!1,N.reset(),j.reset(),$.reset(),V.reset(),U.reset(),H.reset(),G.reset(),v.reset(),x.reset(),te.reset(),w&&(ce.get().streaming.protection.keepProtectionMediaKeys?w.stop():(w.reset(),w=null,Ie())),F.reset(),Y.reset(),X.reset()}function Ae(){return Ai(ae).create({debug:ue,errHandler:L,dashMetrics:W,mediaPlayerModel:R,requestModifier:(0,K.Z)(ae).getInstance(),mssHandler:I,settings:ce})}function Ie(){if(w)return w;var e=dashjs.Protection;if("function"==typeof e){var t=e(ae).create();return c.Z.extend(e.events),h.Z.extend(e.events,{publicOnly:!0}),S.extend(e.errors),P||(P=(0,Ni.Z)(ae).getInstance()),w=t.createProtectionSystem({debug:ue,errHandler:L,videoModel:J,customParametersModel:D,capabilities:P,eventBus:le,events:c.Z,BASE64:Xr,constants:o.Z,cmcdModel:Y,settings:ce})}return null}function Oe(){if(!p)throw se;if(O)return O;var e=dashjs.OfflineController;if("function"==typeof e){c.Z.extend(e.events),h.Z.extend(e.events,{publicOnly:!0}),S.extend(e.errors);var t=Ae(),n=Ht(ae).create();return n.setConfig({manifestModel:z,adapter:N,manifestLoader:t,errHandler:L,contentSteeringController:G}),O=e(ae).create({debug:ue,manifestUpdater:n,baseURLController:M,manifestLoader:t,manifestModel:z,mediaPlayerModel:R,abrController:v,playbackController:U,adapter:N,errHandler:L,dashMetrics:W,timelineConverter:E,segmentBaseController:te,schemeLoaderFactory:_,eventBus:le,events:c.Z,errors:S,constants:o.Z,settings:ce,dashConstants:s.Z,urlUtils:(0,Z.Z)(ae).getInstance()})}return null}function Ne(e){var t=j&&j.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,n=W.getCurrentDVRInfo(t);return n?e+(n.manifestInfo.availableFrom.getTime()/1e3+n.range.start):0}function Re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;O&&O.resetRecords(),!g&&n&&(g=!0,t.info("Streaming Initialized"),function(){var e=Ae();j||(j=Qt(ae).getInstance()),F||(F=Co(ae).create({errHandler:L,manifestModel:z,adapter:N,mediaController:x,baseURLController:M,videoModel:J,settings:ce})),B.setConfig({capabilities:P,customParametersModel:D,adapter:N,settings:ce,manifestModel:z,errHandler:L}),j.setConfig({capabilities:P,capabilitiesFilter:B,manifestLoader:e,manifestModel:z,mediaPlayerModel:R,customParametersModel:D,protectionController:w,textController:F,adapter:N,dashMetrics:W,errHandler:L,timelineConverter:E,videoModel:J,playbackController:U,serviceDescriptionController:H,contentSteeringController:G,abrController:v,mediaController:x,settings:ce,baseURLController:M,uriFragmentModel:Q,segmentBaseController:te}),$.setConfig({settings:ce,playbackController:U,streamController:j,videoModel:J,timelineConverter:E,adapter:N}),U.setConfig({streamController:j,serviceDescriptionController:H,dashMetrics:W,adapter:N,videoModel:J,timelineConverter:E,settings:ce}),V.setConfig({streamController:j,playbackController:U,mediaPlayerModel:R,videoModel:J,settings:ce}),v.setConfig({streamController:j,domStorage:ee,mediaPlayerModel:R,customParametersModel:D,cmsdModel:X,dashMetrics:W,adapter:N,videoModel:J,settings:ce}),Y.setConfig({abrController:v,dashMetrics:W,playbackController:U}),X.setConfig({}),v.initialize(),j.initialize(b,i),F.initialize(),$.initialize(),V.initialize(),Y.initialize(),X.initialize(),G.initialize(),te.initialize()}(),"string"==typeof n?j.load(n,e):j.loadWithManifest(n,e)),!m&&he()&&(m=!0,t.info("Playback Initialized"))}return e={initialize:function(e,n,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;P||(P=(0,Ni.Z)(ae).getInstance()).setConfig({settings:ce}),L||(L=Oi(ae).getInstance()),P.supportsMediaSource()?(p||(p=!0,E=Zr(ae).getInstance(),v||(v=er(ae).getInstance()).setConfig({settings:ce}),_||(_=ht(ae).getInstance()),U||(U=f(ae).getInstance()),x||(x=gn(ae).getInstance()),j||(j=Qt(ae).getInstance()),$||($=tn(ae).getInstance()),V||(V=rn(ae).getInstance()),H||(H=cn(ae).getInstance()),G||(G=jt(ae).getInstance()),B||(B=Di(ae).getInstance()),N=Nr(ae).getInstance(),z=ji(ae).getInstance(),Y=Ve(ae).getInstance(),X=rt(ae).getInstance(),W=Yr(ae).getInstance({settings:ce}),ee=dr(ae).getInstance({settings:ce}),N.setConfig({constants:o.Z,cea608parser:r(),errHandler:L,BASE64:Xr}),M||(M=In(ae).create()),M.setConfig({adapter:N,contentSteeringController:G}),H.setConfig({adapter:N}),te||(te=Er(ae).getInstance({dashMetrics:W,mediaPlayerModel:R,errHandler:L,baseURLController:M,events:c.Z,eventBus:le,debug:ue,boxParser:(0,It.Z)(ae).getInstance(),requestModifier:(0,K.Z)(ae).getInstance(),errors:S})),x.setConfig({domStorage:ee,settings:ce,customParametersModel:D}),R.setConfig({playbackController:U,serviceDescriptionController:H}),G.setConfig({adapter:N,errHandler:L,dashMetrics:W,mediaPlayerModel:R,manifestModel:z,serviceDescriptionController:H,eventBus:le,requestModifier:(0,K.Z)(ae).getInstance()}),_e(),ve(void 0===i||i),Oe()),e&&xe(e),n&&ke(n,s),t.info("[dash.js "+pe()+"] MediaPlayer has been initialized")):L.error(new T.Z(S.CAPABILITY_MEDIASOURCE_ERROR_CODE,S.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(P=e.capabilities),e.capabilitiesFilter&&(B=e.capabilitiesFilter),e.streamController&&(j=e.streamController),e.textController&&(F=e.textController),e.gapController&&($=e.gapController),e.playbackController&&(U=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(G=e.contentSteeringController),e.catchupController&&(V=e.catchupController),e.mediaPlayerModel&&(R=e.mediaPlayerModel),e.customParametersModel&&(D=e.customParametersModel),e.abrController&&(v=e.abrController),e.schemeLoaderFactory&&(_=e.schemeLoaderFactory),e.mediaController&&(x=e.mediaController),e.settings&&(ce=e.settings))},on:function(e,t,n,i){le.on(e,t,n,i)},off:function(e,t,n){le.off(e,t,n)},extend:function(e,t,n){u.Z.extend(e,t,n,ae)},attachView:xe,attachSource:ke,refreshManifest:function(e){if(!p)throw se;if(!he())return e(null,oe);var t=this;"function"==typeof e&&le.on(c.Z.INTERNAL_MANIFEST_LOADED,(function n(i){le.off(c.Z.INTERNAL_MANIFEST_LOADED,n,t),i.error?e(null,i.error):e(i.manifest)}),t),j.refreshManifest()},isReady:he,preload:function(){if(!J.getElement()&&!g){if(!n)throw oe;Re(y)}},play:function(){if(!m)throw ie;(!b||fe()&&m)&&U.play(!0)},isPaused:fe,pause:function(){if(!m)throw ie;U.pause()},isSeeking:function(){if(!m)throw ie;return U.isSeeking()},isDynamic:ge,getLowLatencyModeEnabled:function(){if(!m)throw ie;return U.getLowLatencyModeEnabled()},seek:function(e){if(!m)throw ie;if((0,q.PS)(e,"number"),isNaN(e))throw o.Z.BAD_ARGUMENT_ERROR;e<0&&(e=0);var t=U.getIsDynamic()?me(e):e,n=Te();!U.getIsDynamic()&&n.duration&&(t=Math.min(n.duration,t)),U.seek(t,!1,!1,!0)},seekToOriginalLive:function(){m&&ge()&&U.seekToOriginalLive()},setPlaybackRate:function(e){Te().playbackRate=e},getPlaybackRate:function(){return Te().playbackRate},setMute:function(e){(0,q.PS)(e,"boolean"),Te().muted=e},isMuted:function(){return Te().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw o.Z.BAD_ARGUMENT_ERROR;Te().volume=e},getVolume:function(){return Te().volume},time:be,duration:ye,timeAsUTC:function(){if(!m)throw ie;return be()<0?NaN:Ne(be())},durationAsUTC:function(){if(!m)throw ie;return Ne(ye())},getActiveStream:Se,getDVRWindowSize:function(){var e=j&&j.hasVideoTrack()?o.Z.VIDEO:o.Z.AUDIO,t=W.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:me,getAvailableBaseUrls:function(){var e=z.getValue();return e?M.getBaseUrls(e):[]},getAvailableLocations:function(){var e=z.getValue();if(!e)return[];var t=N.getLocation(e),n=G.getSynthesizedLocationElements(t);return t.concat(n)},getTargetLiveDelay:function(){if(!m)throw ie;return U.getOriginalLiveDelay()},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(i<10?"0"+i.toString():i.toString())},formatUTC:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new Date(1e3*e),o=r.toLocaleDateString(t),s=r.toLocaleTimeString(t,{hour12:n});return i?s+" "+o:s},getVersion:pe,getDebug:function(){return ue},getBufferLength:function(e){var n=[o.Z.VIDEO,o.Z.AUDIO,o.Z.TEXT];if(e)return-1!==n.indexOf(e)?Ee().getCurrentBufferLevel(e)||NaN:(t.warn("getBufferLength requested for invalid type"),NaN);var i=n.map((function(e){return we(e).length>0?Ee().getCurrentBufferLevel(e):Number.MAX_VALUE})).reduce((function(e,t){return Math.min(e,t)}));return i===Number.MAX_VALUE?NaN:i},getTTMLRenderingDiv:function(){return J?J.getTTMLRenderingDiv():null},getVideoElement:Te,getSource:function(){if(!n)throw oe;return n},updateSource:function(e){n=e,j.load(n)},getCurrentLiveLatency:function(){if(!p)throw se;return m?U.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(e){if(!g)throw ne;return v.getTopBitrateInfoFor(e)},setAutoPlay:ve,getAutoPlay:function(){return b},getDashMetrics:Ee,getQualityFor:function(e){if(!g)throw ne;if(e===o.Z.IMAGE){var t=Se();if(!t)return-1;var n=t.getThumbnailController();return n?n.getCurrentTrackIndex():-1}return v.getQualityFor(e)},setQualityFor:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!g)throw ne;if(e===o.Z.IMAGE){var i=Se();if(!i)return;var r=i.getThumbnailController();r&&r.setTrackByIndex(t)}v.setPlaybackQuality(e,j.getActiveStreamInfo(),t,{forceReplace:n})},updatePortalSize:function(){v.setElementSize(),v.setWindowResizeEventCalled(!0)},enableText:function(e){var t=j.getActiveStreamInfo();return!(!t||!F)&&F.enableText(t.id,e)},enableForcedTextStreaming:function(e){return!(!j.getActiveStreamInfo()||!F)&&F.enableForcedTextStreaming(e)},isTextEnabled:function(){var e=j.getActiveStreamInfo();return!(!e||!F)&&F.isTextEnabled(e)},setTextTrack:function(e){if(!m)throw ie;var t=j.getActiveStreamInfo();t&&F&&F.setTextTrack(t.id,e)},getBitrateInfoListFor:function(e){if(!g)throw ne;var t=Se();return t?t.getBitrateListFor(e):[]},getStreamsFromManifest:function(e){if(!g)throw ne;return N.getStreamsInfo(e)},getTracksFor:we,getTracksForTypeFromManifest:function(e,t,n){if(!g)throw ne;return(n=n||N.getStreamsInfo(t,1)[0])?N.getAllMediaInfoForType(n,e,t):[]},getCurrentTrackFor:function(e){if(!g)throw ne;var t=j.getActiveStreamInfo();return x.getCurrentTrackFor(e,t.id)},setInitialMediaSettingsFor:function(e,t){if(!p)throw se;x.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!p)throw se;return x.getInitialSettings(e)},setCurrentTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!g)throw ne;x.setTrack(e,t)},addABRCustomRule:function(e,t,n){D.addAbrCustomRule(e,t,n)},removeABRCustomRule:function(e){D.removeAbrCustomRule(e)},removeAllABRCustomRule:function(){D.removeAllAbrCustomRule()},getABRCustomRules:function(){return D.getAbrCustomRules()},getAverageThroughput:function(e){var t=v.getThroughputHistory(),n=U.getIsDynamic();return t?t.getAverageThroughput(e,n):0},retrieveManifest:function(e,t){var n=Ae(),i=this;le.on(c.Z.INTERNAL_MANIFEST_LOADED,(function e(r){r.error?t(null,r.error):t(r.manifest),le.off(c.Z.INTERNAL_MANIFEST_LOADED,e,i),n.reset()}),i),Q.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){D.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){D.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){D.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:_e,setXHRWithCredentialsForType:function(e,t){D.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return D.getXHRWithCredentialsForType(e)},getProtectionController:function(){return Ie()},attachProtectionController:function(e){w=e},setProtectionData:function(e){i=e,j&&j.setProtectionData(i)},registerLicenseRequestFilter:function(e){D.registerLicenseRequestFilter(e)},registerLicenseResponseFilter:function(e){D.registerLicenseResponseFilter(e)},unregisterLicenseRequestFilter:function(e){D.unregisterLicenseRequestFilter(e)},unregisterLicenseResponseFilter:function(e){D.unregisterLicenseResponseFilter(e)},registerCustomCapabilitiesFilter:function(e){D.registerCustomCapabilitiesFilter(e)},unregisterCustomCapabilitiesFilter:function(e){D.unregisterCustomCapabilitiesFilter(e)},setCustomInitialTrackSelectionFunction:function(e){D.setCustomInitialTrackSelectionFunction(e)},resetCustomInitialTrackSelectionFunction:function(){D.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(e){if(!J.getElement())throw re;J.setTTMLRenderingDiv(e)},attachVttRenderingDiv:function(e){if(!J.getElement())throw re;J.setVttRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=j.getActiveStreamInfo();if(e&&F)return F.getCurrentTrackIdx(e.id)},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var n=U.getIsDynamic()?me(e):e,i=j.getStreamForTime(n);if(null!==i){var r=i.getThumbnailController();if(r)return r.provide(n,t);t(null)}else t(null)}},getDashAdapter:function(){return N},getOfflineController:function(){return Oe()},triggerSteeringRequest:function(){if(G)return G.loadSteeringData()},getCurrentSteeringResponseData:function(){if(G)return G.getCurrentSteeringResponseData()},getSettings:function(){return ce.get()},updateSettings:function(e){ce.update(e)},resetSettings:function(){ce.reset()},reset:de,destroy:function(){de(),u.Z.deleteSingletonInstances(ae)}},t=ue.getLogger(e),p=!1,m=!1,g=!1,b=!0,y=NaN,w=null,O=null,i=null,N=null,te=null,c.Z.extend(h.Z),R=Ui(ae).getInstance(),D=(0,at.Z)(ae).getInstance(),J=ir(ae).getInstance(),Q=Pi(ae).getInstance(),e}Ao.__dashjs_factory_name="MediaPlayer";var Io=u.Z.getClassFactory(Ao);Io.events=h.Z,Io.errors=S,u.Z.updateClassFactory(Ao.__dashjs_factory_name,Io);var Oo=Io},8825:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,e);var t,n,i=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function a(){var e;return function(e,t){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).AST_IN_FUTURE="astInFuture",e.BASE_URLS_UPDATED="baseUrlsUpdated",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",e.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",e.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADING_STARTED="manifestLoadingStarted",e.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.CUE_ENTER="cueEnter",e.CUE_EXIT="cueExit",e.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",e.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",e.INBAND_PRFT="inbandPrft",e.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",e.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming",e}return a}(n(8342).Z));t.Z=a},3393:function(e,t){"use strict";var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.TEXT_DISABLED="disabled",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.FONT_DOWNLOAD_DVB_SCHEME="urn:dvb:dash:fontdownload:2014",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.OFF_MIMETYPE="application/font-sfnt",this.WOFF_MIMETYPE="application/font-woff",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}());t.Z=n},3860:function(e,t){"use strict";var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}());t.Z=n},8080:function(e,t,n){"use strict";n.d(t,{default:function(){return z}});var i=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};i.SSL_CONNECTION_FAILED_PREFIX="SSL",i.DNS_RESOLUTION_FAILED="C00",i.HOST_UNREACHABLE="C01",i.CONNECTION_REFUSED="C02",i.CONNECTION_ERROR="C03",i.CORRUPT_MEDIA_ISOBMFF="M00",i.CORRUPT_MEDIA_OTHER="M01",i.BASE_URL_CHANGED="F00",i.BECAME_REPORTER="S00";var r=i,o=n(1180);function s(e){var t,n,i=(e=e||{}).eventBus,s=e.dashMetrics,a=e.metricsConstants,l=e.events;function c(e){var t=new r;if(n){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.mpdurl||(t.mpdurl=n.originalUrl||n.url),t.terror||(t.terror=new Date),s.addDVBErrors(t)}}function u(e){e.error||(n=e.manifest)}function d(e){c({errorcode:r.BASE_URL_CHANGED,servicelocation:e.entry})}function h(){c({errorcode:r.BECAME_REPORTER})}function p(e){var t;e.metric===a.HTTP_REQUEST&&(0===(t=e.value).responsecode||null==t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&c({errorcode:t.responsecode||r.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function f(e){var t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=r.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=r.CORRUPT_MEDIA_OTHER;break;default:return}c({errorcode:t})}return t={initialize:function(){i.on(l.MANIFEST_UPDATED,u,t),i.on(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),i.on(l.METRIC_ADDED,p,t),i.on(l.METRIC_UPDATED,p,t),i.on(l.PLAYBACK_ERROR,f,t),i.on(o.Z.BECAME_REPORTING_PLAYER,h,t)},reset:function(){i.off(l.MANIFEST_UPDATED,u,t),i.off(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),i.off(l.METRIC_ADDED,p,t),i.off(l.METRIC_UPDATED,p,t),i.off(l.PLAYBACK_ERROR,f,t),i.off(o.Z.BECAME_REPORTING_PLAYER,h,t)}}}s.__dashjs_factory_name="DVBErrorsTranslator";var a=dashjs.FactoryMaker.getSingletonFactory(s),l=n(2295);function c(e){e=e||{};var t,n,i=!1,r=this.context,o=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach((function(e){var t=e.starttime,i=t+e.duration;n.add(t,i)})),i=!!e[0]._useWallClockTime)},reset:function(){n.clear()},isEnabled:function(){var e,t=n.length;if(!t)return!0;e=i?(new Date).getTime()/1e3:o.currentTime;for(var r=0;r<t;r+=1){var s=n.start(r),a=n.end(r);if(s<=e&&e<a)return!0}return!1}},n=(0,l.Z)(r).create(),t}c.__dashjs_factory_name="RangeController";var u=dashjs.FactoryMaker.getClassFactory(c);function d(){return{serialise:function e(t){var n,i,r=[],o=[];for(n in t)if(t.hasOwnProperty(n)&&0!==n.indexOf("_")){if(null==(i=t[n])&&(i=""),Array.isArray(i)){if(!i.length)continue;o=[],i.forEach((function(t){var n="Object"!==Object.prototype.toString.call(t).slice(8,-1);o.push(n?t:e(t))})),i=o.map(encodeURIComponent).join(",")}else"string"==typeof i?i=encodeURIComponent(i):i instanceof Date?i=i.toISOString():"number"==typeof i&&(i=Math.round(i));r.push(n+"="+i)}return r.join("&")}}}d.__dashjs_factory_name="MetricSerialiser";var h=dashjs.FactoryMaker.getSingletonFactory(d);function p(){var e,t,n,i=window.crypto||window.msCrypto,r=Uint32Array,o=Math.pow(2,8*r.BYTES_PER_ELEMENT)-1;function s(){i&&(e||(e=new r(10)),i.getRandomValues(e),t=0)}return n={random:function(n,r){var a;return n||(n=0),r||(r=1),i?(t===e.length&&s(),a=e[t]/o,t+=1):a=Math.random(),a*(r-n)+n}},s(),n}p.__dashjs_factory_name="RNG";var f=dashjs.FactoryMaker.getSingletonFactory(p),g=n(5717);function m(e){var t;e=e||{};var n,i,r,o,s,a,l,c=this.context,u=[],d=e.metricsConstants;function p(){o=!1,s=!1,a=null,l=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),s&&l.isEnabled()&&t.forEach((function(t){var r=n.serialise(t);e!==d.DVB_ERRORS&&(r="metricname=".concat(e,"&").concat(r)),function(e,t,n){var r=new XMLHttpRequest;r.withCredentials=i.getXHRWithCredentialsForType(d.HTTP_REQUEST_DVB_REPORTING_TYPE);var o=function(){var e=u.indexOf(r);-1!==e&&(u.splice(e,1),!(r.status>=200&&r.status<300)&&n&&n())};u.push(r);try{r.open("GET",e),r.onloadend=o,r.onerror=o,r.send()}catch(e){r.onerror()}}(r="".concat(a,"?").concat(r),0,(function(){s=!1}))}))},initialize:function(e,t){var n;if(l=t,!(a=e.dvbReportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");o||((n=e.dvbProbability)&&(1e3===n||n/1e3>=r.random())&&(s=!0),o=!0)},reset:function(){p()}},n=h(c).getInstance(),r=f(c).getInstance(),i=(0,g.Z)(c).getInstance(),p(),t}m.__dashjs_factory_name="DVBReporting";var b=dashjs.FactoryMaker.getClassFactory(m);function y(e){e=e||{};var t={"urn:dvb:dash:reporting:2014":b},n=this.context,i=e.debug?e.debug.getLogger(void 0):{},r=e.metricsConstants,o=e.mediaPlayerModel||{};return{create:function(e,s){var a;try{(a=t[e.schemeIdUri](n).create({metricsConstants:r,mediaPlayerModel:o})).initialize(e,s)}catch(s){a=null,i.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(s.message,")"))}return a},register:function(e,n){t[e]=n},unregister:function(e){delete t[e]}}}y.__dashjs_factory_name="ReportingFactory";var v=dashjs.FactoryMaker.getSingletonFactory(y);function _(e){var t=[],n=v(this.context).getInstance(e);return{initialize:function(e,i){e.some((function(e){var r=n.create(e,i);if(r)return t.push(r),!0}))},reset:function(){t.forEach((function(e){return e.reset()})),t=[]},report:function(e,n){t.forEach((function(t){return t.report(e,n)}))}}}_.__dashjs_factory_name="ReportingController";var E=dashjs.FactoryMaker.getClassFactory(_);function T(){return{reconstructFullMetricName:function(e,t,n){var i=e;return t&&(i+="("+t,n&&n.length&&(i+=","+n),i+=")"),i},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}T.__dashjs_factory_name="HandlerHelpers";var x=dashjs.FactoryMaker.getSingletonFactory(T);function w(e){var t,n,i,r,o;e=e||{};var s=this.context,a=x(s).getInstance(),l=[],c=e.metricsConstants;function u(){var e=function(){try{return Object.keys(l).map((function(e){return l[e]})).reduce((function(e,t){return e.level<t.level?e:t}))}catch(e){return}}();e&&o!==e.t&&(o=e.t,t.report(i,e))}return{initialize:function(e,o,s){o&&(n=a.validateN(s),t=o,i=a.reconstructFullMetricName(e,s),r=setInterval(u,n))},reset:function(){clearInterval(r),r=null,n=0,t=null,o=null},handleNewMetric:function(e,t,n){e===c.BUFFER_LEVEL&&(l[n]=t)}}}w.__dashjs_factory_name="BufferLevelHandler";var k=dashjs.FactoryMaker.getClassFactory(w),S=dashjs.FactoryMaker.getClassFactory((function(e){var t,n=(e=e||{}).eventBus,i=e.metricsConstants;function r(){n.off(o.Z.METRICS_INITIALISATION_COMPLETE,r,this),n.trigger(o.Z.BECAME_REPORTING_PLAYER)}return{initialize:function(e,i){i&&(t=i,n.on(o.Z.METRICS_INITIALISATION_COMPLETE,r,this))},reset:function(){t=null},handleNewMetric:function(e,n){e===i.DVB_ERRORS&&t&&t.report(e,n)}}}));function C(e){var t,n,i,r,o;e=e||{};var s=[],a=x(this.context).getInstance(),l=e.metricsConstants;function c(){var e=s;e.length&&t&&t.report(r,e),s=[]}return{initialize:function(e,s,l,u){s&&(n=a.validateN(l),t=s,u&&u.length&&(i=u),r=a.reconstructFullMetricName(e,l,u),o=setInterval(c,n))},reset:function(){clearInterval(o),o=null,n=null,i=null,s=[],t=null},handleNewMetric:function(e,t){e===l.HTTP_REQUEST&&(i&&i!==t.type||s.push(t))}}}C.__dashjs_factory_name="HttpListHandler";var A=dashjs.FactoryMaker.getClassFactory(C);function I(){var e,t;return{initialize:function(n,i){e=n,t=i},reset:function(){t=null,e=void 0},handleNewMetric:function(n,i){n===e&&t&&t.report(e,i)}}}I.__dashjs_factory_name="GenericMetricHandler";var O=dashjs.FactoryMaker.getClassFactory(I);function N(e){var t=(e=e||{}).debug?e.debug.getLogger(void 0):{},n=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,i=this.context,r={BufferLevel:k,DVBErrors:S,HttpList:A,PlayList:O,RepSwitchList:O,TcpList:O};return{create:function(o,s){var a,l=o.match(n);if(l){try{(a=r[l[1]](i).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(l[1],s,l[3],l[5])}catch(e){a=null,t.error("MetricsHandlerFactory: Could not create handler for type ".concat(l[1]," with args ").concat(l[3],", ").concat(l[5]," (").concat(e.message,")"))}return a}},register:function(e,t){r[e]=t},unregister:function(e){delete r[e]}}}N.__dashjs_factory_name="MetricsHandlerFactory";var R=dashjs.FactoryMaker.getSingletonFactory(N);function D(e){e=e||{};var t,n=[],i=this.context,r=e.eventBus,o=e.events,s=R(i).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function a(e){n.forEach((function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)}))}return t={initialize:function(e,i){e.split(",").forEach((function(e,t,r){var o;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var a=r[t+1];a&&-1===a.indexOf("(")&&-1!==a.indexOf(")")&&(e+=","+a,delete r[t+1])}(o=s.create(e,i))&&n.push(o)})),r.on(o.METRIC_ADDED,a,t),r.on(o.METRIC_UPDATED,a,t)},reset:function(){r.off(o.METRIC_ADDED,a,t),r.off(o.METRIC_UPDATED,a,t),n.forEach((function(e){return e.reset()})),n=[]}}}D.__dashjs_factory_name="MetricsHandlersController";var L=dashjs.FactoryMaker.getClassFactory(D);function M(e){var t,n,i;e=e||{};var r=this.context;function o(){t&&t.reset(),n&&n.reset(),i&&i.reset()}return{initialize:function(s){try{(i=u(r).create({mediaElement:e.mediaElement})).initialize(s.Range),(n=E(r).create({debug:e.debug,metricsConstants:e.metricsConstants,mediaPlayerModel:e.mediaPlayerModel})).initialize(s.Reporting,i),(t=L(r).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(s.metrics,n)}catch(e){throw o(),e}},reset:o}}M.__dashjs_factory_name="MetricsController";var P=dashjs.FactoryMaker.getClassFactory(M),B=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]},j=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},F=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3};function $(e){var t=(e=e||{}).adapter,n=e.constants;return{getMetrics:function(e){var i=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach((function(r){var o=new B,s=t.getIsDynamic(e);r.hasOwnProperty("metrics")&&(o.metrics=r.metrics,r.Range_asArray&&r.Range_asArray.forEach((function(i){var r=new j;r.starttime=function(e,i,r){var o,s,a=0;return i?a=t.getAvailabilityStartTime(e)/1e3:(o=t.getRegularPeriods(e)).length&&(a=o[0].start),s=a,r&&r.hasOwnProperty(n.START_TIME)&&(s+=r.starttime),s}(e,s,i),i.hasOwnProperty("duration")?r.duration=i.duration:r.duration=t.getDuration(e),r._useWallClockTime=s,o.Range.push(r)})),r.Reporting_asArray&&(r.Reporting_asArray.forEach((function(e){var t=new F;e.hasOwnProperty(n.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(n.DVB_REPORTING_URL)&&(t.dvbReportingUrl=e[n.DVB_REPORTING_URL]),e.hasOwnProperty(n.DVB_PROBABILITY)&&(t.dvbProbability=e[n.DVB_PROBABILITY]),o.Reporting.push(t))})),i.push(o)))})),i}}}$.__dashjs_factory_name="ManifestParsing";var U=dashjs.FactoryMaker.getSingletonFactory($);function H(e){var t;e=e||{};var n={},i=this.context,r=e.eventBus,s=e.events;function a(t){if(!t.error){var s=Object.keys(n);U(i).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach((function(t){var r=JSON.stringify(t);if(n.hasOwnProperty(r))s.splice(r,1);else try{var o=P(i).create(e);o.initialize(t),n[r]=o}catch(e){}})),s.forEach((function(e){n[e].reset(),delete n[e]})),r.trigger(o.Z.METRICS_INITIALISATION_COMPLETE)}}function l(){Object.keys(n).forEach((function(e){n[e].reset()})),n={}}return t={reset:function(){r.off(s.MANIFEST_UPDATED,a,t),r.off(s.STREAM_TEARDOWN_COMPLETE,l,t)}},r.on(s.MANIFEST_UPDATED,a,t),r.on(s.STREAM_TEARDOWN_COMPLETE,l,t),t}H.__dashjs_factory_name="MetricsCollectionController";var G=dashjs.FactoryMaker.getClassFactory(H);function V(){var e=this.context;return{createMetricsReporting:function(t){return a(e).getInstance({eventBus:t.eventBus,dashMetrics:t.dashMetrics,metricsConstants:t.metricsConstants,events:t.events}).initialize(),G(e).create(t)},getReportingFactory:function(){return v(e).getInstance()},getMetricsHandlerFactory:function(){return R(e).getInstance()}}}V.__dashjs_factory_name="MetricsReporting";var W=dashjs.FactoryMaker.getClassFactory(V);W.events=o.Z,dashjs.FactoryMaker.updateClassFactory(V.__dashjs_factory_name,W);var z=W},1180:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var a=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,e);var t,n,i=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=s(t);if(n){var r=s(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function a(){var e;return function(e,t){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return a}(n(8342).Z));t.Z=a},5717:function(e,t,n){"use strict";var i=n(2610),r=n(5448),o=n(1264),s=n(3106),a=n(1767),l=n(3393);function c(){var e,t,n,r,c,u,d,h,p=this.context,f=(0,o.Z)(p).getInstance();function g(){r=[],c=[],u=[],h=[],d=null,t=[]}function m(e,t){var n=-1;e.some((function(e,i){if(e===t)return n=i,!0})),n<0||e.splice(n,1)}function b(e){var t;for(t=0;t<h.length;t++)if(h[t].rulename===e)return t;return-1}function y(e,n){v(e,n);var r=new i.Z;r.schemeIdUri=e,r.value=n,t.push(r)}function v(e,n){(0,s.PS)(e,"string"),(0,s.PS)(n,"string"),t.forEach((function(i,r){i.schemeIdUri===e&&i.value===n&&t.splice(r,1)}))}return e={getCustomInitialTrackSelectionFunction:function(){return d},setCustomInitialTrackSelectionFunction:function(e){d=e},resetCustomInitialTrackSelectionFunction:function(){d=null},getLicenseResponseFilters:function(){return c},getLicenseRequestFilters:function(){return r},getCustomCapabilitiesFilters:function(){return u},registerCustomCapabilitiesFilter:function(e){u.push(e)},registerLicenseResponseFilter:function(e){c.push(e)},registerLicenseRequestFilter:function(e){r.push(e)},unregisterCustomCapabilitiesFilter:function(e){m(u,e)},unregisterLicenseResponseFilter:function(e){m(c,e)},unregisterLicenseRequestFilter:function(e){m(r,e)},addAbrCustomRule:function(e,t,n){if("string"!=typeof e||e!==a.Z.ABANDON_FRAGMENT_RULES&&e!==a.Z.QUALITY_SWITCH_RULES||"string"!=typeof t)throw l.Z.BAD_ARGUMENT_ERROR;var i=b(t);-1===i?h.push({type:e,rulename:t,rule:n}):(h[i].type=e,h[i].rule=n)},removeAllAbrCustomRule:function(){h=[]},removeAbrCustomRule:function(e){if(e){var t=b(e);-1!==t&&h.splice(t,1)}else h=[]},getAbrCustomRules:function(){return h},addUTCTimingSource:y,removeUTCTimingSource:v,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=f.get().streaming.utcSynchronization.defaultTimingSource;y(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,i){t?n[t]=!!i:Object.keys(n).forEach((function(t){e(t,i)}))},getXHRWithCredentialsForType:function(e){var t=n[e];return void 0===t?n.default:t},setConfig:function(){},reset:function(){g()}},n={default:!1},g(),e}c.__dashjs_factory_name="CustomParametersModel",t.Z=r.Z.getSingletonFactory(c)},9032:function(e,t,n){"use strict";var i=n(5448),r=n(7473);function o(e){var t=(e=e||{}).requestModifier;function n(e){var n=new Date,i=e.request,r=new XMLHttpRequest;if(r.open(e.method,e.url,!0),i.responseType&&(r.responseType=i.responseType),i.range&&r.setRequestHeader("Range","bytes="+i.range),i.requestStartDate||(i.requestStartDate=n),t&&t.modifyRequestHeader&&(r=t.modifyRequestHeader(r,{url:e.url})),e.headers)for(var o in e.headers){var s=e.headers[o];s&&r.setRequestHeader(o,s)}r.withCredentials=e.withCredentials,r.onload=e.onload,r.onloadend=e.onend,r.onerror=e.onerror,r.onprogress=e.progress,r.onabort=e.onabort,r.ontimeout=e.ontimeout,r.timeout=e.timeout,r.send(),e.response=r}return{load:function(e){t&&t.modifyRequest?(0,r.k)(e,t).then((function(){return n(e)})):n(e)},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}o.__dashjs_factory_name="XHRLoader";var s=i.Z.getClassFactory(o);t.Z=s},1737:function(e,t,n){"use strict";n.d(t,{default:function(){return fe}});var i={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var i=e[n];"urn:mpeg:dash:mp4protection:2011"!==i.schemeIdUri.toLowerCase()||"cenc"!==i.value.toLowerCase()&&"cbcs"!==i.value.toLowerCase()||(t=i)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),i=n.getUint8(t);return t+=20,i>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var i=e.parsePSSHList(n);return t&&i.hasOwnProperty(t.uuid.toLowerCase())?i[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},i=0;;){var r,o,s=void 0,a=i;if(i>=t.buffer.byteLength)break;if(r=i+t.getUint32(i),i+=4,1886614376===t.getUint32(i))if(i+=4,0===(o=t.getUint8(i))||1===o){i++,i+=3,s="";var l=void 0,c=void 0;for(l=0;l<4;l++)s+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=4,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,s+="-",l=0;l<2;l++)s+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;for(i+=2,s+="-",l=0;l<6;l++)s+=1===(c=t.getUint8(i+l).toString(16)).length?"0"+c:c;i+=6,i+=4,n[s=s.toLowerCase()]=t.buffer.slice(a,r),i=r}else i=r;else i=r}return n}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var n=0,r=null;n<e.length&&!r;){var o=e[n];if(o&&o.contentProtection&&o.contentProtection.length>0){var s=o.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===t}));if(s&&s.length>0)for(var a=0;a<s.length&&!r;){for(var l=s[a],c=0;c<i.attributes.length&&!r;){for(var u=0,d=i.attributes[c];u<i.prefixes.length&&!r;){var h=i.prefixes[u];l[d]&&l[d].__prefix&&l[d].__prefix===h&&l[d].__text&&(r=l[d].__text),u+=1}c+=1}a+=1}}n+=1}return r}catch(e){return null}}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e,t),e}(),o=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=n},s=function e(t,n,i,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=i,this.persistentState=r,this.sessionTypes=o};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=c(t);if(n){var r=c(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){var e;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return r}(n(2230).Z)),d=n(5459),h=function e(t,n,i,r,o,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=n,this.responseType=i,this.headers=r,this.withCredentials=o,this.messageType=s,this.sessionId=a,this.data=l},p=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=n,this.data=i},f=n(7855),g=n(703),m=n(3393),b=n(5448);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e){var t,n,i,a,l,c,b,v,_,E,T,x=(e=e||{}).protectionKeyController,w=e.protectionModel,k=e.eventBus,S=e.events,C=e.debug,A=e.BASE64,I=e.constants,O=[],N=e.cmcdModel,R=e.settings,D=e.customParametersModel;function L(){if(!(k&&k.hasOwnProperty("on")&&x&&x.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function M(e,t){v||_?v&&P():function(e,t){if(!_){_=!0;var i,r=[];e=e.sort((function(t,n){return(l&&l[t.ks.systemString]&&l[t.ks.systemString].priority>=0?l[t.ks.systemString].priority:e.length)-(l&&l[n.ks.systemString]&&l[n.ks.systemString].priority>=0?l[n.ks.systemString].priority:e.length)}));for(var o=0;o<e.length;o++){var s=G(e[o]);r.push({ks:e[o].ks,configs:[s],protData:e[o].protData})}w.requestKeySystemAccess(r).then((function(e){var t=(i=e.data).mksa&&i.mksa.selectedSystemString?i.mksa.selectedSystemString:i.keySystem.systemString;return n.info("DRM: KeySystem Access Granted for system string ("+t+")!  Selecting key system..."),w.selectKeySystem(i)})).then((function(e){if(v=e,_=!1,w){k.trigger(S.KEY_SYSTEM_SELECTED,{data:i});var t=$(v);t&&t.serverCertificate&&t.serverCertificate.length>0&&w.setServerCertificate(A.decodeArray(t.serverCertificate).buffer),P()}})).catch((function(e){v=null,_=!1,t||k.trigger(S.KEY_SYSTEM_SELECTED,{data:null,error:new d.Z(u.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,u.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})}))}}(e,t)}function P(){for(var e,t=0;t<i.length;t++)for(e=0;e<i[t].length;e++)if(v===i[t][e].ks){B(i[t][e]);break}i=[]}function B(e){if(x.isClearKey(v)&&e.protData&&e.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(e.protData.clearkeys).length){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?j(e):null!==e.initData&&F(e)}function j(e){L(),w.loadKeySession(e)}function F(e){var t=r.getPSSHForKeySystem(v,e?e.initData:null);if(t){if(function(e){if(!e)return!1;try{for(var t=w.getSessions(),n=0;n<t.length;n++)if(t[n].getKeyId()===e)return!0;return!1}catch(e){return!1}}(e.keyId))return;if(U(t))return;try{e.initData=t,w.createKeySession(e)}catch(e){k.trigger(S.KEY_SESSION_CREATED,{data:null,error:new d.Z(u.KEY_SESSION_CREATED_ERROR_CODE,u.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e&&e.initData?w.createKeySession(e):k.trigger(S.KEY_SESSION_CREATED,{data:null,error:new d.Z(u.KEY_SESSION_CREATED_ERROR_CODE,u.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(v?v.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function $(e){if(e){var t=e.systemString;if(l)return t in l?l[t]:null}return null}function U(e){if(!e)return!1;try{for(var t=w.getAllInitData(),i=0;i<t.length;i++)if(x.initDataEquals(e,t[i]))return n.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function H(e){L(),e?(w.setMediaElement(e),k.on(S.NEED_KEY,J,t)):null===e&&(w.setMediaElement(e),k.off(S.NEED_KEY,J,t))}function G(e){var t=e.protData,n=[],i=[],r=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:b,l=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:b,c=e.sessionType,u=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",d=t&&t.persistentState?t.persistentState:"temporary"===c?"optional":"required";return a.forEach((function(e){e.type===I.AUDIO?n.push(new o(e.codec,r)):e.type===I.VIDEO&&i.push(new o(e.codec,l))})),new s(n,i,u,d,[c])}function V(e){e.error?k.trigger(S.KEY_STATUSES_CHANGED,{data:null,error:e.error}):n.debug("DRM: key status = "+e.status)}function W(e){n.debug("DRM: onKeyMessage");var t=e.data;k.trigger(S.KEY_MESSAGE,{data:t});var i=t.messageType?t.messageType:"license-request",o=t.message,s=t.sessionToken,l=$(v),c=x.getLicenseServerModelInstance(v,l,i),m={sessionToken:s,messageType:i};if(o&&0!==o.byteLength){if(!c)return n.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+s.getSessionId()),void z(m);if(x.isClearKey(v)){var b=x.processClearKeyLicenseRequest(v,l,o);if(b&&b.keyPairs&&b.keyPairs.length>0)return n.debug("DRM: ClearKey license request handled by application!"),z(m),void w.updateKeySession(s,b)}!function(e,t,n){var i=e.sessionToken,o=e.messageType?e.messageType:"license-request",s={sessionToken:i,messageType:o},l=v?v.systemString:null,c=function(e,t,n,i,o){var s=null,l=i.message;if(e&&e.serverURL){var c=e.serverURL;"string"==typeof c&&""!==c?s=c:"object"===y(c)&&c.hasOwnProperty(t)&&(s=c[t])}else if(e&&e.laURL&&""!==e.laURL)s=e.laURL;else if(!(s=r.getLicenseServerUrlFromMediaInfo(a,v.schemeIdURI))&&!x.isClearKey(v)){var u=r.getPSSHData(n.initData);(s=v.getLicenseServerURLFromInitData(u))||(s=i.laURL)}return o.getServerURLFromMessage(s,l,t)}(n,o,i,e,t);if(c){var m={},b=!1;n&&K(m,n.httpRequestHeaders);var _=e.message;K(m,v.getRequestHeadersFromMessage(_)),Object.keys(m).forEach((function(e){"authorization"===e.toLowerCase()&&(b=!0)})),n&&"boolean"==typeof n.withCredentials&&(b=n.withCredentials);var E=function(e){if(w)if(e.status>=200&&e.status<=299){var n=g.Z.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),r=new p(e.responseURL,n,e.response);X(D.getLicenseResponseFilters(),r).then((function(){var n=t.getLicenseMessage(r.data,l,o);null!==n?(z(s),w.updateKeySession(i,n)):Z(e,s,l,o,t)}))}else Z(e,s,l,o,t)},T=function(e){z(s,new d.Z(u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},k=function(e){z(s,new d.Z(u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},S=v.getLicenseRequestFromMessage(_),C=t.getHTTPMethod(o),A=t.getResponseType(l,o),I=n&&!isNaN(n.httpTimeout)?n.httpTimeout:8e3,O=i.getSessionId()||null,N=new h(c,C,A,m,b,o,O,S),L=isNaN(R.get().streaming.retryAttempts[f.w.LICENSE])?3:R.get().streaming.retryAttempts[f.w.LICENSE];X(D.getLicenseRequestFilters(),N).then((function(){q(N,L,I,E,T,k)}))}else z(s,new d.Z(u.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,u.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(t,c,l)}else z(m,new d.Z(u.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,u.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function z(e,t){k.trigger(S.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function q(e,t,i,r,o,s){var a=new XMLHttpRequest;if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled&&R.get().streaming.cmcd.mode===m.Z.CMCD_MODE_QUERY){var l=N.getQueryParameter({url:e.url,type:f.w.LICENSE});l&&(e.url=g.Z.addAditionalQueryParameterToUrl(e.url,[l]))}for(var c in a.open(e.method,e.url,!0),a.responseType=e.responseType,a.withCredentials=e.withCredentials,i>0&&(a.timeout=i),e.headers)a.setRequestHeader(c,e.headers[c]);if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled&&R.get().streaming.cmcd.mode===m.Z.CMCD_MODE_HEADER){var u=N.getHeaderParameters({url:e.url,type:f.w.LICENSE});if(u)for(var d in u){var h=u[d];h&&a.setRequestHeader(d,h)}}var p=function(){t--;var n=isNaN(R.get().streaming.retryIntervals[f.w.LICENSE])?1e3:R.get().streaming.retryIntervals[f.w.LICENSE];T=setTimeout((function(){q(e,t,i,r,o,s)}),n)};a.onload=function(){E=null,this.status>=200&&this.status<=299||t<=0?r(this):(n.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),p())},a.ontimeout=a.onerror=function(){E=null,t<=0?s(this):(n.warn("License request network request failed . Retrying it... Pending retries: "+t),p())},a.onabort=function(){o(this)},k.trigger(S.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),E=a,a.send(e.data)}function Y(){E&&(E.onloadend=E.onerror=E.onprogress=void 0,E.abort(),E=null),T&&(clearTimeout(T),T=null)}function K(e,t){if(t)for(var n in t)e[n]=t[n]}function Z(e,t,n,i,r){var o="NONE",s=null;e.response&&(o=r.getErrorResponse(e.response,n,i),s={serverResponse:e.response||null,responseCode:e.status||null,responseText:e.statusText||null}),z(t,new d.Z(u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+o,s))}function X(e,t){return e?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}function J(e,t){if(!R.get().streaming.protection.ignoreEmeEncryptedEvent){if(n.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void n.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===a.length&&(n.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))return void O.push(setTimeout((function(){J(e,t)}),500));var o=e.key.initData;if(ArrayBuffer.isView(o)&&(o=o.buffer),v){var s=r.getPSSHForKeySystem(v,o);if(s&&U(s))return}n.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(o)));var u=x.getSupportedKeySystemsFromSegmentPssh(o,l,c);if(0===u.length)return void n.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");!function(e){i.push(e),M(e,!1)}(u)}}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");L(),a.push(e)},clearMediaInfoArray:function(){a=[]},handleKeySystemFromManifest:function(){if(a&&0!==a.length){var e=[];a.forEach((function(t){var n=x.getSupportedKeySystemsFromContentProtection(t.contentProtection,l,c);n.length>0&&(0===e.length&&(e=n),i.push(n))})),e&&e.length>0&&M(e,!0)}},createKeySession:F,loadKeySession:j,removeKeySession:function(e){L(),w.removeKeySession(e)},closeKeySession:function(e){L(),w.closeKeySession(e)},setServerCertificate:function(e){L(),w.setServerCertificate(e)},setMediaElement:H,setSessionType:function(e){c=e},setRobustnessLevel:function(e){b=e},setProtectionData:function(e){l=e,x.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return L(),x.getSupportedKeySystemsFromContentProtection(e,l,c)},getKeySystems:function(){return x?x.getKeySystems():[]},setKeySystems:function(e){x&&x.setKeySystems(e)},stop:function(){Y(),w&&w.stop()},reset:function(){k.off(S.INTERNAL_KEY_MESSAGE,W,t),k.off(S.INTERNAL_KEY_STATUS_CHANGED,V,t),L(),Y(),H(null),v=null,_=!1,w&&(w.reset(),w=null),O.forEach((function(e){return clearTimeout(e)})),O=[],a=[],i=[]}},n=C.getLogger(t),i=[],a=[],c="temporary",b="",E=null,T=null,k.on(S.INTERNAL_KEY_MESSAGE,W,t),k.on(S.INTERNAL_KEY_STATUS_CHANGED,V,t),t}v.__dashjs_factory_name="ProtectionController";var _=b.Z.getClassFactory(v),E=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=n},T=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}var t;return(t=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var i={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(i)}this.type&&(n.type=this.type);var r=JSON.stringify(n),o=r.length,s=new ArrayBuffer(o),a=new Uint8Array(s);for(e=0;e<o;e++)a[e]=r.charCodeAt(e);return s}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}(),x=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()),w="e2719d58-a985-b3c9-781a-b030af78d30e",k=x.CLEARKEY_KEYSTEM_STRING;function S(e){var t=(e=e||{}).BASE64;return{uuid:w,schemeIdURI:"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e",systemString:k,getInitData:function(e,n){try{var i=r.parseInitDataFromContentProtection(e,t);if(!i&&n){var o={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(e){return null}}(n["cenc:default_KID"])]};i=(new TextEncoder).encode(JSON.stringify(o))}return i}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),r=[],o=0;o<i.kids.length;o++){var s=i.kids[o],a=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!a)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");r.push(new E(s,a))}n=new T(r)}return n}}}S.__dashjs_factory_name="KeySystemClearKey";var C=dashjs.FactoryMaker.getSingletonFactory(S),A="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",I=x.CLEARKEY_KEYSTEM_STRING;function O(e){var t=e.BASE64,n=e.debug.getLogger(void 0);return{uuid:A,schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:I,getInitData:function(e){return r.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var i=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],s=0;s<r.kids.length;s++){var a=r.kids[s],l=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");o.push(new E(a,l))}i=new T(o),n.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return i}}}O.__dashjs_factory_name="KeySystemW3CClearKey";var N=dashjs.FactoryMaker.getSingletonFactory(O),R="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",D=x.WIDEVINE_KEYSTEM_STRING;function L(e){var t=(e=e||{}).BASE64;return{uuid:R,schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:D,getInitData:function(e){return r.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}L.__dashjs_factory_name="KeySystemWidevine";var M=dashjs.FactoryMaker.getSingletonFactory(L),P="9a04f079-9840-4286-ab92-e65be0885f95",B=x.PLAYREADY_KEYSTEM_STRING;function j(e){var t="utf-16",n=(e=e||{}).BASE64,i=e.settings;function o(){if(!n||!n.hasOwnProperty("decodeArray")||!n.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:P,schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:B,getInitData:function(e){var t,i,s,a,l,c=new Uint8Array([112,115,115,104,0,0,0,0]),u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),d=0,h=null;if(o(),!e)return null;if("pssh"in e)return r.parseInitDataFromContentProtection(e,n);if("pro"in e)h=n.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;h=n.decodeArray(e.prheader.__text)}return t=h.length,i=4+c.length+u.length+4+t,s=new ArrayBuffer(i),a=new Uint8Array(s),(l=new DataView(s)).setUint32(d,i),d+=4,a.set(c,d),d+=c.length,a.set(u,d),d+=u.length,l.setUint32(d,t),d+=4,a.set(h,d),d+=t,a.buffer},getRequestHeadersFromMessage:function(e){var n,r,o={},s=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return o["Content-Type"]="text/xml; charset=utf-8",o;var a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);n=String.fromCharCode.apply(null,a);for(var l=(r=s.parseFromString(n,"application/xml")).getElementsByTagName("name"),c=r.getElementsByTagName("value"),u=0;u<l.length;u++)o[l[u].childNodes[0].nodeValue]=c[u].childNodes[0].nodeValue;return o.hasOwnProperty("Content")&&(o["Content-Type"]=o.Content,delete o.Content),o.hasOwnProperty("Content-Type")||(o["Content-Type"]="text/xml; charset=utf-8"),o},getLicenseRequestFromMessage:function(e){var r=null,s=new DOMParser;if(i&&i.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return e;var a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);o();var l=String.fromCharCode.apply(null,a),c=s.parseFromString(l,"application/xml");if(!c.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var u=c.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return u&&(r=n.decode(u)),r},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),i=6,r=new DOMParser,o=0;o<n;o++){var s=t.getUint16(i,!0);i+=2;var a=t.getUint16(i,!0);if(i+=2,1===s){var l=e.slice(i,i+a),c=String.fromCharCode.apply(null,new Uint16Array(l)),u=r.parseFromString(c,"application/xml");if(u.getElementsByTagName("LA_URL")[0]){var d=u.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(u.getElementsByTagName("LUI_URL")[0]){var h=u.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(h)return h}}else i+=a}return null},getCDMData:function(e){var t,i,r,s;if(o(),!e)return null;for(t=[],s=0;s<e.length;++s)t.push(e.charCodeAt(s)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=n.encode(t),i='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",t),r=[],s=0;s<i.length;++s)r.push(i.charCodeAt(s)),r.push(0);return new Uint8Array(r).buffer},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e}}}j.__dashjs_factory_name="KeySystemPlayReady";var F=dashjs.FactoryMaker.getSingletonFactory(j);function $(e){var t=(e=e||{}).BASE64,n={};return n[x.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[x.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,i){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[i].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}$.__dashjs_factory_name="DRMToday";var U=dashjs.FactoryMaker.getSingletonFactory($);function H(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function n(n){if(window.DOMParser){var i=t(n),r=(new window.DOMParser).parseFromString(i,"text/xml"),o=r?r.getElementsByTagNameNS(e,"Envelope")[0]:null,s=o?o.getElementsByTagNameNS(e,"Body")[0]:null;if(s&&s.getElementsByTagNameNS(e,"Fault")[0])return null}return n}function i(n){var i="",r="",o="",s=-1,a=-1;if(window.DOMParser){var l=t(n),c=(new window.DOMParser).parseFromString(l,"text/xml"),u=c?c.getElementsByTagNameNS(e,"Envelope")[0]:null,d=u?u.getElementsByTagNameNS(e,"Body")[0]:null,h=d?d.getElementsByTagNameNS(e,"Fault")[0]:null,p=h?h.getElementsByTagName("detail")[0]:null,f=p?p.getElementsByTagName("Exception")[0]:null,g=null;if(null===h)return l;i=(g=h.getElementsByTagName("faultstring")[0].firstChild)?g.nodeValue:null,null!==f&&(r=(g=f.getElementsByTagName("StatusCode")[0])?g.firstChild.nodeValue:null,s=(o=(g=f.getElementsByTagName("Message")[0])?g.firstChild.nodeValue:null)?o.lastIndexOf("[")+1:-1,a=o?o.indexOf("]"):-1,o=o?o.substring(s,a):"")}var m="code: ".concat(r,", name: ").concat(i);return o&&(m+=", message: ".concat(o)),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return n.call(this,e)},getErrorResponse:function(e){return i.call(this,e)}}}H.__dashjs_factory_name="PlayReady";var G=b.Z.getSingletonFactory(H);function V(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}V.__dashjs_factory_name="Widevine";var W=dashjs.FactoryMaker.getSingletonFactory(V);function z(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var i=e.keys[n],r=i.kid.replace(/=/g,""),o=i.k.replace(/=/g,"");t.push(new E(r,o))}return new T(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}z.__dashjs_factory_name="ClearKey";var q=dashjs.FactoryMaker.getSingletonFactory(z);function Y(){var e,t,n,i,o,s,a,l,c=this.context;function u(e,t){return t&&e in t?t[e]:null}function d(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function h(e,t){return e&&e.sessionType?e.sessionType:t}return e={initialize:function(){var e;i=[],e=F(c).getInstance({BASE64:o,settings:s}),i.push(e),e=M(c).getInstance({BASE64:o}),i.push(e),e=C(c).getInstance({BASE64:o}),i.push(e),a=e,e=N(c).getInstance({BASE64:o,debug:t}),i.push(e),l=e},setProtectionData:function(e){for(var t,n,r=0;r<i.length;r++){var o=i[r];o.hasOwnProperty("init")&&o.init((t=o.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===a||e===l},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),i=new Uint8Array(t),r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}return!1},getKeySystems:function(){return i},setKeySystems:function(e){i=e},getKeySystemBySystemString:function(e){for(var t=0;t<i.length;t++)if(i[t].systemString===e)return i[t];return null},getSupportedKeySystemsFromContentProtection:function(e,t,n){var o,s,a,l,c=[];if(e){var p=r.findCencContentProtection(e);for(a=0;a<i.length;++a){var f=u((s=i[a]).systemString,t);for(l=0;l<e.length;++l)if((o=e[l]).schemeIdUri.toLowerCase()===s.schemeIdURI){var g=s.getInitData(o,p);c.push({ks:i[a],keyId:o.keyId,initData:g,protData:f,cdmData:s.getCDMData(f?f.cdmData:null),sessionId:d(f,o),sessionType:h(f,n)})}}}return c},getSupportedKeySystemsFromSegmentPssh:function(e,t,n){for(var o,s=[],a=r.parsePSSHList(e),l=0;l<i.length;++l){var c=u((o=i[l]).systemString,t);o.uuid in a&&s.push({ks:o,initData:a[o.uuid],protData:c,cdmData:o.getCDMData(c?c.cdmData:null),sessionId:d(c),sessionType:h(c,n)})}return s},getLicenseServerModelInstance:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var i=null;return t&&t.hasOwnProperty("drmtoday")?i=U(c).getInstance({BASE64:o}):e.systemString===x.WIDEVINE_KEYSTEM_STRING?i=W(c).getInstance():e.systemString===x.PLAYREADY_KEYSTEM_STRING?i=G(c).getInstance():e.systemString===x.CLEARKEY_KEYSTEM_STRING&&(i=q(c).getInstance()),i},processClearKeyLicenseRequest:function(e,t,i){try{return e.getClearKeysFromProtectionData(t,i)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(i){i&&(i.debug&&(t=i.debug,n=t.getLogger(e)),i.BASE64&&(o=i.BASE64),i.settings&&(s=i.settings))}}}Y.__dashjs_factory_name="ProtectionKeyController";var K=dashjs.FactoryMaker.getSingletonFactory(Y);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){return(X=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Q=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&X(e,t)}(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=J(t);if(n){var r=J(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return function(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,e)});function r(){var e;return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),(e=i.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return r}(n(8342).Z)),ee=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=n},te=function e(t,n,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=n,this.defaultURL=i,this.messageType=r||"license-request"},ne=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=n},ie={};function re(e){e=e||{};var t,n,i,r,o,s,a,l,c=this.context,h=e.eventBus,p=e.events,f=e.debug;function g(e,t,i,r,o){var s=e[i];n.debug("Requesting key system access for system string ".concat(s)),navigator.requestMediaKeySystemAccess(s,t).then((function(e){e.selectedSystemString=s,r(e)})).catch((function(n){i+1<e.length?g(e,t,i+1,r,o):o(n)}))}function m(e){if(!e||!e.session)return Promise.resolve;var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function b(e){for(var t=0;t<s.length;t++)if(s[t]===e){s.splice(t,1);break}}function y(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function v(e,t){var i={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":h.trigger(p.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=y(arguments);"expired"===e.status?h.trigger(p.INTERNAL_KEY_STATUS_CHANGED,{error:new d.Z(u.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,u.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):h.trigger(p.INTERNAL_KEY_STATUS_CHANGED,e)}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;h.trigger(p.INTERNAL_KEY_MESSAGE,{data:new te(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){"usable"===y(arguments).status&&(t=!0)})),t}};return e.addEventListener("keystatuseschange",i),e.addEventListener("message",i),e.closed.then((function(){b(i),n.debug("DRM: Session closed.  SessionID = "+i.getSessionId()),h.trigger(p.KEY_SESSION_CLOSED,{data:i.getSessionId()})})),s.push(i),i}return t={getAllInitData:function(){for(var e=[],t=0;t<s.length;t++)s[t].initData&&e.push(s[t].initData);return e},getSessions:function(){return s},requestKeySystemAccess:function(e){return new Promise((function(t,n){!function e(t,n,i,r){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var o="Insecure origins are not allowed";return h.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:o}),void r({error:o})}var s=t[n].protData&&t[n].protData.systemStringPriority?t[n].protData.systemStringPriority:null,a=t[n].configs,l=t[n].ks,c=l.systemString;(function(e,t){return new Promise((function(n,i){g(e,t,0,n,i)}))})(s||(ie[c]?ie[c]:[c]),a).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new ne(l,t);n.mksa=e,h.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{data:n}),i({data:n})})).catch((function(o){if(n+1<t.length)e(t,n+1,i,r);else{var s="Key system access denied! ";h.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:s+o.message}),r({error:s+o.message})}}))}(e,0,t,n)}))},selectKeySystem:function(e){return new Promise((function(t,n){e.mksa.createMediaKeys().then((function(t){return i=e.keySystem,o=t,r?r.setMediaKeys(o):Promise.resolve()})).then((function(){t(i)})).catch((function(){n({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))}))},setMediaElement:function(e){r!==e&&(r&&(r.removeEventListener("encrypted",a),r.setMediaKeys&&r.setMediaKeys(null)),(r=e)&&(r.addEventListener("encrypted",a),r.setMediaKeys&&o&&r.setMediaKeys(o)))},setServerCertificate:function(e){if(!i||!o)throw new Error("Can not set server certificate until you have selected a key system");o.setServerCertificate(e).then((function(){n.info("DRM: License server certificate successfully updated."),h.trigger(p.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){h.trigger(p.SERVER_CERTIFICATE_UPDATED,{error:new d.Z(u.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,u.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e){if(!i||!o)throw new Error("Can not create sessions until you have selected a key system");var t=o.createSession(e.sessionType),r=v(t,e),s=i.systemString===x.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?x.INITIALIZATION_DATA_TYPE_KEYIDS:x.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(s,e.initData).then((function(){n.debug("DRM: Session created.  SessionID = "+r.getSessionId()),h.trigger(p.KEY_SESSION_CREATED,{data:r})})).catch((function(e){b(r),h.trigger(p.KEY_SESSION_CREATED,{data:null,error:new d.Z(u.KEY_SESSION_CREATED_ERROR_CODE,u.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var n=e.session;l.isClearKey(i)&&(t=t.toJWK()),n.update(t).then((function(){h.trigger(p.KEY_SESSION_UPDATED)})).catch((function(t){h.trigger(p.KEY_ERROR,{error:new d.Z(u.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e){if(!i||!o)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,r=0;r<s.length;r++)if(t===s[r].sessionId)return void n.warn("DRM: Ignoring session ID because we have already seen it!");var a=o.createSession(e.sessionType),l=v(a,e);a.load(t).then((function(e){e?(n.debug("DRM: Session loaded.  SessionID = "+l.getSessionId()),h.trigger(p.KEY_SESSION_CREATED,{data:l})):(b(l),h.trigger(p.KEY_SESSION_CREATED,{data:null,error:new d.Z(u.KEY_SESSION_CREATED_ERROR_CODE,u.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))})).catch((function(e){b(l),h.trigger(p.KEY_SESSION_CREATED,{data:null,error:new d.Z(u.KEY_SESSION_CREATED_ERROR_CODE,u.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){n.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),h.trigger(p.KEY_SESSION_REMOVED,{data:e.getSessionId()})}),(function(t){h.trigger(p.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})}))},closeKeySession:function(e){m(e).catch((function(t){b(e),h.trigger(p.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})}))},stop:function(){for(var e,t=0;t<s.length;t++)(e=s[t]).getUsable()||(m(e),b(e))},reset:function(){var e,t=s.length;0!==t?function(){for(var n=function(e){b(e),0===s.length&&(r?(r.removeEventListener("encrypted",a),r.setMediaKeys(null).then((function(){h.trigger(p.TEARDOWN_COMPLETE)}))):h.trigger(p.TEARDOWN_COMPLETE))},i=0;i<t;i++)!function(t){m(e),n(t)}(e=s[i])}():h.trigger(p.TEARDOWN_COMPLETE)}},n=f.getLogger(t),i=null,r=null,o=null,s=[],l=K(c).getInstance(),a={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;h.trigger(p.NEED_KEY,{key:new ee(t,e.initDataType)})}}},t}ie[x.PLAYREADY_KEYSTEM_STRING]=[x.PLAYREADY_KEYSTEM_STRING,x.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],ie[x.WIDEVINE_KEYSTEM_STRING]=[x.WIDEVINE_KEYSTEM_STRING],ie[x.CLEARKEY_KEYSTEM_STRING]=[x.CLEARKEY_KEYSTEM_STRING],re.__dashjs_factory_name="ProtectionModel_21Jan2015";var oe=dashjs.FactoryMaker.getClassFactory(re);function se(e){e=e||{};var t,n,i,r,o,a,l,c,h,p=this.context,f=e.eventBus,g=e.events,m=e.debug,b=e.api;function y(){try{for(var e=0;e<l.length;e++)v(l[e]);i&&i.removeEventListener(b.needkey,c),f.trigger(g.TEARDOWN_COMPLETE)}catch(e){f.trigger(g.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function v(e){var t=e.session;t.removeEventListener(b.error,e),t.removeEventListener(b.message,e),t.removeEventListener(b.ready,e),t.removeEventListener(b.close,e);for(var n=0;n<l.length;n++)if(l[n]===e){l.splice(n,1);break}t[b.release]()}function _(){var e=null,t=function(){i.removeEventListener("loadedmetadata",e),i[b.setMediaKeys](o),f.trigger(g.VIDEO_ELEMENT_SELECTED)};i.readyState>=1?t():(e=t.bind(this),i.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<l.length;t++)e.push(l[t].initData);return e},getSessions:function(){return l},requestKeySystemAccess:function(e){return new Promise((function(t,n){for(var i=!1,r=0;r<e.length;r++)for(var o=e[r].ks.systemString,a=e[r].configs,l=null,c=null,u=0;u<a.length;u++){var d=a[u].audioCapabilities,p=a[u].videoCapabilities;if(d&&0!==d.length){l=[];for(var m=0;m<d.length;m++)window[b.MediaKeys].isTypeSupported(o,d[m].contentType)&&l.push(d[m])}if(p&&0!==p.length){c=[];for(var y=0;y<p.length;y++)window[b.MediaKeys].isTypeSupported(o,p[y].contentType)&&c.push(p[y])}if(!(!l&&!c||l&&0===l.length||c&&0===c.length)){i=!0;var v=new s(l,c),_=h.getKeySystemBySystemString(o),E=new ne(_,v);f.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{data:E}),t({data:E});break}}if(!i){var T="Key system access denied! -- No valid audio/video content configurations detected!";f.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{error:T}),n({error:T})}}))},selectKeySystem:function(e){return new Promise((function(t,n){try{o=e.mediaKeys=new window[b.MediaKeys](e.keySystem.systemString),r=e.keySystem,a=e,i&&_(),t(r)}catch(e){n({error:"Error selecting keys system ("+r.systemString+")! Could not create MediaKeys -- TODO"})}}))},setMediaElement:function(e){i!==e&&(i&&i.removeEventListener(b.needkey,c),(i=e)&&(i.addEventListener(b.needkey,c),o&&_()))},createKeySession:function(e){if(!r||!o||!a)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(a.ksConfiguration.videoCapabilities&&a.ksConfiguration.videoCapabilities.length>0&&(t=a.ksConfiguration.videoCapabilities[0]),null===t&&a.ksConfiguration.audioCapabilities&&a.ksConfiguration.audioCapabilities.length>0&&(t=a.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var i=t.contentType,s=o.createSession(i,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),c=function(e,t){return{session:s,keyId:t.keyId,initData:t.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case b.error:f.trigger(g.KEY_ERROR,{error:new d.Z(u.MEDIA_KEYERR_CODE,"KeyError",this)});break;case b.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;f.trigger(g.INTERNAL_KEY_MESSAGE,{data:new te(this,t,e.destinationURL)});break;case b.ready:n.debug("DRM: Key added."),f.trigger(g.KEY_ADDED);break;case b.close:n.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),f.trigger(g.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}}(0,e);s.addEventListener(b.error,c),s.addEventListener(b.message,c),s.addEventListener(b.ready,c),s.addEventListener(b.close,c),l.push(c),n.debug("DRM: Session created.  SessionID = "+c.getSessionId()),f.trigger(g.KEY_SESSION_CREATED,{data:c})},updateKeySession:function(e,t){var n=e.session;h.isClearKey(r)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),f.trigger(g.KEY_SESSION_UPDATED)},closeKeySession:v,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:y,reset:y},n=m.getLogger(t),i=null,r=null,o=null,a=null,l=[],h=K(p).getInstance(),c={handleEvent:function(e){if(e.type===b.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;f.trigger(g.NEED_KEY,{key:new ee(t,"cenc")})}}},t}se.__dashjs_factory_name="ProtectionModel_3Feb2014";var ae=dashjs.FactoryMaker.getClassFactory(se);function le(e){e=e||{};var t,n,i,r,o,a,l,c,h,p=this.context,f=e.eventBus,g=e.events,m=e.debug,b=e.api,y=e.errHandler;function v(){i&&T();for(var e=0;e<l.length;e++)_(l[e]);f.trigger(g.TEARDOWN_COMPLETE)}function _(e){try{i[b.cancelKeyRequest](r.systemString,e.sessionId)}catch(t){f.trigger(g.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function E(e,t){if(t&&e){for(var n=e.length,i=0;i<n;i++)if(e[i].sessionId==t)return e[i];return null}return null}function T(){i.removeEventListener(b.keyerror,h),i.removeEventListener(b.needkey,h),i.removeEventListener(b.keymessage,h),i.removeEventListener(b.keyadded,h)}return t={getAllInitData:function(){for(var e=[],t=0;t<a.length;t++)e.push(a[t].initData);for(var n=0;n<l.length;n++)e.push(l[n].initData);return e},getSessions:function(){return l.concat(a)},requestKeySystemAccess:function(e){return new Promise((function(t,n){var r=i;r||(r=document.createElement("video"));for(var a=!1,l=0;l<e.length;l++)for(var c=e[l].ks.systemString,u=e[l].configs,d=null,h=0;h<u.length;h++){var p=u[h].videoCapabilities;if(p&&0!==p.length){d=[];for(var m=0;m<p.length;m++)""!==r.canPlayType(p[m].contentType,c)&&d.push(p[m])}if(d&&(!d||0!==d.length)){a=!0;var b=new s(null,d),y=o.getKeySystemBySystemString(c),v=new ne(y,b);f.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{data:v}),t({data:v});break}}if(!a){var _="Key system access denied! -- No valid audio/video content configurations detected!";f.trigger(g.KEY_SYSTEM_ACCESS_COMPLETE,{error:_}),n({error:_})}}))},selectKeySystem:function(e){return r=e.keySystem,Promise.resolve(r)},setMediaElement:function(e){if(i!==e){if(i){T();for(var t=0;t<l.length;t++)_(l[t]);l=[]}(i=e)&&(i.addEventListener(b.keyerror,h),i.addEventListener(b.needkey,h),i.addEventListener(b.keymessage,h),i.addEventListener(b.keyadded,h),f.trigger(g.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!r)throw new Error("Can not create sessions until you have selected a key system");if(c||0===l.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return a.push(t),i[b.generateKeyRequest](r.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionId;if(o.isClearKey(r))for(var s=0;s<t.keyPairs.length;s++)i[b.addKey](r.systemString,t.keyPairs[s].key,t.keyPairs[s].keyID,n);else i[b.addKey](r.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);f.trigger(g.KEY_SESSION_UPDATED)},closeKeySession:_,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:v,reset:v},n=m.getLogger(t),i=null,r=null,a=[],l=[],o=K(p).getInstance(),h={handleEvent:function(e){var t=null;switch(e.type){case b.needkey:var i=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;f.trigger(g.NEED_KEY,{key:new ee(i,"cenc")});break;case b.keyerror:if((t=E(l,e.sessionId))||(t=E(a,e.sessionId)),t){var r=u.MEDIA_KEYERR_CODE,o="";switch(e.errorCode.code){case 1:r=u.MEDIA_KEYERR_UNKNOWN_CODE,o+="MEDIA_KEYERR_UNKNOWN - "+u.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:r=u.MEDIA_KEYERR_CLIENT_CODE,o+="MEDIA_KEYERR_CLIENT - "+u.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:r=u.MEDIA_KEYERR_SERVICE_CODE,o+="MEDIA_KEYERR_SERVICE - "+u.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:r=u.MEDIA_KEYERR_OUTPUT_CODE,o+="MEDIA_KEYERR_OUTPUT - "+u.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:r=u.MEDIA_KEYERR_HARDWARECHANGE_CODE,o+="MEDIA_KEYERR_HARDWARECHANGE - "+u.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:r=u.MEDIA_KEYERR_DOMAIN_CODE,o+="MEDIA_KEYERR_DOMAIN - "+u.MEDIA_KEYERR_DOMAIN_MESSAGE}o+="  System Code = "+e.systemCode,f.trigger(g.KEY_ERROR,{error:new d.Z(r,o,t)})}else n.error("No session token found for key error");break;case b.keyadded:(t=E(l,e.sessionId))||(t=E(a,e.sessionId)),t?(n.debug("DRM: Key added."),f.trigger(g.KEY_ADDED,{data:t})):n.debug("No session token found for key added");break;case b.keymessage:if((c=null!==e.sessionId&&void 0!==e.sessionId)?!(t=E(l,e.sessionId))&&a.length>0&&(t=a.shift(),l.push(t),t.sessionId=e.sessionId,f.trigger(g.KEY_SESSION_CREATED,{data:t})):a.length>0&&(t=a.shift(),l.push(t),0!==a.length&&y.error(new d.Z(u.MEDIA_KEY_MESSAGE_ERROR_CODE,u.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var s=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=s,f.trigger(g.INTERNAL_KEY_MESSAGE,{data:new te(t,s,e.defaultURL)})}else n.warn("No session token found for key message")}}},t}le.__dashjs_factory_name="ProtectionModel_01b";var ce=dashjs.FactoryMaker.getClassFactory(le),ue=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],de=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function he(){var e,t=this.context;function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];if("function"==typeof e[i[Object.keys(i)[0]]])return i}return null}return e={createProtectionSystem:function(i){var r=null,o=K(t).getInstance();o.setConfig({debug:i.debug,BASE64:i.BASE64,settings:i.settings}),o.initialize();var s=function(i){var r=i.debug,o=r.getLogger(e),s=i.eventBus,a=i.errHandler,l=i.videoModel?i.videoModel.getElement():null;return l&&void 0===l.onencrypted||l&&void 0===l.mediaKeys?n(l,de)?(o.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),ae(t).create({debug:r,eventBus:s,events:i.events,api:n(l,de)})):n(l,ue)?(o.info("EME detected on this user agent! (ProtectionModel_01b)"),ce(t).create({debug:r,eventBus:s,errHandler:a,events:i.events,api:n(l,ue)})):(o.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(o.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),oe(t).create({debug:r,eventBus:s,events:i.events}))}(i);return!r&&s&&(r=_(t).create({protectionModel:s,protectionKeyController:o,eventBus:i.eventBus,debug:i.debug,events:i.events,BASE64:i.BASE64,constants:i.constants,cmcdModel:i.cmcdModel,customParametersModel:i.customParametersModel,settings:i.settings}),i.capabilities.setEncryptedMediaSupported(!0)),r}}}he.__dashjs_factory_name="Protection";var pe=dashjs.FactoryMaker.getClassFactory(he);pe.events=Q,pe.errors=u,dashjs.FactoryMaker.updateClassFactory(he.__dashjs_factory_name,pe);var fe=pe},2068:function(e,t,n){"use strict";var i=n(5448),r={DEFAULT:.5,STRONG:1,WEAK:0};function o(e,t,n){var i,o;return i=void 0===e?-1:e,o=function(e){var t=r.DEFAULT;return e!==r.DEFAULT&&e!==r.STRONG&&e!==r.WEAK||(t=e),t}(n),{quality:i,reason:void 0===t?null:t,priority:o}}o.__dashjs_factory_name="SwitchRequest";var s=i.Z.getClassFactory(o);s.NO_CHANGE=-1,s.PRIORITY=r,i.Z.updateClassFactory(o.__dashjs_factory_name,s),t.Z=s},1767:function(e,t,n){"use strict";var i=n(5628),r=n(6535),o=n(7423),s=n(895),a=n(6070),l=n(3112),c=n(1914),u=n(5435),d=n(5448),h=n(2068),p=n(3393),f="qualitySwitchRules",g="abandonFragmentRules";function m(e){e=e||{};var t,n,d=this.context,m=e.mediaPlayerModel,b=e.customParametersModel,y=e.dashMetrics,v=e.settings;function _(e){return e.filter((function(e){return e.quality>h.Z.NO_CHANGE}))}function E(e){var t,n,i,r,o,s={},a=null;if(0!==e.length){for(s[h.Z.PRIORITY.STRONG]={quality:h.Z.NO_CHANGE,reason:null},s[h.Z.PRIORITY.WEAK]={quality:h.Z.NO_CHANGE,reason:null},s[h.Z.PRIORITY.DEFAULT]={quality:h.Z.NO_CHANGE,reason:null},t=0,n=e.length;t<n;t+=1)(i=e[t]).quality!==h.Z.NO_CHANGE&&(s[i.priority].quality===h.Z.NO_CHANGE||s[i.priority].quality>i.quality)&&(s[i.priority].quality=i.quality,s[i.priority].reason=i.reason||null);return s[h.Z.PRIORITY.WEAK].quality!==h.Z.NO_CHANGE&&(a=s[h.Z.PRIORITY.WEAK]),s[h.Z.PRIORITY.DEFAULT].quality!==h.Z.NO_CHANGE&&(a=s[h.Z.PRIORITY.DEFAULT]),s[h.Z.PRIORITY.STRONG].quality!==h.Z.NO_CHANGE&&(a=s[h.Z.PRIORITY.STRONG]),a&&(r=a.quality,o=a.reason),(0,h.Z)(d).create(r,o)}}return{initialize:function(){t=[],n=[],v.get().streaming.abr.useDefaultABRRules&&(v.get().streaming.abr.ABRStrategy===p.Z.ABR_STRATEGY_L2A?t.push((0,c.Z)(d).create({dashMetrics:y,settings:v})):v.get().streaming.abr.ABRStrategy===p.Z.ABR_STRATEGY_LoLP?t.push((0,u.Z)(d).create({dashMetrics:y})):(t.push((0,l.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:v})),t.push((0,i.Z)(d).create({dashMetrics:y})),v.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&t.push((0,r.Z)(d).create({dashMetrics:y,settings:v})),v.get().streaming.abr.additionalAbrRules.switchHistoryRule&&t.push((0,a.Z)(d).create()),v.get().streaming.abr.additionalAbrRules.droppedFramesRule&&t.push((0,s.Z)(d).create()),v.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&n.push((0,o.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:v})))),b.getAbrCustomRules().forEach((function(e){e.type===f&&t.push(e.rule(d).create()),e.type===g&&n.push(e.rule(d).create())}))},reset:function(){[t,n].forEach((function(e){e&&e.length&&e.forEach((function(e){return e.reset&&e.reset()}))})),t=[],n=[]},getMaxQuality:function(e){return E(_(t.map((function(t){return t.getMaxIndex(e)}))))||(0,h.Z)(d).create()},getMinSwitchRequest:E,shouldAbandonFragment:function(e,t){var i=E(_(n.map((function(n){return n.shouldAbandon(e,t)}))));return i&&(i.reason.forceAbandon=!0),i||(0,h.Z)(d).create()},getQualitySwitchRules:function(){return t}}}m.__dashjs_factory_name="ABRRulesCollection";var b=d.Z.getClassFactory(m);b.QUALITY_SWITCH_RULES=f,b.ABANDON_FRAGMENT_RULES=g,d.Z.updateSingletonFactory(m.__dashjs_factory_name,b),t.Z=b},7423:function(e,t,n){"use strict";var i=n(2068),r=n(5448),o=n(6398);function s(e){e=e||{};var t,n,r,a,l,c=this.context,u=e.mediaPlayerModel,d=e.dashMetrics,h=e.settings;function p(){r={},a={},l=[]}return t={shouldAbandon:function(e){var t=(0,i.Z)(c).create(i.Z.NO_CHANGE,{name:s.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var o,p,f=e.getMediaInfo(),g=e.getMediaType(),m=e.getStreamInfo(),b=m?m.id:null,y=e.getCurrentRequest();if(!isNaN(y.index)){o=g,p=y.index,r[o]=r[o]||{},r[o][p]=r[o][p]||{};var v=u.getStableBufferTime();if(d.getCurrentBufferLevel(g)>v)return t;var _=r[g][y.index];if(null===_||null===y.firstByteDate||a.hasOwnProperty(_.id))return t;if(void 0===_.firstByteTime&&(l[g]=[],_.firstByteTime=y.firstByteDate.getTime(),_.segmentDuration=y.duration,_.bytesTotal=y.bytesTotal,_.id=y.index),_.bytesLoaded=y.bytesLoaded,_.elapsedTime=(new Date).getTime()-_.firstByteTime,_.bytesLoaded>0&&_.elapsedTime>0&&function(e,t){l[e]=l[e]||[],l[e].push(t)}(g,Math.round(8*_.bytesLoaded/_.elapsedTime)),l[g].length>=h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.minLengthToAverage&&_.elapsedTime>h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.graceTimeThreshold&&_.bytesLoaded<_.bytesTotal){var E=l[g].reduce((function(e,t){return e+t}),0);if(_.measuredBandwidthInKbps=Math.round(E/l[g].length),_.estimatedTimeOfDownload=+(8*_.bytesTotal/_.measuredBandwidthInKbps/1e3).toFixed(2),_.estimatedTimeOfDownload<_.segmentDuration*h.get().streaming.abr.abrRulesParameters.abandonRequestsRule.abandonMultiplier||0===e.getRepresentationInfo().quality)return t;if(!a.hasOwnProperty(_.id)){var T=e.getAbrController(),x=_.bytesTotal-_.bytesLoaded,w=T.getBitrateList(f),k=T.getQualityForBitrate(f,_.measuredBandwidthInKbps*h.get().streaming.abr.bandwidthSafetyFactor,b),S=T.getMinAllowedIndexFor(g,b),C=void 0!==S?Math.max(S,k):k;x>_.bytesTotal*w[C].bitrate/w[T.getQualityFor(g,b)].bitrate&&(t.quality=C,t.reason.throughput=_.measuredBandwidthInKbps,t.reason.fragmentID=_.id,t.reason.rule=this.getClassName(),a[_.id]=_,n.debug("["+g+"] frag id",_.id," is asking to abandon and switch to quality to ",C," measured bandwidth was",_.measuredBandwidthInKbps),delete r[g][_.id])}}else _.bytesLoaded===_.bytesTotal&&delete r[g][_.id]}return t},reset:p},n=(0,o.Z)(c).getInstance().getLogger(t),p(),t}s.__dashjs_factory_name="AbandonRequestsRule",t.Z=r.Z.getClassFactory(s)},3112:function(e,t,n){"use strict";var i=n(3860),r=n(2068),o=n(5448),s=n(7855),a=n(5595),l=n(8512),c=n(6398),u=n(8825),d=n(3393),h=10;function p(e){e=e||{};var t,n,o,p=this.context,f=e.dashMetrics,g=e.mediaPlayerModel,m=(0,a.Z)(p).getInstance();function b(e,t,n){var i=n.reduce((function(e,t,i){return t>n[e]?i:e}),0);if(0===i)return null;var r=Math.max(e,h+2*t.length),o=(n[i]-1)/(r/h-1);return{gp:o,Vp:h/o}}function y(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function v(e,t){var n=g.getStableBufferTime();if(e.stableBufferTime!==n){var i=b(n,e.bitrates,e.utilities);if(i.Vp!==e.Vp||i.gp!==e.gp){var r=f.getCurrentBufferLevel(t),o=r+e.placeholderBuffer;o-=h,o*=i.Vp/e.Vp,o+=h,e.stableBufferTime=n,e.Vp=i.Vp,e.gp=i.gp,e.placeholderBuffer=Math.max(0,o-r)}}}function _(e,t){return e.Vp*(e.utilities[t]+e.gp)}function E(e,t){for(var n=e.bitrates[t],i=e.utilities[t],r=0,o=t-1;o>=0;--o)if(e.utilities[o]<e.utilities[t]){var s=e.bitrates[o],a=e.utilities[o],l=e.Vp*(e.gp+(n*a-s*i)/(n-s));r=Math.max(r,l)}return r}function T(e){var t=e.mediaType===d.Z.AUDIO?[d.Z.AUDIO]:o;for(var n in t)o.hasOwnProperty(n)&&2===o[n].state&&(o[n].placeholderBuffer=0)}function x(){for(var e in o)if(o.hasOwnProperty(e)){var t=o[e];0!==t.state&&(t.state=1,y(t))}}function w(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=o[e.chunk.mediaInfo.type];if(t&&0!==t.state){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,S(t,e.chunk.mediaInfo.type)}}}function k(e){if(e&&e.metric===i.Z.HTTP_REQUEST&&e.value&&e.value.type===s.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=o[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),S(t,e.mediaType))}}function S(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var n=f.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=_(e,e.lastQuality),r=Math.max(0,i-n);e.placeholderBuffer=Math.min(r,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function C(e){if(e){var t=o[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function A(e){if(e){var t=o[e.mediaType];if(t&&0!==t.state){var n,i=f.getCurrentBufferLevel(e.mediaType);n=t.abrQuality>0?E(t,t.abrQuality):h;var r=Math.max(0,n-i);t.placeholderBuffer=Math.min(t.placeholderBuffer,r)}}}function I(){o={}}return t={getMaxIndex:function(e){var t=(0,r.Z)(p).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var i=e.getMediaInfo(),s=e.getMediaType(),a=e.getScheduleController(),l=e.getStreamInfo(),c=e.getAbrController(),u=c.getThroughputHistory(),d=l?l.id:null,h=l&&l.manifestInfo&&l.manifestInfo.isDynamic,m=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!m)return t;a.setTimeToLoadDelay(0);var T=function(e){var t=e.getMediaType(),n=o[t];return n?0!==n.state&&v(n,t):(n=function(e){var t={},n=e.getMediaInfo().bitrateList.map((function(e){return e.bandwidth})),i=n.map((function(e){return Math.log(e)}));i=i.map((function(e){return e-i[0]+1}));var r=g.getStableBufferTime(),o=b(r,n,i);return o?(t.state=1,t.bitrates=n,t.utilities=i,t.stableBufferTime=r,t.Vp=o.Vp,t.gp=o.gp,t.lastQuality=0,y(t)):t.state=0,t}(e),o[t]=n),n}(e);if(0===T.state)return t;var x,w=f.getCurrentBufferLevel(s),k=u.getAverageThroughput(s,h),S=u.getSafeAverageThroughput(s,h),C=u.getAverageLatency(s);if(t.reason.state=T.state,t.reason.throughput=k,t.reason.latency=C,isNaN(k))return t;switch(T.state){case 1:x=c.getQualityForBitrate(i,S,d,C),t.quality=x,t.reason.throughput=S,T.placeholderBuffer=Math.max(0,E(T,x)-w),T.lastQuality=x,!isNaN(T.lastSegmentDurationS)&&w>=T.lastSegmentDurationS&&(T.state=2);break;case 2:!function(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var i=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,i)}}else{var r=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,r)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,v(e,t)}(T,s),x=function(e,t){for(var n=e.bitrates.length,i=NaN,r=NaN,o=0;o<n;++o){var s=(e.Vp*(e.utilities[o]+e.gp)-t)/e.bitrates[o];(isNaN(r)||s>=r)&&(r=s,i=o)}return i}(T,w+T.placeholderBuffer);var A=c.getQualityForBitrate(i,S,d,C);x>T.lastQuality&&x>A&&(x=Math.max(A,T.lastQuality));var I=Math.max(0,w+T.placeholderBuffer-_(T,x));I<=T.placeholderBuffer?(T.placeholderBuffer-=I,I=0):(I-=T.placeholderBuffer,T.placeholderBuffer=0,x<c.getMaxAllowedIndexFor(s,d)?a.setTimeToLoadDelay(1e3*I):I=0),t.quality=x,t.reason.throughput=k,t.reason.latency=C,t.reason.bufferLevel=w,t.reason.placeholderBuffer=T.placeholderBuffer,t.reason.delay=I,T.lastQuality=x;break;default:n.debug("BOLA ABR rule invoked in bad state."),t.quality=c.getQualityForBitrate(i,S,d,C),t.reason.state=T.state,t.reason.throughput=S,t.reason.latency=C,T.state=1,y(T)}return t},reset:function(){I(),m.off(u.Z.BUFFER_EMPTY,T,t),m.off(u.Z.PLAYBACK_SEEKING,x,t),m.off(u.Z.METRIC_ADDED,k,t),m.off(u.Z.QUALITY_CHANGE_REQUESTED,C,t),m.off(u.Z.FRAGMENT_LOADING_ABANDONED,A,t),m.off(l.Z.MEDIA_FRAGMENT_LOADED,w,t)}},n=(0,c.Z)(p).getInstance().getLogger(t),I(),m.on(u.Z.BUFFER_EMPTY,T,t),m.on(u.Z.PLAYBACK_SEEKING,x,t),m.on(u.Z.METRIC_ADDED,k,t),m.on(u.Z.QUALITY_CHANGE_REQUESTED,C,t),m.on(u.Z.FRAGMENT_LOADING_ABANDONED,A,t),m.on(l.Z.MEDIA_FRAGMENT_LOADED,w,t),t}p.__dashjs_factory_name="BolaRule",t.Z=o.Z.getClassFactory(p)},895:function(e,t,n){"use strict";var i=n(5448),r=n(2068),o=n(6398);function s(){var e,t,n=this.context;return e={getMaxIndex:function(e){var i=(0,r.Z)(n).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return i;var o=e.getDroppedFramesHistory(),s=e.getStreamInfo().id;if(o){var a=o.getFrameHistory(s);if(!a||0===a.length)return i;for(var l=0,c=0,u=r.Z.NO_CHANGE,d=1;d<a.length;d++)if(a[d]&&(l=a[d].droppedVideoFrames,(c=a[d].totalVideoFrames)>375&&l/c>.15)){u=d-1,t.debug("index: "+u+" Dropped Frames: "+l+" Total Frames: "+c);break}return(0,r.Z)(n).create(u,{droppedFrames:l})}return i}},t=(0,o.Z)(n).getInstance().getLogger(e),e}s.__dashjs_factory_name="DroppedFramesRule",t.Z=i.Z.getClassFactory(s)},6535:function(e,t,n){"use strict";var i=n(5595),r=n(8512),o=n(5448),s=n(6398),a=n(2068),l=n(3393),c=n(3860),u=n(8825);function d(e){e=e||{};var t,n,o,d=this.context,h=(0,i.Z)(d).getInstance(),p=e.dashMetrics;function f(){(o={})[l.Z.VIDEO]={ignoreCount:2},o[l.Z.AUDIO]={ignoreCount:2}}function g(){f()}function m(e){isNaN(e.startTime)||e.mediaType!==l.Z.AUDIO&&e.mediaType!==l.Z.VIDEO||o[e.mediaType].ignoreCount>0&&o[e.mediaType].ignoreCount--}return t={getMaxIndex:function(e){var t=(0,a.Z)(d).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!p||!p.hasOwnProperty("getCurrentBufferLevel")||!p.hasOwnProperty("getCurrentBufferState"))throw new Error(l.Z.MISSING_CONFIG_ERROR)}();var i=e.getMediaType(),r=p.getCurrentBufferState(i),s=e.getRepresentationInfo().fragmentDuration,u=e.getStreamInfo(),h=u?u.id:null,f=e.getScheduleController(),g=u&&u.manifestInfo&&u.manifestInfo.isDynamic;if(!f.getPlaybackController().getLowLatencyModeEnabled()&&o[i].ignoreCount>0||!s)return t;if(r&&r.state===c.Z.BUFFER_EMPTY)n.debug("["+i+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var m=e.getMediaInfo(),b=e.getAbrController(),y=b.getThroughputHistory(),v=p.getCurrentBufferLevel(i),_=y.getAverageThroughput(i,g),E=y.getAverageLatency(i),T=_*(v/s)*.5;t.quality=b.getQualityForBitrate(m,T,h,E),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){f(),h.off(u.Z.PLAYBACK_SEEKING,g,t),h.off(r.Z.BYTES_APPENDED_END_FRAGMENT,m,t)}},n=(0,s.Z)(d).getInstance().getLogger(t),f(),h.on(u.Z.PLAYBACK_SEEKING,g,t),h.on(r.Z.BYTES_APPENDED_END_FRAGMENT,m,t),t}d.__dashjs_factory_name="InsufficientBufferRule",t.Z=o.Z.getClassFactory(d)},1914:function(e,t,n){"use strict";var i=n(3860),r=n(2068),o=n(5448),s=n(7855),a=n(5595),l=n(8512),c=n(6398),u=n(3393);function d(e){e=e||{};var t,n,o,d,h=this.context,p=e.dashMetrics,f=(0,a.Z)(h).getInstance();function g(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,e.lastSegmentUrl=""}function m(){for(var e in n)if(n.hasOwnProperty(e)){var t=n[e];0!==t.state&&(t.state=1,g(t))}}function b(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=n[e.chunk.mediaInfo.type],i=o[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,v(t,i)}}}function y(e){if(e&&e.metric===i.Z.HTTP_REQUEST&&e.value&&e.value.type===s.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=n[e.mediaType],r=o[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),v(t,r))}}function v(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function _(e){if(e&&e.mediaType){var t=n[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function E(e,t){if(e.length!==t.length)return-1;for(var n=0,i=0;i<e.length;i++)n+=e[i]*t[i];return n}function T(){n={},o={}}return t={getMaxIndex:function(e){var t,i=(0,r.Z)(h).create(),a=Math.pow(4,.99),l=Math.max(Math.pow(4,1),a*Math.sqrt(4)),c=e.getMediaInfo(),f=e.getMediaType(),m=c.bitrateList.map((function(e){return e.bandwidth})),b=m.length,y=e.getScheduleController(),v=e.getStreamInfo(),_=e.getAbrController(),T=_.getThroughputHistory(),x=v&&v.manifestInfo&&v.manifestInfo.isDynamic,w=e.useL2AABR(),k=p.getCurrentBufferLevel(f,!0),S=T.getSafeAverageThroughput(f,x),C=T.getAverageThroughput(f,x),A=T.getAverageLatency(f),I=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return i;if(i.reason=i.reason||{},!w||f===u.Z.AUDIO)return i;y.setTimeToLoadDelay(0);var O=function(e){var t=e.getMediaType(),i=n[t];return i||(i=function(e){var t={},n=e.getMediaInfo(),i=n.bitrateList.map((function(e){return e.bandwidth/1e3}));return t.state=1,t.bitrates=i,t.lastQuality=0,function(e){e&&e.type&&(o[e.type]={},o[e.type].w=[],o[e.type].prev_w=[],o[e.type].Q=0,o[e.type].segment_request_start_s=0,o[e.type].segment_download_finish_s=0,o[e.type].B_target=1.5)}(n),g(t),t}(e),n[t]=i),i}(e);if(0===O.state)return i;var N=o[f];if(!N)return i;if(i.reason.state=O.state,i.reason.throughput=C,i.reason.latency=A,isNaN(C))return i;switch(O.state){case 1:if(t=_.getQualityForBitrate(c,S,v.id,A),i.quality=t,i.reason.throughput=S,O.lastQuality=t,!isNaN(O.lastSegmentDurationS)&&k>=N.B_target){O.state=2,N.Q=a;for(var R=0;R<b;++R)R===O.lastQuality?N.prev_w[R]=1:N.prev_w[R]=0}break;case 2:var D=[],L=p.getCurrentHttpRequest(f).trace.reduce((function(e,t){return e+t.d}),0),M=p.getCurrentHttpRequest(f).trace.reduce((function(e,t){return e+t.b[0]}),0),P=Math.round(8*M/L),B=p.getCurrentHttpRequest(f);if(P<1&&(P=1),B.url===O.lastSegmentUrl||B.type===s.w.INIT_SEGMENT_TYPE)t=O.lastQuality;else{for(var j=O.lastSegmentDurationS,F=1,$=0;$<b;++$)m[$]=m[$]/1e3,I*m[$]>P&&(F=-1),N.w[$]=N.prev_w[$]+F*(j/(2*l))*((N.Q+a)*(I*m[$]/P));N.w=function(e){for(var t=e.length,n=!1,i=[],r=0;r<t;++r)i[r]=e[r];for(var o=e.sort((function(e,t){return t-e})),s=0,a=0,l=[],c=0;c<t-1;++c)if((a=((s+=o[c])-1)/(c+1))>=o[c+1]){n=!0;break}n||(a=(s+o[t-1]-1)/t);for(var u=0;u<t;++u)l[u]=Math.max(i[u]-a,0);return l}(N.w);for(var U=0;U<b;++U)D[U]=N.w[U]-N.prev_w[U],N.prev_w[U]=N.w[U];N.Q=Math.max(0,N.Q-j+j*I*((E(m,N.prev_w)+E(m,D))/P));for(var H=[],G=0;G<b;++G)H[G]=Math.abs(m[G]-E(N.w,m));(t=H.indexOf(Math.min.apply(Math,H)))>O.lastQuality&&m[O.lastQuality+1]<=P&&(t=O.lastQuality+1),m[t]>=P&&(N.Q=2*Math.max(a,N.Q)),O.lastSegmentUrl=B.url}i.quality=t,i.reason.throughput=C,i.reason.latency=A,i.reason.bufferLevel=k,O.lastQuality=i.quality;break;default:d.debug("L2A ABR rule invoked in bad state."),i.quality=_.getQualityForBitrate(c,S,v.id,A),i.reason.state=O.state,i.reason.throughput=S,i.reason.latency=A,O.state=1,g(O)}return i},reset:function(){T(),f.off(l.Z.PLAYBACK_SEEKING,m,t),f.off(l.Z.MEDIA_FRAGMENT_LOADED,b,t),f.off(l.Z.METRIC_ADDED,y,t),f.off(l.Z.QUALITY_CHANGE_REQUESTED,_,t)}},d=(0,c.Z)(h).getInstance().getLogger(t),T(),f.on(l.Z.PLAYBACK_SEEKING,m,t),f.on(l.Z.MEDIA_FRAGMENT_LOADED,b,t),f.on(l.Z.METRIC_ADDED,y,t),f.on(l.Z.QUALITY_CHANGE_REQUESTED,_,t),t}d.__dashjs_factory_name="L2ARule",t.Z=o.Z.getClassFactory(d)},6070:function(e,t,n){"use strict";var i=n(5448),r=n(6398),o=n(2068);function s(){var e,t,n=this.context;return e={getMaxIndex:function(e){for(var i=e?e.getSwitchHistory():null,r=i?i.getSwitchRequests():[],s=0,a=0,l=0,c=(0,o.Z)(n).create(),u=0;u<r.length;u++)if(void 0!==r[u]&&(s+=r[u].drops,a+=r[u].noDrops,l+=r[u].dropSize,s+a>=6&&s/a>.075)){c.quality=u>0&&r[u].drops>0?u-1:u,c.reason={index:c.quality,drops:s,noDrops:a,dropSize:l},t.debug("Switch history rule index: "+c.quality+" samples: "+(s+a)+" drops: "+s);break}return c}},t=(0,r.Z)(n).getInstance().getLogger(e),e}s.__dashjs_factory_name="SwitchHistoryRule",t.Z=i.Z.getClassFactory(s)},5628:function(e,t,n){"use strict";var i=n(5448),r=n(2068),o=n(3393),s=n(3860);function a(e){e=e||{};var t=this.context,n=e.dashMetrics;return{getMaxIndex:function(e){var i=(0,r.Z)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return i;!function(){if(!n||!n.hasOwnProperty("getCurrentBufferState"))throw new Error(o.Z.MISSING_CONFIG_ERROR)}();var a=e.getMediaInfo(),l=e.getMediaType(),c=n.getCurrentBufferState(l),u=e.getScheduleController(),d=e.getAbrController(),h=e.getStreamInfo(),p=h?h.id:null,f=h&&h.manifestInfo?h.manifestInfo.isDynamic:null,g=d.getThroughputHistory(),m=g.getSafeAverageThroughput(l,f),b=g.getAverageLatency(l),y=e.useBufferOccupancyABR();return isNaN(m)||!c||y||d.getAbandonmentStateFor(p,l)!==s.Z.ABANDON_LOAD&&(c.state===s.Z.BUFFER_LOADED||f)&&(i.quality=d.getQualityForBitrate(a,m,p,b),u.setTimeToLoadDelay(0),i.reason={throughput:m,latency:b}),i},reset:function(){}}}a.__dashjs_factory_name="ThroughputRule",t.Z=i.Z.getClassFactory(a)},4722:function(e,t,n){"use strict";var i=n(5448),r=n(6398);function o(){var e,t,n,i,o,s,a,l,c,u=this.context;function d(){n=null,i=1,o=100,s=0,a=null,l=null,c="dynamic_weight_selection"}function h(){var e=0;if(n)for(var t=0;t<n.length;t++){var i=n[t];i.state.throughput>e&&(e=i.state.throughput)}return e}function p(e,t,n){var i=e.map((function(e,i){return n[i]*Math.pow(e-t[i],2)})).reduce((function(e,t){return e+t}));return(i<0?-1:1)*Math.sqrt(Math.abs(i))}function f(e,t){return p([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function g(e,t,n){for(var i=0;i<t.length;i++){var r=t[i],o=f(r,e);m(r,n,Math.exp(-1*Math.pow(o,2)/(2*Math.pow(.1,2))))}}function m(e,t,n){var i=e.state,r=[.01,.01,.01,.01];i.throughput=i.throughput+(t[0]-i.throughput)*r[0]*n,i.latency=i.latency+(t[1]-i.latency)*r[1]*n,i.rebuffer=i.rebuffer+(t[2]-i.rebuffer)*r[2]*n,i.switch=i.switch+(t[3]-i.switch)*r[3]*n}return e={getNextQuality:function(e,r,u,d,f,m,b){var y=u,v=d,_=r,E=function(e){if(!n){n=[];var t=e.bitrateList,r=[];s=t[0].bandwidth,t.forEach((function(e){r.push(e.bandwidth),e.bandwidth<s&&(s=e.bandwidth)})),c=r.map((function(e){return Math.pow(e,2)})).reduce((function(e,t){return e+t})),i=Math.sqrt(c);for(var o=0;o<t.length;o++){var a={qualityIndex:o,bitrate:t[o].bandwidth,state:{throughput:t[o].bandwidth/i,latency:0,rebuffer:0,switch:0}};n.push(a)}l=function(e){var t=[],n=function(e){for(var t=[],n=0;n<e;n++){var i=[Math.random()*h(),Math.random(),Math.random(),Math.random()];t.push(i)}return t}(Math.pow(e.length,2));t.push(n[0]);for(var i=[1,1,1,1],r=1;r<e.length;r++){for(var o=null,s=null,a=0;a<n.length;a++){for(var l=n[a],c=null,u=0;u<t.length;u++){var d=p(l,t[u],i);(null===c||d<c)&&(c=d)}(null===s||c>s)&&(o=l,s=c)}t.push(o)}for(var f=null,g=null,m=0;m<t.length;m++){for(var b=0,y=0;y<t.length;y++)m!==y&&(b+=p(t[m],t[y],i));(null===f||b>f)&&(f=b,g=m)}var v=[];for(v.push(t[g]),t.splice(g,1);t.length>0;){for(var _=null,E=null,T=0;T<t.length;T++){var x=p(v[0],t[T],i);(null===_||x<_)&&(_=x,E=T)}v.push(t[E]),t.splice(E,1)}return v}(n)}var c;return n}(e),T=r/i;T>1&&(T=h()),u/=o,t.debug("getNextQuality called throughput:".concat(T," latency:").concat(u," bufferSize:").concat(d," currentQualityIndex:").concat(m," playbackRate:").concat(f));var x=E[m],w=x.bitrate*b.getSegmentDuration()/_,k=Math.max(0,w-v);if(v-w<b.getMinBuffer())return t.debug("Buffer is low for bitrate= ".concat(x.bitrate," downloadTime=").concat(w," currentBuffer=").concat(v," rebuffer=").concat(k)),function(e,t){var i=0,r=e;if(n)for(var o=0;o<n.length;o++){var s=n[o];s.bitrate<e.bitrate&&s.bitrate>i&&t>s.bitrate&&(i=s.bitrate,r=s)}return r}(x,_).qualityIndex;switch(c){case"manual_weight_selection":a=[.4,.4,.4,.4];break;case"random_weight_selection":a=function(e,t){for(var n=[],i=Math.sqrt(2/e),r=0;r<4;r++)n.push(Math.random()*i);return a=n}(E.length);break;default:!function(e,t,n,i,r,o,s){a||(a=l[l.length-1]);var c=e.findWeightVector(t,n,i,r,o,s);null!==c&&-1!==c&&(a=c)}(b,E,y,v,k,_,f)}for(var S=null,C=null,A=null,I=0;I<E.length;I++){var O=E[I],N=O.state,R=[N.throughput,N.latency,N.rebuffer,N.switch],D=a.slice(),L=b.getNextBufferWithBitrate(O.bitrate,v,_),M=L<b.getMinBuffer();M&&t.debug("Buffer is low for bitrate=".concat(O.bitrate," downloadTime=").concat(w," currentBuffer=").concat(v," nextBuffer=").concat(L)),(O.bitrate>r-1e4||M)&&O.bitrate!==s&&(D[0]=100);var P=p(R,[T,0,0,0],D);(null===S||P<S)&&(S=P,C=O.qualityIndex,A=O)}var B=Math.abs(x.bitrate-A.bitrate)/i;return g(x,E,[T,u,k,B]),g(A,E,[T,0,0,B]),C},reset:function(){d()}},t=(0,r.Z)(u).getInstance().getLogger(e),d(),e}o.__dashjs_factory_name="LearningAbrController",t.Z=i.Z.getClassFactory(o)},5317:function(e,t,n){"use strict";var i=n(5448),r=n(2298);function o(){var e,t,n,i,o;function s(){t=null,n=null,i=null,o=null}function a(e,t,n,i){var o=new r.Z;return o.type=e,o.weights.bitrateReward=t||1,o.weights.bitrateSwitchPenalty=1,o.weights.rebufferPenalty=n||1e3,o.weights.latencyPenalty=[],o.weights.latencyPenalty.push({threshold:1.1,penalty:.05*i}),o.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),o.weights.playbackSpeedPenalty=i||200,o}function l(e,t,n,i,r){r.bitrateWSum+=r.weights.bitrateReward*e,r.lastBitrate&&(r.bitrateSwitchWSum+=r.weights.bitrateSwitchPenalty*Math.abs(e-r.lastBitrate)),r.lastBitrate=e,r.rebufferWSum+=r.weights.rebufferPenalty*t;for(var o=0;o<r.weights.latencyPenalty.length;o++){var s=r.weights.latencyPenalty[o];if(n<=s.threshold){r.latencyWSum+=s.penalty*n;break}}r.playbackSpeedWSum+=r.weights.playbackSpeedPenalty*Math.abs(1-i),r.totalQoe=r.bitrateWSum-r.bitrateSwitchWSum-r.rebufferWSum-r.latencyWSum-r.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,r,s){t=a("segment",e,r,s),n=e,i=r,o=s},logSegmentMetrics:function(e,n,i,r){t&&l(e,n,i,r,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,r,s){var c=null;return n&&i&&o&&(c=a("segment",n,i,o)),c?(l(e,t,r,s,c),c.totalQoe):0},reset:function(){s()}},s(),e}o.__dashjs_factory_name="LoLpQoeEvaluator",t.Z=i.Z.getClassFactory(o)},5435:function(e,t,n){"use strict";var i=n(6398),r=n(5448),o=n(4722),s=n(5317),a=n(2068),l=n(3860),c=n(6523),u=n(3393);function d(e){var t,n,r,d,h=(e=e||{}).dashMetrics,p=this.context;return n={getMaxIndex:function(e){try{var n=(0,a.Z)(p).create(),i=e.getMediaInfo().type,o=e.getAbrController(),s=e.getStreamInfo(),f=o.getQualityFor(i,s.id),g=e.getMediaInfo(),m=h.getCurrentBufferState(i),b=e.getScheduleController(),y=h.getCurrentBufferLevel(i,!0),v=s&&s.manifestInfo?s.manifestInfo.isDynamic:null,_=b.getPlaybackController(),E=_.getCurrentLiveLatency();if(!e.useLoLPABR()||i===u.Z.AUDIO)return n;E||(E=0);var T=_.getPlaybackRate(),x=o.getThroughputHistory().getSafeAverageThroughput(i,v);if(t.debug("Throughput ".concat(Math.round(x)," kbps")),isNaN(x)||!m)return n;if(o.getAbandonmentStateFor(s.id,i)===l.Z.ABANDON_LOAD)return n;for(var w=g.bitrateList,k=e.getRepresentationInfo().fragmentDuration,S=w[0].bandwidth/1e3,C=w[w.length-1].bandwidth/1e3,A=0;A<w.length;A++){var I=w[A].bandwidth/1e3;I>C?C=I:I<S&&(S=I)}var O=w[f].bandwidth/1e3,N=h.getCurrentHttpRequest(i,!0),R=(N.tresponse.getTime()-N.trequest.getTime())/1e3,D=R>k?R-k:0;d.setupPerSegmentQoe(k,C,S),d.logSegmentMetrics(O,D,E,T);var L=(0,c.Z)(p).create({targetLatency:1.5,bufferMin:.3,segmentDuration:k,qoeEvaluator:d});return n.quality=r.getNextQuality(g,1e3*x,E,y,T,f,L),n.reason={throughput:x,latency:E},n.priority=a.Z.PRIORITY.STRONG,b.setTimeToLoadDelay(0),n.quality!==f&&t.debug("[TgcLearningRule]["+i+"] requesting switch to index: ",n.quality,"Average throughput",Math.round(x),"kbps"),n}catch(e){throw e}},reset:function(){r.reset(),d.reset()}},t=(0,i.Z)(p).getInstance().getLogger(n),r=(0,o.Z)(p).create(),d=(0,s.Z)(p).create(),n}d.__dashjs_factory_name="LoLPRule",t.Z=r.Z.getClassFactory(d)},6523:function(e,t,n){"use strict";var i=n(5448);function r(e){var t,n,i,r,o=e.targetLatency,s=e.bufferMin,a=e.segmentDuration,l=e.qoeEvaluator;function c(){return a}function u(e,t){var n=c();return t>n?e-n:e+n-t}return t={getMinBuffer:function(){return s},getSegmentDuration:c,getNextBufferWithBitrate:function(e,t,n){return u(t,e*a/n)},getNextBuffer:u,findWeightVector:function(e,t,r,c,d,h){var p=null,f=null,g=null,m=Math.abs(t-i);return e.forEach((function(e){n.forEach((function(n){n[0];var i=n[1],c=n[2],b=(n[3],e.bitrate*a/d),y=u(r,b),v=(0===c?10:1/c)*Math.max(1e-5,b-y),_=(0===i?10:1/i)*e.state.latency,E=l.calculateSingleUseQoe(e.bitrate,v,_,h);(null===p||E>p)&&function(e,t,n){return!(e>o+m)&&y>=s}(t)&&(p=E,f=n,g=e.bitrate)}))})),null===f&&null===g&&(f=-1),i=t,f}},n=function e(t,n,i){if(i===n)return t;for(var o=t.length,s=0;s<o;s++)for(var a=t.shift(),l=0;l<r.length;l++)t.push(a.concat(r[l]));return e(t,n,i+1)}((r=[.2,.4,.6,.8,1]).map((function(e){return[e]})),4,1),i=0,t}r.__dashjs_factory_name="LoLpWeightSelector",t.Z=i.Z.getClassFactory(r)},2298:function(e,t){"use strict";t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},7803:function(e,t,n){"use strict";n.d(t,{Y:function(){return p}});var i=n(3393),r=n(1553),o=n(5448),s=n(2128),a=n(2594),l=n(7387),c=n(7417),u=n(9032),d=n(9326),h=n(7802),p=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function f(e){var t,n,o,f,g,m,b,y,v=this.context,_=e.adapter,E=e.baseURLController,T=e.streamInfo,x=e.timelineConverter,w=e.debug,k=e.eventBus,S=e.events,C=e.dashConstants,A=(0,a.Z)(v).getInstance();function I(e,t){var i=new s.Z;i.id=e.id,i.bitrate=e.bandwidth,i.width=e.width,i.height=e.height,i.tilesHor=1,i.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach((function(e){if(p.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(i.tilesHor=parseInt(t[0],10),i.tilesVert=parseInt(t[1],10))}})),t?m.updateSegmentData(e).then((function(t){!function(e,t,n){var i=[],r=function(e,t){var n,i,r,o,s=[],a=0;for(n=0,i=e.segments.length;n<i;n++)r=e.segments[n],(o=(0,l.TJ)(x,_.getIsDynamic(),t,r.startTime,r.duration,r.timescale,r.media,r.mediaRange,a))&&(s.push(o),o=null,a++);return s}(n,t);t.segments=r,e.segmentDuration=t.segments[0].duration,e.readThumbnail=function(e,n){var r=null;i.some((function(t){if(t.start<=e&&t.end>e)return r=t.url,!0})),r?n(r):t.segments.some((function(r){if(r.mediaStartTime<=e&&r.mediaStartTime+r.duration>e){var o=E.resolve(t.path);return b.load({method:"get",url:o.url,request:{range:r.mediaRange,responseType:"arraybuffer"},onload:function(e){var t=y.getSamplesInfo(e.target.response),o=new Blob([e.target.response.slice(t.sampleList[0].offset,t.sampleList[0].offset+t.sampleList[0].size)],{type:"image/jpeg"}),s=window.URL.createObjectURL(o);i.push({start:r.mediaStartTime,end:r.mediaStartTime+r.duration,url:s}),n&&n(s)}}),!0}}))}}(i,e,t)})):(i.startNumber=e.startNumber,i.segmentDuration=e.segmentDuration,i.timescale=e.timescale,i.templateUrl=function(e){var t=A.isRelative(e.media)?A.resolve(e.media,E.resolve(e.path).url):e.media;return t?(0,l.Aj)(t,e.id):""}(e)),i.tilesHor>0&&i.tilesVert>0&&(i.widthPerTile=i.width/i.tilesHor,i.heightPerTile=i.height/i.tilesVert,n.push(i))}function O(){n=[],f=-1,g=null}return t={getTracks:function(){return n},addTracks:function(){if(T&&_&&(g=_.getMediaInfoForType(T,i.Z.IMAGE))){var e=_.getVoRepresentations(g);e&&e.length>0&&e.forEach((function(e){(e.segmentInfoType===r.Z.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===r.Z.SEGMENT_TIMELINE)&&I(e),e.segmentInfoType===r.Z.SEGMENT_BASE&&I(e,!0)})),n.length>0&&n.sort((function(e,t){return e.bitrate-t.bitrate}))}},reset:O,setTrackByIndex:function(e){n&&0!==n.length&&(e>=n.length&&(e=n.length-1),f=e)},getCurrentTrack:function(){return f<0?null:n[f]},getCurrentTrackIndex:function(){return f},getThumbnailRequestForTime:function(e){for(var t,i=_.getVoRepresentations(g),r=0;r<i.length;r++)if(n[f].id===i[r].id){t=i[r];break}return o.getSegmentRequestForTime(g,t,e)}},O(),b=(0,u.Z)(v).create({}),y=(0,c.Z)(v).getInstance(),m=(0,h.Z)(v).create({events:S,eventBus:k,streamInfo:T,timelineConverter:x,dashConstants:C,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:i.Z.IMAGE}),(o=(0,d.Z)(v).create({streamInfo:T,type:i.Z.IMAGE,timelineConverter:x,segmentsController:m,baseURLController:E,debug:w,eventBus:k,events:S,dashConstants:C,urlUtils:A})).initialize(!!_&&_.getIsDynamic()),t}f.__dashjs_factory_name="ThumbnailTracks",t.Z=o.Z.getClassFactory(f)},7417:function(e,t,n){"use strict";var i=n(6398),r=n(8260),o=n(5448),s=n(6934),a=n(9597);function l(){var e,t,n=this.context;function o(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=s.parseBuffer(e),i=(0,r.Z)(n).create();return i.setData(t),i}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function c(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:o,findLastTopIsoBoxCompleted:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new a.Z(0,!1);for(var i,r=t instanceof ArrayBuffer?new Uint8Array(t):t,o=0;n<r.byteLength;){var s=l(r,n),u=c(r,n+4);if(0===s)break;n+s<=r.byteLength&&(e.indexOf(u)>=0?i=new a.Z(n,!0,s):o=n+s),n+=s}return i||new a.Z(o,!1)},getMediaTimescaleFromMoov:function(e){var t=o(e),n=t?t.getBox("mdhd"):void 0;return n?n.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,n,i,r,s,a,l,c,u,d,h,p,f,g,m,b,y=o(e),v=y.getBoxes("moof"),_=y.getBoxes("mfhd");m=y.getBoxes("moof").length,g=_[_.length-1].sequence_number,n=0,s=[];var E=-1,T=-1;for(d=0;d<v.length;d++){var x=v[d],w=x.getChildBoxes("traf");for(c=0;c<w.length;c++){var k=w[c],S=k.getChildBox("tfhd"),C=k.getChildBox("tfdt");r=C.baseMediaDecodeTime;var A=k.getChildBoxes("trun"),I=k.getChildBoxes("subs");for(u=0;u<A.length;u++){var O=A[u];for(n=O.sample_count,f=(S.base_data_offset||0)+(O.data_offset||0),l=0;l<n;l++){t=void 0!==(a=O.samples[l]).sample_duration?a.sample_duration:S.default_sample_duration,i=void 0!==a.sample_size?a.sample_size:S.default_sample_size;var N={dts:r,cts:r+(void 0!==a.sample_composition_time_offset?a.sample_composition_time_offset:0),duration:t,offset:x.offset+f,size:i,subSizes:[i]};if(I)for(h=0;h<I.length;h++){var R=I[h];if(E<R.entry_count-1&&l>T&&(E++,T+=R.entries[E].sample_delta),l==T){N.subSizes=[];var D=R.entries[E];for(p=0;p<D.subsample_count;p++)N.subSizes.push(D.subsamples[p].subsample_size)}}s.push(N),f+=i,r+=t}}b=r-C.baseMediaDecodeTime}}return{sampleList:s,lastSequenceNumber:g,totalDuration:b,numSequences:m}},findInitRange:function(t){var n=null,i=o(t);if(!i)return n;var r=i.getBox("ftyp"),s=i.getBox("moov");return e.debug("Searching for initialization."),s&&s.isComplete&&(n=(r?r.offset:s.offset)+"-"+(s.offset+s.size-1),e.debug("Found the initialization.  Range: "+n)),n},parsePayload:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new a.Z(0,!1);for(var i,r=t instanceof ArrayBuffer?new Uint8Array(t):t,o=0;n<r.byteLength;){var s=l(r,n),u=c(r,n+4);if(0===s)break;n+s<=r.byteLength&&(e.indexOf(u)>=0?i=new a.Z(n,!0,s,u):o=n+s),n+=s}return i||new a.Z(o,!1)}},e=(0,i.Z)(n).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser",t.Z=o.Z.getSingletonFactory(l)},1715:function(e,t,n){"use strict";n.d(t,{B:function(){return a}});var i=n(5448),r=n(7803),o=n(3393),s=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function a(){var e="ManagedMediaSource"in window,t="WebKitMediaSource"in window,n="MediaSource"in window;return e||t||n}function l(){var e,t,n;return e={setConfig:function(e){e&&e.settings&&(t=e.settings)},supportsMediaSource:a,supportsEncryptedMedia:function(){return n},supportsCodec:function(e,n){return n!==o.Z.AUDIO&&n!==o.Z.VIDEO?Promise.resolve(!0):function(e,n){return t.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(e.codec&&n===o.Z.AUDIO||n===o.Z.VIDEO&&e.codec&&e.width&&e.height&&e.bitrate&&e.framerate)}(e,n)?function(e,t){return new Promise((function(n){if(e&&e.codec){var i={type:"media-source"};i[t]={},i[t].contentType=e.codec,i[t].width=e.width,i[t].height=e.height,i[t].bitrate=parseInt(e.bitrate),i[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(i).then((function(e){n(e.supported)})).catch((function(){n(!1)}))}else n(!1)}))}(e,n):function(e){return new Promise((function(t){if(e&&e.codec){var n=e.codec;e.width&&e.height&&(n+=';width="'+e.width+'";height="'+e.height+'"'),"ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(n)||"MediaSource"in window&&MediaSource.isTypeSupported(n)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(n)?t(!0):t(!1)}else t(!1)}))}(e)},setEncryptedMediaSupported:function(e){n=e},supportsEssentialProperty:function(e){try{return-1!==r.Y.indexOf(e.schemeIdUri)||o.Z.FONT_DOWNLOAD_DVB_SCHEME===e.schemeIdUri}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var n,i=e.split(".")[0],r=0===t.indexOf(i),o=0;o<s.length;o++)if(s[o].codec===i){n=s[o];break}return n?r||n.compatibleCodecs.some((function(e){return 0===t.indexOf(e)})):r}},n=!1,e}l.__dashjs_factory_name="Capabilities",t.Z=i.Z.getSingletonFactory(l)},2295:function(e,t,n){"use strict";var i=n(5448),r=n(3106);function o(){return{customTimeRangeArray:[],length:0,add:function(e,t){var n;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var n=this.customTimeRangeArray[e],i=this.customTimeRangeArray[t];return n.start<=i.start&&i.start<=n.end&&n.end<=i.end?(n.end=i.end,this.customTimeRangeArray.splice(t,1),!0):i.start<=n.start&&n.start<=i.end&&i.end<=n.end?(n.start=i.start,this.customTimeRangeArray.splice(t,1),!0):i.start<=n.start&&n.start<=i.end&&n.end<=i.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=i.start&&i.start<=n.end&&i.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,r.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,r.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}o.__dashjs_factory_name="CustomTimeRanges",t.Z=i.Z.getClassFactory(o)},5:function(e,t,n){"use strict";var i=n(5448);function r(){var e,t=/^[a-z][a-z0-9+\-_.]*:/i,n=/^https?:\/\//i,i=/^https:\/\//i,r=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,o=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},s=function(e,t){var n=a;if(!t)return e;if(!u(e))return e;d(e)&&(n=l),h(e)&&(n=c);var i=n(t),r="/"!==i.charAt(i.length-1)&&"/"!==e.charAt(0)?"/":"";return[i,e].join(r)};function a(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function l(e){var t=e.match(r);return t?t[1]:""}function c(e){var n=e.match(t);return n?n[0]:""}function u(e){return!t.test(e)}function d(e){return u(e)&&"/"===e.charAt(0)}function h(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=o}catch(e){}finally{e=e||s}}(),{parseBaseUrl:a,parseOrigin:l,parseScheme:c,isRelative:u,isPathAbsolute:d,isSchemeRelative:h,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return i.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,n){return e(t,n)}}}r.__dashjs_factory_name="DefaultURLUtils",t.Z=i.Z.getSingletonFactory(r)},8260:function(e,t,n){"use strict";var i=n(2839),r=n(5448);function o(){var e;function t(t){var i=[];if(!t||!e||"function"!=typeof e.fetchAll)return i;for(var r,o=e.fetchAll(t),s=0,a=o.length;s<a;s++)(r=n(o[s]))&&i.push(r);return i}function n(e){if(!e)return null;var t=new i.Z(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?n(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var n=t(e.boxes[e.boxes.length-1].type);return n.length>0?n[n.length-1]:null}}}o.__dashjs_factory_name="IsoFile",t.Z=r.Z.getClassFactory(o)},7473:function(e,t,n){"use strict";n.d(t,{k:function(){return r}});var i=n(5448);function r(e,t){var n={url:e.url,method:e.method,headers:Object.assign({},e.headers),credentials:e.withCredentials?"include":void 0,range:e.request.range};return Promise.resolve(t.modifyRequest(n)).then((function(){return Object.assign(e,n,{withCredentials:"include"===n.credentials})}))}function o(){return{modifyRequest:null,modifyRequestURL:function(e){return e},modifyRequestHeader:function(e,t){return t.url,e}}}o.__dashjs_factory_name="RequestModifier",t.Z=i.Z.getSingletonFactory(o)},3106:function(e,t,n){"use strict";n.d(t,{PS:function(){return o},SE:function(){return s}});var i=n(3393);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(r(e)!==t)throw i.Z.BAD_ARGUMENT_ERROR}function s(e){if(null===e||isNaN(e)||e%1!=0)throw i.Z.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},2594:function(e,t,n){"use strict";var i=n(5448),r=n(5);function o(){var e,t=[],n=this.context;function i(n,i,r){var o=function(n){var i;for(i=0;i<t.length;i++)if(t[i].regex.test(n))return t[i].utils;return e}(r||i);return o&&"function"==typeof o[n]?o[n](i,r):e[n](i,r)}return e=(0,r.Z)(n).getInstance(),{registerUrlRegex:function(e,n){t.push({regex:e,utils:n})},parseBaseUrl:function(e){return i("parseBaseUrl",e)},parseOrigin:function(e){return i("parseOrigin",e)},parseScheme:function(e){return i("parseScheme",e)},isRelative:function(e){return i("isRelative",e)},isPathAbsolute:function(e){return i("isPathAbsolute",e)},isSchemeRelative:function(e){return i("isSchemeRelative",e)},isHTTPURL:function(e){return i("isHTTPURL",e)},isHTTPS:function(e){return i("isHTTPS",e)},removeHostname:function(e){return i("removeHostname",e)},resolve:function(e,t){return i("resolve",e,t)}}}o.__dashjs_factory_name="URLUtils";var s=i.Z.getSingletonFactory(o);t.Z=s},5459:function(e,t){"use strict";t.Z=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=i||null}},3186:function(e,t,n){"use strict";var i=n(7855),r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var t;return(t=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===i.w.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?i.w.INIT_SEGMENT_TYPE:i.w.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();r.ACTION_DOWNLOAD="download",r.ACTION_COMPLETE="complete",t.Z=r},2839:function(e,t){"use strict";var n=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var i=0;i<t.references.length;i++){var r={reference_type:t.references[i].reference_type,referenced_size:t.references[i].referenced_size,subsegment_duration:t.references[i].subsegment_duration};this.references.push(r)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,s=t.samples.length;o<s;o++){var a={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(a)}}break;case"prft":this.version=t.version,this.reference_track_ID=t.reference_track_ID,this.ntp_timestamp_sec=t.ntp_timestamp_sec,this.ntp_timestamp_frac=t.ntp_timestamp_frac,this.media_time=t.media_time,this.flags=t.flags}}var t;return(t=[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();t.Z=n},9597:function(e,t){"use strict";t.Z=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=n,this.size=i}},2128:function(e,t){"use strict";t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},7855:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{O:function(){return o},w:function(){return r}});var r=function e(){i(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},o=function e(){i(this,e),this.s=null,this.d=null,this.b=[]};r.GET="GET",r.HEAD="HEAD",r.MPD_TYPE="MPD",r.XLINK_EXPANSION_TYPE="XLinkExpansion",r.INIT_SEGMENT_TYPE="InitializationSegment",r.INDEX_SEGMENT_TYPE="IndexSegment",r.MEDIA_SEGMENT_TYPE="MediaSegment",r.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",r.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",r.DVB_REPORTING_TYPE="DVBReporting",r.LICENSE="license",r.CONTENT_STEERING_TYPE="ContentSteering",r.OTHER_TYPE="other"},3039:function(e,t){"use strict";function n(e,t){return function(n,r){for(var o,s,a,l=i(n,"tag"),c=i(null==r?"*":r,"range"),u=[],d=-1;++d<c.length;)if(o=c[d].toLowerCase(),t||"*"!==o){for(s=-1,a=[];++s<l.length;)if(e(l[s].toLowerCase(),o)){if(!t)return l[s];u.push(l[s])}else a.push(l[s]);l=a}return t?u:void 0}}function i(e,t){var n=e&&"string"==typeof e?[e]:e;if(!n||"object"!=typeof n||!("length"in n))throw new Error("Invalid "+t+" `"+n+"`, expected non-empty string");return n}t.basicFilter=n((function(e,t){return"*"===t||e===t||e.indexOf(t+"-")>-1}),!0),t.extendedFilter=n((function(e,t){var n=e.split("-"),i=t.split("-"),r=0,o=0;if("*"!==i[o]&&n[r]!==i[o])return!1;for(r++,o++;o<i.length;)if("*"!==i[o]){if(!n[r])return!1;if(n[r]!==i[o]){if(1===n[r].length)return!1;r++}else r++,o++}else o++;return!0}),!0),t.lookup=n((function(e,t){for(var n,i=t;;){if("*"===i||e===i)return!0;if((n=i.lastIndexOf("-"))<0)return!1;"-"===i.charAt(n-2)&&(n-=2),i=i.slice(0,n)}}))},3973:function(e,t,n){"use strict";e.exports=n(3854)},3854:function(e,t,n){"use strict";var i=n(2415),r=n(3039),o=n(7778),s=n(5813),a=n(3165),l=n(9460);e.exports=function(e,t){var n,u=t||{},m=i.parse(String(e||"").toLowerCase(),u),b=i.stringify(m),y=-1;if(!b)return b;for(;++y<o.length;)r.extendedFilter(b,o[y].from).length&&(h(m,o[y].from,o[y].to),b=i.stringify(m));for(y=-1;++y<s.length;)p(m,s[y].from.field,s[y].from.value)&&f(m,s[y].to.field,s[y].to.value);for(b=i.stringify(Object.assign({},m,d)),y=-1;++y<a.length;)b===a[y]&&(h(m,a[y],a[y].split("-").slice(0,-1).join("-")),b=i.stringify(Object.assign({},m,d)));if(m.extensions.sort(g),u.warning)for(n in l)c.call(l[n],m[n])&&u.warning("Deprecated "+n+" `"+m[n]+"`, expected one of `"+l[n][m[n]].join("`, `")+"`",null,7);return m.script&&(m.script=m.script.charAt(0).toUpperCase()+m.script.slice(1)),m.region&&(m.region=m.region.toUpperCase()),i.stringify(m)};var c={}.hasOwnProperty,u=new Intl.Collator,d={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function h(e,t,n){var r,o=i.parse(t),s=i.parse(n),a=[];for(r in o)o[r]&&o[r].length&&p(e,r,o[r])&&a.push(r);for(r in s)s[r]&&s[r].length&&(a.indexOf(r)>-1||!e[r]||!e[r].length)&&f(e,r,s[r])}function p(e,t,n){var i,r,o,s,a=!1;if(n){if(r=i=e[t],i&&"object"==typeof i)for(r=[],o=-1;++o<i.length;)s=i[o],n.indexOf(s)<0?r.push(s):a=!0;else i===n&&(r=null,a=!0);e[t]=r}return a}function f(e,t,n){var i,r,o,s=e[t];if(s&&"object"==typeof s)for(i=[].concat(n),r=-1;++r<i.length;)o=i[r],s.indexOf(o)<0&&s.push(o);else e[t]=n}function g(e,t){return u.compare(e.singleton,t.singleton)}},2415:function(e,t,n){"use strict";t.parse=n(6903),t.stringify=n(6713)},6903:function(e,t,n){"use strict";var i=n(2219),r=n(3516),o=n(395),s=n(858),a=n(8589);e.exports=function e(t,n){var c,u,d,h=n||{},p={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},f=String(t),g=f.toLowerCase(),m=0;if(null==t)throw new Error("Expected string, got `"+t+"`");if(l.call(a,g))return(null==h.normalize||h.normalize)&&a[g]?e(a[g]):(p[-1===s.indexOf(g)?"irregular":"regular"]=f,p);for(;r(g.charCodeAt(m))&&m<9;)m++;if(m>1&&m<9){if(p.language=f.slice(0,m),m<4)for(u=0;45===g.charCodeAt(m)&&r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&r(g.charCodeAt(m+3))&&!r(g.charCodeAt(m+4));){if(u>2)return b(m,3,"Too many extended language subtags, expected at most 3 subtags");p.extendedLanguageSubtags.push(f.slice(m+1,m+4)),m+=4,u++}for(45===g.charCodeAt(m)&&r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&r(g.charCodeAt(m+3))&&r(g.charCodeAt(m+4))&&!r(g.charCodeAt(m+5))&&(p.script=f.slice(m+1,m+5),m+=5),45===g.charCodeAt(m)&&(r(g.charCodeAt(m+1))&&r(g.charCodeAt(m+2))&&!r(g.charCodeAt(m+3))?(p.region=f.slice(m+1,m+3),m+=3):o(g.charCodeAt(m+1))&&o(g.charCodeAt(m+2))&&o(g.charCodeAt(m+3))&&!o(g.charCodeAt(m+4))&&(p.region=f.slice(m+1,m+4),m+=4));45===g.charCodeAt(m);){for(d=c=m+1;i(g.charCodeAt(d));){if(d-c>7)return b(d,1,"Too long variant, expected at most 8 characters");d++}if(!(d-c>4||d-c>3&&o(g.charCodeAt(c))))break;p.variants.push(f.slice(c,d)),m=d}for(;45===g.charCodeAt(m)&&120!==g.charCodeAt(m+1)&&i(g.charCodeAt(m+1))&&45===g.charCodeAt(m+2)&&i(g.charCodeAt(m+3));){for(d=m+2,u=0;45===g.charCodeAt(d)&&i(g.charCodeAt(d+1))&&i(g.charCodeAt(d+2));)for(d=(c=d+1)+2,u++;i(g.charCodeAt(d));){if(d-c>7)return b(d,2,"Too long extension, expected at most 8 characters");d++}if(!u)return b(d,4,"Empty extension, extensions must have at least 2 characters of content");p.extensions.push({singleton:f.charAt(m+1),extensions:f.slice(m+3,d).split("-")}),m=d}}else m=0;if(0===m&&120===g.charCodeAt(m)||45===g.charCodeAt(m)&&120===g.charCodeAt(m+1))for(d=m=m?m+2:1;45===g.charCodeAt(d)&&i(g.charCodeAt(d+1));){for(d=c=m+1;i(g.charCodeAt(d));){if(d-c>7)return b(d,5,"Too long private-use area, expected at most 8 characters");d++}p.privateuse.push(f.slice(m+1,d)),m=d}return m!==f.length?b(m,6,"Found superfluous content after tag"):p;function b(e,t,n){return h.warning&&h.warning(n,t,e),h.forgiving?p:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var l={}.hasOwnProperty},6713:function(e){"use strict";e.exports=function(e){var t,n,i,r=e||{},o=[];if(r.irregular||r.regular)return r.irregular||r.regular;if(r.language)for(o=o.concat(r.language,r.extendedLanguageSubtags||[],r.script||[],r.region||[],r.variants||[]),t=r.extensions||[],n=-1;++n<t.length;)(i=t[n]).singleton&&i.extensions&&i.extensions.length&&(o=o.concat(i.singleton,i.extensions));return r.privateuse&&r.privateuse.length&&(o=o.concat("x",r.privateuse)),o.join("-")}},1549:function(e,t,n){"use strict";var i=n(6693),r=n(2165),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|g(e,t),i=a(n),r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if($(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if($(e,ArrayBuffer)||e&&$(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&($(e,SharedArrayBuffer)||e&&$(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return l.from(i,t,n);var r=function(e){if(l.isBuffer(e)){var t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||U(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return u(e),a(e<0?0:0|f(e))}function h(e){for(var t=e.length<0?0:0|f(e.length),n=a(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,l.prototype),i}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||$(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(r)return i?-1:B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function b(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),U(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var o,s=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var u=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){for(var d=!0,h=0;h<l;h++)if(c(e,o+h)!==c(t,h)){d=!1;break}if(d)return o}return-1}function v(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(t.substr(2*s,2),16);if(U(a))return s;e[n+s]=a}return s}function _(e,t,n,i){return F(B(t,e.length-n),e,n,i)}function E(e,t,n,i){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function T(e,t,n,i){return F(j(t),e,n,i)}function x(e,t,n,i){return F(function(e,t){for(var n,i,r,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function w(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,s,a,l,c=e[r],u=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=d}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=S));return n}(i)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),$(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if($(o,Uint8Array))r+o.length>i.length?l.from(o).copy(i,r):Uint8Array.prototype.set.call(i,o,r);else{if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r)}r+=o.length}return i},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,n,i,r){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(i,r),u=e.slice(t,n),d=0;d<a;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function I(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=H[e[o]];return r}function O(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length-1;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,i,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function D(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,i,o){return t=+t,n>>>=0,o||D(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function M(e,t,n,i,o){return t=+t,n>>>=0,o||D(e,0,n,8),r.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,l.prototype),i},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return M(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return M(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var r=e.charCodeAt(0);("utf8"===i&&r<128||"latin1"===i)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=l.isBuffer(e)?e:l.from(e,i),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var P=/[^+/0-9A-Za-z-_]/g;function B(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],s=0;s<i;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function $(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function U(e){return e!=e}var H=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)t[i+r]=e[n]+e[r];return t}()},6693:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,o=l(e),s=o[0],a=o[1],c=new r(3*(s+a)/4-a),u=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],s=16383,a=0,l=i-r;a<l;a+=s)o.push(c(e,a,a+s>l?l:a+s));return 1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,i){for(var r,o,s=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=r)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},2165:function(e,t){t.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=h,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*l-1)*Math.pow(2,r),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*g}},6934:function(e,t){var n={parseBuffer:function(e){return new i(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(r.prototype._boxProcessors[e]=t)},createFile:function(){return new i},createBox:function(e,t,n){var i=r.create(e);return t&&t.append(i,n),i},createFullBox:function(e,t,i){var r=n.createBox(e,t,i);return r.version=0,r.flags=0,r},Utils:{}};n.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var i=[],r=0;if("utf-8"===n)for(;r<e.byteLength;){var o=e.getUint8(r++);o<128||(o<224?(o=(31&o)<<6,o|=63&e.getUint8(r++)):o<240?(o=(15&o)<<12,o|=(63&e.getUint8(r++))<<6,o|=63&e.getUint8(r++)):(o=(7&o)<<18,o|=(63&e.getUint8(r++))<<12,o|=(63&e.getUint8(r++))<<6,o|=63&e.getUint8(r++))),i.push(String.fromCharCode(o))}else for(;r<e.byteLength;)i.push(String.fromCharCode(e.getUint8(r++)));return i.join("")},n.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?(t.push(192|i>>6),t.push(128|63&i)):i<65536?(t.push(224|i>>12),t.push(128|63&i>>6),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|63&i>>12),t.push(128|63&i>>6),t.push(128|63&i))}return t},n.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var i,r=-1;if("number"==typeof n)r=n;else{if("string"==typeof n)i=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);i=n.type}for(var o=0;o<e.boxes.length;o++)if(i===e.boxes[o].type){r=o+1;break}}e.boxes.splice(r,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var i=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};i.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},i.prototype.fetchAll=function(e,t){var n=[];return i._sweep.call(this,e,n,t),n},i.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=r.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},i._sweep=function(e,t,n){for(var r in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;i._sweep.call(this.boxes[r],e,t,n)}},i.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var r=function(){this._cursor=new n.Cursor};r.parse=function(e){var t=new r;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},r.create=function(e){var t=new r;return t.type=e,t.boxes=[],t},r.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],r.prototype._boxProcessors={},r.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},r.prototype._procFieldArray=function(e,t,n,i){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e][r]=this._readField(n,i);else for(r=0;r<this[e].length;r++)this._writeField(n,i,this[e][r])},r.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},r.prototype._procEntries=function(e,t,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e].push({}),n.call(this,this[e][i]);else for(i=0;i<t;i++)n.call(this,this[e][i])},r.prototype._procSubEntries=function(e,t,n,i){var r;if(this._parsing)for(e[t]=[],r=0;r<n;r++)e[t].push({}),i.call(this,e[t][r]);else for(r=0;r<n;r++)i.call(this,e[t][r])},r.prototype._procEntryField=function(e,t,n,i){this._parsing?e[t]=this._readField(n,i):this._writeField(n,i,e[t])},r.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(r.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},r.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},r.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var i=this._raw.getInt32(n),r=this._raw.getInt32(n+4);t=i*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,t},r.prototype._readUint=function(e){var t,n,i=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:i=this._raw.getUint8(r);break;case 16:i=this._raw.getUint16(r);break;case 24:i=((t=this._raw.getUint16(r))<<8)+(n=this._raw.getUint8(r+2));break;case 32:i=this._raw.getUint32(r);break;case 64:t=this._raw.getUint32(r),n=this._raw.getUint32(r+4),i=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,i},r.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var i=this._readUint(8);t+=String.fromCharCode(i)}return t},r.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},r.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},r.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},r.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?n.Utils.dataViewToString(t):t},r.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},r.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},r.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(r.parse(this))},r.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},r.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},r.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},r.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var i=Math.floor(t/Math.pow(2,32)),r=t-i*Math.pow(2,32);this._rawo.setUint32(n,i),this._rawo.setUint32(n+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},r.prototype._writeUint=function(e,t){if(this._rawo){var n,i,r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(r,t);break;case 16:this._rawo.setUint16(r,t);break;case 24:n=(16776960&t)>>8,i=255&t,this._rawo.setUint16(r,n),this._rawo.setUint8(r+2,i);break;case 32:this._rawo.setUint32(r,t);break;case 64:i=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},r.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},r.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},r.prototype._writeTemplate=function(e,t){var n=Math.floor(t),i=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,i)},r.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},r.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var i=new DataView(this._rawo.buffer,this._cursor.offset,t.length),r=0;r<t.length;r++)i.setUint8(r,t[r]);else this.size+=t.length},r.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},r.prototype._boxProcessors.avc1=r.prototype._boxProcessors.avc2=r.prototype._boxProcessors.avc3=r.prototype._boxProcessors.avc4=r.prototype._boxProcessors.hvc1=r.prototype._boxProcessors.hev1=r.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},r.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_offset",1===this.version?"int":"uint",32)}))},r.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},r.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},r.prototype._boxProcessors.free=r.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},r.prototype._boxProcessors.ftyp=r.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},r.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},r.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},r.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},r.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},r.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},r.prototype._boxProcessors.mp4a=r.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},r.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},r.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},r.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",1==this.version?64:32)},r.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},r.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},r.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},r.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},r.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},r.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},r.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},r.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_delta","uint",32)}))},r.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},r.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},r.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},r.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},r.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},r.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},r.prototype._boxProcessors["url "]=r.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},r.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},r.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},r.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},r.prototype._boxProcessors.vtte=function(){}},5530:function(e,t,n){"use strict";e.exports=n(6146).polyfill()},6146:function(t,n,i){t.exports=function(){"use strict";function t(e){return"function"==typeof e}var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,o=void 0,s=void 0,a=function(e,t){f[r]=e,f[r+1]=t,2===(r+=2)&&(s?s(g):_())},l="undefined"!=typeof window?window:void 0,c=l||{},u=c.MutationObserver||c.WebKitMutationObserver,d="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var e=setTimeout;return function(){return e(g,1)}}var f=new Array(1e3);function g(){for(var e=0;e<r;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;r=0}var m,b,y,v,_=void 0;function E(e,t){var n=this,i=new this.constructor(w);void 0===i[x]&&M(i);var r=n._state;if(r){var o=arguments[r-1];a((function(){return D(r,i,o,n._result)}))}else N(n,i,e,t);return i}function T(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(w);return C(t,e),t}_=d?function(){return e.nextTick(g)}:u?(b=0,y=new u(g),v=document.createTextNode(""),y.observe(v,{characterData:!0}),function(){v.data=b=++b%2}):h?((m=new MessageChannel).port1.onmessage=g,function(){return m.port2.postMessage(0)}):void 0===l?function(){try{var e=Function("return this")().require("vertx");return void 0!==(o=e.runOnLoop||e.runOnContext)?function(){o(g)}:p()}catch(e){return p()}}():p();var x=Math.random().toString(36).substring(2);function w(){}var k=void 0;function S(e,n,i){n.constructor===e.constructor&&i===E&&n.constructor.resolve===T?function(e,t){1===t._state?I(e,t._result):2===t._state?O(e,t._result):N(t,void 0,(function(t){return C(e,t)}),(function(t){return O(e,t)}))}(e,n):void 0===i?I(e,n):t(i)?function(e,t,n){a((function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,(function(n){i||(i=!0,t!==n?C(e,n):I(e,n))}),(function(t){i||(i=!0,O(e,t))}),e._label);!i&&r&&(i=!0,O(e,r))}),e)}(e,n,i):I(e,n)}function C(e,t){if(e===t)O(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=t),null===i||"object"!==r&&"function"!==r)I(e,t);else{var n=void 0;try{n=t.then}catch(t){return void O(e,t)}S(e,t,n)}var i,r}function A(e){e._onerror&&e._onerror(e._result),R(e)}function I(e,t){e._state===k&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(R,e))}function O(e,t){e._state===k&&(e._state=2,e._result=t,a(A,e))}function N(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+1]=n,r[o+2]=i,0===o&&e._state&&a(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,s=0;s<t.length;s+=3)i=t[s],r=t[s+n],i?D(n,i,r,o):r(o);e._subscribers.length=0}}function D(e,n,i,r){var o=t(i),s=void 0,a=void 0,l=!0;if(o){try{s=i(r)}catch(e){l=!1,a=e}if(n===s)return void O(n,new TypeError("A promises callback cannot return that same promise."))}else s=r;n._state!==k||(o&&l?C(n,s):!1===l?O(n,a):1===e?I(n,s):2===e&&O(n,s))}var L=0;function M(e){e[x]=L++,e._state=void 0,e._result=void 0,e._subscribers=[]}var P=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(w),this.promise[x]||M(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&I(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===k&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===T){var r=void 0,o=void 0,s=!1;try{r=e.then}catch(e){s=!0,o=e}if(r===E&&e._state!==k)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===B){var a=new n(w);s?O(a,o):S(a,e,r),this._willSettleAt(a,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===k&&(this._remaining--,2===e?O(i,n):this._result[t]=n),0===this._remaining&&I(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;N(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},e}(),B=function(){function e(t){this[x]=L++,this._result=this._state=void 0,this._subscribers=[],w!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){C(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var n=this,i=n.constructor;return t(e)?n.then((function(t){return i.resolve(e()).then((function(){return t}))}),(function(t){return i.resolve(e()).then((function(){throw t}))})):n.then(e,e)},e}();return B.prototype.then=E,B.all=function(e){return new P(this,e).promise},B.race=function(e){var t=this;return n(e)?new t((function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},B.resolve=T,B.reject=function(e){var t=new this(w);return O(t,e),t},B._setScheduler=function(e){s=e},B._setAsap=function(e){a=e},B._asap=a,B.polyfill=function(){var e=void 0;if(void 0!==i.g)e=i.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=B},B.Promise=B,B}()},1159:function(e){"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}f(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,r)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function f(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,u=p(l,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3101:function(e){"use strict";var t=Array.isArray,n=Object.keys,i=Object.prototype.hasOwnProperty;e.exports=function e(r,o){if(r===o)return!0;if(r&&o&&"object"==typeof r&&"object"==typeof o){var s,a,l,c=t(r),u=t(o);if(c&&u){if((a=r.length)!=o.length)return!1;for(s=a;0!=s--;)if(!e(r[s],o[s]))return!1;return!0}if(c!=u)return!1;var d=r instanceof Date,h=o instanceof Date;if(d!=h)return!1;if(d&&h)return r.getTime()==o.getTime();var p=r instanceof RegExp,f=o instanceof RegExp;if(p!=f)return!1;if(p&&f)return r.toString()==o.toString();var g=n(r);if((a=g.length)!==n(o).length)return!1;for(s=a;0!=s--;)if(!i.call(o,g[s]))return!1;for(s=a;0!=s--;)if(!e(r[l=g[s]],o[l]))return!1;return!0}return r!=r&&o!=o}},3362:function(e,t,n){!function(e,t,n,i,r){function o(e,t,n,i){var r=i&&"seq"===i.timeContainer,s=0;i&&(s=r&&n?n.end:i.begin),t.begin=t.explicit_begin?t.explicit_begin+s:s;var a=t.begin,l=null;if("sets"in t)for(var c=0;c<t.sets.length;c++)o(e,t.sets[c],l,t),a="seq"===t.timeContainer?t.sets[c].end:Math.max(a,t.sets[c].end),l=t.sets[c];if("contents"in t){if("contents"in t)for(var u=0;u<t.contents.length;u++)o(e,t.contents[u],l,t),a="seq"===t.timeContainer?t.contents[u].end:Math.max(a,t.contents[u].end),l=t.contents[u]}else a=r?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,s+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=s+t.explicit_end:t.end=a,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function s(e){this.node=e}function a(){this.events=[],this.head=new l,this.body=null}function l(){this.styling=new c,this.layout=new h}function c(){this.styles={},this.initials={}}function u(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function d(){this.styleAttrs=null}function h(){this.regions={}}function p(e,t){f.call(this,"image"),this.src=e,this.type=t}function f(e){this.kind=e}function g(e){this.id=e}function m(e){this.regionID=e}function b(e){this.styleAttrs=e}function y(e){this.sets=e}function v(e){this.contents=e}function _(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function E(){f.call(this,"body")}function T(){f.call(this,"div")}function x(){f.call(this,"p")}function w(){f.call(this,"span")}function k(){f.call(this,"span")}function S(){f.call(this,"br")}function C(){}function A(){}function I(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function O(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function N(e,t){var n={};if(null!==e)for(var r in e.attributes){var o=e.attributes[r].uri+" "+e.attributes[r].local,s=i.byQName[o];if(void 0!==s){var a=s.parse(e.attributes[r].value);null!==a?(n[o]=a,s===i.byName.zIndex&&B(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):j(t,"Cannot parse styling attribute "+o+" --\x3e "+e.attributes[r].value)}}return n}function R(e,t,n){for(var i in e.attributes)if(e.attributes[i].uri===t&&e.attributes[i].local===n)return e.attributes[i].value;return null}function D(e,t,n){var i,r=null;return null!==(i=/^(\d+(?:\.\d+)?)f$/.exec(n))?null!==t&&(r=parseFloat(i[1])/t):null!==(i=/^(\d+(?:\.\d+)?)t$/.exec(n))?null!==e&&(r=parseFloat(i[1])/e):null!==(i=/^(\d+(?:\.\d+)?)ms$/.exec(n))?r=parseFloat(i[1])/1e3:null!==(i=/^(\d+(?:\.\d+)?)s$/.exec(n))?r=parseFloat(i[1]):null!==(i=/^(\d+(?:\.\d+)?)h$/.exec(n))?r=3600*parseFloat(i[1]):null!==(i=/^(\d+(?:\.\d+)?)m$/.exec(n))?r=60*parseFloat(i[1]):null!==(i=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(n))?r=3600*parseInt(i[1])+60*parseInt(i[2])+parseFloat(i[3]):null!==(i=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(n))&&null!==t&&(r=3600*parseInt(i[1])+60*parseInt(i[2])+parseInt(i[3])+(null===i[4]?0:parseInt(i[4])/t)),r}function L(e,t,n){for(;t.styleRefs.length>0;){var i=t.styleRefs.pop();i in e.styles?(L(e,e.styles[i],n),P(e.styles[i].styleAttrs,t.styleAttrs)):j(n,"Non-existant style id referenced")}}function M(e,t,n,i){for(var r=t.length-1;r>=0;r--){var o=t[r];o in e.styles?P(e.styles[o].styleAttrs,n):j(i,"Non-existant style id referenced")}}function P(e,t){for(var n in e)e.hasOwnProperty(n)&&(n in t||(t[n]=e[n]))}function B(e,t){if(e&&e.warn&&e.warn(t))throw t}function j(e,t){if(e&&e.error&&e.error(t))throw t}function F(e,t){throw e&&e.fatal&&e.fatal(t),t}function $(e,t){for(var n,i=0,r=e.length-1;i<=r;){var o=e[n=Math.floor((i+r)/2)];if(o<t)i=n+1;else{if(!(o>t))return{found:!0,index:n};r=n-1}}return{found:!1,index:i}}e.fromXML=function(e,r,f){var g=t.parser(!0,{xmlns:!0}),m=[],b=[],y=[],v=0,_=null;g.onclosetag=function(e){if(m[0]instanceof C)null!==_.head&&null!==_.head.styling&&M(_.head.styling,m[0].styleRefs,m[0].styleAttrs,r),delete m[0].styleRefs;else if(m[0]instanceof c)for(var t in m[0].styles)m[0].styles.hasOwnProperty(t)&&L(m[0],m[0].styles[t],r);else if(m[0]instanceof x||m[0]instanceof w){if(m[0].contents.length>1){var i,o=[m[0].contents[0]];for(i=1;i<m[0].contents.length;i++)m[0].contents[i]instanceof k&&o[o.length-1]instanceof k?o[o.length-1].text+=m[0].contents[i].text:o.push(m[0].contents[i]);m[0].contents=o}m[0]instanceof w&&1===m[0].contents.length&&m[0].contents[0]instanceof k&&(m[0].text=m[0].contents[0].text,delete m[0].contents)}else m[0]instanceof s&&(m[0].node.uri===n.ns_tt&&"metadata"===m[0].node.local?v--:v>0&&f&&"onCloseTag"in f&&f.onCloseTag());y.shift(),b.shift(),m.shift()},g.ontext=function(e){if(void 0===m[0]);else if(m[0]instanceof w||m[0]instanceof x){if(m[0]instanceof w){var t=m[0].styleAttrs[i.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var n=new k;n.initFromText(_,m[0],e,b[0],y[0],r),m[0].contents.push(n)}else m[0]instanceof s&&v>0&&f&&"onText"in f&&f.onText(e)},g.onopentag=function(e){var t=e.attributes["xml:space"];t?y.unshift(t.value):0===y.length?y.unshift("default"):y.unshift(y[0]);var o=e.attributes["xml:lang"];if(o?b.unshift(o.value):0===b.length?b.unshift(""):b.unshift(b[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==_&&F(r,"Two <tt> elements at ("+this.line+","+this.column+")"),(_=new a).initFromNode(e,b[0],r),m.unshift(_);else if("head"===e.local)m[0]instanceof a||F(r,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),m.unshift(_.head);else if("styling"===e.local)m[0]instanceof l||F(r,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),m.unshift(_.head.styling);else if("style"===e.local){var g;m[0]instanceof c?((g=new u).initFromNode(e,r),g.id?_.head.styling.styles[g.id]=g:j(r,"<style> element missing @id attribute"),m.unshift(g)):m[0]instanceof C?((g=new u).initFromNode(e,r),P(g.styleAttrs,m[0].styleAttrs),m.unshift(g)):F(r,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var k;if(m[0]instanceof c){for(var I in(k=new d).initFromNode(e,r),k.styleAttrs)k.styleAttrs.hasOwnProperty(I)&&(_.head.styling.initials[I]=k.styleAttrs[I]);m.unshift(k)}else F(r,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)m[0]instanceof l||F(r,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),m.unshift(_.head.layout);else if("region"===e.local){m[0]instanceof h||F(r,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var O=new C;O.initFromNode(_,e,b[0],r),!O.id||O.id in _.head.layout.regions?j(r,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):_.head.layout.regions[O.id]=O,m.unshift(O)}else if("body"===e.local){m[0]instanceof a||F(r,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==_.body&&F(r,"Second <body> element at "+this.line+","+this.column+")");var N=new E;N.initFromNode(_,e,b[0],r),_.body=N,m.unshift(N)}else if("div"===e.local){m[0]instanceof T||m[0]instanceof E||F(r,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var R=new T;R.initFromNode(_,m[0],e,b[0],r);var D=R.styleAttrs[i.byName.backgroundImage.qname];D&&(R.contents.push(new p(D)),delete R.styleAttrs[i.byName.backgroundImage.qname]),m[0].contents.push(R),m.unshift(R)}else if("image"===e.local){m[0]instanceof T||F(r,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var L=new p;L.initFromNode(_,m[0],e,b[0],r),m[0].contents.push(L),m.unshift(L)}else if("p"===e.local){m[0]instanceof T||F(r,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var M=new x;M.initFromNode(_,m[0],e,b[0],r),m[0].contents.push(M),m.unshift(M)}else if("span"===e.local){m[0]instanceof w||m[0]instanceof x||F(r,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var B=new w;B.initFromNode(_,m[0],e,b[0],y[0],r),m[0].contents.push(B),m.unshift(B)}else if("br"===e.local){m[0]instanceof w||m[0]instanceof x||F(r,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var $=new S;$.initFromNode(_,m[0],e,b[0],r),m[0].contents.push($),m.unshift($)}else if("set"===e.local){m[0]instanceof w||m[0]instanceof x||m[0]instanceof T||m[0]instanceof E||m[0]instanceof C||m[0]instanceof S||F(r,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var U=new A;U.initFromNode(_,m[0],e,r),m[0].sets.push(U),m.unshift(U)}else m.unshift(new s(e));else m.unshift(new s(e));if(m[0]instanceof s)if(e.uri===n.ns_tt&&"metadata"===e.local)v++;else if(v>0&&f&&"onOpenTag"in f){var H=[];for(var G in e.attributes)H[e.attributes[G].uri+" "+e.attributes[G].local]={uri:e.attributes[G].uri,local:e.attributes[G].local,value:e.attributes[G].value};f.onOpenTag(e.uri,e.local,H)}},g.write(e).close(),delete _.head.styling.styles;var I=!1;for(var O in _.head.layout.regions)if(_.head.layout.regions.hasOwnProperty(O)){I=!0;break}if(!I){var N=C.prototype.createDefaultRegion(_.lang);_.head.layout.regions[N.id]=N}for(var R in _.head.layout.regions)_.head.layout.regions.hasOwnProperty(R)&&o(_,_.head.layout.regions[R],null,null);return _.body&&o(_,_.body,null,null),_.body&&function e(t){if("contents"in t)for(var n=("styleAttrs"in t?t.styleAttrs[i.byName.ruby.qname]:null),r="span"===t.kind&&("container"===n||"textContainer"===n||"baseContainer"===n),o=t.contents.length-1;o>=0;o--)!r||"styleAttrs"in t.contents[o]&&i.byName.ruby.qname in t.contents[o].styleAttrs?e(t.contents[o]):delete t.contents[o]}(_.body),_},a.prototype.initFromNode=function(e,t,i){var o=function(e,t){var i=R(e,n.ns_ttp,"cellResolution"),r=15,o=32;if(null!==i){var s=/(\d+) (\d+)/.exec(i);null!==s?(o=parseInt(s[1]),r=parseInt(s[2])):B(t,"Malformed cellResolution value (using initial value instead)")}return{w:o,h:r}}(e,i);this.cellLength={h:new r.ComputedLength(0,1/o.h),w:new r.ComputedLength(1/o.w,0)};var s=function(e,t){var i,r=R(e,n.ns_ttp,"frameRate"),o=30;null!==r&&(null!==(i=/(\d+)/.exec(r))?o=parseInt(i[1]):B(t,"Malformed frame rate attribute (using initial value instead)"));var s=R(e,n.ns_ttp,"frameRateMultiplier"),a=1;null!==s&&(null!==(i=/(\d+) (\d+)/.exec(s))?a=parseInt(i[1])/parseInt(i[2]):B(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=a*o,c=1,u=R(e,n.ns_ttp,"tickRate");return null===u?null!==r&&(c=l):null!==(i=/(\d+)/.exec(u))?c=parseInt(i[1]):B(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:c}}(e,i);this.effectiveFrameRate=s.effectiveFrameRate,this.tickRate=s.tickRate,this.aspectRatio=function(e,t){var i=R(e,n.ns_ittp,"aspectRatio");null===i&&(i=R(e,n.ns_ttp,"displayAspectRatio"));var r=null;if(null!==i){var o=/(\d+)\s+(\d+)/.exec(i);if(null!==o){var s=parseInt(o[1]),a=parseInt(o[2]);0!==s&&0!==a?r=s/a:j(t,"Illegal aspectRatio values (ignoring)")}else j(t,"Malformed aspectRatio attribute (ignoring)")}return r}(e,i);var a=R(e,n.ns_ttp,"timeBase");null!==a&&"media"!==a&&F(i,"Unsupported time base");var l=function(e,t){var i=R(e,n.ns_tts,"extent");if(null===i)return null;var o=i.split(" ");if(2!==o.length)return B(t,"Malformed extent (ignoring)"),null;var s=r.parseLength(o[0]),a=r.parseLength(o[1]);return a&&s?{h:a,w:s}:(B(t,"Malformed extent values (ignoring)"),null)}(e,i);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||F(i,"Extent on TT must be in px or absent"),this.pxLength={h:new r.ComputedLength(0,1/l.h.value),w:new r.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new r.ComputedLength(0,1),w:new r.ComputedLength(1,0)},this.lang=t},a.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=$(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=$(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},a.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},a.prototype.getMediaTimeEvents=function(){return this.events},u.prototype.initFromNode=function(e,t){this.id=I(e),this.styleAttrs=N(e,t),this.styleRefs=O(e)},d.prototype.initFromNode=function(e,t){for(var i in this.styleAttrs={},e.attributes)if(e.attributes[i].uri===n.ns_itts||e.attributes[i].uri===n.ns_ebutts||e.attributes[i].uri===n.ns_tts){var r=e.attributes[i].uri+" "+e.attributes[i].local;this.styleAttrs[r]=e.attributes[i].value}},p.prototype.initFromNode=function(e,t,n,i,r){this.src="src"in n.attributes?n.attributes.src.value:null,this.src||j(r,"Invalid image@src attribute"),this.type="type"in n.attributes?n.attributes.type.value:null,this.type||j(r,"Invalid image@type attribute"),b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},g.prototype.initFromNode=function(e,t,n,i){this.id=I(n)},m.prototype.initFromNode=function(e,t,n,i){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(n)},b.prototype.initFromNode=function(e,t,n,i){this.styleAttrs=N(n,i),null!==e.head&&null!==e.head.styling&&M(e.head.styling,O(n),this.styleAttrs,i)},y.prototype.initFromNode=function(e,t,n,i){this.sets=[]},v.prototype.initFromNode=function(e,t,n,i){this.contents=[]},_.prototype.initFromNode=function(e,t,n,i){var r=function(e,t,n,i){var r=null;n&&"begin"in n.attributes&&null===(r=D(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value))&&B(i,"Malformed begin value "+n.attributes.begin.value+" (using 0)");var o=null;n&&"dur"in n.attributes&&null===(o=D(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value))&&B(i,"Malformed dur value "+n.attributes.dur.value+" (ignoring)");var s=null;return n&&"end"in n.attributes&&null===(s=D(e.tickRate,e.effectiveFrameRate,n.attributes.end.value))&&B(i,"Malformed end value (ignoring)"),{explicit_begin:r,explicit_end:s,explicit_dur:o}}(e,0,n,i);this.explicit_begin=r.explicit_begin,this.explicit_end=r.explicit_end,this.explicit_dur=r.explicit_dur,this.timeContainer=function(e,t){var n=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return n&&"par"!==n?"seq"===n?"seq":(j(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(n,i)},E.prototype.initFromNode=function(e,t,n,i){b.prototype.initFromNode.call(this,e,null,t,i),_.prototype.initFromNode.call(this,e,null,t,i),y.prototype.initFromNode.call(this,e,null,t,i),m.prototype.initFromNode.call(this,e,null,t,i),v.prototype.initFromNode.call(this,e,null,t,i),this.lang=n},T.prototype.initFromNode=function(e,t,n,i,r){b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},x.prototype.initFromNode=function(e,t,n,i,r){b.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),v.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},w.prototype.initFromNode=function(e,t,n,i,r,o){b.prototype.initFromNode.call(this,e,t,n,o),_.prototype.initFromNode.call(this,e,t,n,o),y.prototype.initFromNode.call(this,e,t,n,o),m.prototype.initFromNode.call(this,e,t,n,o),v.prototype.initFromNode.call(this,e,t,n,o),this.space=r,this.lang=i},k.prototype.initFromText=function(e,t,n,i,r,o){_.prototype.initFromNode.call(this,e,t,null,o),this.text=n,this.space=r,this.lang=i},S.prototype.initFromNode=function(e,t,n,i,r){m.prototype.initFromNode.call(this,e,t,n,r),_.prototype.initFromNode.call(this,e,t,n,r),this.lang=i},C.prototype.createDefaultRegion=function(e){var t=new C;return g.call(t,""),b.call(t,{}),y.call(t,[]),_.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},C.prototype.initFromNode=function(e,t,n,i){g.prototype.initFromNode.call(this,e,null,t,i),_.prototype.initFromNode.call(this,e,null,t,i),y.prototype.initFromNode.call(this,e,null,t,i),this.styleAttrs=N(t,i),this.styleRefs=O(t),this.lang=n},A.prototype.initFromNode=function(e,t,n,i){_.prototype.initFromNode.call(this,e,t,n,i);var r=N(n,i);for(var o in this.qname=null,this.value=null,r)if(r.hasOwnProperty(o)){if(this.qname){j(i,"More than one style specified on set");break}this.qname=o,this.value=r[o]}}}(t,"undefined"==typeof sax?n(5378):sax,"undefined"==typeof imscNames?n(210):imscNames,"undefined"==typeof imscStyles?n(6811):imscStyles,"undefined"==typeof imscUtils?n(5926):imscUtils)},506:function(e,t,n){var i=/firefox/i.test(navigator.userAgent);!function(e,t,n){function r(e,t,d,p){var f;if("region"===d.kind)(f=document.createElement("div")).style.position="absolute";else if("body"===d.kind)f=document.createElement("div");else if("div"===d.kind)f=document.createElement("div");else if("image"===d.kind){if(f=document.createElement("img"),null!==e.imgResolver&&null!==d.src){var b=e.imgResolver(d.src,f);b&&(f.src=b),f.height=e.regionH,f.width=e.regionW}}else if("p"===d.kind)f=document.createElement("p");else if("span"===d.kind)if("container"===d.styleAttrs[n.byName.ruby.qname])f=document.createElement("ruby"),e.ruby=!0;else if("base"===d.styleAttrs[n.byName.ruby.qname])f=document.createElement("span");else if("text"===d.styleAttrs[n.byName.ruby.qname])f=document.createElement("rt");else if("baseContainer"===d.styleAttrs[n.byName.ruby.qname])f=document.createElement("rbc");else if("textContainer"===d.styleAttrs[n.byName.ruby.qname])f=document.createElement("rtc");else{if("delimiter"===d.styleAttrs[n.byName.ruby.qname])return;f=document.createElement("span")}else"br"===d.kind&&(f=document.createElement("br"));if(f){if(d.lang&&("region"!==d.kind&&d.lang===p.lang||(f.lang=d.lang)),t.appendChild(f),f.style.margin="0","region"===d.kind){var _=d.styleAttrs[n.byName.writingMode.qname];"lrtb"===_||"lr"===_?(e.ipd="lr",e.bpd="tb"):"rltb"===_||"rl"===_?(e.ipd="rl",e.bpd="tb"):"tblr"===_?(e.ipd="tb",e.bpd="lr"):"tbrl"!==_&&"tb"!==_||(e.ipd="tb",e.bpd="rl")}else if("p"===d.kind&&"tb"===e.bpd){var E=d.styleAttrs[n.byName.direction.qname];e.ipd="ltr"===E?"lr":"rl"}for(var T=0;T<h.length;T++){var x=h[T],w=d.styleAttrs[x.qname];void 0!==w&&null!==x.map&&x.map(e,f,d,w)}var k=f,S=d.styleAttrs[n.byName.linePadding.qname];if(S&&!S.isZero()){var C=S.toUsedLength(e.w,e.h);if(C>0){var A=Math.ceil(C)+"px";"tb"===e.bpd?(k.style.paddingLeft=A,k.style.paddingRight=A):(k.style.paddingTop=A,k.style.paddingBottom=A),e.lp=S}}var I=d.styleAttrs[n.byName.multiRowAlign.qname];if(I&&"auto"!==I){var O=document.createElement("span");O.style.display="inline-block",O.style.textAlign=I,f.appendChild(O),k=O,e.mra=I}var N=d.styleAttrs[n.byName.rubyReserve.qname];if(N&&"none"!==N[0]&&(e.rubyReserve=N),d.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===d.kind&&d.text){var R=d.styleAttrs[n.byName.textEmphasis.qname];if(R&&"none"!==R.style&&(e.textEmphasis=!0),n.byName.textCombine.qname in d.styleAttrs&&"all"===d.styleAttrs[n.byName.textCombine.qname])f.textContent=d.text,f._isd_element=d,R&&u(e,f,0,R);else for(var D="",L=0;L<d.text.length;L++){D+=d.text.charAt(L);var M=d.text.charCodeAt(L);if(M<55296||M>56319||L===d.text.length-1){var P=document.createElement("span");P.textContent=D,R&&u(e,P,0,R),f.appendChild(P),D="",P._isd_element=d}}}if("contents"in d)for(var B=0;B<d.contents.length;B++)r(e,k,d.contents[B],d);var j=[];if("p"===d.kind&&(c(e,k,j,null),e.rubyReserve&&(function(e,t){for(var n=0;n<e.length;n++){var i,r,o=document.createElement("ruby"),s=document.createElement("span");s.textContent="",o.appendChild(s);var a,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length?((i=document.createElement("rtc")).style[m]=g?"after":"under",i.textContent="",i.style.fontSize=l,(r=document.createElement("rtc")).style[m]=g?"before":"over",r.textContent="",r.style.fontSize=l,o.appendChild(i),o.appendChild(r)):((i=document.createElement("rtc")).textContent="",i.style.fontSize=l,a="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&n>0?g?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":g?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",i.style[m]=a,o.appendChild(i));for(var c=null,u=0;u<e[n].rbc.length;u++)if("ruby"===e[n].rbc[u].localName){c=e[n].rbc[u];for(var d=0;d<c.style.length;d++)o.style.setProperty(c.style.item(d),c.style.getPropertyValue(c.style.item(d)));break}(c=c||e[n].elements[0].node).parentElement.insertBefore(o,c)}}(j,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].rbc.length;i++){var r;e[n].rbc[i].style[m]||(r=g?0===n?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===n?"over":"under":0===n?"under":"over",e[n].rbc[i].style[m]=r)}}(j,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].te.length;i++){var r;e[n].te[i].style[y]&&"none"!==e[n].te[i].style[y]||(r="tb"===t.bpd?0===n?"left over":"left under":"rl"===t.bpd?0===n?"right under":"left under":0===n?"left under":"right under",e[n].te[i].style[y]=r)}}(j,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var i=document.createElement("br"),r=e[t].elements[n-1].node;r.parentElement.insertBefore(i,r.nextSibling)}}}(j),e.mra=null),e.lp&&(function(e,t,n){if(null!==e)for(var r=0;r<e.length;r++){var o=e[r].elements.length,s=Math.ceil(t)+"px",a="-"+Math.ceil(t)+"px";if(0!==o){var l=e[r].elements[e[r].start_elem],c=e[r].elements[e[r].end_elem];if(l===c){var u=l.node.getBoundingClientRect();if(0==u.width||0==u.height)continue}"lr"===n.ipd?(l.node.style.marginLeft=a,l.node.style.paddingLeft=s):"rl"===n.ipd?(l.node.style.paddingRight=s,l.node.style.marginRight=a):"tb"===n.ipd&&(l.node.style.paddingTop=s,l.node.style.marginTop=a),"lr"===n.ipd?(i||(c.node.style.marginRight=a),c.node.style.paddingRight=s):"rl"===n.ipd?(c.node.style.paddingLeft=s,i||(c.node.style.marginLeft=a)):"tb"===n.ipd&&(c.node.style.paddingBottom=s,c.node.style.marginBottom=a)}}}(j,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n],r=1;r<i.elements.length;){var a=i.elements[r-1],l=i.elements[r];s(a.node,l.node,t)?i.elements.splice(r,1):r++}for(var c,u,d=[],h=0;h<e.length;h++)for(var p=0;p<e[h].elements.length;p++)(u=o(c=e[h].elements[p].node,d,!1))&&(c.style.backgroundColor=u);for(var f=0;f<d.length;f++)d[f].style.backgroundColor=""}(j,e),e.flg)){var F=l(k.getBoundingClientRect(),e);!function(e,t,n,i,r){for(var o=Math.sign(n-t),s=0;s<=e.length;s++){var a,l,c,u;if(a=0===s?Math.round(t):s===e.length?Math.round(n):Math.round((e[s-1].after+e[s].before)/2),s>0&&e[s-1])for(c=0;c<e[s-1].elements.length;c++)l=o*(a-(u=e[s-1].elements[c]).after)+"px","lr"===i.bpd?u.node.style.paddingRight=l:"rl"===i.bpd?u.node.style.paddingLeft=l:"tb"===i.bpd&&(u.node.style.paddingBottom=l);if(s<e.length)for(c=0;c<e[s].elements.length;c++)l=o*((u=e[s].elements[c]).before-a)+"px","lr"===i.bpd?u.node.style.paddingLeft=l:"rl"===i.bpd?u.node.style.paddingRight=l:"tb"===i.bpd&&(u.node.style.paddingTop=l)}}(j,F.before,F.after,e),e.flg=null}if("region"===d.kind&&"tb"===e.bpd&&e.enableRollUp&&d.contents.length>0&&"after"===d.styleAttrs[n.byName.displayAlign.qname]){c(e,k,j,null);var $=new a(""===d.id?"_":d.id,j);if(e.currentISDState[$.id]=$,e.previousISDState&&$.id in e.previousISDState&&e.previousISDState[$.id].plist.length>0&&$.plist.length>1&&$.plist[$.plist.length-2].text===e.previousISDState[$.id].plist[e.previousISDState[$.id].plist.length-1].text){var U=f.firstElementChild,H=$.plist[$.plist.length-1].after-$.plist[$.plist.length-1].before;U.style.bottom="-"+H+"px",U.style.transition="transform 0.4s",U.style.position="relative",U.style.transform="translateY(-"+H+"px)"}}}else v(e.errorHandler,"Error processing ISD element kind: "+d.kind)}function o(e,t,n){return e.style.backgroundColor?(n&&!t.includes(e)&&t.push(e),e.style.backgroundColor):"SPAN"===e.parentElement.nodeName||"RUBY"===e.parentElement.nodeName||"RBC"===e.parentElement.nodeName||"RTC"===e.parentElement.nodeName||"RT"===e.parentElement.nodeName?o(e.parentElement,t,!0):void 0}function s(e,t,n){if("SPAN"===e.tagName&&"SPAN"===t.tagName&&e._isd_element===t._isd_element){if(!e._isd_element)return v(n.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;e.textContent+=t.textContent;for(var i=0;i<t.style.length;i++){var r=t.style[i];(r.indexOf("border")>=0||r.indexOf("padding")>=0||r.indexOf("margin")>=0)&&(e.style[r]=t.style[r])}return t.parentElement.removeChild(t),!0}return!1}function a(e,t){this.id=e,this.plist=t}function l(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function c(e,t,n,i){if("rt"!==t.localName&&"rtc"!==t.localName){var r,o,s,a,u=t.style.backgroundColor||i;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var d=l(t.getBoundingClientRect(),e);if(0!==n.length&&(r=d.before,o=d.after,s=n[n.length-1].before,o<(a=n[n.length-1].after)&&r>s||a<=o&&s>=r)){var h=Math.sign(d.after-d.before),p=Math.sign(d.end-d.start);h*(d.before-n[n.length-1].before)<0&&(n[n.length-1].before=d.before),h*(d.after-n[n.length-1].after)>0&&(n[n.length-1].after=d.after),p*(d.start-n[n.length-1].start)<0&&(n[n.length-1].start=d.start,n[n.length-1].start_elem=n[n.length-1].elements.length),p*(d.end-n[n.length-1].end)>0&&(n[n.length-1].end=d.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:d.before,after:d.after,start:d.start,end:d.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:u,before:d.before,after:d.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var f=t.firstChild;f;)f.nodeType===Node.ELEMENT_NODE&&(c(e,f,n,u),"ruby"===f.localName||"rtc"===f.localName?n.length>0&&n[n.length-1].rbc.push(f):"span"===f.localName&&f.style[b]&&"none"!==f.style[b]&&n.length>0&&n[n.length-1].te.push(f)),f=f.nextSibling}}function u(e,t,n,i){var r;"none"!==i.style&&("auto"===i.style?t.style[b]="filled":t.style[b]=i.style+" "+i.symbol,("before"===i.position||"after"===i.position)&&(r="tb"===e.bpd?"before"===i.position?"left over":"left under":"rl"===e.bpd?"before"===i.position?"right under":"left under":"before"===i.position?"left under":"right under",t.style[y]=r))}function d(e,t){this.qname=e,this.map=t}e.render=function(e,t,n,i,o,s,a,l,c){var u=i||t.clientHeight,d=o||t.clientWidth;if(null!==e.aspectRatio){var h=u*e.aspectRatio;h>d?u=Math.round(d/e.aspectRatio):d=h}var p=document.createElement("div");p.style.position="relative",p.style.width=d+"px",p.style.height=u+"px",p.style.margin="auto",p.style.top=0,p.style.bottom=0,p.style.left=0,p.style.right=0,p.style.zIndex=0;var f={h:u,w:d,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:s||!1,isd:e,errorHandler:a,previousISDState:l,enableRollUp:c||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(t.appendChild(p),"contents"in e)for(var g=0;g<e.contents.length;g++)r(f,p,e.contents[g],e);return f.currentISDState};for(var h=[new d("http://www.w3.org/ns/ttml#styling backgroundColor",(function(e,t,n,i){0!==i[3]&&(t.style.backgroundColor="rgba("+i[0].toString()+","+i[1].toString()+","+i[2].toString()+","+(i[3]/255).toString()+")")})),new d("http://www.w3.org/ns/ttml#styling color",(function(e,t,n,i){t.style.color="rgba("+i[0].toString()+","+i[1].toString()+","+i[2].toString()+","+(i[3]/255).toString()+")"})),new d("http://www.w3.org/ns/ttml#styling direction",(function(e,t,n,i){t.style.direction=i})),new d("http://www.w3.org/ns/ttml#styling display",(function(e,t,n,i){})),new d("http://www.w3.org/ns/ttml#styling displayAlign",(function(e,t,n,i){t.style.display="flex",t.style.flexDirection="column","before"===i?t.style.justifyContent="flex-start":"center"===i?t.style.justifyContent="center":"after"===i&&(t.style.justifyContent="flex-end")})),new d("http://www.w3.org/ns/ttml#styling extent",(function(e,t,n,i){e.regionH=i.h.toUsedLength(e.w,e.h),e.regionW=i.w.toUsedLength(e.w,e.h);var r=0,o=0,s=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];s&&(r=s[0].toUsedLength(e.w,e.h)+s[2].toUsedLength(e.w,e.h),o=s[1].toUsedLength(e.w,e.h)+s[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-r+"px",t.style.width=e.regionW-o+"px"})),new d("http://www.w3.org/ns/ttml#styling fontFamily",(function(e,t,n,i){for(var r=[],o=0;o<i.length;o++)i[o]=i[o].trim(),"monospaceSerif"===i[o]?(r.push("Courier New"),r.push('"Liberation Mono"'),r.push("Courier"),r.push("monospace")):"proportionalSansSerif"===i[o]?(r.push("Arial"),r.push("Helvetica"),r.push('"Liberation Sans"'),r.push("sans-serif")):"monospace"===i[o]?r.push("monospace"):"sansSerif"===i[o]?r.push("sans-serif"):"serif"===i[o]?r.push("serif"):"monospaceSansSerif"===i[o]?(r.push("Consolas"),r.push("monospace")):"proportionalSerif"===i[o]?r.push("serif"):r.push(i[o]);if(r.length>0){for(var s=[r[0]],a=1;a<r.length;a++)-1==s.indexOf(r[a])&&s.push(r[a]);r=s}t.style.fontFamily=r.join(",")})),new d("http://www.w3.org/ns/ttml#styling shear",(function(e,t,n,i){if(0!==i){var r=-.9*i;"tb"===e.bpd?t.style.transform="skewX("+r+"deg)":t.style.transform="skewY("+r+"deg)"}})),new d("http://www.w3.org/ns/ttml#styling fontSize",(function(e,t,n,i){t.style.fontSize=i.toUsedLength(e.w,e.h)+"px"})),new d("http://www.w3.org/ns/ttml#styling fontStyle",(function(e,t,n,i){t.style.fontStyle=i})),new d("http://www.w3.org/ns/ttml#styling fontWeight",(function(e,t,n,i){t.style.fontWeight=i})),new d("http://www.w3.org/ns/ttml#styling lineHeight",(function(e,t,n,i){t.style.lineHeight="normal"===i?"normal":i.toUsedLength(e.w,e.h)+"px"})),new d("http://www.w3.org/ns/ttml#styling opacity",(function(e,t,n,i){t.style.opacity=i})),new d("http://www.w3.org/ns/ttml#styling origin",(function(e,t,n,i){t.style.top=i.h.toUsedLength(e.w,e.h)+"px",t.style.left=i.w.toUsedLength(e.w,e.h)+"px"})),new d("http://www.w3.org/ns/ttml#styling overflow",(function(e,t,n,i){t.style.overflow=i})),new d("http://www.w3.org/ns/ttml#styling padding",(function(e,t,n,i){var r=[];r[0]=i[0].toUsedLength(e.w,e.h)+"px",r[1]=i[3].toUsedLength(e.w,e.h)+"px",r[2]=i[2].toUsedLength(e.w,e.h)+"px",r[3]=i[1].toUsedLength(e.w,e.h)+"px",t.style.padding=r.join(" ")})),new d("http://www.w3.org/ns/ttml#styling position",(function(e,t,n,i){t.style.top=i.h.toUsedLength(e.w,e.h)+"px",t.style.left=i.w.toUsedLength(e.w,e.h)+"px"})),new d("http://www.w3.org/ns/ttml#styling rubyAlign",(function(e,t,n,i){t.style.rubyAlign="spaceAround"===i?"space-around":"center"})),new d("http://www.w3.org/ns/ttml#styling rubyPosition",(function(e,t,n,i){var r;"before"!==i&&"after"!==i||(r=g?i:"tb"===e.bpd||"rl"===e.bpd?"before"===i?"over":"under":"before"===i?"under":"over",t.parentElement.style[m]=r)})),new d("http://www.w3.org/ns/ttml#styling showBackground",null),new d("http://www.w3.org/ns/ttml#styling textAlign",(function(e,t,n,i){var r;r="start"===i?"rl"===e.ipd?"right":"left":"end"===i?"rl"===e.ipd?"left":"right":i,t.style.textAlign=r})),new d("http://www.w3.org/ns/ttml#styling textDecoration",(function(e,t,n,i){t.style.textDecoration=i.join(" ").replace("lineThrough","line-through")})),new d("http://www.w3.org/ns/ttml#styling textOutline",(function(e,t,n,i){})),new d("http://www.w3.org/ns/ttml#styling textShadow",(function(e,t,i,r){var o=i.styleAttrs[n.byName.textOutline.qname];if("none"===r&&"none"===o)t.style.textShadow="";else{var s=[];if("none"!==o){var a="rgba("+o.color[0].toString()+","+o.color[1].toString()+","+o.color[2].toString()+","+(o.color[3]/255).toString()+")";s.push("1px 1px 1px "+a),s.push("-1px 1px 1px "+a),s.push("1px -1px 1px "+a),s.push("-1px -1px 1px "+a)}if("none"!==r)for(var l=0;l<r.length;l++)s.push(r[l].x_off.toUsedLength(e.w,e.h)+"px "+r[l].y_off.toUsedLength(e.w,e.h)+"px "+r[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+r[l].color[0].toString()+","+r[l].color[1].toString()+","+r[l].color[2].toString()+","+(r[l].color[3]/255).toString()+")");t.style.textShadow=s.join(",")}})),new d("http://www.w3.org/ns/ttml#styling textCombine",(function(e,t,n,i){t.style.textCombineUpright=i})),new d("http://www.w3.org/ns/ttml#styling textEmphasis",(function(e,t,n,i){})),new d("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(e,t,n,i){var r;r="bidiOverride"===i?"bidi-override":i,t.style.unicodeBidi=r})),new d("http://www.w3.org/ns/ttml#styling visibility",(function(e,t,n,i){t.style.visibility=i})),new d("http://www.w3.org/ns/ttml#styling wrapOption",(function(e,t,n,i){"wrap"===i?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"})),new d("http://www.w3.org/ns/ttml#styling writingMode",(function(e,t,n,i){"lrtb"===i||"lr"===i||"rltb"===i||"rl"===i?t.style.writingMode="horizontal-tb":"tblr"===i?t.style.writingMode="vertical-lr":"tbrl"!==i&&"tb"!==i||(t.style.writingMode="vertical-rl")})),new d("http://www.w3.org/ns/ttml#styling zIndex",(function(e,t,n,i){t.style.zIndex=i})),new d("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(e,t,n,i){e.displayForcedOnlyMode&&!1===i&&(t.style.visibility="hidden")}))],p={},f=0;f<h.length;f++)p[h[f].qname]=h[f];var g="webkitRubyPosition"in window.getComputedStyle(document.documentElement),m=g?"webkitRubyPosition":"rubyPosition",b="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",y="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function v(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?n(210):imscNames,"undefined"==typeof imscStyles?n(6811):imscStyles,"undefined"==typeof imscUtils?n(5926):imscUtils)},4080:function(e,t,n){!function(e,t,n,i){e.generateISD=function(e,t,i){var r,a=new s(e),l={},c={},u=e.head.styling.initials[n.byName.showBackground.qname],d=e.head.styling.initials[n.byName.backgroundColor.qname];for(var h in e.head.layout.regions)if(e.head.layout.regions.hasOwnProperty(h)){var p=e.head.layout.regions[h],f=p.styleAttrs[n.byName.showBackground.qname]||u,g=p.styleAttrs[n.byName.backgroundColor.qname]||d;c[p.id]=("always"===f||void 0===f)&&void 0!==g&&!(t<p.begin||t>=p.end)}for(var m in e.body&&e.body.regionID&&(c[e.body.regionID]=!0),r=null!==e.body?function e(t,n){if(n.contents){var i={};for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);return i.contents=[],n.contents.filter((function(e){return!(t<e.begin||t>=e.end)})).forEach((function(n){var r=e(t,n);r.regionID&&(c[r.regionID]=!0),null!==r&&i.contents.push(r)})),i}return n}(t,e.body):null,void 0!==c[""]&&(c[""]=!0),c)if(c[m]){var b=o(e,t,e.head.layout.regions[m],r,null,"",e.head.layout.regions[m],i,l);null!==b&&a.contents.push(b.element)}return a};var r=[n.byName.color.qname,n.byName.textCombine.qname,n.byName.textDecoration.qname,n.byName.textEmphasis.qname,n.byName.textOutline.qname,n.byName.textShadow.qname];function o(e,t,s,c,u,d,h,p,f){if(t<h.begin||t>=h.end)return null;var g="regionID"in h&&""!==h.regionID?h.regionID:d;if(null!==u&&g!==s.id&&(!("contents"in h)||"contents"in h&&0===h.contents.length||""!==g))return null;var m=new a(h);if("sets"in h)for(var b=0;b<h.sets.length;b++)t<h.sets[b].begin||t>=h.sets[b].end||(m.styleAttrs[h.sets[b].qname]=h.sets[b].value);var y={};for(var v in m.styleAttrs)if(m.styleAttrs.hasOwnProperty(v)&&(y[v]=!0,"region"===m.kind&&v===n.byName.writingMode.qname&&!(n.byName.direction.qname in m.styleAttrs))){var _=m.styleAttrs[v];"lrtb"===_||"lr"===_?m.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==_&&"rl"!==_||(m.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==u)for(var E=0;E<n.all.length;E++){var T=n.all[E];if(T.qname===n.byName.textDecoration.qname){var x=u.styleAttrs[T.qname],w=m.styleAttrs[T.qname],k=[];void 0===w?k=x:-1===w.indexOf("none")?((-1===w.indexOf("noUnderline")&&-1!==x.indexOf("underline")||-1!==w.indexOf("underline"))&&k.push("underline"),(-1===w.indexOf("noLineThrough")&&-1!==x.indexOf("lineThrough")||-1!==w.indexOf("lineThrough"))&&k.push("lineThrough"),(-1===w.indexOf("noOverline")&&-1!==x.indexOf("overline")||-1!==w.indexOf("overline"))&&k.push("overline")):k.push("none"),m.styleAttrs[T.qname]=k}else if(T.qname!==n.byName.fontSize.qname||T.qname in m.styleAttrs||"span"!==m.kind||"textContainer"!==m.styleAttrs[n.byName.ruby.qname])if(T.qname!==n.byName.fontSize.qname||T.qname in m.styleAttrs||"span"!==m.kind||"text"!==m.styleAttrs[n.byName.ruby.qname])T.inherit&&T.qname in u.styleAttrs&&!(T.qname in m.styleAttrs)&&(m.styleAttrs[T.qname]=u.styleAttrs[T.qname]);else{var S=u.styleAttrs[n.byName.fontSize.qname];"textContainer"===u.styleAttrs[n.byName.ruby.qname]?m.styleAttrs[T.qname]=S:m.styleAttrs[T.qname]=new i.ComputedLength(.5*S.rw,.5*S.rh)}else{var C=u.styleAttrs[n.byName.fontSize.qname];m.styleAttrs[T.qname]=new i.ComputedLength(.5*C.rw,.5*C.rh)}}for(var A=0;A<n.all.length;A++){var I=n.all[A];if(!(I.qname in m.styleAttrs||I.qname===n.byName.position.qname&&n.byName.origin.qname in m.styleAttrs||I.qname===n.byName.origin.qname&&n.byName.position.qname in m.styleAttrs)){var O=e.head.styling.initials[I.qname]||I.initial;if(null!==O&&("region"===m.kind||!1===I.inherit&&null!==O)){var N=I.parse(O);null!==N?(m.styleAttrs[I.qname]=N,y[I.qname]=!0):l(p,"Invalid initial value for '"+I.qname+"' on element '"+m.kind)}}}for(var R=0;R<n.all.length;R++){var D=n.all[R];if(D.qname in y&&null!==D.compute){var L=D.compute(e,u,m,m.styleAttrs[D.qname],f);null!==L?m.styleAttrs[D.qname]=L:(m.styleAttrs[D.qname]=D.compute(e,u,m,D.parse(D.initial),f),l(p,"Style '"+D.qname+"' on element '"+m.kind+"' cannot be computed"))}}if("none"===m.styleAttrs[n.byName.display.qname])return null;var M=null;null===u?M=null===c?[]:[c]:"contents"in h&&(M=h.contents);for(var P=0;null!==M&&P<M.length;P++){var B=o(e,t,s,c,m,g,M[P],p,f);null!==B&&m.contents.push(B.element)}for(var j in m.styleAttrs)if(m.styleAttrs.hasOwnProperty(j)){var F=!1;if("span"===m.kind){var $=m.styleAttrs[n.byName.ruby.qname];(F=("container"===$||"textContainer"===$||"baseContainer"===$)&&-1!==r.indexOf(j))||(F="container"!==$&&j===n.byName.rubyAlign.qname),F||(F=!("textContainer"===$||"text"===$)&&j===n.byName.rubyPosition.qname)}if(!F){var U=n.byQName[j];"applies"in U&&(F=-1===U.applies.indexOf(m.kind))}F&&delete m.styleAttrs[j]}var H=m.styleAttrs[n.byName.ruby.qname];if("p"===m.kind||"span"===m.kind&&("textContainer"===H||"text"===H)){var G=[];(function e(t,i){if("contents"in t)for(var r=0;r<t.contents.length;r++){var o=t.contents[r],s=o.styleAttrs[n.byName.ruby.qname];("span"!==o.kind||"textContainer"!==s&&"text"!==s)&&("contents"in o?e(o,i):("span"===o.kind&&0!==o.text.length||"br"===o.kind)&&i.push(o))}})(m,G),function(e){for(var t,n=0;n<e.length;)if("br"!==(t=e[n]).kind&&"preserve"!==t.space){var i=t.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(i)&&(0===n||"br"===(r=e[n-1]).kind||/[\r\n\t ]$/.test(r.text))&&(i=i.substring(1)),t.text=i,0===i.length?e.splice(n,1):n++}else n++;var r,o;for(n=0;n<e.length;n++)"br"!==(t=e[n]).kind&&"preserve"!==t.space?/[ ]$/.test(t.text)&&(n===e.length-1||"br"===(o=e[n+1]).kind||"preserve"===o.space&&/^[\r\n]/.test(o.text))&&(t.text=t.text.slice(0,-1)):n++}(G),function e(t){if("br"===t.kind)return!1;if("text"in t)return 0===t.text.length;if("contents"in t){for(var n=t.contents.length;n--;)e(t.contents[n])&&t.contents.splice(n,1);return 0===t.contents.length}}(m)}return"div"===m.kind&&n.byName.backgroundImage.qname in m.styleAttrs||"br"===m.kind||"image"===m.kind||"contents"in m&&m.contents.length>0||"span"===m.kind&&null!==m.text||"region"===m.kind&&"always"===m.styleAttrs[n.byName.showBackground.qname]?{region_id:g,element:m}:null}function s(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function a(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)e.styleAttrs.hasOwnProperty(t)&&(this.styleAttrs[t]=e.styleAttrs[t]);"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function l(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?n(210):imscNames,"undefined"==typeof imscStyles?n(6811):imscStyles,"undefined"==typeof imscUtils?n(5926):imscUtils)},4403:function(e,t,n){t.generateISD=n(4080).generateISD,t.fromXML=n(3362).fromXML,t.renderHTML=n(506).render},210:function(e,t){!function(e){e.ns_tt="http://www.w3.org/ns/ttml",e.ns_tts="http://www.w3.org/ns/ttml#styling",e.ns_ttp="http://www.w3.org/ns/ttml#parameter",e.ns_xml="http://www.w3.org/XML/1998/namespace",e.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",e.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",e.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",e.ns_ebutts="urn:ebu:tt:style"}(t)},6811:function(e,t,n){!function(e,t,n){function i(e,t,n,i,r,o,s,a){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=r,this.animatable=o,this.initial=n,this.applies=i,this.parse=s,this.compute=a}for(var r in e.all=[new i(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new i(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new i(t.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"displayAlign","before",["region"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var i=n.parseLength(t[0]),r=n.parseLength(t[1]);return r&&i?{h:r,w:i}:null}),(function(e,t,i,r,o){var s,a;if("auto"===r)s=new n.ComputedLength(0,1);else if(null===(s=n.toComputedLength(r.h.value,r.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===r)a=new n.ComputedLength(1,0);else if(null===(a=n.toComputedLength(r.w.value,r.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:a}})),new i(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(e){for(var t=e.split(","),n=[],i=0;i<t.length;i++)t[i]=t[i].trim(),"'"!==t[i].charAt(0)&&'"'!==t[i].charAt(0)&&"default"===t[i]?n.push("monospaceSerif"):n.push(t[i]);return n}),null),new i(t.ns_tts,"shear","0%",["p"],!0,!0,n.parseLength,(function(e,t,n,i){return"%"!==i.unit?null:Math.abs(i.value)>100?100*Math.sign(i.value):i.value})),new i(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,n.parseLength,(function(t,i,r,o,s){return n.toComputedLength(o.value,o.unit,null!==i?i.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==i?i.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)})),new i(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(e){return"normal"===e?e:n.parseLength(e)}),(function(t,i,r,o,s){var a;if("normal"===o)a=o;else if(null===(a=n.toComputedLength(o.value,o.unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return a})),new i(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new i(t.ns_tts,"origin","auto",["region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var i=n.parseLength(t[0]),r=n.parseLength(t[1]);return r&&i?{h:r,w:i}:null}),(function(e,t,i,r,o){var s,a;if("auto"===r)s=new n.ComputedLength(0,0);else if(null===(s=n.toComputedLength(r.h.value,r.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===r)a=new n.ComputedLength(0,0);else if(null===(a=n.toComputedLength(r.w.value,r.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:a}})),new i(t.ns_tts,"overflow","hidden",["region"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"padding","0px",["region"],!1,!0,(function(e){var t=e.split(" ");if(t.length>4)return null;for(var i=[],r=0;r<t.length;r++){var o=n.parseLength(t[r]);if(!o)return null;i.push(o)}return i}),(function(t,i,r,o,s){var a;if(1===o.length)a=[o[0],o[0],o[0],o[0]];else if(2===o.length)a=[o[0],o[1],o[0],o[1]];else if(3===o.length)a=[o[0],o[1],o[2],o[1]];else{if(4!==o.length)return null;a=[o[0],o[1],o[2],o[3]]}var l=r.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)a=[a[0],a[3],a[2],a[1]];else if("rltb"===l||"rl"===l)a=[a[0],a[1],a[2],a[3]];else if("tblr"===l)a=[a[3],a[0],a[1],a[2]];else{if("tbrl"!==l&&"tb"!==l)return null;a=[a[3],a[2],a[1],a[0]]}for(var c=[],u=0;u<a.length;u++)if(0===a[u].value)c[u]=new n.ComputedLength(0,0);else if(c[u]=n.toComputedLength(a[u].value,a[u].unit,r.styleAttrs[e.byName.fontSize.qname],0===u||2===u?r.styleAttrs[e.byName.extent.qname].h:r.styleAttrs[e.byName.extent.qname].w,0===u||2===u?t.cellLength.h:t.cellLength.w,0===u||2===u?t.pxLength.h:t.pxLength.w),null===c[u])return null;return c})),new i(t.ns_tts,"position","top left",["region"],!1,!0,(function(e){return n.parsePosition(e)}),(function(t,i,r,o){var s,a;return null===(s=n.toComputedLength(o.v.offset.value,o.v.offset.unit,null,new n.ComputedLength(-r.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-r.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===o.v.edge&&(s=new n.ComputedLength(-s.rw-r.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-s.rh-r.styleAttrs[e.byName.extent.qname].h.rh)),a=n.toComputedLength(o.h.offset.value,o.h.offset.unit,null,new n.ComputedLength(t.dimensions.w.rw-r.styleAttrs[e.byName.extent.qname].w.rw,-r.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===s?null:("right"===o.h.edge&&(a=new n.ComputedLength(t.dimensions.w.rw-a.rw-r.styleAttrs[e.byName.extent.qname].w.rw,-a.rh-r.styleAttrs[e.byName.extent.qname].w.rh)),{h:s,w:a}))})),new i(t.ns_tts,"ruby","none",["span"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(e){return"center"!==e&&"spaceAround"!==e?null:e}),null),new i(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(e){var t=e.split(" "),i=[null,null];if(0===t.length||t.length>2)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(i[0]=t[0],2===t.length&&"none"!==t[0]){var r=n.parseLength(t[1]);if(!r)return null;i[1]=r}return i}),(function(t,i,r,o,s){return"none"===o[0]?o:null===(a=null===o[1]?new n.ComputedLength(.5*r.styleAttrs[e.byName.fontSize.qname].rw,.5*r.styleAttrs[e.byName.fontSize.qname].rh):n.toComputedLength(o[1].value,o[1].unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[o[0],a];var a})),new i(t.ns_tts,"showBackground","always",["region"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"textAlign","start",["p"],!0,!0,(function(e){return e}),(function(e,t,n,i,r){return"left"===i?"start":"right"===i?"end":i})),new i(t.ns_tts,"textCombine","none",["span"],!0,!0,(function(e){return"none"===e||"all"===e?e:null}),null),new i(t.ns_tts,"textDecoration","none",["span"],!0,!0,(function(e){return e.split(" ")}),null),new i(t.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(e){for(var t=e.split(" "),i={style:null,symbol:null,color:null,position:null},r=0;r<t.length;r++)if("none"===t[r]||"auto"===t[r])i.style=t[r];else if("filled"===t[r]||"open"===t[r])i.style=t[r];else if("circle"===t[r]||"dot"===t[r]||"sesame"===t[r])i.symbol=t[r];else if("current"===t[r])i.color=t[r];else if("outside"===t[r]||"before"===t[r]||"after"===t[r])i.position=t[r];else if(i.color=n.parseColor(t[r]),null===i.color)return null;return null==i.style&&null==i.symbol?i.style="auto":(i.symbol=i.symbol||"circle",i.style=i.style||"filled"),i.position=i.position||"outside",i.color=i.color||"current",i}),null),new i(t.ns_tts,"textOutline","none",["span"],!0,!0,(function(e){if("none"===e)return e;var t={},i=e.split(" ");if(0===i.length||i.length>2)return null;var r=n.parseColor(i[0]);if(t.color=r,null!==r&&i.shift(),1!==i.length)return null;var o=n.parseLength(i[0]);return o?(t.thickness=o,t):null}),(function(t,i,r,o,s){if("none"===o)return o;var a={};return null===o.color?a.color=r.styleAttrs[e.byName.color.qname]:a.color=o.color,a.thickness=n.toComputedLength(o.thickness.value,o.thickness.unit,r.styleAttrs[e.byName.fontSize.qname],r.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===a.thickness?null:a})),new i(t.ns_tts,"textShadow","none",["span"],!0,!0,n.parseTextShadow,(function(t,i,r,o){if("none"===o)return o;for(var s=[],a=0;a<o.length;a++){var l={};if(l.x_off=n.toComputedLength(o[a][0].value,o[a][0].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off)return null;if(l.y_off=n.toComputedLength(o[a][1].value,o[a][1].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off)return null;if(null===o[a][2])l.b_radius=0;else if(l.b_radius=n.toComputedLength(o[a][2].value,o[a][2].unit,null,r.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===o[a][3]?l.color=r.styleAttrs[e.byName.color.qname]:l.color=o[a][3],s.push(l)}return s})),new i(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(e){return e}),null),new i(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(e){return e}),null),new i(t.ns_tts,"zIndex","auto",["region"],!1,!0,(function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t}),null),new i(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,(function(e,t,i,r,o){return n.toComputedLength(r.value,r.unit,null,null,e.cellLength.w,null)})),new i(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(e){return e}),null),new i(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(e){return e}),null),new i(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(e){return"true"===e}),null),new i(t.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(e){return"true"===e}),null)],e.byQName={},e.all)e.byQName[e.all[r].qname]=e.all[r];for(var o in e.byName={},e.all)e.byName[e.all[o].name]=e.all[o]}(t,"undefined"==typeof imscNames?n(210):imscNames,"undefined"==typeof imscUtils?n(5926):imscUtils)},5926:function(e,t){!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var o,s=null,a=r[e.toLowerCase()];return void 0!==a?s=a:null!==(o=t.exec(e))?s=[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16),void 0!==o[4]?parseInt(o[4],16):255]:null!==(o=n.exec(e))?s=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),255]:null!==(o=i.exec(e))&&(s=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),parseInt(o[4])]),s};var o=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,n=null;return null!==(t=o.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n},e.parseTextShadow=function(t){for(var n=t.match(/([^\(,\)]|\([^\)]+\))+/g),i=[],r=0;r<n.length;r++){var o=n[r].split(" ");if(1===o.length&&"none"===o[0])return"none";if(o.length>1&&o.length<5){var s=[null,null,null,null],a=e.parseLength(o.shift());if(null===a)return null;if(s[0]=a,null===(a=e.parseLength(o.shift())))return null;if(s[1]=a,0===o.length){i.push(s);continue}if(null!==(a=e.parseLength(o[0]))&&(s[2]=a,o.shift()),0===o.length){i.push(s);continue}var l=e.parseColor(o[0]);if(null===l)return null;s[3]=l,i.push(s)}}return i},e.parsePosition=function(t){var n=t.split(" "),i=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(n.length>4)return null;for(var r=0;r<n.length;r++)if(!i(n[r])){var o=e.parseLength(n[r]);if(null===o)return null;n[r]=o}for(var s={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},a=0;a<n.length;){var l=n[a++];if(i(l)){var c={value:0,unit:"%"};2!==n.length&&a<n.length&&!i(n[a])&&(c=n[a++]),"right"===l?(s.h.edge=l,s.h.offset=c):"bottom"===l?(s.v.edge=l,s.v.offset=c):"left"===l?s.h.offset=c:"top"===l&&(s.v.offset=c)}else{if(1!==n.length&&2!==n.length)return null;1===a?s.h.offset=l:s.v.offset=l}}return s},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,n,i,r,o,s){return"%"===n&&r?new e.ComputedLength(r.rw*t/100,r.rh*t/100):"em"===n&&i?new e.ComputedLength(i.rw*t,i.rh*t):"c"===n&&o?new e.ComputedLength(t*o.rw,t*o.rh):"px"===n&&s?new e.ComputedLength(t*s.rw,t*s.rh):"rh"===n?new e.ComputedLength(0,t/100):"rw"===n?new e.ComputedLength(t/100,0):null}}(t)},3516:function(e){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},2219:function(e,t,n){"use strict";var i=n(3516),r=n(395);e.exports=function(e){return i(e)||r(e)}},395:function(e){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},3875:function(t){"use strict";function n(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function i(e,t){for(var n,i="",r=0,o=-1,s=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(o===a-1||1===s);else if(o!==a-1&&2===s){if(i.length<2||2!==r||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){-1===l?(i="",r=0):r=(i=i.slice(0,l)).length-1-i.lastIndexOf("/"),o=a,s=0;continue}}else if(2===i.length||1===i.length){i="",r=0,o=a,s=0;continue}t&&(i.length>0?i+="/..":i="..",r=2)}else i.length>0?i+="/"+e.slice(o+1,a):i=e.slice(o+1,a),r=a-o-1;o=a,s=0}else 46===n&&-1!==s?++s:s=-1}return i}var r={resolve:function(){for(var t,r="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var a;s>=0?a=arguments[s]:(void 0===t&&(t=e.cwd()),a=t),n(a),0!==a.length&&(r=a+"/"+r,o=47===a.charCodeAt(0))}return r=i(r,!o),o?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(n(e),0===e.length)return".";var t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=i(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return n(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var i=arguments[t];n(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,t){if(n(e),n(t),e===t)return"";if((e=r.resolve(e))===(t=r.resolve(t)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var o=e.length,s=o-i,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var l=t.length-a,c=s<l?s:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===t.charCodeAt(a+d))return t.slice(a+d+1);if(0===d)return t.slice(a+d)}else s>c&&(47===e.charCodeAt(i+d)?u=d:0===d&&(u=0));break}var h=e.charCodeAt(i+d);if(h!==t.charCodeAt(a+d))break;47===h&&(u=d)}var p="";for(d=i+u+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===p.length?p+="..":p+="/..");return p.length>0?p+t.slice(a+u):(a+=u,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(n(e),0===e.length)return".";for(var t=e.charCodeAt(0),i=47===t,r=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!o){r=s;break}}else o=!1;return-1===r?i?"/":".":i&&1===r?"//":e.slice(0,r)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');n(e);var i,r=0,o=-1,s=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(47===c){if(!s){r=i+1;break}}else-1===l&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?-1==--a&&(o=i):(a=-1,o=l))}return r===o?o=l:-1===o&&(o=e.length),e.slice(r,o)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!s){r=i+1;break}}else-1===o&&(s=!1,o=i+1);return-1===o?"":e.slice(r,o)},extname:function(e){n(e);for(var t=-1,i=0,r=-1,o=!0,s=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47!==l)-1===r&&(o=!1,r=a+1),46===l?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1);else if(!o){i=a+1;break}}return-1===t||-1===r||0===s||1===s&&t===r-1&&t===i+1?"":e.slice(t,r)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return n=(t=e).dir||t.root,i=t.base||(t.name||"")+(t.ext||""),n?n===t.root?n+i:n+"/"+i:i;var t,n,i},parse:function(e){n(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var i,r=e.charCodeAt(0),o=47===r;o?(t.root="/",i=1):i=0;for(var s=-1,a=0,l=-1,c=!0,u=e.length-1,d=0;u>=i;--u)if(47!==(r=e.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===r?-1===s?s=u:1!==d&&(d=1):-1!==s&&(d=-1);else if(!c){a=u+1;break}return-1===s||-1===l||0===d||1===d&&s===l-1&&s===a+1?-1!==l&&(t.base=t.name=0===a&&o?e.slice(1,l):e.slice(a,l)):(0===a&&o?(t.name=e.slice(1,s),t.base=e.slice(1,l)):(t.name=e.slice(a,s),t.base=e.slice(a,l)),t.ext=e.slice(s,l)),a>0?t.dir=e.slice(0,a-1):o&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,t.exports=r},8387:function(e,t,n){var i=n(1549),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=s),o(r,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},5378:function(e,t,n){!function(e){e.parser=function(e,t){return new o(e,t)},e.SAXParser=o,e.SAXStream=a,e.createStream=function(e,t){return new a(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function o(t,n){if(!(this instanceof o))return new o(t,n);var i=this;!function(e){for(var t=0,n=r.length;t<n;t++)e[r[t]]=""}(i),i.q=i.c="",i.bufferCheckPosition=e.MAX_BUFFER_LENGTH,i.opt=n||{},i.opt.lowercase=i.opt.lowercase||i.opt.lowercasetags,i.looseCase=i.opt.lowercase?"toLowerCase":"toUpperCase",i.tags=[],i.closed=i.closedRoot=i.sawRoot=!1,i.tag=i.error=null,i.strict=!!t,i.noscript=!(!t&&!i.opt.noscript),i.state=S.BEGIN,i.strictEntities=i.opt.strictEntities,i.ENTITIES=i.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),i.attribList=[],i.opt.xmlns&&(i.ns=Object.create(g)),i.trackPosition=!1!==i.opt.position,i.trackPosition&&(i.position=i.line=i.column=0),A(i,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),o.prototype={end:function(){D(this)},write:function(t){var n=this;if(this.error)throw this.error;if(n.closed)return R(n,"Cannot write after close. Assign an onready handler.");if(null===t)return D(n);"object"==typeof t&&(t=t.toString());for(var i=0,o="";o=H(t,i++),n.c=o,o;)switch(n.trackPosition&&(n.position++,"\n"===o?(n.line++,n.column=0):n.column++),n.state){case S.BEGIN:if(n.state=S.BEGIN_WHITESPACE,"\ufeff"===o)continue;U(n,o);continue;case S.BEGIN_WHITESPACE:U(n,o);continue;case S.TEXT:if(n.sawRoot&&!n.closedRoot){for(var s=i-1;o&&"<"!==o&&"&"!==o;)(o=H(t,i++))&&n.trackPosition&&(n.position++,"\n"===o?(n.line++,n.column=0):n.column++);n.textNode+=t.substring(s,i-1)}"<"!==o||n.sawRoot&&n.closedRoot&&!n.strict?(!T(l,o)||n.sawRoot&&!n.closedRoot||L(n,"Text data outside of root node."),"&"===o?n.state=S.TEXT_ENTITY:n.textNode+=o):(n.state=S.OPEN_WAKA,n.startTagPosition=n.position);continue;case S.SCRIPT:"<"===o?n.state=S.SCRIPT_ENDING:n.script+=o;continue;case S.SCRIPT_ENDING:"/"===o?n.state=S.CLOSE_TAG:(n.script+="<"+o,n.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===o)n.state=S.SGML_DECL,n.sgmlDecl="";else if(E(l,o));else if(E(m,o))n.state=S.OPEN_TAG,n.tagName=o;else if("/"===o)n.state=S.CLOSE_TAG,n.tagName="";else if("?"===o)n.state=S.PROC_INST,n.procInstName=n.procInstBody="";else{if(L(n,"Unencoded <"),n.startTagPosition+1<n.position){var a=n.position-n.startTagPosition;o=new Array(a).join(" ")+o}n.textNode+="<"+o,n.state=S.TEXT}continue;case S.SGML_DECL:"[CDATA["===(n.sgmlDecl+o).toUpperCase()?(I(n,"onopencdata"),n.state=S.CDATA,n.sgmlDecl="",n.cdata=""):n.sgmlDecl+o==="--"?(n.state=S.COMMENT,n.comment="",n.sgmlDecl=""):"DOCTYPE"===(n.sgmlDecl+o).toUpperCase()?(n.state=S.DOCTYPE,(n.doctype||n.sawRoot)&&L(n,"Inappropriately located doctype declaration"),n.doctype="",n.sgmlDecl=""):">"===o?(I(n,"onsgmldeclaration",n.sgmlDecl),n.sgmlDecl="",n.state=S.TEXT):E(d,o)?(n.state=S.SGML_DECL_QUOTED,n.sgmlDecl+=o):n.sgmlDecl+=o;continue;case S.SGML_DECL_QUOTED:o===n.q&&(n.state=S.SGML_DECL,n.q=""),n.sgmlDecl+=o;continue;case S.DOCTYPE:">"===o?(n.state=S.TEXT,I(n,"ondoctype",n.doctype),n.doctype=!0):(n.doctype+=o,"["===o?n.state=S.DOCTYPE_DTD:E(d,o)&&(n.state=S.DOCTYPE_QUOTED,n.q=o));continue;case S.DOCTYPE_QUOTED:n.doctype+=o,o===n.q&&(n.q="",n.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:n.doctype+=o,"]"===o?n.state=S.DOCTYPE:E(d,o)&&(n.state=S.DOCTYPE_DTD_QUOTED,n.q=o);continue;case S.DOCTYPE_DTD_QUOTED:n.doctype+=o,o===n.q&&(n.state=S.DOCTYPE_DTD,n.q="");continue;case S.COMMENT:"-"===o?n.state=S.COMMENT_ENDING:n.comment+=o;continue;case S.COMMENT_ENDING:"-"===o?(n.state=S.COMMENT_ENDED,n.comment=N(n.opt,n.comment),n.comment&&I(n,"oncomment",n.comment),n.comment=""):(n.comment+="-"+o,n.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==o?(L(n,"Malformed comment"),n.comment+="--"+o,n.state=S.COMMENT):n.state=S.TEXT;continue;case S.CDATA:"]"===o?n.state=S.CDATA_ENDING:n.cdata+=o;continue;case S.CDATA_ENDING:"]"===o?n.state=S.CDATA_ENDING_2:(n.cdata+="]"+o,n.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===o?(n.cdata&&I(n,"oncdata",n.cdata),I(n,"onclosecdata"),n.cdata="",n.state=S.TEXT):"]"===o?n.cdata+="]":(n.cdata+="]]"+o,n.state=S.CDATA);continue;case S.PROC_INST:"?"===o?n.state=S.PROC_INST_ENDING:E(l,o)?n.state=S.PROC_INST_BODY:n.procInstName+=o;continue;case S.PROC_INST_BODY:if(!n.procInstBody&&E(l,o))continue;"?"===o?n.state=S.PROC_INST_ENDING:n.procInstBody+=o;continue;case S.PROC_INST_ENDING:">"===o?(I(n,"onprocessinginstruction",{name:n.procInstName,body:n.procInstBody}),n.procInstName=n.procInstBody="",n.state=S.TEXT):(n.procInstBody+="?"+o,n.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:E(b,o)?n.tagName+=o:(M(n),">"===o?j(n):"/"===o?n.state=S.OPEN_TAG_SLASH:(T(l,o)&&L(n,"Invalid character in tag name"),n.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===o?(j(n,!0),F(n)):(L(n,"Forward-slash in opening tag not followed by >"),n.state=S.ATTRIB);continue;case S.ATTRIB:if(E(l,o))continue;">"===o?j(n):"/"===o?n.state=S.OPEN_TAG_SLASH:E(m,o)?(n.attribName=o,n.attribValue="",n.state=S.ATTRIB_NAME):L(n,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===o?n.state=S.ATTRIB_VALUE:">"===o?(L(n,"Attribute without value"),n.attribValue=n.attribName,B(n),j(n)):E(l,o)?n.state=S.ATTRIB_NAME_SAW_WHITE:E(b,o)?n.attribName+=o:L(n,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===o)n.state=S.ATTRIB_VALUE;else{if(E(l,o))continue;L(n,"Attribute without value"),n.tag.attributes[n.attribName]="",n.attribValue="",I(n,"onattribute",{name:n.attribName,value:""}),n.attribName="",">"===o?j(n):E(m,o)?(n.attribName=o,n.state=S.ATTRIB_NAME):(L(n,"Invalid attribute name"),n.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(E(l,o))continue;E(d,o)?(n.q=o,n.state=S.ATTRIB_VALUE_QUOTED):(L(n,"Unquoted attribute value"),n.state=S.ATTRIB_VALUE_UNQUOTED,n.attribValue=o);continue;case S.ATTRIB_VALUE_QUOTED:if(o!==n.q){"&"===o?n.state=S.ATTRIB_VALUE_ENTITY_Q:n.attribValue+=o;continue}B(n),n.q="",n.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:E(l,o)?n.state=S.ATTRIB:">"===o?j(n):"/"===o?n.state=S.OPEN_TAG_SLASH:E(m,o)?(L(n,"No whitespace between attributes"),n.attribName=o,n.attribValue="",n.state=S.ATTRIB_NAME):L(n,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(T(h,o)){"&"===o?n.state=S.ATTRIB_VALUE_ENTITY_U:n.attribValue+=o;continue}B(n),">"===o?j(n):n.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(n.tagName)">"===o?F(n):E(b,o)?n.tagName+=o:n.script?(n.script+="</"+n.tagName,n.tagName="",n.state=S.SCRIPT):(T(l,o)&&L(n,"Invalid tagname in closing tag"),n.state=S.CLOSE_TAG_SAW_WHITE);else{if(E(l,o))continue;T(m,o)?n.script?(n.script+="</"+o,n.state=S.SCRIPT):L(n,"Invalid tagname in closing tag."):n.tagName=o}continue;case S.CLOSE_TAG_SAW_WHITE:if(E(l,o))continue;">"===o?F(n):L(n,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var c,u;switch(n.state){case S.TEXT_ENTITY:c=S.TEXT,u="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:c=S.ATTRIB_VALUE_QUOTED,u="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:c=S.ATTRIB_VALUE_UNQUOTED,u="attribValue"}";"===o?(n[u]+=$(n),n.entity="",n.state=c):E(n.entity.length?v:y,o)?n.entity+=o:(L(n,"Invalid character in entity name"),n[u]+="&"+n.entity+o,n.entity="",n.state=c);continue;default:throw new Error(n,"Unknown state: "+n.state)}return n.position>=n.bufferCheckPosition&&function(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,o=0,s=r.length;o<s;o++){var a=t[r[o]].length;if(a>n)switch(r[o]){case"textNode":O(t);break;case"cdata":I(t,"oncdata",t.cdata),t.cdata="";break;case"script":I(t,"onscript",t.script),t.script="";break;default:R(t,"Max buffer length exceeded: "+r[o])}i=Math.max(i,a)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(n),n},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;O(e=this),""!==e.cdata&&(I(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(I(e,"onscript",e.script),e.script="")}};try{t=n(182).Stream}catch(e){t=function(){}}var s=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function a(e,n){if(!(this instanceof a))return new a(e,n);t.apply(this),this._parser=new o(e,n),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,s.forEach((function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})}))}a.prototype=Object.create(t.prototype,{constructor:{value:a}}),a.prototype.write=function(e){if("function"==typeof i&&"function"==typeof i.isBuffer&&i.isBuffer(e)){if(!this._decoder){var t=n(7503).s;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},a.prototype.on=function(e,n){var i=this;return i._parser["on"+e]||-1===s.indexOf(e)||(i._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),i.emit.apply(i,t)}),t.prototype.on.call(i,e,n)};var l="\r\n\t ",c="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d="'\"",h=l+">",p="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",g={xml:p,xmlns:f};l=_(l),c=_(c),u=_(u);var m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function _(e){return e.split("").reduce((function(e,t){return e[t]=!0,e}),{})}function E(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function T(e,t){return!E(e,t)}d=_(d),h=_(h);var x,w,k,S=0;for(var C in e.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var n=e.ENTITIES[t],i="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=i})),e.STATE)e.STATE[e.STATE[C]]=C;function A(e,t,n){e[t]&&e[t](n)}function I(e,t,n){e.textNode&&O(e),A(e,t,n)}function O(e){e.textNode=N(e.opt,e.textNode),e.textNode&&A(e,"ontext",e.textNode),e.textNode=""}function N(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function R(e,t){return O(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,A(e,"onerror",t),e}function D(e){return e.sawRoot&&!e.closedRoot&&L(e,"Unclosed root tag"),e.state!==S.BEGIN&&e.state!==S.BEGIN_WHITESPACE&&e.state!==S.TEXT&&R(e,"Unexpected end"),O(e),e.c="",e.closed=!0,A(e,"onend"),o.call(e,e.strict,e.opt),e}function L(e,t){if("object"!=typeof e||!(e instanceof o))throw new Error("bad call to strictFail");e.strict&&R(e,t)}function M(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,I(e,"onopentagstart",n)}function P(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),i=n[0],r=n[1];return t&&"xmlns"===e&&(i="xmlns",r=""),{prefix:i,local:r}}function B(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=P(e.attribName,!0),n=t.prefix,i=t.local;if("xmlns"===n)if("xml"===i&&e.attribValue!==p)L(e,"xml: prefix must be bound to "+p+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==f)L(e,"xmlns: prefix must be bound to "+f+"\nActual: "+e.attribValue);else{var r=e.tag,o=e.tags[e.tags.length-1]||e;r.ns===o.ns&&(r.ns=Object.create(o.ns)),r.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,I(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function j(e,t){if(e.opt.xmlns){var n=e.tag,i=P(e.tagName);n.prefix=i.prefix,n.local=i.local,n.uri=n.ns[i.prefix]||"",n.prefix&&!n.uri&&(L(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=i.prefix);var r=e.tags[e.tags.length-1]||e;n.ns&&r.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){I(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var o=0,s=e.attribList.length;o<s;o++){var a=e.attribList[o],l=a[0],c=a[1],u=P(l,!0),d=u.prefix,h=u.local,p=""===d?"":n.ns[d]||"",f={name:l,value:c,prefix:d,local:h,uri:p};d&&"xmlns"!==d&&!p&&(L(e,"Unbound namespace prefix: "+JSON.stringify(d)),f.uri=d),e.tag.attributes[l]=f,I(e,"onattribute",f)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),I(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=S.TEXT:e.state=S.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function F(e){if(!e.tagName)return L(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=S.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=S.SCRIPT);I(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var i=n;t--&&e.tags[t].name!==i;)L(e,"Unexpected close tag");if(t<0)return L(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=S.TEXT);e.tagName=n;for(var r=e.tags.length;r-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,I(e,"onclosetag",e.tagName);var s={};for(var a in o.ns)s[a]=o.ns[a];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==l.ns&&Object.keys(o.ns).forEach((function(t){var n=o.ns[t];I(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=S.TEXT}function $(e){var t,n=e.entity,i=n.toLowerCase(),r="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(n=i).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),r=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),r=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),r.toLowerCase()!==n?(L(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function U(e,t){"<"===t?(e.state=S.OPEN_WAKA,e.startTagPosition=e.position):T(l,t)&&(L(e,"Non-whitespace before first tag."),e.textNode=t,e.state=S.TEXT)}function H(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}S=e.STATE,String.fromCodePoint||(x=String.fromCharCode,w=Math.floor,k=function(){var e,t,n=[],i=-1,r=arguments.length;if(!r)return"";for(var o="";++i<r;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||w(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(i+1===r||n.length>16384)&&(o+=x.apply(null,n),n.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:k,configurable:!0,writable:!0}):String.fromCodePoint=k)}(t)},182:function(e,t,n){e.exports=r;var i=n(1159).EventEmitter;function r(){i.call(this)}n(1765)(r,i),r.Readable=n(2846),r.Writable=n(8318),r.Duplex=n(6138),r.Transform=n(9798),r.PassThrough=n(5472),r.finished=n(8800),r.pipeline=n(7295),r.Stream=r,r.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",l));var s=!1;function a(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",r),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},1765:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},3690:function(e){"use strict";var t={};function n(e,n,i){i||(i=Error);var r=function(e){var t,i;function r(t,i,r){return e.call(this,function(e,t,i){return"string"==typeof n?n:n(e,t,r)}(t,i))||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r}(i);r.prototype.name=i.name,r.prototype.code=e,t[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,o,s,a,l;if("string"==typeof t&&(o="not ",t.substr(0,o.length)===o)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(r," ").concat(i(t,"type"));else{var c=("number"!=typeof l&&(l=0),l+".".length>(a=e).length||-1===a.indexOf(".",l)?"argument":"property");s='The "'.concat(e,'" ').concat(c," ").concat(r," ").concat(i(t,"type"))}return s+". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6138:function(t,n,i){"use strict";var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=u;var o=i(2846),s=i(8318);i(1765)(u,o);for(var a=r(s.prototype),l=0;l<a.length;l++){var c=a[l];u.prototype[c]||(u.prototype[c]=s.prototype[c])}function u(e){if(!(this instanceof u))return new u(e);o.call(this,e),s.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",d)))}function d(){this._writableState.ended||e.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},5472:function(e,t,n){"use strict";e.exports=r;var i=n(9798);function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}n(1765)(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},2846:function(t,n,i){"use strict";var r;t.exports=k,k.ReadableState=w,i(1159).EventEmitter;var o,s=function(e,t){return e.listeners(t).length},a=i(9299),l=i(1549).Buffer,c=i.g.Uint8Array||function(){},u=i(964);o=u&&u.debuglog?u.debuglog("stream"):function(){};var d,h,p,f=i(8393),g=i(6163),m=i(7269).getHighWaterMark,b=i(3690).q,y=b.ERR_INVALID_ARG_TYPE,v=b.ERR_STREAM_PUSH_AFTER_EOF,_=b.ERR_METHOD_NOT_IMPLEMENTED,E=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i(1765)(k,a);var T=g.errorOrDestroy,x=["error","close","destroy","pause","resume"];function w(e,t,n){r=r||i(6138),e=e||{},"boolean"!=typeof n&&(n=t instanceof r),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=m(this,e,"readableHighWaterMark",n),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=i(7503).s),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function k(e){if(r=r||i(6138),!(this instanceof k))return new k(e);var t=this instanceof r;this._readableState=new w(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function S(e,t,n,i,r){o("readableAddChunk",t);var s,a=e._readableState;if(null===t)a.reading=!1,function(e,t){if(o("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,N(e)))}}(e,a);else if(r||(s=function(e,t){var n,i;return i=t,l.isBuffer(i)||i instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t)),n}(a,t)),s)T(e,s);else if(a.objectMode||t&&t.length>0)if("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===l.prototype||(t=function(e){return l.from(e)}(t)),i)a.endEmitted?T(e,new E):C(e,a,t,!0);else if(a.ended)T(e,new v);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!n?(t=a.decoder.write(t),a.objectMode||0!==t.length?C(e,a,t,!1):R(e,a)):C(e,a,t,!1)}else i||(a.reading=!1,R(e,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function C(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&O(e)),R(e,t)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),k.prototype.destroy=g.destroy,k.prototype._undestroy=g.undestroy,k.prototype._destroy=function(e,t){t(e)},k.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=l.from(e,t),t=""),n=!0),S(this,e,t,!1,n)},k.prototype.unshift=function(e){return S(this,e,null,!0,!1)},k.prototype.isPaused=function(){return!1===this._readableState.flowing},k.prototype.setEncoding=function(e){d||(d=i(7503).s);var t=new d(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,r="";null!==n;)r+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var A=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(t){var n=t._readableState;o("emitReadable",n.needReadable,n.emittedReadable),n.needReadable=!1,n.emittedReadable||(o("emitReadable",n.flowing),n.emittedReadable=!0,e.nextTick(N,t))}function N(e){var t=e._readableState;o("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,B(e)}function R(t,n){n.readingMore||(n.readingMore=!0,e.nextTick(D,t,n))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(o("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){o("readable nexttick read 0"),e.read(0)}function P(e,t){o("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(o("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(t){var n=t._readableState;o("endReadable",n.endEmitted),n.endEmitted||(n.ended=!0,e.nextTick($,n,t))}function $(e,t){if(o("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function U(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}k.prototype.read=function(e){o("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return o("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):O(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&F(this),null;var i,r=t.needReadable;return o("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&o("length less than watermark",r=!0),t.ended||t.reading?o("reading or ended",r=!1):r&&(o("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(i=e>0?j(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==i&&this.emit("data",i),i},k.prototype._read=function(e){T(this,new _("_read()"))},k.prototype.pipe=function(t,n){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,o("pipe count=%d opts=%j",r.pipesCount,n);var a=n&&!1===n.end||t===e.stdout||t===e.stderr?g:l;function l(){o("onend"),t.end()}r.endEmitted?e.nextTick(a):i.once("end",a),t.on("unpipe",(function e(n,s){o("onunpipe"),n===i&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,o("cleanup"),t.removeListener("close",p),t.removeListener("finish",f),t.removeListener("drain",c),t.removeListener("error",h),t.removeListener("unpipe",e),i.removeListener("end",l),i.removeListener("end",g),i.removeListener("data",d),u=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||c())}));var c=function(e){return function(){var t=e._readableState;o("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,B(e))}}(i);t.on("drain",c);var u=!1;function d(e){o("ondata");var n=t.write(e);o("dest.write",n),!1===n&&((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==U(r.pipes,t))&&!u&&(o("false write response, pause",r.awaitDrain),r.awaitDrain++),i.pause())}function h(e){o("onerror",e),g(),t.removeListener("error",h),0===s(t,"error")&&T(t,e)}function p(){t.removeListener("finish",f),g()}function f(){o("onfinish"),t.removeListener("close",p),g()}function g(){o("unpipe"),i.unpipe(t)}return i.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(t,"error",h),t.once("close",p),t.once("finish",f),t.emit("pipe",i),r.flowing||(o("pipe resume"),i.resume()),t},k.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=U(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},k.prototype.on=function(t,n){var i=a.prototype.on.call(this,t,n),r=this._readableState;return"data"===t?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===t&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,o("on readable",r.length,r.reading),r.length?O(this):r.reading||e.nextTick(M,this))),i},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(t,n){var i=a.prototype.removeListener.call(this,t,n);return"readable"===t&&e.nextTick(L,this),i},k.prototype.removeAllListeners=function(t){var n=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||e.nextTick(L,this),n},k.prototype.resume=function(){var t=this._readableState;return t.flowing||(o("resume"),t.flowing=!t.readableListening,function(t,n){n.resumeScheduled||(n.resumeScheduled=!0,e.nextTick(P,t,n))}(this,t)),t.paused=!1,this},k.prototype.pause=function(){return o("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(o("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(o("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){o("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var s=0;s<x.length;s++)e.on(x[s],this.emit.bind(this,x[s]));return this._read=function(t){o("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(k.prototype[Symbol.asyncIterator]=function(){return void 0===h&&(h=i(7299)),h(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),k._fromList=j,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(k.from=function(e,t){return void 0===p&&(p=i(6233)),p(k,e,t)})},9798:function(e,t,n){"use strict";e.exports=u;var i=n(3690).q,r=i.ERR_METHOD_NOT_IMPLEMENTED,o=i.ERR_MULTIPLE_CALLBACK,s=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=i.ERR_TRANSFORM_WITH_LENGTH_0,l=n(6138);function c(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(null===i)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush((function(t,n){h(e,t,n)}))}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}n(1765)(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},8318:function(t,n,i){"use strict";function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;for(e.entry=null;i;){var r=i.callback;t.pendingcb--,r(void 0),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=k,k.WritableState=w;var s,a={deprecate:i(7839)},l=i(9299),c=i(1549).Buffer,u=i.g.Uint8Array||function(){},d=i(6163),h=i(7269).getHighWaterMark,p=i(3690).q,f=p.ERR_INVALID_ARG_TYPE,g=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,b=p.ERR_STREAM_CANNOT_PIPE,y=p.ERR_STREAM_DESTROYED,v=p.ERR_STREAM_NULL_VALUES,_=p.ERR_STREAM_WRITE_AFTER_END,E=p.ERR_UNKNOWN_ENCODING,T=d.errorOrDestroy;function x(){}function w(t,n,s){o=o||i(6138),t=t||{},"boolean"!=typeof s&&(s=n instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=h(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,n){var i=t._writableState,r=i.sync,o=i.writecb;if("function"!=typeof o)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),n)!function(t,n,i,r,o){--n.pendingcb,i?(e.nextTick(o,r),e.nextTick(N,t,n),t._writableState.errorEmitted=!0,T(t,r)):(o(r),t._writableState.errorEmitted=!0,T(t,r),N(t,n))}(t,i,r,n,o);else{var s=I(i)||t.destroyed;s||i.corked||i.bufferProcessing||!i.bufferedRequest||A(t,i),r?e.nextTick(C,t,i,s,o):C(t,i,s,o)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function k(e){var t=this instanceof(o=o||i(6138));if(!t&&!s.call(k,this))return new k(e);this._writableState=new w(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function S(e,t,n,i,r,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function C(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),N(e,t)}function A(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,o=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var a=0,l=!0;n;)o[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;o.allBuffers=l,S(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(S(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(n){t.pendingcb--,n&&T(e,n),t.prefinished=!0,e.emit("prefinish"),N(e,t)}))}function N(t,n){var i=I(n);if(i&&(function(t,n){n.prefinished||n.finalCalled||("function"!=typeof t._final||n.destroyed?(n.prefinished=!0,t.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,e.nextTick(O,t,n)))}(t,n),0===n.pendingcb&&(n.finished=!0,t.emit("finish"),n.autoDestroy))){var r=t._readableState;(!r||r.autoDestroy&&r.endEmitted)&&t.destroy()}return i}i(1765)(k,l),w.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(w.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===k&&e&&e._writableState instanceof w}})):s=function(e){return e instanceof this},k.prototype.pipe=function(){T(this,new b)},k.prototype.write=function(t,n,i){var r,o=this._writableState,s=!1,a=!o.objectMode&&(r=t,c.isBuffer(r)||r instanceof u);return a&&!c.isBuffer(t)&&(t=function(e){return c.from(e)}(t)),"function"==typeof n&&(i=n,n=null),a?n="buffer":n||(n=o.defaultEncoding),"function"!=typeof i&&(i=x),o.ending?function(t,n){var i=new _;T(t,i),e.nextTick(n,i)}(this,i):(a||function(t,n,i,r){var o;return null===i?o=new v:"string"==typeof i||n.objectMode||(o=new f("chunk",["string","Buffer"],i)),!o||(T(t,o),e.nextTick(r,o),!1)}(this,o,t,i))&&(o.pendingcb++,s=function(e,t,n,i,r,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,n)),t}(t,i,r);i!==s&&(n=!0,r="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else S(e,t,!1,a,i,r,o);return l}(this,o,a,t,n,i)),s},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||A(this,e))},k.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(e,t,n){n(new g("_write()"))},k.prototype._writev=null,k.prototype.end=function(t,n,i){var r=this._writableState;return"function"==typeof t?(i=t,t=null,n=null):"function"==typeof n&&(i=n,n=null),null!=t&&this.write(t,n),r.corked&&(r.corked=1,this.uncork()),r.ending||function(t,n,i){n.ending=!0,N(t,n),i&&(n.finished?e.nextTick(i):t.once("finish",i)),n.ended=!0,t.writable=!1}(this,r,i),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),k.prototype.destroy=d.destroy,k.prototype._undestroy=d.undestroy,k.prototype._destroy=function(e,t){t(e)}},7299:function(t,n,i){"use strict";var r;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=i(8800),a=Symbol("lastResolve"),l=Symbol("lastReject"),c=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),h=Symbol("handlePromise"),p=Symbol("stream");function f(e,t){return{value:e,done:t}}function g(e){var t=e[a];if(null!==t){var n=e[p].read();null!==n&&(e[d]=null,e[a]=null,e[l]=null,t(f(n,!1)))}}var m=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((o(r={get stream(){return this[p]},next:function(){var t=this,n=this[c];if(null!==n)return Promise.reject(n);if(this[u])return Promise.resolve(f(void 0,!0));if(this[p].destroyed)return new Promise((function(n,i){e.nextTick((function(){t[c]?i(t[c]):n(f(void 0,!0))}))}));var i,r=this[d];if(r)i=new Promise(function(e,t){return function(n,i){e.then((function(){t[u]?n(f(void 0,!0)):t[h](n,i)}),i)}}(r,this));else{var o=this[p].read();if(null!==o)return Promise.resolve(f(o,!1));i=new Promise(this[h])}return this[d]=i,i}},Symbol.asyncIterator,(function(){return this})),o(r,"return",(function(){var e=this;return new Promise((function(t,n){e[p].destroy(null,(function(e){e?n(e):t(f(void 0,!0))}))}))})),r),m);t.exports=function(t){var n,i=Object.create(b,(o(n={},p,{value:t,writable:!0}),o(n,a,{value:null,writable:!0}),o(n,l,{value:null,writable:!0}),o(n,c,{value:null,writable:!0}),o(n,u,{value:t._readableState.endEmitted,writable:!0}),o(n,h,{value:function(e,t){var n=i[p].read();n?(i[d]=null,i[a]=null,i[l]=null,e(f(n,!1))):(i[a]=e,i[l]=t)},writable:!0}),n));return i[d]=null,s(t,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=i[l];return null!==t&&(i[d]=null,i[a]=null,i[l]=null,t(e)),void(i[c]=e)}var n=i[a];null!==n&&(i[d]=null,i[a]=null,i[l]=null,n(f(void 0,!0))),i[u]=!0})),t.on("readable",function(t){e.nextTick(g,t)}.bind(null,i)),i}},8393:function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n(1549).Buffer,s=n(9862).inspect,a=s&&s.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t;return(t=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,n,i,r=o.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=r,i=a,o.prototype.copy.call(t,n,i),a+=s.data.length,s=s.next;return r}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,i=t.data;for(e-=i.length;t=t.next;){var r=t.data,o=e>r.length?r.length:e;if(o===r.length?i+=r:i+=r.slice(0,e),0==(e-=o)){o===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(o));break}++n}return this.length-=n,i}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),n=this.head,i=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,s=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,s),0==(e-=s)){s===r.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(s));break}++i}return this.length-=i,t}},{key:a,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}])&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}()},6163:function(t){"use strict";function n(e,t){r(e,t),i(e)}function i(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(i,s):(s._writableState.errorEmitted=!0,e.nextTick(n,s,t)):e.nextTick(n,s,t):o?(e.nextTick(i,s),o(t)):e.nextTick(i,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,i=e._writableState;n&&n.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}},8800:function(e,t,n){"use strict";var i=n(3690).q.ERR_STREAM_PREMATURE_CLOSE;function r(){}e.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i)}}}(o||r);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){a=!1,c=!0,s||o.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){s=!1,d=!0,a||o.call(t)},p=function(e){o.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new i),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new i),o.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?g():t.on("request",g)):a&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",h),t.on("finish",u),!1!==n.error&&t.on("error",p),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",h),t.removeListener("error",p),t.removeListener("close",f)}}},6233:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},7295:function(e,t,n){"use strict";var i,r=n(3690).q,o=r.ERR_MISSING_ARGS,s=r.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(e,t,r,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;e.on("close",(function(){a=!0})),void 0===i&&(i=n(8800)),i(e,{readable:t,writable:r},(function(e){if(e)return o(e);a=!0,o()}));var l=!1;return function(t){if(!a&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void o(t||new s("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r=function(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var s=t.map((function(e,n){var o=n<t.length-1;return l(e,o,n>0,(function(e){i||(i=e),e&&s.forEach(c),o||(s.forEach(c),r(i))}))}));return t.reduce(u)}},7269:function(e,t,n){"use strict";var i=n(3690).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,r){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new i(r?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},9299:function(e,t,n){e.exports=n(1159).EventEmitter},7503:function(e,t,n){"use strict";var i=n(8387).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=s(t[i]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(e.lastNeed=r-2),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},1067:function(e,t,n){var i;!function(r,o){"use strict";var s="function",a="undefined",l="object",c="string",u="major",d="model",h="name",p="type",f="vendor",g="version",m="architecture",b="console",y="mobile",v="tablet",_="smarttv",E="wearable",T="embedded",x="Amazon",w="Apple",k="ASUS",S="BlackBerry",C="Browser",A="Chrome",I="Firefox",O="Google",N="Huawei",R="LG",D="Microsoft",L="Motorola",M="Opera",P="Samsung",B="Sharp",j="Sony",F="Xiaomi",$="Zebra",U="Facebook",H="Chromium OS",G="Mac OS",V=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},W=function(e,t){return typeof e===c&&-1!==z(t).indexOf(z(e))},z=function(e){return e.toLowerCase()},q=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,500)},Y=function(e,t){for(var n,i,r,a,c,u,d=0;d<t.length&&!c;){var h=t[d],p=t[d+1];for(n=i=0;n<h.length&&!c&&h[n];)if(c=h[n++].exec(e))for(r=0;r<p.length;r++)u=c[++i],typeof(a=p[r])===l&&a.length>0?2===a.length?typeof a[1]==s?this[a[0]]=a[1].call(this,u):this[a[0]]=a[1]:3===a.length?typeof a[1]!==s||a[1].exec&&a[1].test?this[a[0]]=u?u.replace(a[1],a[2]):o:this[a[0]]=u?a[1].call(this,u,a[2]):o:4===a.length&&(this[a[0]]=u?a[3].call(this,u.replace(a[1],a[2])):o):this[a]=u||o;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===l&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(W(t[n][i],e))return"?"===n?o:n}else if(W(t[n],e))return"?"===n?o:n;return e},Z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,M+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[h,M]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[h,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[h,"Smart Lenovo "+C]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+C],g],[/\bfocus\/([\w\.]+)/i],[g,[h,I+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,M+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,M+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI "+C]],[/fxios\/([-\w\.]+)/i],[g,[h,I]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+C]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+C],g],[/samsungbrowser\/([\w\.]+)/i],[g,[h,P+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],g],[/metasr[\/ ]?([\d\.]+)/i],[g,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[h,g],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,U],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,A+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,I+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,g],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,z]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[f,P],[p,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[f,P],[p,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[f,w],[p,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[f,w],[p,v]],[/(macintosh);/i],[d,[f,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[f,B],[p,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[f,N],[p,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[f,N],[p,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[f,F],[p,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[f,F],[p,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[f,"OPPO"],[p,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[f,"Vivo"],[p,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[f,"Realme"],[p,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[f,L],[p,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[f,L],[p,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[f,R],[p,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[f,R],[p,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[f,"Lenovo"],[p,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[f,"Nokia"],[p,y]],[/(pixel c)\b/i],[d,[f,O],[p,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[f,O],[p,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[f,j],[p,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[f,j],[p,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[f,"OnePlus"],[p,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[f,x],[p,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[f,x],[p,y]],[/(playbook);[-\w\),; ]+(rim)/i],[d,f,[p,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[f,S],[p,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[f,k],[p,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[f,k],[p,y]],[/(nexus 9)/i],[d,[f,"HTC"],[p,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[d,/_/g," "],[p,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[f,"Acer"],[p,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[f,"Meizu"],[p,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[f,"Ulefone"],[p,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,d,[p,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,d,[p,v]],[/(surface duo)/i],[d,[f,D],[p,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[f,"Fairphone"],[p,y]],[/(u304aa)/i],[d,[f,"AT&T"],[p,y]],[/\bsie-(\w*)/i],[d,[f,"Siemens"],[p,y]],[/\b(rct\w+) b/i],[d,[f,"RCA"],[p,v]],[/\b(venue[\d ]{2,7}) b/i],[d,[f,"Dell"],[p,v]],[/\b(q(?:mv|ta)\w+) b/i],[d,[f,"Verizon"],[p,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[f,"Barnes & Noble"],[p,v]],[/\b(tm\d{3}\w+) b/i],[d,[f,"NuVision"],[p,v]],[/\b(k88) b/i],[d,[f,"ZTE"],[p,v]],[/\b(nx\d{3}j) b/i],[d,[f,"ZTE"],[p,y]],[/\b(gen\d{3}) b.+49h/i],[d,[f,"Swiss"],[p,y]],[/\b(zur\d{3}) b/i],[d,[f,"Swiss"],[p,v]],[/\b((zeki)?tb.*\b) b/i],[d,[f,"Zeki"],[p,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],d,[p,v]],[/\b(ns-?\w{0,9}) b/i],[d,[f,"Insignia"],[p,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[f,"NextBook"],[p,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],d,[p,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],d,[p,y]],[/\b(ph-1) /i],[d,[f,"Essential"],[p,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[f,"Envizen"],[p,v]],[/\b(trio[-\w\. ]+) b/i],[d,[f,"MachSpeed"],[p,v]],[/\btu_(1491) b/i],[d,[f,"Rotor"],[p,v]],[/(shield[\w ]+) b/i],[d,[f,"Nvidia"],[p,v]],[/(sprint) (\w+)/i],[f,d,[p,y]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[f,D],[p,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[f,$],[p,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[f,$],[p,y]],[/smart-tv.+(samsung)/i],[f,[p,_]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[f,P],[p,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,R],[p,_]],[/(apple) ?tv/i],[f,[d,w+" TV"],[p,_]],[/crkey/i],[[d,A+"cast"],[f,O],[p,_]],[/droid.+aft(\w+)( bui|\))/i],[d,[f,x],[p,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[f,B],[p,_]],[/(bravia[\w ]+)( bui|\))/i],[d,[f,j],[p,_]],[/(mitv-\w{5}) bui/i],[d,[f,F],[p,_]],[/Hbbtv.*(technisat) (.*);/i],[f,d,[p,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,q],[d,q],[p,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,d,[p,b]],[/droid.+; (shield) bui/i],[d,[f,"Nvidia"],[p,b]],[/(playstation [345portablevi]+)/i],[d,[f,j],[p,b]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[f,D],[p,b]],[/((pebble))app/i],[f,d,[p,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[f,w],[p,E]],[/droid.+; (glass) \d/i],[d,[f,O],[p,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[f,$],[p,E]],[/(quest( 2| pro)?)/i],[d,[f,U],[p,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,T]],[/(aeobc)\b/i],[d,[f,x],[p,T]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[p,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[p,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,y]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[g,K,Z]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,K,Z],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,G],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,I+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,H],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,g]]},J=function(e,t){if(typeof e===l&&(t=e,e=o),!(this instanceof J))return new J(e,t).getResult();var n=typeof r!==a&&r.navigator?r.navigator:o,i=e||(n&&n.userAgent?n.userAgent:""),b=n&&n.userAgentData?n.userAgentData:o,_=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(X,t):X,E=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t[h]=o,t[g]=o,Y.call(t,i,_.browser),t[u]=typeof(e=t[g])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:o,E&&n&&n.brave&&typeof n.brave.isBrave==s&&(t[h]="Brave"),t},this.getCPU=function(){var e={};return e[m]=o,Y.call(e,i,_.cpu),e},this.getDevice=function(){var e={};return e[f]=o,e[d]=o,e[p]=o,Y.call(e,i,_.device),E&&!e[p]&&b&&b.mobile&&(e[p]=y),E&&"Macintosh"==e[d]&&n&&typeof n.standalone!==a&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[d]="iPad",e[p]=v),e},this.getEngine=function(){var e={};return e[h]=o,e[g]=o,Y.call(e,i,_.engine),e},this.getOS=function(){var e={};return e[h]=o,e[g]=o,Y.call(e,i,_.os),E&&!e[h]&&b&&"Unknown"!=b.platform&&(e[h]=b.platform.replace(/chrome os/i,H).replace(/macos/i,G)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===c&&e.length>500?q(e,500):e,this},this.setUA(i),this};J.VERSION="1.0.37",J.BROWSER=V([h,g,u]),J.CPU=V([m]),J.DEVICE=V([d,f,p,b,y,_,v,E,T]),J.ENGINE=J.OS=V([h,g]),typeof t!==a?(e.exports&&(t=e.exports=J),t.UAParser=J):n.amdO?(i=function(){return J}.call(t,n,t,e))===o||(e.exports=i):typeof r!==a&&(r.UAParser=J);var Q=typeof r!==a&&(r.jQuery||r.Zepto);if(Q&&!Q.ua){var ee=new J;Q.ua=ee.getResult(),Q.ua.get=function(){return ee.getUA()},Q.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var n in t)Q.ua[n]=t[n]}}}("object"==typeof window?window:this)},7839:function(e,t,n){function i(e){try{if(!n.g.localStorage)return!1}catch(e){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},9862:function(){},964:function(){},3165:function(e){"use strict";e.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},5813:function(e){"use strict";e.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},9460:function(e){"use strict";e.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},7778:function(e){"use strict";e.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},8589:function(e){"use strict";e.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},858:function(e){"use strict";e.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return t[e].call(o.exports,o,o.exports,r),o.exports}r.amdO={},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o={};return function(){"use strict";r.d(o,{default:function(){return u}}),r(8416);var e,t=r(1715),n=r(8080),i=r(1737),s=r(1139),a=function(){var e,t="application/dash+xml";function n(n,i,r){if(!n||!/^VIDEO$/i.test(n.nodeName))return null;if(n._dashjs_player)return n._dashjs_player;var o,a=n.id||n.name||"video element";if(!(i=i||[].slice.call(n.querySelectorAll("source")).filter((function(e){return e.type==t}))[0])&&n.src)(i=document.createElement("source")).src=n.src;else if(!i&&!n.src)return null;return r=r||{},(o=(0,s.Z)(r).create()).initialize(n,i.src,n.autoplay),e||(e=o.getDebug().getLogger()),e.debug("Converted "+a+" to dash.js player and added content: "+i.src),n._dashjs_player=o,o}function i(e){return/^VIDEO$/i.test(e.nodeName)?e:i(e.parentNode)}return{create:n,createAll:function(e,r){var o=[];e=e||"[data-dashjs-player]";for(var s=(r=r||document).querySelectorAll(e),a=0;a<s.length;a++){var l=n(s[a],null);o.push(l)}for(var c=r.querySelectorAll('source[type="'+t+'"]'),u=0;u<c.length;u++){var d=n(i(c[u]),null);o.push(d)}return o}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?a.createAll():e=window.setInterval((function(){window.dashjs&&(window.clearInterval(e),a.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),a.createAll()})));var l=a,c=r(6398);dashjs.Protection=i.default,dashjs.MetricsReporting=n.default,dashjs.MediaPlayerFactory=l,dashjs.Debug=c.Z,dashjs.supportsMediaSource=t.B;var u=dashjs}(),o.default}()},"object"==typeof n&&"object"==typeof t?t.exports=o():"function"==typeof define&&define.amd?define([],o):"object"==typeof n?n.dashjs=o():r.dashjs=o()}).call(this)}).call(this,e("_process"),e("buffer").Buffer)},{_process:485,buffer:381}],389:[function(e,t,n){var i=e("abstract-leveldown").AbstractIterator;function r(e){i.call(this,e),this._options=e,this._iterator=null,this._operations=[]}e("inherits")(r,i),r.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach((function(e){t[e.method].apply(t,e.args)}))},r.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach((function(e){r.prototype["_"+e]=function(){this._operation(e,arguments)}})),r.prototype.seek=function(){this._operation("seek",arguments)},t.exports=r},{"abstract-leveldown":394,inherits:423}],390:[function(e,t,n){var i=e("abstract-leveldown").AbstractLevelDOWN,r=e("inherits"),o=e("./deferred-iterator"),s="put get del batch".split(" ");function a(e){i.call(this,""),this._db=e,this._operations=[],this._iterators=[],l(this)}function l(e){s.forEach((function(t){e["_"+t]=function(){this._operations.push({method:t,args:arguments})}})),"function"==typeof e._db.approximateSize&&(e.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),e._iterator=function(e){var t=new o(e);return this._iterators.push(t),t}}r(a,i),a.prototype._open=function(e,t){var n=this;this._db.open(e,(function(e){if(e)return t(e);n._operations.forEach((function(e){n._db[e.method].apply(n._db,e.args)})),n._operations=[],n._iterators.forEach((function(e){e.setDb(n._db)})),n._iterators=[],function(e){s.concat("iterator").forEach((function(t){e["_"+t]=function(){return this._db[t].apply(this._db,arguments)}})),e._db.approximateSize&&(e.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)})}(n),t()}))},a.prototype._close=function(e){var t=this;this._db.close((function(n){if(n)return e(n);l(t),e()}))},a.prototype._serializeKey=function(e){return e},a.prototype._serializeValue=function(e){return e},t.exports=a,t.exports.DeferredIterator=o},{"./deferred-iterator":389,"abstract-leveldown":394,inherits:423}],391:[function(e,t,n){function i(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}i.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},i.prototype.put=function(e,t){this._checkWritten();var n=this.db._checkKey(e)||this.db._checkValue(t);if(n)throw n;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},i.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},i.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},i.prototype._del=function(e){this._operations.push({type:"del",key:e})},i.prototype.clear=function(){return this._checkWritten(),this._clear(),this},i.prototype._clear=function(){this._operations=[]},i.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},i.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=i},{}],392:[function(e,t,n){(function(e){(function(){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?(e.nextTick(t,new Error("cannot call next() after end()")),n):n._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),n):(n._nexting=!0,n._next((function(){n._nexting=!1,t.apply(null,arguments)})),n)},n.prototype._next=function(t){e.nextTick(t)},n.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},n.prototype._seek=function(e){},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},n.prototype._end=function(t){e.nextTick(t)},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:485}],393:[function(e,t,n){(function(n,i){(function(){var r=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch"),a=Object.prototype.hasOwnProperty,l="start end gt gte lt lte".split(" ");function c(){this.status="new"}function u(e){return-1!==l.indexOf(e)}c.prototype.open=function(e,t){var n=this,i=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"==typeof e&&null!==e||(e={}),e.createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists,this.status="opening",this._open(e,(function(e){if(e)return n.status=i,t(e);n.status="open",t()}))},c.prototype._open=function(e,t){i.nextTick(t)},c.prototype.close=function(e){var t=this,n=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");this.status="closing",this._close((function(i){if(i)return t.status=n,e(i);t.status="closed",e()}))},c.prototype._close=function(e){i.nextTick(e)},c.prototype.get=function(e,t,n){if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");var r=this._checkKey(e);if(r)return i.nextTick(n,r);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),t.asBuffer=!1!==t.asBuffer,this._get(e,t,n)},c.prototype._get=function(e,t,n){i.nextTick((function(){n(new Error("NotFound"))}))},c.prototype.put=function(e,t,n,r){if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("put() requires a callback argument");var o=this._checkKey(e)||this._checkValue(t);if(o)return i.nextTick(r,o);e=this._serializeKey(e),t=this._serializeValue(t),"object"==typeof n&&null!==n||(n={}),this._put(e,t,n,r)},c.prototype._put=function(e,t,n,r){i.nextTick(r)},c.prototype.del=function(e,t,n){if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");var r=this._checkKey(e);if(r)return i.nextTick(n,r);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),this._del(e,t,n)},c.prototype._del=function(e,t,n){i.nextTick(n)},c.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return i.nextTick(n,new Error("batch(array) requires an array argument"));if(0===e.length)return i.nextTick(n);"object"==typeof t&&null!==t||(t={});for(var o=new Array(e.length),s=0;s<e.length;s++){if("object"!=typeof e[s]||null===e[s])return i.nextTick(n,new Error("batch(array) element must be an object and not `null`"));var a=r(e[s]);if("put"!==a.type&&"del"!==a.type)return i.nextTick(n,new Error("`type` must be 'put' or 'del'"));var l=this._checkKey(a.key);if(l)return i.nextTick(n,l);if(a.key=this._serializeKey(a.key),"put"===a.type){var c=this._checkValue(a.value);if(c)return i.nextTick(n,c);a.value=this._serializeValue(a.value)}o[s]=a}this._batch(o,t,n)},c.prototype._batch=function(e,t,n){i.nextTick(n)},c.prototype._setupIteratorOptions=function(e){return(e=function(e,t){var n={};for(var i in t)if(a.call(t,i)){var r=t[i];u(i)&&(r=e._serializeKey(r)),n[i]=r}return n}(this,e)).reverse=!!e.reverse,e.keys=!1!==e.keys,e.values=!1!==e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=!1!==e.keyAsBuffer,e.valueAsBuffer=!1!==e.valueAsBuffer,e},c.prototype.iterator=function(e){return"object"==typeof e&&null!==e||(e={}),e=this._setupIteratorOptions(e),this._iterator(e)},c.prototype._iterator=function(e){return new o(this)},c.prototype._chainedBatch=function(){return new s(this)},c.prototype._serializeKey=function(e){return e},c.prototype._serializeValue=function(e){return e},c.prototype._checkKey=function(e){return null==e?new Error("key cannot be `null` or `undefined`"):n.isBuffer(e)&&0===e.length?new Error("key cannot be an empty Buffer"):""===e?new Error("key cannot be an empty String"):Array.isArray(e)&&0===e.length?new Error("key cannot be an empty Array"):void 0},c.prototype._checkValue=function(e){if(null==e)return new Error("value cannot be `null` or `undefined`")},t.exports=c}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":424,"./abstract-chained-batch":391,"./abstract-iterator":392,_process:485,xtend:632}],394:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch")},{"./abstract-chained-batch":391,"./abstract-iterator":392,"./abstract-leveldown":393}],395:[function(e,t,n){"use strict";var i=e("es-define-property"),r=e("es-errors/syntax"),o=e("es-errors/type"),s=e("gopd");t.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new o("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!s&&s(e,t);if(i)i(e,t,{configurable:null===c&&d?d.configurable:!c,enumerable:null===a&&d?d.enumerable:!a,value:n,writable:null===l&&d?d.writable:!l});else{if(!u&&(a||l||c))throw new r("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},{"es-define-property":400,"es-errors/syntax":405,"es-errors/type":406,gopd:414}],396:[function(e,t,n){var i=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},r=-1;i.Diff=function(e,t){return[e,t]},i.prototype.diff_main=function(e,t,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=r;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[new i.Diff(0,e)]:[];void 0===n&&(n=!0);var s=n,a=this.diff_commonPrefix(e,t),l=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var c=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var u=this.diff_compute_(e,t,s,o);return l&&u.unshift(new i.Diff(0,l)),c&&u.push(new i.Diff(0,c)),this.diff_cleanupMerge(u),u},i.prototype.diff_compute_=function(e,t,n,o){var s;if(!e)return[new i.Diff(1,t)];if(!t)return[new i.Diff(r,e)];var a=e.length>t.length?e:t,l=e.length>t.length?t:e,c=a.indexOf(l);if(-1!=c)return s=[new i.Diff(1,a.substring(0,c)),new i.Diff(0,l),new i.Diff(1,a.substring(c+l.length))],e.length>t.length&&(s[0][0]=s[2][0]=r),s;if(1==l.length)return[new i.Diff(r,e),new i.Diff(1,t)];var u=this.diff_halfMatch_(e,t);if(u){var d=u[0],h=u[1],p=u[2],f=u[3],g=u[4],m=this.diff_main(d,p,n,o),b=this.diff_main(h,f,n,o);return m.concat([new i.Diff(0,g)],b)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,o):this.diff_bisect_(e,t,o)},i.prototype.diff_lineMode_=function(e,t,n){var o=this.diff_linesToChars_(e,t);e=o.chars1,t=o.chars2;var s=o.lineArray,a=this.diff_main(e,t,!1,n);this.diff_charsToLines_(a,s),this.diff_cleanupSemantic(a),a.push(new i.Diff(0,""));for(var l=0,c=0,u=0,d="",h="";l<a.length;){switch(a[l][0]){case 1:u++,h+=a[l][1];break;case r:c++,d+=a[l][1];break;case 0:if(c>=1&&u>=1){a.splice(l-c-u,c+u),l=l-c-u;for(var p=this.diff_main(d,h,!1,n),f=p.length-1;f>=0;f--)a.splice(l,0,p[f]);l+=p.length}u=0,c=0,d="",h=""}l++}return a.pop(),a},i.prototype.diff_bisect_=function(e,t,n){for(var o=e.length,s=t.length,a=Math.ceil((o+s)/2),l=a,c=2*a,u=new Array(c),d=new Array(c),h=0;h<c;h++)u[h]=-1,d[h]=-1;u[l+1]=0,d[l+1]=0;for(var p=o-s,f=p%2!=0,g=0,m=0,b=0,y=0,v=0;v<a&&!((new Date).getTime()>n);v++){for(var _=-v+g;_<=v-m;_+=2){for(var E=l+_,T=(C=_==-v||_!=v&&u[E-1]<u[E+1]?u[E+1]:u[E-1]+1)-_;C<o&&T<s&&e.charAt(C)==t.charAt(T);)C++,T++;if(u[E]=C,C>o)m+=2;else if(T>s)g+=2;else if(f&&(k=l+p-_)>=0&&k<c&&-1!=d[k]&&C>=(w=o-d[k]))return this.diff_bisectSplit_(e,t,C,T,n)}for(var x=-v+b;x<=v-y;x+=2){for(var w,k=l+x,S=(w=x==-v||x!=v&&d[k-1]<d[k+1]?d[k+1]:d[k-1]+1)-x;w<o&&S<s&&e.charAt(o-w-1)==t.charAt(s-S-1);)w++,S++;if(d[k]=w,w>o)y+=2;else if(S>s)b+=2;else if(!f){var C;if((E=l+p-x)>=0&&E<c&&-1!=u[E])if(T=l+(C=u[E])-E,C>=(w=o-w))return this.diff_bisectSplit_(e,t,C,T,n)}}}return[new i.Diff(r,e),new i.Diff(1,t)]},i.prototype.diff_bisectSplit_=function(e,t,n,i,r){var o=e.substring(0,n),s=t.substring(0,i),a=e.substring(n),l=t.substring(i),c=this.diff_main(o,s,!1,r),u=this.diff_main(a,l,!1,r);return c.concat(u)},i.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function r(e){for(var t="",r=0,s=-1,a=n.length;s<e.length-1;){-1==(s=e.indexOf("\n",r))&&(s=e.length-1);var l=e.substring(r,s+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(a==o&&(l=e.substring(r),s=e.length),t+=String.fromCharCode(a),i[l]=a,n[a++]=l),r=s+1}return t}n[0]="";var o=4e4,s=r(e);return o=65535,{chars1:s,chars2:r(t),lineArray:n}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],r=[],o=0;o<i.length;o++)r[o]=t[i.charCodeAt(o)];e[n][1]=r.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),r=i,o=0;n<r;)e.substring(o,r)==t.substring(o,r)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),r=i,o=0;n<r;)e.substring(e.length-r,e.length-o)==t.substring(t.length-r,t.length-o)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var r=Math.min(n,i);if(e==t)return r;for(var o=0,s=1;;){var a=e.substring(r-s),l=t.indexOf(a);if(-1==l)return o;s+=l,0!=l&&e.substring(r-s)!=t.substring(0,s)||(o=s,s++)}},i.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;var r=this;function o(e,t,n){for(var i,o,s,a,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";-1!=(c=t.indexOf(l,c+1));){var d=r.diff_commonPrefix(e.substring(n),t.substring(c)),h=r.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<h+d&&(u=t.substring(c-h,c)+t.substring(c,c+d),i=e.substring(0,n-h),o=e.substring(n+d),s=t.substring(0,c-h),a=t.substring(c+d))}return 2*u.length>=e.length?[i,o,s,a,u]:null}var s,a,l,c,u,d=o(n,i,Math.ceil(n.length/4)),h=o(n,i,Math.ceil(n.length/2));return d||h?(s=h?d&&d[4].length>h[4].length?d:h:d,e.length>t.length?(a=s[0],l=s[1],c=s[2],u=s[3]):(c=s[0],u=s[1],a=s[2],l=s[3]),[a,l,c,u,s[4]]):null},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],o=0,s=null,a=0,l=0,c=0,u=0,d=0;a<e.length;)0==e[a][0]?(n[o++]=a,l=u,c=d,u=0,d=0,s=e[a][1]):(1==e[a][0]?u+=e[a][1].length:d+=e[a][1].length,s&&s.length<=Math.max(l,c)&&s.length<=Math.max(u,d)&&(e.splice(n[o-1],0,new i.Diff(r,s)),e[n[o-1]+1][0]=1,o--,a=--o>0?n[o-1]:-1,l=0,c=0,u=0,d=0,s=null,t=!0)),a++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),a=1;a<e.length;){if(e[a-1][0]==r&&1==e[a][0]){var h=e[a-1][1],p=e[a][1],f=this.diff_commonOverlap_(h,p),g=this.diff_commonOverlap_(p,h);f>=g?(f>=h.length/2||f>=p.length/2)&&(e.splice(a,0,new i.Diff(0,p.substring(0,f))),e[a-1][1]=h.substring(0,h.length-f),e[a+1][1]=p.substring(f),a++):(g>=h.length/2||g>=p.length/2)&&(e.splice(a,0,new i.Diff(0,h.substring(0,g))),e[a-1][0]=1,e[a-1][1]=p.substring(0,p.length-g),e[a+1][0]=r,e[a+1][1]=h.substring(g),a++),a++}a++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),o=n.match(i.nonAlphaNumericRegex_),s=r.match(i.nonAlphaNumericRegex_),a=o&&n.match(i.whitespaceRegex_),l=s&&r.match(i.whitespaceRegex_),c=a&&n.match(i.linebreakRegex_),u=l&&r.match(i.linebreakRegex_),d=c&&e.match(i.blanklineEndRegex_),h=u&&t.match(i.blanklineStartRegex_);return d||h?5:c||u?4:o&&!a&&l?3:a||l?2:o||s?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var r=e[n-1][1],o=e[n][1],s=e[n+1][1],a=this.diff_commonSuffix(r,o);if(a){var l=o.substring(o.length-a);r=r.substring(0,r.length-a),o=l+o.substring(0,o.length-a),s=l+s}for(var c=r,u=o,d=s,h=t(r,o)+t(o,s);o.charAt(0)===s.charAt(0);){r+=o.charAt(0),o=o.substring(1)+s.charAt(0),s=s.substring(1);var p=t(r,o)+t(o,s);p>=h&&(h=p,c=r,u=o,d=s)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=u,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],o=0,s=null,a=0,l=!1,c=!1,u=!1,d=!1;a<e.length;)0==e[a][0]?(e[a][1].length<this.Diff_EditCost&&(u||d)?(n[o++]=a,l=u,c=d,s=e[a][1]):(o=0,s=null),u=d=!1):(e[a][0]==r?d=!0:u=!0,s&&(l&&c&&u&&d||s.length<this.Diff_EditCost/2&&l+c+u+d==3)&&(e.splice(n[o-1],0,new i.Diff(r,s)),e[n[o-1]+1][0]=1,o--,s=null,l&&c?(u=d=!0,o=0):(a=--o>0?n[o-1]:-1,u=d=!1),t=!0)),a++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push(new i.Diff(0,""));for(var t,n=0,o=0,s=0,a="",l="";n<e.length;)switch(e[n][0]){case 1:s++,l+=e[n][1],n++;break;case r:o++,a+=e[n][1],n++;break;case 0:o+s>1?(0!==o&&0!==s&&(0!==(t=this.diff_commonPrefix(l,a))&&(n-o-s>0&&0==e[n-o-s-1][0]?e[n-o-s-1][1]+=l.substring(0,t):(e.splice(0,0,new i.Diff(0,l.substring(0,t))),n++),l=l.substring(t),a=a.substring(t)),0!==(t=this.diff_commonSuffix(l,a))&&(e[n][1]=l.substring(l.length-t)+e[n][1],l=l.substring(0,l.length-t),a=a.substring(0,a.length-t))),n-=o+s,e.splice(n,o+s),a.length&&(e.splice(n,0,new i.Diff(r,a)),n++),l.length&&(e.splice(n,0,new i.Diff(1,l)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,o=0,a="",l=""}""===e[e.length-1][1]&&e.pop();var c=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),c=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),c=!0)),n++;c&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,o=0,s=0,a=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),e[n][0]!==r&&(o+=e[n][1].length),!(i>t));n++)s=i,a=o;return e.length!=n&&e[n][0]===r?a:a+(t-s)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,o=/>/g,s=/\n/g,a=0;a<e.length;a++){var l=e[a][0],c=e[a][1].replace(n,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(s,"&para;<br>");switch(l){case 1:t[a]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case r:t[a]='<del style="background:#ffe6e6;">'+c+"</del>";break;case 0:t[a]="<span>"+c+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==r&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,o=0;o<e.length;o++){var s=e[o][0],a=e[o][1];switch(s){case 1:n+=a.length;break;case r:i+=a.length;break;case 0:t+=Math.max(n,i),n=0,i=0}}return t+Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case r:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],o=0,s=0,a=t.split(/\t/g),l=0;l<a.length;l++){var c=a[l].substring(1);switch(a[l].charAt(0)){case"+":try{n[o++]=new i.Diff(1,decodeURI(c))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+c)}break;case"-":case"=":var u=parseInt(c,10);if(isNaN(u)||u<0)throw new Error("Invalid number in diff_fromDelta: "+c);var d=e.substring(s,s+=u);"="==a[l].charAt(0)?n[o++]=new i.Diff(0,d):n[o++]=new i.Diff(r,d);break;default:if(a[l])throw new Error("Invalid diff operation in diff_fromDelta: "+a[l])}}if(s!=e.length)throw new Error("Delta length ("+s+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),r=this;function o(e,i){var o=e/t.length,s=Math.abs(n-i);return r.Match_Distance?o+s/r.Match_Distance:s?1:o}var s=this.Match_Threshold,a=e.indexOf(t,n);-1!=a&&(s=Math.min(o(0,a),s),-1!=(a=e.lastIndexOf(t,n+t.length))&&(s=Math.min(o(0,a),s)));var l,c,u=1<<t.length-1;a=-1;for(var d,h=t.length+e.length,p=0;p<t.length;p++){for(l=0,c=h;l<c;)o(p,n+c)<=s?l=c:h=c,c=Math.floor((h-l)/2+l);h=c;var f=Math.max(1,n-c+1),g=Math.min(n+c,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<p)-1;for(var b=g;b>=f;b--){var y=i[e.charAt(b-1)];if(m[b]=0===p?(m[b+1]<<1|1)&y:(m[b+1]<<1|1)&y|(d[b+1]|d[b])<<1|1|d[b+1],m[b]&u){var v=o(p,b-1);if(v<=s){if(s=v,!((a=b-1)>n))break;f=Math.max(1,2*n-a)}}}if(o(p+1,n)>s)break;d=m}return a},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var n=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var o=t.substring(e.start2-r,e.start2);o&&e.diffs.unshift(new i.Diff(0,o));var s=t.substring(e.start2+e.length1,e.start2+e.length1+r);s&&e.diffs.push(new i.Diff(0,s)),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+s.length,e.length2+=o.length+s.length}},i.prototype.patch_make=function(e,t,n){var o,s;if("string"==typeof e&&"string"==typeof t&&void 0===n)o=e,(s=this.diff_main(o,t,!0)).length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(e&&"object"==typeof e&&void 0===t&&void 0===n)s=e,o=this.diff_text1(s);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===n)o=e,s=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");o=e,s=n}if(0===s.length)return[];for(var a=[],l=new i.patch_obj,c=0,u=0,d=0,h=o,p=o,f=0;f<s.length;f++){var g=s[f][0],m=s[f][1];switch(c||0===g||(l.start1=u,l.start2=d),g){case 1:l.diffs[c++]=s[f],l.length2+=m.length,p=p.substring(0,d)+m+p.substring(d);break;case r:l.length1+=m.length,l.diffs[c++]=s[f],p=p.substring(0,d)+p.substring(d+m.length);break;case 0:m.length<=2*this.Patch_Margin&&c&&s.length!=f+1?(l.diffs[c++]=s[f],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&c&&(this.patch_addContext_(l,h),a.push(l),l=new i.patch_obj,c=0,h=p,u=d)}1!==g&&(u+=m.length),g!==r&&(d+=m.length)}return c&&(this.patch_addContext_(l,h),a.push(l)),a},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=new i.patch_obj;o.diffs=[];for(var s=0;s<r.diffs.length;s++)o.diffs[s]=new i.Diff(r.diffs[s][0],r.diffs[s][1]);o.start1=r.start1,o.start2=r.start2,o.length1=r.length1,o.length2=r.length2,t[n]=o}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,o=[],s=0;s<e.length;s++){var a,l,c=e[s].start2+i,u=this.diff_text1(e[s].diffs),d=-1;if(u.length>this.Match_MaxBits?-1!=(a=this.match_main(t,u.substring(0,this.Match_MaxBits),c))&&(-1==(d=this.match_main(t,u.substring(u.length-this.Match_MaxBits),c+u.length-this.Match_MaxBits))||a>=d)&&(a=-1):a=this.match_main(t,u,c),-1==a)o[s]=!1,i-=e[s].length2-e[s].length1;else if(o[s]=!0,i=a-c,u==(l=-1==d?t.substring(a,a+u.length):t.substring(a,d+this.Match_MaxBits)))t=t.substring(0,a)+this.diff_text2(e[s].diffs)+t.substring(a+u.length);else{var h=this.diff_main(u,l,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(h)/u.length>this.Patch_DeleteThreshold)o[s]=!1;else{this.diff_cleanupSemanticLossless(h);for(var p,f=0,g=0;g<e[s].diffs.length;g++){var m=e[s].diffs[g];0!==m[0]&&(p=this.diff_xIndex(h,f)),1===m[0]?t=t.substring(0,a+p)+m[1]+t.substring(a+p):m[0]===r&&(t=t.substring(0,a+p)+t.substring(a+this.diff_xIndex(h,f+m[1].length))),m[0]!==r&&(f+=m[1].length)}}}}return[t=t.substring(n.length,t.length-n.length),o]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",r=1;r<=t;r++)n+=String.fromCharCode(r);for(r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var o=e[0],s=o.diffs;if(0==s.length||0!=s[0][0])s.unshift(new i.Diff(0,n)),o.start1-=t,o.start2-=t,o.length1+=t,o.length2+=t;else if(t>s[0][1].length){var a=t-s[0][1].length;s[0][1]=n.substring(s[0][1].length)+s[0][1],o.start1-=a,o.start2-=a,o.length1+=a,o.length2+=a}return 0==(s=(o=e[e.length-1]).diffs).length||0!=s[s.length-1][0]?(s.push(new i.Diff(0,n)),o.length1+=t,o.length2+=t):t>s[s.length-1][1].length&&(a=t-s[s.length-1][1].length,s[s.length-1][1]+=n.substring(0,a),o.length1+=a,o.length2+=a),n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var o=e[n];e.splice(n--,1);for(var s=o.start1,a=o.start2,l="";0!==o.diffs.length;){var c=new i.patch_obj,u=!0;for(c.start1=s-l.length,c.start2=a-l.length,""!==l&&(c.length1=c.length2=l.length,c.diffs.push(new i.Diff(0,l)));0!==o.diffs.length&&c.length1<t-this.Patch_Margin;){var d=o.diffs[0][0],h=o.diffs[0][1];1===d?(c.length2+=h.length,a+=h.length,c.diffs.push(o.diffs.shift()),u=!1):d===r&&1==c.diffs.length&&0==c.diffs[0][0]&&h.length>2*t?(c.length1+=h.length,s+=h.length,u=!1,c.diffs.push(new i.Diff(d,h)),o.diffs.shift()):(h=h.substring(0,t-c.length1-this.Patch_Margin),c.length1+=h.length,s+=h.length,0===d?(c.length2+=h.length,a+=h.length):u=!1,c.diffs.push(new i.Diff(d,h)),h==o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(h.length))}l=(l=this.diff_text2(c.diffs)).substring(l.length-this.Patch_Margin);var p=this.diff_text1(o.diffs).substring(0,this.Patch_Margin);""!==p&&(c.length1+=p.length,c.length2+=p.length,0!==c.diffs.length&&0===c.diffs[c.diffs.length-1][0]?c.diffs[c.diffs.length-1][1]+=p:c.diffs.push(new i.Diff(0,p))),u||e.splice(++n,0,c)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),o=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;o<n.length;){var a=n[o].match(s);if(!a)throw new Error("Invalid patch string: "+n[o]);var l=new i.patch_obj;for(t.push(l),l.start1=parseInt(a[1],10),""===a[2]?(l.start1--,l.length1=1):"0"==a[2]?l.length1=0:(l.start1--,l.length1=parseInt(a[2],10)),l.start2=parseInt(a[3],10),""===a[4]?(l.start2--,l.length2=1):"0"==a[4]?l.length2=0:(l.start2--,l.length2=parseInt(a[4],10)),o++;o<n.length;){var c=n[o].charAt(0);try{var u=decodeURI(n[o].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==c)l.diffs.push(new i.Diff(r,u));else if("+"==c)l.diffs.push(new i.Diff(1,u));else if(" "==c)l.diffs.push(new i.Diff(0,u));else{if("@"==c)break;if(""!==c)throw new Error('Invalid patch mode "'+c+'" in: '+u)}o++}}return t},(i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case 1:e="+";break;case r:e="-";break;case 0:e=" "}t[n+1]=e+encodeURI(this.diffs[n][1])+"\n"}return t.join("").replace(/%20/g," ")},t.exports=i,t.exports.diff_match_patch=i,t.exports.DIFF_DELETE=r,t.exports.DIFF_INSERT=1,t.exports.DIFF_EQUAL=0},{}],397:[function(e,t,n){"use strict";function i(e){if(this._capacity=o(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}i.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,i=this._capacity,r=0;r<e;++r)t[r]=this[n+r&i-1];return t},i.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var i=this._capacity;if(n+t>i){for(var r=0;r<t;++r)this._checkCapacity(n+1),this[o=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n;return n}var o=this._front;for(r=0;r<t;++r)this[o+n&i-1]=arguments[r],o++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},i.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},i.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},i.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var i=n-1;i>=0;i--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[i],t++,this._length=t,this._front=s}return t}var o=this._front;for(i=n-1;i>=0;i--){var s;this[s=(o-1&r-1^r)-r]=arguments[i],o=s}return this._front=o,this._length=t+n,t+n}return 0===n?t:(this._checkCapacity(t+1),r=this._capacity,this[i=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=i,t+1)},i.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},i.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},i.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},i.prototype.isEmpty=function(){return 0===this._length},i.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,i=0;i<e;++i)this[t+i&n-1]=void 0;this._length=0,this._front=0},i.prototype.toString=function(){return this.toArray().toString()},i.prototype.valueOf=i.prototype.toString,i.prototype.removeFront=i.prototype.shift,i.prototype.removeBack=i.prototype.pop,i.prototype.insertFront=i.prototype.unshift,i.prototype.insertBack=i.prototype.push,i.prototype.enqueue=i.prototype.push,i.prototype.dequeue=i.prototype.shift,i.prototype.toJSON=i.prototype.toArray,Object.defineProperty(i.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,i=this._length;n+i>t&&function(e,t,n,i,r){for(var o=0;o<r;++o)n[o+i]=e[o+t],e[o+t]=void 0}(this,0,this,t,n+i&t-1)};var r=Array.isArray;function o(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return function(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,1+(e|e>>16)}(Math.min(Math.max(16,e),1073741824))}t.exports=i},{}],398:[function(e,t,n){var i=e("prr");function r(e,t,n){t&&"string"!=typeof t&&(t=t.message||t.name),i(this,{type:e,name:e,cause:"string"!=typeof t?t:n,message:t},"ewr")}function o(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),r.call(this,"CustomError",e,t)}o.prototype=new Error,t.exports=function(e){var t=function(t,n){return function(e,t,n){var i=function(n,o){r.call(this,t,n,o),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,i)};return i.prototype=n?new n:new o,i}(e,t,n)};return{CustomError:o,FilesystemError:t("FilesystemError"),createError:t}}},{prr:489}],399:[function(e,t,n){var i=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},i.forEach((function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e})),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":398}],400:[function(e,t,n){"use strict";var i=e("get-intrinsic")("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch(e){i=!1}t.exports=i},{"get-intrinsic":413}],401:[function(e,t,n){"use strict";t.exports=EvalError},{}],402:[function(e,t,n){"use strict";t.exports=Error},{}],403:[function(e,t,n){"use strict";t.exports=RangeError},{}],404:[function(e,t,n){"use strict";t.exports=ReferenceError},{}],405:[function(e,t,n){"use strict";t.exports=SyntaxError},{}],406:[function(e,t,n){"use strict";t.exports=TypeError},{}],407:[function(e,t,n){"use strict";t.exports=URIError},{}],408:[function(e,t,n){var i=Object.create||function(e){var t=function(){};return t.prototype=e,new t},r=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=i(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n){if(t)e.call(n);else for(var i=e.length,r=E(e,i),o=0;o<i;++o)r[o].call(n)}function h(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=E(e,r),s=0;s<r;++s)o[s].call(n,i)}function p(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,s=E(e,o),a=0;a<o;++a)s[a].call(n,i,r)}function f(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var s=e.length,a=E(e,s),l=0;l<s;++l)a[l].call(n,i,r,o)}function g(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=E(e,r),s=0;s<r;++s)o[s].apply(n,i)}function m(e,t,n,r){var o,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=i(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(o=u(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else a=s[t]=n,++e._eventsCount;return e}function b(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function y(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=o.call(b,i);return r.listener=n,i.wrapFn=r,r}function v(e,t,n){var i=e._events;if(!i)return[];var r=i[t];return r?"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):E(r,r.length):[]}function _(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function E(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');l=e}}):s.defaultMaxListeners=l,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){var t,n,i,r,o,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=s[e]))return!1;var c="function"==typeof n;switch(i=arguments.length){case 1:d(n,c,this);break;case 2:h(n,c,this,arguments[1]);break;case 3:p(n,c,this,arguments[1],arguments[2]);break;case 4:f(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];g(n,c,this,r)}return!0},s.prototype.addListener=function(e,t){return m(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return m(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,y(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,y(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,o,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=i(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=i(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=i(null):delete n[e]),this;if(0===arguments.length){var s,a=r(n);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=i(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},s.prototype.listeners=function(e){return v(this,e,!0)},s.prototype.rawListeners=function(e){return v(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},s.prototype.listenerCount=_,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],409:[function(e,t,n){!function(){"use strict";var e=!("undefined"==typeof window||!window.document||!window.document.createElement),n={canUseDOM:e,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:e&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:e&&!!window.screen};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define((function(){return n})):void 0!==t&&t.exports?t.exports=n:window.ExecutionEnvironment=n}()},{}],410:[function(e,t,n){"use strict";var i="Function.prototype.bind called on incompatible ",r=Object.prototype.toString,o=Math.max,s="[object Function]",a=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var r=0;r<t.length;r+=1)n[r+e.length]=t[r];return n},l=function(e,t){for(var n=[],i=t||0,r=0;i<e.length;i+=1,r+=1)n[r]=e[i];return n},c=function(e,t){for(var n="",i=0;i<e.length;i+=1)n+=e[i],i+1<e.length&&(n+=t);return n};t.exports=function(e){var t=this;if("function"!=typeof t||r.apply(t)!==s)throw new TypeError(i+t);for(var n,u=l(arguments,1),d=o(0,t.length-u.length),h=[],p=0;p<d;p++)h[p]="$"+p;if(n=Function("binder","return function ("+c(h,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof n){var i=t.apply(this,a(u,arguments));return Object(i)===i?i:this}return t.apply(e,a(u,arguments))})),t.prototype){var f=function(){};f.prototype=t.prototype,n.prototype=new f,f.prototype=null}return n}},{}],411:[function(e,t,n){"use strict";var i=e("./implementation");t.exports=Function.prototype.bind||i},{"./implementation":410}],412:[function(e,t,n){"use strict";t.exports=function(e){return new a(e||g,null)};function i(e,t,n,i,r,o){this._color=e,this.key=t,this.value=n,this.left=i,this.right=r,this._count=o}function r(e){return new i(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new i(e,t.key,t.value,t.left,t.right,t._count)}function s(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function a(e,t){this._compare=e,this.root=t}var l=a.prototype;function c(e,t){var n;return t.left&&(n=c(e,t.left))?n:(n=e(t.key,t.value))||(t.right?c(e,t.right):void 0)}function u(e,t,n,i){if(t(e,i.key)<=0){var r;if(i.left&&(r=u(e,t,n,i.left)))return r;if(r=n(i.key,i.value))return r}if(i.right)return u(e,t,n,i.right)}function d(e,t,n,i,r){var o,s=n(e,r.key),a=n(t,r.key);if(s<=0){if(r.left&&(o=d(e,t,n,i,r.left)))return o;if(a>0&&(o=i(r.key,r.value)))return o}if(a>0&&r.right)return d(e,t,n,i,r.right)}function h(e,t){this.tree=e,this._stack=t}Object.defineProperty(l,"keys",{get:function(){var e=[];return this.forEach((function(t,n){e.push(t)})),e}}),Object.defineProperty(l,"values",{get:function(){var e=[];return this.forEach((function(t,n){e.push(n)})),e}}),Object.defineProperty(l,"length",{get:function(){return this.root?this.root._count:0}}),l.insert=function(e,t){for(var n=this._compare,r=this.root,l=[],c=[];r;){var u=n(e,r.key);l.push(r),c.push(u),r=u<=0?r.left:r.right}l.push(new i(0,e,t,null,null,1));for(var d=l.length-2;d>=0;--d)r=l[d],c[d]<=0?l[d]=new i(r._color,r.key,r.value,l[d+1],r.right,r._count+1):l[d]=new i(r._color,r.key,r.value,r.left,l[d+1],r._count+1);for(d=l.length-1;d>1;--d){var h=l[d-1];if(r=l[d],1===h._color||1===r._color)break;var p=l[d-2];if(p.left===h)if(h.left===r){if(!(f=p.right)||0!==f._color){p._color=0,p.left=h.right,h._color=1,h.right=p,l[d-2]=h,l[d-1]=r,s(p),s(h),d>=3&&((g=l[d-3]).left===p?g.left=h:g.right=h);break}h._color=1,p.right=o(1,f),p._color=0,d-=1}else{if(!(f=p.right)||0!==f._color){h.right=r.left,p._color=0,p.left=r.right,r._color=1,r.left=h,r.right=p,l[d-2]=r,l[d-1]=h,s(p),s(h),s(r),d>=3&&((g=l[d-3]).left===p?g.left=r:g.right=r);break}h._color=1,p.right=o(1,f),p._color=0,d-=1}else if(h.right===r){if(!(f=p.left)||0!==f._color){p._color=0,p.right=h.left,h._color=1,h.left=p,l[d-2]=h,l[d-1]=r,s(p),s(h),d>=3&&((g=l[d-3]).right===p?g.right=h:g.left=h);break}h._color=1,p.left=o(1,f),p._color=0,d-=1}else{var f;if(!(f=p.left)||0!==f._color){var g;h.left=r.right,p._color=0,p.right=r.left,r._color=1,r.right=h,r.left=p,l[d-2]=r,l[d-1]=h,s(p),s(h),s(r),d>=3&&((g=l[d-3]).right===p?g.right=r:g.left=r);break}h._color=1,p.left=o(1,f),p._color=0,d-=1}}return l[0]._color=1,new a(n,l[0])},l.forEach=function(e,t,n){if(this.root)switch(arguments.length){case 1:return c(e,this.root);case 2:return u(t,this._compare,e,this.root);case 3:if(this._compare(t,n)>=0)return;return d(t,n,this._compare,e,this.root)}},Object.defineProperty(l,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new h(this,e)}}),Object.defineProperty(l,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new h(this,e)}}),l.at=function(e){if(e<0)return new h(this,[]);for(var t=this.root,n=[];;){if(n.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new h(this,n);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new h(this,[])},l.ge=function(e){for(var t=this._compare,n=this.root,i=[],r=0;n;){var o=t(e,n.key);i.push(n),o<=0&&(r=i.length),n=o<=0?n.left:n.right}return i.length=r,new h(this,i)},l.gt=function(e){for(var t=this._compare,n=this.root,i=[],r=0;n;){var o=t(e,n.key);i.push(n),o<0&&(r=i.length),n=o<0?n.left:n.right}return i.length=r,new h(this,i)},l.lt=function(e){for(var t=this._compare,n=this.root,i=[],r=0;n;){var o=t(e,n.key);i.push(n),o>0&&(r=i.length),n=o<=0?n.left:n.right}return i.length=r,new h(this,i)},l.le=function(e){for(var t=this._compare,n=this.root,i=[],r=0;n;){var o=t(e,n.key);i.push(n),o>=0&&(r=i.length),n=o<0?n.left:n.right}return i.length=r,new h(this,i)},l.find=function(e){for(var t=this._compare,n=this.root,i=[];n;){var r=t(e,n.key);if(i.push(n),0===r)return new h(this,i);n=r<=0?n.left:n.right}return new h(this,[])},l.remove=function(e){var t=this.find(e);return t?t.remove():this},l.get=function(e){for(var t=this._compare,n=this.root;n;){var i=t(e,n.key);if(0===i)return n.value;n=i<=0?n.left:n.right}};var p=h.prototype;function f(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function g(e,t){return e<t?-1:e>t?1:0}Object.defineProperty(p,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(p,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),p.clone=function(){return new h(this.tree,this._stack.slice())},p.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),n=e[e.length-1];t[t.length-1]=new i(n._color,n.key,n.value,n.left,n.right,n._count);for(var l=e.length-2;l>=0;--l)(n=e[l]).left===e[l+1]?t[l]=new i(n._color,n.key,n.value,t[l+1],n.right,n._count):t[l]=new i(n._color,n.key,n.value,n.left,t[l+1],n._count);if((n=t[t.length-1]).left&&n.right){var c=t.length;for(n=n.left;n.right;)t.push(n),n=n.right;var u=t[c-1];for(t.push(new i(n._color,u.key,u.value,n.left,n.right,n._count)),t[c-1].key=n.key,t[c-1].value=n.value,l=t.length-2;l>=c;--l)n=t[l],t[l]=new i(n._color,n.key,n.value,n.left,t[l+1],n._count);t[c-1].left=t[c]}if(0===(n=t[t.length-1])._color){var d=t[t.length-2];for(d.left===n?d.left=null:d.right===n&&(d.right=null),t.pop(),l=0;l<t.length;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(n.left||n.right){for(n.left?f(n,n.left):n.right&&f(n,n.right),n._color=1,l=0;l<t.length-1;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(1===t.length)return new a(this.tree._compare,null);for(l=0;l<t.length;++l)t[l]._count--;var h=t[t.length-2];return function(e){for(var t,n,i,a,l=e.length-1;l>=0;--l){if(t=e[l],0===l)return void(t._color=1);if((n=e[l-1]).left===t){if((i=n.right).right&&0===i.right._color)return a=(i=n.right=r(i)).right=r(i.right),n.right=i.left,i.left=n,i.right=a,i._color=n._color,t._color=1,n._color=1,a._color=1,s(n),s(i),l>1&&((c=e[l-2]).left===n?c.left=i:c.right=i),void(e[l-1]=i);if(i.left&&0===i.left._color)return a=(i=n.right=r(i)).left=r(i.left),n.right=a.left,i.left=a.right,a.left=n,a.right=i,a._color=n._color,n._color=1,i._color=1,t._color=1,s(n),s(i),s(a),l>1&&((c=e[l-2]).left===n?c.left=a:c.right=a),void(e[l-1]=a);if(1===i._color){if(0===n._color)return n._color=1,void(n.right=o(0,i));n.right=o(0,i);continue}i=r(i),n.right=i.left,i.left=n,i._color=n._color,n._color=0,s(n),s(i),l>1&&((c=e[l-2]).left===n?c.left=i:c.right=i),e[l-1]=i,e[l]=n,l+1<e.length?e[l+1]=t:e.push(t),l+=2}else{if((i=n.left).left&&0===i.left._color)return a=(i=n.left=r(i)).left=r(i.left),n.left=i.right,i.right=n,i.left=a,i._color=n._color,t._color=1,n._color=1,a._color=1,s(n),s(i),l>1&&((c=e[l-2]).right===n?c.right=i:c.left=i),void(e[l-1]=i);if(i.right&&0===i.right._color)return a=(i=n.left=r(i)).right=r(i.right),n.left=a.right,i.right=a.left,a.right=n,a.left=i,a._color=n._color,n._color=1,i._color=1,t._color=1,s(n),s(i),s(a),l>1&&((c=e[l-2]).right===n?c.right=a:c.left=a),void(e[l-1]=a);if(1===i._color){if(0===n._color)return n._color=1,void(n.left=o(0,i));n.left=o(0,i);continue}var c;i=r(i),n.left=i.right,i.right=n,i._color=n._color,n._color=0,s(n),s(i),l>1&&((c=e[l-2]).right===n?c.right=i:c.left=i),e[l-1]=i,e[l]=n,l+1<e.length?e[l+1]=t:e.push(t),l+=2}}}(t),h.left===n?h.left=null:h.right=null,new a(this.tree._compare,t[0])},Object.defineProperty(p,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(p,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(p,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var n=this.tree.root;return n?n._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var i=t.length-2;i>=0;--i)t[i+1]===t[i].right&&(++e,t[i].left&&(e+=t[i].left._count));return e},enumerable:!0}),p.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(p,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),p.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var n=new Array(t.length),r=t[t.length-1];n[n.length-1]=new i(r._color,r.key,e,r.left,r.right,r._count);for(var o=t.length-2;o>=0;--o)(r=t[o]).left===t[o+1]?n[o]=new i(r._color,r.key,r.value,n[o+1],r.right,r._count):n[o]=new i(r._color,r.key,r.value,r.left,n[o+1],r._count);return new a(this.tree._compare,n[0])},p.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(p,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],413:[function(e,t,n){"use strict";var i,r=e("es-errors"),o=e("es-errors/eval"),s=e("es-errors/range"),a=e("es-errors/ref"),l=e("es-errors/syntax"),c=e("es-errors/type"),u=e("es-errors/uri"),d=Function,h=function(e){try{return d('"use strict"; return ('+e+").constructor;")()}catch(e){}},p=Object.getOwnPropertyDescriptor;if(p)try{p({},"")}catch(e){p=null}var f=function(){throw new c},g=p?function(){try{return f}catch(e){try{return p(arguments,"callee").get}catch(e){return f}}}():f,m=e("has-symbols")(),b=e("has-proto")(),y=Object.getPrototypeOf||(b?function(e){return e.__proto__}:null),v={},_="undefined"!=typeof Uint8Array&&y?y(Uint8Array):i,E={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":m&&y?y([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&y?y(y([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&y?y((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":s,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&y?y((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&y?y(""[Symbol.iterator]()):i,"%Symbol%":m?Symbol:i,"%SyntaxError%":l,"%ThrowTypeError%":g,"%TypedArray%":_,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(y)try{null.error}catch(e){var T=y(y(e));E["%Error.prototype%"]=T}var x=function e(t){var n;if("%AsyncFunction%"===t)n=h("async function () {}");else if("%GeneratorFunction%"===t)n=h("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=h("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(n=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&y&&(n=y(r.prototype))}return E[t]=n,n},w={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},k=e("function-bind"),S=e("hasown"),C=k.call(Function.call,Array.prototype.concat),A=k.call(Function.apply,Array.prototype.splice),I=k.call(Function.call,String.prototype.replace),O=k.call(Function.call,String.prototype.slice),N=k.call(Function.call,RegExp.prototype.exec),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,D=/\\(\\)?/g,L=function(e){var t=O(e,0,1),n=O(e,-1);if("%"===t&&"%"!==n)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new l("invalid intrinsic syntax, expected opening `%`");var i=[];return I(e,R,(function(e,t,n,r){i[i.length]=n?I(r,D,"$1"):t||e})),i},M=function(e,t){var n,i=e;if(S(w,i)&&(i="%"+(n=w[i])[0]+"%"),S(E,i)){var r=E[i];if(r===v&&(r=x(i)),void 0===r&&!t)throw new c("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:r}}throw new l("intrinsic "+e+" does not exist!")};t.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new c('"allowMissing" argument must be a boolean');if(null===N(/^%?[^%]*%?$/,e))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=L(e),i=n.length>0?n[0]:"",r=M("%"+i+"%",t),o=r.name,s=r.value,a=!1,u=r.alias;u&&(i=u[0],A(n,C([0,1],u)));for(var d=1,h=!0;d<n.length;d+=1){var f=n[d],g=O(f,0,1),m=O(f,-1);if(('"'===g||"'"===g||"`"===g||'"'===m||"'"===m||"`"===m)&&g!==m)throw new l("property names with quotes must have matching quotes");if("constructor"!==f&&h||(a=!0),S(E,o="%"+(i+="."+f)+"%"))s=E[o];else if(null!=s){if(!(f in s)){if(!t)throw new c("base intrinsic for "+e+" exists, but the property is not available.");return}if(p&&d+1>=n.length){var b=p(s,f);s=(h=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:s[f]}else h=S(s,f),s=s[f];h&&!a&&(E[o]=s)}}return s}},{"es-errors":402,"es-errors/eval":401,"es-errors/range":403,"es-errors/ref":404,"es-errors/syntax":405,"es-errors/type":406,"es-errors/uri":407,"function-bind":411,"has-proto":416,"has-symbols":417,hasown:419}],414:[function(e,t,n){"use strict";var i=e("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch(e){i=null}t.exports=i},{"get-intrinsic":413}],415:[function(e,t,n){"use strict";var i=e("es-define-property"),r=function(){return!!i};r.hasArrayLengthDefineBug=function(){if(!i)return null;try{return 1!==i([],"length",{value:1}).length}catch(e){return!0}},t.exports=r},{"es-define-property":400}],416:[function(e,t,n){"use strict";var i={__proto__:null,foo:{}},r=Object;t.exports=function(){return{__proto__:i}.foo===i.foo&&!(i instanceof r)}},{}],417:[function(e,t,n){"use strict";var i="undefined"!=typeof Symbol&&Symbol,r=e("./shams");t.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&r()}},{"./shams":418}],418:[function(e,t,n){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},{}],419:[function(e,t,n){"use strict";var i=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=e("function-bind");t.exports=o.call(i,r)},{"function-bind":411}],420:[function(e,t,n){"use strict";var i=e("react-is"),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?s:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,h=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;t.exports=function e(t,n,i){if("string"!=typeof n){if(f){var r=p(n);r&&r!==f&&e(t,r,i)}var s=u(n);d&&(s=s.concat(d(n)));for(var a=l(t),g=l(n),m=0;m<s.length;++m){var b=s[m];if(!(o[b]||i&&i[b]||g&&g[b]||a&&a[b])){var y=h(n,b);try{c(t,b,y)}catch(t){}}}}return t}},{"react-is":493}],421:[function(e,t,n){n.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?r-1:0,h=n?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=h,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},n.write=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,d=u>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*l-1)*Math.pow(2,r),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*g}},{}],422:[function(e,t,n){(function(e){(function(){"use strict";var n,i,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var o=0,s=new r(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;i=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}i=!1}t.exports=function(e){1!==c.push(e)||i||n()}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],423:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],424:[function(e,t,n){function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(i(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&i(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],425:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}],426:[function(e,t,n){var i=e("./lib/encodings");function r(e){if(!(this instanceof r))return new r(e);this.opts=e||{},this.encodings=i}t.exports=r,r.prototype._encoding=function(e){return"string"==typeof e&&(e=i[e]),e||(e=i.id),e},r.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},r.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},r.prototype.encodeKey=function(e,t,n){return this._keyEncoding(t,n).encode(e)},r.prototype.encodeValue=function(e,t,n){return this._valueEncoding(t,n).encode(e)},r.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},r.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},r.prototype.encodeBatch=function(e,t){var n=this;return e.map((function(e){var i={type:e.type,key:n.encodeKey(e.key,t,e)};return n.keyAsBuffer(t,e)&&(i.keyEncoding="binary"),e.prefix&&(i.prefix=e.prefix),"value"in e&&(i.value=n.encodeValue(e.value,t,e),n.valueAsBuffer(t,e)&&(i.valueEncoding="binary")),i}))};var o=["lt","gt","lte","gte","start","end"];r.prototype.encodeLtgt=function(e){var t=this,n={};return Object.keys(e).forEach((function(i){n[i]=o.indexOf(i)>-1?t.encodeKey(e[i],e):e[i]})),n},r.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(n,i){return{key:t.decodeKey(n,e),value:t.decodeValue(i,e)}}:e.keys?function(n){return t.decodeKey(n,e)}:e.values?function(n,i){return t.decodeValue(i,e)}:function(){}},r.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},r.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":427}],427:[function(e,t,n){(function(e){(function(){n.utf8=n["utf-8"]={encode:function(e){return i(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},n.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},n.binary={encode:function(t){return i(t)?t:e.from(t)},decode:t,buffer:!0,type:"binary"},n.none={encode:t,decode:t,buffer:!1,type:"id"},n.id=n.none;function t(e){return e}function i(t){return null==t||e.isBuffer(t)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach((function(t){n[t]={encode:function(n){return i(n)?n:e.from(n,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}}))}).call(this)}).call(this,e("buffer").Buffer)},{buffer:381}],428:[function(e,t,n){var i=e("errno").create,r=i("LevelUPError"),o=i("NotFoundError",r);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:r,InitializationError:i("InitializationError",r),OpenError:i("OpenError",r),ReadError:i("ReadError",r),WriteError:i("WriteError",r),NotFoundError:o,EncodingError:i("EncodingError",r)}},{errno:399}],429:[function(e,t,n){var i=e("inherits"),r=e("readable-stream").Readable,o=e("xtend");function s(e,t){if(!(this instanceof s))return new s(e,t);t=t||{},r.call(this,o(t,{objectMode:!0})),this._iterator=e,this._options=t,this.on("end",this.destroy.bind(this,null,null))}t.exports=s,i(s,r),s.prototype._read=function(){var e=this,t=this._options;this.destroyed||this._iterator.next((function(n,i,r){if(!e.destroyed)return n?e.destroy(n):void(void 0===i&&void 0===r?e.push(null):!1!==t.keys&&!1===t.values?e.push(i):!1===t.keys&&!1!==t.values?e.push(r):e.push({key:i,value:r}))}))},s.prototype._destroy=function(e,t){this._iterator.end((function(n){t(e||n)}))}},{inherits:423,"readable-stream":444,xtend:632}],430:[function(e,t,n){"use strict";var i={};function r(e,t,n){n||(n=Error);var r=function(e){function n(n,i,r){return e.call(this,function(e,n,i){return"string"==typeof t?t:t(e,n,i)}(n,i,r))||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(n,e),n}(n);r.prototype.name=n.name,r.prototype.code=e,i[e]=r}function o(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,n){var i,r;if("string"==typeof t&&function(e,t,n){return e.substr(!n||n<0?0:+n,t.length)===t}(t,"not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))r="The ".concat(e," ").concat(i," ").concat(o(t,"type"));else{var s=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";r='The "'.concat(e,'" ').concat(s," ").concat(i," ").concat(o(t,"type"))}return r+". Received type ".concat(typeof n)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=i},{}],431:[function(e,t,n){(function(n){(function(){"use strict";var i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=c;var r=e("./_stream_readable"),o=e("./_stream_writable");e("inherits")(c,r);for(var s=i(o.prototype),a=0;a<s.length;a++){var l=s[a];c.prototype[l]||(c.prototype[l]=o.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);r.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))},{"./_stream_readable":433,"./_stream_writable":435,_process:485,inherits:423}],432:[function(e,t,n){"use strict";t.exports=r;var i=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}e("inherits")(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":434,inherits:423}],433:[function(e,t,n){(function(n,i){(function(){"use strict";var r;t.exports=k,k.ReadableState=w;e("events").EventEmitter;var o=function(e,t){return e.listeners(t).length},s=e("./internal/streams/stream"),a=e("buffer").Buffer,l=(void 0!==i?i:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,u=e("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var d,h,p,f=e("./internal/streams/buffer_list"),g=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,b=e("../errors").codes,y=b.ERR_INVALID_ARG_TYPE,v=b.ERR_STREAM_PUSH_AFTER_EOF,_=b.ERR_METHOD_NOT_IMPLEMENTED,E=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(k,s);var T=g.errorOrDestroy,x=["error","close","destroy","pause","resume"];function w(t,n,i){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=n instanceof r),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",i),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=e("string_decoder/").StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function k(t){if(r=r||e("./_stream_duplex"),!(this instanceof k))return new k(t);var n=this instanceof r;this._readableState=new w(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function S(e,t,n,i,r){c("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(c("onEofChunk"),!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?O(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,N(e)))}}(e,s);else if(r||(o=function(e,t){var n;return function(e){return a.isBuffer(e)||e instanceof l}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new y("chunk",["string","Buffer","Uint8Array"],t)),n}(s,t)),o)T(e,o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),i)s.endEmitted?T(e,new E):C(e,s,t,!0);else if(s.ended)T(e,new v);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?C(e,s,t,!1):R(e,s)):C(e,s,t,!1)}else i||(s.reading=!1,R(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function C(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&O(e)),R(e,t)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),k.prototype.destroy=g.destroy,k.prototype._undestroy=g.undestroy,k.prototype._destroy=function(e,t){t(e)},k.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=a.from(e,t),t=""),n=!0),S(this,e,t,!1,n)},k.prototype.unshift=function(e){return S(this,e,null,!0,!1)},k.prototype.isPaused=function(){return!1===this._readableState.flowing},k.prototype.setEncoding=function(t){d||(d=e("string_decoder/").StringDecoder);var n=new d(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,r="";null!==i;)r+=n.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var A=1073741824;function I(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function O(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(N,e))}function N(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,B(e)}function R(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(D,e,t))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){c("readable nexttick read 0"),e.read(0)}function P(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick($,t,e))}function $(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function U(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}k.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):O(this),null;if(0===(e=I(e,t))&&t.ended)return 0===t.length&&F(this),null;var i,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=I(n,t))),null===(i=e>0?j(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==i&&this.emit("data",i),i},k.prototype._read=function(e){T(this,new _("_read()"))},k.prototype.pipe=function(e,t){var i=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,c("pipe count=%d opts=%j",r.pipesCount,t);var s=t&&!1===t.end||e===n.stdout||e===n.stderr?g:a;function a(){c("onend"),e.end()}r.endEmitted?n.nextTick(s):i.once("end",s),e.on("unpipe",(function t(n,o){c("onunpipe"),n===i&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,c("cleanup"),e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",l),e.removeListener("error",h),e.removeListener("unpipe",t),i.removeListener("end",a),i.removeListener("end",g),i.removeListener("data",d),u=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}));var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,B(e))}}(i);e.on("drain",l);var u=!1;function d(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==U(r.pipes,e))&&!u&&(c("false write response, pause",r.awaitDrain),r.awaitDrain++),i.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===o(e,"error")&&T(e,t)}function p(){e.removeListener("finish",f),g()}function f(){c("onfinish"),e.removeListener("close",p),g()}function g(){c("unpipe"),i.unpipe(e)}return i.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",p),e.once("finish",f),e.emit("pipe",i),r.flowing||(c("pipe resume"),i.resume()),e},k.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=U(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},k.prototype.on=function(e,t){var i=s.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?O(this):r.reading||n.nextTick(M,this))),i},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(e,t){var i=s.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(L,this),i},k.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||n.nextTick(L,this),t},k.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(P,e,t))}(this,e)),e.paused=!1,this},k.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){c("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<x.length;o++)e.on(x[o],this.emit.bind(this,x[o]));return this._read=function(t){c("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"==typeof Symbol&&(k.prototype[Symbol.asyncIterator]=function(){return void 0===h&&(h=e("./internal/streams/async_iterator")),h(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),k._fromList=j,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(k.from=function(t,n){return void 0===p&&(p=e("./internal/streams/from")),p(k,t,n)})}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":430,"./_stream_duplex":431,"./internal/streams/async_iterator":436,"./internal/streams/buffer_list":437,"./internal/streams/destroy":438,"./internal/streams/from":440,"./internal/streams/state":442,"./internal/streams/stream":443,_process:485,buffer:381,events:408,inherits:423,"string_decoder/":610,util:380}],434:[function(e,t,n){"use strict";t.exports=u;var i=e("../errors").codes,r=i.ERR_METHOD_NOT_IMPLEMENTED,o=i.ERR_MULTIPLE_CALLBACK,s=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=i.ERR_TRANSFORM_WITH_LENGTH_0,l=e("./_stream_duplex");function c(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(null===i)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush((function(t,n){h(e,t,n)}))}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},{"../errors":430,"./_stream_duplex":431,inherits:423}],435:[function(e,t,n){(function(n,i){(function(){"use strict";function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;for(e.entry=null;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=k,k.WritableState=w;var s={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),l=e("buffer").Buffer,c=(void 0!==i?i:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var u,d=e("./internal/streams/destroy"),h=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,f=p.ERR_INVALID_ARG_TYPE,g=p.ERR_METHOD_NOT_IMPLEMENTED,m=p.ERR_MULTIPLE_CALLBACK,b=p.ERR_STREAM_CANNOT_PIPE,y=p.ERR_STREAM_DESTROYED,v=p.ERR_STREAM_NULL_VALUES,_=p.ERR_STREAM_WRITE_AFTER_END,E=p.ERR_UNKNOWN_ENCODING,T=d.errorOrDestroy;function x(){}function w(t,i,s){o=o||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=i instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=h(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,r=i.sync,o=i.writecb;if("function"!=typeof o)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,r,o){--t.pendingcb,i?(n.nextTick(o,r),n.nextTick(R,e,t),e._writableState.errorEmitted=!0,T(e,r)):(o(r),e._writableState.errorEmitted=!0,T(e,r),R(e,t))}(e,i,r,t,o);else{var s=O(i)||e.destroyed;s||i.corked||i.bufferProcessing||!i.bufferedRequest||I(e,i),r?n.nextTick(A,e,i,s,o):A(e,i,s,o)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function k(t){var n=this instanceof(o=o||e("./_stream_duplex"));if(!n&&!u.call(k,this))return new k(t);this._writableState=new w(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function S(e,t,n,i,r,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,n)),t}(t,i,r);i!==s&&(n=!0,r="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,a,i,r,o);return c}function C(e,t,n,i,r,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new y("write")):n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function A(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),R(e,t)}function I(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,o=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var a=0,l=!0;n;)o[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;o.allBuffers=l,C(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(C(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function O(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function N(e,t){e._final((function(n){t.pendingcb--,n&&T(e,n),t.prefinished=!0,e.emit("prefinish"),R(e,t)}))}function R(e,t){var i=O(t);if(i&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(N,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return i}e("inherits")(k,a),w.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(w.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===k&&e&&e._writableState instanceof w}})):u=function(e){return e instanceof this},k.prototype.pipe=function(){T(this,new b)},k.prototype.write=function(e,t,i){var r=this._writableState,o=!1,s=!r.objectMode&&function(e){return l.isBuffer(e)||e instanceof c}(e);return s&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(i=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=x),r.ending?function(e,t){var i=new _;T(e,i),n.nextTick(t,i)}(this,i):(s||function(e,t,i,r){var o;return null===i?o=new v:"string"==typeof i||t.objectMode||(o=new f("chunk",["string","Buffer"],i)),!o||(T(e,o),n.nextTick(r,o),!1)}(this,r,e,i))&&(r.pendingcb++,o=S(this,r,s,e,t,i)),o},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||I(this,e))},k.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new E(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(e,t,n){n(new g("_write()"))},k.prototype._writev=null,k.prototype.end=function(e,t,i){var r=this._writableState;return"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,i){t.ending=!0,R(e,t),i&&(t.finished?n.nextTick(i):e.once("finish",i)),t.ended=!0,e.writable=!1}(this,r,i),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),k.prototype.destroy=d.destroy,k.prototype._undestroy=d.undestroy,k.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":430,"./_stream_duplex":431,"./internal/streams/destroy":438,"./internal/streams/state":442,"./internal/streams/stream":443,_process:485,buffer:381,inherits:423,"util-deprecate":621}],436:[function(e,t,n){(function(n){(function(){"use strict";var i;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=e("./end-of-stream"),s=Symbol("lastResolve"),a=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function f(e){var t=e[s];if(null!==t){var n=e[h].read();null!==n&&(e[u]=null,e[s]=null,e[a]=null,t(p(n,!1)))}}function g(e){n.nextTick(f,e)}var m=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((r(i={get stream(){return this[h]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(void 0,!0));if(this[h].destroyed)return new Promise((function(t,i){n.nextTick((function(){e[l]?i(e[l]):t(p(void 0,!0))}))}));var i,r=this[u];if(r)i=new Promise(function(e,t){return function(n,i){e.then((function(){t[c]?n(p(void 0,!0)):t[d](n,i)}),i)}}(r,this));else{var o=this[h].read();if(null!==o)return Promise.resolve(p(o,!1));i=new Promise(this[d])}return this[u]=i,i}},Symbol.asyncIterator,(function(){return this})),r(i,"return",(function(){var e=this;return new Promise((function(t,n){e[h].destroy(null,(function(e){e?n(e):t(p(void 0,!0))}))}))})),i),m);t.exports=function(e){var t,n=Object.create(b,(r(t={},h,{value:e,writable:!0}),r(t,s,{value:null,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,l,{value:null,writable:!0}),r(t,c,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var i=n[h].read();i?(n[u]=null,n[s]=null,n[a]=null,e(p(i,!1))):(n[s]=e,n[a]=t)},writable:!0}),t));return n[u]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[a];return null!==t&&(n[u]=null,n[s]=null,n[a]=null,t(e)),void(n[l]=e)}var i=n[s];null!==i&&(n[u]=null,n[s]=null,n[a]=null,i(p(void 0,!0))),n[c]=!0})),e.on("readable",g.bind(null,n)),n}}).call(this)}).call(this,e("_process"))},{"./end-of-stream":439,_process:485}],437:[function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var l=e("buffer").Buffer,c=e("util").inspect,u=c&&c.custom||"inspect";function d(e,t,n){l.prototype.copy.call(e,t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return l.alloc(0);for(var t=l.allocUnsafe(e>>>0),n=this.head,i=0;n;)d(n.data,t,i),i+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,i=t.data;for(e-=i.length;t=t.next;){var r=t.data,o=e>r.length?r.length:e;if(o===r.length?i+=r:i+=r.slice(0,e),0==(e-=o)){o===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(o));break}++n}return this.length-=n,i}},{key:"_getBuffer",value:function(e){var t=l.allocUnsafe(e),n=this.head,i=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,o=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,o),0==(e-=o)){o===r.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(o));break}++i}return this.length-=i,t}},{key:u,value:function(e,t){return c(this,r(r({},t),{},{depth:0,customInspect:!1}))}}]),e}()},{buffer:381,util:380}],438:[function(e,t,n){(function(e){(function(){"use strict";function n(e,t){r(e,t),i(e)}function i(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(i,s):(s._writableState.errorEmitted=!0,e.nextTick(n,s,t)):e.nextTick(n,s,t):o?(e.nextTick(i,s),o(t)):e.nextTick(i,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,i=e._writableState;n&&n.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))},{_process:485}],439:[function(e,t,n){"use strict";var i=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i)}}}(o||r);var s=n.readable||!1!==n.readable&&t.readable,a=n.writable||!1!==n.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){a=!1,c=!0,s||o.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){s=!1,d=!0,a||o.call(t)},p=function(e){o.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new i),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new i),o.call(t,e)):void 0},g=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?g():t.on("request",g)):a&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",h),t.on("finish",u),!1!==n.error&&t.on("error",p),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",g),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",h),t.removeListener("error",p),t.removeListener("close",f)}}},{"../../../errors":430}],440:[function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],441:[function(e,t,n){"use strict";var i;var r=e("../../../errors").codes,o=r.ERR_MISSING_ARGS,s=r.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(t,n,r,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;t.on("close",(function(){a=!0})),void 0===i&&(i=e("./end-of-stream")),i(t,{readable:n,writable:r},(function(e){if(e)return o(e);a=!0,o()}));var l=!1;return function(e){if(!a&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new s("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}t.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var s=t.map((function(e,n){var o=n<t.length-1;return l(e,o,n>0,(function(e){i||(i=e),e&&s.forEach(c),o||(s.forEach(c),r(i))}))}));return t.reduce(u)}},{"../../../errors":430,"./end-of-stream":439}],442:[function(e,t,n){"use strict";var i=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new i(r?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},{"../../../errors":430}],443:[function(e,t,n){t.exports=e("events").EventEmitter},{events:408}],444:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":431,"./lib/_stream_passthrough.js":432,"./lib/_stream_readable.js":433,"./lib/_stream_transform.js":434,"./lib/_stream_writable.js":435,"./lib/internal/streams/end-of-stream.js":439,"./lib/internal/streams/pipeline.js":441}],445:[function(e,t,n){var i=e("level-errors").WriteError,r=e("./promisify"),o=e("./common").getCallback,s=e("./common").getOptions;function a(e){this._levelup=e,this.batch=e.db.batch(),this.ops=[],this.length=0}a.prototype.put=function(e,t){try{this.batch.put(e,t)}catch(e){throw new i(e)}return this.ops.push({type:"put",key:e,value:t}),this.length++,this},a.prototype.del=function(e){try{this.batch.del(e)}catch(e){throw new i(e)}return this.ops.push({type:"del",key:e}),this.length++,this},a.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new i(e)}return this.ops=[],this.length=0,this},a.prototype.write=function(e,t){var n,a=this._levelup,l=this.ops;(t=o(e,t))||(n=(t=r()).promise),e=s(e);try{this.batch.write(e,(function(e){if(e)return t(new i(e));a.emit("batch",l),t()}))}catch(e){throw new i(e)}return n},t.exports=a},{"./common":446,"./promisify":448,"level-errors":428}],446:[function(e,t,n){n.getCallback=function(e,t){return"function"==typeof e?e:t},n.getOptions=function(e){return"object"==typeof e&&null!==e?e:{}}},{}],447:[function(e,t,n){(function(n){(function(){var i=e("events").EventEmitter,r=e("util").inherits,o=e("xtend"),s=e("deferred-leveldown"),a=e("level-iterator-stream"),l=e("./batch"),c=e("level-errors"),u=e("assert"),d=e("./promisify"),h=e("./common").getCallback,p=e("./common").getOptions,f=c.WriteError,g=c.ReadError,m=c.NotFoundError,b=c.OpenError,y=c.InitializationError;function v(e,t,r){if(!(this instanceof v))return new v(e,t,r);var o;if(i.call(this),this.setMaxListeners(1/0),"function"==typeof t&&(r=t,t={}),t=t||{},!e||"object"!=typeof e){if(o=new y("First argument must be an abstract-leveldown compliant store"),"function"==typeof r)return n.nextTick(r,o);throw o}u.strictEqual(typeof e.status,"string",".status required, old abstract-leveldown"),this.options=p(t),this._db=e,this.db=new s(e),this.open(r)}function _(e,t){if(!e._isOpening()&&!e.isOpen())return n.nextTick(t,new g("Database is not open")),!0}v.prototype.emit=i.prototype.emit,v.prototype.once=i.prototype.once,r(v,i),v.prototype.open=function(e,t){var i,r=this;return"function"==typeof e&&(t=e,e=null),t||(i=(t=d()).promise),e||(e=this.options),this.isOpen()?(n.nextTick(t,null,r),i):this._isOpening()?(this.once("open",(function(){t(null,r)})),i):(this.emit("opening"),this.db.open(e,(function(e){if(e)return t(new b(e));r.db=r._db,t(null,r),r.emit("open"),r.emit("ready")})),i)},v.prototype.close=function(e){var t,i=this;return e||(t=(e=d()).promise),this.isOpen()?(this.db.close((function(){i.emit("closed"),e.apply(null,arguments)})),this.emit("closing"),this.db=new s(this._db)):this.isClosed()?n.nextTick(e):"closing"===this.db.status?this.once("closed",e):this._isOpening()&&this.once("open",(function(){i.close(e)})),t},v.prototype.isOpen=function(){return"open"===this.db.status},v.prototype._isOpening=function(){return"opening"===this.db.status},v.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)},v.prototype.get=function(e,t,n){if(null==e)throw new g("get() requires a key argument");var i;return(n=h(t,n))||(i=(n=d()).promise),_(this,n)||(t=p(t),this.db.get(e,t,(function(t,i){if(t)return t=/notfound/i.test(t)||t.notFound?new m("Key not found in database ["+e+"]",t):new g(t),n(t);n(null,i)}))),i},v.prototype.put=function(e,t,n,i){if(null==e)throw new f("put() requires a key argument");var r,o=this;return(i=h(n,i))||(r=(i=d()).promise),_(this,i)||(n=p(n),this.db.put(e,t,n,(function(n){if(n)return i(new f(n));o.emit("put",e,t),i()}))),r},v.prototype.del=function(e,t,n){if(null==e)throw new f("del() requires a key argument");var i,r=this;return(n=h(t,n))||(i=(n=d()).promise),_(this,n)||(t=p(t),this.db.del(e,t,(function(t){if(t)return n(new f(t));r.emit("del",e),n()}))),i},v.prototype.batch=function(e,t,n){if(!arguments.length)return new l(this);if(!Array.isArray(e))throw new f("batch() requires an array argument");var i,r=this;return(n=h(t,n))||(i=(n=d()).promise),_(this,n)||(t=p(t),this.db.batch(e,t,(function(t){if(t)return n(new f(t));r.emit("batch",e),n()}))),i},v.prototype.iterator=function(e){return this.db.iterator(e)},v.prototype.readStream=v.prototype.createReadStream=function(e){return"number"!=typeof(e=o({keys:!0,values:!0},e)).limit&&(e.limit=-1),new a(this.db.iterator(e),e)},v.prototype.keyStream=v.prototype.createKeyStream=function(e){return this.createReadStream(o(e,{keys:!0,values:!1}))},v.prototype.valueStream=v.prototype.createValueStream=function(e){return this.createReadStream(o(e,{keys:!1,values:!0}))},v.prototype.toString=function(){return"LevelUP"},v.errors=c,t.exports=v.default=v}).call(this)}).call(this,e("_process"))},{"./batch":445,"./common":446,"./promisify":448,_process:485,assert:368,"deferred-leveldown":390,events:408,"level-errors":428,"level-iterator-stream":429,util:624,xtend:632}],448:[function(e,t,n){t.exports=function(){var e,t=new Promise((function(t,n){e=function(e,i){e?n(e):t(i)}}));return e.promise=t,e}},{}],449:[function(e,t,n){(function(e){(function(){function t(e){return void 0!==e&&""!==e}function i(e,t){return Object.hasOwnProperty.call(e,t)}function r(e,t){return Object.hasOwnProperty.call(e,t)&&t}n.compare=function(t,n){if(e.isBuffer(t)){for(var i=Math.min(t.length,n.length),r=0;r<i;r++){var o=t[r]-n[r];if(o)return o}return t.length-n.length}return t<n?-1:t>n?1:0};var o=n.lowerBoundKey=function(e){return r(e,"gt")||r(e,"gte")||r(e,"min")||(e.reverse?r(e,"end"):r(e,"start"))||void 0},s=n.lowerBound=function(e,t){var n=o(e);return n?e[n]:t},a=n.lowerBoundInclusive=function(e){return!i(e,"gt")},l=n.upperBoundInclusive=function(e){return!i(e,"lt")},c=n.lowerBoundExclusive=function(e){return!a(e)},u=n.upperBoundExclusive=function(e){return!l(e)},d=n.upperBoundKey=function(e){return r(e,"lt")||r(e,"lte")||r(e,"max")||(e.reverse?r(e,"start"):r(e,"end"))||void 0},h=n.upperBound=function(e,t){var n=d(e);return n?e[n]:t};function p(e){return e}n.start=function(e,t){return e.reverse?h(e,t):s(e,t)},n.end=function(e,t){return e.reverse?s(e,t):h(e,t)},n.startInclusive=function(e){return e.reverse?l(e):a(e)},n.endInclusive=function(e){return e.reverse?a(e):l(e)},n.toLtgt=function(e,t,r,o,s){t=t||{},r=r||p;var a=arguments.length>3,l=n.lowerBoundKey(e),c=n.upperBoundKey(e);return l?"gt"===l?t.gt=r(e.gt,!1):t.gte=r(e[l],!1):a&&(t.gte=r(o,!1)),c?"lt"===c?t.lt=r(e.lt,!0):t.lte=r(e[c],!0):a&&(t.lte=r(s,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),i(t,"max")&&delete t.max,i(t,"min")&&delete t.min,i(t,"start")&&delete t.start,i(t,"end")&&delete t.end,t},n.contains=function(e,i,r){r=r||n.compare;var o=s(e);if(t(o)&&((a=r(i,o))<0||0===a&&c(e)))return!1;var a,l=h(e);return!t(l)||!((a=r(i,l))>0||0===a&&u(e))},n.filter=function(e,t){return function(i){return n.contains(e,i,t)}}}).call(this)}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":424}],450:[function(e,t,n){(function(e){(function(){!function(e){"use strict";var i={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:m,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:m,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:m,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};function r(e){this.tokens=[],this.tokens.links={},this.options=e||y.defaults,this.rules=i.normal,this.options.gfm&&(this.options.tables?this.rules=i.tables:this.rules=i.gfm)}i._label=/(?:\\[\[\]]|[^\[\]])+/,i._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,i.def=h(i.def).replace("label",i._label).replace("title",i._title).getRegex(),i.bullet=/(?:[*+-]|\d+\.)/,i.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,i.item=h(i.item,"gm").replace(/bull/g,i.bullet).getRegex(),i.list=h(i.list).replace(/bull/g,i.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+i.def.source+")").getRegex(),i._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",i.html=h(i.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,i._tag).getRegex(),i.paragraph=h(i.paragraph).replace("hr",i.hr).replace("heading",i.heading).replace("lheading",i.lheading).replace("tag","<"+i._tag).getRegex(),i.blockquote=h(i.blockquote).replace("paragraph",i.paragraph).getRegex(),i.normal=b({},i),i.gfm=b({},i.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),i.gfm.paragraph=h(i.paragraph).replace("(?!","(?!"+i.gfm.fences.source.replace("\\1","\\2")+"|"+i.list.source.replace("\\1","\\3")+"|").getRegex(),i.tables=b({},i.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),r.rules=i,r.lex=function(e,t){return new r(t).lex(e)},r.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},r.prototype.token=function(e,t){var n,r,o,s,a,l,c,u,d,h,p;for(e=e.replace(/^ +$/gm,"");e;)if((o=this.rules.newline.exec(e))&&(e=e.substring(o[0].length),o[0].length>1&&this.tokens.push({type:"space"})),o=this.rules.code.exec(e))e=e.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});else if(o=this.rules.fences.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"code",lang:o[2],text:o[3]||""});else if(o=this.rules.heading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});else if(t&&(o=this.rules.nptable.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.hr.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"hr"});else if(o=this.rules.blockquote.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,t),this.tokens.push({type:"blockquote_end"});else if(o=this.rules.list.exec(e)){for(e=e.substring(o[0].length),p=(s=o[2]).length>1,this.tokens.push({type:"list_start",ordered:p,start:p?+s:""}),n=!1,h=(o=o[0].match(this.rules.item)).length,u=0;u<h;u++)c=(l=o[u]).length,~(l=l.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&u!==h-1&&(s===(a=i.bullet.exec(o[u+1])[0])||s.length>1&&a.length>1||(e=o.slice(u+1).join("\n")+e,u=h-1)),r=n||/\n\n(?!\s*$)/.test(l),u!==h-1&&(n="\n"===l.charAt(l.length-1),r||(r=n)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(l,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(o=this.rules.html.exec(e))e=e.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===o[1]||"script"===o[1]||"style"===o[1]),text:o[0]});else if(t&&(o=this.rules.def.exec(e)))e=e.substring(o[0].length),o[3]&&(o[3]=o[3].substring(1,o[3].length-1)),d=o[1].toLowerCase(),this.tokens.links[d]||(this.tokens.links[d]={href:o[2],title:o[3]});else if(t&&(o=this.rules.table.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.lheading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:"="===o[2]?1:2,text:o[1]});else if(t&&(o=this.rules.paragraph.exec(e)))e=e.substring(o[0].length),this.tokens.push({type:"paragraph",text:"\n"===o[1].charAt(o[1].length-1)?o[1].slice(0,-1):o[1]});else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"text",text:o[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var o={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:m,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:m,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};function s(e,t){if(this.options=t||y.defaults,this.links=e,this.rules=o.normal,this.renderer=this.options.renderer||new a,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=o.breaks:this.rules=o.gfm:this.options.pedantic&&(this.rules=o.pedantic)}function a(e){this.options=e||{}}function l(){}function c(e){this.tokens=[],this.token=null,this.options=e||y.defaults,this.options.renderer=this.options.renderer||new a,this.renderer=this.options.renderer,this.renderer.options=this.options}function u(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}function h(e,t){return e=e.source,t=t||"",{replace:function(t,n){return n=(n=n.source||n).replace(/(^|[^\[])\^/g,"$1"),e=e.replace(t,n),this},getRegex:function(){return new RegExp(e,t)}}}function p(e,t){return f[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?f[" "+e]=e+"/":f[" "+e]=e.replace(/[^/]*$/,"")),e=f[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}o._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,o._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,o.autolink=h(o.autolink).replace("scheme",o._scheme).replace("email",o._email).getRegex(),o._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,o._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,o.link=h(o.link).replace("inside",o._inside).replace("href",o._href).getRegex(),o.reflink=h(o.reflink).replace("inside",o._inside).getRegex(),o.normal=b({},o),o.pedantic=b({},o.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),o.gfm=b({},o.normal,{escape:h(o.escape).replace("])","~|])").getRegex(),url:h(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",o._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:h(o.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),o.breaks=b({},o.gfm,{br:h(o.br).replace("{2,}","*").getRegex(),text:h(o.gfm.text).replace("{2,}","*").getRegex()}),s.rules=o,s.output=function(e,t,n){return new s(t,n).output(e)},s.prototype.output=function(e){for(var t,n,i,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),i="@"===r[2]?"mailto:"+(n=u(this.mangle(r[1]))):n=u(r[1]),o+=this.renderer.link(i,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):u(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(u(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=this.renderer.text(u(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else r[0]=this.rules._backpedal.exec(r[0])[0],e=e.substring(r[0].length),"@"===r[2]?i="mailto:"+(n=u(r[0])):(n=u(r[0]),i="www."===r[1]?"http://"+n:n),o+=this.renderer.link(i,null,n);return o},s.prototype.outputLink=function(e,t){var n=u(t.href),i=t.title?u(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,i,this.output(e[1])):this.renderer.image(n,i,u(e[1]))},s.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,""):e},s.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",i=e.length,r=0;r<i;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},a.prototype.code=function(e,t,n){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(n=!0,e=i)}return t?'<pre><code class="'+this.options.langPrefix+u(t,!0)+'">'+(n?e:u(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:u(e,!0))+"\n</code></pre>"},a.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},a.prototype.html=function(e){return e},a.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},a.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},a.prototype.list=function(e,t,n){var i=t?"ol":"ul";return"<"+i+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+i+">\n"},a.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},a.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},a.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},a.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},a.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},a.prototype.strong=function(e){return"<strong>"+e+"</strong>"},a.prototype.em=function(e){return"<em>"+e+"</em>"},a.prototype.codespan=function(e){return"<code>"+e+"</code>"},a.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},a.prototype.del=function(e){return"<del>"+e+"</del>"},a.prototype.link=function(e,t,n){if(this.options.sanitize){try{var i=decodeURIComponent(d(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return n}this.options.baseUrl&&!g.test(e)&&(e=p(this.options.baseUrl,e));var r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+">"+n+"</a>"},a.prototype.image=function(e,t,n){this.options.baseUrl&&!g.test(e)&&(e=p(this.options.baseUrl,e));var i='<img src="'+e+'" alt="'+n+'"';return t&&(i+=' title="'+t+'"'),i+(this.options.xhtml?"/>":">")},a.prototype.text=function(e){return e},l.prototype.strong=l.prototype.em=l.prototype.codespan=l.prototype.del=l.prototype.text=function(e){return e},l.prototype.link=l.prototype.image=function(e,t,n){return""+n},l.prototype.br=function(){return""},c.parse=function(e,t){return new c(t).parse(e)},c.prototype.parse=function(e){this.inline=new s(e.links,this.options),this.inlineText=new s(e.links,b({},this.options,{renderer:new l})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,d(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,i,r="",o="";for(n="",e=0;e<this.token.header.length;e++)n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",i=0;i<t.length;i++)n+=this.renderer.tablecell(this.inline.output(t[i]),{header:!1,align:this.token.align[i]});o+=this.renderer.tablerow(n)}return this.renderer.table(r,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var s=this.token.ordered,a=this.token.start;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,s,a);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var f={},g=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function m(){}function b(e){for(var t,n,i=1;i<arguments.length;i++)for(n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function y(e,t,n){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(n||"function"==typeof t){n||(n=t,t=null);var i,o,s=(t=b({},y.defaults,t||{})).highlight,a=0;try{i=r.lex(e,t)}catch(e){return n(e)}o=i.length;var l=function(e){if(e)return t.highlight=s,n(e);var r;try{r=c.parse(i,t)}catch(t){e=t}return t.highlight=s,e?n(e):n(null,r)};if(!s||s.length<3)return l();if(delete t.highlight,!o)return l();for(;a<i.length;a++)!function(e){"code"!==e.type?--o||l():s(e.text,e.lang,(function(t,n){return t?l(t):null==n||n===e.text?--o||l():(e.text=n,e.escaped=!0,void(--o||l()))}))}(i[a])}else try{return t&&(t=b({},y.defaults,t)),c.parse(r.lex(e,t),t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(t||y.defaults).silent)return"<p>An error occurred:</p><pre>"+u(e.message+"",!0)+"</pre>";throw e}}m.exec=m,y.options=y.setOptions=function(e){return b(y.defaults,e),y},y.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new a,xhtml:!1,baseUrl:null},y.Parser=c,y.parser=c.parse,y.Renderer=a,y.TextRenderer=l,y.Lexer=r,y.lexer=r.lex,y.InlineLexer=s,y.inlineLexer=s.output,y.parse=y,void 0!==t&&"object"==typeof n?t.exports=y:"function"==typeof define&&define.amd?define((function(){return y})):e.marked=y}(this||("undefined"!=typeof window?window:e))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],451:[function(e,t,n){t.exports=e("immediate")},{immediate:458}],452:[function(e,t,n){(function(n){(function(){var i=e("inherits"),r=e("abstract-leveldown").AbstractLevelDOWN,o=e("abstract-leveldown").AbstractIterator,s=e("ltgt"),a=e("functional-red-black-tree"),l={},c=e("./immediate");function u(e){return s.compare(e,this._end)>0}function d(e){return s.compare(e,this._end)>=0}function h(e){return s.compare(e,this._end)<0}function p(e){return s.compare(e,this._end)<=0}function f(e,t){o.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var n=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=s.upperBound(t),this._end=s.lowerBound(t),void 0===this._start?this._tree=n.end:s.upperBoundInclusive(t)?this._tree=n.le(this._start):this._tree=n.lt(this._start),this._end&&(s.lowerBoundInclusive(t)?this._test=d:this._test=u)):(this._incr="next",this._start=s.lowerBound(t),this._end=s.upperBound(t),void 0===this._start?this._tree=n.begin:s.lowerBoundInclusive(t)?this._tree=n.ge(this._start):this._tree=n.gt(this._start),this._end&&(s.upperBoundInclusive(t)?this._test=p:this._test=h))}function g(e){if(!(this instanceof g))return new g(e);r.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?l:this,this._store[this._location]=this._store[this._location]||a(s.compare)}i(f,o),f.prototype._next=function(e){var t,i;return this._done++>=this._limit?c(e):this._tree.valid?(t=this._tree.key,i=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new n(t)),this.valueAsBuffer&&(i=new n(i)),this._tree[this._incr](),void c((function(){e(null,t,i)}))):c(e)):c(e)},f.prototype._test=function(){return!0},g.clearGlobalStore=function(e){e?Object.keys(l).forEach((function(e){delete l[e]})):l={}},i(g,r),g.prototype._open=function(e,t){var n=this;c((function(){t(null,n)}))},g.prototype._put=function(e,t,n,i){null==t&&(t="");var r=this._store[this._location].find(e);r.valid?this._store[this._location]=r.update(t):this._store[this._location]=this._store[this._location].insert(e,t),c(i)},g.prototype._get=function(e,t,i){var r=this._store[this._location].get(e);if(void 0===r)return c((function(){i(new Error("NotFound"))}));!1===t.asBuffer||this._isBuffer(r)||(r=new n(String(r))),c((function(){i(null,r)}))},g.prototype._del=function(e,t,n){this._store[this._location]=this._store[this._location].remove(e),c(n)},g.prototype._batch=function(e,t,n){for(var i,r,o,s=-1,a=e.length,l=this._store[this._location];++s<a;)e[s]&&(i=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),o=l.find(i),"put"===e[s].type?(r=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),l=o.valid?o.update(r):l.insert(i,r)):l=o.remove());this._store[this._location]=l,c(n)},g.prototype._iterator=function(e){return new f(this,e)},g.prototype._isBuffer=function(e){return n.isBuffer(e)},g.destroy=function(e,t){var n="$"+e;n in l&&delete l[n],c(t)},t.exports=g}).call(this)}).call(this,e("buffer").Buffer)},{"./immediate":451,"abstract-leveldown":456,buffer:381,"functional-red-black-tree":412,inherits:423,ltgt:464}],453:[function(e,t,n){(function(e){(function(){function n(e){this._db=e,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(e,t){this._checkWritten();var n=this._db._checkKey(e,"key",this._db._isBuffer);if(n)throw n;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},n.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},n.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},n.prototype.write=function(t,n){if(this._checkWritten(),"function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(n):"function"==typeof this._db._batch?this._db._batch(this._operations,t,n):void e.nextTick(n)},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:485}],454:[function(e,t,n){(function(e){(function(){function n(e){this.db=e,this._ended=!1,this._nexting=!1}n.prototype.next=function(t){var n=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return n._ended?t(new Error("cannot call next() after end()")):n._nexting?t(new Error("cannot call next() before previous next() has completed")):(n._nexting=!0,"function"==typeof n._next?n._next((function(){n._nexting=!1,t.apply(null,arguments)})):void e.nextTick((function(){n._nexting=!1,t()})))},n.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=n}).call(this)}).call(this,e("_process"))},{_process:485}],455:[function(e,t,n){(function(n,i){(function(){var r=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var n=this,r=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,(function(e){if(e)return n.status=r,t(e);n.status="open",t()}))):(this.status="open",i.nextTick(t))},a.prototype.close=function(e){var t=this,n=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close((function(i){if(i)return t.status=n,e(i);t.status="closed",e()}))):(this.status="closed",i.nextTick(e))},a.prototype.get=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("get() requires a callback argument");return(r=this._checkKey(e,"key",this._isBuffer))?n(r):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,n):void i.nextTick((function(){n(new Error("NotFound"))})))},a.prototype.put=function(e,t,n,r){var o;if("function"==typeof n&&(r=n),"function"!=typeof r)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?r(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||i.browser||(t=String(t)),"object"!=typeof n&&(n={}),"function"==typeof this._put?this._put(e,t,n,r):void i.nextTick(r))},a.prototype.del=function(e,t,n){var r;if("function"==typeof t&&(n=t),"function"!=typeof n)throw new Error("del() requires a callback argument");return(r=this._checkKey(e,"key",this._isBuffer))?n(r):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,n):void i.nextTick(n))},a.prototype.batch=function(e,t,n){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(n=t),"function"==typeof e&&(n=e),"function"!=typeof n)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var r,o,s=0,a=e.length;s<a;s++)if("object"==typeof(r=e[s])){if(o=this._checkKey(r.type,"type",this._isBuffer))return n(o);if(o=this._checkKey(r.key,"key",this._isBuffer))return n(o)}if("function"==typeof this._batch)return this._batch(e,t,n);i.nextTick(n)},a.prototype.approximateSize=function(e,t,n){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof n)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,n);i.nextTick((function(){n(null,0)}))},a.prototype._setupIteratorOptions=function(e){var t=this;return e=r(e),["start","end","gt","gte","lt","lte"].forEach((function(n){e[n]&&t._isBuffer(e[n])&&0===e[n].length&&delete e[n]})),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return n.isBuffer(e)},a.prototype._checkKey=function(e,t){if(null==e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=a}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":424,"./abstract-chained-batch":453,"./abstract-iterator":454,_process:485,xtend:632}],456:[function(e,t,n){n.AbstractLevelDOWN=e("./abstract-leveldown"),n.AbstractIterator=e("./abstract-iterator"),n.AbstractChainedBatch=e("./abstract-chained-batch"),n.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":453,"./abstract-iterator":454,"./abstract-leveldown":455,"./is-leveldown":457}],457:[function(e,t,n){var i=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(i.prototype).filter((function(e){return"_"!=e[0]&&"approximateSize"!=e})).every((function(t){return"function"==typeof e[t]}))}},{"./abstract-leveldown":455}],458:[function(e,t,n){"use strict";var i,r,o,s=[e("./nextTick"),e("./queueMicrotask"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=-1,l=[],c=!1;function u(){i&&r&&(i=!1,r.length?l=r.concat(l):a=-1,l.length&&d())}function d(){if(!i){c=!1,i=!0;for(var e=l.length,t=setTimeout(u);e;){for(r=l,l=[];r&&++a<e;)r[a].run();a=-1,e=l.length}r=null,a=-1,i=!1,clearTimeout(t)}}for(var h=-1,p=s.length;++h<p;)if(s[h]&&s[h].test&&s[h].test()){o=s[h].install(d);break}function f(e,t){this.fun=e,this.array=t}f.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),c||i||(c=!0,o())}},{"./messageChannel":459,"./mutation.js":460,"./nextTick":380,"./queueMicrotask":461,"./stateChange":462,"./timeout":463}],459:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],460:[function(e,t,n){(function(e){(function(){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return t},n.install=function(n){var i=0,r=new t(n),o=e.document.createTextNode("");return r.observe(o,{characterData:!0}),function(){o.data=i=++i%2}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],461:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return"function"==typeof e.queueMicrotask},n.install=function(t){return function(){e.queueMicrotask(t)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],462:[function(e,t,n){(function(e){(function(){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],463:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],464:[function(e,t,n){(function(e){(function(){function t(e,t){return Object.hasOwnProperty.call(e,t)}function i(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function r(e,t){return Object.hasOwnProperty.call(e,t)&&t}n.compare=function(t,n){if(e.isBuffer(t)){for(var i=Math.min(t.length,n.length),r=0;r<i;r++){var o=t[r]-n[r];if(o)return o}return t.length-n.length}return t<n?-1:t>n?1:0};var o=n.lowerBoundKey=function(e){return r(e,"gt")||r(e,"gte")||r(e,"min")||(e.reverse?r(e,"end"):r(e,"start"))||void 0},s=n.lowerBound=function(e){var t=o(e);return t&&e[t]},a=n.lowerBoundInclusive=function(e){return!t(e,"gt")},l=n.upperBoundInclusive=function(e){return!t(e,"lt")},c=n.lowerBoundExclusive=function(e){return!a(e)},u=n.upperBoundExclusive=function(e){return!l(e)},d=n.upperBoundKey=function(e){return r(e,"lt")||r(e,"lte")||r(e,"max")||(e.reverse?r(e,"start"):r(e,"end"))||void 0},h=n.upperBound=function(e){var t=d(e);return t&&e[t]};function p(e){return e}n.toLtgt=function(e,i,r,o,s){i=i||{},r=r||p;var a=arguments.length>3,l=n.lowerBoundKey(e),c=n.upperBoundKey(e);return l?"gt"===l?i.gt=r(e.gt,!1):i.gte=r(e[l],!1):a&&(i.gte=r(o,!1)),c?"lt"===c?i.lt=r(e.lt,!0):i.lte=r(e[c],!0):a&&(i.lte=r(s,!0)),null!=e.reverse&&(i.reverse=!!e.reverse),t(i,"max")&&delete i.max,t(i,"min")&&delete i.min,t(i,"start")&&delete i.start,t(i,"end")&&delete i.end,i},n.contains=function(e,t,r){r=r||n.compare;var o=s(e);if(i(o)&&((a=r(t,o))<0||0===a&&c(e)))return!1;var a,l=h(e);return!i(l)||!((a=r(t,l))>0||0===a&&u(e))},n.filter=function(e,t){return function(i){return n.contains(e,i,t)}}}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":424}],465:[function(e,t,n){"use strict";var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,l=s(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))r.call(n,u)&&(l[u]=n[u]);if(i){a=i(n);for(var d=0;d<a.length;d++)o.call(n,a[d])&&(l[a[d]]=n[a[d]])}}return l}},{}],466:[function(e,t,n){"use strict";var i;if(!Object.keys){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=e("./isArguments"),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},h={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!h["$"+e]&&r.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();i=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===o.call(e),i=s(e),a=t&&"[object String]"===o.call(e),h=[];if(!t&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var f=c&&n;if(a&&e.length>0&&!r.call(e,0))for(var g=0;g<e.length;++g)h.push(String(g));if(i&&e.length>0)for(var m=0;m<e.length;++m)h.push(String(m));else for(var b in e)f&&"prototype"===b||!r.call(e,b)||h.push(String(b));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return d(e);try{return d(e)}catch(e){return!1}}(e),v=0;v<u.length;++v)y&&"constructor"===u[v]||!r.call(e,u[v])||h.push(u[v]);return h}}t.exports=i},{"./isArguments":468}],467:[function(e,t,n){"use strict";var i=Array.prototype.slice,r=e("./isArguments"),o=Object.keys,s=o?function(e){return o(e)}:e("./implementation"),a=Object.keys;s.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return r(e)?a(i.call(e)):a(e)}):Object.keys=s,Object.keys||s},t.exports=s},{"./implementation":466,"./isArguments":468}],468:[function(e,t,n){"use strict";var i=Object.prototype.toString;t.exports=function(e){var t=i.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===i.call(e.callee)),n}},{}],469:[function(e,t,n){"use strict";var i=e("object-keys"),r=e("has-symbols/shams")(),o=e("call-bind/callBound"),s=Object,a=o("Array.prototype.push"),l=o("Object.prototype.propertyIsEnumerable"),c=r?Object.getOwnPropertySymbols:null;t.exports=function(e,t){if(null==e)throw new TypeError("target must be an object");var n=s(e);if(1===arguments.length)return n;for(var o=1;o<arguments.length;++o){var u=s(arguments[o]),d=i(u),h=r&&(Object.getOwnPropertySymbols||c);if(h)for(var p=h(u),f=0;f<p.length;++f){var g=p[f];l(u,g)&&a(d,g)}for(var m=0;m<d.length;++m){var b=d[m];if(l(u,b)){var y=u[b];n[b]=y}}}return n}},{"call-bind/callBound":382,"has-symbols/shams":418,"object-keys":467}],470:[function(e,t,n){"use strict";var i=e("./implementation");t.exports=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),n={},i=0;i<t.length;++i)n[t[i]]=t[i];var r=Object.assign({},n),o="";for(var s in r)o+=s;return e!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}return!1}()?i:Object.assign:i}},{"./implementation":469}],471:[function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=i(e("levelup")),o=i(e("sublevel-pouchdb")),s=e("through2"),a=i(e("argsarray")),l=i(e("double-ended-queue")),c=i(e("buffer-from")),u=e("pouchdb-adapter-utils"),d=e("pouchdb-merge"),h=e("pouchdb-json"),p=e("pouchdb-md5"),f=e("pouchdb-binary-utils"),g=e("pouchdb-collections"),m=e("pouchdb-utils"),b=e("pouchdb-errors");function y(e,t){var n=new Uint8Array(e);return f.blob([n],{type:t})}function v(e,t){f.readAsBinaryString(e,t)}function _(e,t){var n=t.prefix()[0],i=e._cache,r=i.get(n);return r||(r=new g.Map,i.set(n,r)),r}function E(){this._batch=[],this._cache=new g.Map}E.prototype.get=function(e,t,n){var i=_(this,e),r=i.get(t);return r?m.nextTick((function(){n(null,r)})):null===r?m.nextTick((function(){n({name:"NotFoundError"})})):void e.get(t,(function(e,r){if(e)return"NotFoundError"===e.name&&i.set(t,null),n(e);i.set(t,r),n(null,r)}))},E.prototype.batch=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t],r=_(this,i.prefix);"put"===i.type?r.set(i.key,i.value):r.set(i.key,null)}this._batch=this._batch.concat(e)},E.prototype.execute=function(e,t){for(var n=new g.Set,i=[],r=this._batch.length-1;r>=0;r--){var o=this._batch[r],s=o.prefix.prefix()[0]+""+o.key;n.has(s)||(n.add(s),i.push(o))}e.batch(i,t)};var T=new g.Map,x="_local_last_update_seq",w="_local_doc_count",k="_local_uuid",S={encode:h.safeJsonStringify,decode:h.safeJsonParse,buffer:!1,type:"cheap-json"},C=new m.changesHandler;function A(e){return"winningRev"in e?e.winningRev:d.winningRev(e)}function I(e,t){return"deleted"in e?e.deleted:u.isDeleted(e,t)}function O(e,t,n){var i=[];return e.forEach((function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach((function(t){var n=e.doc._attachments[t];"data"in n||i.push(n)}))})),Promise.all(i.map((function(e){return function(e,t,n){var i=e.content_type;return new Promise((function(r,o){t.binaryStore.get(e.digest,(function(t,s){var a;if(t){if("NotFoundError"!==t.name)return o(t);a=n.binary?f.binaryStringToBlobOrBuffer("",i):""}else a=n.binary?y(s,i):s.toString("base64");delete e.stub,delete e.length,e.data=a,r()}))}))}(e,t,n)})))}t.exports=function(e,t){e=m.clone(e);var n,i,h=this,_={},N=e.revs_limit,R=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var D,L=e.db,M=m.functionName(L);function P(){_.docStore=i.sublevel("document-store",{valueEncoding:S}),_.bySeqStore=i.sublevel("by-sequence",{valueEncoding:"json"}),_.attachmentStore=i.sublevel("attach-store",{valueEncoding:"json"}),_.binaryStore=i.sublevel("attach-binary-store",{valueEncoding:"binary"}),_.localStore=i.sublevel("local-store",{valueEncoding:"json"}),_.metaStore=i.sublevel("meta-store",{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(i,_,B):B()}function B(){_.metaStore.get(x,(function(e,r){void 0===i._updateSeq&&(i._updateSeq=r||0),_.metaStore.get(w,(function(e,r){i._docCount=e?0:r,_.metaStore.get(k,(function(e,i){n=e?m.uuid():i,_.metaStore.put(k,n,(function(){m.nextTick((function(){t(null,h)}))}))}))}))}))}function j(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function F(){var e=i._queue.peekFront();"read"===e.type?function(e){for(var t=[e],n=1,r=i._queue.get(n);void 0!==r&&"read"===r.type;)t.push(r),n++,r=i._queue.get(n);var o=0;t.forEach((function(e){var n=e.args,r=n[n.length-1];n[n.length-1]=a((function(e){r.apply(null,e),++o===t.length&&m.nextTick((function(){t.forEach((function(){i._queue.shift()})),i._queue.length&&F()}))})),j(e.fun,n)}))}(e):function(e){var t=e.args,n=t[t.length-1];t[t.length-1]=a((function(e){n.apply(null,e),m.nextTick((function(){i._queue.shift(),i._queue.length&&F()}))})),j(e.fun,t)}(e)}function $(e){return a((function(t){i._queue.push({fun:e,args:t,type:"write"}),1===i._queue.length&&m.nextTick(F)}))}function U(e){return a((function(t){i._queue.push({fun:e,args:t,type:"read"}),1===i._queue.length&&m.nextTick(F)}))}function H(e){return("0000000000000000"+e).slice(-16)}function G(e,t){"destroy"in L?L.destroy(e,t):t(null)}T.has(M)?D=T.get(M):(D=new g.Map,T.set(M,D)),D.has(R)?(i=D.get(R),P()):D.set(R,o(r(L(R),e,(function(n){if(n)return D.delete(R),t(n);(i=D.get(R))._docCount=-1,i._queue=new l,"object"==typeof e.migrate?e.migrate.doMigrationOne(R,i,P):P()})))),h._remote=!1,h.type=function(){return"leveldb"},h._id=function(e){e(null,n)},h._info=function(e){var t={doc_count:i._docCount,update_seq:i._updateSeq,backend_adapter:m.functionName(L)};return m.nextTick((function(){e(null,t)}))},h._get=U((function(e,t,n){t=m.clone(t),_.docStore.get(e,(function(e,i){if(e||!i)return n(b.createError(b.MISSING_DOC,"missing"));var r;if(t.rev)r=t.latest?d.latest(t.rev,i):t.rev;else if(r=A(i),I(i,r))return n(b.createError(b.MISSING_DOC,"deleted"));var o=i.rev_map[r];_.bySeqStore.get(H(o),(function(e,t){if(!t)return n(b.createError(b.MISSING_DOC));if("_id"in t&&t._id!==i.id)return n(new Error("wrong doc returned"));if(t._id=i.id,"_rev"in t){if(t._rev!==r)return n(new Error("wrong doc returned"))}else t._rev=r;return n(null,{doc:t,metadata:i})}))}))})),h._getAttachment=function(e,t,n,i,r){var o=n.digest,s=n.content_type;_.binaryStore.get(o,(function(e,t){if(e)return"NotFoundError"!==e.name?r(e):r(null,i.binary?function(e){return f.blob([""],{type:e})}(s):"");i.binary?r(null,y(t,s)):r(null,t.toString("base64"))}))},h._bulkDocs=$((function(e,t,n){var r=t.new_edits,o=new Array(e.docs.length),s=new g.Map,a=new g.Map,l=new E,y=0,T=i._updateSeq,k=e.docs,S=k.map((function(e){if(e._id&&u.isLocalId(e._id))return e;var t=u.parseDoc(e,r,h.__opts);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t})),A=S.filter((function(e){return e.error}));if(A.length)return n(A[0]);function I(e,t){var n=Promise.resolve();e.forEach((function(e,t){n=n.then((function(){return new Promise((function(n,i){h._doCompactionNoLock(t,e,{ctx:l},(function(e){if(e)return i(e);n()}))}))}))})),n.then((function(){t()}),t)}function O(){I(a,(function(e){if(e&&P(e),h.auto_compaction)return t=P,n=new g.Map,s.forEach((function(e,t){n.set(t,d.compactTree(e))})),void I(n,t);var t,n;P()}))}function D(e,t,i,r,u,d,h,g){y+=d;var m=null,E=0;e.metadata.winningRev=t,e.metadata.deleted=i,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,r&&(e.data._deleted=!0),e.stemmedRevs.length&&a.set(e.metadata.id,e.stemmedRevs);var x=e.data._attachments?Object.keys(e.data._attachments):[];function w(e){E++,m||(e?g(m=e):E===x.length&&O())}function k(e,t,n){return function(i){p.binaryMd5(i,function(e,t,n,i){return function(r){!function(e,t,n,i,r){var o=e.data._attachments[n];delete o.data,o.digest=t,o.length=i.length;var s=e.metadata.id,a=e.metadata.rev;o.revpos=parseInt(a,10),M(s,a,t,(function(e,n){return e||0===i.length?r(e):n?(l.batch([{type:"put",prefix:_.binaryStore,key:t,value:c(i,"binary")}]),void r()):r(e)}))}(e,"md5-"+r,t,n,i)}}(e,t,i,n))}}for(var S=0;S<x.length;S++){var C,A=x[S],I=e.data._attachments[A];if(I.stub)M(e.data._id,e.data._rev,I.digest,w);else if("string"==typeof I.data){try{C=f.atob(I.data)}catch(e){return void n(b.createError(b.BAD_ARG,"Attachment is not a valid base64 string"))}k(e,A,w)(C)}else v(I.data,k(e,A,w))}function O(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return g();t=++T,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var n=[{key:H(t),value:e.data,prefix:_.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:_.docStore,type:"put"}];l.batch(n),o[h]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},s.set(e.metadata.id,e.metadata),g()}x.length||O()}var L={};function M(e,t,n,i){function r(i){var r=[e,t].join("@"),o={};return i?i.refs&&(o.refs=i.refs,o.refs[r]=!0):(o.refs={},o.refs[r]=!0),new Promise((function(e){l.batch([{type:"put",prefix:_.attachmentStore,key:n,value:o}]),e(!i)}))}var o=L[n]||Promise.resolve();L[n]=o.then((function(){return new Promise((function(e,t){l.get(_.attachmentStore,n,(function(n,i){if(n&&"NotFoundError"!==n.name)return t(n);e(i)}))})).then(r).then((function(e){i(null,e)}),i)}))}function P(e){if(e)return m.nextTick((function(){n(e)}));l.batch([{prefix:_.metaStore,type:"put",key:x,value:T},{prefix:_.metaStore,type:"put",key:w,value:i._docCount+y}]),l.execute(i,(function(e){if(e)return n(e);i._docCount+=y,i._updateSeq=T,C.notify(R),m.nextTick((function(){n(null,o)}))}))}if(!S.length)return n(null,[]);!function(e){var t=[];if(k.forEach((function(e){e&&e._attachments&&Object.keys(e._attachments).forEach((function(n){var i=e._attachments[n];i.stub&&t.push(i.digest)}))})),!t.length)return e();var n,i=0;t.forEach((function(r){!function(e,t){l.get(_.attachmentStore,e,(function(n){if(n){var i=b.createError(b.MISSING_STUB,"unknown stub attachment with digest "+e);t(i)}else t()}))}(r,(function(r){r&&!n&&(n=r),++i===t.length&&e(n)}))}))}((function(e){if(e)return n(e);!function(e){var t,n=0;function i(){if(++n===k.length)return e(t)}k.forEach((function(e){if(e._id&&u.isLocalId(e._id))return i();l.get(_.docStore,e._id,(function(n,r){n?"NotFoundError"!==n.name&&(t=n):s.set(e._id,r),i()}))}))}((function(e){if(e)return n(e);u.processDocs(N,S,h,s,l,o,D,t,O)}))}))})),h._allDocs=function(e,t){return"keys"in e?u.allDocsKeysQuery(this,e):U((function(e,t){e=m.clone(e),function(e){i.isClosed()?e(new Error("database is closed")):e(null,i._docCount)}((function(n,r){if(n)return t(n);var o,a={},l=e.skip||0;if(e.startkey&&(a.gte=e.startkey),e.endkey&&(a.lte=e.endkey),e.key&&(a.gte=a.lte=e.key),e.descending){a.reverse=!0;var c=a.lte;a.lte=a.gte,a.gte=c}if("number"==typeof e.limit&&(o=e.limit),0===o||"gte"in a&&"lte"in a&&a.gte>a.lte){var u={total_rows:r,offset:e.skip,rows:[]};return e.update_seq&&(u.update_seq=i._updateSeq),t(null,u)}var h=[],p=_.docStore.readStream(a),f=s.obj((function(t,n,i){var r=t.value,s=A(r),a=I(r,s);if(a){if("ok"!==e.deleted)return void i()}else{if(l-- >0)return void i();if("number"==typeof o&&o--<=0)return p.unpipe(),p.destroy(),void i()}function c(t){var n={id:r.id,key:r.id,value:{rev:s}};if(e.include_docs){if(n.doc=t,n.doc._rev=n.value.rev,e.conflicts){var o=d.collectConflicts(r);o.length&&(n.doc._conflicts=o)}for(var l in n.doc._attachments)n.doc._attachments.hasOwnProperty(l)&&(n.doc._attachments[l].stub=!0)}if(!1===e.inclusive_end&&r.id===e.endkey)return i();if(a){if("ok"!==e.deleted)return i();n.value.deleted=!0,n.doc=null}h.push(n),i()}if(e.include_docs){var u=r.rev_map[s];_.bySeqStore.get(H(u),(function(e,t){c(t)}))}else c()}),(function(n){Promise.resolve().then((function(){if(e.include_docs&&e.attachments)return O(h,_,e)})).then((function(){var n={total_rows:r,offset:e.skip,rows:h};e.update_seq&&(n.update_seq=i._updateSeq),t(null,n)}),t),n()})).on("unpipe",(function(){f.end()}));p.on("error",t),p.pipe(f)}))}))(e,t)},h._changes=function(e){if((e=m.clone(e)).continuous){var t=R+":"+m.uuid();return C.addListener(R,t,h,e),C.notify(R),{cancel:function(){C.removeListener(R,t)}}}var n,r=e.descending,o=[],a=e.since||0,l=0,c={reverse:r};"limit"in e&&e.limit>0&&(n=e.limit),c.reverse||(c.start=H(e.since||0));var d=e.doc_ids&&new g.Set(e.doc_ids),p=m.filterChange(e),f=new g.Map;function b(){e.done=!0,e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),y.unpipe(v),y.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments&&e.return_docs?O(o,_,e).then((function(){e.complete(null,{results:o,last_seq:a})})):e.complete(null,{results:o,last_seq:a}))}var y=_.bySeqStore.readStream(c),v=s.obj((function(t,s,c){if(n&&l>=n)return b(),c();if(e.cancelled||e.done)return c();var h,g,m=(h=t.key,parseInt(h,10)),y=t.value;if(m===e.since&&!r)return c();if(d&&!d.has(y._id))return c();function v(t){var n=A(t);function i(n){var i=e.processChange(n,t,e);i.seq=t.seq;var r=p(i);if("object"==typeof r)return e.complete(r);r&&(l++,e.attachments&&e.include_docs?O([i],_,e).then((function(){e.onChange(i)})):e.onChange(i),e.return_docs&&o.push(i)),c()}if(t.seq!==m)return c();if(a=m,n===y._rev)return i(y);var r=t.rev_map[n];_.bySeqStore.get(H(r),(function(e,t){i(t)}))}if(g=f.get(y._id))return v(g);_.docStore.get(y._id,(function(t,n){if(e.cancelled||e.done||i.isClosed()||u.isLocalId(n.id))return c();f.set(y._id,n),v(n)}))}),(function(t){if(e.cancelled)return t();e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()})).on("unpipe",(function(){v.end(),b()}));return y.pipe(v),{cancel:function(){e.cancelled=!0,b()}}},h._close=function(e){if(i.isClosed())return e(b.createError(b.NOT_OPEN));i.close((function(t){t?e(t):(D.delete(R),e())}))},h._getRevisionTree=function(e,t){_.docStore.get(e,(function(e,n){e?t(b.createError(b.MISSING_DOC)):t(null,n.rev_tree)}))},h._doCompaction=$((function(e,t,n,i){h._doCompactionNoLock(e,t,n,i)})),h._doCompactionNoLock=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),!t.length)return r();var o=n.ctx||new E;o.get(_.docStore,e,(function(s,a){if(s)return r(s);var l=t.map((function(e){var t=a.rev_map[e];return delete a.rev_map[e],t}));d.traverseRevTree(a.rev_tree,(function(e,n,i,r,o){var s=n+"-"+i;-1!==t.indexOf(s)&&(o.status="missing")}));var c=[];c.push({key:a.id,value:a,type:"put",prefix:_.docStore});var u,h={},p=0;function f(n){if(n&&(u=n),++p===t.length){if(u)return r(u);!function(){var n=Object.keys(h);if(!n.length)return m();var i,r=0;function s(e){e&&(i=e),++r===n.length&&m(i)}var a=new g.Map;t.forEach((function(t){a.set(e+"@"+t,!0)})),n.forEach((function(e){o.get(_.attachmentStore,e,(function(t,n){if(t)return"NotFoundError"===t.name?s():s(t);var i=Object.keys(n.refs||{}).filter((function(e){return!a.has(e)})),r={};i.forEach((function(e){r[e]=!0})),i.length?c.push({key:e,type:"put",value:{refs:r},prefix:_.attachmentStore}):c=c.concat([{key:e,type:"del",prefix:_.attachmentStore},{key:e,type:"del",prefix:_.binaryStore}]),s()}))}))}()}}function m(e){return e?r(e):(o.batch(c),n.ctx?r():void o.execute(i,r))}l.forEach((function(e){c.push({key:H(e),type:"del",prefix:_.bySeqStore}),o.get(_.bySeqStore,H(e),(function(e,t){if(e)return"NotFoundError"===e.name?f():f(e);Object.keys(t._attachments||{}).forEach((function(e){var n=t._attachments[e].digest;h[n]=!0})),f()}))}))}))},h._getLocal=function(e,t){_.localStore.get(e,(function(e,n){e?t(b.createError(b.MISSING_DOC)):t(null,n)}))},h._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?h._putLocalNoLock(e,t,n):h._putLocalWithLock(e,t,n)},h._putLocalWithLock=$((function(e,t,n){h._putLocalNoLock(e,t,n)})),h._putLocalNoLock=function(e,t,n){delete e._revisions;var r=e._rev,o=e._id,s=t.ctx||new E;s.get(_.localStore,o,(function(a,l){if(a&&r)return n(b.createError(b.REV_CONFLICT));if(l&&l._rev!==r)return n(b.createError(b.REV_CONFLICT));e._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var c=[{type:"put",prefix:_.localStore,key:o,value:e}];s.batch(c);var u={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return n(null,u);s.execute(i,(function(e){if(e)return n(e);n(null,u)}))}))},h._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),t.ctx?h._removeLocalNoLock(e,t,n):h._removeLocalWithLock(e,t,n)},h._removeLocalWithLock=$((function(e,t,n){h._removeLocalNoLock(e,t,n)})),h._removeLocalNoLock=function(e,t,n){var r=t.ctx||new E;r.get(_.localStore,e._id,(function(o,s){if(o)return"NotFoundError"!==o.name?n(o):n(b.createError(b.MISSING_DOC));if(s._rev!==e._rev)return n(b.createError(b.REV_CONFLICT));r.batch([{prefix:_.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return n(null,a);r.execute(i,(function(e){if(e)return n(e);n(null,a)}))}))},h._destroy=function(e,t){var n,i=m.functionName(L);if(!T.has(i))return G(R,t);(n=T.get(i)).has(R)?(C.removeAllListeners(R),n.get(R).close((function(){n.delete(R),G(R,t)}))):G(R,t)}}},{argsarray:367,"buffer-from":472,"double-ended-queue":397,levelup:447,"pouchdb-adapter-utils":475,"pouchdb-binary-utils":476,"pouchdb-collections":477,"pouchdb-errors":478,"pouchdb-json":479,"pouchdb-md5":480,"pouchdb-merge":481,"pouchdb-utils":482,"sublevel-pouchdb":611,through2:473}],472:[function(e,t,n){(function(e){(function(){var n=Object.prototype.toString,i="function"==typeof e.alloc&&"function"==typeof e.allocUnsafe&&"function"==typeof e.from;t.exports=function(t,r,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return function(e){return"ArrayBuffer"===n.call(e).slice(8,-1)}(t)?function(t,n,r){n>>>=0;var o=t.byteLength-n;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===r)r=o;else if((r>>>=0)>o)throw new RangeError("'length' is out of bounds");return i?e.from(t.slice(n,n+r)):new e(new Uint8Array(t.slice(n,n+r)))}(t,r,o):"string"==typeof t?function(t,n){if("string"==typeof n&&""!==n||(n="utf8"),!e.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');return i?e.from(t,n):new e(t,n)}(t,r):i?e.from(t):new e(t)}}).call(this)}).call(this,e("buffer").Buffer)},{buffer:381}],473:[function(e,t,n){(function(n){(function(){var i=e("readable-stream").Transform,r=e("util").inherits;function o(e){i.call(this,e),this._destroyed=!1}function s(e,t,n){n(null,e)}function a(e){return function(t,n,i){return"function"==typeof t&&(i=n,n=t,t={}),"function"!=typeof n&&(n=s),"function"!=typeof i&&(i=null),e(t,n,i)}}r(o,i),o.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;n.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=a((function(e,t,n){var i=new o(e);return i._transform=t,n&&(i._flush=n),i})),t.exports.ctor=a((function(e,t,n){function i(t){if(!(this instanceof i))return new i(t);this.options=Object.assign({},e,t),o.call(this,this.options)}return r(i,o),i.prototype._transform=t,n&&(i.prototype._flush=n),i})),t.exports.obj=a((function(e,t,n){var i=new o(Object.assign({objectMode:!0,highWaterMark:16},e));return i._transform=t,n&&(i._flush=n),i}))}).call(this)}).call(this,e("_process"))},{_process:485,"readable-stream":562,util:624}],474:[function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e("pouchdb-utils"),o=i(e("pouchdb-adapter-leveldb-core")),s=i(e("memdown"));function a(e,t){var n=r.assign({db:s},e);o.call(this,n,t)}a.valid=function(){return!0},a.use_prefix=!1,t.exports=function(e){e.adapter("memory",a,!0)}},{memdown:452,"pouchdb-adapter-leveldb-core":471,"pouchdb-utils":482}],475:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("pouchdb-utils"),r=e("pouchdb-binary-utils"),o=e("pouchdb-md5"),s=e("pouchdb-collections"),a=e("pouchdb-errors"),l=e("pouchdb-merge");function c(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}var u=c(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),d=c(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function h(e){if(!/^\d+-/.test(e))return a.createError(a.INVALID_REV);var t=e.indexOf("-"),n=e.substring(0,t),i=e.substring(t+1);return{prefix:parseInt(n,10),id:i}}function p(e,t,n){var r,o,s;n||(n={deterministic_revs:!0});var l={status:"available"};if(e._deleted&&(l.deleted=!0),t)if(e._id||(e._id=i.uuid()),o=i.rev(e,n.deterministic_revs),e._rev){if((s=h(e._rev)).error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[o,l,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[o,l,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,i=e.ids,r=[i[0],t,[]],o=1,s=i.length;o<s;o++)r=[i[o],{status:"missing"},[r]];return[{pos:n,ids:r}]}(e._revisions,l),r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if((s=h(e._rev)).error)return s;r=s.prefix,o=s.id,e._rev_tree=[{pos:r,ids:[o,l,[]]}]}i.invalidIdError(e._id),e._rev=r+"-"+o;var c={metadata:{},data:{}};for(var p in e)if(Object.prototype.hasOwnProperty.call(e,p)){var f="_"===p[0];if(f&&!u[p]){var g=a.createError(a.DOC_VALIDATION,p);throw g.message=a.DOC_VALIDATION.message+": "+p,g}f&&!d[p]?c.metadata[p.slice(1)]=e[p]:c.data[p]=e[p]}return c}function f(e,t,n){var i=function(e){try{return r.atob(e)}catch(e){return{error:a.createError(a.BAD_ARG,"Attachment is not a valid base64 string")}}}(e.data);if(i.error)return n(i.error);e.length=i.length,e.data="blob"===t?r.binaryStringToBlobOrBuffer(i,e.content_type):"base64"===t?r.btoa(i):i,o.binaryMd5(i,(function(t){e.digest="md5-"+t,n()}))}function g(e,t,n){if(e.stub)return n();"string"==typeof e.data?f(e,t,n):function(e,t,n){o.binaryMd5(e.data,(function(i){e.digest="md5-"+i,e.length=e.data.size||e.data.length||0,"binary"===t?r.blobOrBufferToBinaryString(e.data,(function(t){e.data=t,n()})):"base64"===t?r.blobOrBufferToBase64(e.data,(function(t){e.data=t,n()})):n()}))}(e,t,n)}function m(e,t,n,i,r,o,s,c){if(l.revExists(t.rev_tree,n.metadata.rev)&&!c)return i[r]=n,o();var u=t.winningRev||l.winningRev(t),d="deleted"in t?t.deleted:l.isDeleted(t,u),h="deleted"in n.metadata?n.metadata.deleted:l.isDeleted(n.metadata),f=/^1-/.test(n.metadata.rev);if(d&&!h&&c&&f){var g=n.data;g._rev=u,g._id=n.metadata.id,n=p(g,c)}var m=l.merge(t.rev_tree,n.metadata.rev_tree[0],e);if(c&&(d&&h&&"new_leaf"!==m.conflicts||!d&&"new_leaf"!==m.conflicts||d&&!h&&"new_branch"===m.conflicts)){var b=a.createError(a.REV_CONFLICT);return i[r]=b,o()}var y=n.metadata.rev;n.metadata.rev_tree=m.tree,n.stemmedRevs=m.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var v=l.winningRev(n.metadata),_=l.isDeleted(n.metadata,v),E=d===_?0:d<_?-1:1;s(n,v,_,y===v?_:l.isDeleted(n.metadata,y),!0,E,r,o)}n.invalidIdError=i.invalidIdError,n.normalizeDdocFunctionName=i.normalizeDdocFunctionName,n.parseDdocFunctionName=i.parseDdocFunctionName,n.isDeleted=l.isDeleted,n.isLocalId=l.isLocalId,n.allDocsKeysQuery=function(e,t){var n=t.keys,r={offset:t.skip};return Promise.all(n.map((function(n){var o=i.assign({key:n,deleted:"ok"},t);return["limit","skip","keys"].forEach((function(e){delete o[e]})),new Promise((function(i,s){e._allDocs(o,(function(e,o){if(e)return s(e);t.update_seq&&void 0!==o.update_seq&&(r.update_seq=o.update_seq),r.total_rows=o.total_rows,i(o.rows[0]||{key:n,error:"not_found"})}))}))}))).then((function(e){return r.rows=e,r}))},n.parseDoc=p,n.preprocessAttachments=function(e,t,n){if(!e.length)return n();var i,r=0;function o(){r++,e.length===r&&(i?n(i):n())}e.forEach((function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!n.length)return o();function s(e){i=e,++r===n.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&g(e.data._attachments[a],t,s)}))},n.processDocs=function(e,t,n,i,r,o,c,u,d){e=e||1e3;var h=u.new_edits,p=new s.Map,f=0,g=t.length;function b(){++f===g&&d&&d()}t.forEach((function(e,t){if(e._id&&l.isLocalId(e._id)){var i=e._deleted?"_removeLocal":"_putLocal";n[i](e,{ctx:r},(function(e,n){o[t]=e||n,b()}))}else{var s=e.metadata.id;p.has(s)?(g--,p.get(s).push([e,t])):p.set(s,[[e,t]])}})),p.forEach((function(t,n){var r=0;function s(){++r<t.length?d():b()}function d(){var d=t[r],p=d[0],f=d[1];if(i.has(n))m(e,i.get(n),p,o,f,s,c,h);else{var g=l.merge([],p.metadata.rev_tree[0],e);p.metadata.rev_tree=g.tree,p.stemmedRevs=g.stemmedRevs||[],function(e,t,n){var i=l.winningRev(e.metadata),r=l.isDeleted(e.metadata,i);if("was_delete"in u&&r)return o[t]=a.createError(a.MISSING_DOC,"deleted"),n();if(h&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=a.createError(a.REV_CONFLICT);return o[t]=s,n()}c(e,i,r,r,!1,r?0:1,t,n)}(p,f,s)}}d()}))},n.updateDoc=m},{"pouchdb-binary-utils":476,"pouchdb-collections":477,"pouchdb-errors":478,"pouchdb-md5":480,"pouchdb-merge":481,"pouchdb-utils":482}],476:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){return atob(e)},r=function(e){return btoa(e)};function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}function s(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),r=0;r<t;r++)i[r]=e.charCodeAt(r);return n}function a(e,t){return o([s(e)],{type:t})}function l(e,t){var n=new FileReader,i="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(i)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=0;r<i;r++)t+=String.fromCharCode(n[r]);return t}(n))},i?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function c(e,t){l(e,(function(e){t(e)}))}n.atob=i,n.btoa=r,n.base64StringToBlobOrBuffer=function(e,t){return a(i(e),t)},n.binaryStringToArrayBuffer=s,n.binaryStringToBlobOrBuffer=a,n.blob=o,n.blobOrBufferToBase64=function(e,t){c(e,(function(e){t(r(e))}))},n.blobOrBufferToBinaryString=c,n.readAsArrayBuffer=function(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)},n.readAsBinaryString=l,n.typedBuffer=function(){}},{}],477:[function(e,t,n){"use strict";function i(e){return"$"+e}function r(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.get=function(e){var t=i(e);return this._store[t]},o.prototype.set=function(e,t){var n=i(e);return this._store[n]=t,!0},o.prototype.has=function(e){return i(e)in this._store},o.prototype.delete=function(e){var t=i(e),n=t in this._store;return delete this._store[t],n},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,i=t.length;n<i;n++){var o=t[n];e(this._store[o],o=r(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach((function(t,n){e(n)}))},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(n.Set=Set,n.Map=Map):(n.Set=s,n.Map=o)},{}],478:[function(e,t,n){"use strict";var i;function r(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}Object.defineProperty(n,"__esModule",{value:!0}),((i=e("inherits"))&&"object"==typeof i&&"default"in i?i.default:i)(r,Error),r.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var o=new r(401,"unauthorized","Name or password is incorrect."),s=new r(400,"bad_request","Missing JSON list of 'docs'"),a=new r(404,"not_found","missing"),l=new r(409,"conflict","Document update conflict"),c=new r(400,"bad_request","_id field must contain a string"),u=new r(412,"missing_id","_id is required for puts"),d=new r(400,"bad_request","Only reserved document ids may start with underscore."),h=new r(412,"precondition_failed","Database not open"),p=new r(500,"unknown_error","Database encountered an unknown error"),f=new r(500,"badarg","Some query argument is invalid"),g=new r(400,"invalid_request","Request was invalid"),m=new r(400,"query_parse_error","Some query parameter is invalid"),b=new r(500,"doc_validation","Bad special document member"),y=new r(400,"bad_request","Something wrong with the request"),v=new r(400,"bad_request","Document must be a JSON object"),_=new r(404,"not_found","Database not found"),E=new r(500,"indexed_db_went_bad","unknown"),T=new r(500,"web_sql_went_bad","unknown"),x=new r(500,"levelDB_went_went_bad","unknown"),w=new r(403,"forbidden","Forbidden by design doc validate_doc_update function"),k=new r(400,"bad_request","Invalid rev format"),S=new r(412,"file_exists","The database could not be created, the file already exists."),C=new r(412,"missing_stub","A pre-existing attachment stub wasn't found"),A=new r(413,"invalid_url","Provided URL is invalid");n.UNAUTHORIZED=o,n.MISSING_BULK_DOCS=s,n.MISSING_DOC=a,n.REV_CONFLICT=l,n.INVALID_ID=c,n.MISSING_ID=u,n.RESERVED_ID=d,n.NOT_OPEN=h,n.UNKNOWN_ERROR=p,n.BAD_ARG=f,n.INVALID_REQUEST=g,n.QUERY_PARSE_ERROR=m,n.DOC_VALIDATION=b,n.BAD_REQUEST=y,n.NOT_AN_OBJECT=v,n.DB_MISSING=_,n.WSQ_ERROR=T,n.LDB_ERROR=x,n.FORBIDDEN=w,n.INVALID_REV=k,n.FILE_EXISTS=S,n.MISSING_STUB=C,n.IDB_ERROR=E,n.INVALID_URL=A,n.createError=function(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=r.prototype,new n(t)},n.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=p).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:423}],479:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r=(i=e("vuvuzela"))&&"object"==typeof i&&"default"in i?i.default:i;n.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return r.parse(e)}},n.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return r.stringify(e)}}},{vuvuzela:630}],480:[function(e,t,n){(function(t){(function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r=e("pouchdb-binary-utils"),o=(i=e("spark-md5"))&&"object"==typeof i&&"default"in i?i.default:i,s=t.setImmediate||t.setTimeout;function a(e,t,n,i,o){(n>0||i<t.size)&&(t=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,i)),r.readAsArrayBuffer(t,(function(t){e.append(t),o()}))}function l(e,t,n,i,r){(n>0||i<t.length)&&(t=t.substring(n,i)),e.appendBinary(t),r()}n.binaryMd5=function(e,t){var n="string"==typeof e,i=n?e.length:e.size,c=Math.min(32768,i),u=Math.ceil(i/c),d=0,h=n?new o:new o.ArrayBuffer,p=n?l:a;function f(){s(m)}function g(){var e=function(e){return r.btoa(e)}(h.end(!0));t(e),h.destroy()}function m(){var t=d*c;p(h,e,t,t+c,++d<u?f:g)}m()},n.stringMd5=function(e){return o.hash(e)}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":476,"spark-md5":608}],481:[function(e,t,n){"use strict";function i(e){for(var t,n,i,r,o=e.rev_tree.slice();r=o.pop();){var s=r.ids,a=s[2],l=r.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,h=s[0];t&&!(i!==d?i:n!==l?n<l:t<h)||(t=h,n=l,i=d)}}return n+"-"+t}function r(e,t){for(var n,i=e.slice();n=i.pop();)for(var r=n.pos,o=n.ids,s=o[2],a=t(0===s.length,r,o[0],n.ctx,o[1]),l=0,c=s.length;l<c;l++)i.push({pos:r+1,ids:s[l],ctx:a})}function o(e,t){return e.pos-t.pos}function s(e){var t=[];r(e,(function(e,n,i,r,o){e&&t.push({rev:n+"-"+i,pos:n,opts:o})})),t.sort(o).reverse();for(var n=0,i=t.length;n<i;n++)delete t[n].pos;return t}function a(e){for(var t,n=[],i=e.slice();t=i.pop();){var r=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&n.push({pos:r+1-u.length,ids:u});for(var d=0,h=l.length;d<h;d++)i.push({pos:r+1,ids:l[d],history:u})}return n.reverse()}function l(e,t){return e.pos-t.pos}function c(e,t,n){var i=function(e,t,n){for(var i,r=0,o=e.length;r<o;)n(e[i=r+o>>>1],t)<0?r=i+1:o=i;return r}(e,t,n);e.splice(i,0,t)}function u(e,t){for(var n,i,r=t,o=e.length;r<o;r++){var s=e[r],a=[s.id,s.opts,[]];i?(i[2].push(a),i=a):n=i=a}return n}function d(e,t){return e[0]<t[0]?-1:1}function h(e,t){for(var n=[{tree1:e,tree2:t}],i=!1;n.length>0;){var r=n.pop(),o=r.tree1,s=r.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,u=0;u<o[2].length;u++)o[2][u][0]===s[2][a][0]&&(n.push({tree1:o[2][u],tree2:s[2][a]}),l=!0);l||(i="new_branch",c(o[2],s[2][a],d))}else i="new_leaf",o[2][0]=s[2][a]}return{conflicts:i,tree:e}}function p(e,t,n){var i,r=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var u=e[a];if(u.pos===t.pos&&u.ids[0]===t.ids[0])i=h(u.ids,t.ids),r.push({pos:u.pos,ids:i.tree}),o=o||i.conflicts,s=!0;else if(!0!==n){var d=u.pos<t.pos?u:t,p=u.pos<t.pos?t:u,f=p.pos-d.pos,g=[],m=[];for(m.push({ids:d.ids,diff:f,parent:null,parentIdx:null});m.length>0;){var b=m.pop();if(0!==b.diff)for(var y=b.ids[2],v=0,_=y.length;v<_;v++)m.push({ids:y[v],diff:b.diff-1,parent:b.ids,parentIdx:v});else b.ids[0]===p.ids[0]&&g.push(b)}var E=g[0];E?(i=h(E.ids,p.ids),E.parent[2][E.parentIdx]=i.tree,r.push({pos:d.pos,ids:d.ids}),o=o||i.conflicts,s=!0):r.push(u)}else r.push(u)}return s||r.push(t),r.sort(l),{tree:r,conflicts:o||"internal_node"}}function f(e){return e.ids}Object.defineProperty(n,"__esModule",{value:!0}),n.collectConflicts=function(e){for(var t=i(e),n=s(e.rev_tree),r=[],o=0,a=n.length;o<a;o++){var l=n[o];l.rev===t||l.opts.deleted||r.push(l.rev)}return r},n.collectLeaves=s,n.compactTree=function(e){var t=[];return r(e.rev_tree,(function(e,n,i,r,o){"available"!==o.status||e||(t.push(n+"-"+i),o.status="missing")})),t},n.isDeleted=function(e,t){t||(t=i(e));for(var n,r=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(f);n=o.pop();){if(n[0]===r)return!!n[1].deleted;o=o.concat(n[2])}},n.isLocalId=function(e){return/^_local/.test(e)},n.merge=function(e,t,n){var i=p(e,t),o=function(e,t){for(var n,i,o=a(e),s=0,l=o.length;s<l;s++){var c,d=o[s],h=d.ids;if(h.length>t){n||(n={});var f=h.length-t;c={pos:d.pos+f,ids:u(h,f)};for(var g=0;g<f;g++){var m=d.pos+g+"-"+h[g].id;n[m]=!0}}else c={pos:d.pos,ids:u(h,0)};i=i?p(i,c,!0).tree:[c]}return n&&r(i,(function(e,t,i){delete n[t+"-"+i]})),{tree:i,revs:n?Object.keys(n):[]}}(i.tree,n);return{tree:o.tree,stemmedRevs:o.revs,conflicts:i.conflicts}},n.revExists=function(e,t){for(var n,i=e.slice(),r=t.split("-"),o=parseInt(r[0],10),s=r[1];n=i.pop();){if(n.pos===o&&n.ids[0]===s)return!0;for(var a=n.ids[2],l=0,c=a.length;l<c;l++)i.push({pos:n.pos+1,ids:a[l]})}return!1},n.rootToLeaf=a,n.traverseRevTree=r,n.winningRev=i,n.latest=function(e,t){for(var n,i=t.rev_tree.slice();n=i.pop();){var r=n.pos,o=n.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=n.history?n.history.slice():[];if(u.push({id:s,pos:r,opts:a}),c)for(var d=0,h=u.length;d<h;d++){var p=u[d];if(p.pos+"-"+p.id===e)return r+"-"+s}for(var f=0,g=l.length;f<g;f++)i.push({pos:r+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],482:[function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(n,"__esModule",{value:!0});var r=i(e("argsarray")),o=e("pouchdb-collections"),s=i(e("inherits")),a=i(e("immediate")),l=e("pouchdb-errors"),c=e("events"),u=i(e("uuid")),d=e("pouchdb-md5");function h(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),i=new Uint8Array(e);return n.set(i),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}var p=Function.prototype.toString,f=p.call(Object);function g(e){var t,n,i;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,i=e.length;n<i;n++)t[n]=g(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return h(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&p.call(n)==f}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=g(e[n]);void 0!==r&&(t[n]=r)}return t}function m(e){var t=!1;return r((function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}))}function b(e){return r((function(t){t=g(t);var n=this,i="function"==typeof t[t.length-1]&&t.pop(),r=new Promise((function(i,r){var o;try{var s=m((function(e,t){e?r(e):i(t)}));t.push(s),(o=e.apply(n,t))&&"function"==typeof o.then&&i(o)}catch(e){r(e)}}));return i&&r.then((function(e){i(null,e)}),i),r}))}function y(e,t){for(var n={},i=0,r=t.length;i<r;i++){var o=t[i];o in e&&(n[o]=e[o])}return n}var v;function _(e){return e}function E(e){return[{ok:e}]}try{localStorage.setItem("_pouch_check_localstorage",1),v=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){v=!1}function T(){return v}function x(){var e;c.EventEmitter.call(this),this._listeners={},e=this,T()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function w(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}s(x,c.EventEmitter),x.prototype.addListener=function(e,t,n,i){if(!this._listeners[t]){var r=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(r._listeners[t])if(o)o="waiting";else{o=!0;var e=y(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",(function(e){e.seq>i.since&&!i.cancelled&&(i.since=e.seq,i.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},x.prototype.removeListener=function(e,t){t in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},x.prototype.notifyLocalWindows=function(e){T()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},x.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var k="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t};var S=function(){}.name?function(e){return e.name}:function(e){var t=e.toString().match(/^\s*function\s*(?:(\S+)\s*)?\(/);return t&&t[1]?t[1]:""};function C(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}var A=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],I="queryKey",O=/(?:^|&)([^&=]*)=?([^&]*)/g,N=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function R(e,t,n){return new Promise((function(i,r){e.get(t,(function(o,s){if(o){if(404!==o.status)return r(o);s={}}var a=s._rev,l=n(s);if(!l)return i({updated:!1,rev:a});l._id=t,l._rev=a,i(function(e,t,n){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(i){if(409!==i.status)throw i;return R(e,t._id,n)}))}(e,l,n))}))}))}var D=u.v4;n.adapterFun=function(e,t){return b(r((function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var i=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var i=["api",e.name,t],r=0;r<n.length-1;r++)i.push(n[r]);e.constructor.emit("debug",i);var o=n[n.length-1];n[n.length-1]=function(n,i){var r=["api",e.name,t];r=r.concat(n?["error",n]:["success",i]),e.constructor.emit("debug",r),o(n,i)}}}(i,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise((function(t,r){i.taskqueue.addTask((function(o){o?r(o):t(i[e].apply(i,n))}))}))})))},n.assign=k,n.bulkGetShim=function(e,t,n){var i=t.docs,r=new o.Map;i.forEach((function(e){r.has(e.id)?r.get(e.id).push(e):r.set(e.id,[e])}));var s=r.size,a=0,l=new Array(s);function c(){var e;++a===s&&(e=[],l.forEach((function(t){t.docs.forEach((function(n){e.push({id:t.id,docs:[n]})}))})),n(null,{results:e}))}var u=[];r.forEach((function(e,t){u.push(t)}));var d=0;!function n(){if(!(d>=u.length)){var i=Math.min(d+6,u.length),o=u.slice(d,i);!function(i,o){i.forEach((function(i,s){var a=o+s,u=r.get(i),d=y(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(_);var h=_;0===d.open_revs.length&&(delete d.open_revs,h=E),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(i,d,(function(e,t){var r,o,s;r=e?[{error:e}]:h(t),o=i,s=r,l[a]={id:o,docs:s},c(),n()}))}))}(o,d),d+=o.length}}()},n.changesHandler=x,n.clone=g,n.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},n.explainError=function(e,t){w("info","The above "+e+" is totally normal. "+t)},n.filterChange=function(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(i){i.doc||(i.doc={});var r=n&&function(e,t,n){try{return!e(t,n)}catch(e){var i="Filter function threw: "+e.toString();return l.createError(l.BAD_REQUEST,i)}}(e.filter,i.doc,t);if("object"==typeof r)return r;if(r)return!1;if(e.include_docs){if(!e.attachments)for(var o in i.doc._attachments)i.doc._attachments.hasOwnProperty(o)&&(i.doc._attachments[o].stub=!0)}else delete i.doc;return!0}},n.flatten=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t=t.concat(e[n]);return t},n.functionName=S,n.guardedConsole=w,n.hasLocalStorage=T,n.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=l.createError(l.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=l.createError(l.RESERVED_ID)):t=l.createError(l.MISSING_ID),t)throw t},n.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(w("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},n.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):c.EventEmitter.listenerCount(e,t)},n.nextTick=a,n.normalizeDdocFunctionName=function(e){var t=C(e);return t?t.join("/"):null},n.once=m,n.parseDdocFunctionName=C,n.parseUri=function(e){for(var t=N.exec(e),n={},i=14;i--;){var r=A[i],o=t[i]||"",s=-1!==["user","password"].indexOf(r);n[r]=s?decodeURIComponent(o):o}return n[I]={},n[A[12]].replace(O,(function(e,t,i){t&&(n[I][t]=i)})),n},n.pick=y,n.rev=function(e,t){var n=g(e);return t?(delete n._rev_tree,d.stringMd5(JSON.stringify(n))):u.v4().replace(/-/g,"").toLowerCase()},n.scopeEval=function(e,t){var n=[],i=[];for(var r in t)t.hasOwnProperty(r)&&(n.push(r),i.push(t[r]));return n.push(e),Function.apply(null,n).apply(null,i)},n.toPromise=b,n.upsert=R,n.uuid=D},{argsarray:367,events:408,immediate:422,inherits:423,"pouchdb-collections":477,"pouchdb-errors":478,"pouchdb-md5":480,uuid:625}],483:[function(e,t,n){(function(n,i){(function(){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var o,s,a=r(e("immediate")),l=r(e("uuid")),c=r(e("spark-md5")),u=r(e("vuvuzela")),d=r(e("argsarray")),h=r(e("inherits")),p=e("events");function f(e){return"$"+e}function g(e){return e.substring(1)}function m(){this._store={}}function b(e){if(this._store=new m,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function y(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),i=new Uint8Array(e);return n.set(i),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}m.prototype.get=function(e){var t=f(e);return this._store[t]},m.prototype.set=function(e,t){var n=f(e);return this._store[n]=t,!0},m.prototype.has=function(e){return f(e)in this._store},m.prototype.delete=function(e){var t=f(e),n=t in this._store;return delete this._store[t],n},m.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,i=t.length;n<i;n++){var r=t[n];e(this._store[r],r=g(r))}},Object.defineProperty(m.prototype,"size",{get:function(){return Object.keys(this._store).length}}),b.prototype.add=function(e){return this._store.set(e,!0)},b.prototype.has=function(e){return this._store.has(e)},b.prototype.forEach=function(e){this._store.forEach((function(t,n){e(n)}))},Object.defineProperty(b.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(o=Set,s=Map):(o=b,s=m);var v=Function.prototype.toString,_=v.call(Object);function E(e){var t,n,i;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,i=e.length;n<i;n++)t[n]=E(e[n]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return y(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&v.call(n)==_}(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=E(e[n]);void 0!==r&&(t[n]=r)}return t}function T(e){var t=!1;return d((function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}))}function x(e){return d((function(t){t=E(t);var n=this,i="function"==typeof t[t.length-1]&&t.pop(),r=new Promise((function(i,r){var o;try{var s=T((function(e,t){e?r(e):i(t)}));t.push(s),(o=e.apply(n,t))&&"function"==typeof o.then&&i(o)}catch(e){r(e)}}));return i&&r.then((function(e){i(null,e)}),i),r}))}function w(e,t){return x(d((function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var i=this;return function(e,t,n){if(e.constructor.listeners("debug").length){for(var i=["api",e.name,t],r=0;r<n.length-1;r++)i.push(n[r]);e.constructor.emit("debug",i);var o=n[n.length-1];n[n.length-1]=function(n,i){var r=["api",e.name,t];r=r.concat(n?["error",n]:["success",i]),e.constructor.emit("debug",r),o(n,i)}}}(i,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise((function(t,r){i.taskqueue.addTask((function(o){o?r(o):t(i[e].apply(i,n))}))}))})))}function k(e,t){for(var n={},i=0,r=t.length;i<r;i++){var o=t[i];o in e&&(n[o]=e[o])}return n}var S;function C(e){return e}function A(e){return[{ok:e}]}function I(e,t,n){var i=t.docs,r=new s;i.forEach((function(e){r.has(e.id)?r.get(e.id).push(e):r.set(e.id,[e])}));var o=r.size,a=0,l=new Array(o);function c(){var e;++a===o&&(e=[],l.forEach((function(t){t.docs.forEach((function(n){e.push({id:t.id,docs:[n]})}))})),n(null,{results:e}))}var u=[];r.forEach((function(e,t){u.push(t)}));var d=0;!function n(){if(!(d>=u.length)){var i=Math.min(d+6,u.length),o=u.slice(d,i);!function(i,o){i.forEach((function(i,s){var a=o+s,u=r.get(i),d=k(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(C);var h=C;0===d.open_revs.length&&(delete d.open_revs,h=A),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(i,d,(function(e,t){var r,o,s;r=e?[{error:e}]:h(t),o=i,s=r,l[a]={id:o,docs:s},c(),n()}))}))}(o,d),d+=o.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),S=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){S=!1}function O(){return S}function N(){var e;p.EventEmitter.call(this),this._listeners={},e=this,O()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function R(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function D(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function L(e,t){R("info","The above "+e+" is totally normal. "+t)}h(N,p.EventEmitter),N.prototype.addListener=function(e,t,n,i){if(!this._listeners[t]){var r=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(r._listeners[t])if(o)o="waiting";else{o=!0;var e=k(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);n.changes(e).on("change",(function(e){e.seq>i.since&&!i.cancelled&&(i.since=e.seq,i.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},N.prototype.removeListener=function(e,t){t in this._listeners&&(p.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},N.prototype.notifyLocalWindows=function(e){O()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},N.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var M="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t};function P(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}h(P,Error),P.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new P(401,"unauthorized","Name or password is incorrect.");var B=new P(400,"bad_request","Missing JSON list of 'docs'"),j=new P(404,"not_found","missing"),F=new P(409,"conflict","Document update conflict"),$=new P(400,"bad_request","_id field must contain a string"),U=new P(412,"missing_id","_id is required for puts"),H=new P(400,"bad_request","Only reserved document ids may start with underscore."),G=(new P(412,"precondition_failed","Database not open"),new P(500,"unknown_error","Database encountered an unknown error")),V=new P(500,"badarg","Some query argument is invalid"),W=(new P(400,"invalid_request","Request was invalid"),new P(400,"query_parse_error","Some query parameter is invalid")),z=new P(500,"doc_validation","Bad special document member"),q=new P(400,"bad_request","Something wrong with the request"),Y=new P(400,"bad_request","Document must be a JSON object"),K=(new P(404,"not_found","Database not found"),new P(500,"indexed_db_went_bad","unknown")),Z=(new P(500,"web_sql_went_bad","unknown"),new P(500,"levelDB_went_went_bad","unknown"),new P(403,"forbidden","Forbidden by design doc validate_doc_update function"),new P(400,"bad_request","Invalid rev format")),X=(new P(412,"file_exists","The database could not be created, the file already exists."),new P(412,"missing_stub","A pre-existing attachment stub wasn't found"));new P(413,"invalid_url","Provided URL is invalid");function J(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=P.prototype,new n(t)}function Q(e){if("object"!=typeof e){var t=e;(e=G).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function ee(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(i){i.doc||(i.doc={});var r=n&&function(e,t,n){try{return!e(t,n)}catch(e){var i="Filter function threw: "+e.toString();return J(q,i)}}(e.filter,i.doc,t);if("object"==typeof r)return r;if(r)return!1;if(e.include_docs){if(!e.attachments)for(var o in i.doc._attachments)i.doc._attachments.hasOwnProperty(o)&&(i.doc._attachments[o].stub=!0)}else delete i.doc;return!0}}function te(e){for(var t=[],n=0,i=e.length;n<i;n++)t=t.concat(e[n]);return t}function ne(e){var t;if(e?"string"!=typeof e?t=J($):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=J(H)):t=J(U),t)throw t}function ie(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(R("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function re(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function oe(e){var t=re(e);return t?t.join("/"):null}var se=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ae="queryKey",le=/(?:^|&)([^&=]*)=?([^&]*)/g,ce=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ue(e){for(var t=ce.exec(e),n={},i=14;i--;){var r=se[i],o=t[i]||"",s=-1!==["user","password"].indexOf(r);n[r]=s?decodeURIComponent(o):o}return n[ae]={},n[se[12]].replace(le,(function(e,t,i){t&&(n[ae][t]=i)})),n}function de(e,t){var n=[],i=[];for(var r in t)t.hasOwnProperty(r)&&(n.push(r),i.push(t[r]));return n.push(e),Function.apply(null,n).apply(null,i)}function he(e,t,n){return new Promise((function(i,r){e.get(t,(function(o,s){if(o){if(404!==o.status)return r(o);s={}}var a=s._rev,l=n(s);if(!l)return i({updated:!1,rev:a});l._id=t,l._rev=a,i(function(e,t,n){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(i){if(409!==i.status)throw i;return he(e,t._id,n)}))}(e,l,n))}))}))}var pe=function(e){return atob(e)},fe=function(e){return btoa(e)};function ge(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}function me(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),r=0;r<t;r++)i[r]=e.charCodeAt(r);return n}function be(e,t){return ge([me(e)],{type:t})}function ye(e,t){return be(pe(e),t)}function ve(e,t){var n=new FileReader,i="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";if(i)return t(n);t(function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=0;r<i;r++)t+=String.fromCharCode(n[r]);return t}(n))},i?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function _e(e,t){ve(e,(function(e){t(e)}))}function Ee(e,t){_e(e,(function(e){t(fe(e))}))}var Te=i.setImmediate||i.setTimeout;function xe(e,t,n,i,r){(n>0||i<t.size)&&(t=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}(t,n,i)),function(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)}(t,(function(t){e.append(t),r()}))}function we(e,t,n,i,r){(n>0||i<t.length)&&(t=t.substring(n,i)),e.appendBinary(t),r()}function ke(e,t){var n="string"==typeof e,i=n?e.length:e.size,r=Math.min(32768,i),o=Math.ceil(i/r),s=0,a=n?new c:new c.ArrayBuffer,l=n?we:xe;function u(){Te(h)}function d(){var e=function(e){return fe(e)}(a.end(!0));t(e),a.destroy()}function h(){var t=s*r;l(a,e,t,t+r,++s<o?u:d)}h()}function Se(e){return c.hash(e)}function Ce(e,t){var n=E(e);return t?(delete n._rev_tree,Se(JSON.stringify(n))):l.v4().replace(/-/g,"").toLowerCase()}var Ae=l.v4;function Ie(e){for(var t,n,i,r,o=e.rev_tree.slice();r=o.pop();){var s=r.ids,a=s[2],l=r.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,h=s[0];t&&!(i!==d?i:n!==l?n<l:t<h)||(t=h,n=l,i=d)}}return n+"-"+t}function Oe(e,t){for(var n,i=e.slice();n=i.pop();)for(var r=n.pos,o=n.ids,s=o[2],a=t(0===s.length,r,o[0],n.ctx,o[1]),l=0,c=s.length;l<c;l++)i.push({pos:r+1,ids:s[l],ctx:a})}function Ne(e,t){return e.pos-t.pos}function Re(e){var t=[];Oe(e,(function(e,n,i,r,o){e&&t.push({rev:n+"-"+i,pos:n,opts:o})})),t.sort(Ne).reverse();for(var n=0,i=t.length;n<i;n++)delete t[n].pos;return t}function De(e){for(var t=Ie(e),n=Re(e.rev_tree),i=[],r=0,o=n.length;r<o;r++){var s=n[r];s.rev===t||s.opts.deleted||i.push(s.rev)}return i}function Le(e){for(var t,n=[],i=e.slice();t=i.pop();){var r=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&n.push({pos:r+1-u.length,ids:u});for(var d=0,h=l.length;d<h;d++)i.push({pos:r+1,ids:l[d],history:u})}return n.reverse()}function Me(e,t){return e.pos-t.pos}function Pe(e,t,n){var i=function(e,t,n){for(var i,r=0,o=e.length;r<o;)n(e[i=r+o>>>1],t)<0?r=i+1:o=i;return r}(e,t,n);e.splice(i,0,t)}function Be(e,t){for(var n,i,r=t,o=e.length;r<o;r++){var s=e[r],a=[s.id,s.opts,[]];i?(i[2].push(a),i=a):n=i=a}return n}function je(e,t){return e[0]<t[0]?-1:1}function Fe(e,t){for(var n=[{tree1:e,tree2:t}],i=!1;n.length>0;){var r=n.pop(),o=r.tree1,s=r.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(n.push({tree1:o[2][c],tree2:s[2][a]}),l=!0);l||(i="new_branch",Pe(o[2],s[2][a],je))}else i="new_leaf",o[2][0]=s[2][a]}return{conflicts:i,tree:e}}function $e(e,t,n){var i,r=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,l=e.length;a<l;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])i=Fe(c.ids,t.ids),r.push({pos:c.pos,ids:i.tree}),o=o||i.conflicts,s=!0;else if(!0!==n){var u=c.pos<t.pos?c:t,d=c.pos<t.pos?t:c,h=d.pos-u.pos,p=[],f=[];for(f.push({ids:u.ids,diff:h,parent:null,parentIdx:null});f.length>0;){var g=f.pop();if(0!==g.diff)for(var m=g.ids[2],b=0,y=m.length;b<y;b++)f.push({ids:m[b],diff:g.diff-1,parent:g.ids,parentIdx:b});else g.ids[0]===d.ids[0]&&p.push(g)}var v=p[0];v?(i=Fe(v.ids,d.ids),v.parent[2][v.parentIdx]=i.tree,r.push({pos:u.pos,ids:u.ids}),o=o||i.conflicts,s=!0):r.push(c)}else r.push(c)}return s||r.push(t),r.sort(Me),{tree:r,conflicts:o||"internal_node"}}function Ue(e,t,n){var i=$e(e,t),r=function(e,t){for(var n,i,r=Le(e),o=0,s=r.length;o<s;o++){var a,l=r[o],c=l.ids;if(c.length>t){n||(n={});var u=c.length-t;a={pos:l.pos+u,ids:Be(c,u)};for(var d=0;d<u;d++){var h=l.pos+d+"-"+c[d].id;n[h]=!0}}else a={pos:l.pos,ids:Be(c,0)};i=i?$e(i,a,!0).tree:[a]}return n&&Oe(i,(function(e,t,i){delete n[t+"-"+i]})),{tree:i,revs:n?Object.keys(n):[]}}(i.tree,n);return{tree:r.tree,stemmedRevs:r.revs,conflicts:i.conflicts}}function He(e){return e.ids}function Ge(e,t){t||(t=Ie(e));for(var n,i=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(He);n=r.pop();){if(n[0]===i)return!!n[1].deleted;r=r.concat(n[2])}}function Ve(e){return/^_local/.test(e)}function We(e,t,n){p.EventEmitter.call(this);var i=this;this.db=e;var r=(t=t?E(t):{}).complete=T((function(t,n){t?function(e,t){return"listenerCount"in e?e.listenerCount(t):p.EventEmitter.listenerCount(e,t)}(i,"error")>0&&i.emit("error",t):i.emit("complete",n),i.removeAllListeners(),e.removeListener("destroyed",o)}));function o(){i.cancel()}n&&(i.on("complete",(function(e){n(null,e)})),i.on("error",n)),e.once("destroyed",o),t.onChange=function(e,t,n){i.isCancelled||function(e,t,n,i){try{e.emit("change",t,n,i)}catch(e){R("error",'Error in .on("change", function):',e)}}(i,e,t,n)};var s=new Promise((function(e,n){t.complete=function(t,i){t?n(t):e(i)}}));i.once("cancel",(function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})})),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then((function(e){r(null,e)}),r),e.taskqueue.isReady?i.validateChanges(t):e.taskqueue.addTask((function(e){e?t.complete(e):i.isCancelled?i.emit("cancel"):i.validateChanges(t)}))}function ze(e,t,n){var i=[{rev:e._rev}];"all_docs"===n.style&&(i=Re(t.rev_tree).map((function(e){return{rev:e.rev}})));var r={id:t.id,changes:i,doc:e};return Ge(t,e._rev)&&(r.deleted=!0),n.conflicts&&(r.doc._conflicts=De(t),r.doc._conflicts.length||delete r.doc._conflicts),r}function qe(e,t){return e<t?-1:e>t?1:0}function Ye(e,t){return function(n,i){n||i[0]&&i[0].error?((n=n||i[0]).docId=t,e(n)):e(null,i.length?i[0]:i)}}function Ke(e,t){var n=qe(e._id,t._id);return 0!==n?n:qe(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function Ze(e){var t=e._compactionQueue[0],n=t.opts,i=t.callback;e.get("_local/compaction").catch((function(){return!1})).then((function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,(function(t,n){t?i(t):i(null,n),a((function(){e._compactionQueue.shift(),e._compactionQueue.length&&Ze(e)}))}))}))}function Xe(){for(var e in p.EventEmitter.call(this),Xe.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function Je(){this.isReady=!1,this.failed=!1,this.queue=[]}function Qe(e,t){if(!(this instanceof Qe))return new Qe(e,t);var n=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=E(t),n.auto_compaction=t.auto_compaction,n.prefix=Qe.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var i=function(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var i=Qe.adapters,r=Qe.preferredAdapters,o=Qe.prefix,s=t.adapter;if(!s)for(var a=0;a<r.length&&"idb"===(s=r[a])&&"websql"in i&&O()&&localStorage["_pouch__websqldb_"+o+e];++a)R("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var l=i[s];return{name:l&&"use_prefix"in l&&!l.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=i.name,t.adapter=t.adapter||i.adapter,n.name=e,n._adapter=t.adapter,Qe.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Qe.adapters[t.adapter]||!Qe.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Xe.call(n),n.taskqueue=new Je,n.adapter=t.adapter,Qe.adapters[t.adapter].call(n,t,(function(e){if(e)return n.taskqueue.fail(e);(function(e){function t(t){e.removeListener("closed",n),t||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)})(n),n.emit("created",n),Qe.emit("created",n.name),n.taskqueue.ready(n)}))}h(We,p.EventEmitter),We.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},We.prototype.validateChanges=function(e){var t=e.complete,n=this;Qe._changesFilterPlugin?Qe._changesFilterPlugin.validate(e,(function(i){if(i)return t(i);n.doChanges(e)})):n.doChanges(e)},We.prototype.doChanges=function(e){var t=this,n=e.complete;if("live"in(e=E(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=ze,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(Qe._changesFilterPlugin){if(Qe._changesFilterPlugin.normalize(e),Qe._changesFilterPlugin.shouldFilter(this,e))return Qe._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach((function(t){t in e&&R("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')}));"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var i=this.db._changes(e);if(i&&"function"==typeof i.cancel){var r=t.cancel;t.cancel=d((function(e){i.cancel(),r.apply(this,e)}))}}else this.db.info().then((function(i){t.isCancelled?n(null,{status:"cancelled"}):(e.since=i.update_seq,t.doChanges(e))}),n)},h(Xe,p.EventEmitter),Xe.prototype.post=w("post",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(J(Y));this.bulkDocs({docs:[e]},t,Ye(n,e._id))})),Xe.prototype.put=w("put",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e))return n(J(Y));if(ne(e._id),Ve(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var i,r,o,s,a=this;function l(n){"function"==typeof a._put&&!1!==t.new_edits?a._put(e,t,n):a.bulkDocs({docs:[e]},t,Ye(n,e._id))}t.force&&e._rev?(r=(i=e._rev.split("-"))[1],o=parseInt(i[0],10)+1,s=Ce(),e._revisions={start:o,ids:[s,r]},e._rev=o+"-"+s,t.new_edits=!1,l((function(t){var i=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,i)}))):l(n)})),Xe.prototype.putAttachment=w("putAttachment",(function(e,t,n,i,r){var o=this;function s(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:r,data:i,revpos:++n},o.put(e)}return"function"==typeof r&&(r=i,i=n,n=null),void 0===r&&(r=i,i=n,n=null),r||R("warn","Attachment",t,"on document",e,"is missing content_type"),o.get(e).then((function(e){if(e._rev!==n)throw J(F);return s(e)}),(function(t){if(t.reason===j.message)return s({_id:e});throw t}))})),Xe.prototype.removeAttachment=w("removeAttachment",(function(e,t,n,i){var r=this;r.get(e,(function(e,o){if(e)i(e);else if(o._rev===n){if(!o._attachments)return i();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,i)}else i(J(F))}))})),Xe.prototype.remove=w("remove",(function(e,t,n,i){var r;"string"==typeof t?(r={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(r=e,"function"==typeof t?(i=t,n={}):(i=n,n=t)),(n=n||{}).was_delete=!0;var o={_id:r._id,_rev:r._rev||n.rev,_deleted:!0};if(Ve(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(r,i);this.bulkDocs({docs:[o]},n,Ye(i,o._id))})),Xe.prototype.revsDiff=w("revsDiff",(function(e,t,n){"function"==typeof t&&(n=t,t={});var i=Object.keys(e);if(!i.length)return n(null,{});var r=0,o=new s;function a(e,t){o.has(e)||o.set(e,{missing:[]}),o.get(e).missing.push(t)}i.map((function(t){this._getRevisionTree(t,(function(s,l){if(s&&404===s.status&&"missing"===s.message)o.set(t,{missing:e[t]});else{if(s)return n(s);!function(t,n){var i=e[t].slice(0);Oe(n,(function(e,n,r,o,s){var l=n+"-"+r,c=i.indexOf(l);-1!==c&&(i.splice(c,1),"available"!==s.status&&a(t,l))})),i.forEach((function(e){a(t,e)}))}(t,l)}if(++r===i.length){var c={};return o.forEach((function(e,t){c[t]=e})),n(null,c)}}))}),this)})),Xe.prototype.bulkGet=w("bulkGet",(function(e,t){I(this,e,t)})),Xe.prototype.compactDocument=w("compactDocument",(function(e,t,n){var i=this;this._getRevisionTree(e,(function(r,o){if(r)return n(r);var s=function(e){var t={},n=[];return Oe(e,(function(e,i,r,o){var s=i+"-"+r;return e&&(t[s]=0),void 0!==o&&n.push({from:o,to:s}),s})),n.reverse(),n.forEach((function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])})),t}(o),a=[],l=[];Object.keys(s).forEach((function(e){s[e]>t&&a.push(e)})),Oe(o,(function(e,t,n,i,r){var o=t+"-"+n;"available"===r.status&&-1!==a.indexOf(o)&&l.push(o)})),i._doCompaction(e,l,n)}))})),Xe.prototype.compact=w("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&Ze(this)})),Xe.prototype._compact=function(e,t){var n=this,i={return_docs:!1,last_seq:e.last_seq||0},r=[];n.changes(i).on("change",(function(e){r.push(n.compactDocument(e.id,0))})).on("complete",(function(e){var i=e.last_seq;Promise.all(r).then((function(){return he(n,"_local/compaction",(function(e){return(!e.last_seq||e.last_seq<i)&&(e.last_seq=i,e)}))})).then((function(){t(null,{ok:!0})})).catch(t)})).on("error",t)},Xe.prototype.get=w("get",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return n(J($));if(Ve(e)&&"function"==typeof this._getLocal)return this._getLocal(e,n);var i=[],r=this;function o(){var o=[],s=i.length;if(!s)return n(null,o);i.forEach((function(i){r.get(e,{rev:i,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},(function(e,t){if(e)o.push({missing:i});else{for(var r,a=0,l=o.length;a<l;a++)if(o[a].ok&&o[a].ok._rev===t._rev){r=!0;break}r||o.push({ok:t})}--s||n(null,o)}))}))}if(!t.open_revs)return this._get(e,t,(function(i,o){if(i)return i.docId=e,n(i);var s=o.doc,a=o.metadata,l=o.ctx;if(t.conflicts){var c=De(a);c.length&&(s._conflicts=c)}if(Ge(a,s._rev)&&(s._deleted=!0),t.revs||t.revs_info){for(var u=s._rev.split("-"),d=parseInt(u[0],10),h=u[1],p=Le(a.rev_tree),f=null,g=0;g<p.length;g++){var m=p[g],b=m.ids.map((function(e){return e.id})).indexOf(h);(b===d-1||!f&&-1!==b)&&(f=m)}if(!f)return(i=new Error("invalid rev tree")).docId=e,n(i);var y=f.ids.map((function(e){return e.id})).indexOf(s._rev.split("-")[1])+1,v=f.ids.length-y;if(f.ids.splice(y,v),f.ids.reverse(),t.revs&&(s._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map((function(e){return e.id}))}),t.revs_info){var _=f.pos+f.ids.length;s._revs_info=f.ids.map((function(e){return{rev:--_+"-"+e.id,status:e.opts.status}}))}}if(t.attachments&&s._attachments){var E=s._attachments,T=Object.keys(E).length;if(0===T)return n(null,s);Object.keys(E).forEach((function(e){this._getAttachment(s._id,e,E[e],{rev:s._rev,binary:t.binary,ctx:l},(function(t,i){var r=s._attachments[e];r.data=i,delete r.stub,delete r.length,--T||n(null,s)}))}),r)}else{if(s._attachments)for(var x in s._attachments)s._attachments.hasOwnProperty(x)&&(s._attachments[x].stub=!0);n(null,s)}}));if("all"===t.open_revs)this._getRevisionTree(e,(function(e,t){if(e)return n(e);i=Re(t).map((function(e){return e.rev})),o()}));else{if(!Array.isArray(t.open_revs))return n(J(G,"function_clause"));i=t.open_revs;for(var s=0;s<i.length;s++){var a=i[s];if("string"!=typeof a||!/^\d+-/.test(a))return n(J(Z))}o()}})),Xe.prototype.getAttachment=w("getAttachment",(function(e,t,n,i){var r=this;n instanceof Function&&(i=n,n={}),this._get(e,n,(function(o,s){return o?i(o):s.doc._attachments&&s.doc._attachments[t]?(n.ctx=s.ctx,n.binary=!0,void r._getAttachment(e,t,s.doc._attachments[t],n,i)):i(J(j))}))})),Xe.prototype.allDocs=w("allDocs",(function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter((function(t){return t in e}))[0];if(n)return void t(J(W,"Query parameter `"+n+"` is not compatible with multi-get"));if(!ie(this)&&(function(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)})),Xe.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new We(this,e,t)},Xe.prototype.close=w("close",(function(e){return this._closed=!0,this.emit("closed"),this._close(e)})),Xe.prototype.info=w("info",(function(e){var t=this;this._info((function(n,i){if(n)return e(n);i.db_name=i.db_name||t.name,i.auto_compaction=!(!t.auto_compaction||ie(t)),i.adapter=t.adapter,e(null,i)}))})),Xe.prototype.id=w("id",(function(e){return this._id(e)})),Xe.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Xe.prototype.bulkDocs=w("bulkDocs",(function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(J(B));for(var i=0;i<e.docs.length;++i)if("object"!=typeof e.docs[i]||Array.isArray(e.docs[i]))return n(J(Y));var r;if(e.docs.forEach((function(e){e._attachments&&Object.keys(e._attachments).forEach((function(t){r=r||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||R("warn","Attachment",t,"on document",e._id,"is missing content_type")}))})),r)return n(J(q,r));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||ie(o)||e.docs.sort(Ke),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var i=Object.keys(n._attachments),r=0;r<i.length;r++){var o=i[r];n._attachments[o]=k(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map((function(e){return e._id}));return this._bulkDocs(e,t,(function(e,i){if(e)return n(e);if(t.new_edits||(i=i.filter((function(e){return e.error}))),!ie(o))for(var r=0,a=i.length;r<a;r++)i[r].id=i[r].id||s[r];n(null,i)}))})),Xe.prototype.registerDependentDatabase=w("registerDependentDatabase",(function(e,t){var n=new this.constructor(e,this.__opts);he(this,"_local/_pouch_dependentDbs",(function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)})).then((function(){t(null,{db:n})})).catch(t)})),Xe.prototype.destroy=w("destroy",(function(e,t){"function"==typeof e&&(t=e,e={});var n=this,i=!("use_prefix"in n)||n.use_prefix;function r(){n._destroy(e,(function(e,i){if(e)return t(e);n._destroyed=!0,n.emit("destroyed"),t(null,i||{ok:!0})}))}if(ie(n))return r();n.get("_local/_pouch_dependentDbs",(function(e,o){if(e)return 404!==e.status?t(e):r();var s=o.dependentDbs,a=n.constructor,l=Object.keys(s).map((function(e){var t=i?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,n.__opts).destroy()}));Promise.all(l).then(r,t)}))})),Je.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Je.prototype.fail=function(e){this.failed=e,this.execute()},Je.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Je.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},h(Qe,Xe);var et="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},tt=fetch,nt=Headers;Qe.adapters={},Qe.preferredAdapters=[],Qe.prefix="_pouch_";var it=new p.EventEmitter;(function(e){Object.keys(p.EventEmitter.prototype).forEach((function(t){"function"==typeof p.EventEmitter.prototype[t]&&(e[t]=it[t].bind(it))}));var t=e._destructionListeners=new s;e.on("ref",(function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)})),e.on("unref",(function(e){if(t.has(e.name)){var n=t.get(e.name),i=n.indexOf(e);i<0||(n.splice(i,1),n.length>1?t.set(e.name,n):t.delete(e.name))}})),e.on("destroyed",(function(e){if(t.has(e)){var n=t.get(e);t.delete(e),n.forEach((function(e){e.emit("destroyed",!0)}))}}))})(Qe),Qe.adapter=function(e,t,n){t.valid()&&(Qe.adapters[e]=t,n&&Qe.preferredAdapters.push(e))},Qe.plugin=function(e){if("function"==typeof e)e(Qe);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach((function(t){Qe.prototype[t]=e[t]}))}return this.__defaults&&(Qe.__defaults=M({},this.__defaults)),Qe},Qe.defaults=function(e){function t(e,n){if(!(this instanceof t))return new t(e,n);n=n||{},e&&"object"==typeof e&&(e=(n=e).name,delete n.name),n=M({},t.__defaults,n),Qe.call(this,e,n)}return h(t,Qe),t.preferredAdapters=Qe.preferredAdapters.slice(),Object.keys(Qe).forEach((function(e){e in t||(t[e]=Qe[e])})),t.__defaults=M({},this.__defaults,e),t},Qe.fetch=function(e,t){return tt(e,t)};function rt(e,t){for(var n=e,i=0,r=t.length;i<r&&(n=n[t[i]]);i++);return n}function ot(e){for(var t=[],n="",i=0,r=e.length;i<r;i++){var o=e[i];"."===o?i>0&&"\\"===e[i-1]?n=n.substring(0,n.length-1)+".":(t.push(n),n=""):n+=o}return t.push(n),t}var st=["$or","$nor","$not"];function at(e){return st.indexOf(e)>-1}function lt(e){return Object.keys(e)[0]}function ct(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(n){var i=e[n];if("object"!=typeof i&&(i={$eq:i}),at(n))t[n]=i instanceof Array?i.map((function(e){return ct([e])})):ct([i]);else{var r=t[n]=t[n]||{};Object.keys(i).forEach((function(e){var t=i[e];return"$gt"===e||"$gte"===e?function(e,t,n){void 0===n.$eq&&(void 0!==n.$gte?"$gte"===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):void 0!==n.$gt?"$gte"===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}(e,t,r):"$lt"===e||"$lte"===e?function(e,t,n){void 0===n.$eq&&(void 0!==n.$lte?"$lte"===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):void 0!==n.$lt?"$lte"===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}(e,t,r):"$ne"===e?function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,r):"$eq"===e?function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,r):void(r[e]=t)}))}}))})),t}function ut(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=ct(e[n].$and));var i=e[t];"object"==typeof i&&ut(i)}return e}function dt(e,t){for(var n in e){"$and"===n&&(t=!0);var i=e[n];"object"==typeof i&&(t=dt(i,t))}return t}function ht(e){var t=E(e),n=!1;dt(t,!1)&&("$and"in(t=ut(t))&&(t=ct(t.$and)),n=!0),["$or","$nor"].forEach((function(e){e in t&&t[e].forEach((function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n],r=e[i];"object"==typeof r&&null!==r||(e[i]={$eq:r})}}))})),"$not"in t&&(t.$not=ct([t.$not]));for(var i=Object.keys(t),r=0;r<i.length;r++){var o=i[r],s=t[o];"object"!=typeof s||null===s?s={$eq:s}:"$ne"in s&&!n&&(s.$ne=[s.$ne]),t[o]=s}return t}var pt=-324;function ft(e,t){if(e===t)return 0;e=gt(e),t=gt(t);var n=_t(e),i=_t(t);if(n-i!=0)return n-i;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),i=0;i<n;i++){var r=ft(e[i],t[i]);if(0!==r)return r}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var n=Object.keys(e),i=Object.keys(t),r=Math.min(n.length,i.length),o=0;o<r;o++){var s=ft(n[o],i[o]);if(0!==s)return s;if(0!==(s=ft(e[n[o]],t[i[o]])))return s}return n.length===i.length?0:n.length>i.length?1:-1}(e,t)}function gt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var i=0;i<n;i++)e[i]=gt(t[i])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var r in e={},t)if(t.hasOwnProperty(r)){var o=t[r];void 0!==o&&(e[r]=gt(o))}}}return e}function mt(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),i=e<0,r=i?"0":"2",o=function(e,t,n){return function(e,t,n){for(var i="",r=n-e.length;i.length<r;)i+=t;return i}(e,t,n)+e}(((i?-n:n)-pt).toString(),"0",3);r+=""+o;var s=Math.abs(parseFloat(t[0]));i&&(s=10-s);var a=s.toFixed(20);return a=a.replace(/\.?0+$/,""),r+""+a}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),i=-1,r=n.length,o="";if(t)for(;++i<r;)o+=bt(n[i]);else for(;++i<r;){var s=n[i];o+=bt(s)+bt(e[s])}return o}return""}function bt(e){return _t(e=gt(e))+""+mt(e)+"\0"}function yt(e,t){var n,i=t;if("1"===e[t])n=0,t++;else{var r="0"===e[t];t++;var o="",s=e.substring(t,t+3),a=parseInt(s,10)+pt;for(r&&(a=-a),t+=3;;){var l=e[t];if("\0"===l)break;o+=l,t++}n=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),r&&(n-=10),0!==a&&(n=parseFloat(n+"e"+a))}return{num:n,length:t-i}}function vt(e,t){var n=e.pop();if(t.length){var i=t[t.length-1];n===i.element&&(t.pop(),i=t[t.length-1]);var r=i.element,o=i.index;Array.isArray(r)?r.push(n):o===e.length-2?r[e.pop()]=n:e.push(n)}}function _t(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function Et(e,t,n){if(e=e.filter((function(e){return Tt(e.doc,t.selector,n)})),t.sort){var i=function(e){function t(t){return e.map((function(e){var n=ot(lt(e));return rt(t,n)}))}return function(e,n){var i=ft(t(e.doc),t(n.doc));return 0!==i?i:function(e,t){return e<t?-1:e>t?1:0}(e.doc._id,n.doc._id)}}(t.sort);e=e.sort(i),"string"!=typeof t.sort[0]&&"desc"===function(e){return e[lt(e)]}(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var r=t.skip||0,o=("limit"in t?t.limit:e.length)+r;e=e.slice(r,o)}return e}function Tt(e,t,n){return n.every((function(n){var i=t[n],r=ot(n),o=rt(e,r);return at(n)?function(e,t,n){return"$or"===e?t.some((function(e){return Tt(n,e,Object.keys(e))})):"$not"===e?!Tt(n,t,Object.keys(t)):!t.find((function(e){return Tt(n,e,Object.keys(e))}))}(n,i,e):xt(i,e,r,o)}))}function xt(e,t,n,i){return!e||("object"==typeof e?Object.keys(e).every((function(r){var o=e[r];return function(e,t,n,i,r){if(!Ct[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Ct[e](t,n,i,r)}(r,t,o,n,i)})):e===i)}function wt(e){return null!=e}function kt(e){return void 0!==e}function St(e,t){return t.some((function(t){return e instanceof Array?e.indexOf(t)>-1:e===t}))}var Ct={$elemMatch:function(e,t,n,i){return!!Array.isArray(i)&&0!==i.length&&("object"==typeof i[0]?i.some((function(e){return Tt(e,t,Object.keys(t))})):i.some((function(i){return xt(t,e,n,i)})))},$allMatch:function(e,t,n,i){return!!Array.isArray(i)&&0!==i.length&&("object"==typeof i[0]?i.every((function(e){return Tt(e,t,Object.keys(t))})):i.every((function(i){return xt(t,e,n,i)})))},$eq:function(e,t,n,i){return kt(i)&&0===ft(i,t)},$gte:function(e,t,n,i){return kt(i)&&ft(i,t)>=0},$gt:function(e,t,n,i){return kt(i)&&ft(i,t)>0},$lte:function(e,t,n,i){return kt(i)&&ft(i,t)<=0},$lt:function(e,t,n,i){return kt(i)&&ft(i,t)<0},$exists:function(e,t,n,i){return t?kt(i):!kt(i)},$mod:function(e,t,n,i){return wt(i)&&function(e,t){var n=t[0],i=t[1];if(0===n)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(i,10)!==i)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%n===i}(i,t)},$ne:function(e,t,n,i){return t.every((function(e){return 0!==ft(i,e)}))},$in:function(e,t,n,i){return wt(i)&&St(i,t)},$nin:function(e,t,n,i){return wt(i)&&!St(i,t)},$size:function(e,t,n,i){return wt(i)&&function(e,t){return e.length===t}(i,t)},$all:function(e,t,n,i){return Array.isArray(i)&&function(e,t){return t.every((function(t){return e.indexOf(t)>-1}))}(i,t)},$regex:function(e,t,n,i){return wt(i)&&function(e,t){return new RegExp(t).test(e)}(i,t)},$type:function(e,t,n,i){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(i,t)}};function At(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var n="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function It(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=oe(e.view):e.filter=oe(e.filter))}function Ot(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!ie(e.db)}function Nt(e,t){var n=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var i=J(q,"`view` filter parameter not found or invalid.");return n(i)}var r=re(t.view);e.db.get("_design/"+r[0],(function(i,o){if(e.isCancelled)return n(null,{status:"cancelled"});if(i)return n(Q(i));var s=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;if(!s)return n(J(j,o.views?"missing json key: "+r[1]:"missing json key: views"));t.filter=function(e){return de(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(s),e.doChanges(t)}))}else if(t.selector)t.filter=function(e){return function(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var n=Et([{doc:e}],{selector:t=ht(t)},Object.keys(t));return n&&1===n.length}(e,t.selector)},e.doChanges(t);else{var o=re(t.filter);e.db.get("_design/"+o[0],(function(i,r){if(e.isCancelled)return n(null,{status:"cancelled"});if(i)return n(Q(i));var s=r&&r.filters&&r.filters[o[1]];if(!s)return n(J(j,r&&r.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=function(e){return de('"use strict";\nreturn '+e+";",{})}(s),e.doChanges(t)}))}}function Rt(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}Qe.plugin((function(e){e._changesFilterPlugin={validate:At,normalize:It,shouldFilter:Ot,filter:Nt}})),Qe.version="7.2.1";var Dt=Rt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Lt=Rt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Mt(e){if(!/^\d+-/.test(e))return J(Z);var t=e.indexOf("-"),n=e.substring(0,t),i=e.substring(t+1);return{prefix:parseInt(n,10),id:i}}function Pt(e,t,n){var i,r,o;n||(n={deterministic_revs:!0});var s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=Ae()),r=Ce(e,n.deterministic_revs),e._rev){if((o=Mt(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,s,[]]]]}],i=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,s,[]]}],i=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var n=e.start-e.ids.length+1,i=e.ids,r=[i[0],t,[]],o=1,s=i.length;o<s;o++)r=[i[o],{status:"missing"},[r]];return[{pos:n,ids:r}]}(e._revisions,s),i=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((o=Mt(e._rev)).error)return o;i=o.prefix,r=o.id,e._rev_tree=[{pos:i,ids:[r,s,[]]}]}ne(e._id),e._rev=i+"-"+r;var a={metadata:{},data:{}};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var c="_"===l[0];if(c&&!Dt[l]){var u=J(z,l);throw u.message=z.message+": "+l,u}c&&!Lt[l]?a.metadata[l.slice(1)]=e[l]:a.data[l]=e[l]}return a}function Bt(e,t,n){var i=function(e){try{return pe(e)}catch(e){return{error:J(V,"Attachment is not a valid base64 string")}}}(e.data);if(i.error)return n(i.error);e.length=i.length,e.data="blob"===t?be(i,e.content_type):"base64"===t?fe(i):i,ke(i,(function(t){e.digest="md5-"+t,n()}))}function jt(e,t,n){if(e.stub)return n();"string"==typeof e.data?Bt(e,t,n):function(e,t,n){ke(e.data,(function(i){e.digest="md5-"+i,e.length=e.data.size||e.data.length||0,"binary"===t?_e(e.data,(function(t){e.data=t,n()})):"base64"===t?Ee(e.data,(function(t){e.data=t,n()})):n()}))}(e,t,n)}function Ft(e,t,n,i,r,o,s,a){if(function(e,t){for(var n,i=e.slice(),r=t.split("-"),o=parseInt(r[0],10),s=r[1];n=i.pop();){if(n.pos===o&&n.ids[0]===s)return!0;for(var a=n.ids[2],l=0,c=a.length;l<c;l++)i.push({pos:n.pos+1,ids:a[l]})}return!1}(t.rev_tree,n.metadata.rev)&&!a)return i[r]=n,o();var l=t.winningRev||Ie(t),c="deleted"in t?t.deleted:Ge(t,l),u="deleted"in n.metadata?n.metadata.deleted:Ge(n.metadata),d=/^1-/.test(n.metadata.rev);if(c&&!u&&a&&d){var h=n.data;h._rev=l,h._id=n.metadata.id,n=Pt(h,a)}var p=Ue(t.rev_tree,n.metadata.rev_tree[0],e);if(a&&(c&&u&&"new_leaf"!==p.conflicts||!c&&"new_leaf"!==p.conflicts||c&&!u&&"new_branch"===p.conflicts)){var f=J(F);return i[r]=f,o()}var g=n.metadata.rev;n.metadata.rev_tree=p.tree,n.stemmedRevs=p.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var m=Ie(n.metadata),b=Ge(n.metadata,m),y=c===b?0:c<b?-1:1;s(n,m,b,g===m?b:Ge(n.metadata,g),!0,y,r,o)}var $t="document-store",Ut="by-sequence",Ht="attach-store",Gt="attach-seq-store",Vt="meta-store",Wt="local-store",zt="detect-blob-support";function qt(e){try{return JSON.stringify(e)}catch(t){return u.stringify(e)}}function Yt(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(J(K,n,t.type))}}function Kt(e,t,n){return{data:qt(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Zt(e){if(!e)return null;var t=function(e){try{return JSON.parse(e)}catch(t){return u.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Xt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Jt(e,t,n,i){n?i(e?"string"!=typeof e?e:ye(e,t):ge([""],{type:t})):e?"string"!=typeof e?ve(e,(function(e){i(fe(e))})):i(e):i("")}function Qt(e,t,n,i){var r=Object.keys(e._attachments||{});if(!r.length)return i&&i();var o=0;function s(){++o===r.length&&i&&i()}r.forEach((function(i){t.attachments&&t.include_docs?function(e,t){var i=e._attachments[t],r=i.digest;n.objectStore(Ht).get(r).onsuccess=function(e){i.body=e.target.result.body,s()}}(e,i):(e._attachments[i].stub=!0,s())}))}function en(e,t){return Promise.all(e.map((function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return Promise.all(n.map((function(n){var i=e.doc._attachments[n];if("body"in i){var r=i.body,o=i.content_type;return new Promise((function(s){Jt(r,o,t,(function(t){e.doc._attachments[n]=M(k(i,["digest","content_type"]),{data:t}),s()}))}))}})))}})))}function tn(e,t,n){var i=[],r=n.objectStore(Ut),o=n.objectStore(Ht),s=n.objectStore(Gt),a=e.length;function l(){--a||i.length&&i.forEach((function(e){s.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){t.target.result||o.delete(e)}}))}e.forEach((function(e){var n=r.index("_doc_id_rev"),o=t+"::"+e;n.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return l();r.delete(t),s.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];i.push(n),s.delete(t.primaryKey),t.continue()}else l()}}}))}function nn(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}var rn=new N;function on(e,t,n,i,r,o){for(var a,l,c,u,d,h,p,f,g=t.docs,m=0,b=g.length;m<b;m++){var y=g[m];y._id&&Ve(y._id)||(y=g[m]=Pt(y,n.new_edits,e)).error&&!p&&(p=y)}if(p)return o(p);var v=!1,_=0,E=new Array(g.length),T=new s,x=!1,w=i._meta.blobSupport?"blob":"base64";function k(){v=!0,S()}function S(){f&&v&&(f.docCount+=_,h.put(f))}function C(){x||(rn.notify(i._meta.name),o(null,E))}function A(e,t,n,i,r,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=n;var l=e.data;if(l._id=e.metadata.id,l._rev=e.metadata.rev,i&&(l._deleted=!0),l._attachments&&Object.keys(l._attachments).length)return function(e,t,n,i,r,o){var s=e.data,a=0,l=Object.keys(s._attachments);function c(){a===l.length&&I(e,t,n,i,r,o)}function d(){a++,c()}l.forEach((function(n){var i=e.data._attachments[n];if(i.stub)a++,c();else{var r=i.data;delete i.data,i.revpos=parseInt(t,10),function(e,t,n){u.count(e).onsuccess=function(i){if(i.target.result)return n();var r={digest:e,body:t};u.put(r).onsuccess=n}}(i.digest,r,d)}}))}(e,t,n,r,s,a);_+=o,S(),I(e,t,n,r,s,a)}function I(e,t,n,r,o,s){var u=e.data,h=e.metadata;function p(o){var s=e.stemmedRevs||[];r&&i.auto_compaction&&(s=s.concat(function(e){var t=[];return Oe(e.rev_tree,(function(e,n,i,r,o){"available"!==o.status||e||(t.push(n+"-"+i),o.status="missing")})),t}(e.metadata))),s&&s.length&&tn(s,e.metadata.id,a),h.seq=o.target.result;var c=Kt(h,t,n);l.put(c).onsuccess=f}function f(){E[o]={ok:!0,id:h.id,rev:h.rev},T.set(e.metadata.id,e.metadata),function(e,t,n){var i=0,r=Object.keys(e.data._attachments||{});if(!r.length)return n();function o(){++i===r.length&&n()}function s(n){var i=e.data._attachments[n].digest,r=d.put({seq:t,digestSeq:i+"::"+t});r.onsuccess=o,r.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}for(var a=0;a<r.length;a++)s(r[a])}(e,h.seq,s)}u._doc_id_rev=h.id+"::"+h.rev,delete u._id,delete u._rev;var g=c.put(u);g.onsuccess=p,g.onerror=function(e){e.preventDefault(),e.stopPropagation(),c.index("_doc_id_rev").getKey(u._doc_id_rev).onsuccess=function(e){c.put(u,e.target.result).onsuccess=p}}}!function(e,t,n){if(!e.length)return n();var i,r=0;function o(){r++,e.length===r&&(i?n(i):n())}e.forEach((function(e){var n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!n.length)return o();function s(e){i=e,++r===n.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&jt(e.data._attachments[a],t,s)}))}(g,w,(function(t){if(t)return o(t);!function(){var t=nn(r,[$t,Ut,Ht,Wt,Gt,Vt],"readwrite");if(t.error)return o(t.error);(a=t.txn).onabort=Yt(o),a.ontimeout=Yt(o),a.oncomplete=C,l=a.objectStore($t),c=a.objectStore(Ut),u=a.objectStore(Ht),d=a.objectStore(Gt),(h=a.objectStore(Vt)).get(Vt).onsuccess=function(e){f=e.target.result,S()},function(e){var t=[];if(g.forEach((function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach((function(n){var i=e.data._attachments[n];i.stub&&t.push(i.digest)}))})),!t.length)return e();var n,i=0;t.forEach((function(r){!function(e,t){u.get(e).onsuccess=function(n){if(n.target.result)t();else{var i=J(X,"unknown stub attachment with digest "+e);i.status=412,t(i)}}}(r,(function(r){r&&!n&&(n=r),++i===t.length&&e(n)}))}))}((function(t){if(t)return x=!0,o(t);!function(){if(g.length)for(var t=0,r=0,o=g.length;r<o;r++){var c=g[r];if(c._id&&Ve(c._id))u();else l.get(c.metadata.id).onsuccess=d}function u(){++t===g.length&&function(e,t,n,i,r,o,a,l,c){e=e||1e3;var u=l.new_edits,d=new s,h=0,p=t.length;function f(){++h===p&&c&&c()}t.forEach((function(e,t){if(e._id&&Ve(e._id)){var i=e._deleted?"_removeLocal":"_putLocal";n[i](e,{ctx:r},(function(e,n){o[t]=e||n,f()}))}else{var s=e.metadata.id;d.has(s)?(p--,d.get(s).push([e,t])):d.set(s,[[e,t]])}})),d.forEach((function(t,n){var r=0;function s(){++r<t.length?c():f()}function c(){var c=t[r],d=c[0],h=c[1];if(i.has(n))Ft(e,i.get(n),d,o,h,s,a,u);else{var p=Ue([],d.metadata.rev_tree[0],e);d.metadata.rev_tree=p.tree,d.stemmedRevs=p.stemmedRevs||[],function(e,t,n){var i=Ie(e.metadata),r=Ge(e.metadata,i);if("was_delete"in l&&r)return o[t]=J(j,"deleted"),n();if(u&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=J(F);return o[t]=s,n()}a(e,i,r,r,!1,r?0:1,t,n)}(d,h,s)}}c()}))}(e.revs_limit,g,i,T,a,E,A,n,k)}function d(e){var t=Zt(e.target.result);t&&T.set(t.id,t),u()}}()}))}()}))}function sn(e,t,n,i,r){var o,s,a;function l(e){s=e.target.result,o&&r(o,s,a)}function c(e){o=e.target.result,s&&r(o,s,a)}function u(e){var t=e.target.result;if(!t)return r();r([t.key],[t.value],t)}-1===i&&(i=1e3),"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&i>1&&!n?(a={continue:function(){if(!o.length)return r();var n,a=o[o.length-1];if(t&&t.upper)try{n=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return r()}else n=IDBKeyRange.lowerBound(a,!0);t=n,o=null,s=null,e.getAll(t,i).onsuccess=l,e.getAllKeys(t,i).onsuccess=c}},e.getAll(t,i).onsuccess=l,e.getAllKeys(t,i).onsuccess=c):n?e.openCursor(t,"prev").onsuccess=u:e.openCursor(t).onsuccess=u}function an(e,t,n){var i,r,o="startkey"in e&&e.startkey,s="endkey"in e&&e.endkey,a="key"in e&&e.key,l="keys"in e&&e.keys,c=e.skip||0,u="number"==typeof e.limit?e.limit:-1,d=!1!==e.inclusive_end;if(!l&&(r=(i=function(e,t,n,i,r){try{if(e&&t)return r?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return r?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return r?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(i)return IDBKeyRange.only(i)}catch(e){return{error:e}}return null}(o,s,d,a,e.descending))&&i.error)&&("DataError"!==r.name||0!==r.code))return n(J(K,r.name,r.message));var h=[$t,Ut,Vt];e.attachments&&h.push(Ht);var p=nn(t,h,"readonly");if(p.error)return n(p.error);var f=p.txn;f.oncomplete=function(){e.attachments?en(E,e.binary).then(k):k()},f.onabort=Yt(n);var g,m,b=f.objectStore($t),y=f.objectStore(Ut),v=f.objectStore(Vt),_=y.index("_doc_id_rev"),E=[];function T(t,n){var i={id:n.id,key:n.id,value:{rev:t}};n.deleted?l&&(E.push(i),i.value.deleted=!0,i.doc=null):c--<=0&&(E.push(i),e.include_docs&&function(t,n,i){var r=t.id+"::"+i;_.get(r).onsuccess=function(i){if(n.doc=Xt(i.target.result)||{},e.conflicts){var r=De(t);r.length&&(n.doc._conflicts=r)}Qt(n.doc,e,f)}}(n,i,t))}function x(e){for(var t=0,n=e.length;t<n&&E.length!==u;t++){var i=e[t];if(i.error&&l)E.push(i);else{var r=Zt(i);T(r.winningRev,r)}}}function w(e,t,n){n&&(x(t),E.length<u&&n.continue())}function k(){var t={total_rows:g,offset:e.skip,rows:E};e.update_seq&&void 0!==m&&(t.update_seq=m),n(null,t)}return v.get(Vt).onsuccess=function(e){g=e.target.result.docCount},e.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result,n=void 0;return t&&t.key&&(n=t.key),function(e){e.target.result&&e.target.result.length>0&&(m=e.target.result[0])}({target:{result:[n]}})}}(y),r||0===u?void 0:l?function(e,t,n){var i=new Array(e.length),r=0;e.forEach((function(o,s){t.get(o).onsuccess=function(t){t.target.result?i[s]=t.target.result:i[s]={key:o,error:"not_found"},++r===e.length&&n(e,i,{})}}))}(e.keys,b,w):-1===u?function(e,t,n){if("function"!=typeof e.getAll){var i=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(i.push(t.value),t.continue()):n({target:{result:i}})}}else e.getAll(t).onsuccess=n}(b,i,(function(t){var n=t.target.result;e.descending&&(n=n.reverse()),x(n)})):void sn(b,i,e.descending,u+c,w)}var ln=!1,cn=[];function un(){!ln&&cn.length&&(ln=!0,cn.shift()())}var dn,hn=new s,pn=new s;function fn(e,t){var n=this;!function(e,t,n){cn.push((function(){e((function(e,i){(function(e,t,n,i){try{e(t,n)}catch(t){i.emit("error",t)}})(t,e,i,n),ln=!1,a((function(){un()}))}))})),un()}((function(t){!function(e,t,n){var i=t.name,r=null;function l(e,t){var n=e.objectStore($t);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var i=e.target.result;if(i){var r=i.value,o=Ge(r);r.deletedOrLocal=o?"1":"0",n.put(r),i.continue()}else t()}}function c(e,t){var n=e.objectStore(Wt),i=e.objectStore($t),r=e.objectStore(Ut);i.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,l=Ve(a),c=Ie(s);if(l){var u=a+"::"+c,d=a+"::",h=a+"::~",p=r.index("_doc_id_rev"),f=IDBKeyRange.bound(d,h,!1,!1),g=p.openCursor(f);g.onsuccess=function(e){if(g=e.target.result){var t=g.value;t._doc_id_rev===u&&n.put(t),r.delete(g.primaryKey),g.continue()}else i.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function u(e,t){var n=e.objectStore(Ut),i=e.objectStore(Ht),r=e.objectStore(Gt);i.count().onsuccess=function(e){if(!e.target.result)return t();n.openCursor().onsuccess=function(e){var n=e.target.result;if(!n)return t();for(var i=n.value,o=n.primaryKey,s=Object.keys(i._attachments||{}),a={},l=0;l<s.length;l++)a[i._attachments[s[l]].digest]=!0;var c=Object.keys(a);for(l=0;l<c.length;l++){var u=c[l];r.put({seq:o,digestSeq:u+"::"+o})}n.continue()}}}function d(e){var t=e.objectStore(Ut),n=e.objectStore($t);n.openCursor().onsuccess=function(e){var i=e.target.result;if(i){var r,o,s,a,l,c=(r=i.value).data?Zt(r):(r.deleted="1"===r.deletedOrLocal,r);if(c.winningRev=c.winningRev||Ie(c),c.seq)return u();o=c.id+"::",s=c.id+"::",a=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(o,s)),l=0,a.onsuccess=function(e){var t=e.target.result;if(!t)return c.seq=l,u();var n=t.primaryKey;n>l&&(l=n),t.continue()}}function u(){var e=Kt(c,c.winningRev,c.deleted);n.put(e).onsuccess=function(){i.continue()}}}}e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=x((function(t){t(null,e._meta.instanceId)})),e._bulkDocs=function(n,i,o){on(t,n,i,e,r,o)},e._get=function(e,t,n){var i,o,s,a=t.ctx;if(!a){var l=nn(r,[$t,Ut,Ht],"readonly");if(l.error)return n(l.error);a=l.txn}function c(){n(s,{doc:i,metadata:o,ctx:a})}a.objectStore($t).get(e).onsuccess=function(e){if(!(o=Zt(e.target.result)))return s=J(j,"missing"),c();var n;if(t.rev)n=t.latest?function(e,t){for(var n,i=t.rev_tree.slice();n=i.pop();){var r=n.pos,o=n.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=n.history?n.history.slice():[];if(u.push({id:s,pos:r,opts:a}),c)for(var d=0,h=u.length;d<h;d++){var p=u[d];if(p.pos+"-"+p.id===e)return r+"-"+s}for(var f=0,g=l.length;f<g;f++)i.push({pos:r+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(t.rev,o):t.rev;else if(n=o.winningRev,Ge(o))return s=J(j,"deleted"),c();var r=a.objectStore(Ut),l=o.id+"::"+n;r.index("_doc_id_rev").get(l).onsuccess=function(e){if((i=e.target.result)&&(i=Xt(i)),!i)return s=J(j,"missing"),c();c()}}},e._getAttachment=function(e,t,n,i,o){var s;if(i.ctx)s=i.ctx;else{var a=nn(r,[$t,Ut,Ht],"readonly");if(a.error)return o(a.error);s=a.txn}var l=n.digest,c=n.content_type;s.objectStore(Ht).get(l).onsuccess=function(e){Jt(e.target.result.body,c,i.binary,(function(e){o(null,e)}))}},e._info=function(t){var n,i,o=nn(r,[Vt,Ut],"readonly");if(o.error)return t(o.error);var s=o.txn;s.objectStore(Vt).get(Vt).onsuccess=function(e){i=e.target.result.docCount},s.objectStore(Ut).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0},s.oncomplete=function(){t(null,{doc_count:i,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){an(e,r,t)},e._changes=function(t){return function(e,t,n,i){if((e=E(e)).continuous){var r=n+":"+Ae();return rn.addListener(n,r,t,e),rn.notify(n),{cancel:function(){rn.removeListener(n,r)}}}var a=e.doc_ids&&new o(e.doc_ids);e.since=e.since||0;var l=e.since,c="limit"in e?e.limit:-1;0===c&&(c=1);var u,d,h,p,f=[],g=0,m=ee(e),b=new s;function y(e,t,n,i){if(n.seq!==t)return i();if(n.winningRev===e._rev)return i(n,e);var r=e._id+"::"+n.winningRev;p.get(r).onsuccess=function(e){i(n,Xt(e.target.result))}}function v(){e.complete(null,{results:f,last_seq:l})}var _=[$t,Ut];e.attachments&&_.push(Ht);var T=nn(i,_,"readonly");if(T.error)return e.complete(T.error);(u=T.txn).onabort=Yt(e.complete),u.oncomplete=function(){!e.continuous&&e.attachments?en(f).then(v):v()},d=u.objectStore(Ut),h=u.objectStore($t),p=d.index("_doc_id_rev"),sn(d,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,c,(function(t,n,i){if(i&&t.length){var r=new Array(t.length),o=new Array(t.length),s=0;n.forEach((function(n,l){!function(e,t,n){if(a&&!a.has(e._id))return n();var i=b.get(e._id);if(i)return y(e,t,i,n);h.get(e._id).onsuccess=function(r){i=Zt(r.target.result),b.set(e._id,i),y(e,t,i,n)}}(Xt(n),t[l],(function(n,a){o[l]=n,r[l]=a,++s===t.length&&function(){for(var t=[],n=0,s=r.length;n<s&&g!==c;n++){var a=r[n];if(a){var l=o[n];t.push(d(l,a))}}Promise.all(t).then((function(t){for(var n=0,i=t.length;n<i;n++)t[n]&&e.onChange(t[n])})).catch(e.complete),g!==c&&i.continue()}()}))}))}function d(t,n){var i=e.processChange(n,t,e);l=i.seq=t.seq;var r=m(i);return"object"==typeof r?Promise.reject(r):r?(g++,e.return_docs&&f.push(i),e.attachments&&e.include_docs?new Promise((function(t){Qt(n,e,u,(function(){en([i],e.binary).then((function(){t(i)}))}))})):Promise.resolve(i)):Promise.resolve()}}))}(t,e,i,r)},e._close=function(e){r.close(),hn.delete(i),e()},e._getRevisionTree=function(e,t){var n=nn(r,[$t],"readonly");if(n.error)return t(n.error);n.txn.objectStore($t).get(e).onsuccess=function(e){var n=Zt(e.target.result);n?t(null,n.rev_tree):t(J(j))}},e._doCompaction=function(e,t,n){var i=nn(r,[$t,Ut,Ht,Gt],"readwrite");if(i.error)return n(i.error);var o=i.txn;o.objectStore($t).get(e).onsuccess=function(n){var i=Zt(n.target.result);Oe(i.rev_tree,(function(e,n,i,r,o){var s=n+"-"+i;-1!==t.indexOf(s)&&(o.status="missing")})),tn(t,e,o);var r=i.winningRev,s=i.deleted;o.objectStore($t).put(Kt(i,r,s))},o.onabort=Yt(n),o.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=nn(r,[Wt],"readonly");if(n.error)return t(n.error);var i=n.txn.objectStore(Wt).get(e);i.onerror=Yt(t),i.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(J(j))}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var i=e._rev,o=e._id;e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var s,a=t.ctx;if(!a){var l=nn(r,[Wt],"readwrite");if(l.error)return n(l.error);(a=l.txn).onerror=Yt(n),a.oncomplete=function(){s&&n(null,s)}}var c,u=a.objectStore(Wt);i?(c=u.get(o)).onsuccess=function(r){var o=r.target.result;o&&o._rev===i?u.put(e).onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)}:n(J(F))}:((c=u.add(e)).onerror=function(e){n(J(F)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,s)})},e._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={});var i,o=t.ctx;if(!o){var s=nn(r,[Wt],"readwrite");if(s.error)return n(s.error);(o=s.txn).oncomplete=function(){i&&n(null,i)}}var a=e._id,l=o.objectStore(Wt),c=l.get(a);c.onerror=Yt(n),c.onsuccess=function(r){var o=r.target.result;o&&o._rev===e._rev?(l.delete(a),i={ok:!0,id:a,rev:"0-0"},t.ctx&&n(null,i)):n(J(j))}},e._destroy=function(e,t){rn.removeAllListeners(i);var n=pn.get(i);n&&n.result&&(n.result.close(),hn.delete(i));var r=indexedDB.deleteDatabase(i);r.onsuccess=function(){pn.delete(i),O()&&i in localStorage&&delete localStorage[i],t(null,{ok:!0})},r.onerror=Yt(t)};var h=hn.get(i);if(h)return r=h.idb,e._meta=h.global,a((function(){n(null,e)}));var p=indexedDB.open(i,5);pn.set(i,p),p.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore($t,{keyPath:"id"});e.createObjectStore(Ut,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(Ht,{keyPath:"digest"}),e.createObjectStore(Vt,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(zt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(Wt,{keyPath:"_id"});var n=e.createObjectStore(Gt,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore(Wt,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(t),e.oldVersion<4&&function(e){var t=e.createObjectStore(Gt,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var i=[l,c,u,d],r=e.oldVersion;!function e(){var t=i[r-1];r++,t&&t(n,e)}()},p.onsuccess=function(t){(r=t.target.result).onversionchange=function(){r.close(),hn.delete(i)},r.onabort=function(e){R("error","Database has a global failure",e.target.error),r.close(),hn.delete(i)};var o,s,a,l,c=r.transaction([Vt,zt,$t],"readwrite"),u=!1;function d(){void 0!==a&&u&&(e._meta={name:i,instanceId:l,blobSupport:a},hn.set(i,{idb:r,global:e._meta}),n(null,e))}function h(){if(void 0!==s&&void 0!==o){var e=i+"_id";e in o?l=o[e]:o[e]=l=Ae(),o.docCount=s,c.objectStore(Vt).put(o)}}c.objectStore(Vt).get(Vt).onsuccess=function(e){o=e.target.result||{id:Vt},h()},function(e,t){e.objectStore($t).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(c,(function(e){s=e,h()})),dn||(dn=function(e){return new Promise((function(t){var n=ge([""]),i=e.objectStore(zt).put(n,"key");i.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)},i.onerror=e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}})).catch((function(){return!1}))}(c)),dn.then((function(e){a=e,d()})),c.oncomplete=function(){u=!0,d()},c.onabort=Yt(n)},p.onerror=function(e){var t=e.target.error&&e.target.error.message;t?-1!==t.indexOf("stored database is a higher version")&&(t=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):t="Failed to open indexedDB, are you in private browsing mode?",R("error",t),n(J(K,t))}}(n,e,t)}),t,n.constructor)}fn.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var gn=5e3,mn={};function bn(e){var t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach((function(e){var t=n[e];t.data=ye(t.data,t.content_type)}))}function yn(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function vn(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map((function(t){var n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Promise((function(e){Ee(n.data,e)})).then((function(e){n.data=e}))}))):Promise.resolve()}function _n(e,t){if(function(e){if(!e.prefix)return!1;var t=ue(e.prefix).protocol;return"http"===t||"https"===t}(t)){var n=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)}var i=ue(e);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var r=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=r.pop(),-1===i.db.indexOf("%")&&(i.db=encodeURIComponent(i.db)),i.path=r.join("/"),i}function En(e,t){return Tn(e,e.db+"/"+t)}function Tn(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function xn(e){return"?"+Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).join("&")}function wn(e,t){var i=this,r=_n(e.name,e),o=En(r,"");e=E(e);var s,l=function(t,n){if((n=n||{}).headers=n.headers||new nt,n.credentials="include",e.auth||r.auth){var i=e.auth||r.auth,o=i.username+":"+i.password,s=fe(unescape(encodeURIComponent(o)));n.headers.set("Authorization","Basic "+s)}var a=e.headers||{};return Object.keys(a).forEach((function(e){n.headers.append(e,a[e])})),function(e){var t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=-1!==t.indexOf("msie"),i=-1!==t.indexOf("trident"),r=-1!==t.indexOf("edge"),o=!("method"in e)||"GET"===e.method;return(n||i||r)&&o}(n)&&(t+=(-1===t.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(e.fetch||tt)(t,n)};function c(e,t){return w(e,d((function(e){h().then((function(){return t.apply(this,e)})).catch((function(t){e.pop()(t)}))}))).bind(i)}function u(e,t,n){var i={};return(t=t||{}).headers=t.headers||new nt,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),l(e,t).then((function(e){return i.ok=e.ok,i.status=e.status,e.json()})).then((function(e){if(i.data=e,!i.ok){i.data.status=i.status;var t=Q(i.data);if(n)return n(t);throw t}if(Array.isArray(i.data)&&(i.data=i.data.map((function(e){return e.error||e.missing?Q(e):e}))),!n)return i;n(null,i.data)}))}function h(){return e.skip_setup?Promise.resolve():s||((s=u(o).catch((function(e){return e&&e.status&&404===e.status?(L(404,"PouchDB is just detecting if the remote exists."),u(o,{method:"PUT"})):Promise.reject(e)})).catch((function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)}))).catch((function(){s=null})),s)}function p(e){return e.split("/").map(encodeURIComponent).join("/")}a((function(){t(null,i)})),i._remote=!0,i.type=function(){return"http"},i.id=c("id",(function(e){l(Tn(r,"")).then((function(e){return e.json()})).catch((function(){return{}})).then((function(t){var n=t&&t.uuid?t.uuid+r.db:En(r,"");e(null,n)}))})),i.compact=c("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=E(e),u(En(r,"_compact"),{method:"POST"}).then((function(){!function n(){i.info((function(i,r){r&&!r.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)}))}()}))})),i.bulkGet=w("bulkGet",(function(e,t){var n=this;function i(t){var n={};e.revs&&(n.revs=!0),e.attachments&&(n.attachments=!0),e.latest&&(n.latest=!0),u(En(r,"_bulk_get"+xn(n)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then((function(n){e.attachments&&e.binary&&n.data.results.forEach((function(e){e.docs.forEach(bn)})),t(null,n.data)})).catch(t)}function o(){var i=Math.ceil(e.docs.length/50),r=0,o=new Array(i);function s(e){return function(n,s){o[e]=s.results,++r===i&&t(null,{results:te(o)})}}for(var a=0;a<i;a++){var l=k(e,["revs","attachments","binary","latest"]);l.docs=e.docs.slice(50*a,Math.min(e.docs.length,50*(a+1))),I(n,l,s(a))}}var s=Tn(r,""),a=mn[s];"boolean"!=typeof a?i((function(e,n){e?(mn[s]=!1,L(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(mn[s]=!0,t(null,n))})):a?i(t):o()})),i._info=function(e){h().then((function(){return l(En(r,""))})).then((function(e){return e.json()})).then((function(t){t.host=En(r,""),e(null,t)})).catch(e)},i.fetch=function(e,t){return h().then((function(){var n="/"===e.substring(0,1)?Tn(r,e.substring(1)):En(r,e);return l(n,t)}))},i.get=c("get",(function(e,t,n){"function"==typeof t&&(n=t,t={});var i={};function o(e){var n=e._attachments,i=n&&Object.keys(n);if(n&&i.length)return function(e,t){return new Promise((function(n,i){var r,o=0,s=0,a=0,l=e.length;function c(){++a===l?r?i(r):n():h()}function u(){o--,c()}function d(e){o--,r=r||e,c()}function h(){for(;o<t&&s<l;)o++,e[s++]().then(u,d)}h()}))}(i.map((function(i){return function(){return function(i){var o=n[i],s=yn(e._id)+"/"+p(i)+"?rev="+e._rev;return l(En(r,s)).then((function(e){return"buffer"in e?e.buffer():e.blob()})).then((function(e){if(t.binary){var n=Object.getOwnPropertyDescriptor(e.__proto__,"type");return n&&!n.set||(e.type=o.content_type),e}return new Promise((function(t){Ee(e,t)}))})).then((function(e){delete o.stub,delete o.length,o.data=e}))}(i)}})),5)}(t=E(t)).revs&&(i.revs=!0),t.revs_info&&(i.revs_info=!0),t.latest&&(i.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),i.open_revs=t.open_revs),t.rev&&(i.rev=t.rev),t.conflicts&&(i.conflicts=t.conflicts),t.update_seq&&(i.update_seq=t.update_seq),e=yn(e),u(En(r,e+xn(i))).then((function(e){return Promise.resolve().then((function(){if(t.attachments)return n=e.data,Array.isArray(n)?Promise.all(n.map((function(e){if(e.ok)return o(e.ok)}))):o(n);var n})).then((function(){n(null,e.data)}))})).catch((function(t){t.docId=e,n(t)}))})),i.remove=c("remove",(function(e,t,n,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(i=n,n={})):(o=e,"function"==typeof t?(i=t,n={}):(i=n,n=t));var s=o._rev||n.rev;u(En(r,yn(o._id))+"?rev="+s,{method:"DELETE"},i).catch(i)})),i.getAttachment=c("getAttachment",(function(e,t,i,o){"function"==typeof i&&(o=i,i={});var s,a=i.rev?"?rev="+i.rev:"",c=En(r,yn(e))+"/"+p(t)+a;l(c,{method:"GET"}).then((function(e){if(s=e.headers.get("content-type"),e.ok)return void 0===n||n.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e})).then((function(e){void 0===n||n.browser||(e.type=s),o(null,e)})).catch((function(e){o(e)}))})),i.removeAttachment=c("removeAttachment",(function(e,t,n,i){u(En(r,yn(e)+"/"+p(t))+"?rev="+n,{method:"DELETE"},i).catch(i)})),i.putAttachment=c("putAttachment",(function(e,t,n,i,o,s){"function"==typeof o&&(s=o,o=i,i=n,n=null);var a=yn(e)+"/"+p(t),l=En(r,a);if(n&&(l+="?rev="+n),"string"==typeof i){var c;try{c=pe(i)}catch(e){return s(J(V,"Attachment is not a valid base64 string"))}i=c?be(c,o):""}u(l,{headers:new nt({"Content-Type":o}),method:"PUT",body:i},s).catch(s)})),i._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,h().then((function(){return Promise.all(e.docs.map(vn))})).then((function(){return u(En(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},n)})).catch(n)},i._put=function(e,t,n){h().then((function(){return vn(e)})).then((function(){return u(En(r,yn(e._id)),{method:"PUT",body:JSON.stringify(e)})})).then((function(e){n(null,e.data)})).catch((function(t){t.docId=e&&e._id,n(t)}))},i.allDocs=c("allDocs",(function(e,t){"function"==typeof e&&(t=e,e={});var n,i={},o="GET";(e=E(e)).conflicts&&(i.conflicts=!0),e.update_seq&&(i.update_seq=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(i.limit=e.limit),void 0!==e.skip&&(i.skip=e.skip);var s=xn(i);void 0!==e.keys&&(o="POST",n={keys:e.keys}),u(En(r,"_all_docs"+s),{method:o,body:JSON.stringify(n)}).then((function(n){e.include_docs&&e.attachments&&e.binary&&n.data.rows.forEach(bn),t(null,n.data)})).catch(t)})),i._changes=function(e){var t="batch_size"in e?e.batch_size:25;!(e=E(e)).continuous||"heartbeat"in e||(e.heartbeat=1e4);var n="timeout"in e?e.timeout:3e4;"timeout"in e&&e.timeout&&n-e.timeout<gn&&(n=e.timeout+gn),"heartbeat"in e&&e.heartbeat&&n-e.heartbeat<gn&&(n=e.heartbeat+gn);var i={};"timeout"in e&&e.timeout&&(i.timeout=e.timeout);var o=void 0!==e.limit&&e.limit,s=o;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.seq_interval&&(i.seq_interval=e.seq_interval),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.update_seq&&(i.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(i.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var l in e.query_params)e.query_params.hasOwnProperty(l)&&(i[l]=e.query_params[l]);var c,d="GET";e.doc_ids?(i.filter="_doc_ids",d="POST",c={doc_ids:e.doc_ids}):e.selector&&(i.filter="_selector",d="POST",c={selector:e.selector});var p,f=new et,g=function(n,a){if(!e.aborted){i.since=n,"object"==typeof i.since&&(i.since=JSON.stringify(i.since)),e.descending?o&&(i.limit=s):i.limit=!o||s>t?t:s;var l=En(r,"_changes"+xn(i)),g={signal:f.signal,method:d,body:JSON.stringify(c)};p=n,e.aborted||h().then((function(){return u(l,g,a)})).catch(a)}},m={results:[]},b=function(n,i){if(!e.aborted){var r=0;if(i&&i.results){r=i.results.length,m.last_seq=i.last_seq;var l=null,c=null;"number"==typeof i.pending&&(l=i.pending),"string"!=typeof m.last_seq&&"number"!=typeof m.last_seq||(c=m.last_seq),e.query_params,i.results=i.results.filter((function(t){s--;var n=ee(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&bn(t),e.return_docs&&m.results.push(t),e.onChange(t,l,c)),n}))}else if(n)return e.aborted=!0,void e.complete(n);i&&i.last_seq&&(p=i.last_seq);var u=o&&s<=0||i&&r<t||e.descending;(!e.continuous||o&&s<=0)&&u?e.complete(null,m):a((function(){g(p,b)}))}};return g(e.since||0,b),{cancel:function(){e.aborted=!0,f.abort()}}},i.revsDiff=c("revsDiff",(function(e,t,n){"function"==typeof t&&(n=t,t={}),u(En(r,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},n).catch(n)})),i._close=function(e){e()},i._destroy=function(e,t){u(En(r,""),{method:"DELETE"}).then((function(e){t(null,e)})).catch((function(e){404===e.status?t(null,{ok:!0}):t(e)}))}}function kn(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,kn)}catch(e){}}function Sn(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Sn)}catch(e){}}function Cn(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Cn)}catch(e){}}function An(e,t){return t&&e.then((function(e){a((function(){t(null,e)}))}),(function(e){a((function(){t(e)}))})),e}function In(e){return d((function(t){var n=t.pop(),i=e.apply(this,t);return"function"==typeof n&&An(i,n),i}))}function On(e,t){return function(){var n=arguments,i=this;return e.add((function(){return t.apply(i,n)}))}}function Nn(e){var t=new o(e),n=new Array(t.size),i=-1;return t.forEach((function(e){n[++i]=e})),n}function Rn(e){var t=new Array(e.size),n=-1;return e.forEach((function(e,i){t[++n]=i})),t}function Dn(e){return new Cn("builtin "+e+" function requires map values to be numbers or number arrays")}function Ln(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];if("number"!=typeof r){if(!Array.isArray(r))throw Dn("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=r.length;o<s;o++){var a=r[o];if("number"!=typeof a)throw Dn("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=r:t[0]+=r}return t}wn.valid=function(){return!0},h(kn,Error),h(Sn,Error),h(Cn,Error);var Mn=R.bind(null,"log"),Pn=Array.isArray,Bn=JSON.parse;function jn(e,t){return de("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Ln,log:Mn,isArray:Pn,toJSON:Bn})}function Fn(){this.promise=new Promise((function(e){e()}))}function $n(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function Un(e,t,n,i,r,o){var s,a=function(e,t){return $n(e)+$n(t)+"undefined"}(n,i);if(!r&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var l=e.info().then((function(l){var c=l.db_name+"-mrview-"+(r?"temp":Se(a));return he(e,"_local/"+o,(function(e){e.views=e.views||{};var n=t;-1===n.indexOf("/")&&(n=t+"/"+t);var i=e.views[n]=e.views[n]||{};if(!i[c])return i[c]=!0,e})).then((function(){return e.registerDependentDatabase(c).then((function(t){var r=t.db;r.auto_compaction=!0;var o={name:c,db:r,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:i};return o.db.get("_local/lastSeq").catch((function(e){if(404!==e.status)throw e})).then((function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",(function(){delete s[a]})),o}))}))}))}));return s&&(s[a]=l),l}Fn.prototype.add=function(e){return this.promise=this.promise.catch((function(){})).then((function(){return e()})),this.promise},Fn.prototype.finish=function(){return this.promise};var Hn={},Gn=new Fn;function Vn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Wn(e,t){try{e.emit("error",t)}catch(e){R("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),R("error",t)}}var zn=function(e,t){return Ln(t)},qn=function(e,t){return t.length},Yn=function(e,t){return{sum:Ln(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];t+=r*r}return t}(t)}};var Kn=function(e,t,n,i){function r(e,t,n){try{t(n)}catch(t){Wn(e,t)}}function l(e,t,n,i,r){try{return{output:t(n,i,r)}}catch(t){return Wn(e,t),{error:t}}}function c(e,t){var n=ft(e.key,t.key);return 0!==n?n:ft(e.value,t.value)}function u(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function d(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function h(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach((function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach((function(e){var n=t[e];t[e].data=ye(n.data,n.content_type)}))}))}(t),t}}function p(e,t,n,i){var r=t[e];void 0!==r&&(i&&(r=encodeURIComponent(JSON.stringify(r))),n.push(e+"="+r))}function f(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function g(e,t){var n=e.descending?"endkey":"startkey",i=e.descending?"startkey":"endkey";if(void 0!==e[n]&&void 0!==e[i]&&ft(e[n],e[i])>0)throw new kn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new kn("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new kn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(t){var n=function(e){if(e){if("number"!=typeof e)return new kn('Invalid value for integer: "'+e+'"');if(e<0)return new kn('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(n)throw n}))}function m(e){return function(t){if(404===t.status)return e;throw t}}function b(e){var t="string"==typeof e?e:e.name,n=Hn[t];return n||(n=Hn[t]=new Fn),n}function y(e){return On(b(e),(function(){return function(e){var n,i,a=t(e.mapFun,(function(e,t){var r={id:i._id,key:gt(e)};null!=t&&(r.value=gt(t)),n.push(r)})),l=e.seq||0;function u(t,n){return function(){return function(e,t,n){return e.db.get("_local/lastSeq").catch(m({_id:"_local/lastSeq",seq:0})).then((function(i){var r=Rn(t);return Promise.all(r.map((function(n){return function(e,t,n){var i="_local/doc_"+e,r={_id:i,keys:[]},s=n.get(e),a=s[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(s[1])?Promise.resolve(r):t.db.get(i).catch(m(r))).then((function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(e).then((function(t){return function(e,t){for(var n=[],i=new o,r=0,s=t.rows.length;r<s;r++){var l=t.rows[r].doc;if(l&&(n.push(l),i.add(l._id),l._deleted=!a.has(l._id),!l._deleted)){var c=a.get(l._id);"value"in c&&(l.value=c.value)}}var u=Rn(a);return u.forEach((function(e){if(!i.has(e)){var t={_id:e},r=a.get(e);"value"in r&&(t.value=r.value),n.push(t)}})),e.keys=Nn(u.concat(e.keys)),n.push(e),n}(e,t)}))}))}(n,e,t)}))).then((function(t){var r=te(t);return i.seq=n,r.push(i),e.db.bulkDocs({docs:r})}))}))}(e,t,n)}}var d=new Fn;function h(){return e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:l,limit:50}).then(p)}function p(t){var o=t.results;if(o.length){var p=function(t){for(var o=new s,u=0,d=t.length;u<d;u++){var h=t[u];if("_"!==h.doc._id[0]){n=[],(i=h.doc)._deleted||r(e.sourceDB,a,i),n.sort(c);var p=f(n);o.set(h.doc._id,[p,h.changes])}l=h.seq}return o}(o);if(d.add(u(p,l)),!(o.length<50))return h()}}function f(e){for(var t,n=new s,i=0,r=e.length;i<r;i++){var o=e[i],a=[o.key,o.id];i>0&&0===ft(o.key,t)&&a.push(i),n.set(bt(a),o),t=o.key}return n}return h().then((function(){return d.finish()})).then((function(){e.seq=l}))}(e)}))()}function v(e,t){return On(b(e),(function(){return function(e,t){var i,r=e.reduceFun&&!1!==t.reduce,o=t.skip||0;function a(t){return t.include_docs=!0,e.db.allDocs(t).then((function(e){return i=e.total_rows,e.rows.map((function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var i=function(e){for(var t=[],n=[],i=0;;){var r=e[i++];if("\0"!==r)switch(r){case"1":t.push(null);break;case"2":t.push("1"===e[i]),i++;break;case"3":var o=yt(e,i);t.push(o.num),i+=o.length;break;case"4":for(var s="";;){var a=e[i];if("\0"===a)break;s+=a,i++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var l={element:[],index:t.length};t.push(l.element),n.push(l);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}else{if(1===t.length)return t.pop();vt(t,n)}}}(e.doc._id);return{key:i[0],id:i[1],value:"value"in e.doc?e.doc.value:null}}))}))}function c(a){var c;if(c=r?function(e,t,i){0===i.group_level&&delete i.group_level;var r=i.group||i.group_level,o=n(e.reduceFun),s=[],a=isNaN(i.group_level)?Number.POSITIVE_INFINITY:i.group_level;t.forEach((function(e){var t=s[s.length-1],n=r?e.key:null;if(r&&Array.isArray(n)&&(n=n.slice(0,a)),t&&0===ft(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})})),t=[];for(var c=0,d=s.length;c<d;c++){var h=s[c],p=l(e.sourceDB,o,h.keys,h.values,!1);if(p.error&&p.error instanceof Cn)throw p.error;t.push({value:p.error?null:p.output,key:h.groupKey})}return{rows:u(t,i.limit,i.skip)}}(e,a,t):{total_rows:i,offset:o,rows:a},t.update_seq&&(c.update_seq=e.seq),t.include_docs){var h=Nn(a.map(d));return e.sourceDB.allDocs({keys:h,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then((function(e){var t=new s;return e.rows.forEach((function(e){t.set(e.id,e.doc)})),a.forEach((function(e){var n=d(e),i=t.get(n);i&&(e.doc=i)})),c}))}return c}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var h=t.keys.map((function(e){var n={startkey:bt([e]),endkey:bt([e,{}])};return t.update_seq&&(n.update_seq=!0),a(n)}));return Promise.all(h).then(te).then(c)}var p,f,g={descending:t.descending};if(t.update_seq&&(g.update_seq=!0),"start_key"in t&&(p=t.start_key),"startkey"in t&&(p=t.startkey),"end_key"in t&&(f=t.end_key),"endkey"in t&&(f=t.endkey),void 0!==p&&(g.startkey=t.descending?bt([p,{}]):bt([p])),void 0!==f){var m=!1!==t.inclusive_end;t.descending&&(m=!m),g.endkey=bt(m?[f,{}]:[f])}if(void 0!==t.key){var b=bt([t.key]),y=bt([t.key,{}]);g.descending?(g.endkey=b,g.startkey=y):(g.startkey=b,g.endkey=y)}return r||("number"==typeof t.limit&&(g.limit=t.limit),g.skip=o),a(g).then(c)}(e,t)}))()}function _(t,n,r){if("function"==typeof t._query)return function(e,t,n){return new Promise((function(i,r){e._query(t,n,(function(e,t){if(e)return r(e);i(t)}))}))}(t,n,r);if(ie(t))return function(e,t,n){var i,r,o,s=[],a="GET";if(p("reduce",n,s),p("include_docs",n,s),p("attachments",n,s),p("limit",n,s),p("descending",n,s),p("group",n,s),p("group_level",n,s),p("skip",n,s),p("stale",n,s),p("conflicts",n,s),p("startkey",n,s,!0),p("start_key",n,s,!0),p("endkey",n,s,!0),p("end_key",n,s,!0),p("inclusive_end",n,s),p("key",n,s,!0),p("update_seq",n,s),s=""===(s=s.join("&"))?"":"?"+s,void 0!==n.keys){var l="keys="+encodeURIComponent(JSON.stringify(n.keys));l.length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+l:(a="POST","string"==typeof t?i={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var c=Vn(t);return e.fetch("_design/"+c[0]+"/_view/"+c[1]+s,{headers:new nt({"Content-Type":"application/json"}),method:a,body:JSON.stringify(i)}).then((function(e){return r=e.ok,o=e.status,e.json()})).then((function(e){if(!r)throw e.status=o,Q(e);return e.rows.forEach((function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)})),e})).then(h(n))}return i=i||{},Object.keys(t).forEach((function(e){Array.isArray(t[e])?i[e]=t[e]:i[e]=t[e].toString()})),e.fetch("_temp_view"+s,{headers:new nt({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(i)}).then((function(e){return r=e.ok,o=e.status,e.json()})).then((function(e){if(!r)throw e.status=o,Q(e);return e})).then(h(n))}(t,n,r);if("string"!=typeof n)return g(r,n),Gn.add((function(){return Un(t,"temp_view/temp_view",n.map,n.reduce,!0,e).then((function(e){return function(e,t){return e.then((function(e){return t().then((function(){return e}))}),(function(e){return t().then((function(){throw e}))}))}(y(e).then((function(){return v(e,r)})),(function(){return e.db.destroy()}))}))})),Gn.finish();var o=n,s=Vn(o),l=s[0],c=s[1];return t.get("_design/"+l).then((function(n){var s=n.views&&n.views[c];if(!s)throw new Sn("ddoc "+n._id+" has no view named "+c);return i(n,c),g(r,s),Un(t,o,s.map,s.reduce,!1,e).then((function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&a((function(){y(e)})),v(e,r)):y(e).then((function(){return v(e,r)}))}))}))}return{query:function(e,t,n){var i=this;"function"==typeof t&&(n=t,t={}),t=t?function(e){return e.group_level=f(e.group_level),e.limit=f(e.limit),e.skip=f(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var r=Promise.resolve().then((function(){return _(i,e,t)}));return An(r,n),r},viewCleanup:In((function(){var t=this;return"function"==typeof t._viewCleanup?function(e){return new Promise((function(t,n){e._viewCleanup((function(e,i){if(e)return n(e);t(i)}))}))}(t):ie(t)?function(e){return e.fetch("_view_cleanup",{headers:new nt({"Content-Type":"application/json"}),method:"POST"}).then((function(e){return e.json()}))}(t):function(t){return t.get("_local/"+e).then((function(e){var n=new s;Object.keys(e.views).forEach((function(e){var t=Vn(e),i="_design/"+t[0],r=t[1],s=n.get(i);s||(s=new o,n.set(i,s)),s.add(r)}));var i={keys:Rn(n),include_docs:!0};return t.allDocs(i).then((function(i){var r={};i.rows.forEach((function(t){var i=t.key.substring(8);n.get(t.key).forEach((function(n){var o=i+"/"+n;e.views[o]||(o=n);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[n];s.forEach((function(e){r[e]=r[e]||a}))}))}));var o=Object.keys(r).filter((function(e){return!r[e]})).map((function(e){return On(b(e),(function(){return new t.constructor(e,t.__opts).destroy()}))()}));return Promise.all(o).then((function(){return{ok:!0}}))}))}),m({ok:!0}))}(t)}))}}("mrviews",(function(e,t){if("function"==typeof e&&2===e.length){var n=e;return function(e){return n(e,t)}}return jn(e.toString(),t)}),(function(e){var t=e.toString();return function(e){if(/^_sum/.test(e))return zn;if(/^_count/.test(e))return qn;if(/^_stats/.test(e))return Yn;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t)||jn(t)}),(function(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new Sn("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}));var Zn={query:function(e,t,n){return Kn.query.call(this,e,t,n)},viewCleanup:function(e){return Kn.viewCleanup.call(this,e)}};function Xn(e){return/^1-/.test(e)}function Jn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map((function(n){return e.getAttachment(t._id,n,{rev:t._rev})})))}function Qn(e,t,n,i){n=E(n);var r=[],o=!0;function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then((function(e){if(i.cancelled)throw new Error("cancelled");e.rows.forEach((function(e){var t;e.deleted||!e.doc||!Xn(e.value.rev)||(t=e.doc)._attachments&&Object.keys(t._attachments).length>0||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,r.push(e.doc),delete n[e.id])}))}))}return Promise.resolve().then((function(){var e=Object.keys(n).filter((function(e){var t=n[e].missing;return 1===t.length&&Xn(t[0])}));if(e.length>0)return s(e)})).then((function(){var s=function(e){var t=[];return Object.keys(e).forEach((function(n){e[n].missing.forEach((function(e){t.push({id:n,rev:e})}))})),{docs:t,revs:!0,latest:!0}}(n);if(s.docs.length)return e.bulkGet(s).then((function(n){if(i.cancelled)throw new Error("cancelled");return Promise.all(n.results.map((function(n){return Promise.all(n.docs.map((function(n){var i=n.ok;return n.error&&(o=!1),i&&i._attachments?function(e,t,n){var i=ie(t)&&!ie(e),r=Object.keys(n._attachments);return i?e.get(n._id).then((function(i){return Promise.all(r.map((function(r){return function(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}(i,n,r)?t.getAttachment(n._id,r):e.getAttachment(i._id,r)})))})).catch((function(e){if(404!==e.status)throw e;return Jn(t,n)})):Jn(t,n)}(t,e,i).then((function(e){var t=Object.keys(i._attachments);return e.forEach((function(e,n){var r=i._attachments[t[n]];delete r.stub,delete r.length,r.data=e})),i})):i})))}))).then((function(e){r=r.concat(te(e).filter(Boolean))}))}))})).then((function(){return{ok:o,docs:r}}))}var ei="pouchdb";function ti(e,t,n,i,r){return e.get(t).catch((function(n){if(404===n.status)return"http"!==e.adapter&&"https"!==e.adapter||L(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:i,_id:t,history:[],replicator:ei,version:1};throw n})).then((function(o){if(!r.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter((function(e){return e.session_id!==i})),o.history.unshift({last_seq:n,session_id:i}),o.history=o.history.slice(0,5),o.version=1,o.replicator=ei,o.session_id=i,o.last_seq=n,e.put(o).catch((function(o){if(409===o.status)return ti(e,t,n,i,r);throw o}))}))}function ni(e,t,n,i,r){this.src=e,this.target=t,this.id=n,this.returnValue=i,this.opts=r||{}}ni.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then((function(){return n.updateSource(e,t)}))},ni.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?ti(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},ni.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return ti(this.src,this.id,e,t,this.returnValue).catch((function(e){if(si(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e}))}return Promise.resolve(!0)};var ii={undefined:function(e,t){return 0===ft(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:ri(e.history,t.history)}(t,e).last_seq}};function ri(e,t){var n=e[0],i=e.slice(1),r=t[0],o=t.slice(1);return n&&0!==t.length?oi(n.session_id,t)?{last_seq:n.last_seq,history:e}:oi(r.session_id,i)?{last_seq:r.last_seq,history:o}:ri(i,o):{last_seq:0,history:[]}}function oi(e,t){var n=t[0],i=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||oi(e,i))}function si(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}ni.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then((function(e){return e.last_seq||0})).catch((function(e){if(404!==e.status)throw e;return 0})):e.target.get(e.id).then((function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||0:e.src.get(e.id).then((function(e){return t.version!==e.version?0:(n=t.version?t.version.toString():"undefined")in ii?ii[n](t,e):0;var n}),(function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then((function(){return 0}),(function(n){return si(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):0}));throw n}))})).catch((function(e){if(404!==e.status)throw e;return 0}))};function ai(e,t,n){var i=n.doc_ids?n.doc_ids.sort(ft):"",r=n.filter?n.filter.toString():"",o="",s="",a="";return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(ft).reduce((function(t,n){return t[n]=e[n],t}),{})}(n.query_params))),n.filter&&"_view"===n.filter&&(s=n.view.toString()),Promise.all([e.id(),t.id()]).then((function(e){var t=e[0]+e[1]+r+s+o+i+a;return new Promise((function(e){ke(t,e)}))})).then((function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")}))}function li(e,t,n,i,r){var o,s,l,c=[],u={seq:0,changes:[],docs:[]},d=!1,h=!1,p=!1,f=0,g=n.continuous||n.live||!1,m=n.batch_size||100,b=n.batches_limit||10,y=!1,v=n.doc_ids,_=n.selector,T=[],x=Ae();r=r||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var w={};function k(){return l?Promise.resolve():ai(e,t,n).then((function(r){s=r;var o;o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},l=new ni(e,t,s,i,o)}))}function S(){if(T=[],0!==o.docs.length){var e=o.docs,s={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then((function(t){if(i.cancelled)throw R(),new Error("cancelled");var n=Object.create(null);t.forEach((function(e){e.error&&(n[e.id]=e)}));var o=Object.keys(n).length;r.doc_write_failures+=o,r.docs_written+=e.length-o,e.forEach((function(e){var t=n[e._id];if(t){r.errors.push(t);var o=(t.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw t;i.emit("denied",E(t))}else T.push(e)}))}),(function(t){throw r.doc_write_failures+=e.length,t}))}}function C(){if(o.error)throw new Error("There was a problem getting docs.");r.last_seq=f=o.seq;var e=E(r);return T.length&&(e.docs=T,"number"==typeof o.pending&&(e.pending=o.pending,delete o.pending),i.emit("change",e)),d=!0,l.writeCheckpoint(o.seq,x).then((function(){if(d=!1,i.cancelled)throw R(),new Error("cancelled");o=void 0,B()})).catch((function(e){throw F(e),e}))}function A(){return Qn(e,t,o.diffs,i).then((function(e){o.error=!e.ok,e.docs.forEach((function(e){delete o.diffs[e._id],r.docs_read++,o.docs.push(e)}))}))}function I(){var e;i.cancelled||o||(0!==c.length?(o=c.shift(),(e={},o.changes.forEach((function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map((function(e){return e.rev})))})),t.revsDiff(e).then((function(e){if(i.cancelled)throw R(),new Error("cancelled");o.diffs=e}))).then(A).then(S).then(C).then(I).catch((function(e){N("batch processing terminated with error",e)}))):O(!0))}function O(e){0!==u.changes.length?(e||h||u.changes.length>=m)&&(c.push(u),u={seq:0,changes:[],docs:[]},"pending"!==i.state&&"stopped"!==i.state||(i.state="active",i.emit("active")),I()):0!==c.length||o||((g&&w.live||h)&&(i.state="pending",i.emit("paused")),h&&R())}function N(e,t){p||(t.message||(t.message=e),r.ok=!1,r.status="aborting",c=[],u={seq:0,changes:[],docs:[]},R(t))}function R(o){if(!(p||i.cancelled&&(r.status="cancelled",d)))if(r.status=r.status||"complete",r.end_time=(new Date).toISOString(),r.last_seq=f,p=!0,o){(o=J(o)).result=r;var s=(o.name||"").toLowerCase();"unauthorized"===s||"forbidden"===s?(i.emit("error",o),i.removeAllListeners()):function(e,t,n,i){if(!1===e.retry)return t.emit("error",n),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=D),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var r=function(){e.current_back_off=0};t.once("paused",(function(){t.removeListener("active",r)})),t.once("active",r)}e.current_back_off=e.current_back_off||0,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(i,e.current_back_off)}(n,i,o,(function(){li(e,t,n,i)}))}else i.emit("complete",r),i.removeAllListeners()}function L(e,t,r){if(i.cancelled)return R();"number"==typeof t&&(u.pending=t),ee(n)(e)&&(u.seq=e.seq||r,u.changes.push(e),a((function(){O(0===c.length&&w.live)})))}function M(e){if(y=!1,i.cancelled)return R();if(e.results.length>0)w.since=e.results[e.results.length-1].seq,B(),O(!0);else{var t=function(){g?(w.live=!0,B()):h=!0,O(!0)};o||0!==e.results.length?t():(d=!0,l.writeCheckpoint(e.last_seq,x).then((function(){d=!1,r.last_seq=f=e.last_seq,t()})).catch(F))}}function P(e){if(y=!1,i.cancelled)return R();N("changes rejected",e)}function B(){if(!y&&!h&&c.length<b){y=!0,i._changes&&(i.removeListener("cancel",i._abortChanges),i._changes.cancel()),i.once("cancel",r);var t=e.changes(w).on("change",L);t.then(o,o),t.then(M).catch(P),n.retry&&(i._changes=t,i._abortChanges=r)}function r(){t.cancel()}function o(){i.removeListener("cancel",r)}}function j(){k().then((function(){if(!i.cancelled)return l.getCheckpoint().then((function(e){w={since:f=e,limit:m,batch_size:m,style:"all_docs",doc_ids:v,selector:_,return_docs:!0},n.filter&&("string"!=typeof n.filter?w.include_docs=!0:w.filter=n.filter),"heartbeat"in n&&(w.heartbeat=n.heartbeat),"timeout"in n&&(w.timeout=n.timeout),n.query_params&&(w.query_params=n.query_params),n.view&&(w.view=n.view),B()}));R()})).catch((function(e){N("getCheckpoint rejected with ",e)}))}function F(e){d=!1,N("writeCheckpoint completed with error",e)}i.ready(e,t),i.cancelled?R():(i._addedListeners||(i.once("cancel",R),"function"==typeof n.complete&&(i.once("error",n.complete),i.once("complete",(function(e){n.complete(null,e)}))),i._addedListeners=!0),void 0===n.since?j():k().then((function(){return d=!0,l.writeCheckpoint(n.since,x)})).then((function(){d=!1,i.cancelled?R():(f=n.since,j())})).catch(F))}function ci(){p.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise((function(t,n){e.once("complete",t),e.once("error",n)}));e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch((function(){}))}function ui(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function di(e,t,n,i){if("function"==typeof n&&(i=n,n={}),void 0===n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw J(q,"`doc_ids` filter parameter is not a list.");n.complete=i,(n=E(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var r=new ci(n);return li(ui(e,n),ui(t,n),n,r),r}function hi(e,t,n,i){return"function"==typeof n&&(i=n,n={}),void 0===n&&(n={}),(n=E(n)).PouchConstructor=n.PouchConstructor||this,new pi(e=ui(e,n),t=ui(t,n),n,i)}function pi(e,t,n,i){var r=this;this.canceled=!1;var o=n.push?M({},n,n.push):n,s=n.pull?M({},n,n.pull):n;function a(e){r.emit("change",{direction:"pull",change:e})}function l(e){r.emit("change",{direction:"push",change:e})}function c(e){r.emit("denied",{direction:"push",doc:e})}function u(e){r.emit("denied",{direction:"pull",doc:e})}function d(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function h(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function p(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function f(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}this.push=di(e,t,o),this.pull=di(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var g={};function m(e){return function(t,n){("change"===t&&(n===a||n===l)||"denied"===t&&(n===u||n===c)||"paused"===t&&(n===h||n===d)||"active"===t&&(n===f||n===p))&&(t in g||(g[t]={}),g[t][e]=!0,2===Object.keys(g[t]).length&&r.removeAllListeners(t))}}function b(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}n.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",(function(e){"change"===e?(b(r.pull,"change",a),b(r.push,"change",l)):"denied"===e?(b(r.pull,"denied",u),b(r.push,"denied",c)):"active"===e?(b(r.pull,"active",f),b(r.push,"active",p)):"paused"===e&&(b(r.pull,"paused",h),b(r.push,"paused",d))})),this.on("removeListener",(function(e){"change"===e?(r.pull.removeListener("change",a),r.push.removeListener("change",l)):"denied"===e?(r.pull.removeListener("denied",u),r.push.removeListener("denied",c)):"active"===e?(r.pull.removeListener("active",f),r.push.removeListener("active",p)):"paused"===e&&(r.pull.removeListener("paused",h),r.push.removeListener("paused",d))})),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var y=Promise.all([this.push,this.pull]).then((function(e){var t={push:e[0],pull:e[1]};return r.emit("complete",t),i&&i(null,t),r.removeAllListeners(),t}),(function(e){if(r.cancel(),i?i(e):r.emit("error",e),r.removeAllListeners(),i)throw e}));this.then=function(e,t){return y.then(e,t)},this.catch=function(e){return y.catch(e)}}h(ci,p.EventEmitter),ci.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},ci.prototype.ready=function(e,t){var n=this;function i(){n.cancel()}n._readyCalled||(n._readyCalled=!0,e.once("destroyed",i),t.once("destroyed",i),n.once("complete",(function(){e.removeListener("destroyed",i),t.removeListener("destroyed",i)})))},h(pi,p.EventEmitter),pi.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Qe.plugin((function(e){e.adapter("idb",fn,!0)})).plugin((function(e){e.adapter("http",wn,!1),e.adapter("https",wn,!1)})).plugin(Zn).plugin((function(e){e.replicate=di,e.sync=hi,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(t,n,i){return e.constructor.replicate(t,e,n,i)},to:function(t,n,i){return e.constructor.replicate(e,t,n,i)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}})),t.exports=Qe}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:485,argsarray:367,events:408,immediate:422,inherits:423,"spark-md5":608,uuid:625,vuvuzela:630}],484:[function(e,t,n){(function(e){(function(){"use strict";void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,n,i,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,i)}));case 4:return e.nextTick((function(){t.call(null,n,i,r)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick((function(){t.apply(null,o)}))}}}:t.exports=e}).call(this)}).call(this,e("_process"))},{_process:485}],485:[function(e,t,n){var i,r,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],d=!1,h=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||d||l(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],486:[function(e,t,n){"use strict";var i=e("./lib/ReactPropTypesSecret");function r(){}function o(){}o.resetWarningCache=r,t.exports=function(){function e(e,t,n,r,o,s){if(s!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},{"./lib/ReactPropTypesSecret":488}],487:[function(e,t,n){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":486}],488:[function(e,t,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],489:[function(e,t,n){var i,r;i=this,r=function(){var e="function"==typeof Object.defineProperty?function(e,t,n){return Object.defineProperty(e,t,n),e}:function(e,t,n){return e[t]=n.value,e};return function(t,n,i,r){var o;if(r=function(e,t){var n="object"==typeof t,i=!n&&"string"==typeof t,r=function(e){return n?!!t[e]:!!i&&t.indexOf(e[0])>-1};return{enumerable:r("enumerable"),configurable:r("configurable"),writable:r("writable"),value:e}}(i,r),"object"==typeof n){for(o in n)Object.hasOwnProperty.call(n,o)&&(r.value=n[o],e(t,o,r));return t}return e(t,n,r)}},void 0!==t&&t.exports?t.exports=r():i.prr=r()},{}],490:[function(e,t,n){"use strict";var i=e("react"),r=e("object-assign"),o=e("scheduler");function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(s(227));var a=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var d=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,f={},g={};function m(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){b[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];b[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){b[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){b[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){b[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){b[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){b[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){b[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){b[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,i){var r=b.hasOwnProperty(t)?b[t]:null;(null!==r?0===r.type:!i&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!p.call(g,e)||!p.call(f,e)&&(h.test(e)?g[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);b[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);b[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);b[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){b[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),b.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){b[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=60103,x=60106,w=60107,k=60108,S=60114,C=60109,A=60110,I=60112,O=60113,N=60120,R=60115,D=60116,L=60121,M=60128,P=60129,B=60130,j=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;T=F("react.element"),x=F("react.portal"),w=F("react.fragment"),k=F("react.strict_mode"),S=F("react.profiler"),C=F("react.provider"),A=F("react.context"),I=F("react.forward_ref"),O=F("react.suspense"),N=F("react.suspense_list"),R=F("react.memo"),D=F("react.lazy"),L=F("react.block"),F("react.scope"),M=F("react.opaque.id"),P=F("react.debug_trace_mode"),B=F("react.offscreen"),j=F("react.legacy_hidden")}var $,U="function"==typeof Symbol&&Symbol.iterator;function H(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=U&&e[U]||e["@@iterator"])?e:null}function G(e){if(void 0===$)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);$=t&&t[1]||""}return"\n"+$+e}var V=!1;function W(e,t){if(!e||V)return"";V=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var i=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){i=e}e.call(t.prototype)}else{try{throw Error()}catch(e){i=e}e()}}catch(e){if(e&&i&&"string"==typeof e.stack){for(var r=e.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a])return"\n"+r[s].replace(" at new "," at ")}while(1<=s&&0<=a);break}}}finally{V=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?G(e):""}function z(e){switch(e.tag){case 5:return G(e.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return W(e.type,!1);case 11:return W(e.type.render,!1);case 22:return W(e.type._render,!1);case 1:return W(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case w:return"Fragment";case x:return"Portal";case S:return"Profiler";case k:return"StrictMode";case O:return"Suspense";case N:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case R:return q(e.type);case L:return q(e._render);case D:t=e._payload,e=e._init;try{return q(e(t))}catch(e){}}return null}function Y(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Z(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=K(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function J(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Y(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=Y(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?re(e,t.type,n):t.hasOwnProperty("defaultValue")&&re(e,t.type,Y(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ie(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function re(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function oe(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function se(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Y(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Y(n)}}function ce(e,t){var n=Y(t.value),i=Y(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var de="http://www.w3.org/1999/xhtml",he="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ge,me,be=(me=function(e,t){if(e.namespaceURI!==he||"innerHTML"in e)e.innerHTML=t;else{for((ge=ge||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ge.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return me(e,t)}))}:me);function ye(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ve={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_e=["Webkit","ms","Moz","O"];function Ee(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||ve.hasOwnProperty(e)&&ve[e]?(""+t).trim():t+"px"}function Te(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=Ee(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(ve).forEach((function(e){_e.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ve[t]=ve[e]}))}));var xe=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function we(e,t){if(t){if(xe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function ke(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Ae=null,Ie=null;function Oe(e){if(e=er(e)){if("function"!=typeof Ce)throw Error(s(280));var t=e.stateNode;t&&(t=nr(t),Ce(e.stateNode,e.type,t))}}function Ne(e){Ae?Ie?Ie.push(e):Ie=[e]:Ae=e}function Re(){if(Ae){var e=Ae,t=Ie;if(Ie=Ae=null,Oe(e),t)for(e=0;e<t.length;e++)Oe(t[e])}}function De(e,t){return e(t)}function Le(e,t,n,i,r){return e(t,n,i,r)}function Me(){}var Pe=De,Be=!1,je=!1;function Fe(){null===Ae&&null===Ie||(Me(),Re())}function $e(e,t){var n=e.stateNode;if(null===n)return null;var i=nr(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var Ue=!1;if(d)try{var He={};Object.defineProperty(He,"passive",{get:function(){Ue=!0}}),window.addEventListener("test",He,He),window.removeEventListener("test",He,He)}catch(me){Ue=!1}function Ge(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Ve=!1,We=null,ze=!1,qe=null,Ye={onError:function(e){Ve=!0,We=e}};function Ke(e,t,n,i,r,o,s,a,l){Ve=!1,We=null,Ge.apply(Ye,arguments)}function Ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Xe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Je(e){if(Ze(e)!==e)throw Error(s(188))}function Qe(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ze(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Je(r),e;if(o===i)return Je(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,it,rt,ot=!1,st=[],at=null,lt=null,ct=null,ut=new Map,dt=new Map,ht=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ft(e,t,n,i,r){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:r,targetContainers:[i]}}function gt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":dt.delete(t.pointerId)}}function mt(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e=ft(t,n,i,r,o),null!==t&&null!==(t=er(t))&&nt(t),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function bt(e){var t=Qi(e.target);if(null!==t){var n=Ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Xe(n)))return e.blockedOn=t,void rt(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){it(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=er(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function vt(e,t,n){yt(e)&&n.delete(t)}function _t(){for(ot=!1;0<st.length;){var e=st[0];if(null!==e.blockedOn){null!==(e=er(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&st.shift()}null!==at&&yt(at)&&(at=null),null!==lt&&yt(lt)&&(lt=null),null!==ct&&yt(ct)&&(ct=null),ut.forEach(vt),dt.forEach(vt)}function Et(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,_t)))}function Tt(e){function t(t){return Et(t,e)}if(0<st.length){Et(st[0],e);for(var n=1;n<st.length;n++){var i=st[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==at&&Et(at,e),null!==lt&&Et(lt,e),null!==ct&&Et(ct,e),ut.forEach(t),dt.forEach(t),n=0;n<ht.length;n++)(i=ht[n]).blockedOn===e&&(i.blockedOn=null);for(;0<ht.length&&null===(n=ht[0]).blockedOn;)bt(n),null===n.blockedOn&&ht.shift()}function xt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wt={animationend:xt("Animation","AnimationEnd"),animationiteration:xt("Animation","AnimationIteration"),animationstart:xt("Animation","AnimationStart"),transitionend:xt("Transition","TransitionEnd")},kt={},St={};function Ct(e){if(kt[e])return kt[e];if(!wt[e])return e;var t,n=wt[e];for(t in n)if(n.hasOwnProperty(t)&&t in St)return kt[e]=n[t];return e}d&&(St=document.createElement("div").style,"AnimationEvent"in window||(delete wt.animationend.animation,delete wt.animationiteration.animation,delete wt.animationstart.animation),"TransitionEvent"in window||delete wt.transitionend.transition);var At=Ct("animationend"),It=Ct("animationiteration"),Ot=Ct("animationstart"),Nt=Ct("transitionend"),Rt=new Map,Dt=new Map,Lt=["abort","abort",At,"animationEnd",It,"animationIteration",Ot,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Nt,"transitionEnd","waiting","waiting"];function Mt(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],r=e[n+1];r="on"+(r[0].toUpperCase()+r.slice(1)),Dt.set(i,t),Rt.set(i,r),c(r,[i])}}(0,o.unstable_now)();var Pt=8;function Bt(e){if(0!=(1&e))return Pt=15,1;if(0!=(2&e))return Pt=14,2;if(0!=(4&e))return Pt=13,4;var t=24&e;return 0!==t?(Pt=12,t):0!=(32&e)?(Pt=11,32):0!=(t=192&e)?(Pt=10,t):0!=(256&e)?(Pt=9,256):0!=(t=3584&e)?(Pt=8,t):0!=(4096&e)?(Pt=7,4096):0!=(t=4186112&e)?(Pt=6,t):0!=(t=62914560&e)?(Pt=5,t):67108864&e?(Pt=4,67108864):0!=(134217728&e)?(Pt=3,134217728):0!=(t=805306368&e)?(Pt=2,t):0!=(1073741824&e)?(Pt=1,1073741824):(Pt=8,e)}function jt(e,t){var n=e.pendingLanes;if(0===n)return Pt=0;var i=0,r=0,o=e.expiredLanes,s=e.suspendedLanes,a=e.pingedLanes;if(0!==o)i=o,r=Pt=15;else if(0!=(o=134217727&n)){var l=o&~s;0!==l?(i=Bt(l),r=Pt):0!=(a&=o)&&(i=Bt(a),r=Pt)}else 0!=(o=n&~s)?(i=Bt(o),r=Pt):0!==a&&(i=Bt(a),r=Pt);if(0===i)return 0;if(i=n&((0>(i=31-Vt(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0==(t&s)){if(Bt(t),r<=Pt)return t;Pt=r}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-Vt(t)),i|=e[n],t&=~r;return i}function Ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function $t(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ut(24&~t))?$t(10,t):e;case 10:return 0===(e=Ut(192&~t))?$t(8,t):e;case 8:return 0===(e=Ut(3584&~t))&&0===(e=Ut(4186112&~t))&&(e=512),e;case 2:return 0===(t=Ut(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function Ut(e){return e&-e}function Ht(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Gt(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-Vt(t)]=n}var Vt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/zt|0)|0},Wt=Math.log,zt=Math.LN2;var qt=o.unstable_UserBlockingPriority,Yt=o.unstable_runWithPriority,Kt=!0;function Zt(e,t,n,i){Be||Me();var r=Jt,o=Be;Be=!0;try{Le(r,e,t,n,i)}finally{(Be=o)||Fe()}}function Xt(e,t,n,i){Yt(qt,Jt.bind(null,e,t,n,i))}function Jt(e,t,n,i){var r;if(Kt)if((r=0==(4&t))&&0<st.length&&-1<pt.indexOf(e))e=ft(null,e,t,n,i),st.push(e);else{var o=Qt(e,t,n,i);if(null===o)r&&gt(e,i);else{if(r){if(-1<pt.indexOf(e))return e=ft(o,e,t,n,i),void st.push(e);if(function(e,t,n,i,r){switch(t){case"focusin":return at=mt(at,e,t,n,i,r),!0;case"dragenter":return lt=mt(lt,e,t,n,i,r),!0;case"mouseover":return ct=mt(ct,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return ut.set(o,mt(ut.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,dt.set(o,mt(dt.get(o)||null,e,t,n,i,r)),!0}return!1}(o,e,t,n,i))return;gt(e,i)}Ri(e,t,i,null,n)}}}function Qt(e,t,n,i){var r=Se(i);if(null!==(r=Qi(r))){var o=Ze(r);if(null===o)r=null;else{var s=o.tag;if(13===s){if(null!==(r=Xe(o)))return r;r=null}else if(3===s){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Ri(e,t,i,r,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,i=n.length,r="value"in en?en.value:en.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return nn=r.slice(e,1<t?1-t:void 0)}function on(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function sn(){return!0}function an(){return!1}function ln(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?sn:an,this.isPropagationStopped=an,this}return r(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=sn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=sn)},persist:function(){},isPersistent:sn}),t}var cn,un,dn,hn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pn=ln(hn),fn=r({},hn,{view:0,detail:0}),gn=ln(fn),mn=r({},fn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==dn&&(dn&&"mousemove"===e.type?(cn=e.screenX-dn.screenX,un=e.screenY-dn.screenY):un=cn=0,dn=e),cn)},movementY:function(e){return"movementY"in e?e.movementY:un}}),bn=ln(mn),yn=ln(r({},mn,{dataTransfer:0})),vn=ln(r({},fn,{relatedTarget:0})),_n=ln(r({},hn,{animationName:0,elapsedTime:0,pseudoElement:0})),En=ln(r({},hn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Tn=ln(r({},hn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Cn(){return Sn}var An=ln(r({},fn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=on(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?on(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?on(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),In=ln(r({},mn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=ln(r({},fn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Nn=ln(r({},hn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=ln(r({},mn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Dn=[9,13,27,32],Ln=d&&"CompositionEvent"in window,Mn=null;d&&"documentMode"in document&&(Mn=document.documentMode);var Pn=d&&"TextEvent"in window&&!Mn,Bn=d&&(!Ln||Mn&&8<Mn&&11>=Mn),jn=String.fromCharCode(32),Fn=!1;function $n(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Wn(e,t,n,i){Ne(i),0<(t=Li(t,"onChange")).length&&(n=new pn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var zn=null,qn=null;function Yn(e){Si(e,0)}function Kn(e){if(X(tr(e)))return e}function Zn(e,t){if("change"===e)return t}var Xn=!1;if(d){var Jn;if(d){var Qn="oninput"in document;if(!Qn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Qn="function"==typeof ei.oninput}Jn=Qn}else Jn=!1;Xn=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){zn&&(zn.detachEvent("onpropertychange",ni),qn=zn=null)}function ni(e){if("value"===e.propertyName&&Kn(qn)){var t=[];if(Wn(t,qn,e,Se(e)),e=Yn,Be)e(t);else{Be=!0;try{De(e,t)}finally{Be=!1,Fe()}}}}function ii(e,t,n){"focusin"===e?(ti(),qn=n,(zn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(qn)}function oi(e,t){if("click"===e)return Kn(t)}function si(e,t){if("input"===e||"change"===e)return Kn(t)}var ai="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},li=Object.prototype.hasOwnProperty;function ci(e,t){if(ai(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!li.call(t,n[i])||!ai(e[n[i]],t[n[i]]))return!1;return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function di(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function hi(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hi(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pi(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var gi=d&&"documentMode"in document&&11>=document.documentMode,mi=null,bi=null,yi=null,vi=!1;function _i(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vi||null==mi||mi!==J(i)||(i="selectionStart"in(i=mi)&&fi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&ci(yi,i)||(yi=i,0<(i=Li(bi,"onSelect")).length&&(t=new pn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}Mt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Mt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Mt(Lt,2);for(var Ei="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Ti=0;Ti<Ei.length;Ti++)Dt.set(Ei[Ti],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wi=new Set("cancel close invalid load scroll toggle".split(" ").concat(xi));function ki(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,a,l,c){if(Ke.apply(this,arguments),Ve){if(!Ve)throw Error(s(198));var u=We;Ve=!1,We=null,ze||(ze=!0,qe=u)}}(i,t,void 0,e),e.currentTarget=null}function Si(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;ki(r,a,c),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;ki(r,a,c),o=l}}}if(ze)throw e=qe,ze=!1,qe=null,e}function Ci(e,t){var n=ir(t),i=e+"__bubble";n.has(i)||(Ni(t,e,2,!1),n.add(i))}var Ai="_reactListening"+Math.random().toString(36).slice(2);function Ii(e){e[Ai]||(e[Ai]=!0,a.forEach((function(t){wi.has(t)||Oi(t,!1,e,null),Oi(t,!0,e,null)})))}function Oi(e,t,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==i&&!t&&wi.has(e)){if("scroll"!==e)return;r|=2,o=i}var s=ir(o),a=e+"__"+(t?"capture":"bubble");s.has(a)||(t&&(r|=4),Ni(o,e,r,t),s.add(a))}function Ni(e,t,n,i){var r=Dt.get(t);switch(void 0===r?2:r){case 0:r=Zt;break;case 1:r=Xt;break;default:r=Jt}n=r.bind(null,t,n,e),r=void 0,!Ue||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Ri(e,t,n,i,r){var o=i;if(0==(1&t)&&0==(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=Qi(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}!function(e,t,n){if(je)return e(t,n);je=!0;try{Pe(e,t,n)}finally{je=!1,Fe()}}((function(){var i=o,r=Se(n),s=[];e:{var a=Rt.get(e);if(void 0!==a){var l=pn,c=e;switch(e){case"keypress":if(0===on(n))break e;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=vn;break;case"focusout":c="blur",l=vn;break;case"beforeblur":case"afterblur":l=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=bn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=yn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=On;break;case At:case It:case Ot:l=_n;break;case Nt:l=Nn;break;case"scroll":l=gn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=En;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=In}var u=0!=(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==h&&null!=(g=$e(f,h))&&u.push(Di(f,g,p))),d)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(c=n.relatedTarget||n.fromElement)||!Qi(c)&&!c[Xi])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?Qi(c):null)&&(c!==(d=Ze(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=bn,g="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=In,g="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?a:tr(l),p=null==c?a:tr(c),(a=new u(g,f+"leave",l,n,r)).target=d,a.relatedTarget=p,g=null,Qi(r)===i&&((u=new u(h,f+"enter",c,n,r)).target=p,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Mi(p))f++;for(p=0,g=h;g;g=Mi(g))p++;for(;0<f-p;)u=Mi(u),f--;for(;0<p-f;)h=Mi(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Mi(u),h=Mi(h)}u=null}else u=null;null!==l&&Pi(s,a,l,u,!1),null!==c&&null!==d&&Pi(s,d,c,u,!0)}if("select"===(l=(a=i?tr(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Zn;else if(Vn(a))if(Xn)m=si;else{m=ri;var b=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=oi);switch(m&&(m=m(e,i))?Wn(s,m,n,r):(b&&b(e,a,i),"focusout"===e&&(b=a._wrapperState)&&b.controlled&&"number"===a.type&&re(a,"number",a.value)),b=i?tr(i):window,e){case"focusin":(Vn(b)||"true"===b.contentEditable)&&(mi=b,bi=i,yi=null);break;case"focusout":yi=bi=mi=null;break;case"mousedown":vi=!0;break;case"contextmenu":case"mouseup":case"dragend":vi=!1,_i(s,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":_i(s,n,r)}var y;if(Ln)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Hn?$n(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Bn&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Hn&&(y=rn()):(tn="value"in(en=r)?en.value:en.textContent,Hn=!0)),0<(b=Li(i,v)).length&&(v=new Tn(v,e,null,n,r),s.push({event:v,listeners:b}),(y||null!==(y=Un(n)))&&(v.data=y))),(y=Pn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Fn=!0,jn);case"textInput":return(e=t.data)===jn&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Ln&&$n(e,t)?(e=rn(),nn=tn=en=null,Hn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&0<(i=Li(i,"onBeforeInput")).length&&(r=new Tn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=y)}Si(s,t)}))}function Di(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Li(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=$e(e,n))&&i.unshift(Di(e,o,r)),null!=(o=$e(e,t))&&i.push(Di(e,o,r))),e=e.return}return i}function Mi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Pi(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=$e(n,o))&&s.unshift(Di(n,l,a)):r||null!=(l=$e(n,o))&&s.push(Di(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}function Bi(){}var ji=null,Fi=null;function $i(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ui(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Hi="function"==typeof setTimeout?setTimeout:void 0,Gi="function"==typeof clearTimeout?clearTimeout:void 0;function Vi(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function Wi(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function zi(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var qi=0;var Yi=Math.random().toString(36).slice(2),Ki="__reactFiber$"+Yi,Zi="__reactProps$"+Yi,Xi="__reactContainer$"+Yi,Ji="__reactEvents$"+Yi;function Qi(e){var t=e[Ki];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Xi]||n[Ki]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=zi(e);null!==e;){if(n=e[Ki])return n;e=zi(e)}return t}n=(e=n).parentNode}return null}function er(e){return!(e=e[Ki]||e[Xi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function tr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function nr(e){return e[Zi]||null}function ir(e){var t=e[Ji];return void 0===t&&(t=e[Ji]=new Set),t}var rr=[],or=-1;function sr(e){return{current:e}}function ar(e){0>or||(e.current=rr[or],rr[or]=null,or--)}function lr(e,t){rr[++or]=e.current,e.current=t}var cr={},ur=sr(cr),dr=sr(!1),hr=cr;function pr(e,t){var n=e.type.contextTypes;if(!n)return cr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function fr(e){return null!=e.childContextTypes}function gr(){ar(dr),ar(ur)}function mr(e,t,n){if(ur.current!==cr)throw Error(s(168));lr(ur,t),lr(dr,n)}function br(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var o in i=i.getChildContext())if(!(o in e))throw Error(s(108,q(t)||"Unknown",o));return r({},n,i)}function yr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cr,hr=ur.current,lr(ur,e),lr(dr,dr.current),!0}function vr(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=br(e,t,hr),i.__reactInternalMemoizedMergedChildContext=e,ar(dr),ar(ur),lr(ur,e)):ar(dr),lr(dr,n)}var _r=null,Er=null,Tr=o.unstable_runWithPriority,xr=o.unstable_scheduleCallback,wr=o.unstable_cancelCallback,kr=o.unstable_shouldYield,Sr=o.unstable_requestPaint,Cr=o.unstable_now,Ar=o.unstable_getCurrentPriorityLevel,Ir=o.unstable_ImmediatePriority,Or=o.unstable_UserBlockingPriority,Nr=o.unstable_NormalPriority,Rr=o.unstable_LowPriority,Dr=o.unstable_IdlePriority,Lr={},Mr=void 0!==Sr?Sr:function(){},Pr=null,Br=null,jr=!1,Fr=Cr(),$r=1e4>Fr?Cr:function(){return Cr()-Fr};function Ur(){switch(Ar()){case Ir:return 99;case Or:return 98;case Nr:return 97;case Rr:return 96;case Dr:return 95;default:throw Error(s(332))}}function Hr(e){switch(e){case 99:return Ir;case 98:return Or;case 97:return Nr;case 96:return Rr;case 95:return Dr;default:throw Error(s(332))}}function Gr(e,t){return e=Hr(e),Tr(e,t)}function Vr(e,t,n){return e=Hr(e),xr(e,t,n)}function Wr(){if(null!==Br){var e=Br;Br=null,wr(e)}zr()}function zr(){if(!jr&&null!==Pr){jr=!0;var e=0;try{var t=Pr;Gr(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Pr=null}catch(t){throw null!==Pr&&(Pr=Pr.slice(e+1)),xr(Ir,Wr),t}finally{jr=!1}}}var qr=E.ReactCurrentBatchConfig;function Yr(e,t){if(e&&e.defaultProps){for(var n in t=r({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Kr=sr(null),Zr=null,Xr=null,Jr=null;function Qr(){Jr=Xr=Zr=null}function eo(e){var t=Kr.current;ar(Kr),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function no(e,t){Zr=e,Jr=Xr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Ls=!0),e.firstContext=null)}function io(e,t){if(Jr!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Jr=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Xr){if(null===Zr)throw Error(s(308));Xr=t,Zr.dependencies={lanes:0,firstContext:t,responders:null}}else Xr=Xr.next=t;return e._currentValue}var ro=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function so(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function co(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function uo(e,t,n,i){var o=e.updateQueue;ro=!1;var s=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var c=l,u=c.next;c.next=null,null===a?s=u:a.next=u,a=c;var d=e.alternate;if(null!==d){var h=(d=d.updateQueue).lastBaseUpdate;h!==a&&(null===h?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=c)}}if(null!==s){for(h=o.baseState,a=0,d=u=c=null;;){l=s.lane;var p=s.eventTime;if((i&l)===l){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,g=s;switch(l=t,p=n,g.tag){case 1:if("function"==typeof(f=g.payload)){h=f.call(p,h,l);break e}h=f;break e;case 3:f.flags=-4097&f.flags|64;case 0:if(null==(l="function"==typeof(f=g.payload)?f.call(p,h,l):f))break e;h=r({},h,l);break e;case 2:ro=!0}}null!==s.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[s]:l.push(s))}else p={eventTime:p,lane:l,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(u=d=p,c=h):d=d.next=p,a|=l;if(null===(s=s.next)){if(null===(l=o.shared.pending))break;s=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===d&&(c=h),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=d,Ba|=a,e.lanes=a,e.memoizedState=h}}function ho(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(s(191,r));r.call(i)}}}var po=(new i.Component).refs;function fo(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:r({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var go={isMounted:function(e){return!!(e=e._reactInternals)&&Ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=ll(),r=cl(e),o=ao(i,r);o.payload=t,null!=n&&(o.callback=n),lo(e,o),ul(e,r,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=ll(),r=cl(e),o=ao(i,r);o.tag=1,o.payload=t,null!=n&&(o.callback=n),lo(e,o),ul(e,r,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ll(),i=cl(e),r=ao(n,i);r.tag=2,null!=t&&(r.callback=t),lo(e,r),ul(e,i,n)}};function mo(e,t,n,i,r,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!(t.prototype&&t.prototype.isPureReactComponent&&ci(n,i)&&ci(r,o))}function bo(e,t,n){var i=!1,r=cr,o=t.contextType;return"object"==typeof o&&null!==o?o=io(o):(r=fr(t)?hr:ur.current,o=(i=null!=(i=t.contextTypes))?pr(e,r):cr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=go,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function yo(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&go.enqueueReplaceState(t,t.state,null)}function vo(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=po,oo(e);var o=t.contextType;"object"==typeof o&&null!==o?r.context=io(o):(o=fr(t)?hr:ur.current,r.context=pr(e,o)),uo(e,n,r,i),r.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(fo(e,t,o,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&go.enqueueReplaceState(r,r.state,null),uo(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4)}var _o=Array.isArray;function Eo(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===r?t.ref:((t=function(e){var t=i.refs;t===po&&(t=i.refs={}),null===e?delete t[r]:t[r]=e})._stringRef=r,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function To(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function xo(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Hl(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags=2,n):i:(t.flags=2,n):n}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=zl(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){return null!==t&&t.elementType===n.type?((i=r(t,n.props)).ref=Eo(e,t,n),i.return=e,i):((i=Gl(n.type,n.key,n.props,null,e.mode,i)).ref=Eo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ql(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,o){return null===t||7!==t.tag?((t=Vl(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t||"number"==typeof t)return(t=zl(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case T:return(n=Gl(t.type,t.key,t.props,null,e.mode,n)).ref=Eo(e,null,t),n.return=e,n;case x:return(t=ql(t,e.mode,n)).return=e,t}if(_o(t)||H(t))return(t=Vl(t,e.mode,n,null)).return=e,t;To(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==r?null:l(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case T:return n.key===r?n.type===w?d(e,t,n.props.children,i,r):c(e,t,n,i):null;case x:return n.key===r?u(e,t,n,i):null}if(_o(n)||H(n))return null!==r?null:d(e,t,n,i,null);To(e,n)}return null}function f(e,t,n,i,r){if("string"==typeof i||"number"==typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case T:return e=e.get(null===i.key?n:i.key)||null,i.type===w?d(t,e,i.props.children,r,i.key):c(t,e,i,r);case x:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r)}if(_o(i)||H(i))return d(t,e=e.get(n)||null,i,r,null);To(t,i)}return null}function g(r,s,a,l){for(var c=null,u=null,d=s,g=s=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var b=p(r,d,a[g],l);if(null===b){null===d&&(d=m);break}e&&d&&null===b.alternate&&t(r,d),s=o(b,s,g),null===u?c=b:u.sibling=b,u=b,d=m}if(g===a.length)return n(r,d),c;if(null===d){for(;g<a.length;g++)null!==(d=h(r,a[g],l))&&(s=o(d,s,g),null===u?c=d:u.sibling=d,u=d);return c}for(d=i(r,d);g<a.length;g++)null!==(m=f(d,r,g,a[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),s=o(m,s,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(r,e)})),c}function m(r,a,l,c){var u=H(l);if("function"!=typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,g=a,m=a=0,b=null,y=l.next();null!==g&&!y.done;m++,y=l.next()){g.index>m?(b=g,g=null):b=g.sibling;var v=p(r,g,y.value,c);if(null===v){null===g&&(g=b);break}e&&g&&null===v.alternate&&t(r,g),a=o(v,a,m),null===d?u=v:d.sibling=v,d=v,g=b}if(y.done)return n(r,g),u;if(null===g){for(;!y.done;m++,y=l.next())null!==(y=h(r,y.value,c))&&(a=o(y,a,m),null===d?u=y:d.sibling=y,d=y);return u}for(g=i(r,g);!y.done;m++,y=l.next())null!==(y=f(g,r,m,y.value,c))&&(e&&null!==y.alternate&&g.delete(null===y.key?m:y.key),a=o(y,a,m),null===d?u=y:d.sibling=y,d=y);return e&&g.forEach((function(e){return t(r,e)})),u}return function(e,i,o,l){var c="object"==typeof o&&null!==o&&o.type===w&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case T:e:{for(u=o.key,c=i;null!==c;){if(c.key===u){switch(c.tag){case 7:if(o.type===w){n(e,c.sibling),(i=r(c,o.props.children)).return=e,e=i;break e}break;default:if(c.elementType===o.type){n(e,c.sibling),(i=r(c,o.props)).ref=Eo(e,c,o),i.return=e,e=i;break e}}n(e,c);break}t(e,c),c=c.sibling}o.type===w?((i=Vl(o.props.children,e.mode,l,o.key)).return=e,e=i):((l=Gl(o.type,o.key,o.props,null,e.mode,l)).ref=Eo(e,i,o),l.return=e,e=l)}return a(e);case x:e:{for(c=o.key;null!==i;){if(i.key===c){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(e,i.sibling),(i=r(i,o.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=ql(o,e.mode,l)).return=e,e=i}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==i&&6===i.tag?(n(e,i.sibling),(i=r(i,o)).return=e,e=i):(n(e,i),(i=zl(o,e.mode,l)).return=e,e=i),a(e);if(_o(o))return g(e,i,o,l);if(H(o))return m(e,i,o,l);if(u&&To(e,o),void 0===o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,q(e.type)||"Component"))}return n(e,i)}}var wo=xo(!0),ko=xo(!1),So={},Co=sr(So),Ao=sr(So),Io=sr(So);function Oo(e){if(e===So)throw Error(s(174));return e}function No(e,t){switch(lr(Io,t),lr(Ao,e),lr(Co,So),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ar(Co),lr(Co,t)}function Ro(){ar(Co),ar(Ao),ar(Io)}function Do(e){Oo(Io.current);var t=Oo(Co.current),n=fe(t,e.type);t!==n&&(lr(Ao,e),lr(Co,n))}function Lo(e){Ao.current===e&&(ar(Co),ar(Ao))}var Mo=sr(0);function Po(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bo=null,jo=null,Fo=!1;function $o(e,t){var n=$l(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Uo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Ho(e){if(Fo){var t=jo;if(t){var n=t;if(!Uo(e,t)){if(!(t=Wi(n.nextSibling))||!Uo(e,t))return e.flags=-1025&e.flags|2,Fo=!1,void(Bo=e);$o(Bo,n)}Bo=e,jo=Wi(t.firstChild)}else e.flags=-1025&e.flags|2,Fo=!1,Bo=e}}function Go(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Bo=e}function Vo(e){if(e!==Bo)return!1;if(!Fo)return Go(e),Fo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ui(t,e.memoizedProps))for(t=jo;t;)$o(e,t),t=Wi(t.nextSibling);if(Go(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){jo=Wi(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}jo=null}}else jo=Bo?Wi(e.stateNode.nextSibling):null;return!0}function Wo(){jo=Bo=null,Fo=!1}var zo=[];function qo(){for(var e=0;e<zo.length;e++)zo[e]._workInProgressVersionPrimary=null;zo.length=0}var Yo=E.ReactCurrentDispatcher,Ko=E.ReactCurrentBatchConfig,Zo=0,Xo=null,Jo=null,Qo=null,es=!1,ts=!1;function ns(){throw Error(s(321))}function is(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function rs(e,t,n,i,r,o){if(Zo=o,Xo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yo.current=null===e||null===e.memoizedState?Os:Ns,e=n(i,r),ts){o=0;do{if(ts=!1,!(25>o))throw Error(s(301));o+=1,Qo=Jo=null,t.updateQueue=null,Yo.current=Rs,e=n(i,r)}while(ts)}if(Yo.current=Is,t=null!==Jo&&null!==Jo.next,Zo=0,Qo=Jo=Xo=null,es=!1,t)throw Error(s(300));return e}function os(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qo?Xo.memoizedState=Qo=e:Qo=Qo.next=e,Qo}function ss(){if(null===Jo){var e=Xo.alternate;e=null!==e?e.memoizedState:null}else e=Jo.next;var t=null===Qo?Xo.memoizedState:Qo.next;if(null!==t)Qo=t,Jo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(Jo=e).memoizedState,baseState:Jo.baseState,baseQueue:Jo.baseQueue,queue:Jo.queue,next:null},null===Qo?Xo.memoizedState=Qo=e:Qo=Qo.next=e}return Qo}function as(e,t){return"function"==typeof t?t(e):t}function ls(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=Jo,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){r=r.next,i=i.baseState;var l=a=o=null,c=r;do{var u=c.lane;if((Zo&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),i=c.eagerReducer===e?c.eagerState:e(i,c.action);else{var d={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=d,o=i):l=l.next=d,Xo.lanes|=u,Ba|=u}c=c.next}while(null!==c&&c!==r);null===l?o=i:l.next=a,ai(i,t.memoizedState)||(Ls=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function cs(e){var t=ss(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);ai(o,t.memoizedState)||(Ls=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function us(e,t,n){var i=t._getVersion;i=i(t._source);var r=t._workInProgressVersionPrimary;if(null!==r?e=r===i:(e=e.mutableReadLanes,(e=(Zo&e)===e)&&(t._workInProgressVersionPrimary=i,zo.push(t))),e)return n(t._source);throw zo.push(t),Error(s(350))}function ds(e,t,n,i){var r=Ia;if(null===r)throw Error(s(349));var o=t._getVersion,a=o(t._source),l=Yo.current,c=l.useState((function(){return us(r,t,n)})),u=c[1],d=c[0];c=Qo;var h=e.memoizedState,p=h.refs,f=p.getSnapshot,g=h.source;h=h.subscribe;var m=Xo;return e.memoizedState={refs:p,source:t,subscribe:i},l.useEffect((function(){p.getSnapshot=n,p.setSnapshot=u;var e=o(t._source);if(!ai(a,e)){e=n(t._source),ai(d,e)||(u(e),e=cl(m),r.mutableReadLanes|=e&r.pendingLanes),e=r.mutableReadLanes,r.entangledLanes|=e;for(var i=r.entanglements,s=e;0<s;){var l=31-Vt(s),c=1<<l;i[l]|=e,s&=~c}}}),[n,t,i]),l.useEffect((function(){return i(t._source,(function(){var e=p.getSnapshot,n=p.setSnapshot;try{n(e(t._source));var i=cl(m);r.mutableReadLanes|=i&r.pendingLanes}catch(e){n((function(){throw e}))}}))}),[t,i]),ai(f,n)&&ai(g,t)&&ai(h,i)||((e={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:d}).dispatch=u=As.bind(null,Xo,e),c.queue=e,c.baseQueue=null,d=us(r,t,n),c.memoizedState=c.baseState=d),d}function hs(e,t,n){return ds(ss(),e,t,n)}function ps(e){var t=os();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:as,lastRenderedState:e}).dispatch=As.bind(null,Xo,e),[t.memoizedState,e]}function fs(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Xo.updateQueue)?(t={lastEffect:null},Xo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function gs(e){return e={current:e},os().memoizedState=e}function ms(){return ss().memoizedState}function bs(e,t,n,i){var r=os();Xo.flags|=e,r.memoizedState=fs(1|t,n,void 0,void 0===i?null:i)}function ys(e,t,n,i){var r=ss();i=void 0===i?null:i;var o=void 0;if(null!==Jo){var s=Jo.memoizedState;if(o=s.destroy,null!==i&&is(i,s.deps))return void fs(t,n,o,i)}Xo.flags|=e,r.memoizedState=fs(1|t,n,o,i)}function vs(e,t){return bs(516,4,e,t)}function _s(e,t){return ys(516,4,e,t)}function Es(e,t){return ys(4,2,e,t)}function Ts(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function xs(e,t,n){return n=null!=n?n.concat([e]):null,ys(4,2,Ts.bind(null,t,e),n)}function ws(){}function ks(e,t){var n=ss();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&is(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Ss(e,t){var n=ss();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&is(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Cs(e,t){var n=Ur();Gr(98>n?98:n,(function(){e(!0)})),Gr(97<n?97:n,(function(){var n=Ko.transition;Ko.transition=1;try{e(!1),t()}finally{Ko.transition=n}}))}function As(e,t,n){var i=ll(),r=cl(e),o={lane:r,action:n,eagerReducer:null,eagerState:null,next:null},s=t.pending;if(null===s?o.next=o:(o.next=s.next,s.next=o),t.pending=o,s=e.alternate,e===Xo||null!==s&&s===Xo)ts=es=!0;else{if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,l=s(a,n);if(o.eagerReducer=s,o.eagerState=l,ai(l,a))return}catch(e){}ul(e,r,i)}}var Is={readContext:io,useCallback:ns,useContext:ns,useEffect:ns,useImperativeHandle:ns,useLayoutEffect:ns,useMemo:ns,useReducer:ns,useRef:ns,useState:ns,useDebugValue:ns,useDeferredValue:ns,useTransition:ns,useMutableSource:ns,useOpaqueIdentifier:ns,unstable_isNewReconciler:!1},Os={readContext:io,useCallback:function(e,t){return os().memoizedState=[e,void 0===t?null:t],e},useContext:io,useEffect:vs,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,bs(4,2,Ts.bind(null,t,e),n)},useLayoutEffect:function(e,t){return bs(4,2,e,t)},useMemo:function(e,t){var n=os();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=os();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=As.bind(null,Xo,e),[i.memoizedState,e]},useRef:gs,useState:ps,useDebugValue:ws,useDeferredValue:function(e){var t=ps(e),n=t[0],i=t[1];return vs((function(){var t=Ko.transition;Ko.transition=1;try{i(e)}finally{Ko.transition=t}}),[e]),n},useTransition:function(){var e=ps(!1),t=e[0];return gs(e=Cs.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var i=os();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ds(i,e,t,n)},useOpaqueIdentifier:function(){if(Fo){var e=!1,t=function(e){return{$$typeof:M,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(qi++).toString(36))),Error(s(355))})),n=ps(t)[1];return 0==(2&Xo.mode)&&(Xo.flags|=516,fs(5,(function(){n("r:"+(qi++).toString(36))}),void 0,null)),t}return ps(t="r:"+(qi++).toString(36)),t},unstable_isNewReconciler:!1},Ns={readContext:io,useCallback:ks,useContext:io,useEffect:_s,useImperativeHandle:xs,useLayoutEffect:Es,useMemo:Ss,useReducer:ls,useRef:ms,useState:function(){return ls(as)},useDebugValue:ws,useDeferredValue:function(e){var t=ls(as),n=t[0],i=t[1];return _s((function(){var t=Ko.transition;Ko.transition=1;try{i(e)}finally{Ko.transition=t}}),[e]),n},useTransition:function(){var e=ls(as)[0];return[ms().current,e]},useMutableSource:hs,useOpaqueIdentifier:function(){return ls(as)[0]},unstable_isNewReconciler:!1},Rs={readContext:io,useCallback:ks,useContext:io,useEffect:_s,useImperativeHandle:xs,useLayoutEffect:Es,useMemo:Ss,useReducer:cs,useRef:ms,useState:function(){return cs(as)},useDebugValue:ws,useDeferredValue:function(e){var t=cs(as),n=t[0],i=t[1];return _s((function(){var t=Ko.transition;Ko.transition=1;try{i(e)}finally{Ko.transition=t}}),[e]),n},useTransition:function(){var e=cs(as)[0];return[ms().current,e]},useMutableSource:hs,useOpaqueIdentifier:function(){return cs(as)[0]},unstable_isNewReconciler:!1},Ds=E.ReactCurrentOwner,Ls=!1;function Ms(e,t,n,i){t.child=null===e?ko(t,null,n,i):wo(t,e.child,n,i)}function Ps(e,t,n,i,r){n=n.render;var o=t.ref;return no(t,r),i=rs(e,t,n,i,o,r),null===e||Ls?(t.flags|=1,Ms(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~r,ta(e,t,r))}function Bs(e,t,n,i,r,o){if(null===e){var s=n.type;return"function"!=typeof s||Ul(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Gl(n.type,null,i,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,js(e,t,s,i,r,o))}return s=e.child,0==(r&o)&&(r=s.memoizedProps,(n=null!==(n=n.compare)?n:ci)(r,i)&&e.ref===t.ref)?ta(e,t,o):(t.flags|=1,(e=Hl(s,i)).ref=t.ref,e.return=t,t.child=e)}function js(e,t,n,i,r,o){if(null!==e&&ci(e.memoizedProps,i)&&e.ref===t.ref){if(Ls=!1,0==(o&r))return t.lanes=e.lanes,ta(e,t,o);0!=(16384&e.flags)&&(Ls=!0)}return Us(e,t,n,i,o)}function Fs(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},yl(t,n);else{if(0==(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},yl(t,e),null;t.memoizedState={baseLanes:0},yl(t,null!==o?o.baseLanes:n)}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,yl(t,i);return Ms(e,t,r,n),t.child}function $s(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Us(e,t,n,i,r){var o=fr(n)?hr:ur.current;return o=pr(t,o),no(t,r),n=rs(e,t,n,i,o,r),null===e||Ls?(t.flags|=1,Ms(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~r,ta(e,t,r))}function Hs(e,t,n,i,r){if(fr(n)){var o=!0;yr(t)}else o=!1;if(no(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),bo(t,n,i),vo(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;c="object"==typeof c&&null!==c?io(c):pr(t,c=fr(n)?hr:ur.current);var u=n.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==i||l!==c)&&yo(t,s,i,c),ro=!1;var h=t.memoizedState;s.state=h,uo(t,i,s,r),l=t.memoizedState,a!==i||h!==l||dr.current||ro?("function"==typeof u&&(fo(t,n,u,i),l=t.memoizedState),(a=ro||mo(t,n,a,i,h,l,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4)):("function"==typeof s.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"==typeof s.componentDidMount&&(t.flags|=4),i=!1)}else{s=t.stateNode,so(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Yr(t.type,a),s.props=c,d=t.pendingProps,h=s.context,l="object"==typeof(l=n.contextType)&&null!==l?io(l):pr(t,l=fr(n)?hr:ur.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==d||h!==l)&&yo(t,s,i,l),ro=!1,h=t.memoizedState,s.state=h,uo(t,i,s,r);var f=t.memoizedState;a!==d||h!==f||dr.current||ro?("function"==typeof p&&(fo(t,n,p,i),f=t.memoizedState),(c=ro||mo(t,n,c,i,h,f,l))?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=256),i=!1)}return Gs(e,t,n,i,o,r)}function Gs(e,t,n,i,r,o){$s(e,t);var s=0!=(64&t.flags);if(!i&&!s)return r&&vr(t,n,!1),ta(e,t,o);i=t.stateNode,Ds.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=wo(t,e.child,null,o),t.child=wo(t,null,a,o)):Ms(e,t,a,o),t.memoizedState=i.state,r&&vr(t,n,!0),t.child}function Vs(e){var t=e.stateNode;t.pendingContext?mr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mr(0,t.context,!1),No(e,t.containerInfo)}var Ws,zs,qs,Ys,Ks={dehydrated:null,retryLane:0};function Zs(e,t,n){var i,r=t.pendingProps,o=Mo.current,s=!1;return(i=0!=(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!=(2&o)),i?(s=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===r.fallback||!0===r.unstable_avoidThisFallback||(o|=1),lr(Mo,1&o),null===e?(void 0!==r.fallback&&Ho(t),e=r.children,o=r.fallback,s?(e=Xs(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Ks,e):"number"==typeof r.unstable_expectedLoadTime?(e=Xs(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Ks,t.lanes=33554432,e):((n=Wl({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,s?(r=function(e,t,n,i,r){var o=t.mode,s=e.child;e=s.sibling;var a={mode:"hidden",children:n};return 0==(2&o)&&t.child!==s?((n=t.child).childLanes=0,n.pendingProps=a,null!==(s=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=s,s.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Hl(s,a),null!==e?i=Hl(e,i):(i=Vl(i,o,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}(e,t,r.children,r.fallback,n),s=t.child,o=e.child.memoizedState,s.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},s.childLanes=e.childLanes&~n,t.memoizedState=Ks,r):(n=function(e,t,n,i){var r=e.child;return e=r.sibling,n=Hl(r,{mode:"visible",children:n}),0==(2&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}(e,t,r.children,n),t.memoizedState=null,n))}function Xs(e,t,n,i){var r=e.mode,o=e.child;return t={mode:"hidden",children:t},0==(2&r)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Wl(t,r,0,null),n=Vl(n,r,i,null),o.return=e,n.return=e,o.sibling=n,e.child=o,n}function Js(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),to(e.return,t)}function Qs(e,t,n,i,r,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r,s.lastEffect=o)}function ea(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Ms(e,t,i.children,n),0!=(2&(i=Mo.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Js(e,n);else if(19===e.tag)Js(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(lr(Mo,i),0==(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Po(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Qs(t,!1,r,n,o,t.lastEffect);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Po(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Qs(t,!0,n,null,o,t.lastEffect);break;case"together":Qs(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ta(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ba|=t.lanes,0!=(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Hl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Hl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function na(e,t){if(!Fo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ia(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return fr(t.type)&&gr(),null;case 3:return Ro(),ar(dr),ar(ur),qo(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Vo(t)?t.flags|=4:i.hydrate||(t.flags|=256)),zs(t),null;case 5:Lo(t);var o=Oo(Io.current);if(n=t.type,null!==e&&null!=t.stateNode)qs(e,t,n,i,o),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(s(166));return null}if(e=Oo(Co.current),Vo(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[Ki]=t,i[Zi]=a,n){case"dialog":Ci("cancel",i),Ci("close",i);break;case"iframe":case"object":case"embed":Ci("load",i);break;case"video":case"audio":for(e=0;e<xi.length;e++)Ci(xi[e],i);break;case"source":Ci("error",i);break;case"img":case"image":case"link":Ci("error",i),Ci("load",i);break;case"details":Ci("toggle",i);break;case"input":ee(i,a),Ci("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Ci("invalid",i);break;case"textarea":le(i,a),Ci("invalid",i)}for(var c in we(n,a),e=null,a)a.hasOwnProperty(c)&&(o=a[c],"children"===c?"string"==typeof o?i.textContent!==o&&(e=["children",o]):"number"==typeof o&&i.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Ci("scroll",i));switch(n){case"input":Z(i),ie(i,a,!0);break;case"textarea":Z(i),ue(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=Bi)}i=e,t.updateQueue=i,null!==i&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===de&&(e=pe(n)),e===de?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=c.createElement(n,{is:i.is}):(e=c.createElement(n),"select"===n&&(c=e,i.multiple?c.multiple=!0:i.size&&(c.size=i.size))):e=c.createElementNS(e,n),e[Ki]=t,e[Zi]=i,Ws(e,t,!1,!1),t.stateNode=e,c=ke(n,i),n){case"dialog":Ci("cancel",e),Ci("close",e),o=i;break;case"iframe":case"object":case"embed":Ci("load",e),o=i;break;case"video":case"audio":for(o=0;o<xi.length;o++)Ci(xi[o],e);o=i;break;case"source":Ci("error",e),o=i;break;case"img":case"image":case"link":Ci("error",e),Ci("load",e),o=i;break;case"details":Ci("toggle",e),o=i;break;case"input":ee(e,i),o=Q(e,i),Ci("invalid",e);break;case"option":o=oe(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},o=r({},i,{value:void 0}),Ci("invalid",e);break;case"textarea":le(e,i),o=ae(e,i),Ci("invalid",e);break;default:o=i}we(n,o);var u=o;for(a in u)if(u.hasOwnProperty(a)){var d=u[a];"style"===a?Te(e,d):"dangerouslySetInnerHTML"===a?null!=(d=d?d.__html:void 0)&&be(e,d):"children"===a?"string"==typeof d?("textarea"!==n||""!==d)&&ye(e,d):"number"==typeof d&&ye(e,""+d):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=d&&"onScroll"===a&&Ci("scroll",e):null!=d&&_(e,a,d,c))}switch(n){case"input":Z(e),ie(e,i,!1);break;case"textarea":Z(e),ue(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Y(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?se(e,!!i.multiple,a,!1):null!=i.defaultValue&&se(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Bi)}$i(n,i)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Ys(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(s(166));n=Oo(Io.current),Oo(Co.current),Vo(t)?(i=t.stateNode,n=t.memoizedProps,i[Ki]=t,i.nodeValue!==n&&(t.flags|=4)):((i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Ki]=t,t.stateNode=i)}return null;case 13:return ar(Mo),i=t.memoizedState,0!=(64&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Vo(t):n=null!==e.memoizedState,i&&!n&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Mo.current)?0===La&&(La=3):(0!==La&&3!==La||(La=4),null===Ia||0==(134217727&Ba)&&0==(134217727&ja)||fl(Ia,Na))),(i||n)&&(t.flags|=4),null);case 4:return Ro(),zs(t),null===e&&Ii(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return fr(t.type)&&gr(),null;case 19:if(ar(Mo),null===(i=t.memoizedState))return null;if(a=0!=(64&t.flags),null===(c=i.rendering))if(a)na(i,!1);else{if(0!==La||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Po(e))){for(t.flags|=64,na(i,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return lr(Mo,1&Mo.current|2),t.child}e=e.sibling}null!==i.tail&&$r()>Ha&&(t.flags|=64,a=!0,na(i,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=Po(c))){if(t.flags|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),na(i,!0),null===i.tail&&"hidden"===i.tailMode&&!c.alternate&&!Fo)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*$r()-i.renderingStartTime>Ha&&1073741824!==n&&(t.flags|=64,a=!0,na(i,!1),t.lanes=33554432);i.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=i.last)?n.sibling=c:t.child=c,i.last=c)}return null!==i.tail?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=$r(),n.sibling=null,t=Mo.current,lr(Mo,a?1&t|2:1&t),n):null;case 23:case 24:return vl(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function ra(e){switch(e.tag){case 1:fr(e.type)&&gr();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ro(),ar(dr),ar(ur),qo(),0!=(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Lo(e),null;case 13:return ar(Mo),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ar(Mo),null;case 4:return Ro(),null;case 10:return eo(e),null;case 23:case 24:return vl(),null;default:return null}}function oa(e,t){try{var n="",i=t;do{n+=z(i),i=i.return}while(i);var r=n}catch(e){r="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:r}}function sa(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Ws=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},zs=function(){},qs=function(e,t,n,i){var o=e.memoizedProps;if(o!==i){e=t.stateNode,Oo(Co.current);var s,a=null;switch(n){case"input":o=Q(e,o),i=Q(e,i),a=[];break;case"option":o=oe(e,o),i=oe(e,i),a=[];break;case"select":o=r({},o,{value:void 0}),i=r({},i,{value:void 0}),a=[];break;case"textarea":o=ae(e,o),i=ae(e,i),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof i.onClick&&(e.onclick=Bi)}for(d in we(n,i),n=null,o)if(!i.hasOwnProperty(d)&&o.hasOwnProperty(d)&&null!=o[d])if("style"===d){var c=o[d];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(l.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in i){var u=i[d];if(c=null!=o?o[d]:void 0,i.hasOwnProperty(d)&&u!==c&&(null!=u||null!=c))if("style"===d)if(c){for(s in c)!c.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&c[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(a||(a=[]),a.push(d,n)),n=u;else"dangerouslySetInnerHTML"===d?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(a=a||[]).push(d,u)):"children"===d?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(d,""+u):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(l.hasOwnProperty(d)?(null!=u&&"onScroll"===d&&Ci("scroll",e),a||c===u||(a=[])):"object"==typeof u&&null!==u&&u.$$typeof===M?u.toString():(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(t.updateQueue=d)&&(t.flags|=4)}},Ys=function(e,t,n,i){n!==i&&(t.flags|=4)};var aa="function"==typeof WeakMap?WeakMap:Map;function la(e,t,n){(n=ao(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){za||(za=!0,qa=i),sa(e,t)},n}function ca(e,t,n){(n=ao(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return sa(e,t),i(r)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){"function"!=typeof i&&(null===Ya?Ya=new Set([this]):Ya.add(this),sa(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var ua="function"==typeof WeakSet?WeakSet:Set;function da(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Pl(e,t)}else t.current=null}function ha(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Yr(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Vi(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(s(163))}function pa(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var r=e;i=r.next,0!=(4&(r=r.tag))&&0!=(1&r)&&(Dl(n,e),Rl(n,e)),e=i}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(i=n.elementType===n.type?t.memoizedProps:Yr(n.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&ho(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ho(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&$i(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Tt(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(s(163))}function fa(e,t){for(var n=e;;){if(5===n.tag){var i=n.stateNode;if(t)"function"==typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var r=n.memoizedProps.style;r=null!=r&&r.hasOwnProperty("display")?r.display:null,i.style.display=Ee("display",r)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function ga(e,t){if(Er&&"function"==typeof Er.onCommitFiberUnmount)try{Er.onCommitFiberUnmount(_r,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var i=n,r=i.destroy;if(i=i.tag,void 0!==r)if(0!=(4&i))Dl(t,n);else{i=t;try{r()}catch(e){Pl(i,e)}}n=n.next}while(n!==e)}break;case 1:if(da(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Pl(t,e)}break;case 5:da(t);break;case 4:Ea(e,t)}}function ma(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ba(e){return 5===e.tag||3===e.tag||4===e.tag}function ya(e){e:{for(var t=e.return;null!==t;){if(ba(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(s(161))}16&n.flags&&(ye(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ba(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}i?va(e,n,t):_a(e,n,t)}function va(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Bi));else if(4!==i&&null!==(e=e.child))for(va(e,t,n),e=e.sibling;null!==e;)va(e,t,n),e=e.sibling}function _a(e,t,n){var i=e.tag,r=5===i||6===i;if(r)e=r?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(_a(e,t,n),e=e.sibling;null!==e;)_a(e,t,n),e=e.sibling}function Ea(e,t){for(var n,i,r=t,o=!1;;){if(!o){o=r.return;e:for(;;){if(null===o)throw Error(s(160));switch(n=o.stateNode,o.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}o=o.return}o=!0}if(5===r.tag||6===r.tag){e:for(var a=e,l=r,c=l;;)if(ga(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}i?(a=n,l=r.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):n.removeChild(r.stateNode)}else if(4===r.tag){if(null!==r.child){n=r.stateNode.containerInfo,i=!0,r.child.return=r,r=r.child;continue}}else if(ga(e,r),null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;4===(r=r.return).tag&&(o=!1)}r.sibling.return=r.return,r=r.sibling}}function Ta(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{3==(3&i.tag)&&(e=i.destroy,i.destroy=void 0,void 0!==e&&e()),i=i.next}while(i!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){i=t.memoizedProps;var r=null!==e?e.memoizedProps:i;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[Zi]=i,"input"===e&&"radio"===i.type&&null!=i.name&&te(n,i),ke(e,r),t=ke(e,i),r=0;r<o.length;r+=2){var a=o[r],l=o[r+1];"style"===a?Te(n,l):"dangerouslySetInnerHTML"===a?be(n,l):"children"===a?ye(n,l):_(n,a,l,t)}switch(e){case"input":ne(n,i);break;case"textarea":ce(n,i);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(o=i.value)?se(n,!!i.multiple,o,!1):e!==!!i.multiple&&(null!=i.defaultValue?se(n,!!i.multiple,i.defaultValue,!0):se(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(s(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,Tt(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Ua=$r(),fa(t.child,!0)),void xa(t);case 19:return void xa(t);case 17:return;case 23:case 24:return void fa(t,null!==t.memoizedState)}throw Error(s(163))}function xa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ua),t.forEach((function(t){var i=jl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function wa(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var ka=Math.ceil,Sa=E.ReactCurrentDispatcher,Ca=E.ReactCurrentOwner,Aa=0,Ia=null,Oa=null,Na=0,Ra=0,Da=sr(0),La=0,Ma=null,Pa=0,Ba=0,ja=0,Fa=0,$a=null,Ua=0,Ha=1/0;function Ga(){Ha=$r()+500}var Va,Wa=null,za=!1,qa=null,Ya=null,Ka=!1,Za=null,Xa=90,Ja=[],Qa=[],el=null,tl=0,nl=null,il=-1,rl=0,ol=0,sl=null,al=!1;function ll(){return 0!=(48&Aa)?$r():-1!==il?il:il=$r()}function cl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Ur()?1:2;if(0===rl&&(rl=Pa),0!==qr.transition){0!==ol&&(ol=null!==$a?$a.pendingLanes:0),e=rl;var t=4186112&~ol;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Ur(),e=$t(0!=(4&Aa)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),rl)}function ul(e,t,n){if(50<tl)throw tl=0,nl=null,Error(s(185));if(null===(e=dl(e,t)))return null;Gt(e,t,n),e===Ia&&(ja|=t,4===La&&fl(e,Na));var i=Ur();1===t?0!=(8&Aa)&&0==(48&Aa)?gl(e):(hl(e,n),0===Aa&&(Ga(),Wr())):(0==(4&Aa)||98!==i&&99!==i||(null===el?el=new Set([e]):el.add(e)),hl(e,n)),$a=e}function dl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function hl(e,t){for(var n=e.callbackNode,i=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-Vt(a),c=1<<l,u=o[l];if(-1===u){if(0==(c&i)||0!=(c&r)){u=t,Bt(c);var d=Pt;o[l]=10<=d?u+250:6<=d?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);a&=~c}if(i=jt(e,e===Ia?Na:0),t=Pt,0===i)null!==n&&(n!==Lr&&wr(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Lr&&wr(n)}15===t?(n=gl.bind(null,e),null===Pr?(Pr=[n],Br=xr(Ir,zr)):Pr.push(n),n=Lr):n=14===t?Vr(99,gl.bind(null,e)):Vr(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),pl.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function pl(e){if(il=-1,ol=rl=0,0!=(48&Aa))throw Error(s(327));var t=e.callbackNode;if(Nl()&&e.callbackNode!==t)return null;var n=jt(e,e===Ia?Na:0);if(0===n)return null;var i=n,r=Aa;Aa|=16;var o=Tl();for(Ia===e&&Na===i||(Ga(),_l(e,i));;)try{kl();break}catch(t){El(e,t)}if(Qr(),Sa.current=o,Aa=r,null!==Oa?i=0:(Ia=null,Na=0,i=La),0!=(Pa&ja))_l(e,0);else if(0!==i){if(2===i&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vi(e.containerInfo)),0!==(n=Ft(e))&&(i=xl(e,n))),1===i)throw t=Ma,_l(e,0),fl(e,n),hl(e,$r()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,i){case 0:case 1:throw Error(s(345));case 2:Al(e);break;case 3:if(fl(e,n),(62914560&n)===n&&10<(i=Ua+500-$r())){if(0!==jt(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ll(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Hi(Al.bind(null,e),i);break}Al(e);break;case 4:if(fl(e,n),(4186112&n)===n)break;for(i=e.eventTimes,r=-1;0<n;){var a=31-Vt(n);o=1<<a,(a=i[a])>r&&(r=a),n&=~o}if(n=r,10<(n=(120>(n=$r()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ka(n/1960))-n)){e.timeoutHandle=Hi(Al.bind(null,e),n);break}Al(e);break;case 5:Al(e);break;default:throw Error(s(329))}}return hl(e,$r()),e.callbackNode===t?pl.bind(null,e):null}function fl(e,t){for(t&=~Fa,t&=~ja,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Vt(t),i=1<<n;e[n]=-1,t&=~i}}function gl(e){if(0!=(48&Aa))throw Error(s(327));if(Nl(),e===Ia&&0!=(e.expiredLanes&Na)){var t=Na,n=xl(e,t);0!=(Pa&ja)&&(n=xl(e,t=jt(e,t)))}else n=xl(e,t=jt(e,0));if(0!==e.tag&&2===n&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vi(e.containerInfo)),0!==(t=Ft(e))&&(n=xl(e,t))),1===n)throw n=Ma,_l(e,0),fl(e,t),hl(e,$r()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e),hl(e,$r()),null}function ml(e,t){var n=Aa;Aa|=1;try{return e(t)}finally{0===(Aa=n)&&(Ga(),Wr())}}function bl(e,t){var n=Aa;Aa&=-2,Aa|=8;try{return e(t)}finally{0===(Aa=n)&&(Ga(),Wr())}}function yl(e,t){lr(Da,Ra),Ra|=t,Pa|=t}function vl(){Ra=Da.current,ar(Da)}function _l(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Gi(n)),null!==Oa)for(n=Oa.return;null!==n;){var i=n;switch(i.tag){case 1:null!=(i=i.type.childContextTypes)&&gr();break;case 3:Ro(),ar(dr),ar(ur),qo();break;case 5:Lo(i);break;case 4:Ro();break;case 13:case 19:ar(Mo);break;case 10:eo(i);break;case 23:case 24:vl()}n=n.return}Ia=e,Oa=Hl(e.current,null),Na=Ra=Pa=t,La=0,Ma=null,Fa=ja=Ba=0}function El(e,t){for(;;){var n=Oa;try{if(Qr(),Yo.current=Is,es){for(var i=Xo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}es=!1}if(Zo=0,Qo=Jo=Xo=null,ts=!1,Ca.current=null,null===n||null===n.return){La=1,Ma=t,Oa=null;break}e:{var o=e,s=n.return,a=n,l=t;if(t=Na,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(0==(2&a.mode)){var u=a.alternate;u?(a.updateQueue=u.updateQueue,a.memoizedState=u.memoizedState,a.lanes=u.lanes):(a.updateQueue=null,a.memoizedState=null)}var d=0!=(1&Mo.current),h=s;do{var p;if(p=13===h.tag){var f=h.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var g=h.memoizedProps;p=void 0!==g.fallback&&(!0!==g.unstable_avoidThisFallback||!d)}}if(p){var m=h.updateQueue;if(null===m){var b=new Set;b.add(c),h.updateQueue=b}else m.add(c);if(0==(2&h.mode)){if(h.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var y=ao(-1,1);y.tag=2,lo(a,y)}a.lanes|=1;break e}l=void 0,a=t;var v=o.pingCache;if(null===v?(v=o.pingCache=new aa,l=new Set,v.set(c,l)):void 0===(l=v.get(c))&&(l=new Set,v.set(c,l)),!l.has(a)){l.add(a);var _=Bl.bind(null,o,c,a);c.then(_,_)}h.flags|=4096,h.lanes=t;break e}h=h.return}while(null!==h);l=Error((q(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==La&&(La=2),l=oa(l,a),h=s;do{switch(h.tag){case 3:o=l,h.flags|=4096,t&=-t,h.lanes|=t,co(h,la(h,o,t));break e;case 1:o=l;var E=h.type,T=h.stateNode;if(0==(64&h.flags)&&("function"==typeof E.getDerivedStateFromError||null!==T&&"function"==typeof T.componentDidCatch&&(null===Ya||!Ya.has(T)))){h.flags|=4096,t&=-t,h.lanes|=t,co(h,ca(h,o,t));break e}}h=h.return}while(null!==h)}Cl(n)}catch(e){t=e,Oa===n&&null!==n&&(Oa=n=n.return);continue}break}}function Tl(){var e=Sa.current;return Sa.current=Is,null===e?Is:e}function xl(e,t){var n=Aa;Aa|=16;var i=Tl();for(Ia===e&&Na===t||_l(e,t);;)try{wl();break}catch(t){El(e,t)}if(Qr(),Aa=n,Sa.current=i,null!==Oa)throw Error(s(261));return Ia=null,Na=0,La}function wl(){for(;null!==Oa;)Sl(Oa)}function kl(){for(;null!==Oa&&!kr();)Sl(Oa)}function Sl(e){var t=Va(e.alternate,e,Ra);e.memoizedProps=e.pendingProps,null===t?Cl(e):Oa=t,Ca.current=null}function Cl(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(n=ia(n,t,Ra)))return void(Oa=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!=(1073741824&Ra)||0==(4&n.mode)){for(var i=0,r=n.child;null!==r;)i|=r.lanes|r.childLanes,r=r.sibling;n.childLanes=i}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=ra(t)))return n.flags&=2047,void(Oa=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Oa=t);Oa=t=e}while(null!==t);0===La&&(La=5)}function Al(e){var t=Ur();return Gr(99,Il.bind(null,e,t)),null}function Il(e,t){do{Nl()}while(null!==Za);if(0!=(48&Aa))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var i=n.lanes|n.childLanes,r=i,o=e.pendingLanes&~r;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=r,e.mutableReadLanes&=r,e.entangledLanes&=r,r=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<o;){var c=31-Vt(o),u=1<<c;r[c]=0,a[c]=-1,l[c]=-1,o&=~u}if(null!==el&&0==(24&i)&&el.has(e)&&el.delete(e),e===Ia&&(Oa=Ia=null,Na=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){if(r=Aa,Aa|=32,Ca.current=null,ji=Kt,fi(a=pi())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else e:if(l=(l=a.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,o=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(e){l=null;break e}var d=0,h=-1,p=-1,f=0,g=0,m=a,b=null;t:for(;;){for(var y;m!==l||0!==o&&3!==m.nodeType||(h=d+o),m!==c||0!==u&&3!==m.nodeType||(p=d+u),3===m.nodeType&&(d+=m.nodeValue.length),null!==(y=m.firstChild);)b=m,m=y;for(;;){if(m===a)break t;if(b===l&&++f===o&&(h=d),b===c&&++g===u&&(p=d),null!==(y=m.nextSibling))break;b=(m=b).parentNode}m=y}l=-1===h||-1===p?null:{start:h,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Fi={focusedElem:a,selectionRange:l},Kt=!1,sl=null,al=!1,Wa=i;do{try{Ol()}catch(e){if(null===Wa)throw Error(s(330));Pl(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);sl=null,Wa=i;do{try{for(a=e;null!==Wa;){var v=Wa.flags;if(16&v&&ye(Wa.stateNode,""),128&v){var _=Wa.alternate;if(null!==_){var E=_.ref;null!==E&&("function"==typeof E?E(null):E.current=null)}}switch(1038&v){case 2:ya(Wa),Wa.flags&=-3;break;case 6:ya(Wa),Wa.flags&=-3,Ta(Wa.alternate,Wa);break;case 1024:Wa.flags&=-1025;break;case 1028:Wa.flags&=-1025,Ta(Wa.alternate,Wa);break;case 4:Ta(Wa.alternate,Wa);break;case 8:Ea(a,l=Wa);var T=l.alternate;ma(l),null!==T&&ma(T)}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(s(330));Pl(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);if(E=Fi,_=pi(),v=E.focusedElem,a=E.selectionRange,_!==v&&v&&v.ownerDocument&&hi(v.ownerDocument.documentElement,v)){null!==a&&fi(v)&&(_=a.start,void 0===(E=a.end)&&(E=_),"selectionStart"in v?(v.selectionStart=_,v.selectionEnd=Math.min(E,v.value.length)):(E=(_=v.ownerDocument||document)&&_.defaultView||window).getSelection&&(E=E.getSelection(),l=v.textContent.length,T=Math.min(a.start,l),a=void 0===a.end?T:Math.min(a.end,l),!E.extend&&T>a&&(l=a,a=T,T=l),l=di(v,T),o=di(v,a),l&&o&&(1!==E.rangeCount||E.anchorNode!==l.node||E.anchorOffset!==l.offset||E.focusNode!==o.node||E.focusOffset!==o.offset)&&((_=_.createRange()).setStart(l.node,l.offset),E.removeAllRanges(),T>a?(E.addRange(_),E.extend(o.node,o.offset)):(_.setEnd(o.node,o.offset),E.addRange(_))))),_=[];for(E=v;E=E.parentNode;)1===E.nodeType&&_.push({element:E,left:E.scrollLeft,top:E.scrollTop});for("function"==typeof v.focus&&v.focus(),v=0;v<_.length;v++)(E=_[v]).element.scrollLeft=E.left,E.element.scrollTop=E.top}Kt=!!ji,Fi=ji=null,e.current=n,Wa=i;do{try{for(v=e;null!==Wa;){var x=Wa.flags;if(36&x&&pa(v,Wa.alternate,Wa),128&x){_=void 0;var w=Wa.ref;if(null!==w){var k=Wa.stateNode;switch(Wa.tag){case 5:_=k;break;default:_=k}"function"==typeof w?w(_):w.current=_}}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(s(330));Pl(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);Wa=null,Mr(),Aa=r}else e.current=n;if(Ka)Ka=!1,Za=e,Xa=t;else for(Wa=i;null!==Wa;)t=Wa.nextEffect,Wa.nextEffect=null,8&Wa.flags&&((x=Wa).sibling=null,x.stateNode=null),Wa=t;if(0===(i=e.pendingLanes)&&(Ya=null),1===i?e===nl?tl++:(tl=0,nl=e):tl=0,n=n.stateNode,Er&&"function"==typeof Er.onCommitFiberRoot)try{Er.onCommitFiberRoot(_r,n,void 0,64==(64&n.current.flags))}catch(e){}if(hl(e,$r()),za)throw za=!1,e=qa,qa=null,e;return 0!=(8&Aa)||Wr(),null}function Ol(){for(;null!==Wa;){var e=Wa.alternate;al||null===sl||(0!=(8&Wa.flags)?et(Wa,sl)&&(al=!0):13===Wa.tag&&wa(e,Wa)&&et(Wa,sl)&&(al=!0));var t=Wa.flags;0!=(256&t)&&ha(e,Wa),0==(512&t)||Ka||(Ka=!0,Vr(97,(function(){return Nl(),null}))),Wa=Wa.nextEffect}}function Nl(){if(90!==Xa){var e=97<Xa?97:Xa;return Xa=90,Gr(e,Ll)}return!1}function Rl(e,t){Ja.push(t,e),Ka||(Ka=!0,Vr(97,(function(){return Nl(),null})))}function Dl(e,t){Qa.push(t,e),Ka||(Ka=!0,Vr(97,(function(){return Nl(),null})))}function Ll(){if(null===Za)return!1;var e=Za;if(Za=null,0!=(48&Aa))throw Error(s(331));var t=Aa;Aa|=32;var n=Qa;Qa=[];for(var i=0;i<n.length;i+=2){var r=n[i],o=n[i+1],a=r.destroy;if(r.destroy=void 0,"function"==typeof a)try{a()}catch(e){if(null===o)throw Error(s(330));Pl(o,e)}}for(n=Ja,Ja=[],i=0;i<n.length;i+=2){r=n[i],o=n[i+1];try{var l=r.create;r.destroy=l()}catch(e){if(null===o)throw Error(s(330));Pl(o,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Aa=t,Wr(),!0}function Ml(e,t,n){lo(e,t=la(e,t=oa(n,t),1)),t=ll(),null!==(e=dl(e,1))&&(Gt(e,1,t),hl(e,t))}function Pl(e,t){if(3===e.tag)Ml(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Ml(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"==typeof n.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Ya||!Ya.has(i))){var r=ca(n,e=oa(t,e),1);if(lo(n,r),r=ll(),null!==(n=dl(n,1)))Gt(n,1,r),hl(n,r);else if("function"==typeof i.componentDidCatch&&(null===Ya||!Ya.has(i)))try{i.componentDidCatch(t,e)}catch(e){}break}}n=n.return}}function Bl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=ll(),e.pingedLanes|=e.suspendedLanes&n,Ia===e&&(Na&n)===n&&(4===La||3===La&&(62914560&Na)===Na&&500>$r()-Ua?_l(e,0):Fa|=n),hl(e,t)}function jl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Ur()?1:2:(0===rl&&(rl=Pa),0===(t=Ut(62914560&~rl))&&(t=4194304))),n=ll(),null!==(e=dl(e,t))&&(Gt(e,t,n),hl(e,n))}function Fl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function $l(e,t,n,i){return new Fl(e,t,n,i)}function Ul(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Hl(e,t){var n=e.alternate;return null===n?((n=$l(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Gl(e,t,n,i,r,o){var a=2;if(i=e,"function"==typeof e)Ul(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case w:return Vl(n.children,r,o,t);case P:a=8,r|=16;break;case k:a=8,r|=1;break;case S:return(e=$l(12,n,t,8|r)).elementType=S,e.type=S,e.lanes=o,e;case O:return(e=$l(13,n,t,r)).type=O,e.elementType=O,e.lanes=o,e;case N:return(e=$l(19,n,t,r)).elementType=N,e.lanes=o,e;case B:return Wl(n,r,o,t);case j:return(e=$l(24,n,t,r)).elementType=j,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case C:a=10;break e;case A:a=9;break e;case I:a=11;break e;case R:a=14;break e;case D:a=16,i=null;break e;case L:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=$l(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Vl(e,t,n,i){return(e=$l(7,e,i,t)).lanes=n,e}function Wl(e,t,n,i){return(e=$l(23,e,i,t)).elementType=B,e.lanes=n,e}function zl(e,t,n){return(e=$l(6,e,null,t)).lanes=n,e}function ql(e,t,n){return(t=$l(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Yl(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Ht(0),this.expirationTimes=Ht(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ht(0),this.mutableSourceEagerHydrationData=null}function Kl(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function Zl(e,t,n,i){var r=t.current,o=ll(),a=cl(r);e:if(n){t:{if(Ze(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(fr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===n.tag){var c=n.type;if(fr(c)){n=br(n,c,l);break e}}n=l}else n=cr;return null===t.context?t.context=n:t.pendingContext=n,(t=ao(o,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),lo(r,t),ul(r,a,o),a}function Xl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Jl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ql(e,t){Jl(e,t),(e=e.alternate)&&Jl(e,t)}function ec(e,t,n){var i=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Yl(e,t,null!=n&&!0===n.hydrate),t=$l(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,oo(t),e[Xi]=n.current,Ii(8===e.nodeType?e.parentNode:e),i)for(e=0;e<i.length;e++){var r=(t=i[e])._getVersion;r=r(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,r]:n.mutableSourceEagerHydrationData.push(t,r)}this._internalRoot=n}function tc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function nc(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o._internalRoot;if("function"==typeof r){var a=r;r=function(){var e=Xl(s);a.call(e)}}Zl(t,s,e,r)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new ec(e,0,t?{hydrate:!0}:void 0)}(n,i),s=o._internalRoot,"function"==typeof r){var l=r;r=function(){var e=Xl(s);l.call(e)}}bl((function(){Zl(t,s,e,r)}))}return Xl(s)}function ic(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!tc(t))throw Error(s(200));return Kl(e,t,null,n)}Va=function(e,t,n){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||dr.current)Ls=!0;else{if(0==(n&i)){switch(Ls=!1,t.tag){case 3:Vs(t),Wo();break;case 5:Do(t);break;case 1:fr(t.type)&&yr(t);break;case 4:No(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value;var r=t.type._context;lr(Kr,r._currentValue),r._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!=(n&t.child.childLanes)?Zs(e,t,n):(lr(Mo,1&Mo.current),null!==(t=ta(e,t,n))?t.sibling:null);lr(Mo,1&Mo.current);break;case 19:if(i=0!=(n&t.childLanes),0!=(64&e.flags)){if(i)return ea(e,t,n);t.flags|=64}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),lr(Mo,Mo.current),i)break;return null;case 23:case 24:return t.lanes=0,Fs(e,t,n)}return ta(e,t,n)}Ls=0!=(16384&e.flags)}else Ls=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=pr(t,ur.current),no(t,n),r=rs(null,t,i,e,r,n),t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,fr(i)){var o=!0;yr(t)}else o=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,oo(t);var a=i.getDerivedStateFromProps;"function"==typeof a&&fo(t,i,a,e),r.updater=go,t.stateNode=r,r._reactInternals=t,vo(t,i,e,n),t=Gs(null,t,i,!0,o,n)}else t.tag=0,Ms(null,t,r,n),t=t.child;return t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"==typeof e)return Ul(e)?1:0;if(null!=e){if((e=e.$$typeof)===I)return 11;if(e===R)return 14}return 2}(r),e=Yr(r,e),o){case 0:t=Us(null,t,r,e,n);break e;case 1:t=Hs(null,t,r,e,n);break e;case 11:t=Ps(null,t,r,e,n);break e;case 14:t=Bs(null,t,r,Yr(r.type,e),i,n);break e}throw Error(s(306,r,""))}return t;case 0:return i=t.type,r=t.pendingProps,Us(e,t,i,r=t.elementType===i?r:Yr(i,r),n);case 1:return i=t.type,r=t.pendingProps,Hs(e,t,i,r=t.elementType===i?r:Yr(i,r),n);case 3:if(Vs(t),i=t.updateQueue,null===e||null===i)throw Error(s(282));if(i=t.pendingProps,r=null!==(r=t.memoizedState)?r.element:null,so(e,t),uo(t,i,null,n),(i=t.memoizedState.element)===r)Wo(),t=ta(e,t,n);else{if((o=(r=t.stateNode).hydrate)&&(jo=Wi(t.stateNode.containerInfo.firstChild),Bo=t,o=Fo=!0),o){if(null!=(e=r.mutableSourceEagerHydrationData))for(r=0;r<e.length;r+=2)(o=e[r])._workInProgressVersionPrimary=e[r+1],zo.push(o);for(n=ko(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ms(e,t,i,n),Wo();t=t.child}return t;case 5:return Do(t),null===e&&Ho(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,Ui(i,r)?a=null:null!==o&&Ui(i,o)&&(t.flags|=16),$s(e,t),Ms(e,t,a,n),t.child;case 6:return null===e&&Ho(t),null;case 13:return Zs(e,t,n);case 4:return No(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=wo(t,null,i,n):Ms(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Ps(e,t,i,r=t.elementType===i?r:Yr(i,r),n);case 7:return Ms(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ms(e,t,t.pendingProps.children,n),t.child;case 10:e:{i=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value;var l=t.type._context;if(lr(Kr,l._currentValue),l._currentValue=o,null!==a)if(l=a.value,0==(o=ai(l,o)?0:0|("function"==typeof i._calculateChangedBits?i._calculateChangedBits(l,o):1073741823))){if(a.children===r.children&&!dr.current){t=ta(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===i&&0!=(u.observedBits&o)){1===l.tag&&((u=ao(-1,n&-n)).tag=2,lo(l,u)),l.lanes|=n,null!==(u=l.alternate)&&(u.lanes|=n),to(l.return,n),c.lanes|=n;break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Ms(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=(o=t.pendingProps).children,no(t,n),i=i(r=io(r,o.unstable_observedBits)),t.flags|=1,Ms(e,t,i,n),t.child;case 14:return o=Yr(r=t.type,t.pendingProps),Bs(e,t,r,o=Yr(r.type,o),i,n);case 15:return js(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Yr(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,fr(i)?(e=!0,yr(t)):e=!1,no(t,n),bo(t,i,r),vo(t,i,r,n),Gs(null,t,i,!0,e,n);case 19:return ea(e,t,n);case 23:case 24:return Fs(e,t,n)}throw Error(s(156,t.tag))},ec.prototype.render=function(e){Zl(e,this._internalRoot,null,null)},ec.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Zl(null,e,null,(function(){t[Xi]=null}))},tt=function(e){13===e.tag&&(ul(e,4,ll()),Ql(e,4))},nt=function(e){13===e.tag&&(ul(e,67108864,ll()),Ql(e,67108864))},it=function(e){if(13===e.tag){var t=ll(),n=cl(e);ul(e,n,t),Ql(e,n)}},rt=function(e,t){return t()},Ce=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=nr(i);if(!r)throw Error(s(90));X(i),ne(i,r)}}}break;case"textarea":ce(e,n);break;case"select":null!=(t=n.value)&&se(e,!!n.multiple,t,!1)}},De=ml,Le=function(e,t,n,i,r){var o=Aa;Aa|=4;try{return Gr(98,e.bind(null,t,n,i,r))}finally{0===(Aa=o)&&(Ga(),Wr())}},Me=function(){0==(49&Aa)&&(function(){if(null!==el){var e=el;el=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,hl(e,$r())}))}Wr()}(),Nl())},Pe=function(e,t){var n=Aa;Aa|=2;try{return e(t)}finally{0===(Aa=n)&&(Ga(),Wr())}};var rc={Events:[er,tr,nr,Ne,Re,Nl,{current:!1}]},oc={findFiberByHostInstance:Qi,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},sc={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ac.isDisabled&&ac.supportsFiber)try{_r=ac.inject(sc),Er=ac}catch(me){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rc,n.createPortal=ic,n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=Qe(t))?null:e.stateNode},n.flushSync=function(e,t){var n=Aa;if(0!=(48&n))return e(t);Aa|=1;try{if(e)return Gr(99,e.bind(null,t))}finally{Aa=n,Wr()}},n.hydrate=function(e,t,n){if(!tc(t))throw Error(s(200));return nc(null,e,t,!0,n)},n.render=function(e,t,n){if(!tc(t))throw Error(s(200));return nc(null,e,t,!1,n)},n.unmountComponentAtNode=function(e){if(!tc(e))throw Error(s(40));return!!e._reactRootContainer&&(bl((function(){nc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Xi]=null}))})),!0)},n.unstable_batchedUpdates=ml,n.unstable_createPortal=function(e,t){return ic(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},n.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!tc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return nc(e,t,n,!1,i)},n.version="17.0.2"},{"object-assign":465,react:548,scheduler:605}],491:[function(e,t,n){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":490}],492:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&Symbol.for,r=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,a=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,c=i?Symbol.for("react.provider"):60109,u=i?Symbol.for("react.context"):60110,d=i?Symbol.for("react.async_mode"):60111,h=i?Symbol.for("react.concurrent_mode"):60111,p=i?Symbol.for("react.forward_ref"):60112,f=i?Symbol.for("react.suspense"):60113,g=i?Symbol.for("react.suspense_list"):60120,m=i?Symbol.for("react.memo"):60115,b=i?Symbol.for("react.lazy"):60116,y=i?Symbol.for("react.block"):60121,v=i?Symbol.for("react.fundamental"):60117,_=i?Symbol.for("react.responder"):60118,E=i?Symbol.for("react.scope"):60119;function T(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case d:case h:case s:case l:case a:case f:return e;default:switch(e=e&&e.$$typeof){case u:case p:case b:case m:case c:return e;default:return t}}case o:return t}}}function x(e){return T(e)===h}n.AsyncMode=d,n.ConcurrentMode=h,n.ContextConsumer=u,n.ContextProvider=c,n.Element=r,n.ForwardRef=p,n.Fragment=s,n.Lazy=b,n.Memo=m,n.Portal=o,n.Profiler=l,n.StrictMode=a,n.Suspense=f,n.isAsyncMode=function(e){return x(e)||T(e)===d},n.isConcurrentMode=x,n.isContextConsumer=function(e){return T(e)===u},n.isContextProvider=function(e){return T(e)===c},n.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},n.isForwardRef=function(e){return T(e)===p},n.isFragment=function(e){return T(e)===s},n.isLazy=function(e){return T(e)===b},n.isMemo=function(e){return T(e)===m},n.isPortal=function(e){return T(e)===o},n.isProfiler=function(e){return T(e)===l},n.isStrictMode=function(e){return T(e)===a},n.isSuspense=function(e){return T(e)===f},n.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===h||e===l||e===a||e===f||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===b||e.$$typeof===m||e.$$typeof===c||e.$$typeof===u||e.$$typeof===p||e.$$typeof===v||e.$$typeof===_||e.$$typeof===E||e.$$typeof===y)},n.typeOf=T},{}],493:[function(e,t,n){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":492}],494:[function(e,t,n){"use strict";function i(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function r(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}Object.defineProperty(n,"__esModule",{value:!0}),i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0,n.polyfill=function(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,s=null,a=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?s="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(s="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?a="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(a="UNSAFE_componentWillUpdate"),null!==n||null!==s||null!==a){var l=e.displayName||e.name,c="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+c+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==s?"\n  "+s:"")+(null!==a?"\n  "+a:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=i,t.componentWillReceiveProps=r),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var u=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;u.call(this,e,t,i)}}return e}},{}],495:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bodyOpenClassName=n.portalClassName=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("react"),s=f(o),a=f(e("react-dom")),l=f(e("prop-types")),c=f(e("./ModalPortal")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../helpers/ariaAppHider")),d=e("../helpers/safeHTMLElement"),h=f(d),p=e("react-lifecycles-compat");function f(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var b=n.portalClassName="ReactModalPortal",y=n.bodyOpenClassName="ReactModal__Body--open",v=d.canUseDOM&&void 0!==a.default.createPortal,_=function(e){return document.createElement(e)},E=function(){return v?a.default.createPortal:a.default.unstable_renderSubtreeIntoContainer};function T(e){return e()}var x=function(e){function t(){var e,n,r;g(this,t);for(var o=arguments.length,l=Array(o),u=0;u<o;u++)l[u]=arguments[u];return n=r=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.removePortal=function(){!v&&a.default.unmountComponentAtNode(r.node);var e=T(r.props.parentSelector);e&&e.contains(r.node)?e.removeChild(r.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},r.portalRef=function(e){r.portal=e},r.renderPortal=function(e){var n=E()(r,s.default.createElement(c.default,i({defaultStyles:t.defaultStyles},e)),r.node);r.portalRef(n)},m(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidMount",value:function(){d.canUseDOM&&(v||(this.node=_("div")),this.node.className=this.props.portalClassName,T(this.props.parentSelector).appendChild(this.node),!v&&this.renderPortal(this.props))}},{key:"getSnapshotBeforeUpdate",value:function(e){return{prevParent:T(e.parentSelector),nextParent:T(this.props.parentSelector)}}},{key:"componentDidUpdate",value:function(e,t,n){if(d.canUseDOM){var i=this.props,r=i.isOpen,o=i.portalClassName;e.portalClassName!==o&&(this.node.className=o);var s=n.prevParent,a=n.nextParent;a!==s&&(s.removeChild(this.node),a.appendChild(this.node)),(e.isOpen||r)&&!v&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&v?(!this.node&&v&&(this.node=_("div")),E()(s.default.createElement(c.default,i({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){u.setElement(e)}}]),t}();x.propTypes={isOpen:l.default.bool.isRequired,style:l.default.shape({content:l.default.object,overlay:l.default.object}),portalClassName:l.default.string,bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,className:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),overlayClassName:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),appElement:l.default.oneOfType([l.default.instanceOf(h.default),l.default.instanceOf(d.SafeHTMLCollection),l.default.instanceOf(d.SafeNodeList),l.default.arrayOf(l.default.instanceOf(h.default))]),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,ariaHideApp:l.default.bool,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,preventScroll:l.default.bool,parentSelector:l.default.func,aria:l.default.object,data:l.default.object,role:l.default.string,contentLabel:l.default.string,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func,id:l.default.string,overlayElement:l.default.func,contentElement:l.default.func},x.defaultProps={isOpen:!1,portalClassName:b,bodyOpenClassName:y,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return s.default.createElement("div",e,t)},contentElement:function(e,t){return s.default.createElement("div",e,t)}},x.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,p.polyfill)(x),n.default=x},{"../helpers/ariaAppHider":497,"../helpers/safeHTMLElement":502,"./ModalPortal":496,"prop-types":487,react:548,"react-dom":491,"react-lifecycles-compat":494}],496:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("react"),a=m(e("prop-types")),l=g(e("../helpers/focusManager")),c=m(e("../helpers/scopeTab")),u=g(e("../helpers/ariaAppHider")),d=g(e("../helpers/classList")),h=e("../helpers/safeHTMLElement"),p=m(h),f=m(e("../helpers/portalOpenInstances"));function g(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}e("../helpers/bodyTrap");var b={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},y=0,v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setOverlayRef=function(e){n.overlay=e,n.props.overlayRef&&n.props.overlayRef(e)},n.setContentRef=function(e){n.content=e,n.props.contentRef&&n.props.contentRef(e)},n.afterClose=function(){var e=n.props,t=e.appElement,i=e.ariaHideApp,r=e.htmlOpenClassName,o=e.bodyOpenClassName;o&&d.remove(document.body,o),r&&d.remove(document.getElementsByTagName("html")[0],r),i&&y>0&&0==(y-=1)&&u.show(t),n.props.shouldFocusAfterRender&&(n.props.shouldReturnFocusAfterClose?(l.returnFocus(n.props.preventScroll),l.teardownScopedFocus()):l.popWithoutFocus()),n.props.onAfterClose&&n.props.onAfterClose(),f.default.deregister(n)},n.open=function(){n.beforeOpen(),n.state.afterOpen&&n.state.beforeClose?(clearTimeout(n.closeTimer),n.setState({beforeClose:!1})):(n.props.shouldFocusAfterRender&&(l.setupScopedFocus(n.node),l.markForFocusLater()),n.setState({isOpen:!0},(function(){n.openAnimationFrame=requestAnimationFrame((function(){n.setState({afterOpen:!0}),n.props.isOpen&&n.props.onAfterOpen&&n.props.onAfterOpen({overlayEl:n.overlay,contentEl:n.content})}))})))},n.close=function(){n.props.closeTimeoutMS>0?n.closeWithTimeout():n.closeWithoutTimeout()},n.focusContent=function(){return n.content&&!n.contentHasFocus()&&n.content.focus({preventScroll:!0})},n.closeWithTimeout=function(){var e=Date.now()+n.props.closeTimeoutMS;n.setState({beforeClose:!0,closesAt:e},(function(){n.closeTimer=setTimeout(n.closeWithoutTimeout,n.state.closesAt-Date.now())}))},n.closeWithoutTimeout=function(){n.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},n.afterClose)},n.handleKeyDown=function(e){9===e.keyCode&&(0,c.default)(n.content,e),n.props.shouldCloseOnEsc&&27===e.keyCode&&(e.stopPropagation(),n.requestClose(e))},n.handleOverlayOnClick=function(e){null===n.shouldClose&&(n.shouldClose=!0),n.shouldClose&&n.props.shouldCloseOnOverlayClick&&(n.ownerHandlesClose()?n.requestClose(e):n.focusContent()),n.shouldClose=null},n.handleContentOnMouseUp=function(){n.shouldClose=!1},n.handleOverlayOnMouseDown=function(e){n.props.shouldCloseOnOverlayClick||e.target!=n.overlay||e.preventDefault()},n.handleContentOnClick=function(){n.shouldClose=!1},n.handleContentOnMouseDown=function(){n.shouldClose=!1},n.requestClose=function(e){return n.ownerHandlesClose()&&n.props.onRequestClose(e)},n.ownerHandlesClose=function(){return n.props.onRequestClose},n.shouldBeClosed=function(){return!n.state.isOpen&&!n.state.beforeClose},n.contentHasFocus=function(){return document.activeElement===n.content||n.content.contains(document.activeElement)},n.buildClassName=function(e,t){var i="object"===(void 0===t?"undefined":r(t))?t:{base:b[e],afterOpen:b[e]+"--after-open",beforeClose:b[e]+"--before-close"},o=i.base;return n.state.afterOpen&&(o=o+" "+i.afterOpen),n.state.beforeClose&&(o=o+" "+i.beforeClose),"string"==typeof t&&t?o+" "+t:o},n.attributesFromObject=function(e,t){return Object.keys(t).reduce((function(n,i){return n[e+"-"+i]=t[i],n}),{})},n.state={afterOpen:!1,beforeClose:!1},n.shouldClose=null,n.moveFromContentToOverlay=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&!e.isOpen?this.open():!this.props.isOpen&&e.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!t.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,i=e.htmlOpenClassName,r=e.bodyOpenClassName;r&&d.add(document.body,r),i&&d.add(document.getElementsByTagName("html")[0],i),n&&(y+=1,u.hide(t)),f.default.register(this)}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,r=e.overlayClassName,o=e.defaultStyles,s=e.children,a=n?{}:o.content,l=r?{}:o.overlay;if(this.shouldBeClosed())return null;var c={ref:this.setOverlayRef,className:this.buildClassName("overlay",r),style:i({},l,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},u=i({id:t,ref:this.setContentRef,style:i({},a,this.props.style.content),className:this.buildClassName("content",n),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",i({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),d=this.props.contentElement(u,s);return this.props.overlayElement(c,d)}}]),t}();v.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},v.propTypes={isOpen:a.default.bool.isRequired,defaultStyles:a.default.shape({content:a.default.object,overlay:a.default.object}),style:a.default.shape({content:a.default.object,overlay:a.default.object}),className:a.default.oneOfType([a.default.string,a.default.object]),overlayClassName:a.default.oneOfType([a.default.string,a.default.object]),bodyOpenClassName:a.default.string,htmlOpenClassName:a.default.string,ariaHideApp:a.default.bool,appElement:a.default.oneOfType([a.default.instanceOf(p.default),a.default.instanceOf(h.SafeHTMLCollection),a.default.instanceOf(h.SafeNodeList),a.default.arrayOf(a.default.instanceOf(p.default))]),onAfterOpen:a.default.func,onAfterClose:a.default.func,onRequestClose:a.default.func,closeTimeoutMS:a.default.number,shouldFocusAfterRender:a.default.bool,shouldCloseOnOverlayClick:a.default.bool,shouldReturnFocusAfterClose:a.default.bool,preventScroll:a.default.bool,role:a.default.string,contentLabel:a.default.string,aria:a.default.object,data:a.default.object,children:a.default.node,shouldCloseOnEsc:a.default.bool,overlayRef:a.default.func,contentRef:a.default.func,id:a.default.string,overlayElement:a.default.func,contentElement:a.default.func,testId:a.default.string},n.default=v,t.exports=n.default},{"../helpers/ariaAppHider":497,"../helpers/bodyTrap":498,"../helpers/classList":499,"../helpers/focusManager":500,"../helpers/portalOpenInstances":501,"../helpers/safeHTMLElement":502,"../helpers/scopeTab":503,"prop-types":487,react:548}],497:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){a&&(a.removeAttribute?a.removeAttribute("aria-hidden"):null!=a.length?a.forEach((function(e){return e.removeAttribute("aria-hidden")})):document.querySelectorAll(a).forEach((function(e){return e.removeAttribute("aria-hidden")}))),a=null},n.log=function(){},n.assertNodeList=l,n.setElement=function(e){var t=e;if("string"==typeof t&&s.canUseDOM){var n=document.querySelectorAll(t);l(n,t),t=n}return a=t||a},n.validateElement=c,n.hide=function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=c(e)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0)r.value.setAttribute("aria-hidden","true")}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}},n.show=function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=c(e)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0)r.value.removeAttribute("aria-hidden")}catch(e){n=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}},n.documentNotReadyOrSSRTesting=function(){a=null};var i,r=e("warning"),o=(i=r)&&i.__esModule?i:{default:i},s=e("./safeHTMLElement");var a=null;function l(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function c(e){var t=e||a;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,o.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}},{"./safeHTMLElement":502,warning:631}],498:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){for(var e=[s,a],t=0;t<e.length;t++){var n=e[t];n&&n.parentNode&&n.parentNode.removeChild(n)}s=a=null,l=[]},n.log=function(){console.log("bodyTrap ----------"),console.log(l.length);for(var e=[s,a],t=0;t<e.length;t++){var n=e[t]||{};console.log(n.nodeName,n.className,n.id)}console.log("edn bodyTrap ----------")};var i,r=e("./portalOpenInstances"),o=(i=r)&&i.__esModule?i:{default:i};var s=void 0,a=void 0,l=[];function c(){0!==l.length&&l[l.length-1].focusContent()}o.default.subscribe((function(e,t){s||a||((s=document.createElement("div")).setAttribute("data-react-modal-body-trap",""),s.style.position="absolute",s.style.opacity="0",s.setAttribute("tabindex","0"),s.addEventListener("focus",c),(a=s.cloneNode()).addEventListener("focus",c)),(l=t).length>0?(document.body.firstChild!==s&&document.body.insertBefore(s,document.body.firstChild),document.body.lastChild!==a&&document.body.appendChild(a)):(s.parentElement&&s.parentElement.removeChild(s),a.parentElement&&a.parentElement.removeChild(a))}))},{"./portalOpenInstances":501}],499:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){var e=document.getElementsByTagName("html")[0];for(var t in i)o(e,i[t]);var n=document.body;for(var s in r)o(n,r[s]);i={},r={}},n.log=function(){};var i={},r={};function o(e,t){e.classList.remove(t)}n.add=function(e,t){return function(e,t,n){n.forEach((function(n){(function(e,t){e[t]||(e[t]=0),e[t]+=1})(t,n),e.add(n)}))}(e.classList,"html"==e.nodeName.toLowerCase()?i:r,t.split(" "))},n.remove=function(e,t){return function(e,t,n){n.forEach((function(n){(function(e,t){e[t]&&(e[t]-=1)})(t,n),0===t[n]&&e.remove(n)}))}(e.classList,"html"==e.nodeName.toLowerCase()?i:r,t.split(" "))}},{}],500:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.resetState=function(){s=[]},n.log=function(){},n.handleBlur=c,n.handleFocus=u,n.markForFocusLater=function(){s.push(document.activeElement)},n.returnFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;try{return void(0!==s.length&&(t=s.pop()).focus({preventScroll:e}))}catch(e){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},n.popWithoutFocus=function(){s.length>0&&s.pop()},n.setupScopedFocus=function(e){a=e,window.addEventListener?(window.addEventListener("blur",c,!1),document.addEventListener("focus",u,!0)):(window.attachEvent("onBlur",c),document.attachEvent("onFocus",u))},n.teardownScopedFocus=function(){a=null,window.addEventListener?(window.removeEventListener("blur",c),document.removeEventListener("focus",u)):(window.detachEvent("onBlur",c),document.detachEvent("onFocus",u))};var i,r=e("../helpers/tabbable"),o=(i=r)&&i.__esModule?i:{default:i};var s=[],a=null,l=!1;function c(){l=!0}function u(){if(l){if(l=!1,!a)return;setTimeout((function(){a.contains(document.activeElement)||((0,o.default)(a)[0]||a).focus()}),0)}}},{"../helpers/tabbable":504}],501:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.log=function(){console.log("portalOpenInstances ----------"),console.log(r.openInstances.length),r.openInstances.forEach((function(e){return console.log(e)})),console.log("end portalOpenInstances ----------")},n.resetState=function(){r=new i};var i=function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.register=function(e){-1===t.openInstances.indexOf(e)&&(t.openInstances.push(e),t.emit("register"))},this.deregister=function(e){var n=t.openInstances.indexOf(e);-1!==n&&(t.openInstances.splice(n,1),t.emit("deregister"))},this.subscribe=function(e){t.subscribers.push(e)},this.emit=function(e){t.subscribers.forEach((function(n){return n(e,t.openInstances.slice())}))},this.openInstances=[],this.subscribers=[]},r=new i;n.default=r},{}],502:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.canUseDOM=n.SafeNodeList=n.SafeHTMLCollection=void 0;var i,r=e("exenv");var o=((i=r)&&i.__esModule?i:{default:i}).default,s=o.canUseDOM?window.HTMLElement:{};n.SafeHTMLCollection=o.canUseDOM?window.HTMLCollection:{},n.SafeNodeList=o.canUseDOM?window.NodeList:{},n.canUseDOM=o.canUseDOM;n.default=s},{exenv:409}],503:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){var n=(0,o.default)(e);if(n.length){var i=void 0,r=t.shiftKey,a=n[0],l=n[n.length-1],c=s();if(e===c){if(!r)return;i=l}if(l!==c||r||(i=a),a===c&&r&&(i=l),i)return t.preventDefault(),void i.focus();var u=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null!=u&&"Chrome"!=u[1]&&null==/\biPod\b|\biPad\b/g.exec(navigator.userAgent)){var d=n.indexOf(c);if(d>-1&&(d+=r?-1:1),void 0===(i=n[d]))return t.preventDefault(),void(i=r?l:a).focus();t.preventDefault(),i.focus()}}else t.preventDefault()};var i,r=e("./tabbable"),o=(i=r)&&i.__esModule?i:{default:i};function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.activeElement.shadowRoot?s(e.activeElement.shadowRoot):e.activeElement}t.exports=n.default},{"./tabbable":504}],504:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function e(t){return[].slice.call(t.querySelectorAll("*"),0).reduce((function(t,n){return t.concat(n.shadowRoot?e(n.shadowRoot):[n])}),[]).filter(s)};var i=/input|select|textarea|button|object|iframe/;function r(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;try{var n=window.getComputedStyle(e);return t?"visible"!==n.getPropertyValue("overflow")||e.scrollWidth<=0&&e.scrollHeight<=0:"none"==n.getPropertyValue("display")}catch(e){return console.warn("Failed to inspect element style"),!1}}function o(e,t){var n=e.nodeName.toLowerCase();return(i.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e,n=e.getRootNode&&e.getRootNode();t&&t!==document.body;){if(n&&t===n&&(t=n.host.parentNode),r(t))return!1;t=t.parentNode}return!0}(e)}function s(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||t>=0)&&o(e,!n)}t.exports=n.default},{}],505:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i,r=e("./components/Modal"),o=(i=r)&&i.__esModule?i:{default:i};n.default=o.default,t.exports=n.default},{"./components/Modal":495}],506:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=n.ReactReduxContext=void 0;var r=i(e("react")).default.createContext(null);n.ReactReduxContext=r;var o=r;n.default=o},{"@babel/runtime/helpers/interopRequireDefault":357,react:548}],507:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default,r=e("@babel/runtime/helpers/interopRequireWildcard").default;n.__esModule=!0,n.default=void 0;var o=r(e("react")),s=(i(e("prop-types")),e("./Context")),a=e("../utils/Subscription"),l=e("../utils/useIsomorphicLayoutEffect");var c=function(e){var t=e.store,n=e.context,i=e.children,r=(0,o.useMemo)((function(){var e=(0,a.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,o.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=r.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[r,c]);var u=n||s.ReactReduxContext;return o.default.createElement(u.Provider,{value:r},i)};n.default=c},{"../utils/Subscription":522,"../utils/useIsomorphicLayoutEffect":528,"./Context":506,"@babel/runtime/helpers/interopRequireDefault":357,"@babel/runtime/helpers/interopRequireWildcard":358,"prop-types":487,react:548}],508:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default,r=e("@babel/runtime/helpers/interopRequireWildcard").default;n.__esModule=!0,n.default=function(e,t){void 0===t&&(t={});var n=t,i=n.getDisplayName,r=void 0===i?function(e){return"ConnectAdvanced("+e+")"}:i,d=n.methodName,T=void 0===d?"connectAdvanced":d,x=n.renderCountProp,w=void 0===x?void 0:x,k=n.shouldHandleStateChanges,S=void 0===k||k,C=n.storeKey,A=void 0===C?"store":C,I=(n.withRef,n.forwardRef),O=void 0!==I&&I,N=n.context,R=void 0===N?h.ReactReduxContext:N,D=(0,s.default)(n,p),L=R;return function(t){var n=t.displayName||t.name||"Component",i=r(n),d=(0,o.default)({},D,{getDisplayName:r,methodName:T,renderCountProp:w,shouldHandleStateChanges:S,storeKey:A,displayName:i,wrappedComponentName:n,WrappedComponent:t}),h=D.pure,p=h?l.useMemo:function(e){return e()};function x(n){var i=(0,l.useMemo)((function(){var e=n.reactReduxForwardedRef,t=(0,s.default)(n,f);return[n.context,e,t]}),[n]),r=i[0],a=i[1],h=i[2],T=(0,l.useMemo)((function(){return r&&r.Consumer&&(0,c.isContextConsumer)(l.default.createElement(r.Consumer,null))?r:L}),[r,L]),x=(0,l.useContext)(T),w=Boolean(n.store)&&Boolean(n.store.getState)&&Boolean(n.store.dispatch);Boolean(x)&&Boolean(x.store);var k=w?n.store:x.store,C=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,d)}(k)}),[k]),A=(0,l.useMemo)((function(){if(!S)return m;var e=(0,u.createSubscription)(k,w?null:x.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[k,w,x]),I=A[0],O=A[1],N=(0,l.useMemo)((function(){return w?x:(0,o.default)({},x,{subscription:I})}),[w,x,I]),R=(0,l.useReducer)(b,g,E),D=R[0][0],M=R[1];if(D&&D.error)throw D.error;var P=(0,l.useRef)(),B=(0,l.useRef)(h),j=(0,l.useRef)(),F=(0,l.useRef)(!1),$=p((function(){return j.current&&h===B.current?j.current:C(k.getState(),h)}),[k,D,h]);y(v,[B,P,F,h,$,j,O]),y(_,[S,k,I,C,B,P,F,j,O,M],[k,I,C]);var U=(0,l.useMemo)((function(){return l.default.createElement(t,(0,o.default)({},$,{ref:a}))}),[a,t,$]);return(0,l.useMemo)((function(){return S?l.default.createElement(T.Provider,{value:N},U):U}),[T,U,N])}var k=h?l.default.memo(x):x;if(k.WrappedComponent=t,k.displayName=x.displayName=i,O){var C=l.default.forwardRef((function(e,t){return l.default.createElement(k,(0,o.default)({},e,{reactReduxForwardedRef:t}))}));return C.displayName=i,C.WrappedComponent=t,(0,a.default)(C,t)}return(0,a.default)(k,t)}};var o=i(e("@babel/runtime/helpers/extends")),s=i(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),a=i(e("hoist-non-react-statics")),l=r(e("react")),c=e("react-is"),u=e("../utils/Subscription"),d=e("../utils/useIsomorphicLayoutEffect"),h=e("./Context"),p=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],f=["reactReduxForwardedRef"],g=[],m=[null,null];function b(e,t){var n=e[1];return[t.payload,n+1]}function y(e,t,n){(0,d.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),n)}function v(e,t,n,i,r,o,s){e.current=i,t.current=r,n.current=!1,o.current&&(o.current=null,s())}function _(e,t,n,i,r,o,s,a,l,c){if(e){var u=!1,d=null,h=function(){if(!u){var e,n,h=t.getState();try{e=i(h,r.current)}catch(e){n=e,d=e}n||(d=null),e===o.current?s.current||l():(o.current=e,a.current=e,s.current=!0,c({type:"STORE_UPDATED",payload:{error:n}}))}};return n.onStateChange=h,n.trySubscribe(),h(),function(){if(u=!0,n.tryUnsubscribe(),n.onStateChange=null,d)throw d}}}var E=function(){return[null,0]}},{"../utils/Subscription":522,"../utils/useIsomorphicLayoutEffect":528,"./Context":506,"@babel/runtime/helpers/extends":356,"@babel/runtime/helpers/interopRequireDefault":357,"@babel/runtime/helpers/interopRequireWildcard":358,"@babel/runtime/helpers/objectWithoutPropertiesLoose":360,"hoist-non-react-statics":420,react:548,"react-is":532}],509:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.createConnect=g,n.default=void 0;var r=i(e("@babel/runtime/helpers/extends")),o=i(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),s=i(e("../components/connectAdvanced")),a=i(e("../utils/shallowEqual")),l=i(e("./mapDispatchToProps")),c=i(e("./mapStateToProps")),u=i(e("./mergeProps")),d=i(e("./selectorFactory")),h=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function p(e,t,n){for(var i=t.length-1;i>=0;i--){var r=t[i](e);if(r)return r}return function(t,i){throw new Error("Invalid value of type "+typeof e+" for "+n+" argument when connecting component "+i.wrappedComponentName+".")}}function f(e,t){return e===t}function g(e){var t=void 0===e?{}:e,n=t.connectHOC,i=void 0===n?s.default:n,g=t.mapStateToPropsFactories,m=void 0===g?c.default:g,b=t.mapDispatchToPropsFactories,y=void 0===b?l.default:b,v=t.mergePropsFactories,_=void 0===v?u.default:v,E=t.selectorFactory,T=void 0===E?d.default:E;return function(e,t,n,s){void 0===s&&(s={});var l=s,c=l.pure,u=void 0===c||c,d=l.areStatesEqual,g=void 0===d?f:d,b=l.areOwnPropsEqual,v=void 0===b?a.default:b,E=l.areStatePropsEqual,x=void 0===E?a.default:E,w=l.areMergedPropsEqual,k=void 0===w?a.default:w,S=(0,o.default)(l,h),C=p(e,m,"mapStateToProps"),A=p(t,y,"mapDispatchToProps"),I=p(n,_,"mergeProps");return i(T,(0,r.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:C,initMapDispatchToProps:A,initMergeProps:I,pure:u,areStatesEqual:g,areOwnPropsEqual:v,areStatePropsEqual:x,areMergedPropsEqual:k},S))}}var m=g();n.default=m},{"../components/connectAdvanced":508,"../utils/shallowEqual":527,"./mapDispatchToProps":510,"./mapStateToProps":511,"./mergeProps":512,"./selectorFactory":513,"@babel/runtime/helpers/extends":356,"@babel/runtime/helpers/interopRequireDefault":357,"@babel/runtime/helpers/objectWithoutPropertiesLoose":360}],510:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=void 0,n.whenMapDispatchToPropsIsFunction=s,n.whenMapDispatchToPropsIsMissing=a,n.whenMapDispatchToPropsIsObject=l;var r=i(e("../utils/bindActionCreators")),o=e("./wrapMapToProps");function s(e){return"function"==typeof e?(0,o.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,o.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,o.wrapMapToPropsConstant)((function(t){return(0,r.default)(e,t)})):void 0}var c=[s,a,l];n.default=c},{"../utils/bindActionCreators":524,"./wrapMapToProps":515,"@babel/runtime/helpers/interopRequireDefault":357}],511:[function(e,t,n){"use strict";n.__esModule=!0,n.default=void 0,n.whenMapStateToPropsIsFunction=r,n.whenMapStateToPropsIsMissing=o;var i=e("./wrapMapToProps");function r(e){return"function"==typeof e?(0,i.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,i.wrapMapToPropsConstant)((function(){return{}}))}var s=[r,o];n.default=s},{"./wrapMapToProps":515}],512:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=void 0,n.defaultMergeProps=o,n.whenMergePropsIsFunction=a,n.whenMergePropsIsOmitted=l,n.wrapMergePropsFunc=s;var r=i(e("@babel/runtime/helpers/extends"));i(e("../utils/verifyPlainObject"));function o(e,t,n){return(0,r.default)({},n,e,t)}function s(e){return function(t,n){n.displayName;var i,r=n.pure,o=n.areMergedPropsEqual,s=!1;return function(t,n,a){var l=e(t,n,a);return s?r&&o(l,i)||(i=l):(s=!0,i=l),i}}}function a(e){return"function"==typeof e?s(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];n.default=c},{"../utils/verifyPlainObject":529,"@babel/runtime/helpers/extends":356,"@babel/runtime/helpers/interopRequireDefault":357}],513:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t){var n=t.initMapStateToProps,i=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,r.default)(t,o),u=n(e,c),d=i(e,c),h=l(e,c);return(c.pure?a:s)(u,d,h,e,c)},n.impureFinalPropsSelectorFactory=s,n.pureFinalPropsSelectorFactory=a;var r=i(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),o=(i(e("./verifySubselectors")),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function s(e,t,n,i){return function(r,o){return n(e(r,o),t(i,o),o)}}function a(e,t,n,i,r){var o,s,a,l,c,u=r.areStatesEqual,d=r.areOwnPropsEqual,h=r.areStatePropsEqual,p=!1;function f(r,p){var f,g,m=!d(p,s),b=!u(r,o,p,s);return o=r,s=p,m&&b?(a=e(o,s),t.dependsOnOwnProps&&(l=t(i,s)),c=n(a,l,s)):m?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(l=t(i,s)),c=n(a,l,s)):b?(f=e(o,s),g=!h(f,a),a=f,g&&(c=n(a,l,s)),c):c}return function(r,u){return p?f(r,u):(a=e(o=r,s=u),l=t(i,s),c=n(a,l,s),p=!0,c)}}},{"./verifySubselectors":514,"@babel/runtime/helpers/interopRequireDefault":357,"@babel/runtime/helpers/objectWithoutPropertiesLoose":360}],514:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t,n,i){o(e,"mapStateToProps",i),o(t,"mapDispatchToProps",i),o(n,"mergeProps",i)};var r=i(e("../utils/warning"));function o(e,t,n){if(!e)throw new Error("Unexpected value for "+t+" in "+n+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,r.default)("The selector for "+t+" of "+n+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":530,"@babel/runtime/helpers/interopRequireDefault":357}],515:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.getDependsOnOwnProps=r,n.wrapMapToPropsConstant=function(e){return function(t,n){var i=e(t,n);function r(){return i}return r.dependsOnOwnProps=!1,r}},n.wrapMapToPropsFunc=function(e,t){return function(t,n){n.displayName;var i=function(e,t){return i.dependsOnOwnProps?i.mapToProps(e,t):i.mapToProps(e)};return i.dependsOnOwnProps=!0,i.mapToProps=function(t,n){i.mapToProps=e,i.dependsOnOwnProps=r(e);var o=i(t,n);return"function"==typeof o&&(i.mapToProps=o,i.dependsOnOwnProps=r(o),o=i(t,n)),o},i}};i(e("../utils/verifyPlainObject"));function r(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":529,"@babel/runtime/helpers/interopRequireDefault":357}],516:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0;var r=i(e("./components/Provider"));n.Provider=r.default;var o=i(e("./components/connectAdvanced"));n.connectAdvanced=o.default;var s=e("./components/Context");n.ReactReduxContext=s.ReactReduxContext;var a=i(e("./connect/connect"));n.connect=a.default;var l=e("./hooks/useDispatch");n.useDispatch=l.useDispatch,n.createDispatchHook=l.createDispatchHook;var c=e("./hooks/useSelector");n.useSelector=c.useSelector,n.createSelectorHook=c.createSelectorHook;var u=e("./hooks/useStore");n.useStore=u.useStore,n.createStoreHook=u.createStoreHook;var d=i(e("./utils/shallowEqual"));n.shallowEqual=d.default},{"./components/Context":506,"./components/Provider":507,"./components/connectAdvanced":508,"./connect/connect":509,"./hooks/useDispatch":517,"./hooks/useSelector":519,"./hooks/useStore":520,"./utils/shallowEqual":527,"@babel/runtime/helpers/interopRequireDefault":357}],517:[function(e,t,n){"use strict";n.__esModule=!0,n.createDispatchHook=o,n.useDispatch=void 0;var i=e("../components/Context"),r=e("./useStore");function o(e){void 0===e&&(e=i.ReactReduxContext);var t=e===i.ReactReduxContext?r.useStore:(0,r.createStoreHook)(e);return function(){return t().dispatch}}var s=o();n.useDispatch=s},{"../components/Context":506,"./useStore":520}],518:[function(e,t,n){"use strict";n.__esModule=!0,n.useReduxContext=function(){return(0,i.useContext)(r.ReactReduxContext)};var i=e("react"),r=e("../components/Context")},{"../components/Context":506,react:548}],519:[function(e,t,n){"use strict";n.__esModule=!0,n.createSelectorHook=c,n.useSelector=void 0;var i=e("react"),r=e("./useReduxContext"),o=e("../utils/Subscription"),s=e("../utils/useIsomorphicLayoutEffect"),a=e("../components/Context"),l=function(e,t){return e===t};function c(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?r.useReduxContext:function(){return(0,i.useContext)(e)};return function(e,n){void 0===n&&(n=l);var r=t(),a=function(e,t,n,r){var a,l=(0,i.useReducer)((function(e){return e+1}),0)[1],c=(0,i.useMemo)((function(){return(0,o.createSubscription)(n,r)}),[n,r]),u=(0,i.useRef)(),d=(0,i.useRef)(),h=(0,i.useRef)(),p=(0,i.useRef)(),f=n.getState();try{if(e!==d.current||f!==h.current||u.current){var g=e(f);a=void 0!==p.current&&t(g,p.current)?p.current:g}else a=p.current}catch(e){throw u.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\n"),e}return(0,s.useIsomorphicLayoutEffect)((function(){d.current=e,h.current=f,p.current=a,u.current=void 0})),(0,s.useIsomorphicLayoutEffect)((function(){function e(){try{var e=n.getState();if(e===h.current)return;var i=d.current(e);if(t(i,p.current))return;p.current=i,h.current=e}catch(e){u.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[n,c]),a}(e,n,r.store,r.subscription);return(0,i.useDebugValue)(a),a}}var u=c();n.useSelector=u},{"../components/Context":506,"../utils/Subscription":522,"../utils/useIsomorphicLayoutEffect":528,"./useReduxContext":518,react:548}],520:[function(e,t,n){"use strict";n.__esModule=!0,n.createStoreHook=s,n.useStore=void 0;var i=e("react"),r=e("../components/Context"),o=e("./useReduxContext");function s(e){void 0===e&&(e=r.ReactReduxContext);var t=e===r.ReactReduxContext?o.useReduxContext:function(){return(0,i.useContext)(e)};return function(){return t().store}}var a=s();n.useStore=a},{"../components/Context":506,"./useReduxContext":518,react:548}],521:[function(e,t,n){"use strict";n.__esModule=!0;var i={batch:!0},r=e("./exports");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in n&&n[e]===r[e]||(n[e]=r[e]))}));var o=e("./utils/reactBatchedUpdates");n.batch=o.unstable_batchedUpdates,(0,e("./utils/batch").setBatch)(o.unstable_batchedUpdates)},{"./exports":516,"./utils/batch":523,"./utils/reactBatchedUpdates":526}],522:[function(e,t,n){"use strict";n.__esModule=!0,n.createSubscription=function(e,t){var n,o=r;function s(){l.onStateChange&&l.onStateChange()}function a(){n||(n=t?t.addNestedSub(s):e.subscribe(s),o=function(){var e=(0,i.getBatch)(),t=null,n=null;return{clear:function(){t=null,n=null},notify:function(){e((function(){for(var e=t;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],n=t;n;)e.push(n),n=n.next;return e},subscribe:function(e){var i=!0,r=n={callback:e,next:null,prev:n};return r.prev?r.prev.next=r:t=r,function(){i&&null!==t&&(i=!1,r.next?r.next.prev=r.prev:n=r.prev,r.prev?r.prev.next=r.next:t=r.next)}}}}())}var l={addNestedSub:function(e){return a(),o.subscribe(e)},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:s,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,o.clear(),o=r)},getListeners:function(){return o}};return l};var i=e("./batch");var r={notify:function(){},get:function(){return[]}}},{"./batch":523}],523:[function(e,t,n){"use strict";n.__esModule=!0,n.setBatch=n.getBatch=void 0;var i=function(e){e()};n.setBatch=function(e){return i=e};n.getBatch=function(){return i}},{}],524:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){var n={},i=function(i){var r=e[i];"function"==typeof r&&(n[i]=function(){return t(r.apply(void 0,arguments))})};for(var r in e)i(r);return n}},{}],525:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}},{}],526:[function(e,t,n){"use strict";n.__esModule=!0,n.unstable_batchedUpdates=void 0;var i=e("react-dom");n.unstable_batchedUpdates=i.unstable_batchedUpdates},{"react-dom":491}],527:[function(e,t,n){"use strict";function i(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}n.__esModule=!0,n.default=function(e,t){if(i(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var o=0;o<n.length;o++)if(!Object.prototype.hasOwnProperty.call(t,n[o])||!i(e[n[o]],t[n[o]]))return!1;return!0}},{}],528:[function(e,t,n){"use strict";n.__esModule=!0,n.useIsomorphicLayoutEffect=void 0;var i=e("react"),r="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect;n.useIsomorphicLayoutEffect=r},{react:548}],529:[function(e,t,n){"use strict";var i=e("@babel/runtime/helpers/interopRequireDefault").default;n.__esModule=!0,n.default=function(e,t,n){(0,r.default)(e)||(0,o.default)(n+"() in "+t+" must return a plain object. Instead received "+e+".")};var r=i(e("./isPlainObject")),o=i(e("./warning"))},{"./isPlainObject":525,"./warning":530,"@babel/runtime/helpers/interopRequireDefault":357}],530:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],531:[function(e,t,n){"use strict";var i=60103,r=60106,o=60107,s=60108,a=60114,l=60109,c=60110,u=60112,d=60113,h=60120,p=60115,f=60116,g=60121,m=60122,b=60117,y=60129,v=60131;if("function"==typeof Symbol&&Symbol.for){var _=Symbol.for;i=_("react.element"),r=_("react.portal"),o=_("react.fragment"),s=_("react.strict_mode"),a=_("react.profiler"),l=_("react.provider"),c=_("react.context"),u=_("react.forward_ref"),d=_("react.suspense"),h=_("react.suspense_list"),p=_("react.memo"),f=_("react.lazy"),g=_("react.block"),m=_("react.server.block"),b=_("react.fundamental"),y=_("react.debug_trace_mode"),v=_("react.legacy_hidden")}function E(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case o:case a:case s:case d:case h:return e;default:switch(e=e&&e.$$typeof){case c:case u:case f:case p:case l:return e;default:return t}}case r:return t}}}var T=l,x=i,w=u,k=o,S=f,C=p,A=r,I=a,O=s,N=d;n.ContextConsumer=c,n.ContextProvider=T,n.Element=x,n.ForwardRef=w,n.Fragment=k,n.Lazy=S,n.Memo=C,n.Portal=A,n.Profiler=I,n.StrictMode=O,n.Suspense=N,n.isAsyncMode=function(){return!1},n.isConcurrentMode=function(){return!1},n.isContextConsumer=function(e){return E(e)===c},n.isContextProvider=function(e){return E(e)===l},n.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},n.isForwardRef=function(e){return E(e)===u},n.isFragment=function(e){return E(e)===o},n.isLazy=function(e){return E(e)===f},n.isMemo=function(e){return E(e)===p},n.isPortal=function(e){return E(e)===r},n.isProfiler=function(e){return E(e)===a},n.isStrictMode=function(e){return E(e)===s},n.isSuspense=function(e){return E(e)===d},n.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===a||e===y||e===s||e===d||e===h||e===v||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===p||e.$$typeof===l||e.$$typeof===c||e.$$typeof===u||e.$$typeof===b||e.$$typeof===g||e[0]===m)},n.typeOf=E},{}],532:[function(e,t,n){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":531}],533:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],534:[function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCustomEvent=function(e){return this.state.event||!!e.getAttribute("data-event")},e.prototype.customBindListener=function(e){var t=this,n=this.state,i=n.event,o=n.eventOff,a=e.getAttribute("data-event")||i,l=e.getAttribute("data-event-off")||o;a.split(" ").forEach((function(n){e.removeEventListener(n,s.get(e,n));var i=r.bind(t,l);s.set(e,n,i),e.addEventListener(n,i,!1)})),l&&l.split(" ").forEach((function(n){e.removeEventListener(n,t.hideTooltip),e.addEventListener(n,t.hideTooltip,!1)}))},e.prototype.customUnbindListener=function(e){var t=this.state,n=t.event,i=t.eventOff,r=n||e.getAttribute("data-event"),o=i||e.getAttribute("data-event-off");e.removeEventListener(r,s.get(e,n)),o&&e.removeEventListener(o,this.hideTooltip)}};var r=function(e,t){var n=this.state.show,i=this.props.id,r=t.currentTarget.getAttribute("data-iscapture"),s=r&&"true"===r||this.props.isCapture,a=t.currentTarget.getAttribute("currentItem");s||t.stopPropagation(),n&&"true"===a?e||this.hideTooltip(t):(t.currentTarget.setAttribute("currentItem","true"),o(t.currentTarget,this.getTargetArray(i)),this.showTooltip(t))},o=function(e,t){for(var n=0;n<t.length;n++)e!==t[n]?t[n].setAttribute("currentItem","false"):t[n].setAttribute("currentItem","true")},s={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function(e,t,n){this.id in e?e[this.id][t]=n:Object.defineProperty(e,this.id,{configurable:!0,value:i({},t,n)})},get:function(e,t){var n=e[this.id];if(void 0!==n)return n[t]}}},{}],535:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.getEffect=function(e){return e.getAttribute("data-effect")||this.props.effect||"float"}}},{}],536:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.isCapture=function(e){return e&&"true"===e.getAttribute("data-iscapture")||this.props.isCapture||!1}}},{}],537:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.hide=function(e){s(o.default.GLOBAL.HIDE,{target:e})},e.rebuild=function(){s(o.default.GLOBAL.REBUILD)},e.show=function(e){s(o.default.GLOBAL.SHOW,{target:e})},e.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},e.prototype.globalShow=function(e){if(this.mount){var t={currentTarget:e.detail.target};this.showTooltip(t,!0)}},e.prototype.globalHide=function(e){if(this.mount){var t=!!(e&&e.detail&&e.detail.target);this.hideTooltip({currentTarget:t&&e.detail.target},t)}}};var i,r=e("../constant"),o=(i=r)&&i.__esModule?i:{default:i};var s=function(e,t){var n=void 0;"function"==typeof window.CustomEvent?n=new window.CustomEvent(e,{detail:t}):((n=document.createEvent("Event")).initEvent(e,!1,!0),n.detail=t),window.dispatchEvent(n)}},{"../constant":533}],538:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindRemovalTracker=function(){var e=this,t=i();if(null!=t){var n=new t((function(t){for(var n=0;n<t.length;n++)for(var i=t[n],r=0;r<i.removedNodes.length;r++)if(i.removedNodes[r]===e.state.currentTarget)return void e.hideTooltip()}));n.observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=n}},e.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}};var i=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}},{}],539:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.addEventListener(o.default.GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.addEventListener(o.default.GLOBAL.SHOW,this.globalShow,!1),e&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},e.prototype.unbindWindowEvents=function(){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},e.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}};var i,r=e("../constant"),o=(i=r)&&i.__esModule?i:{default:i}},{"../constant":533}],540:[function(e,t,n){"use strict";var i,r,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=w(e("react")),c=w(e("prop-types")),u=w(e("react-dom")),d=w(e("classnames")),h=w(e("sanitize-html-react")),p=w(e("./decorators/staticMethods")),f=w(e("./decorators/windowListener")),g=w(e("./decorators/customEvent")),m=w(e("./decorators/isCapture")),b=w(e("./decorators/getEffect")),y=w(e("./decorators/trackRemoval")),v=w(e("./utils/getPosition")),_=w(e("./utils/getTipContent")),E=e("./utils/aria"),T=w(e("./utils/nodeListToArray")),x=w(e("./style"));function w(e){return e&&e.__esModule?e:{default:e}}var k=(0,p.default)(i=(0,f.default)(i=(0,g.default)(i=(0,m.default)(i=(0,b.default)(i=(0,y.default)((o=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={place:e.place||"top",desiredPlace:e.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,E.parseAria)(e),isEmptyTip:!1,disable:!1,originTooltip:null,isMultiline:!1},n.bind(["showTooltip","updateTooltip","hideTooltip","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),n.mount=!0,n.delayShowLoop=null,n.delayHideLoop=null,n.delayReshow=null,n.intervalUpdateContent=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.Component),a(t,[{key:"bind",value:function(e){var t=this;e.forEach((function(e){t[e]=t[e].bind(t)}))}},{key:"componentDidMount",value:function(){var e=this.props,t=e.insecure,n=e.resizeHide;t&&this.setStyleHeader(),this.bindListener(),this.bindWindowEvents(n)}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.ariaProps,n=(0,E.parseAria)(e);Object.keys(n).some((function(e){return n[e]!==t[e]}))&&this.setState({ariaProps:n})}},{key:"componentWillUnmount",value:function(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function(){return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.matches=this.tooltipRef.msMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function(e){var t=void 0;if(e){var n=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"');t=document.querySelectorAll('[data-tip][data-for="'+n+'"]')}else t=document.querySelectorAll("[data-tip]:not([data-for])");return(0,T.default)(t)}},{key:"bindListener",value:function(){var e=this,t=this.props,n=t.id,i=t.globalEventOff,r=t.isCapture;this.getTargetArray(n).forEach((function(t){var n=e.isCapture(t),i=e.getEffect(t);null===t.getAttribute("currentItem")&&t.setAttribute("currentItem","false"),e.unbindBasicListener(t),e.isCustomEvent(t)?e.customBindListener(t):(t.addEventListener("mouseenter",e.showTooltip,n),"float"===i&&t.addEventListener("mousemove",e.updateTooltip,n),t.addEventListener("mouseleave",e.hideTooltip,n))})),i&&(window.removeEventListener(i,this.hideTooltip),window.addEventListener(i,this.hideTooltip,r)),this.bindRemovalTracker()}},{key:"unbindListener",value:function(){var e=this,t=this.props,n=t.id,i=t.globalEventOff;this.getTargetArray(n).forEach((function(t){e.unbindBasicListener(t),e.isCustomEvent(t)&&e.customUnbindListener(t)})),i&&window.removeEventListener(i,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function(e){var t=this.isCapture(e);e.removeEventListener("mouseenter",this.showTooltip,t),e.removeEventListener("mousemove",this.updateTooltip,t),e.removeEventListener("mouseleave",this.hideTooltip,t)}},{key:"getTooltipContent",value:function(){var e=this.props,t=e.getContent,n=e.children,i=void 0;return t&&(i=Array.isArray(t)?t[0]&&t[0](this.state.originTooltip):t(this.state.originTooltip)),(0,_.default)(this.state.originTooltip,n,i,this.state.isMultiline)}},{key:"isEmptyTip",value:function(e){return"string"==typeof e&&""===e||null===e}},{key:"showTooltip",value:function(e,t){if(!t||this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))){var n=this.props,i=n.multiline,r=n.getContent,o=e.currentTarget.getAttribute("data-tip"),s=e.currentTarget.getAttribute("data-multiline")||i||!1,a=e instanceof window.FocusEvent||t,l=!0;e.currentTarget.getAttribute("data-scroll-hide")?l="true"===e.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(l=this.props.scrollHide);var c=e.currentTarget.getAttribute("data-place")||this.props.place||"top",d=a?"solid":this.getEffect(e.currentTarget),h=e.currentTarget.getAttribute("data-offset")||this.props.offset||{},p=(0,v.default)(e,e.currentTarget,u.default.findDOMNode(this),c,c,d,h),f=p.isNewState?p.newState.place:c;this.clearTimer();var g=e.currentTarget,m=this.state.show?g.getAttribute("data-delay-update")||this.props.delayUpdate:0,b=this,y=function(){b.setState({originTooltip:o,isMultiline:s,desiredPlace:c,place:f,type:g.getAttribute("data-type")||b.props.type||"dark",effect:d,offset:h,html:g.getAttribute("data-html")?"true"===g.getAttribute("data-html"):b.props.html||!1,delayShow:g.getAttribute("data-delay-show")||b.props.delayShow||0,delayHide:g.getAttribute("data-delay-hide")||b.props.delayHide||0,delayUpdate:g.getAttribute("data-delay-update")||b.props.delayUpdate||0,border:g.getAttribute("data-border")?"true"===g.getAttribute("data-border"):b.props.border||!1,extraClass:g.getAttribute("data-class")||b.props.class||b.props.className||"",disable:g.getAttribute("data-tip-disable")?"true"===g.getAttribute("data-tip-disable"):b.props.disable||!1,currentTarget:g},(function(){l&&b.addScrollListener(b.state.currentTarget),b.updateTooltip(e),r&&Array.isArray(r)&&(b.intervalUpdateContent=setInterval((function(){if(b.mount){var e=b.props.getContent,t=(0,_.default)(o,"",e[0](),s),n=b.isEmptyTip(t);b.setState({isEmptyTip:n}),b.updatePosition()}}),r[1]))}))};m?this.delayReshow=setTimeout(y,m):y()}}},{key:"updateTooltip",value:function(e){var t=this,n=this.state,i=n.delayShow,r=n.disable,o=this.props.afterShow,s=this.getTooltipContent(),a=parseInt(i,10),l=e.currentTarget||e.target;if(!this.mouseOnToolTip()&&!this.isEmptyTip(s)&&!r){var c=function(){if(Array.isArray(s)&&s.length>0||s){var n=!t.state.show;t.setState({currentEvent:e,currentTarget:l,show:!0},(function(){t.updatePosition(),n&&o&&o()}))}};clearTimeout(this.delayShowLoop),i?this.delayShowLoop=setTimeout(c,a):c()}}},{key:"listenForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function(e,t){var n=this,i=this.state,r=i.delayHide,o=i.disable,s=this.props.afterHide,a=this.getTooltipContent();if(this.mount&&!this.isEmptyTip(a)&&!o){if(t&&(!this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))||!this.state.show))return;var l=function(){var e=n.state.show;n.mouseOnToolTip()?n.listenForTooltipExit():(n.removeListenerForTooltipExit(),n.setState({show:!1},(function(){n.removeScrollListener(),e&&s&&s()})))};this.clearTimer(),r?this.delayHideLoop=setTimeout(l,parseInt(r,10)):l()}}},{key:"addScrollListener",value:function(e){var t=this.isCapture(e);window.addEventListener("scroll",this.hideTooltip,t)}},{key:"removeScrollListener",value:function(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function(){var e=this,t=this.state,n=t.currentEvent,i=t.currentTarget,r=t.place,o=t.desiredPlace,s=t.effect,a=t.offset,l=u.default.findDOMNode(this),c=(0,v.default)(n,i,l,r,o,s,a);if(c.isNewState)return this.setState(c.newState,(function(){e.updatePosition()}));l.style.left=c.position.left+"px",l.style.top=c.position.top+"px"}},{key:"setStyleHeader",value:function(){var e=document.getElementsByTagName("head")[0];if(!e.querySelector('style[id="react-tooltip"]')){var t=document.createElement("style");t.id="react-tooltip",t.innerHTML=x.default,"undefined"!=typeof __webpack_nonce__&&__webpack_nonce__&&t.setAttribute("nonce",__webpack_nonce__),e.insertBefore(t,e.firstChild)}}},{key:"clearTimer",value:function(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function(){var e=this,n=this.state,i=n.extraClass,r=n.html,o=n.ariaProps,a=n.disable,c=this.getTooltipContent(),u=this.isEmptyTip(c),p=(0,d.default)("__react_component_tooltip",{show:this.state.show&&!a&&!u},{border:this.state.border},{"place-top":"top"===this.state.place},{"place-bottom":"bottom"===this.state.place},{"place-left":"left"===this.state.place},{"place-right":"right"===this.state.place},{"type-dark":"dark"===this.state.type},{"type-success":"success"===this.state.type},{"type-warning":"warning"===this.state.type},{"type-error":"error"===this.state.type},{"type-info":"info"===this.state.type},{"type-light":"light"===this.state.type},{allow_hover:this.props.delayUpdate}),f=this.props.wrapper;return t.supportedWrappers.indexOf(f)<0&&(f=t.defaultProps.wrapper),r?l.default.createElement(f,s({className:p+" "+i,id:this.props.id,ref:function(t){return e.tooltipRef=t}},o,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:(0,h.default)(c,this.props.sanitizeHtmlOptions)}})):l.default.createElement(f,s({className:p+" "+i,id:this.props.id},o,{ref:function(t){return e.tooltipRef=t},"data-id":"tooltip"}),c)}}]),t}(),r.propTypes={children:c.default.any,place:c.default.string,type:c.default.string,effect:c.default.string,offset:c.default.object,multiline:c.default.bool,border:c.default.bool,insecure:c.default.bool,class:c.default.string,className:c.default.string,id:c.default.string,html:c.default.bool,delayHide:c.default.number,delayUpdate:c.default.number,delayShow:c.default.number,event:c.default.string,eventOff:c.default.string,watchWindow:c.default.bool,isCapture:c.default.bool,globalEventOff:c.default.string,getContent:c.default.any,afterShow:c.default.func,afterHide:c.default.func,disable:c.default.bool,scrollHide:c.default.bool,resizeHide:c.default.bool,wrapper:c.default.string,sanitizeHtmlOptions:c.default.any},r.defaultProps={insecure:!0,resizeHide:!0,wrapper:"div"},r.supportedWrappers=["div","span"],r.displayName="ReactTooltip",i=o))||i)||i)||i)||i)||i)||i;t.exports=k},{"./decorators/customEvent":534,"./decorators/getEffect":535,"./decorators/isCapture":536,"./decorators/staticMethods":537,"./decorators/trackRemoval":538,"./decorators/windowListener":539,"./style":541,"./utils/aria":542,"./utils/getPosition":543,"./utils/getTipContent":544,"./utils/nodeListToArray":545,classnames:384,"prop-types":487,react:548,"react-dom":491,"sanitize-html-react":568}],541:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip.allow_hover{pointer-events:auto}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}'},{}],542:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseAria=function(e){var t={};return Object.keys(e).filter((function(e){return/(^aria-\w+$|^role$)/.test(e)})).forEach((function(n){t[n]=e[n]})),t}},{}],543:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,l,c,u,d){for(var h=i(n),p=h.width,f=h.height,g=i(t),m=g.width,b=g.height,y=r(e,t,u),v=y.mouseX,_=y.mouseY,E=o(u,m,b,p,f),T=s(d),x=T.extraOffset_X,w=T.extraOffset_Y,k=window.innerWidth,S=window.innerHeight,C=a(n),A=C.parentTop,I=C.parentLeft,O=function(e){var t=E[e].l;return v+t+x},N=function(e){var t=E[e].t;return _+t+w},R=function(e){return function(e){return O(e)<0}(e)||function(e){return t=E[e].r,v+t+x>k;var t}(e)||function(e){return N(e)<0}(e)||function(e){return t=E[e].b,_+t+w>S;var t}(e)},D=function(e){return!R(e)},L=["top","bottom","left","right"],M=[],P=0;P<4;P++){var B=L[P];D(B)&&M.push(B)}var j=!1,F=void 0;return D(c)&&c!==l?(j=!0,F=c):M.length>0&&R(c)&&R(l)&&(j=!0,F=M[0]),j?{isNewState:!0,newState:{place:F}}:{isNewState:!1,position:{left:parseInt(O(l)-I,10),top:parseInt(N(l)-A,10)}}};var i=function(e){var t=e.getBoundingClientRect(),n=t.height,i=t.width;return{height:parseInt(n,10),width:parseInt(i,10)}},r=function(e,t,n){var r=t.getBoundingClientRect(),o=r.top,s=r.left,a=i(t),l=a.width,c=a.height;return"float"===n?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:s+l/2,mouseY:o+c/2}},o=function(e,t,n,i,r){var o=void 0,s=void 0,a=void 0,l=void 0;return"float"===e?(o={l:-i/2,r:i/2,t:-(r+3+2),b:-3},a={l:-i/2,r:i/2,t:15,b:r+3+2+12},l={l:-(i+3+2),r:-3,t:-r/2,b:r/2},s={l:3,r:i+3+2,t:-r/2,b:r/2}):"solid"===e&&(o={l:-i/2,r:i/2,t:-(n/2+r+2),b:-n/2},a={l:-i/2,r:i/2,t:n/2,b:n/2+r+2},l={l:-(i+t/2+2),r:-t/2,t:-r/2,b:r/2},s={l:t/2,r:i+t/2+2,t:-r/2,b:r/2}),{top:o,bottom:a,left:l,right:s}},s=function(e){var t=0,n=0;for(var i in"[object String]"===Object.prototype.toString.apply(e)&&(e=JSON.parse(e.toString().replace(/\'/g,'"'))),e)"top"===i?n-=parseInt(e[i],10):"bottom"===i?n+=parseInt(e[i],10):"left"===i?t-=parseInt(e[i],10):"right"===i&&(t+=parseInt(e[i],10));return{extraOffset_X:t,extraOffset_Y:n}},a=function(e){for(var t=e;t&&"none"===window.getComputedStyle(t).getPropertyValue("transform");)t=t.parentElement;return{parentTop:t&&t.getBoundingClientRect().top||0,parentLeft:t&&t.getBoundingClientRect().left||0}}},{}],544:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n,i){if(t)return t;if(null!=n)return n;if(null===n)return null;var r=/<br\s*\/?>/;return i&&"false"!==i&&r.test(e)?e.split(r).map((function(e,t){return o.default.createElement("span",{key:t,className:"multi-line"},e)})):e};var i,r=e("react"),o=(i=r)&&i.__esModule?i:{default:i}},{react:548}],545:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){var t=e.length;return e.hasOwnProperty?Array.prototype.slice.call(e):new Array(t).fill().map((function(t){return e[t]}))}},{}],546:[function(e,t,n){"use strict";e("object-assign");var i=e("react"),r=60103;if(n.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;r=o("react.element"),n.Fragment=o("react.fragment")}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:s.current}}n.jsx=c,n.jsxs=c},{"object-assign":465,react:548}],547:[function(e,t,n){"use strict";var i=e("object-assign"),r=60103,o=60106;n.Fragment=60107,n.StrictMode=60108,n.Profiler=60114;var s=60109,a=60110,l=60112;n.Suspense=60113;var c=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var d=Symbol.for;r=d("react.element"),o=d("react.portal"),n.Fragment=d("react.fragment"),n.StrictMode=d("react.strict_mode"),n.Profiler=d("react.profiler"),s=d("react.provider"),a=d("react.context"),l=d("react.forward_ref"),n.Suspense=d("react.suspense"),c=d("react.memo"),u=d("react.lazy")}var h="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=m.prototype;var v=y.prototype=new b;v.constructor=y,i(v,m.prototype),v.isPureReactComponent=!0;var _={current:null},E=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,n){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)E.call(t,i)&&!T.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:r,type:e,key:s,ref:a,props:o,_owner:_.current}}function w(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var k=/\/+/g;function S(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,n,i,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case o:l=!0}}if(l)return s=s(l=e),e=""===i?"."+S(l,0):i,Array.isArray(s)?(n="",null!=e&&(n=e.replace(k,"$&/")+"/"),C(s,t,n,"",(function(e){return e}))):null!=s&&(w(s)&&(s=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,n+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(k,"$&/")+"/")+e)),t.push(s)),1;if(l=0,i=""===i?".":i+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=i+S(a=e[c],c);l+=C(a,t,n,u,s)}else if("function"==typeof(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(a=e.next()).done;)l+=C(a=a.value,t,n,u=i+S(a,c++),s);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,n){if(null==e)return e;var i=[],r=0;return C(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function I(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var O={current:null};function N(){var e=O.current;if(null===e)throw Error(p(321));return e}var R={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:_,IsSomeRendererActing:{current:!1},assign:i};n.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error(p(143));return e}},n.Component=m,n.PureComponent=y,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,n.cloneElement=function(e,t,n){if(null==e)throw Error(p(267,e));var o=i({},e.props),s=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=_.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)E.call(t,u)&&!T.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];o.children=c}return{$$typeof:r,type:e.type,key:s,ref:a,props:o,_owner:l}},n.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},n.createElement=x,n.createFactory=function(e){var t=x.bind(null,e);return t.type=e,t},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:l,render:e}},n.isValidElement=w,n.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:I}},n.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},n.useCallback=function(e,t){return N().useCallback(e,t)},n.useContext=function(e,t){return N().useContext(e,t)},n.useDebugValue=function(){},n.useEffect=function(e,t){return N().useEffect(e,t)},n.useImperativeHandle=function(e,t,n){return N().useImperativeHandle(e,t,n)},n.useLayoutEffect=function(e,t){return N().useLayoutEffect(e,t)},n.useMemo=function(e,t){return N().useMemo(e,t)},n.useReducer=function(e,t,n){return N().useReducer(e,t,n)},n.useRef=function(e){return N().useRef(e)},n.useState=function(e){return N().useState(e)},n.version="17.0.2"},{"object-assign":465}],548:[function(e,t,n){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":547}],549:[function(e,t,n){"use strict";t.exports=e("./cjs/react-jsx-runtime.production.min.js")},{"./cjs/react-jsx-runtime.production.min.js":546}],550:[function(e,t,n){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":551}],551:[function(e,t,n){"use strict";var i=e("process-nextick-args"),r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=d;var o=Object.create(e("core-util-is"));o.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");o.inherits(d,s);for(var l=r(a.prototype),c=0;c<l.length;c++){var u=l[c];d.prototype[u]||(d.prototype[u]=a.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||i.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},{"./_stream_readable":553,"./_stream_writable":555,"core-util-is":385,inherits:423,"process-nextick-args":484}],552:[function(e,t,n){"use strict";t.exports=o;var i=e("./_stream_transform"),r=Object.create(e("core-util-is"));function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}r.inherits=e("inherits"),r.inherits(o,i),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":554,"core-util-is":385,inherits:423}],553:[function(e,t,n){(function(n,i){(function(){"use strict";var r=e("process-nextick-args");t.exports=v;var o,s=e("isarray");v.ReadableState=y;e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},l=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=(void 0!==i?i:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var d=Object.create(e("core-util-is"));d.inherits=e("inherits");var h=e("util"),p=void 0;p=h&&h.debuglog?h.debuglog("stream"):function(){};var f,g=e("./internal/streams/BufferList"),m=e("./internal/streams/destroy");d.inherits(v,l);var b=["error","close","destroy","pause","resume"];function y(t,n){t=t||{};var i=n instanceof(o=o||e("./_stream_duplex"));this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function v(t){if(o=o||e("./_stream_duplex"),!(this instanceof v))return new v(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function _(e,t,n,i,r){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,w(e)}}(e,s)):(r||(o=function(e,t){var n;return function(e){return c.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),i?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):E(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?E(e,s,t,!1):S(e,s)):E(e,s,t,!1))):i||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function E(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&w(e)),S(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=c.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},v.prototype.unshift=function(e){return _(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var T=8388608;function x(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=T?e=T:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function w(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(k,e):k(e))}function k(e){p("emit readable"),e.emit("readable"),O(e)}function S(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function A(e){p("readable nexttick read 0"),e.read(0)}function I(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;for(e-=r.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?r+=o:r+=o.slice(0,e),0==(e-=s)){s===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=c.allocUnsafe(e),i=t.head,r=1;for(i.data.copy(n),e-=i.data.length;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(s));break}++r}return t.length-=r,n}(e,t),i}(e,t.buffer,t.decoder),n);var n}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function L(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):w(this),null;if(0===(e=x(e,t))&&t.ended)return 0===t.length&&R(this),null;var i,r=t.needReadable;return p("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",r=!0),t.ended||t.reading?p("reading or ended",r=!1):r&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=x(n,t))),null===(i=e>0?N(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&R(this)),null!==i&&this.emit("data",i),i},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var i=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,p("pipe count=%d opts=%j",o.pipesCount,t);var l=t&&!1===t.end||e===n.stdout||e===n.stderr?y:c;function c(){p("onend"),e.end()}o.endEmitted?r.nextTick(l):i.once("end",l),e.on("unpipe",(function t(n,r){p("onunpipe"),n===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,p("cleanup"),e.removeListener("close",m),e.removeListener("finish",b),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),i.removeListener("end",c),i.removeListener("end",y),i.removeListener("data",f),d=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}));var u=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,O(e))}}(i);e.on("drain",u);var d=!1,h=!1;function f(t){p("ondata"),h=!1,!1!==e.write(t)||h||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==L(o.pipes,e))&&!d&&(p("false write response, pause",o.awaitDrain),o.awaitDrain++,h=!0),i.pause())}function g(t){p("onerror",t),y(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",b),y()}function b(){p("onfinish"),e.removeListener("close",m),y()}function y(){p("unpipe"),i.unpipe(e)}return i.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",m),e.once("finish",b),e.emit("pipe",i),o.flowing||(p("pipe resume"),i.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=L(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},v.prototype.on=function(e,t){var n=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&w(this):r.nextTick(A,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(I,e,t))}(this,e)),this},v.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(p("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){p("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<b.length;o++)e.on(b[o],this.emit.bind(this,b[o]));return this._read=function(t){p("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=N}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":551,"./internal/streams/BufferList":556,"./internal/streams/destroy":557,"./internal/streams/stream":558,_process:485,"core-util-is":385,events:408,inherits:423,isarray:425,"process-nextick-args":484,"safe-buffer":559,"string_decoder/":560,util:380}],554:[function(e,t,n){"use strict";t.exports=s;var i=e("./_stream_duplex"),r=Object.create(e("core-util-is"));function o(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);i.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){l(e,t,n)})):l(this,null,null)}function l(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=e("inherits"),r.inherits(s,i),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},{"./_stream_duplex":551,"core-util-is":385,inherits:423}],555:[function(e,t,n){(function(n,i,r){(function(){"use strict";var o=e("process-nextick-args");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;for(e.entry=null;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}t.exports=y;var a,l=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?r:o.nextTick;y.WritableState=b;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},d=e("./internal/streams/stream"),h=e("safe-buffer").Buffer,p=(void 0!==i?i:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var f,g=e("./internal/streams/destroy");function m(){}function b(t,n){a=a||e("./_stream_duplex"),t=t||{};var i=n instanceof a;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,c=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===t.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?(o.nextTick(r,i),o.nextTick(k,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(r(i),e._writableState.errorEmitted=!0,e.emit("error",i),k(e,t))}(e,n,i,t,r);else{var s=x(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||T(e,n),i?l(E,e,n,s,r):E(e,n,s,r)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function y(t){if(a=a||e("./_stream_duplex"),!(f.call(y,this)||this instanceof a))return new y(t);this._writableState=new b(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),d.call(this)}function v(e,t,n,i,r,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n)),t}(t,i,r);i!==s&&(n=!0,r="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,a,i,r,o);return l}function _(e,t,n,i,r,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function E(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),k(e,t)}function T(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var a=0,l=!0;n;)r[a]=n,n.isBuf||(l=!1),n=n.next,a+=1;r.allBuffers=l,_(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,d=n.callback;if(_(e,t,!1,t.objectMode?1:c.length,c,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),k(e,t)}))}function k(e,t){var n=x(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(w,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}c.inherits(y,d),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&e&&e._writableState instanceof b}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i=this._writableState,r=!1,s=!i.objectMode&&function(e){return h.isBuffer(e)||e instanceof p}(e);return s&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=m),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,i){var r=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(i,s),r=!1),r}(this,i,e,n))&&(i.pendingcb++,r=v(this,i,s,e,t,n)),r},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||T(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,k(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":551,"./internal/streams/destroy":557,"./internal/streams/stream":558,_process:485,"core-util-is":385,inherits:423,"process-nextick-args":484,"safe-buffer":559,timers:620,"util-deprecate":621}],556:[function(e,t,n){"use strict";var i=e("safe-buffer").Buffer,r=e("util");function o(e,t,n){e.copy(t,n)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)o(n.data,t,r),r+=n.data.length,n=n.next;return t},e}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":559,util:380}],557:[function(e,t,n){"use strict";var i=e("process-nextick-args");function r(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(r,this,e)):i.nextTick(r,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?n._writableState?n._writableState.errorEmitted||(n._writableState.errorEmitted=!0,i.nextTick(r,n,e)):i.nextTick(r,n,e):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":484}],558:[function(e,t,n){t.exports=e("events").EventEmitter},{events:408}],559:[function(e,t,n){var i=e("buffer"),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(o(i,n),n.Buffer=s),o(r,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},{buffer:381}],560:[function(e,t,n){"use strict";var i=e("safe-buffer").Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=s(t[i]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(e.lastNeed=r-2),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":559}],561:[function(e,t,n){t.exports=e("./readable").PassThrough},{"./readable":562}],562:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":551,"./lib/_stream_passthrough.js":552,"./lib/_stream_readable.js":553,"./lib/_stream_transform.js":554,"./lib/_stream_writable.js":555}],563:[function(e,t,n){t.exports=e("./readable").Transform},{"./readable":562}],564:[function(e,t,n){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":555}],565:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("@babel/runtime/helpers/objectSpread2");var r,o=(r=i)&&"object"==typeof r&&"default"in r?r:{default:r};function s(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var a="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},c={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function u(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function d(e,t,n){var i;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(s(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(s(1));return n(d)(e,t)}if("function"!=typeof e)throw new Error(s(2));var r=e,o=t,l=[],h=l,p=!1;function f(){h===l&&(h=l.slice())}function g(){if(p)throw new Error(s(3));return o}function m(e){if("function"!=typeof e)throw new Error(s(4));if(p)throw new Error(s(5));var t=!0;return f(),h.push(e),function(){if(t){if(p)throw new Error(s(6));t=!1,f();var n=h.indexOf(e);h.splice(n,1),l=null}}}function b(e){if(!u(e))throw new Error(s(7));if(void 0===e.type)throw new Error(s(8));if(p)throw new Error(s(9));try{p=!0,o=r(o,e)}finally{p=!1}for(var t=l=h,n=0;n<t.length;n++)(0,t[n])();return e}return b({type:c.INIT}),(i={dispatch:b,subscribe:m,getState:g,replaceReducer:function(e){if("function"!=typeof e)throw new Error(s(10));r=e,b({type:c.REPLACE})}})[a]=function(){var e,t=m;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(s(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[a]=function(){return this},e},i}var h=d;function p(e,t){return function(){return t(e.apply(this,arguments))}}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}n.__DO_NOT_USE__ActionTypes=c,n.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),i=function(){throw new Error(s(15))},r={getState:n.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=t.map((function(e){return e(r)}));return i=f.apply(void 0,a)(n.dispatch),o.default(o.default({},n),{},{dispatch:i})}}},n.bindActionCreators=function(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error(s(16));var n={};for(var i in e){var r=e[i];"function"==typeof r&&(n[i]=p(r,t))}return n},n.combineReducers=function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var r=t[i];"function"==typeof e[r]&&(n[r]=e[r])}var o,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:c.INIT}))throw new Error(s(12));if(void 0===n(void 0,{type:c.PROBE_UNKNOWN_ACTION()}))throw new Error(s(13))}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var i=!1,r={},l=0;l<a.length;l++){var c=a[l],u=n[c],d=e[c],h=u(d,t);if(void 0===h)throw t&&t.type,new Error(s(14));r[c]=h,i=i||h!==d}return(i=i||a.length!==Object.keys(e).length)?r:e}},n.compose=f,n.createStore=d,n.legacy_createStore=h},{"@babel/runtime/helpers/objectSpread2":359}],566:[function(e,t,n){t.exports=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],567:[function(e,t,n){var i=e("buffer"),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(o(i,n),n.Buffer=s),s.prototype=Object.create(r.prototype),o(r,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},{buffer:381}],568:[function(e,t,n){var i=e("htmlparser2"),r=e("xtend"),o=e("regexp-quote");function s(e,t){e&&Object.keys(e).forEach((function(n){t(e[n],n)}))}function a(e,t){return{}.hasOwnProperty.call(e,t)}function l(e,t,n){var u="";function d(e,t){var n=this;this.tag=e,this.attribs=t||{},this.tagPosition=u.length,this.text="",this.updateParentNodeText=function(){v.length&&(v[v.length-1].text+=n.text)}}t?(t=r(l.defaults,t)).parser?t.parser=r(c,t.parser):t.parser=c:(t=l.defaults).parser=c;var h,p,f=t.nonTextTags||["script","style","textarea"];t.allowedAttributes&&(h={},p={},s(t.allowedAttributes,(function(e,t){h[t]=[];var n=[];e.forEach((function(e){e.indexOf("*")>=0?n.push(o(e).replace(/\\\*/g,".*")):h[t].push(e)})),p[t]=new RegExp("^("+n.join("|")+")$")})));var g={};s(t.allowedClasses,(function(e,t){h&&(a(h,t)||(h[t]=[]),h[t].push("class")),g[t]=e}));var m,b={};s(t.transformTags,(function(e,t){var n;"function"==typeof e?n=e:"string"==typeof e&&(n=l.simpleTransform(e)),"*"===t?m=n:b[t]=n}));var y=0,v=[],_={},E={},T=!1,x=0,w=new i.Parser({onopentag:function(e,n){if(T)x++;else{var i=new d(e,n);v.push(i);var r,o=!1,l=!!i.text;a(b,e)&&(r=b[e](e,n),i.attribs=n=r.attribs,void 0!==r.text&&(i.innerText=r.text),e!==r.tagName&&(i.name=e=r.tagName,E[y]=r.tagName)),m&&(r=m(e,n),i.attribs=n=r.attribs,e!==r.tagName&&(i.name=e=r.tagName,E[y]=r.tagName)),t.allowedTags&&-1===t.allowedTags.indexOf(e)&&(o=!0,-1!==f.indexOf(e)&&(T=!0,x=1),_[y]=!0),y++,o||(u+="<"+e,(!h||a(h,e)||h["*"])&&s(n,(function(n,r){if(!h||a(h,e)&&-1!==h[e].indexOf(r)||h["*"]&&-1!==h["*"].indexOf(r)||a(p,e)&&p[e].test(r)||p["*"]&&p["*"].test(r)){if(("href"===r||"src"===r)&&function(e,n){var i=(n=(n=n.replace(/[\x00-\x20]+/g,"")).replace(/<\!\-\-.*?\-\-\>/g,"")).match(/^([a-zA-Z]+)\:/);if(!i)return!1;var r=i[1].toLowerCase();return a(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(r):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(r)}(e,n))return void delete i.attribs[r];if("class"===r&&!(n=function(e,t){return t?(e=e.split(/\s+/)).filter((function(e){return-1!==t.indexOf(e)})).join(" "):e}(n,g[e])).length)return void delete i.attribs[r];u+=" "+r,n.length&&(u+='="'+n+'"')}else delete i.attribs[r]})),-1!==t.selfClosing.indexOf(e)?u+=" />":(u+=">",!i.innerText||l||t.textFilter||(u+=i.innerText)))}},ontext:function(e){if(!T){var n,i=v[v.length-1];i&&(n=i.tag,e=void 0!==i.innerText?i.innerText:e),"script"===n||"style"===n?u+=e:t.textFilter?u+=t.textFilter(e):u+=e,v.length&&(v[v.length-1].text+=e)}},onclosetag:function(e){if(T){if(--x)return;T=!1}var n=v.pop();if(n){if(T=!1,_[--y])return delete _[y],void n.updateParentNodeText();E[y]&&(e=E[y],delete E[y]),t.exclusiveFilter&&t.exclusiveFilter(n)?u=u.substr(0,n.tagPosition):(n.updateParentNodeText(),-1===t.selfClosing.indexOf(e)&&(u+="</"+e+">"))}}},t.parser);return w.write(e),w.end(),u}t.exports=l;var c={decodeEntities:!0};l.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},l.simpleTransform=function(e,t,n){return n=void 0===n||n,t=t||{},function(i,r){var o;if(n)for(o in t)r[o]=t[o];else r=t;return{tagName:e,attribs:r}}}},{htmlparser2:603,"regexp-quote":566,xtend:632}],569:[function(e,t,n){t.exports={elementNames:{altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},attributeNames:{definitionurl:"definitionURL",attributename:"attributeName",attributetype:"attributeType",basefrequency:"baseFrequency",baseprofile:"baseProfile",calcmode:"calcMode",clippathunits:"clipPathUnits",diffuseconstant:"diffuseConstant",edgemode:"edgeMode",filterunits:"filterUnits",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",limitingconeangle:"limitingConeAngle",markerheight:"markerHeight",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textlength:"textLength",viewbox:"viewBox",viewtarget:"viewTarget",xchannelselector:"xChannelSelector",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan"}}},{}],570:[function(e,t,n){var i=e("domelementtype"),r=e("entities"),o=e("./foreignNames.json");o.elementNames.__proto__=null,o.attributeNames.__proto__=null;var s={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var a={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},l=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var n="",r=0;r<e.length;r++){var o=e[r];"root"===o.type?n+=l(o.children,t):i.isTag(o)?n+=u(o,t):o.type===i.Directive?n+=d(o):o.type===i.Comment?n+=f(o):o.type===i.CDATA?n+=p(o):n+=h(o,t)}return n},c=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"];function u(e,t){"foreign"===t.xmlMode&&(e.name=o.elementNames[e.name]||e.name,e.parent&&c.indexOf(e.parent.name)>=0&&(t=Object.assign({},t,{xmlMode:!1}))),!t.xmlMode&&["svg","math"].indexOf(e.name)>=0&&(t=Object.assign({},t,{xmlMode:"foreign"}));var n="<"+e.name,i=function(e,t){if(e){var n,i="";for(var s in e)n=e[s],i&&(i+=" "),"foreign"===t.xmlMode&&(s=o.attributeNames[s]||s),i+=s,(null!==n&&""!==n||t.xmlMode)&&(i+='="'+(t.decodeEntities?r.encodeXML(n):n.replace(/\"/g,"&quot;"))+'"');return i}}(e.attribs,t);return i&&(n+=" "+i),!t.xmlMode||e.children&&0!==e.children.length?(n+=">",e.children&&(n+=l(e.children,t)),a[e.name]&&!t.xmlMode||(n+="</"+e.name+">")):n+="/>",n}function d(e){return"<"+e.data+">"}function h(e,t){var n=e.data||"";return!t.decodeEntities||e.parent&&e.parent.name in s||(n=r.encodeXML(n)),n}function p(e){return"<![CDATA["+e.children[0].data+"]]>"}function f(e){return"\x3c!--"+e.data+"--\x3e"}},{"./foreignNames.json":569,domelementtype:571,entities:575}],571:[function(e,t,n){"use strict";var i,r;Object.defineProperty(n,"__esModule",{value:!0}),n.Doctype=n.CDATA=n.Tag=n.Style=n.Script=n.Comment=n.Directive=n.Text=n.Root=n.isTag=n.ElementType=void 0,(r=i=n.ElementType||(n.ElementType={})).Root="root",r.Text="text",r.Directive="directive",r.Comment="comment",r.Script="script",r.Style="style",r.Tag="tag",r.CDATA="cdata",r.Doctype="doctype",n.isTag=function(e){return e.type===i.Tag||e.type===i.Script||e.type===i.Style},n.Root=i.Root,n.Text=i.Text,n.Directive=i.Directive,n.Comment=i.Comment,n.Script=i.Script,n.Style=i.Style,n.Tag=i.Tag,n.CDATA=i.CDATA,n.Doctype=i.Doctype},{}],572:[function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.decodeHTML=n.decodeHTMLStrict=n.decodeXML=void 0;var r=i(e("./maps/entities.json")),o=i(e("./maps/legacy.json")),s=i(e("./maps/xml.json")),a=i(e("./decode_codepoint")),l=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function c(e){var t=d(e);return function(e){return String(e).replace(l,t)}}n.decodeXML=c(s.default),n.decodeHTMLStrict=c(r.default);var u=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var n=t.charAt(2);return"X"===n||"x"===n?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]||t}}n.decodeHTML=function(){for(var e=Object.keys(o.default).sort(u),t=Object.keys(r.default).sort(u),n=0,i=0;n<t.length;n++)e[i]===t[n]?(t[n]+=";?",i++):t[n]+=";";var s=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(r.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(s,l)}}()},{"./decode_codepoint":573,"./maps/entities.json":577,"./maps/legacy.json":578,"./maps/xml.json":579}],573:[function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var r=i(e("./maps/decode.json")),o=String.fromCodePoint||function(e){var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)};n.default=function(e){return e>=55296&&e<=57343||e>1114111?"":(e in r.default&&(e=r.default[e]),o(e))}},{"./maps/decode.json":576}],574:[function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.escapeUTF8=n.escape=n.encodeNonAsciiHTML=n.encodeHTML=n.encodeXML=void 0;var r=u(i(e("./maps/xml.json")).default),o=d(r);n.encodeXML=m(r);var s,a,l=u(i(e("./maps/entities.json")).default),c=d(l);function u(e){return Object.keys(e).sort().reduce((function(t,n){return t[e[n]]="&"+n+";",t}),{})}function d(e){for(var t=[],n=[],i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];1===o.length?t.push("\\"+o):n.push(o)}t.sort();for(var s=0;s<t.length-1;s++){for(var a=s;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-s;l<3||t.splice(s,l,t[s]+"-"+t[a])}return n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}n.encodeHTML=(s=l,a=c,function(e){return e.replace(a,(function(e){return s[e]})).replace(h,f)}),n.encodeNonAsciiHTML=m(l);var h=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,p=null!=String.prototype.codePointAt?function(e){return e.codePointAt(0)}:function(e){return 1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536};function f(e){return"&#x"+(e.length>1?p(e):e.charCodeAt(0)).toString(16).toUpperCase()+";"}var g=new RegExp(o.source+"|"+h.source,"g");function m(e){return function(t){return t.replace(g,(function(t){return e[t]||f(t)}))}}n.escape=function(e){return e.replace(g,f)},n.escapeUTF8=function(e){return e.replace(o,f)}},{"./maps/entities.json":577,"./maps/xml.json":579}],575:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.decodeXMLStrict=n.decodeHTML5Strict=n.decodeHTML4Strict=n.decodeHTML5=n.decodeHTML4=n.decodeHTMLStrict=n.decodeHTML=n.decodeXML=n.encodeHTML5=n.encodeHTML4=n.escapeUTF8=n.escape=n.encodeNonAsciiHTML=n.encodeHTML=n.encodeXML=n.encode=n.decodeStrict=n.decode=void 0;var i=e("./decode"),r=e("./encode");n.decode=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTML)(e)},n.decodeStrict=function(e,t){return(!t||t<=0?i.decodeXML:i.decodeHTMLStrict)(e)},n.encode=function(e,t){return(!t||t<=0?r.encodeXML:r.encodeHTML)(e)};var o=e("./encode");Object.defineProperty(n,"encodeXML",{enumerable:!0,get:function(){return o.encodeXML}}),Object.defineProperty(n,"encodeHTML",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(n,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return o.encodeNonAsciiHTML}}),Object.defineProperty(n,"escape",{enumerable:!0,get:function(){return o.escape}}),Object.defineProperty(n,"escapeUTF8",{enumerable:!0,get:function(){return o.escapeUTF8}}),Object.defineProperty(n,"encodeHTML4",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(n,"encodeHTML5",{enumerable:!0,get:function(){return o.encodeHTML}});var s=e("./decode");Object.defineProperty(n,"decodeXML",{enumerable:!0,get:function(){return s.decodeXML}}),Object.defineProperty(n,"decodeHTML",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTMLStrict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML4",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTML5",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(n,"decodeHTML4Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeHTML5Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(n,"decodeXMLStrict",{enumerable:!0,get:function(){return s.decodeXML}})},{"./decode":572,"./encode":574}],576:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],577:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],578:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],579:[function(e,t,n){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],580:[function(e,t,n){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],581:[function(e,t,n){var i=e("domelementtype"),r=/\s+/g,o=e("./lib/node"),s=e("./lib/element");function a(e,t,n){"object"==typeof e?(n=t,t=e,e=null):"function"==typeof t&&(n=t,t=l),this._callback=e,this._options=t||l,this._elementCB=n,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};a.prototype.onparserinit=function(e){this._parser=e},a.prototype.onreset=function(){a.call(this,this._callback,this._options,this._elementCB)},a.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},a.prototype._handleCallback=a.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.onclosetag=function(){var e=this._tagStack.pop();this._options.withEndIndices&&e&&(e.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(e)},a.prototype._createDomElement=function(e){if(!this._options.withDomLvl1)return e;var t;for(var n in t="tag"===e.type?Object.create(s):Object.create(o),e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},a.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],n=t?t.children:this.dom,i=n[n.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withEndIndices&&(e.endIndex=this._parser.endIndex),i?(e.prev=i,i.next=e):e.prev=null,n.push(e),e.parent=t||null},a.prototype.onopentag=function(e,t){var n={type:"script"===e?i.Script:"style"===e?i.Style:i.Tag,name:e,attribs:t,children:[]},r=this._createDomElement(n);this._addDomElement(r),this._tagStack.push(r)},a.prototype.ontext=function(e){var t,n=this._options.normalizeWhitespace||this._options.ignoreWhitespace;if(!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===i.Text)n?t.data=(t.data+e).replace(r," "):t.data+=e;else if(this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===i.Text)n?t.data=(t.data+e).replace(r," "):t.data+=e;else{n&&(e=e.replace(r," "));var o=this._createDomElement({data:e,type:i.Text});this._addDomElement(o)}},a.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===i.Comment)t.data+=e;else{var n={data:e,type:i.Comment},r=this._createDomElement(n);this._addDomElement(r),this._tagStack.push(r)}},a.prototype.oncdatastart=function(){var e={children:[{data:"",type:i.Text}],type:i.CDATA},t=this._createDomElement(e);this._addDomElement(t),this._tagStack.push(t)},a.prototype.oncommentend=a.prototype.oncdataend=function(){this._tagStack.pop()},a.prototype.onprocessinginstruction=function(e,t){var n=this._createDomElement({name:e,data:t,type:i.Directive});this._addDomElement(n)},t.exports=a},{"./lib/element":582,"./lib/node":583,domelementtype:580}],582:[function(e,t,n){var i=e("./node"),r=t.exports=Object.create(i),o={tagName:"name"};Object.keys(o).forEach((function(e){var t=o[e];Object.defineProperty(r,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{"./node":583}],583:[function(e,t,n){var i=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return o[this.type]||o.element}},r={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},o={element:1,text:3,cdata:4,comment:8};Object.keys(r).forEach((function(e){var t=r[e];Object.defineProperty(i,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{}],584:[function(e,t,n){var i=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach((function(e){Object.keys(e).forEach((function(t){i[t]=e[t].bind(i)}))}))},{"./lib/helpers":585,"./lib/legacy":586,"./lib/manipulation":587,"./lib/querying":588,"./lib/stringify":589,"./lib/traversal":590}],585:[function(e,t,n){n.removeSubsets=function(e){for(var t,n,i,r=e.length;--r>-1;){for(t=n=e[r],e[r]=null,i=!0;n;){if(e.indexOf(n)>-1){i=!1,e.splice(r,1);break}n=n.parent}i&&(e[r]=t)}return e};var i=1,r=2,o=4,s=8,a=16,l=n.compareDocumentPosition=function(e,t){var n,l,c,u,d,h,p=[],f=[];if(e===t)return 0;for(n=e;n;)p.unshift(n),n=n.parent;for(n=t;n;)f.unshift(n),n=n.parent;for(h=0;p[h]===f[h];)h++;return 0===h?i:(c=(l=p[h-1]).children,u=p[h],d=f[h],c.indexOf(u)>c.indexOf(d)?l===t?o|a:o:l===e?r|s:r)};n.uniqueSort=function(e){var t,n,i=e.length;for(e=e.slice();--i>-1;)t=e[i],(n=e.indexOf(t))>-1&&n<i&&e.splice(i,1);return e.sort((function(e,t){var n=l(e,t);return n&r?-1:n&o?1:0})),e}},{}],586:[function(e,t,n){var i=e("domelementtype"),r=n.isTag=i.isTag;n.testElement=function(e,t){for(var n in e)if(e.hasOwnProperty(n))if("tag_name"===n){if(!r(t)||!e.tag_name(t.name))return!1}else if("tag_type"===n){if(!e.tag_type(t.type))return!1}else if("tag_contains"===n){if(r(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[n](t.attribs[n]))return!1;return!0};var o={tag_name:function(e){return"function"==typeof e?function(t){return r(t)&&e(t.name)}:"*"===e?r:function(t){return r(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return!r(t)&&e(t.data)}:function(t){return!r(t)&&t.data===e}}};function s(e,t){return"function"==typeof t?function(n){return n.attribs&&t(n.attribs[e])}:function(n){return n.attribs&&n.attribs[e]===t}}function a(e,t){return function(n){return e(n)||t(n)}}n.getElements=function(e,t,n,i){var r=Object.keys(e).map((function(t){var n=e[t];return t in o?o[t](n):s(t,n)}));return 0===r.length?[]:this.filter(r.reduce(a),t,n,i)},n.getElementById=function(e,t,n){return Array.isArray(t)||(t=[t]),this.findOne(s("id",e),t,!1!==n)},n.getElementsByTagName=function(e,t,n,i){return this.filter(o.tag_name(e),t,n,i)},n.getElementsByTagType=function(e,t,n,i){return this.filter(o.tag_type(e),t,n,i)}},{domelementtype:580}],587:[function(e,t,n){n.removeElement=function(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}},n.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var i=t.next=e.next;i&&(i.prev=t);var r=t.parent=e.parent;if(r){var o=r.children;o[o.lastIndexOf(e)]=t}},n.appendChild=function(e,t){if(t.parent=e,1!==e.children.push(t)){var n=e.children[e.children.length-2];n.next=t,t.prev=n,t.next=null}},n.append=function(e,t){var n=e.parent,i=e.next;if(t.next=i,t.prev=e,e.next=t,t.parent=n,i){if(i.prev=t,n){var r=n.children;r.splice(r.lastIndexOf(i),0,t)}}else n&&n.children.push(t)},n.prepend=function(e,t){var n=e.parent;if(n){var i=n.children;i.splice(i.lastIndexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,t.next=e,e.prev=t}},{}],588:[function(e,t,n){var i=e("domelementtype").isTag;function r(e,t,n,i){for(var o,s=[],a=0,l=t.length;a<l&&!(e(t[a])&&(s.push(t[a]),--i<=0))&&(o=t[a].children,!(n&&o&&o.length>0&&(o=r(e,o,n,i),s=s.concat(o),(i-=o.length)<=0)));a++);return s}t.exports={filter:function(e,t,n,i){return Array.isArray(t)||(t=[t]),"number"==typeof i&&isFinite(i)||(i=1/0),r(e,t,!1!==n,i)},find:r,findOneChild:function(e,t){for(var n=0,i=t.length;n<i;n++)if(e(t[n]))return t[n];return null},findOne:function e(t,n){for(var r=null,o=0,s=n.length;o<s&&!r;o++)i(n[o])&&(t(n[o])?r=n[o]:n[o].children.length>0&&(r=e(t,n[o].children)));return r},existsOne:function e(t,n){for(var r=0,o=n.length;r<o;r++)if(i(n[r])&&(t(n[r])||n[r].children.length>0&&e(t,n[r].children)))return!0;return!1},findAll:function(e,t){for(var n=[],r=t.slice();r.length;){var o=r.shift();i(o)&&(o.children&&o.children.length>0&&r.unshift.apply(r,o.children),e(o)&&n.push(o))}return n}}},{domelementtype:580}],589:[function(e,t,n){var i=e("domelementtype"),r=e("dom-serializer"),o=i.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map((function(e){return r(e,t)})).join(""):""},getOuterHTML:r,getText:function e(t){return Array.isArray(t)?t.map(e).join(""):o(t)?"br"===t.name?"\n":e(t.children):t.type===i.CDATA?e(t.children):t.type===i.Text?t.data:""}}},{"dom-serializer":570,domelementtype:580}],590:[function(e,t,n){var i=n.getChildren=function(e){return e.children},r=n.getParent=function(e){return e.parent};n.getSiblings=function(e){var t=r(e);return t?i(t):[e]},n.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},n.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},n.getName=function(e){return e.name}},{}],591:[function(e,t,n){var i=e("../maps/decode.json");t.exports=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in i&&(e=i[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},{"../maps/decode.json":592}],592:[function(e,t,n){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],593:[function(e,t,n){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],594:[function(e,t,n){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],595:[function(e,t,n){arguments[4][579][0].apply(n,arguments)},{dup:579}],596:[function(e,t,n){function i(e){this._cbs=e||{},this.events=[]}t.exports=i;var r=e("./").EVENTS;Object.keys(r).forEach((function(e){if(0===r[e])e="on"+e,i.prototype[e]=function(){this.events.push([e]),this._cbs[e]&&this._cbs[e]()};else if(1===r[e])e="on"+e,i.prototype[e]=function(t){this.events.push([e,t]),this._cbs[e]&&this._cbs[e](t)};else{if(2!==r[e])throw Error("wrong number of arguments");e="on"+e,i.prototype[e]=function(t,n){this.events.push([e,t,n]),this._cbs[e]&&this._cbs[e](t,n)}}})),i.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},i.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e=0,t=this.events.length;e<t;e++)if(this._cbs[this.events[e][0]]){var n=this.events[e].length;1===n?this._cbs[this.events[e][0]]():2===n?this._cbs[this.events[e][0]](this.events[e][1]):this._cbs[this.events[e][0]](this.events[e][1],this.events[e][2])}}},{"./":603}],597:[function(e,t,n){var i=e("domhandler"),r=e("domutils");function o(e,t){this.init(e,t)}function s(e,t){return r.getElementsByTagName(e,t,!0)}function a(e,t){return r.getElementsByTagName(e,t,!0,1)[0]}function l(e,t,n){return r.getText(r.getElementsByTagName(e,t,n,1)).trim()}function c(e,t,n,i,r){var o=l(n,i,r);o&&(e[t]=o)}e("inherits")(o,i),o.prototype.init=i;var u=function(e){return"rss"===e||"feed"===e||"rdf:RDF"===e};o.prototype.onend=function(){var e,t,n={},r=a(u,this.dom);r&&("feed"===r.name?(t=r.children,n.type="atom",c(n,"id","id",t),c(n,"title","title",t),(e=a("link",t))&&(e=e.attribs)&&(e=e.href)&&(n.link=e),c(n,"description","subtitle",t),(e=l("updated",t))&&(n.updated=new Date(e)),c(n,"author","email",t,!0),n.items=s("entry",t).map((function(e){var t,n={};return c(n,"id","id",e=e.children),c(n,"title","title",e),(t=a("link",e))&&(t=t.attribs)&&(t=t.href)&&(n.link=t),(t=l("summary",e)||l("content",e))&&(n.description=t),(t=l("updated",e))&&(n.pubDate=new Date(t)),n}))):(t=a("channel",r.children).children,n.type=r.name.substr(0,3),n.id="",c(n,"title","title",t),c(n,"link","link",t),c(n,"description","description",t),(e=l("lastBuildDate",t))&&(n.updated=new Date(e)),c(n,"author","managingEditor",t,!0),n.items=s("item",r.children).map((function(e){var t,n={};return c(n,"id","guid",e=e.children),c(n,"title","title",e),c(n,"link","link",e),c(n,"description","description",e),(t=l("pubDate",e))&&(n.pubDate=new Date(t)),n})))),this.dom=n,i.prototype._handleCallback.call(this,r?null:Error("couldn't find root of feed"))},t.exports=o},{domhandler:581,domutils:584,inherits:423}],598:[function(e,t,n){var i=e("./Tokenizer.js"),r={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},o={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:r,input:r,output:r,button:r,datalist:r,textarea:r,option:{option:!0},optgroup:{optgroup:!0}},s={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},a={__proto__:null,math:!0,svg:!0},l={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function u(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(i=this._options.Tokenizer),this._tokenizer=new i(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(u,e("events").EventEmitter),u.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},u.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},u.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in o)for(var t;(t=this._stack[this._stack.length-1])in o[e];this.onclosetag(t));!this._options.xmlMode&&e in s||(this._stack.push(e),e in a?this._foreignContext.push(!0):e in l&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},u.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in s&&this._cbs.onclosetag(this._tagname),this._tagname=""},u.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),(e in a||e in l)&&this._foreignContext.pop(),!this._stack.length||e in s&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},u.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},u.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},u.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},u.prototype.onattribdata=function(e){this._attribvalue+=e},u.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},u.prototype._getInstructionName=function(e){var t=e.search(c),n=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(n=n.toLowerCase()),n},u.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},u.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},u.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},u.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},u.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},u.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},u.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},u.prototype.parseComplete=function(e){this.reset(),this.end(e)},u.prototype.write=function(e){this._tokenizer.write(e)},u.prototype.end=function(e){this._tokenizer.end(e)},u.prototype.pause=function(){this._tokenizer.pause()},u.prototype.resume=function(){this._tokenizer.resume()},u.prototype.parseChunk=u.prototype.write,u.prototype.done=u.prototype.end,t.exports=u},{"./Tokenizer.js":601,events:408,inherits:423}],599:[function(e,t,n){function i(e){this._cbs=e||{}}t.exports=i;var r=e("./").EVENTS;Object.keys(r).forEach((function(e){if(0===r[e])e="on"+e,i.prototype[e]=function(){this._cbs[e]&&this._cbs[e]()};else if(1===r[e])e="on"+e,i.prototype[e]=function(t){this._cbs[e]&&this._cbs[e](t)};else{if(2!==r[e])throw Error("wrong number of arguments");e="on"+e,i.prototype[e]=function(t,n){this._cbs[e]&&this._cbs[e](t,n)}}}))},{"./":603}],600:[function(e,t,n){t.exports=r;var i=e("./WritableStream.js");function r(e){i.call(this,new o(this),e)}function o(e){this.scope=e}e("inherits")(r,i),r.prototype.readable=!0;var s=e("../").EVENTS;Object.keys(s).forEach((function(e){if(0===s[e])o.prototype["on"+e]=function(){this.scope.emit(e)};else if(1===s[e])o.prototype["on"+e]=function(t){this.scope.emit(e,t)};else{if(2!==s[e])throw Error("wrong number of arguments!");o.prototype["on"+e]=function(t,n){this.scope.emit(e,t,n)}}}))},{"../":603,"./WritableStream.js":602,inherits:423}],601:[function(e,t,n){t.exports=me;var i=e("entities/lib/decode_codepoint.js"),r=e("entities/maps/entities.json"),o=e("entities/maps/legacy.json"),s=e("entities/maps/xml.json"),a=0,l=a++,c=a++,u=a++,d=a++,h=a++,p=a++,f=a++,g=a++,m=a++,b=a++,y=a++,v=a++,_=a++,E=a++,T=a++,x=a++,w=a++,k=a++,S=a++,C=a++,A=a++,I=a++,O=a++,N=a++,R=a++,D=a++,L=a++,M=a++,P=a++,B=a++,j=a++,F=a++,$=a++,U=a++,H=a++,G=a++,V=a++,W=a++,z=a++,q=a++,Y=a++,K=a++,Z=a++,X=a++,J=a++,Q=a++,ee=a++,te=a++,ne=a++,ie=a++,re=a++,oe=a++,se=a++,ae=a++,le=a++,ce=0,ue=ce++,de=ce++,he=ce++;function pe(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function fe(e,t,n){var i=e.toLowerCase();return e===i?function(e){e===i?this._state=t:(this._state=n,this._index--)}:function(r){r===i||r===e?this._state=t:(this._state=n,this._index--)}}function ge(e,t){var n=e.toLowerCase();return function(i){i===n||i===e?this._state=t:(this._state=u,this._index--)}}function me(e,t){this._state=l,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=l,this._special=ue,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}me.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=c,this._sectionStart=this._index):this._decodeEntities&&this._special===ue&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=l,this._state=re,this._sectionStart=this._index)},me.prototype._stateBeforeTagName=function(e){"/"===e?this._state=h:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==ue||pe(e)?this._state=l:"!"===e?(this._state=T,this._sectionStart=this._index+1):"?"===e?(this._state=w,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?u:j,this._sectionStart=this._index)},me.prototype._stateInTagName=function(e){("/"===e||">"===e||pe(e))&&(this._emitToken("onopentagname"),this._state=g,this._index--)},me.prototype._stateBeforeCloseingTagName=function(e){pe(e)||(">"===e?this._state=l:this._special!==ue?"s"===e||"S"===e?this._state=F:(this._state=l,this._index--):(this._state=p,this._sectionStart=this._index))},me.prototype._stateInCloseingTagName=function(e){(">"===e||pe(e))&&(this._emitToken("onclosetag"),this._state=f,this._index--)},me.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=l,this._sectionStart=this._index+1)},me.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=l,this._sectionStart=this._index+1):"/"===e?this._state=d:pe(e)||(this._state=m,this._sectionStart=this._index)},me.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=l,this._sectionStart=this._index+1):pe(e)||(this._state=g,this._index--)},me.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||pe(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=b,this._index--)},me.prototype._stateAfterAttributeName=function(e){"="===e?this._state=y:"/"===e||">"===e?(this._cbs.onattribend(),this._state=g,this._index--):pe(e)||(this._cbs.onattribend(),this._state=m,this._sectionStart=this._index)},me.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=v,this._sectionStart=this._index+1):"'"===e?(this._state=_,this._sectionStart=this._index+1):pe(e)||(this._state=E,this._sectionStart=this._index,this._index--)},me.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},me.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},me.prototype._stateInAttributeValueNoQuotes=function(e){pe(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=g,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},me.prototype._stateBeforeDeclaration=function(e){this._state="["===e?I:"-"===e?k:x},me.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=l,this._sectionStart=this._index+1)},me.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=l,this._sectionStart=this._index+1)},me.prototype._stateBeforeComment=function(e){"-"===e?(this._state=S,this._sectionStart=this._index+1):this._state=x},me.prototype._stateInComment=function(e){"-"===e&&(this._state=C)},me.prototype._stateAfterComment1=function(e){this._state="-"===e?A:S},me.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"-"!==e&&(this._state=S)},me.prototype._stateBeforeCdata1=fe("C",O,x),me.prototype._stateBeforeCdata2=fe("D",N,x),me.prototype._stateBeforeCdata3=fe("A",R,x),me.prototype._stateBeforeCdata4=fe("T",D,x),me.prototype._stateBeforeCdata5=fe("A",L,x),me.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=M,this._sectionStart=this._index+1):(this._state=x,this._index--)},me.prototype._stateInCdata=function(e){"]"===e&&(this._state=P)},me.prototype._stateAfterCdata1=function(e){this._state="]"===e?B:M},me.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"]"!==e&&(this._state=M)},me.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=$:"t"===e||"T"===e?this._state=Z:(this._state=u,this._index--)},me.prototype._stateBeforeSpecialEnd=function(e){this._special!==de||"c"!==e&&"C"!==e?this._special!==he||"t"!==e&&"T"!==e?this._state=l:this._state=ee:this._state=W},me.prototype._stateBeforeScript1=ge("R",U),me.prototype._stateBeforeScript2=ge("I",H),me.prototype._stateBeforeScript3=ge("P",G),me.prototype._stateBeforeScript4=ge("T",V),me.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||pe(e))&&(this._special=de),this._state=u,this._index--},me.prototype._stateAfterScript1=fe("R",z,l),me.prototype._stateAfterScript2=fe("I",q,l),me.prototype._stateAfterScript3=fe("P",Y,l),me.prototype._stateAfterScript4=fe("T",K,l),me.prototype._stateAfterScript5=function(e){">"===e||pe(e)?(this._special=ue,this._state=p,this._sectionStart=this._index-6,this._index--):this._state=l},me.prototype._stateBeforeStyle1=ge("Y",X),me.prototype._stateBeforeStyle2=ge("L",J),me.prototype._stateBeforeStyle3=ge("E",Q),me.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||pe(e))&&(this._special=he),this._state=u,this._index--},me.prototype._stateAfterStyle1=fe("Y",te,l),me.prototype._stateAfterStyle2=fe("L",ne,l),me.prototype._stateAfterStyle3=fe("E",ie,l),me.prototype._stateAfterStyle4=function(e){">"===e||pe(e)?(this._special=ue,this._state=p,this._sectionStart=this._index-5,this._index--):this._state=l},me.prototype._stateBeforeEntity=fe("#",oe,se),me.prototype._stateBeforeNumericEntity=fe("X",le,ae),me.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?s:r;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},me.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var n=this._buffer.substr(e,t);if(o.hasOwnProperty(n))return this._emitPartial(o[n]),void(this._sectionStart+=t+1);t--}},me.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==l?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},me.prototype._decodeNumericEntity=function(e,t){var n=this._sectionStart+e;if(n!==this._index){var r=this._buffer.substring(n,this._index),o=parseInt(r,t);this._emitPartial(i(o)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},me.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},me.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},me.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===l?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},me.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},me.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===l?this._stateText(e):this._state===c?this._stateBeforeTagName(e):this._state===u?this._stateInTagName(e):this._state===h?this._stateBeforeCloseingTagName(e):this._state===p?this._stateInCloseingTagName(e):this._state===f?this._stateAfterCloseingTagName(e):this._state===d?this._stateInSelfClosingTag(e):this._state===g?this._stateBeforeAttributeName(e):this._state===m?this._stateInAttributeName(e):this._state===b?this._stateAfterAttributeName(e):this._state===y?this._stateBeforeAttributeValue(e):this._state===v?this._stateInAttributeValueDoubleQuotes(e):this._state===_?this._stateInAttributeValueSingleQuotes(e):this._state===E?this._stateInAttributeValueNoQuotes(e):this._state===T?this._stateBeforeDeclaration(e):this._state===x?this._stateInDeclaration(e):this._state===w?this._stateInProcessingInstruction(e):this._state===k?this._stateBeforeComment(e):this._state===S?this._stateInComment(e):this._state===C?this._stateAfterComment1(e):this._state===A?this._stateAfterComment2(e):this._state===I?this._stateBeforeCdata1(e):this._state===O?this._stateBeforeCdata2(e):this._state===N?this._stateBeforeCdata3(e):this._state===R?this._stateBeforeCdata4(e):this._state===D?this._stateBeforeCdata5(e):this._state===L?this._stateBeforeCdata6(e):this._state===M?this._stateInCdata(e):this._state===P?this._stateAfterCdata1(e):this._state===B?this._stateAfterCdata2(e):this._state===j?this._stateBeforeSpecial(e):this._state===F?this._stateBeforeSpecialEnd(e):this._state===$?this._stateBeforeScript1(e):this._state===U?this._stateBeforeScript2(e):this._state===H?this._stateBeforeScript3(e):this._state===G?this._stateBeforeScript4(e):this._state===V?this._stateBeforeScript5(e):this._state===W?this._stateAfterScript1(e):this._state===z?this._stateAfterScript2(e):this._state===q?this._stateAfterScript3(e):this._state===Y?this._stateAfterScript4(e):this._state===K?this._stateAfterScript5(e):this._state===Z?this._stateBeforeStyle1(e):this._state===X?this._stateBeforeStyle2(e):this._state===J?this._stateBeforeStyle3(e):this._state===Q?this._stateBeforeStyle4(e):this._state===ee?this._stateAfterStyle1(e):this._state===te?this._stateAfterStyle2(e):this._state===ne?this._stateAfterStyle3(e):this._state===ie?this._stateAfterStyle4(e):this._state===re?this._stateBeforeEntity(e):this._state===oe?this._stateBeforeNumericEntity(e):this._state===se?this._stateInNamedEntity(e):this._state===ae?this._stateInNumericEntity(e):this._state===le?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},me.prototype.pause=function(){this._running=!1},me.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},me.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},me.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},me.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===M||this._state===P||this._state===B?this._cbs.oncdata(e):this._state===S||this._state===C||this._state===A?this._cbs.oncomment(e):this._state!==se||this._xmlMode?this._state!==ae||this._xmlMode?this._state!==le||this._xmlMode?this._state!==u&&this._state!==g&&this._state!==y&&this._state!==b&&this._state!==m&&this._state!==_&&this._state!==v&&this._state!==E&&this._state!==p&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},me.prototype.reset=function(){me.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},me.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},me.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},me.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},me.prototype._emitPartial=function(e){this._baseState!==l?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":591,"entities/maps/entities.json":593,"entities/maps/legacy.json":594,"entities/maps/xml.json":595}],602:[function(e,t,n){t.exports=a;var i=e("./Parser.js"),r=e("readable-stream").Writable,o=e("string_decoder").StringDecoder,s=e("buffer").Buffer;function a(e,t){var n=this._parser=new i(e,t),s=this._decoder=new o;r.call(this,{decodeStrings:!1}),this.once("finish",(function(){n.end(s.end())}))}e("inherits")(a,r),a.prototype._write=function(e,t,n){e instanceof s&&(e=this._decoder.write(e)),this._parser.write(e),n()}},{"./Parser.js":598,buffer:381,inherits:423,"readable-stream":380,string_decoder:610}],603:[function(e,t,n){var i=e("./Parser.js"),r=e("domhandler");function o(e,n){return delete t.exports[e],t.exports[e]=n,n}t.exports={Parser:i,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:r,get FeedHandler(){return o("FeedHandler",e("./FeedHandler.js"))},get Stream(){return o("Stream",e("./Stream.js"))},get WritableStream(){return o("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return o("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return o("DomUtils",e("domutils"))},get CollectingHandler(){return o("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:r,get RssHandler(){return o("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var n=new r(t);return new i(n,t).end(e),n.dom},parseFeed:function(e,n){var r=new t.exports.FeedHandler(n);return new i(r,n).end(e),r.dom},createDomStream:function(e,t,n){var o=new r(e,t,n);return new i(o,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":596,"./FeedHandler.js":597,"./Parser.js":598,"./ProxyHandler.js":599,"./Stream.js":600,"./Tokenizer.js":601,"./WritableStream.js":602,domelementtype:580,domhandler:581,domutils:584}],604:[function(e,t,n){"use strict";var i,r,o,s;if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,d=null,h=function(){if(null!==u)try{var e=n.unstable_now();u(!0,e),u=null}catch(e){throw setTimeout(h,0),e}};i=function(e){null!==u?setTimeout(i,0,e):(u=e,setTimeout(h,0))},r=function(e,t){d=setTimeout(e,t)},o=function(){clearTimeout(d)},n.unstable_shouldYield=function(){return!1},s=n.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,f=window.clearTimeout;if("undefined"!=typeof console){var g=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof g&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var m=!1,b=null,y=-1,v=5,_=0;n.unstable_shouldYield=function(){return n.unstable_now()>=_},s=function(){},n.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<e?Math.floor(1e3/e):5};var E=new MessageChannel,T=E.port2;E.port1.onmessage=function(){if(null!==b){var e=n.unstable_now();_=e+v;try{b(!0,e)?T.postMessage(null):(m=!1,b=null)}catch(e){throw T.postMessage(null),e}}else m=!1},i=function(e){b=e,m||(m=!0,T.postMessage(null))},r=function(e,t){y=p((function(){e(n.unstable_now())}),t)},o=function(){f(y),y=-1}}function x(e,t){var n=e.length;e.push(t);e:for(;;){var i=n-1>>>1,r=e[i];if(!(void 0!==r&&0<S(r,t)))break e;e[i]=t,e[n]=r,n=i}}function w(e){return void 0===(e=e[0])?null:e}function k(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length;i<r;){var o=2*(i+1)-1,s=e[o],a=o+1,l=e[a];if(void 0!==s&&0>S(s,n))void 0!==l&&0>S(l,s)?(e[i]=l,e[a]=n,i=a):(e[i]=s,e[o]=n,i=o);else{if(!(void 0!==l&&0>S(l,n)))break e;e[i]=l,e[a]=n,i=a}}}return t}return null}function S(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var C=[],A=[],I=1,O=null,N=3,R=!1,D=!1,L=!1;function M(e){for(var t=w(A);null!==t;){if(null===t.callback)k(A);else{if(!(t.startTime<=e))break;k(A),t.sortIndex=t.expirationTime,x(C,t)}t=w(A)}}function P(e){if(L=!1,M(e),!D)if(null!==w(C))D=!0,i(B);else{var t=w(A);null!==t&&r(P,t.startTime-e)}}function B(e,t){D=!1,L&&(L=!1,o()),R=!0;var i=N;try{for(M(t),O=w(C);null!==O&&(!(O.expirationTime>t)||e&&!n.unstable_shouldYield());){var s=O.callback;if("function"==typeof s){O.callback=null,N=O.priorityLevel;var a=s(O.expirationTime<=t);t=n.unstable_now(),"function"==typeof a?O.callback=a:O===w(C)&&k(C),M(t)}else k(C);O=w(C)}if(null!==O)var l=!0;else{var c=w(A);null!==c&&r(P,c.startTime-t),l=!1}return l}finally{O=null,N=i,R=!1}}var j=s;n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(e){e.callback=null},n.unstable_continueExecution=function(){D||R||(D=!0,i(B))},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return w(C)},n.unstable_next=function(e){switch(N){case 1:case 2:case 3:var t=3;break;default:t=N}var n=N;N=t;try{return e()}finally{N=n}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=j,n.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=N;N=e;try{return t()}finally{N=n}},n.unstable_scheduleCallback=function(e,t,s){var a=n.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:I++,callback:t,priorityLevel:e,startTime:s,expirationTime:l=s+l,sortIndex:-1},s>a?(e.sortIndex=s,x(A,e),null===w(C)&&e===w(A)&&(L?o():L=!0,r(P,s-a))):(e.sortIndex=l,x(C,e),D||R||(D=!0,i(B))),e},n.unstable_wrapCallback=function(e){var t=N;return function(){var n=N;N=t;try{return e.apply(this,arguments)}finally{N=n}}}},{}],605:[function(e,t,n){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":604}],606:[function(e,t,n){"use strict";var i=e("get-intrinsic"),r=e("define-data-property"),o=e("has-property-descriptors")(),s=e("gopd"),a=e("es-errors/type"),l=i("%Math.floor%");t.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||l(t)!==t)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,c=!0;if("length"in e&&s){var u=s(e,"length");u&&!u.configurable&&(i=!1),u&&!u.writable&&(c=!1)}return(i||c||!n)&&(o?r(e,"length",t,!0,!0):r(e,"length",t)),e}},{"define-data-property":395,"es-errors/type":406,"get-intrinsic":413,gopd:414,"has-property-descriptors":415}],607:[function(e,t,n){!function(e){Date.now=Date.now||function(){return(new Date).getTime()};var t={extend:function(){arguments[0]=arguments[0]||{};for(var e=1;e<arguments.length;e++)for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&("object"==typeof arguments[e][n]?arguments[e][n]instanceof Array?arguments[0][n]=arguments[e][n]:arguments[0][n]=t.extend(arguments[0][n],arguments[e][n]):arguments[0][n]=arguments[e][n]);return arguments[0]},binarySearch:function(e,t){for(var n=0,i=e.length;n<i;){var r=n+i>>1;t<e[r][0]?i=r:n=r+1}return n}};function n(e){this.options=t.extend({},n.defaultOptions,e),this.disabled=!1,this.clear()}function i(e){this.options=t.extend({},i.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}n.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},n.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var t=this.data[e][1];t>this.maxValue&&(this.maxValue=t),t<this.minValue&&(this.minValue=t)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.append=function(e,t,n){for(var i=this.data.length-1;i>=0&&this.data[i][0]>e;)i--;-1===i?this.data.splice(0,0,[e,t]):this.data.length>0&&this.data[i][0]===e?n?(this.data[i][1]+=t,t=this.data[i][1]):this.data[i][1]=t:i<this.data.length-1?this.data.splice(i+1,0,[e,t]):this.data.push([e,t]),this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},n.prototype.dropOldData=function(e,t){for(var n=0;this.data.length-n>=t&&this.data[n+1][0]<e;)n++;0!==n&&this.data.splice(0,n)},i.tooltipFormatter=function(e,t){for(var n=[(this.options.timestampFormatter||i.timeFormatter)(new Date(e))],r=0;r<t.length;++r)n.push('<span style="color:'+t[r].series.options.strokeStyle+'">'+this.options.yMaxFormatter(t[r].value,this.options.labels.precision)+"</span>");return n.join("<br>")},i.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},yIntermediateFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:i.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},i.AnimateCompatibility={requestAnimationFrame:function(e,t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout((function(){e(Date.now())}),16)}).call(window,e,t)},cancelAnimationFrame:function(e){return(window.cancelAnimationFrame||function(e){clearTimeout(e)}).call(window,e)}},i.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},i.prototype.addTimeSeries=function(e,n){this.seriesSet.push({timeSeries:e,options:t.extend({},i.defaultSeriesPresentationOptions,n)}),e.options.resetBounds&&e.options.resetBoundsInterval>0&&(e.resetBoundsTimerId=setInterval((function(){e.resetBounds()}),e.options.resetBoundsInterval))},i.prototype.removeTimeSeries=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e){this.seriesSet.splice(n,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},i.prototype.getTimeSeriesOptions=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e)return this.seriesSet[n].options},i.prototype.bringToFront=function(e){for(var t=this.seriesSet.length,n=0;n<t;n++)if(this.seriesSet[n].timeSeries===e){var i=this.seriesSet.splice(n,1);this.seriesSet.push(i[0]);break}},i.prototype.streamTo=function(e,t){this.canvas=e,this.delay=t,this.start()},i.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},i.prototype.updateTooltip=function(){var e=this.getTooltipEl();if(this.mouseover&&this.options.tooltip){for(var n=this.lastChartTimestamp,i=this.options.scrollBackwards?n-this.mouseX*this.options.millisPerPixel:n-(this.canvas.offsetWidth-this.mouseX)*this.options.millisPerPixel,r=[],o=0;o<this.seriesSet.length;o++){var s=this.seriesSet[o].timeSeries;if(!s.disabled){var a=t.binarySearch(s.data,i);a>0&&a<s.data.length&&r.push({series:this.seriesSet[o],index:a,value:s.data[a][1]})}}r.length?(e.innerHTML=this.options.tooltipFormatter.call(this,i,r),e.style.display="block"):e.style.display="none"}else e.style.display="none"},i.prototype.mousemove=function(e){this.mouseover=!0,this.mouseX=e.offsetX,this.mouseY=e.offsetY,this.mousePageX=e.pageX,this.mousePageY=e.pageY;var t=this.getTooltipEl();t.style.top=Math.round(this.mousePageY)+"px",t.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()},i.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},i.prototype.resize=function(){var e,t,n=this.options.enableDpiScaling&&window?window.devicePixelRatio:1;this.options.responsive?(e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,e!==this.lastWidth&&(this.lastWidth=e,this.canvas.setAttribute("width",Math.floor(e*n).toString()),this.canvas.getContext("2d").scale(n,n)),t!==this.lastHeight&&(this.lastHeight=t,this.canvas.setAttribute("height",Math.floor(t*n).toString()),this.canvas.getContext("2d").scale(n,n))):1!==n&&(e=parseInt(this.canvas.getAttribute("width")),t=parseInt(this.canvas.getAttribute("height")),this.originalWidth&&Math.floor(this.originalWidth*n)===e||(this.originalWidth=e,this.canvas.setAttribute("width",Math.floor(e*n).toString()),this.canvas.style.width=e+"px",this.canvas.getContext("2d").scale(n,n)),this.originalHeight&&Math.floor(this.originalHeight*n)===t||(this.originalHeight=t,this.canvas.setAttribute("height",Math.floor(t*n).toString()),this.canvas.style.height=t+"px",this.canvas.getContext("2d").scale(n,n)))},i.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var e=function(){this.frame=i.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var t=new Date(0),n=this.seriesSet.reduce(function(e,t){var n=t.timeSeries.data,i=Math.round(this.options.displayDataFromPercentile*n.length)-1;if(i=(i=i>=0?i:0)<=n.length-1?i:n.length-1,n&&n.length>0){var r=n[i][0];e=e>r?e:r}return e}.bind(this),t);this.render(this.canvas,n>t?n:null)}else this.render();e()}.bind(this))}.bind(this);e()}},i.prototype.stop=function(){this.frame&&(i.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},i.prototype.updateValueRange=function(){for(var e=this.options,t=Number.NaN,n=Number.NaN,i=0;i<this.seriesSet.length;i++){var r=this.seriesSet[i].timeSeries;r.disabled||(isNaN(r.maxValue)||(t=isNaN(t)?r.maxValue:Math.max(t,r.maxValue)),isNaN(r.minValue)||(n=isNaN(n)?r.minValue:Math.min(n,r.minValue)))}if(null!=e.maxValue?t=e.maxValue:t*=e.maxValueScale,null!=e.minValue?n=e.minValue:n-=Math.abs(n*e.minValueScale-n),this.options.yRangeFunction){var o=this.options.yRangeFunction({min:n,max:t});n=o.min,t=o.max}if(!isNaN(t)&&!isNaN(n)){var s=t-n-this.currentValueRange,a=n-this.currentVisMinValue;this.isAnimatingScale=Math.abs(s)>.1||Math.abs(a)>.1,this.currentValueRange+=e.scaleSmoothing*s,this.currentVisMinValue+=e.scaleSmoothing*a}this.valueRange={min:n,max:t}},i.prototype.render=function(e,t){var n=Date.now();if(!(this.options.limitFPS>0&&n-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(!this.isAnimatingScale){var i=Math.min(1e3/6,this.options.millisPerPixel);if(n-this.lastRenderTimeMillis<i)return}this.resize(),this.updateTooltip(),this.lastRenderTimeMillis=n,e=e||this.canvas,t=t||n-(this.delay||0),t-=t%this.options.millisPerPixel,this.lastChartTimestamp=t;var r=e.getContext("2d"),o=this.options,s={top:0,left:0,width:e.clientWidth,height:e.clientHeight},a=t-s.width*o.millisPerPixel,l=function(e){var t=e-this.currentVisMinValue;return 0===this.currentValueRange?s.height:s.height-Math.round(t/this.currentValueRange*s.height)}.bind(this),c=function(e){return o.scrollBackwards?Math.round((t-e)/o.millisPerPixel):Math.round(s.width-(t-e)/o.millisPerPixel)};if(this.updateValueRange(),r.font=o.labels.fontSize+"px "+o.labels.fontFamily,r.save(),r.translate(s.left,s.top),r.beginPath(),r.rect(0,0,s.width,s.height),r.clip(),r.save(),r.fillStyle=o.grid.fillStyle,r.clearRect(0,0,s.width,s.height),r.fillRect(0,0,s.width,s.height),r.restore(),r.save(),r.lineWidth=o.grid.lineWidth,r.strokeStyle=o.grid.strokeStyle,o.grid.millisPerLine>0){r.beginPath();for(var u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine){var d=c(u);o.grid.sharpLines&&(d-=.5),r.moveTo(d,0),r.lineTo(d,s.height)}r.stroke(),r.closePath()}for(var h=1;h<o.grid.verticalSections;h++){var p=Math.round(h*s.height/o.grid.verticalSections);o.grid.sharpLines&&(p-=.5),r.beginPath(),r.moveTo(0,p),r.lineTo(s.width,p),r.stroke(),r.closePath()}if(o.grid.borderVisible&&(r.beginPath(),r.strokeRect(0,0,s.width,s.height),r.closePath()),r.restore(),o.horizontalLines&&o.horizontalLines.length)for(var f=0;f<o.horizontalLines.length;f++){var g=o.horizontalLines[f],m=Math.round(l(g.value))-.5;r.strokeStyle=g.color||"#ffffff",r.lineWidth=g.lineWidth||1,r.beginPath(),r.moveTo(0,m),r.lineTo(s.width,m),r.stroke(),r.closePath()}for(var b=0;b<this.seriesSet.length;b++){r.save();var y=this.seriesSet[b].timeSeries;if(!y.disabled){var v=y.data,_=this.seriesSet[b].options;y.dropOldData(a,o.maxDataSetLength),r.lineWidth=_.lineWidth,r.strokeStyle=_.strokeStyle,r.beginPath();for(var E=0,T=0,x=0,w=0;w<v.length&&1!==v.length;w++){var k=c(v[w][0]),S=l(v[w][1]);if(0===w)E=k,r.moveTo(k,S);else switch(o.interpolation){case"linear":case"line":r.lineTo(k,S);break;case"bezier":default:r.bezierCurveTo(Math.round((T+k)/2),x,Math.round(T+k)/2,S,k,S);break;case"step":r.lineTo(k,x),r.lineTo(k,S)}T=k,x=S}v.length>1&&(_.fillStyle&&(r.lineTo(s.width+_.lineWidth+1,x),r.lineTo(s.width+_.lineWidth+1,s.height+_.lineWidth+1),r.lineTo(E,s.height+_.lineWidth),r.fillStyle=_.fillStyle,r.fill()),_.strokeStyle&&"none"!==_.strokeStyle&&r.stroke(),r.closePath()),r.restore()}}if(o.tooltip&&this.mouseX>=0&&(r.lineWidth=o.tooltipLine.lineWidth,r.strokeStyle=o.tooltipLine.strokeStyle,r.beginPath(),r.moveTo(this.mouseX,0),r.lineTo(this.mouseX,s.height),r.closePath(),r.stroke(),this.updateTooltip()),!o.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var C=o.yMaxFormatter(this.valueRange.max,o.labels.precision),A=o.yMinFormatter(this.valueRange.min,o.labels.precision),I=o.scrollBackwards?0:s.width-r.measureText(C).width-2,O=o.scrollBackwards?0:s.width-r.measureText(A).width-2;r.fillStyle=o.labels.fillStyle,r.fillText(C,I,o.labels.fontSize),r.fillText(A,O,s.height-2)}if(o.labels.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&o.grid.verticalSections>0){var N=(this.valueRange.max-this.valueRange.min)/o.grid.verticalSections,R=s.height/o.grid.verticalSections;for(h=1;h<o.grid.verticalSections;h++){p=s.height-Math.round(h*R),o.grid.sharpLines&&(p-=.5);var D=o.yIntermediateFormatter(this.valueRange.min+h*N,o.labels.precision);intermediateLabelPos=o.labels.intermediateLabelSameAxis?o.scrollBackwards?0:s.width-r.measureText(D).width-2:o.scrollBackwards?s.width-r.measureText(D).width-2:0,r.fillText(D,intermediateLabelPos,p-o.grid.lineWidth)}}if(o.timestampFormatter&&o.grid.millisPerLine>0){var L=o.scrollBackwards?r.measureText(A).width:s.width-r.measureText(A).width+4;for(u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine)if(d=c(u),!o.scrollBackwards&&d<L||o.scrollBackwards&&d>L){var M=new Date(u),P=o.timestampFormatter(M),B=r.measureText(P).width;L=o.scrollBackwards?d+B+2:d-B-2,r.fillStyle=o.labels.fillStyle,o.scrollBackwards?r.fillText(P,d,s.height-2):r.fillText(P,d-B,s.height-2)}}r.restore()}},i.timeFormatter=function(e){function t(e){return(e<10?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},e.TimeSeries=n,e.SmoothieChart=i}(void 0===n?this:n)},{}],608:[function(e,t,n){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var i;try{i=window}catch(e){i=self}i.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,t){var n=e[0],i=e[1],r=e[2],o=e[3];i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&r)+t[1]-389564586|0)<<12|o>>>20)+n|0)&n|~o&i)+t[2]+606105819|0)<<17|r>>>15)+o|0)&o|~r&n)+t[3]-1044525330|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&r)+t[5]+1200080426|0)<<12|o>>>20)+n|0)&n|~o&i)+t[6]-1473231341|0)<<17|r>>>15)+o|0)&o|~r&n)+t[7]-45705983|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&r)+t[9]-1958414417|0)<<12|o>>>20)+n|0)&n|~o&i)+t[10]-42063|0)<<17|r>>>15)+o|0)&o|~r&n)+t[11]-1990404162|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&r|~i&o)+t[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&r)+t[13]-40341101|0)<<12|o>>>20)+n|0)&n|~o&i)+t[14]-1502002290|0)<<17|r>>>15)+o|0)&o|~r&n)+t[15]+1236535329|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[1]-165796510|0)<<5|n>>>27)+i|0)&r|i&~r)+t[6]-1069501632|0)<<9|o>>>23)+n|0)&i|n&~i)+t[11]+643717713|0)<<14|r>>>18)+o|0)&n|o&~n)+t[0]-373897302|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[5]-701558691|0)<<5|n>>>27)+i|0)&r|i&~r)+t[10]+38016083|0)<<9|o>>>23)+n|0)&i|n&~i)+t[15]-660478335|0)<<14|r>>>18)+o|0)&n|o&~n)+t[4]-405537848|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[9]+568446438|0)<<5|n>>>27)+i|0)&r|i&~r)+t[14]-1019803690|0)<<9|o>>>23)+n|0)&i|n&~i)+t[3]-187363961|0)<<14|r>>>18)+o|0)&n|o&~n)+t[8]+1163531501|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i&o|r&~o)+t[13]-1444681467|0)<<5|n>>>27)+i|0)&r|i&~r)+t[2]-51403784|0)<<9|o>>>23)+n|0)&i|n&~i)+t[7]+1735328473|0)<<14|r>>>18)+o|0)&n|o&~n)+t[12]-1926607734|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[5]-378558|0)<<4|n>>>28)+i|0)^i^r)+t[8]-2022574463|0)<<11|o>>>21)+n|0)^n^i)+t[11]+1839030562|0)<<16|r>>>16)+o|0)^o^n)+t[14]-35309556|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[1]-1530992060|0)<<4|n>>>28)+i|0)^i^r)+t[4]+1272893353|0)<<11|o>>>21)+n|0)^n^i)+t[7]-155497632|0)<<16|r>>>16)+o|0)^o^n)+t[10]-1094730640|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[13]+681279174|0)<<4|n>>>28)+i|0)^i^r)+t[0]-358537222|0)<<11|o>>>21)+n|0)^n^i)+t[3]-722521979|0)<<16|r>>>16)+o|0)^o^n)+t[6]+76029189|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((o=((o+=((n=((n+=(i^r^o)+t[9]-640364487|0)<<4|n>>>28)+i|0)^i^r)+t[12]-421815835|0)<<11|o>>>21)+n|0)^n^i)+t[15]+530742520|0)<<16|r>>>16)+o|0)^o^n)+t[2]-995338651|0)<<23|i>>>9)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[0]-198630844|0)<<6|n>>>26)+i|0)|~r))+t[7]+1126891415|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[14]-1416354905|0)<<15|r>>>17)+o|0)|~n))+t[5]-57434055|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[12]+1700485571|0)<<6|n>>>26)+i|0)|~r))+t[3]-1894986606|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[10]-1051523|0)<<15|r>>>17)+o|0)|~n))+t[1]-2054922799|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[8]+1873313359|0)<<6|n>>>26)+i|0)|~r))+t[15]-30611744|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[6]-1560198380|0)<<15|r>>>17)+o|0)|~n))+t[13]+1309151649|0)<<21|i>>>11)+r|0,i=((i+=((o=((o+=(i^((n=((n+=(r^(i|~o))+t[4]-145523070|0)<<6|n>>>26)+i|0)|~r))+t[11]-1120210379|0)<<10|o>>>22)+n|0)^((r=((r+=(n^(o|~i))+t[2]+718787259|0)<<15|r>>>17)+o|0)|~n))+t[9]-343485551|0)<<21|i>>>11)+r|0,e[0]=n+e[0]|0,e[1]=i+e[1]|0,e[2]=r+e[2]|0,e[3]=o+e[3]|0}function i(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function o(e){var t,r,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,i(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,n(u,o),u}function s(e){var n,i="";for(n=0;n<4;n+=1)i+=t[e>>8*n+4&15]+t[e>>8*n&15];return i}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,n=[],i=e.length;for(t=0;t<i-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function u(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,i){var r,o,s,a,l=this.byteLength,c=t(n,l),u=l;return i!==e&&(u=t(i,l)),c>u?new ArrayBuffer(0):(r=u-c,o=new ArrayBuffer(r),s=new Uint8Array(o),a=new Uint8Array(this,c,r),s.set(a),o)}}(),u.prototype.append=function(e){return this.appendBinary(l(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)n(this._hash,i(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i.charCodeAt(t)<<(t%4<<3);return this._finish(o,r),n=a(this._hash),e&&(n=c(n)),this.reset(),n},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var i,r,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(n(this._hash,e),s=0;s<16;s+=1)e[s]=0;i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(i[2],16),o=parseInt(i[1],16)||0,e[14]=r,e[15]=o,n(this._hash,e)},u.hash=function(e,t){return u.hashBinary(l(e),t)},u.hashBinary=function(e,t){var n=a(o(e));return t?c(n):n},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(e){var t,i,o,s,a=(i=this._buff.buffer,o=e,!0,(s=new Uint8Array(i.byteLength+o.byteLength)).set(new Uint8Array(i)),s.set(new Uint8Array(o),i.byteLength),s),l=a.length;for(this._length+=e.byteLength,t=64;t<=l;t+=64)n(this._hash,r(a.subarray(t-64,t)));return this._buff=t-64<l?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){var t,n,i=this._buff,r=i.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=i[t]<<(t%4<<3);return this._finish(o,r),n=a(this._hash),e&&(n=c(n)),this.reset(),n},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var n,i=e.length,r=new ArrayBuffer(i),o=new Uint8Array(r);for(n=0;n<i;n+=1)o[n]=e.charCodeAt(n);return o}(e.buff),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var i=a(function(e){var t,i,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)n(u,r(e.subarray(t-64,t)));for(i=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(n(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,n(u,o),u}(new Uint8Array(e)));return t?c(i):i},u}))},{}],609:[function(e,t,n){t.exports=r;var i=e("events").EventEmitter;function r(){i.call(this)}e("inherits")(r,i),r.Readable=e("readable-stream/readable.js"),r.Writable=e("readable-stream/writable.js"),r.Duplex=e("readable-stream/duplex.js"),r.Transform=e("readable-stream/transform.js"),r.PassThrough=e("readable-stream/passthrough.js"),r.Stream=r,r.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",l));var s=!1;function a(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",r),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",l),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},{events:408,inherits:423,"readable-stream/duplex.js":550,"readable-stream/passthrough.js":561,"readable-stream/readable.js":562,"readable-stream/transform.js":563,"readable-stream/writable.js":564}],610:[function(e,t,n){"use strict";var i=e("safe-buffer").Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=h,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}n.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=s(t[i]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(e.lastNeed=r-2),r):--i<n||-2===r?0:(r=s(t[i]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":567}],611:[function(e,t,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=i(e("ltgt")),o=i(e("events")),s=i(e("level-codec")),a=i(e("readable-stream")),l=i(e("inherits"));function c(e){return function(e){return"function"==typeof e}(e.prefix)?e.prefix():e}function u(){Error.call(this)}l(u,Error),u.prototype.name="NotFoundError";var d=o.EventEmitter,h=new u,p=function(e,t,n,i){var r=new d;function o(e){var t,n={};if(i)for(t in i)void 0!==i[t]&&(n[t]=i[t]);if(e)for(t in e)void 0!==e[t]&&(n[t]=e[t]);return n}return r.sublevels={},r.options=i,r.version="6.5.4",r.methods={},t=t||[],r.put=function(n,i,s,a){"function"==typeof s&&(a=s,s={}),e.apply([{key:n,value:i,prefix:t.slice(),type:"put"}],o(s),(function(e){if(e)return a(e);r.emit("put",n,i),a(null)}))},r.prefix=function(){return t.slice()},r.batch=function(n,i,s){"function"==typeof i&&(s=i,i={}),n=n.map((function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}})),e.apply(n,o(i),(function(e){if(e)return s(e);r.emit("batch",n),s(null)}))},r.get=function(n,i,r){"function"==typeof i&&(r=i,i={}),e.get(n,t,o(i),(function(e,t){e?r(h):r(null,t)}))},r.sublevel=function(i,s){return r.sublevels[i]=r.sublevels[i]||p(e,t.concat(i),n,o(s))},r.readStream=r.createReadStream=function(i){var r;(i=o(i)).prefix=t;var s=e.iterator(i);return(r=n(i,e.createDecoder(i))).setIterator(s),r},r.close=function(t){e.close(t)},r.isOpen=e.isOpen,r.isClosed=e.isClosed,r},f=a.Readable;function g(e,t){if(!(this instanceof g))return new g(e,t);f.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}l(g,f),g.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end((function(){})):this._waiting?(this._waiting=!1,this._read()):this},g.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next((function(t,n,i){if(t||void 0===n&&void 0===i)return t||e._destroyed||e.push(null),e._cleanup(t);i=e._makeData(n,i),e._destroyed||e.push(i)})):this._waiting=!0},g.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&"iterator has ended"!==e.message&&t.emit("error",e),t._iterator?t._iterator.end((function(){t._iterator=null,t.emit("close")})):t.emit("close")}},g.prototype.destroy=function(){this._cleanup()};var m={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),n=t.indexOf("",1);return[t.substring(1,n),t.substring(n+1)]},lowerBound:"\0",upperBound:""},b=new s;t.exports=function(e){return p(function(e,t,n){function i(e,i,r,o){return t.encode([e,n.encodeKey(i,r,o)])}function o(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open((function(){})),{apply:function(t,r,s){r=r||{};for(var a=[],l=-1,u=t.length;++l<u;){var d=t[l];o(d,d.prefix),d.prefix=c(d.prefix),a.push({key:i(d.prefix,d.key,r,d),value:"del"!==d.type&&n.encodeValue(d.value,r,d),type:d.type})}e.db.batch(a,r,s)},get:function(t,r,o,s){return o.asBuffer=n.valueAsBuffer(o),e.db.get(i(r,t,o),o,(function(e,t){e?s(e):s(null,n.decodeValue(t,o))}))},createDecoder:function(e){return function(i,r){return{key:n.decodeKey(t.decode(i)[1],e),value:n.decodeValue(r,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(o){var s,a=function(e){var t={};for(var n in e)t[n]=e[n];return t}(o||{}),l=o.prefix||[];return r.toLtgt(o,a,(function(e){return i(l,e,a,{})}),t.lowerBound,t.upperBound),a.prefix=null,a.keyAsBuffer=a.valueAsBuffer=!1,"number"!=typeof a.limit&&(a.limit=-1),a.keyAsBuffer=t.buffer,a.valueAsBuffer=n.valueAsBuffer(a),s=e.db.iterator(a),{next:function(e){return s.next(e)},end:function(e){s.end(e)}}}}}(e,m,b),[],g,e.options)}},{events:408,inherits:423,"level-codec":426,ltgt:449,"readable-stream":618}],612:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],613:[function(e,t,n){(function(n){(function(){t.exports=a;var i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},r=e("core-util-is");r.inherits=e("inherits");var o=e("./_stream_readable"),s=e("./_stream_writable");function a(e){if(!(this instanceof a))return new a(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||n.nextTick(this.end.bind(this))}r.inherits(a,o),function(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n],n)}(i(s.prototype),(function(e){a.prototype[e]||(a.prototype[e]=s.prototype[e])}))}).call(this)}).call(this,e("_process"))},{"./_stream_readable":615,"./_stream_writable":617,_process:485,"core-util-is":385,inherits:423}],614:[function(e,t,n){t.exports=o;var i=e("./_stream_transform"),r=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);i.call(this,e)}r.inherits=e("inherits"),r.inherits(o,i),o.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":616,"core-util-is":385,inherits:423}],615:[function(e,t,n){(function(n){(function(){t.exports=u;var i=e("isarray"),r=e("buffer").Buffer;u.ReadableState=c;var o=e("events").EventEmitter;o.listenerCount||(o.listenerCount=function(e,t){return e.listeners(t).length});var s,a=e("stream"),l=e("core-util-is");function c(t,n){var i=(t=t||{}).highWaterMark;this.highWaterMark=i||0===i?i:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(s||(s=e("string_decoder/").StringDecoder),this.decoder=new s(t.encoding),this.encoding=t.encoding)}function u(e){if(!(this instanceof u))return new u(e);this._readableState=new c(e,this),this.readable=!0,a.call(this)}function d(e,t,i,o,s){var a=function(e,t){var n=null;return r.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,i);if(a)e.emit("error",a);else if(null==i)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?f(e):_(e)}(e,t);else if(t.objectMode||i&&i.length>0)if(t.ended&&!s){var l=new Error("stream.push() after EOF");e.emit("error",l)}else t.endEmitted&&s?(l=new Error("stream.unshift() after end event"),e.emit("error",l)):(!t.decoder||s||o||(i=t.decoder.write(i)),t.length+=t.objectMode?1:i.length,s?t.buffer.unshift(i):(t.reading=!1,t.buffer.push(i)),t.needReadable&&f(e),function(e,t){t.readingMore||(t.readingMore=!0,n.nextTick((function(){!function(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}(e,t)})))}(e,t));else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}l.inherits=e("inherits"),l.inherits(u,a),u.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding)!==n.encoding&&(e=new r(e,t),t=""),d(this,n,e,t,!1)},u.prototype.unshift=function(e){return d(this,this._readableState,e,"",!0)},u.prototype.setEncoding=function(t){s||(s=e("string_decoder/").StringDecoder),this._readableState.decoder=new s(t),this._readableState.encoding=t};var h=8388608;function p(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=h)e=h;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?n.nextTick((function(){g(e)})):g(e))}function g(e){e.emit("readable")}function m(e){var t,n=e._readableState;function i(e,i,r){!1===e.write(t)&&n.awaitDrain++}for(n.awaitDrain=0;n.pipesCount&&null!==(t=e.read());)if(1===n.pipesCount?i(n.pipes):E(n.pipes,i),e.emit("data",t),n.awaitDrain>0)return;if(0===n.pipesCount)return n.flowing=!1,void(o.listenerCount(e,"data")>0&&y(e));n.ranOut=!0}function b(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function y(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var i=t||!1,r=!1;e.readable=!0,e.pipe=a.prototype.pipe,e.on=e.addListener=a.prototype.on,e.on("readable",(function(){var t;for(r=!0;!i&&null!==(t=e.read());)e.emit("data",t);null===t&&(r=!1,e._readableState.needReadable=!0)})),e.pause=function(){i=!0,this.emit("pause")},e.resume=function(){i=!1,r?n.nextTick((function(){e.emit("readable")})):this.read(0),this.emit("resume")},e.emit("readable")}function v(e,t){var n,i=t.buffer,o=t.length,s=!!t.decoder,a=!!t.objectMode;if(0===i.length)return null;if(0===o)n=null;else if(a)n=i.shift();else if(!e||e>=o)n=s?i.join(""):r.concat(i,o),i.length=0;else if(e<i[0].length)n=(d=i[0]).slice(0,e),i[0]=d.slice(e);else if(e===i[0].length)n=i.shift();else{n=s?"":new r(e);for(var l=0,c=0,u=i.length;c<u&&l<e;c++){var d=i[0],h=Math.min(e-l,d.length);s?n+=d.slice(0,h):d.copy(n,l,0,h),h<d.length?i[0]=d.slice(h):i.shift(),l+=h}}return n}function _(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,n.nextTick((function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))})))}function E(e,t){for(var n=0,i=e.length;n<i;n++)t(e[n],n)}u.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n,i=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(0===(e=p(e,t))&&t.ended)return n=null,t.length>0&&t.decoder&&(n=v(e,t),t.length-=n.length),0===t.length&&_(this),n;var r=t.needReadable;return t.length-e<=t.highWaterMark&&(r=!0),(t.ended||t.reading)&&(r=!1),r&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=p(i,t)),null===(n=e>0?v(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&_(this),n},u.prototype._read=function(e){this.emit("error",new Error("not implemented"))},u.prototype.pipe=function(e,t){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1;var a=t&&!1===t.end||e===n.stdout||e===n.stderr?d:c;function l(e){e===r&&d()}function c(){e.end()}s.endEmitted?n.nextTick(a):r.once("end",a),e.on("unpipe",l);var u=function(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&m(e)}}(r);function d(){e.removeListener("close",p),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",l),r.removeListener("end",c),r.removeListener("end",d),e._writableState&&!e._writableState.needDrain||u()}function h(t){g(),e.removeListener("error",h),0===o.listenerCount(e,"error")&&e.emit("error",t)}function p(){e.removeListener("finish",f),g()}function f(){e.removeListener("close",p),g()}function g(){r.unpipe(e)}return e.on("drain",u),e._events&&e._events.error?i(e._events.error)?e._events.error.unshift(h):e._events.error=[h,e._events.error]:e.on("error",h),e.once("close",p),e.once("finish",f),e.emit("pipe",r),s.flowing||(this.on("readable",b),s.flowing=!0,n.nextTick((function(){m(r)}))),e},u.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this);return this}return-1===(r=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}(t.pipes,e))||(t.pipes.splice(r,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},u.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||y(this),"readable"===e&&this.readable){var i=this._readableState;i.readableListening||(i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0,i.reading?i.length&&f(this):this.read(0))}return n},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){y(this),this.read(0),this.emit("resume")},u.prototype.pause=function(){y(this,!0),this.emit("pause")},u.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;for(var r in e.on("end",(function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)})),e.on("data",(function(r){t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r||(t.objectMode||r&&r.length)&&(i.push(r)||(n=!0,e.pause()))})),e)"function"==typeof e[r]&&void 0===this[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return E(["error","close","destroy","pause","resume"],(function(t){e.on(t,i.emit.bind(i,t))})),i._read=function(t){n&&(n=!1,e.resume())},i},u._fromList=v}).call(this)}).call(this,e("_process"))},{_process:485,buffer:381,"core-util-is":385,events:408,inherits:423,isarray:612,stream:609,"string_decoder/":619}],616:[function(e,t,n){t.exports=s;var i=e("./_stream_duplex"),r=e("core-util-is");function o(e,t){this.afterTransform=function(e,n){return function(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!=n&&e.push(n),r&&r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e){if(!(this instanceof s))return new s(e);i.call(this,e),this._transformState=new o(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",(function(){"function"==typeof this._flush?this._flush((function(e){a(t,e)})):a(t)}))}function a(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=(e._readableState,e._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(i.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}r.inherits=e("inherits"),r.inherits(s,i),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("not implemented")},s.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":613,"core-util-is":385,inherits:423}],617:[function(e,t,n){(function(n){(function(){t.exports=l;var i=e("buffer").Buffer;l.WritableState=a;var r=e("core-util-is");r.inherits=e("inherits");var o=e("stream");function s(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function a(e,t){var i=(e=e||{}).highWaterMark;this.highWaterMark=i||0===i?i:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,r=i.sync,o=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,r,o){i?n.nextTick((function(){o(r)})):o(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,0,r,t,o);else{var s=h(e,i);s||i.bufferProcessing||!i.buffer.length||function(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var i=t.buffer[n],r=i.chunk,o=i.encoding,s=i.callback;if(u(e,t,t.objectMode?1:r.length,r,o,s),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}(e,i),r?n.nextTick((function(){d(e,i,s,o)})):d(e,i,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function l(t){var n=e("./_stream_duplex");if(!(this instanceof l||this instanceof n))return new l(t);this._writableState=new a(t,this),this.writable=!0,o.call(this)}function c(e,t,n,r,o){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new i(t,n)),t}(t,n,r),i.isBuffer(n)&&(r="buffer");var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;return l||(t.needDrain=!0),t.writing?t.buffer.push(new s(n,r,o)):u(e,t,a,n,r,o),l}function u(e,t,n,i,r,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,e._write(i,r,t.onwrite),t.sync=!1}function d(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),i(),n&&p(e,t)}function h(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function p(e,t){var n=h(0,t);return n&&(t.finished=!0,e.emit("finish")),n}r.inherits(l,o),l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},l.prototype.write=function(e,t,r){var o=this._writableState,s=!1;return"function"==typeof t&&(r=t,t=null),i.isBuffer(e)?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=function(){}),o.ended?function(e,t,i){var r=new Error("write after end");e.emit("error",r),n.nextTick((function(){i(r)}))}(this,0,r):function(e,t,r,o){var s=!0;if(!i.isBuffer(r)&&"string"!=typeof r&&null!=r&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),n.nextTick((function(){o(a)})),s=!1}return s}(this,o,e,r)&&(s=c(this,o,e,t,r)),s},l.prototype._write=function(e,t,n){n(new Error("not implemented"))},l.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.ending||r.finished||function(e,t,i){t.ending=!0,p(e,t),i&&(t.finished?n.nextTick(i):e.once("finish",i)),t.ended=!0}(this,r,i)}}).call(this)}).call(this,e("_process"))},{"./_stream_duplex":613,_process:485,buffer:381,"core-util-is":385,inherits:423,stream:609}],618:[function(e,t,n){var i=e("stream");(n=t.exports=e("./lib/_stream_readable.js")).Stream=i,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":613,"./lib/_stream_passthrough.js":614,"./lib/_stream_readable.js":615,"./lib/_stream_transform.js":616,"./lib/_stream_writable.js":617,stream:609}],619:[function(e,t,n){var i=e("buffer").Buffer,r=i.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!r(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=s)}this.charBuffer=new i(6),this.charReceived=0,this.charLength=0};function s(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i,r=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),r=(t+=e.toString(this.encoding,0,r)).length-1,(i=t.charCodeAt(r))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t}},{buffer:381}],620:[function(e,t,n){(function(t,i){(function(){var r=e("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,a={},l=0;function c(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new c(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new c(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=l++,i=!(arguments.length<2)&&s.call(arguments,1);return a[t]=!0,r((function(){a[t]&&(i?e.apply(null,i):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof i?i:function(e){delete a[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":485,timers:620}],621:[function(e,t,n){(function(e){(function(){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],622:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],623:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],624:[function(e,t,n){(function(t,i){(function(){var r=/%[sdj%]/g;n.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,s=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),l=i[n];n<o;l=i[++n])g(l)||!_(l)?s+=" "+l:s+=" "+a(l);return s},n.deprecate=function(e,r){if(y(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(t)?i.showHidden=t:t&&n._extend(i,t),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),u(i,e,i.depth)}function l(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,i){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return b(r)||(r=u(e,r,i)),r}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),T(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(x(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(v(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(T(t))return d(t)}var c,_="",w=!1,k=["{","}"];return p(t)&&(w=!0,k=["[","]"]),x(t)&&(_=" [Function"+(t.name?": "+t.name:"")+"]"),v(t)&&(_=" "+RegExp.prototype.toString.call(t)),E(t)&&(_=" "+Date.prototype.toUTCString.call(t)),T(t)&&(_=" "+d(t)),0!==s.length||w&&0!=t.length?i<0?v(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=w?function(e,t,n,i,r){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(h(e,t,n,i,String(s),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(h(e,t,n,i,r,!0))})),o}(e,t,i,a,s):s.map((function(n){return h(e,t,i,a,n,w)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(c,_,k)):k[0]+_+k[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,i,r,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(i,r)||(s="["+r+"]"),a||(e.seen.indexOf(l.value)<0?(a=g(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function b(e){return"string"==typeof e}function y(e){return void 0===e}function v(e){return _(e)&&"[object RegExp]"===w(e)}function _(e){return"object"==typeof e&&null!==e}function E(e){return _(e)&&"[object Date]"===w(e)}function T(e){return _(e)&&("[object Error]"===w(e)||e instanceof Error)}function x(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=t.pid;s[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else s[e]=function(){};return s[e]},n.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=f,n.isNull=g,n.isNullOrUndefined=function(e){return null==e},n.isNumber=m,n.isString=b,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=v,n.isObject=_,n.isDate=E,n.isError=T,n.isFunction=x,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var e=new Date,t=[k(e.getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",C(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":623,_process:485,inherits:622}],625:[function(e,t,n){var i=e("./v1"),r=e("./v4"),o=r;o.v1=i,o.v4=r,t.exports=o},{"./v1":628,"./v4":629}],626:[function(e,t,n){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,r=i;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},{}],627:[function(e,t,n){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);t.exports=function(){return i(r),r}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],628:[function(e,t,n){var i,r,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,l=0;t.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:r;if(null==d||null==h){var p=o();null==d&&(d=i=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=r=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:l+1,m=f-a+(g-l)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||f>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=g,r=h;var b=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;u[c++]=b>>>24&255,u[c++]=b>>>16&255,u[c++]=b>>>8&255,u[c++]=255&b;var y=f/4294967296*1e4&268435455;u[c++]=y>>>8&255,u[c++]=255&y,u[c++]=y>>>24&15|16,u[c++]=y>>>16&255,u[c++]=h>>>8|128,u[c++]=255&h;for(var v=0;v<6;++v)u[c+v]=d[v];return t||s(u)}},{"./lib/bytesToUuid":626,"./lib/rng":627}],629:[function(e,t,n){var i=e("./lib/rng"),r=e("./lib/bytesToUuid");t.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||r(s)}},{"./lib/bytesToUuid":626,"./lib/rng":627}],630:[function(e,t,n){"use strict";function i(e,t,n){var i=n[n.length-1];e===i.element&&(n.pop(),i=n[n.length-1]);var r=i.element,o=i.index;Array.isArray(r)?r.push(e):o===t.length-2?r[t.pop()]=e:t.push(e)}n.stringify=function(e){var t=[];t.push({obj:e});for(var n,i,r,o,s,a,l,c,u,d,h="";n=t.pop();)if(i=n.obj,h+=n.prefix||"",r=n.val||"")h+=r;else if("object"!=typeof i)h+=void 0===i?null:JSON.stringify(i);else if(null===i)h+="null";else if(Array.isArray(i)){for(t.push({val:"]"}),o=i.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:i[o],prefix:s});t.push({val:"["})}else{for(l in a=[],i)i.hasOwnProperty(l)&&a.push(l);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)u=i[c=a[o]],d=o>0?",":"",d+=JSON.stringify(c)+":",t.push({obj:u,prefix:d});t.push({val:"{"})}return h},n.parse=function(e){for(var t,n,r,o,s,a,l,c,u,d=[],h=[],p=0;;)if("}"!==(t=e[p++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":p+=3,i(null,d,h);break;case"t":p+=3,i(!0,d,h);break;case"f":p+=4,i(!1,d,h);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",p--;;){if(r=e[p++],!/[\d\.\-e\+]/.test(r)){p--;break}n+=r}i(parseFloat(n),d,h);break;case'"':for(o="",s=void 0,a=0;'"'!==(l=e[p++])||"\\"===s&&a%2==1;)o+=l,"\\"===(s=l)?a++:a=0;i(JSON.parse('"'+o+'"'),d,h);break;case"[":c={element:[],index:d.length},d.push(c.element),h.push(c);break;case"{":u={element:{},index:d.length},d.push(u.element),h.push(u);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===d.length)return d.pop();i(d.pop(),d,h)}}},{}],631:[function(e,t,n){"use strict";var i=function(){};t.exports=i},{}],632:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)i.call(n,r)&&(e[r]=n[r])}return e};var i=Object.prototype.hasOwnProperty},{}]},{},[190]);
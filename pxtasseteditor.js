!function e(t,i,s){function n(r,a){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[r]={exports:{}};t[r][0].call(u.exports,(function(e){return n(t[r][1][e]||e)}),u,u.exports,e,t,i,s)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BlockDragger=void 0;const s=e("./plugins/duplicateOnDrag");class n extends s.DuplicateOnDragBlockDragger{drag(e,t){const i=document.getElementsByClassName("blocklyToolboxDiv")[0],s=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],n=document.getElementById("blocklyTrashIcon");if(s&&n){const t=function(e,t){return Math.abs(t-(e.left+e.width/2))}(s.getBoundingClientRect(),e.clientX);if(t<200){const e=t/200;n.style.opacity=""+(1-e),n.style.display="block",i&&(s.style.opacity=`${e}`,t<50&&pxt.BrowserUtils.addClass(i,"blocklyToolboxDeleting"))}else n.style.display="none",s.style.opacity="1",i&&pxt.BrowserUtils.removeClass(i,"blocklyToolboxDeleting")}return super.drag(e,t)}endDrag(e,t){super.endDrag(e,t);const i=document.getElementsByClassName("blocklyToolboxDiv")[0],s=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],n=document.getElementById("blocklyTrashIcon");n&&s&&(n.style.display="none",s.style.opacity="1",i&&pxt.BrowserUtils.removeClass(i,"blocklyToolboxDeleting"))}}i.BlockDragger=n},{"./plugins/duplicateOnDrag":78}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BreakpointIcon=void 0;const s=e("blockly");class n extends s.icons.Icon{constructor(e,t){super(e),this.onStateChange=t,this.isSet_=!1}getType(){return n.type}initView(e){super.initView(e),this.breakpointSvg||(this.breakpointSvg=s.utils.dom.createSvgElement("circle",{class:"blocklyBreakpointSymbol",stroke:"white","stroke-width":2,cx:7,cy:11.5,r:8},this.svgRoot),this.updateColor())}getSize(){return new s.utils.Size(25,25)}onClick(){this.isSet_=!this.isSet_,this.updateColor(),this.onStateChange(this.sourceBlock,this.isSet_)}isEnabled(){return this.isSet_}setEnabled(e){this.isSet_=e,this.updateColor()}updateColor(){this.breakpointSvg&&this.breakpointSvg.setAttribute("fill",this.isSet_?"#FF0000":"#CCCCCC")}}i.BreakpointIcon=n,n.type=new s.icons.IconType("breakpoint")},{blockly:197}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initFunctions=void 0;const s=e("blockly"),n=e("../help"),o=e("../plugins/functions"),r=e("../toolbox"),a=e("../fields"),l=e("../loader"),c=e("../importer"),u=e("../plugins/duplicateOnDrag");i.initFunctions=function(){const e=s.Msg;e.FUNCTION_CREATE_NEW=lf("Make a Function..."),e.FUNCTION_WARNING_DUPLICATE_ARG=lf("Functions cannot use the same argument name more than once."),e.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME=lf("Argument names must not be the same as the function name."),e.FUNCTION_WARNING_EMPTY_NAME=lf("Function and argument names cannot be empty."),e.FUNCTIONS_DEFAULT_FUNCTION_NAME=lf("doSomething"),e.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME=lf("bool"),e.FUNCTIONS_DEFAULT_STRING_ARG_NAME=lf("text"),e.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME=lf("num"),e.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME=lf("arg"),e.PROCEDURES_HUE=pxt.toolbox.getNamespaceColor("functions"),e.REPORTERS_HUE=pxt.toolbox.getNamespaceColor("variables");const t=pxt.blocks.getBlockDefinition("procedures_defnoreturn");e.PROCEDURES_DEFNORETURN_TITLE=t.block.PROCEDURES_DEFNORETURN_TITLE,e.PROCEDURE_ALREADY_EXISTS=t.block.PROCEDURE_ALREADY_EXISTS,s.Blocks.procedures_defnoreturn.init=function(){let e=new s.FieldTextInput("",s.Procedures.rename);this.appendDummyInput().appendField(s.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.argumentVarModels_=[],this.hat="cap",this.setStatements_(!0),this.statementConnection_=null},(0,n.installBuiltinHelpInfo)("procedures_defnoreturn");const i=pxt.blocks.getBlockDefinition("procedures_callnoreturn");e.PROCEDURES_CALLRETURN_TOOLTIP=t.tooltip.toString(),s.Blocks.procedures_callnoreturn={init:function(){let e=new a.FieldProcedure("");this.appendDummyInput("TOPROW").appendField(i.block.PROCEDURES_CALLNORETURN_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.quarkConnections_={},this.quarkIds_=null},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){s.Names.equals(e,this.getProcedureCall())&&this.setFieldValue(t,"NAME")},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&!this.isInsertionMarker())if(e.type==s.Events.CREATE&&-1!=e.ids.indexOf(this.id)){let t=this.getProcedureCall(),i=s.Procedures.getDefinition(t,this.workspace);if(!i||i.type==this.defType_&&JSON.stringify(i.arguments_)==JSON.stringify(this.arguments_)||(i=null),!i){s.Events.setGroup(e.group);let t=s.utils.xml.createElement("xml"),i=s.utils.xml.createElement("block");i.setAttribute("type",this.defType_);let n=this.getRelativeToSurfaceXY(),o=n.x+s.SNAP_RADIUS*(this.RTL?-1:1),r=n.y+2*s.SNAP_RADIUS;i.setAttribute("x",o),i.setAttribute("y",r);let a=s.utils.xml.createElement("field");a.setAttribute("name","NAME"),a.appendChild(document.createTextNode(this.getProcedureCall())),i.appendChild(a),t.appendChild(i),(0,c.domToWorkspaceNoEvents)(t,this.workspace),s.Events.setGroup(!1)}}else if(e.type==s.Events.DELETE){let t=this.getProcedureCall();s.Procedures.getDefinition(t,this.workspace)||(s.Events.setGroup(e.group),this.dispose(!0,!1),s.Events.setGroup(!1))}},mutationToDom:function(){const e=document.createElement("mutation");return e.setAttribute("name",this.getProcedureCall()),e},domToMutation:function(e){const t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t)},customContextMenu:function(e){let t={enabled:!0};t.text=s.Msg.PROCEDURES_HIGHLIGHT_DEF;let i=this.getProcedureCall(),n=this.workspace;t.callback=function(){let e=s.Procedures.getDefinition(i,n);e&&e.select()},e.push(t)},defType_:"procedures_defnoreturn"},(0,n.installBuiltinHelpInfo)("procedures_callnoreturn");const h=pxt.blocks.getBlockDefinition("function_definition");e.FUNCTIONS_EDIT_OPTION=h.block.FUNCTIONS_EDIT_OPTION,(0,n.installBuiltinHelpInfo)("function_definition");const d=pxt.blocks.getBlockDefinition("function_call");e.FUNCTIONS_CALL_TITLE=d.block.FUNCTIONS_CALL_TITLE,e.FUNCTIONS_GO_TO_DEFINITION_OPTION=d.block.FUNCTIONS_GO_TO_DEFINITION_OPTION,(0,n.installBuiltinHelpInfo)("function_call"),(0,n.installBuiltinHelpInfo)("function_call_output"),s.Blocks.function_return={init:function(){!function(e){const t=pxt.blocks.getBlockDefinition("function_return"),i="0_add_button",n="0_rem_button";s.Extensions.apply("inline-svgs",e,!1);let o,r=!0;function a(){const s=e.getInput("RETURN_VALUE");if(r){if(!s){for(;e.getInput("");)e.removeInput("");e.jsonInit({message0:t.block.message_with_value,args0:[{type:"input_value",name:"RETURN_VALUE",check:null}],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}if(e.getInput(i)&&e.removeInput(i),e.getInput(n)||u(n,e.REMOVE_IMAGE_DATAURI,lf("Remove return value")),o){const t=e.workspace.getBlockById(o);t&&t.outputConnection&&!t.outputConnection.targetBlock()&&e.getInput("RETURN_VALUE").connection.connect(t.outputConnection),o=void 0}}else{if(s){const i=s.connection.targetBlock();i&&(i.isShadow()&&i.setShadow(!1),s.connection.disconnect(),o=i.id),e.removeInput("RETURN_VALUE"),e.jsonInit({message0:t.block.message_no_value,args0:[],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}e.getInput(n)&&e.removeInput(n),e.getInput(i)||u(i,e.ADD_IMAGE_DATAURI,lf("Add return value"))}e.setInputsInline(!0)}function l(){return s.Xml.domToText(e.mutationToDom())}function c(t,i){t!==i&&s.Events.fire(new s.Events.BlockChange(e,"mutation",null,t,i))}function u(t,i,n){e.appendDummyInput(t).appendField(new s.FieldImage(i,24,24,n,(()=>{const e=l();r=!r;const t=l();c(e,t),a(),c(t,l())}),!1))}a(),e.domToMutation=e=>{e.hasAttribute("last_connected_id")&&(o=e.getAttribute("last_connected_id")),r=function(e){return"true"!==e.getAttribute("no_return_value")}(e),a()},e.mutationToDom=()=>{const t=document.createElement("mutation");return function(e,t){e.setAttribute("no_return_value",t?"false":"true")}(t,!!e.getInput("RETURN_VALUE")),o&&t.setAttribute("last_connected_id",o),t}}(this)},onchange:function(e){const t=this;if(!t.workspace||t.workspace.isFlyout)return;const i=e.type===s.Events.BLOCK_CREATE&&-1!=e.ids.indexOf(t.id),n=e.type===s.Events.BLOCK_DRAG&&e.blocks.some((e=>e.id===t.id));if(i||n){const i=t.getRootBlock();if("function_return"===i.type||null!=i.previousConnection)return;"function_definition"!==i.type&&(s.Events.setGroup(e.group),t.previousConnection.disconnect(),s.Events.setGroup(!1))}}},(0,n.installBuiltinHelpInfo)("function_return"),s.Procedures.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,r.createFlyoutHeadingLabel)(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.push(e)}const i=lf("Make a Function..."),n=lf("New function name:");let o=s.utils.xml.createElement("button");return o.setAttribute("text",i),o.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(function(t){let o=t=>{s.dialog.prompt(n,t,(function(t){pxt.tickEvent("blocks.makeafunction"),t&&(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""))==i&&(t=null),t&&(e.getVariable(t)?s.dialog.alert(s.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})):s.Procedures.isNameUsed(t,e)?(t=>{let i=e.getTopBlocks(!0)[0],n=10,o=10;if(i){let e=i.getRelativeToSurfaceXY();n=e.x+s.SNAP_RADIUS*(i.RTL?-1:1),o=e.y+2*s.SNAP_RADIUS}let r=s.utils.xml.createElement("xml"),a=s.utils.xml.createElement("block");a.setAttribute("type","procedures_defnoreturn"),a.setAttribute("x",String(n)),a.setAttribute("y",String(o));let l=s.utils.xml.createElement("field");l.setAttribute("name","NAME"),l.appendChild(document.createTextNode(t)),a.appendChild(l),r.appendChild(a);let u=(0,c.domToWorkspaceNoEvents)(r,e);s.hideChaff();let h=e.getBlockById(u[0]);h.select(),e.centerOnBlock(h.id)})(t):s.dialog.alert(s.Msg.PROCEDURE_ALREADY_EXISTS.replace("%1",t.toLowerCase()),(function(){o(t)})))}))};o("doSomething")})),t.push(o),function(e,i){for(let i=0;i<e.length;i++){let n=e[i][0],o=(e[i][1],s.utils.xml.createElement("block"));o.setAttribute("type","procedures_callnoreturn"),o.setAttribute("gap","16"),o.setAttribute("colour",pxt.toolbox.getNamespaceColor("functions"));let r=s.utils.xml.createElement("field");r.textContent=n,r.setAttribute("name","NAME"),o.appendChild(r),t.push(o)}}(s.Procedures.allProcedures(e)[0]),t};const p={number:pxt.blocks.defaultIconForArgType("number"),boolean:pxt.blocks.defaultIconForArgType("boolean"),string:pxt.blocks.defaultIconForArgType("string"),Array:pxt.blocks.defaultIconForArgType("Array")},g={},m=pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions;m&&m.extraFunctionEditorTypes&&m.extraFunctionEditorTypes.forEach((e=>{p[e.typeName]=e.icon||pxt.blocks.defaultIconForArgType(),e.defaultName&&(g[e.typeName]=e.defaultName)}));for(const e of Object.keys(p))o.FunctionManager.getInstance().setIconForType(e,p[e]);for(const e of Object.keys(g))o.FunctionManager.getInstance().setArgumentNameForType(e,g[e]);s.Blocks.argument_reporter_custom&&(s.Blocks.argument_reporter_custom.domToMutation=function(e){const t=e.getAttribute("typename");this.typeName_=t,e.hasAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(u.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase()),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_),(0,l.setOutputCheck)(this,t,l.cachedBlockInfo)});const f=s.Blocks.function_definition.makeCallOption;s.Blocks.function_definition.makeCallOption=function(){const e=f.call(this),t=this.getName();return e.text=pxt.Util.lf("Create 'call {0}'",t),e}}},{"../fields":65,"../help":66,"../importer":67,"../loader":71,"../plugins/duplicateOnDrag":78,"../plugins/functions":93,"../toolbox":120,blockly:197}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLists=void 0;const s=e("blockly"),n=e("../help"),o=e("../constants");i.initLists=function(){const e=s.Msg,t=pxt.blocks.getBlockDefinition("lists_create_with");e.LISTS_CREATE_EMPTY_TITLE=t.block.LISTS_CREATE_EMPTY_TITLE,e.LISTS_CREATE_WITH_INPUT_WITH=t.block.LISTS_CREATE_WITH_INPUT_WITH,e.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD=t.block.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,e.LISTS_CREATE_WITH_ITEM_TITLE=t.block.LISTS_CREATE_WITH_ITEM_TITLE,(0,n.installBuiltinHelpInfo)("lists_create_with");const i=pxt.blocks.getBlockDefinition("lists_length");e.LISTS_LENGTH_TITLE=i.block.LISTS_LENGTH_TITLE,s.Blocks.lists_length.init=function(){this.jsonInit({message0:e.LISTS_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["Array"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,n.installBuiltinHelpInfo)("lists_length");const r=pxt.blocks.getBlockDefinition("lists_index_get");s.Blocks.lists_index_get={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:pxt.toolbox.blockColors.arrays,outputShape:o.provider.SHAPES.ROUND,inputsInline:!0}),this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0),(0,n.setBuiltinHelpInfo)(this,"lists_index_get")}};const a=pxt.blocks.getBlockDefinition("lists_index_set");s.Blocks.lists_index_set={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE",check:null}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.arrays,inputsInline:!0}),(0,n.setBuiltinHelpInfo)(this,"lists_index_set")}}}},{"../constants":18,"../help":66,blockly:197}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLogic=void 0;const s=e("blockly"),n=e("../help");i.initLogic=function(){const e=s.Msg,t=pxt.blocks.getBlockDefinition("controls_if"),i=t.tooltip;e.CONTROLS_IF_MSG_IF=t.block.CONTROLS_IF_MSG_IF,e.CONTROLS_IF_MSG_THEN=t.block.CONTROLS_IF_MSG_THEN,e.CONTROLS_IF_MSG_ELSE=t.block.CONTROLS_IF_MSG_ELSE,e.CONTROLS_IF_MSG_ELSEIF=t.block.CONTROLS_IF_MSG_ELSEIF,e.CONTROLS_IF_TOOLTIP_1=i.CONTROLS_IF_TOOLTIP_1,e.CONTROLS_IF_TOOLTIP_2=i.CONTROLS_IF_TOOLTIP_2,e.CONTROLS_IF_TOOLTIP_3=i.CONTROLS_IF_TOOLTIP_3,e.CONTROLS_IF_TOOLTIP_4=i.CONTROLS_IF_TOOLTIP_4,(0,n.installBuiltinHelpInfo)("controls_if");const o=pxt.blocks.getBlockDefinition("logic_compare").tooltip;e.LOGIC_COMPARE_TOOLTIP_EQ=o.LOGIC_COMPARE_TOOLTIP_EQ,e.LOGIC_COMPARE_TOOLTIP_NEQ=o.LOGIC_COMPARE_TOOLTIP_NEQ,e.LOGIC_COMPARE_TOOLTIP_LT=o.LOGIC_COMPARE_TOOLTIP_LT,e.LOGIC_COMPARE_TOOLTIP_LTE=o.LOGIC_COMPARE_TOOLTIP_LTE,e.LOGIC_COMPARE_TOOLTIP_GT=o.LOGIC_COMPARE_TOOLTIP_GT,e.LOGIC_COMPARE_TOOLTIP_GTE=o.LOGIC_COMPARE_TOOLTIP_GTE,(0,n.installBuiltinHelpInfo)("logic_compare");const r=pxt.blocks.getBlockDefinition("logic_operation"),a=r.tooltip;e.LOGIC_OPERATION_AND=r.block.LOGIC_OPERATION_AND,e.LOGIC_OPERATION_OR=r.block.LOGIC_OPERATION_OR,e.LOGIC_OPERATION_TOOLTIP_AND=a.LOGIC_OPERATION_TOOLTIP_AND,e.LOGIC_OPERATION_TOOLTIP_OR=a.LOGIC_OPERATION_TOOLTIP_OR,(0,n.installBuiltinHelpInfo)("logic_operation");const l=pxt.blocks.getBlockDefinition("logic_negate");e.LOGIC_NEGATE_TITLE=l.block.LOGIC_NEGATE_TITLE,(0,n.installBuiltinHelpInfo)("logic_negate");const c=pxt.blocks.getBlockDefinition("logic_boolean");e.LOGIC_BOOLEAN_TRUE=c.block.LOGIC_BOOLEAN_TRUE,e.LOGIC_BOOLEAN_FALSE=c.block.LOGIC_BOOLEAN_FALSE,(0,n.installBuiltinHelpInfo)("logic_boolean")}},{"../help":66,blockly:197}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initLoops=void 0;const s=e("blockly"),n=e("../help");i.initLoops=function(){const e=s.Msg,t=pxt.blocks.getBlockDefinition("controls_repeat_ext");e.CONTROLS_REPEAT_TITLE=t.block.CONTROLS_REPEAT_TITLE,e.CONTROLS_REPEAT_INPUT_DO=t.block.CONTROLS_REPEAT_INPUT_DO,(0,n.installBuiltinHelpInfo)("controls_repeat_ext");const i=pxt.blocks.getBlockDefinition("device_while");s.Blocks.device_while={init:function(){this.jsonInit({message0:i.block.message0,args0:[{type:"input_value",name:"COND",check:"Boolean"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops")}),this.appendStatementInput("DO").appendField(i.block.appendField),(0,n.setBuiltinHelpInfo)(this,"device_while")}};const o=pxt.blocks.getBlockDefinition("pxt_controls_for");s.Blocks.pxt_controls_for={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_value",name:"VAR",variable:o.block.variable,check:"Variable"},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(o.block.appendField);let e=this;(0,n.setHelpResources)(this,"pxt_controls_for",o.name,(function(){return pxt.U.rlf(o.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),o.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const i=this.getField("VAR");s.Names.equals(e,i.getText())&&i.setValue(t)}};const r=pxt.blocks.getBlockDefinition("controls_simple_for");s.Blocks.controls_simple_for={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"field_variable",name:"VAR",variable:r.block.variable},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(r.block.appendField);let e=this;(0,n.setHelpResources)(this,"controls_simple_for",r.name,(function(){return pxt.U.rlf(r.tooltip,e.getField("VAR").getText())}),r.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){const i=this.getField("VAR");s.Names.equals(e,i.getText())&&i.setValue(t)},customContextMenu:function(e){if(!this.isCollapsed()&&!this.inDebugWorkspace()){let t={enabled:!0},i=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",i);let n=s.utils.xml.createElement("field");n.textContent=i,n.setAttribute("name","VAR");let o=s.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(n),t.callback=s.ContextMenu.callbackFactory(this,o),e.push(t)}}};const a=pxt.blocks.getBlockDefinition(ts.pxtc.TS_BREAK_TYPE);s.Blocks[pxtc.TS_BREAK_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:a.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,n.setHelpResources)(this,ts.pxtc.TS_BREAK_TYPE,a.name,a.tooltip,a.url,e,void 0,void 0,!1)}};const l=pxt.blocks.getBlockDefinition(ts.pxtc.TS_CONTINUE_TYPE);s.Blocks[pxtc.TS_CONTINUE_TYPE]={init:function(){const e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:l.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,n.setHelpResources)(this,ts.pxtc.TS_CONTINUE_TYPE,l.name,l.tooltip,l.url,e,void 0,void 0,!1)}},s.Blocks[pxtc.COLLAPSED_BLOCK]={init:function(){this.jsonInit({message0:"...",inputsInline:!0,previousStatement:null,nextStatement:null,colour:"#cccccc"}),(0,n.setHelpResources)(this,ts.pxtc.COLLAPSED_BLOCK,"...",lf("a few blocks"),void 0,"#cccccc",void 0,void 0,!1)}};const c=pxt.blocks.getBlockDefinition("pxt_controls_for_of");s.Blocks.pxt_controls_for_of={init:function(){this.jsonInit({message0:c.block.message0,args0:[{type:"input_value",name:"VAR",variable:c.block.variable,check:"Variable"},{type:"input_value",name:"LIST",check:["Array","String"]}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(c.block.appendField);let e=this;(0,n.setHelpResources)(this,"pxt_controls_for_of",c.name,(function(){return pxt.Util.rlf(c.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")}),c.url,String(pxt.toolbox.getNamespaceColor("loops")))}};const u=pxt.blocks.getBlockDefinition("controls_for_of");s.Blocks.controls_for_of={init:function(){this.jsonInit({message0:u.block.message0,args0:[{type:"field_variable",name:"VAR",variable:u.block.variable},{type:"input_value",name:"LIST",check:"Array"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(u.block.appendField);let e=this;(0,n.setHelpResources)(this,"controls_for_of",u.name,(function(){return pxt.Util.rlf(u.tooltip,e.getField("VAR").getText())}),u.url,String(pxt.toolbox.getNamespaceColor("loops")))}}}},{"../help":66,blockly:197}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initMathRoundBlock=i.initMathOpBlock=i.initMath=void 0;const s=e("blockly"),n=e("../help"),o=e("../constants"),r=e("../composableMutations"),a=e("../fields/field_dropdown");function l(){const e=pxt.blocks.MATH_FUNCTIONS.unary.concat(pxt.blocks.MATH_FUNCTIONS.binary).concat(pxt.blocks.MATH_FUNCTIONS.infix),t=pxt.blocks.getBlockDefinition("math_js_op");function i(e,t){const i=e.appendValueInput("ARG"+(t?1:0));i.setCheck("Number"),t&&(i.connection.setShadowDom(function(){if(!c){(c=document.createElement("shadow")).setAttribute("type","math_number");const e=document.createElement("field");e.setAttribute("name","NUM"),e.textContent="0",c.appendChild(e)}return c}()),i.connection.respawnShadow_())}function l(e,t){let i=!!e.getInput("ARG1");t?(i&&e.moveInputBefore("op_dropdown","ARG1"),e.moveInputBefore("ARG0","op_dropdown")):(i&&e.moveInputBefore("ARG0","ARG1"),e.moveInputBefore("op_dropdown","ARG0"))}s.Blocks.math_js_op={init:function(){const s=this;s.setPreviousStatement(!1),s.setNextStatement(!1),s.setOutput(!0,"Number"),s.setOutputShape(o.provider.SHAPES.ROUND),s.setInputsInline(!0),s.appendDummyInput("op_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e])),(e=>function(e,t){return!function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.unary.indexOf(e)}(t)?e.getInput("ARG1")||i(e,!0):e.removeInput("ARG1",!0),l(e,function(e){return-1!==pxt.blocks.MATH_FUNCTIONS.infix.indexOf(e)}(t)),t}(s,e))),"OP"),i(s,!1),(0,r.appendMutation)(s,{mutationToDom:e=>{let t;for(let e=0;e<s.inputList.length;e++){const i=s.inputList[e];if("op_dropdown"===i.name){t=!1;break}if("ARG0"===i.name){t=!0;break}}return e.setAttribute("op-type",(s.getInput("ARG1")?t?"infix":"binary":"unary").toString()),e},domToMutation:e=>{if(e.hasAttribute("op-type")){const t=e.getAttribute("op-type");"unary"!=t&&i(s,!0),l(s,"infix"===t)}}})}},(0,n.installHelpResources)("math_js_op",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}let c;function u(){const e=pxt.blocks.ROUNDING_FUNCTIONS,t=pxt.blocks.getBlockDefinition("math_js_round");s.Blocks.math_js_round={init:function(){const i=this;i.setPreviousStatement(!1),i.setNextStatement(!1),i.setOutput(!0,"Number"),i.setOutputShape(o.provider.SHAPES.ROUND),i.setInputsInline(!0),i.appendDummyInput("round_dropdown").appendField(new a.FieldDropdown(e.map((e=>[t.block[e],e]))),"OP"),function(e){e.appendValueInput("ARG0").setCheck("Number")}(i)}},(0,n.installHelpResources)("math_js_round",t.name,(function(e){return t.tooltip[e.getFieldValue("OP")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))}i.initMath=function(e){const t=pxt.blocks.getBlockDefinition("math_op2"),i=t.tooltip;s.Blocks.math_op2={init:function(){this.jsonInit({message0:lf("%1 of %2 and %3"),args0:[{type:"field_dropdown",name:"op",options:[[lf("{id:op}min"),"min"],[lf("{id:op}max"),"max"]]},{type:"input_value",name:"x",check:"Number"},{type:"input_value",name:"y",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,n.setHelpResources)(this,"math_op2",t.name,(function(e){return i[e.getFieldValue("op")]}),t.url,pxt.toolbox.getNamespaceColor(t.category))},codeCard:(0,n.attachCardInfo)(e,"Math.min")};const r=pxt.blocks.getBlockDefinition("math_op3");s.Blocks.math_op3={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"x",check:"Number"}],inputsInline:!0,output:"Number",outputShape:o.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,n.setBuiltinHelpInfo)(this,"math_op3")},codeCard:(0,n.attachCardInfo)(e,"Math.abs")},["math_number","math_integer","math_whole_number","math_number_minmax"].forEach((e=>{const t=pxt.blocks.getBlockDefinition(e);(0,n.installHelpResources)(e,t.name,t.tooltip,t.url,"#fff","#fff","#fff")}));const a=s.Msg,c=pxt.blocks.getBlockDefinition("math_arithmetic"),h=c.tooltip;a.MATH_ADDITION_SYMBOL=c.block.MATH_ADDITION_SYMBOL,a.MATH_SUBTRACTION_SYMBOL=c.block.MATH_SUBTRACTION_SYMBOL,a.MATH_MULTIPLICATION_SYMBOL=c.block.MATH_MULTIPLICATION_SYMBOL,a.MATH_DIVISION_SYMBOL=c.block.MATH_DIVISION_SYMBOL,a.MATH_POWER_SYMBOL=c.block.MATH_POWER_SYMBOL,(0,n.installHelpResources)("math_arithmetic",c.name,(function(e){return h[e.getFieldValue("OP")]}),c.url,pxt.toolbox.getNamespaceColor(c.category));const d=pxt.blocks.getBlockDefinition("math_modulo");a.MATH_MODULO_TITLE=d.block.MATH_MODULO_TITLE,(0,n.installBuiltinHelpInfo)("math_modulo"),l(),u()},i.initMathOpBlock=l,i.initMathRoundBlock=u},{"../composableMutations":17,"../constants":18,"../fields/field_dropdown":33,"../help":66,blockly:197}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initOnStart=void 0;const s=e("blockly"),n=e("../fields"),o=e("../help");i.initOnStart=function(){const e=pxt.blocks.getBlockDefinition(ts.pxtc.ON_START_TYPE);if(s.Blocks[ts.pxtc.ON_START_TYPE]={init:function(){this.jsonInit({message0:e.block.message0,args0:[{type:"input_dummy"},{type:"input_statement",name:"HANDLER"}],colour:(pxt.appTarget.runtime?pxt.appTarget.runtime.onStartColor:"")||pxt.toolbox.getNamespaceColor("loops")}),(0,o.setHelpResources)(this,ts.pxtc.ON_START_TYPE,e.name,e.tooltip,e.url,String((pxt.appTarget.runtime?pxt.appTarget.runtime.onStartColor:"")||pxt.toolbox.getNamespaceColor("loops")),void 0,void 0,!!pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable)}},s.Blocks[pxtc.TS_STATEMENT_TYPE]={init:function(){let e,t,i=this;i.setColour("#717171"),i.setPreviousStatement(!0),i.setNextStatement(!0),i.setInputsInline(!1),i.domToMutation=e=>{const s=parseInt(e.getAttribute("numlines"));i.declaredVariables=e.getAttribute("declaredvars"),t=[];for(let i=0;i<s;i++){const s=e.getAttribute("line"+i);t.push(s)}i.setPythonEnabled(!1)},i.mutationToDom=()=>{let e=document.createElement("mutation");return t&&(t.forEach(((t,i)=>e.setAttribute("line"+i,t))),e.setAttribute("numlines",t.length.toString())),i.declaredVariables&&e.setAttribute("declaredvars",this.declaredVariables),e},i.setPythonEnabled=s=>{if(e!==s){for(;i.inputList.length;)i.removeInput(i.inputList[0].name);e=s,s?(i.appendDummyInput().appendField(pxt.Util.lf("<python code>"),"LINE0"),i.setTooltip(lf("A Python statement that could not be converted to blocks"))):(t.forEach(((e,t)=>{i.appendDummyInput().appendField(e,"LINE"+t)})),i.setTooltip(lf("A JavaScript statement that could not be converted to blocks")))}},i.getLines=()=>t,i.setEditable(!1),(0,o.setHelpResources)(this,pxtc.TS_STATEMENT_TYPE,lf("JavaScript statement"),lf("A JavaScript statement that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},s.Blocks[pxtc.TS_OUTPUT_TYPE]={init:function(){let e=this;e.setColour("#717171"),e.setPreviousStatement(!1),e.setNextStatement(!1),e.setOutput(!0),e.setEditable(!1),e.appendDummyInput().appendField(new n.FieldTsExpression(""),"EXPRESSION"),e.setPythonEnabled=t=>{e.getField("EXPRESSION").setPythonEnabled(t),t?e.setTooltip(lf("A Python expression that could not be converted to blocks")):e.setTooltip(lf("A JavaScript expression that could not be converted to blocks"))},(0,o.setHelpResources)(e,pxtc.TS_OUTPUT_TYPE,lf("JavaScript expression"),lf("A JavaScript expression that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock){const e=pxt.appTarget.runtime.pauseUntilBlock,t=pxt.blocks.getBlockDefinition(ts.pxtc.PAUSE_UNTIL_TYPE);s.Blocks[pxtc.PAUSE_UNTIL_TYPE]={init:function(){const i=e.color||pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:t.block.message0,args0:[{type:"input_value",name:"PREDICATE",check:"Boolean"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:i}),(0,o.setHelpResources)(this,ts.pxtc.PAUSE_UNTIL_TYPE,t.name,t.tooltip,t.url,i,void 0,void 0,!1)}}}}},{"../fields":65,"../help":66,blockly:197}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initText=void 0;const s=e("blockly"),n=e("../help"),o=e("../constants");i.initText=function(){const e=pxt.blocks.getBlockDefinition("text");(0,n.installHelpResources)("text",e.name,e.tooltip,e.url,"#fff","#fff","#fff");const t=pxt.blocks.getBlockDefinition("text_length");s.Msg.TEXT_LENGTH_TITLE=t.block.TEXT_LENGTH_TITLE,s.Blocks.text_length.init=function(){this.jsonInit({message0:s.Msg.TEXT_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["String"]}],output:"Number",outputShape:o.provider.SHAPES.ROUND})},(0,n.installBuiltinHelpInfo)("text_length");const i=pxt.blocks.getBlockDefinition("text_join");s.Msg.TEXT_JOIN_TITLE_CREATEWITH=i.block.TEXT_JOIN_TITLE_CREATEWITH,(0,n.installBuiltinHelpInfo)("text_join")}},{"../constants":18,"../help":66,blockly:197}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initVariables=void 0;const s=e("blockly"),n=e("../toolbox"),o=e("../help");i.initVariables=function(){s.FieldVariable.prototype.getVariableTypes_=()=>[""];let e=lf("{id:var}item");s.Variables.flyoutCategory=function(e){let t=[];if(!pxt.appTarget.appTheme.hideFlyoutHeadings){let e=(0,n.createFlyoutHeadingLabel)(lf("Variables"),pxt.toolbox.getNamespaceColor("variables"),pxt.toolbox.getNamespaceIcon("variables"));t.push(e)}let i=document.createElement("button");i.setAttribute("text",lf("Make a Variable...")),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){s.Variables.createVariableButtonHandler(e.getTargetWorkspace())})),t.push(i);let o=s.Variables.flyoutCategoryBlocks(e);return t.concat(o)},s.Variables.flyoutCategoryBlocks=function(e){let t=e.getVariablesOfType(""),i=[];if(t.length>0){let e=t[t.length-1];t.sort(s.VariableModel.compareByName);for(let e=0;e<t.length;e++){const o=t[e];if(s.Blocks.variables_get){let e=(0,n.mkVariableFieldBlock)("variables_get",o.getId(),o.type,o.name,!1);e.setAttribute("gap","8"),i.push(e)}}if(i[i.length-1].setAttribute("gap","24"),(s.Blocks.variables_change||s.Blocks.variables_set)&&i.unshift((0,n.createFlyoutGroupLabel)(lf("Your Variables"))),s.Blocks.variables_change){let t=s.Blocks.variables_get?20:8,o=(0,n.mkVariableFieldBlock)("variables_change",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=s.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=s.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let i=s.utils.xml.createElement("field");i.setAttribute("name","NUM"),i.appendChild(document.createTextNode("1")),t.appendChild(i),o.appendChild(e)}i.unshift(o)}if(s.Blocks.variables_set){let t=s.Blocks.variables_change?8:24,o=(0,n.mkVariableFieldBlock)("variables_set",e.getId(),e.type,e.name,!1);o.setAttribute("gap",t+"");{let e=s.utils.xml.createElement("value");e.setAttribute("name","VALUE");let t=s.utils.xml.createElement("shadow");t.setAttribute("type","math_number"),e.appendChild(t);let i=s.utils.xml.createElement("field");i.setAttribute("name","NUM"),i.appendChild(document.createTextNode("0")),t.appendChild(i),o.appendChild(e)}i.unshift(o)}}return i};const t=s.Msg,i=pxt.blocks.getBlockDefinition("variables_get");t.VARIABLES_GET_CREATE_SET=i.block.VARIABLES_GET_CREATE_SET,(0,o.installBuiltinHelpInfo)("variables_get"),(0,o.installBuiltinHelpInfo)("variables_get_reporter"),t.RENAME_VARIABLE=lf("Rename variable..."),t.DELETE_VARIABLE=lf('Delete the "%1" variable'),t.DELETE_VARIABLE_CONFIRMATION=lf('Delete %1 uses of the "%2" variable?'),t.NEW_VARIABLE_DROPDOWN=lf("New variable...");const r=pxt.blocks.getBlockDefinition("variables_set");t.VARIABLES_SET=r.block.VARIABLES_SET,t.VARIABLES_DEFAULT_NAME=e,t.VARIABLES_SET_CREATE_GET=lf("Create 'get %1'"),(0,o.installBuiltinHelpInfo)("variables_set");const a=pxt.blocks.getBlockDefinition("variables_change");s.Blocks.variables_change={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"field_variable",name:"VAR",variable:e},{type:"input_value",name:"VALUE",check:"Number"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("variables")}),(0,o.setBuiltinHelpInfo)(this,"variables_change")},customContextMenu:function(e){if(!this.inDebugWorkspace()){let t={enabled:this.workspace.remainingCapacity()>0},i=this.getField("VAR").getText();t.text=lf("Create 'get {0}'",i);let n=s.utils.xml.createElement("field");n.textContent=i,n.setAttribute("name","VAR");let o=s.utils.xml.createElement("block");o.setAttribute("type","variables_get"),o.appendChild(n),t.callback=s.ContextMenu.callbackFactory(this,o),e.push(t)}}},t.NEW_VARIABLE_TITLE=lf("New variable name:"),t.RENAME_VARIABLE_TITLE=lf("Rename all '%1' variables to:")}},{"../help":66,"../toolbox":120,blockly:197}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.renderCodeCard=void 0;const s=e("./render");i.renderCodeCard=function(e,t={}){const i=e.url?/^[^:]+:\/\//.test(e.url)?e.url:"/"+e.url.replace(/^\.?\/?/,""):e.youTubeId?`https://youtu.be/${e.youTubeId}`:void 0,n=!!i,o=(e,t,i="div",s="")=>{let n=document.createElement(i);return t&&(n.className=t),e&&e.appendChild(n),s&&n.appendChild(document.createTextNode(s+"")),n};let r=o(null,"ui "+(e.style||"card")+" "+(e.color||"")+(n?" link":""),n?"a":"div");if(r.setAttribute("role","option"),r.setAttribute("aria-selected","true"),n){const e=r;e.href=i,/^https?:\/\//.test(i)&&(e.target="_blank")}if(!t.hideHeader&&e.header){let t=o(r,"ui content "+(e.responsive?" tall desktop only":""));e.header&&o(t,"description","span",e.header)}const a=(t.shortName?e.shortName:"")||e.name;let l=o(r,"ui image"+(e.responsive?" tall landscape only":""));if(e.label){let t=document.createElement("label");t.className=`ui ${e.labelClass?e.labelClass:"orange right ribbon"} label`,t.textContent=e.label,l.appendChild(t)}if(e.blocksXml){const t=(0,s.render)(e.blocksXml);if(t){let e=o(l,"");e.setAttribute("style","width:100%; min-height:10em"),e.appendChild(t)}else console.error("failed to render blocks"),pxt.debug(e.blocksXml)}if(e.typeScript){let t=document.createElement("pre");t.appendChild(document.createTextNode(e.typeScript)),l.appendChild(t)}if(e.imageUrl||(e.youTubeId?`https://img.youtube.com/vi/${e.youTubeId}/0.jpg`:void 0)){let t=document.createElement("div");t.className="ui imagewrapper";let i=document.createElement("div");i.className="ui cardimage",i.style.backgroundImage=`url("${e.imageUrl}")`,i.title=a,i.setAttribute("role","presentation"),t.appendChild(i),l.appendChild(t)}if("file"==e.cardType){let e=o(r,"ui fileimage");l.appendChild(e)}if(a||e.description){let t=o(r,"ui content");if(a&&(r.setAttribute("aria-label",a),o(t,"header","div",a)),e.description){const i=o(t,"ui description"),s=e.description.split(".")[0]+".";i.appendChild(document.createTextNode(s))}}if(e.time){let t=o(r,"meta");e.time&&o(t,"date","span").appendChild(document.createTextNode(pxt.Util.timeSince(e.time)))}return e.extracontent&&o(r,"extra content","div").appendChild(document.createTextNode(e.extracontent)),r}},{"./render":118}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.workerOpAsync=i.compileExpression=i.callKey=i.compileAsync=i.compileBlockAsync=void 0;const s=e("blockly"),n=e("./environment"),o=e("./typeChecker"),r=e("./util"),a=e("../toolbox"),l=e("../legacyMutations"),c=e("./variables"),u=e("../fields");function h(e,t){if(e.type===ts.pxtc.ON_START_TYPE)return 0;const i=t.stdCallTable[e.type],s=d(t,e),n=1+ts.pxtc.Util.codalHash16(s);return i&&i.attrs.afterOnStart?n:-n}function d(e,t){return t.type==ts.pxtc.ON_START_TYPE?JSON.stringify({name:ts.pxtc.ON_START_TYPE}):t.type==ts.pxtc.FUNCTION_DEFINITION_TYPE?JSON.stringify({type:"function",name:t.getFieldValue("function_name")}):JSON.stringify(p(t)).replace(/"id"\s*:\s*"[^"]+"/g,"")}function p(e){const t=[],i=[];for(const n of e.inputList){for(const e of n.fieldRow)e.name&&t.push(e.getText());n.type===s.inputTypes.VALUE&&(n.connection.targetBlock()?i.push(p(n.connection.targetBlock())):i.push(null))}return{type:e.type,fields:t,inputs:i}}function g(e,t){e.setEnabled(t);const i=e.getDescendants(!1);for(const e of i)e.setEnabled(t)}function m(e,t){if(t.isInsertionMarker())return[];let i;const s=[];switch(e.stats[t.type]=(e.stats[t.type]||0)+1,v(t,s),t.type){case"controls_if":i=function(e,t,i){let s=[];for(let n=0;n<=t.elseifCount_;++n){let o=f(e,(0,r.getInputTargetBlock)(e,t,"IF"+n),i),a=_(e,(0,r.getInputTargetBlock)(e,t,"DO"+n)),l=pxt.blocks.mkText("if (");n>0&&((l=pxt.blocks.mkText("else if (")).glueToBlock=pxt.blocks.GlueMode.WithSpace),(0,r.append)(s,[l,o,pxt.blocks.mkText(")"),a])}if(t.elseCount_){let i=pxt.blocks.mkText("else");i.glueToBlock=pxt.blocks.GlueMode.WithSpace,(0,r.append)(s,[i,_(e,(0,r.getInputTargetBlock)(e,t,"ELSE"))])}return s}(e,t,s);break;case"pxt_controls_for":case"controls_for":case"controls_simple_for":i=function(e,t,i){let s=(0,r.getInputTargetBlock)(e,t,"TO"),n=(0,r.getInputTargetBlock)(e,t,"DO"),a=(0,r.getInputTargetBlock)(e,t,"BY"),l=(0,r.getInputTargetBlock)(e,t,"FROM"),c=!a||a.type.match(/^math_number/)&&1==B(a),u=(0,o.lookup)(e,t,(0,r.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+u.escapedName+" = "),l?f(e,l,i):pxt.blocks.mkText("0"),pxt.blocks.mkText("; "),pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"<=",f(e,s,i)),pxt.blocks.mkText("; "),c?pxt.blocks.mkText(u.escapedName+"++"):pxt.blocks.mkInfix(pxt.blocks.mkText(u.escapedName),"+=",f(e,a,i)),pxt.blocks.mkText(")"),_(e,n)]}(e,t,s);break;case"pxt_controls_for_of":case"controls_for_of":i=function(e,t,i){let s=(0,r.getInputTargetBlock)(e,t,"LIST"),n=(0,r.getInputTargetBlock)(e,t,"DO"),a=(0,o.lookup)(e,t,(0,r.getLoopVariableField)(e,t).getField("VAR").getText());return[pxt.blocks.mkText("for (let "+a.escapedName+" of "),f(e,s,i),pxt.blocks.mkText(")"),_(e,n)]}(e,t,s);break;case"variables_set":i=[T(e,t,s)];break;case"variables_change":i=[E(e,t,s)];break;case"controls_repeat_ext":i=function(e,t,i){let s=f(e,(0,r.getInputTargetBlock)(e,t,"TIMES"),i),n=_(e,(0,r.getInputTargetBlock)(e,t,"DO")),a=i=>!(0,o.lookup)(e,t,i),l="index";for(let e=2;!a(l);e++)l="index"+e;return[pxt.blocks.mkText("for (let "+l+" = 0; "),pxt.blocks.mkInfix(pxt.blocks.mkText(l),"<",s),pxt.blocks.mkText("; "+l+"++)"),n]}(e,t,s);break;case"device_while":i=function(e,t,i){let s=f(e,(0,r.getInputTargetBlock)(e,t,"COND"),i),n=_(e,(0,r.getInputTargetBlock)(e,t,"DO"));return[pxt.blocks.mkText("while ("),s,pxt.blocks.mkText(")"),n]}(e,t,s);break;case"procedures_defnoreturn":i=function(e,t,i){const s=(0,r.escapeVarName)(t.getFieldValue("NAME"),e,!0),n=(0,r.getInputTargetBlock)(e,t,"STACK");return[pxt.blocks.mkText("function "+s+"() "),_(e,n)]}(e,t);break;case"function_definition":i=function(e,t,i){const s=(0,r.escapeVarName)(t.getField("function_name").getText(),e,!0),n=(0,r.getInputTargetBlock)(e,t,"STACK"),a=t.getArguments().map((i=>{if("Array"==i.type){const s=(0,o.lookup)(e,t,i.name),n=(0,o.getConcreteType)(s.type),a=(null==n?void 0:n.type)&&"Array"!==n.type?n.type:"any[]";return`${(0,r.escapeVarName)(i.name,e)}: ${a}`}return`${(0,r.escapeVarName)(i.name,e)}: ${i.type}`})),l=(0,o.isFunctionRecursive)(e,t,!1);return[pxt.blocks.mkText(`function ${s} (${a.join(", ")})${l?": any":""}`),_(e,n)]}(e,t);break;case"procedures_callnoreturn":i=[A(e,t,s)];break;case"function_call":i=[w(e,t,s,!0)];break;case pxtc.TS_RETURN_STATEMENT_TYPE:i=[R(e,t,s)];break;case ts.pxtc.ON_START_TYPE:i=function(e,t){const i=_(e,(0,r.getInputTargetBlock)(e,t,"HANDLER"));return pxt.appTarget.compile&&pxt.appTarget.compile.onStartText&&i&&i.children&&i.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.ON_START_COMMENT}\n`))),i}(e,t).children;break;case pxtc.TS_STATEMENT_TYPE:i=function(e,t){return t.getLines().map((e=>pxt.blocks.mkText(e+"\n")))}(0,t);break;case pxtc.PAUSE_UNTIL_TYPE:i=function(e,t,i){const s=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;pxt.U.assert(!!s,"target has block enabled");const n=s.namespace,o=s.callName||"pauseUntil",r=x(e,t,{definitionName:"PREDICATE",actualName:"PREDICATE"},i),a=[pxt.blocks.mkGroup([pxt.blocks.mkText("() => "),r])];return n?[pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(n,o,a,!1))]:[pxt.blocks.mkStmt(pxt.blocks.H.mkCall(o,a,!1,!1))]}(e,t,s);break;case pxtc.TS_DEBUGGER_TYPE:i=function(e,t){return"1"==t.getFieldValue("ON_OFF")?[pxt.blocks.mkText("debugger;\n")]:[]}(0,t);break;case pxtc.TS_BREAK_TYPE:i=[pxt.blocks.mkText("break;\n")];break;case pxtc.TS_CONTINUE_TYPE:i=[pxt.blocks.mkText("continue;\n")];break;default:i=e.stdCallTable[t.type]?[N(e,t,s)]:[pxt.blocks.mkStmt(f(e,t,s))]}let n=i[i.length-1];return n&&!n.id&&(n.id=t.id),s.length&&function(e,t){const i=[];for(const t of e)for(const e of t.split("\n"))i.push(pxt.blocks.mkText(`// ${e}`)),i.push(pxt.blocks.mkNewLine());for(const e of i.reverse())t.unshift(e)}(s,i),i.forEach((e=>{!(e.type===pxt.blocks.NT.Block||e.type===pxt.blocks.NT.Prefix&&pxt.Util.startsWith(e.op,"//"))||t.type==pxtc.ON_START_TYPE&&e.id||(e.id=t.id)})),i}function f(e,t,i){let s;if(pxt.U.assert(null!=t),e.stats[t.type]=(e.stats[t.type]||0)+1,v(t,i),"placeholder"!=t.type&&t.isEnabled&&t.isEnabled())switch(t.type){case"math_number":case"math_integer":case"math_whole_number":case"math_number_minmax":s=function(e,t,i){return pxt.blocks.H.mkNumberLiteral(B(t))}(0,t);break;case"math_op2":s=function(e,t,i){let s=t.getFieldValue("op"),n=f(e,(0,r.getInputTargetBlock)(e,t,"x"),i),o=f(e,(0,r.getInputTargetBlock)(e,t,"y"),i);return pxt.blocks.H.mathCall(s,[n,o])}(e,t,i);break;case"math_op3":s=function(e,t,i){let s=f(e,(0,r.getInputTargetBlock)(e,t,"x"),i);return pxt.blocks.H.mathCall("abs",[s])}(e,t,i);break;case"math_arithmetic":case"logic_compare":case"logic_operation":s=function(e,t,i){let s=t.getFieldValue("OP"),n=(0,r.getInputTargetBlock)(e,t,"A"),a=(0,r.getInputTargetBlock)(e,t,"B"),l=[f(e,n,i),f(e,a,i)];(function(e){return-1!==["LT","LTE","GT","GTE","EQ","NEQ"].indexOf(e)})(s)&&D(e,n)&&D(e,a)&&pxt.blocks.flattenNode([l[0]]).output!==pxt.blocks.flattenNode([l[1]]).output&&(l=l.map((e=>pxt.blocks.H.mkParenthesizedExpression(pxt.blocks.mkGroup([e,pxt.blocks.mkText(" as any")])))));const c=(0,o.returnType)(e,n);if((0,o.isStringType)(c)){if("EQ"==s)return pxt.blocks.H.mkSimpleCall("==",l);if("NEQ"==s)return pxt.blocks.H.mkSimpleCall("!=",l)}else if((0,o.isBooleanType)(c))return pxt.blocks.H.mkSimpleCall(O[s],l);return pxt.U.assert(s in O),pxt.blocks.H.mkSimpleCall(O[s],l)}(e,t,i);break;case"math_modulo":s=function(e,t,i){let s=(0,r.getInputTargetBlock)(e,t,"DIVIDEND"),n=(0,r.getInputTargetBlock)(e,t,"DIVISOR"),o=[f(e,s,i),f(e,n,i)];return pxt.blocks.H.mkSimpleCall("%",o)}(e,t,i);break;case"logic_boolean":s=function(e,t,i){return pxt.blocks.H.mkBooleanLiteral("TRUE"==t.getFieldValue("BOOL"))}(0,t);break;case"logic_negate":s=function(e,t,i){let s=f(e,(0,r.getInputTargetBlock)(e,t,"BOOL"),i);return pxt.blocks.mkPrefix("!",[pxt.blocks.H.mkParenthesizedExpression(s)])}(e,t,i);break;case"variables_get":case"variables_get_reporter":s=function(e,t){const i=t.getField("VAR").getText();let s=(0,o.lookup)(e,t,i);return s?(s.firstReference||(s.firstReference=t),pxt.U.assert(null!=s&&null!=s.type),pxt.blocks.mkText(s.escapedName)):pxt.blocks.mkText(i)}(e,t);break;case"text":s=function(e,t,i){return pxt.blocks.H.mkStringLiteral(t.getFieldValue("TEXT"))}(0,t);break;case"text_join":s=function(e,t,i){let s,n=0;for(;;){const o=(0,r.getInputTargetBlock)(e,t,"ADD"+n);if(n++,!o){if(n<t.inputList.length)continue;break}const a=f(e,o,i);s=s?pxt.blocks.H.mkSimpleCall("+",[s,a]):0===o.type.indexOf("text")?a:pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),a])}return s||pxt.blocks.H.mkStringLiteral("")}(e,t,i);break;case"lists_create_with":s=function(e,t,i){let s=t.inputList.map((t=>t.connection&&t.connection.targetBlock()?f(e,t.connection.targetBlock(),i):void 0)).filter((e=>!!e));return pxt.blocks.H.mkArrayLiteral(s,!t.getInputsInline())}(e,t,i);break;case"lists_index_get":s=function(e,t,i){const s=f(e,(0,r.getInputTargetBlock)(e,t,"LIST"),i),n=f(e,(0,r.getInputTargetBlock)(e,t,"INDEX"),i);return pxt.blocks.mkGroup([s,pxt.blocks.mkText("["),n,pxt.blocks.mkText("]")])}(e,t,i);break;case"lists_index_set":s=function(e,t,i){const s=(0,r.getInputTargetBlock)(e,t,"LIST"),n=f(e,s,i),o=f(e,(0,r.getInputTargetBlock)(e,t,"INDEX"),i),a=f(e,(0,r.getInputTargetBlock)(e,t,"VALUE"),i),l=pxt.blocks.mkGroup([n,pxt.blocks.mkText("["),o,pxt.blocks.mkText("] = "),a]);return"lists_create_with"===s.type?b(l):l}(e,t,i);break;case"math_js_op":case"math_js_round":s=function(e,t,i){const s=t.getFieldValue("OP"),n=[f(e,(0,r.getInputTargetBlock)(e,t,"ARG0"),i)];return t.getInput("ARG1")&&n.push(f(e,(0,r.getInputTargetBlock)(e,t,"ARG1"),i)),pxt.blocks.H.mathCall(s,n)}(e,t,i);break;case pxtc.TS_OUTPUT_TYPE:s=function(e,t,i){return pxt.blocks.mkText(t.getFieldValue("EXPRESSION").trim())}(0,t);break;case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":s=function(e,t,i){const s=(0,r.escapeVarName)(t.getFieldValue("VALUE"),e);return pxt.blocks.mkText(s)}(e,t);break;case"function_call_output":s=w(e,t,i,!1);break;default:let n=e.stdCallTable[t.type];n?s=n.imageLiteral?I(e,t,n.imageLiteral,n.imageLiteralColumns,n.imageLiteralRows,n.namespace,n.f,(0,r.visibleParams)(n,(0,r.countOptionals)(t,n)).map((s=>x(e,t,s,i)))):L(e,t,n,i):(pxt.reportError("blocks","unable to compile expression",{details:t.type}),s=(0,o.defaultValueForType)((0,o.returnType)(e,t)))}else if("Array"===(0,o.find)((0,o.returnType)(e,t)).type){let i="lists_index_get"===t.getParent().type;if(!i){const s=e.stdCallTable[t.getParent().type];i=s&&s.isExpression}const n=pxt.blocks.mkText("[0]");s=i?n:b(n)}else s=(0,o.defaultValueForType)((0,o.returnType)(e,t));return s.id=t.id,s}function _(e,t){let i=[],s=t;for(;t;)t.isEnabled()&&(0,r.append)(i,m(e,t)),t=t.getNextBlock();return s&&e.blockDeclarations[s.id]&&e.blockDeclarations[s.id].filter((e=>!e.alreadyDeclared)).forEach((t=>{i.unshift(C(t,e.blocksInfo)),t.alreadyDeclared=n.BlockDeclarationType.Implicit})),pxt.blocks.mkBlock(i)}function b(e){const t=pxt.blocks.mkStmt(pxt.blocks.mkText(";"));return t.glueToBlock=pxt.blocks.GlueMode.NoSpace,pxt.blocks.mkGroup([t,e])}function T(e,t,i){let s=(0,r.getInputTargetBlock)(e,t,"VALUE"),a=(0,o.lookup)(e,t,t.getField("VAR").getText()),l=e.idToScope[t.id].declaredVars[a.name]===a&&!a.firstReference&&!a.alreadyDeclared;l&&(0,r.forEachChildExpression)(t,(t=>{"variables_get"===t.type&&(0,o.lookup)(e,t,t.getField("VAR").getText())===a&&(l=!1)}),!0);let c=f(e,s,i),u=a.escapedName+" = ";if(a.isAssigned=!0,l){a.alreadyDeclared=n.BlockDeclarationType.Assigned;const t=(0,o.getConcreteType)(a.type);if(u=`let ${a.escapedName} = `,t){const i=(0,o.getConcreteType)((0,o.returnType)(e,s));t.type!==i.type&&(u=`let ${a.escapedName}: ${t.type} = `)}}else a.firstReference||(a.firstReference=t);return pxt.blocks.mkStmt(pxt.blocks.mkText(u),c)}function E(e,t,i){let s=(0,r.getInputTargetBlock)(e,t,"VALUE"),n=(0,o.lookup)(e,t,t.getField("VAR").getText()),a=f(e,s,i),l=pxt.blocks.mkText(n.escapedName);return pxt.blocks.mkStmt(pxt.blocks.mkInfix(l,"+=",a))}function y(e,t,i,s,n,a){const c=s.map((i=>x(e,t,i,a))),u=(0,r.getInputTargetBlock)(e,t,"HANDLER"),h=_(e,u);let d;if(pxt.appTarget.compile&&pxt.appTarget.compile.emptyEventHandlerComments&&0===h.children.length&&h.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.HANDLER_COMMENT}`))),(0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.ObjectDestructuringMutator)d=t.mutation.compileMutation(e,a);else if(i.comp.handlerArgs.length){let s=(0,o.getEscapedCBParameters)(t,i,e);d=pxt.blocks.mkText(`function (${s.join(", ")})`)}return function(e,t,i,s,n,o,r=!1){let a;return n.noFinalNewline=!0,a=o?pxt.blocks.mkGroup([o,n]):pxt.blocks.mkGroup([pxt.blocks.mkText("function ()"),n]),r?pxt.blocks.mkStmt(pxt.blocks.H.extensionCall(i,s.concat([a]),!1)):t?pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(t,i,s.concat([a]),!1)):pxt.blocks.mkStmt(pxt.blocks.H.mkCall(i,s.concat([a]),!1))}(0,n,i.f,c,h,d,i.isExtensionMethod)}function I(e,t,i,s,n,o,r,a){a=void 0===a?[]:a;let l="\n";n=n||5,s=(s||5)*i;let c=t.getFieldValue("LEDS");c=c.replace(/[ `\n]+/g,"");for(let e=0;e<n;++e){for(let t=0;t<s;++t)t>0&&(l+=" "),l+="#"===c[e*s+t]?"#":".";l+="\n"}let u=pxt.blocks.H.mkStringLiteral(l);return u.canIndentInside=!0,pxt.blocks.H.namespaceCall(o,r,[u].concat(a),!1)}function k(e,t,i){let s=pxt.blocks.flattenNode(t);return P("format",{format:{input:s.output,pos:1}}).then((()=>({source:s.output,sourceMap:s.sourceMap,stats:e.stats,diagnostics:i||[]})))}function v(e,t){var i;const s=null===(i=e.getCommentText)||void 0===i?void 0:i.call(e);s&&t.push(s)}function C(e,t){const i=(0,o.getConcreteType)(e.type);let s,n="";if("null"==(s="Array"===i.type?pxt.blocks.mkText("[]"):(0,o.defaultValueForType)(i)).op||"[]"==s.op){let e=i.type;"Array"!==e&&"null[]"!==e||(e="number[]");let o=t.apis.byQName[e];o&&o.attributes.autoCreate?s=pxt.blocks.mkText(o.attributes.autoCreate+"()"):n=": "+e}return pxt.blocks.mkStmt(pxt.blocks.mkText("let "+e.escapedName+n+" = "),s)}function S(e,t,i,s,n){const o=a(e,n.x,n.x+n.width)||a(n.x,e,e+i),r=a(t,n.y,n.y+n.height)||a(n.y,t,t+s);return o&&r;function a(e,t,i){return e>=t&&e<=i}}i.compileBlockAsync=function(e,t){const i=e.workspace,s=(0,n.mkEnv)(i,t);(0,o.infer)(i&&i.getAllBlocks(!1),s,i);const r=m(s,e);return s.placeholders={},k(s,r)},i.compileAsync=function(e,t,i={}){const l=(0,n.mkEnv)(e,t,i),[u,p]=function(e,t,i){try{let l=t.getAllBlocks(!1);pxt.react.getTilemapProject&&pxt.react.getTilemapProject().removeInactiveBlockAssets(l.map((e=>e.id)));let u=t.getTopBlocks(!0);u=u.sort(((t,i)=>h(t,e)-h(i,e))),function(e,t,i){const n=s.Events.isEnabled();n&&s.Events.disable(),t.forEach((e=>e.setEnabled(!0)));const o={};function a(e,t){o[e]?g(t,!1):(g(t,!0),o[e]=t)}i.forEach((t=>{const i=e.stdCallTable[t.type];if(t.type==ts.pxtc.ON_START_TYPE)a(ts.pxtc.ON_START_TYPE,t);else{if((0,r.isFunctionDefinition)(t)||i&&i.attrs.blockAllowMultiple&&!i.attrs.handlerStatement)return;if(i&&i.hasHandler&&!i.attrs.handlerStatement)a(i.attrs.blockHandlerKey||d(e,t),t);else{let e=t;for(;e;)g(t,!1),e=e.getNextBlock()}}})),n&&s.Events.enable()}(e,l,u),l=l.filter((e=>e.isEnabled())),u=u.filter((e=>e.isEnabled())),(0,c.trackAllVariables)(u,e),(0,o.infer)(l,e,t);const p=[],f=function(e,t){if(!e.length||e.some((e=>!e.rendered)))return{orphans:t,idToComments:{}};const i=e.map((e=>{const t=e.getBoundingRectangle(),i=e.getHeightWidth();return{id:e.id,x:t.left,y:t.top,width:i.width,height:i.height}})),s={orphans:[],idToComments:{}};for(const e of t){const t=e.getBoundingRectangle(),n=e.getHeightWidth(),o=t.left,r=t.top;let a;for(const e of i)(S(o,r,n.width,n.height,e)||!a&&S(o-20,r-20,n.width+40,n.height+40,e))&&(a=e);a?(s.idToComments[a.id]||(s.idToComments[a.id]=[]),s.idToComments[a.id].push(e)):s.orphans.push(e)}return s}(u,t.getTopComments(!0));f.orphans.forEach((e=>(0,r.append)(p,$(e).children))),u.forEach((t=>{if(f.idToComments[t.id]&&f.idToComments[t.id].forEach((e=>{(0,r.append)(p,$(e).children)})),t.type==ts.pxtc.ON_START_TYPE)(0,r.append)(p,m(e,t));else{const i=pxt.blocks.mkBlock(m(e,t));i.type==pxt.blocks.NT.Block?(0,r.append)(p,i.children):p.push(i)}}));const _=[];e.enums.forEach((e=>{const i=t.getVariablesOfType(e.name);if(i&&i.length){const t=i.map((e=>{const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}));t.sort(((e,t)=>e[1]-t[1]));const s=[];let n=-1;t.forEach((([t,i],o)=>{let r;if(e.isBitMask){const e=Math.log2(i);e>=0&&Math.floor(e)===e&&(r=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkSimpleCall("<<",[pxt.blocks.H.mkNumberLiteral(1),pxt.blocks.H.mkNumberLiteral(e)])))}else if(e.isHash){const e=ts.pxtc.Util.codalHash16(t.toLowerCase());r=pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(e))}r||(r=i===n+1?pxt.blocks.mkText(t):pxt.blocks.H.mkAssign(pxt.blocks.mkText(t),pxt.blocks.H.mkNumberLiteral(i))),s.push(r),n=i}));const o=pxt.blocks.mkCommaSep(s,!0);o.glueToBlock=pxt.blocks.GlueMode.NoSpace,_.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`enum ${e.name}`),pxt.blocks.mkBlock([o])]))}})),e.kinds.forEach((e=>{const i=t.getVariablesOfType("KIND_"+e.name);if(i&&i.length){const t=i.map((e=>e.name)).filter((t=>-1===e.initialMembers.indexOf(t)));t.length&&_.push(pxt.blocks.mkGroup([pxt.blocks.mkText(`namespace ${e.name}`),pxt.blocks.mkBlock(t.map((t=>pxt.blocks.mkStmt(pxt.blocks.mkText(`export const ${t} = ${e.name}.${e.createFunctionName}()`)))))]))}}));const b=e.allVariables.filter((e=>!e.alreadyDeclared)).map((e=>C(e,i)));return e.allVariables.filter((e=>e.alreadyDeclared===n.BlockDeclarationType.Implicit&&!e.isAssigned)).forEach((t=>{const i=(0,o.getConcreteType)(t.type);"string"===i.type||"number"===i.type||"boolean"===i.type||(0,a.isArrayType)(i.type)||e.diagnostics.push({blockId:t.firstReference&&t.firstReference.id,message:lf("Variable '{0}' is never assigned",t.name)})})),[_.concat(b.concat(p)),e.diagnostics]}catch(t){let i=t.block;if(!i)throw t;i.setWarningText(t+""),e.errors.push(i)}finally{e.placeholders={}}return[null,null]}(l,e,t);return k(l,u,p)},i.callKey=d,i.compileExpression=f;let O={ADD:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",LT:"<",LTE:"<=",GT:">",GTE:">=",AND:"&&",OR:"||",EQ:"==",NEQ:"!=",POWER:"**"};function A(e,t,i){const s=(0,r.escapeVarName)(t.getFieldValue("NAME"),e,!0);return pxt.blocks.mkStmt(pxt.blocks.mkText(s+"()"))}function w(e,t,i,s){const n=(0,r.escapeVarName)(t.getField("function_name").getText(),e,!0),o=!t.getInputsInline(),a=t.getArguments().map((e=>({actualName:e.name,definitionName:e.id}))).map((s=>x(e,t,s,i))),l=pxt.blocks.H.stdCall(n,a,o);return s?pxt.blocks.mkStmt(l):l}function R(e,t,i){const s=(0,r.getInputTargetBlock)(e,t,"RETURN_VALUE");return s&&"placeholder"!=s.type?pxt.blocks.mkStmt(pxt.blocks.mkText("return "),f(e,s,i)):pxt.blocks.mkStmt(pxt.blocks.mkText("return"))}function N(e,t,i){const s=e.stdCallTable[t.type];return s.imageLiteral?pxt.blocks.mkStmt(I(0,t,s.imageLiteral,s.imageLiteralColumns,s.imageLiteralRows,s.namespace,s.f,(0,r.visibleParams)(s,(0,r.countOptionals)(t,s)).map((s=>x(e,t,s,i))))):s.hasHandler?y(e,t,s,function(e,t){return(0,r.visibleParams)(e,(0,r.countOptionals)(t,e)).filter((e=>!!e.definitionName))}(s,t),s.namespace,i):pxt.blocks.mkStmt(L(e,t,s,i))}function x(e,t,i,n,a=!1){let l=t.getFieldValue(i.definitionName);if(null!=l){const n=t.getField(i.definitionName);if(n instanceof s.FieldTextInput||n instanceof u.FieldTextInput)return pxt.blocks.H.mkStringLiteral(l);if(n instanceof u.FieldTilemap&&!n.isGreyBlock){const t=pxt.react.getTilemapProject(),i=n.getValue();if(i.startsWith("tilemap`"))return pxt.blocks.mkText(i);if(e.options.emitTilemapLiterals)try{const e=pxt.sprite.decodeTilemap(i,"typescript",t);if(e){const[i]=t.createNewTilemapFromData(e);return pxt.blocks.mkText(`tilemap\`${i}\``)}}catch(e){}}const o=e.blocksInfo.apis.byQName[i.type];if(o&&o.attributes.emitAsConstant)for(const t of Object.keys(e.blocksInfo.apis.byQName)){const i=e.blocksInfo.apis.byQName[t];if(i&&i.attributes&&i.attributes.enumIdentity===l)return pxt.blocks.mkText(t)}let r=pxt.blocks.mkText(l);return r.canIndentInside="string"==typeof l&&l.indexOf("\n")>=0,r}{(0,o.attachPlaceholderIf)(e,t,i.definitionName);const s=(0,r.getInputTargetBlock)(e,t,i.definitionName);return a&&"lists_create_with"===s.type?b(f(e,s,n)):i.shadowOptions&&i.shadowOptions.toString&&!(0,o.isStringType)((0,o.returnType)(e,s))?pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),pxt.blocks.H.mkParenthesizedExpression(f(e,s,n))]):f(e,s,n)}}function L(e,t,i,s){let n;if((0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.RestParameterMutator)n=t.mutation.compileMutation(e,s).children;else{if("ENUM_GET"===i.attrs.shim){const e=i.attrs.enumName,s=t.getFieldValue("MEMBER").replace(/^\d+/,"");return pxt.blocks.H.mkPropertyAccess(s,pxt.blocks.mkText(e))}if("KIND_GET"===i.attrs.shim){const s=e.kinds.filter((e=>e.blockId===i.attrs.blockId))[0];return pxt.blocks.H.mkPropertyAccess(t.getFieldValue("MEMBER"),pxt.blocks.mkText(s.name))}n=(0,r.visibleParams)(i,(0,r.countOptionals)(t,i)).map(((n,o)=>x(e,t,n,s,i.isExtensionMethod&&0===o&&!i.isExpression)))}let o=i.namespace,a=i.f;if(i.attrs.blockAliasFor){const t=e.blocksInfo.apis.byQName[i.attrs.blockAliasFor];t&&(a=t.name,o=t.namespace)}const c=!t.getInputsInline();if(i.isIdentity)return n[0];if(i.property)return pxt.blocks.H.mkPropertyAccess(a,n[0]);if("@get@"==a)return pxt.blocks.H.mkPropertyAccess(n[1].op.replace(/.*\./,""),n[0]);if("@set@"==a)return pxt.blocks.H.mkAssign(pxt.blocks.H.mkPropertyAccess(n[1].op.replace(/.*\./,"").replace(/@set/,""),n[0]),n[2]);if("@change@"==a)return pxt.blocks.H.mkSimpleCall("+=",[pxt.blocks.H.mkPropertyAccess(n[1].op.replace(/.*\./,"").replace(/@set/,""),n[0]),n[2]]);if(i.isExtensionMethod){if(i.attrs.defaultInstance){let o;(0,r.isMutatingBlock)(t)&&t.mutation.getMutationType()===l.MutatorTypes.DefaultInstanceMutator&&(o=t.mutation.compileMutation(e,s)),o?n.unshift(o):n.unshift(pxt.blocks.mkText(i.attrs.defaultInstance))}return pxt.blocks.H.extensionCall(a,n,c)}return o?pxt.blocks.H.namespaceCall(o,a,n,c):pxt.blocks.H.stdCall(a,n,c)}function $(e){const t=e.getContent();return pxt.blocks.H.mkMultiComment(t.trim())}function D(e,t){return M(e,t)||"logic_boolean"===t.type||"text"===t.type}function M(e,t){if(!t)return!1;if("math_number"===t.type||"math_integer"===t.type||"math_number_minmax"===t.type||"math_whole_number"===t.type)return!0;const i=e.stdCallTable[t.type];if(!i)return!1;const{comp:s}=i;if("TD_ID"===i.attrs.shim&&1===s.parameters.length){const i=t.getFieldValue(s.parameters[0].definitionName);return i?!isNaN(parseInt(i)):M(e,(0,r.getInputTargetBlock)(e,t,s.parameters[0].definitionName))}return!1}function B(e){let t=e.getFieldValue("math_number_minmax"===e.type?"SLIDER":"NUM");const i=parseFloat(t);return function(e,t){isFinite(e)&&!isNaN(e)||function(e,t){let i=new Error(e);throw i.block=t,i}(lf("Number entered is either too large or too small"),t)}(i,e),i}function P(e,t){return pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t)}i.workerOpAsync=P},{"../fields":65,"../legacyMutations":70,"../toolbox":120,"./environment":13,"./typeChecker":14,"./util":15,"./variables":16,blockly:197}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mkEnv=i.emptyEnv=i.BlockDeclarationType=i.Point=void 0;const s=e("./util");var n;function o(e,t){return{workspace:e,options:t,stdCallTable:{},userFunctionReturnValues:{},diagnostics:[],errors:[],renames:{oldToNew:{},takenNames:{},oldToNewFunctions:{}},stats:{},enums:[],kinds:[],idToScope:{},blockDeclarations:{},allVariables:[],blocksInfo:null,placeholders:{}}}i.Point=class{constructor(e,t,i,s,n){this.link=e,this.type=t,this.parentType=i,this.childType=s,this.isArrayType=n}},(n=i.BlockDeclarationType||(i.BlockDeclarationType={}))[n.None=0]="None",n[n.Argument=1]="Argument",n[n.Assigned=2]="Assigned",n[n.Implicit=3]="Implicit",i.emptyEnv=o,i.mkEnv=function(e,t,i={}){let n=o(e,i);return n.blocksInfo=t,t&&(Object.keys(t.apis.byQName).forEach((e=>{const i=t.apis.byQName[e];!i.pkg||6!==i.kind&&3!==i.kind&&5!==i.kind&&4!==i.kind||(n.renames.takenNames[i.qName]=!0)})),t.enumsByName&&Object.keys(t.enumsByName).forEach((e=>n.enums.push(t.enumsByName[e]))),t.kindsByName&&Object.keys(t.kindsByName).forEach((e=>n.kinds.push(t.kindsByName[e]))),t.blocks.forEach((e=>{if(n.stdCallTable[e.attributes.blockId])return void pxt.reportError("blocks","function already defined",{details:e.attributes.blockId,qualifiedName:e.qName,packageName:e.pkg});n.renames.takenNames[e.namespace]=!0;const t=pxt.blocks.compileInfo(e),i=!!t.thisParameter;n.stdCallTable[e.attributes.blockId]={namespace:e.namespace,f:e.name,comp:t,attrs:e.attributes,isExtensionMethod:i,isExpression:e.retType&&"void"!==e.retType,imageLiteral:e.attributes.imageLiteral||e.attributes.gridLiteral,imageLiteralColumns:e.attributes.imageLiteralColumns,imageLiteralRows:e.attributes.imageLiteralRows,hasHandler:pxt.blocks.hasHandler(e),property:!e.parameters,isIdentity:"TD_ID"==e.attributes.shim}})),e.getTopBlocks(!1).filter(s.isFunctionDefinition).forEach((e=>{const t="procedures_defnoreturn"===e.type?e.getFieldValue("NAME"):e.getField("function_name").getText();(0,s.escapeVarName)(t,n,!0)}))),n}},{"./util":15}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isBooleanType=i.isStringType=i.defaultValueForType=i.getEscapedCBParameters=i.isFunctionRecursive=i.getDeclaredVariables=i.lookup=i.getConcreteType=i.attachPlaceholderIf=i.returnType=i.find=i.mkPoint=i.infer=void 0;const s=e("./environment"),n=e("./util"),o=e("../plugins/functions");function r(e,t){let i=g(e),s=g(t);if(O(null==i.link&&null==s.link),i==s)return;if(m(i))return void b(e.type,t.type);if(m(s))return b(e.type,t.type),e.type=null,e.link=s,i.link=s,void(i.isArrayType=s.isArrayType);if(i.childType&&s.childType){const e=i.childType;i.childType=null,r(e,s.childType)}else i.childType&&!s.childType&&(s.childType=i.childType);if(i.parentType&&s.parentType){const e=i.parentType;i.parentType=null,r(e,s.parentType)}else!i.parentType||s.parentType||s.type||(s.parentType=i.parentType);let n=b(i.type,s.type);e.link=s,i.link=s,i.isArrayType=s.isArrayType,e.type=null,t.type=n}function a(e,t,i,s){E(e,t,i);try{r(f(e,(0,n.getInputTargetBlock)(e,t,i)),s)}catch(e){}}function l(e,t=!1){return new s.Point(null,e,null,null,t)}i.infer=function(e,t,i){function s(e){var t,i;const s=null===(i=null===(t=e.connection)||void 0===t?void 0:t.getCheck())||void 0===i?void 0:i[0];return e.name?s||"T":void 0}function o(e,i){let o=e.inputList.filter((e=>"T"===s(e)));if(o.length){const s=(0,n.getInputTargetBlock)(t,e,o[0].name);if(s){const n=f(t,s),o=n.type?p(f(t,s).type+"[]"):p(null);return y(o,n),a(t,e,i,o),!0}}return!1}e&&e.filter((e=>e.isEnabled())).forEach((e=>{try{switch(e.type){case"math_op2":a(t,e,"x",p(c.type)),a(t,e,"y",p(c.type));break;case"math_op3":a(t,e,"x",p(c.type));break;case"math_arithmetic":case"logic_compare":switch(e.getFieldValue("OP")){case"ADD":case"MINUS":case"MULTIPLY":case"DIVIDE":case"LT":case"LTE":case"GT":case"GTE":case"POWER":a(t,e,"A",p(c.type)),a(t,e,"B",p(c.type));break;case"AND":case"OR":E(t,e,"A",u.type),E(t,e,"B",u.type);break;case"EQ":case"NEQ":E(t,e,"A"),E(t,e,"B");let i=f(t,(0,n.getInputTargetBlock)(t,e,"A")),s=f(t,(0,n.getInputTargetBlock)(t,e,"B"));try{r(i,s)}catch(e){}}break;case"logic_operation":E(t,e,"A",u.type),E(t,e,"B",u.type);break;case"logic_negate":E(t,e,"BOOL",u.type);break;case"controls_if":for(let i=0;i<=e.elseifCount_;++i)E(t,e,"IF"+i,u.type);break;case"pxt_controls_for":case"controls_simple_for":a(t,e,"TO",p(c.type));break;case"pxt_controls_for_of":case"controls_for_of":y(f(t,(0,n.getInputTargetBlock)(t,e,"LIST")),k(t,e,(0,n.getLoopVariableField)(t,e).getField("VAR").getText()).type);break;case"variables_set":case"variables_change":let i=k(t,e,e.getField("VAR").getText()).type;E(t,e,"VALUE");let l=(0,n.getInputTargetBlock)(t,e,"VALUE");if(l){let s=function(e,t){var i;const s=null===(i=t.outputConnection)||void 0===i?void 0:i.getCheck();return(null==s?void 0:s.length)&&"Array"!==s[0]&&"T"!==s[0]?s.map((e=>p(e))):[f(e,t)]}(t,l);const n=g(i);if(n.type&&s.slice(1).some((e=>e.type===n.type)))i.link=g(s[0]);else try{r(i,s[0])}catch(e){}}break;case"controls_repeat_ext":a(t,e,"TIMES",p(c.type));break;case"device_while":E(t,e,"COND",u.type);break;case"lists_index_get":a(t,e,"LIST",p("Array")),a(t,e,"INDEX",p(c.type)),y(f(t,(0,n.getInputTargetBlock)(t,e,"LIST")),f(t,e));break;case"lists_index_set":a(t,e,"LIST",p("Array")),E(t,e,"VALUE"),o(e,"LIST"),a(t,e,"INDEX",p(c.type));break;case"function_definition":_(t,e.getField("function_name").getText());break;case"function_call":case"function_call_output":e.getArguments().forEach((i=>{a(t,e,i.id,p(i.type))}));break;case pxtc.TS_RETURN_STATEMENT_TYPE:E(t,e,"RETURN_VALUE");break;case pxtc.PAUSE_UNTIL_TYPE:a(t,e,"PREDICATE",u);break;default:if(e.type in t.stdCallTable){const i=t.stdCallTable[e.type];if("ENUM_GET"===i.attrs.shim||"KIND_GET"===i.attrs.shim)return;(0,n.visibleParams)(i,(0,n.countOptionals)(e,i)).forEach(((n,r)=>{var l;const c=i.isExtensionMethod&&0===r;if(n.definitionName&&!e.getFieldValue(n.definitionName)){let i=e.inputList.find((e=>e.name==n.definitionName));const r=null===(l=null==i?void 0:i.connection)||void 0===l?void 0:l.getCheck();if(r){if(c&&"Array"===s(i)&&o(e,n.definitionName))return;for(let i=0;i<r.length;i++)try{let s=r[i];a(t,e,n.definitionName,p(s));break}catch(e){}}}}))}}}catch(i){const s=i.block||e;s.setWarningText(i+""),t.errors.push(s)}})),t.allVariables.forEach((e=>{null==I(e.type).type&&(e.isFunctionParameter?e.type.isArrayType&&(e.type.type="any[]"):r(e.type,p(e.type.isArrayType?"number[]":c.type)))}))},i.mkPoint=l;const c=l("number"),u=l("boolean"),h=l("string"),d=l("void");function p(e){if(!e)return l(e);switch(e.toLowerCase()){case"number":return c;case"boolean":return u;case"string":return h;case"void":return d;default:return l(e)}}function g(e){return e.link?g(e.link):e}function m(e){return e===c||e===u||e===h||e===d}function f(e,t){var i,s;if(O(null!=t),function(e){return"placeholder"==e.type||e.type===pxtc.TS_OUTPUT_TYPE}(t))return t.p||(t.p=l(null)),g(t.p);if("variables_get"==t.type)return g(k(e,t,t.getField("VAR").getText()).type);if("function_call_output"==t.type)return function(e,t){return _(e,t.getField("function_name").getText())}(e,t);if(!t.outputConnection)return p(d.type);const n=(null===(s=null===(i=t.outputConnection)||void 0===i?void 0:i.getCheck())||void 0===s?void 0:s[0])||"T";if("Array"===n){const i=t.outputConnection.getCheck();if(i.length>1)return p(i[1]);let s;if("lists_create_with"==t.type){if(t.inputList&&t.inputList.length)for(const i of t.inputList)if(i.connection&&i.connection.targetBlock()){let t=g(f(e,i.connection.targetBlock()));if(t){if(t.parentType)return t.parentType;y(s=t.type?p(t.type+"[]"):l(null),t);break}}}else"argument_reporter_array"==t.type&&(s||(s=k(e,t,t.getFieldValue("VALUE")).type));return s&&(s.isArrayType=!0),s||l(null,!0)}if("T"===n){const i=e.stdCallTable[t.type],s="lists_index_get"===t.type;if(s||i&&i.comp.thisParameter){let n;if((n=s?t.inputList.find((e=>"LIST"===e.name)):t.inputList.find((e=>e.name===i.comp.thisParameter.definitionName))).connection&&n.connection.targetBlock()){const t=f(e,n.connection.targetBlock());if(t.childType)return t.childType;const i=T(t.type)&&"Array"!==t.type?l(t.type.substr(0,t.type.length-2)):l(null);return y(t,i),i}}return l(null)}return p(n)}function _(e,t){if(!e.userFunctionReturnValues[t]){const i=(0,o.getDefinition)(t,e.workspace);let s=l("void");if(C(e,i,!0))s=l("any");else{const o=[];for(const t of i.getDescendants(!1))"function_return"===t.type&&(E(e,t,"RETURN_VALUE"),o.push(f(e,(0,n.getInputTargetBlock)(e,t,"RETURN_VALUE"))));if(o.length)try{const e=l(null);for(const t of o)r(e,t);s=e}catch(n){e.diagnostics.push({blockId:i.id,message:pxt.Util.lf("Function '{0}' has an invalid return type",t)}),s=l("any")}}e.userFunctionReturnValues[t]=s}return e.userFunctionReturnValues[t]}function b(e,t){if(null==e||"Array"===e&&T(t))return t;if(null==t||"Array"===t&&T(e))return e;if(e==t)return e;throw new Error("cannot mix "+e+" with "+t)}function T(e){return e&&(-1!==e.indexOf("[]")||"Array"==e)}function E(e,t,i,s){const n=t.getInputTargetBlock(i);n?n.type!==pxtc.TS_OUTPUT_TYPE||n.p||(n.p=l(null)):(e.placeholders[t.id]||(e.placeholders[t.id]={}),e.placeholders[t.id][i]||(e.placeholders[t.id][i]=function(e,t,i){return{type:"placeholder",p:l(i||null),workspace:e.workspace,parentBlock_:t,getParent:()=>t}}(e,t,s)))}function y(e,t){const i=g(e),s=g(t);i.childType?r(i.childType,s):i.type||(i.childType=s),s.parentType?r(s.parentType,i):s.type||(s.parentType=i),T(i.type)&&(i.isArrayType=!0)}function I(e,t=[]){const i=g(e);if(-1===t.indexOf(i)&&(t.push(i),!i.type||"Array"===i.type)){if(i.parentType){const e=I(i.parentType,t);if(e.type&&"Array"!==e.type)return T(e.type)?i.type=e.type.substr(0,e.type.length-2):i.type=e.type,i}if(i.childType){const e=I(i.childType,t);if(e.type)return i.type=e.type+"[]",i}}return i}function k(e,t,i){return v(i,e.idToScope[t.id])}function v(e,t){return t&&t.declaredVars[e]?t.declaredVars[e]:t&&t.parent?v(e,t.parent):null}function C(e,t,i){const s=(0,n.getFunctionName)(t),r={};return function t(a){let l;l=i?a.getDescendants(!1).filter((e=>"function_return"==e.type)).map((t=>(0,n.getInputTargetBlock)(e,t,"RETURN_VALUE"))).filter((e=>e&&"function_call_output"===e.type)):a.getDescendants(!1).filter((e=>"function_call_output"==e.type));for(const e of l){const i=(0,n.getFunctionName)(e);if(i===s)return!0;if(!r[i]&&(r[i]=!0,t((0,o.getDefinition)(i,e.workspace))))return!0}return!1}(t)}function S(e,t,i){let s=[];if(t.attrs.draggableParameters)for(let o=0;o<t.comp.handlerArgs.length;o++){const r=t.comp.handlerArgs[o];let a;const c=(0,n.getInputTargetBlock)(i,e,"HANDLER_DRAG_PARAM_"+r.name);if(null===(a="reporter"===t.attrs.draggableParameters?c&&c.getFieldValue("VALUE"):c&&c.getField("VAR").getText()))break;s.push({name:a,type:l(r.type)})}else for(let i=0;i<t.comp.handlerArgs.length;i++){const n=t.comp.handlerArgs[i],o=e.getField("HANDLER_"+n.name),r=o&&o.getText();if(null===r)break;s.push({name:r,type:l(n.type)})}return s}function O(e){if(!e)throw new Error("Assertion failure")}i.find=g,i.returnType=f,i.attachPlaceholderIf=E,i.getConcreteType=I,i.lookup=k,i.getDeclaredVariables=function(e,t){switch(e.type){case"pxt_controls_for":case"controls_simple_for":return[{name:(0,n.getLoopVariableField)(t,e).getField("VAR").getText(),type:c}];case"pxt_controls_for_of":case"controls_for_of":return[{name:(0,n.getLoopVariableField)(t,e).getField("VAR").getText(),type:l(null)}];case"function_definition":return e.getArguments().filter((e=>"Array"===e.type)).map((e=>{const t=l(null);return t.isArrayType=!0,{name:e.name,type:t,isFunctionParameter:!0}}))}if((0,n.isMutatingBlock)(e)){const t=e.mutation.getDeclaredVariables();if(t)return Object.keys(t).map((e=>({name:e,type:l(t[e])})))}let i=t.stdCallTable[e.type];return i&&i.comp.handlerArgs.length?S(e,i,t):[]},i.isFunctionRecursive=C,i.getEscapedCBParameters=function(e,t,i){return S(e,t,i).map((t=>k(i,e,t.name).escapedName))},i.defaultValueForType=function(e){if(null==e.type&&(r(e,p(c.type)),e=g(e)),T(e.type)||e.isArrayType)return pxt.blocks.mkText("[]");switch(e.type){case"boolean":return pxt.blocks.H.mkBooleanLiteral(!1);case"number":return pxt.blocks.H.mkNumberLiteral(0);case"string":return pxt.blocks.H.mkStringLiteral("");default:return pxt.blocks.mkText("null")}},i.isStringType=function(e){return e===h},i.isBooleanType=function(e){return e===u}},{"../plugins/functions":93,"./environment":13,"./util":15}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isFunctionDefinition=i.append=i.escapeVarName=i.isMutatingBlock=i.getInputTargetBlock=i.countOptionals=i.visibleParams=i.getFunctionName=i.getLoopVariableField=i.printScope=i.forEachStatementInput=i.forEachChildExpression=void 0;const s=e("blockly");function n(e){let t="";for(let i=0;i<e;i++)t+="    ";return t}function o(e,t,i){var s;return t.getInputTargetBlock(i)||(null===(s=e.placeholders[t.id])||void 0===s?void 0:s[i])}i.forEachChildExpression=function e(t,i,n=!1){t.inputList.filter((e=>e.type===s.inputTypes.VALUE)).forEach((t=>{t.connection&&t.connection.targetBlock()&&(i(t.connection.targetBlock()),n&&e(t.connection.targetBlock(),i,n))}))},i.forEachStatementInput=function(e,t){e.inputList.filter((e=>e.type===s.inputTypes.STATEMENT)).forEach((e=>{e.connection&&e.connection.targetBlock()&&t(e.connection.targetBlock())}))},i.printScope=function e(t,i=0){const s=Object.keys(t.declaredVars).map((e=>`${e}(${t.declaredVars[e].id})`)).join(",");t.referencedVars.join(", "),console.log(`${n(i)}SCOPE: ${t.firstStatement?t.firstStatement.type:"TOP-LEVEL"}`),s.length&&console.log(`${n(i)}DECS: ${s}`),t.children.forEach((t=>e(t,i+1)))},i.getLoopVariableField=function(e,t){return"pxt_controls_for"==t.type||"pxt_controls_for_of"==t.type?o(e,t,"VAR"):t},i.getFunctionName=function(e){return e.getField("function_name").getText()},i.visibleParams=function({comp:e},t){const i=[];return e.thisParameter&&i.push(e.thisParameter),e.parameters.forEach((e=>{e.isOptional&&t>0?(i.push(e),--t):e.isOptional||i.push(e)})),i},i.countOptionals=function(e,t){if(t.attrs.compileHiddenArguments)return t.comp.parameters.reduce(((e,t)=>(t.isOptional&&e++,e)),0);if(e.mutationToDom){const t=e.mutationToDom();if(t.hasAttribute("_expanded")){const e=parseInt(t.getAttribute("_expanded"));return isNaN(e)?0:Math.max(e,0)}}return 0},i.getInputTargetBlock=o,i.isMutatingBlock=function(e){return!!e.mutation},i.escapeVarName=function(e,t,i=!1){if(!e)return"_";if(i){if(t.renames.oldToNewFunctions[e])return t.renames.oldToNewFunctions[e]}else if(t.renames.oldToNew[e])return t.renames.oldToNew[e];let s=ts.pxtc.escapeIdentifier(e);if(t.renames.takenNames[s]){let e=2;for(;t.renames.takenNames[s+e];)e++;s+=e}return i?(t.renames.oldToNewFunctions[e]=s,t.renames.takenNames[s]=!0):t.renames.oldToNew[e]=s,s},i.append=function(e,t){e.push.apply(e,t)},i.isFunctionDefinition=function(e){return"procedures_defnoreturn"===e.type||"function_definition"===e.type}},{blockly:197}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.trackAllVariables=void 0;const s=e("blockly"),n=e("./environment"),o=e("./typeChecker"),r=e("./util");function a(e,t){const i=Object.keys(e.declaredVars);if(i.length){const s=i.map((t=>e.declaredVars[t]));e.firstStatement&&(t.blockDeclarations[e.firstStatement.id]=s.concat(t.blockDeclarations[e.firstStatement.id]||[])),s.forEach((e=>t.allVariables.push(e)))}e.children.forEach((e=>a(e,t)))}function l(e,t){let i;if(-1!==e.referencedVars.indexOf(t))return e;for(const s of e.children)if(c(s,t)){if(u(s,t))return e;if(i)return e;i=s}return i?l(i,t):void 0}function c(e,t){if(-1!==e.referencedVars.indexOf(t))return!0;for(const i of e.children)if(c(i,t))return!0;return!1}function u(e,t){if(-1!==e.assignedVars.indexOf(t))return!0;for(const i of e.children)if(u(i,t))return!0;return!1}function h(e,t){for(const t of Object.keys(e.declaredVars)){const s=e.declaredVars[t];s.escapedName||(s.escapedName=i(t))}function i(i){if(!i)return"_";let n=ts.pxtc.escapeIdentifier(i);if(t.renames.takenNames[n]||s(n,e,i)){let o=2;for(;t.renames.takenNames[n+o]||s(n+o,e,i);)o++;n+=o}return n}function s(e,t,i){if(t){for(const s of Object.keys(t.declaredVars)){const n=t.declaredVars[s];if((i!==n.name||n.name!==n.escapedName)&&n.escapedName===e)return!0}return s(e,t.parent,i)}return!1}e.children.forEach((e=>h(e,t)))}i.trackAllVariables=function(e,t){let i,c=1;return e.forEach((e=>{if(e.type===ts.pxtc.ON_START_TYPE){const s=e.getInputTargetBlock("HANDLER");s&&u(s,i={firstStatement:s,declaredVars:{},referencedVars:[],children:[],assignedVars:[]},t)}})),i||(i={firstStatement:null,declaredVars:{},referencedVars:[],children:[],assignedVars:[]}),e.forEach((e=>{e.type!==ts.pxtc.ON_START_TYPE&&u(e,i,t)})),Object.keys(i.declaredVars).forEach((e=>{const t=i.declaredVars[e];delete i.declaredVars[e],(l(i,t.id)||i).declaredVars[e]=t})),a(i,t),h(i,t),i;function u(e,t,i){if(i.idToScope[e.id]=t,"variables_get"===e.type){const i=d(e.getField("VAR").getText(),t);t.referencedVars.push(i.id)}else if("variables_set"===e.type||"variables_change"===e.type){const i=d(e.getField("VAR").getText(),t);t.assignedVars.push(i.id),t.referencedVars.push(i.id)}else if(e.type===pxtc.TS_STATEMENT_TYPE){const i=e.declaredVariables;i&&i.split(",").forEach((e=>{d(e,t).alreadyDeclared=n.BlockDeclarationType.Argument}))}if(function(e){return e.inputList.some((e=>e.type===s.inputTypes.STATEMENT))}(e)){const s=(0,o.getDeclaredVariables)(e,i).map((e=>Object.assign(Object.assign({},e),{id:c++})));let a=t;s.length&&(a={parent:t,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]},s.forEach((e=>{e.alreadyDeclared=n.BlockDeclarationType.Assigned,a.declaredVars[e.name]=e})),i.idToScope[e.id]=a),t!==a&&t.children.push(a),(0,r.forEachChildExpression)(e,(e=>{u(e,a,i)})),(0,r.forEachStatementInput)(e,(e=>{const t={parent:a,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]};a.children.push(t),u(e,t,i)}))}else(0,r.forEachChildExpression)(e,(e=>{u(e,t,i)}));e.nextConnection&&e.nextConnection.targetBlock()&&u(e.nextConnection.targetBlock(),t,i)}function d(e,t){return t.declaredVars[e]?t.declaredVars[e]:t.parent?d(e,t.parent):(t.declaredVars[e]={name:e,type:(0,o.mkPoint)(null),id:c++},t.declaredVars[e])}}},{"./environment":13,"./typeChecker":14,"./util":15,blockly:197}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initExpandableBlock=i.initVariableArgsBlock=i.appendMutation=void 0;const s=e("blockly"),n=e("./toolbox"),o=e("./constants"),r=e("./fields"),a=e("./loader");function l(e,t){const i=e,s=i.mutationToDom,n=i.domToMutation;i.mutationToDom=()=>{const e=s?s():document.createElement("mutation");return t.mutationToDom(e)},i.domToMutation=e=>{n&&n(e),t.domToMutation(e)}}i.appendMutation=l,i.initVariableArgsBlock=function(e,t){let i=0,n=0,o=e.appendDummyInput(),c=()=>{if(i!==n){if(i>n){const s=i-n;for(let i=0;i<s;i++){const s=t[n+i];o.insertFieldAt(o.fieldRow.length-1,new r.FieldArgumentVariable(s.name),"HANDLER_"+s.name);const a=e;(null==a?void 0:a.initSvg)&&a.initSvg()}}else{let e=n-i;for(let i=0;i<e;i++){const e=t[n-i-1];o.removeField("HANDLER_"+e.name)}}i>=t.length?o.removeField("_HANDLER_ADD"):n>=t.length&&u(),n=i}};function u(){o.appendField(new s.FieldImage(e.ADD_IMAGE_DATAURI,24,24,lf("Add argument"),(()=>{i=Math.min(i+1,t.length),c()}),!1),"_HANDLER_ADD")}s.Extensions.apply("inline-svgs",e,!1),u(),l(e,{mutationToDom:s=>{s.setAttribute("numArgs",i.toString());for(let n=0;n<i;n++){const i=e.getField("HANDLER_"+t[n].name);let o=i&&i.getText();s.setAttribute("arg"+n,o)}return s},domToMutation:s=>{let n=parseInt(s.getAttribute("numargs"));i=Math.min(isNaN(n)?0:n,t.length),c();for(let n=0;n<i;n++){const i=s.getAttribute("arg"+n),o="HANDLER_"+t[n].name;e.getField(o)&&(0,a.setVarFieldValue)(e,o,i)}}})},i.initExpandableBlock=function(e,t,i,r,a,u){const h="0_add_button",d="0_rem_button",p="0_add_rem_button",g="_expanded",m="_input_init",f=i.parameters.map((e=>e.name)),_=i.parameters.length,b=a?_:1,T="variable"===e.blocksById[t.type].attributes.inlineInputMode,E=e.blocksById[t.type].attributes.inlineInputModeLimit||4,y=e.blocksById[t.type].attributes.compileHiddenArguments,I=e.blocksById[t.type].attributes.expandableArgumentBreaks;let k;I&&(k=I.split(/[;,]/).map((e=>parseInt(e))));const v=new c(t);v.setEventsEnabled(!1),v.setValue(g,0),v.setValue(m,!1),v.setEventsEnabled(!0),s.Extensions.apply("inline-svgs",t,!1);let C=!1,S=!0;if(l(t,{mutationToDom:e=>(e.setAttribute(g,v.getString(g)),e.setAttribute(m,v.getString(m)),e),domToMutation:e=>{if(v.setEventsEnabled(!1),e.hasAttribute(m)&&"true"==e.getAttribute(m)&&!v.getBoolean(m)&&v.setValue(m,!0),N(),e.hasAttribute(g)){const i=parseInt(e.getAttribute(g));if(!isNaN(i)){const e=i-(v.getNumber(g)||0);v.getBoolean(m)?t.rendered||t.isInsertionMarker()?A(e,!0,t.isInsertionMarker()):(v.setValue(g,x(e)),R()):A(e,!0)}}v.setEventsEnabled(!0)}}),N(),y){let e=0;for(let s=0;s<t.inputList.length;s++){const n=t.inputList[s];(pxt.Util.startsWith(n.name,o.optionalInputWithFieldPrefix)||-1!==f.indexOf(n.name))&&(!n.connection||n.connection.isConnected()||t.isInsertionMarker()||$(n,r.definitionNameToParam[i.parameters[e].name]),++e)}}const O={updateBeforeRender:()=>{C||S&&(S=!1,C=!0,A(0,void 0,!0),C=!1)}};function A(e,s=!1,n=!1){const a=x(e);if(!n&&!s&&a===v.getNumber(g))return;v.setValue(g,a);const l=a;if(!v.getBoolean(m)&&l>0&&(N(),!t.rendered))return;let c=0;for(let e=0;e<t.inputList.length;e++){const s=t.inputList[e];if(pxt.Util.startsWith(s.name,o.optionalDummyInputPrefix))L(s,c<l||l===_);else if(pxt.Util.startsWith(s.name,o.optionalInputWithFieldPrefix)||-1!==f.indexOf(s.name)){const e=c<l;L(s,e),e&&s.connection&&!s.connection.isConnected()&&!t.isInsertionMarker()&&$(s,r.definitionNameToParam[i.parameters[c].name]),++c}}R(),T&&t.setInputsInline(l<E),s||t.render()}function w(e,i,n,o){t.appendDummyInput(e).appendField(new s.FieldImage(i,24,24,n,(()=>A(o)),!1))}function R(){if(C)return;const e=v.getNumber(g),i=e!==_,n=0!==e;t.inputList.some((e=>e.name===h))&&t.removeInput(h,!0),t.inputList.some((e=>e.name===d))&&t.removeInput(d,!0),t.inputList.some((e=>e.name===p))&&t.removeInput(p,!0),i&&n?t.appendDummyInput(p).appendField(new s.FieldImage(t.REMOVE_IMAGE_DATAURI,24,24,lf("Hide optional arguments"),(()=>A(-1*b)),!1)).appendField(new s.FieldImage(t.ADD_IMAGE_DATAURI,24,24,lf("Reveal optional arguments"),(()=>A(b)),!1)):i?w(h,t.ADD_IMAGE_DATAURI,lf("Reveal optional arguments"),b):n&&w(d,t.REMOVE_IMAGE_DATAURI,lf("Hide optional arguments"),-1*b)}function N(){v.setValue(m,!0),u(),R()}function x(e){const t=Math.min(Math.max(v.getNumber(g)+e,0),_);if(k){if(e>=0){if(0===t)return 0;for(const e of k)if(e>=t)return e;return _}for(let e=0;e<k.length;e++)if(k[e]>=t)return e>0?k[e-1]:0;return k[k.length-1]}return t}function L(e,t){e.setVisible(t)}function $(i,o){let r=(0,n.createShadowValue)(e,o);"value"===r.tagName.toLowerCase()&&(r=r.firstElementChild),s.Events.disable();try{const e=s.Xml.domToBlock(r,t.workspace);e&&i.connection.connect(e.outputConnection)}catch(e){}s.Events.enable()}t.mixin(O)};class c{constructor(e,t){this.block=e,this.fireEvents=!0,this.state=t||{}}setValue(e,t){if(this.fireEvents&&this.block.mutationToDom){const i=this.block.mutationToDom();this.state[e]=t.toString();const n=this.block.mutationToDom();Object.keys(this.state).forEach((e=>{i.getAttribute(e)!==this.state[e]&&n.setAttribute(e,this.state[e])}));const o=s.Xml.domToText(i),r=s.Xml.domToText(n);o!=r&&s.Events.fire(new s.Events.BlockChange(this.block,"mutation",null,o,r))}else this.state[e]=t.toString()}getNumber(e){return parseInt(this.state[e])}getBoolean(e){return"false"!=this.state[e]}getString(e){return this.state[e]}setEventsEnabled(e){this.fireEvents=e}}},{"./constants":18,"./fields":65,"./loader":71,"./toolbox":120,blockly:197}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.optionalInputWithFieldPrefix=i.optionalDummyInputPrefix=i.provider=void 0;const s=e("blockly");i.provider=new s.zelos.ConstantProvider,i.optionalDummyInputPrefix="0_optional_dummy",i.optionalInputWithFieldPrefix="0_optional_field"},{blockly:197}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.registerBlockitems=void 0;const s=e("blockly"),n=e("../external");var o,r;(r=o||(o={}))[r.Duplicate=10]="Duplicate",r[r.AddComment=20]="AddComment",r[r.ExpandCollapse=30]="ExpandCollapse",r[r.DeleteBlock=40]="DeleteBlock",r[r.Help=50]="Help",i.registerBlockitems=function(){(function(){const e={displayText:e=>e.block.isCollapsed()?pxt.U.lf("Expand Block"):pxt.U.lf("Collapse Block"),preconditionFn(e){const t=e.block;return t.workspace.getTopBlocks(!1).some((e=>e===t))&&t.statementInputCount>0&&!t.previousConnection&&!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block&&(pxt.tickEvent("blocks.context.expandCollapseBlock",void 0,{interactiveConsent:!0}),e.block.setCollapsed(!e.block.isCollapsed()))},scopeType:s.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtExpandCollapseBlock",weight:o.ExpandCollapse};s.ContextMenuRegistry.registry.register(e)})(),function(){const e={displayText:()=>pxt.U.lf("Help"),preconditionFn(e){const t=e.block;return("function"==typeof t.helpUrl?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback(e){if(!e.block)return;const t=e.block,i="function"==typeof t.helpUrl?t.helpUrl():t.helpUrl;i&&(0,n.openHelpUrl)(i)},scopeType:s.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtHelpBlock",weight:o.Help};s.ContextMenuRegistry.registry.register(e)}(),s.ContextMenuRegistry.registry.getItem("blockDelete").weight=o.DeleteBlock,s.ContextMenuRegistry.registry.getItem("blockComment").weight=o.AddComment,s.ContextMenuRegistry.registry.getItem("blockDuplicate").weight=o.Duplicate,s.ContextMenuRegistry.registry.unregister("blockCollapseExpand"),s.ContextMenuRegistry.registry.unregister("blockHelp"),s.ContextMenuRegistry.registry.unregister("blockInline")}},{"../external":24,blockly:197}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setupWorkspaceContextMenu=i.initContextMenu=void 0;const s=e("blockly"),n=e("./workspaceItems"),o=e("../external"),r=e("./blockItems");i.initContextMenu=function(){const e=s.Msg;e.DUPLICATE_BLOCK=lf("{id:block}Duplicate"),e.DUPLICATE_COMMENT=lf("Duplicate Comment"),e.REMOVE_COMMENT=lf("Remove Comment"),e.ADD_COMMENT=lf("Add Comment"),e.EXTERNAL_INPUTS=lf("External Inputs"),e.INLINE_INPUTS=lf("Inline Inputs"),e.EXPAND_BLOCK=lf("Expand Block"),e.COLLAPSE_BLOCK=lf("Collapse Block"),e.ENABLE_BLOCK=lf("Enable Block"),e.DISABLE_BLOCK=lf("Disable Block"),e.DELETE_BLOCK=lf("Delete Block"),e.DELETE_X_BLOCKS=lf("Delete Blocks"),e.DELETE_ALL_BLOCKS=lf("Delete All Blocks"),e.HELP=lf("Help"),(0,n.registerWorkspaceItems)(),(0,r.registerBlockitems)()},i.setupWorkspaceContextMenu=function(e){e.configureContextMenu=(t,i)=>{e.options.comments&&!e.options.readOnly&&t.unshift(s.ContextMenu.workspaceCommentOption(e,i)),(0,o.onWorkspaceContextMenu)(e,t)}}},{"../external":24,"./blockItems":19,"./workspaceItems":22,blockly:197}],21:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./contextMenu"),i)},{"./contextMenu":20}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.registerWorkspaceItems=void 0;const s=e("blockly"),n=e("../layout");var o,r;(r=o||(o={}))[r.DeleteAll=20]="DeleteAll",r[r.FormatCode=30]="FormatCode",r[r.CollapseBlocks=40]="CollapseBlocks",r[r.ExpandBlocks=50]="ExpandBlocks",r[r.Snapshot=60]="Snapshot",i.registerWorkspaceItems=function(){(function(){const e={displayText:()=>pxt.U.lf("Format Code"),preconditionFn:e=>e.workspace.options.readOnly?"hidden":"enabled",callback(e){e.workspace&&(pxt.tickEvent("blocks.context.format",void 0,{interactiveConsent:!0}),(0,n.flow)(e.workspace,{useViewWidth:!0}))},scopeType:s.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtFormatCode",weight:o.FormatCode};s.ContextMenuRegistry.registry.register(e)})(),function(){const e={displayText:()=>pxt.U.lf("Snapshot"),preconditionFn(e){if(!(0,n.screenshotEnabled)())return"hidden";const t=e.workspace,i=t.getTopBlocks(!1),s=t.getTopComments(!1);return 0===i.length&&0===s.length?"disabled":"enabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.screenshot",void 0,{interactiveConsent:!0}),(async()=>{var t;let i=await(0,n.screenshotAsync)(e.workspace,null,null===(t=pxt.appTarget.appTheme)||void 0===t?void 0:t.embedBlocksInSnapshot);pxt.BrowserUtils.isSafari()&&(i=i.replace(/^data:image\/[^;]/,"data:application/octet-stream")),pxt.BrowserUtils.browserDownloadDataUri(i,`${pxt.appTarget.nickname||pxt.appTarget.id}-${lf("screenshot")}.png`)})())},scopeType:s.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtSnapshotCode",weight:o.Snapshot};s.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Collapse Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&!e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.collapse",void 0,{interactiveConsent:!0}),(0,n.setCollapsedAll)(e.workspace,!0))},scopeType:s.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtCollapseBlocks",weight:o.CollapseBlocks};s.ContextMenuRegistry.registry.register(e)}(),function(){const e={displayText:()=>pxt.U.lf("Expand Blocks"),preconditionFn(e){const t=e.workspace;return t.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":t.getTopBlocks(!1).some((e=>e.isEnabled()&&e.isCollapsed()))?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.expand",void 0,{interactiveConsent:!0}),(0,n.setCollapsedAll)(e.workspace,!1))},scopeType:s.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtExpandBlocks",weight:o.ExpandBlocks};s.ContextMenuRegistry.registry.register(e)}(),function(){const e=e=>{const t=[],i=e=>{if(e.isDeletable())t.push(...e.getDescendants(!1));else for(const t of e.getChildren(!1))i(t)};for(const t of e.getTopBlocks())i(t);return t},t={displayText:t=>e(t.workspace).filter((e=>!e.isShadow())).length>1?pxt.U.lf("Delete All Blocks"):pxt.U.lf("Delete Block"),preconditionFn:t=>t.workspace.options.readOnly?"hidden":0===e(t.workspace).filter((e=>!e.isShadow())).length?"disabled":"enabled",callback(t){if(!t.workspace)return;const i=e(t.workspace),n=i.filter((e=>!e.isShadow())).length,o=()=>{let e=s.utils.idGenerator.genUid();s.Events.setGroup(e);let t=i.shift();t&&(t.workspace?(t.dispose(!1,!0),setTimeout(o,10)):o()),s.Events.setGroup(!1)};pxt.tickEvent("blocks.context.delete",void 0,{interactiveConsent:!0}),n<2?o():s.dialog.confirm(lf("Delete all {0} blocks?",n),(e=>{e&&o()}))},scopeType:s.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtDeleteAllBlocks",weight:o.DeleteAll};s.ContextMenuRegistry.registry.register(t)}(),s.ContextMenuRegistry.registry.unregister("workspaceDelete"),s.ContextMenuRegistry.registry.unregister("expandWorkspace"),s.ContextMenuRegistry.registry.unregister("collapseWorkspace"),s.ContextMenuRegistry.registry.unregister("cleanWorkspace"),s.ContextMenuRegistry.registry.unregister("redoWorkspace"),s.ContextMenuRegistry.registry.unregister("undoWorkspace")}},{"../layout":69,blockly:197}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.decompiledDiffAsync=i.mergeXml=i.diffXml=i.needsDecompiledDiff=void 0;const s=e("blockly"),n=e("./importer"),o=e("./render");i.needsDecompiledDiff=function(e,t){if(!e||!t)return!1;const i={};if(e.replace(/id="([^"]+)"/g,((e,t)=>(i[t]=!0,""))),!Object.keys(i).length)return!1;let s=0,n=0;return t.replace(/id="([^"]+)"/g,((e,t)=>(s++,i[t]&&n++,""))),s>0&&0==n},i.diffXml=function(e,t,i){return a((0,n.loadWorkspaceXml)(e,!0),(0,n.loadWorkspaceXml)(t,!0),i)};const r="#d0d0d0";function a(e,t,i){try{return s.Events.disable(),function(e,t,i){pxt.tickEvent("blocks.diff",{started:1}),i=i||{};const a=l();if(!e)return{ws:void 0,message:lf("All blocks are new."),added:0,deleted:0,modified:1};if(!t)return{ws:void 0,message:lf("The current blocks seem corrupted."),added:0,deleted:0,modified:1};const u=pxt.Util.toDictionary(e.getTopBlocks(!1),(e=>c(e,!0)));t.getTopBlocks(!1).forEach((t=>{const i=c(t,!0),s=e.getBlockById(t.id)||u[i];s&&i==c(s,!0)&&(a("fast unmodified top ",t.id),t.dispose(!1),s.dispose(!1))}));const h=e.getAllBlocks(!1).filter((e=>e.isEnabled())),d=e.getTopBlocks(!1).filter((e=>e.isEnabled())),p=t.getAllBlocks(!1).filter((e=>e.isEnabled()));if(a("blocks",p.map((e=>e.toDevString()))),a(p),0==h.length&&0==p.length)return pxt.tickEvent("blocks.diff",{moves:1}),{ws:void 0,message:lf("Some blocks were moved or changed."),added:0,deleted:0,modified:1};const g=d.filter((e=>!t.getBlockById(e.id))),m=h.filter((e=>!t.getBlockById(e.id))),f=p.filter((t=>!e.getBlockById(t.id))),_=(0,o.initRenderingWorkspace)(),b=(0,n.saveWorkspaceXml)(t,!0);(0,n.domToWorkspaceNoEvents)(s.utils.xml.textToDom(b),_),_.getAllBlocks(!1).filter((e=>!e.isEnabled())).forEach((e=>{a("disabled ",e.toDevString()),e.dispose(!1)}));const T=pxt.Util.toDictionary(_.getAllBlocks(!1),(e=>e.id));a("todo blocks",T),A("start"),i.hideDeletedTopBlocks||(g.forEach((e=>{a(`deleted top ${e.toDevString()}`),O(e);const t=S(e);O(t),t.setEnabled(!1)})),A("deleted top")),f.map((e=>_.getBlockById(e.id))).filter((e=>!!e)).forEach((e=>{a(`added ${e.toDevString()}`),O(e)})),A("added");const E={};if(!i.hideDeletedBlocks){const e=m.filter((e=>!(T[e.id]||C(e)||e.outputConnection&&e.outputConnection.isConnected())));e.forEach((e=>{const t=S(e);E[e.id]=t.id,a(`deleted block ${e.toDevString()}->${t.toDevString()}`)})),e.forEach((e=>function(e){a(`stitching ${e.toDevString()}->${E[e.id]}`);const t=_.getBlockById(E[e.id]);t.setEnabled(!1),v(t),O(t);const i=e.getPreviousBlock();if(i){const n=_.getBlockById(E[i.id])||_.getBlockById(i.id);if(a(`previous ${e.id}->${t.toDevString()}: ${n.toDevString()}`),n)if(n.nextConnection)t.previousConnection.connect(n.nextConnection);else{const e=n.inputList.slice().reverse().find((e=>e.connection&&e.connection.type==s.NEXT_STATEMENT));e&&t.previousConnection.connect(e.connection)}}const n=e.getNextBlock();if(n){const i=_.getBlockById(E[n.id])||_.getBlockById(n.id);i&&(a(`next ${e.id}->${t.toDevString()}: ${i.toDevString()}`),t.nextConnection.connect(i.previousConnection))}}(e)))}let y=0;if(pxt.Util.values(T).filter((t=>function(t){const i=e.getBlockById(t.id);if(!i)return!1;const s=t.getPreviousBlock();if(s&&!T[s.id])return!1;const n=t.getNextBlock();if(n&&!T[n.id])return!1;const o=i.getPreviousBlock();if(!o&&!s)return!1;if(!!o!=!!s||o.id!=s.id)return!0;const r=i.getNextBlock();return!(!r&&!n||!!r==!!n&&r.id==n.id)}(t))).forEach((e=>{a(`moved ${e.toDevString()}`),delete T[e.id],v(e),y++})),A("moved"),pxt.Util.values(T).filter((t=>function(t){let i=e.getBlockById(t.id);if(!i)return!1;const s=c(i),n=c(t);return s!=n&&(a(`old ${i.toDevString()}`,s),a(`new ${t.toDevString()}`,n),!0)}(t))).forEach((e=>{a(`changed ${e.toDevString()}`),delete T[e.id],v(e),y++})),A("changed"),_.getTopBlocks(!1).forEach((e=>{(function(e){return!!e.getDescendants(!1).find((e=>C(e)))})(e)||(a(`unmodified top ${e.toDevString()}`),delete T[e.id],e.dispose(!1))})),A("cleaned"),pxt.Util.values(T).filter((e=>!!_.getBlockById(e.id))).forEach((e=>{!function e(t){t.setColour(r),function(e){e.rendered=!1,e.inputList.forEach((e=>e.fieldRow.forEach((e=>{e.init()}))))}(t),i.statementsOnly&&(t.inputList||[]).map((e=>e.type==s.inputTypes.VALUE&&e.connection&&e.connection.targetBlock())).filter((e=>!!e)).forEach((t=>e(t)))}(e)})),A("unmodified"),!_.getAllBlocks(!1).length)return pxt.tickEvent("blocks.diff",{missed:1}),{ws:_,message:lf("Some blocks were changed."),deleted:m.length,added:f.length,modified:y};_.resize(),s.svgResize(_);const I=(0,o.renderWorkspace)(i.renderOptions||{emPixels:20,layout:4,aspectRatio:.5,useViewWidth:!0}),k={ws:_,svg:I,deleted:m.length,added:f.length,modified:y};return pxt.tickEvent("blocks.diff",{deleted:k.deleted,added:k.added,modified:k.modified}),k;function v(e){e.__pxt_used=!0}function C(e){return!!e.__pxt_used}function S(e){const t=s.Xml.blockToDom(e,!1),i=s.Xml.domToBlock(t,_);return i.nextConnection&&i.nextConnection.targetConnection&&i.nextConnection.disconnect(),i.previousConnection&&i.previousConnection.targetConnection&&i.previousConnection.disconnect(),i}function O(e){e.getDescendants(!1).forEach((e=>{delete T[e.id],v(e)}))}function A(e){a(`${e}:`,pxt.Util.values(T).map((e=>e.toDevString())))}}(e,t,i)}catch(e){return pxt.reportException(e),{ws:void 0,message:lf("Oops, we could not diff those blocks."),error:e,deleted:0,added:0,modified:0}}finally{s.Events.enable()}}function l(){return pxt.options.debug||window&&/diffdbg=1/.test(window.location.href)?console.log:(e,...t)=>{}}function c(e,t){const i=s.Xml.blockToDom(e,!0);return u(i),h(i,(e=>{u(e),t||("next"==e.localName||"statement"==e.localName||"shadow"==e.localName)&&e.remove()})),s.Xml.domToText(i)}function u(e){e.removeAttribute("id"),e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("deletable"),e.removeAttribute("editable"),e.removeAttribute("movable")}function h(e,t){if(e){t(e);for(const i of pxt.Util.toArray(e.children))h(i,t)}}function d(e,t){if(!t)return;let i,s;for(let n=0;n<e.length;++n){let o=e[n];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!i||s>o.endPos-o.startPos)&&(i=o,s=o.endPos-o.startPos)}return i?i.id:void 0}i.mergeXml=function(e,t,i){return e==t?i:i==t?e:void 0},i.decompiledDiffAsync=function(e,t,i,s,o={}){const r=l(),c=t.outfiles[pxt.MAIN_BLOCKS];let u=s.outfiles[pxt.MAIN_BLOCKS];r(c),r(u);const h=pxt.diff.compute(e,i,{ignoreWhitespace:!0,full:!0});r(h);const p={};let g=0,m=0;h.forEach(((e,i)=>{const n=e[0],o=e.substr(2);let a=o.length;switch(n){case"-":g+=a+1;break;case"+":m+=a+1;break;default:const i=/^\s+/.exec(o);if(i){const e=i[0].length;g+=e,m+=e,a-=e}const n=d(s.blockSourceMap,{start:m,length:a});if(n&&!p[n]){const i=d(t.blockSourceMap,{start:g,length:a});i&&(r(e),r(`id ${g}:${o.length}>${i} ==> ${m}:${o.length}>${n}`),p[n]=i,u=u.replace(n,i))}g+=a+1,m+=a+1}}));const f=(0,n.loadWorkspaceXml)(c,!0),_=(0,n.loadWorkspaceXml)(u,!0);return o.statementsOnly=!0,a(f,_,o)}},{"./importer":67,"./render":118,blockly:197}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.prompt=i.setPrompt=i.setOnWorkspaceContextMenu=i.onWorkspaceContextMenu=i.setOpenHelpUrl=i.openHelpUrl=i.setExtensionBlocklyPatch=i.extensionBlocklyPatch=i.setPromptTranslateBlock=i.promptTranslateBlock=void 0;const s=e("blockly");let n,o,r,a,l;i.promptTranslateBlock=function(e,t){n&&n(e,t)},i.setPromptTranslateBlock=function(e){n=e},i.extensionBlocklyPatch=function(e,t){o&&o(e,t)},i.setExtensionBlocklyPatch=function(e){o=e},i.openHelpUrl=function(e){r?r(e):window.open(e)},i.setOpenHelpUrl=function(e){r=e},i.onWorkspaceContextMenu=function(e,t){a&&a(e,t)},i.setOnWorkspaceContextMenu=function(e){a=e},i.setPrompt=function(e,t){t&&s.dialog.setPrompt(e),l=e},i.prompt=function(e,t,i,n){l?l(e,t,i,n):s.dialog.prompt(e,t,i)}},{blockly:197}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createFieldEditor=i.registerFieldEditor=i.initFieldEditors=void 0;const s=e("./field_animation"),n=e("./field_tilemap"),o=e("./field_textinput"),r=e("./field_sprite"),a=e("./field_gridpicker"),l=e("./field_colour"),c=e("./field_images"),u=e("./field_textdropdown"),h=e("./field_numberdropdown"),d=e("./field_imagedropdown"),p=e("./field_note"),g=e("./field_melodySandbox"),m=e("./field_toggle"),f=e("./field_toggle_downup"),_=e("./field_toggle_highlow"),b=e("./field_toggle_onoff"),T=e("./field_toggle_updown"),E=e("./field_toggle_winlose"),y=e("./field_toggle_yesno"),I=e("./field_protractor"),k=e("./field_position"),v=e("./field_speed"),C=e("./field_tileset"),S=e("./field_turnratio"),O=e("./field_musiceditor"),A=e("./field_sound_effect"),w=e("./field_autocomplete"),R=e("./field_colorwheel");let N={};function x(e,t,i){null==N[e]&&(N[e]={field:t,validator:i})}i.initFieldEditors=function(){var e;x("text",o.FieldTextInput),x("note",p.FieldNote),x("gridpicker",a.FieldGridPicker),x("textdropdown",u.FieldTextDropdown),x("numberdropdown",h.FieldNumberDropdown),x("imagedropdown",d.FieldImageDropdown),x("colorwheel",R.FieldColorWheel),x("toggle",m.FieldToggle),x("toggleonoff",b.FieldToggleOnOff),x("toggleyesno",y.FieldToggleYesNo),x("toggleupdown",T.FieldToggleUpDown),x("toggledownup",f.FieldToggleDownUp),x("togglehighlow",_.FieldToggleHighLow),x("togglewinlose",E.FieldToggleWinLose),x("colornumber",l.FieldColorNumber),x("images",c.FieldImages),x("sprite",r.FieldSpriteEditor),x("animation",s.FieldAnimationEditor),x("tilemap",n.FieldTilemap),x("tileset",C.FieldTileset),x("speed",v.FieldSpeed),x("turnratio",S.FieldTurnRatio),x("protractor",I.FieldProtractor),x("position",k.FieldPosition),x("melody",g.FieldCustomMelody),x("soundeffect",A.FieldSoundEffect),x("autocomplete",w.FieldAutoComplete),(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.songEditor)&&x("musiceditor",O.FieldMusicEditor)},i.registerFieldEditor=x,i.createFieldEditor=function(e,t,i){if(null==N[e])return console.error(`Field editor ${e} not registered`),null;i||(i={}),pxt.Util.assert(null==i.lightMode,"lightMode is a reserved parameter for custom fields"),i.lightMode=pxt.options.light;let s=N[e];return new s.field(t,i,s.validator)}},{"./field_animation":26,"./field_autocomplete":29,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_downup":55,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_turnratio":62}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAnimationEditor=void 0;var s=pxt.svgUtil;const n=e("./field_asset"),o=e("./field_utils"),r=32;class a extends n.FieldAssetEditor{constructor(){super(...arguments),this.onMouseEnter=()=>{if(this.animateRef||!this.asset)return;const e=this.getParentInterval()||this.asset.interval,t=e>50?e:50;let i=0;this.animateRef=setInterval((()=>{this.preview&&this.frames[i]&&this.preview.src(this.frames[i]),i=(i+1)%this.frames.length}),t)},this.onMouseLeave=()=>{this.animateRef&&clearInterval(this.animateRef),this.animateRef=void 0,this.preview&&this.frames[0]&&this.preview.src(this.frames[0])}}initView(){this.sourceBlock_.getSvgRoot().addEventListener("mouseenter",this.onMouseEnter),this.sourceBlock_.getSvgRoot().addEventListener("mouseleave",this.onMouseLeave)}showEditor_(){this.asset&&(this.asset.interval=this.getParentInterval()||this.asset.interval),super.showEditor_()}render_(){super.render_(),this.size_.height=42,this.size_.width=80}getAssetType(){return"animation"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i;const s=function(e,t){return-1===e.indexOf("[")?null:(e=e.replace(/[\[\]]/gm,"")).split(",").map((e=>pxt.sprite.imageLiteralToBitmap(e,t).data())).filter((e=>e.height&&e.width))}(e,this.params.taggedTemplate);if(s&&s.length)return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:s,interval:this.getParentInterval(),meta:{}};const n=t.lookupAssetByName("animation",e.trim());if(n)return n}return{internalID:-1,id:this.sourceBlock_.id,type:"animation",frames:[new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight).data()],interval:500,meta:{}}}onEditorClose(e){this.setParentInterval(e.interval)}getValueText(){return this.asset?this.isTemporaryAsset()?"["+this.asset.frames.map((e=>pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e),"typescript",this.params.taggedTemplate))).join(",")+"]":pxt.getTSReferenceForAsset(this.asset):this.valueText||"[]"}redrawPreview(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);const e=(new s.Rect).at(35,1).size(40,40).corner(4).setClass("blocklyAnimationField");this.fieldGroup_.appendChild(e.el);const t=new s.Text("").at(5,26).setClass("semanticIcon");this.fieldGroup_.appendChild(t.el),this.asset&&(this.frames=this.asset.frames.map((e=>(0,o.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e),r,this.lightMode))),this.preview=(new s.Image).src(this.frames[0]).at(39,5).size(r,r),this.fieldGroup_.appendChild(this.preview.el))}getParentIntervalBlock(){const e=this.sourceBlock_;if(e.getParent()){const t=e.getParent();for(const e of t.inputList)if("frameInterval"===e.name)return e.connection.targetBlock()}}setParentInterval(e){const t=this.getParentIntervalBlock();if(t){const i=l(t);i&&t.setFieldValue(String(e),i)}}getParentInterval(){const e=this.getParentIntervalBlock();if(e){const t=l(e);if(t)return Number(e.getFieldValue(t))}return 100}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t):t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}function l(e){return"math_number_minmax"===e.type?"SLIDER":function(e){return"math_number"===e||"math_integer"===e||"math_whole_number"===e}(e.type)?"NUM":"timePicker"===e.type?"ms":null}i.FieldAnimationEditor=a},{"./field_asset":28,"./field_utils":64}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentVariable=void 0;const s=e("blockly");class n extends s.FieldVariable{constructor(e){super(e),this.menuGenerator_=this.generateMenu}generateMenu(){return s.FieldVariable.dropdownCreate.call(this).filter((e=>e[1]!=s.DELETE_VARIABLE_ID))}}i.FieldArgumentVariable=n},{blockly:197}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BlocklyTilemapChange=i.FieldAssetEditor=void 0;const s=e("blockly");var n=pxt.svgUtil;const o=e("./field_base"),r=e("./field_utils"),a=32;class l extends o.FieldBase{constructor(e,t,i){super(e,t,i),this.pendingEdit=!1,this.isEmpty=!1,this.assetChangeListener=()=>{if(this.pendingEdit)return;const e=this.getBlockData();e&&(this.asset=pxt.react.getTilemapProject().lookupAsset(this.getAssetType(),e)),this.redrawPreview()},this.lightMode=t.lightMode,this.params=this.parseFieldOptions(t),this.blocksInfo=t.blocksInfo}onInit(){this.redrawPreview()}onValueChanged(e){return this.parseValueText(e),this.redrawPreview(),this.getValueText()}showEditor_(){if(this.isGreyBlock)return;const e=Object.assign({},this.params);let t;switch(e.blocksInfo=this.blocksInfo,this.asset.type){case"tile":case"image":t="image-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"image");break;case"animation":t="animation-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"image").concat((0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"animation"));break;case"tilemap":t="tilemap-editor";const i=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(i,this.asset);for(const e of(0,r.getTilesReferencedByTilesets)(this.sourceBlock_.workspace))-1===this.asset.data.projectReferences.indexOf(e.id)&&this.asset.data.projectReferences.push(e.id);break;case"song":t="music-editor",e.temporaryAssets=(0,r.getTemporaryAssets)(this.sourceBlock_.workspace,"song"),(0,r.setMelodyEditorOpen)(this.sourceBlock_,!0)}this.isFullscreen()?this.showEditorFullscreen(t,e):this.showEditorInWidgetDiv(t,e)}showEditorFullscreen(e,t){const i=pxt.react.getFieldEditorView(e,this.asset,t);this.undoRedoState&&i.restorePersistentData(this.undoRedoState),pxt.react.getTilemapProject().pushUndo(),i.onHide((()=>{this.onFieldEditorHide(i)})),i.show()}showEditorInWidgetDiv(e,t){let i,n={getScaledBBox:()=>i};s.WidgetDiv.show(n,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),o.classList.remove("sound-effect-editor-widget"),o.style.transform="",o.style.position="",o.style.left="",o.style.top="",o.style.width="",o.style.height="",o.style.opacity="",o.style.transition="",o.style.alignItems="",this.onFieldEditorHide(a)}));const o=s.WidgetDiv.getDiv(),a=pxt.react.getFieldEditorView(e,this.asset,t,o),l=this.sourceBlock_,c=l.getBoundingRectangle(),u=(0,r.workspaceToScreenCoordinates)(l.workspace,new s.utils.Coordinate(c.right,c.top)),h=u.x-400,d=u.y+60-20;o.style.opacity="0",o.classList.add("sound-effect-editor-widget"),o.style.position="absolute",o.style.left=h+"px",o.style.top=d+"px",o.style.width="50rem",o.style.height="34.25rem",o.style.display="flex",o.style.alignItems="center",o.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",o.style.borderRadius="",a.onHide((()=>{s.WidgetDiv.hideIfOwner(n)})),a.show();const p=o.getBoundingClientRect(),g=l.workspace.getInjectionDiv().getBoundingClientRect();p.height>g.height?(o.style.height="",o.style.top="calc(1rem - 20px)",o.style.bottom="calc(1rem + 20px)"):(p.bottom>g.bottom||p.top<g.top)&&(o.style.top=g.top+g.height/2-p.height/2-20+"px");const m=l.workspace.getToolbox().getWidth(),f=g.left+m;if(p.width>g.width-m)o.style.width="",o.style.left="1rem",o.style.right="1rem";else if(p.left+p.width>=g.right){const e=(0,r.workspaceToScreenCoordinates)(l.workspace,new s.utils.Coordinate(c.left,c.top));e.x-p.width-20>f?o.style.left=e.x-p.width-20+"px":o.style.left=f+(g.width-m)/2-p.width/2+"px"}else p.left<g.left&&(o.style.left=f+"px");const _=o.getBoundingClientRect();i=new s.utils.Rect(_.top,_.bottom,_.left,_.right),requestAnimationFrame((()=>{o.style.opacity="1",o.style.transform="translateY(20px)"}))}onFieldEditorHide(e){var t;const i=e.getResult(),n=pxt.react.getTilemapProject();if("song"===this.asset.type&&(0,r.setMelodyEditorOpen)(this.sourceBlock_,!1),i){const o=this.getValue();if(pxt.assetEquals(this.asset,i))return;const r=c(this.asset)?null:this.asset.id;let a=c(i)?null:i.id;r||a!==this.sourceBlock_.id||(i.id=n.generateNewID(i.type),a=i.id),this.pendingEdit=!0,(null===(t=i.meta)||void 0===t?void 0:t.displayName)&&this.disposeOfTemporaryAsset(),this.asset=i;const l=n.revision();if(this.onEditorClose(this.asset),this.updateAssetListener(),this.updateAssetMeta(),this.redrawPreview(),this.undoRedoState=e.getPersistentData(),this.sourceBlock_&&s.Events.isEnabled()){const e=new u(this.sourceBlock_,"field",this.name,o,this.getValue(),l,n.revision());r!==a&&(e.oldAssetId=r,e.newAssetId=a),s.Events.fire(e)}this.pendingEdit=!1}}render_(){this.isGreyBlock&&!this.textElement_&&this.createTextElement_(),super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=50)}getDisplayText_(){if(this.isGreyBlock){const e=pxt.Util.htmlUnescape(this.valueText);return e.substr(0,e.indexOf("("))+"(...)"}return""}updateEditable(){if(this.isGreyBlock&&this.fieldGroup_){const e=this.fieldGroup_;s.utils.dom.removeClass(e,"blocklyNonEditableText"),s.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""}else super.updateEditable()}getValue(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.getValueText()}onDispose(){var e;(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&!this.sourceBlock_.workspace.rendered&&this.disposeOfTemporaryAsset(),pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener)}disposeOfTemporaryAsset(){this.isTemporaryAsset()&&(pxt.react.getTilemapProject().removeAsset(this.asset),this.setBlockData(null),this.asset=void 0)}clearTemporaryAssetData(){this.isTemporaryAsset()&&this.setBlockData(null)}isTemporaryAsset(){return c(this.asset)}getAsset(){return this.asset}updateAsset(e){this.asset=e,this.setValue(this.getValue())}onEditorClose(e){}redrawPreview(){if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return this.createTextElement_(),this.render_(),void this.updateEditable();const e=(new n.Rect).at(5,1).size(40,40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(e.el),this.asset){let e;switch(this.asset.type){case"image":case"tile":e=(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.bitmap),a,this.lightMode);break;case"animation":e=(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.frames[0]),a,this.lightMode);break;case"tilemap":e=(0,r.tilemapToImageURI)(this.asset.data,a,this.lightMode);break;case"song":e=(0,r.songToDataURI)(this.asset.song,60,20,this.lightMode)}if(e){const t=(new n.Image).src(e).at(9,5).size(a,a);this.fieldGroup_.appendChild(t.el)}}}parseValueText(e){if(e=pxt.Util.htmlUnescape(e),this.sourceBlock_){const t=pxt.react.getTilemapProject(),i=this.getBlockData(),s=t.lookupAsset(this.getAssetType(),i);!s||e&&this.isEmpty?(this.setBlockData(null),this.asset&&this.sourceBlock_&&this.asset.meta.blockIDs&&(this.asset.meta.blockIDs=this.asset.meta.blockIDs.filter((e=>e!==this.sourceBlock_.id)),this.isTemporaryAsset()||t.updateAsset(this.asset)),this.isEmpty=!e,this.asset=this.createNewAsset(e)):this.asset=s,this.updateAssetMeta(),this.updateAssetListener()}}parseFieldOptions(e){const t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e?(e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.lightMode=e.lightMode,t):t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}updateAssetMeta(){if(this.asset){if(this.asset.meta||(this.asset.meta={}),this.asset.meta.blockIDs||(this.asset.meta.blockIDs=[]),this.sourceBlock_){if(-1===this.asset.meta.blockIDs.indexOf(this.sourceBlock_.id)){const e=this.asset.meta.blockIDs;e.length&&this.isTemporaryAsset()&&e.some((e=>this.sourceBlock_.workspace.getBlockById(e)))&&(this.asset=pxt.cloneAsset(this.asset),this.asset.meta.blockIDs=[]),this.asset.meta.blockIDs.push(this.sourceBlock_.id)}this.setBlockData(this.isTemporaryAsset()?null:this.asset.id)}this.isTemporaryAsset()?this.asset.meta.temporaryInfo={blockId:this.sourceBlock_.id,fieldName:this.name}:pxt.react.getTilemapProject().updateAsset(this.asset)}}updateAssetListener(){pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener),this.asset&&!this.isTemporaryAsset()&&pxt.react.getTilemapProject().addChangeListener(this.asset,this.assetChangeListener)}isFullscreen(){return!0}}function c(e){return e&&!e.meta.displayName}i.FieldAssetEditor=l;class u extends s.Events.BlockChange{constructor(e,t,i,s,n,o,r){super(e,t,i,s,n),this.oldRevision=o,this.newRevision=r,this.fieldName=i}isNull(){return this.oldRevision===this.newRevision&&super.isNull()}run(e){if(this.newAssetId||this.oldAssetId){const t=this.getEventWorkspace_().getBlockById(this.blockId);e?(0,r.setBlockDataForField)(t,this.fieldName,this.newAssetId):(0,r.setBlockDataForField)(t,this.fieldName,this.oldAssetId)}e?(pxt.react.getTilemapProject().redo(),super.run(e)):(pxt.react.getTilemapProject().undo(),super.run(e));const t=this.getEventWorkspace_(),i=new u(t.getBlockById(this.blockId),"tilemap-revision","revision",null,pxt.react.getTilemapProject().revision(),0,0);i.recordUndo=!1,s.Events.fire(i)}}i.BlocklyTilemapChange=u},{"./field_base":30,"./field_utils":64,blockly:197}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutoComplete=void 0;const s=e("blockly"),n=e("./field_utils"),o=e("./field_textdropdown"),r=e("../plugins/text");class a extends o.FieldTextDropdown{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.key=t.key,this.isTextValid_=!0}isOptionListDynamic(){return!0}getDisplayText_(){return this.parsedValue||""}doValueUpdate_(e){this.isDirty_=!0,null!==e&&(/['"`].*['"`]/.test(e)?this.parsedValue=JSON.parse(e):this.parsedValue=e,this.value_=this.parsedValue)}getValue(){return this.parsedValue?this.parsedValue:""}getOptions(){var e;const t=null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace;if(!t)return[];const i=[],s=(0,n.getAllFields)(t,(e=>e instanceof a&&e.getKey()===this.key)).map((e=>e.ref.getDisplayText_()));for(const e of s)e.trim()&&!i.some((t=>t[0]===e))&&i.push([e,e]);return i.sort(((e,t)=>e[0].localeCompare(t[0]))),i}showDropdown_(){this.getOptions().length&&super.showDropdown_()}getKey(){return this.key?this.key:this.sourceBlock_?this.sourceBlock_.type:void 0}initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(){super.updateSize_();const e=Math.max(this.size_.width,1);let t=this.positionLeft(e+3);this.textElement_.setAttribute("x",t.toString()),t+=this.positionRight(t+e+3),this.size_.width=e+t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding):(this.quoteRightX_=e+r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*r.FieldString.quotePadding,t=this.quoteWidth_+r.FieldString.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+r.FieldString.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}createSVGArrow(){}}i.FieldAutoComplete=a},{"../plugins/text":115,"./field_textdropdown":50,"./field_utils":64,blockly:197}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldBase=void 0;const s=e("blockly"),n=e("./field_utils");class o extends s.Field{constructor(e,t,i){super(e,i),this.SERIALIZABLE=!0,this.options=t,e&&!this.valueText&&(this.valueText=e)}static enqueueInit(e){o.pendingInit.push(e),this.pendingTimeout||(o.pendingTimeout=setTimeout((()=>o.flushInitQueue())))}static flushInitQueue(){for(const e of o.pendingInit)e.onLoadedIntoWorkspace();o.pendingTimeout=void 0,o.pendingInit=[]}init(){super.init(),this.onInit(),o.enqueueInit(this)}dispose(){this.onDispose()}getValue(){return this.valueText}doValueUpdate_(e){null!==e&&(this.valueText=this.loaded?this.onValueChanged(e):e)}getDisplayText_(){return this.valueText}onLoadedIntoWorkspace(){this.loaded||(this.loaded=!0,this.valueText=this.onValueChanged(this.valueText))}getAnchorDimensions(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=s.FieldDropdown.CHECKMARK_OVERHANG:e.left-=s.FieldDropdown.CHECKMARK_OVERHANG,e}isInitialized(){return!!this.fieldGroup_}getBlockData(){return(0,n.getBlockDataForField)(this.sourceBlock_,this.name)}setBlockData(e){(0,n.setBlockDataForField)(this.sourceBlock_,this.name,e)}getSiblingBlock(e,t=!1){const i=t?this.sourceBlock_.getParent():this.sourceBlock_;if(i&&i.inputList)for(const t of i.inputList)if(t.name===e)return t.connection.targetBlock()}getSiblingField(e,t=!1){const i=t?this.sourceBlock_.getParent():this.sourceBlock_;if(i)return i.getField(e)}}i.FieldBase=o,o.pendingInit=[]},{"./field_utils":64,blockly:197}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorWheel=void 0;const s=e("../plugins/math");class n extends s.FieldSlider{constructor(e,t,i){super(String(e),"0","255","1","10","Color",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.channel&&(this.channel_=this.params.channel)}setBackground_(e){let t=this.createColourStops_().join(",");e.style.background=`linear-gradient(left, ${t})`,this.params.sliderWidth&&(e.style.width=`${this.params.sliderWidth}px`)}setReadout_(e,t){const i=this.colorWheel(parseInt(t),this.channel_),s=document.createElement("span");s.className="blocklyColorReadout",s.style.backgroundColor=`${i}`,pxsim.U.clear(e),e.appendChild(s)}createColourStops_(){let e=[];for(let t=0;t<=255;t+=20)e.push(this.colorWheel(t,this.channel_));return e}colorWheel(e,t){return"hsvfast"==t?this.hsvFast(e,255,255):(e=255-e)<85?this.hex(3*e,255,255-3*e):e<170?(e-=85,this.hex(255,255-3*e,3*e)):(e-=170,this.hex(255-3*e,3*e,255))}hsvFast(e,t,i){let s=e%255>>0;s<0&&(s+=255);let n,o,r,a=i*(255-t)/255>>0,l=i-a,c=(s=192*s/255>>0)/64>>0,u=s%64>>0,h=(u*l/63.75>>0)+a,d=((63-u)*l/63.75>>0)+a;return c?1==c?(n=a,o=d,r=h):(n=h,o=a,r=d):(n=d,o=h,r=a),this.hex(n,o,r)}hex(e,t,i){return`#${this.componentToHex(255&e)}${this.componentToHex(255&t)}${this.componentToHex(255&i)}`}componentToHex(e){let t=e.toString(16);return 1==t.length?"0"+t:t}}i.FieldColorWheel=n},{"../plugins/math":101}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorNumber=void 0;const s=e("blockly");class n extends s.FieldColour{constructor(e,t,i){if(super(e,i),this.isFieldCustom_=!0,this.valueMode_="rgb",t.colours)this.setColours(JSON.parse(t.colours));else if(pxt.appTarget.runtime&&pxt.appTarget.runtime.palette){let e,t=pxt.Util.clone(pxt.appTarget.runtime.palette);t[0]="#dedede",pxt.appTarget.runtime.paletteNames&&((e=pxt.Util.clone(pxt.appTarget.runtime.paletteNames))[0]=lf("transparent")),this.setColours(t,e)}this.setValue(this.getColours_()[0]),t.columns&&this.setColumns(parseInt(t.columns)),t.valueMode&&(this.valueMode_=t.valueMode)}setColours(e,t){const i=super.setColours(e,t);return this.colours_=e,i}doClassValidation_(e){return"string"!=typeof e?null:o(e,this.getColours_())}getValue(e){if(e)return this.value_;switch(this.valueMode_){case"hex":return`"${this.value_}"`;case"rgb":return this.value_.indexOf("#")>-1?`0x${this.value_.replace(/^#/,"")}`:this.value_;case"index":if(!this.value_)return"-1";const e=this.getColours_();for(let t=0;t<e.length;t++)if(this.value_.toUpperCase()===e[t].toUpperCase())return t+""}return this.value_}doValueUpdate_(e){super.doValueUpdate_(o(e,this.getColours_()))}getColours_(){return this.colours_}applyColour(){const e=this.getSourceBlock();if(!e)throw new s.UnattachedFieldError;if(!this.fieldGroup_)return;const t=this.borderRect_;if(!t)throw new Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",o(this.getValue(),this.getColours_())),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}}function o(e,t){if(e){const i=/Colors\.([a-zA-Z]+)/.exec(e),s=/(0x|#)([0-9a-fA-F]+)/.exec(e);if(i)switch(i[1].toLocaleLowerCase()){case"red":return"#FF0000";case"orange":return"#FF7F00";case"yellow":return"#FFFF00";case"green":return"#00FF00";case"blue":return"#0000FF";case"indigo":return"#4B0082";case"violet":return"#8A2BE2";case"purple":return"#A033E5";case"pink":return"#FF007F";case"white":return"#FFFFFF";case"black":return"#000000";default:return e}else if(s){const e=s[2];if(3===e.length){let t="#";for(let i=0;i<e.length;i++){const s=e.charAt(i);t+=s+s}return t}if(6===e.length)return"#"+e}if(t){const i=parseInt(e);return isNaN(i)||null==t[i]?t[0]:t[i]}}return e}i.FieldColorNumber=n,s.Css.register("\n/* eslint-disable indent */\ntable.blocklyColourTable {\n    outline: none;\n    border-radius: 11px;\n}\n\ntable.blocklyColourTable > tr > td {\n    height: 22px;\n    width: 22px;\n    margin: 2px;\n    text-align: center;\n    cursor: pointer;\n    border-radius: 4px;\n    border: 2px solid rgba(0,0,0,.1);\n}\n\ntable.blocklyColourTable > tr > td:hover {\n    border: 1px solid #FFF;\n    box-sizing: border-box;\n}\n\ntable.blocklyColourTable > tr > td.blocklyColourSelected {\n    border: 1px solid #000;\n    box-sizing: border-box;\n    color: #fff;\n}\n\ntable.blocklyColourTable>tr>td.blocklyColourHighlighted {\n    border-color: #eee;\n    box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);\n    position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n    border-color: #eee !important;\n    outline: 1px solid #333;\n    position: relative;\n}\n/* eslint-enable indent */\n")},{blockly:197}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldDropdown=void 0;const s=e("blockly"),n=e("../plugins/newVariableField/fieldDropdownMixin");class o extends s.FieldDropdown{shouldAddBorderRect_(){return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}showEditor_(e){n.showEditorMixin.call(this,e)}}i.FieldDropdown=o},{"../plugins/newVariableField/fieldDropdownMixin":103,blockly:197}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldGridPicker=void 0;const s=e("blockly"),n=e("./field_utils");class o extends s.FieldDropdown{constructor(e,t,i){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");null!==t&&(this.setValue(t),this.closeModal_&&(this.close(),this.closeModal_=!1))},this.buttonClickAndClose_=e=>{this.closeModal_=!0,this.buttonClick_(e)},this.columns_=parseInt(t.columns)||4,this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||200,this.backgroundColour_=(0,n.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1);let s={xOffset:parseInt(t.tooltipsXOffset)||15,yOffset:parseInt(t.tooltipsYOffset)||-10};this.tooltipConfig_=s,this.hasSearchBar_=!!t.hasSearchBar||!1,this.hideRect_=!!t.hideRect||!1}dispose(){super.dispose(),this.disposeTooltip(),this.disposeIntersectionObserver()}createTooltip_(){this.gridTooltip_||(this.gridTooltip_=document.createElement("div"),this.gridTooltip_.className="goog-tooltip blocklyGridPickerTooltip",this.gridTooltip_.style.position="absolute",this.gridTooltip_.style.display="none",this.gridTooltip_.style.visibility="hidden",document.body.appendChild(this.gridTooltip_))}populateTableContainer(e,t,i){pxsim.U.removeChildren(t),0==e.length&&(this.firstItem_=void 0);for(let i=0;i<e.length/this.columns_;i++){let s=this.populateRow(i,e,t);t.appendChild(s)}}populateRow(e,t,i){const n=this.columns_,r=document.createElement("div");r.className="blocklyGridPickerRow";for(let a=n*e;a<Math.min(n*e+n,t.length);a++){let e=t[a][0];const n=t[a][1],l=document.createElement("div");l.className="goog-menuitem goog-option",l.setAttribute("id",":"+a),l.setAttribute("role","menuitem"),l.style.userSelect="none",l.title=e.alt||e,l.setAttribute("data-value",n);const c=document.createElement("div");c.setAttribute("class","goog-menuitem-content"),c.title=e.alt||e,c.setAttribute("data-value",n);const u="object"==typeof e;let h=this.backgroundColour_;if(n==this.getValue()&&(l.setAttribute("aria-selected","true"),pxt.BrowserUtils.addClass(l,"goog-option-selected"),h=this.sourceBlock_.getColourTertiary(),this.selectedItemDom=l,u&&!this.shouldShowTooltips()&&this.updateSelectedBar_(e,n)),l.style.backgroundColor=h,l.style.borderColor=this.borderColour_,u){const t=new Image(e.width,e.height);t.setAttribute("draggable","false"),"IntersectionObserver"in window?(t.src=o.DEFAULT_IMG,t.setAttribute("data-src",e.src),this.observer.observe(t)):t.src=e.src,t.alt=e.alt||"",t.setAttribute("data-value",n),c.appendChild(t)}else c.textContent=e;if(this.shouldShowTooltips()){s.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_);const e=this.sourceBlock_.RTL?-this.tooltipConfig_.xOffset:this.tooltipConfig_.xOffset,t=this.tooltipConfig_.yOffset;s.browserEvents.conditionalBind(l,"mousemove",this,(s=>{if(u){this.gridTooltip_.style.top=`${s.clientY+t}px`,this.gridTooltip_.style.left=`${s.clientX+e}px`;const i=document.elementFromPoint(s.clientX,s.clientY),n=i.title||i.alt;this.gridTooltip_.textContent=n,this.gridTooltip_.style.visibility=n?"visible":"hidden",this.gridTooltip_.style.display=n?"":"none"}pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),i.setAttribute("aria-activedescendant",l.id)})),s.browserEvents.conditionalBind(l,"mouseout",this,(e=>{u&&(this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"),pxt.BrowserUtils.removeClass(l,"goog-menuitem-highlight"),i.removeAttribute("aria-activedescendant")}))}else u?(this.selectedBar_.style.display="",s.browserEvents.conditionalBind(l,"click",this,(t=>{if(this.closeModal_)this.buttonClick_(t);else{const t=i.getElementsByClassName("goog-menuitem-highlight");for(let e=0;e<t.length;e++)pxt.BrowserUtils.removeClass(t[e],"goog-menuitem-highlight");pxt.BrowserUtils.addClass(l,"goog-menuitem-highlight"),this.updateSelectedBar_(e,n)}}))):(s.browserEvents.conditionalBind(l,"click",this,this.buttonClickAndClose_),s.browserEvents.conditionalBind(l,"mouseup",this,this.buttonClickAndClose_));l.appendChild(c),r.appendChild(l),0==a&&(this.firstItem_=l)}return r}shouldShowRect_(){return!this.hideRect_&&!this.sourceBlock_.isShadow()}doClassValidation_(e){return e}close(){this.disposeTooltip(),s.WidgetDiv.hideIfOwner(this),s.Events.setGroup(!1)}getFirstItem(){return this.firstItem_}highlightFirstItem(e){let t=e.childNodes;if(t.length&&t[0].childNodes){for(let e=0;e<t.length;++e){let i=t[e].childNodes.length;for(let s=0;s<i;++s){const i=t[e].childNodes[s];pxt.BrowserUtils.removeClass(i,"goog-menuitem-highlight"),pxt.BrowserUtils.removeClass(i,"goog-option-selected")}}t[0].childNodes[0].className+=" goog-menuitem-highlight"}}highlightAndScrollSelected(e,t){this.selectedItemDom&&s.utils.style.scrollIntoContainerView(this.selectedItemDom,t,!0)}showEditor_(){s.WidgetDiv.show(this,this.sourceBlock_.RTL,(()=>{this.onClose_()})),this.setupIntersectionObserver_(),this.createTooltip_();const e=document.createElement("div");this.positionMenu_(e)}positionMenu_(e){const t=s.utils.svgMath.getViewportBBox(),i=this.getAnchorDimensions_(),{paddingContainer:n,scrollContainer:o}=this.createWidget_(e),r={width:n.offsetWidth,height:n.offsetHeight},a=window.outerWidth,l=window.outerHeight;this.width_>a&&(this.width_=a),e.style.width=this.width_+"px";let c=0;if(this.hasSearchBar_&&(c+=50),this.selectedBar_&&(c+=50),this.maxRows_){let t=e.children[0].offsetHeight*(this.maxRows_+.3);l<t+c&&(t=l-c),r.height>t&&(o.style.overflowY="auto",o.style.height=t+"px",r.height=t)}r.height+=c,s.WidgetDiv.positionWithAnchor(t,i,r,this.sourceBlock_.RTL),this.highlightAndScrollSelected(e,o)}shouldShowTooltips(){return!pxt.BrowserUtils.isMobile()}getAnchorDimensions_(){const e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=s.FieldDropdown.CHECKMARK_OVERHANG:e.left-=s.FieldDropdown.CHECKMARK_OVERHANG,e}createWidget_(e){const t=s.WidgetDiv.getDiv(),i=this.getOptions();e.setAttribute("role","menu"),e.setAttribute("aria-haspopup","true");const n=document.createElement("div"),o=document.createElement("div");if(o.style.border=`solid 1px ${this.borderColour_}`,e.style.backgroundColor=this.backgroundColour_,n.style.backgroundColor=this.backgroundColour_,o.style.backgroundColor=this.backgroundColour_,e.className="blocklyGridPickerMenu",n.className="blocklyGridPickerScroller",o.className="blocklyGridPickerPadder",o.appendChild(n),n.appendChild(e),t.appendChild(o),this.hasSearchBar_){const t=this.createSearchBar_(e,n,i);o.insertBefore(t,o.childNodes[0])}return this.shouldShowTooltips()||(this.selectedBar_=this.createSelectedBar_(),o.appendChild(this.selectedBar_)),this.populateTableContainer(i,e,n),{paddingContainer:o,scrollContainer:n}}createSearchBar_(e,t,i){const s=document.createElement("div");s.setAttribute("class","ui fluid icon input");const n=document.createElement("i");n.setAttribute("class","search icon");const o=document.createElement("input");return o.setAttribute("type","search"),o.setAttribute("id","search-bar"),o.setAttribute("class","blocklyGridPickerSearchBar"),o.setAttribute("placeholder",pxt.Util.lf("Search")),o.addEventListener("click",(()=>{o.focus(),o.setSelectionRange(0,o.value.length)})),o.addEventListener("keyup",pxt.Util.debounce((()=>{let s=o.value,n=new RegExp(s,"i"),r=i.filter((e=>{const t=e[0].alt,i=e[1];return t?n.test(t):n.test(i)}));this.populateTableContainer.bind(this)(r,e,t),s?this.highlightFirstItem(e):this.highlightAndScrollSelected(e,t),this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"}),300,!1)),o.addEventListener("keyup",(t=>{if(13==t.which){const t=e.childNodes[0];if(t){const e=t.childNodes[0];e&&(this.closeModal_=!0,e.click())}}})),s.appendChild(o),s.appendChild(n),s}createSelectedBar_(){const e=document.createElement("div");e.setAttribute("class","blocklyGridPickerSelectedBar"),e.style.display="none";const t=document.createElement("div"),i=document.createElement("div");i.className="blocklyGridPickerSelectedImage",t.appendChild(i),this.selectedImg_=document.createElement("img"),this.selectedImg_.setAttribute("width","30px"),this.selectedImg_.setAttribute("height","30px"),this.selectedImg_.setAttribute("draggable","false"),this.selectedImg_.style.display="none",this.selectedImg_.src=o.DEFAULT_IMG,i.appendChild(this.selectedImg_),this.selectedBarText_=document.createElement("span"),this.selectedBarText_.className="blocklyGridPickerTooltip",t.appendChild(this.selectedBarText_);const n=document.createElement("div"),r=document.createElement("div");r.className="ui buttons mini",n.appendChild(r);const a=document.createElement("button");a.className="ui button icon green";const l=document.createElement("i");l.className="icon check",a.appendChild(l),s.browserEvents.conditionalBind(a,"click",this,(()=>{this.setValue(this.selectedBarValue_),this.close()}));const c=document.createElement("button");c.className="ui button icon red";const u=document.createElement("i");return u.className="icon cancel",c.appendChild(u),s.browserEvents.conditionalBind(c,"click",this,(()=>{this.close()})),r.appendChild(a),r.appendChild(c),e.appendChild(t),e.appendChild(n),e}updateSelectedBar_(e,t){e.src&&(this.selectedImg_.src=e.src,this.selectedImg_.style.display=""),this.selectedImg_.alt=e.alt||e,this.selectedBarText_.textContent=e.alt||e,this.selectedBarValue_=t}setupIntersectionObserver_(){"IntersectionObserver"in window&&(this.disposeIntersectionObserver(),this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");t&&(e.src=t,e.removeAttribute("data-src"))})(e.target))}))}),{rootMargin:"20px 0px",threshold:.01}))}disposeIntersectionObserver(){this.observer&&(this.observer=null)}disposeTooltip(){this.gridTooltip_&&(pxsim.U.remove(this.gridTooltip_),this.gridTooltip_=null)}onClose_(){this.disposeTooltip()}}i.FieldGridPicker=o,o.DEFAULT_IMG="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{"./field_utils":64,blockly:197}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImageDropdown=void 0;const s=e("blockly"),n=e("./field_utils"),o=e("./field_dropdown");class r extends o.FieldDropdown{constructor(e,t,i){super(t.data),this.isFieldCustom_=!0,this.buttonClick_=e=>{let t=e.target.getAttribute("data-value");t&&(this.setValue(t),s.DropDownDiv.hide())},this.columns_=parseInt(t.columns),this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||300,this.backgroundColour_=(0,n.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1)}showEditor_(){if(s.DropDownDiv.hideIfOwner(this))return;s.DropDownDiv.hideWithoutAnimation(),s.DropDownDiv.clearContent();let e=s.DropDownDiv.getContentDiv(),t=document.createElement("div");t.setAttribute("role","menu"),t.setAttribute("aria-haspopup","true");const i=this.getOptions();let n=0;for(let e=0;e<i.length;e++){let o=i[e][0];const r=i[e][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",t.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+e),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt;let l=o.height;this.columns_?(l=this.width_/this.columns_-8,a.style.width=l+"px",a.style.height=l+"px"):(a.style.width=o.width+"px",a.style.height=o.height+"px"),l>n&&(n=l);let c=this.backgroundColour_;r==this.getValue()&&(c=this.sourceBlock_.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=c,a.style.borderColor=this.borderColour_,s.browserEvents.bind(a,"click",this,this.buttonClick_),s.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),t.setAttribute("aria-activedescendant",a.id)})),s.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),t.removeAttribute("aria-activedescendant")}));let u=document.createElement("img");u.src=o.src,a.setAttribute("data-value",r),u.setAttribute("data-value",r),a.appendChild(u),t.appendChild(a)}t.style.width=this.width_+"px",e.appendChild(t),this.maxRows_&&(e.style.maxHeight=(this.maxRows_+.4)*(n+8)+"px"),pxt.BrowserUtils.isFirefox()&&(e.style.paddingRight="20px"),s.DropDownDiv.setColour(this.backgroundColour_,this.borderColour_),s.DropDownDiv.showPositionedByField(this,this.onHide_.bind(this));let o=this.sourceBlock_;this.savedPrimary_=null==o?void 0:o.getColour(),(null==o?void 0:o.isShadow())?o.setColour(o.getColourTertiary()):this.borderRect_&&this.borderRect_.setAttribute("fill",o.getColourTertiary())}doValueUpdate_(e){this.selectedOption_=void 0,super.doValueUpdate_(e)}onHide_(){let e=s.DropDownDiv.getContentDiv();e.removeAttribute("role"),e.removeAttribute("aria-haspopup"),e.removeAttribute("aria-activedescendant"),e.style.width="",e.style.paddingRight="",e.style.maxHeight="";let t=this.sourceBlock_;(null==t?void 0:t.isShadow())?this.sourceBlock_.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}}i.FieldImageDropdown=r,s.Css.register("\n.blocklyDropDownButton {\n    display: inline-block;\n    float: left;\n    padding: 0;\n    margin: 4px;\n    border-radius: 4px;\n    outline: none;\n    border: 1px solid;\n    transition: box-shadow .1s;\n    cursor: pointer;\n}\n\n.blocklyDropDownButtonHover {\n    box-shadow: 0px 0px 0px 4px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton:active {\n    box-shadow: 0px 0px 0px 6px rgba(255, 255, 255, 0.2);\n}\n\n.blocklyDropDownButton > img {\n    width: 80%;\n    height: 80%;\n    margin-top: 5%\n}\n")},{"./field_dropdown":33,"./field_utils":64,blockly:197}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImages=void 0;const s=e("blockly"),n=e("./field_imagedropdown");class o extends n.FieldImageDropdown{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.shouldSort_=t.sort,this.addLabel_=!!t.addLabel}showEditor_(){if(s.DropDownDiv.hideIfOwner(this))return;let e=this.sourceBlock_;s.DropDownDiv.hideWithoutAnimation(),s.DropDownDiv.clearContent();let t=s.DropDownDiv.getContentDiv(),i=document.createElement("div");i.setAttribute("role","menu"),i.setAttribute("aria-haspopup","true");const n=this.getOptions();this.shouldSort_&&n.sort();for(let t=0;t<n.length;t++){const o=n[t][0],r=n[t][1];if("placeholder"==o.type){let e=document.createElement("span");e.setAttribute("class","blocklyDropDownPlaceholder"),e.style.width=o.width+"px",e.style.height=o.height+"px",i.appendChild(e);continue}let a=document.createElement("button");a.setAttribute("id",":"+t),a.setAttribute("role","menuitem"),a.setAttribute("class","blocklyDropDownButton"),a.title=o.alt,this.columns_?a.style.width=this.width_/this.columns_-8+"px":(a.style.width=o.width+"px",a.style.height=o.height+"px");let l=e.getColour();r==this.getValue()&&(l=e.getColourTertiary(),a.setAttribute("aria-selected","true")),a.style.backgroundColor=l,a.style.borderColor=e.getColourTertiary(),s.browserEvents.bind(a,"click",this,this.buttonClick_),s.browserEvents.bind(a,"mouseover",this,(()=>{a.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),i.setAttribute("aria-activedescendant",a.id)})),s.browserEvents.bind(a,"mouseout",this,(()=>{a.setAttribute("class","blocklyDropDownButton"),i.removeAttribute("aria-activedescendant")}));let c=document.createElement("img");if(c.src=o.src,a.setAttribute("data-value",r),c.setAttribute("data-value",r),a.appendChild(c),this.addLabel_){const e=this.createTextNode_(o.alt);e.setAttribute("data-value",r),a.appendChild(e)}i.appendChild(a)}i.style.width=this.width_+"px",t.appendChild(i),s.DropDownDiv.setColour(e.getColour(),e.getColourTertiary()),s.DropDownDiv.showPositionedByField(this,this.onHideCallback.bind(this)),this.savedPrimary_=null==e?void 0:e.getColour(),(null==e?void 0:e.isShadow())?e.setColour(e.style.colourTertiary):this.borderRect_&&this.borderRect_.setAttribute("fill",e.style.colourTertiary)}onHideCallback(){let e=this.sourceBlock_;(null==e?void 0:e.isShadow())?e.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}createTextNode_(e){const t=document.createElement("span");return t.setAttribute("class","blocklyDropdownTextLabel"),t.textContent=e,t}}i.FieldImages=o},{"./field_imagedropdown":35,blockly:197}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldKind=void 0;const s=e("blockly"),n=e("./field_utils"),o=e("../external"),r=e("./field_dropdown");class a extends r.FieldDropdown{constructor(e){super(function(e){return function(){const t=[],i=this.getSourceBlock();return(null==i?void 0:i.workspace)&&!i.isInFlyout?i.workspace.getVariablesOfType(p(e.name)).forEach((e=>{t.push([e.name,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t.push([void 0,"SEPARATOR"]),t.push([lf("Rename {0}...",e.memberName),"RENAME"]),t.push([lf("Delete {0}...",e.memberName),"DELETE"]),t}}(e)),this.opts=e}initView(){super.initView()}onItemSelected_(e,t){const i=t.getValue();if("CREATE"===i)c(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e)));else if("RENAME"===i){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),i=t.name;if(-1!==this.opts.initialMembers.indexOf(i))return void s.dialog.alert(lf("The built-in {0} '{1}' cannot be renamed. Try creating a new kind instead!",this.opts.memberName,i));u(e,Object.assign(Object.assign({},this.opts),{toRename:t}),lf("Rename '{0}':",i),(t=>{const s=(0,n.getAllFields)(e,(e=>e instanceof a&&e.getValue()===i&&e.opts.name===this.opts.name));for(const e of s)e.ref.setValue(t)}))}else if("DELETE"===i){const e=this.sourceBlock_.workspace,t=e.getVariable(this.value_,p(this.opts.name)),i=t.name;if(-1!==this.opts.initialMembers.indexOf(i))return void s.dialog.alert(lf("The built-in {0} '{1}' cannot be deleted.",this.opts.memberName,i));const o=(0,n.getAllFields)(e,(e=>e instanceof a&&e.getValue()===i&&e.opts.name===this.opts.name));o.length>1?s.dialog.confirm(lf('Delete {0} uses of the "{1}" {2}?',o.length,i,this.opts.memberName),(i=>{if(i){s.Events.setGroup(!0);for(const e of o)e.block.dispose(!0);e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]),s.Events.setGroup(!1)}})):(e.deleteVariableById(t.getId()),this.setValue(this.opts.initialMembers[0]))}else super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}getOptions(e){return this.initVariables(),super.getOptions(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=h(e,this.opts.name);this.opts.initialMembers.forEach((i=>{-1===t.indexOf(i)&&d(e,this.opts,i)})),"CREATE"!==this.getValue()&&"RENAME"!==this.getValue()&&"DELETE"!==this.getValue()||this.opts.initialMembers.length&&this.setValue(this.opts.initialMembers[0])}}}function l(e,t,i,n,r){(0,o.prompt)(i,null,(o=>{if(o){let a=!1;if(pxtc.isIdentifierStart(o.charCodeAt(0),2)){a=!0;for(let e=1;e<o.length;e++)pxtc.isIdentifierPart(o.charCodeAt(e),2)||(a=!1)}if(!a)return void s.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>l(e,t,i,n,r)));if(pxt.blocks.isReservedWord(o)||"CREATE"===o||"RENAME"===o||"DELETE"===o)return void s.dialog.alert(lf("'{0}' is a reserved word and cannot be used.",o),(()=>l(e,t,i,n,r)));const c=h(e,t.name);for(let a=0;a<c.length;a++)if(c[a]===o)return void s.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,o),(()=>l(e,t,i,n,r)));o===t.createFunctionName&&s.dialog.alert(lf("'{0}' is a reserved name.",t.createFunctionName),(()=>l(e,t,i,n,r))),n(o)}}),{placeholder:t.promptHint})}function c(e,t,i,s){l(e,t,i,(i=>{s(d(e,t,i))}),c)}function u(e,t,i,s){l(e,t,i,(i=>{e.getVariableMap().renameVariable(t.toRename,i),s(i)}),u)}function h(e,t){const i=e.getVariablesOfType(p(t));return i&&i.length?i.map((e=>e.name)):[]}function d(e,t,i){return s.Variables.getOrCreateVariablePackage(e,null,i,p(t.name)),i}function p(e){return"KIND_"+e}i.FieldKind=a},{"../external":24,"./field_dropdown":33,"./field_utils":64,blockly:197}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMatrix=void 0;const s=e("blockly"),n=/^.*[\.#].*$/;var o,r;(r=o||(o={}))[r.None=0]="None",r[r.Number=1]="Number",r[r.Letter=2]="Letter";class a extends s.Field{constructor(e,t,i){if(super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.onColor="#FFFFFF",this.scale=1,this.matrixWidth=5,this.matrixHeight=5,this.yAxisLabel=o.None,this.xAxisLabel=o.None,this.cellState=[],this.cells=[],this.dontHandleMouseEvent_=e=>{e.stopPropagation(),e.preventDefault()},this.clearLedDragHandler=e=>{const t=this.sourceBlock_.getSvgRoot();pxsim.pointerEvents.down.forEach((e=>t.removeEventListener(e,this.dontHandleMouseEvent_))),t.removeEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.removeEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.removeEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),s.Touch.clearTouchIdentifier(),this.elt.removeEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),e.stopPropagation(),e.preventDefault()},this.toggleRect=(e,t)=>{this.cellState[e][t]=this.currentDragState_,this.updateValue()},this.handleRootMouseMoveListener=e=>{let t,i;e.changedTouches&&1==e.changedTouches.length?(t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY):(t=e.clientX,i=e.clientY);const s=document.elementFromPoint(t,i);if(!s)return;const n=s.getAttribute("data-x"),o=s.getAttribute("data-y");null!=n&&null!=o&&this.toggleRect(parseInt(n),parseInt(o))},this.params=t,void 0!==this.params.rows){let e=parseInt(this.params.rows);isNaN(e)||(this.matrixHeight=e)}if(void 0!==this.params.columns){let e=parseInt(this.params.columns);isNaN(e)||(this.matrixWidth=e)}void 0!==this.params.onColor&&(this.onColor=this.params.onColor),void 0!==this.params.offColor&&(this.offColor=this.params.offColor),void 0!==this.params.scale?this.scale=Math.max(.6,Math.min(2,Number(this.params.scale))):Math.max(this.matrixWidth,this.matrixHeight)>15?this.scale=.85:Math.max(this.matrixWidth,this.matrixHeight)>10&&(this.scale=.9)}showEditor_(){}initMatrix(){if(!this.sourceBlock_.isInsertionMarker()){this.elt=pxsim.svg.parseString('<svg xmlns="http://www.w3.org/2000/svg" id="field-matrix" />');for(let e=0;e<this.matrixWidth;e++){this.cellState.push([]),this.cells.push([]);for(let t=0;t<this.matrixHeight;t++)this.cellState[e].push(!1)}this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.createCell(e,t);if(this.updateValue(),this.xAxisLabel!==o.None){const e=this.scale*this.matrixHeight*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN,t=pxsim.svg.child(this.elt,"g",{transform:`translate(0 ${e})`});for(let e=0;e<this.matrixWidth;e++){const i=this.getYAxisWidth()+this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_WIDTH/2+a.CELL_HORIZONTAL_MARGIN/2;pxsim.svg.child(t,"text",{x:i,class:"blocklyText"}).textContent=this.getLabel(e,this.xAxisLabel)}}if(this.yAxisLabel!==o.None){const e=pxsim.svg.child(this.elt,"g",{});for(let t=0;t<this.matrixHeight;t++){const i=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_WIDTH/2+2*a.CELL_VERTICAL_MARGIN;pxsim.svg.child(e,"text",{x:0,y:i,class:"blocklyText"}).textContent=this.getLabel(t,this.yAxisLabel)}}this.fieldGroup_.replaceChild(this.elt,this.fieldGroup_.firstChild)}}getLabel(e,t){switch(t){case o.Letter:return String.fromCharCode(e+65);default:return(e+1).toString()}}createCell(e,t){const i=this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_HORIZONTAL_MARGIN+this.getYAxisWidth(),n=this.scale*t*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_VERTICAL_MARGIN,o=pxsim.svg.child(this.elt,"g",{transform:`translate(${i} ${n})`}),r=pxsim.svg.child(o,"rect",{class:"blocklyLed"+(this.cellState[e][t]?"On":"Off"),cursor:"pointer",width:this.scale*a.CELL_WIDTH,height:this.scale*a.CELL_WIDTH,fill:this.getColor(e,t),"data-x":e,"data-y":t,rx:Math.max(2,this.scale*a.CELL_CORNER_RADIUS)});this.cells[e][t]=r,this.sourceBlock_.workspace.isFlyout||pxsim.pointerEvents.down.forEach((i=>r.addEventListener(i,(i=>{const n=this.sourceBlock_.getSvgRoot();this.currentDragState_=!this.cellState[e][t],s.hideChaff(),this.sourceBlock_.select(),this.toggleRect(e,t),pxsim.pointerEvents.down.forEach((e=>n.addEventListener(e,this.dontHandleMouseEvent_))),n.addEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.addEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.addEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),this.elt.addEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),i.stopPropagation(),i.preventDefault()}),!1)))}getColor(e,t){return this.cellState[e][t]?this.onColor:this.offColor||a.DEFAULT_OFF_COLOR}getOpacity(e,t){const i=this.offColor?"1.0":"0.2";return this.cellState[e][t]?"1.0":i}updateCell(e,t){const i=this.cells[e][t];i.setAttribute("fill",this.getColor(e,t)),i.setAttribute("fill-opacity",this.getOpacity(e,t)),i.setAttribute("class","blocklyLed"+(this.cellState[e][t]?"On":"Off"))}setValue(e,t=!0){if(super.setValue(String(e)),this.elt){t&&this.restoreStateFromString();for(let e=0;e<this.matrixWidth;e++)for(let t=0;t<this.matrixHeight;t++)this.updateCell(e,t)}}render_(){this.visible_?(this.elt||this.initMatrix(),this.size_.height=this.scale*Number(this.matrixHeight)*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN+this.getXAxisHeight(),this.size_.width=this.scale*Number(this.matrixWidth)*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+this.getYAxisWidth()):this.markDirty()}getValue(){let e=function(e){const t=(e=(e||"").trim()).charAt(0);return t===e.charAt(e.length-1)&&-1!==u.indexOf(t)?e.substr(1,e.length-2).trim():e}(this.value_);return`\`\n${a.TAB}${e}\n${a.TAB}\``}restoreStateFromString(){let e=this.value_;if(e){const t=e.split("\n").filter((e=>n.test(e)));for(let e=0;e<t.length&&e<this.matrixHeight;e++){let i=0;const s=t[e];for(let t=0;t<s.length&&i<this.matrixWidth;t++)c(s[t])?(this.cellState[i][e]=!1,i++):l(s[t])&&(this.cellState[i][e]=!0,i++)}}}updateValue(){let e="";for(let t=0;t<this.matrixHeight;t++){for(let i=0;i<this.matrixWidth;i++)e+=(this.cellState[i][t]?"#":".")+" ";e+="\n"+a.TAB}this.setValue(e,!1)}getYAxisWidth(){return this.yAxisLabel===o.None?0:a.Y_AXIS_WIDTH}getXAxisHeight(){return this.xAxisLabel===o.None?0:a.X_AXIS_HEIGHT}}function l(e){return"#"===e||"*"===e||"1"===e}function c(e){return"."===e||"_"===e||"0"===e}i.FieldMatrix=a,a.CELL_WIDTH=25,a.CELL_HORIZONTAL_MARGIN=7,a.CELL_VERTICAL_MARGIN=5,a.CELL_CORNER_RADIUS=5,a.BOTTOM_MARGIN=9,a.Y_AXIS_WIDTH=9,a.X_AXIS_HEIGHT=10,a.TAB="        ",a.DEFAULT_OFF_COLOR="#000000";const u=["'",'"',"`"]},{blockly:197}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldCustomMelody=i.TOTAL_WIDTH=i.HEADER_HEIGHT=void 0;const s=e("blockly");var n=pxt.svgUtil;const o=e("./field_utils");i.HEADER_HEIGHT=50,i.TOTAL_WIDTH=300;class r extends s.Field{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.soundingKeys=0,this.numRow=8,this.numCol=8,this.tempo=120,this.isPlaying=!1,this.timeouts=[],this.params=t,this.createMelodyIfDoesntExist()}init(){super.init(),this.onInit()}showEditor_(){s.DropDownDiv.hideWithoutAnimation(),s.DropDownDiv.clearContent(),s.DropDownDiv.setColour(this.getDropdownBackgroundColour(),this.getDropdownBorderColour());let e=s.DropDownDiv.getContentDiv();pxt.BrowserUtils.addClass(e,"melody-content-div"),pxt.BrowserUtils.addClass(e.parentElement,"melody-editor-dropdown"),this.gallery=new pxtmelody.MelodyGallery,this.renderEditor(e),this.prevString=this.getValue(),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!0),s.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>{this.onEditorClose(),pxt.BrowserUtils.removeClass(e,"melody-content-div"),pxt.BrowserUtils.removeClass(e.parentElement,"melody-editor-dropdown"),(0,o.setMelodyEditorOpen)(this.sourceBlock_,!1)}))}getValue(){return this.stringRep=this.getTypeScriptValue(),this.stringRep}doValueUpdate_(e){null==e||""==e||'""'==e||this.stringRep&&this.stringRep===e||(this.stringRep=e,this.parseTypeScriptValue(e),super.doValueUpdate_(this.getValue()))}getText_(){return this.invalidString?pxt.Util.lf("Invalid Input"):this.getValue()}onInit(){this.render_(),this.createMelodyIfDoesntExist(),this.invalidString||(this.fieldGroup_||(this.fieldGroup_=s.utils.dom.createSvgElement("g",{},null)),this.visible_||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.updateFieldLabel())}render_(){super.render_(),this.invalidString||(this.size_.width=r.MUSIC_ICON_WIDTH+(r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*this.numCol),this.sourceBlock_.setColour("#ffffff")}renderEditor(e){let t=this.getDropdownBackgroundColour(),s=this.getDropdownBorderColour();this.topDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.topDiv,"melody-top-bar-div"),this.root=new n.SVG(this.topDiv).id("melody-editor-header-controls"),this.toggle=new c(this.root,{leftText:lf("Editor"),rightText:lf("Gallery"),baseColor:t}),this.toggle.onStateChange((e=>{e?this.hideGallery():this.showGallery()})),this.toggle.layout(),this.toggle.translate((i.TOTAL_WIDTH-this.toggle.width())/2,0),e.appendChild(this.topDiv),e.appendChild(this.gallery.getElement()),this.editorDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.editorDiv,"melody-editor-div"),this.editorDiv.style.setProperty("background-color",s),this.gridDiv=this.createGridDisplay(),this.editorDiv.appendChild(this.gridDiv),this.bottomDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.bottomDiv,"melody-bottom-bar-div"),this.doneButton=document.createElement("button"),pxt.BrowserUtils.addClass(this.doneButton,"melody-confirm-button"),this.doneButton.innerText=lf("Done"),this.doneButton.addEventListener("click",(()=>this.onDone())),this.doneButton.style.setProperty("background-color",t),this.playButton=document.createElement("button"),this.playButton.id="melody-play-button",this.playButton.addEventListener("click",(()=>this.togglePlay())),this.playIcon=document.createElement("i"),this.playIcon.id="melody-play-icon",pxt.BrowserUtils.addClass(this.playIcon,"play icon"),this.playButton.appendChild(this.playIcon),this.tempoInput=document.createElement("input"),pxt.BrowserUtils.addClass(this.tempoInput,"ui input"),this.tempoInput.type="number",this.tempoInput.title=lf("tempo"),this.tempoInput.id="melody-tempo-input",this.tempoInput.addEventListener("input",(()=>this.setTempo(+this.tempoInput.value))),this.syncTempoField(!0),this.bottomDiv.appendChild(this.tempoInput),this.bottomDiv.appendChild(this.playButton),this.bottomDiv.appendChild(this.doneButton),this.editorDiv.appendChild(this.bottomDiv),e.appendChild(this.editorDiv)}onEditorClose(){this.stopMelody(),this.gallery&&this.gallery.stopMelody(),this.clearDomReferences(),this.sourceBlock_&&s.Events.isEnabled()&&this.getValue()!==this.prevString&&s.Events.fire(new s.Events.BlockChange(this.sourceBlock_,"field",this.name,this.prevString,this.getValue())),this.prevString=void 0}onDone(){s.DropDownDiv.hideIfOwner(this),this.onEditorClose()}clearDomReferences(){this.topDiv=null,this.editorDiv=null,this.gridDiv=null,this.bottomDiv=null,this.doneButton=null,this.playButton=null,this.playIcon=null,this.tempoInput=null,this.elt=null,this.cells=null,this.toggle=null,this.root=null,this.gallery.clearDomReferences()}getTypeScriptValue(){return this.invalidString?this.invalidString:this.melody?'"'+this.melody.getStringRepresentation()+'"':""}parseTypeScriptValue(e){let t=e;try{e=(e=e.slice(1,-1)).trim(),this.createMelodyIfDoesntExist();let t=e.split(" ");t.forEach((e=>{if(!this.isValidNote(e))throw new Error(lf("Invalid note '{0}'. Notes can be C D E F G A B C5",e))})),this.melody.resetMelody();for(let e=0;e<t.length;e++)if("-"!=t[e]){let i=pxtmelody.noteToRow(t[e]);this.melody.updateMelody(i,e)}this.updateFieldLabel()}catch(e){pxt.log(e),this.invalidString=t}}isValidNote(e){switch(e){case"C":case"D":case"E":case"F":case"G":case"A":case"B":case"C5":case"-":return!0}return!1}getPreviewWidth(){return this.updateSize_(),this.size_.width}getPreviewHeight(){var e;return(null===(e=this.getConstants())||void 0===e?void 0:e.FIELD_BORDER_RECT_HEIGHT)||16}getDropdownBackgroundColour(){const e=this.sourceBlock_.getParent();return e?e.getColour():"#3D3D3D"}getDropdownBorderColour(){const e=this.sourceBlock_.getParent();return e?e.getColourTertiary():"#2A2A2A"}updateFieldLabel(){if(!this.fieldGroup_)return;pxsim.U.clear(this.fieldGroup_);let e=u("").appendClass("melody-editor-field-icon").at(6,15);this.fieldGroup_.appendChild(e.el);let t=this.melody.getStringRepresentation().trim().split(" ");for(let e=0;e<t.length;e++){let i=pxtmelody.getColorClass(pxtmelody.noteToRow(t[e]));const s=(new n.Rect).at((r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*e+r.COLOR_BLOCK_X,r.COLOR_BLOCK_Y).size(r.COLOR_BLOCK_WIDTH,r.COLOR_BLOCK_HEIGHT).stroke("#898989",1).fill(h(pxtmelody.noteToRow(t[e]))).corners(3,2);pxt.BrowserUtils.addClass(s.el,i),this.fieldGroup_.appendChild(s.el)}}setTempo(e){(isNaN(e)||e<=0)&&this.tempoInput?this.tempoInput.value=this.tempo+"":this.tempo!=e&&(this.tempo=e,this.melody&&this.melody.setTempo(this.tempo),this.tempoInput&&(this.tempoInput.value=this.tempo+""),this.syncTempoField(!1))}syncTempoField(e){const t=this.sourceBlock_.getParent();if(t)for(const i of t.inputList)if("tempo"===i.name||"bpm"===i.name){const t=i.connection.targetBlock();t&&(e?t.getFieldValue("SLIDER")?(this.tempoInput.value=t.getFieldValue("SLIDER"),this.tempo=+this.tempoInput.value):this.tempoInput.value=this.tempo+"":("math_number_minmax"===t.type?t.setFieldValue(this.tempoInput.value,"SLIDER"):t.setFieldValue(this.tempoInput.value,"NUM"),this.tempoInput.focus()));break}}getDuration(){return 6e4/this.tempo}createMelodyIfDoesntExist(){return!this.melody&&(this.melody=new pxtmelody.MelodyArray,!0)}onNoteSelect(e,t){this.invalidString=null,this.melody.updateMelody(e,t),this.melody.getValue(e,t)&&!this.isPlaying&&this.playNote(e,t),this.updateGrid(),this.updateFieldLabel()}updateGrid(){for(let e=0;e<this.numRow;e++){const t=pxtmelody.getColorClass(e);for(let i=0;i<this.numCol;i++){const s=this.cells[e][i];this.melody.getValue(e,i)?(pxt.BrowserUtils.removeClass(s,"melody-default"),pxt.BrowserUtils.addClass(s,t)):(pxt.BrowserUtils.addClass(s,"melody-default"),pxt.BrowserUtils.removeClass(s,t))}}}playNote(e,t){let i=++this.soundingKeys;this.isPlaying?(this.timeouts.push(setTimeout((()=>{this.playToneCore(e)}),t*this.getDuration())),this.timeouts.push(setTimeout((()=>{pxt.AudioContextManager.stop()}),(t+1)*this.getDuration()))):(this.playToneCore(e),this.timeouts.push(setTimeout((()=>{this.soundingKeys==i&&pxt.AudioContextManager.stop()}),this.getDuration())))}queueToneForColumn(e,t,i){const s=setTimeout((()=>{++this.soundingKeys,pxt.AudioContextManager.stop();for(let t=0;t<this.numRow;t++)this.melody.getValue(t,e)&&this.playToneCore(t);this.highlightColumn(e,!0),this.timeouts=this.timeouts.filter((e=>e!==s))}),t),n=setTimeout((()=>{this.timeouts=this.timeouts.filter((e=>e!==n)),this.highlightColumn(e,!1)}),t+i);this.timeouts.push(s),this.timeouts.push(n)}playToneCore(e){let t=0;switch(e){case 0:t=523;break;case 1:t=494;break;case 2:t=440;break;case 3:t=392;break;case 4:t=349;break;case 5:t=330;break;case 6:t=294;break;case 7:t=262}pxt.AudioContextManager.tone(t)}highlightColumn(e,t){this.cells.map((t=>t[e])).forEach((e=>{t?pxt.BrowserUtils.addClass(e,"playing"):pxt.BrowserUtils.removeClass(e,"playing")}))}createGridDisplay(){r.VIEWBOX_WIDTH=(r.CELL_WIDTH+r.CELL_VERTICAL_MARGIN)*this.numCol+r.CELL_VERTICAL_MARGIN,pxt.BrowserUtils.isEdge()&&(r.VIEWBOX_WIDTH+=37),r.VIEWBOX_HEIGHT=(r.CELL_WIDTH+r.CELL_HORIZONTAL_MARGIN)*this.numRow+r.CELL_HORIZONTAL_MARGIN,this.elt=pxsim.svg.parseString(`<svg xmlns="http://www.w3.org/2000/svg" class="melody-grid-div" viewBox="0 0 ${r.VIEWBOX_WIDTH} ${r.VIEWBOX_HEIGHT}"/>`),this.cells=[];for(let e=0;e<this.numRow;e++)this.cells.push([]);for(let e=0;e<this.numRow;e++)for(let t=0;t<this.numCol;t++)this.createCell(e,t);return this.elt}createCell(e,t){const i=e*(r.CELL_WIDTH+r.CELL_HORIZONTAL_MARGIN)+r.CELL_HORIZONTAL_MARGIN,s=t*(r.CELL_WIDTH+r.CELL_VERTICAL_MARGIN)+r.CELL_VERTICAL_MARGIN,n=pxsim.svg.child(this.elt,"g",{transform:`translate(${s} ${i})`}),o=pxsim.svg.child(n,"rect",{cursor:"pointer",width:r.CELL_WIDTH,height:r.CELL_WIDTH,stroke:"white","data-x":e,"data-y":t,rx:r.CELL_CORNER_RADIUS});this.melody.getValue(e,t)?pxt.BrowserUtils.addClass(o,pxtmelody.getColorClass(e)):pxt.BrowserUtils.addClass(o,"melody-default"),this.sourceBlock_.workspace.isFlyout||(pxsim.pointerEvents.down.forEach((i=>o.addEventListener(i,(i=>{this.onNoteSelect(e,t),i.stopPropagation(),i.preventDefault()}),!1))),this.cells[e][t]=o)}togglePlay(){this.isPlaying?this.stopMelody():(this.isPlaying=!0,this.playMelody()),this.updatePlayButton()}updatePlayButton(){this.isPlaying?(pxt.BrowserUtils.removeClass(this.playIcon,"play icon"),pxt.BrowserUtils.addClass(this.playIcon,"stop icon")):(pxt.BrowserUtils.removeClass(this.playIcon,"stop icon"),pxt.BrowserUtils.addClass(this.playIcon,"play icon"))}playMelody(){if(this.isPlaying){for(let e=0;e<this.numCol;e++)this.queueToneForColumn(e,e*this.getDuration(),this.getDuration());this.timeouts.push(setTimeout((()=>this.playMelody()),this.numCol*this.getDuration()))}else this.stopMelody()}stopMelody(){if(this.isPlaying){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop(),this.isPlaying=!1,this.cells.forEach((e=>e.forEach((e=>pxt.BrowserUtils.removeClass(e,"playing")))))}}showGallery(){this.stopMelody(),this.updatePlayButton(),this.gallery.show((e=>{e&&(this.melody.parseNotes(e),this.gallery.hide(),this.toggle.toggle(),this.updateFieldLabel(),this.updateGrid())}))}hideGallery(){this.gallery.hide()}}i.FieldCustomMelody=r,r.CELL_WIDTH=25,r.CELL_HORIZONTAL_MARGIN=7,r.CELL_VERTICAL_MARGIN=5,r.CELL_CORNER_RADIUS=5,r.COLOR_BLOCK_WIDTH=10,r.COLOR_BLOCK_HEIGHT=20,r.COLOR_BLOCK_X=20,r.COLOR_BLOCK_Y=5,r.COLOR_BLOCK_SPACING=2,r.MUSIC_ICON_WIDTH=20;const a=200,l=40;class c{constructor(e,t){this.props=function(e){return e.baseColor||(e.baseColor="#e95153"),e.backgroundColor||(e.backgroundColor="rgba(52,73,94,.2)"),e.borderColor||(e.borderColor="rgba(52,73,94,.4)"),e.selectedTextColor||(e.selectedTextColor=e.baseColor),e.unselectedTextColor||(e.unselectedTextColor="hsla(0,0%,100%,.9)"),e.switchColor||(e.switchColor="#ffffff"),e}(t),this.root=e.group(),this.buildDom(),this.isLeft=!0}buildDom(){this.root.style().content("\n        .toggle-left {\n            transform: translateX(0px);\n            animation: mvleft 0.2s 0s ease;\n        }\n\n        .toggle-right {\n            transform: translateX(100px);\n            animation: mvright 0.2s 0s ease;\n        }\n\n        @keyframes mvright {\n            0% {\n                transform: translateX(0px);\n            }\n            100% {\n                transform: translateX(100px);\n            }\n        }\n\n        @keyframes mvleft {\n            0% {\n                transform: translateX(100px);\n            }\n            100% {\n                transform: translateX(0px);\n            }\n        }\n        "),this.root.def().create("clipPath","sprite-editor-toggle-border").clipPathUnits(!0).draw("rect").at(0,0).corners(.02,.1).size(1,1),this.root.draw("rect").size(a,l).fill(this.props.baseColor).stroke(this.props.borderColor,4).corners(4,4).clipPath("url(#sprite-editor-toggle-border)"),this.root.draw("rect").at(2,2).size(196,36).fill(this.props.backgroundColor).corners(4,4),this.switch=this.root.draw("rect").at(2,2).size(98,36).fill(this.props.switchColor).corners(4,4),this.leftElement=this.root.group(),this.leftText=u(this.props.leftText).appendClass("sprite-editor-text").fill(this.props.selectedTextColor),this.leftElement.appendChild(this.leftText),this.rightElement=this.root.group(),this.rightText=u(this.props.rightText).appendClass("sprite-editor-text").fill(this.props.unselectedTextColor),this.rightElement.appendChild(this.rightText),this.root.onClick((()=>this.toggle()))}toggle(e=!1){this.isLeft?(this.switch.removeClass("toggle-left"),this.switch.appendClass("toggle-right"),this.leftText.fill(this.props.unselectedTextColor),this.rightText.fill(this.props.selectedTextColor)):(this.switch.removeClass("toggle-right"),this.switch.appendClass("toggle-left"),this.leftText.fill(this.props.selectedTextColor),this.rightText.fill(this.props.unselectedTextColor)),this.isLeft=!this.isLeft,!e&&this.changeHandler&&this.changeHandler(this.isLeft)}onStateChange(e){this.changeHandler=e}layout(){this.leftText.moveTo(51,20),this.rightText.moveTo(149,20)}translate(e,t){this.root.translate(e,t)}height(){return l}width(){return a}}function u(e){return new n.Text(e).anchor("middle").setAttribute("dominant-baseline","middle").setAttribute("dy",pxt.BrowserUtils.isIE()||pxt.BrowserUtils.isEdge()?"0.3em":"0.1em")}function h(e){switch(e){case 0:return"#A80000";case 1:return"#D83B01";case 2:return"#FFB900";case 3:return"#107C10";case 4:return"#008272";case 5:return"#0078D7";case 6:return"#5C2D91";case 7:return"#B4009E"}return"#DCDCDC"}},{"./field_utils":64,blockly:197}],40:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMusicEditor=void 0;var s=pxt.svgUtil;const n=e("./field_asset"),o=e("./field_utils");class r extends n.FieldAssetEditor{getAssetType(){return"song"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("song",this.getBlockData());let i;if(e){const t=/^\s*hex\s*`([a-fA-F0-9]+)`\s*(?:;?)\s*$/.exec(e);t&&(i=pxt.assets.music.decodeSongFromHex(t[1]))}else i=pxt.assets.music.getEmptySong(2);return i?(pxt.assets.music.inflateSong(i),{internalID:-1,id:this.sourceBlock_.id,type:"song",meta:{},song:i}):(this.isGreyBlock=!0,void(this.valueText=e))}render_(){super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=18+this.previewWidth())}getValueText(){return this.asset&&!this.isTemporaryAsset()?pxt.getTSReferenceForAsset(this.asset):this.asset?`hex\`${pxt.assets.music.encodeSongToHex(this.asset.song)}\``:this.valueText||""}parseFieldOptions(e){return{}}redrawPreview(){var e;if(!this.fieldGroup_)return;if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)return void super.redrawPreview();const t=18+this.previewWidth(),i=(new s.Rect).at(5,1).size(8+this.previewWidth(),40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(i.el),this.asset){const e=(0,o.songToDataURI)(this.asset.song,this.previewWidth(),32,this.lightMode);if(e){const t=(new s.Image).src(e).at(9,5).size(this.previewWidth(),32);this.fieldGroup_.appendChild(t.el)}}(null===(e=this.size_)||void 0===e?void 0:e.width)!=t&&this.forceRerender()}previewWidth(){return 32*(this.asset?this.asset.song.measures:2)}}i.FieldMusicEditor=r},{"./field_asset":28,"./field_utils":64}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNote=void 0;const s=e("blockly"),n=e("./field_utils");var o,r;(r=o||(o={}))[r.C=262]="C",r[r.CSharp=277]="CSharp",r[r.D=294]="D",r[r.Eb=311]="Eb",r[r.E=330]="E",r[r.F=349]="F",r[r.FSharp=370]="FSharp",r[r.G=392]="G",r[r.GSharp=415]="GSharp",r[r.A=440]="A",r[r.Bb=466]="Bb",r[r.B=494]="B",r[r.C3=131]="C3",r[r.CSharp3=139]="CSharp3",r[r.D3=147]="D3",r[r.Eb3=156]="Eb3",r[r.E3=165]="E3",r[r.F3=175]="F3",r[r.FSharp3=185]="FSharp3",r[r.G3=196]="G3",r[r.GSharp3=208]="GSharp3",r[r.A3=220]="A3",r[r.Bb3=233]="Bb3",r[r.B3=247]="B3",r[r.C4=262]="C4",r[r.CSharp4=277]="CSharp4",r[r.D4=294]="D4",r[r.Eb4=311]="Eb4",r[r.E4=330]="E4",r[r.F4=349]="F4",r[r.FSharp4=370]="FSharp4",r[r.G4=392]="G4",r[r.GSharp4=415]="GSharp4",r[r.A4=440]="A4",r[r.Bb4=466]="Bb4",r[r.B4=494]="B4",r[r.C5=523]="C5",r[r.CSharp5=555]="CSharp5",r[r.D5=587]="D5",r[r.Eb5=622]="Eb5",r[r.E5=659]="E5",r[r.F5=698]="F5",r[r.FSharp5=740]="FSharp5",r[r.G5=784]="G5",r[r.GSharp5=831]="GSharp5",r[r.A5=880]="A5",r[r.Bb5=932]="Bb5",r[r.B5=988]="B5",r[r.C6=1047]="C6",r[r.CSharp6=1109]="CSharp6",r[r.D6=1175]="D6",r[r.Eb6=1245]="Eb6",r[r.E6=1319]="E6",r[r.F6=1397]="F6",r[r.FSharp6=1480]="FSharp6",r[r.G6=1568]="G6",r[r.GSharp6=1568]="GSharp6",r[r.A6=1760]="A6",r[r.Bb6=1865]="Bb6",r[r.B6=1976]="B6",r[r.C7=2093]="C7";class a extends s.FieldNumber{constructor(e,t,i){super(null,0,null,null,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.isTextValid_=!0,this.nKeys_=36,this.minNote_=28,this.maxNote_=63,this.eps=2,this.setSpellcheck(!1),this.prepareNotes(),this.isExpanded=!1,this.currentPage=0,this.totalPlayCount=0,t.editorColour&&(this.primaryColour=(0,n.parseColour)(t.editorColour),this.borderColour=s.utils.colour.blend("#000000",this.primaryColour,.2));const o=parseInt(t.eps);!Number.isNaN(o)&&o>=0&&(this.eps=o);const r=parseInt(t.minNote)||this.minNote_,a=parseInt(t.maxNote)||this.maxNote_;r>=28&&a<=75&&a>r&&(this.minNote_=r,this.maxNote_=a,this.nKeys_=this.maxNote_-this.minNote_+1),this.setValue(e)}doClassValidation_(e){const t=/^Note\.(.+)$/.exec(e),i=t&&t.length>1?t[1]:null;if(null===(e=o[i]?o[i]:String(parseFloat(e||"0"))))return null;const s=parseFloat(e||"0");if(isNaN(s)||s<0)return null;const n=Math.floor(s)!=s;return Number(s.toFixed(n?2:0))}getValue(){return this.value_+""}doValueUpdate_(e){isNaN(Number(e))||Number(e)<0||(this.sourceBlock_&&s.Events.isEnabled()&&this.value_!=e&&s.Events.fire(new s.Events.BlockChange(this.sourceBlock_,"field",this.name,this.value_,e)),this.value_=e,this.refreshText())}getText(){if(this.isExpanded)return""+this.value_;{const e=+this.value_;for(let t=0;t<this.nKeys_;t++)if(Math.abs(this.getKeyFreq(t+this.minNote_)-e)<this.eps)return this.getKeyName(t+this.minNote_);let t=e.toString();return isNaN(e)||(t+=" Hz"),t}}refreshText(){this.forceRerender()}onFinishEditing_(e){this.refreshText()}onHide(){this.isExpanded=!1,this.refreshText()}showEditor_(e){this.isExpanded=!0,this.updateColor(),s.DropDownDiv.hideWithoutAnimation(),s.DropDownDiv.clearContent();const t=pxt.BrowserUtils.isMobile()||pxt.BrowserUtils.isIOS();super.showEditor_(e,t),this.refreshText(),s.Events.setGroup(!0),this.piano=[],this.currentSelectedKey=void 0;const i=this.nKeys_-this.nKeys_/a.notesPerOctave*a.blackKeysPerOctave,n=a.notesPerOctave-a.blackKeysPerOctave;let o=a.keyWidth*i,r=a.keyHeight+a.labelHeight;const c=window.innerWidth<o;c&&(o=n*a.keyWidth,r=a.keyHeight+a.labelHeight+a.prevNextHeight);const u=l("blocklyPianoDiv",`width: ${o}px;\n            height: ${r}px;`);s.DropDownDiv.getContentDiv().appendChild(u),this.noteLabel=l("blocklyNoteLabel",`top: ${a.keyHeight}px;\n            width: ${o}px;\n            background-color: ${this.primaryColour};\n            border-color: ${this.primaryColour};`),u.appendChild(this.noteLabel),this.noteLabel.textContent="-";let h=0;for(let e=0;e<this.nKeys_;e++){const t=Math.floor(e/a.notesPerOctave);let i=this.getPosition(e+this.minNote_);c&&e>=a.notesPerOctave&&(i-=n*t*a.keyWidth);const s=this.getKeyDiv(e+this.minNote_,i);this.piano.push(s),u.appendChild(s),Math.abs(this.getKeyFreq(e+this.minNote_)-Number(this.getValue()))<this.eps&&(pxt.BrowserUtils.addClass(s,"selected"),this.currentSelectedKey=s,h=t)}c&&(this.setPage(h),u.appendChild(this.getNextPrevDiv(!0,o)),u.appendChild(this.getNextPrevDiv(!1,o))),s.DropDownDiv.setColour(this.primaryColour,this.borderColour),s.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,(()=>this.onHide()))}playKey(e,t){const i=++this.totalPlayCount;this.currentSelectedKey!==e&&(this.currentSelectedKey&&pxt.BrowserUtils.removeClass(this.currentSelectedKey,"selected"),pxt.BrowserUtils.addClass(e,"selected"),this.setValue(t)),this.currentSelectedKey=e,this.htmlInput_.value=this.getText(),pxt.AudioContextManager.tone(t),setTimeout((()=>{this.totalPlayCount==i&&pxt.AudioContextManager.stop()}),300)}dispose(){s.DropDownDiv.hideIfOwner(this),super.dispose()}updateColor(){const e=this.sourceBlock_.getParent();e&&(this.sourceBlock_.isShadow()||function(e){return 1===e.inputList.length&&1===e.inputList[0].fieldRow.length}(this.sourceBlock_))?(this.primaryColour=e.getColour(),this.borderColour=e.getColourTertiary()):(this.primaryColour="#3D3D3D",this.borderColour="#2A2A2A")}setPage(e){const t=this.nKeys_/a.notesPerOctave;e=Math.max(Math.min(e,t-1),0),this.noteLabel.textContent=`Octave #${e+1}`;const i=e*a.notesPerOctave;for(let e=0;e<this.piano.length;++e){const t=e>=i&&e<i+a.notesPerOctave;this.piano[e].style.display=t?"block":"none"}this.currentPage=e}getNextPrevDiv(e,t){const i=e?0:t/2,n=l("blocklyNotePrevNext",`top: ${a.keyHeight+a.labelHeight}px;\n            left: ${i}px;\n            width: ${Math.ceil(t/2)}px;\n            ${e?"border-left-color":"border-right-color"}: ${this.primaryColour};\n            background-color: ${this.primaryColour};\n            border-bottom-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{s.browserEvents.conditionalBind(n,t,this,(()=>this.setPage(e?this.currentPage-1:this.currentPage+1)),!0)})),n.textContent=e?"<":">",n}getKeyDiv(e,t){const i=l("blocklyNote "+(this.isWhite(e)?"":"black"),`width: ${this.getKeyWidth(e)}px;\n            height: ${this.getKeyHeight(e)}px;\n            left: ${t}px;\n            border-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach((t=>{s.browserEvents.conditionalBind(i,t,this,(()=>this.playKey(i,this.getKeyFreq(e))),!0)})),s.browserEvents.conditionalBind(i,"mouseover",this,(t=>{this.noteLabel.textContent=this.getKeyName(e),t.buttons&&this.playKey(i,this.getKeyFreq(e))}),!0),i}isWhite(e){switch((e+=8)%12){case 1:case 3:case 6:case 8:case 10:return!1;default:return!0}}whiteKeysBefore(e){switch((e+=8)%12){case 0:return 0;case 1:case 2:return 1;case 3:case 4:return 2;case 5:return 3;case 6:case 7:return 4;case 8:case 9:return 5;case 10:case 11:return 6}return-1}getKeyWidth(e){return this.isWhite(e)?a.keyWidth:a.keyWidth/2}getKeyHeight(e){return this.isWhite(e)?a.keyHeight:a.keyHeight/2}getKeyFreq(e){return this.getKeyNoteData(e).freq}getKeyName(e){const t=this.getKeyNoteData(e);let i=t.prefixedName;return this.nKeys_<=a.notesPerOctave?i=t.name:this.minNote_>=28&&this.maxNote_<=63&&(i=t.altPrefixedName||i),i}getKeyNoteData(e){return a.Notes[e]}getPosition(e){if(e===this.minNote_)return 0;const t=a.keyWidth/4,i=Math.floor((this.minNote_+8)/a.notesPerOctave),s=Math.floor((e+8)/a.notesPerOctave);let n=this.whiteKeysBefore(this.minNote_)*a.keyWidth;if(this.isWhite(this.minNote_)||(n-=t),s>i){const o=7*a.keyWidth,r=o-n+(s-i-1)*o;return this.whiteKeysBefore(e)*a.keyWidth+r-(this.isWhite(e)?0:t)}return this.whiteKeysBefore(e)*a.keyWidth-n-(this.isWhite(e)?0:t)}prepareNotes(){a.Notes||(a.Notes={28:{name:lf("{id:note}C"),prefixedName:lf("Low C"),freq:131},29:{name:lf("C#"),prefixedName:lf("Low C#"),freq:139},30:{name:lf("{id:note}D"),prefixedName:lf("Low D"),freq:147},31:{name:lf("D#"),prefixedName:lf("Low D#"),freq:156},32:{name:lf("{id:note}E"),prefixedName:lf("Low E"),freq:165},33:{name:lf("{id:note}F"),prefixedName:lf("Low F"),freq:175},34:{name:lf("F#"),prefixedName:lf("Low F#"),freq:185},35:{name:lf("{id:note}G"),prefixedName:lf("Low G"),freq:196},36:{name:lf("G#"),prefixedName:lf("Low G#"),freq:208},37:{name:lf("{id:note}A"),prefixedName:lf("Low A"),freq:220},38:{name:lf("A#"),prefixedName:lf("Low A#"),freq:233},39:{name:lf("{id:note}B"),prefixedName:lf("Low B"),freq:247},40:{name:lf("{id:note}C"),prefixedName:lf("Middle C"),freq:262},41:{name:lf("C#"),prefixedName:lf("Middle C#"),freq:277},42:{name:lf("{id:note}D"),prefixedName:lf("Middle D"),freq:294},43:{name:lf("D#"),prefixedName:lf("Middle D#"),freq:311},44:{name:lf("{id:note}E"),prefixedName:lf("Middle E"),freq:330},45:{name:lf("{id:note}F"),prefixedName:lf("Middle F"),freq:349},46:{name:lf("F#"),prefixedName:lf("Middle F#"),freq:370},47:{name:lf("{id:note}G"),prefixedName:lf("Middle G"),freq:392},48:{name:lf("G#"),prefixedName:lf("Middle G#"),freq:415},49:{name:lf("{id:note}A"),prefixedName:lf("Middle A"),freq:440},50:{name:lf("A#"),prefixedName:lf("Middle A#"),freq:466},51:{name:lf("{id:note}B"),prefixedName:lf("Middle B"),freq:494},52:{name:lf("{id:note}C"),prefixedName:lf("Tenor C"),altPrefixedName:lf("High C"),freq:523},53:{name:lf("C#"),prefixedName:lf("Tenor C#"),altPrefixedName:lf("High C#"),freq:554},54:{name:lf("{id:note}D"),prefixedName:lf("Tenor D"),altPrefixedName:lf("High D"),freq:587},55:{name:lf("D#"),prefixedName:lf("Tenor D#"),altPrefixedName:lf("High D#"),freq:622},56:{name:lf("{id:note}E"),prefixedName:lf("Tenor E"),altPrefixedName:lf("High E"),freq:659},57:{name:lf("{id:note}F"),prefixedName:lf("Tenor F"),altPrefixedName:lf("High F"),freq:698},58:{name:lf("F#"),prefixedName:lf("Tenor F#"),altPrefixedName:lf("High F#"),freq:740},59:{name:lf("{id:note}G"),prefixedName:lf("Tenor G"),altPrefixedName:lf("High G"),freq:784},60:{name:lf("G#"),prefixedName:lf("Tenor G#"),altPrefixedName:lf("High G#"),freq:831},61:{name:lf("{id:note}A"),prefixedName:lf("Tenor A"),altPrefixedName:lf("High A"),freq:880},62:{name:lf("A#"),prefixedName:lf("Tenor A#"),altPrefixedName:lf("High A#"),freq:932},63:{name:lf("{id:note}B"),prefixedName:lf("Tenor B"),altPrefixedName:lf("High B"),freq:988},64:{name:lf("{id:note}C"),prefixedName:lf("High C"),freq:1046},65:{name:lf("C#"),prefixedName:lf("High C#"),freq:1109},66:{name:lf("{id:note}D"),prefixedName:lf("High D"),freq:1175},67:{name:lf("D#"),prefixedName:lf("High D#"),freq:1245},68:{name:lf("{id:note}E"),prefixedName:lf("High E"),freq:1319},69:{name:lf("{id:note}F"),prefixedName:lf("High F"),freq:1397},70:{name:lf("F#"),prefixedName:lf("High F#"),freq:1478},71:{name:lf("{id:note}G"),prefixedName:lf("High G"),freq:1568},72:{name:lf("G#"),prefixedName:lf("High G#"),freq:1661},73:{name:lf("{id:note}A"),prefixedName:lf("High A"),freq:1760},74:{name:lf("A#"),prefixedName:lf("High A#"),freq:1865},75:{name:lf("{id:note}B"),prefixedName:lf("High B"),freq:1976}})}}function l(e,t){const i=document.createElement("div");return pxt.BrowserUtils.addClass(i,e),i.setAttribute("style",t.replace(/\s+/g," ")),i}i.FieldNote=a,a.keyWidth=22,a.keyHeight=90,a.labelHeight=24,a.prevNextHeight=20,a.notesPerOctave=12,a.blackKeysPerOctave=5},{"./field_utils":64,blockly:197}],42:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNumberDropdown=void 0;const s=e("./field_textdropdown");class n extends s.BaseFieldTextDropdown{constructor(e,t,i,s,n,o){super(e+"",t,o),this.setConstraints(i,s,n)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}getValue(){return Number(super.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);-1!==t.indexOf("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=t.indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);return isNaN(t)?null:(t=Math.min(Math.max(t,this.min_),this.max_),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),null!==this.decimalPlaces&&(t=Number(t.toFixed(this.decimalPlaces))),t+"")}}i.FieldNumberDropdown=class extends n{constructor(e,t,i){super(e,t.data,t.min,t.max,t.precision,i),this.isFieldCustom_=!0}getOptions(){let e;return this.menuGenerator_&&("string"==typeof this.menuGenerator_&&(this.menuGenerator_=JSON.parse(this.menuGenerator_)),e=this.menuGenerator_.map((e=>"object"==typeof e?[pxt.Util.rlf(e[0]),e[1]]:[String(e),String(e)]))),e}}},{"./field_textdropdown":50}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldPosition=void 0;const s=e("blockly"),n=e("../plugins/math");class o extends n.FieldSlider{constructor(e,t,i){super(e,"0","100","1","1","Value",i),this.isFieldCustom_=!0,this.params=t,this.params.screenHeight||(this.params.screenHeight=120),this.params.screenWidth||(this.params.screenWidth=160),this.params.xInputName||(this.params.xInputName="x"),this.params.yInputName||(this.params.yInputName="y"),this.params.min&&(this.min_=parseInt(this.params.min)),this.params.max&&(this.max_=parseInt(this.params.max))}showEditor_(e){this.getFieldByName(this.params.xInputName)===this&&(this.max_=this.params.screenWidth,this.labelText_=this.params.xInputName),this.getFieldByName(this.params.yInputName)===this&&(this.max_=this.params.screenHeight,this.labelText_=this.params.yInputName),super.showEditor_(e),this.renderScreenPicker()}doValueUpdate_(e){super.doValueUpdate_(e),this.resetCrosshair&&this.resetCrosshair()}renderScreenPicker(){let e=s.DropDownDiv.getContentDiv();this.selectorDiv_=document.createElement("div"),this.selectorDiv_.className="blocklyCanvasOverlayOuter",e.appendChild(this.selectorDiv_);const t=document.createElement("div");t.className="blocklyCanvasOverlayDiv",this.selectorDiv_.appendChild(t);const i=document.createElement("div");i.className="cross-x",t.appendChild(i);const n=document.createElement("div");n.className="cross-y",t.appendChild(n);const o=document.createElement("div");o.className="label",t.appendChild(o);const r=1.5*this.params.screenWidth,a=1.5*this.params.screenHeight;t.style.height=a+"px",t.style.width=r+"px";const l=e.getElementsByClassName("goog-slider-horizontal")[0];if(l){l.style.width=r+"px";const e=Number(this.getValue());!isNaN(e)&&e>this.getMin()&&(this.setValue(e-1+""),this.setValue(e+""))}const c=(e,t)=>{e=Math.round(Math.max(0,Math.min(r,e))),t=Math.round(Math.max(0,Math.min(a,t))),i.style.top=t+"px",n.style.left=e+"px",e=Math.round(Math.max(0,Math.min(this.params.screenWidth,e/r*this.params.screenWidth))),t=Math.round(Math.max(0,Math.min(this.params.screenHeight,t/a*this.params.screenHeight))),isNaN(e)?o.textContent=`${this.params.yInputName}=${t}`:isNaN(t)?o.textContent=`${this.params.xInputName}=${e}`:o.textContent=`${this.params.xInputName}=${e} ${this.params.yInputName}=${t}`;const s=o.getBoundingClientRect();e>this.params.screenWidth/2?o.style.left=e*(r/this.params.screenWidth)-s.width-8+"px":o.style.left=e*(r/this.params.screenWidth)+4+"px",t>this.params.screenHeight/2?o.style.top=t*(a/this.params.screenHeight)-s.height-6+"px":o.style.top=t*(a/this.params.screenHeight)+"px"};this.resetCrosshair=()=>{const{currentX:e,currentY:t}=this.getXY();c(e/this.params.screenWidth*r,t/this.params.screenHeight*a)},this.resetCrosshair(),s.browserEvents.bind(this.selectorDiv_,"mousemove",this,(e=>{const i=t.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;c(s,n)})),s.browserEvents.bind(this.selectorDiv_,"mouseleave",this,this.resetCrosshair),s.browserEvents.bind(this.selectorDiv_,"click",this,(e=>{const i=t.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top,o=Math.round(s/r*this.params.screenWidth),l=Math.round(n/a*this.params.screenHeight);this.close(),this.setXY(o,l)}))}resizeHandler(){this.close()}setXY(e,t){const i=this.getFieldByName(this.params.xInputName);i&&"number"==typeof i.getValue()&&i.setValue(String(e));const s=this.getFieldByName(this.params.yInputName);s&&"number"==typeof s.getValue()&&s.setValue(String(t))}getFieldByName(e){const t=this.sourceBlock_.getParent();if(t)for(let i=0;i<t.inputList.length;i++){const s=t.inputList[i];if(s.name===e)return this.getTargetField(s)}}getXY(){let e,t;const i=this.getFieldByName(this.params.xInputName);i&&(e=i.getValue());const s=this.getFieldByName(this.params.yInputName);return s&&(t=s.getValue()),{currentX:parseInt(e),currentY:parseInt(t)}}getTargetField(e){const t=e.connection.targetBlock();if(!t)return null;const i=t.inputList[0];return i?i.fieldRow[0]:null}widgetDispose_(){super.widgetDispose_(),this.close(!0)}close(e){e||(s.WidgetDiv.hideIfOwner(this),s.DropDownDiv.hideIfOwner(this)),window.removeEventListener("resize",this.resizeHandler),this.resetCrosshair=void 0,this.selectorDiv_&&(s.utils.dom.removeNode(this.selectorDiv_),this.selectorDiv_=void 0)}}i.FieldPosition=o},{"../plugins/math":101,blockly:197}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProcedure=void 0;const s=e("./field_dropdown");class n extends s.FieldDropdown{constructor(e,t){super((function(){let e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){let t=this.sourceBlock_.workspace.getAllBlocks(!1);for(let i=0;i<t.length;i++)if(t[i].getProcedureDef){let s=t[i].getProcedureDef();e.push(s[0])}}let t=this.getValue();t&&-1==e.indexOf(t)&&e.push(t),e.sort(((e,t)=>{const i=e.toLowerCase(),s=t.toLowerCase();return i===s?0:i>s?1:-1})),e.length||e.push("Temp"),this.rawValue&&-1===e.indexOf(this.rawValue)&&e.push(this.rawValue);let i=[];for(let t=0;t<e.length;t++)i[t]=[e[t],e[t]];return i}),t),this.setValue(e||"")}getOptions(e){return this.menuGenerator_()}doClassValidation_(e){return void 0===e?null:e}doValueUpdate_(e){this.rawValue=e,super.doValueUpdate_(e)}init(){this.fieldGroup_||super.init.call(this)}setSourceBlock(e){pxt.Util.assert(!e.isShadow(),"Procedure fields are not allowed to exist on shadow blocks."),super.setSourceBlock.call(this,e)}}i.FieldProcedure=n},{"./field_dropdown":33}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProtractor=void 0;const s=e("../plugins/math");class n extends s.FieldSlider{constructor(e,t,i){super(String(e),"0","180","1","15",lf("Angle"),i),this.isFieldCustom_=!0,this.params=t}createLabelDom_(e){const t=document.createElement("div");this.circleSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.circleSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.circleSVG),pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.circleSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"});const i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateAngle("string"==typeof e?parseFloat(e):e),this.reporter&&(this.reporter.textContent=`${e}°`)}updateAngle(e){if(!this.circleBar)return;const t=(180-(e=Math.max(0,Math.min(180,e))))/180*Math.PI*90;this.circleBar.setAttribute("stroke-dashoffset",`${t}`)}}i.FieldProtractor=n},{"../plugins/math":101}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSoundEffect=void 0;const s=e("blockly");var n=pxt.svgUtil;const o=e("./field_base"),r=e("./field_utils"),a=160,l=40;class c extends o.FieldBase{constructor(){super(...arguments),this.registeredChangeListener=!1,this.onWorkspaceChange=e=>{if(e.type!==s.Events.CHANGE)return;const t=this.sourceBlock_.workspace.getBlockById(e.blockId);!t||t!==this.sourceBlock_&&t.getParent()!==this.sourceBlock_||this.redrawPreview()}}onInit(){this.options||(this.options={}),this.options.durationInputName||(this.options.durationInputName="duration"),this.options.startFrequencyInputName||(this.options.startFrequencyInputName="startFrequency"),this.options.endFrequencyInputName||(this.options.endFrequencyInputName="endFrequency"),this.options.startVolumeInputName||(this.options.startVolumeInputName="startVolume"),this.options.endVolumeInputName||(this.options.endVolumeInputName="endVolume"),this.options.waveFieldName||(this.options.waveFieldName="waveShape"),this.options.interpolationFieldName||(this.options.interpolationFieldName="interpolation"),this.options.effectFieldName||(this.options.effectFieldName="effect"),this.options.useMixerSynthesizer||(this.options.useMixerSynthesizer=!1),this.redrawPreview(),this.sourceBlock_.workspace&&(this.workspace=this.sourceBlock_.workspace,this.sourceBlock_.isShadow()||this.sourceBlock_.isInsertionMarker()||(this.registeredChangeListener=!0,this.workspace.addChangeListener(this.onWorkspaceChange)))}onDispose(){this.workspace&&this.registeredChangeListener&&(this.workspace.removeChangeListener(this.onWorkspaceChange),this.registeredChangeListener=!1)}onValueChanged(e){return e}redrawPreview(){if(!this.fieldGroup_)return;if(this.drawnSound){const e=this.readCurrentSound();if(e.startFrequency===this.drawnSound.startFrequency&&e.endFrequency===this.drawnSound.endFrequency&&e.startVolume===this.drawnSound.startVolume&&e.endVolume===this.drawnSound.endVolume&&e.wave===this.drawnSound.wave&&e.interpolation===this.drawnSound.interpolation)return}pxsim.U.clear(this.fieldGroup_);const e=(new n.Rect).at(5,4).size(a,l).setClass("blocklySpriteField").stroke("#fff",1).fill("#dedede").corner(20),t="preview-clip-"+pxt.U.guidGen(),i=(new n.ClipPath).id(t).clipPathUnits(!1),s=(new n.Rect).size(115,l).fill("#FFF").at(0,0);i.appendChild(s),this.drawnSound=this.readCurrentSound();const o=(new n.Path).stroke("grey",2).fill("none").setD(pxt.assets.renderSoundPath(this.drawnSound,120,32)).clipPath("url('#"+t+"')"),r=(new n.Group).translate(35,7);r.appendChild(i),r.appendChild(o);const c=new n.Text("").appendClass("melody-editor-field-icon").setAttribute("alignment-baseline","middle").anchor("middle").at(20,24);this.fieldGroup_.appendChild(e.el),this.fieldGroup_.appendChild(c.el),this.fieldGroup_.appendChild(r.el)}showEditor_(){const e=this.readCurrentSound();let t;s.Events.disable();let i={getScaledBBox:()=>t};s.WidgetDiv.show(i,this.sourceBlock_.RTL,(()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),a.hide(),n.classList.remove("sound-effect-editor-widget"),n.style.transform="",n.style.position="",n.style.left="",n.style.top="",n.style.width="",n.style.height="",n.style.opacity="",n.style.transition="",n.style.alignItems="",s.Events.enable(),s.Events.setGroup(!0),this.fireNumberInputUpdate(this.options.durationInputName,e.duration),this.fireNumberInputUpdate(this.options.startFrequencyInputName,e.startFrequency),this.fireNumberInputUpdate(this.options.endFrequencyInputName,e.endFrequency),this.fireNumberInputUpdate(this.options.startVolumeInputName,e.startVolume),this.fireNumberInputUpdate(this.options.endVolumeInputName,e.endVolume),this.fireFieldDropdownUpdate(this.options.waveFieldName,u[e.wave]),this.fireFieldDropdownUpdate(this.options.interpolationFieldName,d[e.interpolation]),this.fireFieldDropdownUpdate(this.options.effectFieldName,h[e.effect]),s.Events.setGroup(!1),this.mostRecentValue&&this.setBlockData(JSON.stringify(this.mostRecentValue))}));const n=s.WidgetDiv.getDiv(),o={onClose:()=>{a.hide(),s.WidgetDiv.hideIfOwner(i)},onSoundChange:e=>{this.mostRecentValue=e,this.updateSiblingBlocks(e),this.redrawPreview()},initialSound:e,useMixerSynthesizer:g(this.options.useMixerSynthesizer)},a=pxt.react.getFieldEditorView("soundeffect-editor",e,o,n),l=this.sourceBlock_,c=l.getBoundingRectangle(),p=(0,r.workspaceToScreenCoordinates)(l.workspace,new s.utils.Coordinate(c.right,c.top)),m=p.x+20,f=p.y-20;n.style.opacity="0",n.classList.add("sound-effect-editor-widget"),n.style.position="absolute",n.style.left=m+"px",n.style.top=f+"px",n.style.width="30rem",n.style.height="40rem",n.style.display="flex",n.style.alignItems="center",n.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",n.style.borderRadius="",a.onHide((()=>{})),a.show();const _=n.getBoundingClientRect(),b=l.workspace.getInjectionDiv().getBoundingClientRect();_.height>b.height?(n.style.height="",n.style.top="calc(1rem - 20px)",n.style.bottom="calc(1rem + 20px)"):(_.bottom>b.bottom||_.top<b.top)&&(n.style.top=b.top+b.height/2-_.height/2-20+"px");const T=l.workspace.getToolbox().getWidth();if(_.width>b.width-T)n.style.width="",n.style.left="1rem",n.style.right="1rem";else if(_.left+_.width>=b.right){const e=(0,r.workspaceToScreenCoordinates)(l.workspace,new s.utils.Coordinate(c.left,c.top)),t=b.left+T;e.x-_.width-20>t?n.style.left=e.x-_.width-20+"px":n.style.left=t+(b.width-T)/2-_.width/2+"px"}const E=n.getBoundingClientRect();t=new s.utils.Rect(E.top,E.bottom,E.left,E.right),requestAnimationFrame((()=>{n.style.opacity="1",n.style.transform="translateY(20px)"}))}render_(){super.render_(),this.size_.height=48,this.size_.width=165}updateSiblingBlocks(e){this.setNumberInputValue(this.options.durationInputName,e.duration),this.setNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),this.setNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),this.setNumberInputValue(this.options.startVolumeInputName,e.startVolume),this.setNumberInputValue(this.options.endVolumeInputName,e.endVolume),this.setFieldDropdownValue(this.options.waveFieldName,u[e.wave]),this.setFieldDropdownValue(this.options.interpolationFieldName,d[e.interpolation]),this.setFieldDropdownValue(this.options.effectFieldName,h[e.effect])}setNumberInputValue(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);i&&("math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?i.setFieldValue(Math.round(t),"NUM"):"math_number_minmax"===i.type&&i.setFieldValue(Math.round(t),"SLIDER"))}getNumberInputValue(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);return i?"math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?parseInt(i.getFieldValue("NUM")+""):"math_number_minmax"===i.type?parseInt(i.getFieldValue("SLIDER")+""):t:t}fireNumberInputUpdate(e,t){const i=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);if(!i)return;let n;"math_number"===i.type||"math_integer"===i.type||"math_whole_number"===i.type?n="NUM":"math_number_minmax"===i.type&&(n="SLIDER"),n&&s.Events.fire(new s.Events.BlockChange(i,"field",n,t,this.getNumberInputValue(e,t)))}setFieldDropdownValue(e,t){const i=this.getSiblingField(e)||this.getSiblingField(e,!0);i&&i.setValue(t)}getFieldDropdownValue(e){const t=this.getSiblingField(e)||this.getSiblingField(e,!0);if(t)return t.getValue()}fireFieldDropdownUpdate(e,t){const i=this.getSiblingField(e)||this.getSiblingField(e,!0);i&&s.Events.fire(new s.Events.BlockChange(i.getSourceBlock(),"field",i.name,t,this.getFieldDropdownValue(e)))}readCurrentSound(){const e=this.readBlockDataSound();return{duration:this.getNumberInputValue(this.options.durationInputName,e.duration),startFrequency:this.getNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),endFrequency:this.getNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),startVolume:this.getNumberInputValue(this.options.startVolumeInputName,e.startVolume),endVolume:this.getNumberInputValue(this.options.endVolumeInputName,e.endVolume),wave:p(u,this.getFieldDropdownValue(this.options.waveFieldName))||e.wave,interpolation:p(d,this.getFieldDropdownValue(this.options.interpolationFieldName))||e.interpolation,effect:p(h,this.getFieldDropdownValue(this.options.effectFieldName))||e.effect}}readBlockDataSound(){const e=this.getBlockData();let t;try{t=JSON.parse(e)}catch(e){t={duration:1e3,startFrequency:100,endFrequency:4800,startVolume:100,endVolume:0,wave:"sine",interpolation:"linear",effect:"none"}}return t}}i.FieldSoundEffect=c;const u={sine:"WaveShape.Sine",square:"WaveShape.Square",sawtooth:"WaveShape.Sawtooth",triangle:"WaveShape.Triangle",noise:"WaveShape.Noise"},h={none:"SoundExpressionEffect.None",vibrato:"SoundExpressionEffect.Vibrato",tremolo:"SoundExpressionEffect.Tremolo",warble:"SoundExpressionEffect.Warble"},d={linear:"InterpolationCurve.Linear",curve:"InterpolationCurve.Curve",logarithmic:"InterpolationCurve.Logarithmic"};function p(e,t){return Object.keys(e).find((i=>e[i]===t))}function g(e){if(!e)return!1;if("string"==typeof e)switch(e.toLowerCase().trim()){case"1":case"yes":case"y":case"on":case"true":return!0;default:return!1}return!!e}},{"./field_base":30,"./field_utils":64,blockly:197}],47:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpeed=void 0;const s=e("../plugins/math");class n extends s.FieldSlider{constructor(e,t,i){super(String(e),"-100","100","1","10","Speed",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.format||(this.params.format="{0}%")}createLabelDom_(e){const t=document.createElement("div");this.speedSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.speedSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.speedSVG),pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.speedSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:`font-size: ${Math.max(14,50-5*(this.params.format.length-4))}px`,class:"sim-text inverted number"});const i=document.createElement("span");return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateSpeed("string"==typeof e?parseFloat(e):e),this.params&&this.reporter&&(this.reporter.textContent=ts.pxtc.U.rlf(this.params.format,e))}updateSpeed(e){if(!this.circleBar)return;let t=this.sign(e);e=Math.abs(e)/100*50+50,-1==t&&(e=50-e);let i=(100-e)/100*(180*Math.PI);this.circleBar.setAttribute("stroke-dashoffset",`${i}`)}sign(e){return e?e<0?-1:1:0}}i.FieldSpeed=n},{"../plugins/math":101}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpriteEditor=void 0;const s=e("./field_asset");class n extends s.FieldAssetEditor{getAssetType(){return"image"}createNewAsset(e){const t=pxt.react.getTilemapProject();if(e){const i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("image",this.getBlockData());const i=e?pxt.sprite.imageLiteralToBitmap(e,this.params.taggedTemplate):new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight);let s;if(!i){if(!(s=o(e)))return this.isGreyBlock=!0,void(this.valueText=e);this.qName=e}return s||(s=i.data()),{internalID:-1,id:this.sourceBlock_.id,type:"image",jresData:pxt.sprite.base64EncodeBitmap(s),meta:{},bitmap:s}}getValueText(){if(!this.asset)return this.valueText||"";if(this.asset&&!this.isTemporaryAsset())return pxt.getTSReferenceForAsset(this.asset);if(this.qName){const e=o(this.qName);if(e&&pxt.sprite.bitmapEquals(e,this.asset.bitmap))return this.qName}return pxt.sprite.bitmapToImageLiteral(this.asset&&pxt.sprite.Bitmap.fromData(this.asset.bitmap),"typescript",this.params.taggedTemplate)}parseFieldOptions(e){return function(e){const t={initColor:1,initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.sizes){const i=e.sizes.split(";"),s=[];for(let e=0;e<i.length;e++){const t=i[e].split(",");if(2!==t.length)continue;let n=parseInt(t[0]),o=parseInt(t[1]);if(isNaN(n)||isNaN(o))continue;const r=pxt.appTarget.runtime&&pxt.appTarget.runtime.screenSize;n<0&&r&&(n=r.width),o<0&&r&&(o=r.height),s.push([n,o])}s.length>0&&(t.initWidth=s[0][0],t.initHeight=s[0][1])}return e.filter&&(t.filter=e.filter),e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initColor=i(e.initColor,t.initColor),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate,t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}function o(e){const t=pxt.react.getTilemapProject().getGalleryAssets("image").filter((t=>t.id===e)),i=t.length&&t[0];if(i)return i.bitmap}i.FieldSpriteEditor=n},{"./field_asset":28}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldStyledLabel=void 0;const s=e("blockly");class n extends s.FieldLabel{constructor(e,t,i){super(e,function(e){if(e){if(e.bold&&e.italics)return"blocklyBoldItalicizedText";if(e.bold)return"blocklyBoldText";if(e.italics)return"blocklyItalicizedText"}}(t)),this.isFieldCustom_=!0}}i.FieldStyledLabel=n},{blockly:197}],50:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextDropdown=i.BaseFieldTextDropdown=void 0;const s=e("blockly");class n extends s.FieldTextInput{constructor(e,t,i){super(e,i),this.menuGenerator_=t,this.selectedMenuItem=null,this.menu_=null,this.svgArrow=null,this.generatedOptions=null}initView(){super.initView(),this.createSVGArrow()}showEditor_(e,t){super.showEditor_(e,t),this.dropDownOpen_||this.showDropdown_(),s.Touch.clearTouchIdentifier()}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let i=0;i<e.length;i++){const s=e[i];Array.isArray(s)?"string"!=typeof s[1]?(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option id must be a string. Found "+s[1]+" in: ",s)):s[0]&&"string"!=typeof s[0]&&"string"!=typeof s[0].src&&(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must have a string label or image description. Found"+s[0]+" in: ",s)):(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must be an array. Found: ",s))}if(t)throw TypeError("Found invalid FieldDropdown options.")}(this.generatedOptions),this.generatedOptions)}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}dropdownDispose_(){this.dropDownOpen_=!1,this.menu_&&this.menu_.dispose(),this.menu_=null,this.selectedMenuItem=null,this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new s.UnattachedFieldError;const t=new s.Menu;t.setRole(s.utils.aria.Role.LISTBOX),this.menu_=t;const i=this.getOptions(!1);this.selectedMenuItem=null;for(let n=0;n<i.length;n++){const[o,r]=i[n],a=(()=>{if("object"==typeof o){const e=new Image(o.width,o.height);return e.src=o.src,e.alt=o.alt||"",e}return o})(),l=new s.MenuItem(a,r);l.setRole(s.utils.aria.Role.OPTION),l.setRightToLeft(e.RTL),l.setCheckable(!0),t.addChild(l),l.setChecked(r===this.value_),r===this.value_&&(this.selectedMenuItem=l),l.onAction(this.handleMenuActionEvent,this)}}showDropdown_(e){const t=this.getSourceBlock();if(!t)throw new s.UnattachedFieldError;this.dropdownCreate(),e&&"number"==typeof e.clientX?this.menu_.openingCoords=new s.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,s.DropDownDiv.clearContent();const i=this.menu_.render(s.DropDownDiv.getContentDiv());s.utils.dom.addClass(i,"blocklyDropdownMenu");const n=t.getParent(),o=(n||t).getColour(),r=(n||t).style.colourTertiary;s.DropDownDiv.setColour(o,r),this.dropDownOpen_=!0,s.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),s.utils.style.scrollIntoContainerView(this.selectedMenuItem.getElement(),s.DropDownDiv.getContentDiv(),!0)),this.applyColour()}updateSize_(e){super.updateSize_(e);const t=this.positionSVGArrow(this.size_.width,this.size_.height/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2);this.size_.width+=t}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const i=this.getSourceBlock();if(!i)throw new s.UnattachedFieldError;const n=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,r=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE,a=i.RTL?n:e+o;return this.svgArrow.setAttribute("transform","translate("+a+","+t+")"),r+o}createSVGArrow(){this.svgArrow=s.utils.dom.createSvgElement("image",{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(s.utils.dom.XLINK_NS,"xlink:href",o.DROPDOWN_SVG_DATAURI)}handleMenuActionEvent(e){s.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue()),s.WidgetDiv.hideIfOwner(this)}}i.BaseFieldTextDropdown=n,n.DROPDOWN_SVG_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiM1NzVFNzUiLz48L3N2Zz4K";class o extends n{constructor(e,t,i){super(e,t.values,i),this.isFieldCustom_=!0}}i.FieldTextDropdown=o},{blockly:197}],51:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextInput=void 0;const s=e("blockly");class n extends s.FieldTextInput{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0}}i.FieldTextInput=n},{blockly:197}],52:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTilemap=void 0;const s=e("./field_asset");class n extends s.FieldAssetEditor{getInitText(){return this.initText}getTileset(){var e;return null===(e=this.asset)||void 0===e?void 0:e.data.tileset}getAssetType(){return"tilemap"}createNewAsset(e=""){var t;e&&(e=e.replace(/&#96;/g,"`"));const i=pxt.react.getTilemapProject(),s=pxt.lookupProjectAssetByTSReference(e,i);if(s)return s;if(null===(t=this.sourceBlock_)||void 0===t?void 0:t.isInFlyout)return;const n=pxt.sprite.decodeTilemap(e,"typescript",i)||i.blankTilemap(this.params.tileWidth,this.params.initWidth,this.params.initHeight);let o;if(function(e){return!!(e&&e.tilemap&&e.tilemap.width&&e.tilemap.height&&e.layers&&e.layers.width===e.tilemap.width&&e.layers.height===e.tilemap.height&&e.tileset)}(n)){this.initText=e,this.isGreyBlock=!1;const[t]=i.createNewTilemapFromData(n);o=i.getTilemap(t)}else e.trim()&&(this.isGreyBlock=!0,this.valueText=e);return o}onEditorClose(e){pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),e)}getValueText(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.asset?pxt.getTSReferenceForAsset(this.asset):this.initText?this.getInitText():this.valueText||""}parseFieldOptions(e){return function(e){const t={initWidth:16,initHeight:16,disableResize:!1,tileWidth:16,lightMode:!1};if(!e)return t;if(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),e.tileWidth)if("number"==typeof e.tileWidth)switch(e.tileWidth){case 4:t.tileWidth=4;break;case 8:t.tileWidth=8;break;case 16:t.tileWidth=16;break;case 32:t.tileWidth=32}else switch(e.tileWidth.trim().toLowerCase()){case"4":case"four":t.tileWidth=4;break;case"8":case"eight":t.tileWidth=8;break;case"16":case"sixteen":t.tileWidth=16;break;case"32":case"thirtytwo":t.tileWidth=32}return t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t;function i(e,t){const i=parseInt(e);return isNaN(i)?t:i}}(e)}}i.FieldTilemap=n},{"./field_asset":28}],53:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTileset=void 0;const s=e("./field_images"),n=e("./field_utils"),o=32;class r extends s.FieldImages{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.menuGenerator_=()=>{var e,t;return(null===(e=this.sourceBlock_)||void 0===e?void 0:e.workspace)&&(0,n.needsTilemapUpgrade)(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)?[a()]:r.getReferencedTiles(this.sourceBlock_.workspace)},this.assetChangeListener=()=>{this.doValueUpdate_(this.getValue()),this.forceRerender()},this.blocksInfo=t.blocksInfo}static getReferencedTiles(e){const t=pxt.react.getTilemapProject();if(t.revision()!==r.cachedRevision||e.id!=r.cachedWorkspaceId){r.cachedRevision=t.revision(),r.cachedWorkspaceId=e.id;const i=(0,n.getAllReferencedTiles)(e),s=[16,4,8,32];for(const e of s){const s=t.getProjectTiles(e,16===e);if(s)for(const e of s.tiles)i.find((t=>t.id===e.id))||i.push(e)}let a={};i.sort(((e,t)=>e.id===t.id?0:e.bitmap.width!==t.bitmap.width?e.bitmap.width-t.bitmap.width:e.isProjectTile!==t.isProjectTile?e.isProjectTile?-1:1:(a[e.id]||(a[e.id]=c(e.id)))-(a[t.id]||(a[t.id]=c(t.id)))));const h=e=>c(e.id)<=2?l(e.bitmap.width):(0,n.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1);r.referencedTiles=i.map((e=>[{src:h(e),width:o,height:o,alt:u(e)},e.id,e]))}return r.referencedTiles}initView(){super.initView(),this.sourceBlock_&&this.sourceBlock_.isInFlyout&&this.setValue(this.getOptions()[0][1])}getValue(){if(this.selectedOption_){let e=this.selectedOption_[2];return(e=pxt.react.getTilemapProject().lookupAsset(e.type,e.id))?pxt.getTSReferenceForAsset(e):super.getValue()}const e=super.getValue();return"string"==typeof e&&-1===e.indexOf(".")&&-1===e.indexOf("`")?`img\`${e}\``:e}getText(){const e=this.getValue();return"string"==typeof e&&-1!==e.indexOf("`")?e:super.getText()}render_(){if(this.value_&&this.selectedOption_&&this.selectedOption_[1]!==this.value_){const e=pxt.react.getTilemapProject().resolveTile(this.value_);r.cachedRevision=-1,e&&(this.selectedOption_=[{src:(0,n.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),o,!1),width:o,height:o,alt:u(e)},this.value_,e])}super.render_()}doValueUpdate_(e){let t=!1;const i=this.getOptions(!0);if(e){const s=pxt.parseAssetTSReference(e);s&&(e=s.name),e=e.trim();for(const s of i)if(e===s[2].id||e===s[2].meta.displayName||e===pxt.getShortIDForAsset(s[2]))return this.selectedOption_=s,this.value_=this.getValue(),this.updateAssetListener(),super.doValueUpdate_(s[1]),void(t=!0);t||super.doValueUpdate_(e),this.selectedOption_=null,this.updateAssetListener()}}doClassValidation_(e){if(!this.getOptions(!0).some((([t,i])=>i===e))){if(e){const t=pxt.react.getTilemapProject(),i=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(e);if(i){const s=t.lookupAssetByName("tile",i[1]);if(s)return this.localTile=s,e}}return this.sourceBlock_&&console.warn(`Trying to set tile reference to nonexistent tile. Block type: ${this.sourceBlock_.type}, Field name: ${this.name}, Value: ${e}`),null}return e}getOptions(e){if("function"!=typeof this.menuGenerator_){this.transparent=a();const e=[this.transparent];return this.localTile&&e.push([{src:(0,n.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.localTile.bitmap),o,!1),width:o,height:o,alt:u(this.localTile)},this.localTile.id,this.localTile]),e}return this.menuGenerator_.call(this)}dispose(){super.dispose(),pxt.react.getTilemapProject().removeChangeListener("tile",this.assetChangeListener)}updateAssetListener(){const e=pxt.react.getTilemapProject();e.removeChangeListener("tile",this.assetChangeListener),this.selectedOption_&&e.addChangeListener(this.selectedOption_[2],this.assetChangeListener)}}function a(){const e=pxt.react.getTilemapProject().getTransparency(16);return[{src:l(16),width:o,height:o,alt:pxt.U.lf("transparency")},e.id,e]}function l(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e,t.height=e,i.fillStyle="#aeaeae",i.fillRect(0,0,e,e),i.fillStyle="#dedede";for(let t=0;t<e;t+=4)for(let s=0;s<e;s+=4)t+s>>2&1&&i.fillRect(t,s,4,4);return t.toDataURL()}function c(e){switch(e){case"myTiles.transparency16":return 1;case"myTiles.transparency4":case"myTiles.transparency8":case"myTiles.transparency32":return 2;default:if(e.startsWith("myTiles.tile")){const t=parseInt(e.slice(12));if(!Number.isNaN(t))return t+2}return 9999999999}}function u(e){return e.meta.displayName||pxt.getShortIDForAsset(e)}i.FieldTileset=r},{"./field_images":36,"./field_utils":64}],54:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggle=i.BaseFieldToggle=void 0;const s=e("blockly"),n=e("../constants");class o extends s.FieldNumber{constructor(e,t,i,s,n){super(e,void 0,void 0,void 0,n),this.trueText=i,this.falseText=s,this.isFieldCustom_=!0,this.CURSOR="pointer",this.params=t,this.setValue(e),this.type_=t.type}initView(){if(!this.fieldGroup_)return;this.clickTarget_=this.sourceBlock_.getSvgRoot(),!this.sourceBlock_.isShadow()&&this.sourceBlock_.inputList&&this.sourceBlock_.inputList.length>1&&(this.borderRect_=s.utils.dom.createSvgElement("rect",{rx:this.getConstants().CORNER_RADIUS,ry:this.getConstants().CORNER_RADIUS,x:0,y:0,width:this.size_.width,height:this.size_.height,fill:this.sourceBlock_.getColour(),stroke:this.sourceBlock_.getColourTertiary()},null),this.fieldGroup_.insertBefore(this.borderRect_,this.textElement_));const e=this.getSize();switch(this.checkElement_=s.utils.dom.createSvgElement("g",{class:"blocklyToggle "+(this.state_?"blocklyToggleOn":"blocklyToggleOff"),transform:`translate(8, ${e.height/2})`},this.fieldGroup_),this.getOutputShape()){case n.provider.SHAPES.HEXAGONAL:this.toggleThumb_=s.utils.dom.createSvgElement("polygon",{class:"blocklyToggleRect",points:"-7,-14 -21,0 -7,14 7,14 21,0 7,-14",cursor:"pointer"},this.checkElement_);break;case n.provider.SHAPES.ROUND:this.toggleThumb_=s.utils.dom.createSvgElement("rect",{class:"blocklyToggleCircle",x:-6,y:-14,height:28,width:28,rx:14,ry:14,cursor:"pointer"},this.checkElement_);break;case n.provider.SHAPES.SQUARE:this.toggleThumb_=s.utils.dom.createSvgElement("rect",{class:"blocklyToggleRect",x:-6,y:-14,height:28,width:28,rx:3,ry:3,cursor:"pointer"},this.checkElement_)}let t=this.sourceBlock_.RTL?-e.width/2:e.width/2;this.textElement_=s.utils.dom.createSvgElement("text",{class:"blocklyText",x:t,dy:"0.6ex",y:e.height/2},this.fieldGroup_),this.updateEditable(),this.switchToggle(this.state_),this.setValue(this.getValue()),this.markDirty()}getDisplayText_(){return this.state_?this.getTrueText():this.getFalseText()}getTrueText(){return this.trueText}getFalseText(){return this.falseText}updateSize_(){switch(this.getOutputShape()){case n.provider.SHAPES.ROUND:this.size_.width=2*this.getInnerWidth()-7;break;case n.provider.SHAPES.HEXAGONAL:this.size_.width=2*this.getInnerWidth()+8-Math.floor(this.getInnerWidth()/2);break;case n.provider.SHAPES.SQUARE:this.size_.width=9+2*this.getInnerWidth()}}getInnerWidth(){return 10*this.getMaxLength()}getMaxLength(){return Math.max(this.getTrueText().length,this.getFalseText().length)}getOutputShape(){return this.sourceBlock_.isShadow()?this.sourceBlock_.getOutputShape():n.provider.SHAPES.SQUARE}doClassValidation_(e){return"boolean"==typeof this.fromVal(e)?e:"false"}applyColour(){let e=this.sourceBlock_.getColourTertiary();this.borderRect_?this.borderRect_.setAttribute("stroke",e):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e)}getValue(){return this.toVal(this.state_)}doValueUpdate_(e){let t=this.fromVal(e);this.state_!==t&&(this.sourceBlock_&&s.Events.isEnabled()&&s.Events.fire(new s.Events.BlockChange(this.sourceBlock_,"field",this.name,this.state_,t)),this.state_=t,this.switchToggle(this.state_),this.isDirty_=!0)}switchToggle(e){if(this.checkElement_){this.updateSize_();const t=this.getSize(),i=this.getInnerWidth();e?(pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOff")):(pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOff"));const s=this.getOutputShape();let o=0,r=0,a=0,l=0;switch(s){case n.provider.SHAPES.HEXAGONAL:a=-(r=(o=t.width/2)/2),l=r-i,this.toggleThumb_.setAttribute("points",`0,-14 -14,0 0,14 ${o},14 ${o+14},0 ${o},-14`);break;case n.provider.SHAPES.ROUND:case n.provider.SHAPES.SQUARE:r=(o=5+i)/2,this.toggleThumb_.setAttribute("width",""+o),this.toggleThumb_.setAttribute("x",`-${r}`),a=l=s==n.provider.SHAPES.SQUARE?2:-6}this.checkElement_.setAttribute("transform",`translate(${e?l+i+r:r+a}, ${t.height/2})`)}}render_(){if(this.visible_&&this.textElement_){for(;this.textElement_.firstChild;)this.textElement_.firstChild.remove();let e=document.createTextNode(this.getDisplayText_());this.textElement_.appendChild(e),pxt.BrowserUtils.addClass(this.textElement_,"blocklyToggleText"),this.updateSize_();let t=this.size_.width,i=(this.state_?t+t/8:t/2)-t/2;this.textElement_.setAttribute("x",`${i}`)}this.borderRect_&&(this.borderRect_.setAttribute("width",`${this.size_.width}`),this.borderRect_.setAttribute("height",`${this.size_.height}`))}showEditor_(){let e=!this.state_;null!==e&&this.setValue(this.toVal(e))}toVal(e){return"number"==this.type_?String(e?"1":"0"):String(e?"true":"false")}fromVal(e){return"string"==typeof e?"1"==e||"TRUE"==e.toUpperCase():!!e}}i.BaseFieldToggle=o;i.FieldToggle=class extends o{constructor(e,t,i){super(e,t,lf("True"),lf("False"),i)}}},{"../constants":18,blockly:197}],55:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleDownUp=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("DOWN"),lf("UP"),i)}}i.FieldToggleDownUp=n},{"./field_toggle":54}],56:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleHighLow=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("HIGH"),lf("LOW"),i)}}i.FieldToggleHighLow=n},{"./field_toggle":54}],57:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleOnOff=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("ON"),lf("OFF"),i)}}i.FieldToggleOnOff=n},{"./field_toggle":54}],58:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleUpDown=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("UP"),lf("DOWN"),i)}}i.FieldToggleUpDown=n},{"./field_toggle":54}],59:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleWinLose=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("WIN"),lf("LOSE"),i)}}i.FieldToggleWinLose=n},{"./field_toggle":54}],60:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleYesNo=void 0;const s=e("./field_toggle");class n extends s.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("Yes"),lf("No"),i)}}i.FieldToggleYesNo=n},{"./field_toggle":54}],61:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTsExpression=void 0;const s=e("blockly");class n extends s.FieldTextInput{constructor(){super(...arguments),this.isFieldCustom_=!0,this.pythonMode=!1}updateEditable(){let e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(pxt.BrowserUtils.addClass(e,"blocklyEditableText"),pxt.BrowserUtils.removeClass(e,"blocklyGreyExpressionBlockText"),this.fieldGroup_.style.cursor=this.CURSOR):(pxt.BrowserUtils.addClass(e,"blocklyGreyExpressionBlockText"),pxt.BrowserUtils.removeClass(e,"blocklyEditableText"),this.fieldGroup_.style.cursor=""))}setPythonEnabled(e){e!==this.pythonMode&&(this.pythonMode=e,this.forceRerender())}getText(){return this.pythonMode?pxt.Util.lf("<python code>"):this.getValue()}applyColour(){var e;this.sourceBlock_&&(null===(e=this.getConstants())||void 0===e?void 0:e.FULL_BLOCK_FIELDS)&&this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourPrimary),this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourPrimary))}}i.FieldTsExpression=n},{blockly:197}],62:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTurnRatio=void 0;const s=e("blockly"),n=e("../plugins/math");class o extends n.FieldSlider{constructor(e,t,i){super(String(e),"-200","200","1","10","TurnRatio",i),this.isFieldCustom_=!0,this.params=t,this.sliderColor_="#a8aaa8"}createLabelDom_(e){let t=document.createElement("div"),i=s.utils.dom.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",height:o.HALF+o.HANDLE_RADIUS+10+"px",width:2*o.HALF+"px"},t),n=s.utils.dom.createSvgElement("defs",{},i),r=s.utils.dom.createSvgElement("marker",{id:"head",orient:"auto",markerWidth:"2",markerHeight:"4",refX:"0.1",refY:"1.5"},n);s.utils.dom.createSvgElement("path",{d:"M0,0 V3 L1.5,1.5 Z",fill:"#f12a21"},r),this.reporter_=pxsim.svg.child(i,"text",{x:o.HALF,y:96,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"}),this.path_=s.utils.dom.createSvgElement("path",{x1:o.HALF,y1:o.HALF,"marker-end":"url(#head)",style:"fill: none; stroke: #f12a21; stroke-width: 10"},i),this.updateGraph_();let a=document.createElement("span");return a.setAttribute("class","blocklyFieldSliderReadout"),[t,a]}updateGraph_(){if(!this.path_)return;let e=Math.min(Math.max(Number(this.getValue())||0,-200),200);const t=e/100,i=Math.max(-1,Math.min(1,t)),s=Math.max(i)*Math.PI/2,n=o.RADIUS-6;let r=o.HALF;const a=o.HALF-22;Math.abs(t)>1&&(r-=(t-(t>0?1:-1))*n/2);const l=.2+.5*Math.abs(i),c=n*l,u=n*Math.sin(Math.PI/2-s),h=n*Math.cos(Math.PI/2-s),d=u-n*l*Math.cos(2*s),p=`M ${r} ${a} C ${r} ${a-c} ${r+(h-n*l*Math.sin(2*s))} ${a-d} ${r+h} ${a-u}`;this.path_.setAttribute("d",p),this.reporter_.textContent=`${e}`}setReadout(e){this.updateGraph_()}}i.FieldTurnRatio=o,o.HALF=80,o.HANDLE_RADIUS=30,o.RADIUS=o.HALF-o.HANDLE_RADIUS-1},{"../plugins/math":101,blockly:197}],63:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getNextValue=i.FieldUserEnum=void 0;const s=e("blockly"),n=e("../external"),o=e("./field_dropdown");class r extends o.FieldDropdown{constructor(e){super(function(e){return function(){const t=[];return this.sourceBlock_&&this.sourceBlock_.workspace?this.sourceBlock_.workspace.getVariablesOfType(e.name).forEach((e=>{const i=e.name.replace(/^\d+/,"");t.push([i,e.name])})):e.initialMembers.forEach((e=>t.push([e,e]))),t.push([lf("Add a new {0}...",e.memberName),"CREATE"]),t}}(e)),this.opts=e}init(){super.init(),this.initVariables()}onItemSelected_(e,t){"CREATE"===t.getValue()?a(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),(e=>e&&this.setValue(e))):super.onItemSelected_(e,t)}doClassValidation_(e){var t;return(null===(t=this.opts)||void 0===t?void 0:t.initialMembers)&&!this.opts.initialMembers.find((t=>t==e))&&this.getOptions(),super.doClassValidation_(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){const e=this.sourceBlock_.workspace,t=c(e,this.opts.name);if(this.opts.initialMembers.forEach((i=>{t.some((([e,t])=>e===i))||h(e,this.opts,i)})),"CREATE"===this.getValue()){const t=function(e,t,i){const s=e.getVariablesOfType(t);if(s&&s.length)for(let e=0;e<s.length;e++){const[t]=l(s[e]);if(t===i)return s[e].name}}(e,this.opts.name,this.opts.initialMembers[0]);t&&this.setValue(t)}}}}function a(e,t,i,o){(0,n.prompt)(i,null,(n=>{if(n){let r=!1;if(pxtc.isIdentifierStart(n.charCodeAt(0),2)){r=!0;for(let e=1;e<n.length;e++)pxtc.isIdentifierPart(n.charCodeAt(e),2)||(r=!1)}if(!r)return void s.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),(()=>a(e,t,i,o)));const l=c(e,t.name);for(let r=0;r<l.length;r++){const[c,u]=l[r];if(c===n)return void s.dialog.alert(lf("A {0} named '{1}' already exists.",t.memberName,n),(()=>a(e,t,i,o)))}o(h(e,t,n))}}),{placeholder:t.promptHint})}function l(e){const t=/^(\d+)([^0-9].*)$/.exec(e.name);return t?[t[2],parseInt(t[1])]:[e.name,-1]}function c(e,t){const i=e.getVariablesOfType(t);return i&&i.length?i.map(l):[]}function u(e,t){const i=e.map((([e,t])=>t));if(t.isBitMask){for(let e=0;e<i.length;e++){let t=1<<e;if(i.indexOf(t)<0)return t}return 1<<i.length}if(t.isHash)return 0;{const e=t.firstValue||0;for(let t=0;t<i.length;t++)if(i.indexOf(e+t)<0)return e+t;return e+i.length}}function h(e,t,i){const n=u(c(e,t.name),t)+i;return s.Variables.getOrCreateVariablePackage(e,null,n,t.name),n}i.FieldUserEnum=r,i.getNextValue=u},{"../external":24,"./field_dropdown":33,blockly:197}],64:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getBlockDataForField=i.setBlockDataForField=i.setBlockData=i.getBlockData=i.workspaceToScreenCoordinates=i.setMelodyEditorOpen=i.FieldEditorOpenEvent=i.FIELD_EDITOR_OPEN_EVENT_TYPE=i.getTemporaryAssets=i.getTilesReferencedByTilesets=i.getAllReferencedTiles=i.getAllFields=i.upgradeTilemapsInWorkspace=i.needsTilemapUpgrade=i.getAllBlocksWithTilesets=i.getAllBlocksWithTilemaps=i.songToDataURI=i.tilemapToImageURI=i.bitmapToImageURI=i.parseColour=i.svg=void 0;const s=e("blockly"),n=e("./field_tilemap"),o=e("./field_animation"),r=e("./field_musiceditor"),a=e("./field_sprite"),l=e("./field_tileset");var c;function u(e,t){const i=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE);for(const s of i)if(parseInt(s.name.substr(0,s.name.indexOf(";")))===t.projectId){e.deleteVariableById(s.getId());break}}function h(e){return p(e,(e=>e instanceof n.FieldTilemap&&!e.isGreyBlock))}function d(e){return p(e,(e=>e instanceof l.FieldTileset))}function p(e,t){const i=[];return e.getTopBlocks(!1).forEach((e=>function e(s){for(const n of s.inputList){for(const e of n.fieldRow)t(e)&&i.push({block:s,field:e.name,ref:e});n.connection&&n.connection.targetBlock()&&e(n.connection.targetBlock())}s.nextConnection&&s.nextConnection.targetBlock()&&e(s.nextConnection.targetBlock())}(e))),i}(c=i.svg||(i.svg={})).hasClass=function(e,t){return pxt.BrowserUtils.containsClass(e,t)},c.addClass=function(e,t){pxt.BrowserUtils.addClass(e,t)},c.removeClass=function(e,t){pxt.BrowserUtils.removeClass(e,t)},i.parseColour=function(e){const t=Number(e);return isNaN(t)?"string"==typeof e&&e.match(/^#[0-9a-fA-F]{6}$/)?e:"#000":s.utils.colour.hueToHex(t)},i.bitmapToImageURI=function(e,t,i){const s=pxt.appTarget.runtime.palette.slice(1),n=document.createElement("canvas");n.width=t,n.height=t;const o=Math.min(t/e.width,t/e.height),r=Math.max(Math.floor(t*(1-e.width/e.height)/2),0),a=Math.max(Math.floor(t*(1-e.height/e.width)/2),0);let l;i?((l=n.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=n.getContext("2d");for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++){const c=e.get(t,n);c?(l.fillStyle=s[c-1],l.fillRect(r+t*o,a+n*o,o,o)):i&&(l.fillStyle="#dedede",l.fillRect(r+t*o,a+n*o,o,o))}return n.toDataURL()},i.tilemapToImageURI=function(e,t,i){const s=pxt.appTarget.runtime.palette.slice(),n=document.createElement("canvas");n.width=t,n.height=t;const o=Math.min(t/e.tilemap.width,t/e.tilemap.height),r=Math.max(Math.floor(t*(1-e.tilemap.width/e.tilemap.height)/2),0),a=Math.max(Math.floor(t*(1-e.tilemap.height/e.tilemap.width)/2),0);let l;i?((l=n.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,t)):l=n.getContext("2d");let c=[];for(let t=0;t<e.tilemap.width;t++)for(let n=0;n<e.tilemap.height;n++){const u=e.tilemap.get(t,n);if(u){if(!c[u]){const t=e.tileset.tiles[u];c[u]=t?pxt.sprite.computeAverageColor(pxt.sprite.Bitmap.fromData(t.bitmap),s):"#dedede"}l.fillStyle=c[u],l.fillRect(r+t*o,a+n*o,o,o)}else i&&(l.fillStyle="#dedede",l.fillRect(r+t*o,a+n*o,o,o))}return n.toDataURL()},i.songToDataURI=function(e,t,i,s,n){const o=pxt.appTarget.runtime.palette.slice(),r=document.createElement("canvas");let a;r.width=t,r.height=i,s?((a=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",a.fillRect(0,0,t,i)):a=r.getContext("2d");const l=[5,11,5,4,2,6,14,2,5,1];n=n||e.measures;const c=Math.max(Math.floor(t/(e.beatsPerMeasure*n*2)),1),u=Math.floor(t/c),h=Math.max(Math.floor(i/12),1),d=Math.floor(i/h);for(const t of e.tracks)for(const i of t.notes){const s=Math.floor(i.startTick/(e.ticksPerBeat/2));if(s>u)break;for(const n of i.notes){const i=12-n.note%12;i>d||(a.fillStyle=o[l[t.id||e.tracks.indexOf(t)]],a.fillRect(s*c,i*h,c,h))}}return r.toDataURL()},i.getAllBlocksWithTilemaps=h,i.getAllBlocksWithTilesets=d,i.needsTilemapUpgrade=function(e){return!!e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name))).length},i.upgradeTilemapsInWorkspace=function(e,t){const i=e.getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map((e=>pxt.sprite.legacy.blocklyVariableToTile(e.name)));if(i.length)try{s.Events.disable();let n=[];for(const s of i)s.qualifiedName?n[s.projectId]=t.resolveTile(s.qualifiedName):s.data&&(n[s.projectId]=t.createNewTile(s.data,"myTiles.tile"+s.projectId)),u(e,s);const o=h(e);for(const e of o){const i=pxt.sprite.legacy.decodeTilemap(e.ref.getInitText(),"typescript"),s=[],o=new pxt.sprite.TilemapData(i.tilemap,{tileWidth:i.tileset.tileWidth,tiles:i.tileset.tiles.map(((e,i)=>null!=e.projectId?n[e.projectId]:(s[i]||(s[i]=t.resolveTile(e.qualifiedName)),s[i])))},i.layers);e.ref.setValue(pxt.sprite.encodeTilemap(o,"typescript"))}const r=d(e);for(const e of r)e.ref.doValueUpdate_(e.ref.getValue()),e.ref.getSize()}finally{s.Events.enable()}},i.getAllFields=p,i.getAllReferencedTiles=function(e,t){var i;let s={};const n=h(e),o=pxt.react.getTilemapProject();for(const e of n)if(e.block.id!==t)for(const t of(null===(i=e.ref.getTileset())||void 0===i?void 0:i.tiles)||[])s[t.id]=o.lookupAsset("tile",t.id);const r=o.getAssets("tilemap");for(const e of r)for(const t of e.data.tileset.tiles)s[t.id]=o.lookupAsset("tile",t.id);const a=d(e);for(const e of a){const t=e.ref.getValue(),i=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(t);if(i){const e=o.lookupAssetByName("tile",i[1]);e&&!s[e.id]&&(s[e.id]=e)}else s[t]||(s[t]=o.resolveTile(t))}return Object.keys(s).map((e=>s[e])).filter((e=>!!e))},i.getTilesReferencedByTilesets=function(e){let t={};const i=pxt.react.getTilemapProject(),s=d(e);for(const e of s){const s=e.ref.getValue(),n=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(s);if(n){const e=i.lookupAssetByName("tile",n[1]);e&&!t[e.id]&&(t[e.id]=e)}else t[s]||(t[s]=i.resolveTile(s))}return Object.keys(t).map((e=>t[e])).filter((e=>!!e))},i.getTemporaryAssets=function(e,t){switch(t){case"image":return p(e,(e=>e instanceof a.FieldSpriteEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"animation":return p(e,(e=>e instanceof o.FieldAnimationEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));case"song":return p(e,(e=>e instanceof r.FieldMusicEditor&&e.isTemporaryAsset())).map((e=>e.ref.getAsset()));default:return[]}},i.FIELD_EDITOR_OPEN_EVENT_TYPE="field_editor_open";class g extends s.Events.UiBase{constructor(e,t){super(e.workspace.id),this.type=i.FIELD_EDITOR_OPEN_EVENT_TYPE,this.blockId=e.id,this.isOpen=t}}function m(e){return e.data?/^(?:\d+;?)+$/.test(e.data)?{commentRefs:e.data.split(";"),fieldData:{}}:JSON.parse(e.data):{commentRefs:[],fieldData:{}}}function f(e,t){e.data=JSON.stringify(t)}i.FieldEditorOpenEvent=g,i.setMelodyEditorOpen=function(e,t){s.Events.fire(new g(e,t))},i.workspaceToScreenCoordinates=function(e,t){const i=t.scale(e.scale),n=e.getOriginOffsetInPixels(),o=s.utils.Coordinate.sum(i,n),r=e.getInjectionDiv().getBoundingClientRect();return new s.utils.Coordinate(o.x+r.left,o.y+r.top)},i.getBlockData=m,i.setBlockData=f,i.setBlockDataForField=function(e,t,i){const s=m(e);s.fieldData[t]=i,f(e,s)},i.getBlockDataForField=function(e,t){return m(e).fieldData[t]}},{"./field_animation":26,"./field_musiceditor":40,"./field_sprite":48,"./field_tilemap":52,"./field_tileset":53,blockly:197}],65:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./field_utils"),i),n(e("./fieldEditorRegistry"),i),n(e("./field_animation"),i),n(e("./field_argumentvariable"),i),n(e("./field_kind"),i),n(e("./field_asset"),i),n(e("./field_ledmatrix"),i),n(e("./field_styledlabel"),i),n(e("./field_base"),i),n(e("./field_tsexpression"),i),n(e("./field_textinput"),i),n(e("./field_tilemap"),i),n(e("./field_userenum"),i),n(e("./field_procedure"),i),n(e("./field_sprite"),i),n(e("./field_imagedropdown"),i),n(e("./field_protractor"),i),n(e("./field_toggle_highlow"),i),n(e("./field_images"),i),n(e("./field_sound_effect"),i),n(e("./field_toggle_onoff"),i),n(e("./field_speed"),i),n(e("./field_toggle_updown"),i),n(e("./field_toggle_winlose"),i),n(e("./field_autocomplete"),i),n(e("./field_melodySandbox"),i),n(e("./field_toggle_yesno"),i),n(e("./field_musiceditor"),i),n(e("./field_textdropdown"),i),n(e("./field_note"),i),n(e("./field_turnratio"),i),n(e("./field_colorwheel"),i),n(e("./field_numberdropdown"),i),n(e("./field_colour"),i),n(e("./field_position"),i),n(e("./field_tileset"),i),n(e("./field_gridpicker"),i),n(e("./field_toggle"),i)},{"./fieldEditorRegistry":25,"./field_animation":26,"./field_argumentvariable":27,"./field_asset":28,"./field_autocomplete":29,"./field_base":30,"./field_colorwheel":31,"./field_colour":32,"./field_gridpicker":34,"./field_imagedropdown":35,"./field_images":36,"./field_kind":37,"./field_ledmatrix":38,"./field_melodySandbox":39,"./field_musiceditor":40,"./field_note":41,"./field_numberdropdown":42,"./field_position":43,"./field_procedure":44,"./field_protractor":45,"./field_sound_effect":46,"./field_speed":47,"./field_sprite":48,"./field_styledlabel":49,"./field_textdropdown":50,"./field_textinput":51,"./field_tilemap":52,"./field_tileset":53,"./field_toggle":54,"./field_toggle_highlow":56,"./field_toggle_onoff":57,"./field_toggle_updown":58,"./field_toggle_winlose":59,"./field_toggle_yesno":60,"./field_tsexpression":61,"./field_turnratio":62,"./field_userenum":63,"./field_utils":64}],66:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.attachCardInfo=i.mkCard=i.installHelpResources=i.setHelpResources=i.installBuiltinHelpInfo=i.setBuiltinHelpInfo=void 0;const s=e("blockly"),n=e("./xml"),o=e("./external"),r=e("./toolbox");function a(e,t,i,s,r,a,l,c,u){!s||"string"!=typeof s&&"function"!=typeof s||e.setTooltip(s),r&&e.setHelpUrl(r),a&&e.setColour(a,l,c),u&&e.setDeletable(!1);let h=document.getElementById("blocklyToolboxDefinition"),d=h?(0,n.getFirstChildWithAttr)(h,"block","type",t):void 0;e.codeCard={header:i,name:i,software:1,description:"function"==typeof s?s(e):s,blocksXml:d?'<xml xmlns="http://www.w3.org/1999/xhtml">'+((0,n.cleanOuterHTML)(d)||`<block type="${t}"></block>`)+"</xml>":void 0,url:r},pxt.Util.isTranslationMode()&&(e.customContextMenu=i=>{const s=pxt.blocks.getBlockDefinition(e.type);s&&s.translationIds&&i.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,o.promptTranslateBlock)(t,s.translationIds)}})})}function l(e,t,i,n,o,r,l){let c=s.Blocks[e],u=c.init;u&&(c.init=function(){u.call(this),a(this,e,t,i,n,o,r,l)})}function c(e,t){return{name:e.namespace+"."+e.name,shortName:e.name,description:e.attributes.jsDoc,url:e.attributes.help?"reference/"+e.attributes.help.replace(/^\//,""):void 0,blocksXml:`<xml xmlns="http://www.w3.org/1999/xhtml">${(0,n.cleanOuterHTML)(t)}</xml>`}}i.setBuiltinHelpInfo=function(e,t){const i=pxt.blocks.getBlockDefinition(t);a(e,t,i.name,i.tooltip,i.url,pxt.toolbox.getNamespaceColor(i.category))},i.installBuiltinHelpInfo=function(e){const t=pxt.blocks.getBlockDefinition(e);l(e,t.name,t.tooltip,t.url,pxt.toolbox.getNamespaceColor(t.category))},i.setHelpResources=a,i.installHelpResources=l,i.mkCard=c,i.attachCardInfo=function(e,t){const i=e.apis.byQName[t];if(i){const t=pxt.blocks.compileInfo(i);return c(i,(0,r.createToolboxBlock)(e,i,t))}}},{"./external":24,"./toolbox":120,"./xml":121,blockly:197}],67:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.validateAllReferencedBlocksExist=i.patchShadows=i.patchCommentIds=i.importXml=i.loadWorkspaceXml=i.loadBlocksXml=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=i.getDirectChildren=i.saveBlocksXml=i.workspaceToDom=i.saveWorkspaceXml=i.clearWithoutEvents=i.domToWorkspaceNoEvents=void 0;const s=e("blockly"),n=e("./loader"),o=e("./external"),r=e("./fields");function a(e,t,i){pxt.tickEvent("blocks.domtow");let n=[];p(e),m(e,!1);try{s.Events.disable(),n=s.Xml.domToWorkspace(e,t),r.FieldBase.flushInitQueue();for(const e of t.getAllBlocks())e.afterWorkspaceLoad&&e.afterWorkspaceLoad.call(e);!function(e,t){e.getAllBlocks(!1).filter((e=>!!e.getCommentText())).forEach((i=>{var s,n;const o=i.getCommentText();if(/@hide/.test(o)&&(null==t?void 0:t.applyHideMetaComment))return void i.dispose(!0);let r=o;/@highlight/.test(r)&&(r=r.replace(/@highlight/g,"").trim(),null===(n=(s=e).highlightBlock)||void 0===n||n.call(s,i.id,!0)),/@collapsed/.test(r)&&!i.getParent()&&(r=r.replace(/@collapsed/g,"").trim(),i.setCollapsed(!0)),o===(r=r.replace(/@validate-\S+/g,"").trim())||(null==t?void 0:t.keepMetaComments)||i.setCommentText(r||null)}))}(t,i)}catch(e){pxt.reportException(e)}finally{s.Events.enable()}return n.filter((e=>!!t.getBlockById(e)))}function l(e,t){const i=s.Xml.workspaceToDom(e,t),n=s.Xml.variablesToDom(e.getAllVariables()),o=c(i,"variables");for(const e of o)e.remove();return i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),i}function c(e,t){const i=[];for(let s=0;s<e.childNodes.length;s++){const n=e.childNodes.item(s);n.tagName===t&&i.push(n)}return i}function u(e,t){return h(e,"block","type",t).concat(h(e,"shadow","type",t))}function h(e,t,i,s){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(i)===s))}function d(e,t,i,s){const n=h(e,t,i,s);return n.length?n[0]:void 0}function p(e){const t=c(e,"comment");for(const e of t)e.hasAttribute("id")||e.setAttribute("id",s.utils.idGenerator.genUid())}function g(e){if(2===e.parentElement.childElementCount)return void e.remove();const t=s.utils.xml.createElement("block");for(const i of e.getAttributeNames())t.setAttribute(i,e.getAttribute(i));for(const i of e.childNodes)t.appendChild(i.cloneNode(!0));return e.parentElement.appendChild(t),e.remove(),t}function m(e,t){if("shadow"===e.tagName){const t=e.getAttribute("type");let i=!1;switch(t){case"variables_get_reporter":case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":i=!0}if(i){if(!(e=g(e)))return;let t=c(e,"mutation")[0];t?t.setAttribute("duplicateondrag","true"):((t=s.utils.xml.createElement("mutation")).setAttribute("duplicateondrag","true"),e.appendChild(t))}else("variables_get"===t||f(e))&&(e=g(e))}if(e)for(const i of e.children)m(i,t||"shadow"===e.tagName)}function f(e){for(const t of e.children)if("block"===t.tagName.toLowerCase()||f(t))return!0;return!1}function _(e,t,i){var o;let r=i.getAttribute("type"),a=s.Blocks[r],l=(0,n.blockSymbol)(r);if(!l||!a)return;let c=pxt.blocks.compileInfo(l);null===(o=l.parameters)||void 0===o||o.forEach(((s,n)=>{let o=e.apis.byQName[s.type];if(o&&6==o.kind){let e=d(i,"field","name",c.actualNameToParam[s.name].definitionName);if(e){let i=t[o.name+"."+e.textContent];i&&(e.textContent=i)}}}))}i.domToWorkspaceNoEvents=a,i.clearWithoutEvents=function(e){if(pxt.tickEvent("blocks.clear"),e)try{s.Events.disable(),e.clear(),e.clearUndo()}finally{s.Events.enable()}},i.saveWorkspaceXml=function(e,t){const i=l(e,!t);return s.Xml.domToText(i)},i.workspaceToDom=l,i.saveBlocksXml=function(e,t){return e.getTopBlocks(!1).map((e=>s.Xml.domToText(s.Xml.blockToDom(e,!t))))},i.getDirectChildren=c,i.getBlocksWithType=u,i.getChildrenWithAttr=h,i.getFirstChildWithAttr=d,i.loadBlocksXml=function(e,t){let i=s.utils.xml.textToDom(t),n=s.Xml.domToBlock(i,e);if(e.getMetrics){let t=e.getMetrics(),i=n.getHeightWidth();n.moveBy(t.viewLeft+t.viewWidth/2-i.width/2,t.viewTop+t.viewHeight/2-i.height/2)}},i.loadWorkspaceXml=function(e,t=!1,i){const n=new s.Workspace;try{return a(s.utils.xml.textToDom(e),n,i),n}catch(e){return t||pxt.reportException(e),null}},i.importXml=function(e,t,i,s=!1){try{(0,n.initializeAndInject)(i);const s=(new DOMParser).parseFromString(t,"application/xml"),r=pxt.patching.computePatches(e);r&&(r.filter((e=>"blockId"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{u(s,t).forEach((i=>{i.setAttribute("type",e.map[t]),pxt.debug(`patched block ${t} -> ${e.map[t]}`)}))})))),r.filter((e=>"blockValue"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{const i=t.split("."),n=i[0];i[1],u(s,n).reduce(((e,t)=>e.concat(c(t,"value"))),[]).forEach((i=>{i.setAttribute("name",e.map[t]),pxt.debug(`patched block value ${t} -> ${e.map[t]}`)}))})))),r.filter((e=>"userenum"==e.type)).forEach((e=>Object.keys(e.map).forEach((t=>{h(s,"variable","type",t).forEach((i=>{i.setAttribute("type",e.map[t]),pxt.debug(`patched enum variable type ${t} -> ${e.map[t]}`)}))})))));const a=c(s.children.item(0),"shadow");for(const e of a){const t=s.createElement("block");e.getAttributeNames().forEach((i=>t.setAttribute(i,e.getAttribute(i))));for(let i=0;i<e.childNodes.length;i++)t.appendChild(e.childNodes.item(i));e.replaceWith(t)}m(s.documentElement,!1),p(s.documentElement);const l={};Object.keys(i.apis.byQName).forEach((e=>{let t=i.apis.byQName[e];7==t.kind&&(l[t.namespace+"."+(t.attributes.blockImportId||t.attributes.block||t.attributes.blockId||t.name)]=t.namespace+"."+t.name)}));const d=s.getElementsByTagName("block");for(let e=0;e<d.length;++e)_(i,l,d[e]);return function(e,t){const i=u(e,ts.pxtc.ON_START_TYPE);let s=i.length?i[0]:void 0;if(s)return void s.removeAttribute("deletable");let o=[];const r=t.blocksById;let a,l=e.firstElementChild;for(;l;){const t=l.nextElementSibling,i=l.getAttribute("type");if(!l.getAttribute("disabled")&&!l.getElementsByTagName("statement").length&&(n.buildinBlockStatements[i]||r[i]&&"void"==r[i].retType&&!(0,n.hasArrowFunction)(r[i])))if(a){const t=e.ownerDocument.createElement("next");t.appendChild(l),a.appendChild(t),l.removeAttribute("x"),l.removeAttribute("y"),a=l}else(a=e.ownerDocument.createElement("statement")).setAttribute("name","HANDLER"),s||((s=e.ownerDocument.createElement("block")).setAttribute("type",ts.pxtc.ON_START_TYPE),o.push(s)),s.appendChild(a),a.appendChild(l),l.removeAttribute("x"),l.removeAttribute("y"),a=l;l=t}o.forEach((t=>e.appendChild(t)))}(s.documentElement,i),function(e,t){pxt.U.toArray(e.querySelectorAll("block[type=procedures_defnoreturn]")).forEach((e=>{e.setAttribute("type","function_definition"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")})),pxt.U.toArray(e.querySelectorAll("block[type=procedures_callnoreturn]")).forEach((e=>{e.setAttribute("type","function_call"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")}))}(s.documentElement),(0,o.extensionBlocklyPatch)(e,s.documentElement),(new XMLSerializer).serializeToString(s)}catch(e){return s||pxt.reportException(e),t}},i.patchCommentIds=p,i.patchShadows=m,i.validateAllReferencedBlocksExist=function(e){pxt.U.assert(!!(null==s?void 0:s.Blocks),"Called validateAllReferencedBlocksExist before initializing Blockly");const t=s.utils.xml.textToDom(e),i=t.querySelectorAll("block");for(let e=0;e<i.length;e++)if(!s.Blocks[i.item(e).getAttribute("type")])return!1;const n=t.querySelectorAll("shadow");for(let e=0;e<n.length;e++)if(!s.Blocks[n.item(e).getAttribute("type")])return!1;return!0}},{"./external":24,"./fields":65,"./loader":71,blockly:197}],68:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.external=i.contextMenu=void 0,n(e("./plugins/arrays"),i),n(e("./plugins/functions"),i),n(e("./plugins/logic"),i),n(e("./plugins/math"),i),n(e("./plugins/text"),i),n(e("./plugins/renderer"),i),n(e("./plugins/flyout"),i),n(e("./plugins/newVariableField"),i),n(e("./compiler/compiler"),i),n(e("./compiler/environment"),i),n(e("./loader"),i),n(e("./layout"),i),n(e("./render"),i),n(e("./toolbox"),i),n(e("./fields"),i),n(e("./sourceMap"),i),n(e("./importer"),i),n(e("./diff"),i),n(e("./legacyMutations"),i),n(e("./blockDragger"),i);const o=e("./contextMenu");i.contextMenu=o;const r=e("./external");i.external=r,n(e("./breakpointIcon"),i)},{"./blockDragger":1,"./breakpointIcon":2,"./compiler/compiler":12,"./compiler/environment":13,"./contextMenu":21,"./diff":23,"./external":24,"./fields":65,"./importer":67,"./layout":69,"./legacyMutations":70,"./loader":71,"./plugins/arrays":75,"./plugins/flyout":80,"./plugins/functions":93,"./plugins/logic":99,"./plugins/math":101,"./plugins/newVariableField":105,"./plugins/renderer":110,"./plugins/text":115,"./render":118,"./sourceMap":119,"./toolbox":120}],69:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.documentToSvg=i.blocklyToSvgAsync=i.cleanUpBlocklySvg=i.serializeSvgString=i.serializeNode=i.toSvgAsync=i.toPngAsync=i.screenshotAsync=i.screenshotEnabled=i.flow=i.setCollapsedAll=i.verticalAlign=i.splitSvg=i.patchBlocksFromOldWorkspace=void 0;const s=e("blockly"),n=e("./compiler/environment"),o=e("./fields"),r=e("./compiler/compiler"),a=e("./importer");i.patchBlocksFromOldWorkspace=function(e,t,i){const o=(0,a.loadWorkspaceXml)(i,!0);return function(e,t,i){let s,o;t.getTopBlocks(!1).filter((e=>e.isEnabled())).forEach((a=>{const l=a.getRelativeToSurfaceXY();if(l&&0!=l.x&&0!=l.y){s||(s=(0,n.mkEnv)(t,e),o={},i.getTopBlocks(!1).forEach((e=>{const t=(0,r.callKey)(s,e),i=o[t]||[];i.push(e),o[t]=i})));const c=(0,r.callKey)(s,a),u=(o[c]||[]).shift();if(u){const e=u.getRelativeToSurfaceXY();e.x=l.x,e.y=l.y}}}))}(e,t,o),function(e,t){const i=(0,a.workspaceToDom)(e,!0),n=(0,a.workspaceToDom)(t,!0);return pxt.Util.toArray(i.childNodes).filter((e=>e.nodeType==Node.ELEMENT_NODE&&"block"==e.localName&&"true"==e.getAttribute("disabled"))).filter((e=>!!s.Blocks[e.getAttribute("type")])).forEach((e=>n.appendChild(n.ownerDocument.importNode(e,!0)))),s.Xml.domToText(n)}(t,o)},i.splitSvg=function(e,t,i=18){const s=t.getTopComments(!0),n=t.getTopBlocks(!0);if(s.length+n.length<2)return e;const o=document.createElement("div");function r(t,s,n,r,a,l){const c=e.cloneNode(!0),u=c.querySelector(`g.blocklyWorkspace > g.${t}`),h=c.querySelector(`g.blocklyWorkspace > g.${s}`),d=pxt.Util.toArray(u.querySelectorAll(`g.blocklyWorkspace > g.${t} > ${l?"."+l:"g[transform]"}`)),p=d.splice(n,1)[0];if(!p)return void pxt.log("missing block, did block failed to load?");d.filter((e=>e!=p)).forEach((e=>{e.parentNode.removeChild(e)})),u.removeAttribute("transform"),h.parentNode.removeChild(h),p.setAttribute("transform",`translate(${a.x}, ${a.y})`);const g=r.width/i+"em",m=r.height/i+"em";c.setAttribute("viewBox",`0 0 ${r.width} ${r.height}`),c.style.width=g,c.style.height=m,c.setAttribute("width",g),c.setAttribute("height",m),o.appendChild(c)}return o.className=`blocks-svg-list ${t.getInjectionDiv().className}`,s.forEach(((e,t)=>r("blocklyBubbleCanvas","blocklyBlockCanvas",t,e.getHeightWidth(),{x:0,y:0},"blocklyComment"))),n.forEach(((e,t)=>{const s=e.getHeightWidth(),n={x:0,y:0};e.hat&&(s.height+=i,n.y+=i),r("blocklyBlockCanvas","blocklyBubbleCanvas",t,s,n)})),o},i.verticalAlign=function(e,t){let i=0;e.getTopComments(!0).forEach((e=>{e.moveBy(0,i),i+=e.getHeightWidth().height,i+=t})),e.getTopBlocks(!0).forEach(((e,s)=>{e.hat&&(i+=t),e.moveBy(0,i),i+=e.getHeightWidth().height,i+=t}))},i.setCollapsedAll=function(e,t){e.getTopBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>e.setCollapsed(t)))};const l=20;function c(e,t,i){let s;i&&(s={target:pxt.appTarget.id,versions:pxt.appTarget.versions,xml:(0,a.saveBlocksXml)(e).map((e=>pxt.Util.htmlEscape(e)))});const n=0|t||4;return d(e,n).then((e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:n,text:i?JSON.stringify(s,null,2):null}):Promise.resolve(void 0))).catch((e=>{pxt.reportException(e)}))}i.flow=function(e,t){if(t){if(t.useViewWidth){const t=e.getMetrics();if(t.viewHeight>t.viewWidth)return E(e.getTopComments(!0),e.getTopBlocks(!0),void 0,t.viewWidth),void e.scroll(l,20)}E(e.getTopComments(!0),e.getTopBlocks(!0),t.ratio)}else E(e.getTopComments(!0),e.getTopBlocks(!0));e.scroll(l,20)},i.screenshotEnabled=function(){return!pxt.BrowserUtils.isIE()},i.screenshotAsync=function(e,t,i){return c(e,t,i)},i.toPngAsync=c;const u="http://www.w3.org/1999/xlink",h=12e7;function d(e,t){if(!e)return Promise.resolve(void 0);const i=e.getBlocksBoundingBox(),s=e.getParentSvg().cloneNode(!0);m(s);let n=i.right-i.left,o=i.bottom-i.top,r=1;const a=n*o*Math.pow(t,2);return a>h&&(r=Math.sqrt(h/a)),f(s,i.left,i.top,n,o,r)}function p(e){return g((new XMLSerializer).serializeToString(e))}function g(e){return e.replace(new RegExp("&nbsp;","g"),"&#160;")}function m(e){pxt.BrowserUtils.removeClass(e,"blocklySvg"),pxt.BrowserUtils.addClass(e,"blocklyPreview pxt-renderer classic-theme"),pxt.U.toArray(e.querySelectorAll(".blocklyMainBackground,.blocklyScrollbarBackground")).forEach((e=>{e&&e.parentNode.removeChild(e)})),pxt.U.toArray(e.querySelectorAll(".blocklyConnectionIndicator,.blocklyInputConnectionIndicator")).forEach((e=>{e&&e.parentNode.removeChild(e)})),e.removeAttribute("width"),e.removeAttribute("height"),pxt.U.toArray(e.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.removeAttribute("transform")));const t=new DOMParser;return pxt.U.toArray(e.querySelectorAll(".blocklyCommentTextarea")).forEach((e=>{const i=t.parseFromString("<!doctype html><body>"+pxt.docs.html2Quote(e.value),"text/html");e.textContent=i.body.textContent})),e}function f(e,t,i,s,n,o){if(!e.childNodes[0])return Promise.resolve(void 0);e.removeAttribute("width"),e.removeAttribute("height"),e.removeAttribute("transform");let r=Math.round(s*(o||1)),a=Math.round(n*(o||1));const l=p(e).replace(/^\s*<svg[^>]+>/i,"").replace(/<\/svg>\s*$/i,""),c=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="${u}" width="${r}" height="${a}" viewBox="${t} ${i} ${s} ${n}" class="pxt-renderer classic-theme">${l}</svg>`,h=(new DOMParser).parseFromString(c,"image/svg+xml"),d=h.createElementNS("http://www.w3.org/1999/xhtml","style"),g=pxt.Util.isUserLanguageRtl(),m=document.getElementById(`style-${g?"rtl":""}blockly.css`).href,f=pxt.Util.toArray(document.head.getElementsByTagName("link")).filter((e=>pxt.Util.endsWith(e.getAttribute("href"),"semantic.css")))[0].href;return Promise.all([pxt.BrowserUtils.loadAjaxAsync(m),pxt.BrowserUtils.loadAjaxAsync(f)]).then((e=>{var t,i;const s=pxt.Util.toArray(document.head.querySelectorAll("style")).filter((e=>/\.blocklySvg/.test(e.innerText)))[0];e.unshift((null===(t=document.getElementById("blockly-common-style"))||void 0===t?void 0:t.innerText)||""),e.unshift((null===(i=document.getElementById("blockly-renderer-style-pxt-classic"))||void 0===i?void 0:i.innerText)||"");const n=(s?s.innerText:"")+"\n\n"+e.map((e=>e+"\n\n"));return d.appendChild(h.createCDATASection(n)),h.documentElement.insertBefore(d,h.documentElement.firstElementChild),function(e){b||(b={});const t=e.getElementsByTagName("image"),i=pxt.Util.toArray(t).filter((e=>{const t=e.getAttributeNS(u,"href");return t&&!/^data:/.test(t)})).map((e=>e)).map((e=>{const t=e.getAttributeNS(u,"href");let i=b[t];return(i?Promise.resolve(b[t]):pxt.BrowserUtils.loadImageAsync(e.getAttributeNS(u,"href")).then((e=>{const s=document.createElement("canvas"),n=s.getContext("2d");let o=e.width,r=e.height;return s.width=o,s.height=r,n.drawImage(e,0,0,o,r,0,0,s.width,s.height),b[t]=i=s.toDataURL("image/png"),i})).catch((e=>(pxt.debug(`svg render: failed to load ${t}`),"")))).then((t=>{e.setAttributeNS(u,"href",t)}))}));return Promise.all(i).then((()=>{}))}(h).then((()=>function(e){if(T||(T={}),!pxt.BrowserUtils.isEdge())return Promise.resolve();const t=e.getElementsByTagName("image"),i=pxt.Util.toArray(t).filter((e=>/^data:image\/svg\+xml/.test(e.getAttributeNS(u,"href")))).map((e=>e)).map((e=>{const t=e.getAttributeNS(u,"href"),i=parseInt(e.getAttribute("width").replace(/[^0-9]/g,"")),s=parseInt(e.getAttribute("height").replace(/[^0-9]/g,""));let n=T[t];return(n?Promise.resolve(n):pxt.BrowserUtils.encodeToPngAsync(t,{width:i,height:s,pixelDensity:2})).then((i=>{T[t]=i,e.setAttributeNS(u,"href",i)}))}));return Promise.all(i).then((()=>{}))}(h))).then((()=>({width:r,height:a,svg:p(h).replace('<style xmlns="http://www.w3.org/1999/xhtml">',"<style>"),xml:_(h),css:n})))}))}function _(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(unescape(encodeURIComponent(t)))}let b,T;function E(e,t,i=1.62,s){const n=[],r={};let a;e.forEach((e=>{const t=e.data;null!=t&&(r[t]=e)})),t.sort(((e,t)=>e.isEnabled()===t.isEnabled()?e.type===t.type?0:"function_definition"===e.type?1:"function_definition"===t.type?-1:e.type.localeCompare(t.type):e.isEnabled()?-1:1)),t.forEach((e=>{const t=(0,o.getBlockData)(e).commentRefs;if(t.length){const i=[];for(let e=0;e<t.length;e++){const s=r[t[e]];s&&(i.push(y(s)),delete r[t[e]])}if(i.length)return void n.push({value:e,width:-1,height:-1,children:i})}const i=y(e);!a&&e.isEnabled()&&e.type===pxtc.ON_START_TYPE?a=i:n.push(i)})),a&&n.unshift(a),Object.keys(r).sort(((e,t)=>e.length===t.length?e>t?-1:1:e.length>t.length?-1:1)).forEach((e=>{r[e]&&n.push(y(r[e]))})),e.forEach((e=>{null==e.data&&n.push(y(e))}));let c,u=0;for(let e=0;e<n.length;e++){const t=n[e];if(t.children){const e=t.value.getHeightWidth();t.x=0,t.y=0;let i=e.width+13,s=0;for(let e=0;e<t.children.length;e++){const n=t.children[e];n.x=i,n.y=s,s+=n.height+13,t.width=Math.max(t.width,i+n.width)}t.height=Math.max(s-13,e.height)}u+=(t.height+13)*(t.width+13)}c=s>l?s-l:Math.sqrt(u)*i;let h=l,d=20,p=0;for(let e=0;e<n.length;e++){const t=n[e];if(t.children){g(t,h+t.x,d+t.y);for(let e=0;e<t.children.length;e++){const i=t.children[e];g(i,h+i.x,d+i.y)}}else g(t,h,d);h+=t.width+45,p=Math.max(p,d+t.height+45),h>c&&(h=l,d=p)}function g(e,t,i){const s=e.value.getBoundingRectangle();e.value.moveBy(t-s.left,i-s.top)}}function y(e){const t=e.getHeightWidth();return{value:e,height:t.height,width:t.width}}i.toSvgAsync=d,i.serializeNode=p,i.serializeSvgString=g,i.cleanUpBlocklySvg=m,i.blocklyToSvgAsync=f,i.documentToSvg=_},{"./compiler/compiler":12,"./compiler/environment":13,"./fields":65,"./importer":67,blockly:197}],70:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mutateToolboxBlock=i.addMutation=i.MutatorTypes=void 0;const s=e("blockly"),n=e("./compiler/util"),o=e("./compiler/compiler"),r=e("./loader");var a,l;(l=a=i.MutatorTypes||(i.MutatorTypes={})).ObjectDestructuringMutator="objectdestructuring",l.RestParameterMutator="restparameter",l.DefaultInstanceMutator="defaultinstance",i.addMutation=function(e,t,i){let s;switch(i){case a.ObjectDestructuringMutator:if(!t.parameters||t.parameters.length<1)console.error("Destructuring mutations require at least one parameter");else{let e=!1;for(const i of t.parameters)if(-1!==i.type.indexOf("=>")){if(!i.properties||0===i.properties.length)return void console.error("Destructuring mutations only supported for functions with an event parameter that has multiple properties");e=!0}if(!e)return void console.error("Destructuring mutations must have an event parameter")}s=new u(e,t);break;case a.RestParameterMutator:s=new h(e,t);break;case a.DefaultInstanceMutator:s=new d(e,t);break;default:return void console.warn("Ignoring unknown mutation type: "+i)}e.mutationToDom=s.mutationToDom.bind(s),e.domToMutation=s.domToMutation.bind(s),e.compose=s.compose.bind(s),e.decompose=s.decompose.bind(s),e.mutation=s},i.mutateToolboxBlock=function(e,t,i){const s=document.createElement("mutation");switch(t){case a.ObjectDestructuringMutator:s.setAttribute(u.propertiesAttributeName,i);break;case a.RestParameterMutator:s.setAttribute(h.countAttributeName,i);break;case a.DefaultInstanceMutator:s.setAttribute(d.attributeName,i);default:return void console.warn("Ignoring unknown mutation type: "+t)}e.appendChild(s)};class c{constructor(e,t){this.info=t,this.block=e,this.topBlockType=this.block.type+"_mutator";const i=this.getSubBlockNames();this.initializeMutatorTopBlock(),this.initializeMutatorSubBlocks(i);const n=i.map((e=>e.type));this.block.setMutator(new s.icons.MutatorIcon(n,e))}compose(e){const t=e.getDescendants(!1).map((e=>({type:e.type,name:e.inputList[0].name})));t.shift(),this.updateBlock(t)}decompose(e){const t=e.newBlock(this.topBlockType);t.initSvg();for(const i of t.inputList)if(i.name===c.mutatorStatmentInput){let t=i.connection;this.getVisibleBlockTypes().forEach((i=>{const s=e.newBlock(i);s.initSvg(),t.connect(s.previousConnection),t=s.nextConnection}));break}return t}compileMutation(e,t){}getDeclaredVariables(){}isDeclaredByMutation(e){return!1}initializeMutatorSubBlock(e,t,i){e.appendDummyInput(t).appendField(t),e.setColour(i),e.setNextStatement(!0),e.setPreviousStatement(!0)}initializeMutatorTopBlock(){const e=this.info.attributes.mutateText,t=this.block.getColour();s.Blocks[this.topBlockType]=s.Blocks[this.topBlockType]||{init:function(){this.appendDummyInput().appendField(e),this.setColour(t),this.appendStatementInput(c.mutatorStatmentInput)}}}initializeMutatorSubBlocks(e){const t=this.block.getColour(),i=this.initializeMutatorSubBlock.bind(this);e.forEach((e=>{s.Blocks[e.type]=s.Blocks[e.type]||{init:function(){i(this,e.name,t)}}}))}}c.mutatorStatmentInput="PROPERTIES",c.mutatedVariableInputName="properties";class u extends c{constructor(e,t){super(e,t),this.currentlyVisible=[],this.parameterRenames={},this.prefix=this.info.attributes.mutatePrefix,this.block.appendDummyInput(c.mutatedVariableInputName),this.block.appendStatementInput("HANDLER").setCheck("null")}getMutationType(){return a.ObjectDestructuringMutator}compileMutation(e,t){if(!this.info.attributes.mutatePropertyEnum&&!this.parameters.length)return;const i=`function ({ ${this.parameters.map((t=>{const i=this.block.getField(t),s=i&&i.getText(),o=(0,n.escapeVarName)(t,e);return s!==t?(this.parameterRenames[t]=s,`${t}: ${(0,n.escapeVarName)(s,e)}`):o})).join(", ")} })`;return this.info.attributes.mutatePropertyEnum?pxt.blocks.mkText(` [${this.parameters.map((e=>`${this.info.attributes.mutatePropertyEnum}.${e}`)).join(", ")}],${i}`):pxt.blocks.mkText(i)}getDeclaredVariables(){const e={};return this.parameters.forEach((t=>{e[this.getVarFieldValue(t)]=this.parameterTypes[t]})),e}isDeclaredByMutation(e){return this.parameters.some((t=>this.getVarFieldValue(t)===e))}mutationToDom(){const e=document.createElement("mutation"),t=this.parameters.map((e=>{const t=this.getVarFieldValue(e);return t!==e&&(this.parameterRenames[e]=pxt.Util.htmlEscape(t)),pxt.Util.htmlEscape(e)})).join(",");e.setAttribute(u.propertiesAttributeName,t);for(const e in this.parameterRenames)e===this.parameterRenames[e]&&delete this.parameterRenames[e];return e.setAttribute(u.renameAttributeName,JSON.stringify(this.parameterRenames)),e}domToMutation(e){const t=e.getAttribute(u.propertiesAttributeName);if(t){const i=t.split(","),s=[];if(void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),i.forEach((e=>{const t=e.split(":");this.info.parameters[this.paramIndex].properties.some((e=>e.name===t[0]))&&s.push({property:t[0],newName:t[1]})})),this.parameterRenames=void 0,e.hasAttribute(u.renameAttributeName))try{this.parameterRenames=JSON.parse(e.getAttribute(u.renameAttributeName))}catch(e){console.warn("Ignoring invalid rename map in saved block mutation")}this.parameterRenames=this.parameterRenames||{},this.parameters=[],s.forEach((e=>{this.parameters.push(e.property),e.newName&&e.newName!==e.property&&(this.parameterRenames[e.property]=e.newName)})),this.updateVisibleProperties(),s.filter((e=>!!e.newName)).forEach((e=>this.setVarFieldValue(e.property,e.newName)))}}getVarFieldValue(e){const t=this.block.getField(e);return t&&t.getText()}setVarFieldValue(e,t){this.block.getField(e),this.block.getField(e)&&(0,r.setVarFieldValue)(this.block,e,t)}updateBlock(e){this.parameters=[],e.forEach((e=>{-1===this.parameters.indexOf(e.name)&&this.parameters.push(e.name)})),this.updateVisibleProperties()}getSubBlockNames(){return this.parameters=[],this.parameterTypes={},void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),this.info.parameters[this.paramIndex].properties.map((e=>(this.parameterTypes[e.name]=e.type,{type:this.propertyId(e.name),name:e.name})))}getVisibleBlockTypes(){return this.currentlyVisible.map((e=>this.propertyId(e)))}updateVisibleProperties(){if(pxt.Util.listsEqual(this.currentlyVisible,this.parameters))return;const e=this.block.inputList.find((e=>e.name===c.mutatedVariableInputName));this.prefix&&0===this.currentlyVisible.length&&e.appendField(this.prefix,u.prefixLabel),this.currentlyVisible.forEach((t=>{if(-1===this.parameters.indexOf(t)){const i=this.getVarFieldValue(t);i!==t&&(this.parameterRenames[t]=i),e.removeField(t)}})),this.parameters.forEach((t=>{if(-1===this.currentlyVisible.indexOf(t)){const i=this.parameterRenames[t]||t;e.appendField(new s.FieldVariable(i),t)}})),this.prefix&&0===this.parameters.length&&e.removeField(u.prefixLabel),this.currentlyVisible=this.parameters}propertyId(e){return this.block.type+"_"+e}getParameterIndex(){for(let e=0;e<this.info.parameters.length;e++)if(-1!==this.info.parameters[e].type.indexOf("=>"))return e}}u.propertiesAttributeName="callbackproperties",u.renameAttributeName="renamemap",u.prefixLabel="0prefix_label_";class h extends c{constructor(){super(...arguments),this.count=0}getMutationType(){return a.RestParameterMutator}compileMutation(e,t){const i=[];return this.forEachInput((s=>i.push((0,o.compileExpression)(e,s,t)))),pxt.blocks.mkGroup(i)}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(h.countAttributeName,this.count.toString()),e}domToMutation(e){const t=e.getAttribute(h.countAttributeName);if(t){try{this.count=parseInt(t)}catch(e){return}for(let e=0;e<this.count;e++)this.addNumberField(!1,e)}}updateBlock(e){if(e){const t=Math.abs(this.count-e.length);if(this.count<e.length)for(let e=0;e<t;e++)this.addNumberField(!0,this.count);else if(this.count>e.length)for(let e=0;e<t;e++)this.removeNumberField()}}getSubBlockNames(){return[{name:"Value",type:h.entryTypeName}]}getVisibleBlockTypes(){const e=[];return this.forEachInput((()=>e.push(h.entryTypeName))),e}addNumberField(e,t){const i=this.block.appendValueInput(h.valueInputPrefix+t).setCheck("Number");if(e){const e=this.block.workspace.newBlock("math_number");e.initSvg(),e.setShadow(!0),i.connection.connect(e.outputConnection),this.block.workspace.render(),this.count++}}removeNumberField(){this.count>0&&this.block.removeInput(h.valueInputPrefix+(this.count-1)),this.count--}forEachInput(e){for(let t=0;t<this.count;t++)e(this.block.getInputTargetBlock(h.valueInputPrefix+t),t)}}h.countAttributeName="count",h.entryTypeName="entry",h.valueInputPrefix="value_input_";class d extends c{constructor(){super(...arguments),this.showing=!1}getMutationType(){return a.DefaultInstanceMutator}compileMutation(e,t){if(this.showing){const i=this.block.getInputTargetBlock(d.instanceInputName);if(i)return(0,o.compileExpression)(e,i,t)}}mutationToDom(){const e=document.createElement("mutation");return e.setAttribute(d.attributeName,this.showing?"true":"false"),e}domToMutation(e){const t=e.getAttribute(d.attributeName);t?this.updateShape("true"===t):this.updateShape(!1)}updateBlock(e){this.updateShape(!(!e||!e.length))}getSubBlockNames(){return[{name:"Instance",type:d.instanceSubBlockType}]}getVisibleBlockTypes(){const e=[];return this.showing&&e.push(d.instanceSubBlockType),e}updateShape(e){this.showing!==e&&(e&&!this.block.getInputTargetBlock(d.instanceInputName)?this.block.appendValueInput(d.instanceInputName):this.block.removeInput(d.instanceInputName),this.showing=e)}}d.attributeName="showing",d.instanceInputName="__instance__",d.instanceSubBlockType="instance"},{"./compiler/compiler":12,"./compiler/util":15,"./loader":71,blockly:197}],71:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PxtWorkspaceSearch=i.setVarFieldValue=i.generateIcons=i.getFixedInstanceDropdownValues=i.setOutputCheck=i.initialize=i.initializeAndInject=i.cleanBlocks=i.hasArrowFunction=i.injectBlocks=i.blockSymbol=i.cachedBlockInfo=i.buildinBlockStatements=i.builtinBlocks=i.isTupleType=void 0;const s=e("blockly"),n=e("@blockly/plugin-workspace-search"),o=e("./constants"),r=e("./composableMutations"),a=e("./legacyMutations"),l=e("./builtins/math"),c=e("./fields"),u=e("./builtins/functions"),h=e("./builtins/lists"),d=e("./builtins/logic"),p=e("./builtins/loops"),g=e("./builtins/text"),m=e("./toolbox"),f=e("./help"),_=e("./fields"),b=e("./fields"),T=e("./fields"),E=e("./fields"),y=e("./external"),I=e("./builtins/variables"),k=e("./builtins/misc"),v=e("./contextMenu"),C=e("./codecardRenderer"),S=e("./monkeyPatches"),O=e("./fields/field_dropdown");let A;function w(){return A||(A={},Object.keys(s.Blocks).forEach((e=>A[e]={block:s.Blocks[e]}))),A}i.isTupleType=function(e){let t=/^\[(.+)\]$/.exec(e);return t?t[1].split(/,\s*/):void 0},i.builtinBlocks=w,i.buildinBlockStatements={controls_if:!0,controls_for:!0,pxt_controls_for:!0,controls_simple_for:!0,controls_repeat_ext:!0,pxt_controls_for_of:!0,controls_for_of:!0,variables_set:!0,variables_change:!0,device_while:!0};let R={};function N(e){return i.cachedBlockInfo=e,e.blocks.map((t=>{const i=pxt.blocks.compileInfo(t),n=(0,m.createToolboxBlock)(e,t,i);if(t.attributes.blockBuiltin){pxt.Util.assert(!!w()[t.attributes.blockId]);const e=w()[t.attributes.blockId];e.symbol=t,e.block.codeCard=(0,f.mkCard)(t,n)}else!function(e,t,i,n){let l=t.attributes.blockId;if(w()[l])return pxt.reportError("blocks","trying to override builtin block",{details:l}),!1;let u=JSON.stringify(t);if(R[l]&&R[l].hash==u)return!0;if(s.Blocks[t.attributes.blockId])return console.error("duplicate block definition: "+l),!1;let h={hash:u,fn:t,block:{codeCard:(0,f.mkCard)(t,n),init:function(){!function(e,t,i,n){var l;const u=(i.attributes.blockNamespace||i.namespace).split(".")[0],h=1==i.kind||2==i.kind,d=t.apis.byQName[u],p=i.attributes.blockNamespace&&d&&d.attributes.color||i.attributes.color||d&&d.attributes.color||pxt.toolbox.getNamespaceColor(u)||255,g=pxt.blocks.getHelpUrl(i);g&&e.setHelpUrl(g),e.setColour(p);let m=o.provider.SHAPES.ROUND;"boolean"==i.retType&&(m=o.provider.SHAPES.HEXAGONAL),e.setOutputShape(m),i.attributes.undeletable&&e.setDeletable(!1),k(i.attributes._def);let f=!1;if(i.attributes.mutate)(0,a.addMutation)(e,i,i.attributes.mutate);else if(i.attributes.defaultInstance)(0,a.addMutation)(e,i,a.MutatorTypes.DefaultInstanceMutator);else if(i.attributes._expandedDef&&"disabled"!==i.attributes.expandableArgumentMode){const s="toggle"===i.attributes.expandableArgumentMode;(0,r.initExpandableBlock)(t,e,i.attributes._expandedDef,n,s,(()=>k(i.attributes._expandedDef,!0)))}else if(n.handlerArgs.length)if(f=!0,i.attributes.optionalVariableArgs)(0,r.initVariableArgsBlock)(e,n.handlerArgs);else if(i.attributes.draggableParameters)n.handlerArgs.filter((e=>!e.inBlockDef)).forEach((s=>{const n=e.appendValueInput("HANDLER_DRAG_PARAM_"+s.name);"reporter"==i.attributes.draggableParameters?n.setCheck(D(s.type,t)):n.setCheck("Variable")}));else{let t=e.appendDummyInput();n.handlerArgs.filter((e=>!e.inBlockDef)).forEach((e=>{t.appendField(new s.FieldVariable(e.name),"HANDLER_"+e.name)}))}(0,r.appendMutation)(e,{mutationToDom:t=>(e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.saveOptions){const i=e.saveOptions();i&&t.setAttribute("customfield",JSON.stringify(i))}}))})),t),domToMutation:t=>{e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{if(e.isFieldCustom_&&e.restoreOptions){const i=JSON.parse(t.getAttribute("customfield"));i&&e.restoreOptions(i)}}))}))}});const y=i.attributes.imageLiteral||i.attributes.gridLiteral;if(y){const t=(i.attributes.imageLiteralColumns||5)*y,s=i.attributes.imageLiteralRows||5,n=i.attributes.imageLiteralScale,o=i.attributes.gridLiteralOnColor,r=i.attributes.gridLiteralOffColor;e.appendDummyInput().appendField(new _.FieldMatrix("",{columns:t,rows:s,scale:n,onColor:o,offColor:r}),"LEDS")}"external"===i.attributes.inlineInputMode?e.setInputsInline(!1):"inline"===i.attributes.inlineInputMode?e.setInputsInline(!0):e.setInputsInline(!i.parameters||i.parameters.length<4&&!y),((null===(l=i.parameters)||void 0===l?void 0:l.find((e=>pxtc.parameterTypeIsArrowFunction(e))))||f)&&(e.appendStatementInput("HANDLER").setCheck(null),e.setInputsInline(!0)),M(e,i.retType,t);const I=x(i);function k(r,a=!1){let l=0,u=!a&&!!n.thisParameter;const d=function(e){const t=[];let i=[];return e.parts.forEach((e=>{switch(e.kind){case"break":s();break;case"param":i.push(e),s();break;case"image":case"label":i.push(e)}})),s(),t;function s(){i.length&&(t.push(i),i=[])}}(r),g=new pxt.ImageConverter;if(("ENUM_GET"===i.attributes.shim||"KIND_GET"===i.attributes.shim)&&(n.parameters.length>1||n.thisParameter))return void console.warn(`Enum blocks may only have 1 parameter but ${i.attributes.blockId} has ${n.parameters.length}`);const m=t=>{var i;return null===(i=e.inputList)||void 0===i?void 0:i.some((e=>e.name===t))};d.forEach((r=>{const d=[];let f,_,y,I=!1;if(r.forEach((e=>{if("param"!==e.kind){const t=function(e){if("image"===e.kind)return function(e){let t=P[e];if(t)return new s.FieldImage(t,40,40,"",null,pxt.Util.isUserLanguageRtl());pxt.log(`missing jres icon ${e}`)}(e.uri);const t=function(e){if(" "===e)return"";if(e.length>1){const t=" "==e.charAt(0),i=" "==e.charAt(e.length-1);if(t||i)return e.substring(t?1:0,i?e.length-1:e.length)}return e}(e.text);return t?e.cssClass?new s.FieldLabel(t,e.cssClass):e.style.length?new b.FieldStyledLabel(t,{bold:-1!==e.style.indexOf("bold"),italics:-1!==e.style.indexOf("italics"),blocksInfo:void 0}):new s.FieldLabel(t,void 0):void 0}(e);t&&d.push({field:t})}else{if("ENUM_GET"===i.attributes.shim)return pxt.Util.assert(!!i.attributes.enumName,"Trying to create an ENUM_GET block without a valid enum name"),void d.push({name:"MEMBER",field:new T.FieldUserEnum(t.enumsByName[i.attributes.enumName])});if("KIND_GET"===i.attributes.shim)return void d.push({name:"MEMBER",field:new c.FieldKind(t.kindsByName[i.attributes.kindNamespace||i.attributes.blockNamespace||i.namespace])});{let o=function(e,t,i=!1){if(e.ref){const i="this"===e.name?t.thisParameter:t.actualNameToParam[e.name];if(!i){let i;if(t.handlerArgs.forEach((t=>{t.name===e.name&&(i=t)})),i)return i}return i}return i?t.thisParameter:t.definitionNameToParam[e.name]}(e,n,u);if(u=!1,!o)return void console.error("block "+i.attributes.blockId+": unknown parameter "+e.name+(e.ref?` (${e.ref})`:""));if(function(e){return!e.definitionName}(o))return f="HANDLER_DRAG_PARAM_"+o.name,void(_="reporter"===i.attributes.draggableParameters?D(o.type,t):"Variable");let r=pxt.Util.lookup(t.apis.byQName,o.type);I=!0;const a=o.definitionName,l=o.actualName;let c=r&&6==r.kind,m=r&&!!r.attributes.fixedInstances&&!o.shadowBlockId,b=!!i.attributes.constantShim,T="@combined@"==o.type,y=o.fieldEditor,k=a.charAt(0).toUpperCase()+a.slice(1),v=o.type;if(c||m||b||T){let e;0==(e=c?function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.namespace===t&&!e.attributes.blockHidden))}(t.apis,o.type):m?U(t.apis,r.qName):T?i.combinedProperties.map((e=>pxt.Util.lookup(t.apis.byQName,e))):function(e,t){return pxt.Util.values(e.byQName).filter((e=>e.attributes.blockIdentity===t))}(t.apis,i.qName)).length&&console.error(`no instances of ${r.qName} found`);const s=e.map((e=>{let t=e.attributes.block||e.attributes.blockId||e.name,i=e.attributes.blockCombine;return e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=g.convert(e.attributes.jresURL)),i&&(t=t.replace(/@set/,"")),[e.attributes.iconURL||e.attributes.blockImage?{src:e.attributes.iconURL||pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,`blocks/${e.namespace.toLowerCase()}/${e.name.toLowerCase()}.png`),alt:t,width:36,height:36,value:e.name}:t,e.namespace+"."+e.name]}));if(o.defaultValue){let e=-1;if(s.some(((t,i)=>t[1]===o.defaultValue&&(e=i,!0))),e>-1){const t=s.splice(e,1)[0];s.unshift(t)}}if(y){let e=i.attributes.paramDefl[l]||"";const n={data:s,colour:p,label:k,type:v,blocksInfo:t};pxt.Util.jsonMergeFrom(n,i.attributes.paramFieldEditorOptions&&i.attributes.paramFieldEditorOptions[l]||{}),d.push(F((0,E.createFieldEditor)(y,e,n),a))}else d.push(F(new O.FieldDropdown(s),a))}else if(y){const e=i.attributes.paramDefl[o.actualName]||"",s={colour:p,label:k,type:v,blocksInfo:t};pxt.Util.jsonMergeFrom(s,i.attributes.paramFieldEditorOptions&&i.attributes.paramFieldEditorOptions[o.actualName]||{}),d.push(F((0,E.createFieldEditor)(y,e,s),o.definitionName))}else f=a,h&&"this"===e.name?_=o.type:"number"==o.type&&o.shadowBlockId&&"value"==o.shadowBlockId?(f=void 0,d.push(F(new s.FieldNumber("0"),a))):_="string"==o.type&&o.shadowOptions&&o.shadowOptions.toString?null:D(o.type,t)}}})),f){if(m(f))return;(y=e.appendValueInput(f)).setAlign(s.ALIGN_LEFT)}else if(a){const t=I?o.optionalInputWithFieldPrefix:o.optionalDummyInputPrefix;if(f=t+l++,m(f))return;y=e.appendDummyInput(f)}else y=e.appendDummyInput();_&&y.setCheck(_),d.forEach((e=>y.appendField(e.field,e.name)))})),g.logTime()}e.setPreviousStatement(!(I&&!i.attributes.handlerStatement)&&"void"==i.retType),e.setNextStatement(!(I&&!i.attributes.handlerStatement)&&"void"==i.retType),e.setTooltip(/^__/.test(i.namespace)?"":i.attributes.jsDoc)}(this,e,t,i)}}};pxt.Util.isTranslationMode()&&(h.block.customContextMenu=e=>{t.attributes.translationId&&e.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,y.promptTranslateBlock)(l,[t.attributes.translationId])}})}),R[l]=h,s.Blocks[l]=h.block}(e,t,i,n);return t}))}function x(e){var t;return!!(null===(t=e.parameters)||void 0===t?void 0:t.some((e=>pxtc.parameterTypeIsArrowFunction(e))))}i.blockSymbol=function(e){let t=R[e];return t?t.fn:void 0},i.injectBlocks=N,i.hasArrowFunction=x,i.cleanBlocks=function(){pxt.debug("removing all custom blocks");for(const e in R)B(R[e].fn)},i.initializeAndInject=function(e){$(e),N(e)},i.initialize=function(e){$(e),function(e){P={};const t=e.apis.jres;t&&Object.keys(t).forEach((e=>{const i=t[e];i&&i.icon&&(P[e]=i.icon)}))}(e)};let L=!1;function $(e){L||(L=!0,(0,S.applyMonkeyPatches)(),(0,E.initFieldEditors)(),(0,v.initContextMenu)(),(0,k.initOnStart)(),(0,l.initMath)(e),(0,I.initVariables)(),(0,u.initFunctions)(),(0,h.initLists)(),(0,p.initLoops)(),(0,d.initLogic)(),(0,g.initText)(),s.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="",function(){const e=e=>{if(e.disabled)return lf("This block is disabled and will not run. Attach this block to an event to enable it.");let t=e.tooltip;for(;"function"==typeof t;)t=t(e);return t};s.Tooltip.setCustomTooltip(((t,i)=>{if(i.codeCard){const s=(0,C.renderCodeCard)({header:e(i)});t.appendChild(s)}else{let n=e(i),o=(n=s.utils.string.wrap(n,s.Tooltip.LIMIT)).split("\n");for(let e=0;e<o.length;e++){let i=document.createElement("div");i.appendChild(document.createTextNode(o[e])),t.appendChild(i)}}}))}())}function D(e,t){const i=e.split(/\s*\|\s*/),s=[];for(const e of i)switch(e){case"number":s.push("Number");break;case"string":s.push("String");break;case"boolean":s.push("Boolean");break;case"T":case"any":return null;case"void":return;default:if((0,m.isArrayType)(e)){if(i.length>1)return null;s.push("Array")}const n=t.apis.byQName[e];n&&n.extendsTypes&&0<n.extendsTypes.length?s.push(...n.extendsTypes):s.push(e)}return s}function M(e,t,i){const s=D(t,i);(s||null===s)&&e.setOutput(!0,s)}function B(e){delete s.Blocks[e.attributes.blockId],delete R[e.attributes.blockId]}i.setOutputCheck=M;let P={};function F(e,t){return{field:e,name:t}}function U(e,t){return pxt.Util.values(e.byQName).filter((i=>4===i.kind&&i.attributes.fixedInstance&&function(e,t,i){if(t==i)return!0;let s=e.byQName[t];return!(!s||!s.extendsTypes)&&s.extendsTypes.indexOf(i)>=0}(e,i.retType,t))).sort(((e,t)=>(t.attributes.weight||50)-(e.attributes.weight||50)))}i.getFixedInstanceDropdownValues=U,i.generateIcons=function(e){const t=new pxt.ImageConverter;e.forEach((e=>{e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=t.convert(e.attributes.jresURL))}))},i.setVarFieldValue=function(e,t,i){const s=e.getField(t),n=e.workspace.getAllVariables();let o=!1;if(n&&n.length)for(let e=0;e<n.length;e++){const t=n[e];t.name===i&&(s.setValue(t.getId()),o=!0)}if(!o){s.initModel();const e=s.getVariable();e.name=i,s.setValue(e.getId())}};class H extends n.WorkspaceSearch{}i.PxtWorkspaceSearch=H},{"./builtins/functions":3,"./builtins/lists":4,"./builtins/logic":5,"./builtins/loops":6,"./builtins/math":7,"./builtins/misc":8,"./builtins/text":9,"./builtins/variables":10,"./codecardRenderer":11,"./composableMutations":17,"./constants":18,"./contextMenu":21,"./external":24,"./fields":65,"./fields/field_dropdown":33,"./help":66,"./legacyMutations":70,"./monkeyPatches":73,"./toolbox":120,"@blockly/plugin-workspace-search":190,blockly:197}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchBlockSvg=void 0;const s=e("blockly"),n=e("../plugins/renderer/constants");i.monkeyPatchBlockSvg=function(){const e=s.BlockSvg.prototype.setCollapsed;s.BlockSvg.prototype.setCollapsed=function(t){if(t!==this.isCollapsed()&&(e.call(this,t),this.isCollapsed())){const e=this.getInput(s.constants.COLLAPSED_INPUT_NAME),t=n.ConstantProvider.EXPAND_IMAGE_DATAURI;t&&e.appendField(new s.FieldImage(t,24,24,"",(()=>{this.setCollapsed(!1)}),!1))}}}},{"../plugins/renderer/constants":108,blockly:197}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.applyMonkeyPatches=void 0;const s=e("./blockSvg");i.applyMonkeyPatches=function(){(0,s.monkeyPatchBlockSvg)()}},{"./blockSvg":72}],74:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("../functions/constants"),o={valueConnections_:[],horizontalAfter_:3,itemCount_:3,mutationToDom:function(){const e=s.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),this.horizontalAfter_&&e.setAttribute("horizontalafter",this.horizontalAfter_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10);const t=e.getAttribute("horizontalafter");t&&(this.horizontalAfter_=parseInt(t,10)),this.updateShape_()},storeConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreConnections_(),this.itemCount_>1){const o=this.getInput("ADD0");if(o&&o.connection.targetConnection){const r=this.getInput("ADD"+(this.itemCount_-1)),a=o.connection.getShadowDom(),l=a&&a.getAttribute("type");if(l){const s=i("shadow",l),n=e(a,"value");for(let i=0;i<n.length;i++){const o=n[i],r=o.getAttribute("name"),a=e(o,"shadow")[0];t(s,r,a&&a.getAttribute("type"))}r.connection.setShadowDom(s)}const c=o.connection.targetConnection,u=c&&c.getSourceBlock(),h=u&&u.type;if(h&&h!==l){const e=i("block",h);if(u)if(h===n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=s.utils.xml.createElement("mutation");t.setAttribute("name",u.getName()),e.appendChild(t)}else if(u.inputList)for(let i=0;i<u.inputList.length;i++){const s=u.inputList[i],n=s.connection&&s.connection.getShadowDom(),o=n&&n.getAttribute("type");t(e,s.name,o)}const o=s.Xml.domToBlock(e,this.workspace);r.connection.connect(o.outputConnection)}else r.connection.setShadowDom(r.connection.getShadowDom())}}function e(e,t){const i=[];if(!e||!e.children)return i;for(let s=0;s<e.children.length;s++){const n=e.children[s];n.tagName===t&&i.push(n)}return i}function t(e,t,n){if(!t||!n)return;const o=s.utils.xml.createElement("value");o.setAttribute("name",t),o.appendChild(i("shadow",n)),e.appendChild(o)}function i(e,t){const i=s.utils.xml.createElement(e);return i.setAttribute("type",t),i.setAttribute("id",s.utils.idGenerator.genUid()),i}},removeItem_:function(){this.storeConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreConnections_()},update_:function(e){s.Events.setGroup(!0);const t=this,i=t.mutationToDom(),n=i&&s.Xml.domToText(i),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof s.BlockSvg&&t.initSvg();const r=s.Events.getGroup(),a=t.mutationToDom(),l=a&&s.Xml.domToText(a);n!=l&&(s.Events.fire(new s.Events.BlockChange(t,"mutation",null,n,l)),setTimeout((function(){s.Events.setGroup(r),t.bumpNeighbours(),s.Events.setGroup(!1)}),s.config.bumpDelay)),t.rendered&&t instanceof s.BlockSvg&&t.render(),s.Events.setGroup(!1)},updateShape_:function(){this.itemCount_?(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(s.Msg.LISTS_CREATE_WITH_INPUT_WITH)):(this.getInput("TITLE")&&this.removeInput("TITLE"),this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(s.Msg.LISTS_CREATE_EMPTY_TITLE));let e=0;for(e=0;e<this.itemCount_;e++)this.getInput("ADD"+e)||this.appendValueInput("ADD"+e);for(;this.getInput("ADD"+e);)this.removeInput("ADD"+e),e++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const t=this.appendDummyInput("BUTTONS");this.itemCount_>0&&t.appendField(new s.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(()=>{this.removeItem_()}),!1)),t.appendField(new s.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(()=>{this.addItem_()}),!1));const i=this.itemCount_<=this.horizontalAfter_;if(this.setInputsInline(i),this.workspace instanceof s.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(i?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};s.Blocks.lists_create_with=Object.assign(Object.assign({},o),{init:function(){if(s.Extensions.apply("inline-svgs",this,!1),this.setHelpUrl(s.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.updateShape_(),this.setOutput(!0,"Array"),this.workspace instanceof s.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.ROUND)}this.setInputsInline(!0),this.setTooltip(s.Msg.LISTS_CREATE_WITH_TOOLTIP)}})},{"../functions/constants":88,blockly:197}],75:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./createList"),i)},{"./createList":74}],76:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DuplicateOnDragConnectionChecker=void 0;const s=e("blockly"),n=e("./duplicateOnDrag"),o=[];o[s.ConnectionType.INPUT_VALUE]=s.ConnectionType.OUTPUT_VALUE,o[s.ConnectionType.OUTPUT_VALUE]=s.ConnectionType.INPUT_VALUE,o[s.ConnectionType.NEXT_STATEMENT]=s.ConnectionType.PREVIOUS_STATEMENT,o[s.ConnectionType.PREVIOUS_STATEMENT]=s.ConnectionType.NEXT_STATEMENT;class r extends s.ConnectionChecker{doDragChecks(e,t,i){if(!super.doDragChecks(e,t,i))return!1;const s=t.targetBlock();return!s||!(0,n.isDuplicateOnDragBlock)(s)}doSafetyChecks(e,t){if(!e||!t)return s.Connection.REASON_TARGET_NULL;let i,n,r,a;return e.isSuperior()?(i=e.getSourceBlock(),n=t.getSourceBlock(),r=e,a=t):(n=e.getSourceBlock(),i=t.getSourceBlock(),a=e,r=t),i===n?s.Connection.REASON_SELF_CONNECTION:a.type!==o[r.type]?s.Connection.REASON_WRONG_TYPE:i.workspace!==n.workspace?s.Connection.REASON_DIFFERENT_WORKSPACES:a.type===s.ConnectionType.OUTPUT_VALUE&&n.previousConnection&&n.previousConnection.isConnected()||a.type===s.ConnectionType.PREVIOUS_STATEMENT&&n.outputConnection&&n.outputConnection.isConnected()?s.Connection.REASON_PREVIOUS_AND_OUTPUT:s.Connection.CAN_CONNECT}}i.DuplicateOnDragConnectionChecker=r},{"./duplicateOnDrag":77,blockly:197}],77:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isDuplicateOnDragBlock=i.DuplicateOnDragBlockDragger=i.DUPLICATE_ON_DRAG_MUTATION_KEY=void 0;const s=e("blockly");i.DUPLICATE_ON_DRAG_MUTATION_KEY="duplicateondrag";class n extends s.BlockDragger{disconnectBlock_(e,t){var n,o,r;let a,l;const c=this.draggingBlock_.mutationToDom&&this.draggingBlock_.mutationToDom();if("true"===(null===(n=null==c?void 0:c.getAttribute(i.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===n?void 0:n.toLowerCase())){const e=this.draggingBlock_.outputConnection;if(!(null==e?void 0:e.targetConnection))return;a=s.Xml.domToBlock(s.Xml.blockToDom(this.draggingBlock_,!0),this.workspace_),l=e.targetConnection}super.disconnectBlock_(e,t),a&&l&&(l.connect(a.outputConnection),c.setAttribute(i.DUPLICATE_ON_DRAG_MUTATION_KEY,"false"),null===(r=(o=this.draggingBlock_).domToMutation)||void 0===r||r.call(o,c))}}i.DuplicateOnDragBlockDragger=n,i.isDuplicateOnDragBlock=function(e){var t,s,n;return"true"===(null===(n=null===(s=null===(t=e.mutationToDom)||void 0===t?void 0:t.call(e))||void 0===s?void 0:s.getAttribute(i.DUPLICATE_ON_DRAG_MUTATION_KEY))||void 0===n?void 0:n.toLowerCase())}},{blockly:197}],78:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./duplicateOnDrag"),i),n(e("./variablesGetReporter"),i),n(e("./connectionChecker"),i)},{"./connectionChecker":76,"./duplicateOnDrag":77,"./variablesGetReporter":79}],79:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("./duplicateOnDrag"),o={duplicateOnDrag_:!1,mutationToDom(){const e=s.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(n.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_))}};s.Extensions.registerMutator("variables_get_reporter_mutator",o),s.defineBlocksWithJsonArray([{type:"variables_get_reporter",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,colour:"%{BKY_VARIABLES_HUE}",outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableReporter"],mutator:"variables_get_reporter_mutator"}])},{"./duplicateOnDrag":77,blockly:197}],80:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./verticalFlyout"),i)},{"./verticalFlyout":81}],81:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VerticalFlyout=void 0;const s=e("blockly");i.VerticalFlyout=class{constructor(e){this.options=e,this.horizontalLayout=!1,this.autoClose=!0,this.cached=[],this.dummyWorkspace=new s.WorkspaceSvg(e)}createDom(e){return this.element||(this.dummyWorkspace.createDom(),this.element=s.utils.dom.createSvgElement(e,{class:"blocklyFlyout"}),this.element.id="multiFlyout",this.element.style.display="none"),this.element}init(e){this.targetWorkspace=e}dispose(){for(const e of this.cached)e.dispose()}getWidth(){return this.activeFlyout?this.activeFlyout.getWidth():0}getHeight(){return this.activeFlyout?this.activeFlyout.getHeight():0}getWorkspace(){return this.activeFlyout?this.activeFlyout.getWorkspace():this.dummyWorkspace}isVisible(){return this.visible}setVisible(e){if(e!==this.visible){this.visible=e,this.element.style.display=e?"block":"none";for(const e of this.cached)e!==this.activeFlyout&&e.isVisible()&&e.setVisible(!1);this.activeFlyout&&this.activeFlyout.setVisible(e)}}setContainerVisible(e){if(this.containerVisible!==e){this.containerVisible=e;for(const t of this.cached)t.setContainerVisible(e)}}hide(){this.activeFlyout&&this.activeFlyout.hide(),this.setVisible(!1)}show(e,t){const i=t||this.hashBlocks(e);this.activeFlyout&&this.activeFlyout.hide();const s=this.cached.find((e=>e.key===i));if(this.element.style.display="block",this.visible=!0,s)return this.activeFlyout=s,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),void this.activeFlyout.show(e);this.activeFlyout=new n(this.options),this.cached.push(this.activeFlyout),this.element.appendChild(this.activeFlyout.createDom("g")),this.activeFlyout.init(this.targetWorkspace),this.activeFlyout.key=i,this.activeFlyout.autoClose=this.autoClose,this.activeFlyout.setContainerVisible(this.containerVisible),this.activeFlyout.show(e)}createBlock(e){if(this.activeFlyout)return this.activeFlyout.createBlock(e)}reflow(){this.activeFlyout&&this.activeFlyout.reflow()}isScrollable(){return!this.activeFlyout||this.activeFlyout.isScrollable()}getX(){return this.activeFlyout?this.activeFlyout.getX():0}getY(){return this.activeFlyout?this.activeFlyout.getY():0}position(){this.activeFlyout&&this.activeFlyout.position()}isDragTowardWorkspace(e){return!!this.activeFlyout&&this.activeFlyout.isDragTowardWorkspace(e)}isBlockCreatable(e){return!!this.activeFlyout&&this.activeFlyout.isBlockCreatable(e)}scrollToStart(){this.activeFlyout&&this.activeFlyout.scrollToStart()}blocksToString(e){let t=null;return e.map((e=>e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e")).reduce(((e,t)=>e+t),"")}hashBlocks(e){if(Array.isArray(e))return pxt.Util.codalHash16(this.blocksToString(e))}};class n extends s.VerticalFlyout{constructor(e){super(e),this.options=e,this.buttonListeners=[]}show(e){Array.isArray(e)&&(this.def=e.slice()),super.show(e)}blockIsRecyclable_(e){switch(e.type){case"variables_get":case"variables_set":case"variables_change":return!1}return!0}initFlyoutButton_(e,t,i){const n=s.FlyoutButton.TEXT_MARGIN_X,o=s.FlyoutButton.TEXT_MARGIN_Y;e.isLabel()||(s.FlyoutButton.TEXT_MARGIN_X=17.5,s.FlyoutButton.TEXT_MARGIN_Y=14);const r=e.createDom();if(e.moveTo(t,i),e.show(),this.buttonListeners.push(s.browserEvents.conditionalBind(r,"pointerdown",this,this.onButtonMouseDown)),this.buttons_.push(e),s.FlyoutButton.TEXT_MARGIN_X=n,s.FlyoutButton.TEXT_MARGIN_Y=o,!this.def)return;const a=this.def.find((t=>t.getAttribute("text")===e.getButtonText()));if(this.def.splice(this.def.indexOf(a),1),!a)return;a.hasAttribute("web-class")&&r.classList.add(a.getAttribute("web-class"));const l=a.getAttribute("web-icon"),c=a.getAttribute("web-icon-class"),u=a.getAttribute("web-icon-color");if(l||c){const t=s.utils.dom.createSvgElement("text",{class:c?"blocklyFlyoutLabelIcon "+c:"blocklyFlyoutLabelIcon",x:0,y:0,"text-anchor":"start"},r);l&&(t.textContent=l),u&&t.setAttribute("style","fill: "+u);const i=e.getTargetWorkspace();t.setAttribute("dominant-baseline","central"),t.setAttribute("dy","0"),t.setAttribute("x",(i.RTL?e.width+s.FlyoutButton.TEXT_MARGIN_X:0)+""),t.setAttribute("y",e.height/2+s.FlyoutButton.TEXT_MARGIN_Y+"");const n=s.utils.dom.getTextWidth(t)+2*s.FlyoutButton.TEXT_MARGIN_X;e.width+=n;for(let e=0;e<r.children.length;e++){const i=r.children.item(e);if(i!==t){const e=Number(i.getAttribute("x"));i.setAttribute("x",e+n+"")}}}const h=a.getAttribute("web-line"),d=a.getAttribute("web-line-width");if(h){const t=s.utils.dom.createSvgElement("line",{class:"blocklyFlyoutLine","stroke-dasharray":h,"text-anchor":"middle"},r);t.setAttribute("x1","0"),t.setAttribute("x2",null!=d?d:e.width+""),t.setAttribute("y1",e.height+10+""),t.setAttribute("y2",e.height+10+"")}}onButtonMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}}},{blockly:197}],82:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("../constants"),o={typeName_:"",getTypeName(){return this.typeName_},removeFieldCallback(e){const t=this.getParent();(null==t?void 0:t.removeFieldCallback)&&t.removeFieldCallback(e)}};s.Blocks[n.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"bool"}],extensions:["output_boolean","text_field_color"]}),this.typeName_="boolean"}}),s.Blocks[n.ARGUMENT_EDITOR_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"text"}],extensions:["output_string","text_field_color"]}),this.typeName_="string"}}),s.Blocks[n.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"num"}],extensions:["output_number","text_field_color"]}),this.typeName_="number"}}),s.Blocks[n.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"list"}],extensions:["output_array","text_field_color"]}),this.typeName_="Array"}}),s.Blocks[n.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},o),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"arg"}],outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,extensions:["text_field_color"]}),this.typeName_="any"},mutationToDom(){const e=s.utils.xml.createElement("mutation");return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_)}})},{"../constants":88,blockly:197}],83:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("../constants"),o=e("../msg"),r=e("../../duplicateOnDrag"),a={typeName_:"",duplicateOnDrag_:!1,getTypeName(){return this.typeName_},mutationToDom(){const e=s.utils.xml.createElement("mutation");return this.duplicateOnDrag_&&e.setAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),e},domToMutation(e){e.hasAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY)&&(this.duplicateOnDrag_="true"===e.getAttribute(r.DUPLICATE_ON_DRAG_MUTATION_KEY).toLowerCase(),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_))}};s.Blocks[n.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:s.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_boolean"]}),this.typeName_="boolean"}}),s.Blocks[n.ARGUMENT_REPORTER_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:s.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_string"]}),this.typeName_="string"}}),s.Blocks[n.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:s.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_number"]}),this.typeName_="number"}}),s.Blocks[n.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:s.Msg[o.MsgKey.REPORTERS_HUE],extensions:["output_array"]}),this.typeName_="Array"}}),s.Blocks[n.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},a),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_label_serializable",name:"VALUE",text:""}],colour:s.Msg[o.MsgKey.REPORTERS_HUE],inputsInline:!0,outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,output:null}),this.typeName_=""},mutationToDom(){const e=a.mutationToDom.call(this);return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_),a.domToMutation.call(this,e),this.pathObject&&this.pathObject.setHasDottedOutllineOnHover(this.duplicateOnDrag_)}})},{"../../duplicateOnDrag":78,"../constants":88,"../msg":94,blockly:197}],84:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../msg"),l=Object.assign(Object.assign({},n.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){let n=null,o=null;if(t&&e.id in t){const i=t[e.id];n=i.block,o=i.shadow}const r=null==n?void 0:n.workspace.connectionChecker;s.Events.disable();try{if(n&&!n.isDisposed()&&t&&(null==r?void 0:r.canConnectWithReason(null==n?void 0:n.outputConnection,i.connection,!1))===s.Connection.CAN_CONNECT){let r;n.outputConnection.connect(i.connection),"variables_get"!==(r=n.isShadow()?s.Xml.blockToDom(n):o||this.buildShadowDom_(e.type)).getAttribute("type")&&i.connection.setShadowDom(r),delete t[i.name]}else this.attachShadow_(i,e.type)}finally{s.Events.enable()}},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==s.inputTypes.VALUE)continue;const i=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();i&&i.isShadow()&&i.getVarModels().length&&i.setShadow(!1);const n=t.connection&&t.getShadowDom();(0,r.isVariableBlockType)(null==n?void 0:n.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){this.appendDummyInput("function_name").appendField(new s.FieldLabel(e,"functionNameText"),"function_name")},updateFunctionLabel_:function(e){this.getField("function_name").setValue(e)},attachShadow_(e,t){const i=(0,r.getShadowBlockInfoFromType_)(t,this.workspace),n=i[0],o=i[1],a=i[2];s.Events.disable();let l=null;try{(l=this.workspace.newBlock(n)).setFieldValue(a,o),l.setShadow("variables_get"!==n),!this.isInsertionMarker()&&l instanceof s.BlockSvg&&(l.initSvg(),l.render())}finally{s.Events.enable()}l&&(l.setShadow(!0),l.outputConnection.connect(e.connection))},buildShadowDom_(e){const t=s.utils.xml.createElement("shadow"),i=(0,r.getShadowBlockInfoFromType_)(e,this.workspace),n=i[0],o=i[1],a=i[2],l="variables_get"===n;t.setAttribute("type",n);const c=s.utils.xml.createElement("field");if(c.textContent=a,l){c.setAttribute("id",a);const e=this.workspace.getVariableById(a);c.textContent=e?e.name:""}return c.setAttribute("name",o),t.appendChild(c),t},onchange(e){var t;if(this.workspace&&!this.workspace.isFlyout)if(e.type==s.Events.BLOCK_CREATE&&-1!=(null===(t=e.ids)||void 0===t?void 0:t.indexOf(this.id))){const t=this.getName(),i=(0,r.getDefinition)(t,this.workspace);if(i){const e=i.getArguments().slice(),t=this.arguments_.slice();JSON.stringify(t)!==JSON.stringify(e)&&(0,r.mutateCallersAndDefinition)(i.getName(),this.workspace,i.mutationToDom()),this.functionId_=i.functionId_}else{s.Events.setGroup(e.group);const t=s.utils.xml.createElement("xml"),i=s.utils.xml.createElement("block");i.setAttribute("type",o.FUNCTION_DEFINITION_BLOCK_TYPE);const n=this.getRelativeToSurfaceXY(),r=n.x+s.config.snapRadius*(this.RTL?-1:1),a=n.y+2*s.config.snapRadius;i.setAttribute("x",r+""),i.setAttribute("y",a+"");const l=this.mutationToDom();i.appendChild(l),t.appendChild(i),s.Xml.domToWorkspace(t,this.workspace),s.Events.setGroup(!1)}}else if(e.type==s.Events.BLOCK_DELETE){const t=this.getName();(0,r.getDefinition)(t,this.workspace)||(s.Events.setGroup(e.group),this.dispose(!0),s.Events.setGroup(!1))}}});s.Blocks[o.FUNCTION_CALL_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(s.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(s.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(s.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}}),s.Blocks[o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0,null),this.setOutputShape((new s.zelos.ConstantProvider).SHAPES.ROUND),this.setColour(s.Msg[a.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(s.Msg[a.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(s.Msg[a.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}})},{"../commonFunctionMixin":87,"../constants":88,"../msg":94,"../utils":96,blockly:197}],85:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.newFunctionMutation=void 0;const s=e("blockly"),n=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../functionManager"),c=e("../msg"),u=Object.assign(Object.assign({},n.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){const s=this.createArgumentEditor_(e.type,e.name);i.connection.connect(s.outputConnection)},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",void 0,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){s.Events.disable(),this.getField("function_name").setValue(e),s.Events.enable()},createArgumentEditor_:function(e,t){let i;s.Events.disable();try{let n="";switch(e){case"boolean":n=o.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE;break;case"number":n=o.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE;break;case"string":n=o.ARGUMENT_EDITOR_STRING_BLOCK_TYPE;break;case"Array":n=o.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE;break;default:n=o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE}(i=n==o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE?(0,r.createCustomArgumentEditor)(e,this.workspace):this.workspace.newBlock(n)).setFieldValue(t,"TEXT"),i.setShadow(!0),!this.isInsertionMarker()&&i instanceof s.BlockSvg&&(i.initSvg(),i.render())}finally{s.Events.enable()}return i},focusLastEditor_(){if(this.inputList.length>0){let e=this.inputList[this.inputList.length-2];if(e.type==s.inputTypes.DUMMY){const t=this.workspace;t instanceof s.WorkspaceSvg&&t.centerOnBlock(this.id),e.fieldRow[0].showEditor()}else if(e.type==s.inputTypes.VALUE){const t=e.connection.targetBlock(),i=t.workspace;i instanceof s.WorkspaceSvg&&i.centerOnBlock(t.id),t.getField("TEXT").showEditor()}}},removeFieldCallback(e){let t=null;for(let i=0;i<this.inputList.length&&!t;i++){let s=this.inputList[i];if(s.connection){let i=s.connection.targetBlock();if(!i)continue;i.getField(e.name)===e&&(t=s.name)}else for(let i=0;i<s.fieldRow.length;i++)s.fieldRow[i]==e&&(t=s.name)}t&&(s.WidgetDiv.hide(),this.removeInput(t),this.updateFunctionSignature(),this.updateDisplay_())},addParam_(e,t){s.WidgetDiv.hide();const i=(0,r.findUniqueParamName)(t,this.arguments_.map((e=>e.name)));this.arguments_.push({id:s.utils.idGenerator.genUid(),name:i,type:e}),this.updateDisplay_(),this.focusLastEditor_()},addBooleanExternal(){this.addParam_("boolean",s.Msg[c.MsgKey.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME])},addStringExternal(){this.addParam_("string",s.Msg[c.MsgKey.FUNCTIONS_DEFAULT_STRING_ARG_NAME])},addNumberExternal(){this.addParam_("number",s.Msg[c.MsgKey.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME])},addArrayExternal(){this.addParam_("Array",s.Msg[c.MsgKey.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME])},addCustomExternal(e){this.addParam_(e,l.FunctionManager.getInstance().getArgumentNameForType(e))},updateFunctionSignature(){this.arguments_=[];for(let e=1;e<this.inputList.length;e++){const t=this.inputList[e];switch(t.type){case s.inputTypes.STATEMENT:break;case s.inputTypes.DUMMY:this.name_=t.fieldRow[0].getValue()||t.fieldRow[0].getText();break;case s.inputTypes.VALUE:const e=t.connection.targetBlock();this.arguments_.push({id:t.name,name:e.getFieldValue("TEXT"),type:e.getTypeName()});break;default:console.warn("Unexpected input type on a function mutator root: "+t.type)}}}});i.newFunctionMutation=function(e){const t=(0,r.findLegalName)(s.Msg[c.MsgKey.FUNCTIONS_DEFAULT_FUNCTION_NAME],e),i=s.utils.xml.createElement("mutation");return i.setAttribute("name",t),i.setAttribute("functionid",s.utils.idGenerator.genUid()),i},s.Blocks[o.FUNCTION_DECLARATION_BLOCK_TYPE]=Object.assign(Object.assign({},u),{init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(s.Msg[c.MsgKey.PROCEDURES_HUE]),this.setStatements_(!0),this.setDeletable(!1),this.setMovable(!1),this.contextMenu=!1,this.setInputsInline(!0)}})},{"../commonFunctionMixin":87,"../constants":88,"../fields/fieldAutocapitalizeTextInput":91,"../functionManager":92,"../msg":94,"../utils":96,blockly:197}],86:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("../commonFunctionMixin"),o=e("../constants"),r=e("../utils"),a=e("../fields/fieldAutocapitalizeTextInput"),l=e("../msg"),c=e("../functionManager"),u=e("../svgs"),h=e("../../duplicateOnDrag"),d=Object.assign(Object.assign({},n.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){let s,n=null;(null==t?void 0:t[e.id])&&(n=t[e.id].block),t&&n&&!n.isDisposed()?((s=n).setFieldValue(e.name,"VALUE"),delete t[i.name]):s=this.createArgumentReporter_(e),s.duplicateOnDrag_=!0,i.connection.connect(s.outputConnection)},afterWorkspaceLoad:function(){var e;for(const t of this.inputList){if(t.type!==s.inputTypes.VALUE)continue;const i=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();(null==i?void 0:i.isShadow())&&i.mutationToDom&&i.mutationToDom().getAttribute(h.DUPLICATE_ON_DRAG_MUTATION_KEY)&&i.setShadow(!1);const n=t.connection&&t.getShadowDom();(0,r.isVariableBlockType)(null==n?void 0:n.getAttribute("type"))&&t.setShadowDom(null)}},addFunctionLabel_:function(e){const t=new a.FieldAutocapitalizeTextInput(e||"",r.rename,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(t,"function_name")},updateFunctionLabel_:function(e){s.Events.disable(),this.getField("function_name").setValue(e),s.Events.enable()},createArgumentReporter_:function(e){let t,i="";switch(e.type){case"boolean":i=o.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE;break;case"number":i=o.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE;break;case"string":i=o.ARGUMENT_REPORTER_STRING_BLOCK_TYPE;break;case"Array":i=o.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE;break;default:i=o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}s.Events.disable();try{(t=i==o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE?(0,r.createCustomArgumentReporter)(e.type,this.workspace):this.workspace.newBlock(i)).setFieldValue(e.name,"VALUE"),t.setShadow(!0),!this.isInsertionMarker()&&t instanceof s.BlockSvg&&(t.initSvg(),t.render())}finally{s.Events.enable()}return t},customContextMenu:function(e){var t,i;this.isInFlyout||(null===(i=null===(t=this.workspace)||void 0===t?void 0:t.options)||void 0===i?void 0:i.readOnly)||(e.push(this.makeEditOption()),e.push(this.makeCallOption()))},makeEditOption:function(){return{enabled:!0,text:s.Msg.FUNCTIONS_EDIT_OPTION,callback:()=>{!function(e){if(e.type==o.FUNCTION_CALL_BLOCK_TYPE||e.type==o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=e.workspace;e=(0,r.getDefinition)(e.getName(),t)}s.hideChaff(),s.getSelected()&&s.getSelected().unselect(),c.FunctionManager.getInstance().editFunctionExternal(e.mutationToDom(),(t=>{t&&((0,r.mutateCallersAndDefinition)(e.getName(),e.workspace,t),e.updateDisplay_()),setTimeout((()=>{e.afterWorkspaceLoad&&e.afterWorkspaceLoad()}))}))}(this)}}},makeCallOption:function(){const e=this.getName(),t=s.utils.xml.createElement("mutation");t.setAttribute("name",e);const i=s.utils.xml.createElement("block");return i.appendChild(t),i.setAttribute("type",o.FUNCTION_CALL_BLOCK_TYPE),{enabled:this.workspace.remainingCapacity()>0,text:s.Msg.FUNCTIONS_CREATE_CALL_OPTION.replace("%1",e),callback:s.ContextMenu.callbackFactory(this,i)}}});s.Blocks[o.FUNCTION_DEFINITION_BLOCK_TYPE]=Object.assign(Object.assign({},d),{init:function(){if(this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(s.Msg[l.MsgKey.PROCEDURES_HUE]),this.setTooltip(s.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_TOOLTIP]),this.setHelpUrl(s.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_HELPURL]),this.setStatements_(!0),this.setInputsInline(!0),this.workspace.options.collapse){const e=u.COLLAPSE_IMAGE_DATAURI;this.appendDummyInput("function_collapse").appendField(new s.FieldImage(e,24,24,"",(()=>{this.setCollapsed(!0)}),!1))}}})},{"../../duplicateOnDrag":78,"../commonFunctionMixin":87,"../constants":88,"../fields/fieldAutocapitalizeTextInput":91,"../functionManager":92,"../msg":94,"../svgs":95,"../utils":96,blockly:197}],87:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.COMMON_FUNCTION_MIXIN=void 0;const s=e("blockly"),n=e("./constants"),o=e("./utils"),r=e("./msg");i.COMMON_FUNCTION_MIXIN={name_:"",functionId_:"",arguments_:[],mutationToDom:function(){this.ensureIds_();const e=s.utils.xml.createElement("mutation");return e.setAttribute("name",this.name_),e.setAttribute("functionid",this.functionId_),this.arguments_.forEach((function(t){const i=s.utils.xml.createElement("arg");i.setAttribute("name",t.name),i.setAttribute("id",t.id),i.setAttribute("type",t.type),e.appendChild(i)})),e},domToMutation:function(e){const t=[];for(let i=0;i<e.childNodes.length;++i){const s=e.childNodes[i];"arg"==s.nodeName.toLowerCase()&&t.push({id:s.getAttribute("id"),name:s.getAttribute("name"),type:s.getAttribute("type")})}this.arguments_=t,this.name_=e.getAttribute("name"),this.restoreSavedFunctionId(e.getAttribute("functionid"))},saveExtraState:function(){return{name:this.name_,functionid:this.functionId_,arguments:this.arguments_.slice()}},loadExtraState:function(e){this.arguments_=e.arguments.slice(),this.name_=e.name,this.restoreSavedFunctionId(e.functionid)},restoreSavedFunctionId:function(e){(0,o.idsInUse)(this.workspace).indexOf(e)<0&&(this.functionId_=e),this.ensureIds_();let t=null;this instanceof s.BlockSvg&&(t=this.getHeightWidth()),this.type!==n.FUNCTION_DEFINITION_BLOCK_TYPE||t&&!t.height&&!t.width?this.updateDisplay_():!this.getFieldValue("function_name")&&this.name_&&(this.setFieldValue(this.name_,"function_name"),this.updateDisplay_())},getName:function(){return this.name_},getFunctionId:function(){return this.functionId_},getArguments:function(){return this.arguments_},removeValueInputs_:function(){const e=[];for(let t,i=0;t=this.inputList[i];i++)t.type==s.inputTypes.VALUE?t.dispose():e.push(t);this.inputList=e},disconnectOldBlocks_:function(){let e={};for(let t,i=0;t=this.inputList[i];i++)if("STACK"!==t.name&&t.connection){let i=t.connection.targetBlock(),s={shadow:t.connection.getShadowDom(),block:i};e[t.name]=s,t.connection.setShadowDom(null),t.connection.targetConnection&&t.connection.disconnect()}return e},deleteShadows_:function(e){if(e)for(let t in e){let i=e[t];if(i){const s=i.block;(null==s?void 0:s.isShadow())&&(s.dispose(!1),delete e[t])}}},createAllInputs_:function(e){let t=!1,i=!1,a=!1;if(this.inputList.forEach((function(e){"function_title"==e.name?t=!0:"function_name"==e.name?i=!0:"function_collapse"==e.name&&(a=!0)})),!t){let e="";switch(this.type){case n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case n.FUNCTION_CALL_BLOCK_TYPE:e=s.Msg[r.MsgKey.FUNCTIONS_CALL_TITLE];break;case n.FUNCTION_DEFINITION_BLOCK_TYPE:case n.FUNCTION_DECLARATION_BLOCK_TYPE:e=s.Msg[r.MsgKey.FUNCTIONS_DEFNORETURN_TITLE]}this.appendDummyInput("function_title").appendField(e,"function_title")}i?this.updateFunctionLabel_(this.getName()):this.addFunctionLabel_(this.getName());let l=this;this.arguments_.forEach((function(t){let i=l.appendValueInput(t.id);(0,o.isCustomType)(t.type)?i.setCheck(t.type):i.setCheck(t.type.charAt(0).toUpperCase()+t.type.slice(1)),l.isInsertionMarker()||l.populateArgument_(t,e,i)})),a&&this.moveInputBefore("function_collapse",null),this.hasStatements_&&this.moveInputBefore("STACK",null)},updateDisplay_:function(){let e=this.rendered;this.rendered=!1;let t=this.disconnectOldBlocks_();this.removeValueInputs_(),this.createAllInputs_(t),this.deleteShadows_(t),this.rendered=e,e&&!this.isInsertionMarker()&&this instanceof s.BlockSvg&&(this.initSvg(),this.render())},setStatements_:function(e){this.hasStatements_!==e&&(e?this.appendStatementInput("STACK"):this.removeInput("STACK",!0),this.hasStatements_=e)},ensureIds_:function(){switch(this.type){case n.FUNCTION_DEFINITION_BLOCK_TYPE:this.functionId_&&"null"!=this.functionId_||(this.functionId_=s.utils.idGenerator.genUid());for(let e=0;e<this.arguments_.length;++e)this.arguments_[e].id||(this.arguments_[e].id=s.utils.idGenerator.genUid());break;case n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case n.FUNCTION_CALL_BLOCK_TYPE:const e=(0,o.getDefinition)(this.name_,this.workspace);if(e){this.functionId_=e.getFunctionId();const t=e.getArguments();for(let e=0;e<this.arguments_.length;++e)for(let i=0;i<t.length;++i)if(t[i].name==this.arguments_[e].name){this.arguments_[e].id=t[i].id;break}}}}}},{"./constants":88,"./msg":94,"./utils":96,blockly:197}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE=i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE=i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE=i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE=i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE=i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE=i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE=i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE=i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE=i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE=i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE=i.FUNCTION_CALL_BLOCK_TYPE=i.FUNCTION_DECLARATION_BLOCK_TYPE=i.FUNCTION_DEFINITION_BLOCK_TYPE=void 0,i.FUNCTION_DEFINITION_BLOCK_TYPE="function_definition",i.FUNCTION_DECLARATION_BLOCK_TYPE="function_declaration",i.FUNCTION_CALL_BLOCK_TYPE="function_call",i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE="function_call_output",i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE="argument_reporter_boolean",i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE="argument_reporter_number",i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE="argument_reporter_string",i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE="argument_reporter_array",i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE="argument_reporter_custom",i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE="argument_editor_boolean",i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE="argument_editor_number",i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE="argument_editor_string",i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE="argument_editor_array",i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE="argument_editor_custom"},{}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=e("./utils"),o=e("./msg"),r=e("./svgs"),a=new s.zelos.ConstantProvider;const l={customContextMenu:function(e){const t={enabled:!0,text:s.Msg[o.MsgKey.FUNCTIONS_GO_TO_DEFINITION_OPTION],callback:()=>{const e=this.getField("function_name").getText(),t=(0,n.getDefinition)(e,this.workspace);t&&this.workspace instanceof s.WorkspaceSvg&&this.workspace.centerOnBlock(t.id)}};e.push(t)}},c={customContextMenu:function(e){if(this.isCollapsed())return;const t={text:s.Msg.RENAME_VARIABLE,enabled:!this.workspace.options.readOnly,callback:()=>{const e=this.workspace,t=this.getField("VAR").getVariable();s.Variables.renameVariable(e,t)}};if(e.unshift(t),!this.isInFlyout){const t=this.workspace.getVariablesOfType("");for(const i of t){const t={enabled:!this.workspace.options.readOnly,text:i.name,callback:()=>{let e=this.getField("VAR");e||console.log("Tried to get a variable field on the wrong type of block."),e.setValue(i.getId())}};e.unshift(t)}}}};s.Extensions.registerMixin("function_contextmenu_edit",l),s.Extensions.registerMixin("contextMenu_variableReporter",c),s.Extensions.register("output_number",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Number")})),s.Extensions.register("output_string",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"String")})),s.Extensions.register("output_boolean",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.HEXAGONAL),this.setOutput(!0,"Boolean")})),s.Extensions.register("output_array",(function(){this.setInputsInline(!0),this.setOutputShape(a.SHAPES.ROUND),this.setOutput(!0,"Array")})),s.Extensions.register("text_field_color",(function(){if(this.workspace instanceof s.WorkspaceSvg){const e=this.workspace.getRenderer().getConstants();this.setColour(e.FIELD_BORDER_RECT_COLOUR)}else this.setColour("#fff")})),s.Extensions.register("inline-svgs",(function(){this.ADD_IMAGE_DATAURI=r.ADD_IMAGE_DATAURI,this.REMOVE_IMAGE_DATAURI=r.REMOVE_IMAGE_DATAURI}))},{"./msg":94,"./svgs":95,"./utils":96,blockly:197}],90:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentEditor=void 0;const s=e("blockly"),n=e("../functionManager");class o extends s.FieldTextInput{constructor(e,t,i){super(e,t,i),this.typeName=i.typeName}showEditor(e){var t;super.showEditor(e);const i=s.WidgetDiv.getDiv();i.className+=" argumentEditorInput";const r=document.createElement("img");if(r.setAttribute("class","argumentEditorRemoveIcon"),r.setAttribute("src",o.REMOVE_ARG_URI),this.removeButtonMouseWrapper_=s.browserEvents.conditionalBind(r,"mousedown",this,this.removeCallback),i.appendChild(r),this.typeName&&(null===(t=this.sourceBlock_)||void 0===t?void 0:t.workspace)){const e=n.FunctionManager.getInstance().getIconForType(this.typeName);if(e){const t=e+" icon argumentEditorTypeIcon",s=document.createElement("i");s.className=t,i.appendChild(s)}}}removeCallback(){var e,t;const i=null===(e=this.sourceBlock_)||void 0===e?void 0:e.getParent();if(!i)return;let n;for(const e of i.inputList)if((null===(t=e.connection)||void 0===t?void 0:t.targetBlock())===this.sourceBlock_){n=e.name;break}n&&(s.WidgetDiv.hide(),i.removeInput(n))}}i.FieldArgumentEditor=o,o.REMOVE_ARG_URI="data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='UTF-8' standalone='no'?%3e%3csvg width='20px' height='20px' viewBox='0 0 20 20' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3c!-- Generator: Sketch 48.1 (47250) - http://www.bohemiancoding.com/sketch --%3e%3ctitle%3edelete-argument v2%3c/title%3e%3cdesc%3eCreated with Sketch.%3c/desc%3e%3cdefs%3e%3c/defs%3e%3cg id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e%3cg id='delete-argument-v2' stroke='%23FF661A'%3e%3cg id='Group' transform='translate(3.000000, 2.500000)'%3e%3cpath d='M1,3 L13,3 L11.8900496,14.0995037 C11.8389294,14.6107055 11.4087639,15 10.8950124,15 L3.10498756,15 C2.59123611,15 2.16107055,14.6107055 2.10995037,14.0995037 L1,3 Z' id='Rectangle' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M7,11 L7,6' id='Line' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M9.5,11 L9.5,6' id='Line-Copy' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M4.5,11 L4.5,6' id='Line-Copy-2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3crect id='Rectangle-2' fill='%23FF661A' x='0' y='2.5' width='14' height='1' rx='0.5'%3e%3c/rect%3e%3cpath d='M6,0 L8,0 C8.55228475,-1.01453063e-16 9,0.44771525 9,1 L9,3 L5,3 L5,1 C5,0.44771525 5.44771525,1.01453063e-16 6,0 Z' id='Rectangle-3' stroke-width='1.5'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",s.fieldRegistry.register("field_argument_editor",o),s.Css.register("\n\n.argumentEditorInput {\n    overflow: visible;\n}\n\n.functioneditor i.argumentEditorTypeIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: 40px;\n    left: 50%;\n    margin-left: -12px;\n}\n\n.argumentEditorRemoveIcon {\n    position: absolute;\n    width: 24px;\n    height: 24px;\n    top: -40px;\n    left: 50%;\n    margin-left: -12px;\n    cursor: pointer;\n}\n\n")},{"../functionManager":92,blockly:197}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutocapitalizeTextInput=void 0;const s=e("blockly");class n extends s.FieldTextInput{constructor(e,t,i){super(e,t,i),this.disableAutocapitalize=!1}setAutocapitalize(e){this.disableAutocapitalize=!e,this.htmlInput_&&(this.disableAutocapitalize?this.htmlInput_.setAttribute("autocapitalize","none"):this.htmlInput_.removeAttribute("autocapitalize"))}configure_(e){super.configure_(e),void 0!==e.disableAutocapitalize&&(this.disableAutocapitalize=e.disableAutocapitalize)}widgetCreate_(){const e=super.widgetCreate_();return this.disableAutocapitalize&&e.setAttribute("autocapitalize","none"),e}}i.FieldAutocapitalizeTextInput=n,s.fieldRegistry.register("field_autocapitalize_text_input",n)},{blockly:197}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FunctionManager=void 0;const s=e("blockly"),n=e("./msg");class o{constructor(){this.typeIcons={},this.typeArgumentNames={}}static getInstance(){return o.instance}getIconForType(e){return this.typeIcons[e]}setIconForType(e,t){this.typeIcons[t]=e}setArgumentNameForType(e,t){this.typeArgumentNames[e]=t}getArgumentNameForType(e){return this.typeArgumentNames[e]?this.typeArgumentNames[e]:s.Msg[n.MsgKey.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME]}setEditFunctionExternal(e){this._editFunctionExternal=e}editFunctionExternal(e,t){this._editFunctionExternal?this._editFunctionExternal(e,t):console.warn("External function editor must be overriden: Blockly.Functions.editFunctionExternalHandler",e,t)}}i.FunctionManager=o,o.instance=new o},{"./msg":94,blockly:197}],93:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.validateFunctionExternal=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.flyoutCategory=void 0,n(e("./msg"),i),n(e("./extensions"),i),n(e("./fields/fieldArgumentEditor"),i),n(e("./fields/fieldAutocapitalizeTextInput"),i),n(e("./blocks/argumentEditorBlocks"),i),n(e("./blocks/argumentReporterBlocks"),i),n(e("./blocks/functionDeclarationBlock"),i),n(e("./blocks/functionDefinitionBlock"),i),n(e("./blocks/functionCallBlocks"),i),n(e("./functionManager"),i);var o=e("./utils");Object.defineProperty(i,"flyoutCategory",{enumerable:!0,get:function(){return o.flyoutCategory}}),Object.defineProperty(i,"getDefinition",{enumerable:!0,get:function(){return o.getDefinition}}),Object.defineProperty(i,"getAllFunctionDefinitionBlocks",{enumerable:!0,get:function(){return o.getAllFunctionDefinitionBlocks}}),Object.defineProperty(i,"validateFunctionExternal",{enumerable:!0,get:function(){return o.validateFunctionExternal}})},{"./blocks/argumentEditorBlocks":82,"./blocks/argumentReporterBlocks":83,"./blocks/functionCallBlocks":84,"./blocks/functionDeclarationBlock":85,"./blocks/functionDefinitionBlock":86,"./extensions":89,"./fields/fieldArgumentEditor":90,"./fields/fieldAutocapitalizeTextInput":91,"./functionManager":92,"./msg":94,"./utils":96}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MsgKey=void 0;const s=e("blockly");var n,o;function r(e,t){s.Msg[e]||(s.Msg[e]=t)}(o=n=i.MsgKey||(i.MsgKey={})).REPORTERS_HUE="REPORTERS_HUE",o.FUNCTIONS_CALL_TITLE="FUNCTIONS_CALL_TITLE",o.FUNCTIONS_DEFNORETURN_TITLE="FUNCTIONS_DEFNORETURN_TITLE",o.FUNCTIONS_GO_TO_DEFINITION_OPTION="FUNCTIONS_GO_TO_DEFINITION_OPTION",o.FUNCTION_CALL_TOOLTIP="FUNCTION_CALL_TOOLTIP",o.PROCEDURES_HUE="PROCEDURES_HUE",o.PROCEDURES_CALLNORETURN_HELPURL="PROCEDURES_CALLNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME="FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME",o.FUNCTIONS_DEFAULT_STRING_ARG_NAME="FUNCTIONS_DEFAULT_STRING_ARG_NAME",o.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME="FUNCTIONS_DEFAULT_NUMBER_ARG_NAME",o.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME="FUNCTIONS_DEFAULT_ARRAY_ARG_NAME",o.PROCEDURES_DEFNORETURN_TOOLTIP="PROCEDURES_DEFNORETURN_TOOLTIP",o.PROCEDURES_DEFNORETURN_HELPURL="PROCEDURES_DEFNORETURN_HELPURL",o.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME="FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME",o.FUNCTIONS_DEFAULT_FUNCTION_NAME="FUNCTIONS_DEFAULT_FUNCTION_NAME",o.FUNCTION_CREATE_NEW="FUNCTION_CREATE_NEW",o.FUNCTION_FLYOUT_LABEL="FUNCTION_FLYOUT_LABEL",o.FUNCTIONS_EDIT_OPTION="FUNCTIONS_EDIT_OPTION",o.FUNCTIONS_CREATE_CALL_OPTION="FUNCTIONS_CREATE_CALL_OPTION",r(n.REPORTERS_HUE,"#A80000"),r(n.FUNCTIONS_CALL_TITLE,"call"),r(n.FUNCTIONS_DEFNORETURN_TITLE,"function"),r(n.FUNCTIONS_GO_TO_DEFINITION_OPTION,"Go to Definition"),r(n.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME,"bool"),r(n.FUNCTIONS_DEFAULT_STRING_ARG_NAME,"text"),r(n.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME,"num"),r(n.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME,"array"),r(n.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME,"value"),r(n.FUNCTIONS_DEFAULT_FUNCTION_NAME,"doSomething"),r(n.FUNCTION_CREATE_NEW,"Make a Function"),r(n.FUNCTION_FLYOUT_LABEL,"Your Functions"),r(n.FUNCTIONS_EDIT_OPTION,"Edit Function"),r(n.FUNCTIONS_CREATE_CALL_OPTION,"Create 'call %1'")},{blockly:197}],95:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.REMOVE_IMAGE_DATAURI=i.ADD_IMAGE_DATAURI=i.COLLAPSE_IMAGE_DATAURI=void 0,i.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",i.ADD_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJhZGQuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjQ4MjEiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NjkiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjEyLjkxNTI1NCIKICAgICBpbmtzY2FwZTpjeT0iMTYuMDY3Nzk2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0icmVwZWF0IiAvPjxzdHlsZQogICAgIHR5cGU9InRleHQvY3NzIgogICAgIGlkPSJzdHlsZTMiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjx0aXRsZQogICAgIGlkPSJ0aXRsZTUiPnJlcGVhdDwvdGl0bGU+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMiCiAgICAgd2lkdGg9IjQuMDUwMDAwMiIKICAgICBoZWlnaHQ9IjEyLjM5NzA1IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSItMTguMTk4NTI2IgogICAgIHJ4PSIwLjgxIgogICAgIHJ5PSIwLjgxIgogICAgIHRyYW5zZm9ybT0ic2NhbGUoMSwtMSkiIC8+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMtMSIKICAgICB3aWR0aD0iNC4wNTAwMDAyIgogICAgIGhlaWdodD0iMTIuMzk3MTE5IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSI1LjgwMTQ0MDciCiAgICAgcng9IjAuODEiCiAgICAgcnk9IjAuODEiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwxLDEsMCwwLDApIiAvPjxjaXJjbGUKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICBpZD0icGF0aDQxMzYiCiAgICAgY3g9IjEyIgogICAgIGN5PSIxMiIKICAgICByPSIxMC41MDMxOTEiIC8+PC9zdmc+",i.REMOVE_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJyZW1vdmUuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjFhZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NTAiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjAuMDUwODQ3NTIxIgogICAgIGlua3NjYXBlOmN5PSI5Ljk2NjEwMTciCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJyZXBlYXQiIC8+PHN0eWxlCiAgICAgdHlwZT0idGV4dC9jc3MiCiAgICAgaWQ9InN0eWxlMyI+Cgkuc3Qwe2ZpbGw6I0NGOEIxNzt9Cgkuc3Qxe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+PHRpdGxlCiAgICAgaWQ9InRpdGxlNSI+cmVwZWF0PC90aXRsZT48cmVjdAogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eTowLjA3ODQzMTM3IgogICAgIGlkPSJyZWN0NDE0My0xIgogICAgIHdpZHRoPSI0LjA1MDAwMDIiCiAgICAgaGVpZ2h0PSIxMi4zOTcxMTkiCiAgICAgeD0iOS45NzUwMDA0IgogICAgIHk9IjUuODAxNDQwNyIKICAgICByeD0iMC44MSIKICAgICByeT0iMC44MSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsMSwwLDAsMCkiIC8+PGNpcmNsZQogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgIGlkPSJwYXRoNDEzNiIKICAgICBjeD0iMTIiCiAgICAgY3k9IjEyIgogICAgIHI9IjEwLjUwMzE5MSIgLz48L3N2Zz4="},{}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isVariableBlockType=i.validateFunctionExternal=i.flyoutCategory=i.getShadowBlockInfoFromType_=i.findUniqueParamName=i.mutateCallersAndDefinition=i.idsInUse=i.findLegalName=i.createCustomArgumentEditor=i.createCustomArgumentReporter=i.isCustomType=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.rename=void 0;const s=e("blockly"),n=e("./constants"),o=e("./functionManager"),r=e("./msg"),a=e("./blocks/functionDeclarationBlock");function l(e,t){for(const i of t.getTopBlocks(!1))if(i.type===n.FUNCTION_DEFINITION_BLOCK_TYPE){const t=i;if(t.getName()===e)return t}return null}function c(e){return e.getTopBlocks(!1).filter((e=>e.type===n.FUNCTION_DEFINITION_BLOCK_TYPE))}function u(e,t,i){const n=s.utils.xml.createElement("block");n.setAttribute("type",e);const o=s.utils.xml.createElement("mutation");return o.setAttribute("typename",t),n.appendChild(o),s.Xml.domToBlock(n,i)}function h(e,t,i){if(null==i?void 0:i.isInFlyout)return e;const s=d(t,i);for(;s[e];)e=p(e);return e}function d(e,t,i){const s={};return e.getAllVariables().forEach((function(e){s[e.name]=!0})),e.getAllBlocks(!1).forEach((function(e){const o=e;o==t||i&&o.getFunctionId&&o.getFunctionId()==i||(o.type==n.FUNCTION_DEFINITION_BLOCK_TYPE?s[o.getName()]=!0:"procedures_defreturn"==e.type||e.type)})),s}function p(e){const t=e.match(/^(.*?)(\d+)$/);return t?e=t[1]+(parseInt(t[2],10)+1):e+="2",e}function g(e,t,i){const o=l(e,t);if(o){const t=function(e,t){const i=[];for(const s of t.getAllBlocks(!1))if(s.type===n.FUNCTION_CALL_BLOCK_TYPE||s.type===n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){const t=s;t.getName()===e&&i.push(t)}return i}(e,o.workspace);t.push(o),s.Events.setGroup(!0),t.forEach((function(e){const t=e.mutationToDom(),r=t&&s.Xml.domToText(t);e.domToMutation(i);const a=e.mutationToDom(),l=a&&s.Xml.domToText(a);if(r!=l)if(s.Events.fire(new s.Events.BlockChange(e,"mutation",null,r,l)),e.id==o.id){const e=m(t,!1),i=m(a,!0);o.getDescendants(!1).forEach((function(t){if(!function(e){return e.type==n.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE||e.type==n.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE||e.type==n.ARGUMENT_REPORTER_STRING_BLOCK_TYPE||e.type==n.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE||e.type==n.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}(t))return;let s=t.getFieldValue("VALUE"),o=e[s];i[o]?i[o]!==s&&t.setFieldValue(i[o],"VALUE"):t.dispose(!0)}))}else setTimeout((function(){e.bumpNeighbours()}),s.config.bumpDelay)})),s.Events.setGroup(!1)}else console.warn("Attempted to change function "+e+", but no definition block was found on the workspace")}function m(e,t){const i={};for(let s=0;s<e.childNodes.length;++s){const n=e.childNodes[s],o=t?n.getAttribute("id"):n.getAttribute("name"),r=t?n.getAttribute("name"):n.getAttribute("id");i[o]=r}return i}function f(e,t){return!t||-1==t.indexOf(e)}i.rename=function(e){e=e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");const t=this.sourceBlock_,i=h(e,t.workspace,t),s=this.getValue();if(!e)return s;if(!i)return e;if(!s)return t.name_=i,i;if(s!=e&&s!=i){t.name_=i;const e=t.mutationToDom();t.name_=s,g(s,t.workspace,e)}return i},i.getDefinition=l,i.getAllFunctionDefinitionBlocks=c,i.isCustomType=function(e){return!("boolean"==e||"string"==e||"number"==e)},i.createCustomArgumentReporter=function(e,t){return u(n.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE,e,t)},i.createCustomArgumentEditor=function(e,t){return u(n.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE,e,t)},i.findLegalName=h,i.idsInUse=function(e){const t=[];return e.getAllBlocks(!1).forEach((function(e){e.type==n.FUNCTION_DEFINITION_BLOCK_TYPE&&t.push(e.getFunctionId())})),t},i.mutateCallersAndDefinition=g,i.findUniqueParamName=function(e,t){for(;!f(e,t);)e=p(e);return e},i.getShadowBlockInfoFromType_=function(e,t){let i="",n="",r="";switch(e){case"boolean":i="logic_boolean",n="BOOL",r="TRUE";break;case"number":i="math_number",n="NUM",r="1";break;case"string":i="text",n="TEXT",r="abc";break;case"Array":i="variables_get",n="VAR",r=s.Variables.getOrCreateVariablePackage(t,null,"list","").getId();break;default:i="variables_get",n="VAR",r=s.Variables.getOrCreateVariablePackage(t,null,o.FunctionManager.getInstance().getArgumentNameForType(e),"").getId()}return[i,n,r]},i.flyoutCategory=function(e){const t=[],i=document.createElement("button"),l=s.Msg[r.MsgKey.FUNCTION_CREATE_NEW];i.setAttribute("text",l),i.setAttribute("callbackKey","CREATE_FUNCTION"),e.registerButtonCallback("CREATE_FUNCTION",(()=>{!function(e){s.hideChaff(),s.getSelected()&&s.getSelected().unselect(),o.FunctionManager.getInstance().editFunctionExternal((0,a.newFunctionMutation)(e),function(e){return function(t){if(t){const i='<xml><block type="'+n.FUNCTION_DEFINITION_BLOCK_TYPE+'">'+s.Xml.domToText(t)+"</block></xml>",o=s.utils.xml.textToDom(i);s.Events.setGroup(!0);const r=s.Xml.domToBlock(o.firstChild,e);if(r.updateDisplay_(),e.getMetrics){const t=e.getMetrics(),i=r.getHeightWidth();r.moveBy(t.viewLeft+t.viewWidth/2-i.width/2,t.viewTop+t.viewHeight/2-i.height/2),r.scheduleSnapAndBump()}e.centerOnBlock(r.id),s.Events.setGroup(!1),setTimeout((()=>{r.afterWorkspaceLoad&&r.afterWorkspaceLoad()}))}}}(e))}(e)})),t.push(i);for(const i of c(e)){const e=i.getName(),n=i.getArguments(),o=s.utils.xml.createElement("block");o.setAttribute("type","function_call"),o.setAttribute("gap","16");const r=s.utils.xml.createElement("mutation");r.setAttribute("name",e),o.appendChild(r);for(let e=0;e<n.length;e++){const t=s.utils.xml.createElement("arg");t.setAttribute("name",n[e].name),t.setAttribute("type",n[e].type),t.setAttribute("id",n[e].id),r.appendChild(t)}t.push(o)}return t},i.validateFunctionExternal=function(e,t){const i=e.getAttribute("name");if(!i)return s.dialog.alert(s.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;const n={};for(let t=0;t<e.childNodes.length;++t){const i=e.childNodes[t].getAttribute("name");if(!i)return s.dialog.alert(s.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;if(n[i])return s.dialog.alert(s.Msg.FUNCTION_WARNING_DUPLICATE_ARG),!1;n[i]=!0}return n[i]?(s.dialog.alert(s.Msg.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME),!1):!d(t,null,e.getAttribute("functionid"))[i]||(s.dialog.alert(s.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",i)),!1)},i.isVariableBlockType=function(e){switch(e){case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":case"variables_get_reporter":case"variables_get":return!0}return!1}},{"./blocks/functionDeclarationBlock":85,"./constants":88,"./functionManager":92,"./msg":94,blockly:197}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly");s.Extensions.unregister("logic_compare"),s.Extensions.register("logic_compare",(function(){}))},{blockly:197}],98:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n={elseifCount_:0,elseCount_:0,valueConnections_:[],statementConnections_:[],elseStatementConnection_:null,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=s.utils.xml.createElement("mutation");return this.elseifCount_&&e.setAttribute("elseif",this.elseifCount_+""),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){e&&(this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_())},storeConnections_:function(e){e||(e=0),this.valueConnections_=[null],this.statementConnections_=[null],this.elseStatementConnection_=null;for(let t=1;t<=this.elseifCount_;t++)e!=t&&(this.valueConnections_.push(this.getInput("IF"+t).connection.targetConnection),this.statementConnections_.push(this.getInput("DO"+t).connection.targetConnection));this.getInput("ELSE")&&(this.elseStatementConnection_=this.getInput("ELSE").connection.targetConnection)},restoreConnections_:function(){var e,t,i;for(let i=1;i<=this.elseifCount_;i++)null===(e=this.valueConnections_[i])||void 0===e||e.reconnect(this,"IF"+i),null===(t=this.statementConnections_[i])||void 0===t||t.reconnect(this,"DO"+i);this.getInput("ELSE")&&(null===(i=this.elseStatementConnection_)||void 0===i||i.reconnect(this,"ELSE"))},addElse_:function(){this.storeConnections_(),this.update_((()=>{this.elseCount_++})),this.restoreConnections_()},removeElse_:function(){this.storeConnections_(),this.update_((()=>{this.elseCount_--})),this.restoreConnections_()},addElseIf_:function(){this.storeConnections_(),this.update_((()=>{this.elseifCount_++})),this.restoreConnections_()},removeElseIf_:function(e){this.storeConnections_(e),this.update_((()=>{this.elseifCount_--})),this.restoreConnections_()},update_:function(e){s.Events.setGroup(!0);const t=this,i=t.mutationToDom(),n=i&&s.Xml.domToText(i),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof s.BlockSvg&&t.initSvg();const r=s.Events.getGroup(),a=t.mutationToDom(),l=a&&s.Xml.domToText(a);n!=l&&(s.Events.fire(new s.Events.BlockChange(t,"mutation",null,n,l)),setTimeout((function(){s.Events.setGroup(r),t.bumpNeighbours(),s.Events.setGroup(!1)}),s.config.bumpDelay)),t.rendered&&t instanceof s.BlockSvg&&t.render(),s.Events.setGroup(!1)},updateShape_:function(){this.getInput("ELSE")&&(this.removeInput("ELSE"),this.removeInput("ELSETITLE"),this.removeInput("ELSEBUTTONS"));let e=1;for(;this.getInput("IF"+e);)this.removeInput("IF"+e),this.removeInput("IFTITLE"+e),this.removeInput("IFBUTTONS"+e),this.removeInput("DO"+e),e++;for(let e=1;e<=this.elseifCount_;e++){const i=function(e){return function(){t.removeElseIf_(e)}}(e);this.appendValueInput("IF"+e).setCheck("Boolean").appendField(s.Msg.CONTROLS_IF_MSG_ELSEIF),this.appendDummyInput("IFTITLE"+e).appendField(s.Msg.CONTROLS_IF_MSG_THEN),this.appendDummyInput("IFBUTTONS"+e).appendField(new s.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",i,!1)).setAlign(s.ALIGN_RIGHT),this.appendStatementInput("DO"+e)}this.elseCount_&&(this.appendDummyInput("ELSETITLE").appendField(s.Msg.CONTROLS_IF_MSG_ELSE),this.appendDummyInput("ELSEBUTTONS").setAlign(s.ALIGN_RIGHT).appendField(new s.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",this.removeElse_.bind(this),!1)),this.appendStatementInput("ELSE")),this.getInput("ADDBUTTON")&&this.removeInput("ADDBUTTON");const t=this;this.appendDummyInput("ADDBUTTON").appendField(new s.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){0==t.elseCount_?t.addElse_():(t.elseifCount_||(t.elseifCount_=0),t.addElseIf_())}),!1))},rebuildShape_:function(){const e=[null],t=[null];let i=null;this.getInput("ELSE")&&(i=this.getInput("ELSE").connection.targetConnection);let s=1;for(;this.getInput("IF"+s);){const i=this.getInput("IF"+s),n=this.getInput("DO"+s);e.push(i.connection.targetConnection),t.push(n.connection.targetConnection),s++}this.updateShape_(),this.reconnectChildBlocks_(e,t,i)},reconnectChildBlocks_:function(e,t,i){var s,n;for(let i=1;i<=this.elseifCount_;i++)null===(s=e[i])||void 0===s||s.reconnect(this,"IF"+i),null===(n=t[i])||void 0===n||n.reconnect(this,"DO"+i);null==i||i.reconnect(this,"ELSE")}};s.Blocks.controls_if=Object.assign(Object.assign({},n),{init(){if(s.Extensions.apply("inline-svgs",this,!1),this.elseifCount_=0,this.elseCount_=0,this.setHelpUrl(s.Msg.CONTROLS_IF_HELPURL),this.appendValueInput("IF0").setCheck("Boolean").appendField(s.Msg.CONTROLS_IF_MSG_IF),this.appendDummyInput("THEN0").appendField(s.Msg.CONTROLS_IF_MSG_THEN),this.appendStatementInput("DO0"),this.workspace instanceof s.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(e.getConstants().SHAPES.HEXAGONAL)}this.updateShape_(),this.setInputsInline(!0),this.setColour(s.Msg.LOGIC_HUE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip((()=>this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?s.Msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?s.Msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?s.Msg.CONTROLS_IF_TOOLTIP_4:"":s.Msg.CONTROLS_IF_TOOLTIP_1))}})},{blockly:197}],99:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./extensions"),i),n(e("./ifElse"),i)},{"./extensions":97,"./ifElse":98}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSlider=void 0;const s=e("blockly");class n extends s.FieldNumber{constructor(e,t,i,s,n,o,r,a){super(e,t,i,s,r,a),"string"==typeof n?this.step_=parseFloat(n):"number"==typeof n&&(this.step_=n),this.labelText_=o}hasMin(){return this.getMin()>-1/0}hasMax(){return this.getMax()<1/0}getStep(){return this.step_}getLabel(){return this.labelText_}setLabel(e){this.labelText_=e}setOptions(e,t,i,s){this.setConstraints(e,t,s),this.step_=parseFloat(i)||void 0}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=`${e}`).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);if(isNaN(t))return null;this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_);let i=String(this.precision_);-1!==i.indexOf("e")&&(i=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const s=i.indexOf(".");let n;return null!==(n=-1===s?this.precision_?0:null:i.length-s-1)&&(t=Number(t.toFixed(n))),t}showEditor_(e,t){super.showEditor_(e,t),s.DropDownDiv.hideWithoutAnimation(),s.DropDownDiv.clearContent();const i=s.DropDownDiv.getContentDiv();i.setAttribute("role","menu"),i.setAttribute("aria-haspopup","true"),this.addSlider_(i),s.DropDownDiv.setColour("#ffffff","#dddddd"),s.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_)}addSlider_(e){if(this.labelText_){let t=this.createLabelDom_(this.labelText_);e.appendChild(t[0]),this.readout_=t[1],this.setReadout(this.value_)}this.slider_=this.createSlider(),e.appendChild(this.slider_);const t=()=>{pxt.BrowserUtils.isFirefox()||this.htmlInput_.focus()};s.browserEvents.bind(this.slider_,"input",this,(e=>{const i=parseFloat(this.slider_.value)||0;if(null!==i){this.setValue(i);const e=this.htmlInput_;e&&(e.value=i+"",t())}})),s.browserEvents.bind(this.slider_,"focus",this,(e=>{t()}))}setValue(e,t){super.setValue(e,t),this.updateDom(),this.slider_&&(this.slider_.value=this.getValue()+"")}createSlider(){const e=document.createElement("input");return e.type="range",e.min=this.getMin()+"",e.max=this.getMax()+"",e.value=this.getValue()+"",Number.isNaN(this.step_)||(e.step=this.step_+""),e}updateDom(){this.setReadout(this.getValue())}setReadout(e){this.readout_&&(this.readout_.innerText=e+"")}createLabelDom_(e){const t=document.createElement("div");t.setAttribute("class","blocklyFieldSliderLabel");const i=document.createElement("span");i.setAttribute("class","blocklyFieldSliderReadout");const s=document.createElement("span");return s.setAttribute("class","blocklyFieldSliderLabelText"),s.innerText=e,t.appendChild(s),t.appendChild(i),[t,i]}}i.FieldSlider=n,s.fieldRegistry.register("field_slider",n),s.Css.register('\n.blocklyFieldSliderLabel {\n    font-family: "Helvetica Neue", "Segoe UI", Helvetica, sans-serif;\n    font-size: 0.65rem;\n    color: $colour_toolboxText;\n    margin: 8px;\n}\n.blocklyFieldSliderLabelText {\n    font-weight: bold;\n}\n.blocklyFieldSliderReadout {\n    margin-left: 10px;\n}\n\ninput[type=range] {\n    -webkit-appearance: none;\n    width: 100%;\n}\ninput[type=range]:focus {\n    outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n    -webkit-appearance: none;\n    margin: 8px;\n    height: 22px;\n    width: 150px;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: #547AB2;\n}\ninput[type=range]::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\ninput[type=range]::-moz-range-track {\n    margin: 8px;\n    height: 22px;\n    width: 95%;\n    outline: none;\n    border-radius: 11px;\n    margin-bottom: 20px;\n    background: #547AB2;\n}\ninput[type=range]::-moz-range-thumb {\n    width: 26px;\n    height: 26px;\n    margin-top: -1px;\n    background-color: white;\n    border-radius: 100%;\n    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);\n    cursor: pointer;\n}\n')},{blockly:197}],101:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./fieldSlider"),i),n(e("./numberBlocks"),i)},{"./fieldSlider":100,"./numberBlocks":102}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n=new s.zelos.ConstantProvider;s.defineBlocksWithJsonArray([{type:"math_integer",message0:"%1",args0:[{type:"field_number",name:"NUM",precision:1}],output:"Number",outputShape:n.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_whole_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0,precision:1}],output:"Number",outputShape:n.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_positive_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0}],output:"Number",outputShape:n.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_number_minmax",message0:"%1",args0:[{type:"field_slider",name:"SLIDER",value:0,step:1,labelText:"Number"}],output:"Number",outputShape:n.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",mutator:"math_number_minmax_mutator",extensions:["parent_tooltip_when_inline"]}]);const o={mutationToDom:function(){const e=this.inputList[0].fieldRow[0];let t=s.utils.xml.createElement("mutation");return e.hasMin()&&t.setAttribute("min",e.getMin()+""),e.hasMax()&&t.setAttribute("max",e.getMax()+""),null!=e.getLabel()&&t.setAttribute("label",e.getLabel()),null!=e.getStep()&&t.setAttribute("step",e.getStep()+""),null!=e.getPrecision()&&t.setAttribute("precision",e.getPrecision()+""),t},domToMutation:function(e){const t=this.inputList[0].fieldRow[0],i=e.getAttribute("min"),s=e.getAttribute("max"),n=e.getAttribute("step"),o=e.getAttribute("label"),r=e.getAttribute("precision");t.setLabel(o),t.setOptions(i,s,n,r)}};s.Extensions.registerMutator("math_number_minmax_mutator",o)},{blockly:197}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.showEditorMixin=void 0;const s=e("blockly");i.showEditorMixin=function(e){const t=this.getSourceBlock();if(!t)throw new s.UnattachedFieldError;const i=new s.Menu;i.setRole(s.utils.aria.Role.LISTBOX),this.menu_=i;const o=this.getOptions(!1);let r=null;const a=e=>{s.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)};for(let e=0;e<o.length;e++){const[l,c]=o[e];if("SEPARATOR"===c){const e=new n("");i.addChild(e);continue}const u=(()=>{if("object"==typeof l){const e=new Image(l.width,l.height);return e.src=l.src,e.alt=l.alt||"",e}return l})(),h=new s.MenuItem(u,c);h.setRole(s.utils.aria.Role.OPTION),h.setRightToLeft(t.RTL),h.setCheckable(!0),i.addChild(h),h.setChecked(c===this.value_),h.onAction(a,this),c===this.value_&&(r=h)}e&&"number"==typeof e.clientX?this.menu_.openingCoords=new s.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,s.DropDownDiv.clearContent();const l=this.menu_.render(s.DropDownDiv.getContentDiv());if(s.utils.dom.addClass(l,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV){const e=t.getColour(),i=this.sourceBlock_.style.colourTertiary;s.DropDownDiv.setColour(e,i)}s.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),r&&(this.menu_.setHighlighted(r),s.utils.style.scrollIntoContainerView(r.getElement(),s.DropDownDiv.getContentDiv(),!0)),this.applyColour()};class n extends s.MenuItem{createDom(){const e=document.createElement("div");return e.id=s.utils.idGenerator.getNextUniqueId(),this.element_=e,e.className="blockly-menuseparator",e.setAttribute("role","separator"),e}getElement(){return this.element_}getId(){return this.element_.id}}s.Css.register("\n.blockly-menuseparator {\n    border-top: 1px solid rgba(0, 0, 0, 0.2);\n    margin: 4px 0;\n    padding: 0;\n}\n")},{blockly:197}],104:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldVariable=void 0;const s=e("blockly"),n=e("./fieldDropdownMixin");class o extends s.FieldVariable{constructor(e,t,i,s,n){super(e,t,i,s,n),this.menuGenerator_=o.dropdownCreate}static dropdownCreate(){const e=s.FieldVariable.dropdownCreate.call(this),t=e.findIndex((e=>"RENAME_VARIABLE_ID"===e[1]));return e.splice(t,0,[s.Msg.NEW_VARIABLE_DROPDOWN,o.CREATE_VARIABLE_ID],[void 0,"SEPARATOR"]),e}onItemSelected_(e,t){!this.sourceBlock_||this.sourceBlock_.isDeadOrDying()||t.getValue()!==o.CREATE_VARIABLE_ID?super.onItemSelected_(e,t):s.Variables.createVariableButtonHandler(this.sourceBlock_.workspace,(e=>{const t=this.sourceBlock_.workspace.getVariable(e);t&&this.setValue(t.getId())}))}showEditor_(e){n.showEditorMixin.call(this,e)}}i.FieldVariable=o,o.CREATE_VARIABLE_ID="CREATE_VARIABLE",s.fieldRegistry.unregister("field_variable"),s.fieldRegistry.register("field_variable",o)},{"./fieldDropdownMixin":103,blockly:197}],105:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./fieldVariable"),i)},{"./fieldVariable":104}],106:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isCollapsedInputRow=i.CollapsedInputRow=void 0;const s=e("blockly");class n extends s.blockRendering.InputRow{constructor(e){super(e),this.type|=s.blockRendering.Types.INPUT_ROW|s.blockRendering.Types.getType("COLLAPSED_INPUT_ROW")}measure(){this.width=this.minWidth,this.height=this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT}}i.CollapsedInputRow=n,i.isCollapsedInputRow=function(e){return!!(e.type&s.blockRendering.Types.getType("COLLAPSED_INPUT_ROW"))}},{blockly:197}],107:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ConnectionPreviewer=void 0;const s=e("blockly");class n extends s.InsertionMarkerPreviewer{previewReplacement(e,t,i){super.previewReplacement(e,t,i),this.connectionLine||(this.connectionLine=s.utils.dom.createSvgElement("line",{class:"blocklyConnectionLine",x1:0,y1:0,x2:0,y2:0},e.sourceBlock_.getSvgRoot()),this.draggedConnectionIndicator=this.createConnectionIndicator(e));const o=n.CONNECTION_INDICATOR_RADIUS,r=e.getOffsetInBlock(),a=s.utils.Coordinate.sum(e.sourceBlock_.getRelativeToSurfaceXY(),r),l=s.utils.Coordinate.sum(t.sourceBlock_.getRelativeToSurfaceXY(),t.getOffsetInBlock()),c=l.x-a.x,u=l.y-a.y,h=Math.atan2(u,c);Math.sqrt(c*c+u*u)<2*o+1?s.utils.dom.addClass(this.connectionLine,"hidden"):(s.utils.dom.removeClass(this.connectionLine,"hidden"),this.connectionLine.setAttribute("x1",String(r.x+Math.cos(h)*o)),this.connectionLine.setAttribute("y1",String(r.y+Math.sin(h)*o)),this.connectionLine.setAttribute("x2",String(r.x+c-Math.cos(h)*o)),this.connectionLine.setAttribute("y2",String(r.y+u-Math.sin(h)*o)))}hidePreview(){super.hidePreview(),this.connectionLine&&(this.connectionLine.remove(),this.connectionLine=null,this.draggedConnectionIndicator.remove(),this.draggedConnectionIndicator=null,this.staticConnection=null)}createConnectionIndicator(e){const t=s.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"},e.sourceBlock_.getSvgRoot());s.utils.dom.createSvgElement("circle",{r:n.CONNECTION_INDICATOR_RADIUS},t);const i=e.getOffsetInBlock();return t.setAttribute("transform","translate("+i.x+","+i.y+")"),t}}i.ConnectionPreviewer=n,n.CONNECTION_INDICATOR_RADIUS=9},{blockly:197}],108:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ConstantProvider=void 0;const s=e("blockly");class n extends s.zelos.ConstantProvider{constructor(){super(...arguments),this.FIELD_TEXT_FONTFAMILY='"Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace',this.FIELD_TEXT_FONTWEIGHT="600",this.HIGHLIGHT_GLOW_COLOUR="#FFF200",this.ERROR_HIGHLIGHT_GLOW_COLOR="#FF0000",this.HIGHLIGHT_GLOW_SIZE=1.1,this.ELLIPSES_RADIUS=6,this.ELLIPSES_SPACING=8,this.ellipses=this.makeEllipses()}createDom(e,t,i){super.createDom(e,t,i);const n=s.utils.dom.createSvgElement(s.utils.Svg.DEFS,{},e);this.highlightOutlineFilter=this.createHighlight(n,"blocklyHighlightedGlowFilter",this.HIGHLIGHT_GLOW_COLOUR),this.highlightOutlineFilterId=this.highlightOutlineFilter.id,this.errorOutlineFilter=this.createHighlight(n,"blocklyErrorHighlightedGlowFilter",this.ERROR_HIGHLIGHT_GLOW_COLOR),this.errorOutlineFilterId=this.errorOutlineFilter.id,this.embossFilterOverride=this.createOutline(n,"blocklyBubbleEmbossGlowFilter"),this.embossFilterId=this.embossFilterOverride.id}dispose(){super.dispose(),this.highlightOutlineFilter&&s.utils.dom.removeNode(this.highlightOutlineFilter)}makeEllipses(){const e=this.ELLIPSES_RADIUS,t=this.ELLIPSES_SPACING;let i="";for(let n=0;n<3;n++)i+=s.utils.svgPaths.moveBy(t,0)+s.utils.svgPaths.arc("a","180 1,1",e,s.utils.svgPaths.point(2*e,0));for(let n=0;n<3;n++)i+=s.utils.svgPaths.arc("a","180 1,1",e,s.utils.svgPaths.point(2*-e,0))+s.utils.svgPaths.moveBy(-t,0);return i}getCSS_(e){return super.getCSS_(e).concat([e+" .blocklyConnectionIndicator, "+e+" .blocklyInputConnectionIndicator {","fill: #ff0000;","stroke: #ffff00;","stroke-width: 3px;","}",e+" .blocklyConnectionIndicator {","display: none;","}",e+" .blocklyBlockDragSurface > g > .blocklyDraggable > .blocklyConnectionIndicator {","display: block;","}",e+" .blocklyConnectionLine {","stroke: #ffff00;","stroke-width: 4px;","}",e+" .blocklyConnectionLine.hidden {","display: none;","}",e+" .blocklyFlyoutHeading .blocklyFlyoutLabelText {font-size: 1.5rem;","}"])}createHighlight(e,t,i){const n=s.utils.dom.createSvgElement(s.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);s.utils.dom.createSvgElement(s.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.HIGHLIGHT_GLOW_SIZE},n);const o=s.utils.dom.createSvgElement(s.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},n);return s.utils.dom.createSvgElement(s.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},o),s.utils.dom.createSvgElement(s.utils.Svg.FEFLOOD,{"flood-color":i,"flood-opacity":1,result:"outColor"},n),s.utils.dom.createSvgElement(s.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},n),n}createOutline(e,t){const i=s.utils.dom.createSvgElement(s.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e);s.utils.dom.createSvgElement(s.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:.92},i);const n=s.utils.dom.createSvgElement(s.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},i);s.utils.dom.createSvgElement(s.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},n),s.utils.dom.createSvgElement(s.utils.Svg.FEFLOOD,{"flood-color":"#000000","flood-opacity":.5,result:"outColor"},i),s.utils.dom.createSvgElement(s.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},i);const o=s.utils.dom.createSvgElement("feMerge",{},i);return s.utils.dom.createSvgElement("feMergeNode",{in:"outBlur"},o),s.utils.dom.createSvgElement("feMergeNode",{in:"outGlow"},o),s.utils.dom.createSvgElement("feMergeNode",{in:"SourceGraphic"},o),i}}i.ConstantProvider=n,n.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",n.EXPAND_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.654)'%3E%3Cpath d='m1611 832q0-53-37-90l-651-651q-38-38-91-38-54 0-90 38l-651 651q-38 36-38 90 0 53 38 91l74 75q39 37 91 37 53 0 90-37l486-486 486 486q37 37 90 37 52 0 91-37l75-75q37-39 37-91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A"},{blockly:197}],109:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Drawer=void 0;const s=e("blockly"),n=e("./collapsedInputRow");class o extends s.zelos.Drawer{drawCollapsedStack_(e){const t=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.constants_.INSIDE_CORNERS.width,i=this.constants_.STATEMENT_INPUT_PADDING_LEFT+2*this.constants_.INSIDE_CORNERS.width+s.utils.svgPaths.lineOnAxis("h",-this.constants_.INSIDE_CORNERS.width)+this.constants_.INSIDE_CORNERS.pathTop,n=e.height-2*this.constants_.INSIDE_CORNERS.height,o=this.constants_.INSIDE_CORNERS.pathBottom+s.utils.svgPaths.lineOnAxis("h",this.constants_.INSIDE_CORNERS.width),r=this.constants_.ellipses;this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.bottomRight+s.utils.svgPaths.lineOnAxis("H",t)+i+s.utils.svgPaths.lineOnAxis("v",n/2)+r+s.utils.svgPaths.lineOnAxis("v",n/2)+o+s.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.constants_.OUTSIDE_CORNERS.rightHeight)+this.constants_.OUTSIDE_CORNERS.topRight}drawOutline_(){if(this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection)this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_();else{this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):(0,n.isCollapsedInputRow)(t)?this.drawCollapsedStack_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}}drawLeft_(){if(super.drawLeft_(),this.info_.rows.find((function(e){return(0,n.isCollapsedInputRow)(e)}))){let e=this.info_.startY;s.blockRendering.Types.isLeftRoundedCorner(this.info_.topRow.elements[0])&&(e+=this.constants_.OUTSIDE_CORNERS.rightHeight),this.outlinePath_=this.outlinePath_.slice(0,-1),this.outlinePath_+=s.utils.svgPaths.lineOnAxis("V",e)}}}i.Drawer=o},{"./collapsedInputRow":106,blockly:197}],110:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./renderer"),i),n(e("./connectionPreviewer"),i)},{"./connectionPreviewer":107,"./renderer":113}],111:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RenderInfo=void 0;const s=e("blockly"),n=e("./collapsedInputRow");class o extends s.zelos.RenderInfo{measure(){if(this.block_)for(const e of this.block_.inputList)e.init();super.measure()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new s.blockRendering.InputRow(this.constants_);this.inputRows.push(e);const t=this.block_.getIcons();for(let i,n=0;i=t[n];n++){const t=new s.blockRendering.Icon(this.constants_,i);this.isCollapsed&&!i.isShownWhenCollapsed()||e.elements.push(t)}let i;for(let t,n=0;t=this.block_.inputList[n];n++)if(t.isVisible()){this.shouldStartNewRow_(t,i)&&(this.rows.push(e),e=new s.blockRendering.InputRow(this.constants_),this.inputRows.push(e));for(let i,n=0;i=t.fieldRow[n];n++)e.elements.push(new s.blockRendering.Field(this.constants_,i,t));this.addInput_(t,e),i=t}this.isCollapsed&&(this.block_.inputList.find((function(e){return e.type==s.inputTypes.STATEMENT}))?e=this.addCollapsedRow_(e):(e.hasJaggedEdge=!0,e.elements.push(new s.blockRendering.JaggedEdge(this.constants_)))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;const e=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof s.inputs.StatementInput||this.rows.some((e=>(0,n.isCollapsedInputRow)(e)));this.bottomRow.minHeight=e?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new s.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new s.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new s.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new s.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new s.blockRendering.RoundCorner(this.constants_,"right"))}addCollapsedRow_(e){this.rows.push(e);const t=new n.CollapsedInputRow(this.constants_);return t.hasDummyInput=!0,t}}i.RenderInfo=o},{"./collapsedInputRow":106,blockly:197}],112:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PathObject=void 0;const s=e("blockly"),n="blockly-dotted-outline-on-hover",o="hover";class r extends s.zelos.PathObject{constructor(){super(...arguments),this.connectionPointIndicators=new WeakMap}updateHighlighted(e){if(e){if(!this.svgPathHighlighted){const e=this.constants,t=this.hasError?e.errorOutlineFilterId:e.highlightOutlineFilterId;this.svgPathHighlighted=this.svgPath.cloneNode(!0),this.svgPathHighlighted.setAttribute("fill","none"),this.svgPathHighlighted.setAttribute("filter","url(#"+t+")"),this.svgRoot.appendChild(this.svgPathHighlighted)}}else this.svgPathHighlighted&&(this.svgRoot.removeChild(this.svgPathHighlighted),this.svgPathHighlighted=null)}updateSelected(e){e&&this.svgPath.classList.remove(o),super.updateSelected(e)}addConnectionHighlight(e,t,i,n){if(super.addConnectionHighlight(e,t,i,n),e.type===s.INPUT_VALUE||e.type===s.OUTPUT_VALUE){const t=s.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"});s.utils.dom.createSvgElement("circle",{r:r.CONNECTION_INDICATOR_RADIUS},t);const i=e.getOffsetInBlock();t.setAttribute("transform","translate("+i.x+","+i.y+")"),this.connectionPointIndicators.set(e,t),this.svgRoot.appendChild(t)}}removeConnectionHighlight(e){super.removeConnectionHighlight(e),this.connectionPointIndicators.has(e)&&(this.connectionPointIndicators.get(e).remove(),this.connectionPointIndicators.delete(e))}setHasDottedOutllineOnHover(e){this.hasDottedOutlineOnHover=e,e?(this.svgPath.classList.add(n),this.mouseOverData||(this.mouseOverData=s.browserEvents.bind(this.svgRoot,"mouseover",this,(()=>{this.svgPath.classList.add(o)})),this.mouseLeaveData=s.browserEvents.bind(this.svgRoot,"mouseleave",this,(()=>{this.svgPath.classList.remove(o)})))):(this.svgPath.classList.remove(n),this.mouseOverData&&(s.browserEvents.unbind(this.mouseOverData),s.browserEvents.unbind(this.mouseLeaveData),this.mouseOverData=void 0,this.mouseLeaveData=void 0),this.svgPath.classList.remove(n))}setHasError(e){this.hasError=e}isHighlighted(){return!!this.svgPathHighlighted}resizeHighlight(){this.svgPathHighlighted&&(this.updateHighlighted(!1),this.updateHighlighted(!0))}}i.PathObject=r,r.CONNECTION_INDICATOR_RADIUS=9,s.Css.register("\n.blockly-dotted-outline-on-hover {\n    transition: stroke .4s;\n}\n.blockly-dotted-outline-on-hover.hover {\n    stroke-dasharray: 2;\n    stroke: white;\n    stroke-width: 2;\n}\n")},{blockly:197}],113:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Renderer=void 0;const s=e("blockly"),n=e("./pathObject"),o=e("./constants"),r=e("./info"),a=e("./drawer");class l extends s.zelos.Renderer{makePathObject(e,t){return new n.PathObject(e,t,this.getConstants())}makeConstants_(){return new o.ConstantProvider}makeRenderInfo_(e){return new r.RenderInfo(this,e)}makeDrawer_(e,t){return new a.Drawer(e,t)}render(e){e.updateBeforeRender&&e.updateBeforeRender(),super.render(e)}}i.Renderer=l,s.blockRendering.register("pxt",l)},{"./constants":108,"./drawer":109,"./info":111,"./pathObject":112,blockly:197}],114:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FieldString=void 0;const s=e("blockly");class n extends s.FieldTextInput{initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(e){super.updateSize_(e);const t=this.value_?this.size_.width:1;let i=this.positionLeft(t+3);this.textElement_.setAttribute("x",i+""),i+=this.positionRight(i+t+3),this.size_.width=t+i}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteLeftX_=e+this.quoteWidth_+2*n.quotePadding,t=this.quoteWidth_+n.quotePadding):(this.quoteLeftX_=0,t=this.quoteWidth_+n.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return this.sourceBlock_.RTL?(this.quoteRightX_=n.quotePadding,t=this.quoteWidth_+n.quotePadding):(this.quoteRightX_=e+n.quotePadding,t=this.quoteWidth_+n.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}}i.FieldString=n,n.quotePadding=0,s.fieldRegistry.register("field_string",n)},{blockly:197}],115:[function(e,t,i){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),n(e("./fieldString"),i),n(e("./text"),i),n(e("./join"),i)},{"./fieldString":114,"./join":116,"./text":117}],116:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly"),n={itemCount_:0,valueConnections_:[],mutationToDom:function(){const e=s.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},storeValueConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreValueConnections_:function(){var e;for(let t=0;t<this.itemCount_;t++)null===(e=this.valueConnections_[t])||void 0===e||e.reconnect(this,"ADD"+t)},addItem_:function(){if(this.storeValueConnections_(),this.update_((()=>{this.itemCount_++})),this.restoreValueConnections_(),this.itemCount_>1){const e=this.getInput("ADD0");if(e&&e.connection.targetConnection){const t=this.getInput("ADD"+(this.itemCount_-1)),i=e.connection.getShadowDom();if(i){const e=s.utils.xml.createElement("shadow"),n=i.getAttribute("type");e.setAttribute("type",n),e&&(e.setAttribute("id",s.utils.idGenerator.genUid()),t.connection.setShadowDom(e))}}}},removeItem_:function(){this.storeValueConnections_(),this.update_((()=>{this.itemCount_--})),this.restoreValueConnections_()},update_:function(e){s.Events.setGroup(!0);const t=this,i=t.mutationToDom(),n=i&&s.Xml.domToText(i),o=t.rendered;t.rendered=!1,e&&e.call(this),this.updateShape_(),t.rendered=o,t instanceof s.BlockSvg&&t.initSvg();const r=s.Events.getGroup(),a=t.mutationToDom(),l=a&&s.Xml.domToText(a);n!=l&&(s.Events.fire(new s.Events.BlockChange(t,"mutation",null,n,l)),setTimeout((function(){s.Events.setGroup(r),t.bumpNeighbours(),s.Events.setGroup(!1)}),s.config.bumpDelay)),t.rendered&&t instanceof s.BlockSvg&&t.render(),s.Events.setGroup(!1)},updateShape_:function(){const e=this;let t;for(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(s.Msg.TEXT_JOIN_TITLE_CREATEWITH),t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||this.appendValueInput("ADD"+t).setAlign(s.ALIGN_LEFT);for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");const i=this.appendDummyInput("BUTTONS");this.itemCount_>1&&i.appendField(new s.FieldImage(this.REMOVE_IMAGE_DATAURI,24,24,"*",(function(){e.removeItem_()}),!1)),i.appendField(new s.FieldImage(this.ADD_IMAGE_DATAURI,24,24,"*",(function(){e.addItem_()}),!1));const n=this.itemCount_<=4;if(this.setInputsInline(n),this.workspace instanceof s.WorkspaceSvg){const e=this.workspace.getRenderer();this.setOutputShape(n?e.getConstants().SHAPES.ROUND:e.getConstants().SHAPES.SQUARE)}}};s.Extensions.registerMutator("pxt_text_join_mutator",n,(function(){s.Extensions.apply("inline-svgs",this,!1),this.itemCount_=2,this.updateShape_()})),s.defineBlocksWithJsonArray([{type:"text_join",message0:"",output:"String",outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"pxt_text_join_mutator"}])},{blockly:197}],117:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e("blockly");s.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_string",name:"TEXT",text:""}],output:"String",outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]}])},{blockly:197}],118:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.blocksMetrics=i.render=i.renderWorkspace=i.cleanRenderingWorkspace=i.initRenderingWorkspace=void 0;const s=e("blockly"),n=e("./layout"),o=e("./importer");let r,a;function l(){return r||((a=document.createElement("div")).style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="1px",a.style.height="1px",document.body.appendChild(a),r=s.inject(a,{move:{scrollbars:!1},readOnly:!0,sounds:!1,media:pxt.webConfig.commitCdnUrl+"blockly/media/",rtl:pxt.Util.isUserLanguageRtl(),renderer:"pxt"})),(0,o.clearWithoutEvents)(r),r}function c(){r&&r.dispose(),r=void 0}function u(e={emPixels:18,layout:1}){switch(e.splitSvg?1:e.layout||4){case 1:(0,n.verticalAlign)(r,e.emPixels||18);break;case 4:(0,n.flow)(r,{ratio:e.aspectRatio,useViewWidth:e.useViewWidth});break;case 3:r.cleanUp_&&r.cleanUp_()}let t=r.getMetrics();const i=a.querySelectorAll("svg")[0].cloneNode(!0);return(0,n.cleanUpBlocklySvg)(i),pxt.U.toArray(i.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach((e=>e.setAttribute("transform",`translate(${-t.contentLeft}, ${-t.contentTop}) scale(1)`))),i.setAttribute("viewBox",`0 0 ${t.contentWidth} ${t.contentHeight}`),e.emPixels&&(i.style.width=t.contentWidth/e.emPixels+"em",i.style.height=t.contentHeight/e.emPixels+"em"),e.splitSvg?(0,n.splitSvg)(i,r,e.emPixels):i}i.initRenderingWorkspace=l,i.cleanRenderingWorkspace=c,i.renderWorkspace=u,i.render=function(e,t={emPixels:18,layout:1}){l();try{let i=e||'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',n=s.utils.xml.textToDom(i);return(0,o.domToWorkspaceNoEvents)(n,r,{applyHideMetaComment:!0}),u(t)}catch(e){return void pxt.reportException(e)}finally{c()}},i.blocksMetrics=function(e){const t=e.getTopBlocks(!1);if(!t.length)return{width:0,height:0};let i;return t.forEach((e=>{const t=e.getBoundingRectangle();i?(i.l=Math.min(i.l,t.left),i.r=Math.max(i.r,t.right),i.t=Math.min(i.t,t.top),i.b=Math.min(i.b,t.bottom)):i={l:t.left,r:t.right,t:t.top,b:t.bottom}})),{width:i.r-i.l,height:i.b-i.t}}},{"./importer":67,"./layout":69,blockly:197}],119:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.findBlockIdByLine=i.findBlockIdByPosition=void 0,i.findBlockIdByPosition=function(e,t){if(!t)return;let i,s;for(let n=0;n<e.length;++n){let o=e[n];o.startPos<=t.start&&o.endPos>=t.start+t.length&&(!i||s>o.endPos-o.startPos)&&(i=o,s=o.endPos-o.startPos)}return i?i.id:void 0},i.findBlockIdByLine=function(e,t){if(!t)return;let i,s;for(let n=0;n<e.length;++n){let o=e[n];o.startLine<=t.start&&o.endLine>t.start+t.length&&(!i||s>o.endLine-o.startLine)&&(i=o,s=o.endLine-o.startLine)}return i?i.id:void 0}},{}],120:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.createFunctionsFlyoutCategory=i.mkReturnStatementBlock=i.mkVariableFieldBlock=i.mkFieldBlock=i.mkPredicateBlock=i.createToolboxBlock=i.createFlyoutGap=i.createFlyoutButton=i.createFlyoutGroupLabel=i.createFlyoutHeadingLabel=i.createShadowValue=i.isArrayType=void 0;const s=e("blockly"),n=e("./plugins/functions"),o=e("./plugins/duplicateOnDrag"),r=/^(string|number|boolean)$/,a={string:{field:"TEXT",block:"text",defaultValue:""},number:{field:"NUM",block:"math_number",defaultValue:"0"},boolean:{field:"BOOL",block:"logic_boolean",defaultValue:"false"},Array:{field:"VAR",block:"variables_get",defaultValue:"list"}};function l(e){let t=/^(?:Array<(.+)>)|(?:(.+)\[\])|(?:\[.+\])$/.exec(e);return t?t[1]?t[1]:t[2]:void 0}function c(e,t,i,s){let n;if(s=s||t.defaultValue,!(i=i||t.shadowBlockId)&&t.range&&(i="math_number_minmax"),n=s&&'"'==s.slice(0,1)?JSON.parse(s):s,"number"==t.type&&"value"==i){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode("0")),e}if(t.fieldEditor){if(t.defaultValue){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(t.defaultValue)),e}return}let o=pxt.Util.lookup(e.apis.byQName,t.type),r=6==(null==o?void 0:o.kind),c=o&&!!o.attributes.fixedInstances&&!t.shadowBlockId,h="@combined@"==t.type;if(!i&&(r||c||h)){if(s){const e=document.createElement("field");return e.setAttribute("name",t.definitionName),e.appendChild(document.createTextNode(s)),e}return}const d="variables_get"==i,p="text"==i,g=document.createElement("value");g.setAttribute("name",t.definitionName);const m=l(t.type),f=document.createElement(d||m?"block":"shadow");g.appendChild(f);const _=a[m||t.type];if(f.setAttribute("type",i||(m?"lists_create_with":_&&_.block||t.type)),f.setAttribute("colour","#fff"),m){if(_&&!i){let e;switch(m){case"number":e=["0","1"];break;case"string":e=["a","b","c"];break;case"boolean":e=["FALSE","FALSE","FALSE"]}return u(f,_.block,_.field,e),g}if(i&&n)return u(f,n),g}if(!_||i&&_.block!==i&&"math_number_minmax"!==i){if(n){const s=document.createElement("field");if(s.textContent=n,d)s.setAttribute("name","VAR"),f.appendChild(s);else if(p)s.setAttribute("name","TEXT"),f.appendChild(s);else if(i){const t=e.blocksById[i];if(t&&t.attributes._def&&t.attributes._def.parameters.length){const e=t.attributes._def.parameters[0];s.setAttribute("name",e.name),f.appendChild(s)}}else s.setAttribute("name",t.definitionName),f.appendChild(s)}}else{const e=document.createElement("field");let s,o;switch(f.appendChild(e),i){case"variables_get":s="VAR";break;case"math_number_minmax":s="SLIDER";break;default:s=_.field}e.setAttribute("name",s),o="boolean"==t.type?document.createTextNode((n||_.defaultValue).toUpperCase()):document.createTextNode(n||_.defaultValue),e.appendChild(o)}let b;return t.range&&((b=document.createElement("mutation")).setAttribute("min",t.range.min.toString()),b.setAttribute("max",t.range.max.toString()),b.setAttribute("label",t.actualName.charAt(0).toUpperCase()+t.actualName.slice(1)),t.fieldOptions&&(t.fieldOptions.step&&b.setAttribute("step",t.fieldOptions.step),t.fieldOptions.color&&b.setAttribute("color",t.fieldOptions.color),t.fieldOptions.precision&&b.setAttribute("precision",t.fieldOptions.precision))),t.fieldOptions&&(b||(b=document.createElement("mutation")),b.setAttribute("customfield",JSON.stringify(t.fieldOptions))),b&&f.appendChild(b),g}function u(e,t,i,s){const n=s?s.length:2,o=document.createElement("mutation");o.setAttribute("items",""+n),o.setAttribute("horizontalafter",""+n),e.appendChild(o);for(let o=0;o<n;o++){const n=document.createElement("value");n.setAttribute("name","ADD"+o);const r=document.createElement("shadow");if(r.setAttribute("type",t),i){const e=document.createElement("field");e.setAttribute("name",i),s&&e.appendChild(document.createTextNode(s[o])),r.appendChild(e)}n.appendChild(r),e.appendChild(n)}}function h(e,t,i,s){const n=p(e,pxt.toolbox.convertColor(t),i,s);return n.setAttribute("web-class","blocklyFlyoutHeading"),n}function d(e,t,i,s){const n=p(e,void 0,t);return n.setAttribute("web-class","blocklyFlyoutGroup"),n.setAttribute("web-line","1.5"),i&&n.setAttribute("web-line-width",i),s&&(n.setAttribute("web-help-button","true"),n.setAttribute("callbackKey",s)),n}function p(e,t,i,n){let o=s.utils.xml.createElement("label");return o.setAttribute("text",e),t&&o.setAttribute("web-icon-color",pxt.toolbox.convertColor(t)),i&&(1===i.length?(o.setAttribute("web-icon",i),n&&o.setAttribute("web-icon-class",n)):o.setAttribute("web-icon-class",`blocklyFlyoutIcon${e}`)),o}function g(e,t,i,s){const n=document.createElement(s?"shadow":"block");n.setAttribute("type",pxt.Util.htmlEscape(e));const o=document.createElement("field");return o.setAttribute("name",pxt.Util.htmlEscape(t)),o.textContent=pxt.Util.htmlEscape(i),n.appendChild(o),n}function m(){const e=document.createElement("block");e.setAttribute("type","function_return");const t=document.createElement("value");t.setAttribute("name","RETURN_VALUE"),e.appendChild(t);const i=g("math_number","NUM","0",!0);return t.appendChild(i),e}i.isArrayType=l,i.createShadowValue=c,i.createFlyoutHeadingLabel=h,i.createFlyoutGroupLabel=d,i.createFlyoutButton=function(e,t){let i=s.utils.xml.createElement("button");return i.setAttribute("text",t),i.setAttribute("callbackKey",e),i},i.createFlyoutGap=function(e){const t=s.utils.xml.createElement("sep");return t.setAttribute("gap",e+""),t},i.createToolboxBlock=function e(t,i,s){var n,a;let u,h;if(i.attributes.toolboxParent){const s=t.blocksById[i.attributes.toolboxParent];if(s){const n=pxt.blocks.compileInfo(s);if(u=e(t,s,n),i.attributes.toolboxParentArgument)!(h=u.querySelector(`value[name=${i.attributes.toolboxParentArgument}]`))&&n.parameters.some((e=>e.definitionName===i.attributes.toolboxParentArgument))&&((h=document.createElement("value")).setAttribute("name",i.attributes.toolboxParentArgument),u.appendChild(h));else if(!(h=u.querySelector("value")))for(const e of n.parameters)if(!u.querySelector(`field[name=${e.definitionName}]`)){(h=document.createElement("value")).setAttribute("name",e.definitionName),u.appendChild(h);break}if(h)for(;h.firstChild;)h.removeChild(h.firstChild);else u=void 0}}let d=document.createElement(u?"shadow":"block");if(d.setAttribute("type",i.attributes.blockId),i.attributes.blockGap?d.setAttribute("gap",i.attributes.blockGap):pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&d.setAttribute("gap",pxt.appTarget.appTheme.defaultBlockGap.toString()),s.thisParameter){const e=s.thisParameter,i=!!(null===(n=t.apis.byQName[e.type])||void 0===n?void 0:n.attributes.fixedInstances);let o=e.shadowBlockId,r=e.defaultValue;i||o||(o="variables_get",r=r||e.definitionName);const a=c(t,e,o,r);a&&d.appendChild(a)}if("ENUM_GET"===i.attributes.shim||"KIND_GET"===i.attributes.shim){if(null===(a=i.parameters)||void 0===a?void 0:a.length){const e=i.parameters[0].default;if(e){const t=document.createElement("field");t.setAttribute("name","MEMBER"),t.textContent=e,d.appendChild(t)}}}else i.parameters&&(s.parameters.filter((e=>r.test(e.type)||r.test(l(e.type))||e.shadowBlockId||e.defaultValue)).forEach((e=>{const i=c(t,e);i&&d.appendChild(i)})),i.attributes.draggableParameters?s.handlerArgs.forEach((e=>{const t="reporter"===i.attributes.draggableParameters,s=document.createElement("value");s.setAttribute("name","HANDLER_DRAG_PARAM_"+e.name);const n=t?pxt.blocks.reporterTypeForArgType(e.type):"variables_get_reporter",r=document.createElement("block");r.setAttribute("type",n);const a=document.createElement("mutation");r.appendChild(a),a.setAttribute(o.DUPLICATE_ON_DRAG_MUTATION_KEY,"true"),t&&"argument_reporter_custom"===n&&a.setAttribute("typename",e.type);const l=document.createElement("field");l.setAttribute("name",t?"VALUE":"VAR"),l.textContent=pxt.Util.htmlEscape(e.name),r.appendChild(l),s.appendChild(r),d.appendChild(s)})):s.handlerArgs.forEach((e=>{const t=document.createElement("field");t.setAttribute("name","HANDLER_"+e.name),t.textContent=e.name,d.appendChild(t)})));return u?(h.appendChild(d),u):d},i.mkPredicateBlock=function(e){const t=document.createElement("block");t.setAttribute("type",e);const i=document.createElement("value");i.setAttribute("name","PREDICATE"),t.appendChild(i);const s=g("logic_boolean","BOOL","TRUE",!0);return i.appendChild(s),t},i.mkFieldBlock=g,i.mkVariableFieldBlock=function(e,t,i,s,n){const o=document.createElement(n?"shadow":"block");o.setAttribute("type",pxt.Util.htmlEscape(e));const r=document.createElement("field");return r.setAttribute("name","VAR"),r.id=t,r.setAttribute("variabletype",pxt.Util.htmlEscape(i)),r.textContent=pxt.Util.htmlEscape(s),o.appendChild(r),o},i.mkReturnStatementBlock=m,i.createFunctionsFlyoutCategory=function(e){const t=(0,n.flyoutCategory)(e);if(t.length>1){let e=m();t.splice(1,0,d(lf("Your Functions"))),t.splice(1,0,e)}const i=(0,n.getAllFunctionDefinitionBlocks)(e).filter((e=>e.getDescendants(!1).some((e=>"function_return"===e.type&&e.getInputTargetBlock("RETURN_VALUE"))))).map((e=>e.getField("function_name").getText())),s=h(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions");t.unshift(s);const o=[];for(const e of t)if(o.push(e),"function_call"===e.getAttribute("type")){const t=e.children.item(0);if(t){const s=t.getAttribute("name");if(i.some((e=>e===s))){const t=e.cloneNode(!0);t.setAttribute("type","function_call_output"),o.push(t)}}}return o}},{"./plugins/duplicateOnDrag":78,"./plugins/functions":93,blockly:197}],121:[function(e,t,i){"use strict";function s(e,t,i,s){return pxt.Util.toArray(e.getElementsByTagName(t)).filter((e=>e.getAttribute(i)===s))}Object.defineProperty(i,"__esModule",{value:!0}),i.cleanOuterHTML=i.getDirectChildren=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=void 0,i.getBlocksWithType=function(e,t){return s(e,"block","type",t).concat(s(e,"shadow","type",t))},i.getChildrenWithAttr=s,i.getFirstChildWithAttr=function(e,t,i,n){const o=s(e,t,i,n);return o.length?o[0]:void 0},i.getDirectChildren=function(e,t){const i=[];for(let s=0;s<e.childNodes.length;s++){const n=e.childNodes.item(s);n.tagName===t&&i.push(n)}return i},i.cleanOuterHTML=function(e){return e.outerHTML.replace(/^<\?[^>]*>/,"")}},{}],122:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Button=void 0;const s=e("react/jsx-runtime"),n=e("../util");i.Button=e=>{const{id:t,className:i,style:o,ariaLabel:r,ariaHidden:a,ariaDescribedBy:l,ariaControls:c,ariaExpanded:u,ariaHasPopup:h,ariaPosInSet:d,ariaSetSize:p,ariaSelected:g,ariaPressed:m,role:f,onClick:_,onKeydown:b,onBlur:T,buttonRef:E,title:y,label:I,leftIcon:k,rightIcon:v,hardDisabled:C,href:S,target:O,tabIndex:A,children:w}=e;let{disabled:R}=e;R=R||C;const N=(0,n.classList)("common-button",i,R&&"disabled");return(0,s.jsxs)("button",Object.assign({id:t,className:N,style:o,title:y,ref:E,onClick:R?void 0:e=>{_&&_(),S&&window.open(S,O||"_blank","noopener,noreferrer"),e.stopPropagation(),e.preventDefault()},onKeyDown:b||n.fireClickOnEnter,onBlur:T,role:f||"button",tabIndex:A||(R?-1:0),disabled:C,"aria-label":r,"aria-hidden":a,"aria-controls":c,"aria-expanded":u,"aria-haspopup":h,"aria-posinset":d,"aria-setsize":p,"aria-describedby":l,"aria-selected":g,"aria-pressed":m},{children:[(k||v||I)&&(0,s.jsxs)("span",Object.assign({className:"common-button-flex"},{children:[k&&(0,s.jsx)("i",{className:k,"aria-hidden":!0}),(0,s.jsx)("span",Object.assign({className:"common-button-label"},{children:I})),v&&(0,s.jsx)("i",{className:"right "+v,"aria-hidden":!0})]})),w]}))}},{"../util":130,"react/jsx-runtime":240}],123:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Checkbox=void 0;const s=e("react/jsx-runtime"),n=e("../util");i.Checkbox=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:r,role:a,isChecked:l,onChange:c,label:u}=e;return(0,s.jsxs)("div",Object.assign({className:(0,n.classList)("common-checkbox",i)},{children:[(0,s.jsx)("input",{id:t,tabIndex:0,type:"checkbox",checked:l,onChange:()=>{c(!l)},onKeyDown:n.fireClickOnEnter,role:a,"aria-hidden":o,"aria-label":r}),u&&(0,s.jsx)("label",Object.assign({htmlFor:t},{children:u}))]}))}},{"../util":130,"react/jsx-runtime":240}],124:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusList");i.Dropdown=e=>{const{id:t,className:i,ariaHidden:l,ariaLabel:c,role:u,items:h,tabIndex:d,selectedId:p,onItemSelected:g}=e,[m,f]=n.useState(!1);let _;const b=(0,o.classList)("common-dropdown",i),T=h.find((e=>e.id===p))||h[0];return(0,s.jsxs)("div",Object.assign({className:b,ref:e=>{e&&(_=e)},onBlur:e=>{_&&m&&!_.contains(e.relatedTarget)&&f(!1)}},{children:[(0,s.jsx)(r.Button,Object.assign({},T,{id:t,tabIndex:d,rightIcon:m?"fas fa-chevron-up":"fas fa-chevron-down",role:u,className:(0,o.classList)("common-dropdown-button",m&&"expanded",T.className),onClick:()=>{f(!m)},onKeydown:e=>{const t=h.indexOf(T);"ArrowDown"===e.key?t<h.length-1&&(g(h[t+1].id),e.preventDefault(),e.stopPropagation()):"ArrowUp"===e.key?t>0&&(g(h[t-1].id),e.preventDefault(),e.stopPropagation()):"Enter"===e.key&&(f(!0),e.preventDefault(),e.stopPropagation())},ariaHasPopup:"listbox",ariaExpanded:m,ariaLabel:c,ariaHidden:l})),m&&(0,s.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:p,"aria-labelledby":t,useUpAndDownArrowKeys:!0,onItemReceivedFocus:e=>{e.id&&h.some((t=>t.id===e.id))&&g(e.id)}},{children:(0,s.jsx)("ul",Object.assign({role:"presentation"},{children:h.map((e=>(0,s.jsx)("li",Object.assign({role:"presentation"},{children:(0,s.jsx)(r.Button,Object.assign({},e,{className:(0,o.classList)("common-dropdown-item",e.className),onClick:()=>{f(!1),g(e.id)},ariaSelected:e.id===p,role:"option"}))}),e.id)))}))}))]}))}},{"../util":130,"./Button":122,"./FocusList":126,react:239,"react/jsx-runtime":240}],125:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EditorToggle=void 0;const s=e("react/jsx-runtime"),n=e("../util"),o=e("./Button"),r=e("./FocusList"),a=e("./MenuDropdown");i.EditorToggle=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:r,role:h,items:d,selected:p}=e,g=d.some((e=>u(e))),m=e=>{};return(0,s.jsxs)("div",Object.assign({className:"common-editor-toggle-outer"},{children:[(0,s.jsx)(c,Object.assign({},e)),(0,s.jsxs)("div",Object.assign({id:t,className:(0,n.classList)("common-editor-toggle",g&&"has-dropdown",i),role:h||"tablist","aria-hidden":!0,"aria-label":r},{children:[d.map(((e,t)=>{const i=p===t;return(0,s.jsxs)("div",Object.assign({className:(0,n.classList)("common-editor-toggle-item",i&&"selected",u(e)&&"common-editor-toggle-item-dropdown")},{children:[(0,s.jsx)(l,{item:e,isSelected:i,onKeydown:m}),u(e)&&(0,s.jsx)(a.MenuDropdown,{id:"toggle-dropdown",className:"toggle-dropdown",icon:"fas fa-chevron-down",title:lf("More options"),tabIndex:-1,ariaHidden:!0,items:e.items.map((e=>({title:e.title,label:e.label,onClick:e.onClick,leftIcon:e.icon})))})]}),t)})),(0,s.jsx)("div",{className:"common-editor-toggle-handle","aria-hidden":!0})]}))]}))};const l=e=>{const{item:t,isSelected:i,onKeydown:n}=e,{label:r,title:a,onClick:l,icon:c,focusable:u}=t;return(0,s.jsx)(o.Button,{className:c?void 0:"no-icon",role:u?"tab":void 0,tabIndex:-1,onKeydown:n,label:r,title:a,onClick:l,leftIcon:c,ariaHidden:!0})},c=e=>{const{items:t,id:i,selected:n,ariaHidden:a}=e,l=t.reduce(((e,t,i)=>{const s=[...e];return s.push(Object.assign({},t)),n===i&&(s[s.length-1].selected=!0),u(t)&&s.push(...t.items.filter((e=>e.focusable))),s}),[]);return(0,s.jsx)(r.FocusList,Object.assign({id:i,role:"tablist",className:"common-toggle-accessibility",childTabStopId:i+"-selected"},{children:l.map(((e,t)=>(0,s.jsx)(o.Button,{className:e.selected?"selected":void 0,id:e.selected?i+"-selected":void 0,role:"tab",title:e.title,label:e.label,onClick:e.onClick,ariaSelected:e.selected,ariaHidden:a},t)))}))};function u(e){var t;return!!(null===(t=e.items)||void 0===t?void 0:t.length)}},{"../util":130,"./Button":122,"./FocusList":126,"./MenuDropdown":129,"react/jsx-runtime":240}],126:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FocusList=void 0;const s=e("react/jsx-runtime");i.FocusList=e=>{const{id:t,className:i,role:n,ariaHidden:o,ariaLabel:r,childTabStopId:a,children:l,onItemReceivedFocus:c,useUpAndDownArrowKeys:u}=e;let h,d;const p=e=>"true"===e.getAttribute("data-isfocusable")&&"none"!==getComputedStyle(e).display,g=()=>h.find((e=>p(e))),m=()=>{for(let e=0;e<h.length;e++)if(p(h[h.length-1-e]))return h[h.length-1-e];return h[0]},f=(e,t)=>{let i;for(let s=1;s<h.length;s++)if(i=t?h[(e+s)%h.length]:h[(e+h.length-s)%h.length],p(i))return i;return h[0]};return(0,s.jsx)("div",Object.assign({id:t,className:i,role:n,tabIndex:a?void 0:0,onKeyDown:e=>{if(!(null==h?void 0:h.length))return;const t=document.activeElement,i=h.indexOf(t),s=e=>{e.focus(),c&&c(e)};-1===i&&t!==d||("Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),t.click?t.click():t.dispatchEvent(new Event("click"))):e.key===(u?"ArrowDown":"ArrowRight")?(i===h.length-1||t===d?s(g()):s(f(i,!0)),e.preventDefault(),e.stopPropagation()):e.key===(u?"ArrowUp":"ArrowLeft")?(s(0===i||t===d?m():f(i,!1)),e.preventDefault(),e.stopPropagation()):"Home"===e.key?(s(g()),e.preventDefault(),e.stopPropagation()):"End"===e.key&&(s(m()),e.preventDefault(),e.stopPropagation()))},ref:e=>{if(!e||d)return;d=e;const t=e.querySelectorAll('[tabindex]:not([tabindex="-1"]),[data-isfocusable]');h=[];for(const e of t.values())h.push(e),e.setAttribute("tabindex","-1"),e.setAttribute("data-isfocusable","true");if(a){const e=d.querySelector("#"+a);e&&e.setAttribute("tabindex","0")}},"aria-hidden":o,"aria-label":r},{children:l}))}},{"react/jsx-runtime":240}],127:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FocusTrap=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../util");i.FocusTrap=e=>{const{children:t,id:i,className:r,onEscape:a,arrowKeyNavigation:l,dontStealFocus:c,includeOutsideTabOrder:u}=e;let h;const[d,p]=n.useState(!1),g=()=>(0,o.nodeListToArray)(u?h.querySelectorAll("[tabindex]"):h.querySelectorAll('[tabindex]:not([tabindex="-1"])'));return(0,s.jsx)("div",Object.assign({id:i,className:(0,o.classList)("common-focus-trap",r),ref:e=>{e&&(h=e,c||d||e.contains(document.activeElement)||!g().length||(h.focus(),p(!0)))},onKeyDown:e=>{if(!h)return;const t=(t,i)=>{const s=g();if(!s.length)return;const n=s.indexOf(e.target);t?i?s[s.length-1].focus():n===s.length-1?s[0].focus():s[n+1].focus():i?s[0].focus():0===n?s[s.length-1].focus():s[Math.max(n-1,0)].focus(),e.preventDefault(),e.stopPropagation()};"Escape"===e.key?(a(),e.preventDefault(),e.stopPropagation()):"Tab"===e.key?e.shiftKey?t(!1,!1):t(!0,!1):l&&("ArrowDown"===e.key?t(!0,!1):"ArrowUp"===e.key?t(!1,!1):"Home"===e.key?t(!1,!0):"End"===e.key&&t(!0,!0))},tabIndex:-1},{children:t}))}},{"../util":130,react:239,"react/jsx-runtime":240}],128:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Input=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusList");i.Input=e=>{var t;const{id:i,className:l,inputClassName:c,groupClassName:u,role:h,ariaHidden:d,ariaLabel:p,initialValue:g,label:m,title:f,placeholder:_,icon:b,iconTitle:T,disabled:E,type:y,readOnly:I,autoComplete:k,selectOnClick:v,onChange:C,onEnterKey:S,onIconClick:O,onBlur:A,onOptionSelected:w,handleInputRef:R,preserveValueOnBlur:N,options:x}=e,[L,$]=n.useState(void 0),[D,M]=n.useState(!1);let B;const P=e=>e&&-1!=Object.values(x).indexOf(e)?`dropdown-item-${e}`:void 0;return(0,s.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-wrapper",E&&"disabled",l),onBlur:e=>{D&&!B.contains(e.relatedTarget)&&M(!1)},ref:e=>{e&&(B=e)}},{children:[m&&(0,s.jsx)("label",Object.assign({className:"common-input-label",htmlFor:i},{children:m})),(0,s.jsxs)("div",Object.assign({className:(0,o.classList)("common-input-group",u)},{children:[(0,s.jsx)("input",{id:i,className:(0,o.classList)("common-input",b&&"has-icon",c),title:f,role:h||"textbox",tabIndex:E?-1:0,"aria-label":p,"aria-hidden":d,type:y||"text",placeholder:_,value:void 0!==L?L:g||"",readOnly:!!I,onClick:e=>{v&&e.target.select(),x&&!D&&M(!0)},onChange:e=>{const t=e.target.value;I||L===t||$(t),C&&C(t)},onKeyDown:t=>{var i,s;const n="number"==typeof t.which?t.which:t.keyCode;if(13===n||e.treatSpaceAsEnter&&32===n)S&&(t.preventDefault(),S(L));else if(x&&D&&"ArrowDown"===t.key)null===(i=document.getElementById(P(Object.values(x)[0])))||void 0===i||i.focus(),t.preventDefault(),t.stopPropagation();else if(x&&D&&"ArrowUp"===t.key){const e=Object.values(x);null===(s=document.getElementById(P(e[e.length-1])))||void 0===s||s.focus(),t.preventDefault(),t.stopPropagation()}},onBlur:()=>{A&&A(L),N||$(void 0)},autoComplete:k?"":"off",autoCorrect:k?"":"off",autoCapitalize:k?"":"off",spellCheck:k,disabled:E,ref:R}),b&&(O?(0,s.jsx)(r.Button,{leftIcon:b,title:T,disabled:E,onClick:()=>{O&&O(L)}}):(0,s.jsx)("i",{className:b,"aria-hidden":!0})),x&&(0,s.jsx)(r.Button,{leftIcon:D?"fas fa-chevron-up":"fas fa-chevron-down",title:T,disabled:E,ariaHasPopup:"listbox",ariaExpanded:D,ariaLabel:p,onClick:()=>{x&&M(!D)}})]})),D&&(0,s.jsx)(a.FocusList,Object.assign({role:"listbox",className:"common-menu-dropdown-pane common-dropdown-shadow",childTabStopId:null!==(t=P(L))&&void 0!==t?t:P(Object.values(x)[0]),"aria-labelledby":i,useUpAndDownArrowKeys:!0},{children:(0,s.jsx)("ul",Object.assign({role:"presentation"},{children:Object.keys(x).map((e=>(0,s.jsx)("li",Object.assign({role:"presentation"},{children:(0,s.jsx)(r.Button,{title:e,label:e,id:P(x[e]),className:(0,o.classList)("common-dropdown-item"),onClick:()=>(e=>{var t;M(!1);const s=x[e];$(s),w&&w(s),null===(t=document.getElementById(i))||void 0===t||t.focus()})(e),ariaSelected:P(x[e])===P(null!=L?L:g),role:"option"})}),e)))}))}))]}))}},{"../util":130,"./Button":122,"./FocusList":126,react:239,"react/jsx-runtime":240}],129:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MenuDropdown=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../util"),r=e("./Button"),a=e("./FocusTrap");i.MenuDropdown=e=>{const{id:t,className:i,ariaHidden:l,ariaLabel:c,role:u,items:h,label:d,title:p,icon:g,tabIndex:m,disabled:f}=e,[_,b]=n.useState(!1);let T,E;const y=(0,o.classList)("common-menu-dropdown",i),I=t+"-menu";return(0,s.jsxs)("div",Object.assign({className:y,ref:e=>{e&&(T=e)},onBlur:e=>{T&&_&&!T.contains(e.relatedTarget)&&b(!1)}},{children:[(0,s.jsx)(r.Button,{id:t,label:d,tabIndex:m,buttonRef:e=>{e&&(E=e)},title:p,leftIcon:g,role:u||"menuitem",className:(0,o.classList)("menu-button",_&&"expanded"),onClick:()=>{b(!_)},ariaHasPopup:"true",ariaExpanded:_,ariaControls:_?I:void 0,ariaLabel:c,ariaHidden:l,disabled:f}),_&&(0,s.jsx)("div",Object.assign({role:"menu",className:"common-menu-dropdown-pane",tabIndex:0,id:I,"aria-labelledby":t},{children:(0,s.jsx)(a.FocusTrap,Object.assign({arrowKeyNavigation:!0,onEscape:()=>{b(!1),E&&E.focus()}},{children:(0,s.jsx)("ul",Object.assign({role:"presentation"},{children:h.map(((e,t)=>(0,s.jsx)("li",Object.assign({role:"presentation"},{children:(0,s.jsx)(r.Button,Object.assign({},e,{className:(0,o.classList)("common-menu-dropdown-item",e.className),onClick:()=>{b(!1),e.onClick()},role:"menuitem",ariaPosInSet:t+1,ariaSetSize:h.length}))}),t)))}))}))}))]}))}},{"../util":130,"./Button":122,"./FocusTrap":127,react:239,"react/jsx-runtime":240}],130:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.screenToSVGCoord=i.clientCoord=i.CheckboxStatus=i.nodeListToArray=i.classList=i.fireClickOnEnter=i.jsxLF=void 0;const s=e("react/jsx-runtime");var n;i.jsxLF=function(e,...t){const i=[];e.replace(/\{\d\}/g,(e=>(i.push(parseInt(e.substr(1,1))),e)));const n=[];let o,r=0;for(const a of i)o=e.split(`{${a}}`),pxt.U.assert(2===o.length),n.push((0,s.jsx)("span",{children:o[0]},r++)),n.push((0,s.jsx)("span",{children:t[a]},r++)),e=o[1];return n.push((0,s.jsx)("span",{children:e},r++)),n},i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())},i.classList=function(...e){return e.filter((e=>"string"==typeof e)).reduce(((e,t)=>e.concat(t.split(" "))),[]).map((e=>e.trim())).filter((e=>!!e)).join(" ")},i.nodeListToArray=function(e){const t=[];for(const i of e)t.push(i);return t},(n=i.CheckboxStatus||(i.CheckboxStatus={}))[n.Selected=0]="Selected",n[n.Unselected=1]="Unselected",n[n.Waiting=2]="Waiting",i.clientCoord=function(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e},i.screenToSVGCoord=function(e,t){const i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i.matrixTransform(e.getScreenCTM().inverse())}},{"react/jsx-runtime":240}],131:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetEditor=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-dom"),r=e("./components/ImageFieldEditor"),a=e("./components/ImageEditor/store/imageReducer");document.addEventListener("DOMContentLoaded",(()=>{!function(){const e=document.getElementById("asset-editor-field-div");o.render((0,s.jsx)(l,{}),e)}()}));class l extends n.Component{constructor(e){super(e),this.handleMessage=e=>{const t=e.data;switch(t.type){case"create":this.setPalette(t.palette),this.initTilemapProject(t.files);const e=this.getEmptyAsset(t.assetType,t.displayName);this.setState({editing:e,isEmptyAsset:!0}),this.sendResponse({id:t.id,type:t.type});break;case"open":this.setPalette(t.palette),this.initTilemapProject(t.files);const i=this.lookupAsset(t.assetType,t.assetId);"tilemap"===i.type&&pxt.sprite.addMissingTilemapTilesAndReferences(this.editorProject,i),this.setState({editing:i}),this.sendResponse({id:t.id,type:t.type});break;case"duplicate":this.setPalette(t.palette),this.initTilemapProject(t.files);const s=this.lookupAsset(t.assetType,t.assetId);this.setState({editing:this.editorProject.duplicateAsset(s)}),this.sendResponse({id:t.id,type:t.type});break;case"save":this.sendResponse({id:t.id,type:t.type,files:this.saveProjectFiles()})}},this.refHandler=e=>{e&&(this.editor=e,this.editor.init(this.state.editing,(()=>{}),{galleryTiles:this.galleryTiles,hideMyAssets:!0,hideCloseButton:!0}))},this.handleKeydown=e=>{!e.ctrlKey||"s"!==e.key&&"S"!==e.key||this.sendSaveRequest()},this.pollForUpdates=()=>{this.state.editing&&this.updateAsset()},this.sendSaveRequest=()=>{this.sendEvent({type:"event",kind:"done-clicked"})},this.state={},pxt.react.getTilemapProject=()=>this.editorProject,(0,a.setTelemetryFunction)(c)}componentDidMount(){window.addEventListener("message",this.handleMessage,null),window.addEventListener("keydown",this.handleKeydown,null),this.sendEvent({type:"event",kind:"ready"}),c("asset-editor-shown"),this.pollingInterval=setInterval(this.pollForUpdates,200)}componentWillUnmount(){window.removeEventListener("message",this.handleMessage,null),window.removeEventListener("keydown",this.handleKeydown,null),window.clearInterval(this.pollingInterval)}componentDidUpdate(e,t,i){var s;(null==t?void 0:t.editing)&&t.editing!==this.state.editing&&this.saveProject.removeChangeListener(t.editing.type,this.sendSaveRequest),(null===(s=this.state)||void 0===s?void 0:s.editing)&&this.saveProject.addChangeListener(this.state.editing,this.sendSaveRequest)}render(){return this.state.editing?(0,s.jsx)(r.ImageFieldEditor,{ref:this.refHandler,singleFrame:"animation"!==this.state.editing.type,isMusicEditor:"song"===this.state.editing.type,doneButtonCallback:this.sendSaveRequest,hideDoneButton:!0,includeSpecialTagsInFilter:!0}):(0,s.jsx)("div",{})}sendResponse(e){this.postMessage(e)}sendEvent(e){this.postMessage(e)}postMessage(e){window.acquireVsCodeApi?window.acquireVsCodeApi().postMessage(e):window.parent.postMessage(e,"*")}updateAsset(){var e,t,i,s,n;const o=this.editor.getValue(),r=pxt.cloneAsset(o);if(!this.lastValue||!pxt.assetEquals(this.lastValue,r)){if(this.lastValue=pxt.cloneAsset(o),"tilemap"===r.type&&o.type===r.type&&(r.data.deletedTiles=null===(e=o.data.deletedTiles)||void 0===e?void 0:e.slice(),r.data.editedTiles=null===(t=o.data.editedTiles)||void 0===t?void 0:t.slice(),r.data.projectReferences=null===(i=o.data.projectReferences)||void 0===i?void 0:i.slice(),r.data.tileOrder=null===(s=o.data.tileOrder)||void 0===s?void 0:s.slice()),this.saveProject=this.editorProject.clone(),this.state.isEmptyAsset){const e=null===(n=r.meta)||void 0===n?void 0:n.displayName;let t;switch(r.type){case"image":t=this.saveProject.createNewProjectImage(r.bitmap,e);break;case"tile":t=this.saveProject.createNewTile(r.bitmap,null,e);break;case"tilemap":pxt.sprite.updateTilemapReferencesFromResult(this.saveProject,r);const[i,s]=this.saveProject.createNewTilemapFromData(r.data,e);t=this.saveProject.lookupAssetByName("tilemap",i);break;case"animation":t=this.saveProject.createNewAnimationFromData(r.frames,r.interval,e);break;case"song":t=this.saveProject.createNewSong(r.song,e)}}else"tilemap"===r.type&&pxt.sprite.updateTilemapReferencesFromResult(this.saveProject,r),this.saveProject.updateAsset(r);this.sendSaveRequest()}}saveProjectFiles(){this.updateAsset();const e=pxt.inflateJRes(this.saveProject.getProjectAssetsJRes()),t=pxt.inflateJRes(this.saveProject.getProjectTilesetJRes()),i={};for(const t of Object.keys(e)){const s=this.locateFileForAsset(t)||pxt.IMAGES_JRES;i[s]||(i[s]={}),i[s][t]=e[t]}for(const e of Object.keys(t)){const s=this.locateFileForAsset(e)||pxt.TILEMAP_JRES;i[s]||(i[s]={}),i[s][e]=t[e]}const s=Object.assign({},this.files);for(const e of Object.keys(i)){s[e]=JSON.stringify(i[e],null,4);const t=e.substring(0,e.length-"jres".length)+"ts";(s[t]||e===pxt.IMAGES_JRES||e===pxt.TILEMAP_JRES)&&(s[t]=pxt.emitProjectImages(i[e])+"\n"+pxt.emitTilemapsFromJRes(i[e]))}return s}setPalette(e){e&&Array.isArray(e)&&e.length&&(pxt.appTarget.runtime.palette=e.slice())}initTilemapProject(e){var t;const i={},s={},n={},o={};this.editorProject=new pxt.TilemapProject,this.inflatedJres={},this.commentAttrs={};for(const t of Object.keys(e).filter((e=>!e.endsWith(".jres")))){const i=u(e[t]);for(const e of Object.keys(i))this.commentAttrs[e]=i[e]}for(const r of Object.keys(e).filter((e=>e.endsWith(".jres")))){const a=-1!==r.indexOf("pxt_modules")||-1!==r.indexOf("node_modules"),l=pxt.inflateJRes(JSON.parse(e[r]));this.inflatedJres[r]=l;for(const e of Object.keys(l)){if(null===(t=this.commentAttrs[e])||void 0===t?void 0:t.tags){const t=this.commentAttrs[e].tags.split(" ").filter((e=>!!e));t.length&&(l[e].tags=t)}l[e].mimeType===pxt.TILEMAP_MIME_TYPE||l[e].tilemapTile?a?s[e]=l[e]:i[e]=l[e]:a?o[e]=l[e]:n[e]=l[e]}}this.editorProject.loadAssetsJRes(o,!0),this.editorProject.loadAssetsJRes(n),this.editorProject.loadTilemapJRes(s,!1,!0),this.editorProject.loadTilemapJRes(i),this.galleryTiles=this.editorProject.getGalleryAssets("tile").map((e=>{var t;if(!this.commentAttrs[e.id])return;const i=null===(t=e.meta.tags)||void 0===t?void 0:t.map((e=>pxt.Util.startsWith(e,"category-")?e:e.toLowerCase()));return i&&-1!==i.indexOf("tile")?{qName:e.id,bitmap:e.bitmap,alt:e.id,tags:i}:void 0})).filter((e=>!!e)),this.saveProject=this.editorProject.clone()}locateFileForAsset(e){for(const t of Object.keys(this.inflatedJres))if(this.inflatedJres[t][e])return t}getEmptyAsset(e,t){const i=pxt.react.getTilemapProject(),s=t||pxt.getDefaultAssetDisplayName(e);let n=s,o=0;for(;i.isNameTaken(e,n);)n=s+o++;const r={type:e,id:"",internalID:0,meta:{displayName:n}};switch(e){case"image":case"tile":r.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":const e=r;e.data=i.blankTilemap(16,16,16),pxt.sprite.addMissingTilemapTilesAndReferences(i,e);break;case"animation":const t=r;t.frames=[new pxt.sprite.Bitmap(16,16).data()],t.interval=200;break;case"song":r.song=pxt.assets.music.getEmptySong(2)}return r}lookupAsset(e,t){const i=this.saveProject.lookupAsset(e,t);if(i)return i;const s=t.split(".");return this.saveProject.lookupAsset(e,s[s.length-1])}}function c(e){pxt.tickEvent("asset.editor",{action:e})}function u(e){const t=e.split("\n"),i={};let s,n="";for(const e of t){const t=/^namespace\s+([^\}]+)\s+\{$/.exec(e);if(t){s=t[1],n="";continue}if(/^\s+\/\/%\s/.test(e)){n+=e+"\n";continue}const o=/^\s*export\s+const\s+([^\s]+)\s*=/.exec(e);o&&(i[s+"."+o[1]]=pxtc.parseCommentString(n),n="")}return i}i.AssetEditor=l},{"./components/ImageEditor/store/imageReducer":151,"./components/ImageFieldEditor":157,react:239,"react-dom":207,"react/jsx-runtime":240}],132:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.assetToGalleryItem=i.getAssets=i.getNewInternalID=i.lookupAsset=i.createTile=i.createProjectImage=i.createNewImageAsset=i.isNameTaken=void 0;const s=e("../../pxtblocks");function n(e,t=new pxt.ImageConverter){var i;switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":let n=e.data.tilemap;return e.previewURI=s.tilemapToImageURI(e.data,Math.max(n.width,n.height),!1),e;case"animation":return(null===(i=e.frames)||void 0===i?void 0:i.length)<=0?null:(e.framePreviewURIs=e.frames.map((e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e)))),e.previewURI=e.framePreviewURIs[0],e);case"song":return e.previewURI=s.songToDataURI(e.song,32,32,!1,1),e}}function o(e){return function(t,i){const s=-1===e.indexOf(t.meta.package)?0:1,n=-1===e.indexOf(i.meta.package)?0:1;return s===n?function(e,t){return e.internalID-t.internalID}(t,i):s-n}}i.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},i.createNewImageAsset=function(e,t,i,s){const n=pxt.react.getTilemapProject();switch(e){case"tile":return n.createNewTile(new pxt.sprite.Bitmap(t,i).data(),null,s);case"image":return n.createNewImage(t,i)}return null},i.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},i.createTile=function(e,t,i){return pxt.react.getTilemapProject().createNewTile(e,t,i)},i.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},i.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()},i.getAssets=function(e=!1,t="image",i=[]){const s=pxt.react.getTilemapProject(),r=new pxt.ImageConverter,a=e=>n(e,r),l=e?s.getGalleryAssets.bind(s):s.getAssets.bind(s),c=function(){var e;const t=null===(e=pxt.appTarget.blocksprj)||void 0===e?void 0:e.config;if(t)return Object.keys(t.dependencies);return[]}(),u=l("image").map(a).sort(o(c)),h=l("tile").map(a).filter((e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi))).sort(o(c)),d=l("tilemap").map(a).sort(o(c)),p=l("animation").map(a).sort(o(c)),g=l("song").map(a).sort(o(c));for(const e of i)switch(e.type){case"image":u.push(a(e));break;case"tile":h.push(a(e));break;case"animation":p.push(a(e));break;case"tilemap":d.push(a(e));break;case"song":g.push(a(e))}let m=[];switch(t){case"image":m=u.concat(h).concat(p).concat(d).concat(g);break;case"tile":m=h.concat(u).concat(p).concat(d).concat(g);break;case"animation":m=p.concat(u).concat(h).concat(d).concat(g);break;case"tilemap":m=d.concat(h).concat(u).concat(p).concat(g);break;case"song":m=g.concat(u).concat(h).concat(p).concat(d)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:m.length}),m},i.assetToGalleryItem=n},{"../../pxtblocks":68}],133:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FilterPanel=i.FilterPanelSubheading=i.FilterTag=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../util");class r extends n.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return(0,s.jsxs)("div",Object.assign({className:"filter-tag"},{children:[(0,s.jsx)("div",Object.assign({className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter,"aria-checked":this.props.selected},{children:(0,s.jsx)("i",{className:"icon square outline "+(this.props.selected?"check":"")})})),(0,s.jsx)("div",Object.assign({className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:o.fireClickOnEnter},{children:pxtc.U.rlf(this.props.tag)}))]}))}clickHandler(){this.props.onClickHandler(this.props.tag)}}i.FilterTag=r;class a extends n.Component{render(){return(0,s.jsxs)("div",Object.assign({className:"filter-subheading-row"},{children:[(0,s.jsx)("div",Object.assign({className:"filter-subheading-title"},{children:`${this.props.subheading}:`})),this.props.buttonText&&(0,s.jsx)("div",Object.assign({className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:o.fireClickOnEnter},{children:this.props.buttonText}))]}))}}i.FilterPanelSubheading=a;class l extends n.Component{isTagSelected(e){return this.props.enabledTags.indexOf(e.toLowerCase())>=0}render(){const e=this.props.tagOptions;return(0,s.jsxs)("div",Object.assign({className:"filter-panel"},{children:[(0,s.jsx)("div",Object.assign({className:"filter-title"},{children:lf("Filter")})),(0,s.jsx)(a,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:this.props.enabledTags.length>0?{color:"white"}:{}}),(0,s.jsx)("div",Object.assign({className:"filter-tag-list"},{children:e.map((e=>(0,s.jsx)(r,{tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler},e)))}))]}))}}i.FilterPanel=l},{"../util":180,react:239,"react/jsx-runtime":240}],134:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Alert=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./actions/dispatch");class a extends n.Component{constructor(e){super(e)}render(){const{title:e,text:t,options:i,dispatchHideAlert:n}=this.props;return(0,s.jsx)("div",Object.assign({className:"image-editor-alert-container",role:"region",onClick:n},{children:(0,s.jsxs)("div",Object.assign({className:"image-editor-alert",role:"dialog"},{children:[(0,s.jsxs)("div",Object.assign({className:"title"},{children:[(0,s.jsx)("span",{className:"ms-Icon ms-Icon--Warning"}),(0,s.jsx)("span",{children:e}),(0,s.jsx)("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:n})]})),(0,s.jsx)("div",Object.assign({className:"text"},{children:t})),i&&(0,s.jsx)("div",Object.assign({className:"options"},{children:i.map(((e,t)=>(0,s.jsx)("div",Object.assign({className:"button",role:"button",onClick:e.onClick},{children:e.label}),t)))}))]}))}))}}const l={dispatchHideAlert:r.dispatchHideAlert};i.Alert=(0,o.connect)((function({editor:e},t){return e?t:{}}),l)(a)},{"./actions/dispatch":147,react:239,"react-redux":225,"react/jsx-runtime":240}],135:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BottomBar=i.BottomBarImpl=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./Button"),l=e("./util"),c=e("../../assets"),u=e("./keyboardShortcuts"),h=e("../../../../react-common/components/util");class d extends n.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:s,imageDimensions:n}=this.props;!isNaN(i)&&s?this.setState({width:i+"",height:Math.floor(i*(n[1]/n[0]))+""}):this.setState({width:t})},this.handleHeightChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:s,imageDimensions:n}=this.props;!isNaN(i)&&s?this.setState({height:i+"",width:Math.floor(i*(n[0]/n[1]))+""}):this.setState({height:t})},this.handleDimensionalBlur=()=>{const{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:i}=this.props,s=parseInt(this.state.width),n=parseInt(this.state.height),o=t?255:512,r=isNaN(s)?e[0]:Math.min(Math.max(s,1),o),a=isNaN(n)?e[1]:Math.min(Math.max(n,1),o);r===e[0]&&a===e[1]||i([r,a]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;const i=e.target.value||"",s=i.trim();pxt.validateAssetName(s)?(0,c.isNameTaken)(s)&&s!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:i,assetNameMessage:t})},this.handleAssetNameBlur=()=>{const{dispatchChangeAssetName:e,assetName:t}=this.props;if(this.state.assetName){let i=this.state.assetName.trim();i!==t&&pxt.validateAssetName(i)&&!(0,c.isNameTaken)(i)&&e(i)}this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){const{imageDimensions:e,cursorLocation:t,hasUndo:i,hasRedo:n,dispatchUndoImageEdit:o,dispatchRedoImageEdit:r,aspectRatioLocked:c,onionSkinEnabled:u,dispatchToggleAspectRatioLocked:d,dispatchToggleOnionSkinEnabled:p,resizeDisabled:g,singleFrame:m,onDoneClick:f,assetName:_,hideDoneButton:b,hideAssetName:T}=this.props,{assetNameMessage:E}=this.state,y=null==this.state.width?e[0]:this.state.width,I=null==this.state.height?e[1]:this.state.height,k=null==this.state.assetName?_||"":this.state.assetName;return(0,s.jsxs)("div",Object.assign({className:"image-editor-bottombar"},{children:[!g&&(0,s.jsxs)("div",Object.assign({className:"image-editor-resize"},{children:[(0,s.jsx)("input",{className:"image-editor-input",title:lf("Image Width"),value:y,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),(0,s.jsx)(a.IconButton,{onClick:d,iconClass:c?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:c?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!c,noTab:!0}),(0,s.jsx)("input",{className:"image-editor-input",title:lf("Image Height"),value:I,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})]})),!m&&(0,s.jsx)("div",{className:"image-editor-seperator"}),!m&&(0,s.jsx)("div",{children:(0,s.jsx)(a.IconButton,{onClick:p,iconClass:"ms-Icon ms-Icon--MapLayers",title:u?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!u})}),!g&&(0,s.jsx)("div",{className:(0,h.classList)("image-editor-seperator",!t&&"transparent")}),(0,s.jsx)("div",Object.assign({className:"image-editor-coordinate-preview"},{children:t&&`${t[0]}, ${t[1]}`})),(0,s.jsx)("div",Object.assign({className:"image-editor-change-name"},{children:!T&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{className:"image-editor-input",title:lf("Asset Name"),value:k,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),E&&(0,s.jsx)("div",Object.assign({className:"ui pointing below red basic label"},{children:E}))]})})),(0,s.jsxs)("div",Object.assign({className:"image-editor-undo-redo"},{children:[(0,s.jsx)(a.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:i?o:null,disabled:!i}),(0,s.jsx)(a.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:n?r:null,disabled:!n})]})),(0,s.jsx)("div",{className:"image-editor-seperator"}),(0,s.jsxs)("div",Object.assign({className:"image-editor-zoom-controls"},{children:[(0,s.jsx)(a.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),(0,s.jsx)(a.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})]})),!b&&(0,s.jsx)("div",Object.assign({role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:f,onKeyDown:l.fireClickOnlyOnEnter},{children:lf("Done")}))]}))}setShortcutsEnabled(e){e&&this.shortcutLock?((0,u.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,u.obtainShortcutLock)())}}i.BottomBarImpl=d;const p={dispatchChangeImageDimensions:r.dispatchChangeImageDimensions,dispatchUndoImageEdit:r.dispatchUndoImageEdit,dispatchRedoImageEdit:r.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:r.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:r.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:r.dispatchChangeZoom,dispatchChangeAssetName:r.dispatchChangeAssetName};i.BottomBar=(0,o.connect)((function({store:{present:e,past:t,future:i},editor:s},n){var o,r,a;if(!e)return{};const l=s.isTilemap?e.tilemap.bitmap:e.frames[e.currentFrame].bitmap;return{imageDimensions:[l.width,l.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:s.onionSkinEnabled,cursorLocation:s.cursorLocation,resizeDisabled:"tile"===(null===(o=e.asset)||void 0===o?void 0:o.type),assetName:null===(a=null===(r=e.asset)||void 0===r?void 0:r.meta)||void 0===a?void 0:a.displayName,hasUndo:!!t.length,hasRedo:!!i.length,isTilemap:s.isTilemap}}),p)(d)},{"../../../../react-common/components/util":130,"../../assets":132,"./Button":136,"./actions/dispatch":147,"./keyboardShortcuts":149,"./util":156,react:239,"react-redux":225,"react/jsx-runtime":240}],136:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IconButton=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./util");class r extends n.Component{render(){const{title:e,iconClass:t,onClick:i,toggle:n,disabled:r,noTab:a}=this.props;return(0,s.jsx)("div",Object.assign({role:"button",className:`image-editor-button ${n?"toggle":""} ${r?"disabled":""}`,title:e,tabIndex:a||r?-1:0,onClick:i,onKeyDown:o.fireClickOnlyOnEnter},{children:(0,s.jsx)("span",{className:t})}))}}i.IconButton=r},{"./util":156,react:239,"react/jsx-runtime":240}],137:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CursorSizes=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./actions/dispatch"),r=e("react-redux");class a extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selected:e}=this.props;return(0,s.jsxs)("div",Object.assign({className:"cursor-buttons"},{children:[(0,s.jsx)("div",Object.assign({className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},{children:(0,s.jsx)("div",{className:"cursor-button small"})})),(0,s.jsx)("div",Object.assign({className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},{children:(0,s.jsx)("div",{className:"cursor-button medium"})})),(0,s.jsx)("div",Object.assign({className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},{children:(0,s.jsx)("div",{className:"cursor-button large"})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{dispatchChangeCursorSize:t}=this.props;t(e)}),this.handlers[e]}}const l={dispatchChangeCursorSize:o.dispatchChangeCursorSize};i.CursorSizes=(0,r.connect)((function({editor:e},t){return e?{selected:e.cursorSize}:{}}),l)(a)},{"./actions/dispatch":147,react:239,"react-redux":225,"react/jsx-runtime":240}],138:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const s=e("react/jsx-runtime"),n=e("react");class o extends n.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,{open:i}=this.state,n=e[t];return(0,s.jsxs)("div",Object.assign({className:"image-editor-dropdown-outer"},{children:[(0,s.jsxs)("button",Object.assign({className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},{children:[(null==n?void 0:n.text)||"",(0,s.jsx)("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})]})),(0,s.jsx)("ul",Object.assign({tabIndex:-1,role:"listbox","aria-activedescendant":null==n?void 0:n.id,className:i&&e.length?"":"hidden"},{children:e.map(((e,i)=>(0,s.jsx)("li",Object.assign({role:"option","aria-selected":i===t,className:i===t?"selected":"",onClick:this.clickHandler(i)},{children:e.text}),e.id)))}))]}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Dropdown=o},{react:239,"react/jsx-runtime":240}],139:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageCanvas=i.ImageCanvasImpl=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./store/imageReducer"),a=e("./actions/dispatch"),l=e("./util"),c=e("./toolDefinitions"),u=e("../../assets"),h=e("./keyboardShortcuts"),d=e("./ImageEditor"),p=[r.TileDrawingMode.Wall];class g extends n.Component{constructor(){super(...arguments),this.cursor=c.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache={},this.onKeyDown=e=>{var t,i,s,n,o,a;if((0,h.areShortcutsEnabled)()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image)){let t=!1;switch(e.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),t=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),t=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),t=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),t=!0}t&&(this.props.dispatchImageEdit(this.editState.toImageState()),e.preventDefault())}if(!e.repeat){switch(!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"v"!==e.key||e.stopPropagation(),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),e.preventDefault()),"Escape"==e.key&&(null===(n=null===(s=this.editState)||void 0===s?void 0:s.floating)||void 0===n?void 0:n.image)&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),e.preventDefault()),("Backspace"===e.key||"Delete"===e.key)&&(null===(a=null===(o=this.editState)||void 0===o?void 0:o.floating)||void 0===a?void 0:a.image)&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),e.preventDefault()),this.lastTool=this.props.tool,e.keyCode){case 18:this.props.dispatchChangeImageTool(r.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:this.props.dispatchChangeImageTool(r.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t,i;if(this.props.tool===r.ImageEditorTool.Marquee&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image))if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify((0,l.createTilemapPatchFromFloatingLayer)(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=e=>{if(this.props.isTilemap){const t=e.clipboardData.getData("application/makecode-tilemap");let i;try{i=JSON.parse(t)}catch(e){}if(!(i&&i.map&&i.layers&&i.tiles))return;return e.preventDefault(),void this.applyTilemapPatch(i)}let t=e.clipboardData.getData("application/makecode-image");if(!t){const i=e.clipboardData.getData("text/plain"),s=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(i);s&&(t=s[0])}const i=t&&pxt.sprite.imageLiteralToBitmap(t);i&&i.width&&i.height&&(e.preventDefault(),this.props.tool!==r.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(r.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.setFloatingLayer(i),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){const e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width,i=!this.props.isTilemap&&this.props.tool==r.ImageEditorTool.Marquee;return(0,s.jsx)("div",Object.assign({ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu,tabIndex:0},{children:(0,s.jsxs)("div",Object.assign({className:"paint-container"},{children:[!this.props.lightMode&&(0,s.jsx)("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),(0,s.jsx)("canvas",{ref:"paint-surface",className:"paint-surface main"}),p.map(((e,t)=>(0,s.jsx)("canvas",{ref:`paint-surface-${e.toString()}`,className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide")},t))),(0,s.jsx)("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"}),i&&(0,s.jsx)("div",{ref:"floating-layer-nw-corner",className:"image-editor-floating-layer-corner"}),i&&(0,s.jsx)("div",{ref:"floating-layer-ne-corner",className:"image-editor-floating-layer-corner"}),i&&(0,s.jsx)("div",{ref:"floating-layer-se-corner",className:"image-editor-floating-layer-corner"}),i&&(0,s.jsx)("div",{ref:"floating-layer-sw-corner",className:"image-editor-floating-layer-corner"})]}))}))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.tileCache={},this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=p.map((e=>this.refs[`paint-surface-${e.toString()}`])),(0,l.bindGestureEvents)(this.refs["canvas-bounds"],this);const e=this.refs["canvas-bounds"];e.addEventListener("wheel",(e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()})),e.addEventListener("mousemove",(e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)})),e.addEventListener("mouseout",(e=>{this.edit||this.updateCursorLocation(null)})),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste);const t=this.getImageState();this.editState=(0,c.getEditState)(t,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){if(!this.edit||!this.editState){const e=this.getImageState();this.editState=(0,c.getEditState)(e,this.props.isTilemap,this.props.drawingMode)}if(this.props.isTilemap||(this.tileCache={}),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()}componentWillUnmount(){this.tileCache={},document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){var i,s;this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement!==this.refs["canvas-bounds"]&&document.activeElement.blur(),this.refs["canvas-bounds"].focus(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):(null===(s=null===(i=this.editState)||void 0===i?void 0:i.floating)||void 0===s?void 0:s.image)&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}}onDragEnd(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else if(this.isResizing){if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit(!1),this.updateCursor(!1,!1)}else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}this.isResizing=!1}updateCursorLocation(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){const t=this.canvas.getBoundingClientRect(),i=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),s=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&i===this.cursorLocation[0]&&s===this.cursorLocation[1]||(this.cursorLocation=[i,s,e.clientX,e.clientY],this.hasHover&&this.props.dispatchChangeCursorLocation(this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(i,s)),0))}return this.cursorLocation=[0,0,e.clientX,e.clientY],!1}updateCursor(e,t){const{tool:i}=this.props,s=c.tools.find((e=>e.tool===i));s?t?e?this.updateCursorCore(s.downLayerCursor||s.hoverLayerCursor||s.downCursor||s.hoverCursor):this.updateCursorCore(s.hoverLayerCursor||s.hoverCursor):e?this.updateCursorCore(s.downCursor||s.hoverCursor):this.updateCursorCore(s.hoverCursor):this.updateCursorCore(c.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||c.ToolCursor.Default,this.updateBackground()}startEdit(e){const{tool:t,toolWidth:i,selectedColor:s,backgroundColor:n,drawingMode:o}=this.props,[a,l]=this.cursorLocation;if(this.inBounds(a,l)||this.isResizing){let a=o==r.TileDrawingMode.Wall?2:e?n:s;this.edit=(0,c.getEdit)(t,this.editState,a,i),this.edit.originalImage=this.originalImage,this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.cursorLocation[2],this.cursorLocation[3],this.editState)}}updateEdit(e,t){this.edit&&(this.edit.inBounds(e,t)||this.isResizing)&&(this.edit.update(e,t),this.redraw())}commitEdit(e=!0){const{dispatchImageEdit:t}=this.props,i=this.getImageState();this.edit&&(this.editState=(0,c.getEditState)(i,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.originalImage=e?void 0:this.edit.originalImage,this.edit=void 0,t(this.editState.toImageState()))}redraw(){const{prevFrame:e,onionSkinEnabled:t,selectedColor:i,toolWidth:s,drawingMode:n,tool:o}=this.props,a=this.getImageState(),l=n==r.TileDrawingMode.Wall?2:i;let u=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,u=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach((e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth})),t&&e){const t=(0,c.getEditState)(e,this.props.isTilemap,n),i=this.canvas.getContext("2d");i.globalAlpha=.5,this.drawImage(t.image),t.floating&&t.floating.image&&this.drawImage(t.floating.image,t.layerOffsetX,t.layerOffsetY,!0),i.globalAlpha=1}if(this.edit){const i=this.editState.copy();i.setActiveLayer(n),this.edit.doEdit(i),this.drawImage(i.image,0,0,!(!t||!e)),this.drawOverlayLayers(i.overlayLayers),this.redrawFloatingLayer(i)}else if(this.drawImage(this.editState.image,0,0,!(!t||!e)),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const e=o===r.ImageEditorTool.Erase?0:l;this.drawCursor(this.cursorLocation[0]-(s>>1),this.cursorLocation[1]-(s>>1),s,e)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const e=this.background.getContext("2d");e.imageSmoothingEnabled=!1,e.fillStyle="#aeaeae",e.fillRect(0,0,this.background.width,this.background.height),e.fillStyle="#dedede";const t=this.imageHeight<<1,i=this.imageWidth<<1;for(let s=0;s<i;s++)for(let i=0;i<t;i++)s+i&1&&e.fillRect(s*this.cellWidth,i*this.cellWidth,this.cellWidth,this.cellWidth)}}u&&this.zoomToCanvas()}drawImage(e,t=0,i=0,s=!1,n=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,i,s,n):this.drawBitmap(e,t,i,s,n)}redrawFloatingLayer(e,t=!1){const i=this.refs["floating-layer-border"],s=this.refs["floating-layer-nw-corner"],n=this.refs["floating-layer-ne-corner"],o=this.refs["floating-layer-se-corner"],r=this.refs["floating-layer-sw-corner"],a=[s,n,o,r];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));const l=this.canvas.getBoundingClientRect(),c=Math.max(e.layerOffsetX,0),u=Math.max(e.layerOffsetY,0),h=Math.min(e.layerOffsetX+e.floating.image.width,e.width),d=Math.min(e.layerOffsetY+e.floating.image.height,e.height),p=l.width/e.width,g=l.height/e.height;i.style.display="",(h-c<1||d-u<1)&&(i.style.display="none");const m=-this.panX+p*c,f=-this.panY+g*u,_=p*(h-c),b=g*(d-u);if(i.style.left=m+"px",i.style.top=f+"px",i.style.width=_+"px",i.style.height=b+"px",i.style.borderLeft=e.layerOffsetX>=0?"":"none",i.style.borderTop=e.layerOffsetY>=0?"":"none",i.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",i.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none",null!=s){const e=16,t=3;this.props.isTilemap||(a.forEach((i=>{i.style.display="",i.style.width=e+"px",i.style.height=e+"px",i.style.border=t+"px solid black",i.style.position="absolute",i.style.backgroundColor="white"})),s.style.left=m-e+"px",s.style.top=f-e+"px",s.style.cursor="nw-resize",n.style.left=m+_+"px",n.style.top=f-e+"px",n.style.cursor="ne-resize",o.style.left=m+_+"px",o.style.top=f+b+"px",o.style.cursor="se-resize",r.style.left=m-e+"px",r.style.top=f+b+"px",r.style.cursor="sw-resize")}}else i.style.display="none",a.forEach((e=>{e&&(e.style.display="none")}))}drawOverlayLayers(e,t=0,i=0,s=!this.props.lightMode){e&&e.forEach(((e,n)=>{this.drawBitmap(e,t,i,!0,s,this.canvasLayers[n])}))}drawBitmap(e,t=0,i=0,s=!1,n=!this.props.lightMode,o=this.canvas){const{colors:r}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let n=0;n<e.width;n++)for(let o=0;o<e.height;o++){const l=e.get(n,o);l?(a.fillStyle=r[l],a.fillRect(n+t,o+i,1,1)):s||a.clearRect(n+t,o+i,1,1)}}generateTile(e,t){if(!t.tiles[e])return null;const i=document.createElement("canvas");return i.width=t.tileWidth,i.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!1,!this.props.lightMode,i),this.tileCache[t.tiles[e].id]=i,i}drawTilemap(e,t=0,i=0,s=!1,n=!this.props.lightMode,o=this.canvas){const{tilemapState:{tileset:r}}=this.props,a=o.getContext("2d");let l,c;this.tileCacheRevision!==this.props.tilesetRevision&&(this.tileCache={},this.tileCacheRevision=this.props.tilesetRevision),a.imageSmoothingEnabled=!1,a.fillStyle=d.LIGHT_MODE_TRANSPARENT;for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if((l=e.get(o,u))&&l<r.tiles.length){if((c=this.tileCache[r.tiles[l].id])||(c=this.generateTile(l,r)),!c)continue;a.drawImage(c,(o+t)*this.cellWidth,(u+i)*this.cellWidth)}else s||(n?a.clearRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth):a.fillRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth))}drawCursor(e,t,i,s){const n=this.props.isTilemap&&this.props.drawingMode===r.TileDrawingMode.Wall,o=(n?this.canvasLayers[0]:this.canvas).getContext("2d");if(o.imageSmoothingEnabled=!1,s&&-1!==s)if(this.props.isTilemap&&!n){if(s>=this.props.tilemapState.tileset.tiles.length)return;let n=this.tileCache[this.props.tilemapState.tileset.tiles[s].id];if(n||(n=this.generateTile(s,this.props.tilemapState.tileset)),!n)return;for(let s=0;s<i;s++)for(let r=0;r<i;r++)o.drawImage(n,(e+s)*this.cellWidth,(t+r)*this.cellWidth)}else n?(o.fillStyle=this.props.colors[s],o.fillRect(e,t,1,1)):(o.fillStyle=this.props.colors[s],o.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth));else this.props.lightMode?(o.fillStyle=d.LIGHT_MODE_TRANSPARENT,o.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)):o.clearRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,i){const s=this.refs["canvas-bounds"];if(this.canvas&&s){const n=s.getBoundingClientRect();t=void 0===t?n.left+(n.width>>1):t,i=void 0===i?n.top+(n.height>>1):i;const{canvasX:o,canvasY:r}=this.clientToCanvas(t,i,n);this.zoom=Math.max(this.zoom+e,2.5);const a=this.getCanvasUnit(n);if(a){const{canvasX:e,canvasY:s}=this.clientToCanvas(t,i,n);if(isNaN(e)||isNaN(s)||isNaN(o)||isNaN(r))return;this.panX+=(o-e)*a,this.panY+=(r-s)*a}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];const i=this.refs["canvas-bounds"].getBoundingClientRect(),s=this.canvas.getBoundingClientRect();return s.width<i.width&&(e=-((i.width>>1)-(s.width>>1))),s.height<i.height&&(t=-((i.height>>1)-(s.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;const e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){const t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();const i=this.getCanvasUnit(e);if(0===i){if(this.waitingToZoom)return;return this.waitingToZoom=!0,void requestAnimationFrame((()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}))}this.waitingToZoom=!1;const s=i*this.imageWidth,n=i*this.imageHeight,o=this.imageWidth>1&&this.imageHeight>1?2*i:i>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,s-o),-(e.width-o)),this.panY=Math.max(Math.min(this.panY,n-o),-(e.height-o)),this.canvas.style.position="fixed",this.canvas.style.width=`${s}px`,this.canvas.style.height=`${n}px`,this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach((e=>this.cloneCanvasStyle(this.canvas,e))),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){const i=this.refs["canvas-bounds"].getBoundingClientRect();let s,{canvasX:n,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,i);n=Math.floor(n),o=Math.floor(o),this.editState.inFloatingLayer(n,o)&&(s=this.editState.floating.image.get(n-this.editState.layerOffsetX,o-this.editState.layerOffsetY)),s||(s=this.editState.image.get(n,o)),t?this.props.dispatchChangeBackgroundColor(s):this.props.dispatchChangeSelectedColor(s)}selectAll(){this.props.tool!==r.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(r.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,i){const s=this.getCanvasUnit(i);return{canvasX:(e-i.left+this.panX)/s,canvasY:(t-i.top+this.panY)/s}}getCanvasUnit(e){const t=e.width/e.height,i=this.imageWidth/this.imageHeight,s=Math.pow(this.zoom/10,2);return t>i?s*(e.height/this.imageHeight):s*(e.width/this.imageWidth)}inBounds(e,t){return e>=0&&e<this.imageWidth&&t>=0&&t<this.imageHeight}isPanning(){return this.props.tool===r.ImageEditorTool.Pan}touchesResize(e,t){const i=document.querySelectorAll(":hover");for(let e=0;e<i.length;e++)if("image-editor-floating-layer-corner"==i[e].className)return!0;return!1}isColorSelect(){return this.props.tool===r.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case r.ImageEditorTool.Fill:case r.ImageEditorTool.Marquee:case r.ImageEditorTool.Pan:case r.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(e){const{tilemapState:t,dispatchCreateNewTile:i,gallery:s,backgroundColor:n}=this.props,{tileset:o}=t,r=pxt.sprite.tilemapLiteralToTilemap(e.map);if(!r||!r.width||!r.height)return;const a=e.tiles.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),l=e.layers.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),c=[];let h=o.tiles.length;for(const e of a){const t=o.tiles.findIndex((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t>=0)c.push(t);else{if(s){const t=s.find((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t){i(null,o.tiles.length,n,t.qualifiedName),c.push(h),h++;continue}}i((0,u.createTile)(e.data()),o.tiles.length,n),c.push(h),h++}}this.editState.mergeFloatingLayer();const d=new pxt.sprite.Tilemap(r.width,r.height);for(let e=0;e<d.width;e++)for(let t=0;t<d.height;t++)d.set(e,t,c[r.get(e,t)]);this.editState.floating={image:d,overlayLayers:l},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}i.ImageCanvasImpl=g;const m={dispatchImageEdit:a.dispatchImageEdit,dispatchChangeCursorLocation:a.dispatchChangeCursorLocation,dispatchChangeZoom:a.dispatchChangeZoom,dispatchChangeImageTool:a.dispatchChangeImageTool,dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchCreateNewTile:a.dispatchCreateNewTile};i.ImageCanvas=(0,o.connect)((function({store:{present:e},editor:t},i){if(t.isTilemap){let i=e;return i?{selectedColor:t.selectedColor,tilemapState:i,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:i.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery,tilesetRevision:t.tilesetRevision}:{}}let s=e;return s?{selectedColor:t.selectedColor,colors:s.colors,imageState:s.frames[s.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:s.frames[s.currentFrame-1],isTilemap:t.isTilemap,tilesetRevision:t.tilesetRevision}:{}}),m)(g)},{"../../assets":132,"./ImageEditor":140,"./actions/dispatch":147,"./keyboardShortcuts":149,"./store/imageReducer":151,"./toolDefinitions":155,"./util":156,react:239,"react-redux":225,"react/jsx-runtime":240}],140:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageEditor=i.LIGHT_MODE_TRANSPARENT=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./store/imageStore"),a=e("./SideBar"),l=e("./BottomBar"),c=e("./TopBar"),u=e("./ImageCanvas"),h=e("./Alert"),d=e("./Timeline"),p=e("./keyboardShortcuts"),g=e("./actions/dispatch"),m=e("./util"),f=e("../../assets"),_=e("../../../../react-common/components/util");i.LIGHT_MODE_TRANSPARENT="#dedede";class b extends n.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if((0,p.setStore)(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){const i=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:i})}else{const e=t.store.present.tileset.tileWidth,i=(0,f.createNewImageAsset)("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:i})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{const t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore((0,g.dispatchCloseTileEditor)(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){(0,p.addKeyListener)(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||(0,p.removeKeyListener)(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){const{singleFrame:e,lightMode:t,hideDoneButton:i,hideAssetName:n}=this.props,p=this.getStore(),{tileToEdit:g,editingTile:m,alert:f}=this.state,T="Animation"===p.getState().store.present.kind;return(0,s.jsxs)("div",Object.assign({className:"image-editor-outer"},{children:[(0,s.jsx)(o.Provider,Object.assign({store:p},{children:(0,s.jsxs)("div",Object.assign({className:(0,_.classList)("image-editor",m&&"editing-tile",i&&"hide-done-button")},{children:[(0,s.jsx)(c.TopBar,{singleFrame:e}),(0,s.jsxs)("div",Object.assign({className:"image-editor-content"},{children:[(0,s.jsx)(a.SideBar,{lightMode:t}),(0,s.jsx)(u.ImageCanvas,{suppressShortcuts:m,lightMode:t}),T&&!e?(0,s.jsx)(d.Timeline,{}):void 0]})),(0,s.jsx)(l.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick,hideDoneButton:!!i,hideAssetName:!!n}),f&&f.title&&(0,s.jsx)(h.Alert,{title:f.title,text:f.text,options:f.options})]}))})),m&&(0,s.jsx)(b,{store:r.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:g,singleFrame:!0,nested:!0,hideAssetName:n})]}))}openAsset(e,t,i=!1){this.dispatchOnStore((0,g.dispatchOpenAsset)(e,i,t)),e.meta.displayName?this.dispatchOnStore((0,g.dispatchChangeAssetName)(e.meta.displayName)):i&&this.dispatchOnStore((0,g.dispatchChangeAssetName)(""))}openGalleryAsset(e){const t=this.getAsset(),i=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===i.length);break;case"animation":this.dispatchOnStore((0,g.dispatchSetFrames)(e.frames.map((e=>({bitmap:e})))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore((0,g.dispatchChangeZoom)(0))}getCurrentFrame(){const e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return(0,m.imageStateToBitmap)(t)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),s=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),type:"image",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:s}}getTile(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),s=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),isProjectTile:!0,type:"tile",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:s}}getAnimation(){var e;const t=this.getStore().getState().store.present,i=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:(0,f.getNewInternalID)(),type:"animation",interval:t.interval,frames:t.frames.map((e=>(0,m.imageStateToBitmap)(e).data())),meta:i}}getTilemap(){var e;const t=this.getStore().getState(),i=t.store.present,{floating:s,overlayLayers:n,layerOffsetX:o,layerOffsetY:r}=i.tilemap,a=(0,m.applyBitmapData)(pxt.sprite.Bitmap.fromData(n[0]).copy().data(),s&&s.overlayLayers&&s.overlayLayers[0],o,r),l=new pxt.sprite.TilemapData((0,m.imageStateToTilemap)(i.tilemap),i.tileset,a);l.deletedTiles=t.editor.deletedTiles,l.editedTiles=t.editor.editedTiles;const c=i.asset?Object.assign({},i.asset.meta):{};return{id:null===(e=i.asset)||void 0===e?void 0:e.id,internalID:i.asset?i.asset.internalID:(0,f.getNewInternalID)(),type:"tilemap",data:l,meta:c}}getPersistentData(){const e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore((0,g.dispatchSetInitialState)(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];if(e.width!==t.bitmap.width||e.height!==t.bitmap.height){const i=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)];t.bitmap.width===i[0]&&t.bitmap.height===i[1]||this.dispatchOnStore((0,g.dispatchChangeImageDimensions)(i)),e=(e=e.copy()).resize(i[0],i[1])}}this.dispatchOnStore((0,g.dispatchImageEdit)({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore((0,g.dispatchDisableResize)())}closeNestedEditor(){var e;this.state.editingTile&&(null===(e=this.refs["nested-image-editor"])||void 0===e||e.onDoneClick())}getJres(){if(this.props.singleFrame){const e=this.getCurrentFrame().data();return pxt.sprite.base64EncodeBitmap(e)}return""}loadJres(e){if(e)try{this.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){}}getStore(){return this.props.store||r.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}i.ImageEditor=b},{"../../../../react-common/components/util":130,"../../assets":132,"./Alert":134,"./BottomBar":135,"./ImageCanvas":139,"./SideBar":142,"./Timeline":143,"./TopBar":146,"./actions/dispatch":147,"./keyboardShortcuts":149,"./store/imageStore":152,"./util":156,react:239,"react-redux":225,"react/jsx-runtime":240}],141:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Pivot=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./util");class r extends n.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,i=e[t];return(0,s.jsx)("div",Object.assign({className:"image-editor-pivot-outer"},{children:e.map(((e,t)=>(0,s.jsx)("div",Object.assign({role:"tab",className:"image-editor-pivot-option "+(e===i?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:o.fireClickOnlyOnEnter},{children:e.text}),e.id)))}))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Pivot=r},{"./util":156,react:239,"react/jsx-runtime":240}],142:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SideBar=i.SideBarImpl=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./toolDefinitions"),a=e("./Button"),l=e("./actions/dispatch"),c=e("./sprite/Palette"),u=e("./tilemap/TilePalette"),h=e("./tilemap/Minimap");class d extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:e,isTilemap:t,lightMode:i}=this.props;return(0,s.jsxs)("div",Object.assign({className:"image-editor-sidebar "+(t?"tilemap":"")},{children:[t&&(0,s.jsx)("div",Object.assign({className:"image-editor-tilemap-minimap"},{children:(0,s.jsx)(h.Minimap,{lightMode:i})})),(0,s.jsx)("div",Object.assign({className:"image-editor-tool-buttons"},{children:r.tools.filter((e=>!e.hiddenTool)).map((t=>(0,s.jsx)(a.IconButton,{iconClass:t.iconClass,toggle:e!=t.tool,title:t.title,onClick:this.clickHandler(t.tool)},t.tool)))})),(0,s.jsx)("div",Object.assign({className:"image-editor-palette"},{children:t?(0,s.jsx)(u.TilePalette,{}):(0,s.jsx)(c.Palette,{})}))]}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}i.SideBarImpl=d;const p={dispatchChangeImageTool:l.dispatchChangeImageTool};i.SideBar=(0,o.connect)((function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}}),p)(d)},{"./Button":136,"./actions/dispatch":147,"./sprite/Palette":150,"./tilemap/Minimap":153,"./tilemap/TilePalette":154,"./toolDefinitions":155,react:239,"react-redux":225,"react/jsx-runtime":240}],143:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Timeline=i.TimelineImpl=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./TimelineFrame"),l=e("./util");class c extends n.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{const{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{const{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{const{dispatchNewFrame:e}=this.props;this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:t,currentFrame:i,interval:n,previewAnimating:o}=this.props,{isMovingFrame:r,dropPreviewIndex:l}=this.state;let c,u=e.slice();return r&&(c=e[i],u.splice(i,1),u.splice(l,0,null)),(0,s.jsxs)("div",Object.assign({className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},{children:[(0,s.jsx)("div",Object.assign({className:"image-editor-timeline-preview"},{children:(0,s.jsx)(a.TimelineFrame,{frames:o?e:[e[i]],colors:t,interval:n,animating:!0})})),(0,s.jsx)("div",Object.assign({className:"image-editor-timeline-frames-outer"},{children:(0,s.jsxs)("div",Object.assign({className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},{children:[u.map(((e,n)=>{const o=!r&&n===i;return e?(0,s.jsx)("div",Object.assign({className:"image-editor-timeline-frame "+(o?"active":""),role:"button",onClick:this.clickHandler(n)},{children:(0,s.jsx)(a.TimelineFrame,{frames:[e],colors:t,showActions:o,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})}),n):(0,s.jsx)("div",{className:"image-editor-timeline-frame drop-marker"},n)})),c&&(0,s.jsx)("div",Object.assign({ref:"floating-frame",className:"image-editor-timeline-frame dragging"},{children:(0,s.jsx)(a.TimelineFrame,{frames:[c],colors:t,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})})),(0,s.jsx)("div",Object.assign({className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},{children:(0,s.jsx)("span",{className:"ms-Icon ms-Icon--Add"})}))]}))}))]}))}componentDidMount(){let e;this.frameScroller=this.refs["frame-scroller-ref"];let t=!1;(0,l.bindGestureEvents)(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:i=>{e=i.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");const s=this.frameScroller.getBoundingClientRect(),n=i.clientY-s.top,o=this.frameScroller.firstElementChild.getBoundingClientRect().height,r=Math.floor(n/o);t=r!==this.props.currentFrame},onDragMove:i=>{if(t){this.scrollOffset-=e-i.clientY,e=i.clientY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(i)},onDragEnd:()=>{if(e=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:e,currentFrame:t}=this.props;e(t,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",(e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{currentFrame:t,dispatchChangeCurrentFrame:i}=this.props;this.dragEnd?this.dragEnd=!1:e!=t&&i(e)}),this.handlers[e]}updateDragDrop(e){const t=this.frameScroller.getBoundingClientRect(),i=e.clientY-t.top,s=this.frameScroller.firstElementChild.getBoundingClientRect().height,n=Math.floor(i/s);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=i+"px",this.setState({dropPreviewIndex:n})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}i.TimelineImpl=c;const u={dispatchDuplicateFrame:r.dispatchDuplicateFrame,dispatchDeleteFrame:r.dispatchDeleteFrame,dispatchChangeCurrentFrame:r.dispatchChangeCurrentFrame,dispatchNewFrame:r.dispatchNewFrame,dispatchMoveFrame:r.dispatchMoveFrame};i.Timeline=(0,o.connect)((function({store:{present:e},editor:t},i){let s=e;return s?{frames:s.frames,currentFrame:s.currentFrame,colors:s.colors,interval:s.interval,previewAnimating:t.previewAnimating}:{}}),u)(c)},{"./TimelineFrame":144,"./actions/dispatch":147,"./util":156,react:239,"react-redux":225,"react/jsx-runtime":240}],144:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimelineFrame=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./Button"),r=pxt.BrowserUtils.isEdge()?25:1;class a extends n.Component{constructor(e){super(e),this.state={index:0}}render(){const{frames:e,animating:t,showActions:i,duplicateFrame:n,deleteFrame:r}=this.props,a=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],l=a.bitmap.height>a.bitmap.width;return(0,s.jsxs)("div",Object.assign({className:"timeline-frame-outer "+(l?"portrait":"landscape")},{children:[(0,s.jsx)("div",{className:"timeline-frame-spacer"}),(0,s.jsx)("canvas",{ref:"preview-canvas"}),(0,s.jsx)("div",{className:"timeline-frame-spacer"}),i&&(0,s.jsxs)("div",Object.assign({className:"timeline-frame-actions"},{children:[(0,s.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:n}),(0,s.jsx)(o.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:r})]}))]}))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(!this.canvas)return;const{animating:e,frames:t}=this.props,i=t[e?Math.min(Math.max(0,this.state.index),t.length-1):0];this.canvas.height=i.bitmap.height*r,this.canvas.width=i.bitmap.width*r;const s=pxt.sprite.Bitmap.fromData(i.bitmap);if(this.drawBitmap(s),i.floating&&i.floating.bitmap){const e=pxt.sprite.Bitmap.fromData(i.floating.bitmap);this.drawBitmap(e,i.layerOffsetX,i.layerOffsetY,!0)}}updateAnimation(){const{animating:e,interval:t,frames:i}=this.props,s=e&&t>5&&i.length>1;s&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.setState({index:(this.state.index+1)%this.props.frames.length})),t),this.intervalcurrent=t):!s&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(e,t=0,i=0,s=!1){const{colors:n}=this.props,o=this.canvas.getContext("2d");for(let a=0;a<e.width;a++)for(let l=0;l<e.height;l++){const c=e.get(a,l);c?(o.fillStyle=n[c],o.fillRect((a+t)*r,(l+i)*r,r,r)):s||o.clearRect((a+t)*r,(l+i)*r,r,r)}}}i.TimelineFrame=a},{"./Button":136,react:239,"react/jsx-runtime":240}],145:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Toggle=void 0;const s=e("react/jsx-runtime"),n=e("react");class o extends n.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){const{initialValue:e,label:t}=this.props;return(0,s.jsxs)("div",Object.assign({className:"image-editor-toggle-container"},{children:[t&&(0,s.jsx)("span",{children:t}),(0,s.jsxs)("label",Object.assign({className:"image-editor-toggle"},{children:[(0,s.jsx)("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),(0,s.jsx)("span",{className:"image-editor-toggle-switch"})]}))]}))}}i.Toggle=o},{react:239,"react/jsx-runtime":240}],146:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TopBar=i.TopBarImpl=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./actions/dispatch"),a=e("./Button"),l=e("./CursorSizes"),c=e("./Toggle"),u=e("./keyboardShortcuts");class h extends n.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>(0,u.flip)(!0),this.flipHorizontal=()=>(0,u.flip)(!1),this.rotateClockwise=()=>(0,u.rotate)(!0),this.rotateCounterclockwise=()=>(0,u.rotate)(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{const{dispatchChangeInterval:e}=this.props,t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){const{interval:e,previewAnimating:t,singleFrame:i,isTilemap:n,dispatchChangeOverlayEnabled:o}=this.props,r=null==this.state.interval?e:this.state.interval;return(0,s.jsxs)("div",Object.assign({className:"image-editor-topbar"},{children:[(0,s.jsx)("div",Object.assign({className:"cursor-group"},{children:(0,s.jsx)(l.CursorSizes,{})})),(0,s.jsx)("div",{className:"image-editor-seperator"}),(0,s.jsxs)("div",Object.assign({className:"image-transform-group"},{children:[(0,s.jsx)(a.IconButton,{iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical},"flipv"),(0,s.jsx)(a.IconButton,{iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal},"fliph"),(0,s.jsx)(a.IconButton,{iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise},"rotatec"),(0,s.jsx)(a.IconButton,{iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise},"rotatecc")]})),(0,s.jsx)("div",{className:"spacer"}),!i&&(0,s.jsx)("div",{className:"image-editor-seperator"}),!i&&(0,s.jsxs)("div",Object.assign({className:"timeline-controls"},{children:[(0,s.jsx)(a.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),(0,s.jsx)("div",Object.assign({className:"image-editor-interval-label image-editor-label"},{children:(0,s.jsx)("span",{className:"ms-Icon ms-Icon--Clock"})})),(0,s.jsx)("div",Object.assign({className:"image-editor-interval"},{children:(0,s.jsx)("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:r,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur})}))]})),n&&(0,s.jsx)(c.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o})]}))}}i.TopBarImpl=h;const d={dispatchChangeInterval:r.dispatchChangeInterval,dispatchChangePreviewAnimating:r.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:r.dispatchChangeOverlayEnabled};i.TopBar=(0,o.connect)((function({store:{present:e},editor:t},i){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}}),d)(h)},{"./Button":136,"./CursorSizes":137,"./Toggle":145,"./actions/dispatch":147,"./keyboardShortcuts":149,react:239,"react-redux":225,"react/jsx-runtime":240}],147:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchSetFrames=i.dispatchOpenAsset=i.dispatchChangeAssetName=i.dispatchDisableResize=i.dispatchDeleteTile=i.dispatchCloseTileEditor=i.dispatchOpenTileEditor=i.dispatchSetGalleryOpen=i.dispatchCreateNewTile=i.dispatchChangeDrawingMode=i.dispatchChangeTilePalettePage=i.dispatchChangeTilePaletteCategory=i.dispatchSetInitialState=i.dispatchChangeBackgroundColor=i.dispatchSwapBackgroundForeground=i.dispatchHideAlert=i.dispatchShowAlert=i.dispatchChangeZoom=i.dispatchChangeOverlayEnabled=i.dispatchToggleOnionSkinEnabled=i.dispatchChangePreviewAnimating=i.dispatchChangeInterval=i.dispatchMoveFrame=i.dispatchChangeCurrentFrame=i.dispatchDuplicateFrame=i.dispatchDeleteFrame=i.dispatchNewFrame=i.dispatchToggleAspectRatioLocked=i.dispatchRedoImageEdit=i.dispatchUndoImageEdit=i.dispatchImageEdit=i.dispatchChangeCursorLocation=i.dispatchChangeKeyModifiers=i.dispatchChangeImageDimensions=i.dispatchChangeSelectedColor=i.dispatchChangeCursorSize=i.dispatchChangeImageTool=void 0;const s=e("./types");i.dispatchChangeImageTool=e=>({type:s.CHANGE_IMAGE_TOOL,tool:e});i.dispatchChangeCursorSize=e=>({type:s.CHANGE_CURSOR_SIZE,cursorSize:e});i.dispatchChangeSelectedColor=e=>({type:s.CHANGE_SELECTED_COLOR,selectedColor:e});i.dispatchChangeImageDimensions=e=>({type:s.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e});i.dispatchChangeKeyModifiers=e=>({type:s.CHANGE_KEY_MODIFIERS,keyModifiers:e});i.dispatchChangeCursorLocation=e=>({type:s.CHANGE_CURSOR_LOCATION,cursorLocation:e});i.dispatchImageEdit=e=>({type:s.IMAGE_EDIT,newState:e});i.dispatchUndoImageEdit=()=>({type:s.UNDO_IMAGE_EDIT});i.dispatchRedoImageEdit=()=>({type:s.REDO_IMAGE_EDIT});i.dispatchToggleAspectRatioLocked=()=>({type:s.TOGGLE_ASPECT_RATIO});i.dispatchNewFrame=e=>({type:s.NEW_FRAME,index:e});i.dispatchDeleteFrame=e=>({type:s.DELETE_FRAME,index:e});i.dispatchDuplicateFrame=e=>({type:s.DUPLICATE_FRAME,index:e});i.dispatchChangeCurrentFrame=e=>({type:s.CHANGE_CURRENT_FRAME,index:e});i.dispatchMoveFrame=(e,t)=>({type:s.MOVE_FRAME,oldIndex:e,newIndex:t});i.dispatchChangeInterval=e=>({type:s.CHANGE_INTERVAL,newInterval:e});i.dispatchChangePreviewAnimating=e=>({type:s.CHANGE_PREVIEW_ANIMATING,animating:e});i.dispatchToggleOnionSkinEnabled=()=>({type:s.TOGGLE_ONION_SKIN_ENABLED});i.dispatchChangeOverlayEnabled=e=>({type:s.CHANGE_OVERLAY_ENABLED,enabled:e});i.dispatchChangeZoom=e=>({type:s.CHANGE_CANVAS_ZOOM,zoom:e});i.dispatchShowAlert=(e,t,i)=>({type:s.SHOW_ALERT,title:e,text:t,options:i});i.dispatchHideAlert=()=>({type:s.HIDE_ALERT});i.dispatchSwapBackgroundForeground=()=>({type:s.SWAP_FOREGROUND_BACKGROUND});i.dispatchChangeBackgroundColor=e=>({type:s.CHANGE_BACKGROUND_COLOR,backgroundColor:e});i.dispatchSetInitialState=(e,t)=>({type:s.SET_INITIAL_STATE,state:e,past:t});i.dispatchChangeTilePaletteCategory=e=>({type:s.CHANGE_TILE_PALETTE_CATEGORY,category:e});i.dispatchChangeTilePalettePage=e=>({type:s.CHANGE_TILE_PALETTE_PAGE,page:e});i.dispatchChangeDrawingMode=e=>({type:s.CHANGE_DRAWING_MODE,drawingMode:e});i.dispatchCreateNewTile=(e,t,i,n)=>({type:s.CREATE_NEW_TILE,tile:e,foreground:t,background:i,qualifiedName:n});i.dispatchSetGalleryOpen=e=>({type:s.SET_GALLERY_OPEN,open:e});i.dispatchOpenTileEditor=(e,t)=>({type:s.OPEN_TILE_EDITOR,index:e,id:t});i.dispatchCloseTileEditor=(e,t)=>({type:s.CLOSE_TILE_EDITOR,result:e,index:t});i.dispatchDeleteTile=(e,t)=>({type:s.DELETE_TILE,id:t,index:e});i.dispatchDisableResize=()=>({type:s.DISABLE_RESIZE});i.dispatchChangeAssetName=e=>({type:s.CHANGE_ASSET_NAME,name:e});i.dispatchOpenAsset=(e,t,i)=>({type:s.OPEN_ASSET,asset:e,keepPast:t,gallery:i});i.dispatchSetFrames=e=>({type:s.SET_FRAMES,frames:e})},{"./types":148}],148:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OPEN_ASSET=i.CHANGE_ASSET_NAME=i.DISABLE_RESIZE=i.DELETE_TILE=i.CLOSE_TILE_EDITOR=i.OPEN_TILE_EDITOR=i.CREATE_NEW_TILE=i.CHANGE_DRAWING_MODE=i.CHANGE_TILE_PALETTE_CATEGORY=i.CHANGE_TILE_PALETTE_PAGE=i.CHANGE_BACKGROUND_COLOR=i.SWAP_FOREGROUND_BACKGROUND=i.HIDE_ALERT=i.SHOW_ALERT=i.CHANGE_CANVAS_ZOOM=i.CHANGE_OVERLAY_ENABLED=i.TOGGLE_ONION_SKIN_ENABLED=i.CHANGE_PREVIEW_ANIMATING=i.CHANGE_INTERVAL=i.CHANGE_CURRENT_FRAME=i.MOVE_FRAME=i.DUPLICATE_FRAME=i.DELETE_FRAME=i.NEW_FRAME=i.SET_GALLERY_OPEN=i.TOGGLE_ASPECT_RATIO=i.REDO_IMAGE_EDIT=i.UNDO_IMAGE_EDIT=i.IMAGE_EDIT=i.CHANGE_CURSOR_LOCATION=i.CHANGE_KEY_MODIFIERS=i.CHANGE_IMAGE_DIMENSIONS=i.CHANGE_SELECTED_COLOR=i.CHANGE_CURSOR_SIZE=i.CHANGE_IMAGE_TOOL=i.SET_FRAMES=i.SET_INITIAL_STATE=void 0,i.SET_INITIAL_STATE="SET_INITIAL_STATE",i.SET_FRAMES="SET_FRAMES",i.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",i.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",i.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",i.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",i.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",i.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",i.IMAGE_EDIT="IMAGE_EDIT",i.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",i.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",i.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",i.SET_GALLERY_OPEN="SET_GALLERY_OPEN",i.NEW_FRAME="NEW_FRAME",i.DELETE_FRAME="DELETE_FRAME",i.DUPLICATE_FRAME="DUPLICATE_FRAME",i.MOVE_FRAME="MOVE_FRAME",i.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",i.CHANGE_INTERVAL="CHANGE_INTERVAL",i.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",i.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",i.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",i.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",i.SHOW_ALERT="SHOW_ALERT",i.HIDE_ALERT="HIDE_ALERT",i.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",i.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",i.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",i.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",i.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",i.CREATE_NEW_TILE="CREATE_NEW_TILE",i.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",i.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",i.DELETE_TILE="DELETE_TILE",i.DISABLE_RESIZE="DISABLE_RESIZE",i.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",i.OPEN_ASSET="OPEN_ASSET"},{}],149:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColor=i.outline=i.rotate=i.flip=i.setStore=i.areShortcutsEnabled=i.releaseShortcutLock=i.obtainShortcutLock=i.removeKeyListener=i.addKeyListener=void 0;const s=e("./store/imageReducer"),n=e("./actions/dispatch"),o=e("./store/imageStore"),r=e("./toolDefinitions");let a=o.mainStore,l=[];function c(){return!l.length}function u(e){const t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(f((0,n.dispatchUndoImageEdit)()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(f((0,n.dispatchRedoImageEdit)()),e.preventDefault(),e.stopPropagation())}function h(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function d(e){if(!c())return;if(e.shiftKey&&/^(?:Digit[1-9])|(?:Key[A-F])$/.test(e.code))return void(0==e.code.indexOf("Digit")?E(parseInt(e.code.substring(5))):E(parseInt(e.code.substring(3),16)));switch(e.key){case"e":g(s.ImageEditorTool.Erase);break;case"h":g(s.ImageEditorTool.Pan);break;case"b":case"p":g(s.ImageEditorTool.Paint);break;case"g":g(s.ImageEditorTool.Fill);break;case"m":g(s.ImageEditorTool.Marquee);break;case"u":g(s.ImageEditorTool.Rect);break;case"l":g(s.ImageEditorTool.Line);break;case"c":g(s.ImageEditorTool.Circle);break;case"-":case"_":m(-1);break;case"=":case"+":m(1);break;case"x":f((0,n.dispatchSwapBackgroundForeground)());break;case"H":b(!1);break;case"V":b(!0);break;case"[":T(!1);break;case"]":T(!0);break;case">":_(!0);break;case"<":_(!1)}const t=a.getState().editor;if(e.shiftKey&&"KeyR"===e.code)y(t.backgroundColor,t.selectedColor);else if(!t.isTilemap&&/^Digit\d$/.test(e.code)){const t=+e.code.slice(-1)+(e.shiftKey?9:0);t>=0&&t<16&&function(e){f((0,n.dispatchChangeSelectedColor)(e))}(t)}}function p(){const e=a.getState();if(e.editor.isTilemap){const t=e.store.present;return[(0,r.getEditState)(t.tilemap,!0,e.editor.drawingMode),"tilemap"]}{const t=e.store.present;return[(0,r.getEditState)(t.frames[t.currentFrame],!1,e.editor.drawingMode),t.frames.length>1?"animation":"image"]}}function g(e){f((0,n.dispatchChangeImageTool)(e))}function m(e){f((0,n.dispatchChangeZoom)(e))}function f(e){a.dispatch(e)}function _(e){let t;const i=a.getState().editor.cursorSize;switch(i){case 1:t=e?3:1;break;case 3:t=e?5:1;break;case 5:t=e?5:3}i!==t&&f((0,n.dispatchChangeCursorSize)(t))}function b(e){const[t,i]=p(),s=(0,r.flipEdit)(t,e,"tilemap"===i);f((0,n.dispatchImageEdit)(s.toImageState()))}function T(e){const[t,i]=p(),s=(0,r.rotateEdit)(t,e,"tilemap"===i,"animation"===i);f((0,n.dispatchImageEdit)(s.toImageState()))}function E(e){const[t,i]=p();if("tilemap"===i)return;const s=(0,r.outlineEdit)(t,e);f((0,n.dispatchImageEdit)(s.toImageState()))}function y(e,t){const[i,s]=p(),o=(0,r.replaceColorEdit)(i,e,t);f((0,n.dispatchImageEdit)(o.toImageState()))}i.addKeyListener=function(){l=[],document.addEventListener("keydown",d),document.addEventListener("keydown",u,!0),document.addEventListener("keydown",h,!0)},i.removeKeyListener=function(){document.removeEventListener("keydown",d),document.removeEventListener("keydown",u,!0),document.removeEventListener("keydown",h,!0)},i.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},i.releaseShortcutLock=function(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)},i.areShortcutsEnabled=c,i.setStore=function(e){a=e||o.mainStore},i.flip=b,i.rotate=T,i.outline=E,i.replaceColor=y},{"./actions/dispatch":147,"./store/imageReducer":151,"./store/imageStore":152,"./toolDefinitions":155}],150:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Palette=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("../actions/dispatch");class a extends n.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){const{colors:e,selected:t,backgroundColor:i,dispatchSwapBackgroundForeground:n}=this.props;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:n},{children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("pattern",Object.assign({id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},{children:[(0,s.jsx)("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),(0,s.jsx)("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),(0,s.jsx)("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"})]}))}),(0,s.jsxs)("g",{children:[(0,s.jsx)("rect",Object.assign({fill:i?e[i]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,s.jsx)("title",{children:l(i,e[i])})})),(0,s.jsx)("rect",Object.assign({fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},{children:(0,s.jsx)("title",{children:l(t,e[t])})}))]})]})),(0,s.jsx)("div",Object.assign({className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},{children:this.props.colors.map(((e,t)=>(0,s.jsx)("div",{className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:l(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}},t)))}))]})}clickHandler(e){return this.handlers[e]||(this.handlers[e]=t=>{0===t.button?this.props.dispatchChangeSelectedColor(e):(this.props.dispatchChangeBackgroundColor(e),t.preventDefault(),t.stopPropagation())}),this.handlers[e]}}function l(e,t){const i=0===e?lf("transparency"):function(e){switch(null==e?void 0:e.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}(t);return i?lf("Color {0} ({1})",e,i):lf("Color {0}",e)}const c={dispatchChangeSelectedColor:r.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:r.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:r.dispatchSwapBackgroundForeground};i.Palette=(0,o.connect)((function({store:{present:e},editor:t},i){let s=e;return s?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:s.colors}:{}}),c)(a)},{"../actions/dispatch":147,react:239,"react-redux":225,"react/jsx-runtime":240}],151:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setTelemetryFunction=i.TileDrawingMode=i.TileCategory=i.KeyModifiers=i.CursorSize=i.ImageEditorTool=void 0;const s=e("../../../assets"),n=e("../actions/types");var o,r,a,l;(l=o=i.ImageEditorTool||(i.ImageEditorTool={}))[l.Paint=0]="Paint",l[l.Fill=1]="Fill",l[l.Line=2]="Line",l[l.Erase=3]="Erase",l[l.Circle=4]="Circle",l[l.Rect=5]="Rect",l[l.ColorSelect=6]="ColorSelect",l[l.Marquee=7]="Marquee",l[l.Pan=8]="Pan",function(e){e[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five"}(i.CursorSize||(i.CursorSize={})),function(e){e[e.Alt=1]="Alt",e[e.Shift=2]="Shift"}(i.KeyModifiers||(i.KeyModifiers={})),function(e){e[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc"}(r=i.TileCategory||(i.TileCategory={})),function(e){e.Default="default",e.Wall="wall"}(a=i.TileDrawingMode||(i.TileDrawingMode={}));const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!1,currentFrame:0,frames:[g(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,tilesetRevision:0,isTilemap:!1}},u=(e,t)=>{switch(t.type){case n.TOGGLE_ASPECT_RATIO:return f("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case n.CHANGE_CURRENT_FRAME:return f("change-frame"),Object.assign(Object.assign({},e),{currentFrame:t.index});case n.CHANGE_INTERVAL:return f("change-interval"),Object.assign(Object.assign({},e),{interval:t.newInterval});case n.CHANGE_IMAGE_DIMENSIONS:f("change-dimensions");const[i,s]=t.imageDimensions;return Object.assign(Object.assign({},e),{frames:e.frames.map(((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(i,s).data()})))});case n.IMAGE_EDIT:return f("image-edit"),Object.assign(Object.assign({},e),{frames:e.frames.map(((i,s)=>s===e.currentFrame?t.newState:i))});case n.DELETE_FRAME:if(1===e.frames.length)return e;f("delete-frame");const o=e.frames.slice();o.splice(t.index,1);let r=e.currentFrame;return e.currentFrame>=t.index&&e.currentFrame>0&&r--,Object.assign(Object.assign({},e),{currentFrame:r,frames:o});case n.DUPLICATE_FRAME:f("duplicate-frame");const a=e.frames.slice();return a.splice(t.index,0,function(e){let t,i,s;return e.floating&&(e.floating.bitmap&&(i=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(s=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data()))),t={bitmap:i,overlayLayers:s}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data())),floating:t})}(e.frames[t.index])),Object.assign(Object.assign({},e),{frames:a,currentFrame:t.index+1});case n.NEW_FRAME:return f("new-frame"),Object.assign(Object.assign({},e),{frames:[...e.frames,g(e.frames[0].bitmap.width,e.frames[0].bitmap.height)],currentFrame:e.frames.length});case n.MOVE_FRAME:if(t.newIndex<0||t.newIndex>=e.frames.length||t.newIndex<0||t.newIndex>=e.frames.length)return e;f("move-frame");const l=e.frames.slice(),c=l.splice(t.oldIndex,1)[0];return l.splice(t.newIndex,0,c),Object.assign(Object.assign({},e),{frames:l,currentFrame:t.oldIndex===e.currentFrame?t.newIndex:e.currentFrame});case n.SET_FRAMES:return f("set-frames"),Object.assign(Object.assign({},e),{frames:t.frames,currentFrame:0});default:return e}},h=(e,t,i)=>{let s;switch(t.type){case n.CHANGE_PREVIEW_ANIMATING:return f("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case n.CHANGE_CANVAS_ZOOM:return(t.zoom>0||t.zoom<0)&&f("zoom-"+(t.zoom>0?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case n.CHANGE_IMAGE_TOOL:return f(`change-tool-${o[t.tool]}`),Object.assign(Object.assign({},e),{tool:t.tool});case n.CHANGE_CURSOR_SIZE:return f(`change-cursor-size-${t.cursorSize}`),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case n.CHANGE_SELECTED_COLOR:return f(`foreground-color-${t.selectedColor}`),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case n.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case n.CHANGE_BACKGROUND_COLOR:return f(`background-color-${t.backgroundColor}`),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case n.SWAP_FOREGROUND_BACKGROUND:return f("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case n.TOGGLE_ONION_SKIN_ENABLED:return f("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case n.CHANGE_TILE_PALETTE_CATEGORY:return f(`change-tile-category-${r[t.category]}`),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case n.CHANGE_TILE_PALETTE_PAGE:return f("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case n.CHANGE_DRAWING_MODE:return f("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||a.Default});case n.CHANGE_OVERLAY_ENABLED:return f("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case n.CREATE_NEW_TILE:return s=e.editedTiles,!t.tile||s&&-1!==s.indexOf(t.tile.id)||(s=(s||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:s,selectedColor:t.foreground,backgroundColor:t.background});case n.SET_GALLERY_OPEN:return f(`set-gallery-open-${t.open}`),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case n.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor,tilesetRevision:e.tilesetRevision+1});case n.OPEN_TILE_EDITOR:const l=t.index?"edit":"new";return f(`open-tile-editor-${l}`),Object.assign(Object.assign({},e),{editingTile:{type:l,tilesetIndex:t.index}});case n.CLOSE_TILE_EDITOR:return s=e.editedTiles,!t.result||s&&-1!==s.indexOf(t.result.id)||(s=(s||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:s,selectedColor:t.index||i.present.tileset.tiles.length,editingTile:void 0,tilesetRevision:e.tilesetRevision+1});case n.SHOW_ALERT:return f("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case n.HIDE_ALERT:return f("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case n.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},d=(e,t)=>{switch(t.type){case n.TOGGLE_ASPECT_RATIO:return f("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case n.CHANGE_IMAGE_DIMENSIONS:f("change-dimensions");const[i,o]=t.imageDimensions;return Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:T(e.tilemap.bitmap,i,o),overlayLayers:e.tilemap.overlayLayers&&e.tilemap.overlayLayers.map((e=>function(e,t,i){return pxt.sprite.Bitmap.fromData(e).resize(t,i).data()}(e,i,o)))})});case n.CREATE_NEW_TILE:const r=!t.qualifiedName;let a;return f(r?"new-tile":`used-tile-${t.qualifiedName}`),r?(a=t.tile).isProjectTile=!0:a=(0,s.lookupAsset)("tile",t.qualifiedName),Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([a])}),nextId:r?e.nextId+1:e.nextId});case n.CLOSE_TILE_EDITOR:return f("close-tile-editor"),t.result?t.index?Object.assign(Object.assign({},e),{tileset:p(e.tileset,t.index,t.result)}):Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([t.result])}),nextId:e.nextId+1}):e;case n.DELETE_TILE:f("delete-tile");const l=e.tileset.tiles.slice();return l.splice(t.index,1),Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:b(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},e.tileset),{tiles:l})});case n.IMAGE_EDIT:return f("image-edit"),Object.assign(Object.assign({},e),{tilemap:t.newState});default:return e}};function p(e,t,i){return Object.assign(Object.assign({},e),{tiles:e.tiles.map(((e,s)=>s===t?i:e))})}function g(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let m;function f(e){m&&m(e)}function _(e,t){for(const i of e.tiles)if(!i.jresData&&!i.isProjectTile)for(const e of t)if(e.qualifiedName===i.id){i.bitmap=e.bitmap;break}return e}function b(e,t){const i=t.copy();for(let t=0;t<i.width;t++)for(let s=0;s<i.height;s++){const n=i.get(t,s);n===e?i.set(t,s,0):n>e&&i.set(t,s,n-1)}return i}function T(e,t,i){return pxt.sprite.Tilemap.fromData(e).resize(t,i).data()}function E(e,t){return"tilemap"===e.type?function(e,t){return{kind:"Tilemap",asset:e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:e.data.tilemap.data(),overlayLayers:[e.data.layers]},tileset:_(e.data.tileset,t),nextId:e.data.nextId}}(e,t):function(e){return{kind:"Animation",asset:e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===e.type,currentFrame:0,frames:"animation"===e.type?e.frames.map((e=>({bitmap:e}))):[{bitmap:e.bitmap}],interval:"animation"===e.type?e.interval:100}}(e)}i.setTelemetryFunction=function(e){m=e},i.default=(e=c,t)=>{var i;switch(t.type){case n.OPEN_TILE_EDITOR:case n.CHANGE_PREVIEW_ANIMATING:case n.CHANGE_CANVAS_ZOOM:case n.CHANGE_IMAGE_TOOL:case n.CHANGE_CURSOR_SIZE:case n.CHANGE_SELECTED_COLOR:case n.CHANGE_CURSOR_LOCATION:case n.CHANGE_BACKGROUND_COLOR:case n.SWAP_FOREGROUND_BACKGROUND:case n.TOGGLE_ONION_SKIN_ENABLED:case n.CHANGE_OVERLAY_ENABLED:case n.CHANGE_TILE_PALETTE_PAGE:case n.CHANGE_TILE_PALETTE_CATEGORY:case n.CHANGE_DRAWING_MODE:case n.SET_GALLERY_OPEN:case n.SHOW_ALERT:case n.HIDE_ALERT:case n.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{editor:h(e.editor,t,e.store)});case n.SET_INITIAL_STATE:const o=t.state;return Object.assign(Object.assign({},e),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:o.selectedColor,backgroundColor:o.backgroundColor,tilemapPalette:o.tilemapPalette,tileGalleryOpen:o.tileGalleryOpen,tileGallery:o.tileGallery,isTilemap:o.isTilemap,referencedTiles:e.editor.referencedTiles}),store:Object.assign(Object.assign({},e.store),{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case n.OPEN_ASSET:const l=t.asset,p=t.gallery||(t.keepPast?e.editor.tileGallery:[]);let g=-1;if("tilemap"===l.type){const e=t.asset.data;if(pxt.sprite.isEmptyTilemap(e)){const t=e.tileset.tiles||[],n=null===(i=p.find((e=>-1!==e.tags.indexOf("forest"))))||void 0===i?void 0:i.qualifiedName,o=(0,s.lookupAsset)("tile",n);o&&!t.find((e=>e.id===n))&&t.push(o),g=t.indexOf(o)}}return Object.assign(Object.assign({},e),{editor:"tilemap"===l.type?{selectedColor:g,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:r.Forest,page:0},drawingMode:a.Default,overlayEnabled:!0,tileGallery:p,tileGalleryOpen:!!p,referencedTiles:l.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tilesetRevision:0,tool:t.keepPast?e.editor.tool:c.editor.tool,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,editedTiles:t.keepPast?e.editor.editedTiles:void 0,deletedTiles:t.keepPast?e.editor.deletedTiles:void 0}:{isTilemap:!1,tilesetRevision:0,selectedColor:t.keepPast?e.editor.selectedColor:c.editor.selectedColor,backgroundColor:t.keepPast?e.editor.backgroundColor:c.editor.backgroundColor,previewAnimating:t.keepPast?e.editor.previewAnimating:c.editor.previewAnimating,tool:t.keepPast?e.editor.tool:c.editor.tool,onionSkinEnabled:t.keepPast?e.editor.onionSkinEnabled:c.editor.onionSkinEnabled,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,resizeDisabled:t.keepPast?e.editor.resizeDisabled:c.editor.resizeDisabled},store:Object.assign(Object.assign({},e.store),{past:t.keepPast?e.store.past:[],present:E(t.asset,p),future:[]})});case n.CHANGE_ASSET_NAME:return f("change-asset-name"),Object.assign(Object.assign({},e),{store:{past:[...e.store.past,e.store.present],present:Object.assign(Object.assign({},e.store.present),{asset:Object.assign(Object.assign({},e.store.present.asset),{meta:Object.assign(Object.assign({},e.store.present.asset.meta||{}),{displayName:t.name})})}),future:[]}});case n.UNDO_IMAGE_EDIT:return e.store.past.length?(f("undo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:[...e.store.future,e.store.present]}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;case n.REDO_IMAGE_EDIT:return e.store.future.length?(f("redo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;default:return Object.assign(Object.assign({},e),{editor:h(e.editor,t,e.store),store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.editor.isTilemap?d(e.store.present,t):u(e.store.present,t),future:[]})})}}},{"../../../assets":132,"../actions/types":148}],152:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mainStore=i.tileEditorStore=void 0;const s=e("redux"),n=e("./imageReducer"),o=(0,s.createStore)(n.default);i.default=o,i.tileEditorStore=(0,s.createStore)(n.default),i.mainStore=o},{"./imageReducer":151,redux:241}],153:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Minimap=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("../ImageEditor"),a=pxt.BrowserUtils.isEdge()?25:1;class l extends n.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return(0,s.jsx)("div",Object.assign({className:"minimap-outer"},{children:(0,s.jsx)("canvas",{ref:"minimap-canvas",className:"paint-surface"})}))}redrawCanvas(){const{tilemap:e,lightMode:t}=this.props;let{bitmap:i,floating:s,layerOffsetX:n,layerOffsetY:o}=e;const l=this.canvas.getContext("2d"),c=pxt.sprite.Tilemap.fromData(i),u=s&&s.bitmap?pxt.sprite.Tilemap.fromData(s.bitmap):null;this.canvas.width=c.width*a,this.canvas.height=c.height*a,this.tileColors=[];for(let e=0;e<c.width;e++)for(let i=0;i<c.height;i++){const s=u?u.get(e-n,i-o):null,h=c.get(e,i);s?(l.fillStyle=this.getColor(s),l.fillRect(e*a,i*a,a,a)):h?(l.fillStyle=this.getColor(h),l.fillRect(e*a,i*a,a,a)):t?(l.fillStyle=r.LIGHT_MODE_TRANSPARENT,l.fillRect(e*a,i*a,a,a)):l.clearRect(e*a,i*a,a,a)}}getColor(e){if(!this.tileColors[e]){const{tileset:t,colors:i}=this.props;if(e>=t.tiles.length)return"#ffffff";const s=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(s,i)}return this.tileColors[e]}}i.Minimap=(0,o.connect)((function({store:{present:e},editor:t},i){let s=e;return s?{tilemap:s.tilemap,tileset:s.tileset,colors:s.colors}:{}}),{})(l)},{"../ImageEditor":140,react:239,"react-redux":225,"react/jsx-runtime":240}],154:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TilePalette=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("../store/imageReducer"),a=e("../actions/dispatch"),l=e("../TimelineFrame"),c=e("../Dropdown"),u=e("../Pivot"),h=e("../Button"),d=e("../../../assets"),p=pxt.BrowserUtils.isEdge()?25:1,g=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],m=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],f=new pxt.sprite.Bitmap(16,16);class _ extends n.Component{constructor(e){super(e),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{const{tileset:e,selected:t,dispatchOpenTileEditor:i}=this.props,s=e.tiles[t];(null==s?void 0:s.isProjectTile)&&0!==t&&i(t,s.id)},this.tileDuplicateHandler=()=>{var e;const{tileset:t,selected:i,backgroundColor:s,dispatchCreateNewTile:n}=this.props;if(!t.tiles[i]||!t.tiles[i].isProjectTile||0===i)return;const o=t.tiles[i];n((0,d.createTile)(o.bitmap,null,null===(e=o.meta)||void 0===e?void 0:e.displayName),t.tiles.length,s)},this.tileDeleteAlertHandler=()=>{const{tileset:e,selected:t,dispatchShowAlert:i,dispatchHideAlert:s,referencedTiles:n}=this.props,o=e.tiles[t];t&&o&&o.isProjectTile&&(n&&-1!==n.indexOf(o.id)?i(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:s}]):i(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:s}]))},this.deleteTile=()=>{const e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,e.button>0)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=r.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.drawingMode===r.TileDrawingMode.Wall?this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default):this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const{gallery:t}=e;if(this.refreshGallery(e),t){const e={};for(const i of t){const t=i.tags.find((e=>pxt.Util.startsWith(e,"category-")));t&&(e[t]||(e[t]={id:t,text:pxt.Util.rlf(`{id:tilecategory}${t.substr(9)}`),tiles:[]}),e[t].tiles.push(i))}this.categories=g.concat(Object.keys(e).map((t=>e[t])))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:i,tileset:n,category:o,page:a,drawingMode:d,galleryOpen:p}=this.props,g=n.tiles[t]?n.tiles[t].bitmap:f.data(),_=n.tiles[i]?n.tiles[i].bitmap:f.data();f.data(),this.updateGalleryTiles();let E=Math.ceil(this.categoryTiles.length/16);p||this.categoryTiles.length%16!=0||E++;const y=!p&&(1===E||a===E-1),I=p||!this.renderedTiles.some((e=>!T(e)&&e.index===t));return(0,s.jsxs)("div",Object.assign({className:"tile-palette"},{children:[(0,s.jsxs)("div",Object.assign({className:"tile-palette-fg-bg"},{children:[(0,s.jsx)("div",Object.assign({className:"tile-palette-swatch fg "+(d==r.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:(0,s.jsx)(l.TimelineFrame,{frames:[{bitmap:g}],colors:e})})),(0,s.jsxs)("div",Object.assign({className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},{children:[(0,s.jsx)(l.TimelineFrame,{frames:[{bitmap:_}],colors:e}),(0,s.jsx)(h.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})]})),(0,s.jsx)("div",Object.assign({className:"tile-palette-swatch wall "+(d==r.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},{children:(0,s.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},{children:(0,s.jsx)("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})}))}))]})),(0,s.jsx)(u.Pivot,{options:m,selected:p?1:0,onChange:this.pivotHandler}),(0,s.jsxs)("div",Object.assign({className:"tile-palette-controls-outer"},{children:[p&&(0,s.jsx)(c.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter((e=>!!e.tiles.length)),selected:o}),!p&&(0,s.jsxs)("div",Object.assign({className:"tile-palette-controls"},{children:[(0,s.jsx)(h.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:I,toggle:!I}),(0,s.jsx)(h.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:I,toggle:!I}),(0,s.jsx)(h.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:I,toggle:!I})]}))]})),(0,s.jsxs)("div",Object.assign({className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},{children:[(0,s.jsxs)("div",Object.assign({className:"tile-canvas"},{children:[(0,s.jsx)("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),y&&(0,s.jsx)("div",Object.assign({ref:"create-tile-ref"},{children:(0,s.jsx)(h.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0})}))]})),(0,s.jsx)("div",Object.assign({className:"tile-canvas-controls"},{children:b(E,a,this.pageHandler)}))]}))]}))}updateGalleryTiles(){const{page:e,category:t,galleryOpen:i}=this.props;this.categoryTiles=i?this.categories[t].tiles:this.getCustomTiles().map((([e,t])=>({index:t,bitmap:e.bitmap})));const s=16*e;this.renderedTiles=this.categoryTiles.slice(s,s+16)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:i,dispatchChangeTilePaletteCategory:s,dispatchChangeTilePalettePage:n}=this.props;if(!e||e<0||e>=t.tiles.length)return;const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map((([e,t])=>e));if(!e)return;const t=Math.max(Math.floor(e.findIndex((e=>e.id==o.id))/16),0);i(!1),n(t)}else{const e=this.categories.find((e=>-1!==e.tiles.findIndex((e=>e.qualifiedName==o.id))));if(!e||!e.tiles)return;const t=Math.max(Math.floor(e.tiles.findIndex((e=>e.qualifiedName==o.id))/16),0);i(!0),s(this.categories.indexOf(e)),n(t)}}redrawCanvas(){const{tileset:e,page:t,selected:i}=this.props,s=4*t*4,n=e.tileWidth+1;this.canvas.width=(4*n+1)*p,this.canvas.height=(4*n+1)*p;const o=this.canvas.getContext("2d");for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=this.categoryTiles[s+4*e+t];r&&(T(r)||r.index!==i||(o.fillStyle="#ff0000",o.fillRect(t*n,e*n,n+1,n+1)),o.fillStyle="#333333",o.fillRect(t*n+1,e*n+1,n-1,n-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(r.bitmap),1+t*n,1+e*n))}this.positionCreateTileButton()}drawBitmap(e,t=0,i=0,s=!0,n=p,o=this.canvas){const{colors:r}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let o=0;o<e.width;o++)for(let l=0;l<e.height;l++){const c=e.get(o,l);c?(a.fillStyle=r[c],a.fillRect((o+t)*n,(l+i)*n,n,n)):s||a.clearRect((o+t)*n,(l+i)*n,n,n)}}handleCanvasClickCore(e,t,i){const s=this.canvas.getBoundingClientRect(),n=(e-s.left)/(s.width/4)|0,o=(t-s.top)/(s.height/4)|0,a=this.renderedTiles[4*o+n];if(a){let e,t;if(T(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,e>=0)i?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:e,backgroundColor:s,tileset:n}=this.props,o=n.tiles.length||1;this.props.dispatchCreateNewTile(null,i?e:o,i?o:s,t)}this.props.dispatchChangeDrawingMode(r.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:t,tileset:i}=e;t&&g.forEach((e=>{e.tiles=t.filter((t=>-1!==t.tags.indexOf(e.id)&&t.tileWidth===i.tileWidth))}))}positionCreateTileButton(){const e=this.refs["create-tile-ref"];if(e){const t=this.categoryTiles.length%4,i=Math.floor(this.categoryTiles.length/4)%4;e.style.position="absolute",e.style.left="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)",e.style.top="calc("+i/4+" * (100% - 0.5rem) + 0.25rem)"}}getCustomTiles(){return this.props.tileset.tiles.map(((e,t)=>[e,t])).filter((([e])=>e.isProjectTile)).sort((([e],[t])=>{const i="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==i?-1:t.id==i?1:e.internalID-t.internalID}))}getTileIndex(e){const{tileset:t}=this.props;for(let i=0;i<t.tiles.length;i++)if(t.tiles[i].id===e.qualifiedName)return i;return-1}}function b(e,t,i){const n=16+5*(e-1),o=[];for(let i=0;i<e;i++)o[i]=i===t;return(0,s.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${n} 10`,className:"tile-palette-pages "+(e<2?"disabled":"")},{children:[(0,s.jsx)("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?()=>i(t-1):void 0}),o.map(((e,t)=>(0,s.jsx)("circle",{className:"tile-palette-page-dot",cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>i(t)},t))),(0,s.jsx)("polygon",{className:"tile-palette-page-arrow",points:`${n-1},5 ${n-4},3 ${n-4},7`,onClick:t<e-1?()=>i(t+1):void 0})]}))}function T(e){return!!e.qualifiedName}const E={dispatchChangeSelectedColor:a.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:a.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:a.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:a.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:a.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:a.dispatchChangeDrawingMode,dispatchCreateNewTile:a.dispatchCreateNewTile,dispatchSetGalleryOpen:a.dispatchSetGalleryOpen,dispatchOpenTileEditor:a.dispatchOpenTileEditor,dispatchDeleteTile:a.dispatchDeleteTile,dispatchShowAlert:a.dispatchShowAlert,dispatchHideAlert:a.dispatchHideAlert};i.TilePalette=(0,o.connect)((function({store:{present:e},editor:t},i){let s=e;return s?{selected:t.selectedColor,tileset:s.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:s.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}}),E)(_)},{"../../../assets":132,"../Button":136,"../Dropdown":138,"../Pivot":141,"../TimelineFrame":144,"../actions/dispatch":147,"../store/imageReducer":151,react:239,"react-redux":225,"react/jsx-runtime":240}],155:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColorEdit=i.outlineEdit=i.flipEdit=i.rotateEdit=i.MarqueeEdit=i.FillEdit=i.CircleEdit=i.LineEdit=i.OutlineEdit=i.RectangleEdit=i.PaintEdit=i.SelectionEdit=i.Edit=i.EditState=i.getEditState=i.getEdit=i.tools=i.ToolCursor=void 0;const s=e("./store/imageReducer");var n,o;(o=n=i.ToolCursor||(i.ToolCursor={})).None="none",o.Default="default",o.Pointer="pointer",o.Crosshair="crosshair",o.Grab="grab",o.Grabbing="grabbing",o.EyeDropper="var(--eyedropper)",i.tools=[{tool:s.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:n.Crosshair},{tool:s.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:n.Crosshair,hoverLayerCursor:n.Grab,downLayerCursor:n.Grabbing},{tool:s.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:n.Grab,downCursor:n.Grabbing},{tool:s.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:n.EyeDropper}],i.getEdit=function(e,t,i,n){switch(e){case s.ImageEditorTool.Paint:return new c(t.width,t.height,i,n);case s.ImageEditorTool.Rect:return new u(t.width,t.height,i,n);case s.ImageEditorTool.Fill:return new p(t.width,t.height,i,n);case s.ImageEditorTool.Line:return new h(t.width,t.height,i,n);case s.ImageEditorTool.Marquee:return new g(t.width,t.height,i,n);case s.ImageEditorTool.Circle:return new d(t.width,t.height,i,n);case s.ImageEditorTool.Erase:return new c(t.width,t.height,0,n);case s.ImageEditorTool.ColorSelect:default:return}},i.getEditState=function(e,t,i=s.TileDrawingMode.Default){const n=new r(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());let o,a,l;return e.overlayLayers&&(n.overlayLayers=e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),n.layerOffsetX=e.layerOffsetX,n.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(a=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(l=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),o={image:a,overlayLayers:l}),n.floating=o,n.setActiveLayer(i),n};class r{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){switch(e){case s.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}}copy(){const e=new r;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map((e=>e.copy())),this.floating){let t,i;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(i=this.floating.overlayLayers.map((e=>e.copy()))),e.floating={image:t,overlayLayers:i}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)})),this.floating.overlayLayers=void 0))}copyToLayer(e,t,i,s,n=!1){if(0===i||0===s)return;i<0&&(e+=i,i=-i),s<0&&(t+=s,s=-s);let o,r=this.image.copy(e,t,i,s);if(this.layerOffsetX=r.x0,this.layerOffsetY=r.y0,r.x0=void 0,r.y0=void 0,this.overlayLayers&&(o=this.overlayLayers.map((n=>n.copy(e,t,i,s)))),n)for(let n=0;n<i;n++)for(let i=0;i<s;i++)this.image.set(e+n,t+i,0),this.overlayLayers&&this.overlayLayers.forEach((s=>s.set(e+n,t+i,0)));this.floating={image:r,overlayLayers:o}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,e>=0&&e<this.floating.image.width&&t>=0&&t<this.floating.image.height)}setFloatingLayer(e,t,i){var s,n;i&&this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!==(s=null==t?void 0:t.layerOffsetX)&&void 0!==s?s:0,this.layerOffsetY=null!==(n=null==t?void 0:t.layerOffsetY)&&void 0!==n?n:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map((e=>e.data())):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map((e=>e.data())):void 0}}}i.EditState=r;class a{constructor(e,t,i,s){this.canvasWidth=e,this.canvasHeight=t,this.color=i,this.toolWidth=s}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return e>=0&&e<this.canvasWidth&&t>=0&&t<this.canvasHeight}start(e,t,i,s,n){this.isStarted=!0,this.startCol=e,this.startRow=t,this.startX=i,this.startY=s}drawCursor(e,t,i){i(e,t)}}i.Edit=a;class l extends a{update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}i.SelectionEdit=l;class c extends a{constructor(e,t,i,s){super(e,t,i,s),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(e,t,i,s){const n=i-e,o=s-t,r=(e,t)=>this.mask.set(e,t);if(0===n){const i=o>=0?s:t;for(let n=o>=0?t:s;n<=i;n++)this.drawCore(e,n,r);return}const a=n>0?1:-1,l=o>0?1:-1,c=Math.abs(o/n);let u=0,h=t;for(let t=e;a>0?t<=i:t>=i;t+=a)for(this.drawCore(t,h,r),u+=c;u>=.5;)(l>0?h<=s:h>=s)&&this.drawCore(t,h,r),h+=l,u-=1}doEditCore(e){e.mergeFloatingLayer();for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)this.mask.get(t,i)&&e.activeLayer.set(t,i,this.color)}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let s=0;s<this.toolWidth;s++)for(let n=0;n<this.toolWidth;n++){const o=e+s,r=t+n;o>=0&&o<this.canvasWidth&&r>=0&&r<this.canvasHeight&&i(e+s,t+n)}}}i.PaintEdit=c;i.RectangleEdit=class extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight();for(let s=t.x;s<=i.x;s++)for(let n=t.y;n<=i.y;n++)e.activeLayer.set(s,n,this.color)}};class u extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();let t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;let i=this.bottomRight();i.x+=this.toolWidth>>1,i.y+=this.toolWidth>>1;for(let s=0;s<this.toolWidth;s++)this.drawRectangle(e,{x:t.x+s,y:t.y+s},{x:i.x-s,y:i.y-s})}drawRectangle(e,t,i){if(!(t.x>i.x||t.y>i.y)){for(let s=t.x;s<=i.x;s++)e.activeLayer.set(s,t.y,this.color),e.activeLayer.set(s,i.y,this.color);for(let s=t.y;s<=i.y;s++)e.activeLayer.set(t.x,s,this.color),e.activeLayer.set(i.x,s,this.color)}}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let s=0;s<this.toolWidth;s++)for(let n=0;n<this.toolWidth;n++){const o=e+s,r=t+n;o>=0&&o<this.canvasWidth&&r>=0&&r<this.canvasHeight&&i(e+s,t+n)}}}i.OutlineEdit=u;class h extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(e,t,i,s,n){const o=i-e,r=s-t,a=(e,t)=>n.activeLayer.set(e,t,this.color);if(0===o){const i=r>=0?s:t;for(let n=r>=0?t:s;n<=i;n++)this.drawCore(e,n,a);return}const l=o>0?1:-1,c=r>0?1:-1,u=Math.abs(r/o);let h=0,d=t;for(let t=e;l>0?t<=i:t>=i;t+=l)for(this.drawCore(t,d,a),h+=u;h>=.5;)(c>0?d<=s:d>=s)&&this.drawCore(t,d,a),d+=c,h-=1}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let s=0;s<this.toolWidth;s++)for(let n=0;n<this.toolWidth;n++)i(e+s,t+n)}}i.LineEdit=h;class d extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight(),s=i.x-t.x,n=i.y-t.y,o=Math.floor(Math.hypot(s,n)),r=this.startCol,a=this.startRow;this.midpoint(r,a,o,e)}midpoint(e,t,i,s){let n=i-1,o=0,r=1,a=1,l=r-2*i;for(;n>=o;)s.activeLayer.set(e+n,t+o,this.color),s.activeLayer.set(e+n,t-o,this.color),s.activeLayer.set(e+o,t+n,this.color),s.activeLayer.set(e+o,t-n,this.color),s.activeLayer.set(e-o,t+n,this.color),s.activeLayer.set(e-o,t-n,this.color),s.activeLayer.set(e-n,t+o,this.color),s.activeLayer.set(e-n,t-o,this.color),l<=0&&(o++,l+=a,a+=2),l>0&&(n--,l+=(r+=2)-2*i)}}i.CircleEdit=d;class p extends a{constructor(){super(...arguments),this.showPreview=!0}start(e,t,i,s,n){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(e){const t=e.activeLayer!==e.image,i=(i,s)=>(t?e.activeLayer.get(i,s)+1<<8:0)+e.image.get(i,s),s=i(this.col,this.row);if(s===this.color)return;e.mergeFloatingLayer();const n=new pxt.sprite.Bitmask(e.width,e.height);n.set(this.col,this.row);const o=[{x:this.col,y:this.row}];for(;o.length;){const t=o.pop();i(t.x,t.y)===s&&(e.activeLayer.set(t.x,t.y,this.color),r(t.x+1,t.y),r(t.x-1,t.y),r(t.x,t.y+1),r(t.x,t.y-1))}function r(e,t){e>=0&&e<n.width&&t>=0&&t<n.height&&!n.get(e,t)&&(n.set(e,t),o.push({x:e,y:t}))}}}i.FillEdit=p;class g extends l{constructor(){super(...arguments),this.isMove=!1,this.isResize=!1,this.showPreview=!1}start(e,t,i,s,n){this.isStarted=!0,this.startCol=e,this.startRow=t;const o=document.elementFromPoint(i,s);if(n.floating&&n.floating.image)if(o&&"image-editor-floating-layer-corner"==o.className){this.isResize=!0,this.startOffsetX=n.layerOffsetX,this.startOffsetY=n.layerOffsetY;let e,t=0;const o=document.getElementsByClassName("image-editor-floating-layer-corner");for(let n=0;n<o.length;n++){let r=Math.sqrt(Math.pow(o[n].getBoundingClientRect().x-i,2)+Math.pow(o[n].getBoundingClientRect().y-s,2));r>t&&(t=r,e=o[n])}const r=document.getElementsByClassName("paint-surface");let a;for(let e=0;e<r.length;e++)r[e].className.includes("main")&&(a=r[e]);const l=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,u=a.getBoundingClientRect().width,h=a.getBoundingClientRect().height;this.anchorCol=(e.getBoundingClientRect().x-l)/u*this.canvasWidth,this.anchorRow=(e.getBoundingClientRect().y-c)/h*this.canvasHeight,this.originalImage||(this.originalImage=n.floating.image.copy())}else n.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=n.layerOffsetX,this.startOffsetY=n.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){const t=this.topLeft(),i=this.bottomRight();if(this.isDragged)if(this.isMove)e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow;else if(this.isResize){const t=Math.round(Math.abs(this.anchorCol-this.endCol)),i=Math.round(Math.abs(this.anchorRow-this.endRow)),s=function(e,t,i){const s=new pxt.sprite.Bitmap(t,i,0,0);for(let n=0;n<t;n++)for(let o=0;o<i;o++){const r=Math.floor(n/t*e.width),a=Math.floor(o/i*e.height),l=e.get(r,a);s.set(n,o,l)}return s}(this.originalImage,t,i);e.setFloatingLayer(s,{layerOffsetX:Math.round(Math.min(this.anchorCol,this.endCol)),layerOffsetY:Math.round(Math.min(this.anchorRow,this.endRow))},!1)}else e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,i.x-t.x+1,i.y-t.y+1,!0);else this.isMove||e.mergeFloatingLayer()}}i.MarqueeEdit=g,i.rotateEdit=function(e,t,i,s){var n;const o=!!(null===(n=e.floating)||void 0===n?void 0:n.image),a=o?e.floating:e,l=i?new pxt.sprite.Tilemap(a.image.height,a.image.width):new pxt.sprite.Bitmap(a.image.height,a.image.width),c=a.overlayLayers?a.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.height,e.width))):void 0;for(let e=0;e<a.image.width;e++)for(let t=0;t<a.image.height;t++)h(a.image,l,e,t),c&&c.forEach(((i,s)=>h(a.overlayLayers[s],i,e,t)));const u=l.width===l.height&&l.width===e.image.width&&e.image.width===e.image.height;if(!s&&!o||u){const e=new r(l);return e.overlayLayers=c,e}if(!o)for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)e.image.set(t,i,0),e.overlayLayers&&e.overlayLayers.forEach((e=>null==e?void 0:e.set(t,i,0)));return(l.width===e.image.height&&l.height===e.image.width||l.width===e.image.width&&l.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(l.width>>1),e.layerOffsetY=(e.height>>1)-(l.height>>1)),e.floating={image:l,overlayLayers:c},e;function h(e,i,s,n){t?i.set(n,s,e.get(s,e.height-n-1)):i.set(n,s,e.get(e.width-s-1,n))}},i.flipEdit=function(e,t,i){var s,n;const o=(null===(s=e.floating)||void 0===s?void 0:s.image)?e.floating:e,a=i?new pxt.sprite.Tilemap(o.image.width,o.image.height):new pxt.sprite.Bitmap(o.image.width,o.image.height),l=o.overlayLayers?o.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.width,e.height))):void 0;for(let e=0;e<o.image.width;e++)for(let t=0;t<o.image.height;t++)c(o.image,a,e,t),l&&l.forEach(((i,s)=>c(o.overlayLayers[s],i,e,t)));if(null===(n=e.floating)||void 0===n?void 0:n.image)return e.floating={image:a,overlayLayers:l},e;{const e=new r(a);return e.overlayLayers=l,e}function c(e,i,s,n){t?i.set(s,n,e.get(s,e.height-n-1)):i.set(s,n,e.get(e.width-s-1,n))}},i.outlineEdit=function(e,t){var i,s;const n=(null===(i=e.floating)||void 0===i?void 0:i.image)?e.floating:e,o=e.copy(),r=(null===(s=null==e?void 0:e.floating)||void 0===s?void 0:s.image)?o.floating.image:o.image;for(let e=0;e<n.image.width;e++)for(let i=0;i<n.image.height;i++)0===n.image.get(e,i)&&(0===n.image.get(e-1,i)&&0===n.image.get(e,i-1)&&0===n.image.get(e+1,i)&&0===n.image.get(e,i+1)||r.set(e,i,t));return o},i.replaceColorEdit=function(e,t,i){var s,n;const o=(null===(s=e.floating)||void 0===s?void 0:s.image)?e.floating:e,r=e.copy(),a=(null===(n=null==e?void 0:e.floating)||void 0===n?void 0:n.image)?r.floating.image:r.image;for(let e=0;e<o.image.width;e++)for(let s=0;s<o.image.height;s++)o.image.get(e,s)===t&&a.set(e,s,i);return r}},{"./store/imageReducer":151}],156:[function(e,t,i){"use strict";function s(){return"undefined"!=typeof window&&!!window.PointerEvent}function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}var o;Object.defineProperty(i,"__esModule",{value:!0}),i.createTilemapPatchFromFloatingLayer=i.applyBitmapData=i.imageStateToTilemap=i.imageStateToBitmap=i.bindGestureEvents=i.GestureState=i.fireClickOnlyOnEnter=i.clientCoord=i.pointerEvents=i.Bitmask=i.MapTools=i.isBitmapSupported=i.isTouchEnabled=i.hasPointerEvents=i.DRAG_RADIUS=void 0,i.DRAG_RADIUS=3,i.hasPointerEvents=s,i.isTouchEnabled=n,i.isBitmapSupported=function(){return!!window.createImageBitmap},(o=i.MapTools||(i.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase";function r(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}i.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){const i=e+this.width*t,s=i>>3,n=7&i;this.mask[s]|=1<<n}get(e,t){const i=e+this.width*t,s=i>>3,n=7&i;return this.mask[s]>>n&1}},i.pointerEvents=s()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:n()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},i.clientCoord=r,i.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class a{constructor(e,t,i){this.target=e,this.isRightClick=i,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>i.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(e,t){for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier===t)return e.changedTouches[i]}function c(e){return e.button>0}i.GestureState=a,i.bindGestureEvents=function(e,t){s()?function(e,t){let i;e.addEventListener("pointerup",(e=>{i&&(i.end(r(e)),e.preventDefault()),i=void 0})),e.addEventListener("pointerdown",(e=>{i&&i.end(),i=new a(t,r(e),c(e)),e.preventDefault()})),e.addEventListener("pointermove",(e=>{i&&(i.update(r(e)),e.preventDefault())})),e.addEventListener("pointerleave",(e=>{i&&(i.end(r(e)),e.preventDefault()),i=void 0}))}(e,t):n()?function(e,t){let i,s;e.addEventListener("touchend",(e=>{if(i&&s){const t=l(e,s);t&&(i.end(t),i=void 0,e.preventDefault())}})),e.addEventListener("touchstart",(e=>{i&&i.end(),s=e.changedTouches[0].identifier,i=new a(t,e.changedTouches[0],c(e))})),e.addEventListener("touchmove",(e=>{if(i&&s){const t=l(e,s);t&&(i.update(t),e.preventDefault())}})),e.addEventListener("touchcancel",(e=>{if(i&&s){const t=l(e,s);t&&(i.end(t),i=void 0,e.preventDefault())}}))}(e,t):function(e,t){let i;e.addEventListener("mouseup",(e=>{i&&i.end(r(e)),i=void 0})),e.addEventListener("mousedown",(e=>{i&&i.end(),i=new a(t,r(e),c(e))})),e.addEventListener("mousemove",(e=>{i&&i.update(r(e))})),e.addEventListener("mouseleave",(e=>{i&&i.end(r(e)),i=void 0}))}(e,t)},i.imageStateToBitmap=function(e){const t=pxt.sprite.Bitmap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Bitmap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.imageStateToTilemap=function(e){const t=pxt.sprite.Tilemap.fromData(e.bitmap).copy();if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Tilemap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.applyBitmapData=function(e,t,i=0,s=0){if(!e||!t)return e;const n=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=i,o.y0=s,n.apply(o,!0),n.data()},i.createTilemapPatchFromFloatingLayer=function(e,t){if(!e.floating)return;const i=pxt.sprite.Tilemap.fromData(e.floating.image.data()),s=new pxt.sprite.Tilemap(i.width,i.height),n=e.floating.overlayLayers?e.floating.overlayLayers.map((e=>pxt.sprite.base64EncodeBitmap(e.data()))):[];let o=[];for(let e=0;e<i.width;e++)for(let n=0;n<i.height;n++){const r=t.tiles[i.get(e,n)],a=o.indexOf(r);-1===a?(s.set(e,n,o.length),o.push(r)):s.set(e,n,a)}return{map:pxt.sprite.hexEncodeTilemap(s),layers:n,tiles:o.map((e=>pxt.sprite.base64EncodeBitmap(e.bitmap)))}}},{}],157:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageFieldEditor=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./assetEditor/assetCard"),r=e("../assets"),a=e("./ImageEditor/ImageEditor"),l=e("./ImageEditor/keyboardShortcuts"),c=e("./ImageEditor/store/imageReducer"),u=e("./FilterPanel"),h=e("../util"),d=e("../../../react-common/components/controls/EditorToggle"),p=e("./MusicFieldEditor"),g=e("../../../react-common/components/util");class m extends n.Component{constructor(e){super(e),this.tagClickHandler=e=>{let t=this.state.gallerySelectedTags;const i=e.toLowerCase(),s=t.indexOf(i);s<0?t.push(i):t.splice(s,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),_("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),_("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),_("gallery-my-assets"),this.userAssets=(0,r.getAssets)(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,i;if(this.ref&&e.id!==(null===(t=this.asset)||void 0===t?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null===(i=this.asset)||void 0===i?void 0:i.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}_("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},(0,c.setTelemetryFunction)(_)}get asset(){var e;return null===(e=this.ref)||void 0===e?void 0:e.getAsset()}render(){var e,t,i,n,o;const{currentView:r,headerVisible:l,editingTile:c,hideMyAssets:m,filterOpen:_,hideCloseButton:b}=this.state,T="gallery"===this.state.currentView&&_;let E=l,y=!this.props.isMusicEditor&&(!this.asset||c||"tilemap"!==this.asset.type);const I=!m&&!c;this.asset&&!this.galleryAssets&&y&&this.updateGalleryAssets(),(null===(e=this.galleryAssets)||void 0===e?void 0:e.length)||(y=!1);const k=this.props.includeSpecialTagsInFilter?[]:["tile","dialog","background"];let v=[],C=[];switch(r){case"my-assets":C=this.filterAssetsByType(this.userAssets,c?"tile":null===(t=this.asset)||void 0===t?void 0:t.type),v=this.getAvailableTags(C,k);break;case"gallery":C=this.filterAssetsByType(this.galleryAssets,c?"tile":null===(i=this.asset)||void 0===i?void 0:i.type,!0,!0),v=this.getAvailableTags(C,k),C=this.filterAssetsByTag(C)}const S=[{label:lf("Editor"),title:lf("Editor"),focusable:!0,icon:"fas fa-paint-brush",onClick:this.showEditor,view:"editor"},{label:lf("Gallery"),title:lf("Gallery"),focusable:!0,icon:"fas fa-image",onClick:this.showGallery,view:"gallery"},{label:lf("My Assets"),title:lf("My Assets"),focusable:!0,icon:"fas fa-folder",onClick:this.showMyAssets,view:"my-assets"}];return y||I?y?I||S.splice(2,1):S.splice(1,1):E=!1,(0,s.jsxs)("div",Object.assign({className:(0,g.classList)("image-editor-wrapper",this.props.isMusicEditor&&"music-asset-editor")},{children:[E&&(0,s.jsxs)("div",Object.assign({className:"gallery-editor-header"},{children:[(0,s.jsx)("div",{className:"image-editor-header-left"}),(0,s.jsx)("div",Object.assign({className:"image-editor-header-center"},{children:(0,s.jsx)(d.EditorToggle,{id:"image-editor-toggle",className:"slim tablet-compact",items:S,selected:S.findIndex((e=>e.view===r))})})),(0,s.jsxs)("div",Object.assign({className:"image-editor-header-right"},{children:[(0,s.jsxs)("div",Object.assign({className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:h.fireClickOnEnter},{children:[(0,s.jsx)("div",Object.assign({className:"gallery-filter-button-icon"},{children:(0,s.jsx)("i",{className:"icon filter"})})),(0,s.jsx)("div",Object.assign({className:"gallery-filter-button-label"},{children:lf("Filter")}))]})),!c&&!b&&(0,s.jsx)("div",Object.assign({className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},{children:(0,s.jsx)("i",{className:"ui icon close"})}))]}))]})),(0,s.jsxs)("div",Object.assign({className:"image-editor-gallery-window"},{children:[(0,s.jsxs)("div",Object.assign({className:"image-editor-gallery-content"},{children:[this.props.isMusicEditor?(0,s.jsx)(p.MusicFieldEditor,{ref:"image-editor",onDoneClicked:this.onDoneClick,hideDoneButton:this.props.hideDoneButton}):(0,s.jsx)(a.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode,hideDoneButton:this.props.hideDoneButton,hideAssetName:!(null===(o=null===(n=pxt.appTarget)||void 0===n?void 0:n.appTheme)||void 0===o?void 0:o.assetEditor)}),(0,s.jsx)(f,{items:C,hidden:"editor"===r,onAssetSelected:this.onAssetSelected})]})),(0,s.jsx)("div",Object.assign({className:"filter-panel-gutter "+(T?"":"hidden")},{children:(0,s.jsx)("div",Object.assign({className:"filter-panel-container"},{children:(0,s.jsx)(u.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:v})}))}))]}))]}))}componentDidMount(){this.ref=this.refs["image-editor"],_("image-editor-shown")}componentWillUnmount(){_("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,i){switch(this.closeEditor=t,this.options=i,this.lightMode=i.lightMode,e.type){case"image":this.initSingleFrame(e,i);break;case"tile":i.disableResize=!0,this.initSingleFrame(e,i);break;case"animation":this.initAnimation(e,i);break;case"tilemap":this.initTilemap(e,i);break;case"song":this.ref.openAsset(e)}this.editID=e.id;let s=!1;i&&(this.blocksInfo=i.blocksInfo,i.filter&&(this.setState({galleryFilter:i.filter}),s=!0),null!=i.headerVisible&&(this.setState({headerVisible:i.headerVisible}),s=!0),null!=i.hideMyAssets&&(this.setState({hideMyAssets:i.hideMyAssets}),s=!0),null!=i.hideCloseButton&&(this.setState({hideCloseButton:i.hideCloseButton}),s=!0)),s||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){return this.ref?this.ref.getJres():""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options&&this.options.disableResize&&this.ref.disableResize())}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=(0,r.getAssets)(!0,this.asset.type)}getAvailableTags(e,t){let i=[];return this.galleryAssets?(e.forEach((e=>{var s;null===(s=e.meta.tags)||void 0===s||s.forEach((e=>{const s=function(e){let t=0===e.indexOf("?")&&e.length>1?e.substring(1):e;return t.toLowerCase()}(e);t.indexOf(s)<0&&i.indexOf(s)<0&&i.push(s)}))})),i):[]}filterAssetsByTag(e){return this.state.gallerySelectedTags.length>0&&this.state.filterOpen&&(e=e.filter((e=>{var t;return!!(null===(t=e.meta.tags)||void 0===t?void 0:t.find((e=>this.state.gallerySelectedTags.indexOf(e)>=0)))}))),e}filterAssetsByType(e,t,i=!1,s){var n;if(void 0===t&&(t=null===(n=this.asset)||void 0===n?void 0:n.type),void 0===t)return e;if(this.asset&&!i&&(e=e.map((e=>e.type!==this.asset.type||e.id!==this.asset.id?e:(0,r.assetToGalleryItem)(this.getValue()))),this.state.editingTile)){const t=this.ref.getAsset();e=e.map((e=>{var i;return(null===(i=t.data.editedTiles)||void 0===i?void 0:i.indexOf(e.id))>=0?(0,r.assetToGalleryItem)(t.data.tileset.tiles.find((t=>t.id===e.id))):e}))}if(s){e.forEach((e=>{var t,i,s;!e.meta.tags&&this.options&&(e.meta.tags=(null===(s=null===(i=null===(t=this.blocksInfo)||void 0===t?void 0:t.apis.byQName[e.id])||void 0===i?void 0:i.attributes.tags)||void 0===s?void 0:s.split(" "))||[])}));const t=this.state.galleryFilter.split(" ").filter((e=>!!e)).map((e=>e.toLowerCase())),i=t.filter((e=>0!==e.indexOf("!"))),s=t.filter((e=>0===e.indexOf("!")&&e.length>1)).map((e=>e.substring(1)));e=e.filter((e=>function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>{const t=`?${e}`;return i.some((i=>i===e||i===t))}))}(e,i)&&function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>!i.some((t=>t===e))))}(e,s)))}if(i)switch(t){case"animation":return e.filter((e=>"animation"===e.type||"tile"===e.type||"image"===e.type));case"image":return e.filter((e=>"tile"===e.type||"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}else switch(t){case"animation":return e.filter((e=>"animation"===e.type));case"image":return e.filter((e=>"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type));case"song":return e.filter((e=>"song"===e.type))}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let i;(null==t?void 0:t.blocksInfo)&&(this.blocksInfo=t.blocksInfo,i=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map((e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),(null==t?void 0:t.galleryTiles)&&(i=t.galleryTiles.map((e=>({bitmap:e.bitmap,tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),this.ref.openAsset(e,i)}loadJres(e){this.ref&&this.ref.loadJres(e)}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?((0,l.releaseShortcutLock)(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=(0,l.obtainShortcutLock)())}}i.ImageFieldEditor=m;class f extends n.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){let{items:e,hidden:t}=this.props;return(0,s.jsx)("div",Object.assign({className:"image-editor-gallery "+(e&&!t?"visible":"")},{children:!t&&e&&e.map(((e,t)=>(0,s.jsx)(o.AssetCardView,{asset:e,selected:!1,onClick:this.clickHandler},t)))}))}}n.Component;function _(e){pxt.tickEvent("image.editor",{action:e})}},{"../../../react-common/components/controls/EditorToggle":125,"../../../react-common/components/util":130,"../assets":132,"../util":180,"./FilterPanel":133,"./ImageEditor/ImageEditor":140,"./ImageEditor/keyboardShortcuts":149,"./ImageEditor/store/imageReducer":151,"./MusicFieldEditor":158,"./assetEditor/assetCard":161,react:239,"react/jsx-runtime":240}],158:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MusicFieldEditor=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./musicEditor/MusicEditor");class r extends n.Component{constructor(e){super(e),this.onSongChanged=e=>{this.mostRecentValue=e},this.onAssetNameChanged=e=>{this.setState({editingSong:Object.assign(Object.assign({},this.state.editingSong),{meta:Object.assign(Object.assign({},this.state.editingSong.meta),{displayName:e})})})},this.state={editRef:0}}render(){const{onDoneClicked:e}=this.props,{editingSong:t}=this.state;return(0,s.jsx)("div",Object.assign({className:"music-field-editor"},{children:t&&(0,s.jsx)(o.MusicEditor,{asset:t,onSongChanged:this.onSongChanged,onAssetNameChanged:this.onAssetNameChanged,editRef:this.state.editRef,onDoneClicked:e,hideDoneButton:this.props.hideDoneButton})}))}getAsset(){if(this.state.editingSong)return Object.assign(Object.assign({},this.state.editingSong),{song:this.mostRecentValue||this.state.editingSong.song})}openAsset(e){pxt.assets.music.inflateSong(e.song),this.setState({editingSong:e,editRef:this.state.editRef+1})}openGalleryAsset(e){}getJres(){return""}loadJres(e){}disableResize(){}onResize(){}getPersistentData(){}restorePersistentData(e){}}i.MusicFieldEditor=r},{"./musicEditor/MusicEditor":166,react:239,"react/jsx-runtime":240}],159:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchUpdateGalleryAssets=i.dispatchUpdateUserAssets=i.dispatchChangeGalleryView=i.dispatchChangeSelectedAsset=void 0;const s=e("./types");i.dispatchChangeSelectedAsset=(e,t)=>({type:s.CHANGE_SELECTED_ASSET,assetType:e,assetId:t});i.dispatchChangeGalleryView=(e,t,i)=>({type:s.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:i});i.dispatchUpdateUserAssets=()=>({type:s.UPDATE_USER_ASSETS});i.dispatchUpdateGalleryAssets=()=>({type:s.UPDATE_GALLERY_ASSETS})},{"./types":160}],160:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UPDATE_GALLERY_ASSETS=i.UPDATE_USER_ASSETS=i.CHANGE_GALLERY_VIEW=i.CHANGE_SELECTED_ASSET=void 0,i.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",i.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",i.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",i.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],161:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCard=i.AssetCardView=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("react-redux"),r=e("./store/assetEditorReducerState"),a=e("./actions/dispatch"),l=e("./assetPreview");class c extends n.Component{constructor(){super(...arguments),this.clickHandler=()=>{const{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){const{asset:e,selected:t}=this.props;return(0,s.jsx)(u,{asset:e,selected:t,onClick:this.clickHandler})}}class u extends n.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";case"song":return"music";case"image":default:return null}}render(){var e,t;const{asset:i,selected:n}=this.props,o=(0,r.isGalleryAsset)(i),a=this.getDisplayIconForAsset(i.type),c=a||!(null===(e=i.meta)||void 0===e?void 0:e.displayName);return(0,s.jsxs)("div",Object.assign({className:"asset-editor-card "+(n?"selected":""),onClick:this.clickHandler,role:"listitem"},{children:[(0,s.jsx)(l.AssetPreview,{asset:i}),c&&(0,s.jsxs)("div",Object.assign({className:"asset-editor-card-label"},{children:[a&&(0,s.jsx)("div",Object.assign({className:"asset-editor-card-icon"},{children:(0,s.jsx)("i",{className:`icon ${a}`})})),!(null===(t=i.meta)||void 0===t?void 0:t.displayName)&&!o&&(0,s.jsx)("div",Object.assign({className:"asset-editor-card-icon warning"},{children:(0,s.jsx)("i",{className:"icon exclamation triangle"})}))]}))]}))}}i.AssetCardView=u;const h={dispatchChangeSelectedAsset:a.dispatchChangeSelectedAsset};i.AssetCard=(0,o.connect)((function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}}),h)(c)},{"./actions/dispatch":159,"./assetPreview":162,"./store/assetEditorReducerState":163,react:239,"react-redux":225,"react/jsx-runtime":240}],162:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetPreview=void 0;const s=e("react/jsx-runtime"),n=e("react");class o extends n.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1&&(this.currentFrame=0,this.animationIntervalRef=setInterval((()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length}),Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e;const{asset:t}=this.props,i="animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1,n=t.meta.displayName||(t.meta.temporaryInfo?lf("Temporary Asset"):t.id);return(0,s.jsx)("div",Object.assign({className:"asset-editor-preview",title:n},{children:(0,s.jsx)("img",{src:t.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:i?this.onMouseEnter:void 0,onMouseLeave:i?this.onMouseLeave:void 0,ref:i?this.handleRef:void 0,loading:"lazy"})}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}i.AssetPreview=o},{react:239,"react/jsx-runtime":240}],163:[function(e,t,i){"use strict";var s;Object.defineProperty(i,"__esModule",{value:!0}),i.isGalleryAsset=i.GalleryView=void 0,(s=i.GalleryView||(i.GalleryView={}))[s.User=0]="User",s[s.Gallery=1]="Gallery",i.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")}},{}],164:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EditControls=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../../../../react-common/components/controls/Button"),r=e("../../../../react-common/components/controls/Input"),a=e("../../assets");i.EditControls=e=>{const{onAssetNameChanged:t,onDoneClicked:i,assetName:l,hideDoneButton:c}=e,[u,h]=n.useState(),[d,p]=n.useState(),g=e=>{let i=null;const s=e.trim();if(!s)return h(void 0),void p(void 0);pxt.validateAssetName(s)?(0,a.isNameTaken)(s)&&s!==l&&(i=lf("This name is already used elsewhere in your project")):i=lf("Names may only contain letters, numbers, '-', '_', and space"),i?(h(s),p(i)):(t(s),h(void 0),p(void 0))};return(0,s.jsxs)("div",Object.assign({className:"music-editor-edit-controls"},{children:[d&&(0,s.jsx)("div",Object.assign({className:"music-editor-name-error"},{children:d})),(0,s.jsx)(r.Input,{placeholder:lf("Asset Name"),initialValue:l||u,onBlur:g,onEnterKey:g}),!c&&(0,s.jsx)(o.Button,{className:"green",title:lf("Done"),label:lf("Done"),onClick:i})]}))}},{"../../../../react-common/components/controls/Button":122,"../../../../react-common/components/controls/Input":128,"../../assets":132,react:239,"react/jsx-runtime":240}],165:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GridHighlight=void 0;const s=e("react/jsx-runtime"),n=e("./svgConstants");i.GridHighlight=e=>{const{start:t,end:i,ticksPerBeat:o}=e,r=null!=t&&null!=i,a=Math.min(t,i),l=Math.max(t,i);return r?(0,s.jsxs)("g",{children:[(0,s.jsx)("rect",{fill:"#03adfc",x:(0,n.tickToX)(o,a),y:n.STAFF_HEADER_HEIGHT-n.STAFF_GRID_TICK_HEIGHT,width:(0,n.tickToX)(o,l)-(0,n.tickToX)(o,a),height:n.STAFF_GRID_TICK_HEIGHT}),(0,s.jsx)("rect",{fill:"#03adfc",x:(0,n.tickToX)(o,a),y:n.BASS_STAFF_TOP+n.STAFF_HEADER_HEIGHT-n.STAFF_GRID_TICK_HEIGHT,width:(0,n.tickToX)(o,l)-(0,n.tickToX)(o,a),height:n.STAFF_GRID_TICK_HEIGHT})]}):(0,s.jsx)("g",{})}},{"./svgConstants":178,"react/jsx-runtime":240}],166:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MusicEditor=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./EditControls"),r=e("./keyboardNavigation"),a=e("./playback"),l=e("./PlaybackControls"),c=e("./ScrollableWorkspace"),u=e("./TrackSelector"),h=e("./utils");i.MusicEditor=e=>{const{asset:t,onSongChanged:i,savedUndoStack:d,onAssetNameChanged:p,editRef:g,onDoneClicked:m,hideDoneButton:f}=e,[_,b]=n.useState(0),[T,E]=n.useState("1/8"),[y,I]=n.useState(t.song),[k,v]=n.useState(!1),[C,S]=n.useState(!1),[O,A]=n.useState(d||[]),[w,R]=n.useState([]),[N,x]=n.useState(g),[L,$]=n.useState(),[D,M]=n.useState(),[B,P]=n.useState(!1),[F,U]=n.useState((0,h.doesSongUseBassClef)(t.song));n.useEffect((()=>()=>{(0,a.stopPlayback)()}),[]),n.useEffect((()=>{const e=e=>{L&&(e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(L)))},t=e=>{if(L){e.preventDefault(),e.stopPropagation(),e.clipboardData.setData("application/makecode-song",JSON.stringify(L));const t=(0,h.applySelection)(L,C?_:void 0);j((0,h.deleteSelectedNotes)(t),!0)}},i=e=>{const t=e.clipboardData.getData("application/makecode-song");if(t){const e=JSON.parse(t);let i;i=L?{originalSong:(0,h.unselectAllNotes)((0,h.applySelection)(L,C?_:void 0)),pastedContent:e,startTick:L.startTick,endTick:L.startTick+(e.endTick-e.startTick),deltaTick:0,transpose:0}:{originalSong:y,pastedContent:e,startTick:0,endTick:e.endTick-e.startTick,deltaTick:0,transpose:0},j((0,h.applySelection)(i,C?_:void 0),!1),$(i)}};return document.addEventListener("copy",e),document.addEventListener("cut",t),document.addEventListener("paste",i),()=>{document.removeEventListener("copy",e),document.removeEventListener("cut",t),document.removeEventListener("paste",i)}}),[L,C,y]),N!==g&&(x(g),I(t.song));const H=n.useRef(),G=k?1:function(e,t){switch(e){case"1/4":return t;case"1/8":return t/2;case"1/16":return t/4;case"1/32":return t/8}}(T,y.ticksPerBeat),V=!!y.tracks[_].drums,j=(e,t)=>{var s;(0,a.isPlaying)()&&(0,a.updatePlaybackSongAsync)(e);let n=O.slice();t&&(n.push(pxt.assets.music.cloneSong((null==L?void 0:L.originalSong)||(null===(s=H.current)||void 0===s?void 0:s.original)||y)),A(n),R([])),I(e),i&&i(e),H.current&&(H.current.editing=e)},W=()=>{var e,t;let i;return $(void 0),"move"===(null===(e=null==H?void 0:H.current)||void 0===e?void 0:e.dragType)?i=(0,h.unselectAllNotes)(H.current.editing):(0,h.findSelectedRange)(y)&&(i=(0,h.unselectAllNotes)(y)),i&&(j(i,!0),"move"===(null===(t=null==H?void 0:H.current)||void 0===t?void 0:t.dragType)&&(H.current=void 0)),i},Y=e=>{M(D?Object.assign(Object.assign({},D),{tick:e}):{tick:e,gridTicks:G,track:_,bassClef:!1,hideTracksActive:C,selection:L})};return(0,s.jsxs)("div",Object.assign({className:"music-editor"},{children:[(0,s.jsx)(u.TrackSelector,{song:y,selected:_,onTrackSelected:e=>{W(),P(!1);const t=y.tracks[e];t.drums?pxsim.music.playDrumAsync(t.drums[0]):pxsim.music.playNoteAsync((0,h.rowToNote)(t.instrument.octave,6,!1,!!t.drums).note,t.instrument,pxsim.music.tickToMs(y.beatsPerMinute,y.ticksPerBeat,y.ticksPerBeat/2)),b(e),D&&M(Object.assign(Object.assign({},D),{track:e})),k&&v(!1)},eraserActive:k,onEraserClick:()=>{W(),P(!1),v(!k)},hideTracksActive:C,onHideTracksClick:()=>{W(),P(!1),S(!C)},selectedResolution:T,onResolutionSelected:E}),(0,s.jsx)(c.ScrollableWorkspace,{song:y,selectedTrack:_,eraserActive:k,onWorkspaceClick:(e,t)=>{P(!1);const i=y.tracks[_],s=i.instrument,n=(0,h.findPreviousNoteEvent)(y,_,e.tick),o=(0,h.findPreviousNoteEvent)(y,_,e.exactTick);W(),Y(e.tick);const r=t=>(0,h.isBassClefNote)(s.octave,t,V)===e.isBassClef&&(0,h.noteToRow)(s.octave,t,V)===e.row;let a,l;if((null==o?void 0:o.startTick)===e.exactTick&&o.notes.some(r)?(a=e.exactTick,l=o):(null==n?void 0:n.startTick)===e.tick&&n.notes.some(r)&&(a=e.tick,l=n),l){const i=(0,h.unselectAllNotes)(y);if(t&&!V){const t=l.notes.find(r),n=12*s.octave-20,o=12*s.octave+20,c=(0,h.removeNoteAtRowFromTrack)(i,_,e.row,e.isBassClef,a);let u;u="normal"===t.enharmonicSpelling&&t.note<o?"sharp":"sharp"===t.enharmonicSpelling&&t.note>n||t.note===o?"flat":"normal";const d=(0,h.rowToNote)(s.octave,e.row,e.isBassClef,V,u);j((0,h.addNoteToTrack)(c,_,d,l.startTick,l.endTick),!0),pxsim.music.playNoteAsync(d.note,s,pxsim.music.tickToMs(y.beatsPerMinute,y.ticksPerBeat,l.endTick-l.startTick))}else j((0,h.removeNoteAtRowFromTrack)(i,_,e.row,e.isBassClef,a),!0)}else{if(k){for(let t=0;t<y.tracks.length;t++){if(C&&t!==_)continue;const i=(0,h.findPreviousNoteEvent)(y,t,e.tick),s=(0,h.findPreviousNoteEvent)(y,t,e.exactTick);let n,o;(null==s?void 0:s.startTick)===e.exactTick&&s.notes.some(r)?(n=e.exactTick,o=s):(null==i?void 0:i.startTick)===e.tick&&i.notes.some(r)&&(n=e.tick,o=i),((null==o?void 0:o.startTick)===n||(null==o?void 0:o.endTick)>n)&&o.notes.some(r)&&j((0,h.removeNoteAtRowFromTrack)(y,t,e.row,e.isBassClef,o.startTick),!1)}return}{const t=(0,h.rowToNote)(s.octave,e.row,e.isBassClef,V),n=y.beatsPerMeasure*y.ticksPerBeat*y.measures;if(e.tick===n)return;const o=V?1:G;j((0,h.unselectAllNotes)((0,h.addNoteToTrack)(y,_,t,e.tick,e.tick+o)),!0),V?pxsim.music.playDrumAsync(i.drums[t.note]):pxsim.music.playNoteAsync(t.note,s,pxsim.music.tickToMs(y.beatsPerMinute,y.ticksPerBeat,G))}}},onWorkspaceDragStart:()=>{if(P(!1),H.current)return H.current.editing=y,H.current.original=y,void(H.current.selectionAtDragStart=L&&Object.assign({},L));H.current={editing:y,original:y,selectionAtDragStart:L&&Object.assign({},L)}},onWorkspaceDragEnd:()=>{if("move"===H.current.dragType){const e=H.current.dragEnd.tick-H.current.dragStart.tick,t=H.current.dragEnd.row-(H.current.dragEnd.isBassClef?12:0)-(H.current.dragStart.row-(H.current.dragStart.isBassClef?12:0));return $(Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:H.current.selectionAtDragStart.deltaTick+e,transpose:H.current.selectionAtDragStart.transpose+t})),H.current.dragStart=void 0,H.current.dragEnd=void 0,void(H.current.selectionAtDragStart=void 0)}if("note-length"===H.current.dragType&&W(),pxt.assets.music.songEquals(H.current.editing,H.current.original)||j(H.current.editing,!0),"marquee"===H.current.dragType){const e=(0,h.findSelectedRange)(H.current.editing,G);$(e?{startTick:e.start,endTick:e.end,deltaTick:0,transpose:0,originalSong:H.current.editing}:void 0)}H.current=void 0},onWorkspaceDrag:(e,t)=>{if(Y(t.tick),k){for(let e=0;e<y.tracks.length;e++){if(C&&e!==_)continue;const i=y.tracks[e].instrument,s=(0,h.findPreviousNoteEvent)(y,e,t.exactTick),n=e=>(0,h.isBassClefNote)(i.octave,e,V)===t.isBassClef&&(0,h.noteToRow)(i.octave,e,V)===t.row;((null==s?void 0:s.startTick)===t.exactTick||(null==s?void 0:s.endTick)>t.exactTick)&&s.notes.some(n)&&j((0,h.removeNoteAtRowFromTrack)(y,e,t.row,t.isBassClef,s.startTick),!1)}return}if(H.current.dragType=void 0,H.current.dragStart=e,H.current.dragEnd=t,H.current.original.tracks[_].drums)return void j((0,h.fillDrums)(H.current.original,_,e.row,e.tick,t.tick,G),!1);if(H.current.selectionAtDragStart){const i=(0,h.findNoteEventAtPosition)(H.current.original,e,C?_:void 0);if(null==i?void 0:i.selected){H.current.dragType="move";const i=t.tick-e.tick,s=t.row-(t.isBassClef?12:0)-(e.row-(e.isBassClef?12:0)),n=Object.assign(Object.assign({},H.current.selectionAtDragStart),{deltaTick:i+H.current.selectionAtDragStart.deltaTick,transpose:s+H.current.selectionAtDragStart.transpose}),o=(0,h.applySelection)(n,C?_:void 0);return j(o,!1),void $(n)}}const i=(0,h.findPreviousNoteEvent)(H.current.original,_,e.exactTick);if(!V&&i&&e.exactTick>=i.startTick&&e.exactTick<i.endTick){let s=!1;for(const t of i.notes)if((0,h.noteToRow)(y.tracks[_].instrument.octave,t,!1)===e.row){s=!0;break}if(s){if(t.tick<i.startTick+1)return;return $(void 0),H.current.dragType="note-length",void j((0,h.editNoteEventLength)(H.current.original,_,i.startTick,t.tick),!1)}}$({startTick:e.tick,endTick:t.tick,deltaTick:0,transpose:0,originalSong:H.current.editing}),j((0,h.selectNoteEventsInRange)(H.current.original,e.tick,t.tick,C?_:void 0),!1),H.current.dragType="marquee"},gridTicks:G,hideUnselectedTracks:C,showBassClef:F,selection:L,cursor:B?D:void 0,onKeydown:e=>{P(!0);let t=D;t||(t={tick:0,gridTicks:G,track:_,bassClef:!1,hideTracksActive:C,selection:L}),t.gridTicks=G,t.track=_,t.selection=L,t.hideTracksActive=C;const[i,s]=(0,r.handleKeyboardEvent)(y,t,e);pxt.assets.music.songEquals(i,y)||j(i,!s.selection),s.selection?$(s.selection):$(void 0),M(s)}}),(0,s.jsx)(l.PlaybackControls,{song:y,onTempoChange:e=>{W(),P(!1),j(Object.assign(Object.assign({},y),{beatsPerMinute:e}),!0)},onMeasuresChanged:e=>{W(),P(!1),j((0,h.changeSongLength)(y,e),!0)},onUndoClick:()=>{if(!O.length)return;R(w.concat([y]));const e=O.pop();A(O.slice()),j(e,!1)},onRedoClick:()=>{if(!w.length)return;A(O.concat([y]));const e=w.pop();R(w.slice()),j(e,!1)},showBassClef:F,onBassClefCheckboxClick:U,hasUndo:!!O.length,hasRedo:!!w.length}),(0,s.jsx)(o.EditControls,{assetName:t.meta.displayName,onAssetNameChanged:p,onDoneClicked:m,hideDoneButton:f})]}))}},{"./EditControls":164,"./PlaybackControls":169,"./ScrollableWorkspace":170,"./TrackSelector":173,"./keyboardNavigation":176,"./playback":177,"./utils":179,react:239,"react/jsx-runtime":240}],167:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Note=void 0;const s=e("react/jsx-runtime"),n=e("../../../../react-common/components/util"),o=e("./svgConstants"),r=e("./utils");i.Note=e=>{const{row:t,iconURI:i,length:a,opacity:l,enharmonicSpelling:c,isBassClef:u,selected:h,cursorHighlighted:d}=e;return(0,s.jsxs)("g",Object.assign({className:(0,n.classList)("music-staff-note",h&&"selected",d&&"cursor-highlighted"),transform:`translate(${-o.NOTE_ICON_WIDTH/2}, ${(0,o.rowY)(t,u)-o.NOTE_ICON_WIDTH/2})`},{children:[0===t&&(0,s.jsx)("line",{className:"music-staff-row",x1:-o.NOTE_ICON_WIDTH/2,y1:o.NOTE_ICON_WIDTH/2,x2:3*o.NOTE_ICON_WIDTH/2,y2:o.NOTE_ICON_WIDTH/2,opacity:l}),!!a&&(0,s.jsx)("rect",{x:o.NOTE_ICON_WIDTH/2,y:o.NOTE_ICON_WIDTH/2-o.NOTE_DURATION_HEIGHT/2,width:a,height:o.NOTE_DURATION_HEIGHT}),(0,s.jsx)("image",Object.assign({x:0,y:0,width:o.NOTE_ICON_WIDTH,height:o.NOTE_ICON_WIDTH,href:(0,r.resolveImageURL)(i),opacity:l},{children:(0,s.jsx)("animate",{attributeName:"y",values:"0;-7;-10;-7;0",dur:"0.25s",repeatCount:"1",begin:"indefinite"})})),c&&"normal"!==c&&(0,s.jsx)("text",Object.assign({x:o.NOTE_ICON_WIDTH,y:0,fontSize:o.NOTE_ICON_WIDTH/2},{children:"sharp"===c?"♯":"♭"}))]}))}},{"../../../../react-common/components/util":130,"./svgConstants":178,"./utils":179,"react/jsx-runtime":240}],168:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NoteGroup=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./Note"),r=e("./playback"),a=e("./svgConstants"),l=e("./utils");i.NoteGroup=e=>{const{song:t,noteEvent:i,octave:c,iconURI:u,isDrumTrack:h,cursor:d}=e;let p;n.useEffect((()=>{let e=!1;const t=t=>{if(t>=i.startTick&&t<i.endTick){if(!e){e=!0,p.classList.add("music-note-playing");const t=p.querySelectorAll("animate");for(let e=0;e<t.length;e++)t.item(e).beginElement()}}else e&&(e=!1,p.classList.remove("music-note-playing"))},s=()=>{e&&(e=!1,p.classList.remove("music-note-playing"))};return(0,r.addTickListener)(t),(0,r.addPlaybackStateListener)(s),()=>{(0,r.removeTickListener)(t),(0,r.removePlaybackStateListener)(s),p.classList.remove("music-note-playing")}}),[i]);const g=(0,a.tickToX)(t.ticksPerBeat,i.startTick),m=h?0:(0,a.tickToX)(t.ticksPerBeat,i.endTick)-g,f=(null==d?void 0:d.tick)===i.startTick;return(0,s.jsx)("g",Object.assign({className:"music-staff-note-group",transform:`translate(${g}, 0)`,ref:e=>{e&&(p=e)}},{children:i.notes.map(((e,t)=>{const n=(0,l.isBassClefNote)(c,e,h),r=(0,l.noteToRow)(c,e,h);return(0,s.jsx)(o.Note,{isBassClef:n,row:r,enharmonicSpelling:e.enharmonicSpelling,iconURI:u,length:m,selected:i.selected,cursorHighlighted:f&&d.noteGroupIndex===t},t)}))}))}},{"./Note":167,"./playback":177,"./svgConstants":178,"./utils":179,react:239,"react/jsx-runtime":240}],169:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PlaybackControls=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../../../../react-common/components/controls/Button"),r=e("../../../../react-common/components/controls/Checkbox"),a=e("../../../../react-common/components/controls/Input"),l=e("../../../../react-common/components/util"),c=e("./playback");i.PlaybackControls=e=>{const{song:t,onTempoChange:i,onMeasuresChanged:u,onUndoClick:h,onRedoClick:d,hasUndo:p,hasRedo:g,showBassClef:m,onBassClefCheckboxClick:f}=e,[_,b]=n.useState("stop");n.useEffect((()=>{const e=e=>{b(e)};return(0,c.addPlaybackStateListener)(e),()=>(0,c.removePlaybackStateListener)(e)}),[]);const T=e=>{let t=parseFloat(e);Number.isNaN(t)||(t=Math.min(500,Math.max(20,Math.floor(t))),i(t))},E=e=>{let t=parseInt(e);isNaN(t)||t<1||t>50||u(t)};return(0,s.jsxs)("div",Object.assign({className:"music-playback-controls"},{children:[(0,s.jsxs)("div",Object.assign({className:"music-playback-buttons"},{children:[(0,s.jsx)(o.Button,{className:"square-button",title:lf("Stop"),leftIcon:"fas fa-stop",onClick:()=>{(0,c.stopPlayback)(),b("stop")}}),(0,s.jsx)(o.Button,{className:(0,l.classList)("square-button","play"===_&&"green"),title:lf("Play"),leftIcon:"fas fa-play",onClick:()=>{(0,c.startPlaybackAsync)(t,!1,0),b("play")}}),(0,s.jsx)(o.Button,{className:(0,l.classList)("square-button","loop"===_&&"green"),title:lf("Loop"),leftIcon:"fas fa-retweet",onClick:()=>{(0,c.isLooping)()||((0,c.isPlaying)()?(0,c.setLooping)(!0):(0,c.startPlaybackAsync)(t,!0,0),b("loop"))}})]})),(0,s.jsx)(a.Input,{id:"music-playback-tempo-input music-editor-label",label:lf("Tempo:"),initialValue:t.beatsPerMinute.toString(),onBlur:T,onEnterKey:T}),(0,s.jsx)("div",{className:"spacer"}),(0,s.jsx)(r.Checkbox,{className:"music-editor-label",id:"show-bass-clef",label:lf("Show bass clef"),isChecked:m,onChange:f}),(0,s.jsxs)("div",Object.assign({className:"music-undo-redo common-button-group"},{children:[(0,s.jsx)(o.Button,{className:"square-button purple",title:lf("Undo"),leftIcon:"xicon undo",disabled:!p,onClick:h}),(0,s.jsx)(o.Button,{className:"square-button purple",title:lf("Redo"),leftIcon:"xicon redo",disabled:!g,onClick:d})]})),(0,s.jsxs)("div",Object.assign({className:"music-playback-measures"},{children:[(0,s.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Measures:")})),(0,s.jsx)(o.Button,{className:"menu-button",title:lf("Remove measure"),leftIcon:"fas fa-minus-circle",onClick:()=>{t.measures>1&&u(t.measures-1)}}),(0,s.jsx)(a.Input,{id:"music-playback-measures-input",initialValue:t.measures.toString(),onBlur:E,onEnterKey:E}),(0,s.jsx)(o.Button,{className:"menu-button",title:lf("Add measure"),leftIcon:"fas fa-plus-circle",onClick:()=>{t.measures<50&&u(t.measures+1)}})]}))]}))}},{"../../../../react-common/components/controls/Button":122,"../../../../react-common/components/controls/Checkbox":123,"../../../../react-common/components/controls/Input":128,"../../../../react-common/components/util":130,"./playback":177,react:239,"react/jsx-runtime":240}],170:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ScrollableWorkspace=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("./svgConstants"),r=e("./utils"),a=e("./Workspace");i.ScrollableWorkspace=e=>{const{cursor:t,song:i}=e,l=n.useRef(null);return n.useEffect((()=>{if(!t)return;const e=(0,o.tickToX)(i.ticksPerBeat,t.tick),s=l.current.querySelector("svg"),n=e=>{const t=s.createSVGPoint();return t.x=e,t.y=0,t.matrixTransform(s.getScreenCTM()).x},a=n(e),c=(0,r.findNoteEventAtTick)(i,t.track,t.tick),u=n(e+o.BEAT_WIDTH)-a;let h;h=c?n((0,o.tickToX)(i.ticksPerBeat,c.endTick+i.ticksPerBeat/2))-a:u;const d=l.current.getBoundingClientRect(),p=a-d.x,g=p+h;p<u?l.current.scrollLeft+=p-u:h<d.width&&g>d.width&&(l.current.scrollLeft+=g-d.width)}),[null==t?void 0:t.tick,i.ticksPerBeat]),(0,s.jsx)("div",Object.assign({ref:l,className:"music-scrollable-workspace"},{children:(0,s.jsx)("div",Object.assign({className:"music-scroller"},{children:(0,s.jsx)(a.Workspace,Object.assign({},e))}))}))}},{"./Workspace":174,"./svgConstants":178,"./utils":179,react:239,"react/jsx-runtime":240}],171:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Staff=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../../../../react-common/components/util"),r=e("./playback"),a=e("./svgConstants"),l=e("./utils");i.Staff=e=>{const{top:t,isBassClef:i,gridTicks:c,ticksPerBeat:u,beatsPerMeasure:h,beatsPerMinute:d,measures:p}=e;let g;n.useEffect((()=>{const e=pxsim.music.tickToMs(d,u,1),t=(0,a.tickToX)(u,2)-(0,a.tickToX)(u,1);let i,s,n=0,o=!1;const l=e=>{n=(0,a.tickToX)(u,e),s=Date.now(),o||(o=!0,g.style.display="unset",i=requestAnimationFrame(h))},c=()=>{o=!1,g.style.display="none",i&&cancelAnimationFrame(i)},h=()=>{const r=n+t*(Date.now()-s)/e;g.setAttribute("transform",`translate(${r}, 0)`),o&&(i=requestAnimationFrame(h))};return(0,r.addTickListener)(l),(0,r.addPlaybackStateListener)(c),()=>{(0,r.removeTickListener)(l),(0,r.removePlaybackStateListener)(c),i&&cancelAnimationFrame(i)}}),[u,d]);const m=(0,a.workspaceWidth)(p,h),f=[];for(let e=0;e<5;e++)f.push((0,s.jsx)("line",{className:"music-staff-row",x1:0,y1:(0,a.rowY)(2*e+2,!1),x2:m,y2:(0,a.rowY)(2*e+2,!1)},e));const _=[],b=c;for(let e=0;e<p*h*u;e+=b){const t=e%u==0,n=e%(h*u)==0,r=!t&&!n;_.push((0,s.jsxs)("g",{children:[n&&!i&&(0,s.jsx)("text",Object.assign({x:(0,a.tickToX)(u,e),y:a.STAFF_HEADER_HEIGHT-a.STAFF_HEADER_OFFSET,textAnchor:"middle",fontSize:a.STAFF_HEADER_FONT_SIZE},{children:Math.floor(e/(h*u))+1})),(0,s.jsx)("line",{className:"music-staff-column",x1:(0,a.tickToX)(u,e),y1:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.STAFF_HEADER_HEIGHT}),!r&&(0,s.jsx)("line",{className:(0,o.classList)("music-staff-column",t&&"beat-start",n&&"measure-start"),x1:(0,a.tickToX)(u,e),y1:i&&n?0:a.STAFF_HEADER_HEIGHT,x2:(0,a.tickToX)(u,e),y2:a.WORKSPACE_HEIGHT})]},e))}return(0,s.jsxs)("g",Object.assign({className:"music-staff",transform:`translate(0 ${t})`},{children:[(0,s.jsx)("rect",{className:"music-staff-background",x:0,y:a.STAFF_HEADER_HEIGHT,width:m,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,s.jsx)("image",{className:"music-staff-clef",href:(0,l.resolveImageURL)(i?"music-editor/bass-clef.svg":"music-editor/treble-clef.svg"),height:i?a.BASS_CLEF_HEIGHT:a.CLEF_HEIGHT,x:0,y:i?a.BASS_CLEF_TOP:a.STAFF_HEADER_HEIGHT}),(0,s.jsx)("rect",{fill:"#000",x:0,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:m,height:a.STAFF_GRID_TICK_HEIGHT}),(0,s.jsx)("rect",{fill:"#dedede",x:a.CLEF_WIDTH,y:a.STAFF_HEADER_HEIGHT-a.STAFF_GRID_TICK_HEIGHT,width:m-a.CLEF_WIDTH-a.STAFF_END_WIDTH,height:a.STAFF_GRID_TICK_HEIGHT}),(0,s.jsx)("g",Object.assign({className:"music-staff-rows"},{children:f})),(0,s.jsx)("g",Object.assign({className:"music-staff-beats"},{children:_})),(0,s.jsxs)("g",Object.assign({className:"music-staff-end"},{children:[(0,s.jsx)("rect",{x:m-a.STAFF_END_WIDTH,y:a.STAFF_HEADER_HEIGHT,width:3,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT}),(0,s.jsx)("rect",{x:m-12,y:a.STAFF_HEADER_HEIGHT,width:12,height:a.WORKSPACE_HEIGHT-a.STAFF_HEADER_HEIGHT})]})),(0,s.jsx)("g",Object.assign({className:"music-playback-head",ref:e=>{e&&(g=e)}},{children:(0,s.jsx)("line",{className:"music-playback-line",x1:0,y1:a.STAFF_HEADER_HEIGHT,x2:0,y2:a.WORKSPACE_HEIGHT})}))]}))}},{"../../../../react-common/components/util":130,"./playback":177,"./svgConstants":178,"./utils":179,react:239,"react/jsx-runtime":240}],172:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Track=void 0;const s=e("react/jsx-runtime"),n=e("./Note"),o=e("./NoteGroup"),r=e("./svgConstants");i.Track=e=>{const{song:t,track:i,cursorLocation:a,keyboardCursor:l}=e;let c;return a&&(c=(0,s.jsx)("g",Object.assign({transform:`translate(${(0,r.tickToX)(t.ticksPerBeat,a.tick)}, 0)`},{children:(0,s.jsx)(n.Note,{isBassClef:a.isBassClef,row:a.row,iconURI:i.iconURI,opacity:.5})}))),(0,s.jsxs)("g",Object.assign({className:"music-staff-track"},{children:[l&&(0,s.jsx)("g",{children:(0,s.jsx)("rect",{x:(0,r.tickToX)(t.ticksPerBeat,l.tick),y:l.bassClef?r.BASS_STAFF_TOP+r.STAFF_HEADER_HEIGHT:r.STAFF_HEADER_HEIGHT,width:5,height:r.WORKSPACE_HEIGHT-r.STAFF_HEADER_HEIGHT,fill:"purple"})}),i.notes.map((e=>(0,s.jsx)(o.NoteGroup,{noteEvent:e,octave:i.instrument.octave,song:t,iconURI:i.iconURI,isDrumTrack:!!i.drums,cursor:l},e.startTick))),c]}))}},{"./Note":167,"./NoteGroup":168,"./svgConstants":178,"react/jsx-runtime":240}],173:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TrackSelector=void 0;const s=e("react/jsx-runtime"),n=e("../../../../react-common/components/controls/Button"),o=e("../../../../react-common/components/controls/Checkbox"),r=e("../../../../react-common/components/controls/Dropdown"),a=e("../../../../react-common/components/controls/FocusList"),l=e("../../../../react-common/components/util"),c=e("./utils"),u={four:"1/4",eight:"1/8",sixteen:"1/16",thirtytwo:"1/32"};i.TrackSelector=e=>{const{song:t,selected:i,onTrackSelected:h,selectedResolution:d,onResolutionSelected:p,eraserActive:g,onEraserClick:m,hideTracksActive:f,onHideTracksClick:_}=e,b=[{title:lf("1/4 Note"),label:lf("1/4"),id:"four"},{title:lf("1/8 Note"),label:lf("1/8"),id:"eight"},{title:lf("1/16 Note"),label:lf("1/16"),id:"sixteen"},{title:lf("1/32 Note"),label:lf("1/32"),id:"thirtytwo"}];return(0,s.jsxs)("div",Object.assign({className:"music-track-selector"},{children:[(0,s.jsxs)(a.FocusList,Object.assign({role:"radiogroup",ariaLabel:lf("Track selection")},{children:[t.tracks.map(((e,o)=>(0,s.jsx)(n.Button,{role:"radio",ariaSelected:i===o&&!g,ariaPosInSet:o+1,ariaSetSize:t.tracks.length+1,title:e.name,className:(0,l.classList)("music-track-button square-button pixellated",i===o&&!g&&"selected"),label:(0,s.jsx)("img",{src:(0,c.resolveImageURL)(e.iconURI),alt:e.name}),onClick:()=>(e=>{h(e)})(o)},e.name))),(0,s.jsx)(n.Button,{className:(0,l.classList)("music-track-button square-button",g&&"selected"),title:g?lf("Turn off eraser tool"):lf("Turn on eraser tool"),leftIcon:"fas fa-eraser",ariaSelected:g,ariaPosInSet:t.tracks.length,ariaSetSize:t.tracks.length+1,onClick:m})]})),(0,s.jsx)(o.Checkbox,{className:"music-editor-label",id:"hide-tracks",label:lf("Only show selected instrument"),isChecked:f,onChange:_}),(0,s.jsxs)("div",Object.assign({className:"music-track-grid"},{children:[(0,s.jsx)("div",Object.assign({className:"music-editor-label"},{children:lf("Grid:")})),(0,s.jsx)(r.Dropdown,{id:"grid-resolution",ariaLabel:lf("Staff grid resolution"),items:b,selectedId:Object.keys(u).find((e=>u[e]===d)),onItemSelected:e=>{p(u[e])}})]}))]}))}},{"../../../../react-common/components/controls/Button":122,"../../../../react-common/components/controls/Checkbox":123,"../../../../react-common/components/controls/Dropdown":124,"../../../../react-common/components/controls/FocusList":126,"../../../../react-common/components/util":130,"./utils":179,"react/jsx-runtime":240}],174:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Workspace=void 0;const s=e("react/jsx-runtime"),n=e("react"),o=e("../../../../react-common/components/util"),r=e("./GridHighlight"),a=e("./Staff"),l=e("./svgConstants"),c=e("./Track"),u=e("./utils"),h=e("./WorkspaceSelection");function d(e,t,i,s){const n=(0,o.screenToSVGCoord)(t,(0,o.clientCoord)(e)),r=n.y>l.BASS_STAFF_TOP,a=(0,l.closestTick)(i.ticksPerBeat,n.x+l.BEAT_WIDTH/i.ticksPerBeat,s);return{isBassClef:r,row:(0,l.closestRow)(n.y),tick:a,exactTick:(0,l.closestTick)(i.ticksPerBeat,n.x,1)}}i.Workspace=e=>{const{song:t,onWorkspaceClick:i,gridTicks:p,selectedTrack:g,onWorkspaceDrag:m,onWorkspaceDragStart:f,onWorkspaceDragEnd:_,onKeydown:b,cursor:T,hideUnselectedTracks:E,eraserActive:y,showBassClef:I,selection:k}=e,[v,C]=n.useState(null),[S,O]=n.useState(null),[A,w]=n.useState(!1);let R;n.useEffect((()=>{R.onpointerdown=e=>{e.preventDefault(),R.focus();const i=d(e,R,t,p);i.tick>=0&&i.row>=0&&i.row<12&&O(i)},R.onpointermove=e=>{const i=d(e,R,t,p);if(v&&v.exactTick===i.exactTick&&v.row===i.row)return;const s=t.beatsPerMeasure*t.ticksPerBeat*t.measures;i.tick>=0&&i.row>=0&&i.row<12&&i.tick<=s?(S&&(A||(w(!0),f()),m(S,i)),i.tick<s?C(i):C(null)):C(null)},R.onpointerleave=e=>{C(null),A&&(_(),w(!1))},R.onpointerup=e=>{if(O(null),A)_(),w(!1);else{const s=d(e,R,t,p);s.tick>=0&&s.row>=0&&s.row<12&&i(s,e.ctrlKey)}}}),[v,S,A,m,_,f]);let N,x,L=A||y?void 0:v;const $=v&&(0,u.findNoteEventAtTick)(t,g,v.tick),D=S&&(0,u.findNoteEventAtTick)(t,g,S.tick);k?(N=k.startTick+k.deltaTick,x=k.endTick+k.deltaTick):!y&&D&&(null==v?void 0:v.tick)>=D.startTick?(N=D.startTick,x=D.endTick):!y&&A&&v&&S?(N=Math.min(v.tick,S.tick),x=Math.max(v.tick,S.tick)):$?(N=$.startTick,x=$.endTick):v&&(N=v.tick,x=v.tick+p),$&&L&&(L=Object.assign(Object.assign({},L),{tick:$.startTick}));const M=t.tracks.filter(((e,t)=>t!==g)),B=I?2*l.WORKSPACE_HEIGHT:l.WORKSPACE_HEIGHT,P=pxt.assets.music.getSongInfo(t);return(0,s.jsxs)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:(0,o.classList)("music-workspace",y&&"erasing"),viewBox:`0 0 ${(0,l.workspaceWidth)(t.measures,t.beatsPerMeasure)+20} ${B}`,"aria-label":lf("Music Workspace"),tabIndex:0,onKeyDown:b,ref:e=>{e&&(R=e)}},{children:[(0,s.jsxs)("filter",Object.assign({id:"selection-outline"},{children:[(0,s.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,s.jsx)("feFlood",{floodColor:"yellow",floodOpacity:"1",result:"FLOODED"}),(0,s.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,s.jsxs)("feMerge",{children:[(0,s.jsx)("feMergeNode",{in:"OUTLINE"}),(0,s.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,s.jsxs)("filter",Object.assign({id:"cursor-outline"},{children:[(0,s.jsx)("feMorphology",{in:"SourceAlpha",result:"DILATED",operator:"dilate",radius:"4"}),(0,s.jsx)("feFlood",{floodColor:"purple",floodOpacity:"1",result:"FLOODED"}),(0,s.jsx)("feComposite",{in:"FLOODED",in2:"DILATED",operator:"in",result:"OUTLINE"}),(0,s.jsxs)("feMerge",{children:[(0,s.jsx)("feMergeNode",{in:"OUTLINE"}),(0,s.jsx)("feMergeNode",{in:"SourceGraphic"})]})]})),(0,s.jsx)(a.Staff,Object.assign({},P,{top:0,gridTicks:p})),I&&(0,s.jsx)(a.Staff,Object.assign({},P,{top:l.BASS_STAFF_TOP,isBassClef:!0,gridTicks:p})),(0,s.jsx)(r.GridHighlight,Object.assign({},P,{start:N,end:x})),k&&(0,s.jsx)(h.WorkspaceSelection,Object.assign({},P,{range:k})),!E&&M.map(((e,i)=>(0,s.jsx)(c.Track,{track:e,song:t},i))),(0,s.jsx)(c.Track,{track:t.tracks[g],song:t,cursorLocation:L,keyboardCursor:T})]}))}},{"../../../../react-common/components/util":130,"./GridHighlight":165,"./Staff":171,"./Track":172,"./WorkspaceSelection":175,"./svgConstants":178,"./utils":179,react:239,"react/jsx-runtime":240}],175:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WorkspaceSelection=void 0;const s=e("react/jsx-runtime"),n=e("./svgConstants");i.WorkspaceSelection=e=>{const{range:t,ticksPerBeat:i}=e,o=(0,n.tickToX)(i,t.startTick+t.deltaTick),r=(0,n.tickToX)(i,t.endTick+t.deltaTick);return(0,s.jsxs)("g",{children:[(0,s.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,r),y:n.STAFF_HEADER_HEIGHT,width:Math.max(o,r)-Math.min(o,r),height:n.WORKSPACE_HEIGHT-n.STAFF_HEADER_HEIGHT}),(0,s.jsx)("rect",{className:"music-workspace-selection",fill:"#03adfc",opacity:.5,x:Math.min(o,r),y:n.BASS_STAFF_TOP+n.STAFF_HEADER_HEIGHT,width:Math.max(o,r)-Math.min(o,r),height:n.WORKSPACE_HEIGHT-n.STAFF_HEADER_HEIGHT})]})}},{"./svgConstants":178,"react/jsx-runtime":240}],176:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.handleKeyboardEvent=void 0;const s=e("./playback"),n=e("./utils");i.handleKeyboardEvent=function(e,t,i){const o=i.ctrlKey||i.metaKey,r=i.shiftKey,a=i.altKey,l=t.selection?void 0:(0,n.findNoteEventAtTick)(e,t.track,t.tick);(null==l?void 0:l.startTick)===t.tick&&void 0===t.noteGroupIndex&&(t.noteGroupIndex=0);let c=e,u=Object.assign(Object.assign({},t),{selection:t.selection&&Object.assign({},t.selection)});const h=e.tracks[t.track].instrument,d=h.octave,p=e.ticksPerBeat*e.beatsPerMeasure,g=p*e.measures,m=!!t.selection,f=!!e.tracks[t.track].drums,_=e=>{u.selection&&(c=(0,n.applySelection)(u.selection,t.hideTracksActive?t.track:void 0),e&&(c=(0,n.unselectAllNotes)(c)),delete u.selection)},b=t=>{for(const i of t.notes)pxsim.music.playNoteAsync(i.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,t.endTick-t.startTick))};switch(i.key){case"ArrowUp":case"Up":if(i.preventDefault(),r){u.bassClef=!1;break}if(u.selection){u.selection.transpose++,c=(0,n.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=l.notes.length-1;else if(a)u.noteGroupIndex=Math.min(t.noteGroupIndex+1,l.notes.length-1);else{let i=l.notes[t.noteGroupIndex],s=(0,n.isBassClefNote)(d,i,f);const r=(0,n.noteToRow)(d,i,f);let a=r;const p=o?12:1;for(;l.notes.some((e=>(0,n.isBassClefNote)(d,e,f)===s&&a===(0,n.noteToRow)(d,e,f)));)if((a+=p)>=12){if(!s)break;s=!1,a-=12}if(a>=12||a<0)break;const g=(0,n.rowToNote)(d,a,s,f,i.enharmonicSpelling);c=(0,n.removeNoteAtRowFromTrack)(c,t.track,r,(0,n.isBassClefNote)(d,i,f),l.startTick),c=(0,n.addNoteToTrack)(c,t.track,g,l.startTick,l.endTick);const m=(0,n.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=m.notes.findIndex((e=>e.note===g.note)),pxsim.music.playNoteAsync(g.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,m.endTick-m.startTick))}break;case"ArrowDown":case"Down":if(i.preventDefault(),r){u.bassClef=!0;break}if(u.selection){u.selection.transpose--,c=(0,n.applySelection)(u.selection);break}if(!l)break;if(a&&o)u.noteGroupIndex=0;else if(a)u.noteGroupIndex=Math.max(t.noteGroupIndex-1,0);else{let i=l.notes[t.noteGroupIndex];const s=c.tracks[t.track];let r=(0,n.isBassClefNote)(d,i,!!s.drums);const a=(0,n.noteToRow)(d,i,!!s.drums);let p=a;const g=o?-12:-1;for(;l.notes.some((e=>(0,n.isBassClefNote)(d,e,!!s.drums)===r&&p===(0,n.noteToRow)(d,e,!!s.drums)));)if((p+=g)<0){if(r)break;r=!0,p+=12}if(p>=12||p<0)break;const m=(0,n.rowToNote)(d,p,r,!!s.drums,i.enharmonicSpelling);c=(0,n.removeNoteAtRowFromTrack)(c,t.track,a,(0,n.isBassClefNote)(d,i,!!s.drums),l.startTick),c=(0,n.addNoteToTrack)(c,t.track,m,l.startTick,l.endTick);const f=(0,n.findNoteEventAtTick)(c,t.track,t.tick);u.noteGroupIndex=f.notes.findIndex((e=>e.note===m.note)),pxsim.music.playNoteAsync(m.note,h,pxsim.music.tickToMs(c.beatsPerMinute,e.ticksPerBeat,f.endTick-f.startTick))}break;case"ArrowLeft":case"Left":if(i.preventDefault(),r&&m&&(u.selection.deltaTick||u.selection.transpose)&&_(!0),o){u.tick%p==0?u.tick=Math.max(u.tick-p,0):u.tick=Math.floor(u.tick/p)*p;const e=(0,n.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,b(e)):u.noteGroupIndex=void 0;break}const T=t.tick%t.gridTicks!=0?Math.floor(u.tick/t.gridTicks)*t.gridTicks:t.tick-t.gridTicks,E=(0,n.findPreviousNoteEvent)(c,t.track,t.tick-1);if((null==E?void 0:E.endTick)>T){u.tick=E.startTick,u.noteGroupIndex=0;break}u.tick=Math.max(T,0),u.noteGroupIndex=void 0;break;case"ArrowRight":case"Right":if(i.preventDefault(),r&&m&&(u.selection.deltaTick||u.selection.transpose)&&_(!0),o){u.tick%p==0?u.tick=Math.min(u.tick+p,g-p):(u.tick=Math.min(Math.ceil(u.tick/p)*p,g-p),u.tick>=g&&(u.tick-=p));const e=(0,n.findNoteEventAtTick)(c,t.track,u.tick);(null==e?void 0:e.startTick)===u.tick?(u.noteGroupIndex=0,b(e)):u.noteGroupIndex=void 0;break}const y=l?Math.ceil(l.endTick/t.gridTicks)*t.gridTicks:t.tick+t.gridTicks,I=(0,n.findNextNoteEvent)(c,t.track,t.tick);if((null==I?void 0:I.startTick)<=y){u.tick=I.startTick,u.noteGroupIndex=0;break}u.tick=Math.min(Math.ceil(y/t.gridTicks)*t.gridTicks,g-t.gridTicks),u.noteGroupIndex=void 0;break;case"End":if(i.preventDefault(),o){u.tick=g-t.gridTicks;const e=(0,n.findNoteEventAtTick)(c,t.track,u.tick);e?(u.tick=e.startTick,u.noteGroupIndex=0,b(e)):u.noteGroupIndex=void 0}break;case"Home":if(i.preventDefault(),o){u.tick=0;const e=(0,n.findNoteEventAtTick)(c,t.track,u.tick);e?(u.noteGroupIndex=0,b(e)):u.noteGroupIndex=void 0}break;case"Backspace":if(i.preventDefault(),t.selection)_(),c=(0,n.deleteSelectedNotes)(c);else if(void 0!==t.noteGroupIndex){if(o){c=(0,n.removeNoteEventFromTrack)(c,t.track,t.tick),u.noteGroupIndex=void 0;break}c=(0,n.removeNoteFromTrack)(c,t.track,l.notes[t.noteGroupIndex],l.startTick),1===l.notes.length?u.noteGroupIndex=void 0:u.noteGroupIndex=Math.min(u.noteGroupIndex,l.notes.length-2)}break;case"Enter":m&&_(!0);break;case"Spacebar":case" ":i.preventDefault(),(0,s.isPlaying)()?(0,s.stopPlayback)():r?(0,s.startPlaybackAsync)(e,o,null==t?void 0:t.tick):(0,s.startPlaybackAsync)(e,o,0);break;case"j":case"J":if(e.tracks[t.track].drums)break;if(l){i.preventDefault();const e=l.notes[u.noteGroupIndex],s=12*h.octave-20,o=12*h.octave+20,r=(0,n.noteToRow)(d,e,!1),a=l.startTick,p=(0,n.isBassClefNote)(d,e,!1);let g;c=(0,n.removeNoteAtRowFromTrack)(c,u.track,r,p,a),g="normal"===e.enharmonicSpelling&&e.note<o?"sharp":"sharp"===e.enharmonicSpelling&&e.note>s||e.note===o?"flat":"normal";const m=(0,n.rowToNote)(h.octave,r,p,!1,g);c=(0,n.addNoteToTrack)(c,u.track,m,l.startTick,l.endTick),pxsim.music.playNoteAsync(m.note,h,pxsim.music.tickToMs(c.beatsPerMinute,c.ticksPerBeat,t.gridTicks))}break;default:if(o&&"a"===i.key||"A"===i.key){i.preventDefault(),u.selection&&_(!0),u.selection={startTick:0,endTick:g,originalSong:c,transpose:0,deltaTick:0};break}if(/^[a-g]$/i.test(i.key)){if(o)break;let e;i.preventDefault(),_(!0),e=t.bassClef?(0,n.rowToNote)(d,3+"abcdefg".indexOf(i.key.toLowerCase()),!0,f):(0,n.rowToNote)(d,5+"abcdefg".indexOf(i.key.toLowerCase()),!1,f),l?-1===l.notes.indexOf(e)&&(c=(0,n.addNoteToTrack)(c,t.track,e,l.startTick,l.endTick),b((0,n.findNoteEventAtTick)(c,t.track,l.startTick))):(c=(0,n.addNoteToTrack)(c,t.track,e,t.tick,t.tick+t.gridTicks),u.noteGroupIndex=0,b((0,n.findNoteEventAtTick)(c,t.track,t.tick)));break}if(/^[1-9]$/.test(i.key)){i.preventDefault(),_(!0),l&&(c=(0,n.editNoteEventLength)(c,t.track,l.startTick,l.startTick+parseInt(i.key)*t.gridTicks),b((0,n.findNoteEventAtTick)(c,t.track,l.startTick)));break}}if(u.tick!==t.tick)if(r)u.selection?u.selection.endTick=u.tick:u.selection={originalSong:e,startTick:t.tick,endTick:u.tick,transpose:0,deltaTick:0},c=(0,n.applySelection)(u.selection,u.hideTracksActive?u.track:void 0);else if(u.selection){const e=(0,n.selectNoteEventsInRange)(u.selection.originalSong,u.selection.startTick,u.selection.endTick,u.hideTracksActive?u.track:void 0),i=(0,n.findSelectedRange)(e,u.gridTicks);i&&(u.selection.startTick=i.start,u.selection.endTick=i.end),u.selection.deltaTick+=u.tick-t.tick,c=(0,n.applySelection)(u.selection,u.hideTracksActive?u.track:void 0),u.selection.startTick+u.selection.deltaTick>0&&(u.tick=u.selection.startTick+u.selection.deltaTick)}return[c,u]}},{"./playback":177,"./utils":179}],177:[function(e,t,i){"use strict";let s;Object.defineProperty(i,"__esModule",{value:!0}),i.removePlaybackStateListener=i.addPlaybackStateListener=i.removeTickListener=i.addTickListener=i.stopPlayback=i.updatePlaybackSongAsync=i.setLooping=i.isLooping=i.isPlaying=i.startPlaybackAsync=void 0;let n=[],o=[];function r(){return!!s&&"stop"!==s.state()}i.startPlaybackAsync=async function(e,t,i){s||(s=new pxsim.music.Sequencer,await s.initAsync(),s.addEventListener("state-change",(()=>{for(const e of n)e(s.state())})),s.addEventListener("tick",(()=>{for(const e of o)e(s.currentTick())})),s.setVolume(100)),s.startFrom(e,t,i)},i.isPlaying=r,i.isLooping=function(){return r()&&"loop"===s.state()},i.setLooping=function(e){s&&s.setLooping(e)},i.updatePlaybackSongAsync=async function(e){s&&s.updateSong(e)},i.stopPlayback=function(){s&&s.stop()},i.addTickListener=function(e){o.push(e)},i.removeTickListener=function(e){o=o.filter((t=>e!==t))},i.addPlaybackStateListener=function(e){n.push(e)},i.removePlaybackStateListener=function(e){n=n.filter((t=>e!==t))}},{}],178:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.rowY=i.closestRow=i.closestTick=i.beatToX=i.tickToX=i.workspaceWidth=i.BASS_CLEF_HEIGHT=i.BASS_CLEF_TOP=i.BASS_STAFF_HEADER_HEIGHT=i.BASS_STAFF_TOP=i.NOTE_DURATION_HEIGHT=i.NOTE_ICON_WIDTH=i.WORKSPACE_HEIGHT=i.STAFF_GRID_TICK_HEIGHT=i.STAFF_END_WIDTH=i.STAFF_HEADER_OFFSET=i.STAFF_HEADER_FONT_SIZE=i.STAFF_HEADER_HEIGHT=i.CLEF_HEIGHT=i.CLEF_WIDTH=i.STAFF_ROW_HEIGHT=i.BEAT_WIDTH=void 0,i.BEAT_WIDTH=150,i.STAFF_ROW_HEIGHT=50,i.CLEF_WIDTH=250,i.CLEF_HEIGHT=320,i.STAFF_HEADER_HEIGHT=i.STAFF_ROW_HEIGHT,i.STAFF_HEADER_FONT_SIZE=40,i.STAFF_HEADER_OFFSET=11,i.STAFF_END_WIDTH=25,i.STAFF_GRID_TICK_HEIGHT=7,i.WORKSPACE_HEIGHT=i.STAFF_HEADER_HEIGHT+7*i.STAFF_ROW_HEIGHT,i.NOTE_ICON_WIDTH=45,i.NOTE_DURATION_HEIGHT=i.NOTE_ICON_WIDTH/3,i.BASS_STAFF_TOP=i.WORKSPACE_HEIGHT,i.BASS_STAFF_HEADER_HEIGHT=i.STAFF_ROW_HEIGHT/2,i.BASS_CLEF_TOP=90,i.BASS_CLEF_HEIGHT=230,i.workspaceWidth=function(e,t){return i.CLEF_WIDTH+e*t*i.BEAT_WIDTH+i.STAFF_END_WIDTH},i.tickToX=function(e,t){return i.CLEF_WIDTH+i.BEAT_WIDTH/e*t},i.beatToX=function(e){return i.CLEF_WIDTH+i.BEAT_WIDTH*e},i.closestTick=function(e,t,s){const n=Math.floor((t-i.CLEF_WIDTH)*(e/i.BEAT_WIDTH));return Math.floor(n/s)*s},i.closestRow=function(e){const t=e>i.BASS_STAFF_TOP;return 12-Math.round((e-i.STAFF_HEADER_HEIGHT-(t?i.BASS_STAFF_TOP:0))/(i.STAFF_ROW_HEIGHT/2))},i.rowY=function(e,t){return t?i.BASS_STAFF_TOP+i.STAFF_HEADER_HEIGHT+(12-e%12)*i.STAFF_ROW_HEIGHT/2:i.STAFF_HEADER_HEIGHT+(12-e%12)*i.STAFF_ROW_HEIGHT/2}},{}],179:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.doesSongUseBassClef=i.applySelection=i.moveSelectedNotes=i.deleteSelectedNotes=i.unselectAllNotes=i.selectNoteEventsInRange=i.findSelectedRange=i.changeSongLength=i.findNoteEventAtPosition=i.findNextNoteEvent=i.findPreviousNoteEvent=i.findNoteEventAtTick=i.fillDrums=i.editNoteEventLength=i.removeNoteEventFromTrack=i.removeNoteAtRowFromTrack=i.removeNoteFromTrack=i.addNoteToTrack=i.isBassClefNote=i.noteToRow=i.resolveImageURL=i.rowToNote=void 0;const s=[0,2,4,5,7,9,11,12,14,16,17,19],n=[0,1,3,5,7,8,10,12,13,15,17,19];function o(e,t,i,o,r){if(o)return{note:t+(i?12:0),enharmonicSpelling:"normal"};let a;return a=i?n[t]+12*e-19:s[t]+12*e+1,r&&"normal"!==r?"sharp"===r?{note:a+1,enharmonicSpelling:r}:{note:a-1,enharmonicSpelling:r}:{note:a,enharmonicSpelling:"normal"}}function r(e,t,i){if(i)return t.note>=12?t.note-12:t.note;const o=a(e,t,!1),r=t.note-1-12*e+(o?20:0),l=o?n:s;for(let e=0;e<l.length;e++){if(l[e]===r)return"normal"===t.enharmonicSpelling?e:"sharp"===t.enharmonicSpelling?e-1:e+1;if(l[e]>r){if("sharp"===t.enharmonicSpelling)return e-1;if("flat"===t.enharmonicSpelling)return e}}return"sharp"===t.enharmonicSpelling&&r===l[l.length-1]+1?l.length-1:-1}function a(e,t,i){return i?t.note>=12:"flat"===t.enharmonicSpelling?t.note<12*e:"sharp"===t.enharmonicSpelling?t.note<=12*e+1:t.note<12*e+1}function l(e,t,i,s,n){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:c(e.notes,i,s,n,e.instrument.octave,!!e.drums).filter((e=>(e.startTick<=s||e.startTick>=n)&&(e.endTick>=n||e.endTick<=s)))})))})}function c(e,t,i,s,n,o){const l={notes:[t],startTick:i,endTick:s};for(let s=0;s<e.length;s++){if(e[s].startTick>i)return e.slice(0,s).concat([l]).concat(e.slice(s));if(e[s].endTick>i)return e[s].notes.some((e=>e.note===t.note&&e.enharmonicSpelling===t.enharmonicSpelling))?e.slice():e.map(((e,i)=>i!==s?e:Object.assign(Object.assign({},e),{notes:e.notes.concat([t]).sort(((e,t)=>{const i=a(n,e,o);return i===a(n,t,o)?r(n,e,o)-r(n,t,o):i?-1:1}))})))}return e.slice().concat([l])}function u(e,t,i){const s=e.slice();for(let e=0;e<s.length;e++)if(s[e].startTick==i){s[e]=Object.assign(Object.assign({},s[e]),{notes:s[e].notes.filter((e=>e.note!==t.note))});break}return s.filter((e=>e.notes.length))}function h(e,t,i,s,n,o){const l=e.slice();for(let e=0;e<l.length;e++)if(l[e].startTick==n){l[e]=Object.assign(Object.assign({},l[e]),{notes:l[e].notes.filter((e=>a(s,e,o)!==i||r(s,e,o)!==t))});break}return l.filter((e=>e.notes.length))}function d(e,t,i){const s=e.slice();if(t>=i)return s;let n;for(let e=0;e<s.length;e++)s[e].startTick===t?(n=Object.assign(Object.assign({},s[e]),{endTick:i}),s[e]=n):n&&s[e].startTick<n.endTick&&(s[e]=void 0);return s.filter((e=>!!e))}function p(e,t,i){const s=e.tracks[t];for(const e of s.notes)if(e.startTick<=i&&e.endTick>i)return e}function g(e,t){let i=e.measures*e.beatsPerMeasure*e.ticksPerBeat+1,s=-1;for(const t of e.tracks)for(const e of t.notes)e.selected&&(i=Math.min(e.startTick,i),s=Math.max(e.endTick,s));if(-1!==s)return void 0!==t&&(i=Math.floor(i/t)*t,s=Math.ceil(s/t)*t),{start:i,end:s}}function m(e,t,i,s){return void 0!==s?Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,n)=>n!==s?e:f(e,Math.min(t,i),Math.max(t,i))))}):Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>f(e,Math.min(t,i),Math.max(t,i))))})}function f(e,t,i){return Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.slice(),selected:!(e.startTick>=i||e.endTick<=t)})))})}function _(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.map((e=>Object.assign(Object.assign({},e),{selected:!1})))})))})}function b(e,t,i,s){const n=g(e);if(!n)return e;const{start:o,end:r}=n,a=o+t,l=r+t,c=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,n)=>void 0!==s&&s!=n?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.selected||e.endTick<=a||e.startTick>=l)).map((s=>s.selected?E(s,e.instrument.octave,t,i,!!e.drums):s)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,c)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<c)).sort(((e,t)=>e.startTick-t.startTick))})))})}function T(e,t){return e.pastedContent?function(e,t){const i=T(e.pastedContent,t),s=g(i,t),n=e.startTick+e.deltaTick,o=n+(s.end-s.start),r=_(e.originalSong),a=r.beatsPerMeasure*r.ticksPerBeat*r.measures;return Object.assign(Object.assign({},r),{tracks:r.tracks.map(((r,l)=>void 0!==t&&t!=l?r:Object.assign(Object.assign({},r),{notes:r.notes.filter((e=>e.endTick<=n||e.startTick>=o)).concat(i.tracks[l].notes.filter((e=>e.selected)).map((t=>Object.assign(Object.assign({},t),{startTick:t.startTick-s.start+e.startTick,endTick:t.endTick-s.start+e.startTick})))).map((t=>t.selected?E(t,r.instrument.octave,e.deltaTick,e.transpose,!!r.drums):t)).map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,a)}))).filter((e=>e.notes.length>0&&e.startTick>=0&&e.startTick<a)).sort(((e,t)=>e.startTick-t.startTick))})))})}(e,t):b(m(e.originalSong,e.startTick,e.endTick,t),e.deltaTick,e.transpose,t)}function E(e,t,i,n,l){const c=Object.assign(Object.assign({},e),{startTick:e.startTick+i,endTick:e.endTick+i,notes:[]});if(l)c.notes=e.notes.slice();else for(const i of e.notes){let e=a(t,i,l),u=r(t,i,l);u+n>=s.length?e&&(u-=12,e=!1):u+n<0&&(e||(u+=12,e=!0));const h=u+n;h<0||h>=s.length||c.notes.push(o(t,h,e,l,i.enharmonicSpelling))}return c}i.rowToNote=o,i.resolveImageURL=function(e){return window.MonacoPaths&&window.MonacoPaths[e]||e},i.noteToRow=r,i.isBassClefNote=a,i.addNoteToTrack=l,i.removeNoteFromTrack=function(e,t,i,s){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,n)=>n!==t?e:Object.assign(Object.assign({},e),{notes:u(e.notes,i,s)})))})},i.removeNoteAtRowFromTrack=function(e,t,i,s,n){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:h(e.notes,i,s,e.instrument.octave,n,!!e.drums)})))})},i.removeNoteEventFromTrack=function(e,t,i){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,s)=>s!==t?e:Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>e.startTick!==i))})))})},i.editNoteEventLength=function(e,t,i,s){const n=e.beatsPerMeasure*e.ticksPerBeat*e.measures;return Object.assign(Object.assign({},e),{tracks:e.tracks.map(((e,o)=>o!==t?e:Object.assign(Object.assign({},e),{notes:d(e.notes,i,Math.min(s,n))})))})},i.fillDrums=function(e,t,i,s,n,o){for(let r=s;r<n;r+=o)e=l(e,t,{note:i,enharmonicSpelling:"normal"},r,r+1);return e},i.findNoteEventAtTick=p,i.findPreviousNoteEvent=function(e,t,i){const s=e.tracks[t];let n;for(const e of s.notes){if(e.startTick>i)return n;n=e}return n},i.findNextNoteEvent=function(e,t,i){const s=e.tracks[t];for(const e of s.notes)if(e.startTick>i)return e},i.findNoteEventAtPosition=function(e,t,i){if(void 0!==i){const s=p(e,i,t.tick),n=e.tracks[i];return(null==s?void 0:s.notes.some((e=>r(n.instrument.octave,e,!!n.drums)===t.row)))?s:void 0}for(let i=0;i<e.tracks.length;i++){const s=p(e,i,t.tick),n=e.tracks[i];if(null==s?void 0:s.notes.some((e=>r(n.instrument.octave,e,!!n.drums)===t.row)))return s}},i.changeSongLength=function(e,t){const i=t*e.beatsPerMeasure*e.ticksPerBeat;return Object.assign(Object.assign({},e),{measures:t,tracks:e.tracks.map((e=>{const t=Object.assign(Object.assign({},e),{notes:e.notes.slice()});return t.notes=t.notes.filter((e=>e.startTick<i)),t.notes=t.notes.map((e=>Object.assign(Object.assign({},e),{endTick:Math.min(e.endTick,i)}))),t}))})},i.findSelectedRange=g,i.selectNoteEventsInRange=m,i.unselectAllNotes=_,i.deleteSelectedNotes=function(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map((e=>Object.assign(Object.assign({},e),{notes:e.notes.filter((e=>!e.selected))})))})},i.moveSelectedNotes=b,i.applySelection=T,i.doesSongUseBassClef=function(e){return e.tracks.some((e=>e.notes.some((t=>t.notes.some((t=>a(e.instrument.octave,t,!!e.drums)))))))}},{}],180:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.fireClickOnEnter=void 0,i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}},{}],181:[function(e,t,i){var s=e("./toPropertyKey.js");t.exports=function(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":188}],182:[function(e,t,i){function s(){return t.exports=s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,s.apply(this,arguments)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{}],183:[function(e,t,i){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],184:[function(e,t,i){var s=e("./typeof.js").default;function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(n=function(e){return e?i:t})(e)}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=s(e)&&"function"!=typeof e)return{default:e};var i=n(t);if(i&&i.has(e))return i.get(e);var o={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=r?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,i&&i.set(e,o),o},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":189}],185:[function(e,t,i){var s=e("./defineProperty.js");function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}t.exports=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./defineProperty.js":181}],186:[function(e,t,i){t.exports=function(e,t){if(null==e)return{};var i,s,n={},o=Object.keys(e);for(s=0;s<o.length;s++)i=o[s],t.indexOf(i)>=0||(n[i]=e[i]);return n},t.exports.__esModule=!0,t.exports.default=t.exports},{}],187:[function(e,t,i){var s=e("./typeof.js").default;t.exports=function(e,t){if("object"!=s(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":189}],188:[function(e,t,i){var s=e("./typeof.js").default,n=e("./toPrimitive.js");t.exports=function(e){var t=n(e,"string");return"symbol"==s(t)?t:String(t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":187,"./typeof.js":189}],189:[function(e,t,i){function s(e){return t.exports=s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,s(e)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{}],190:[function(e,t,i){
/*! For license information please see index.js.LICENSE.txt */
!function(s,n){if("object"==typeof i&&"object"==typeof t)t.exports=n(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],n);else{var o=n("object"==typeof i?e("blockly/core"):s.Blockly);for(var r in o)("object"==typeof i?i:s)[r]=o[r]}}(this,(e=>(()=>{"use strict";var t={573:t=>{t.exports=e}},i={};function s(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{s.r(n),s.d(n,{WorkspaceSearch:()=>i});var e=s(573);const t=function(){let e=!1;return function(){if(e)return;e=!0;const t=document.createElement("style");t.id="blockly-ws-search-style";const i=document.createTextNode("path.blocklyPath.blockly-ws-search-highlight {\n    fill: #000;\n  }\n  path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {\n    fill: grey;\n  }\n  .blockly-ws-search-close-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;\n  }\n  .blockly-ws-search-next-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;\n  }\n  .blockly-ws-search-previous-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;\n  }\n  .blockly-ws-search {\n    background: #fff;\n    border: solid lightgrey 0.5px;\n    box-shadow: 0px 10px 20px grey;\n    justify-content: center;\n    padding: 0.25em;\n    position: absolute;\n    z-index: 70;\n  }\n  .blockly-ws-search-input input {\n    border: none;\n  }\n  .blockly-ws-search button {\n    border: none;\n  }\n  .blockly-ws-search-actions {\n    display: flex;\n  }\n  .blockly-ws-search-container {\n    display: flex;\n  }\n  .blockly-ws-search-content {\n    display: flex;\n  }");t.appendChild(i),document.head.insertBefore(t,document.head.firstChild)}}();class i{constructor(e){this.workspace=e,this.id="workspaceSearch",this.htmlDiv=null,this.actionDiv=null,this.inputElement=null,this.textInputPlaceholder="Search",this.blocks=[],this.currentBlockIndex=-1,this.searchText="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents=[]}init(){this.workspace.getComponentManager().addComponent({component:this,weight:0,capabilities:[e.ComponentManager.Capability.POSITIONABLE]}),t(),this.createDom(),this.setVisible(!1),this.workspace.resize()}dispose(){for(const t of this.boundEvents)e.browserEvents.unbind(t);this.boundEvents.length=0,this.htmlDiv&&(this.htmlDiv.remove(),this.htmlDiv=null),this.actionDiv=null,this.inputElement=null}createDom(){const t=this.workspace.getInjectionDiv();this.addEvent(t,"keydown",this,(e=>this.onWorkspaceKeyDown(e))),this.htmlDiv=document.createElement("div"),e.utils.dom.addClass(this.htmlDiv,"blockly-ws-search");const i=document.createElement("div");e.utils.dom.addClass(i,"blockly-ws-search-container");const s=document.createElement("div");e.utils.dom.addClass(s,"blockly-ws-search-content"),i.appendChild(s);const n=document.createElement("div");e.utils.dom.addClass(n,"blockly-ws-search-input"),this.inputElement=this.createTextInput(),this.addEvent(this.inputElement,"keydown",this,(e=>this.onKeyDown(e))),this.addEvent(this.inputElement,"input",this,(()=>this.onInput())),this.addEvent(this.inputElement,"click",this,(()=>{this.searchAndHighlight(this.searchText,this.preserveSelected),this.inputElement.select()})),n.appendChild(this.inputElement),s.appendChild(n),this.actionDiv=document.createElement("div"),e.utils.dom.addClass(this.actionDiv,"blockly-ws-search-actions"),s.appendChild(this.actionDiv);const o=this.createNextBtn();o&&this.addActionBtn(o,(()=>this.next()));const r=this.createPreviousBtn();r&&this.addActionBtn(r,(()=>this.previous()));const a=this.createCloseBtn();a&&(this.addBtnListener(a,(()=>this.close())),i.appendChild(a)),this.htmlDiv.appendChild(i),t.insertBefore(this.htmlDiv,this.workspace.getParentSvg())}addEvent(t,i,s,n){const o=e.browserEvents.conditionalBind(t,i,s,n);this.boundEvents.push(o)}addActionBtn(e,t){this.addBtnListener(e,t),this.actionDiv.appendChild(e)}createTextInput(){const e=document.createElement("input");return e.type="text",e.setAttribute("placeholder",this.textInputPlaceholder),e}createNextBtn(){return this.createBtn("blockly-ws-search-next-btn","Find next")}createPreviousBtn(){return this.createBtn("blockly-ws-search-previous-btn","Find previous")}createCloseBtn(){return this.createBtn("blockly-ws-search-close-btn","Close search bar")}createBtn(t,i){const s=document.createElement("button");return e.utils.dom.addClass(s,t),s.setAttribute("aria-label",i),s}addBtnListener(e,t){this.addEvent(e,"click",this,t),this.addEvent(e,"keydown",this,(e=>{"Enter"===e.key?(t(e),e.preventDefault()):"Escape"===e.key&&this.close(),e.stopPropagation()}))}getBoundingRectangle(){return null}position(t,i){this.workspace.RTL?this.htmlDiv.style.left=t.absoluteMetrics.left+"px":t.toolboxMetrics.position===e.TOOLBOX_AT_RIGHT?this.htmlDiv.style.right=t.toolboxMetrics.width+"px":this.htmlDiv.style.right="0",this.htmlDiv.style.top=t.absoluteMetrics.top+"px"}onInput(){if(this.searchOnInput){const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onKeyDown(e){if("Escape"===e.key)this.close();else if("Enter"===e.key)if(this.searchOnInput)this.next();else{const e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onWorkspaceKeyDown(e){(e.ctrlKey||e.metaKey)&&"f"===e.key&&(this.open(),e.preventDefault(),e.stopPropagation())}previous(){this.setCurrentBlock(this.currentBlockIndex-1)}next(){this.setCurrentBlock(this.currentBlockIndex+1)}setSearchPlaceholder(e){this.textInputPlaceholder=e,this.inputElement&&this.inputElement.setAttribute("placeholder",this.textInputPlaceholder)}setCurrentBlock(e){if(!this.blocks.length)return;let t=this.blocks[this.currentBlockIndex];t&&this.unhighlightCurrentSelection(t),this.currentBlockIndex=(e%this.blocks.length+this.blocks.length)%this.blocks.length,t=this.blocks[this.currentBlockIndex],this.highlightCurrentSelection(t),this.workspace.centerOnBlock(t.id,!1)}open(){this.setVisible(!0),this.inputElement.focus(),this.searchText&&this.searchAndHighlight(this.searchText)}close(){this.setVisible(!1),this.workspace.markFocused(),this.clearBlocks()}setVisible(e){this.htmlDiv.style.display=e?"flex":"none"}searchAndHighlight(e,t){const i=this.blocks[this.currentBlockIndex];this.searchText=e.trim(),this.clearBlocks(),this.blocks=this.getMatchingBlocks(this.workspace,this.searchText,this.caseSensitive),this.highlightSearchGroup(this.blocks);let s=0;t&&(s=this.blocks.indexOf(i),s=s>-1?s:0),this.setCurrentBlock(s)}getSearchPool(e){return e.getAllBlocks(!0).filter((e=>{const t=e.getSurroundParent();return!t||!t.isCollapsed()}))}isBlockMatch(e,t,i){let s="";if(e.isCollapsed())s=e.toString();else{const t=[];e.inputList.forEach((e=>{e.fieldRow.forEach((e=>{t.push(e.getText())}))})),s=t.join(" ").trim()}return i||(s=s.toLowerCase()),s.indexOf(t)>-1}getMatchingBlocks(e,t,i){return t?(this.caseSensitive||(t=t.toLowerCase()),this.getSearchPool(e).filter((e=>this.isBlockMatch(e,t,i)))):[]}clearBlocks(){this.unhighlightSearchGroup(this.blocks);const e=this.blocks[this.currentBlockIndex];e&&this.unhighlightCurrentSelection(e),this.currentBlockIndex=-1,this.blocks=[]}highlightCurrentSelection(t){const i=t.pathObject.svgPath;e.utils.dom.addClass(i,"blockly-ws-search-current")}unhighlightCurrentSelection(t){const i=t.pathObject.svgPath;e.utils.dom.removeClass(i,"blockly-ws-search-current")}highlightSearchGroup(t){t.forEach((t=>{const i=t.pathObject.svgPath;e.utils.dom.addClass(i,"blockly-ws-search-highlight")}))}unhighlightSearchGroup(t){t.forEach((t=>{const i=t.pathObject.svgPath;e.utils.dom.removeClass(i,"blockly-ws-search-highlight")}))}}})(),n})()))},{"blockly/core":196}],191:[function(e,t,i){var s,n;s=this,n=function(e){return e},"function"==typeof define&&define.amd?define(["./blockly_compressed"],n):"object"==typeof i?t.exports=e("./blockly_compressed"):s.Blockly=s.Blockly},{"./blockly_compressed":192}],192:[function(e,t,i){(function(e){(function(){var s,n;s=this,n=function(){var t,i,s,n,o,r,a,l,c,u,h,d,p,g,m,f,_,b,T,E,y,I,k,v,C,S,O,A,w,R,N,x,L,$,D,M,B,P,F,U,H,G,V,j,W,Y,z,X,K,q,J,Z,Q,ee,te,ie,se,ne,oe,re,ae,le,ce,ue,he,de,pe,ge,me,fe,_e,be,Te,Ee,ye,Ie,ke,ve,Ce,Se,Oe,Ae,we,Re,Ne,xe,Le,$e,De,Me,Be,Pe,Fe,Ue,He,Ge,Ve,je,We,Ye,ze,Xe,Ke,qe,Je,Ze,Qe,et,tt,it,st,nt,ot,rt,at,lt,ct,ut,ht,dt,pt,gt,mt,ft,_t,bt,Tt,Et,yt,It,kt,vt,Ct,St,Ot,At,wt,Rt,Nt,xt,Lt,$t,Dt,Mt,Bt,Pt,Ft,Ut,Ht,Gt,Vt,jt,Wt,Yt,zt,Xt,Kt,qt,Jt,Zt,Qt,ei,ti,ii,si,ni,oi,ri,ai,li,ci,ui,hi,di,pi,gi,mi,fi,_i,bi,Ti,Ei,yi,Ii,ki,vi,Ci,Si,Oi,Ai,wi,Ri,Ni,xi,Li,$i,Di,Mi,Bi,Pi,Fi,Ui,Hi,Gi,Vi,ji,Wi,Yi,zi,Xi,Ki,qi,Ji,Zi,Qi,es,ts,is,ss,ns,os,rs,as,ls,cs,us,hs,ds,ps,gs,ms,fs,_s,bs,Ts,Es,ys,Is,ks,vs,Cs,Ss,Os,As,ws,Rs,Ns,xs,Ls,$s,Ds,Ms,Bs,Ps,Fs,Us,Hs,Gs,Vs,js,Ws,Ys,zs,Xs,Ks,qs,Js,Zs,Qs,en,tn,sn,nn,on,rn,an,ln,cn,un,hn,dn,pn,gn,mn,fn,_n,bn,Tn,En,yn,In,kn,vn,Cn,Sn,On,An,wn,Rn,Nn,xn,Ln,$n,Dn,Mn,Bn,Pn,Fn,Un,Hn,Gn,Vn,jn,Wn,Yn,zn,Xn,Kn,qn,Jn,Zn,Qn,eo,to,io,so,no,oo,ro,ao,lo,co,uo,ho,po,go,mo,fo,_o,bo,To,Eo,yo,Io,ko,vo,Co,So,Oo,Ao,wo,Ro,No,xo,Lo,$o,Do,Mo,Bo,Po,Fo,Uo,Ho,Go,Vo,jo,Wo,Yo,zo,Xo,Ko,qo,Jo,Zo,Qo,er,tr,ir,sr,nr,or,rr,ar,lr,cr,ur,hr,dr,pr,gr,mr,fr,_r,br,Tr,Er,yr,Ir,kr,vr,Cr,Sr,Or,Ar,wr,Rr,Nr,xr,Lr,$r,Dr={};t=function(e,t,s,n){if(!(e instanceof Ur)&&"string"!=typeof e||""===`${e}`.trim())throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),"string"!=typeof t||""===t.trim())throw Error('Invalid name "'+t+'". The name must be a non-empty string.');const o=t.toLowerCase();if(!s)throw Error("Can not register a null value");let r=Mr[e],a=Pr[e];if(r||(r=Mr[e]=Object.create(null),a=Pr[e]=Object.create(null)),i(e,s),!n&&r[o])throw Error('Name "'+o+'" with type "'+e+'" already registered.');r[o]=s,a[o]=t},i=function(e,t){switch(e){case String(Ur.FIELD):if("function"!=typeof t.fromJson)throw Error('Type "'+e+'" must have a fromJson function')}},s=function(e,t){e=`${e}`.toLowerCase(),t=t.toLowerCase();const i=Mr[e];i&&i[t]?(delete Mr[e][t],delete Pr[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},n=function(e,t,i){e=`${e}`.toLowerCase(),t=t.toLowerCase();const s=Mr[e];if(!s||!s[t]){if(t="Unable to find ["+t+"]["+e+"] in the registry.",i)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null}return s[t]},o=function(e,t){return e=`${e}`.toLowerCase(),t=t.toLowerCase(),!!(e=Mr[e])&&!!e[t]},r=function(e,t,i){return n(e,t,i)},a=function(e,t,i){return n(e,t,i)},l=function(e,t,i){e=`${e}`.toLowerCase();var s=Mr[e];if(!s){if(s=`Unable to find [${e}] in the registry.`,i)throw Error(`${s} You must require or register a ${e} plugin.`);return console.warn(s),null}if(!t)return s;e=Pr[e],i=Object.create(null);for(const t of Object.keys(s))i[e[t]]=s[t];return i},c=function(e,t,i){return"function"==typeof(t=t.plugins[String(e)]||Fr)?t:r(e,t,i)},u=function(e){return Wr[e]||null},h=function(){const e=[];for(const t in Wr)e.push(Wr[t]);return e},d=function(e){Wr[e.id]=e},p=function(e){delete Wr[e.id]},g=function(){return Gr},m=function(e){Gr=e},f=function(){return Yr},_=function(e){Yr=e},b=function(){return Vr},T=function(e){Vr=e},E=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const t=e.getParentSvg(),i=e.getCachedParentSvgSize();var s=t.parentElement;if(s instanceof HTMLElement){var n=s.offsetWidth;s=s.offsetHeight,i.width!==n&&(t.setAttribute("width",n+"px"),e.setCachedParentSvgSize(n,null)),i.height!==s&&(t.setAttribute("height",s+"px"),e.setCachedParentSvgSize(null,s)),e.resize()}},y=function(e,t){const i=Object.create(null),s=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=s.indexOf(e),s.splice(e,s.length-e));for(let e,t=0;e=s[t];t++)i[e.type]?i[e.type]++:i[e.type]=1;return i},I=function(e){return function(){this.jsonInit(e)}},k=function(e){Xr.defineBlocksWithJsonArrayInternal(e)},v=function(e){Dr.defineBlocks$$module$build$src$core$common(Dr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},Dr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const t={};for(let i=0;i<e.length;i++){const s=e[i];if(!s){console.warn(`Block definition #${i} in JSON array is ${s}. Skipping`);continue}const n=s.type;n?t[n]={init:I(s)}:console.warn(`Block definition #${i} in JSON array is missing a type attribute. Skipping.`)}return t},Dr.defineBlocks$$module$build$src$core$common=function(e){for(const t of Object.keys(e)){const i=e[t];t in jr&&console.warn(`Block definiton "${t}" overwrites previous definition.`),jr[t]=i}},C=function(){return"blockly-"+(pa++).toString(36)},S=function(){return da.genUid()},O=function(e){Jr=e},A=function(){return Jr},w=function(e){ua.fireInternal(e)},R=function(e){if($()){if(!ca.length)try{requestAnimationFrame((()=>{setTimeout(N,0)}))}catch(e){setTimeout(N,0)}ca.push(e)}},N=function(){var e=x(ca,!0);ca.length=0;for(let i,s=0;i=e[s];s++)if(i.workspaceId){var t=u(i.workspaceId);t&&t.fireChangeListener(i)}e=new Set(e.map((e=>e.workspaceId)));for(const i of e){if(!i)continue;if(!(e=u(i)))continue;let s;for(t=(e=e.getUndoStack()).length;0<t;t--){const i=e[t-1];if(""===i.group)break;if(void 0===s)s=i.group;else if(i.group!==s)break}s&&t!=e.length-1&&(t=e.splice(t,e.length-t),t=x(t,!0),e.push(...t))}},x=function(e,t){e=e.slice(),t||e.reverse();const i=[],s=Object.create(null);for(let t,r=0;t=e[r];r++)if(!t.isNull()){var n=[t.isUiEvent?ta:t.type,t.blockId,t.workspaceId].join(" "),o=s[n];const e=o?o.event:null;o?t.type===Dr.MOVE$$module$build$src$core$events$utils&&o.index===r-1?(n=t,e.newParentId=n.newParentId,e.newInputName=n.newInputName,e.newCoordinate=n.newCoordinate,n.reason&&(e.reason?(n=new Set(n.reason.concat(e.reason)),e.reason=Array.from(n)):e.reason=n.reason),o.index=r):t.type===Dr.CHANGE$$module$build$src$core$events$utils&&t.element===e.element&&t.name===e.name?e.newValue=t.newValue:t.type===na?(o=t,e.viewTop=o.viewTop,e.viewLeft=o.viewLeft,e.scale=o.scale,e.oldScale=o.oldScale):t.type===ia&&e.type===sa||(s[n]={event:t,index:r},i.push(t)):(s[n]={event:t,index:r},i.push(t))}e=i.filter((function(e){return!e.isNull()})),t||e.reverse();for(let t,i=1;t=e[i];i++)t.type===Dr.CHANGE$$module$build$src$core$events$utils&&"mutation"===t.element&&e.unshift(e.splice(i,1)[0]);return e},L=function(){for(let e,t=0;e=ca[t];t++)e.recordUndo=!1},Dr.disable$$module$build$src$core$events$utils=function(){Zr++},Dr.enable$$module$build$src$core$events$utils=function(){Zr--},$=function(){return 0===Zr},Dr.getGroup$$module$build$src$core$events$utils=function(){return qr},Dr.setGroup$$module$build$src$core$events$utils=function(e){ua.setGroupInternal(e)},D=function(e){qr="boolean"==typeof e?e?S():"":e},M=function(e){const t=[];e=e.getDescendants(!1);for(let i,s=0;i=e[s];s++)t[s]=i.id;return t},B=function(e,t){const i=P(e.type);if(!i)throw Error("Unknown event type.");return i.fromJson(e,t)},P=function(e){const t=r(Ur.EVENT,e);if(!t)throw Error(`Event type ${e} not found in registry.`);return t},F=function(e){if((e.type===Dr.MOVE$$module$build$src$core$events$utils||e.type===Dr.CREATE$$module$build$src$core$events$utils)&&e.workspaceId){var t=u(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){const i=Jr;try{Jr=!1;const s=e.getParent();if(s&&s.isEnabled()){const t=e.getDescendants(!1);for(let e,i=0;e=t[i];i++)e.setEnabled(!0)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())do{e.setEnabled(!1),e=e.getNextBlock()}while(e)}finally{Jr=i}}}},U=function(e,t){H(),Da=setTimeout((function(){t&&t.handleRightClick(e)}),Na)},H=function(){Da&&(clearTimeout(Da),Da=0)},G=function(){La=null},V=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&W(e)},j=function(e){return`${e.pointerId}`},W=function(e){const t=j(e);return La?La===t:"pointerdown"===e.type&&(La=t,!0)},Y=function(e,t,i,s,n){function o(e){(n||V(e))&&(i?s.call(i,e):s(e))}const r=[];if(t in $a)for(let i=0;i<$a[t].length;i++){const s=$a[t][i];e.addEventListener(s,o,!1),r.push([e,s,o])}else e.addEventListener(t,o,!1),r.push([e,t,o]);return r},z=function(e,t,i,s){function n(e){i?s.call(i,e):s(e)}const o=[];if(t in $a)for(let i=0;i<$a[t].length;i++){const s=$a[t][i];e.addEventListener(s,n,!1),o.push([e,s,n])}else e.addEventListener(t,n,!1),o.push([e,t,n]);return o},X=function(e){const t=e[e.length-1][2];for(;e.length;){const[t,i,s]=e.pop();t.removeEventListener(i,s,!1)}return t},K=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||"true"===e.target.getAttribute("data-is-text-input"))return!0;if(e.target instanceof HTMLInputElement)return"text"===(e=e.target).type||"number"===e.type||"email"===e.type||"password"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type;if(e.target instanceof HTMLTextAreaElement)return!0}return!1},q=function(e){return!(!e.ctrlKey||!Ga)||2===e.button},J=function(e,t,i){const s=t.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,i||(i=t.getScreenCTM().inverse()),s.matrixTransform(i)},Z=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*Wa,y:e.deltaY*Wa};case 2:return{x:e.deltaX*Ya,y:e.deltaY*Ya}}},Q=function(e,t){return-1!==(t=e.indexOf(t))&&(e.splice(t,1),!0)},ee=function(e){if(Ja)throw Error("CSS already injected");Za+="\n"+e},te=function(e,t){Ja||(Ja=!0,e&&(e=t.replace(/[\\/]$/,""),t=Za.replace(/<<<PATH>>>/g,e),Za="",(e=document.createElement("style")).id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},ie=function(e,t,i,s){e=e+" was deprecated in "+t+" and will be deleted in "+i+".",s&&(e+="\nUse "+s+" instead."),tl.has(e)||(tl.add(e),console.warn(e))},se=function(e,t,i){e=document.createElementNS(nl,`${e}`);for(const i in t)e.setAttribute(i,`${t[i]}`);return i&&i.appendChild(e),e},ne=function(e,t){return!(t=t.split(" ")).every((t=>e.classList.contains(t)))&&(e.classList.add(...t),!0)},oe=function(e,t){e.classList.remove(...t.split(" "))},re=function(e,t){return!(t=t.split(" ")).every((t=>!e.classList.contains(t)))&&(e.classList.remove(...t),!0)},ae=function(e,t){return e.classList.contains(t)},le=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},ce=function(e,t){const i=t.nextSibling;if(!(t=t.parentNode))throw Error("Reference node has no parent.");i?t.insertBefore(e,i):t.appendChild(e)},ue=function(e,t){return ie("Blockly.utils.dom.containsNode","version 10","version 11",'Use native "contains" DOM method'),e.contains(t)},he=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},de=function(){ll++,al||(al=Object.create(null))},pe=function(){--ll||(al=null)},ge=function(e){const t=e.textContent+"\n"+e.className.baseVal;let i;if(al&&(i=al[t]))return i;try{i=e.getComputedTextLength()}catch(t){return 8*e.textContent.length}return al&&(al[t]=i),i},me=function(e,t,i,s){return fe(e,t+"pt",i,s)},fe=function(e,t,i,s){const n=e.textContent;var o;return e=n+"\n"+e.className.baseVal,al&&(o=al[e])||(cl||((o=document.createElement("canvas")).className="blocklyComputeCanvas",document.body.appendChild(o),cl=o.getContext("2d")),cl.font=i+" "+t+" "+s,o=n?cl.measureText(n).width:0,al&&(al[e]=o)),o},_e=function(e,t,i,s){const n=document.createElement("span");n.style.font=i+" "+t+" "+s,n.textContent=e,(e=document.createElement("div")).style.width="1px",e.style.height="0",(t=document.createElement("div")).style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(n),t.appendChild(e),document.body.appendChild(t),i={height:0,baseline:0};try{t.style.alignItems="baseline",i.baseline=e.offsetTop-n.offsetTop,t.style.alignItems="flex-end",i.height=e.offsetTop-n.offsetTop}finally{document.body.removeChild(t)}return i},be=function(e){return gl.getSizeInternal(e)},Te=function(e){if("none"!==ye(e,"display"))return Ee(e);const t=e.style,i=t.display,s=t.visibility,n=t.position;t.visibility="hidden",t.position="absolute",t.display="inline";const o=e.offsetWidth;return e=e.offsetHeight,t.display=i,t.position=n,t.visibility=s,new pl(o,e)},Ee=function(e){return new pl(e.offsetWidth,e.offsetHeight)},ye=function(e,t){return(e=window.getComputedStyle(e))[t]||e.getPropertyValue(t)},Ie=function(e){const t=new el(0,0);e=e.getBoundingClientRect();var i=document.documentElement;return i=new el(window.pageXOffset||i.scrollLeft,window.pageYOffset||i.scrollTop),t.x=e.left+i.x,t.y=e.top+i.y,t},ke=function(){const e=document.body,t=document.documentElement;return new el(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},ve=function(e){const t=parseFloat(ye(e,"borderLeftWidth")),i=parseFloat(ye(e,"borderRightWidth")),s=parseFloat(ye(e,"borderTopWidth"));return e=parseFloat(ye(e,"borderBottomWidth")),new dl(s,e,t,i)},Ce=function(e,t,i){e=Se(e,t,i),t.scrollLeft=e.x,t.scrollTop=e.y},Se=function(e,t,i){var s=Ie(e),n=Ie(t),o=ve(t);const r=s.x-n.x-o.left;return s=s.y-n.y-o.top,n=Ee(e),e=t.clientWidth-n.width,n=t.clientHeight-n.height,o=t.scrollLeft,t=t.scrollTop,i?(o+=r-e/2,t+=s-n/2):(o+=Math.min(r,Math.max(r-e,0)),t+=Math.min(s,Math.max(s-n,0))),new el(o,t)},Oe=function(e){const t=new el(0,0);var i=e.x&&e.getAttribute("x");const s=e.y&&e.getAttribute("y");return i&&(t.x=parseInt(i)),s&&(t.y=parseInt(s)),(i=(i=e.getAttribute("transform"))&&i.match(fl))&&(t.x+=Number(i[1]),i[3]&&(t.y+=Number(i[3]))),(e=e.getAttribute("style"))&&-1<e.indexOf("translate")&&(e=e.match(_l))&&(t.x+=Number(e[1]),e[3]&&(t.y+=Number(e[3]))),t},Ae=function(e){let t=0,i=0;for(;e;){const s=Oe(e);if(t+=s.x,i+=s.y,-1!==(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;e=e.parentNode}return new el(t,i)},we=function(){const e=ke();return new dl(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},Re=function(){const e=document.documentElement,t=window;return new el(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},Ne=function(e,t){var i=t.x;t=t.y;const s=e.getInjectionDiv().getBoundingClientRect();return i=new el(i-s.left,t-s.top),t=e.getOriginOffsetInPixels(),el.difference(i,t).scale(1/e.scale)},xe=function(e,t){var i=t.scale(e.scale);t=i.x,i=i.y;const s=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new el(t+s.left+e.x,i+s.top+e.y)},Le=function(e){({document:Il=Il,DOMParser:kl=kl,XMLSerializer:vl=vl}=e),El=new kl,yl=new vl},Dr.createElement$$module$build$src$core$utils$xml=function(e){return Il.createElementNS(Cl,e)},Dr.createTextNode$$module$build$src$core$utils$xml=function(e){return Il.createTextNode(e)},Dr.textToDom$$module$build$src$core$utils$xml=function(e){let t=El.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=El.parseFromString(e,"text/html"))&&t.body.firstChild&&"xml"===t.body.firstChild.nodeName.toLowerCase())return t.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},$e=function(e){return De(yl.serializeToString(e))},De=function(e){return e.replace(Sl,(e=>`&#${e.charCodeAt(0)};`))},Me=function(e){return e?((e instanceof Element||"string"==typeof e)&&(e=We(e),e=Ge(e)),Be(e),e):null},Be=function(e){const t=e.kind;if(e=e.contents,t&&t!==Rl&&t!==wl)throw Error("Invalid toolbox kind "+t+". Please supply either "+Rl+" or "+wl);if(!e)throw Error("Toolbox must have a contents attribute.")},Pe=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:Ve(e):[]},Fe=function(e){return $l.hasCategoriesInternal(e)},Ue=function(e){if(!e)return!1;const t=e.kind;return t?t===wl:!!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length},He=function(e){return!(!e||!e.contents||!e.contents.filter((function(e){return"CATEGORY"===e.kind.toUpperCase()})).length)},Ge=function(e){const t={contents:Ve(e)};return e instanceof Node&&je(e,t),t},Ve=function(e){const t=[];let i=e.childNodes;i||(i=e);for(let s,n=0;s=i[n];n++){if(!s.tagName)continue;e={};const i=s.tagName.toUpperCase();e.kind=i,"BLOCK"===i?e.blockxml=s:s.childNodes&&0<s.childNodes.length&&(e.contents=Ve(s)),je(s,e),t.push(e)}return t},je=function(e,t){for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i];-1<s.nodeName.indexOf("css-")?(t.cssconfig=t.cssconfig||{},t.cssconfig[s.nodeName.replace("css-","")]=s.value):t[s.nodeName]=s.value}},We=function(e){let t=null;if(e)if("string"==typeof e){if("xml"!==(t=Dr.textToDom$$module$build$src$core$utils$xml(e)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},Ye=function(e,t,i,s,n,o){const r=o.scrollbar&&o.scrollbar.canScrollVertically();return e.horizontal===xl.LEFT?(i=n.absoluteMetrics.left+i,r&&o.RTL&&(i+=Tl.scrollbarThickness)):(i=n.absoluteMetrics.left+n.viewMetrics.width-t.width-i,r&&!o.RTL&&(i-=Tl.scrollbarThickness)),e.vertical===Nl.TOP?e=n.absoluteMetrics.top+s:(e=n.absoluteMetrics.top+n.viewMetrics.height-t.height-s,o.scrollbar&&o.scrollbar.canScrollHorizontally()&&(e-=Tl.scrollbarThickness)),new dl(e,e+t.height,i,i+t.width)},ze=function(e,t){return{horizontal:t.toolboxMetrics.position===Al.LEFT||e.horizontalLayout&&!e.RTL?xl.RIGHT:xl.LEFT,vertical:t.toolboxMetrics.position===Al.BOTTOM?Nl.TOP:Nl.BOTTOM}},Xe=function(e,t,i,s){const n=e.left,o=e.right-e.left,r=e.bottom-e.top;for(let a=0;a<s.length;a++){const l=s[a];e.intersects(l)&&(e=i===Ll.UP?l.top-r-t:l.bottom+t,e=new dl(e,e+r,n,n+o),a=-1)}return e},Ke=function(e,t){jl(e,t)},qe=function(e){jl=e},Je=function(e,t){zl.confirmInternal(e,t)},Ze=function(e,t){Wl(e,t)},Qe=function(e){Wl=e},et=function(e,t,i){Yl(e,t,i)},tt=function(e){Yl=e},it=function(e){return void 0!==e.getVariableModel},st=function(e){return void 0!==e.getProcedureDef},nt=function(e){return void 0!==e.getProcedureCall&&void 0!==e.renameProcedure},Dr.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let i=0;i<e.length;i++){const s=e[i].getVarModels();if(s)for(let e=0;e<s.length;e++){const i=s[e];i.getId()&&t.add(i)}}return Array.from(t.values())},Dr.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const t=new Set;for(let s,n=0;s=e[n];n++){var i=s.getDeveloperVariables;if(i){i=i();for(let e=0;e<i.length;e++)t.add(i[e])}}return Array.from(t.values())},ot=function(e){let t=[];const i=document.createElement("button");return i.setAttribute("text","%{BKY_NEW_VARIABLE}"),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",(function(e){ut(e.getTargetWorkspace())})),t.push(i),e=rt(e),t.concat(e)},rt=function(e){const t=[];if(0<(e=e.getVariablesOfType("")).length){var i=e[e.length-1];if(jr.variables_set){var s=Dr.createElement$$module$build$src$core$utils$xml("block");s.setAttribute("type","variables_set"),s.setAttribute("gap",jr.math_change?"8":"24"),s.appendChild(_t(i)),t.push(s)}if(jr.math_change&&((s=Dr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","math_change"),s.setAttribute("gap",jr.variables_get?"20":"8"),s.appendChild(_t(i)),i=Dr.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),s.appendChild(i),t.push(s)),jr.variables_get){e.sort(Zl.compareByName);for(let s,n=0;s=e[n];n++)(i=Dr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get"),i.setAttribute("gap","8"),i.appendChild(_t(s)),t.push(i)}}return t},at=function(e){return ec.generateUniqueNameInternal(e)},lt=function(e){return ct(Ql.charAt(0),e.getAllVariableNames())},ct=function(e,t){if(!t.length)return e;const i=Ql;let s="",n=i.indexOf(e);for(;;){let o=!1;for(let i=0;i<t.length;i++)if(t[i].toLowerCase()===e){o=!0;break}if(!o)break;++n===i.length&&(n=0,s=`${Number(s)+1}`),e=i.charAt(n)+s}return e},ut=function(e,t,i){const s=i||"";!function i(n){ht(Dr.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,n,(function(n){if(n){var o=pt(n,e);if(o){if(o.type===s)var r=Dr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",o.name);else r=(r=Dr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",o.name).replace("%2",o.type);Ke(r,(function(){i(n)}))}else e.createVariable(n,s),t&&t(n)}else t&&t(null)}))}("")},Dr.renameVariable$$module$build$src$core$variables=function(e,t,i){!function s(n){const o=Dr.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",t.name);ht(o,n,(function(n){if(n){var o=dt(n,t.type,e),r=gt(t.name,n,e);if(o||r){var a="";o?a=Dr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",o.name).replace("%2",o.type):r&&(a=Dr.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",n).replace("%2",r)),Ke(a,(function(){s(n)}))}else e.renameVariableById(t.getId(),n),i&&i(n)}else i&&i(null)}))}("")},ht=function(e,t,i){et(e,t,(function(e){e&&((e=e.replace(/[\s\xa0]+/g," ").trim())===Dr.Msg$$module$build$src$core$msg.RENAME_VARIABLE||e===Dr.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(e=null),i(e)}))},dt=function(e,t,i){i=i.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let s,n=0;s=i[n];n++)if(s.name.toLowerCase()===e&&s.type!==t)return s;return null},pt=function(e,t){t=t.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let i,s=0;i=t[s];s++)if(i.name.toLowerCase()===e)return i;return null},gt=function(e,t,i){return i.getProcedureMap().getProcedures().length?mt(e,t,i):ft(e,t,i)},mt=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getProcedureMap().getProcedures();for(const n of i){var s=n.getParameters().filter(it).map((e=>e.getVariableModel().name));if(s&&(i=s.some((t=>t.toLowerCase()===e)),s=s.some((e=>e.toLowerCase()===t)),i&&s))return n.getName()}return null},ft=function(e,t,i){e=e.toLowerCase(),t=t.toLowerCase(),i=i.getAllBlocks(!1);for(const n of i){if(!st(n))continue;var s=(i=n.getProcedureDef())[1];const o=s.some((t=>t.toLowerCase()===e));if(s=s.some((e=>e.toLowerCase()===t)),o&&s)return i[0]}return null},_t=function(e){const t=Dr.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.type),e=Dr.createTextNode$$module$build$src$core$utils$xml(e.name),t.appendChild(e),t},Dr.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,i,s){let n=Dr.getVariable$$module$build$src$core$variables(e,t,i,s);return n||(n=bt(e,t,i,s)),n},Dr.getVariable$$module$build$src$core$variables=function(e,t,i,s){const n=e.getPotentialVariableMap();let o=null;if(t&&(!(o=e.getVariableById(t))&&n&&(o=n.getVariableById(t)),o))return o;if(i){if(void 0===s)throw Error("Tried to look up a variable by name without a type");!(o=e.getVariable(i,s))&&n&&(o=n.getVariable(i,s))}return o},bt=function(e,t,i,s){const n=e.getPotentialVariableMap();return i||(i=at(e.isFlyout?e.targetWorkspace:e)),n?n.createVariable(i,s,t):e.createVariable(i,s,t)},Tt=function(e,t){e=e.getAllVariables();const i=[];if(t.length!==e.length)for(let s=0;s<e.length;s++){const n=e[s];-1===t.indexOf(n)&&i.push(n)}return i},Et=function(e,i){t(Ur.PASTER,e,i)},yt=function(e){s(Ur.PASTER,e)},It=function(e){return St(e),Ct()?(Ot(),Promise.resolve()):(cc||(cc=new Promise((e=>{uc=e,hc=window.requestAnimationFrame((()=>{Ot(),e()}))}))),cc)},kt=function(){return cc||Promise.resolve()},vt=function(e){e||window.cancelAnimationFrame(hc),Ot(e),!e&&uc&&uc()},Ct=function(){return Ba},St=function(e){lc.add(e);const t=e.getParent();t?St(t):ac.add(e)},Ot=function(e){const t=e?new Set([e]):new Set([...ac].map((e=>e.workspace))),i=[...ac].filter(wt).filter((e=>t.has(e.workspace)));for(var s of i)Rt(s);for(const e of t)e.resizeContents();for(const e of i)s=e.getRelativeToSurfaceXY(),e.updateComponentLocations(s);for(const e of i)At(e);e||(cc=null)},At=function(e){ac.delete(e),lc.delete(e);for(const t of e.getChildren(!1))At(t)},wt=function(e){return!e.isDisposed()&&!e.getParent()},Rt=function(e){if(lc.has(e)){for(const t of e.getChildren(!1))Rt(t);e.renderEfficiently()}},Nt=function(e,t){const i=Dr.createElement$$module$build$src$core$utils$xml("xml");var s=xt(Dr.allUsedVarModels$$module$build$src$core$variables(e));s.hasChildNodes()&&i.appendChild(s),s=e.getTopComments(!0);for(let e=0;e<s.length;e++)i.appendChild(s[e].toXmlWithXY(t));for(e=e.getTopBlocks(!0),s=0;s<e.length;s++)i.appendChild(Lt(e[s],t));return i},xt=function(e){const t=Dr.createElement$$module$build$src$core$utils$xml("variables");for(let i=0;i<e.length;i++){const s=e[i],n=Dr.createElement$$module$build$src$core$utils$xml("variable");n.appendChild(Dr.createTextNode$$module$build$src$core$utils$xml(s.name)),s.type&&n.setAttribute("type",s.type),n.id=s.getId(),t.appendChild(n)}return t},Lt=function(e,t){if(e.isInsertionMarker()&&!(e=e.getChildren(!1)[0]))return new DocumentFragment;let i=0;if(e.workspace.RTL&&(i=e.workspace.getWidth()),t=Mt(e,t),ti(t)){const s=e.getRelativeToSurfaceXY();t.setAttribute("x",String(Math.round(e.workspace.RTL?i-s.x:s.x))),t.setAttribute("y",String(Math.round(s.y)))}return t},$t=function(e){if(e.isSerializable()){const t=Dr.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name",e.name||""),e.toXml(t)}return null},Dt=function(e,t){for(let i=0;i<e.inputList.length;i++){const s=e.inputList[i];for(let e=0;e<s.fieldRow.length;e++){const i=$t(s.fieldRow[e]);i&&t.appendChild(i)}}},Mt=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?Mt(t):new DocumentFragment;const i=Dr.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(i.setAttribute("type",e.type),t||(i.id=e.id),e.mutationToDom){var s=e.mutationToDom();s&&(s.hasChildNodes()||s.hasAttributes())&&i.appendChild(s)}if(Dt(e,i),s=e.getCommentText()){var n=e.getIcon(Hl.COMMENT),o=n.getBubbleSize();n=n.bubbleIsVisible();var r=Dr.createElement$$module$build$src$core$utils$xml("comment");r.appendChild(Dr.createTextNode$$module$build$src$core$utils$xml(s)),r.setAttribute("pinned",`${n}`),r.setAttribute("h",String(o.height)),r.setAttribute("w",String(o.width)),i.appendChild(r)}for(e.data&&((s=Dr.createElement$$module$build$src$core$utils$xml("data")).appendChild(Dr.createTextNode$$module$build$src$core$utils$xml(e.data)),i.appendChild(s)),s=0;s<e.inputList.length;s++){var a=void 0;if(n=!0,(o=e.inputList[s]).type!==Dr.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&o.type!==Dr.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){r=o.connection.targetBlock(),o.type===Dr.inputTypes$$module$build$src$core$inputs$input_types.VALUE?a=Dr.createElement$$module$build$src$core$utils$xml("value"):o.type===Dr.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(a=Dr.createElement$$module$build$src$core$utils$xml("statement"));const e=o.connection.getShadowDom();!e||r&&r.isShadow()||a.appendChild(Bt(e,t)),r&&(r=Mt(r,t)).nodeType===sl.ELEMENT_NODE&&(a.appendChild(r),n=!1),a.setAttribute("name",o.name),n||i.appendChild(a)}}let l;return void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&i.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isEnabled()||i.setAttribute("disabled","true"),e.isDeletable()||e.isShadow()||i.setAttribute("deletable","false"),e.isMovable()||e.isShadow()||i.setAttribute("movable","false"),e.isEditable()||i.setAttribute("editable","false"),(a=e.getNextBlock())&&(s=Mt(a,t)).nodeType===sl.ELEMENT_NODE&&((l=Dr.createElement$$module$build$src$core$utils$xml("next")).appendChild(s),i.appendChild(l)),!(e=e.nextConnection&&e.nextConnection.getShadowDom())||a&&a.isShadow()||l.appendChild(Bt(e,t)),i},Bt=function(e,t){let i,s=e=e.cloneNode(!0);for(;s;)if(t&&"shadow"===s.nodeName&&s.removeAttribute("id"),s.firstChild)s=s.firstChild;else{for(;s&&!s.nextSibling;){let e;i=s,s=s.parentNode,i.nodeType===sl.TEXT_NODE&&""===i.data.trim()&&(null==(e=s)?void 0:e.firstChild)!==i&&le(i)}s&&(i=s,s=s.nextSibling,i.nodeType===sl.TEXT_NODE&&""===i.data.trim()&&le(i))}return e},Pt=function(e){return $e(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Ft=function(e){e=Pt(e).split("<");let t="";for(let i=1;i<e.length;i++){const s=e[i];"/"===s[0]&&(t=t.substring(2)),e[i]=t+"<"+s,"/"!==s[0]&&"/>"!==s.slice(-2)&&(t+="  ")}return(e=(e=e.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},Ut=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=Dr.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},Dr.domToWorkspace$$module$build$src$core$xml=function(e,t){let i=0;t.RTL&&(i=t.getWidth());const s=[];de();const n=Dr.getGroup$$module$build$src$core$events$utils();n||Dr.setGroup$$module$build$src$core$events$utils(!0),t.setResizesEnabled&&t.setResizesEnabled(!1);let o=!0;try{for(let n,r=0;n=e.childNodes[r];r++){const e=n.nodeName.toLowerCase(),r=n;if("block"===e||"shadow"===e&&!A()){const e=Gt(r,t);let n;s.push(e.id);const a=parseInt(null!=(n=r.getAttribute("x"))?n:"10",10);let l;const c=parseInt(null!=(l=r.getAttribute("y"))?l:"10",10);isNaN(a)||isNaN(c)||e.moveBy(t.RTL?i-a:a,c,["create"]),o=!1}else{if("shadow"===e)throw TypeError("Shadow block cannot be a top-level block.");if("comment"===e)t.rendered?rc.fromXmlRendered(r,t,i):ic.fromXml(r,t);else if("variables"===e){if(!o)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");Vt(r,t),o=!1}}}}finally{Dr.setGroup$$module$build$src$core$events$utils(n),t.setResizesEnabled&&t.setResizesEnabled(!0),t.rendered&&vt(),pe()}return w(new(P(aa))(t)),s},Ht=function(e,t){if(!t.getBlocksBoundingBox)return Dr.domToWorkspace$$module$build$src$core$xml(e,t);var i=t.getBlocksBoundingBox();if(e=Dr.domToWorkspace$$module$build$src$core$xml(e,t),i&&i.top!==i.bottom){var s=i.bottom;i=t.RTL?i.right:i.left;var n=1/0;let o=-1/0,r=1/0;for(let i=0;i<e.length;i++){const s=t.getBlockById(e[i]).getRelativeToSurfaceXY();s.y<r&&(r=s.y),s.x<n&&(n=s.x),s.x>o&&(o=s.x)}for(s=s-r+10,i=t.RTL?i-o:i-n,n=0;n<e.length;n++)t.getBlockById(e[n]).moveBy(i,s,["create"])}return e},Dr.domToBlock$$module$build$src$core$xml=function(e,t){return e=Gt(e,t),t.rendered&&vt(),e},Gt=function(e,t){Dr.disable$$module$build$src$core$events$utils();var i=t.getAllVariables();let s;try{if(s=Zt(e,t),t.rendered){const e=s,i=s.getDescendants(!1);e.setConnectionTracking(!1);for(let e=i.length-1;0<=e;e--)i[e].initSvg();for(let e=i.length-1;0<=e;e--)i[e].queueRender();setTimeout((function(){e.disposed||e.setConnectionTracking(!0)}),1),t.resizeContents()}else{const e=s.getDescendants(!1);for(let t=e.length-1;0<=t;t--)e[t].initModel()}}finally{Dr.enable$$module$build$src$core$events$utils()}if($()){for(e=Tt(t,i),t=0;t<e.length;t++)i=e[t],w(new(P(ea))(i));w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(s))}return s},Vt=function(e,t){for(let s=0;s<e.children.length;s++){var i=e.children[s];const n=i.getAttribute("type"),o=i.getAttribute("id");if(!(i=i.textContent))break;t.createVariable(i,n,o)}},jt=function(e){const t={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let i=0;i<e.children.length;i++){const s=e.children[i];if(s.nodeType!==sl.TEXT_NODE)switch(s.nodeName.toLowerCase()){case"mutation":t.mutation.push(s);break;case"comment":t.comment.push(s);break;case"data":t.data.push(s);break;case"title":case"field":t.field.push(s);break;case"value":case"statement":t.input.push(s);break;case"next":t.next.push(s);break;default:console.warn("Ignoring unknown tag: "+s.nodeName)}}return t},Wt=function(e,t){let i=!1;for(let s=0;s<e.length;s++){const n=e[s];t.domToMutation&&(t.domToMutation(n),t.initSvg&&(i=!0))}return i},Yt=function(e,t){for(let s=0;s<e.length;s++){var i=e[s];const n=i.textContent,o="true"===i.getAttribute("pinned");let r;const a=parseInt(null!=(r=i.getAttribute("w"))?r:"50",10);let l;i=parseInt(null!=(l=i.getAttribute("h"))?l:"50",10),t.setCommentText(n);const c=t.getIcon(Hl.COMMENT);isNaN(a)||isNaN(i)||c.setBubbleSize(new pl(a,i)),c.setBubbleVisible(o),setTimeout((()=>c.setBubbleVisible(o)),1)}},zt=function(e,t){for(let i=0;i<e.length;i++)t.data=e[i].textContent},Xt=function(e,t){for(let i=0;i<e.length;i++){const s=e[i],n=s.getAttribute("name");n?Qt(t,n,s):console.warn(`Ignoring unnamed field in block ${t.type}`)}},Kt=function(e){let t=null,i=null;for(let s=0;s<e.childNodes.length;s++){const n=e.childNodes[s];ti(n)&&("block"===n.nodeName.toLowerCase()?t=n:"shadow"===n.nodeName.toLowerCase()&&(i=n))}return{childBlockElement:t,childShadowElement:i}},qt=function(e,t,i,s){for(let o=0;o<e.length;o++){var n=e[o];const r=n.getAttribute("name"),a=r?i.getInput(r):null;if(!a){console.warn("Ignoring non-existent input "+r+" in block "+s);break}if((n=Kt(n)).childBlockElement){if(!a.connection)throw TypeError("Input connection does not exist.");Zt(n.childBlockElement,t,a.connection,!1)}if(n.childShadowElement){let e;null==(e=a.connection)||e.setShadowDom(n.childShadowElement)}}},Jt=function(e,t,i){for(let s=0;s<e.length;s++){const n=Kt(e[s]);if(n.childBlockElement){if(!i.nextConnection)throw TypeError("Next statement does not exist.");if(i.nextConnection.isConnected())throw TypeError("Next statement is already connected.");Zt(n.childBlockElement,t,i.nextConnection,!0)}n.childShadowElement&&i.nextConnection&&i.nextConnection.setShadowDom(n.childShadowElement)}},Zt=function(e,t,i,s){var n;const o=e.getAttribute("type");if(!o)throw TypeError("Block type unspecified: "+e.outerHTML);var r=null!=(n=e.getAttribute("id"))?n:void 0;n=t.newBlock(o,r),r=jt(e);const a=Wt(r.mutation,n);if(Yt(r.comment,n),zt(r.data,n),i)if(s){if(!n.previousConnection)throw TypeError("Next block does not have previous statement.");i.connect(n.previousConnection)}else if(n.outputConnection)i.connect(n.outputConnection);else{if(!n.previousConnection)throw TypeError("Child block does not have output or previous statement.");i.connect(n.previousConnection)}if(Xt(r.field,n),qt(r.input,t,n,o),Jt(r.next,t,n),a&&n.initSvg(),(t=e.getAttribute("inline"))&&n.setInputsInline("true"===t),(t=e.getAttribute("disabled"))&&n.setEnabled("true"!==t&&"disabled"!==t),(t=e.getAttribute("deletable"))&&n.setDeletable("true"===t),(t=e.getAttribute("movable"))&&n.setMovable("true"===t),(t=e.getAttribute("editable"))&&n.setEditable("true"===t),(t=e.getAttribute("collapsed"))&&n.setCollapsed("true"===t),"shadow"===e.nodeName.toLowerCase()){for(e=n.getChildren(!1),t=0;t<e.length;t++)if(!e[t].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");n.setShadow(!0)}return n},Qt=function(e,t,i){const s=e.getField(t);s?s.fromXml(i):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},ei=function(e){for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes[t];if("next"===i.nodeName.toLowerCase()){e.removeChild(i);break}}},ti=function(e){return e.nodeType===sl.ELEMENT_NODE},ii=function(e){return void 0!==e.saveState&&void 0!==e.loadState},si=function(e,i){t(Ur.SERIALIZER,e,i)},ni=function(e){s(Ur.SERIALIZER,e)},oi=function(e,{addCoordinates:t=!1,addInputBlocks:i=!0,addNextBlocks:s=!0,doFullSerialization:n=!0,saveIds:o=!0}={}){if(e.isInsertionMarker())return null;const r={type:e.type,id:o?e.id:void 0};return t&&ai(e,r),ri(e,r),li(e,r,n),ci(e,r,n),ui(e,r,n),i&&hi(e,r,n,o),s&&di(e,r,n,o),r},ri=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.enabled=!1),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},ai=function(e,t){const i=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(i.RTL?i.getWidth()-e.x:e.x),t.y=Math.round(e.y)},li=function(e,t,i){e.saveExtraState?null!==(e=e.saveExtraState(i))&&(t.extraState=e):e.mutationToDom&&null!==(e=e.mutationToDom())&&(t.extraState=Pt(e).replace(' xmlns="https://developers.google.com/blockly/xml"',""))},ci=function(e,t,i){const s=Object.create(null);for(const t of e.getIcons())ii(t)&&(e=t.saveState(i))&&(s[t.getType().toString()]=e);Object.keys(s).length&&(t.icons=s)},ui=function(e,t,i){const s=Object.create(null);for(let t=0;t<e.inputList.length;t++){const n=e.inputList[t];for(let e=0;e<n.fieldRow.length;e++){const t=n.fieldRow[e];t.isSerializable()&&(s[t.name]=t.saveState(i))}}Object.keys(s).length&&(t.fields=s)},hi=function(e,t,i,s){const n=Object.create(null);for(let t=0;t<e.inputList.length;t++){const o=e.inputList[t];if(!o.connection)continue;const r=pi(o.connection,i,s);r&&(n[o.name]=r)}Object.keys(n).length&&(t.inputs=n)},di=function(e,t,i,s){e.nextConnection&&(e=pi(e.nextConnection,i,s))&&(t.next=e)},pi=function(e,t,i){const s=e.getShadowState(!0);if(e=e.targetBlock(),!s&&!e)return null;const n=Object.create(null);return s&&(n.shadow=s),e&&!e.isShadow()&&(n.block=oi(e,{doFullSerialization:t,saveIds:i})),n},gi=function(e,t,{recordUndo:i=!1}={}){return e=mi(e,t,{recordUndo:i}),t.rendered&&vt(),e},mi=function(e,t,{parentConnection:i,isShadow:s=!1,recordUndo:n=!1}={}){const o=A();let r;O(n),(n=Dr.getGroup$$module$build$src$core$events$utils())||Dr.setGroup$$module$build$src$core$events$utils(!0),Dr.disable$$module$build$src$core$events$utils();try{r=fi(e,t,{parentConnection:i,isShadow:s})}finally{Dr.enable$$module$build$src$core$events$utils()}if($()&&w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(r)),Dr.setGroup$$module$build$src$core$events$utils(n),O(o),t.rendered){const e=r;setTimeout((()=>{e.disposed||e.setConnectionTracking(!0)}),1)}return r},fi=function(e,t,{parentConnection:i,isShadow:s=!1}={}){if(!e.type)throw new mc(e);const n=t.newBlock(e.type,e.id);return n.setShadow(s),_i(n,e),bi(n,e),Ti(n,e),Ei(i,n,e),yi(n,e),Ii(n,e),ki(n,e),vi(n,e),Si(n,t.rendered),n},_i=function(e,t){let i=void 0===t.x?0:t.x;t=void 0===t.y?0:t.y;const s=e.workspace;i=s.RTL?s.getWidth()-i:i,e.moveBy(i,t)},bi=function(e,t){t.collapsed&&e.setCollapsed(!0),!1===t.deletable&&e.setDeletable(!1),!1===t.movable&&e.setMovable(!1),!1===t.editable&&e.setEditable(!1),!1===t.enabled&&e.setEnabled(!1),void 0!==t.inline&&e.setInputsInline(t.inline),void 0!==t.data&&(e.data=t.data)},Ti=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation(Dr.textToDom$$module$build$src$core$utils$xml(t.extraState)))},Ei=function(e,t,i){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new bc(i);if(e.type===Dr.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var s=t.outputConnection;if(!s)throw new fc("output",t,i)}else if(!(s=t.previousConnection))throw new fc("previous",t,i);if(!e.connect(s)){const n=t.workspace.connectionChecker;throw new _c(n.getErrorMessage(n.canConnectWithReason(s,e,!1),s,e),e.type===Dr.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,i)}}},yi=function(e,t){if(t.icons){var i=Object.keys(t.icons);for(const n of i){i=t.icons[n];var s=e.getIcon(n);if(!s){if(!(s=r(Ur.ICON,n,!1)))throw new Tc(n,e,t);s=new s(e),e.addIcon(s)}ii(s)&&s.loadState(i)}}},Ii=function(e,t){if(t.fields){var i=Object.keys(t.fields);for(let s=0;s<i.length;s++){const n=i[s],o=t.fields[n],r=e.getField(n);r?r.loadState(o):console.warn(`Ignoring non-existant field ${n} in block ${e.type}`)}}},ki=function(e,t){if(t.inputs){var i=Object.keys(t.inputs);for(let s=0;s<i.length;s++){const n=i[s],o=e.getInput(n);if(!o||!o.connection)throw new fc(n,e,t);Ci(o.connection,t.inputs[n])}}},vi=function(e,t){if(t.next){if(!e.nextConnection)throw new fc("next",e,t);Ci(e.nextConnection,t.next)}},Ci=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&fi(t.block,e.getSourceBlock().workspace,{parentConnection:e})},Si=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const t of e.getIcons())t.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},Oi=function(e){const t=e.workspace,i=Dr.config$$module$build$src$core$config.snapRadius,s=e.getRelativeToSurfaceXY(),n=new el(0,0),o=t.getAllBlocks(!1).filter((t=>t.id!=e.id)).map((e=>e.getRelativeToSurfaceXY()));for(;Ai(el.sum(s,n),o)||wi(e,n,i);)t.RTL?n.translate(-i,2*i):n.translate(i,2*i);e.moveTo(el.sum(s,n))},Ai=function(e,t){return t.some((t=>1>=Math.abs(t.x-e.x)&&1>=Math.abs(t.y-e.y)))},wi=function(e,t,i){return e.getConnections_(!1).some((e=>!!e.closest(i,t).connection))},Ri=function(e){return ie("Blockly.clipboard.copy","v11","v12","myCopyable.toCopyData()"),Dc.copyInternal(e)},Ni=function(e){const t=e.toCopyData();let i;return Lc=t,$c=null!=(i=e.workspace)?i:null,t},xi=function(e,t,i){return e&&t?Li(e,t,i):Lc&&$c?Li(Lc,$c):null},Li=function(e,t,i){let s,n,o;return t=null!=(s=t.getRootWorkspace())?s:t,null!=(o=null==(n=a(Ur.PASTER,e.paster,!1))?void 0:n.paste(e,t,i))?o:null},$i=function(e){return ie("Blockly.clipboard.duplicate","v11","v12","Blockly.clipboard.paste(myCopyable.toCopyData(), myWorkspace)"),Dc.duplicateInternal(e)},Di=function(e){const t=e.toCopyData();return t?xi(t,e.workspace):null},Mi=function(e,t){e.setAttribute(Uc,t)},Bi=function(e,t,i){Array.isArray(i)&&(i=i.join(" ")),e.setAttribute(Fc+t,`${i}`)},Pi=function(){return Gc},Fi=function(e){if(Gc=e,null===e){let e;null==(e=document.querySelector("."+zc))||e.remove()}},Ui=function(){document.querySelector("."+zc)||((Gc=document.createElement("div")).className=zc,(b()||document.body).appendChild(Gc))},Hi=function(e,t,i){Gi(),Wc=e,Yc=i,(e=Gc)&&(e.style.direction=t?"rtl":"ltr",e.style.display="block",t=g(),Xc=t.getRenderer().getClassName(),Kc=t.getTheme().getClassName(),Xc&&ne(e,Xc),Kc&&ne(e,Kc))},Gi=function(){if(Vi()){Wc=null;var e=Gc;e&&(e.style.display="none",e.style.left="",e.style.top="",Yc&&Yc(),Yc=null,e.textContent="",Xc&&(re(e,Xc),Xc=""),Kc&&(re(e,Kc),Kc=""),g().markFocused())}},Vi=function(){return!!Wc},ji=function(e){Wc===e&&Gi()},Wi=function(e,t,i){Gc.style.left=e+"px",Gc.style.top=t+"px",Gc.style.height=i+"px"},Yi=function(e,t,i,s){const n=Xi(e,t,i);e=zi(e,t,i,s),0>n?Wi(e,0,i.height+n):Wi(e,n,i.height)},zi=function(e,t,i,s){return s?Math.min(Math.max(t.right-i.width,e.left),e.right-i.width):Math.max(Math.min(t.left,e.right-i.width),e.left)},Xi=function(e,t,i){return t.bottom+i.height>=e.bottom?t.top-i.height:t.bottom},Ki=function(e){return!(null==e||!e.repositionForWindowResize)},qi=function(){Ki(Wc)&&Wc.repositionForWindowResize()||Gi()},Ji=function(){return Jc},Zi=function(e){Jc=e},Qi=function(e,t,i){if(Hi(Zc,i,os),t.length){var s=es(t,i);Qc=s,ts(s,e,i),setTimeout((function(){s.focus()}),1),Jc=null}else ns()},es=function(e,t){const i=new Vc;i.setRole(Bc.MENU);for(let s=0;s<e.length;s++){const n=e[s],o=new jc(n.text);o.setRightToLeft(t),o.setRole(Bc.MENUITEM),i.addChild(o),o.setEnabled(n.enabled),n.enabled&&o.onAction((function(){ns(),requestAnimationFrame((()=>{setTimeout((()=>{n.callback(n.scope)}),0)}))}),{})}return i},ts=function(e,t,i){const s=we();t=new dl(t.clientY+s.top,t.clientY+s.top,t.clientX+s.left,t.clientX+s.left),is(e);const n=e.getSize();i&&(t.left+=n.width,t.right+=n.width,s.left+=n.width,s.right+=n.width),Yi(s,t,n,i),e.focus()},is=function(e){var t=Pi();if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),ne(t,"blocklyContextMenu"),Y(t,"contextmenu",null,ss),e.focus()},ss=function(e){e.preventDefault(),e.stopPropagation()},ns=function(){ji(Zc),Jc=null},os=function(){Qc&&(Qc.dispose(),Qc=null)},Dr.callbackFactory$$module$build$src$core$contextmenu=function(e,t){return()=>{let i;Dr.disable$$module$build$src$core$events$utils();try{i=t instanceof Element?Gt(t,e.workspace):mi(t,e.workspace);const s=e.getRelativeToSurfaceXY();s.x=e.RTL?s.x-Dr.config$$module$build$src$core$config.snapRadius:s.x+Dr.config$$module$build$src$core$config.snapRadius,s.y+=2*Dr.config$$module$build$src$core$config.snapRadius,i.moveBy(s.x,s.y)}finally{Dr.enable$$module$build$src$core$events$utils()}return $()&&!i.isShadow()&&w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(i)),i.select(),i}},rs=function(e){return{text:Dr.Msg$$module$build$src$core$msg.REMOVE_COMMENT,enabled:!0,callback:function(){Dr.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),Dr.setGroup$$module$build$src$core$events$utils(!1)}}},as=function(e){return{text:Dr.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,enabled:!0,callback:function(){const t=e.toCopyData();t&&xi(t,e.workspace)}}},ls=function(e,t){const i={enabled:!0};return i.text=Dr.Msg$$module$build$src$core$msg.ADD_COMMENT,i.callback=function(){const i=new rc(e,Dr.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT,rc.DEFAULT_SIZE,rc.DEFAULT_SIZE);var s=e.getInjectionDiv().getBoundingClientRect();s=new el(t.clientX-s.left,t.clientY-s.top);const n=e.getOriginOffsetInPixels();(s=el.difference(s,n)).scale(1/e.scale),i.moveBy(s.x,s.y),e.rendered&&(i.initSvg(),i.render(),i.select())},i},cs=function(e){return e*Math.PI/180},us=function(e){return 180*e/Math.PI},hs=function(e,t,i){if(i<e){const t=i;i=e,e=t}return Math.max(e,Math.min(t,i))},ds=function(){document.querySelector(".blocklyDropDownDiv")||((ou=document.createElement("div")).className="blocklyDropDownDiv",(b()||document.body).appendChild(ou),(ru=document.createElement("div")).className="blocklyDropDownContent",ou.appendChild(ru),(au=document.createElement("div")).className="blocklyDropDownArrow",ou.appendChild(au),ou.style.opacity="0",ou.style.transition="transform "+du+"s, opacity "+du+"s",ou.addEventListener("focusin",(function(){ne(ou,"blocklyFocused")})),ou.addEventListener("focusout",(function(){re(ou,"blocklyFocused")})))},ps=function(e){_u=e},gs=function(){return bu},ms=function(){return ru},fs=function(){ru.textContent="",ru.style.width=""},_s=function(e,t){ou.style.backgroundColor=e,ou.style.borderColor=t},bs=function(e,t,i,s){return Is(Es(t),e,i,s)},Ts=function(e,t,i){return Tu=!0,Is(ys(e),e,t,i)},Es=function(e){var t=e.getSvgRoot();const i=e.workspace.scale,s=e.height*i;return e=e.width*i,t=Ie(t),new dl(t.y,t.y+s,t.x,t.x+e)},ys=function(e){return e=e.getScaledBBox(),new dl(e.top,e.bottom,e.left,e.right)},Is=function(e,t,i,s){const n=e.left+(e.right-e.left)/2,o=e.bottom;e=e.top,s&&(e+=s);let r=(s=t.getSourceBlock()).workspace;for(;r.options.parentWorkspace;)r=r.options.parentWorkspace;return ps(r.getParentSvg().parentNode),ks(t,s.RTL,n,o,n,e,i)},ks=function(e,t,i,s,n,o,r){return bu=e,gu=r||null,ou.style.direction=t?"rtl":"ltr",e=g(),mu=e.getRenderer().getClassName(),fu=e.getTheme().getClassName(),mu&&ne(ou,mu),fu&&ne(ou,fu),xs(i,s,n,o)},vs=function(e,t,i,s){return{initialX:(e=Os(e,i.left,i.right,s.width)).divX,initialY:t,finalX:e.divX,finalY:t+hu,arrowX:e.arrowX,arrowY:-(lu/2+cu),arrowAtTop:!0,arrowVisible:!0}},Cs=function(e,t,i,s){return{initialX:(e=Os(e,i.left,i.right,s.width)).divX,initialY:t-s.height,finalX:e.divX,finalY:t-s.height-hu,arrowX:e.arrowX,arrowY:s.height-2*cu-lu/2,arrowAtTop:!1,arrowVisible:!0}},Ss=function(e,t,i){return{initialX:(e=Os(e,t.left,t.right,i.width)).divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Os=function(e,t,i,s){return t=hs(t,e-s/2,i-s),{arrowX:e=hs(i=uu,e=e-lu/2-t,s-i-lu),divX:t}},As=function(){return!!bu},ws=function(e,t){return bu===e&&(t?Ns():Rs(),!0)},Rs=function(){ou.style.transform="translate(0, 0)",ou.style.opacity="0",pu=setTimeout((function(){Ns()}),1e3*du),gu&&(gu(),gu=null)},Ns=function(){As()&&(pu&&clearTimeout(pu),ou.style.transform="",ou.style.left="",ou.style.top="",ou.style.opacity="0",ou.style.display="none",ou.style.backgroundColor="",ou.style.borderColor="",gu&&(gu(),gu=null),fs(),bu=null,mu&&(re(ou,mu),mu=""),fu&&(re(ou,fu),fu=""),g().markFocused())},xs=function(e,t,i,s){(e=Eu.getPositionMetrics(e,t,i,s)).arrowVisible?(au.style.display="",au.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",au.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):au.style.display="none",t=Math.floor(e.initialX),i=Math.floor(e.initialY),s=Math.floor(e.finalX);const n=Math.floor(e.finalY);return ou.style.left=t+"px",ou.style.top=i+"px",ou.style.display="block",ou.style.opacity="1",ou.style.transform="translate("+(s-t)+"px,"+(n-i)+"px)",!!e.arrowAtTop},Ls=function(){if(bu){var e=bu.getSourceBlock();const t=(e=Tu?ys(bu):Es(e)).left+(e.right-e.left)/2;xs(t,e.bottom,t,e.top)}else Rs()},$s=function(e){if(!(100<e.getDescendants(!1).length)){var t=e.workspace,i=e.getSvgRoot();t.getAudioManager().play("delete");var s=t.getSvgXY(i);(i=i.cloneNode(!0)).setAttribute("transform","translate("+s.x+","+s.y+")"),t.getParentSvg().appendChild(i),Ds(i,{x:s.x,y:s.y,width:e.width,height:e.height},t.RTL,new Date,t.scale)}},Ds=function(e,t,i,s,n){const o=((new Date).getTime()-s.getTime())/150;1<o?le(e):(e.setAttribute("transform","translate("+(t.x+(i?-1:1)*t.width*n/2*o)+","+(t.y+t.height*n*o)+") scale("+(1-o)*n+")"),setTimeout(Ds,10,e,t,i,s,n))},Ms=function(e){var t=e.workspace;const i=t.scale;if(t.getAudioManager().play("click"),!(1>i)){var s=t.getSvgXY(e.getSvgRoot());e.outputConnection?(s.x+=(e.RTL?3:-3)*i,s.y+=13*i):e.previousConnection&&(s.x+=(e.RTL?-23:23)*i,s.y+=3*i);var n=se(hl.CIRCLE,{cx:s.x,cy:s.y,r:0,fill:"none",stroke:"#888","stroke-width":10},t.getParentSvg());e=se(hl.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*i},n),t=se(hl.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},n),e.beginElement(),t.beginElement(),setTimeout((()=>{le(n)}),150)}},Bs=function(e){if(Fs(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var t=e.getHeightWidth().height;t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),ku=e,Ps(e,t,new Date)}},Ps=function(e,t,i){const s=((new Date).getTime()-i.getTime())/200;let n="";1>=s&&(n=`skewX(${Math.round(Math.sin(s*Math.PI*3)*(1-s)*t)})`,Iu=setTimeout(Ps,10,e,t,i)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${n}`)},Fs=function(){ku&&(Iu&&(clearTimeout(Iu),Iu=null),ku.getSvgRoot().setAttribute("transform",ku.getTranslation()),ku=null)},Us=function(e,t){return ie("Blockly.utils.string.startsWith()","April 2022","April 2023","Use built-in string.startsWith"),e.startsWith(t)},Hs=function(e){return e.length?e.reduce((function(e,t){return e.length<t.length?e:t})).length:0},Gs=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,s=0;for(t=t||Hs(e),i=0;i<t;i++){for(var n=e[0][i],o=1;o<e.length;o++)if(n!==e[o][i])return s;" "===n&&(s=i+1)}for(n=1;n<e.length;n++)if((o=e[n][i])&&" "!==o)return s;return t},Vs=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i,s=0;for(t=t||Hs(e),i=0;i<t;i++){for(var n=e[0].substr(-i-1,1),o=1;o<e.length;o++)if(n!==e[o].substr(-i-1,1))return s;" "===n&&(s=i+1)}for(n=1;n<e.length;n++)if((o=e[n].charAt(e[n].length-i-1))&&" "!==o)return s;return t},Dr.wrap$$module$build$src$core$utils$string=function(e,t){e=e.split("\n");for(let i=0;i<e.length;i++)e[i]=js(e[i],t);return e.join("\n")},js=function(e,t){if(e.length<=t)return e;const i=e.trim().split(/\s+/);for(var s=0;s<i.length;s++)i[s].length>t&&(t=i[s].length);var n=-1/0;let o,r=1;do{s=n,o=e,e=[],n=i.length/r;let a=1;for(let t=0;t<i.length-1;t++)a<(t+1.5)/n?(a++,e[t]=!0):e[t]=!1;e=Ys(i,e,t),n=Ws(i,e,t),e=zs(i,e),r++}while(n>s);return o},Ws=function(e,t,i){const s=[0],n=[];for(var o=0;o<e.length;o++)s[s.length-1]+=e[o].length,!0===t[o]?(s.push(0),n.push(e[o].charAt(e[o].length-1))):!1===t[o]&&s[s.length-1]++;for(e=Math.max(...s),t=0,o=0;o<s.length;o++)t-=2*Math.pow(Math.abs(i-s[o]),1.5),t-=Math.pow(e-s[o],1.5),-1!==".?!".indexOf(n[o])?t+=i/3:-1!==",;)]}".indexOf(n[o])&&(t+=i/4);return 1<s.length&&s[s.length-1]<=s[s.length-2]&&(t+=.5),t},Ys=function(e,t,i){let s,n=Ws(e,t,i);for(let o=0;o<t.length-1;o++){if(t[o]===t[o+1])continue;const r=[].concat(t);r[o]=!r[o],r[o+1]=!r[o+1];const a=Ws(e,r,i);a>n&&(n=a,s=r)}return s?Ys(e,s,i):t},zs=function(e,t){const i=[];for(let s=0;s<e.length;s++)i.push(e[s]),void 0!==t[s]&&i.push(t[s]?"\n":" ");return i.join("")},Dr.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},Xs=function(e){Au=e},Ks=function(){return Au},qs=function(){return wu},Js=function(){return Vu},Zs=function(e){if(e=Qs(e)){for(e=e.tooltip;"function"==typeof e;)e=e();if("string"!=typeof e)throw Error("Tooltip function must return a string.");return e}return""},Qs=function(e){for(;e&&e.tooltip;){if("string"==typeof e.tooltip||"function"==typeof e.tooltip)return e;e=e.tooltip}return null},en=function(){document.querySelector(".blocklyTooltipDiv")||((Vu=document.createElement("div")).className="blocklyTooltipDiv",(b()||document.body).appendChild(Vu))},tn=function(e){e.mouseOverWrapper_=z(e,"pointerover",null,nn),e.mouseOutWrapper_=z(e,"pointerout",null,on),e.addEventListener("pointermove",rn,!1)},sn=function(e){e&&(X(e.mouseOverWrapper_),X(e.mouseOutWrapper_),e.removeEventListener("pointermove",rn))},nn=function(e){Ru||(e=Qs(e.currentTarget),Mu!==e&&(ln(),Bu=null,Mu=e),clearTimeout(xu))},on=function(e){Ru||(xu=setTimeout((function(){Bu=Mu=null,ln()}),1),clearTimeout(Lu),Lu=0)},rn=function(e){if(Mu&&Mu.tooltip&&!Ru)if(wu){const t=$u-e.pageX;e=Du-e.pageY,Math.sqrt(t*t+e*e)>Uu&&ln()}else Bu!==Mu&&(clearTimeout(Lu),$u=e.pageX,Du=e.pageY,Lu=setTimeout(gn,Hu))},an=function(){Bu=Mu=null,ln()},ln=function(){wu&&(wu=!1,Vu&&(Vu.style.display="none")),Lu&&(clearTimeout(Lu),Lu=0)},cn=function(){ln(),Ru=!0},un=function(){Ru=!1},hn=function(){Vu&&Mu&&("function"==typeof Au?Au(Vu,Mu):dn())},dn=function(){var e=Zs(Mu);e=(e=Dr.wrap$$module$build$src$core$utils$string(e,Nu)).split("\n");for(let t=0;t<e.length;t++){const i=document.createElement("div");i.appendChild(document.createTextNode(e[t])),Vu.appendChild(i)}},pn=function(e){const t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;let s=$u;s=e?s-(Pu+Vu.offsetWidth):s+Pu;let n=Du+Fu;return n+Vu.offsetHeight>i+window.scrollY&&(n-=Vu.offsetHeight+2*Fu),e?s=Math.max(Gu-window.scrollX,s):s+Vu.offsetWidth>t+window.scrollX-2*Gu&&(s=t-Vu.offsetWidth-2*Gu),{x:s,y:n}},gn=function(){if(!Ru&&(Bu=Mu,Vu)){Vu.textContent="",hn();var e=Mu.RTL;Vu.style.direction=e?"rtl":"ltr",Vu.style.display="block",wu=!0;var{x:t,y:i}=pn(e);Vu.style.left=t+"px",Vu.style.top=i+"px"}},mn=function(e,t){for(const i in t)e[i]=null!==t[i]&&"object"==typeof t[i]?mn(e[i]||Object.create(null),t[i]):t[i];return e},fn=function(e){return void 0!==e.bubbleIsVisible&&void 0!==e.setBubbleVisible},_n=function(){return eh},bn=function(e){eh=e},Tn=function(){return th},En=function(e){th=e},yn=function(e){e=`${e}`.toLowerCase().trim();var t=ih[e];if(t)return t;if(t="#"===(t="0x"===e.substring(0,2)?"#"+e.substring(2):e)[0]?t:"#"+t,/^#[0-9a-f]{6}$/.test(t))return t;if(/^#[0-9a-f]{3}$/.test(t))return["#",t[1],t[1],t[2],t[2],t[3],t[3]].join("");var i=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return i&&(e=Number(i[1]),t=Number(i[2]),i=Number(i[3]),0<=e&&256>e&&0<=t&&256>t&&0<=i&&256>i)?In(e,t,i):null},In=function(e,t,i){return t=e<<16|t<<8|i,16>e?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},kn=function(e){return(e=yn(e))?[(e=parseInt(e.substr(1),16))>>16,e>>8&255,255&e]:[0,0,0]},vn=function(e,t,i){let s=0,n=0,o=0;if(0===t)o=n=s=i;else{const r=Math.floor(e/60),a=e/60-r;e=i*(1-t);const l=i*(1-t*a);switch(t=i*(1-t*(1-a)),r){case 1:s=l,n=i,o=e;break;case 2:s=e,n=i,o=t;break;case 3:s=e,n=l,o=i;break;case 4:s=t,n=e,o=i;break;case 5:s=i,n=e,o=l;break;case 6:case 0:s=i,n=t,o=e}}return In(Math.floor(s),Math.floor(n),Math.floor(o))},Cn=function(e,t,i){return(e=yn(e))&&(t=yn(t))?(e=kn(e),t=kn(t),In(Math.round(t[0]+i*(e[0]-t[0])),Math.round(t[1]+i*(e[1]-t[1])),Math.round(t[2]+i*(e[2]-t[2])))):null},Sn=function(e){return vn(e,eh,255*th)},On=function(e,t,i){const s=[];var n=e.split("");n.push("");var o=0;e=[];let r=null;for(let c=0;c<n.length;c++){var a=n[c];if(0===o)if("%"===a)(o=e.join(""))&&s.push(o),e.length=0,o=1;else if(i&&"\n"===a){const t=e.join("");t&&s.push(t),e.length=0,s.push(a)}else e.push(a);else if(1===o)"%"===a?(e.push(a),o=0):t&&"0"<=a&&"9">=a?(o=2,r=a,(a=e.join(""))&&s.push(a),e.length=0):"{"===a?o=3:(e.push("%",a),o=0);else if(2===o)if("0"<=a&&"9">=a)r+=a;else{var l=void 0;s.push(parseInt(null!=(l=r)?l:"",10)),c--,o=0}else 3===o&&(""===a?(e.splice(0,0,"%{"),c--,o=0):"}"!==a?e.push(a):(o=e.join(""),/[A-Z]\w*/i.test(o)&&(a=(a=o.toUpperCase()).startsWith("BKY_")?a.substring(4):null)&&a in Dr.Msg$$module$build$src$core$msg?"string"==typeof(o=Dr.Msg$$module$build$src$core$msg[a])?Array.prototype.push.apply(s,On(o,t,i)):t?s.push(`${o}`):s.push(o):s.push("%{"+o+"}"),o=e.length=0))}for((t=e.join(""))&&s.push(t),l=[],e.length=0,n=0;n<s.length;n++)"string"!=typeof s[n]||i&&"\n"===s[n]?((t=e.join(""))&&l.push(t),e.length=0,l.push(s[n])):e.push(s[n]);return(t=e.join(""))&&l.push(t),e.length=0,l},An=function(e){return On(e,!0,!0)},wn=function(e){return"string"!=typeof e?e:(e=On(e,!1,!1)).length?String(e[0]):""},Rn=function(e){let t=!0;const i=Dr.Msg$$module$build$src$core$msg,s=e.match(/%{BKY_[A-Z]\w*}/gi);if(s)for(let n=0;n<s.length;n++)void 0===i[s[n].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+s[n]+" in "+e),t=!1);return t},Nn=function(e){const t="string"==typeof e?wn(e):e;var i=Number(t);if(!isNaN(i)&&0<=i&&360>=i)return{hue:i,hex:vn(i,_n(),255*Tn())};if(i=yn(t))return{hue:null,hex:i};throw i='Invalid colour: "'+t+'"',e!==t&&(i+=' (from "'+e+'")'),Error(i)},xn=function(e){return void 0!==e.getProcedureModel&&void 0!==e.doProcedureUpdate&&void 0!==e.isProcedureDef},Ln=function(e){return void 0!==e.startPublishing&&void 0!==e.stopPublishing},$n=function(e,i){t(Ur.FIELD,e,i)},Dn=function(e){s(Ur.FIELD,e)},Dr.fromJson$$module$build$src$core$field_registry=function(e){return uh.fromJsonInternal(e)},Mn=function(e){const t=a(Ur.FIELD,e.type);if(t){if("function"!=typeof t.fromJson)throw new TypeError("returned Field was not a IRegistrableField");return t.fromJson(e)}return console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null},Bn=function(e){let t=!1;const i=e.map((([e,i])=>"string"==typeof e?[wn(e),i]:(t=!0,[null!==e.alt?Object.assign({},e,{alt:wn(e.alt)}):Object.assign({},e),i])));if(t||2>e.length)return{options:i};var s=i.map((([e])=>e)),n=Hs(s);e=Gs(s,n);const o=Vs(s,n);return!e&&!o||n<=e+o?{options:i}:(n=e?s[0].substring(0,e-1):void 0,s=o?s[0].substr(1-o):void 0,{options:Pn(i,e,o),prefix:n,suffix:s})},Pn=function(e,t,i){return e.map((([e,s])=>[e.substring(t,e.length-i),s]))},Fn=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let i=0;i<e.length;i++){const s=e[i];Array.isArray(s)?"string"!=typeof s[1]?(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option id must be a string. Found "+s[1]+" in: ",s)):s[0]&&"string"!=typeof s[0]&&"string"!=typeof s[0].src&&(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must have a string label or image description. Found"+s[0]+" in: ",s)):(t=!0,console.error("Invalid option["+i+"]: Each FieldDropdown option must be an array. Found: ",s))}if(t)throw TypeError("Found invalid FieldDropdown options.")},Dr.register$$module$build$src$core$extensions=function(e,t){if("string"!=typeof e||""===e.trim())throw Error('Error: Invalid extension name "'+e+'"');if(_h[e])throw Error('Error: Extension "'+e+'" is already registered.');if("function"!=typeof t)throw Error('Error: Extension "'+e+'" must be a function');_h[e]=t},Dr.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||"object"!=typeof t)throw Error('Error: Mixin "'+e+'" must be a object');Dr.register$$module$build$src$core$extensions(e,(function(){this.mixin(t)}))},Dr.registerMutator$$module$build$src$core$extensions=function(e,t,i,s){const n='Error when registering mutator "'+e+'": ';Xn(n,t);const o=Yn(t,n);if(i&&"function"!=typeof i)throw Error(n+'Extension "'+e+'" is not a function');Dr.register$$module$build$src$core$extensions(e,(function(){o&&this.setMutator(new Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon(s||[],this)),this.mixin(t),i&&i.apply(this)}))},Un=function(e){Hn(e)?delete _h[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},Hn=function(e){return!!_h[e]},Gn=function(e,t,i){const s=_h[e];if("function"!=typeof s)throw Error('Error: Extension "'+e+'" not found.');let n;if(i?Vn(e,t):n=Kn(t),s.apply(t),i)Xn('Error after applying mutator "'+e+'": ',t);else if(!qn(n,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},Vn=function(e,t){if(Kn(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},jn=function(e,t){return zn(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},Wn=function(e,t){return zn(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},Yn=function(e,t){return zn(e.compose,e.decompose,t+" compose/decompose")},zn=function(e,t,i){if(e&&t){if("function"!=typeof e||"function"!=typeof t)throw Error(i+" must be a function");return!0}if(!e&&!t)return!1;throw Error(i+"Must have both or neither functions")},Xn=function(e,t){const i=jn(t,e),s=Wn(t,e);if(!i&&!s)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");Yn(t,e)},Kn=function(e){const t=[];return void 0!==e.domToMutation&&t.push(e.domToMutation),void 0!==e.mutationToDom&&t.push(e.mutationToDom),void 0!==e.saveExtraState&&t.push(e.saveExtraState),void 0!==e.loadExtraState&&t.push(e.loadExtraState),void 0!==e.compose&&t.push(e.compose),void 0!==e.decompose&&t.push(e.decompose),t},qn=function(e,t){if((t=Kn(t)).length!==e.length)return!1;for(let i=0;i<t.length;i++)if(e[i]!==t[i])return!1;return!0},Jn=function(e){if("object"!=typeof document)throw Error("runAfterPageLoad() requires browser document.");if("complete"===document.readyState)e();else{const t=setInterval((function(){"complete"===document.readyState&&(clearInterval(t),e())}),10)}},Dr.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,t){const i=[];return function(){-1===i.indexOf(this.type)&&(Zn(this,e,t),i.push(this.type)),this.setTooltip(function(){const i=String(this.getFieldValue(e));return wn(t[i])}.bind(this))}},Zn=function(e,t,i){var s=e.getField(t);if(s instanceof dh&&!s.isOptionListDynamic()){s=s.getOptions();for(const[,n]of s)void 0===i[n]&&console.warn(`No tooltip mapping for value ${n} of field ${t} of block type ${e.type}.`)}},Dr.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,t){return function(){this.setTooltip(function(){const i=this.getField(t);return wn(e).replace("%1",i?i.getText():"")}.bind(this))}},Qn=function(){const e=this.tooltip;this.setTooltip(function(){const t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||e}.bind(this))},eo=function(e,t){return" "+e+","+t+" "},to=function(e,t){return" "+e+t.join("")},io=function(e,t){return" M "+e+","+t+" "},so=function(e,t){return" m "+e+","+t+" "},no=function(e,t){return" l "+e+","+t+" "},oo=function(e){return" l"+e.join("")},ro=function(e,t){return" "+e+" "+t+" "},ao=function(e,t,i,s){return e+" "+i+" "+i+" "+t+s},lo=function(e,i){t(Ur.ICON,e.toString(),i)},co=function(e){s(Ur.ICON,e)},uo=function(e){const t=e.getProcedureMap().getProcedures().filter((e=>!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!1]));e.getBlocksByType("procedures_defnoreturn",!1).forEach((e=>{!xn(e)&&st(e)&&t.push(e.getProcedureDef())}));const i=e.getProcedureMap().getProcedures().filter((e=>!!e.getReturnTypes())).map((e=>[e.getName(),e.getParameters().map((e=>e.getName())),!0]));return e.getBlocksByType("procedures_defreturn",!1).forEach((e=>{!xn(e)&&st(e)&&i.push(e.getProcedureDef())})),t.sort(ho),i.sort(ho),[t,i]},ho=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},Dr.findLegalName$$module$build$src$core$procedures=function(e,t){if(t.isInFlyout)return e;for(e=e||Dr.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!po(e,t.workspace,t);){const t=e.match(/^(.*?)(\d+)$/);e=t?t[1]+(parseInt(t[2])+1):e+"2"}return e},po=function(e,t,i){return!go(e,t,i)},go=function(e,t,i){for(const s of t.getAllBlocks(!1))if(s!==i&&st(s)&&Dr.Names$$module$build$src$core$names.equals(s.getProcedureDef()[0],e))return!0;i=i&&xn(i)?null==i?void 0:i.getProcedureModel():void 0;for(const s of t.getProcedureMap().getProcedures())if(s!==i&&Dr.Names$$module$build$src$core$names.equals(s.getName(),e))return!0;return!1},Dr.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new rh;e=e.trim();const i=Dr.findLegalName$$module$build$src$core$procedures(e,t);xn(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(i);const s=this.getValue();if(s!==e&&s!==i)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){const n=e[t];n.renameProcedure&&n.renameProcedure(s,i)}return i},mo=function(e){function t(e,t){for(let n=0;n<e.length;n++){var s=e[n][0];const o=e[n][1],r=Dr.createElement$$module$build$src$core$utils$xml("block");r.setAttribute("type",t),r.setAttribute("gap","16");const a=Dr.createElement$$module$build$src$core$utils$xml("mutation");for(a.setAttribute("name",s),r.appendChild(a),s=0;s<o.length;s++){const e=Dr.createElement$$module$build$src$core$utils$xml("arg");e.setAttribute("name",o[s]),a.appendChild(e)}i.push(r)}}const i=[];if(jr.procedures_defnoreturn){var s=Dr.createElement$$module$build$src$core$utils$xml("block");s.setAttribute("type","procedures_defnoreturn"),s.setAttribute("gap","16");var n=Dr.createElement$$module$build$src$core$utils$xml("field");n.setAttribute("name","NAME"),n.appendChild(Dr.createTextNode$$module$build$src$core$utils$xml(Dr.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),s.appendChild(n),i.push(s)}return jr.procedures_defreturn&&((s=Dr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defreturn"),s.setAttribute("gap","16"),(n=Dr.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),n.appendChild(Dr.createTextNode$$module$build$src$core$utils$xml(Dr.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),s.appendChild(n),i.push(s)),jr.procedures_ifreturn&&((s=Dr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_ifreturn"),s.setAttribute("gap","16"),i.push(s)),i.length&&i[i.length-1].setAttribute("gap","24"),t((e=uo(e))[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),i},fo=function(e){var t=[],i=e.getBlocksByType("procedures_mutatorarg",!1);for(let e,s=0;e=i[s];s++)t.push(e.getFieldValue("NAME"));i=Dr.createElement$$module$build$src$core$utils$xml("xml");const s=Dr.createElement$$module$build$src$core$utils$xml("block");s.setAttribute("type","procedures_mutatorarg");const n=Dr.createElement$$module$build$src$core$utils$xml("field");n.setAttribute("name","NAME"),t=ct(Dr.DEFAULT_ARG$$module$build$src$core$procedures,t),t=Dr.createTextNode$$module$build$src$core$utils$xml(t),n.appendChild(t),s.appendChild(n),i.appendChild(s),e.updateToolbox(i)},_o=function(e){if(e.type===sa&&"mutator"===e.bubbleType&&e.isOpen&&e.blockId){var t=(e=u(e.workspaceId).getBlockById(e.blockId)).type;"procedures_defnoreturn"!==t&&"procedures_defreturn"!==t||(e=e.getIcon(Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),fo(e),e.addChangeListener(bo))}},bo=function(e){e.type!==Dr.CREATE$$module$build$src$core$events$utils&&e.type!==Dr.DELETE$$module$build$src$core$events$utils&&e.type!==Dr.CHANGE$$module$build$src$core$events$utils&&e.type!==Qr||(e=u(e.workspaceId),fo(e))},To=function(e,t){return t.getAllBlocks(!1).filter((t=>Eo(t,e)||nt(t)&&Dr.Names$$module$build$src$core$names.equals(t.getProcedureCall(),e)))},Eo=function(e,t){return xn(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&Dr.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},Dr.mutateCallers$$module$build$src$core$procedures=function(e){const t=A();var i=e.getProcedureDef()[0];const s=e.mutationToDom(!0);e=To(i,e.workspace);for(let o,r=0;o=e[r];r++){i=(i=o.mutationToDom())&&$e(i),o.domToMutation&&o.domToMutation(s);var n=o.mutationToDom();i!==(n=n&&$e(n))&&(O(!1),w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(o,"mutation",null,i,n)),O(t))}},Dr.getDefinition$$module$build$src$core$procedures=function(e,t){for(const i of t.getAllBlocks(!1))if(xn(i)&&i.isProcedureDef()&&Dr.Names$$module$build$src$core$names.equals(i.getProcedureModel().getName(),e)||st(i)&&Dr.Names$$module$build$src$core$names.equals(i.getProcedureDef()[0],e))return i;return null},yo=function(e){return e.isDynamic},Io=function(e){return void 0!==e.pathDown&&void 0!==e.pathUp},ko=function(e){return void 0!==e.pathLeft&&void 0!==e.pathRight},vo=function(e){let t=e.outputConnection;return(!t||e.previousConnection&&e.previousConnection.isConnected())&&(t=e.previousConnection),t},Co=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");e.targetConnection=t,t.targetConnection=e},So=function(e,t){let i=null;const s=null==(t=t.outputConnection)?void 0:t.getConnectionChecker();for(let n,o=0;n=e.inputList[o];o++){const e=n.connection;let o;if(e&&null!=(o=s)&&o.canConnect(t,e,!1)){if(i)return null;i=e}}return i},Oo=function(e,t){let i;for(;i=So(e,t);)if(!(e=i.targetBlock())||e.isShadow())return i;return null},Ao=function(e,i){t(Ur.RENDERER,e,i)},wo=function(e){s(Ur.RENDERER,e)},Ro=function(e,t,i){return(e=new(r(Ur.RENDERER,e))(e)).init(t,i),e},No=function(e){ut(e.getTargetWorkspace(),void 0,"String")},xo=function(e){ut(e.getTargetWorkspace(),void 0,"Number")},Lo=function(e){ut(e.getTargetWorkspace(),void 0,"Colour")},$o=function(e){let t=[],i=document.createElement("button");return i.setAttribute("text",Dr.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(i),(i=document.createElement("button")).setAttribute("text",Dr.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(i),(i=document.createElement("button")).setAttribute("text",Dr.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(i),e.registerButtonCallback("CREATE_VARIABLE_STRING",No),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",xo),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Lo),e=Do(e),t.concat(e)},Do=function(e){const t=[];if(0<(e=e.getAllVariables()).length){if(jr.variables_set_dynamic){var i=e[e.length-1];const s=Dr.createElement$$module$build$src$core$utils$xml("block");s.setAttribute("type","variables_set_dynamic"),s.setAttribute("gap","24"),s.appendChild(_t(i)),t.push(s)}if(jr.variables_get_dynamic){e.sort(Zl.compareByName);for(let s,n=0;s=e[n];n++)(i=Dr.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get_dynamic"),i.setAttribute("gap","8"),i.appendChild(_t(s)),t.push(i)}}return t},Mo=function(e){e.resizeContents()},Bo=function(e){return void 0!==e.toCopyData},Po=function(){np.registry.register({name:Ud.ESCAPE,preconditionFn:e=>!e.options.readOnly,callback:e=>(e.hideChaff(),!0),keyCodes:[Th.ESC]})},Fo=function(){np.registry.register({name:Ud.DELETE,preconditionFn(e){const t=f();return!e.options.readOnly&&null!=t&&t.isDeletable()},callback:(e,t)=>(t.preventDefault(),!Yu.inProgress()&&(f().checkAndDelete(),!0)),keyCodes:[Th.DELETE,Th.BACKSPACE]})},Uo=function(){const e=np.registry.createSerializedKey(Th.C,[Th.CTRL]),t=np.registry.createSerializedKey(Th.C,[Th.ALT]),i=np.registry.createSerializedKey(Th.C,[Th.META]);np.registry.register({name:Ud.COPY,preconditionFn(e){const t=f();return!e.options.readOnly&&!Yu.inProgress()&&null!=t&&t.isDeletable()&&t.isMovable()&&Bo(t)},callback:(e,t)=>(t.preventDefault(),e.hideChaff(),!(!(t=f())||!Bo(t)||(op=t.toCopyData(),rp=e,!op))),keyCodes:[e,t,i]})},Ho=function(){const e=np.registry.createSerializedKey(Th.X,[Th.CTRL]),t=np.registry.createSerializedKey(Th.X,[Th.ALT]),i=np.registry.createSerializedKey(Th.X,[Th.META]);np.registry.register({name:Ud.CUT,preconditionFn(e){const t=f();return!e.options.readOnly&&!Yu.inProgress()&&null!=t&&t instanceof Fd&&t.isDeletable()&&t.isMovable()&&!t.workspace.isFlyout},callback(e){const t=f();return!(!t||!Bo(t)||(op=t.toCopyData(),rp=e,t.checkAndDelete(),0))},keyCodes:[e,t,i]})},Go=function(){const e=np.registry.createSerializedKey(Th.V,[Th.CTRL]),t=np.registry.createSerializedKey(Th.V,[Th.ALT]),i=np.registry.createSerializedKey(Th.V,[Th.META]);np.registry.register({name:Ud.PASTE,preconditionFn:e=>!e.options.readOnly&&!Yu.inProgress(),callback:()=>!(!op||!rp||!xi(op,rp)),keyCodes:[e,t,i]})},Vo=function(){const e=np.registry.createSerializedKey(Th.Z,[Th.CTRL]),t=np.registry.createSerializedKey(Th.Z,[Th.ALT]),i=np.registry.createSerializedKey(Th.Z,[Th.META]);np.registry.register({name:Ud.UNDO,preconditionFn:e=>!e.options.readOnly&&!Yu.inProgress(),callback:e=>(e.hideChaff(),e.undo(!1),!0),keyCodes:[e,t,i]})},jo=function(){const e=np.registry.createSerializedKey(Th.Z,[Th.SHIFT,Th.CTRL]),t=np.registry.createSerializedKey(Th.Z,[Th.SHIFT,Th.ALT]),i=np.registry.createSerializedKey(Th.Z,[Th.SHIFT,Th.META]),s=np.registry.createSerializedKey(Th.Y,[Th.CTRL]);np.registry.register({name:Ud.REDO,preconditionFn:e=>!Yu.inProgress()&&!e.options.readOnly,callback:e=>(e.hideChaff(),e.undo(!0),!0),keyCodes:[e,t,i,s]})},Wo=function(){Po(),Fo(),Uo(),Ho(),Go(),Vo(),jo()},Yo=function(e){const t={id:e.getId(),name:e.getName(),returnTypes:e.getReturnTypes()};return e.getParameters().length?(t.parameters=e.getParameters().map((e=>zo(e))),t):t},zo=function(e){const t={id:e.getId(),name:e.getName()};return e.getTypes().length?(t.types=e.getTypes(),t):t},Xo=function(e,t,i,s){if(e=new e(s,i.name,i.id).setReturnTypes(i.returnTypes),!i.parameters)return e;for(const[n,o]of i.parameters.entries())e.insertParameter(Ko(t,o,s),n);return e},Ko=function(e,t,i){return e=new e(i,t.name,t.id),t.types&&e.setTypes(t.types),e},qo=function(e){const t=Object.create(null),i=l(Ur.SERIALIZER,!0);for(const s in i){let n;const o=null==(n=i[s])?void 0:n.save(e);o&&(t[s]=o)}return t},Jo=function(e,t,{recordUndo:i=!1}={}){var s=l(Ur.SERIALIZER,!0);if(s){s=Object.entries(s).sort(((e,t)=>t[1].priority-e[1].priority));var n=A();O(i),(i=Dr.getGroup$$module$build$src$core$events$utils())||Dr.setGroup$$module$build$src$core$events$utils(!0),de(),t instanceof Od&&t.setResizesEnabled(!1);for(const[,e]of s.reverse()){let i;null==(i=e)||i.clear(t)}for(let[i,n]of s.reverse())if(e[i]){let s;null==(s=n)||s.load(e[i],t)}t instanceof Od&&t.setResizesEnabled(!0),pe(),w(new(P(aa))(t)),Dr.setGroup$$module$build$src$core$events$utils(i),O(n)}},Zo=function(e,t,i){const s=i.getBoundingRectangle(),n=s.right-s.left,o=hs(t.top,s.top,t.top+t.height-(s.bottom-s.top))-s.top;let r=t.left;return t=t.left+t.width-n,e.RTL?r=Math.min(t,r):t=Math.max(r,t),!(!(e=hs(r,s.left,t)-s.left)&&!o||(i.moveBy(e,o,["inbounds"]),0))},Qo=function(e){return t=>{var i,s=e.getMetricsManager();if(s.hasFixedEdges()&&!e.isDragging())if(-1!==la.indexOf(null!=(i=t.type)?i:"")){i=s.getScrollMetrics(!0);const n=er(e,t);n&&(s=Dr.getGroup$$module$build$src$core$events$utils()||!1,Dr.setGroup$$module$build$src$core$events$utils(t.group),Zo(e,i,n)&&!t.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),Dr.setGroup$$module$build$src$core$events$utils(s))}else t.type===na&&t.scale&&t.oldScale&&t.scale>t.oldScale&&tr(e)}},er=function(e,t){let i=null;switch(t.type){case Dr.CREATE$$module$build$src$core$events$utils:case Dr.MOVE$$module$build$src$core$events$utils:(i=e.getBlockById(t.blockId))&&(i=i.getRootBlock());break;case oa:case ra:i=e.getCommentById(t.commentId)}return i},tr=function(e){var t=e.getMetricsManager();if(t.hasFixedEdges()&&!e.isDragging()){t=t.getScrollMetrics(!0);var i=e.getTopBoundedElements();for(let s,n=0;s=i[n];n++)Zo(e,t,s)}},ir=function(e,t){const i=[];for(const s of e.getIcons())fn(s)&&!s.bubbleIsVisible()||(i.push({location:t,icon:s}),s.onLocationChange(t));for(const s of e.getChildren(!1))i.push(...ir(s,el.sum(t,s.relativeCoords)));return i},sr=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.UNDO,preconditionFn:e=>0<e.workspace.getUndoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!1)},scopeType:tu.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},nr=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.REDO,preconditionFn:e=>0<e.workspace.getRedoStack().length?"enabled":"disabled",callback(e){e.workspace.undo(!0)},scopeType:tu.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},or=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.CLEAN_UP,preconditionFn:e=>e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden",callback(e){e.workspace.cleanUp()},scopeType:tu.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},rr=function(e,t){function i(t){n--,t.setCollapsed(e),0===n&&Dr.setGroup$$module$build$src$core$events$utils(!1)}let s=0,n=0;Dr.setGroup$$module$build$src$core$events$utils(!0);for(let e=0;e<t.length;e++){let o=t[e];for(;o;)n++,setTimeout(i.bind(null,o),s),o=o.getNextBlock(),s+=10}},ar=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.COLLAPSE_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(!i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){rr(!0,e.workspace.getTopBlocks(!0))},scopeType:tu.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},lr=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.EXPAND_ALL,preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let t=0;t<e.length;t++){let i=e[t];for(;i;){if(i.isCollapsed())return"enabled";i=i.getNextBlock()}}return"disabled"}return"hidden"},callback(e){rr(!1,e.workspace.getTopBlocks(!0))},scopeType:tu.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},cr=function(e,t){if(e.isDeletable())Array.prototype.push.apply(t,e.getDescendants(!1));else{e=e.getChildren(!1);for(let i=0;i<e.length;i++)cr(e[i],t)}},ur=function(e){const t=[];e=e.getTopBlocks(!0);for(let i=0;i<e.length;i++)cr(e[i],t);return t},hr=function(e,t){t?Dr.setGroup$$module$build$src$core$events$utils(t):(Dr.setGroup$$module$build$src$core$events$utils(!0),t=Dr.getGroup$$module$build$src$core$events$utils());const i=e.shift();i&&(i.isDeadOrDying()?hr(e,t):(i.dispose(!1,!0),setTimeout(hr,10,e,t))),Dr.setGroup$$module$build$src$core$events$utils(!1)},dr=function(){tu.registry.register({displayText:e=>e.workspace?1===(e=ur(e.workspace).length)?Dr.Msg$$module$build$src$core$msg.DELETE_BLOCK:Dr.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`):"",preconditionFn:e=>e.workspace&&0<ur(e.workspace).length?"enabled":"disabled",callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var t=ur(e.workspace);2>t.length?hr(t):Je(Dr.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),(function(e){e&&hr(t)}))}},scopeType:tu.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},pr=function(){sr(),nr(),or(),ar(),lr(),dr()},gr=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden",callback(e){if(e.block){var t=e.block.toCopyData();t&&xi(t,e.block.workspace)}},scopeType:tu.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},mr=function(){tu.registry.register({displayText:e=>e.block.hasIcon(Sh.TYPE)?Dr.Msg$$module$build$src$core$msg.REMOVE_COMMENT:Dr.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden",callback(e){(e=e.block).hasIcon(Sh.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:tu.ScopeType.BLOCK,id:"blockComment",weight:2})},fr=function(){tu.registry.register({displayText:e=>e.block.getInputsInline()?Dr.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:Dr.Msg$$module$build$src$core$msg.INLINE_INPUTS,preconditionFn(e){if(!(e=e.block).isInFlyout&&e.isMovable()&&!e.isCollapsed())for(let t=1;t<e.inputList.length;t++)if(!(e.inputList[t-1]instanceof Pp||e.inputList[t]instanceof Pp))return"enabled";return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:tu.ScopeType.BLOCK,id:"blockInline",weight:3})},_r=function(){tu.registry.register({displayText:e=>e.block.isCollapsed()?Dr.Msg$$module$build$src$core$msg.EXPAND_BLOCK:Dr.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden",callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:tu.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},br=function(){tu.registry.register({displayText:e=>e.block.isEnabled()?Dr.Msg$$module$build$src$core$msg.DISABLE_BLOCK:Dr.Msg$$module$build$src$core$msg.ENABLE_BLOCK,preconditionFn:e=>!(e=e.block).isInFlyout&&e.workspace.options.disable&&e.isEditable()?e.getInheritedDisabled()?"disabled":"enabled":"hidden",callback(e){e=e.block;const t=Dr.getGroup$$module$build$src$core$events$utils();t||Dr.setGroup$$module$build$src$core$events$utils(!0),e.setEnabled(!e.isEnabled()),Dr.setGroup$$module$build$src$core$events$utils(t)},scopeType:tu.ScopeType.BLOCK,id:"blockDisable",weight:5})},Tr=function(){tu.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),1===e?Dr.Msg$$module$build$src$core$msg.DELETE_BLOCK:Dr.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn:e=>!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden",callback(e){e.block&&e.block.checkAndDelete()},scopeType:tu.ScopeType.BLOCK,id:"blockDelete",weight:6})},Er=function(){tu.registry.register({displayText:()=>Dr.Msg$$module$build$src$core$msg.HELP,preconditionFn:e=>("function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden",callback(e){e.block.showHelp()},scopeType:tu.ScopeType.BLOCK,id:"blockHelp",weight:7})},yr=function(){gr(),mr(),fr(),_r(),br(),Tr(),Er()},Ir=function(){pr(),yr()},kr=function(e,t){var i=null;let s;if(i="string"==typeof e?document.getElementById(e)||document.querySelector(e):e,!document.contains(i)&&document!==(null==(s=i)?void 0:s.ownerDocument))throw Error("Error: container is not in current document");e=new Zu(t||{}),(t=document.createElement("div")).className="injectionDiv",t.tabIndex=0,Bi(t,Pc.LABEL,Dr.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),i.appendChild(t),i=vr(t,e);const n=Cr(t,i,e);return Sr(n),m(n),E(n),t.addEventListener("focusin",(function(){m(n)})),n},vr=function(e,t){e.setAttribute("dir","LTR"),te(t.hasCss,t.pathToMedia),e=se(hl.SVG,{xmlns:nl,"xmlns:html":ol,"xmlns:xlink":rl,version:"1.1",class:"blocklySvg",tabindex:"0"},e);const i=se(hl.DEFS,{},e),s=String(Math.random()).substring(2);return t.gridPattern=zu.createDom(s,t.gridOptions,i),e},Cr=function(e,t,i){i.parentWorkspace=null;const s=(i=new Od(i)).options;i.scale=s.zoomOptions.startScale,t.appendChild(i.createDom("blocklyMainBackground",e));var n=i.getRenderer().getClassName();return n&&ne(e,n),(n=i.getTheme().getClassName())&&ne(e,n),!s.hasCategories&&s.languageTree&&(e=i.addFlyout(hl.SVG),ce(e,t)),s.hasTrashcan&&i.addTrashcan(),s.zoomOptions&&s.zoomOptions.controls&&i.addZoomControls(),i.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),i.translate(0,0),i.addChangeListener(Qo(i)),E(i),Ui(),ds(),en(),i},Sr=function(e){const t=e.options;var i=e.getParentSvg();if(Y(i.parentNode,"contextmenu",null,(function(e){K(e)||e.preventDefault()})),i=Y(window,"resize",null,(function(){ln(),e.hideComponents(!0),Ls(),qi(),E(e),tr(e)})),e.setResizeHandlerWrapper(i),Ar(),t.languageTree){i=e.getToolbox();const s=e.getFlyout(!0);i?i.init():s&&(s.init(e),s.show(t.languageTree),"function"==typeof s.scrollToStart&&s.scrollToStart())}t.hasTrashcan&&e.trashcan.init(),t.zoomOptions&&t.zoomOptions.controls&&e.zoomControls_.init(),t.moveOptions&&t.moveOptions.scrollbars?(e.scrollbar=new pp(e,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.horizontal,!0===t.moveOptions.scrollbars||!!t.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),t.hasSounds&&wr(t.pathToMedia,e)},Or=function(e){const t=g();t&&!(K(e)||t.rendered&&!t.isVisible())&&np.registry.onKeyDown(t,e)},Ar=function(){lg||(Y(document,"scroll",null,(function(){const e=h();for(let t,i=0;t=e[i];i++)t instanceof Od&&t.updateInverseScreenCTM()})),Y(document,"keydown",null,Or),z(document,"touchend",null,H),z(document,"touchcancel",null,H),Ua&&Y(window,"orientationchange",document,(function(){E(g())}))),lg=!0},wr=function(e,t){function i(){for(;n.length;){const e=n.pop();e&&X(e)}s.preload()}const s=t.getAudioManager();s.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),s.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),s.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const n=[];n.push(Y(document,"pointermove",null,i,!0)),n.push(Y(document,"touchstart",null,i,!0))},Rr=function(e){return void 0!==e.getType&&void 0!==e.initView&&void 0!==e.dispose&&void 0!==e.getWeight&&void 0!==e.getSize&&void 0!==e.applyColour&&void 0!==e.hideForInsertionMarker&&void 0!==e.updateEditable&&void 0!==e.updateCollapsed&&void 0!==e.isShownWhenCollapsed&&void 0!==e.setOffsetInBlock&&void 0!==e.onLocationChange&&void 0!==e.onClick},Nr=function(e){return void 0!==e.paste},xr=function(e){return e.isSelectable()},Lr=function(e){g().hideChaff(e)},($r=$r||{}).scope={},$r.ASSUME_ES5=!1,$r.ASSUME_NO_NATIVE_MAP=!1,$r.ASSUME_NO_NATIVE_SET=!1,$r.SIMPLE_FROUND_POLYFILL=!1,$r.ISOLATE_POLYFILLS=!1,$r.FORCE_POLYFILL_PROMISE=!1,$r.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,$r.defineProperty=$r.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype||(e[t]=i.value),e},$r.getGlobal=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e];for(var i=0;i<t.length;++i){var s=t[i];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")},$r.global=$r.getGlobal(this),$r.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),$r.TRUST_ES6_POLYFILLS=!$r.ISOLATE_POLYFILLS||$r.IS_SYMBOL_NATIVE,$r.polyfills={},$r.propertyToPolyfillSymbol={},$r.POLYFILL_PREFIX="$jscp$",$r.polyfill=function(e,t,i,s){t&&($r.ISOLATE_POLYFILLS?$r.polyfillIsolated(e,t,i,s):$r.polyfillUnisolated(e,t,i,s))},$r.polyfillUnisolated=function(e,t,i,s){for(i=$r.global,e=e.split("."),s=0;s<e.length-1;s++){var n=e[s];if(!(n in i))return;i=i[n]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&$r.defineProperty(i,e,{configurable:!0,writable:!0,value:t})},$r.polyfillIsolated=function(e,t,i,s){var n=e.split(".");e=1===n.length,s=n[0],s=!e&&s in $r.polyfills?$r.polyfills:$r.global;for(var o=0;o<n.length-1;o++){var r=n[o];if(!(r in s))return;s=s[r]}n=n[n.length-1],null!=(t=t(i=$r.IS_SYMBOL_NATIVE&&"es6"===i?s[n]:null))&&(e?$r.defineProperty($r.polyfills,n,{configurable:!0,writable:!0,value:t}):t!==i&&(void 0===$r.propertyToPolyfillSymbol[n]&&(i=1e9*Math.random()>>>0,$r.propertyToPolyfillSymbol[n]=$r.IS_SYMBOL_NATIVE?$r.global.Symbol(n):$r.POLYFILL_PREFIX+i+"$"+n),$r.defineProperty(s,$r.propertyToPolyfillSymbol[n],{configurable:!0,writable:!0,value:t})))},$r.polyfill("globalThis",(function(e){return e||$r.global}),"es_2020","es3"),$r.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$r.arrayIterator=function(e){return{next:$r.arrayIteratorImpl(e)}},$r.initSymbol=function(){},$r.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},$r.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var i=0,s=!1,n={next:function(){if(!s&&i<e.length){var n=i++;return{value:t(n,e[n]),done:!1}}return s=!0,{done:!0,value:void 0}}};return n[Symbol.iterator]=function(){return n},n},$r.polyfill("Array.prototype.values",(function(e){return e||function(){return $r.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),$r.polyfill("Array.prototype.flat",(function(e){return e||function(e){e=void 0===e?1:e;var t=[];return Array.prototype.forEach.call(this,(function(i){Array.isArray(i)&&0<e?(i=Array.prototype.flat.call(i,e-1),t.push.apply(t,i)):t.push(i)})),t}}),"es9","es5"),$r.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},$r.polyfill("Object.entries",(function(e){return e||function(e){var t,i=[];for(t in e)$r.owns(e,t)&&i.push([t,e[t]]);return i}}),"es8","es3"),$r.polyfill("Object.values",(function(e){return e||function(e){var t,i=[];for(t in e)$r.owns(e,t)&&i.push(e[t]);return i}}),"es8","es3");var Mr=Object.create(null),Br={typeMap:Mr},Pr=Object.create(null),Fr="default",Ur=class{constructor(e){this.name=e}toString(){return this.name}};Ur.CONNECTION_CHECKER=new Ur("connectionChecker"),Ur.CONNECTION_PREVIEWER=new Ur("connectionPreviewer"),Ur.CURSOR=new Ur("cursor"),Ur.EVENT=new Ur("event"),Ur.FIELD=new Ur("field"),Ur.INPUT=new Ur("input"),Ur.RENDERER=new Ur("renderer"),Ur.TOOLBOX=new Ur("toolbox"),Ur.THEME=new Ur("theme"),Ur.TOOLBOX_ITEM=new Ur("toolboxItem"),Ur.FLYOUTS_VERTICAL_TOOLBOX=new Ur("flyoutsVerticalToolbox"),Ur.FLYOUTS_HORIZONTAL_TOOLBOX=new Ur("flyoutsHorizontalToolbox"),Ur.METRICS_MANAGER=new Ur("metricsManager"),Ur.BLOCK_DRAGGER=new Ur("blockDragger"),Ur.SERIALIZER=new Ur("serializer"),Ur.ICON=new Ur("icon"),Ur.PASTER=new Ur("paster");var Hr={DEFAULT:Fr,TEST_ONLY:Br};Hr.Type=Ur,Hr.getAllItems=l,Hr.getClass=r,Hr.getClassFromOptions=c,Hr.getObject=a,Hr.hasItem=o,Hr.register=t,Hr.unregister=s;var Gr,Vr,jr=Object.create(null),Wr=Object.create(null),Yr=null,zr=[],Xr={defineBlocksWithJsonArrayInternal:v},Kr={TEST_ONLY:Xr};Kr.createBlockDefinitionsFromJsonArray=Dr.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Kr.defineBlocks=Dr.defineBlocks$$module$build$src$core$common,Kr.defineBlocksWithJsonArray=k,Kr.draggingConnections=zr,Kr.getAllWorkspaces=h,Kr.getBlockTypeCounts=y,Kr.getMainWorkspace=g,Kr.getParentContainer=b,Kr.getSelected=f,Kr.getWorkspaceById=u,Kr.registerWorkspace=d,Kr.setMainWorkspace=m,Kr.setParentContainer=T,Kr.setSelected=_,Kr.svgResize=E,Kr.unregisterWorkpace=p;var qr,Jr,Zr,Qr,ea,ta,ia,sa,na,oa,ra,aa,la,ca,ua,ha,da={genUid:()=>{const e="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length,t=[];for(let i=0;20>i;i++)t[i]="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.random()*e);return t.join("")}},pa=0,ga={TEST_ONLY:da};ga.genUid=S,ga.getNextUniqueId=C,qr="",Jr=!0,Zr=0,Dr.CREATE$$module$build$src$core$events$utils="create",Dr.CREATE$$module$build$src$core$events$utils,Dr.DELETE$$module$build$src$core$events$utils="delete",Dr.DELETE$$module$build$src$core$events$utils,Dr.CHANGE$$module$build$src$core$events$utils="change",Dr.CHANGE$$module$build$src$core$events$utils,Qr="block_field_intermediate_change",Dr.MOVE$$module$build$src$core$events$utils="move",Dr.MOVE$$module$build$src$core$events$utils,ea="var_create",ta="ui",ia="click",sa="bubble_open",na="viewport_change",oa="comment_create",ra="comment_move",aa="finished_loading",la=[Dr.CREATE$$module$build$src$core$events$utils,Dr.MOVE$$module$build$src$core$events$utils,oa,ra],ua={FIRE_QUEUE:ca=[],fireNow:N,fireInternal:R,setGroupInternal:D},(ha={BLOCK_CHANGE:Dr.CHANGE$$module$build$src$core$events$utils,BLOCK_CREATE:Dr.CREATE$$module$build$src$core$events$utils,BLOCK_DELETE:Dr.DELETE$$module$build$src$core$events$utils,BLOCK_DRAG:"drag",BLOCK_FIELD_INTERMEDIATE_CHANGE:Qr,BLOCK_MOVE:Dr.MOVE$$module$build$src$core$events$utils,BUBBLE_OPEN:sa,BUMP_EVENTS:la,CHANGE:Dr.CHANGE$$module$build$src$core$events$utils,CLICK:ia,COMMENT_CHANGE:"comment_change",COMMENT_CREATE:oa,COMMENT_DELETE:"comment_delete",COMMENT_MOVE:ra,CREATE:Dr.CREATE$$module$build$src$core$events$utils,DELETE:Dr.DELETE$$module$build$src$core$events$utils,FINISHED_LOADING:aa,MARKER_MOVE:"marker_move",MOVE:Dr.MOVE$$module$build$src$core$events$utils,SELECTED:"selected",TEST_ONLY:ua,THEME_CHANGE:"theme_change",TOOLBOX_ITEM_SELECT:"toolbox_item_select",TRASHCAN_OPEN:"trashcan_open",UI:ta,VAR_CREATE:ea,VAR_DELETE:"var_delete",VAR_RENAME:"var_rename",VIEWPORT_CHANGE:na}).clearPendingUndo=L,ha.disable=Dr.disable$$module$build$src$core$events$utils,ha.disableOrphans=F,ha.enable=Dr.enable$$module$build$src$core$events$utils,ha.filter=x,ha.fire=w,ha.fromJson=B,ha.get=P,ha.getDescendantIds=M,ha.getGroup=Dr.getGroup$$module$build$src$core$events$utils,ha.getRecordUndo=A,ha.isEnabled=$,ha.setGroup=Dr.setGroup$$module$build$src$core$events$utils,ha.setRecordUndo=O;var ma,fa,_a=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=Dr.getGroup$$module$build$src$core$events$utils(),this.recordUndo=A()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,i){return i.isBlank=!1,i.group=e.group||"",i.workspaceId=t.id,i}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=u(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},ba=class extends _a{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=void 0===e,this.workspaceId=e||""}},Ta=class extends ba{constructor(e,t,i){null===(t=e?e.workspace.id:t)&&(t=void 0),super(t),this.type=ia,this.blockId=e?e.id:void 0,this.targetType=i}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ta)).targetType=e.targetType,t.blockId=e.blockId,t}};(fa=ma||(ma={})).BLOCK="block",fa.WORKSPACE="workspace",fa.ZOOM_CONTROLS="zoom_controls",t(Ur.EVENT,ia,Ta);var Ea={};Ea.Click=Ta,Ea.ClickTarget=ma;var ya,Ia,ka,va,Ca,Sa,Oa,Aa,wa,Ra,Na=750,xa="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),La=null,$a={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},Da=0,Ma={TOUCH_ENABLED:xa,TOUCH_MAP:$a};Ma.checkTouchIdentifier=W,Ma.clearTouchIdentifier=G,Ma.getTouchIdentifierFromEvent=j,Ma.longStart=U,Ma.longStop=H,Ma.shouldHandleEvent=V,function(e){function t(e){return-1!==i.indexOf(e.toUpperCase())}const i=(ya=e).toUpperCase();Ia=t("JavaFX"),ka=t("WebKit"),va=t("Gecko")&&!ka,Ca=t("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,Sa=t("iPad")||t("Macintosh")&&0<e,Oa=t("iPhone")&&!Sa,Aa=t("Macintosh"),wa=Sa||Ca&&!t("Mobile")||t("Silk"),Ra=!wa&&(Oa||Ca)}(globalThis.navigator&&globalThis.navigator.userAgent||"");var Ba=Ia,Pa=va,Fa=Ca,Ua=Sa,Ha=Oa,Ga=Aa,Va=Ra,ja={ANDROID:Fa,GECKO:Pa,IPAD:Ua,IPHONE:Ha,JavaFx:Ba,MAC:Ga,MOBILE:Va,raw:ya},Wa=40,Ya=125,za={};za.bind=z,za.conditionalBind=Y,za.getScrollDeltaPixels=Z,za.isRightButton=q,za.isTargetInput=K,za.mouseToSvg=J,za.unbind=X;var Xa={};Xa.removeElem=Q;var Ka=class{constructor(e){this.name_=e}toString(){return this.name_}};Ka.POSITIONABLE=new Ka("positionable"),Ka.DRAG_TARGET=new Ka("drag_target"),Ka.DELETE_AREA=new Ka("delete_area"),Ka.AUTOHIDEABLE=new Ka("autohideable");var qa=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){const i=e.component.id;var s;if(!t&&this.componentData.has(i))throw Error('Plugin "'+i+'" with capabilities "'+(null==(s=this.componentData.get(i))?void 0:s.capabilities)+'" already added.');for(this.componentData.set(i,e),t=[],s=0;s<e.capabilities.length;s++){const n=String(e.capabilities[s]).toLowerCase();if(t.push(n),this.capabilityToComponentIds.has(n)){let e;null==(e=this.capabilityToComponentIds.get(n))||e.push(i)}else this.capabilityToComponentIds.set(n,[i])}this.componentData.get(i).capabilities=t}removeComponent(e){const t=this.componentData.get(e);if(t){for(let i=0;i<t.capabilities.length;i++){const s=String(t.capabilities[i]).toLowerCase();Q(this.capabilityToComponentIds.get(s),e)}this.componentData.delete(e)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');var i,s;this.hasCapability(e,t)?console.warn('Plugin "'+e+'already has capability "'+t+'"'):(t=`${t}`.toLowerCase(),null==(i=this.componentData.get(e))||i.capabilities.push(t),null==(s=this.capabilityToComponentIds.get(t))||s.push(e))}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=`${t}`.toLowerCase(),Q(this.componentData.get(e).capabilities,t),Q(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+"doesn't have capability \""+t+'" to remove')}hasCapability(e,t){return t=`${t}`.toLowerCase(),this.componentData.has(e)&&-1!==this.componentData.get(e).capabilities.indexOf(t)}getComponent(e){let t;return null==(t=this.componentData.get(e))?void 0:t.component}getComponents(e,t){if(e=`${e}`.toLowerCase(),!(e=this.capabilityToComponentIds.get(e)))return[];const i=[];if(t){const t=[];e.forEach((e=>{t.push(this.componentData.get(e))})),t.sort((function(e,t){return e.weight-t.weight})),t.forEach((function(e){i.push(e.component)}))}else e.forEach((e=>{i.push(this.componentData.get(e).component)}));return i}};qa.Capability=Ka;var Ja=!1,Za='\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don\'t allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyBlockDragSurface {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n',Qa={};Qa.inject=te,Qa.register=ee;var el=class{constructor(e,t){this.x=e,this.y=t}clone(){return new el(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t||!(!e||!t)&&e.x===t.x&&e.y===t.y}static distance(e,t){const i=e.x-t.x;return e=e.y-t.y,Math.sqrt(i*i+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new el(e.x-t.x,e.y-t.y)}static sum(e,t){return new el(e.x+t.x,e.y+t.y)}},tl=new Set,il={};il.warn=ie;var sl,nl="http://www.w3.org/2000/svg",ol="http://www.w3.org/1999/xhtml",rl="http://www.w3.org/1999/xlink";!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"}(sl||(sl={}));var al=null,ll=0,cl=null,ul={HTML_NS:ol};ul.NodeType=sl,ul.SVG_NS=nl,ul.XLINK_NS=rl,ul.addClass=ne,ul.containsNode=ue,ul.createSvgElement=se,ul.getFastTextWidth=me,ul.getFastTextWidthWithSizeString=fe,ul.getTextWidth=ge,ul.hasClass=ae,ul.insertAfter=ce,ul.measureFontMetrics=_e,ul.removeClass=re,ul.removeClasses=oe,ul.removeNode=le,ul.setCssTransform=he,ul.startTextWidthCache=de,ul.stopTextWidthCache=pe;var hl=class{constructor(e){this.tagName=e}toString(){return this.tagName}};hl.ANIMATE=new hl("animate"),hl.CIRCLE=new hl("circle"),hl.CLIPPATH=new hl("clipPath"),hl.DEFS=new hl("defs"),hl.FECOMPOSITE=new hl("feComposite"),hl.FECOMPONENTTRANSFER=new hl("feComponentTransfer"),hl.FEFLOOD=new hl("feFlood"),hl.FEFUNCA=new hl("feFuncA"),hl.FEGAUSSIANBLUR=new hl("feGaussianBlur"),hl.FEPOINTLIGHT=new hl("fePointLight"),hl.FESPECULARLIGHTING=new hl("feSpecularLighting"),hl.FILTER=new hl("filter"),hl.FOREIGNOBJECT=new hl("foreignObject"),hl.G=new hl("g"),hl.IMAGE=new hl("image"),hl.LINE=new hl("line"),hl.PATH=new hl("path"),hl.PATTERN=new hl("pattern"),hl.POLYGON=new hl("polygon"),hl.RECT=new hl("rect"),hl.SVG=new hl("svg"),hl.TEXT=new hl("text"),hl.TSPAN=new hl("tspan");var dl=class{constructor(e,t,i,s){this.top=e,this.bottom=t,this.left=i,this.right=s}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)}},pl=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t||!(!e||!t)&&e.width===t.width&&e.height===t.height}},gl={getSizeInternal:Te},ml={TEST_ONLY:gl};ml.getBorderBox=ve,ml.getComputedStyle=ye,ml.getContainerOffsetToScrollInto=Se,ml.getPageOffset=Ie,ml.getSize=be,ml.getViewportPageOffset=ke,ml.scrollIntoContainerView=Ce;var fl=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,_l=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,bl={TEST_ONLY:{XY_REGEX:fl,XY_STYLE_REGEX:_l}};bl.getDocumentScroll=Re,bl.getInjectionDivXY=Ae,bl.getRelativeXY=Oe,bl.getViewportBBox=we,bl.screenToWsCoordinates=Ne,bl.wsToScreenCoordinates=xe;var Tl=class{constructor(e,t,i,s,n){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new el(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new el(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=i||!1,this.margin=void 0!==n?n:Tl.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),s&&(e+=" "+s),this.outerSvg=se(hl.SVG,{class:e}),s=se(hl.G,{},this.outerSvg),this.svgBackground=se(hl.RECT,{class:"blocklyScrollbarBackground"},s),e=Math.floor((Tl.scrollbarThickness-5)/2),this.svgHandle=se(hl.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},s),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),ce(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=Y(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=Y(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=Tl.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),X(this.onMouseDownBarWrapper_),X(this.onMouseDownHandleWrapper_),le(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return 0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,he(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){(e||(e=this.workspace.getMetrics()))&&(this.oldHostMetrics&&Tl.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics()))}requiresViewResize(e){return!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=Tl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=Tl.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-Tl.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewWidth/e.scrollWidth;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth;var i=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=Tl.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-Tl.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var t=this.scrollbarLength*e.viewHeight/e.scrollHeight;t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight;var i=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/t*i,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=i/t}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),G(),this.cleanUp(),q(e))e.stopPropagation();else{var t=J(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());t=this.horizontal?t.x:t.y;var i=Ae(this.svgHandle);i=this.horizontal?i.x:i.y;var s=this.handlePosition,n=.95*this.handleLength;t<=i?s-=n:t>=i+this.handleLength&&(s+=n),this.setHandlePosition(this.constrainHandlePosition(s)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),q(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=Y(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=Y(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){G(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(X(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(X(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(t||void 0===t)&&this.updateMetrics()}setOrigin(e,t){this.origin=new el(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}};Tl.scrollbarThickness=xa?25:15,Tl.DEFAULT_SCROLLBAR_MARGIN=.5;var El={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},yl={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:Il,DOMParser:kl,XMLSerializer:vl}=globalThis;kl&&(El=new kl),vl&&(yl=new vl);var Cl="https://developers.google.com/blockly/xml",Sl=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,Ol={NAME_SPACE:Cl};Ol.createElement=Dr.createElement$$module$build$src$core$utils$xml,Ol.createTextNode=Dr.createTextNode$$module$build$src$core$utils$xml,Ol.domToText=$e,Ol.injectDependencies=Le,Ol.textToDom=Dr.textToDom$$module$build$src$core$utils$xml;var Al,wl="categoryToolbox",Rl="flyoutToolbox";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(Al||(Al={}));var Nl,xl,Ll,$l={hasCategoriesInternal:Ue},Dl={};Dl.Position=Al,Dl.TEST_ONLY=$l,Dl.convertFlyoutDefToJsonArray=Pe,Dl.convertToolboxDefToJson=Me,Dl.hasCategories=Fe,Dl.isCategoryCollapsible=He,Dl.parseToolboxTree=We,function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(Nl||(Nl={})),function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(xl||(xl={})),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(Ll||(Ll={}));var Ml={};Ml.bumpDirection=Ll,Ml.bumpPositionRect=Xe,Ml.getCornerOppositeToolbox=ze,Ml.getStartPositionRect=Ye,Ml.horizontalPosition=xl,Ml.verticalPosition=Nl;var Bl=96,Pl=124,Fl="sprites.png",Ul=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=se(hl.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[qa.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&le(this.svgGroup);for(const e of this.boundEvents)X(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new dl(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){if(this.initialized){var i,s=ze(this.workspace,e),n=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(n+=this.LARGE_SPACING+this.HEIGHT),e=Ye(s,new pl(this.WIDTH,n),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),s=s.vertical,t=Xe(e,this.MARGIN_VERTICAL,s===Nl.TOP?Ll.DOWN:Ll.UP,t),s===Nl.TOP){var o,r=this.SMALL_SPACING+this.HEIGHT;null==(o=this.zoomInGroup)||o.setAttribute("transform","translate(0, "+r+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(r+this.LARGE_SPACING+this.HEIGHT)+")")}else{let e;o=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0,null==(e=this.zoomInGroup)||e.setAttribute("transform","translate(0, "+o+")"),o=o+this.SMALL_SPACING+this.HEIGHT,null==(r=this.zoomOutGroup)||r.setAttribute("transform","translate(0, "+o+")")}this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=se(hl.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const t=se(hl.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);se(hl.RECT,{width:32,height:32},t),se(hl.IMAGE,{width:Bl,height:Pl,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(rl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(Y(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=se(hl.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const t=se(hl.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);se(hl.RECT,{width:32,height:32},t),se(hl.IMAGE,{width:Bl,height:Pl,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(rl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(Y(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),G(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=se(hl.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const t=se(hl.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);se(hl.RECT,{width:32,height:32},t),se(hl.IMAGE,{width:Bl,height:Pl,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(rl,"xlink:href",this.workspace.options.pathToMedia+Fl),this.boundEvents.push(Y(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),G(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(P(ia))(null,this.workspace.id,"zoom_controls");w(e)}};ee("\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n");var Hl=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};Hl.MUTATOR=new Hl("mutator"),Hl.WARNING=new Hl("warning"),Hl.COMMENT=new Hl("comment"),function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"}(Dr.inputTypes$$module$build$src$core$inputs$input_types||(Dr.inputTypes$$module$build$src$core$inputs$input_types={})),Dr.inputTypes$$module$build$src$core$inputs$input_types;var Gl,Vl,jl=function(e,t){window.alert(e),t&&t()},Wl=function(e,t){t(window.confirm(e))},Yl=function(e,t,i){i(window.prompt(e,t))},zl={confirmInternal:Ze},Xl={TEST_ONLY:zl};Xl.alert=Ke,Xl.confirm=Je,Xl.prompt=et,Xl.setAlert=qe,Xl.setConfirm=Qe,Xl.setPrompt=tt,Dr.Msg$$module$build$src$core$msg=Object.create(null),Gl=function(e){Object.keys(e).forEach((function(t){Dr.Msg$$module$build$src$core$msg[t]=e[t]}))},Vl={Msg:Dr.Msg$$module$build$src$core$msg,setLocale:Gl};var Kl={};Kl.isLegacyProcedureCallBlock=nt,Kl.isLegacyProcedureDefBlock=st;var ql=class extends _a{constructor(e){super(),this.isBlank=void 0===e,e&&(this.varId=e.getId(),this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new ql)).varId=e.varId,t}},Jl=class extends ql{constructor(e){super(e),this.type=ea,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Jl)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.createVariable(this.varName,this.varType,this.varId):t.deleteVariableById(this.varId)}};t(Ur.EVENT,ea,Jl);var Zl=class{constructor(e,t,i,s){this.workspace=e,this.name=t,this.type=i||"",this.id_=s||S()}getId(){return this.id_}static compareByName(e,t){return e.name.localeCompare(t.name,void 0,{sensitivity:"base"})}},Ql="ijkmnopqrstuvwxyzabcdefgh",ec={generateUniqueNameInternal:lt},tc={CATEGORY_NAME:"VARIABLE",TEST_ONLY:ec,VAR_LETTER_OPTIONS:Ql};tc.allDeveloperVariables=Dr.allDeveloperVariables$$module$build$src$core$variables,tc.allUsedVarModels=Dr.allUsedVarModels$$module$build$src$core$variables,tc.createVariableButtonHandler=ut,tc.flyoutCategory=ot,tc.flyoutCategoryBlocks=rt,tc.generateUniqueName=at,tc.generateUniqueNameFromOptions=ct,tc.generateVariableFieldDom=_t,tc.getAddedVariables=Tt,tc.getOrCreateVariablePackage=Dr.getOrCreateVariablePackage$$module$build$src$core$variables,tc.getVariable=Dr.getVariable$$module$build$src$core$variables,tc.nameUsedWithAnyType=pt,tc.nameUsedWithConflictingParam=gt,tc.promptName=ht,tc.renameVariable=Dr.renameVariable$$module$build$src$core$variables;var ic=class{constructor(e,t,i,s,n){this.workspace=e,this.editable=this.movable=this.deletable=!0,this.disposed_=!1,this.isComment=!0,this.id=n&&!e.getCommentById(n)?n:S(),e.addTopComment(this),this.xy_=new el(0,0),this.height_=i,this.width_=s,this.RTL=e.RTL,this.content_=t,ic.fireCreateEvent(this)}dispose(){this.disposed_||($()&&w(new(P("comment_delete"))(this)),this.workspace.removeTopComment(this),this.disposed_=!0)}getHeight(){return this.height_}setHeight(e){this.height_=e}getWidth(){return this.width_}setWidth(e){this.width_=e}getRelativeToSurfaceXY(){return new el(this.xy_.x,this.xy_.y)}moveBy(e,t){const i=new(P(ra))(this);this.xy_.translate(e,t),i.recordNew(),w(i)}isDeletable(){return this.deletable&&!(this.workspace&&this.workspace.options.readOnly)}setDeletable(e){this.deletable=e}isMovable(){return this.movable&&!(this.workspace&&this.workspace.options.readOnly)}setMovable(e){this.movable=e}isEditable(){return this.editable&&!(this.workspace&&this.workspace.options.readOnly)}setEditable(e){this.editable=e}getContent(){return this.content_}setContent(e){this.content_!==e&&(w(new(P("comment_change"))(this,this.content_,e)),this.content_=e)}toXmlWithXY(e){return(e=this.toXml(e)).setAttribute("x",String(Math.round(this.xy_.x))),e.setAttribute("y",String(Math.round(this.xy_.y))),e.setAttribute("h",String(this.height_)),e.setAttribute("w",String(this.width_)),e}toXml(e){const t=Dr.createElement$$module$build$src$core$utils$xml("comment");return e||(t.id=this.id),t.textContent=this.getContent(),t}static fireCreateEvent(e){if($()){const t=Dr.getGroup$$module$build$src$core$events$utils();t||Dr.setGroup$$module$build$src$core$events$utils(!0);try{w(new(P(oa))(e))}finally{Dr.setGroup$$module$build$src$core$events$utils(t)}}}static fromXml(e,t){var i=ic.parseAttributes(e);return t=new ic(t,i.content,i.h,i.w,i.id),i=e.getAttribute("x"),e=e.getAttribute("y"),i=i?parseInt(i,10):NaN,e=e?parseInt(e,10):NaN,isNaN(i)||isNaN(e)||t.moveBy(i,e),ic.fireCreateEvent(t),t}static parseAttributes(e){const t=e.getAttribute("h"),i=e.getAttribute("w"),s=e.getAttribute("x"),n=e.getAttribute("y"),o=e.getAttribute("id");if(!o)throw Error("No ID present in XML comment definition.");let r;return{id:o,h:t?parseInt(t):100,w:i?parseInt(i):100,x:s?parseInt(s):NaN,y:n?parseInt(n):NaN,content:null!=(r=e.textContent)?r:""}}},sc=class extends ba{constructor(e,t,i){super(i),this.type="selected",this.oldElementId=null!=e?e:void 0,this.newElementId=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new sc)).oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}};t(Ur.EVENT,"selected",sc);var nc={};nc.register=Et,nc.unregister=yt;var oc=class{paste(e,t,i){const s=e.commentState;if(i)s.setAttribute("x",`${i.x}`),s.setAttribute("y",`${i.y}`);else{var n;let e;i=parseInt(null!=(n=s.getAttribute("x"))?n:"0")+50,n=parseInt(null!=(e=s.getAttribute("y"))?e:"0")+50,s.setAttribute("x",`${i}`),s.setAttribute("y",`${n}`)}return rc.fromXmlRendered(e.commentState,t)}};oc.TYPE="workspace-comment",Et(oc.TYPE,new oc);var rc=class extends ic{constructor(e,t,i,s,n){super(e,t,i,s,n),this.onMouseMoveWrapper=this.onMouseUpWrapper=null,this.eventsInit=!1,this.deleteIconBorder=this.deleteGroup=this.resizeGroup=this.foreignObject=this.svgHandleTarget=this.svgRectTarget=this.textarea=null,this.rendered=this.autoLayout=this.focused=!1,this.svgGroup=se(hl.G,{class:"blocklyComment"}),this.workspace=e,this.svgRect_=se(hl.RECT,{class:"blocklyCommentRect",x:0,y:0,rx:3,ry:3}),this.svgGroup.appendChild(this.svgRect_),this.render()}dispose(){this.disposed_||(f()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),$()&&w(new(P("comment_delete"))(this)),le(this.svgGroup),Dr.disable$$module$build$src$core$events$utils(),super.dispose(),Dr.enable$$module$build$src$core$events$utils())}initSvg(e){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");this.workspace.options.readOnly||this.eventsInit||(Y(this.svgRectTarget,"pointerdown",this,this.pathMouseDown),Y(this.svgHandleTarget,"pointerdown",this,this.pathMouseDown)),this.eventsInit=!0,this.updateMovable(),this.getSvgRoot().parentNode||this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot()),!e&&this.textarea&&this.textarea.select()}pathMouseDown(e){const t=this.workspace.getGesture(e);t&&t.handleBubbleStart(e,this)}showContextMenu(e){throw Error("The implementation of showContextMenu should be monkey-patched in by blockly.ts")}select(){if(f()!==this){var e=null;if(f()){e=f().id,Dr.disable$$module$build$src$core$events$utils();try{f().unselect()}finally{Dr.enable$$module$build$src$core$events$utils()}}e=new(P("selected"))(e,this.id,this.workspace.id),w(e),_(this),this.addSelect()}}unselect(){if(f()===this){var e=new(P("selected"))(this.id,null,this.workspace.id);w(e),_(null),this.removeSelect(),this.blurFocus()}}addSelect(){ne(this.svgGroup,"blocklySelected"),this.setFocus()}removeSelect(){ne(this.svgGroup,"blocklySelected"),this.blurFocus()}addFocus(){ne(this.svgGroup,"blocklyFocused")}removeFocus(){re(this.svgGroup,"blocklyFocused")}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,i=0,s=this.getSvgRoot();if(s)do{const e=Oe(s);t+=e.x,i+=e.y,s=s.parentNode}while(s&&!e.hasLayer(s)&&null!==s);return this.xy_=new el(t,i)}moveBy(e,t){const i=new(P(ra))(this),s=this.getRelativeToSurfaceXY();this.translate(s.x+e,s.y+t),this.xy_=new el(s.x+e,s.y+t),i.recordNew(),w(i),this.workspace.resizeContents()}translate(e,t){this.xy_=new el(e,t),this.getSvgRoot().setAttribute("transform","translate("+e+","+t+")")}moveDuringDrag(e){e=`translate(${e.x}, ${e.y})`,this.getSvgRoot().setAttribute("transform",e)}moveTo(e,t){this.translate(e,t)}clearTransformAttributes(){this.getSvgRoot().removeAttribute("transform")}getBoundingRectangle(){var e=this.getRelativeToSurfaceXY();const t=this.getHeightWidth(),i=e.y,s=e.y+t.height;let n;return this.RTL?(n=e.x-t.width,e=e.x):(n=e.x,e=e.x+t.width),new dl(i,s,n,e)}updateMovable(){this.isMovable()?ne(this.svgGroup,"blocklyDraggable"):re(this.svgGroup,"blocklyDraggable")}setMovable(e){super.setMovable(e),this.updateMovable()}setEditable(e){super.setEditable(e),this.textarea&&(this.textarea.readOnly=!e)}setDragging(e){e?ne(this.getSvgRoot(),"blocklyDragging"):re(this.getSvgRoot(),"blocklyDragging")}getSvgRoot(){return this.svgGroup}getContent(){return this.textarea?this.textarea.value:this.content_}setContent(e){super.setContent(e),this.textarea&&(this.textarea.value=e)}setDeleteStyle(e){e?ne(this.svgGroup,"blocklyDraggingDelete"):re(this.svgGroup,"blocklyDraggingDelete")}setAutoLayout(e){}toXmlWithXY(e){let t=0;this.workspace.RTL&&(t=this.workspace.getWidth()),e=this.toXml(e);const i=this.getRelativeToSurfaceXY();return e.setAttribute("x",String(Math.round(this.workspace.RTL?t-i.x:i.x))),e.setAttribute("y",String(Math.round(i.y))),e.setAttribute("h",String(this.getHeight())),e.setAttribute("w",String(this.getWidth())),e}toCopyData(){return{paster:oc.TYPE,commentState:this.toXmlWithXY()}}getHeightWidth(){return{width:this.getWidth(),height:this.getHeight()}}render(){if(!this.rendered){var e=this.getHeightWidth(),t=this.createEditor();this.svgGroup.appendChild(t),this.svgHandleTarget=se(hl.RECT,{class:"blocklyCommentHandleTarget",x:0,y:0}),this.svgGroup.appendChild(this.svgHandleTarget),this.svgRectTarget=se(hl.RECT,{class:"blocklyCommentTarget",x:0,y:0,rx:3,ry:3}),this.svgGroup.appendChild(this.svgRectTarget),this.addResizeDom(),this.isDeletable()&&this.addDeleteDom(),this.setSize(e.width,e.height),this.textarea.value=this.content_,this.rendered=!0,this.resizeGroup&&Y(this.resizeGroup,"pointerdown",this,this.resizeMouseDown),this.isDeletable()&&(Y(this.deleteGroup,"pointerdown",this,this.deleteMouseDown),Y(this.deleteGroup,"pointerout",this,this.deleteMouseOut),Y(this.deleteGroup,"pointerup",this,this.deleteMouseUp))}}createEditor(){this.foreignObject=se(hl.FOREIGNOBJECT,{x:0,y:rc.TOP_OFFSET,class:"blocklyCommentForeignObject"});const e=document.createElementNS(ol,"body");e.setAttribute("xmlns",ol),e.className="blocklyMinimalBody";const t=document.createElementNS(ol,"textarea");return t.className="blocklyCommentTextarea",t.setAttribute("dir",this.RTL?"RTL":"LTR"),t.readOnly=!this.isEditable(),e.appendChild(t),this.textarea=t,this.foreignObject.appendChild(e),Y(t,"wheel",this,(function(e){e.stopPropagation()})),Y(t,"change",this,(function(e){this.setContent(t.value)})),this.foreignObject}addResizeDom(){this.resizeGroup=se(hl.G,{class:this.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.svgGroup),se(hl.POLYGON,{points:"0,8 8,8 8,0"},this.resizeGroup),se(hl.LINE,{class:"blocklyResizeLine",x1:8/3,y1:7,x2:7,y2:8/3},this.resizeGroup),se(hl.LINE,{class:"blocklyResizeLine",x1:16/3,y1:7,x2:7,y2:16/3},this.resizeGroup)}addDeleteDom(){this.deleteGroup=se(hl.G,{class:"blocklyCommentDeleteIcon"},this.svgGroup),this.deleteIconBorder=se(hl.CIRCLE,{class:"blocklyDeleteIconShape",r:"7",cx:"7.5",cy:"7.5"},this.deleteGroup),se(hl.LINE,{x1:"5",y1:"10",x2:"10",y2:"5",stroke:"#fff","stroke-width":"2"},this.deleteGroup),se(hl.LINE,{x1:"5",y1:"5",x2:"10",y2:"10",stroke:"#fff","stroke-width":"2"},this.deleteGroup)}resizeMouseDown(e){this.unbindDragEvents(),q(e)||(this.workspace.startDrag(e,new el(this.workspace.RTL?-this.width_:this.width_,this.height_)),this.onMouseUpWrapper=Y(document,"pointerup",this,this.resizeMouseUp),this.onMouseMoveWrapper=Y(document,"pointermove",this,this.resizeMouseMove),this.workspace.hideChaff()),e.stopPropagation()}deleteMouseDown(e){this.deleteIconBorder&&ne(this.deleteIconBorder,"blocklyDeleteIconHighlighted"),e.stopPropagation()}deleteMouseOut(e){this.deleteIconBorder&&re(this.deleteIconBorder,"blocklyDeleteIconHighlighted")}deleteMouseUp(e){this.dispose(),e.stopPropagation()}unbindDragEvents(){this.onMouseUpWrapper&&(X(this.onMouseUpWrapper),this.onMouseUpWrapper=null),this.onMouseMoveWrapper&&(X(this.onMouseMoveWrapper),this.onMouseMoveWrapper=null)}resizeMouseUp(e){G(),this.unbindDragEvents()}resizeMouseMove(e){this.autoLayout=!1,e=this.workspace.moveDrag(e),this.setSize(this.RTL?-e.x:e.x,e.y)}resizeComment(){const e=this.getHeightWidth(),t=rc.TOP_OFFSET;let i,s;if(null==(i=this.foreignObject)||i.setAttribute("width",String(e.width)),null==(s=this.foreignObject)||s.setAttribute("height",String(e.height-t)),this.RTL){let t;null==(t=this.foreignObject)||t.setAttribute("x",String(-e.width))}this.textarea&&(this.textarea.style.width=e.width-4+"px",this.textarea.style.height=e.height-4-t+"px")}setSize(e,t){let i,s,n,o;if(e=Math.max(e,45),t=Math.max(t,20+rc.TOP_OFFSET),this.width_=e,this.height_=t,this.svgRect_.setAttribute("width",`${e}`),this.svgRect_.setAttribute("height",`${t}`),null==(i=this.svgRectTarget)||i.setAttribute("width",`${e}`),null==(s=this.svgRectTarget)||s.setAttribute("height",`${t}`),null==(n=this.svgHandleTarget)||n.setAttribute("width",`${e}`),null==(o=this.svgHandleTarget)||o.setAttribute("height",String(rc.TOP_OFFSET)),this.RTL){let e;this.svgRect_.setAttribute("transform","scale(-1 1)"),null==(e=this.svgRectTarget)||e.setAttribute("transform","scale(-1 1)")}if(this.resizeGroup)if(this.RTL){let i;this.resizeGroup.setAttribute("transform","translate("+(8-e)+","+(t-8)+") scale(-1 1)"),null==(i=this.deleteGroup)||i.setAttribute("transform","translate("+(8-e)+",-8) scale(-1 1)")}else{let i;this.resizeGroup.setAttribute("transform","translate("+(e-8)+","+(t-8)+")"),null==(i=this.deleteGroup)||i.setAttribute("transform","translate("+(e-8)+",-8)")}this.resizeComment()}setFocus(){this.focused=!0,setTimeout((()=>{this.disposed_||(this.textarea.focus(),this.addFocus(),this.svgRectTarget&&ne(this.svgRectTarget,"blocklyCommentTargetFocused"),this.svgHandleTarget&&ne(this.svgHandleTarget,"blocklyCommentHandleTargetFocused"))}),0)}blurFocus(){this.focused=!1,setTimeout((()=>{this.disposed_||(this.textarea.blur(),this.removeFocus(),this.svgRectTarget&&re(this.svgRectTarget,"blocklyCommentTargetFocused"),this.svgHandleTarget&&re(this.svgHandleTarget,"blocklyCommentHandleTargetFocused"))}),0)}static fromXmlRendered(e,t,i){let s;Dr.disable$$module$build$src$core$events$utils();try{const n=ic.parseAttributes(e);if(s=new rc(t,n.content,n.h,n.w,n.id),t.rendered&&(s.initSvg(!0),s.render()),!isNaN(n.x)&&!isNaN(n.y))if(t.RTL){const e=i||t.getWidth();s.moveBy(e-n.x,n.y)}else s.moveBy(n.x,n.y)}finally{Dr.enable$$module$build$src$core$events$utils()}return ic.fireCreateEvent(s),s}};rc.DEFAULT_SIZE=100,rc.TOP_OFFSET=10,ee("\n.blocklyCommentForeignObject {\n  position: relative;\n  z-index: 0;\n}\n\n.blocklyCommentRect {\n  fill: #E7DE8E;\n  stroke: #bcA903;\n  stroke-width: 1px;\n}\n\n.blocklyCommentTarget {\n  fill: transparent;\n  stroke: #bcA903;\n}\n\n.blocklyCommentTargetFocused {\n  fill: none;\n}\n\n.blocklyCommentHandleTarget {\n  fill: none;\n}\n\n.blocklyCommentHandleTargetFocused {\n  fill: transparent;\n}\n\n.blocklyFocused>.blocklyCommentRect {\n  fill: #B9B272;\n  stroke: #B9B272;\n}\n\n.blocklySelected>.blocklyCommentTarget {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCommentDeleteIcon {\n  cursor: pointer;\n  fill: #000;\n  display: none;\n}\n\n.blocklySelected > .blocklyCommentDeleteIcon {\n  display: block;\n}\n\n.blocklyDeleteIconShape {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1px;\n}\n\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\n  stroke: #fc3;\n}\n");var ac=new Set,lc=new WeakSet,cc=null,uc=null,hc=0,dc={};dc.finishQueuedRenders=kt,dc.queueRender=It,dc.triggerQueuedRenders=vt;var pc={};pc.appendDomToWorkspace=Ht,pc.blockToDom=Mt,pc.blockToDomWithXY=Lt,pc.clearWorkspaceAndLoadFromXml=Ut,pc.deleteNext=ei,pc.domToBlock=Dr.domToBlock$$module$build$src$core$xml,pc.domToBlockInternal=Gt,pc.domToPrettyText=Ft,pc.domToText=Pt,pc.domToVariables=Vt,pc.domToWorkspace=Dr.domToWorkspace$$module$build$src$core$xml,pc.variablesToDom=xt,pc.workspaceToDom=Nt;var gc=class extends Error{},mc=class extends gc{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},fc=class extends gc{constructor(e,t,i){super(`The block ${t.toDevString()} is missing a(n) ${e}\nconnection`),this.block=t,this.state=i}},_c=class extends gc{constructor(e,t,i,s){super(`The block ${i.toDevString()} could not connect its\n${t} to its parent, because: ${e}`),this.childBlock=i,this.childState=s}},bc=class extends gc{constructor(e){super("Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren"),this.state=e}},Tc=class extends gc{constructor(e,t,i){super(`Cannot add an icon of type '${e}' to the block ${t.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=t,this.state=i}},Ec={};Ec.BadConnectionCheck=_c,Ec.DeserializationError=gc,Ec.MissingBlockType=mc,Ec.MissingConnection=fc,Ec.RealChildOfShadow=bc,Ec.UnregisteredIcon=Tc;var yc={};yc.register=si,yc.unregister=ni;var Ic=class{constructor(){this.priority=50}save(e){const t=[];for(const i of e.getTopBlocks(!1))(e=oi(i,{addCoordinates:!0,doFullSerialization:!1}))&&t.push(e);return t.length?{languageVersion:0,blocks:t}:null}load(e,t){e=e.blocks;for(const i of e)gi(i,t,{recordUndo:A()})}clear(e){for(const t of e.getTopBlocks(!1))t.dispose(!1)}};si("blocks",new Ic);var kc={};kc.BlockSerializer=Ic,kc.append=gi,kc.appendInternal=mi,kc.save=oi;var vc=class extends _a{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new vc)).blockId=e.blockId,t}},Cc=class extends vc{constructor(e){super(e),this.type=Dr.CREATE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Lt(e),this.ids=M(e),this.json=oi(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=Pt(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Cc)).xml=Dr.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!Sc(t,this.ids))if(e)gi(this.json,t);else for(e=0;e<this.ids.length;e++){const i=this.ids[e],s=t.getBlockById(i);s?s.dispose(!1):i===this.blockId&&console.warn("Can't uncreate non-existent block: "+i)}}},Sc=function(e,t){return t.map((t=>e.getBlockById(t))).filter((e=>e&&e.isShadow())).length===t.length};t(Ur.EVENT,Dr.CREATE$$module$build$src$core$events$utils,Cc);var Oc=class extends ba{constructor(e,t){super(t),this.type="theme_change",this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Oc)).themeName=e.themeName,t}};t(Ur.EVENT,"theme_change",Oc);var Ac,wc=class extends ba{constructor(e,t,i,s,n){super(s),this.type=na,this.viewTop=e,this.viewLeft=t,this.scale=i,this.oldScale=n}toJson(){const e=super.toJson();if(void 0===this.viewTop)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.viewLeft)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.scale)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.oldScale)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new wc)).viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}};t(Ur.EVENT,na,wc),Dr.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:28,connectingSnapRadius:28,currentConnectionPreference:8,bumpDelay:250},Dr.config$$module$build$src$core$config,function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"}(Ac||(Ac={}));var Rc=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(e,t){if(!this.connections.length)return-1;const i=this.calculateIndexForYPos(t);if(i>=this.connections.length)return-1;t=e.y;let s=i;for(;0<=s&&this.connections[s].y===t;){if(this.connections[s]===e)return s;s--}for(s=i;s<this.connections.length&&this.connections[s].y===t;){if(this.connections[s]===e)return s;s++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,i=this.connections.length;for(;t<i;){const s=Math.floor((t+i)/2);if(this.connections[s].y<e)t=s+1;else{if(!(this.connections[s].y>e)){t=s;break}i=s}}return t}removeConnection(e,t){if(-1===(e=this.findIndexOfConnection(e,t)))throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,t){function i(e){const i=n-s[e].x,r=o-s[e].y;return Math.sqrt(i*i+r*r)<=t&&l.push(s[e]),r<t}const s=this.connections,n=e.x,o=e.y;e=0;let r=s.length-2,a=r;for(;e<a;)s[a].y<o?e=a:r=a,a=Math.floor((e+r)/2);const l=[];if(r=e=a,s.length){for(;0<=e&&i(e);)e--;do{r++}while(r<s.length&&i(r))}return l}isInYRange(e,t,i){return Math.abs(this.connections[e].y-t)<=i}searchForClosest(e,t,i){if(!this.connections.length)return{connection:null,radius:t};const s=e.y,n=e.x;e.x=n+i.x,e.y=s+i.y;var o=this.calculateIndexForYPos(e.y);i=null;let r,a=t,l=o-1;for(;0<=l&&this.isInYRange(l,e.y,t);)r=this.connections[l],this.connectionChecker.canConnect(e,r,!0,a)&&(i=r,a=r.distanceFrom(e)),l--;for(;o<this.connections.length&&this.isInYRange(o,e.y,t);)r=this.connections[o],this.connectionChecker.canConnect(e,r,!0,a)&&(i=r,a=r.distanceFrom(e)),o++;return e.x=n,e.y=s,{connection:i,radius:a}}static init(e){const t=[];return t[Ac.INPUT_VALUE]=new Rc(e),t[Ac.OUTPUT_VALUE]=new Rc(e),t[Ac.NEXT_STATEMENT]=new Rc(e),t[Ac.PREVIOUS_STATEMENT]=new Rc(e),t}},Nc=class{paste(e,t,i){if(!t.isCapacityAvailable(e.typeCounts))return null;let s;i&&(e.blockState.x=i.x,e.blockState.y=i.y),Dr.disable$$module$build$src$core$events$utils();try{s=gi(e.blockState,t),Oi(s)}finally{Dr.enable$$module$build$src$core$events$utils()}return s?($()&&!s.isShadow()&&w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(s)),s.select(),s):s}};Nc.TYPE="block",Et(Nc.TYPE,new Nc);var xc={};xc.BlockPaster=Nc,xc.moveBlockToNotConflict=Oi;var Lc=null,$c=null,Dc={duplicateInternal:Di,copyInternal:Ni},Mc={};Mc.BlockPaster=Nc,Mc.TEST_ONLY=Dc,Mc.copy=Ri,Mc.duplicate=$i,Mc.paste=xi,Mc.registry=nc;var Bc,Pc,Fc="aria-",Uc="role";!function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem"}(Bc||(Bc={})),function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin"}(Pc||(Pc={}));var Hc={};Hc.Role=Bc,Hc.State=Pc,Hc.setRole=Mi,Hc.setState=Bi;var Gc,Vc=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const t=document.createElement("div");t.className="blocklyMenu goog-menu blocklyNonSelectable",t.tabIndex=0,this.roleName&&Mi(t,this.roleName),this.element=t;for(let e,i=0;e=this.menuItems[i];i++)t.appendChild(e.createDom());return this.mouseOverHandler=Y(t,"pointerover",this,this.handleMouseOver,!0),this.clickHandler=Y(t,"pointerup",this,this.handleClick,!0),this.mouseEnterHandler=Y(t,"pointerenter",this,this.handleMouseEnter,!0),this.mouseLeaveHandler=Y(t,"pointerleave",this,this.handleMouseLeave,!0),this.onKeyDownHandler=Y(t,"keydown",this,this.handleKeyEvent),e.appendChild(t),t}getElement(){return this.element}focus(){const e=this.getElement();e&&(e.focus({preventScroll:!0}),ne(e,"blocklyFocused"))}blur(){const e=this.getElement();e&&(e.blur(),re(e,"blocklyFocused"))}setRole(e){this.roleName=e}dispose(){this.mouseOverHandler&&(X(this.mouseOverHandler),this.mouseOverHandler=null),this.clickHandler&&(X(this.clickHandler),this.clickHandler=null),this.mouseEnterHandler&&(X(this.mouseEnterHandler),this.mouseEnterHandler=null),this.mouseLeaveHandler&&(X(this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.onKeyDownHandler&&(X(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e,t=0;e=this.menuItems[t];t++)e.dispose();this.element=null}getMenuItem(e){const t=this.getElement();for(;e&&e!==t;){if(e.classList.contains("blocklyMenuItem"))for(let t,i=0;t=this.menuItems[i];i++)if(t.getElement()===e)return t;e=e.parentElement}return null}setHighlighted(e){var t=this.highlightedItem;t&&(t.setHighlighted(!1),this.highlightedItem=null),e&&(e.setHighlighted(!0),this.highlightedItem=e,t=this.getElement(),Ce(e.getElement(),t),Bi(t,Pc.ACTIVEDESCENDANT,e.getId()))}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){let i;for(e+=t;i=this.menuItems[e];){if(i.isEnabled()){this.setHighlighted(i);break}e+=t}}handleMouseOver(e){(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){const t=this.openingCoords;if(this.openingCoords=null,t&&"number"==typeof e.clientX){const i=new el(e.clientX,e.clientY);if(1>el.distance(t,i))return}(e=this.getMenuItem(e.target))&&e.performAction()}handleMouseEnter(e){this.focus()}handleMouseLeave(e){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),t=be(e);return t.height=e.scrollHeight,t}},jc=class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=C(),this.element=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const t=document.createElement("div");if(t.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var i=document.createElement("div");i.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",t.appendChild(i)}return i=this.content,"string"==typeof this.content&&(i=document.createTextNode(this.content)),t.appendChild(i),e.appendChild(t),this.roleName&&Mi(e,this.roleName),Bi(e,Pc.SELECTED,this.checkable&&this.checked||!1),Bi(e,Pc.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return null!=(e=this.opt_value)?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const t=this.getElement();t&&this.isEnabled()&&(e?(ne(t,"blocklyMenuItemHighlight"),ne(t,"goog-menuitem-highlight")):(re(t,"blocklyMenuItemHighlight"),re(t,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(e,t){this.actionHandler=e.bind(t)}},Wc=null,Yc=null,zc="blocklyWidgetDiv",Xc="",Kc="",qc={};qc.createDom=Ui,qc.getDiv=Pi,qc.hide=Gi,qc.hideIfOwner=ji,qc.isVisible=Vi,qc.positionWithAnchor=Yi,qc.repositionForWindowResize=qi,qc.show=Hi,qc.testOnly_setDiv=Fi;var Jc=null,Zc={},Qc=null,eu={};eu.callbackFactory=Dr.callbackFactory$$module$build$src$core$contextmenu,eu.commentDeleteOption=rs,eu.commentDuplicateOption=as,eu.dispose=os,eu.getCurrentBlock=Ji,eu.hide=ns,eu.setCurrentBlock=Zi,eu.show=Qi,eu.workspaceCommentOption=ls;var tu=class{constructor(){this.registry_=new Map,this.reset()}reset(){this.registry_.clear()}register(e){if(this.registry_.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registry_.set(e.id,e)}unregister(e){if(!this.registry_.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registry_.delete(e)}getItem(e){let t;return null!=(t=this.registry_.get(e))?t:null}getContextMenuOptions(e,t){const i=[];for(const n of this.registry_.values())if(e===n.scopeType){var s=n.preconditionFn(t);"hidden"!==s&&(s={text:"function"==typeof n.displayText?n.displayText(t):n.displayText,enabled:"enabled"===s,callback:n.callback,scope:t,weight:n.weight},i.push(s))}return i.sort((function(e,t){return e.weight-t.weight})),i}};!function(e){var t=e.ScopeType||(e.ScopeType={});t.BLOCK="block",t.WORKSPACE="workspace",e.registry=new e}(tu||(tu={}));var iu=tu.ScopeType,su={};su.ContextMenuRegistry=tu,su.ScopeType=iu;var nu={};nu.clamp=hs,nu.toDegrees=us,nu.toRadians=cs;var ou,ru,au,lu=16,cu=1,uu=12,hu=16,du=.25,pu=null,gu=null,mu="",fu="",_u=null,bu=null,Tu=null,Eu={getBoundsInfo:function(){const e=Ie(_u),t=be(_u);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,i,s){const n=Eu.getBoundsInfo(),o=be(ou);return t+o.height<n.bottom?vs(e,t,n,o):s-o.height>n.top?Cs(i,s,n,o):t+o.height<document.documentElement.clientHeight?vs(e,t,n,o):s-o.height>document.documentElement.clientTop?Cs(i,s,n,o):Ss(e,n,o)}},yu={ANIMATION_TIME:du,ARROW_HORIZONTAL_PADDING:uu,ARROW_SIZE:lu,BORDER_SIZE:cu,PADDING_Y:hu,TEST_ONLY:Eu};yu.clearContent=fs,yu.createDom=ds,yu.getContentDiv=ms,yu.getOwner=gs,yu.getPositionX=Os,yu.hide=Rs,yu.hideIfOwner=ws,yu.hideWithoutAnimation=Ns,yu.isVisible=As,yu.repositionForWindowResize=Ls,yu.setBoundsElement=ps,yu.setColour=_s,yu.show=ks,yu.showPositionedByBlock=bs,yu.showPositionedByField=Ts;var Iu=null,ku=null,vu={};vu.connectionUiEffect=Ms,vu.disconnectUiEffect=Bs,vu.disconnectUiStop=Fs,vu.disposeUiEffect=$s;var Cu=class{constructor(e,t){this.bubble=e,this.workspace=t,this.dragTarget_=null,this.wouldDeleteBubble_=!1,this.startXY_=this.bubble.getRelativeToSurfaceXY()}startBubbleDrag(){let e;Dr.getGroup$$module$build$src$core$events$utils()||Dr.setGroup$$module$build$src$core$events$utils(!0),this.workspace.setResizesEnabled(!1),this.bubble.setAutoLayout&&this.bubble.setAutoLayout(!1),null==(e=this.workspace.getLayerManager())||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}dragBubble(e,t){t=this.pixelsToWorkspaceUnits_(t),t=el.sum(this.startXY_,t),this.bubble.moveDuringDrag(t),t=this.dragTarget_,this.dragTarget_=this.workspace.getDragTarget(e),e=this.wouldDeleteBubble_,this.wouldDeleteBubble_=this.shouldDelete_(this.dragTarget_),e!==this.wouldDeleteBubble_&&this.updateCursorDuringBubbleDrag_(),this.dragTarget_!==t&&(t&&t.onDragExit(this.bubble),this.dragTarget_&&this.dragTarget_.onDragEnter(this.bubble)),this.dragTarget_&&this.dragTarget_.onDragOver(this.bubble)}shouldDelete_(e){return!(!e||!this.workspace.getComponentManager().hasCapability(e.id,qa.Capability.DELETE_AREA))&&e.wouldDelete(this.bubble,!1)}updateCursorDuringBubbleDrag_(){this.bubble.setDeleteStyle(this.wouldDeleteBubble_)}endBubbleDrag(e,t){if(this.dragBubble(e,t),this.dragTarget_&&this.dragTarget_.shouldPreventMove(this.bubble)?e=this.startXY_:(e=this.pixelsToWorkspaceUnits_(t),e=el.sum(this.startXY_,e)),this.bubble.moveTo(e.x,e.y),this.dragTarget_&&this.dragTarget_.onDrop(this.bubble),this.wouldDeleteBubble_)this.fireMoveEvent_(),this.bubble.dispose();else{if(this.bubble.setDragging){let e;this.bubble.setDragging(!1),null==(e=this.workspace.getLayerManager())||e.moveOffDragLayer(this.bubble,100)}this.fireMoveEvent_()}this.workspace.setResizesEnabled(!0),Dr.setGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent_(){if(this.bubble instanceof rc){const e=new(P(ra))(this.bubble);e.setOldCoordinate(this.startXY_),e.recordNew(),w(e)}}pixelsToWorkspaceUnits_(e){return e=new el(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}},Su=[];Su[Ac.INPUT_VALUE]=Ac.OUTPUT_VALUE,Su[Ac.OUTPUT_VALUE]=Ac.INPUT_VALUE,Su[Ac.NEXT_STATEMENT]=Ac.PREVIOUS_STATEMENT,Su[Ac.PREVIOUS_STATEMENT]=Ac.NEXT_STATEMENT;var Ou={};Ou.commonWordPrefix=Gs,Ou.commonWordSuffix=Vs,Ou.isNumber=Dr.isNumber$$module$build$src$core$utils$string,Ou.shortestStringLength=Hs,Ou.startsWith=Us,Ou.wrap=Dr.wrap$$module$build$src$core$utils$string;var Au=void 0,wu=!1,Ru=!1,Nu=50,xu=0,Lu=0,$u=0,Du=0,Mu=null,Bu=null,Pu=0,Fu=10,Uu=10,Hu=750,Gu=5,Vu=null,ju={HOVER_MS:Hu,LIMIT:Nu,MARGINS:Gu,OFFSET_X:Pu,OFFSET_Y:Fu,RADIUS_OK:Uu};ju.bindMouseEvents=tn,ju.block=cn,ju.createDom=en,ju.dispose=an,ju.getCustomTooltip=Ks,ju.getDiv=Js,ju.getTooltipOfObject=Zs,ju.hide=ln,ju.isVisible=qs,ju.setCustomTooltip=Xs,ju.unbindMouseEvents=sn,ju.unblock=un;var Wu=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace.isMovableVertically(),this.startScrollXY_=new el(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){f()&&f().unselect()}endDrag(e){this.drag(e)}drag(e){if(e=el.sum(this.startScrollXY_,e),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(e.x,this.workspace.scrollY);else{if(!this.verticalScrollEnabled_)throw new TypeError("Invalid state.");this.workspace.scroll(this.workspace.scrollX,e.y)}}},Yu=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new el(0,0),this.startWorkspace_=this.targetBlock=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.flyout=this.workspaceDragger=this.blockDragger=this.bubbleDragger=null,this.isMultiTouch_=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new el(0,0),this.healStack=!1}dispose(){G(),un(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.blockDragger&&this.blockDragger.dispose(),this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const t=new el(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(),H()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=el.difference(e,this.mouseDownXY),!this.hasExceededDragRadius&&(this.hasExceededDragRadius=el.magnitude(this.currentDragDeltaXY)>(this.flyout?Dr.config$$module$build$src$core$config.flyoutDragRadius:Dr.config$$module$build$src$core$config.dragRadius))}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||null==(e=this.flyout)||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error("Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined");return!(this.flyout.isScrollable()&&!this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)||(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),Dr.getGroup$$module$build$src$core$events$utils()||Dr.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),this.targetBlock.select(),0))}updateIsDraggingBubble(){return!!this.startBubble&&(this.startDraggingBubble(),!0)}updateIsDraggingBlock(){if(!this.targetBlock)return!1;if(this.flyout){if(this.updateIsDraggingFromFlyout())return this.startDraggingBlock(),!0}else if(this.targetBlock.isMovable())return this.startDraggingBlock(),!0;return!1}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.workspaceDragger=new Wu(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(){if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.updateIsDraggingBubble()||this.updateIsDraggingBlock()||this.updateIsDraggingWorkspace()}startDraggingBlock(){this.blockDragger=new(c(Ur.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(this.targetBlock,this.startWorkspace_),this.blockDragger.startDrag(this.currentDragDeltaXY,this.healStack),this.blockDragger.drag(this.mostRecentEvent,this.currentDragDeltaXY)}startDraggingBubble(){if(!this.startBubble)throw Error("Cannot update dragging the bubble because the start bubble is undefined");if(!this.startWorkspace_)throw Error("Cannot update dragging the bubble because the start workspace is undefined");this.bubbleDragger=new Cu(this.startBubble,this.startWorkspace_),this.bubbleDragger.startBubbleDrag(),this.bubbleDragger.dragBubble(this.mostRecentEvent,this.currentDragDeltaXY)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,K(e)?this.cancel():(this.gestureHasStarted=!0,Fs(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=gs(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,cn(),this.targetBlock&&this.targetBlock.select(),q(e)?this.handleRightClick(e):("pointerdown"===e.type.toLowerCase()&&"mouse"!==e.pointerType&&U(e,this),this.mouseDownXY=new el(e.clientX,e.clientY),this.healStack=e.altKey||e.ctrlKey||e.metaKey,this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(Y(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(Y(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(Y(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&H())}handleMove(e){this.isDragging()&&V(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.blockDragger?this.blockDragger.drag(this.mostRecentEvent,this.currentDragDeltaXY):this.bubbleDragger&&this.bubbleDragger.dragBubble(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),H())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!V(e))return;if(this.updateFromEvent(e),H(),this.isEnding_)return void console.log("Trying to end a gesture recursively.");this.isEnding_=!0,this.bubbleDragger?this.bubbleDragger.endBubbleDrag(e,this.currentDragDeltaXY):this.blockDragger?this.blockDragger.endDrag(e,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()?this.doBubbleClick():this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e)}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=j(e);this.cachedPoints.set(t,this.getTouchPoint(e));var i=Array.from(this.cachedPoints.keys());2===i.length&&(t=this.cachedPoints.get(i[0]),i=this.cachedPoints.get(i[1]),this.startDistance=el.distance(t,i),this.isMultiTouch_=!0,e.preventDefault())}handleTouchMove(e){const t=j(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&2===this.cachedPoints.size?this.handlePinch(e):this.handleMove(e)}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),i=this.cachedPoints.get(t[0]);if(t=this.cachedPoints.get(t[1]),i=el.distance(i,t)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(t=0<(t=i-this.previousScale)?5*t:6*t,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const s=this.startWorkspace_,n=J(e,s.getParentSvg(),s.getInverseScreenCTM());s.zoom(n.x,n.y,t)}this.previousScale=i,e.preventDefault()}handleTouchEnd(e){e=j(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new el(e.pageX,e.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(H(),this.bubbleDragger?this.bubbleDragger.endBubbleDrag(this.mostRecentEvent,this.currentDragDeltaXY):this.blockDragger?this.blockDragger.endDrag(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.doStart(e)}fireWorkspaceClick(e){w(new(P(ia))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}doBubbleClick(){this.startBubble instanceof rc&&(this.startBubble.setFocus(),this.startBubble.select())}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");this.targetBlock.isEnabled()&&(Dr.getGroup$$module$build$src$core$events$utils()||Dr.setGroup$$module$build$src$core$events$utils(!0),this.flyout.createBlock(this.targetBlock).scheduleSnapAndBump())}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");const e=new(P(ia))(this.startBlock,this.startWorkspace_.id,"block");w(e)}this.bringBlockToFront(),Dr.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){e=this.creatorWorkspace,f()&&f().unselect(),this.fireWorkspaceClick(this.startWorkspace_||e)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):this.targetBlock=e}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isBlockClick(){return!(!this.startBlock||this.hasExceededDragRadius||this.isFieldClick()||this.isIconClick())}isFieldClick(){return!!this.startField&&this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose))}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!(this.startBlock||this.startBubble||this.startField||this.hasExceededDragRadius)}isDragging(){return!!this.workspaceDragger||!!this.blockDragger||!!this.bubbleDragger}hasStarted(){return this.gestureHasStarted}getInsertionMarkers(){return this.blockDragger?this.blockDragger.getInsertionMarkers():[]}getCurrentDragger(){let e,t;return null!=(t=null!=(e=this.blockDragger)?e:this.workspaceDragger)?t:this.bubbleDragger}static inProgress(){const e=h();for(let t,i=0;t=e[i];i++)if(t.currentGesture_)return!0;return!1}},zu=class{constructor(e,t){let i,s,n;this.pattern=e,this.scale=1,this.spacing=null!=(i=t.spacing)?i:0,this.length=null!=(s=t.length)?s:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling,this.snapToGrid=null!=(n=t.snap)&&n}setSpacing(e){this.spacing=e,this.update(this.scale)}setLength(e){this.length=e,this.update(this.scale)}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getSpacing(){return this.spacing}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e;this.pattern.setAttribute("width",`${t}`),this.pattern.setAttribute("height",`${t}`);let i=(t=Math.floor(this.spacing/2)+.5)-this.length/2,s=t+this.length/2;t*=e,i*=e,s*=e,this.setLineAttributes(this.line1,e,i,s,t,t),this.setLineAttributes(this.line2,e,t,t,i,s)}setLineAttributes(e,t,i,s,n,o){e&&(e.setAttribute("stroke-width",`${t}`),e.setAttribute("x1",`${i}`),e.setAttribute("y1",`${n}`),e.setAttribute("x2",`${s}`),e.setAttribute("y2",`${o}`))}moveTo(e,t){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${t}`)}static createDom(e,t,i){let s,n;if(e=se(hl.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},i),0<(null!=(s=t.length)?s:1)&&0<(null!=(n=t.spacing)?n:0)){let i;se(hl.LINE,{stroke:t.colour},e),null!=(i=t.length)&&i&&se(hl.LINE,{stroke:t.colour},e)}else se(hl.LINE,{},e);return e}},Xu=class{constructor(e){this.workspace=e,this.cursorSvg_=this.cursor_=null,this.markers=new Map,this.markerSvg_=null}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),t.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,t)),this.setMarkerSvg(t.getDrawer().createDom()),this.markers.set(e,t)}unregisterMarker(e){const t=this.markers.get(e);if(!t)throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.");t.dispose(),this.markers.delete(e)}getCursor(){return this.cursor_}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=e)&&(e=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom()))}setCursorSvg(e){e?(this.workspace.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null}setMarkerSvg(e){e?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(e)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const e=Object.keys(this.markers);for(let t,i=0;t=e[i];i++)this.unregisterMarker(t);this.markers.clear(),this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};Xu.LOCAL_MARKER="local_marker_1";var Ku={};Ku.deepMerge=mn;var qu=class{constructor(e,i,s,n){this.name=e,this.startHats=!1,this.blockStyles=i||Object.create(null),this.categoryStyles=s||Object.create(null),this.componentStyles=n||Object.create(null),this.fontStyle=Object.create(null),t(Ur.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(!(e=this.componentStyles[e]))return null;if("string"==typeof e){const t=this.getComponentStyle(e);if(t)return t}return`${e}`}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();const i=new qu(e);let s=t.base;if(s){if("string"==typeof s){let e;s=null!=(e=a(Ur.THEME,s))?e:void 0}s instanceof qu&&(mn(i,s),i.name=e)}return mn(i.blockStyles,t.blockStyles),mn(i.categoryStyles,t.categoryStyles),mn(i.componentStyles,t.componentStyles),mn(i.fontStyle,t.fontStyle),null!==t.startHats&&(i.startHats=t.startHats),i}},Ju=new qu("classic",{colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},{colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}}),Zu=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,i=!1;var s=!1,n=!1,o=!1,r=!1,a=!1;const l=!!e.readOnly;var c;l||(t=Me(null!=(c=e.toolbox)?c:null),i=Fe(t),s=void 0===(s=e.trashcan)?i:s,n=void 0===(n=e.collapse)?i:n,o=void 0===(o=e.comments)?i:o,r=void 0===(r=e.disable)?i:r,a=void 0===(a=e.sounds)||a),c=e.maxTrashcanContents,s?void 0===c&&(c=32):c=0;const u=!!e.rtl;let h=e.horizontalLayout;void 0===h&&(h=!1);var d="end"!==e.toolboxPosition;d=h?d?Al.TOP:Al.BOTTOM:d===u?Al.RIGHT:Al.LEFT;let p=e.css;void 0===p&&(p=!0);let g="https://blockly-demo.appspot.com/static/media/";e.media?g=e.media.endsWith("/")?e.media:e.media+"/":"path"in e&&(ie("path","Nov 2014","Jul 2023","media"),g=e.path+"media/");const m=e.oneBasedIndex,f=e.renderer||"geras",_=e.plugins||{};let b,T,E,y=e.modalInputs;void 0===y&&(y=!0),this.RTL=u,this.oneBasedIndex=void 0===m||m,this.collapse=n,this.comments=o,this.disable=r,this.readOnly=l,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=null!=(b=e.maxInstances)?b:null,this.modalInputs=y,this.pathToMedia=g,this.hasCategories=i,this.moveOptions=Zu.parseMoveOptions_(e,i),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=s,this.maxTrashcanContents=c,this.hasSounds=a,this.hasCss=p,this.horizontalLayout=h,this.languageTree=t,this.gridOptions=Zu.parseGridOptions_(e),this.zoomOptions=Zu.parseZoomOptions_(e),this.toolboxPosition=d,this.theme=Zu.parseThemeOptions_(e),this.renderer=f,this.rendererOverrides=null!=(T=e.rendererOverrides)?T:null,this.parentWorkspace=null!=(E=e.parentWorkspace)?E:null,this.plugins=_}static parseMoveOptions_(e,t){const i=e.move||{},s={};return void 0===i.scrollbars&&void 0===e.scrollbars?s.scrollbars=t:"object"==typeof i.scrollbars?(s.scrollbars={horizontal:!!i.scrollbars.horizontal,vertical:!!i.scrollbars.vertical},s.scrollbars.horizontal&&s.scrollbars.vertical?s.scrollbars=!0:s.scrollbars.horizontal||s.scrollbars.vertical||(s.scrollbars=!1)):s.scrollbars=!!i.scrollbars||!!e.scrollbars,s.wheel=s.scrollbars&&void 0!==i.wheel?!!i.wheel:"object"==typeof s.scrollbars,s.drag=!(!s.scrollbars||void 0!==i.drag&&!i.drag),s}static parseZoomOptions_(e){e=e.zoom||{};const t={};return t.controls=void 0!==e.controls&&!!e.controls,t.wheel=void 0!==e.wheel&&!!e.wheel,t.startScale=void 0===e.startScale?1:Number(e.startScale),t.maxScale=void 0===e.maxScale?3:Number(e.maxScale),t.minScale=void 0===e.minScale?.3:Number(e.minScale),t.scaleSpeed=void 0===e.scaleSpeed?1.2:Number(e.scaleSpeed),t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions_(e){e=e.grid||{};const t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=void 0===e.length?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions_(e){return"string"==typeof(e=e.theme||Ju)?a(Ur.THEME,e):e instanceof qu?e:qu.defineTheme(e.name||"builtin"+C(),e)}},Qu=class extends vc{constructor(e,t,i,s,n){super(e),this.type=Dr.CHANGE$$module$build$src$core$events$utils,e&&(this.element=t,this.name=i||void 0,this.oldValue=s,this.newValue=n)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Qu)).element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");var i=t.getIcon(Hl.MUTATOR);switch(i&&fn(i)&&i.bubbleIsVisible()&&i.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":t.setEnabled(!e);break;case"inline":t.setInputsInline(!!e);break;case"mutation":i=Qu.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation(Dr.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),w(new Qu(t,"mutation",null,i,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?Pt(e):""}};t(Ur.EVENT,Dr.CHANGE$$module$build$src$core$events$utils,Qu);var eh=.45,th=.65,ih={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},sh={};sh.blend=Cn,sh.getHsvSaturation=_n,sh.getHsvValue=Tn,sh.hexToRgb=kn,sh.hsvToHex=vn,sh.hueToHex=Sn,sh.names=ih,sh.parse=yn,sh.rgbToHex=In,sh.setHsvSaturation=bn,sh.setHsvValue=En;var nh={};nh.checkMessageReferences=Rn,nh.parseBlockColour=Nn,nh.replaceMessageReferences=wn,nh.tokenizeInterpolation=An;var oh=class{constructor(e,t,i){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new pl(0,0),e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){e.tooltip&&this.setTooltip(wn(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=se(hl.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=se(hl.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=se(hl.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");tn(e),this.mouseDownWrapper_=Y(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return null!==(e=this.saveLegacyState(oh))?e:this.getValue()}loadState(e){this.loadLegacyState(oh,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?((e=Dr.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",this.name||""),$e(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml&&(this.fromXml(Dr.textToDom$$module$build$src$core$utils$xml(t)),!0)}dispose(){let e;ws(this),ji(this),null!=(e=this.getSourceBlock())&&e.isDeadOrDying()||le(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(ne(e,"blocklyEditableText"),re(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(ne(e,"blocklyNonEditableText"),re(e,"blocklyEditableText"),e.style.cursor=""))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==oh.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var t=this.fieldGroup_;t&&(t.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const t=this.getConstants();let i=2*(e=void 0!==e?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING),s=t.FIELD_TEXT_HEIGHT,n=0;this.textElement_&&(i+=n=me(this.textElement_,t.FIELD_TEXT_FONTSIZE,t.FIELD_TEXT_FONTWEIGHT,t.FIELD_TEXT_FONTFAMILY)),this.isFullBlockField()||(s=Math.max(s,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=s,this.size_.width=i,this.positionTextElement_(e,n),this.positionBorderRect_()}positionTextElement_(e,t){if(this.textElement_){var i,s=this.getConstants(),n=this.size_.height/2;this.textElement_.setAttribute("x",String(null!=(i=this.getSourceBlock())&&i.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(s.FIELD_TEXT_BASELINE_CENTER?n:n-s.FIELD_TEXT_HEIGHT/2+s.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0===this.size_.width&&(this.render_(),0!==this.size_.width&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new pl(0,0)}getScaledBBox(){let e;var t=this.getSourceBlock();if(!t)throw new rh;if(this.isFullBlockField()){var i=this.sourceBlock_.getHeightWidth();const s=t.workspace.scale;e=this.getAbsoluteXY_(),t=(i.width+1)*s,i=(i.height+1)*s,Pa?(e.x+=1.5*s,e.y+=1.5*s):(e.x-=.5*s,e.y-=.5*s)}else i=this.borderRect_.getBoundingClientRect(),e=Ie(this.borderRect_),t=i.width,i=i.height;return new dl(e.y,e.y+i,e.x,e.x+t)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+"…"),e=e.replace(/\s/g,oh.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="‏"),e):oh.NBSP}getText(){const e=this.getText_();return String(null!==e?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.queueRender(),this.sourceBlock_.bumpNeighbours())}setValue(e,t=!0){if(null!==e){var i,s=this.doClassValidation_(e);(e=this.processValidation_(e,s))instanceof Error||(s=null==(i=this.getValidator())?void 0:i.call(this,e),(i=this.processValidation_(e,s))instanceof Error||(e=this.sourceBlock_)&&e.disposed||((s=this.getValue())===i?this.doValueUpdate_(i):(this.doValueUpdate_(i),t&&e&&$()&&w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(e,"field",this.name||null,s,i)),this.isDirty_&&this.forceRerender())))}}processValidation_(e,t){return null===t?(this.doValueInvalid_(e),this.isDirty_&&this.forceRerender(),Error()):void 0===t?e:t}getValue(){return this.value_}doClassValidation_(e){return null==e?null:e}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||""===e||(e=this.sourceBlock_);const t=this.getClickTarget_();t?t.tooltip=e:this.tooltip_=e}getTooltip(){const e=this.getClickTarget_();return Zs(e||{tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return Ie(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const t=this.getSourceBlock();if(!t)throw new rh;const i=t.inputList;for(let s=0;s<t.inputList.length;s++){const t=i[s],n=t.fieldRow;for(let i=0;i<n.length;i++)if(n[i]===this){e=t;break}}return e}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(e){return!1}setCursorSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.cursorSvg_=e}else this.cursorSvg_=null}setMarkerSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.markerSvg_=e}else this.markerSvg_=null}updateMarkers_(){var e=this.getSourceBlock();if(!e)throw new rh;(e=e.workspace).keyboardAccessibilityMode&&this.cursorSvg_&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg_&&e.getMarker(Xu.LOCAL_MARKER).draw()}};oh.NBSP=" ",oh.SKIP_SETUP=Symbol("SKIP_SETUP");var rh=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},ah={};ah.Field=oh,ah.UnattachedFieldError=rh,Dr.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.name:null:(console.warn("Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());"),null)}populateVariables(e){e=Dr.allUsedVarModels$$module$build$src$core$variables(e);for(let t=0;t<e.length;t++)this.getName(e[t].getId(),Dr.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let i=e;t===Dr.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(i=e),e=i.toLowerCase();const s=t===Dr.NameType$$module$build$src$core$names.VARIABLE||t===Dr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(t)||this.db.set(t,new Map);const n=this.db.get(t);return n.has(e)?s+n.get(e):(t=this.getDistinctName(i,t),n.set(e,t.substr(s.length)),t)}getUserNames(e){let t;return(e=null==(t=this.db.get(e))?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let i,s,n,o=null;for(;this.dbReverse.has(e+(null!=(i=o)?i:""))||this.reservedWords.has(e+(null!=(s=o)?s:""));)o=o?o+1:2;return e+=null!=(n=o)?n:"",this.dbReverse.add(e),(t===Dr.NameType$$module$build$src$core$names.VARIABLE||t===Dr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!=="0123456789".indexOf(e[0])&&(e="my_"+e)):e=Dr.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},function(e){(e=e.NameType||(e.NameType={})).DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}(Dr.Names$$module$build$src$core$names||(Dr.Names$$module$build$src$core$names={})),Dr.NameType$$module$build$src$core$names=Dr.Names$$module$build$src$core$names.NameType,Dr.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=Dr.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,{NameType:Dr.NameType$$module$build$src$core$names}.Names=Dr.Names$$module$build$src$core$names;var lh=class extends Map{constructor(){super()}set(e,t){return this.get(e)===t||(super.set(e,t),Ln(t)&&t.startPublishing()),this}delete(e){const t=this.get(e);return(e=super.delete(e))?(Ln(t)&&t.stopPublishing(),e):e}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},ch=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new el(0,0),this.workspaceLocation=new el(0,0),this.svgRoot=null,this.tooltip=e}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var t=this.sourceBlock;this.svgRoot=se(hl.G,{class:"blocklyIconGroup"}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),Y(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,tn(this.svgRoot)}}dispose(){sn(this.svgRoot),le(this.svgRoot)}getWeight(){return-1}getSize(){return new pl(0,0)}setTooltip(e){this.tooltip=null!=e?e:this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",fn(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;null==(e=this.svgRoot)||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=el.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}setVisible(e){ie("setVisible","v10","v11","setBubbleVisible"),fn(this)&&this.setBubbleVisible(e)}},uh={fromJsonInternal:Mn},hh={TEST_ONLY:uh};hh.fromJson=Dr.fromJson$$module$build$src$core$field_registry,hh.register=$n,hh.unregister=Dn;var dh=class extends oh{constructor(e,t,i){super(oh.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==oh.SKIP_SETUP&&(Array.isArray(e)?(Fn(e),e=Bn(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],i&&this.configure_(i),this.setValue(this.selectedOption[1]),t&&this.setValidator(t))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(dh,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=se(hl.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&ne(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null!=(e=this.getSourceBlock())&&e.isShadow())}createTextArrow_(){let e,t;this.arrow=se(hl.TSPAN,{},this.textElement_),this.arrow.appendChild(document.createTextNode(null!=(e=this.getSourceBlock())&&e.RTL?dh.ARROW_CHAR+" ":" "+dh.ARROW_CHAR)),null!=(t=this.getSourceBlock())&&t.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=se(hl.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(rl,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new rh;this.dropdownCreate(),this.menu_.openingCoords=e&&"number"==typeof e.clientX?new el(e.clientX,e.clientY):null,fs(),e=this.menu_.render(ms()),ne(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),_s(t,this.sourceBlock_.style.colourTertiary)),Ts(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),Ce(this.selectedMenuItem.getElement(),ms(),!0)),this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new rh;const t=new Vc;t.setRole(Bc.LISTBOX),this.menu_=t;const i=this.getOptions(!1);this.selectedMenuItem=null;for(let n=0;n<i.length;n++){const[o,r]=i[n];if("object"==typeof o){var s=new Image(o.width,o.height);s.src=o.src,s.alt=o.alt||""}else s=o;(s=new jc(s,r)).setRole(Bc.OPTION),s.setRightToLeft(e.RTL),s.setCheckable(!0),t.addChild(s),s.setChecked(r===this.value_),r===this.value_&&(this.selectedMenuItem=s),s.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){ws(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||(this.generatedOptions=this.menuGenerator_(),Fn(this.generatedOptions)),this.generatedOptions)}doClassValidation_(e){return this.getOptions(!0).some((t=>t[1]===e))?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let t,i=0;t=e[i];i++)t[1]===this.value_&&(this.selectedOption=t)}applyColour(){const e=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",e.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow&&(this.sourceBlock_.isShadow()?this.arrow.style.fill=e.colourSecondary:this.arrow.style.fill=e.colourPrimary)}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];e&&"object"==typeof e?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const t=this.getSourceBlock();if(!t)throw new rh;this.imageElement.style.display="",this.imageElement.setAttributeNS(rl,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const i=Number(e.height);e=Number(e.width);var s=!!this.borderRect_;const n=Math.max(s?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,i+ph);let o;s=s?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,o=this.svgArrow?this.positionSVGArrow(e+s,n/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):me(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=e+o+2*s,this.size_.height=n;let r=0;t.RTL?this.imageElement.setAttribute("x",`${s+o}`):(r=e+o,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${s}`)),this.imageElement.setAttribute("y",String(n/2-i/2)),this.positionTextElement_(r+s,e+o)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();ne(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var t=!!this.borderRect_;e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const i=me(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let s=0;this.svgArrow&&(s=this.positionSVGArrow(i+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=i+s+2*t,this.size_.height=e,this.positionTextElement_(t,i)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;const i=this.getSourceBlock();if(!i)throw new rh;const s=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,n=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(i.RTL?s:e+n)+","+t+")"),o+n}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];return"object"==typeof e?e.alt:e}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}};dh.CHECKMARK_OVERHANG=25,dh.MAX_MENU_HEIGHT_VH=.45,dh.ARROW_CHAR="▾";var ph=10;$n("field_dropdown",dh);var gh,mh=class{constructor(e,t,i){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new pl(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.svgRoot=se(hl.G,{},e.getBubbleCanvas()),e=se(hl.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=se(hl.PATH,{},e),this.background=se(hl.RECT,{class:"blocklyDraggable",x:0,y:0,rx:gh.BORDER_WIDTH,ry:gh.BORDER_WIDTH},e),this.contentContainer=se(hl.G,{},this.svgRoot),Y(this.background,"pointerdown",this,this.onMouseDown)}dispose(){le(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,gh.MIN_SIZE),e.height=Math.max(e.height,gh.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let t;null==(t=this.workspace.getGesture(e))||t.handleBubbleStart(e,this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new dl(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),s=this.getOptimalRelativeTop(t);const n={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},o={x:-this.size.width-30,y:s};s={x:e.getWidth(),y:s};var r={x:i,y:e.getHeight()};i=e.getWidth()<e.getHeight()?s:r,e=e.getWidth()<e.getHeight()?r:s,s=this.getOverlap(n,t),r=this.getOverlap(o,t);const a=this.getOverlap(i,t);t=this.getOverlap(e,t),s===(t=Math.max(s,r,a,t))?(this.relativeLeft=n.x,this.relativeTop=n.y):r===t?(this.relativeLeft=o.x,this.relativeTop=o.y):a===t?(this.relativeLeft=i.x,this.relativeTop=i.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var i=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(i+this.size.width,t.left+t.width)-Math.max(i,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;if(this.size.width>e.width)return t;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var i=this.anchor.x-t;i-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):i>e.right&&(t=-(e.right-this.anchor.x))}else{const s=(i=t+this.anchor.x)+this.size.width;i<e.left?t=e.left-this.anchor.x:s>e.right&&(t=e.right-this.anchor.x-this.size.width)}return t}getOptimalRelativeTop(e){let t=-this.size.height/4;if(this.size.height>e.height)return t;const i=this.anchor.y+t,s=i+this.size.height;return i<(e=this.getWorkspaceViewRect(e)).top?t=e.top-this.anchor.y:s>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height),t}getWorkspaceViewRect(e){const t=e.top;let i=e.top+e.height,s=e.left;return e=e.left+e.width,i-=this.getScrollbarThickness(),this.workspace.RTL?s-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new dl(t,i,s,e)}getScrollbarThickness(){return Tl.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var t=this.size.width/2,i=this.size.height/2,s=-this.relativeLeft,n=-this.relativeTop;if(t===s&&i===n)e.push("M "+t+","+i);else{n-=i,s-=t,this.workspace.RTL&&(s*=-1);var o=Math.sqrt(n*n+s*s),r=Math.acos(s/o);0>n&&(r=2*Math.PI-r);var a=r+Math.PI/2;a>2*Math.PI&&(a-=2*Math.PI);var l=Math.sin(a);const c=Math.cos(a);let u=(this.size.width+this.size.height)/gh.TAIL_THICKNESS;u=Math.min(u,this.size.width,this.size.height)/4,s=t+(a=1-gh.ANCHOR_RADIUS/o)*s,n=i+a*n,a=t+u*c;const h=i+u*l;t-=u*c,i-=u*l,(l=r+(l=cs(this.workspace.RTL?-gh.TAIL_ANGLE:gh.TAIL_ANGLE)))>2*Math.PI&&(l-=2*Math.PI),r=Math.sin(l)*o/gh.TAIL_BEND,o=Math.cos(l)*o/gh.TAIL_BEND,e.push("M"+a+","+h),e.push("C"+(a+o)+","+(h+r)+" "+s+","+n+" "+s+","+n),e.push("C"+s+","+n+" "+(t+o)+","+(i+r)+" "+t+","+i)}let c;e.push("z"),null==(c=this.tail)||c.setAttribute("d",e.join(" "))}bringToFront(){let e;const t=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==t?void 0:t.lastChild)===this.svgRoot||(null==t||t.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new el(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}};gh=mh,mh.BORDER_WIDTH=6,mh.DOUBLE_BORDER=2*gh.BORDER_WIDTH,mh.MIN_SIZE=gh.DOUBLE_BORDER,mh.TAIL_THICKNESS=1,mh.TAIL_ANGLE=20,mh.TAIL_BEND=4,mh.ANCHOR_RADIUS=8;var fh=class extends mh{constructor(e,t,i,s){let n,o;super(t,i,s),this.workspace=t,this.anchor=i,this.ownerRect=s,this.autoLayout=!0,t=new Zu(e),this.validateWorkspaceOptions(t),this.svgDialog=se(hl.SVG,{x:mh.BORDER_WIDTH,y:mh.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Zu(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(hl.G),this.miniWorkspace.getCanvas()),null==(e=this.miniWorkspace.getFlyout())||e.init(this.miniWorkspace),null==e||e.show(t.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this)),null==(n=this.miniWorkspace.getFlyout())||null==(o=n.getWorkspace())||o.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const t=e.getRelativeToSurfaceXY();if(20>t.y&&e.moveBy(0,20-t.y),e.RTL){let i=-20;const s=this.miniWorkspace.getFlyout();s&&(i-=s.getWidth()),t.x>i&&e.moveBy(i-t.x,0)}else 20>t.x&&e.moveBy(20-t.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),t=this.calculateWorkspaceSize();Math.abs(e.width-t.width)<fh.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<fh.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${t.width}px`),this.svgDialog.setAttribute("height",`${t.height}px`),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new pl(t.width+mh.DOUBLE_BORDER,t.height+mh.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+fh.MARGIN;e=e.height+fh.MARGIN;const i=this.miniWorkspace.getFlyout();if(i){const s=i.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,s.height+20),t+=i.getWidth()}return new pl(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let t;if(e=null==(t=this.miniWorkspace.getFlyout())?void 0:t.getWorkspace())for(const t of e.getAllBlocks(!1))t.setStyle(t.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};fh.MINIMUM_VIEW_CHANGE=10,fh.MARGIN=3*mh.DOUBLE_BORDER,Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends ch{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),se(hl.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),se(hl.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),se(hl.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),ne(this.svgRoot,"blockly-icon-mutator"))}dispose(){let e;super.dispose(),null==(e=this.miniWorkspaceBubble)||e.dispose()}getWeight(){return Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new pl(17,17)}applyColour(){let e,t;super.applyColour(),null==(e=this.miniWorkspaceBubble)||e.setColour(this.sourceBlock.style.colourPrimary),null==(t=this.miniWorkspaceBubble)||t.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.miniWorkspaceBubble)||t.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){if(this.bubbleIsVisible()!==e){if(e){let e;this.miniWorkspaceBubble=new fh(this.getMiniWorkspaceConfig(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.applyColour(),this.createRootBlock(),this.addSaveConnectionsListener(),null==(e=this.miniWorkspaceBubble)||e.addWorkspaceChangeListener(this.createMiniWorkspaceChangeListener())}else{let e;null==(e=this.miniWorkspaceBubble)||e.dispose(),this.miniWorkspaceBubble=null,this.saveConnectionsListener&&this.sourceBlock.workspace.removeChangeListener(this.saveConnectionsListener),this.saveConnectionsListener=null}w(new(P(sa))(this.sourceBlock,e,"mutator"))}}getMiniWorkspaceConfig(){let e;const t={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:null!=(e=this.sourceBlock.workspace.options.rendererOverrides)?e:void 0};return this.flyoutBlockTypes.length&&(t.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map((e=>({kind:"block",type:e})))}),t}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new dl(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");for(var e of(this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace()),this.rootBlock.getDescendants(!1)))e.queueRender();let t,i,s,n;this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1),e=null!=(n=null==(t=this.miniWorkspaceBubble)||null==(i=t.getWorkspace())||null==(s=i.getFlyout())?void 0:s.getWidth())?n:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+16):16,16)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout((()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()}),0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||e.type===Dr.CREATE$$module$build$src$core$events$utils||e.type===Dr.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=Dr.getGroup$$module$build$src$core$events$utils();e||Dr.setGroup$$module$build$src$core$events$utils(!0);var t=Qu.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var i=Qu.getExtraBlockState_(this.sourceBlock);t!==i&&w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"mutation",null,t,i)),Dr.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return null==(e=this.miniWorkspaceBubble)?void 0:e.getWorkspace()}static reconnect(e,t,i){return ie("MutatorIcon.reconnect","v10","v11","connection.reconnect"),!!e&&e.reconnect(t,i)}static findParentWs(e){return ie("MutatorIcon.findParentWs","v10","v11","workspace.getRootWorkspace"),e.getRootWorkspace()}},Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=Hl.MUTATOR,Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon;var _h=Object.create(null),bh={allExtensions:_h};Dr.register$$module$build$src$core$extensions("parent_tooltip_when_inline",Qn);var Th,Eh={TEST_ONLY:bh};Eh.apply=Gn,Eh.buildTooltipForDropdown=Dr.buildTooltipForDropdown$$module$build$src$core$extensions,Eh.buildTooltipWithFieldText=Dr.buildTooltipWithFieldText$$module$build$src$core$extensions,Eh.isRegistered=Hn,Eh.register=Dr.register$$module$build$src$core$extensions,Eh.registerMixin=Dr.registerMixin$$module$build$src$core$extensions,Eh.registerMutator=Dr.registerMutator$$module$build$src$core$extensions,Eh.runAfterPageLoad=Jn,Eh.unregister=Un,function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"}(Th||(Th={}));var yh={};yh.arc=ao,yh.curve=to,yh.line=oo,yh.lineOnAxis=ro,yh.lineTo=no,yh.moveBy=so,yh.moveTo=io,yh.point=eo;var Ih={};Ih.Coordinate=el,Ih.KeyCodes=Th,Ih.Rect=dl,Ih.Size=pl,Ih.Svg=hl,Ih.aria=Hc,Ih.array=Xa,Ih.browserEvents=za,Ih.colour=sh,Ih.deprecation=il,Ih.dom=ul,Ih.extensions=Eh,Ih.idGenerator=ga,Ih.math=nu,Ih.object=Ku,Ih.parsing=nh,Ih.string=Ou,Ih.style=ml,Ih.svgMath=bl,Ih.svgPaths=yh,Ih.toolbox=Dl,Ih.userAgent=ja,Ih.xml=Ol;var kh={};kh.register=lo,kh.unregister=co;var vh=class extends mh{constructor(e,t,i,s){super(t,i,s),this.text=e,this.workspace=t,this.anchor=i,this.ownerRect=s,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(e){this.text=e,le(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createSpans(t,e),this.workspace.RTL&&this.rightAlignSpans(t.getBBox().width,e),t}createParagraph(e){return se(hl.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:mh.BORDER_WIDTH},e)}createSpans(e,t){return t.split("\n").map((t=>{const i=se(hl.TSPAN,{dy:"1em",x:mh.BORDER_WIDTH},e);return t=document.createTextNode(t),i.appendChild(t),i}))}rightAlignSpans(e,t){for(const i of t)i.setAttribute("text-anchor","end"),i.setAttribute("x",`${e+mh.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new pl(e.width+2*mh.BORDER_WIDTH,e.height+2*mh.BORDER_WIDTH),!0)}},Ch=class extends mh{constructor(e,t,i){super(e,t,i),this.workspace=e,this.anchor=t,this.ownerRect=i,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new pl(160+mh.DOUBLE_BORDER,80+mh.DOUBLE_BORDER),this.MIN_SIZE=new pl(45+mh.DOUBLE_BORDER,20+mh.DOUBLE_BORDER),({inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer)),this.resizeGroup=this.createResizeHandle(this.svgRoot),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}createEditor(e){e=se(hl.FOREIGNOBJECT,{x:mh.BORDER_WIDTH,y:mh.BORDER_WIDTH},e);const t=document.createElementNS(ol,"body");t.setAttribute("xmlns",ol),t.className="blocklyMinimalBody";const i=document.createElementNS(ol,"textarea");return i.className="blocklyCommentTextarea",i.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),t.appendChild(i),e.appendChild(t),this.bindTextAreaEvents(i),setTimeout((()=>{i.focus()}),0),{inputRoot:e,textArea:i}}bindTextAreaEvents(e){Y(e,"wheel",this,(e=>{e.stopPropagation()})),Y(e,"focus",this,this.onStartEdit,!0),Y(e,"change",this,this.onTextChange)}createResizeHandle(e){e=se(hl.G,{class:this.workspace.RTL?"blocklyResizeSW":"blocklyResizeSE"},e);const t=2*mh.BORDER_WIDTH;return se(hl.POLYGON,{points:`0,${t} ${t},${t} ${t},0`},e),se(hl.LINE,{class:"blocklyResizeLine",x1:t/3,y1:t-1,x2:t-1,y2:t/3},e),se(hl.LINE,{class:"blocklyResizeLine",x1:2*t/3,y1:t-1,x2:t-1,y2:2*t/3},e),Y(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const i=e.width-mh.DOUBLE_BORDER,s=e.height-mh.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${i}`),this.inputRoot.setAttribute("height",`${s}`),this.textArea.style.width=i-4+"px",this.textArea.style.height=s-4+"px",this.workspace.RTL?this.resizeGroup.setAttribute("transform",`translate(${mh.DOUBLE_BORDER}, ${s}) scale(-1 1)`):this.resizeGroup.setAttribute("transform",`translate(${i}, ${s})`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(e){this.bringToFront(),q(e)||(this.workspace.startDrag(e,new el(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=Y(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=Y(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){G(),this.resizePointerUpListener&&(X(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(X(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e),this.setSize(new pl(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}};ee("\n.blocklyCommentTextarea {\n  background-color: #fef49c;\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n");var Sh=class extends ch{constructor(e){super(e),this.sourceBlock=e,this.textBubble=this.textInputBubble=null,this.text="",this.bubbleSize=new pl(160,80),this.bubbleVisiblity=!1}getType(){return Sh.TYPE}initView(e){this.svgRoot||(super.initView(e),se(hl.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),se(hl.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),se(hl.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),ne(this.svgRoot,"blockly-icon-comment"))}dispose(){let e,t;super.dispose(),null==(e=this.textInputBubble)||e.dispose(),null==(t=this.textBubble)||t.dispose()}getWeight(){return Sh.WEIGHT}getSize(){return new pl(17,17)}applyColour(){super.applyColour();const e=this.sourceBlock.style.colourPrimary;let t,i;null==(t=this.textInputBubble)||t.setColour(e),null==(i=this.textBubble)||i.setColour(e)}updateEditable(){super.updateEditable(),this.bubbleIsVisible()&&(this.setBubbleVisible(!1),this.setBubbleVisible(!0))}onLocationChange(e){let t,i;super.onLocationChange(e),e=this.getAnchorLocation(),null==(t=this.textInputBubble)||t.setAnchorLocation(e),null==(i=this.textBubble)||i.setAnchorLocation(e)}setText(e){const t=this.text;let i,s;w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,t,e)),this.text=e,null==(i=this.textInputBubble)||i.setText(this.text),null==(s=this.textBubble)||s.setText(this.text)}getText(){return this.text}setBubbleSize(e){let t;this.bubbleSize=e,null==(t=this.textInputBubble)||t.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){let t,i,s,n;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new pl(null!=(i=e.width)?i:160,null!=(s=e.height)?s:80),this.bubbleVisiblity=null!=(n=e.pinned)&&n,setTimeout((()=>this.setBubbleVisible(this.bubbleVisiblity)),1)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){e&&(this.textBubble||this.textInputBubble)||(e||this.textBubble||this.textInputBubble)&&(this.bubbleVisiblity=e,this.sourceBlock.rendered&&!this.sourceBlock.isInFlyout&&(e?(this.sourceBlock.isEditable()?this.showEditableBubble():this.showNonEditableBubble(),this.applyColour()):this.hideBubble(),w(new(P(sa))(this.sourceBlock,e,"comment"))))}showEditableBubble(){this.textInputBubble=new Ch(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener((()=>this.onTextChange())),this.textInputBubble.addSizeChangeListener((()=>this.onSizeChange()))}showNonEditableBubble(){this.textBubble=new vh(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect())}hideBubble(){let e,t;null==(e=this.textInputBubble)||e.dispose(),this.textInputBubble=null,null==(t=this.textBubble)||t.dispose(),this.textBubble=null}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new dl(e.y,e.y+e.height,e.x,e.x+e.width)}};Sh.TYPE=Hl.COMMENT,Sh.WEIGHT=3,lo(Sh.TYPE,Sh);var Oh=class extends ch{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return Oh.TYPE}initView(e){this.svgRoot||(super.initView(e),se(hl.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),se(hl.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),se(hl.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),ne(this.svgRoot,"blockly-icon-warning"))}dispose(){let e;super.dispose(),null==(e=this.textBubble)||e.dispose()}getWeight(){return Oh.WEIGHT}getSize(){return new pl(17,17)}applyColour(){let e;super.applyColour(),null==(e=this.textBubble)||e.setColour(this.sourceBlock.style.colourPrimary)}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){let t;super.onLocationChange(e),null==(t=this.textBubble)||t.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){if(this.textMap.get(t)===e)return this;let i;return e?this.textMap.set(t,e):this.textMap.delete(t),null==(i=this.textBubble)||i.setText(this.getText()),this}getText(){return[...this.textMap.values()].join("\n")}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){if(this.bubbleIsVisible()!==e){if(e)this.textBubble=new vh(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.applyColour();else{let e;null==(e=this.textBubble)||e.dispose(),this.textBubble=null}w(new(P(sa))(this.sourceBlock,e,"warning"))}}getAnchorLocation(){return el.sum(this.workspaceLocation,new el(8.5,8.5))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new dl(e.y,e.y+e.height,e.x,e.x+e.width)}};Oh.TYPE=Hl.WARNING,Oh.WEIGHT=2;var Ah=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},wh={};wh.DuplicateIconType=Ah;var Rh,Nh={};Nh.CommentIcon=Sh,Nh.Icon=ch,Nh.IconType=Hl,Nh.MutatorIcon=Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon,Nh.WarningIcon=Oh,Nh.exceptions=wh,Nh.registry=kh,Dr.DEFAULT_ARG$$module$build$src$core$procedures="x",(Rh={CATEGORY_NAME:"PROCEDURE",DEFAULT_ARG:Dr.DEFAULT_ARG$$module$build$src$core$procedures}).ObservableProcedureMap=lh,Rh.allProcedures=uo,Rh.findLegalName=Dr.findLegalName$$module$build$src$core$procedures,Rh.flyoutCategory=mo,Rh.getCallers=To,Rh.getDefinition=Dr.getDefinition$$module$build$src$core$procedures,Rh.isNameUsed=go,Rh.isProcedureBlock=xn,Rh.mutateCallers=Dr.mutateCallers$$module$build$src$core$procedures,Rh.mutatorOpenListener=_o,Rh.rename=Dr.rename$$module$build$src$core$procedures;var xh=new class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return e.type&this.FIELD}isHat(e){return e.type&this.HAT}isIcon(e){return e.type&this.ICON}isSpacer(e){return e.type&this.SPACER}isInRowSpacer(e){return e.type&this.IN_ROW_SPACER}isInput(e){return e.type&this.INPUT}isExternalInput(e){return e.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(e){return e.type&this.INLINE_INPUT}isStatementInput(e){return e.type&this.STATEMENT_INPUT}isPreviousConnection(e){return e.type&this.PREVIOUS_CONNECTION}isNextConnection(e){return e.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(e){return e.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(e){return e.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(e){return e.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(e){return e.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(e){return e.type&this.RIGHT_SQUARE_CORNER}isCorner(e){return e.type&this.CORNER}isJaggedEdge(e){return e.type&this.JAGGED_EDGE}isRow(e){return e.type&this.ROW}isBetweenRowSpacer(e){return e.type&this.BETWEEN_ROW_SPACER}isTopRow(e){return e.type&this.TOP_ROW}isBottomRow(e){return e.type&this.BOTTOM_ROW}isTopOrBottomRow(e){return e.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(e){return e.type&this.INPUT_ROW}},Lh=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=xh.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},$h=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=xh.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(xh.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const t=this.elements[e];if(xh.isSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const t=this.elements[e];if(xh.isSpacer(t))return t}return null}},Dh=class extends $h{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=xh.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let s=0;s<this.elements.length;s++){const n=this.elements[s];t+=n.width,xh.isSpacer(n)||(xh.isNextConnection(n)?i=Math.max(i,n.height):e=Math.max(e,n.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.descenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},Mh=class extends Lh{constructor(e,t){super(e),this.connectionModel=t,this.type|=xh.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},Bh=class extends Mh{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=xh.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},Ph=class extends Bh{constructor(e,t){super(e,t),this.height=0,this.type|=xh.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Fh=class extends Lh{constructor(e,t,i){super(e),this.field=t,this.parentInput=i,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=xh.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},Uh=class extends Lh{constructor(e){super(e),this.type|=xh.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},Hh=class extends Lh{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.isVisible=fn(t)&&t.bubbleIsVisible(),this.type|=xh.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},Gh=class extends Lh{constructor(e,t){super(e),this.type=this.type|xh.SPACER|xh.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},Vh=class extends Bh{constructor(e,t){super(e,t),this.type|=xh.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},jh=class extends Bh{constructor(e,t){super(e,t),this.type|=xh.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},Wh=class extends $h{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=xh.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let t=0;t<this.elements.length;t++){const i=this.elements[t];this.width+=i.width,xh.isInput(i)&&i instanceof Bh&&(xh.isStatementInput(i)&&i instanceof jh?e+=i.connectedBlockWidth:xh.isExternalInput(i)&&i instanceof Ph&&0!==i.connectedBlockWidth&&(e+=i.connectedBlockWidth-i.connectionWidth)),xh.isSpacer(i)||(this.height=Math.max(this.height,i.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},Yh=class extends Lh{constructor(e){super(e),this.type|=xh.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},zh=class extends Mh{constructor(e,t){super(e,t),this.type|=xh.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},Xh=class extends Mh{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=xh.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},Kh=class extends Mh{constructor(e,t){super(e,t),this.type|=xh.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},qh=class extends Lh{constructor(e,t){super(e),this.type=(t&&"left"!==t?xh.RIGHT_ROUND_CORNER:xh.LEFT_ROUND_CORNER)|xh.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},Jh=class extends $h{constructor(e,t,i){super(e),this.height=t,this.width=i,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|xh.SPACER|xh.BETWEEN_ROW_SPACER,this.elements=[new Gh(this.constants_,i)]}measure(){}},Zh=class extends Lh{constructor(e,t){super(e),this.type=(t&&"left"!==t?xh.RIGHT_SQUARE_CORNER:xh.LEFT_SQUARE_CORNER)|xh.CORNER,this.width=this.height=this.constants_.NO_PADDING}},Qh=class extends $h{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=xh.TOP_ROW}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,i=e.getPreviousBlock();return!!e.outputConnection||t||!!i&&i.getNextBlock()===e}hasRightSquareCorner(e){return!0}measure(){let e=0,t=0,i=0;for(let s=0;s<this.elements.length;s++){const n=this.elements[s];t+=n.width,xh.isSpacer(n)||(xh.isHat(n)&&n instanceof Uh?i=Math.max(i,n.ascenderHeight):e=Math.max(e,n.height))}this.width=Math.max(this.minWidth,t),this.height=Math.max(this.minHeight,e)+i,this.capline=this.ascenderHeight=i,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},ed=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=so(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const t=e.blockStyles;for(const e in t)this.blockStyles[e]=this.validatedBlockStyle_(t[e]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=void 0!==e.startHats?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=_e("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&0===e.indexOf("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const t={};return e&&Object.assign(t,e),e=Nn(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?Nn(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?Nn(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return Cn("#fff",e,.6)||e}generateTertiaryColour_(e){return Cn("#fff",e,.3)||e}dispose(){this.embossFilter&&le(this.embossFilter),this.disabledPattern&&le(this.disabledPattern),this.debugFilter&&le(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH;return{height:e,width:t,path:oo([eo(t,e/4),eo(2*-t,e/2),eo(t,e/4)])}}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:to("c",[eo(30,-e),eo(70,-e),eo(t,0)])}}makePuzzleTab(){function e(e){const s=-(e=e?-1:1);var n=i/2;const o=n+2.5,r=n+.5,a=eo(-t,e*n);return n=eo(t,e*n),to("c",[eo(0,e*o),eo(-t,s*r),a])+to("s",[eo(t,2.5*s),n])}const t=this.TAB_WIDTH,i=this.TAB_HEIGHT,s=e(!0),n=e(!1);return{type:this.SHAPES.PUZZLE,width:t,height:i,pathDown:n,pathUp:s}}makeNotch(){function e(e){return oo([eo(e*s,i),eo(3*e,0),eo(e*s,-i)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,s=(t-3)/2,n=e(1),o=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:n,pathRight:o}}makeInsideCorners(){const e=this.CORNER_RADIUS;return{width:e,height:e,pathTop:ao("a","0 0,0",e,eo(-e,e)),pathBottom:ao("a","0 0,0",e,eo(e,e))}}makeOutsideCorners(){const e=this.CORNER_RADIUS,t=so(0,e)+ao("a","0 0,1",e,eo(e,-e)),i=ao("a","0 0,1",e,eo(e,e)),s=ao("a","0 0,1",e,eo(-e,-e));return{topLeft:t,topRight:i,bottomRight:ao("a","0 0,1",e,eo(-e,e)),bottomLeft:s,rightHeight:e}}shapeFor(e){switch(e.type){case Ac.INPUT_VALUE:case Ac.OUTPUT_VALUE:return this.PUZZLE_TAB;case Ac.PREVIOUS_STATEMENT:case Ac.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,i){this.injectCSS_(t,i),this.defs=se(hl.DEFS,{},e),e=se(hl.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),se(hl.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=se(hl.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),se(hl.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),se(hl.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),se(hl.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=se(hl.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),se(hl.RECT,{width:10,height:10,fill:"#aaa"},e),se(hl.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const e=se(hl.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=se(hl.FECOMPONENTTRANSFER,{result:"outBlur"},e);se(hl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),se(hl.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),se(hl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const i=t.join("\n");this.cssNode?this.cssNode.firstChild.textContent=i:((t=document.createElement("style")).id=e,e=document.createTextNode(i),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect,`,`${e} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},td={};td.ConstantProvider=ed,td.isDynamicShape=yo,td.isNotch=ko,td.isPuzzleTab=Io;var id=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}hideHiddenIcons_(){ie("hideHiddenIcons_","v10","v11")}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,t=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=so(e.xPos,this.info_.startY);for(let e,i=0;e=t[i];i++)xh.isLeftRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:xh.isRightRoundedCorner(e)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:xh.isPreviousConnection(e)&&e instanceof Mh?this.outlinePath_+=e.shape.pathLeft:xh.isHat(e)?this.outlinePath_+=this.constants_.START_HAT.path:xh.isSpacer(e)&&(this.outlinePath_+=ro("h",e.width));this.outlinePath_+=ro("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+ro("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const t=e.getLastInput();this.positionExternalValueConnection_(e);const i=yo(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown;this.outlinePath_+=ro("H",t.xPos+t.width)+i+ro("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t=e.getLastInput();if(t){var i=t.xPos+t.notchOffset+t.shape.width;t=t.shape.pathRight+ro("h",-(t.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var s=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=ro("H",i)+t+ro("v",s)+this.constants_.INSIDE_CORNERS.pathBottom+ro("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=ro("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,t=e.elements;this.positionNextConnection_();let i=0,s="";for(let n,o=t.length-1;n=t[o];o--)xh.isNextConnection(n)&&n instanceof Mh?s+=n.shape.pathRight:xh.isLeftSquareCorner(n)?s+=ro("H",e.xPos):xh.isLeftRoundedCorner(n)?s+=this.constants_.OUTSIDE_CORNERS.bottomLeft:xh.isRightRoundedCorner(n)?(s+=this.constants_.OUTSIDE_CORNERS.bottomRight,i=this.constants_.OUTSIDE_CORNERS.rightHeight):xh.isSpacer(n)&&(s+=ro("h",-1*n.width));this.outlinePath_+=ro("V",e.baseline-i),this.outlinePath_+=s}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const t=e.connectionOffsetY+e.height;e=yo(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=ro("V",t)+e}this.outlinePath_+="z"}drawInternals_(){for(let e,t=0;e=this.info_.rows[t];t++)for(let t,i=0;t=e.elements[i];i++)xh.isInlineInput(t)?this.drawInlineInput_(t):(xh.isIcon(t)||xh.isField(t))&&this.layoutField_(t)}layoutField_(e){const t=e.centerline-e.height/2;let i=e.xPos;var s="";this.info_.RTL&&(i=-(i+e.width),e.flipRtl&&(i+=e.width,s="scale(-1 1)")),xh.isIcon(e)?((s=e.icon).setOffsetInBlock(new el(i,t)),this.info_.isInsertionMarker&&s.hideForInsertionMarker()):((e=e.field.getSvgRoot()).setAttribute("transform","translate("+i+","+t+")"+s),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const t=e.width,i=e.height,s=e.connectionOffsetY,n=e.connectionHeight+s;this.inlinePath_+=io(e.xPos+e.connectionWidth,e.centerline-i/2)+ro("v",s)+e.shape.pathDown+ro("v",i-n)+ro("h",t-e.connectionWidth)+ro("v",-i)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const t=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock(this.info_.RTL?-i:i,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const t of e.elements)if(t instanceof Mh)if(t.highlighted)this.drawConnectionHighlightPath(t);else{let e,i;null==(i=(e=this.block_.pathObject).removeConnectionHighlight)||i.call(e,t.connectionModel)}}drawConnectionHighlightPath(e){const t=e.connectionModel;e=t.type===Ac.INPUT_VALUE||t.type===Ac.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const i=t.getSourceBlock();let s,n;null==(n=(s=i.pathObject).addConnectionHighlight)||n.call(s,t,e,t.getOffsetInBlock(),i.RTL)}getExpressionConnectionHighlightPath(e){let t="";return yo(e.shape)?t=e.shape.pathDown(e.height):Io(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,so(0,-e)+ro("v",e)+t+ro("v",e)}getStatementConnectionHighlightPath(e){if(!ko(e.shape))throw Error("Statement connections should have notch shapes");const t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return so(-t,0)+ro("h",t)+e.shape.pathLeft+ro("h",t)}};!function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}(Dr.Align$$module$build$src$core$inputs$align||(Dr.Align$$module$build$src$core$inputs$align={})),Dr.Align$$module$build$src$core$inputs$align;var sd=class extends oh{constructor(e,t,i){super(oh.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==oh.SKIP_SETUP&&(i?this.configure_(i):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&ne(this.getTextElement(),this.class)}doClassValidation_(e){return null==e?null:`${e}`}setClass(e){this.textElement_&&(this.class&&re(this.textElement_,this.class),e&&ne(this.textElement_,e)),this.class=e}static fromJson(e){return new this(wn(e.text),void 0,e)}};$n("field_label",sd),sd.prototype.DEFAULT_VALUE="";var nd=class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=Dr.Align$$module$build$src$core$inputs$input.LEFT,this.visible=!0,this.type=Dr.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,i){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return t||""===t&&i?("string"==typeof t&&(t=Dr.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t})),t.setSourceBlock(this.sourceBlock),this.sourceBlock.rendered&&(t.init(),t.applyColour()),t.name=i,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered&&(this.sourceBlock.queueRender(),this.sourceBlock.bumpNeighbours()),e):e}removeField(e,t){for(let t,i=0;t=this.fieldRow[i];i++)if(t.name===e)return t.dispose(),this.fieldRow.splice(i,1),this.sourceBlock.rendered&&(this.sourceBlock.queueRender(),this.sourceBlock.bumpNeighbours()),!0;if(t)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let t=[];if(this.visible===e)return t;this.visible=e;for(let t,i=0;t=this.fieldRow[i];i++)t.setVisible(e);if(this.connection){var i=this.connection;e?t=i.startTrackingAll():i.stopTrackingAll(),(i=i.targetBlock())&&(i.getSvgRoot().style.display=e?"block":"none")}return t}markDirty(){for(let e,t=0;e=this.fieldRow[t];t++)e.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){if(this.sourceBlock.workspace.rendered)for(let e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()}dispose(){for(let e,t=0;e=this.fieldRow[t];t++)e.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}};!function(e){(e=e.Align||(e.Align={}))[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"}(nd||(nd={})),Dr.Align$$module$build$src$core$inputs$input=nd.Align,{Align:Dr.Align$$module$build$src$core$inputs$input}.Input=nd;var od=class extends nd{constructor(e,t){super(e,t),this.name=e,this.type=Dr.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},rd=class extends nd{constructor(e,t){super(e,t),this.name=e,this.type=Dr.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},ad=class extends nd{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=Dr.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(Ac.NEXT_STATEMENT)}};Dr.ValueInput$$module$build$src$core$inputs$value_input=class extends nd{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=Dr.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(Ac.INPUT_VALUE)}},Dr.ValueInput$$module$build$src$core$inputs$value_input;var ld=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new Xh(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new Qh(this.constants_),this.bottomRow=new Dh(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new Wh(this.constants_);this.inputRows.push(e);var t=this.block_.getIcons();for(let i,s=0;i=t[s];s++){const t=new Hh(this.constants_,i);this.isCollapsed&&!i.isShownWhenCollapsed()||e.elements.push(t)}t=void 0;for(let i,s=0;i=this.block_.inputList[s];s++)if(i.isVisible()){this.shouldStartNewRow_(i,t)&&(this.rows.push(e),e=new Wh(this.constants_),this.inputRows.push(e));for(let t,s=0;t=i.fieldRow[s];s++)e.elements.push(new Fh(this.constants_,t,i));this.addInput_(i,e),t=i}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new Yh(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let i=this.topRow.hasLeftSquareCorner(this.block_)?Zh:qh;this.topRow.elements.push(new i(this.constants_)),t?(e=new Uh(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new Kh(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof ad&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,i=this.topRow.hasRightSquareCorner(this.block_)?Zh:qh,this.topRow.elements.push(new i(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ad?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new Zh(this.constants_)):this.bottomRow.elements.push(new qh(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new zh(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new Zh(this.constants_,"right")):this.bottomRow.elements.push(new qh(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Vh(this.constants_,e)),t.hasInlineInput=!0):e instanceof ad?(t.elements.push(new jh(this.constants_,e)),t.hasStatement=!0):e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Ph(this.constants_,e)),t.hasExternalInput=!0):(e instanceof od||e instanceof rd)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),null===t.align&&(t.align=e.align)}shouldStartNewRow_(e,t){return!!t&&(t instanceof rd||e instanceof ad||t instanceof ad||(e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input||e instanceof od||t instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input)&&!this.isInline)}addElemSpacing_(){for(let e,t=0;e=this.rows[t];t++){const t=e.elements;if(e.elements=[],e.startsWithElemSpacer()&&e.elements.push(new Gh(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let i=0;i<t.length-1;i++){e.elements.push(t[i]);const s=this.getInRowSpacing_(t[i],t[i+1]);e.elements.push(new Gh(this.constants_,s))}e.elements.push(t[t.length-1]),e.endsWithElemSpacer()&&e.elements.push(new Gh(this.constants_,this.getInRowSpacing_(t[t.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&xh.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&xh.isInput(e)&&!t){if(xh.isExternalInput(e))return this.constants_.NO_PADDING;if(xh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(xh.isStatementInput(e))return this.constants_.NO_PADDING}return e&&xh.isLeftSquareCorner(e)&&t&&(xh.isPreviousConnection(t)||xh.isNextConnection(t))?t.notchOffset:e&&xh.isLeftRoundedCorner(e)&&t&&(xh.isPreviousConnection(t)||xh.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,t=0,i=0;for(let n,o=0;n=this.rows[o];o++){if(n.measure(),t=Math.max(t,n.width),n.hasStatement){var s=n.getLastInput();let t,i;s=n.width-(null!=(i=null==(t=s)?void 0:t.width)?i:0),e=Math.max(e,s)}i=Math.max(i,n.widthWithConnectedBlocks)}this.statementEdge=e,this.width=t;for(let e,t=0;e=this.rows[t];t++)e.hasStatement&&(e.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(t,i),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let t,i=0;t=this.rows[i];i++)if(t.hasStatement)this.alignStatementRow_(t);else{var e=t.width;0<(e=this.getDesiredRowWidth_(t)-e)&&this.addAlignmentPadding_(t,e),xh.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){const i=e.getFirstSpacer(),s=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===Dr.Align$$module$build$src$core$inputs$align.LEFT&&s)s.width+=t;else if(e.align===Dr.Align$$module$build$src$core$inputs$align.CENTRE&&i&&s)i.width+=t/2,s.width+=t/2;else if(e.align===Dr.Align$$module$build$src$core$inputs$align.RIGHT&&i)i.width+=t;else{if(!s)return;s.width+=t}e.width+=t}alignStatementRow_(e){const t=e.getLastInput();if(t){var i=e.width-t.width,s=this.statementEdge;0<(i=s-i)&&this.addAlignmentPadding_(e,i),i=e.width,s=this.getDesiredRowWidth_(e),t.width+=s-i,t.height=Math.max(t.height,e.height),e.width+=s-i,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let t=0;t<e.length;t++)this.rows.push(e[t]),t!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[t],e[t+1]))}makeSpacerRow_(e,t){var i=this.getSpacerRowHeight_(e,t);const s=this.getSpacerRowWidth_(e,t);return i=new Jh(this.constants_,i,s),e.hasStatement&&(i.followsStatement=!0),t.hasStatement&&(i.precedesStatement=!0),i}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return xh.isSpacer(t)?e.yPos+t.height/2:xh.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,xh.isNextConnection(t)?e+t.height/2:e-t.height/2):xh.isTopRow(e)?xh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(e){let t=e.xPos;for(let i,s=0;i=e.elements[s];s++)xh.isSpacer(i)&&(i.height=e.height),i.xPos=t,i.centerline=this.getElemCenterline_(e,i),t+=i.width}finalize_(){let e=0,t=0;for(let i,s=0;i=this.rows[s];s++)i.yPos=t,i.xPos=this.startX,t+=i.height,e=Math.max(e,i.widthWithConnectedBlocks),this.recordElemPositions_(i);if(this.outputConnection&&this.block_.nextConnection){const t=this.block_.nextConnection.targetBlock();t&&(e=Math.max(e,t.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline,this.bottomRow.baseline=t-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let t;if((null==(t=this.outputConnection)?void 0:t.connectionModel)===e)return this.outputConnection;for(const t of this.rows)for(const i of t.elements)if(i instanceof Mh&&i.connectionModel===e)return i;return null}},cd=class{constructor(e,t,i){if(this.wsCoordinate=null,!t)throw Error("Cannot create a node without a location.");this.type=e,this.isConnectionLocation=cd.isConnectionType(e),this.location=t,this.processParams(i||null)}processParams(e){e&&e.wsCoordinate&&(this.wsCoordinate=e.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var e=this.location.getParentInput();const t=e.getSourceBlock();for(e=t.inputList.indexOf(e),e+=1;e<t.inputList.length;e++){const i=t.inputList[e],s=i.fieldRow;for(let e=0;e<s.length;e++){const t=s[e];if(t.isClickable()||cd.NAVIGATE_ALL_FIELDS)return cd.createFieldNode(t)}if(i.connection)return cd.createInputNode(i)}return null}findNextForField(){var e=this.location,t=e.getParentInput();const i=e.getSourceBlock();if(!i)throw Error("The current AST location is not associated with a block");var s=i.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)+1;s<i.inputList.length;s++){const n=(t=i.inputList[s]).fieldRow;for(;e<n.length;){if(n[e].isClickable()||cd.NAVIGATE_ALL_FIELDS)return cd.createFieldNode(n[e]);e++}if(e=0,t.connection)return cd.createInputNode(t)}return null}findPrevForInput(){const e=this.location.getParentInput(),t=e.getSourceBlock();for(var i=t.inputList.indexOf(e);0<=i;i--){var s=t.inputList[i];if(s.connection&&s!==e)return cd.createInputNode(s);for(let e=(s=s.fieldRow).length-1;0<=e;e--){const t=s[e];if(t.isClickable()||cd.NAVIGATE_ALL_FIELDS)return cd.createFieldNode(t)}}return null}findPrevForField(){var e=this.location;const t=e.getParentInput(),i=e.getSourceBlock();if(!i)throw Error("The current AST location is not associated with a block");var s=i.inputList.indexOf(t);for(e=t.fieldRow.indexOf(e)-1;0<=s;s--){var n=i.inputList[s];if(n.connection&&n!==t)return cd.createInputNode(n);for(n=n.fieldRow;-1<e;){if(n[e].isClickable()||cd.NAVIGATE_ALL_FIELDS)return cd.createFieldNode(n[e]);e--}0<=s-1&&(e=i.inputList[s-1].fieldRow.length-1)}return null}navigateBetweenStacks(e){var t=this.getLocation();if(t.getSourceBlock){var i=t.getSourceBlock();i&&(t=i)}if(!t||t.isDeadOrDying())return null;i=t.getRootBlock(),t=i.workspace.getTopBlocks(!0);for(let s=0;s<t.length;s++)if(i.id===t[s].id)return-1===(e=s+(e?1:-1))||e===t.length?null:cd.createStackNode(t[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")}findTopASTNodeForBlock(e){const t=vo(e);return t?cd.createConnectionNode(t):cd.createBlockNode(e)}getOutAstNodeForBlock(e){if(!e)return null;e=e.getTopStackBlock();const t=vo(e);return t&&t.targetConnection&&t.targetConnection.getParentInput()?cd.createInputNode(t.targetConnection.getParentInput()):cd.createStackNode(e)}findFirstFieldOrInput(e){e=e.inputList;for(let t=0;t<e.length;t++){const i=e[t],s=i.fieldRow;for(let e=0;e<s.length;e++){const t=s[e];if(t.isClickable()||cd.NAVIGATE_ALL_FIELDS)return cd.createFieldNode(t)}if(i.connection)return cd.createInputNode(i)}return null}getSourceBlock(){return this.getType()===cd.types.BLOCK||this.getType()===cd.types.STACK?this.getLocation():this.getType()===cd.types.WORKSPACE?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case cd.types.STACK:return this.navigateBetweenStacks(!0);case cd.types.OUTPUT:return cd.createBlockNode(this.location.getSourceBlock());case cd.types.FIELD:return this.findNextForField();case cd.types.INPUT:return this.findNextForInput();case cd.types.BLOCK:const e=this.location.nextConnection;if(!e)break;return cd.createConnectionNode(e);case cd.types.PREVIOUS:return cd.createBlockNode(this.location.getSourceBlock());case cd.types.NEXT:return cd.createConnectionNode(this.location.targetConnection)}return null}in(){switch(this.type){case cd.types.WORKSPACE:const e=this.location.getTopBlocks(!0);if(0<e.length)return cd.createStackNode(e[0]);break;case cd.types.STACK:return this.findTopASTNodeForBlock(this.location);case cd.types.BLOCK:return this.findFirstFieldOrInput(this.location);case cd.types.INPUT:return cd.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case cd.types.STACK:return this.navigateBetweenStacks(!1);case cd.types.FIELD:return this.findPrevForField();case cd.types.INPUT:return this.findPrevForInput();case cd.types.BLOCK:var e=vo(this.location);if(!e)break;return cd.createConnectionNode(e);case cd.types.PREVIOUS:if((e=this.location.targetConnection)&&!e.getParentInput())return cd.createConnectionNode(e);break;case cd.types.NEXT:return cd.createBlockNode(this.location.getSourceBlock())}return null}out(){switch(this.type){case cd.types.STACK:var e=this.location,t=e.getRelativeToSurfaceXY();return t=new el(t.x,t.y+cd.DEFAULT_OFFSET_Y),cd.createWorkspaceNode(e.workspace,t);case cd.types.OUTPUT:return(t=(e=this.location).targetConnection)?cd.createConnectionNode(t):cd.createStackNode(e.getSourceBlock());case cd.types.FIELD:if(!(e=this.location.getSourceBlock()))throw Error("The current AST location is not associated with a block");return cd.createBlockNode(e);case cd.types.INPUT:return cd.createBlockNode(this.location.getSourceBlock());case cd.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case cd.types.PREVIOUS:case cd.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(e){switch(e){case cd.types.PREVIOUS:case cd.types.NEXT:case cd.types.INPUT:case cd.types.OUTPUT:return!0}return!1}static createFieldNode(e){return e?new cd(cd.types.FIELD,e):null}static createConnectionNode(e){if(!e)return null;const t=e.type;return t===Ac.INPUT_VALUE||t===Ac.NEXT_STATEMENT&&e.getParentInput()?cd.createInputNode(e.getParentInput()):t===Ac.NEXT_STATEMENT?new cd(cd.types.NEXT,e):t===Ac.OUTPUT_VALUE?new cd(cd.types.OUTPUT,e):t===Ac.PREVIOUS_STATEMENT?new cd(cd.types.PREVIOUS,e):null}static createInputNode(e){return e&&e.connection?new cd(cd.types.INPUT,e.connection):null}static createBlockNode(e){return e?new cd(cd.types.BLOCK,e):null}static createStackNode(e){return e?new cd(cd.types.STACK,e):null}static createWorkspaceNode(e,t){return t&&e?new cd(cd.types.WORKSPACE,e,{wsCoordinate:t}):null}static createTopNode(e){const t=vo(e);return t?cd.createConnectionNode(t):cd.createBlockNode(e)}};cd.NAVIGATE_ALL_FIELDS=!1,cd.DEFAULT_OFFSET_Y=-20,function(e){(e=e.types||(e.types={})).FIELD="field",e.BLOCK="block",e.INPUT="input",e.OUTPUT="output",e.NEXT="next",e.PREVIOUS="previous",e.STACK="stack",e.WORKSPACE="workspace"}(cd||(cd={}));var ud=class extends ba{constructor(e,t,i,s){let n=e?e.workspace.id:void 0;s&&s.getType()===cd.types.WORKSPACE&&(n=s.getLocation().id),super(n),this.type="marker_move",this.blockId=null==e?void 0:e.id,this.oldNode=i||void 0,this.newNode=s,this.isCursor=t}toJson(){const e=super.toJson();if(void 0===this.isCursor)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new ud)).isCursor=e.isCursor,t.blockId=e.blockId,t.oldNode=e.oldNode,t.newNode=e.newNode,t}};t(Ur.EVENT,"marker_move",ud);var hd=class{constructor(e,t,i){this.workspace=e,this.marker=i,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=t,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=i.colour||e}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return"cursor"===this.marker.type}createDom(){const e=this.isCursor()?"blocklyCursor":"blocklyMarker";return this.svgGroup_=se(hl.G,{class:e}),this.createDomInternal_(),this.svgGroup_}setParent_(e){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent=e}draw(e,t){if(t){this.constants_=this.workspace.getRenderer().getConstants();var i=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||i,this.applyColour_(t),this.showAtLocation_(t),this.fireMarkerEvent(e,t),void 0!==(e=this.currentMarkerSvg.childNodes[0])&&e.beginElement&&e.beginElement()}else this.hide()}showAtLocation_(e){const t=e.getLocation().type;e.getType()===cd.types.BLOCK?this.showWithBlock_(e):e.getType()===cd.types.OUTPUT?this.showWithOutput_(e):t===Ac.INPUT_VALUE?this.showWithInput_(e):t===Ac.NEXT_STATEMENT?this.showWithNext_(e):e.getType()===cd.types.PREVIOUS?this.showWithPrevious_(e):e.getType()===cd.types.FIELD?this.showWithField_(e):e.getType()===cd.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()===cd.types.STACK&&this.showWithStack_(e)}showWithBlockPrevOutput(e){const t=(e=e.getSourceBlock()).width;var i=e.height,s=.75*i;const n=this.constants_.CURSOR_BLOCK_PADDING;e.previousConnection?(i=this.constants_.shapeFor(e.previousConnection),this.positionPrevious_(t,n,s,i)):e.outputConnection?(s=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(t,i,s)):this.positionBlock_(t,n,s),this.setParent_(e),this.showCurrent_()}showWithBlock_(e){this.showWithBlockPrevOutput(e)}showWithPrevious_(e){this.showWithBlockPrevOutput(e)}showWithOutput_(e){this.showWithBlockPrevOutput(e)}showWithCoordinates_(e){var t=e.getWsCoordinate();e=t.x,t=t.y,this.workspace.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,t,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(e){const t=(e=e.getLocation()).getSize().width,i=e.getSize().height;this.positionRect_(0,0,t,i),this.setParent_(e),this.showCurrent_()}showWithInput_(e){const t=(e=e.getLocation()).getSourceBlock();this.positionInput_(e),this.setParent_(t),this.showCurrent_()}showWithNext_(e){var t=e.getLocation();e=t.getSourceBlock();let i=0;t=t.getOffsetInBlock().y;const s=e.getHeightWidth().width;this.workspace.RTL&&(i=-s),this.positionLine_(i,t,s),this.setParent_(e),this.showCurrent_()}showWithStack_(e){var t=(e=e.getLocation()).getHeightWidth();const i=t.width+this.constants_.CURSOR_STACK_PADDING;t=t.height+this.constants_.CURSOR_STACK_PADDING;const s=-this.constants_.CURSOR_STACK_PADDING/2,n=-this.constants_.CURSOR_STACK_PADDING/2;let o=s;this.workspace.RTL&&(o=-(i+s)),this.positionRect_(o,n,i,t),this.setParent_(e),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(e,t,i){if(e=so(-t,i)+ro("V",-t)+ro("H",e+2*t)+ro("V",i),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(e){const t=e.getOffsetInBlock().x,i=e.getOffsetInBlock().y;e=io(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+t+","+i+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(e,t,i){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${e}`),this.markerSvgLine_.setAttribute("y",`${t}`),this.markerSvgLine_.setAttribute("width",`${i}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(e,t,i){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");e=so(e,0)+ro("h",-(e-i.width))+ro("v",this.constants_.TAB_OFFSET_FROM_TOP)+i.pathDown+ro("V",t)+ro("H",e),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(e,t,i,s){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");e=so(-t,i)+ro("V",-t)+ro("H",this.constants_.NOTCH_OFFSET_LEFT)+s.pathLeft+ro("H",e+2*t)+ro("V",i),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(e,t,i,s){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${e}`),this.markerSvgRect_.setAttribute("y",`${t}`),this.markerSvgRect_.setAttribute("width",`${i}`),this.markerSvgRect_.setAttribute("height",`${s}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(e){e.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(e,t){const i=t.getSourceBlock();e=new(P("marker_move"))(i,this.isCursor(),e,t),w(e)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=se(hl.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=se(hl.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=se(hl.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=se(hl.PATH,{transform:""},this.markerSvg_),this.markerBlock_=se(hl.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();se(hl.ANIMATE,e,this.markerSvgLine_),se(hl.ANIMATE,e,this.markerInput_),se(hl.ANIMATE,Object.assign({},e,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(e){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",e),this.markerInput_.firstElementChild.setAttribute("values",e),this.markerBlock_.firstElementChild.setAttribute("values",e))}dispose(){this.svgGroup_&&le(this.svgGroup_)}},dd=class{constructor(e,t,i){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=i,this.style=t,this.svgRoot=e,this.svgPath=se(hl.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?ne(this.svgRoot,e):re(this.svgRoot,e))}updateHighlighted(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,i,s){if(this.connectionHighlights.has(e)){if(this.currentHighlightMatchesNew(e,t,i))return;this.removeConnectionHighlight(e)}t=se(hl.PATH,{class:"blocklyHighlightedConnectionPath",d:t,transform:`translate(${i.x}, ${i.y})`+(s?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(e,t)}currentHighlightMatchesNew(e,t,i){let s;const n=null==(s=this.connectionHighlights.get(e))?void 0:s.getAttribute("d");return e=this.highlightOffsets.get(e),n===t&&el.equals(e,i)}removeConnectionHighlight(e){const t=this.connectionHighlights.get(e);t&&(le(t),this.connectionHighlights.delete(e))}},pd=class{constructor(e,t){this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e}connect_(e){const t=Ac.INPUT_VALUE,i=this.getSourceBlock();var s=e.getSourceBlock();let n,o;if(e.isConnected()&&e.disconnectInternal(!1),this.isConnected()){const e=this.stashShadowState(),t=this.targetBlock();t.isShadow()?t.dispose(!1):(this.disconnectInternal(),n=t),this.applyShadowState(e)}$()&&(o=new(P(Dr.MOVE$$module$build$src$core$events$utils))(s)).setReason(["connect"]),Co(this,e),s.setParent(i),o&&(o.recordNew(),w(o)),n&&(e=this.type===t?n.outputConnection:n.previousConnection)&&((s=pd.getConnectionForOrphanedConnection(s,e))?e.connect(s):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===Ac.INPUT_VALUE||this.type===Ac.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const t=Dr.getGroup$$module$build$src$core$events$utils();t||Dr.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),Dr.setGroup$$module$build$src$core$events$utils(t)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(!t||!i)throw Error("Source connection not connected.");const s=Dr.getGroup$$module$build$src$core$events$utils();let n;s||Dr.setGroup$$module$build$src$core$events$utils(!0),$()&&(n=new(P(Dr.MOVE$$module$build$src$core$events$utils))(i.getSourceBlock())).setReason(["disconnect"]);const o=this.targetConnection;o&&(o.targetConnection=null),this.targetConnection=null,e&&i.getSourceBlock().setParent(null),n&&(n.recordNew(),w(n)),i.getSourceBlock().isShadow()||t.respawnShadow_(),Dr.setGroup$$module$build$src$core$events$utils(s)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){return!(this.getSourceBlock().isDeadOrDying()||(t=null==(i=e.getInput(t))?void 0:i.connection,(i=this.targetBlock())&&i!==e||!t||t.targetConnection===this||(t.isConnected()&&t.disconnect(),t.connect(this),0)));var i}targetBlock(){if(this.isConnected()){let e,t;return null!=(t=null==(e=this.targetConnection)?void 0:e.getSourceBlock())?t:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Mt(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?oi(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const t=this.sourceBlock_.inputList;for(let i=0;i<t.length;i++)if(t[i].connection===this){e=t[i];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var t="Output Connection of ";else if(e.previousConnection===this)t="Previous Connection of ";else if(e.nextConnection===this)t="Next Connection of ";else{t=null;for(let i,s=0;i=e.inputList[s];s++)if(i.connection===this){t=i;break}if(!t)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";t='Input "'+t.name+'" connection on '}return t+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,(e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.getSourceBlock().isDeadOrDying()||(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock()))):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock()))}createShadowBlock(e){var t=this.getSourceBlock();const i=this.getShadowState(),s=this.getShadowDom();if(t.isDeadOrDying()||!i&&!s)return null;if(i)return mi(i,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(s){if(t=Gt(s,t.workspace),e)if(this.type===Ac.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else{if(this.type!==Ac.NEXT_STATEMENT)throw Error("Cannot connect a shadow block to a previous/output connection");if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}return t}return null}serializeShadow(e){e&&(this.shadowDom=Mt(e),this.shadowState=oi(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===Ac.OUTPUT_VALUE)return Oo(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);const i=t.getConnectionChecker();return e&&i.canConnect(t,e,!1)?e:null}};pd.CAN_CONNECT=0,pd.REASON_SELF_CONNECTION=1,pd.REASON_WRONG_TYPE=2,pd.REASON_TARGET_NULL=3,pd.REASON_CHECKS_FAILED=4,pd.REASON_DIFFERENT_WORKSPACES=5,pd.REASON_SHADOW_PARENT=6,pd.REASON_DRAG_CHECKS_FAILED=7,pd.REASON_PREVIOUS_AND_OUTPUT=8;var gd=class{constructor(e){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,_(e),this.topBlock=e,this.workspace=e.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){Dr.disable$$module$build$src$core$events$utils(),this.hidePreview(),Dr.enable$$module$build$src$core$events$utils();var{local:e,closest:t}=this.activeCandidate;if(e.connect(t),this.topBlock.rendered){const i=e.isSuperior()?t:e,s=this.topBlock.getRootBlock();kt().then((()=>{Ms(i.getSourceBlock()),setTimeout((()=>{s.bringToFront()}),0)}))}}}update(e,t){const i=this.getCandidate(e);((this.wouldDeleteBlock=this.shouldDelete(!!i,t))||this.shouldUpdatePreviews(i,e))&&(Dr.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(i),this.maybeShowPreview(i),Dr.enable$$module$build$src$core$events$utils())}createMarkerBlock(e){var t=e.type;let i;Dr.disable$$module$build$src$core$events$utils();try{if((i=this.workspace.newBlock(t)).setInsertionMarker(!0),e.saveExtraState){var s=e.saveExtraState(!0);s&&i.loadExtraState&&i.loadExtraState(s)}else if(e.mutationToDom){const t=e.mutationToDom();t&&i.domToMutation&&i.domToMutation(t)}for(t=0;t<e.inputList.length;t++){const n=e.inputList[t];if("_TEMP_COLLAPSED_INPUT"===n.name)continue;const o=i.inputList[t];if(!o)throw Error("The insertion marker manager tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","an input"));for(s=0;s<n.fieldRow.length;s++){const e=n.fieldRow[s],t=o.fieldRow[s];if(!t)throw Error("The insertion marker manager tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","a field"));t.setValue(e.getValue())}}for(const e of i.getDescendants(!1))e.setInsertionMarker(!0);i.setCollapsed(e.isCollapsed()),i.setInputsInline(e.getInputsInline()),i.initSvg(),i.getSvgRoot().setAttribute("visibility","hidden")}finally{Dr.enable$$module$build$src$core$events$utils()}return i}initAvailableConnections(){const e=this.topBlock.getConnections_(!1),t=this.topBlock.lastConnectionInStack(!0);return t&&t!==this.topBlock.nextConnection&&(e.push(t),this.lastOnStack=t),e}shouldUpdatePreviews(e,t){if(!e)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:i,closest:s}=this.activeCandidate;if(s===e.closest&&i===e.local)return!1;const n=i.x+t.x-s.x;return t=i.y+t.y-s.y,e.radius<Math.sqrt(n*n+t*t)-Dr.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(e){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let t=this.getStartRadius(),i=null;for(let s=0;s<this.availableConnections.length;s++){const n=this.availableConnections[s],o=n.closest(t,e);o.connection&&(i={closest:o.connection,local:n,radius:o.radius},t=o.radius)}return i}getStartRadius(){return this.activeCandidate?Dr.config$$module$build$src$core$config.connectingSnapRadius:Dr.config$$module$build$src$core$config.snapRadius}shouldDelete(e,t){return!(!t||!this.workspace.getComponentManager().hasCapability(t.id,qa.Capability.DELETE_AREA))&&t.wouldDelete(this.topBlock,e)}maybeShowPreview(e){if(!this.wouldDeleteBlock&&e){var t,i=e.closest;i===(null==(t=this.activeCandidate)?void 0:t.closest)||i.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=e,this.showPreview(this.activeCandidate))}}showPreview(e){const t=this.workspace.getRenderer();switch(t.getConnectionPreviewMethod(e.closest,e.local,this.topBlock)){case gd.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(e);break;case gd.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(e);break;case gd.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(e)}t.shouldHighlightConnection(e.closest)&&e.closest.highlight()}maybeHidePreview(e){if(e){if(this.activeCandidate){const t=this.activeCandidate.local!==e.local;(this.activeCandidate.closest!==e.closest||t||this.wouldDeleteBlock)&&this.hidePreview()}}else this.hidePreview();this.activeCandidate=this.markerConnection=null}hidePreview(){let e;const t=null==(e=this.activeCandidate)?void 0:e.closest;t&&t.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(t)&&t.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(e){const{local:t,closest:i}=e;let s,n=(e=this.lastOnStack&&t===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!n)throw Error("Cannot show the insertion marker because there is no insertion marker block");try{s=n.getMatchingConnection(t.getSourceBlock(),t)}catch(i){if(e&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),n=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),n=this.firstMarker=this.createMarkerBlock(this.topBlock)),!n)throw Error("Cannot show the insertion marker because there is no insertion marker block");s=n.getMatchingConnection(t.getSourceBlock(),t)}if(!s)throw Error("Cannot show the insertion marker because there is no associated connection");if(s===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");n.queueRender(),vt(),s.connect(i);const o={x:i.x-s.x,y:i.y-s.y},r=s.getOffsetInBlock().clone(),a=s;kt().then((()=>{let e,t;null==(e=n)||e.positionNearConnection(a,o,r),null==(t=n)||t.getSvgRoot().setAttribute("visibility","visible")})),this.markerConnection=s}hideInsertionMarker(){if(this.markerConnection){var e,t=this.markerConnection,i=t.getSourceBlock(),s=i.outputConnection;if(null!=(e=i.previousConnection)&&e.targetConnection||null!=s&&s.targetConnection)i.unplug(!0);else{let e;null==(e=t.targetBlock())||e.unplug(!1)}if(t.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(t=i.getSvgRoot())&&t.setAttribute("visibility","hidden")}}showInsertionInputOutline(e){e=e.closest,this.highlightedBlock=e.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(e,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(e){if(this.fadedBlock=e.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const e=[];return this.firstMarker&&e.push(this.firstMarker),this.lastMarker&&e.push(this.lastMarker),e}disposeInsertionMarker(e){if(e){Dr.disable$$module$build$src$core$events$utils();try{e.dispose()}finally{Dr.enable$$module$build$src$core$events$utils()}}}};!function(e){(e=e.PREVIEW_TYPE||(e.PREVIEW_TYPE={}))[e.INSERTION_MARKER=0]="INSERTION_MARKER",e[e.INPUT_OUTLINE=1]="INPUT_OUTLINE",e[e.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"}(gd||(gd={}));var md=gd.PREVIEW_TYPE,fd={};fd.InsertionMarkerManager=gd,fd.PreviewType=md;var _d=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName())}refreshDom(e,t){const i=this.getConstants();i.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=i.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new ed}makeRenderInfo_(e){return new ld(this,e)}makeDrawer_(e,t){return new id(e,t)}makeMarkerDrawer(e,t){return new hd(e,this.getConstants(),t)}makePathObject(e,t){return new dd(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,i){return!!pd.getConnectionForOrphanedConnection(e,i===Ac.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}getConnectionPreviewMethod(e,t,i){return ie("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Ac.OUTPUT_VALUE||t.type===Ac.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(i,e.targetBlock(),t.type)?gd.PREVIEW_TYPE.INSERTION_MARKER:gd.PREVIEW_TYPE.REPLACEMENT_FADE:gd.PREVIEW_TYPE.INSERTION_MARKER}render(e){const t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},bd={};bd.BottomRow=Dh,bd.Connection=Mh,bd.ConstantProvider=ed,bd.Drawer=id,bd.ExternalValueInput=Ph,bd.Field=Fh,bd.Hat=Uh,bd.Icon=Hh,bd.InRowSpacer=Gh,bd.InlineInput=Vh,bd.InputConnection=Bh,bd.InputRow=Wh,bd.JaggedEdge=Yh,bd.MarkerSvg=hd,bd.Measurable=Lh,bd.NextConnection=zh,bd.OutputConnection=Xh,bd.PathObject=dd,bd.PreviousConnection=Kh,bd.RenderInfo=ld,bd.Renderer=_d,bd.RoundCorner=qh,bd.Row=$h,bd.SpacerRow=Jh,bd.SquareCorner=Zh,bd.StatementInput=jh,bd.TopRow=Qh,bd.Types=xh,bd.init=Ro,bd.register=Ao,bd.unregister=wo;var Td=class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces_=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(t&&(t=t.getClassName())&&re(e,t),(t=this.theme.getClassName())&&ne(e,t));for(let e,t=0;e=this.subscribedWorkspaces_[t];t++)e.refreshTheme();for(const[i,s]of this.componentDB)for(const n of s){e=n.element,t=n.propertyName;const s=this.theme&&this.theme.getComponentStyle(i);e.style.setProperty(t,s||"")}for(const e of this.subscribedWorkspaces_)e.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces_.push(e)}unsubscribeWorkspace(e){if(!Q(this.subscribedWorkspaces_,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,i){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:i}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(i,t||"")}unsubscribe(e){if(e)for(const[t,i]of this.componentDB){for(let t=i.length-1;0<=t;t--)i[t].element===e&&i.splice(t,1);i.length||this.componentDB.delete(t)}}dispose(){this.subscribedWorkspaces_.length=0,this.componentDB.clear()}},Ed={CATEGORY_NAME:"VARIABLE_DYNAMIC"};Ed.flyoutCategory=$o,Ed.flyoutCategoryBlocks=Do,Ed.onCreateVariableButtonClick_Colour=Lo,Ed.onCreateVariableButtonClick_Number=xo,Ed.onCreateVariableButtonClick_String=No;var yd=class{canConnect(e,t,i,s){return this.canConnectWithReason(e,t,i,s)===pd.CAN_CONNECT}canConnectWithReason(e,t,i,s){const n=this.doSafetyChecks(e,t);return n!==pd.CAN_CONNECT?n:this.doTypeChecks(e,t)?i&&!this.doDragChecks(e,t,s||0)?pd.REASON_DRAG_CHECKS_FAILED:pd.CAN_CONNECT:pd.REASON_CHECKS_FAILED}getErrorMessage(e,t,i){switch(e){case pd.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case pd.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case pd.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case pd.REASON_TARGET_NULL:return"Target connection is null.";case pd.REASON_CHECKS_FAILED:return"Connection checks failed. "+t+" expected "+t.getCheck()+", found "+i.getCheck();case pd.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case pd.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case pd.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return pd.REASON_TARGET_NULL;let i,s,n;return e.isSuperior()?(i=e.getSourceBlock(),s=t.getSourceBlock(),n=t):(s=e.getSourceBlock(),i=t.getSourceBlock(),n=e,e=t),i===s?pd.REASON_SELF_CONNECTION:n.type!==Su[e.type]?pd.REASON_WRONG_TYPE:i.workspace!==s.workspace?pd.REASON_DIFFERENT_WORKSPACES:i.isShadow()&&!s.isShadow()?pd.REASON_SHADOW_PARENT:n.type===Ac.OUTPUT_VALUE&&s.previousConnection&&s.previousConnection.isConnected()||n.type===Ac.PREVIOUS_STATEMENT&&s.outputConnection&&s.outputConnection.isConnected()?pd.REASON_PREVIOUS_AND_OUTPUT:pd.CAN_CONNECT}doTypeChecks(e,t){if(e=e.getCheck(),t=t.getCheck(),!e||!t)return!0;for(let i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return!0;return!1}doDragChecks(e,t,i){if(e.distanceFrom(t)>i||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case Ac.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case Ac.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case Ac.INPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;case Ac.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return-1===zr.indexOf(t)}canConnectToPrevious_(e,t){return!(e.targetConnection||-1!==zr.indexOf(t)||t.targetConnection&&(!(e=t.targetBlock()).isInsertionMarker()||e.getPreviousBlock()))}};t(Ur.CONNECTION_CHECKER,Fr,yd);var Id=class extends ql{constructor(e){super(e),this.type="var_delete",e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Id)).varType=e.varType,t.varName=e.varName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?t.deleteVariableById(this.varId):t.createVariable(this.varName,this.varType,this.varId)}};t(Ur.EVENT,"var_delete",Id);var kd=class extends ql{constructor(e,t){super(e),this.type="var_rename",e&&(this.oldName=e.name,this.newName=void 0===t?"":t)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new kd)).oldName=e.oldName,t.newName=e.newName,t}run(e){const t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");e?t.renameVariableById(this.varId,this.newName):t.renameVariableById(this.varId,this.oldName)}};t(Ur.EVENT,"var_rename",kd);var vd=class{constructor(e){this.workspace=e,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(;0<e.length;)this.deleteVariable(e[0]);if(0!==this.variableMap.size)throw Error("Non-empty variable map")}renameVariable(e,t){if(e.name!==t){var i=this.getVariable(t,e.type),s=this.workspace.getAllBlocks(!1),n=Dr.getGroup$$module$build$src$core$events$utils();n||Dr.setGroup$$module$build$src$core$events$utils(!0);try{i&&i.getId()!==e.getId()?this.renameVariableWithConflict_(e,t,i,s):this.renameVariableAndUses_(e,t,s)}finally{Dr.setGroup$$module$build$src$core$events$utils(n)}}}renameVariableById(e,t){const i=this.getVariableById(e);if(!i)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(i,t)}renameVariableAndUses_(e,t,i){for(w(new(P("var_rename"))(e,t)),e.name=t,t=0;t<i.length;t++)i[t].updateVarName(e)}renameVariableWithConflict_(e,t,i,s){const n=e.type;for(t!==i.name&&this.renameVariableAndUses_(i,t,s),t=0;t<s.length;t++)s[t].renameVarById(e.getId(),i.getId());w(new(P("var_delete"))(e)),Q(this.variableMap.get(n),e)}createVariable(e,t,i){var s=this.getVariable(e,t);if(s){if(i&&s.getId()!==i)throw Error('Variable "'+e+'" is already in use and its id is "'+s.getId()+'" which conflicts with the passed in id, "'+i+'".');return s}if(i&&this.getVariableById(i))throw Error('Variable id, "'+i+'", is already in use.');return s=i||S(),t=t||"",s=new Zl(this.workspace,e,t,s),(e=this.variableMap.get(t)||[]).push(s),this.variableMap.delete(t),this.variableMap.set(t,e),w(new(P(ea))(s)),s}deleteVariable(e){const t=e.getId(),i=this.variableMap.get(e.type);if(i)for(let s=0;s<i.length;s++)if(i[s].getId()===t){i.splice(s,1),w(new(P("var_delete"))(e)),0===i.length&&this.variableMap.delete(e.type);break}}deleteVariableById(e){const t=this.getVariableById(e);if(t){var i=t.name;const s=this.getVariableUsesById(e);for(let t,n=0;t=s[n];n++)if("procedures_defnoreturn"===t.type||"procedures_defreturn"===t.type)return e=String(t.getFieldValue("NAME")),i=Dr.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",i).replace("%2",e),void Ke(i);1<s.length?(i=Dr.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(s.length)).replace("%2",i),Je(i,(e=>{e&&t&&this.deleteVariableInternal(t,s)}))):this.deleteVariableInternal(t,s)}else console.warn("Can't delete non-existent variable: "+e)}deleteVariableInternal(e,t){const i=Dr.getGroup$$module$build$src$core$events$utils();i||Dr.setGroup$$module$build$src$core$events$utils(!0);try{for(let e=0;e<t.length;e++)t[e].dispose(!0);this.deleteVariable(e)}finally{Dr.setGroup$$module$build$src$core$events$utils(i)}}getVariable(e,t){if(t=this.variableMap.get(t||""))for(let i,s=0;i=t[s];s++)if(Dr.Names$$module$build$src$core$names.equals(i.name,e))return i;return null}getVariableById(e){for(const t of this.variableMap.values())for(const i of t)if(i.getId()===e)return i;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?e.slice():[]}getVariableTypes(e){const t=new Set(this.variableMap.keys());if(e&&e.getPotentialVariableMap())for(const i of e.getPotentialVariableMap().variableMap.keys())t.add(i);return t.has("")||t.add(""),Array.from(t.values())}getAllVariables(){let e=[];for(const t of this.variableMap.values())e=e.concat(t);return e}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map((e=>e.name))}getVariableUsesById(e){const t=[],i=this.workspace.getAllBlocks(!1);for(let s=0;s<i.length;s++){const n=i[s].getVarModels();if(n)for(let o=0;o<n.length;o++)n[o].getId()===e&&t.push(i[s])}return t}},Cd=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new lh,this.potentialVariableMap=null,this.id=S(),d(this),this.options=e||new Zu({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(c(Ur.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new vd(this)}dispose(){this.listeners.length=0,this.clear(),p(this)}sortObjects_(e,t){const i=Math.sin(cs(Cd.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),t=t.getRelativeToSurfaceXY(),e.y+i*e.x-(t.y+i*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!Q(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){Q(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects_.bind(this)),e.filter((function(e){return!e.isInsertionMarker()}))):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!Q(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t}getAllBlocks(e=!1){if(e){var t=this.getTopBlocks(!0);e=[];for(let i=0;i<t.length;i++)e.push(...t[i].getDescendants(!0))}else for(e=this.getTopBlocks(!1),t=0;t<e.length;t++)e.push(...e[t].getChildren(!1));return e.filter((function(e){return!e.isInsertionMarker()}))}clear(){this.isClearing=!0;try{const e=Dr.getGroup$$module$build$src$core$events$utils();for(e||Dr.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();Dr.setGroup$$module$build$src$core$events$utils(e),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){this.variableMap.renameVariableById(e,t)}createVariable(e,t,i){return this.variableMap.createVariable(e,t,i)}getVariableUsesById(e){return this.variableMap.getVariableUsesById(e)}deleteVariableById(e){this.variableMap.deleteVariableById(e)}getVariable(e,t){return this.variableMap.getVariable(e,t)}getVariableById(e){return this.variableMap.getVariableById(e)}getVariablesOfType(e){return this.variableMap.getVariablesOfType(e)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(void 0!==this.options.maxInstances[e]?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(const i in e){if(e[i]>this.remainingCapacityOfType(i))return!1;t+=e[i]}return!(t>this.remainingCapacity())}hasBlockLimits(){return 1/0!==this.options.maxBlocks||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,i=e?this.undoStack_:this.redoStack_;const s=t.pop();if(s){for(var n=[s];t.length&&s.group&&s.group===t[t.length-1].group;){const e=t.pop();e&&n.push(e)}for(t=0;t<n.length;t++)i.push(n[t]);n=x(n,e),O(!1);try{for(i=0;i<n.length;i++)n[i].run(e)}finally{O(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,L()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){Q(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let t=0;t<this.listeners.length;t++)(0,this.listeners[t])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let t;return null!=(t=this.commentDB.get(e))?t:null}allInputsFilled(e){const t=this.getTopBlocks(!1);for(let i=0;i<t.length;i++)if(!t[i].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new vd(this)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return u(e)}static getAll(){return h()}};Cd.SCAN_ANGLE=3;var Sd=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound_=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,t){if(e.length){try{var i=new globalThis.Audio}catch(e){return}for(let t=0;t<e.length;t++){const n=e[t],o=n.match(/\.(\w+)$/);if(o&&i.canPlayType("audio/"+o[1])){var s=new globalThis.Audio(n);break}}s&&this.sounds.set(t,s)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const t=e.play();if(void 0!==t?t.then(e.pause).catch((function(){})):e.pause(),Ua||Ha)break}}play(e,t){if(!this.muted){var i=this.sounds.get(e);i?(e=new Date,null!==this.lastSound_&&e.getTime()-this.lastSound_.getTime()<100||(this.lastSound_=e,(i=Ua||Fa?i:i.cloneNode()).volume=void 0===t?1:t,i.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},Od=class extends Cd{constructor(e){let t;super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.isVisible_=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.dragDeltaXY=null,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox_=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(c(Ur.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||Od.setTopLevelWorkspaceMetrics_,this.componentManager=new qa,this.connectionDBList=Rc.init(this.connectionChecker),this.audioManager=new Sd(e.parentWorkspace),this.grid=this.options.gridPattern?new zu(this.options.gridPattern,e.gridOptions):null,this.markerManager=new Xu(this),tc&&ot&&this.registerToolboxCategoryCallback("VARIABLE",ot),Ed&&$o&&this.registerToolboxCategoryCallback("VARIABLE_DYNAMIC",$o),Rh&&mo&&(this.registerToolboxCategoryCallback("PROCEDURE",mo),this.addChangeListener(_o)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new Td(this,this.options.theme||Ju),this.themeManager_.subscribeWorkspace(this),this.renderer=Ro(this.options.renderer||"geras",this.getTheme(),null!=(t=this.options.rendererOverrides)?t:void 0),this.cachedParentSvgSize=new pl(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(e){this.markerManager.setCursorSvg(e)}setMarkerSvg(e){this.markerManager.setMarkerSvg(e)}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=Ju),this.themeManager_.setTheme(e)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter((function(e){return!!e.getStyleName()}))),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);const e=new(P("theme_change"))(this.getTheme().name,this.id);w(e)}updateBlockStyles_(e){for(let t,i=0;t=e[i];i++){const e=t.getStyleName();e&&t.setStyle(e)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(e){let t=0,i=0,s=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(s=this.scale);do{const n=Oe(e);e!==this.getCanvas()&&e!==this.getBubbleCanvas()||(s=1),t+=n.x*s,i+=n.y*s,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new el(t,i)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new pl(e.width,e.height)}getOriginOffsetInPixels(){return Ae(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if(-1!==(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=null!=t?t:null),this.svgGroup_=se(hl.G,{class:"blocklyWorkspace"}),e&&(this.svgBackground_=se(hl.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"===e&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e)),e=this.createLayer(50),ne(e,"blocklyBlockCanvas"),e=this.createLayer(100),ne(e,"blocklyBubbleCanvas")}createDragLayer(e){const t=se(hl.SVG,{class:"blocklyBlockDragSurface",xmlns:nl,"xmlns:html":ol,"xmlns:xlink":rl,version:"1.1"});return e.append(t),se(hl.G,{},t)}translateLayers(e,t){let i;e=`translate(${e.x}, ${e.y}) scale(${t})`,null==(i=this.dragLayer)||i.setAttribute("transform",e);for(const[,t]of this.layers)t.setAttribute("transform",e)}moveToDragLayer(e){let t;null==(t=this.dragLayer)||t.appendChild(e.getSvgRoot())}moveOffDragLayer(e,t){this.append(e,t)}append(e,t){let i;this.layers.has(t)||this.createLayer(t),null==(i=this.layers.get(t))||i.appendChild(e.getSvgRoot())}createLayer(e){const t=this.workspace.getSvgGroup(),i=se(hl.G,{});let s=!1;const n=[...this.layers].sort(((e,t)=>e[0]-t[0]));for(const[o,r]of n)if(e<o){t.insertBefore(i,r),s=!0;break}return s||t.appendChild(i),this.layers.set(e,i),i}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(50)}getBubbleLayer(){return this.layers.get(100)}}(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(Y(this.svgGroup_,"pointerdown",this,this.onMouseDown_,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),Y(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(c(Ur.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=c(Ur.CURSOR,this.options))&&this.markerManager.setCursor(new e),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&le(this.svgGroup_),this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&le(e.parentNode)}this.resizeHandlerWrapper&&(X(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=Od.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new Ul(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}addFlyout(e){const t=new Zu({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(c(Ur.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(t):new(c(Ur.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position(),this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(qa.Capability.POSITIONABLE,!0),t=this.getMetricsManager().getUiMetrics(),i=[];for(let s,n=0;s=e[n];n++){s.position(t,i);const e=s.getBoundingRectangle();e&&i.push(e)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const e=Re();el.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations_())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){const i=this.getParentSvg();null!=e&&(this.cachedParentSvgSize.width=e,i.setAttribute("data-cached-width",`${e}`)),null!=t&&(this.cachedParentSvgSize.height=t,i.setAttribute("data-cached-height",`${t}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if("svg"===e.tagName){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if($()){var e=this.scale,t=-this.scrollY,i=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(t-this.oldTop)&&1>Math.abs(i-this.oldLeft))){var s=new(P(na))(t,i,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=t,this.oldLeft=i,w(s)}}}translate(e,t){let i,s;null==(i=this.layerManager)||i.translateLayers(new el(e,t),this.scale),null==(s=this.grid)||s.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.isVisible_=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox_&&this.toolbox_.setVisible(e),e||this.hideChaff(!0))}render(){for(var e=this.getAllBlocks(!1),t=e.length-1;0<=t;t--)e[t].queueRender();if(this.currentGesture_)for(e=this.currentGesture_.getInsertionMarkers(),t=0;t<e.length;t++)e[t].queueRender();kt().then((()=>{this.markerManager.updateMarkers()}))}highlightBlock(e,t){if(void 0===t){for(let e,t=0;e=this.highlightedBlocks[t];t++)e.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=void 0===t||t)?-1===this.highlightedBlocks.indexOf(e)&&this.highlightedBlocks.push(e):Q(this.highlightedBlocks,e),e.setHighlighted(t))}paste(e){if(ie("Blockly.WorkspaceSvg.prototype.paste","v10","v11","Blockly.clipboard.paste"),!this.rendered||!e.type&&!e.tagName)return null;this.currentGesture_&&this.currentGesture_.cancel();const t=Dr.getGroup$$module$build$src$core$events$utils();let i;t||Dr.setGroup$$module$build$src$core$events$utils(!0);try{i=e.type?this.pasteBlock_(null,e):"comment"===e.tagName.toLowerCase()?this.pasteWorkspaceComment_(e):this.pasteBlock_(e,null)}finally{Dr.setGroup$$module$build$src$core$events$utils(t)}return i}pasteBlock_(e,t){let i;Dr.disable$$module$build$src$core$events$utils();try{let s=0,n=0;if(e){let t,o;i=Gt(e,this),s=parseInt(null!=(t=e.getAttribute("x"))?t:"0"),this.RTL&&(s=-s),n=parseInt(null!=(o=e.getAttribute("y"))?o:"0")}else t&&(i=gi(t,this),s=t.x||10,this.RTL&&(s=this.getWidth()-s),n=t.y||10);if(!isNaN(s)&&!isNaN(n)){let e;do{e=!1;const t=this.getAllBlocks(!1);for(let i,o=0;i=t[o];o++){const t=i.getRelativeToSurfaceXY();if(1>=Math.abs(s-t.x)&&1>=Math.abs(n-t.y)){e=!0;break}}if(!e){const t=i.getConnections_(!1);for(let i,o=0;i=t[o];o++)if(i.closest(Dr.config$$module$build$src$core$config.snapRadius,new el(s,n)).connection){e=!0;break}}e&&(s=this.RTL?s-Dr.config$$module$build$src$core$config.snapRadius:s+Dr.config$$module$build$src$core$config.snapRadius,n+=2*Dr.config$$module$build$src$core$config.snapRadius)}while(e);i.moveTo(new el(s,n))}}finally{Dr.enable$$module$build$src$core$events$utils()}return $()&&!i.isShadow()&&w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(i)),i.select(),i}pasteWorkspaceComment_(e){let t;Dr.disable$$module$build$src$core$events$utils();try{t=rc.fromXmlRendered(e,this);let i,s,n=parseInt(null!=(i=e.getAttribute("x"))?i:"0"),o=parseInt(null!=(s=e.getAttribute("y"))?s:"0");isNaN(n)||isNaN(o)||(this.RTL&&(n=-n),t.moveBy(n+50,o+50))}finally{Dr.enable$$module$build$src$core$events$utils()}return $()&&ic.fireCreateEvent(t),t.select(),t}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()}renameVariableById(e,t){super.renameVariableById(e,t),this.refreshToolboxSelection()}deleteVariableById(e){super.deleteVariableById(e),this.refreshToolboxSelection()}createVariable(e,t,i){return e=super.createVariable(e,t,i),this.refreshToolboxSelection(),e}recordDragTargets(){const e=this.componentManager.getComponents(qa.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let t,i=0;t=e[i];i++){const e=t.getClientRect();e&&this.dragTargetAreas.push({component:t,clientRect:e})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let t,i=0;t=this.dragTargetAreas[i];i++)if(t.clientRect.contains(e.clientX,e.clientY))return t.component;return null}onMouseDown_(e){const t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){(e=J(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,this.dragDeltaXY=el.difference(t,e)}moveDrag(e){return(e=J(e,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,e.y/=this.scale,el.sum(this.dragDeltaXY,e)}isDragging(){return null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel_(e){if(Yu.inProgress())e.preventDefault(),e.stopPropagation();else{var t=this.options.zoomOptions&&this.options.zoomOptions.wheel,i=this.options.moveOptions&&this.options.moveOptions.wheel;if(t||i){var s=Z(e);if(Ga)var n=e.metaKey;t&&(e.ctrlKey||n||!i)?(s=-s.y/50,t=J(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,s)):(t=this.scrollX-s.x,i=this.scrollY-s.y,e.shiftKey&&!s.x&&(t=this.scrollX-s.y,i=this.scrollY),this.scroll(t,i)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new dl(0,0,0,0);const t=e[0].getBoundingRectangle();for(let s=1;s<e.length;s++){var i=e[s];i.isInsertionMarker&&i.isInsertionMarker()||((i=i.getBoundingRectangle()).top<t.top&&(t.top=i.top),i.bottom>t.bottom&&(t.bottom=i.bottom),i.left<t.left&&(t.left=i.left),i.right>t.right&&(t.right=i.right))}return t}cleanUp(){this.setResizesEnabled(!1),Dr.setGroup$$module$build$src$core$events$utils(!0);const e=this.getTopBlocks(!0);let t=0;for(let i,s=0;i=e[s];s++){if(!i.isMovable())continue;const e=i.getRelativeToSurfaceXY();i.moveBy(-e.x,t-e.y,["cleanup"]),i.snapToGrid(),t=i.getRelativeToSurfaceXY().y+i.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}Dr.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.options.readOnly&&!this.isFlyout){var t=tu.registry.getContextMenuOptions(tu.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(t,e),Qi(e,t,this.RTL)}}updateToolbox(e){if(e=Me(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(Fe(e)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox_.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(m(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,i){i=Math.pow(this.options.zoomOptions.scaleSpeed,i);const s=this.scale*i;if(this.scale!==s){s>this.options.zoomOptions.maxScale?i=this.options.zoomOptions.maxScale/this.scale:s<this.options.zoomOptions.minScale&&(i=this.options.zoomOptions.minScale/this.scale);var n=this.getCanvas().getCTM(),o=this.getParentSvg().createSVGPoint();o.x=e,o.y=t,e=(o=o.matrixTransform(n.inverse())).x,t=o.y,n=n.translate(e*(1-i),t*(1-i)).scale(i),this.scrollX=n.e,this.scrollY=n.f,this.setScale(s)}}zoomCenter(e){var t=this.getMetrics();let i;this.flyout?(i=t.svgWidth?t.svgWidth/2:0,t=t.svgHeight?t.svgHeight/2:0):(i=t.viewWidth/2+t.absoluteLeft,t=t.viewHeight/2+t.absoluteTop),this.zoom(i,t,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),t=e.viewWidth;e=e.viewHeight;var i=this.getBlocksBoundingBox(),s=i.right-i.left+40;if(i=i.bottom-i.top+40,s){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),i+=this.flyout.getHeight()/this.scale):(t+=this.flyout.getWidth(),s+=this.flyout.getWidth()/this.scale)),t/=s,e/=i,Dr.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(t,e)),this.scrollCenter()}finally{Dr.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){ne(this.getCanvas(),"blocklyCanvasTransitioning"),ne(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){re(this.getCanvas(),"blocklyCanvasTransitioning"),re(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),t=(e.scrollWidth-e.viewWidth)/2,i=(e.scrollHeight-e.viewHeight)/2;t=-t-e.scrollLeft,i=-i-e.scrollTop,this.scroll(t,i)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){if(this.isMovable()){var i=e?this.getBlockById(e):null;if(i){e=i.getRelativeToSurfaceXY(),i=t?{height:i.height,width:i.width}:i.getHeightWidth();var s=this.scale;t=(e.x+(this.RTL?-1:1)*i.width/2)*s,e=(e.y+i.height/2)*s,i=this.getMetrics(),this.scroll(-(t-i.viewWidth/2),-(e-i.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(e,t){this.hideChaff(!0);const i=this.getMetrics();e=Math.min(e,-i.scrollLeft),t=Math.min(t,-i.scrollTop);const s=i.scrollTop+Math.max(0,i.scrollHeight-i.viewHeight);e=Math.max(e,-(i.scrollLeft+Math.max(0,i.scrollWidth-i.viewWidth))),t=Math.max(t,-s),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+i.scrollLeft),-(t+i.scrollTop),!1),e+=i.absoluteLeft,t+=i.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){Q(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){let t;return null!=(t=this.flyoutButtonCallbacks.get(e))?t:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){const t="pointerdown"===e.type,i=this.currentGesture_;return i?t&&i.hasStarted()?(console.warn("Tried to start the same gesture twice."),i.cancel(),null):i:t?this.currentGesture_=new Yu(e,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){ln(),Gi(),Ns(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(qa.Capability.AUTOHIDEABLE,!0).forEach((t=>t.autoHide(e)))}static setTopLevelWorkspaceMetrics_(e){const t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),"number"==typeof e.y&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}},Ad={};Ad.WorkspaceSvg=Od,Ad.resizeSvgContents=Mo;var wd=class extends ba{constructor(e,t){super(t),this.type="trashcan_open",this.isOpen=e}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new wd)).isOpen=e.isOpen,t}};t(Ur.EVENT,"trashcan_open",wd);var Rd=class extends vc{constructor(e){if(super(e),this.type=Dr.DELETE$$module$build$src$core$events$utils,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Lt(e),this.ids=M(e),this.wasShadow=e.isShadow(),this.oldJson=oi(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(void 0===this.wasShadow)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=Pt(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Rd)).oldXml=Dr.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||"shadow"===t.oldXml.tagName.toLowerCase(),t.oldJson=e.oldJson,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){const t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const i=this.ids[e],s=t.getBlockById(i);s?s.dispose(!1):i===this.blockId&&console.warn("Can't delete non-existent block: "+i)}else gi(this.oldJson,t)}};t(Ur.EVENT,Dr.DELETE$$module$build$src$core$events$utils,Rd);var Nd=class{constructor(e,t,i){if(this.data=null,this.disposed=!1,this.hue_=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.outputShape_=null,this.isInsertionMarker_=this.disposing=!1,this.onchangeWrapper_=this.helpUrl=this.rendered=null,this.statementInputCount=0,this.workspace=e,this.id=i&&!e.getBlockById(i)?i:S(),e.setBlockById(this.id,this),this.xy_=new el(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,!(i=jr[t])||"object"!=typeof i)throw TypeError("Invalid block definition for type: "+t);Object.assign(this,i)}e.addTopBlock(this),e.addTypedBlock(this),new.target===Nd&&this.doInit_()}doInit_(){const e=Dr.getGroup$$module$build$src$core$events$utils();e||Dr.setGroup$$module$build$src$core$events$utils(!0);const t=A();try{"function"==typeof this.init&&(O(!1),this.init(),O(t)),$()&&w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(this))}finally{Dr.setGroup$$module$build$src$core$events$utils(e),O(t)}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)}dispose(e){this.isDeadOrDying()||(this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(e),$()&&w(new(P(Dr.DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopBlock(this),this.disposeInternal())}disposeInternal(){this.isDeadOrDying()||(this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.disposing=!0,"function"==typeof this.destroy&&this.destroy(),this.childBlocks_.forEach((e=>e.disposeInternal())),this.inputList.forEach((e=>e.dispose())),this.inputList.length=0,this.getConnections_(!0).forEach((e=>e.dispose())),this.disposed=!0)}isDeadOrDying(){return this.disposing||this.disposed}initModel(){for(const e of this.inputList)for(const t of e.fieldRow)t.initModel&&t.initModel()}unplug(e){this.outputConnection&&this.unplugFromRow_(e),this.previousConnection&&this.unplugFromStack_(e)}unplugFromRow_(e){let t,i=null;null!=(t=this.outputConnection)&&t.isConnected()&&(i=this.outputConnection.targetConnection,this.outputConnection.disconnect()),i&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow()&&(null==(e=e.targetConnection)||e.disconnect(),this.workspace.connectionChecker.canConnect(e,i,!1)?i.connect(e):null==e||e.onFailedConnect(i))}getOnlyValueConnection_(){let e=null;for(let t=0;t<this.inputList.length;t++){const i=this.inputList[t].connection;if(i&&i.type===Ac.INPUT_VALUE&&i.targetConnection){if(e)return null;e=i}}return e}unplugFromStack_(e){let t=null;var i;if(null!=(i=this.previousConnection)&&i.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),i=this.getNextBlock(),e&&i&&!i.isShadow()){let i,s;null==(e=null!=(s=null==(i=this.nextConnection)?void 0:i.targetConnection)?s:null)||e.disconnect(),t&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let t,i=0;t=this.inputList[i];i++)t.connection&&e.push(t.connection);return e}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){const i=t.targetBlock();if(!i||e&&i.isShadow())return t;t=i.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let t,i=0;t=this.inputList[i];i++)if(t.connection&&t.connection.targetBlock()===e)return t;return null}getSurroundParent(){let e,t=this;do{if(e=t,!(t=t.getParent()))return null}while(t.getNextBlock()===e);return t}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;do{t=(e=t).parentBlock_}while(t);return e}getTopStackBlock(){let e,t=this;do{e=t.getPreviousBlock()}while(e&&e.getNextBlock()===t&&(t=e));return t}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let i,s=0;i=this.inputList[s];s++)if(i.connection){var t=i.connection.targetBlock();t&&e.push(t)}return(t=this.getNextBlock())&&e.push(t),e}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),i=!!t;if(i&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!i&&e)throw Error("Block not connected to new parent.");if(i&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?Q(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const t=[this],i=this.getChildren(e);for(let s,n=0;s=i[n];n++)t.push(...s.getDescendants(e));return t}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable_}setDeletable(e){this.deletable_=e}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable_}setMovable(e){this.movable_=e}isDuplicatable(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(y(this,!0))}isShadow(){return this.isShadow_}setShadow(e){this.isShadow_=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable_}setEditable(e){this.editable_=e;for(let e,t=0;e=this.inputList[t];t++)for(let t,i=0;t=e.fieldRow[i];i++)t.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,t){const i=this.getConnections_(!0);if(e=e.getConnections_(!0),i.length!==e.length)throw Error("Connection lists did not match in length.");for(let s=0;s<e.length;s++)if(e[s]===t)return i[s];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return Zs(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(e){e=Nn(e),this.hue_=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=e,this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)}getField(e){if("string"!=typeof e)throw TypeError("Block.prototype.getField expects a string with the field name but received "+(void 0===e?"nothing":e+" of type "+typeof e)+" instead");for(let t,i=0;t=this.inputList[i];i++)for(let i,s=0;i=t.fieldRow[s];s++)if(i.name===e)return i;return null}getVars(){const e=[];for(let t,i=0;t=this.inputList[i];i++)for(let i,s=0;i=t.fieldRow[s];s++)i.referencesVariables()&&e.push(i.getValue());return e}getVarModels(){const e=[];for(let t,i=0;t=this.inputList[i];i++)for(let i,s=0;i=t.fieldRow[s];s++)if(i.referencesVariables()){const t=this.workspace.getVariableById(i.getValue());t&&e.push(t)}return e}updateVarName(e){for(let t,i=0;t=this.inputList[i];i++)for(let i,s=0;i=t.fieldRow[s];s++)i.referencesVariables()&&e.getId()===i.getValue()&&i.refreshVariableName()}renameVarById(e,t){for(let i,s=0;i=this.inputList[s];s++)for(let s,n=0;s=i.fieldRow[n];n++)s.referencesVariables()&&e===s.getValue()&&s.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){const i=this.getField(t);if(!i)throw Error('Field "'+t+'" not found.');i.setValue(e)}setPreviousStatement(e,t){if(e)void 0===t&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(Ac.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(Ac.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)void 0===t&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(Ac.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof od&&this.inputList[e]instanceof od)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof od)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof rd)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return!this.disabled}setEnabled(e){if(this.isEnabled()!==e){const t=this.disabled;this.disabled=!e,w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this,"disabled",null,t,!e))}}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(e.disabled)return!0;e=e.getSurroundParent()}return!1}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let e=2;e<t.length;e++)"("===t[e-2]&&")"===t[e]&&(t[e-2]=t[e-1],t.splice(e-1,2));let i="";return t=(t=t.reduce(((e,t)=>(e=e+("("===i||")"===t?"":" ")+t,i=t[t.length-1],e)),"")).trim()||"???",e&&t.length>e&&(t=t.substring(0,e-3)+"..."),t}toTokens(e="?"){const t=[];for(const s of this.inputList)if("_TEMP_COLLAPSED_INPUT"!=s.name){for(const e of s.fieldRow)t.push(e.getText());if(s.connection){const n=s.connection.targetBlock();if(n){var i=s.connection;let o=i.getCheck();!o&&i.targetConnection&&(o=i.targetConnection.getCheck()),(i=!!o&&(-1!==o.indexOf("Boolean")||-1!==o.indexOf("Number")))&&t.push("("),t.push(...n.toTokens(e)),i&&t.push(")")}else t.push(e)}}return t}appendValueInput(e){return this.appendInput(new Dr.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new ad(e,this))}appendDummyInput(e=""){return this.appendInput(new od(e,this))}appendEndRowInput(e=""){return this.appendInput(new rd(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=r(Ur.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var i=0;e["args"+i];){if(void 0===e["message"+i])throw Error(t+`args${i} must have a corresponding message (message${i}).`);i++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle_(e,t):this.jsonInitColour_(e,t),i=0;void 0!==e["message"+i];)this.interpolate_(e["message"+i],e["args"+i]||[],e["implicitAlign"+i]||e["lastDummyAlign"+i],t),i++;if(void 0!==e.inputsInline&&(Dr.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),Dr.enable$$module$build$src$core$events$utils()),void 0!==e.output&&this.setOutput(!0,e.output),void 0!==e.outputShape&&this.setOutputShape(e.outputShape),void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement),void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement),void 0!==e.tooltip&&(i=wn(e.tooltip),this.setTooltip(i)),void 0!==e.enableContextMenu&&(this.contextMenu=!!e.enableContextMenu),void 0!==e.suppressPrefixSuffix&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),void 0!==e.helpUrl&&(i=wn(e.helpUrl),this.setHelpUrl(i)),"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),void 0!==e.mutator&&Gn(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)Gn(e[t],this,!1)}jsonInitColour_(e,t){if("colour"in e)if(void 0===e.colour)console.warn(t+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch(i){console.warn(t+"Illegal colour value: ",e)}}}jsonInitStyle_(e,t){e=e.style;try{this.setStyle(e)}catch(i){console.warn(t+"Style does not exist: ",e)}}mixin(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){t=[];for(const i in e)void 0!==this[i]&&t.push(i);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate_(e,t,i,s){e=An(e),this.validateTokens_(e,t.length),t=this.interpolateArguments_(e,t,i),i=[];for(let n,o=0;n=t[o];o++)if(this.isInputKeyword_(n.type)){if(e=this.inputFromJson_(n,s)){for(let t,s=0;t=i[s];s++)e.appendField(t[0],t[1]);i.length=0}}else(e=this.fieldFromJson_(n))&&i.push([e,n.name])}validateTokens_(e,t){const i=[];let s=0;for(let n=0;n<e.length;n++){const o=e[n];if("number"==typeof o){if(1>o||o>t)throw Error('Block "'+this.type+'": Message index %'+o+" out of range.");if(i[o])throw Error('Block "'+this.type+'": Message index %'+o+" duplicated.");i[o]=!0,s++}}if(s!==t)throw Error('Block "'+this.type+'": Message does not reference all '+t+" arg(s).")}interpolateArguments_(e,t,i){const s=[];for(let o=0;o<e.length;o++){var n=e[o];if("number"==typeof n&&(n=t[n-1]),"string"==typeof n)if("\n"===n)n={type:"input_end_row"},i&&(n.align=i);else if(!(n=this.stringToFieldJson_(n)))continue;s.push(n)}return(e=s.length)&&!this.isInputKeyword_(s[e-1].type)&&(e={type:"input_dummy"},i&&(e.align=i),s.push(e)),s}fieldFromJson_(e){const t=Dr.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?"string"==typeof e.alt?(e=this.stringToFieldJson_(e.alt))?this.fieldFromJson_(e):null:this.fieldFromJson_(e.alt):t}inputFromJson_(e,t){var i={LEFT:Dr.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:Dr.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:Dr.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:Dr.Align$$module$build$src$core$inputs$align.CENTRE};let s;switch(e.type){case"input_value":s=this.appendValueInput(e.name);break;case"input_statement":s=this.appendStatementInput(e.name);break;case"input_dummy":s=this.appendDummyInput(e.name);break;case"input_end_row":s=this.appendEndRowInput(e.name);break;default:s=this.appendInputFromRegistry(e.type,e.name)}return s?(e.check&&s.setCheck(e.check),e.align&&(void 0===(i=i[e.align.toUpperCase()])?console.warn(t+"Illegal align value: ",e.align):s.setAlign(i)),s):null}isInputKeyword_(e){return"input_value"===e||"input_statement"===e||"input_dummy"===e||"input_end_row"===e||o(Ur.INPUT,e)}stringToFieldJson_(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,t){if(e!==t){var i=-1,s=t?-1:this.inputList.length;for(let n,o=0;n=this.inputList[o];o++)if(n.name===e){if(i=o,-1!==s)break}else if(t&&n.name===t&&(s=o,-1!==i))break;if(-1===i)throw Error('Named input "'+e+'" not found.');if(-1===s)throw Error('Reference input "'+t+'" not found.');this.moveNumberedInputBefore(i,s)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");const i=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,i)}removeInput(e,t){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t instanceof ad&&this.statementInputCount--,t.dispose(),this.inputList.splice(i,1),!0;if(t)return!1;throw Error("Input not found: "+e)}getInput(e){for(let t,i=0;t=this.inputList[i];i++)if(t.name===e)return t;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,t;return null!=(t=null==(e=this.getIcon(Sh.TYPE))?void 0:e.getText())?t:null}setCommentText(e){var t;let i;const s=null!=(i=null==(t=this.getIcon(Sh.TYPE))?void 0:t.getText())?i:null;s!==e&&(null!==e?((t=this.getIcon(Sh.TYPE))||(t=this.addIcon(new Sh(this))),Dr.disable$$module$build$src$core$events$utils(),t.setText(e),Dr.enable$$module$build$src$core$events$utils()):this.removeIcon(Sh.TYPE),w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this,"comment",null,s,e)))}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new Ah(e);return this.icons.push(e),this.icons.sort(((e,t)=>e.getWeight()-t.getWeight())),e}removeIcon(e){if(!this.hasIcon(e))return!1;let t;return null==(t=this.getIcon(e))||t.dispose(),this.icons=this.icons.filter((t=>!t.getType().equals(e))),!0}hasIcon(e){return this.icons.some((t=>t.getType().equals(e)))}getIcon(e){return e instanceof Hl?this.icons.find((t=>t.getType().equals(e))):this.icons.find((t=>t.getType().toString()===e))}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy_}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const s=new(P(Dr.MOVE$$module$build$src$core$events$utils))(this);i&&s.setReason(i),this.xy_.translate(e,t),s.recordNew(),w(s)}makeConnection_(e){return new pd(this,e)}allInputsFilled(e){if(void 0===e&&(e=!0),!e&&this.isShadow())return!1;for(let i,s=0;i=this.inputList[s];s++)if(i.connection){var t=i.connection.targetBlock();if(!t||!t.allInputsFilled(e))return!1}return!(t=this.getNextBlock())||t.allInputsFilled(e)}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};Nd.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",Nd.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD";var xd=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(e){this.drawer=e}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(e){const t=this.curNode;this.curNode=e,this.drawer&&this.drawer.draw(t,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},Ld=class extends xd{constructor(){super(),this.type="cursor"}next(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()===cd.types.NEXT||e.getType()===cd.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e}in(){var e=this.getCurNode();if(!e)return null;let t,i;return e.getType()!==cd.types.PREVIOUS&&e.getType()!==cd.types.OUTPUT||(e=e.next()),(e=null!=(i=null==(t=e)?void 0:t.in())?i:null)&&this.setCurNode(e),e}prev(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()===cd.types.NEXT||e.getType()===cd.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e}out(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()===cd.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null}};t(Ur.CURSOR,Fr,Ld);var $d=class extends Ld{constructor(){super()}next(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null}in(){return this.next()}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null}out(){return this.prev()}getNextNode_(e,t){if(!e)return null;const i=e.in()||e.next();return t(i)?i:i?this.getNextNode_(i,t):t(e=this.findSiblingOrParent(e.out()))?e:e?this.getNextNode_(e,t):null}getPreviousNode_(e,t){if(!e)return null;let i=e.prev();return t(i=i?this.getRightMostChild(i):e.out())?i:i?this.getPreviousNode_(i,t):null}validNode_(e){let t=!1;return(e=e&&e.getType())!==cd.types.OUTPUT&&e!==cd.types.INPUT&&e!==cd.types.FIELD&&e!==cd.types.NEXT&&e!==cd.types.PREVIOUS&&e!==cd.types.WORKSPACE||(t=!0),t}findSiblingOrParent(e){return e?e.next()||this.findSiblingOrParent(e.out()):null}getRightMostChild(e){if(!e.in())return e;for(e=e.in();e&&e.next();)e=e.next();return this.getRightMostChild(e)}};$d.registrationName="basicCursor",t(Ur.CURSOR,$d.registrationName,$d);var Dd=class extends $d{validNode_(e){let t=!1;const i=e&&e.getType();return e&&(e=e.getLocation(),i===cd.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(t=!0)),t}},Md=class extends pd{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[Su[t]],this.offsetInBlock=new el(0,0),this.trackedState=Md.TrackedState.WILL_TRACK}dispose(){let e,t;super.dispose(),this.trackedState===Md.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),null==(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)||t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e){if(!this.sourceBlock_.workspace.isDragging()){var t=this.sourceBlock_.getRootBlock();if(!t.isInFlyout){var i=!1;if(!t.isMovable()){if(!(t=e.getSourceBlock().getRootBlock()).isMovable())return;e=this,i=!0}var s=f()==t;s||t.addSelect();var n=e.x+Dr.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.x,o=e.y+Dr.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random())-this.y;i&&(o=-o),t.RTL&&(n=e.x-Dr.config$$module$build$src$core$config.snapRadius-Math.floor(10*Math.random())-this.x),t.moveBy(n,o,["bump"]),s||t.removeSelect()}}}moveTo(e,t){let i=!1;return this.trackedState===Md.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Md.TrackedState.TRACKED,i=!0):this.trackedState===Md.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),i=!0),this.x=e,this.y=t,i}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const t=this.targetBlock();e&&t&&(e=el.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Md.TrackedState.TRACKED||!e&&this.trackedState===Md.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Md.TrackedState.TRACKED):(this.trackedState===Md.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Md.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let t=0;t<e.length;t++){const i=e[t],s=i.getConnections_(!0);for(let e=0;e<s.length;e++)s[e].setTracking(!1);for(const e of i.getIcons())fn(e)&&e.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==Ac.INPUT_VALUE&&this.type!==Ac.NEXT_STATEMENT)return e;const t=this.targetBlock();if(t){let i;t.isCollapsed()?(i=[],t.outputConnection&&i.push(t.outputConnection),t.nextConnection&&i.push(t.nextConnection),t.previousConnection&&i.push(t.previousConnection)):i=t.getConnections_(!0);for(let t=0;t<i.length;t++)e.push(...i[t].startTrackingAll());e.length||(e=[t])}return e}onFailedConnect(e){const t=this.getSourceBlock();if(A()){const i=Dr.getGroup$$module$build$src$core$events$utils();setTimeout(function(){t.isDisposed()||t.getParent()||(Dr.setGroup$$module$build$src$core$events$utils(i),this.bumpAwayFrom(e),Dr.setGroup$$module$build$src$core$events$utils(!1))}.bind(this),Dr.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(t&&i){var s=t.getSourceBlock(),n=i.getSourceBlock();super.disconnectInternal(e),s.rendered&&s.queueRender(),n.rendered&&(n.updateDisabled(),n.queueRender(),n.getSvgRoot().style.display="block")}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock();const i=t.rendered,s=e.rendered;i&&t.updateDisabled(),s&&e.updateDisabled(),i&&s&&(this.type===Ac.NEXT_STATEMENT||this.type===Ac.PREVIOUS_STATEMENT?e.queueRender():t.queueRender()),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||((this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())}setCheck(e){return super.setCheck(e),this.sourceBlock_.rendered&&this.sourceBlock_.queueRender(),this}};!function(e){(e=e.TrackedState||(e.TrackedState={}))[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"}(Md||(Md={}));var Bd=Md.TrackedState,Pd={};Pd.RenderedConnection=Md,Pd.TrackedState=Bd;var Fd=class extends Nd{constructor(e,t,i){super(e,t,i),this.width=this.height=0,this.warningTextDb=new Map,this.warning=this.mutator=null,this.eventsInit_=this.renderIsInProgress_=this.visuallyDisabled=this.rendered=!1,this.translation="",this.bumpNeighboursPid=0,this.dragging=!1,this.relativeCoords=new el(0,0),this.workspace=e,this.svgGroup_=se(hl.G,{}),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style),(e=this.pathObject.svgPath).tooltip=this,tn(e),this.svgGroup_.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");for(let e,t=0;e=this.inputList[t];t++)e.init();for(var e of this.getIcons())e.initView(this.createIconPointerDownListener(e)),e.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()),e=this.getSvgRoot(),this.workspace.options.readOnly||this.eventsInit_||!e||Y(e,"pointerdown",this,this.onMouseDown_),this.eventsInit_=!0,e.parentNode||this.workspace.getCanvas().appendChild(e)}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()&&this.getParent())this.getParent().select();else if(f()!==this){var e=null;if(f()){e=f().id,Dr.disable$$module$build$src$core$events$utils();try{f().unselect()}finally{Dr.enable$$module$build$src$core$events$utils()}}e=new(P("selected"))(e,this.id,this.workspace.id),w(e),_(this),this.addSelect()}}unselect(){if(f()===this){var e=new(P("selected"))(this.id,null,this.workspace.id);e.workspaceId=this.workspace.id,w(e),_(null),this.removeSelect()}}setParent(e){const t=this.parentBlock_;if(e!==t){de(),super.setParent(e),pe();var i=this.getSvgRoot();if(!this.workspace.isClearing&&i){var s=this.getRelativeToSurfaceXY();e?e.getSvgRoot().appendChild(i):t&&((e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(i,e):this.workspace.getCanvas().appendChild(i),this.translate(s.x,s.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,i=0,s=this.getSvgRoot();if(s)do{const e=Oe(s);t+=e.x,i+=e.y,s=s.parentNode}while(s&&!e.hasLayer(s));return new el(t,i)}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");const s=$();let n=null;s&&(n=new(P(Dr.MOVE$$module$build$src$core$events$utils))(this),i&&n.setReason(i)),e=new el(e,t),t=this.getRelativeToSurfaceXY(),e=el.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),s&&n&&(n.recordNew(),w(n)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new el(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){const i=this.getRelativeToSurfaceXY();this.moveBy(e.x-i.x,e.y-i.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!(this.isDeadOrDying()||this.workspace.isDragging()||this.getParent()||this.isInFlyout)){var e=this.workspace.getGrid();if(e&&e.shouldSnap()){var t=e.getSpacing(),i=t/2,s=this.getRelativeToSurfaceXY();e=Math.round(Math.round((s.x-i)/t)*t+i-s.x),t=Math.round(Math.round((s.y-i)/t)*t+i-s.y),(e||t)&&this.moveBy(e,t,["snap"])}}}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY(),t=this.getHeightWidth();let i,s;return this.RTL?(i=e.x-t.width,s=e.x):(i=e.x,s=e.x+t.width),new dl(e.y,e.y+t.height,i,s)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e,t=0;e=this.inputList[t];t++)e.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed_())}updateCollapsed_(){var e=this.isCollapsed();const t="_TEMP_COLLAPSED_INPUT",i="_TEMP_COLLAPSED_FIELD";for(let i,s=0;i=this.inputList[s];s++)i.name!==t&&i.setVisible(!e);for(var s of this.getIcons())s.updateCollapsed();e?(e=this.toString(30),(s=this.getField(i))?s.setValue(e):(this.getInput(t)||this.appendDummyInput(t)).appendField(new sd(e),i)):(this.updateDisabled(),this.removeInput(t))}tab(e,t){const i=new Dd;i.setCurNode(cd.createFieldNode(e)),e=i.getCurNode(),t?i.next():i.prev(),(t=i.getCurNode())&&t!==e&&(t.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(t))}onMouseDown_(e){const t=this.workspace.getGesture(e);t&&t.handleBlockStart(e,this)}showHelp(){const e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const e=tu.registry.getContextMenuOptions(tu.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e}showContextMenu(e){const t=this.generateContextMenu();t&&t.length&&(Qi(e,t,this.RTL),Zi(this))}updateComponentLocations(e){if(this.rendered){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const t of this.getChildren(!1))t.updateComponentLocations(el.sum(e,t.relativeCoords))}}updateConnectionLocations(e){for(const t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(const t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(const t of this.inputList)for(const i of t.fieldRow)i.onLocationChange(e)}setDragging(e){(this.dragging=e)?(this.translation="",zr.push(...this.getConnections_(!0)),ne(this.svgGroup_,"blocklyDragging")):(zr.length=0,re(this.svgGroup_,"blocklyDragging"));for(let t=0;t<this.childBlocks_.length;t++)this.childBlocks_[t].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e=this.getIcons();for(let t=0;t<e.length;t++)e[t].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(e,t){this.isDeadOrDying()||(an(),ns(),t&&this.rendered&&(this.unplug(e),$s(this)),super.dispose(!!e),le(this.svgGroup_))}disposeInternal(){this.isDeadOrDying()||(super.disposeInternal(),this.rendered=!1,f()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach((e=>clearTimeout(e))),this.warningTextDb.clear(),this.getIcons().forEach((e=>e.dispose())))}checkAndDelete(){this.workspace.isFlyout||(Dr.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),Dr.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:Nc.TYPE,blockState:oi(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:y(this,!0)}}applyColour(){this.pathObject.applyColour(this);const e=this.getIcons();for(let t=0;t<e.length;t++)e[t].applyColour();for(let e,t=0;e=this.inputList[t];t++)for(let t,i=0;t=e.fieldRow[i];i++)t.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let e;null==(e=this.getNextBlock())||e.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const e of this.getChildren(!1))e.updateDisabled()}}getCommentIcon(){let e;return ie("getCommentIcon","v10","v11","getIcon"),null!=(e=this.getIcon(Sh.TYPE))?e:null}setWarningText(e,t=""){if(t)this.warningTextDb.has(t)&&(clearTimeout(this.warningTextDb.get(t)),this.warningTextDb.delete(t));else{for(var i of this.warningTextDb.values())clearTimeout(i);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(t,setTimeout((()=>{this.isDeadOrDying()||(this.warningTextDb.delete(t),this.setWarningText(e,t))}),100));else if(this.isInFlyout&&(e=null),i=this.getIcon(Oh.TYPE),e){let s=this.getSurroundParent(),n=null;for(;s;)s.isCollapsed()&&(n=s),s=s.getSurroundParent();n&&n.setWarningText(Dr.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,Fd.COLLAPSED_WARNING_ID),i?i.addMessage(e,t):this.addIcon(new Oh(this).addMessage(e,t))}else i&&(t?(i.addMessage("",t),i.getText()||this.removeIcon(Oh.TYPE)):this.removeIcon(Oh.TYPE))}setMutator(e){this.removeIcon(Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof Oh&&(this.warning=e),e instanceof Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),this.rendered&&(e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),vt(),this.bumpNeighbours()),e}createIconPointerDownListener(e){return t=>{this.isDeadOrDying()||(t=this.workspace.getGesture(t))&&t.setStartIcon(e)}}removeIcon(e){const t=super.removeIcon(e);return e.equals(Oh.TYPE)&&(this.warning=null),e.equals(Dr.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.rendered&&(this.queueRender(),vt(),this.bumpNeighbours()),t}setEnabled(e){this.isEnabled()!==e&&(super.setEnabled(e),this.rendered&&!this.getInheritedDisabled()&&this.updateDisabled())}setHighlighted(e){this.rendered&&this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const t=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,!t)throw Error("Invalid style name: "+e);this.hat=t.hat,this.pathObject.setStyle(t),this.colour_=t.colourPrimary,this.style=t,this.applyColour()}bringToFront(e=!1){let t=this;if(!t.isDeadOrDying())do{const i=t.getSvgRoot(),s=i.parentNode,n=s.childNodes;if(n[n.length-1]!==i&&s.appendChild(i),e)break;t=t.getParent()}while(t)}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setNextStatement(e,t){super.setNextStatement(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setOutput(e,t){super.setOutput(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}setInputsInline(e){super.setInputsInline(e),this.rendered&&(this.queueRender(),this.bumpNeighbours())}removeInput(e,t){return e=super.removeInput(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours()),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.rendered&&(this.queueRender(),this.bumpNeighbours())}appendInput(e){return super.appendInput(e),this.rendered&&(this.queueRender(),this.bumpNeighbours()),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var t=this.nextConnection.targetBlock();t&&t.setConnectionTracking(e)}if(!this.collapsed_)for(t=0;t<this.inputList.length;t++){var i=this.inputList[t].connection;i&&(i.setTracking(e),(i=i.targetBlock())&&i.setConnectionTracking(e))}}getConnections_(e){const t=[];if((e||this.rendered)&&(this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection),e||!this.collapsed_))for(let e,i=0;e=this.inputList[i];i++)e.connection&&t.push(e.connection);return t}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Md(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){if(!this.bumpNeighboursPid){var e=Dr.getGroup$$module$build$src$core$events$utils();this.bumpNeighboursPid=setTimeout((()=>{const t=Dr.getGroup$$module$build$src$core$events$utils();Dr.setGroup$$module$build$src$core$events$utils(e),this.getRootBlock().bumpNeighboursInternal(),Dr.setGroup$$module$build$src$core$events$utils(t),this.bumpNeighboursPid=0}),Dr.config$$module$build$src$core$config.bumpDelay)}}bumpNeighboursInternal(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const t of this.getConnections_(!1)){if(t.isSuperior()){let e;null==(e=t.targetBlock())||e.bumpNeighboursInternal()}for(const i of t.neighbours(Dr.config$$module$build$src$core$config.snapRadius))i.getSourceBlock().getRootBlock()!==e&&(t.isConnected()&&i.isConnected()||(t.isSuperior()?i.bumpAwayFrom(t):t.bumpAwayFrom(i)))}}scheduleSnapAndBump(){const e=Dr.getGroup$$module$build$src$core$events$utils();setTimeout((()=>{Dr.setGroup$$module$build$src$core$events$utils(e),this.snapToGrid(),Dr.setGroup$$module$build$src$core$events$utils(!1)}),Dr.config$$module$build$src$core$config.bumpDelay/2),this.bumpNeighbours()}positionNearConnection(e,t,i){if(e.type===Ac.NEXT_STATEMENT||e.type===Ac.INPUT_VALUE){let s=t.x;t=t.y,s+=i.x-e.getOffsetInBlock().x,t+=i.y-e.getOffsetInBlock().y,this.moveBy(s,t)}}getChildren(e){return super.getChildren(e)}queueRender(){return It(this)}render(){this.queueRender(),vt()}renderEfficiently(){this.rendered=!0,de(),this.isCollapsed()&&this.updateCollapsed_(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),pe(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const e of this.inputList){const t=e.connection;t&&t.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(Xu.LOCAL_MARKER).draw();for(const e of this.inputList)for(const t of e.fieldRow)t.updateMarkers_()}setCursorSvg(e){this.pathObject.setCursorSvg(e)}setMarkerSvg(e){this.pathObject.setMarkerSvg(e)}getHeightWidth(){let e=this.height,t=this.width;var i=this.getNextBlock();if(i){i=i.getHeightWidth();const s=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=i.height-s,t=Math.max(t,i.width)}return{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}};Fd.INLINE=-1,Fd.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var Ud,Hd=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},Gd=class extends Hd{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e,t){return e instanceof Fd?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e&&!t)):this.updateWouldDelete_(e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},Vd=class extends Gd{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=new Zu({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===Al.TOP?Al.BOTTOM:Al.TOP,this.flyout=new(c(Ur.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===Al.RIGHT?Al.LEFT:Al.RIGHT,this.flyout=new(c(Ur.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){let e;this.svgGroup=se(hl.G,{class:"blocklyTrash"});const t=String(Math.random()).substring(2);e=se(hl.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup),se(hl.RECT,{width:jd,height:Wd,y:Yd},e);const i=se(hl.IMAGE,{width:Bl,x:-qd,height:Pl,y:-Jd,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup);return i.setAttributeNS(rl,"xlink:href",this.workspace.options.pathToMedia+Fl),e=se(hl.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup),se(hl.RECT,{width:jd,height:Yd},e),this.svgLid=se(hl.IMAGE,{width:Bl,x:-qd,height:Pl,y:-Jd,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup),this.svgLid.setAttributeNS(rl,"xlink:href",this.workspace.options.pathToMedia+Fl),z(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),z(this.svgGroup,"pointerup",this,this.click),z(i,"pointerover",this,this.mouseOver),z(i,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(ce(this.flyout.createDom(hl.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[qa.Capability.AUTOHIDEABLE,qa.Capability.DELETE_AREA,qa.Capability.DRAG_TARGET,qa.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&le(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map((function(e){return JSON.parse(e)})),t=this.workspace.getParentSvg().style;t.cursor="wait",setTimeout((()=>{let i,s;null==(i=this.flyout)||i.show(e),t.cursor="",null==(s=this.workspace.scrollbar)||s.setVisible(!1)}),10),this.fireUiEvent(!0)}}closeFlyout(){var e,t;this.contentsIsOpen()&&(null==(e=this.flyout)||e.hide(),null==(t=this.workspace.scrollbar)||t.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){if(this.initialized){var i,s=ze(this.workspace,e);e=Ye(s,new pl(jd,Wd+Yd),Xd,zd,e,this.workspace),t=Xe(e,zd,s.vertical===Nl.TOP?Ll.DOWN:Ll.UP,t),this.top=t.top,this.left=t.left,null==(i=this.svgGroup)||i.setAttribute("transform","translate("+this.left+","+this.top+")")}}getBoundingRectangle(){return new dl(this.top,this.top+Wd+Yd,this.left,this.left+jd)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const t=e.top+Jd-Kd;return e=e.left+qd-Kd,new dl(t,t+Yd+Wd+2*Kd,e,e+jd+2*Kd)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=ep;var t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*sp),t=tp+this.lidOpen*(ip-tp),this.svgGroup&&(this.svgGroup.style.opacity=`${t}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),Qd/e))}setLidAngle(e){const t=this.workspace.toolboxPosition===Al.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let i;null==(i=this.svgLid)||i.setAttribute("transform","rotate("+(t?-e:e)+","+(t?4:jd-4)+","+(Yd-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*sp)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(P("trashcan_open"))(e,this.workspace.id),w(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||e.type!==Dr.DELETE$$module$build$src$core$events$utils||e.type!==Dr.DELETE$$module$build$src$core$events$utils||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),-1===this.contents.indexOf(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(Zd)}}}cleanBlockJson(e){return function e(t){if(t){if(delete t.id,delete t.x,delete t.y,delete t.enabled,t.icons&&t.icons.comment){var i=t.icons.comment;delete i.height,delete i.width,delete i.pinned}for(var s in i=t.inputs){var n=i[s];const t=n.block;n=n.shadow,t&&e(t),n&&e(n)}t.next&&(t=(s=t.next).block,s=s.shadow,t&&e(t),s&&e(s))}}(e=JSON.parse(JSON.stringify(e))),Object.assign({},{kind:"BLOCK"},e)}},jd=47,Wd=44,Yd=16,zd=20,Xd=20,Kd=10,qd=0,Jd=32,Zd=.1,Qd=80,ep=4,tp=.4,ip=.8,sp=45,np=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),(t=e.keyCodes)&&0<t.length)for(let i=0;i<t.length;i++)this.addKeyMapping(t[i],e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,i){e=`${e}`;const s=this.keyMap.get(e);if(s&&!i)throw Error(`Shortcut named "${t}" collides with shortcuts "${s}"`);s&&i?s.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,i){const s=this.keyMap.get(e);if(!s)return i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1;const n=s.indexOf(t);return-1<n?(s.splice(n,1),0===s.length&&this.keyMap.delete(e),!0):(i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){this.keyMap.clear();for(const t in e)this.keyMap.set(t,e[t])}getKeyMap(){const e=Object.create(null);for(const[t,i]of this.keyMap)e[t]=i;return e}getRegistry(){const e=Object.create(null);for(const[t,i]of this.shortcuts)e[t]=i;return mn(Object.create(null),e)}onKeyDown(e,t){var i=this.serializeKeyEvent_(t);if(!(i=this.getShortcutNamesByKeyCode(i)))return!1;for(let s,n=0;s=i[n];n++){const i=this.shortcuts.get(s);let n,o;if(null==(n=i)||!n.preconditionFn||null!=(o=i)&&o.preconditionFn(e)){let s,n;if(null!=(s=i)&&s.callback&&null!=(n=i)&&n.callback(e,t,i))return!0}}return!1}getShortcutNamesByKeyCode(e){return this.keyMap.get(e)||[]}getKeyCodesByShortcutName(e){const t=[];for(const[i,s]of this.keyMap)-1<s.indexOf(e)&&t.push(i);return t}serializeKeyEvent_(e){let t="";for(const i in np.modifierKeys)e.getModifierState(i)&&(""!==t&&(t+="+"),t+=i);return""!==t&&e.keyCode?t=t+"+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers_(e){for(let t,i=0;t=e[i];i++)if(!(t in np.modifierKeys))throw Error(t+" is not a valid modifier key.")}createSerializedKey(e,t){let i="";if(t){this.checkModifiers_(t);for(const e in np.modifierKeys)-1<t.indexOf(np.modifierKeys[e])&&(""!==i&&(i+="+"),i+=e)}return""!==i&&e?i=i+"+"+e:e&&(i=`${e}`),i}};np.registry=new np,function(e){(e=e.modifierKeys||(e.modifierKeys={}))[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(np||(np={})),function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"}(Ud||(Ud={}));var op=null,rp=null;Wo();var ap={};ap.names=Ud,ap.registerCopy=Uo,ap.registerCut=Ho,ap.registerDefaultShortcuts=Wo,ap.registerDelete=Fo,ap.registerEscape=Po,ap.registerPaste=Go,ap.registerRedo=jo,ap.registerUndo=Vo;var lp={ProcedureSerializer:class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=75}save(e){return(e=e.getProcedureMap().getProcedures().map((e=>Yo(e)))).length?e:null}load(e,t){const i=t.getProcedureMap();for(const s of e)i.add(Xo(this.procedureModelClass,this.parameterModelClass,s,t))}clear(e){e.getProcedureMap().clear()}}};lp.loadParameter=Ko,lp.loadProcedure=Xo,lp.saveParameter=zo,lp.saveProcedure=Yo;var cp=class{constructor(){this.priority=100}save(e){const t=[];for(const i of e.getAllVariables())e={name:i.name,id:i.getId()},i.type&&(e.type=i.type),t.push(e);return t.length?t:null}load(e,t){for(const i of e)t.createVariable(i.name,i.type,i.id)}clear(e){e.getVariableMap().clear()}};si("variables",new cp);var up={};up.VariableSerializer=cp;var hp={};hp.load=Jo,hp.save=qo;var dp={blocks:kc,exceptions:Ec,priorities:{BLOCKS:50,PROCEDURES:75,VARIABLES:100},procedures:lp,registry:yc,variables:up,workspaces:hp},pp=class{constructor(e,t,i,s,n){this.workspace=e,this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null,i=void 0===i||i;const o=(t=void 0===t||t)&&i;t&&(this.hScroll=new Tl(e,!0,o,s,n)),i&&(this.vScroll=new Tl(e,!1,o,s,n)),o&&(this.corner_=se(hl.RECT,{height:Tl.scrollbarThickness,width:Tl.scrollbarThickness,class:"blocklyScrollbarBackground"}),ce(this.corner_,e.getBubbleCanvas()))}dispose(){le(this.corner_),this.oldHostMetrics_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var t=!1,i=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===e.viewWidth&&this.oldHostMetrics_.viewHeight===e.viewHeight&&this.oldHostMetrics_.absoluteTop===e.absoluteTop&&this.oldHostMetrics_.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===e.scrollWidth&&this.oldHostMetrics_.viewLeft===e.viewLeft&&this.oldHostMetrics_.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===e.scrollHeight&&this.oldHostMetrics_.viewTop===e.viewTop&&this.oldHostMetrics_.scrollTop===e.scrollTop||(i=!0)):i=t=!0,t||i){try{Dr.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&i&&this.vScroll.resize(e)}finally{Dr.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==e.viewWidth||this.oldHostMetrics_.absoluteLeft!==e.absoluteLeft){let e;null==(e=this.corner_)||e.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!==e.viewHeight||this.oldHostMetrics_.absoluteTop!==e.absoluteTop){let e;null==(e=this.corner_)||e.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics_=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,i){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),(i||void 0===i)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},gp=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,i=0;return e&&(t=e.getWidth(),i=e.getHeight()),new pl(t,i)}getFlyoutMetrics(e){return{width:(e=this.getDimensionsPx_(this.workspace_.getFlyout(e))).width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;const i=this.getToolboxMetrics(),s=this.getFlyoutMetrics(),n=!!this.workspace_.getToolbox();var o;const r=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=n?i.position:s.position)===Al.TOP;return o===Al.LEFT&&(n&&(e+=i.width),r&&(e+=s.width)),a&&(n&&(t+=i.height),r&&(t+=s.height)),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const t=this.getSvgMetrics(),i=this.getToolboxMetrics(),s=this.getFlyoutMetrics(),n=!!this.workspace_.getToolbox();var o;const r=!(null!=(o=this.workspace_.getFlyout())&&o.autoClose),a=(o=n?i.position:s.position)===Al.LEFT||o===Al.RIGHT;return o!==Al.TOP&&o!==Al.BOTTOM||(n&&(t.height-=i.height),r&&(t.height-=s.height)),a&&(n&&(t.width-=i.width),r&&(t.width-=s.width)),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const t=this.workspace_.isMovableHorizontally(),i=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const s={};return i||(s.top=e.top,s.bottom=e.top+e.height),t||(s.left=e.left,s.right=e.left+e.width),s}getPaddedContent_(e,t){const i=t.top+t.height,s=t.left+t.width,n=e.width,o=n/2,r=(e=e.height)/2;return{top:Math.min(t.top-r,i-e),bottom:Math.max(i+r,t.top+e),left:Math.min(t.left-o,s-n),right:Math.max(s+o,t.left+n)}}getScrollMetrics(e,t,i){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var s=i||this.getContentMetrics();i=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,s),s=void 0!==i.top?i.top:t.top;const n=void 0!==i.left?i.left:t.left;return{top:s/e,left:n/e,width:((void 0!==i.right?i.right:t.right)-n)/e,height:((void 0!==i.bottom?i.bottom:t.bottom)-s)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),i=this.getSvgMetrics(),s=this.getAbsoluteMetrics(),n=this.getViewMetrics(),o=this.getContentMetrics(),r=this.getScrollMetrics(!1,n,o);return{contentHeight:o.height,contentWidth:o.width,contentTop:o.top,contentLeft:o.left,scrollHeight:r.height,scrollWidth:r.width,scrollTop:r.top,scrollLeft:r.left,viewHeight:n.height,viewWidth:n.width,viewTop:n.top,viewLeft:n.left,absoluteTop:s.top,absoluteLeft:s.left,svgHeight:i.height,svgWidth:i.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}};t(Ur.METRICS_MANAGER,Fr,gp);var mp=class extends _a{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=aa,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};t(Ur.EVENT,aa,mp);var fp=class extends ba{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type="drag",e&&(this.blockId=e.id,this.isStart=t,this.blocks=i)}toJson(){const e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new fp)).isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}};t(Ur.EVENT,"drag",fp);var _p={};_p.bumpIntoBounds=Zo,_p.bumpIntoBoundsHandler=Qo,_p.bumpTopObjectsIntoBounds=tr;var bp=class{constructor(e,t){this.connectionCandidate=this.dragTarget_=null,this.wouldDeleteBlock_=!1,this.dragIconData_=[],this.draggingBlock_=e,this.workspace_=t,this.connectionPreviewer=new(c(Ur.CONNECTION_PREVIEWER,this.workspace_.options))(e),this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY(),this.dragIconData_=ir(e,this.startXY_)}dispose(){this.dragIconData_.length=0,this.connectionPreviewer.dispose()}startDrag(e,t){let i;Dr.getGroup$$module$build$src$core$events$utils()||Dr.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent_(),this.draggingBlock_.bringToFront(!0),de(),this.workspace_.setResizesEnabled(!1),Fs(),this.shouldDisconnect_(t)&&this.disconnectBlock_(t,e),this.draggingBlock_.setDragging(!0),null==(i=this.workspace_.getLayerManager())||i.moveToDragLayer(this.draggingBlock_)}shouldDisconnect_(e){return!!(this.draggingBlock_.getParent()||e&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())}disconnectBlock_(e,t){this.draggingBlock_.unplug(e),e=this.pixelsToWorkspaceUnits_(t),e=el.sum(this.startXY_,e),this.draggingBlock_.translate(e.x,e.y),Bs(this.draggingBlock_)}fireDragStartEvent_(){const e=new(P("drag"))(this.draggingBlock_,!0,this.draggingBlock_.getDescendants(!1));w(e)}drag(e,t){const i=this.draggingBlock_;this.moveBlock(i,t),this.updateDragTargets(e,i),this.wouldDeleteBlock_=this.wouldDeleteBlock(e,i,t),this.updateCursorDuringBlockDrag_(),this.updateConnectionPreview(i,t)}moveBlock(e,t){t=this.pixelsToWorkspaceUnits_(t),t=el.sum(this.startXY_,t),e.moveDuringDrag(t)}updateDragTargets(e,t){if(e=this.workspace_.getDragTarget(e),this.dragTarget_!==e){let i;null==(i=this.dragTarget_)||i.onDragExit(t),null==e||e.onDragEnter(t)}null==e||e.onDragOver(t),this.dragTarget_=e}wouldDeleteBlock(e,t,i){return!(!(e=this.workspace_.getDragTarget(e))||!this.workspace_.getComponentManager().hasCapability(e.id,qa.Capability.DELETE_AREA))&&e.wouldDelete(t,!!this.getConnectionCandidate(t,i))}updateConnectionPreview(e,t){const i=this.connectionCandidate,s=this.getConnectionCandidate(e,t);if(s){this.connectionCandidate=t=i&&this.currCandidateIsBetter(i,t,s)?i:s;var{local:n,neighbour:o}=t;n.type!==Ac.OUTPUT_VALUE&&n.type!==Ac.PREVIOUS_STATEMENT||!o.isConnected()||o.targetBlock().isInsertionMarker()||this.orphanCanConnectAtEnd(e,o.targetBlock(),n.type)?this.connectionPreviewer.previewConnection(n,o):this.connectionPreviewer.previewReplacement(n,o,o.targetBlock())}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(e,t,i){return!!pd.getConnectionForOrphanedConnection(e,i===Ac.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,i){const{local:s,neighbour:n}=e;e=new el(s.x,s.y);const o=new el(n.x,n.y);return t=el.distance(el.sum(e,t),o),i.distance>t-Dr.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let i=Dr.config$$module$build$src$core$config.snapRadius,s=null;for(const n of e){const{connection:e,radius:o}=n.closest(i,t);e&&(s={local:n,neighbour:e,distance:o},i=o)}return s}getLocalConnections(e){const t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e,t){if(this.drag(e,t),this.fireDragEndEvent_(),pe(),Fs(),this.connectionPreviewer.hidePreview(),e=null,this.dragTarget_&&this.dragTarget_.shouldPreventMove(this.draggingBlock_)||(e=this.getNewLocationAfterDrag_(t).delta),this.dragTarget_&&this.dragTarget_.onDrop(this.draggingBlock_),!this.maybeDeleteBlock_()){let t;null==(t=this.workspace_.getLayerManager())||t.moveOffDragLayer(this.draggingBlock_,50),this.draggingBlock_.setDragging(!1),e?this.updateBlockAfterMove_():Zo(this.draggingBlock_.workspace,this.workspace_.getMetricsManager().getScrollMetrics(!0),this.draggingBlock_)}this.connectionPreviewer.dispose(),this.workspace_.setResizesEnabled(!0),Dr.setGroup$$module$build$src$core$events$utils(!1)}getNewLocationAfterDrag_(e){return{delta:e=this.pixelsToWorkspaceUnits_(e),newLocation:el.sum(this.startXY_,e)}}maybeDeleteBlock_(){return!!this.wouldDeleteBlock_&&(this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0),zr.length=0,!0)}updateBlockAfterMove_(){this.fireMoveEvent_(),this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.draggingBlock_.queueRender(),this.draggingBlock_.scheduleSnapAndBump()}applyConnections(e){const{local:t,neighbour:i}=e;if(t.connect(i),this.draggingBlock_.rendered){const e=t.isSuperior()?i:t,s=this.draggingBlock_.getRootBlock();kt().then((()=>{Ms(e.getSourceBlock()),setTimeout((()=>{s.bringToFront()}),0)}))}}fireDragEndEvent_(){const e=new(P("drag"))(this.draggingBlock_,!1,this.draggingBlock_.getDescendants(!1));w(e)}updateToolboxStyle_(e){const t=this.workspace_.getToolbox();if(t){const i=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";e&&"function"==typeof t.removeStyle?t.removeStyle(i):e||"function"!=typeof t.addStyle||t.addStyle(i)}}fireMoveEvent_(){if(!this.draggingBlock_.isDeadOrDying()){var e=new(P(Dr.MOVE$$module$build$src$core$events$utils))(this.draggingBlock_);e.setReason(["drag"]),e.oldCoordinate=this.startXY_,e.recordNew(),w(e)}}updateCursorDuringBlockDrag_(){this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_)}pixelsToWorkspaceUnits_(e){return e=new el(e.x/this.workspace_.scale,e.y/this.workspace_.scale),this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale),e}dragIcons_(){ie("Blockly.BlockDragger.prototype.dragIcons_","v10","v11")}getInsertionMarkers(){return this.workspace_.getAllBlocks().filter((e=>e.isInsertionMarker()))}};t(Ur.BLOCK_DRAGGER,Fr,bp);var Tp={};Tp.Bubble=mh,Tp.MiniWorkspaceBubble=fh,Tp.TextBubble=vh,Tp.TextInputBubble=Ch;var Ep=class extends vc{constructor(e,t,i,s){super(e),this.type=Qr,this.recordUndo=!1,e&&(this.name=t,this.oldValue=i,this.newValue=s)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ep)).name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};t(Ur.EVENT,Qr,Ep);var yp=class extends vc{constructor(e){super(e),this.type=Dr.MOVE$$module$build$src$core$events$utils,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new yp)).oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(i=e.oldCoordinate.split(","),t.oldCoordinate=new el(Number(i[0]),Number(i[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(i=e.newCoordinate.split(","),t.newCoordinate=new el(Number(i[0]),Number(i[1]))),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}recordNew(){const e=this.currentLocation_();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation_(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t=e.getBlockById(this.blockId);if(!t)throw Error("The block associated with the block move event could not be found");e={};const i=t.getParent();return i?(e.parentId=i.id,(t=i.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&el.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var i=t.getBlockById(this.blockId);if(i){var s=e?this.newParentId:this.oldParentId,n=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,s){var o=t.getBlockById(s);if(!o)return void console.warn("Can't connect to non-existent block: "+s)}if(i.getParent()&&i.unplug(),e)n=i.getRelativeToSurfaceXY(),i.moveBy(e.x-n.x,e.y-n.y,this.reason);else{let e,s;(!(t=i.outputConnection)||i.previousConnection&&i.previousConnection.isConnected())&&(t=i.previousConnection),i=null==(s=t)?void 0:s.type,n?(i=o.getInput(n))&&(e=i.connection):i===Ac.PREVIOUS_STATEMENT&&(e=o.nextConnection),e&&t?t.connect(e):console.warn("Can't connect to non-existent input: "+n)}}else console.warn("Can't move non-existent block: "+this.blockId)}};t(Ur.EVENT,Dr.MOVE$$module$build$src$core$events$utils,yp);var Ip,kp=class extends ba{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=sa,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=i)}toJson(){const e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new kp)).isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}};!function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"}(Ip||(Ip={})),t(Ur.EVENT,sa,kp);var vp={};vp.BubbleOpen=kp,vp.BubbleType=Ip;var Cp=class extends _a{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=Dr.getGroup$$module$build$src$core$events$utils(),this.recordUndo=A())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Cp)).commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){var i=e.getEventWorkspace_();if(t){if(t=Dr.createElement$$module$build$src$core$utils$xml("xml"),!e.xml)throw Error("Ecountered a comment event without proper xml");t.appendChild(e.xml),Dr.domToWorkspace$$module$build$src$core$xml(t,i)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(i=i.getCommentById(e.commentId))?i.dispose():console.warn("Can't uncreate non-existent comment: "+e.commentId)}}},Sp=class extends Cp{constructor(e,t,i){super(e),this.type="comment_change",e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===i?"":i)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Sp)).oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var i=e?this.newContents_:this.oldContents_;if(!i){if(e)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson")}t.setContent(i)}else console.warn("Can't change non-existent comment: "+this.commentId)}};t(Ur.EVENT,"comment_change",Sp);var Op=class extends Cp{constructor(e){super(e),this.type=oa,e&&(this.xml=e.toXmlWithXY())}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");return e.xml=Pt(this.xml),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Op)).xml=Dr.textToDom$$module$build$src$core$utils$xml(e.xml),t}run(e){Cp.CommentCreateDeleteHelper(this,e)}};t(Ur.EVENT,oa,Op);var Ap=class extends Cp{constructor(e){super(e),this.type="comment_delete",e&&(this.xml=e.toXmlWithXY())}run(e){Cp.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");return e.xml=Pt(this.xml),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ap)).xml=Dr.textToDom$$module$build$src$core$utils$xml(e.xml),t}};t(Ur.EVENT,"comment_delete",Ap);var wp=class extends Cp{constructor(e){super(e),this.type=ra,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,t,i){return t=super.fromJson(e,t,null!=i?i:new wp),i=e.oldCoordinate.split(","),t.oldCoordinate_=new el(Number(i[0]),Number(i[1])),i=e.newCoordinate.split(","),t.newCoordinate_=new el(Number(i[0]),Number(i[1])),t}isNull(){return el.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newCoordinate_:this.oldCoordinate_))throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");var i=t.getRelativeToSurfaceXY();t.moveBy(e.x-i.x,e.y-i.y)}else console.warn("Can't move non-existent comment: "+this.commentId)}};t(Ur.EVENT,ra,wp);var Rp=class extends ba{constructor(e,t,i){super(i),this.type="toolbox_item_select",this.oldItem=null!=e?e:void 0,this.newItem=null!=t?t:void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Rp)).oldItem=e.oldItem,t.newItem=e.newItem,t}};t(Ur.EVENT,"toolbox_item_select",Rp),Dr.CHANGE$$module$build$src$core$events$utils,Dr.CREATE$$module$build$src$core$events$utils,Dr.DELETE$$module$build$src$core$events$utils,Dr.MOVE$$module$build$src$core$events$utils,Dr.CHANGE$$module$build$src$core$events$utils,Dr.CREATE$$module$build$src$core$events$utils,Dr.DELETE$$module$build$src$core$events$utils,Dr.MOVE$$module$build$src$core$events$utils,Dr.disable$$module$build$src$core$events$utils,Dr.enable$$module$build$src$core$events$utils,Dr.getGroup$$module$build$src$core$events$utils,Dr.setGroup$$module$build$src$core$events$utils;var Np={};Np.Abstract=_a,Np.BLOCK_CHANGE=Dr.CHANGE$$module$build$src$core$events$utils,Np.BLOCK_CREATE=Dr.CREATE$$module$build$src$core$events$utils,Np.BLOCK_DELETE=Dr.DELETE$$module$build$src$core$events$utils,Np.BLOCK_DRAG="drag",Np.BLOCK_FIELD_INTERMEDIATE_CHANGE=Qr,Np.BLOCK_MOVE=Dr.MOVE$$module$build$src$core$events$utils,Np.BUBBLE_OPEN=sa,Np.BUMP_EVENTS=la,Np.BlockBase=vc,Np.BlockChange=Qu,Np.BlockCreate=Cc,Np.BlockDelete=Rd,Np.BlockDrag=fp,Np.BlockFieldIntermediateChange=Ep,Np.BlockMove=yp,Np.BubbleOpen=kp,Np.BubbleType=Ip,Np.CHANGE=Dr.CHANGE$$module$build$src$core$events$utils,Np.CLICK=ia,Np.COMMENT_CHANGE="comment_change",Np.COMMENT_CREATE=oa,Np.COMMENT_DELETE="comment_delete",Np.COMMENT_MOVE=ra,Np.CREATE=Dr.CREATE$$module$build$src$core$events$utils,Np.Click=Ta,Np.ClickTarget=ma,Np.CommentBase=Cp,Np.CommentChange=Sp,Np.CommentCreate=Op,Np.CommentDelete=Ap,Np.CommentMove=wp,Np.DELETE=Dr.DELETE$$module$build$src$core$events$utils,Np.FINISHED_LOADING=aa,Np.FinishedLoading=mp,Np.MARKER_MOVE="marker_move",Np.MOVE=Dr.MOVE$$module$build$src$core$events$utils,Np.MarkerMove=ud,Np.SELECTED="selected",Np.Selected=sc,Np.THEME_CHANGE="theme_change",Np.TOOLBOX_ITEM_SELECT="toolbox_item_select",Np.TRASHCAN_OPEN="trashcan_open",Np.ThemeChange=Oc,Np.ToolboxItemSelect=Rp,Np.TrashcanOpen=wd,Np.UI=ta,Np.UiBase=ba,Np.VAR_CREATE=ea,Np.VAR_DELETE="var_delete",Np.VAR_RENAME="var_rename",Np.VIEWPORT_CHANGE=na,Np.VarBase=ql,Np.VarCreate=Jl,Np.VarDelete=Id,Np.VarRename=kd,Np.ViewportChange=wc,Np.clearPendingUndo=L,Np.disable=Dr.disable$$module$build$src$core$events$utils,Np.disableOrphans=F,Np.enable=Dr.enable$$module$build$src$core$events$utils,Np.filter=x,Np.fire=w,Np.fromJson=B,Np.get=P,Np.getDescendantIds=M,Np.getGroup=Dr.getGroup$$module$build$src$core$events$utils,Np.getRecordUndo=A,Np.isEnabled=$,Np.setGroup=Dr.setGroup$$module$build$src$core$events$utils,Np.setRecordUndo=O;var xp=class extends ed{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&le(this.selectedGlowFilter),this.replacementGlowFilter&&le(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:e,width:t,path:to("c",[eo(25,-e),eo(71,-e),eo(t,0)])}}makeHexagonal(){function e(e,i,s){var n=e/2;return no(-(s=s?-1:1)*(n=n>t?t:n),e=(i?-1:1)*e/2)+no(s*n,e)}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeRounded(){function e(e,t,s){const n=e>i?e-i:0,o=s===t?"0":"1";return ao("a","0 0,"+o,e=(e>i?i:e)/2,eo((s?1:-1)*e,(t?-1:1)*e))+ro("v",(t?-1:1)*n)+ao("a","0 0,"+o,e,eo((s?-1:1)*e,(t?-1:1)*e))}const t=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,i=2*t;return{type:this.SHAPES.ROUND,isDynamic:!0,width:e=>(e/=2)>t?t:e,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}makeSquared(){function e(e,i,s){e-=2*t;const n=s===i?"0":"1";return ao("a","0 0,"+n,t,eo((s?1:-1)*t,(i?-1:1)*t))+ro("v",(i?-1:1)*e)+ao("a","0 0,"+n,t,eo((s?-1:1)*t,(i?-1:1)*t))}const t=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:e=>t,height:e=>e,connectionOffsetY:e=>e/2,connectionOffsetX:e=>-e,pathDown:t=>e(t,!1,!1),pathUp:t=>e(t,!0,!1),pathRightDown:t=>e(t,!1,!0),pathRightUp:t=>e(t,!1,!0)}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case Ac.INPUT_VALUE:case Ac.OUTPUT_VALUE:if(null!==(e=e.getSourceBlock().getOutputShape()))switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&-1!==t.indexOf("Boolean")?this.HEXAGONAL:(t&&-1!==t.indexOf("Number")||t&&t.indexOf("String"),this.ROUNDED);case Ac.PREVIOUS_STATEMENT:case Ac.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(e){return to("c",[eo(e*n/2,0),eo(e*n*3/4,r/2),eo(e*n,r)])+oo([eo(e*n,o)])+to("c",[eo(e*n/4,r/2),eo(e*n/2,r),eo(e*n,r)])+ro("h",e*s)+to("c",[eo(e*n/2,0),eo(e*n*3/4,-r/2),eo(e*n,-r)])+oo([eo(e*n,-o)])+to("c",[eo(e*n/4,-r/2),eo(e*n/2,-r),eo(e*n,-r)])}const t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,s=t/3,n=s/3,o=i/2,r=o/2,a=e(1),l=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:a,pathRight:l}}makeInsideCorners(){const e=this.CORNER_RADIUS,t=ao("a","0 0,0",e,eo(-e,e)),i=ao("a","0 0,1",e,eo(-e,e));return{width:e,height:e,pathTop:t,pathBottom:ao("a","0 0,0",e,eo(e,e)),rightWidth:e,rightHeight:e,pathTopRight:i,pathBottomRight:ao("a","0 0,1",e,eo(e,e))}}generateSecondaryColour_(e){return Cn("#000",e,.15)||e}generateTertiaryColour_(e){return Cn("#000",e,.25)||e}createDom(e,t,i){super.createDom(e,t,i),e=se(hl.DEFS,{},e),t=se(hl.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),se(hl.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),i=se(hl.FECOMPONENTTRANSFER,{result:"outBlur"},t),se(hl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),se(hl.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),se(hl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=se(hl.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),se(hl.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=se(hl.FECOMPONENTTRANSFER,{result:"outBlur"},e),se(hl.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),se(hl.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),se(hl.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),se(hl.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text,`,`${e} .blocklyNonEditableText>g>text,`,`${e} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .goog-menuitem,`,`${e}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .goog-menuitem-content {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Lp=class extends id{constructor(e,t){super(e,t)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(xh.isSpacer(e)){const s=e.precedesStatement;var t=e.followsStatement;if(s||t){const n=this.constants_.INSIDE_CORNERS;var i=n.rightHeight;return i=e.height-(s?i:0),t=t?n.pathBottomRight:"",e=0<i?ro("V",e.yPos+i):"",void(this.outlinePath_+=t+e+(s?n.pathTopRight:""))}}this.outlinePath_+=ro("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=so(e.xPos,this.info_.startY),this.outlinePath_+=ro("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=ro("V",e.baseline),this.outlinePath_+=ro("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=io(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){const t=e.width-2*e.connectionWidth,i=e.height;return ro("h",t)+e.shape.pathRightDown(i)+ro("h",-t)+e.shape.pathUp(i)+"z"}drawStatementInput_(e){var t=e.getLastInput();const i=t.xPos+t.notchOffset+t.shape.width,s=this.constants_.INSIDE_CORNERS,n=t.shape.pathRight+ro("h",-(t.notchOffset-s.width))+s.pathTop,o=e.height-2*s.height;t=s.pathBottom+ro("h",t.notchOffset-s.width)+(t.connectedBottomNextConnection?"":t.shape.pathLeft),this.outlinePath_+=ro("H",i)+n+ro("v",o)+t+ro("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const t=e.connectionModel;if(t.type===Ac.NEXT_STATEMENT||t.type===Ac.PREVIOUS_STATEMENT||t.type===Ac.OUTPUT_VALUE&&!e.isDynamicShape)super.drawConnectionHighlightPath(e);else{e=t.type===Ac.INPUT_VALUE?io(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):io(e.width,-e.height/2)+e.shape.pathDown(e.height);var i,s,n=t.getSourceBlock();null==(s=(i=n.pathObject).addConnectionHighlight)||s.call(i,t,e,t.getOffsetInBlock(),n.RTL)}}},$p=class extends oh{constructor(e,t,i,s,n,o,r){if(super(oh.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",i=Number(wn(i)),t=Number(wn(t)),isNaN(i)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(0>=i||0>=t)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new pl(t,i+$p.Y_PADDING),this.imageHeight=i,"function"==typeof n&&(this.clickHandler=n),e!==oh.SKIP_SETUP&&(r?this.configure_(r):(this.flipRtl=!!o,this.altText=wn(s)||""),this.setValue(wn(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=wn(e.alt))}initView(){this.imageElement=se(hl.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(rl,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return"string"!=typeof e?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(rl,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};$p.Y_PADDING=1,$n("field_image",$p),$p.prototype.DEFAULT_VALUE="";var Dp=class extends oh{constructor(e,t,i){super(oh.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),void 0!==e.spellcheck&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new rh;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new rh;let t;return this.fullBlockClickTarget_=!(null==(t=this.getConstants())||!t.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.htmlInput_.getAttribute("data-untyped-default-value"),this.sourceBlock_&&$()&&w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new rh;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.style.colourTertiary)):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(re(e,"blocklyInvalidInput"),Bi(e,Pc.INVALID,!1)):(ne(e,"blocklyInvalidInput"),Bi(e,Pc.INVALID,!0))}if(!(e=this.getSourceBlock()))throw new rh;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,t=!1){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(Va||Fa||Ua)?this.showPromptEditor_():this.showInlineEditor_(t)}showPromptEditor_(){et(Dr.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),(e=>{null!==e&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)}))}showInlineEditor_(e){const t=this.getSourceBlock();if(!t)throw new rh;Hi(this,t.RTL,this.widgetDispose_.bind(this)),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new rh;Dr.setGroup$$module$build$src$core$events$utils(!0);const t=Pi();var i=this.getClickTarget_();if(!i)throw Error("A click target has not been set.");ne(i,"editing"),(i=document.createElement("input")).className="blocklyHtmlInput",i.setAttribute("spellcheck",this.spellcheck_);const s=this.workspace_.getScale();var n=this.getConstants().FIELD_TEXT_FONTSIZE*s+"pt";return t.style.fontSize=n,i.style.fontSize=n,n=Dp.BORDERRADIUS*s+"px",this.isFullBlockField()&&(n=((n=this.getScaledBBox()).bottom-n.top)/2+"px",e=e.getParent()?e.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,i.style.border=1*s+"px solid "+e,t.style.borderRadius=n,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*s+"px")),i.style.borderRadius=n,t.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(i),i}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&$()&&null!==this.valueWhenEditorWasOpened_&&this.valueWhenEditorWasOpened_!==this.value_&&(w(new(P(Dr.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),Dr.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=Pi().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,!(e=this.getClickTarget_()))throw Error("A click target has not been set.");re(e,"editing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper_=Y(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=Y(e,"input",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(X(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(X(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(e){"Enter"===e.key?(Gi(),Ns()):"Escape"===e.key?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),Gi(),Ns()):"Tab"===e.key&&(Gi(),Ns(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())}onHtmlInputChange_(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&$()&&this.value_!==e&&w(new(P(Qr))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){var e=this.getSourceBlock();if(!e)throw new rh;const t=Pi(),i=this.getScaledBBox();t.style.width=i.right-i.left+"px",t.style.height=i.bottom-i.top+"px",e=new el(e.RTL?i.right-t.offsetWidth:i.left,i.top),t.style.left=e.x+"px",t.style.top=e.y+"px"}repositionForWindowResize(){const e=this.getSourceBlock();return e instanceof Fd&&(Zo(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),e)||this.resizeEditor_(),!0)}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};Dp.BORDERRADIUS=4;var Mp=class extends Dp{constructor(e,t,i){super(e,t,i)}doClassValidation_(e){return void 0===e?null:`${e}`}static fromJson(e){return new this(wn(e.text),void 0,e)}};$n("field_input",Mp),Mp.prototype.DEFAULT_VALUE="";var Bp=class extends Dh{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},Pp=class extends jh{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},Fp=class extends Lh{constructor(e){super(e),this.width=this.height=0,this.type|=xh.getType("RIGHT_CONNECTION")}},Up=class extends Qh{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},Hp=class extends ld{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new Up(this.constants_),this.bottomRow=new Bp(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new Fp(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return!!t&&(t instanceof rd||e instanceof ad||t instanceof ad||(e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input||e instanceof od||e instanceof rd)&&(!this.isInline||this.isMultiRow))}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&xh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&xh.isLeftRoundedCorner(e)&&t&&(xh.isPreviousConnection(t)||xh.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&xh.isLeftSquareCorner(e)&&t&&xh.isHat(t)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){if(xh.isTopRow(e)&&xh.isBottomRow(t))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const i=xh.isInputRow(e)&&e.hasStatement,s=xh.isInputRow(t)&&t.hasStatement;return s||i?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),s&&i?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):xh.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):xh.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,t){const i=this.width-this.startX;return xh.isInputRow(e)&&e.hasStatement||xh.isInputRow(t)&&t.hasStatement?Math.max(i,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):i}getElemCenterline_(e,t){if(e.hasStatement&&!xh.isSpacer(t)&&!xh.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(xh.isInlineInput(t)&&t instanceof Bh){const i=t.connectedBlock;if(i&&i.outputConnection&&i.nextConnection)return e.yPos+i.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof od||e instanceof rd)&&t.hasDummyInput&&t.align===Dr.Align$$module$build$src$core$inputs$align.LEFT&&e.align===Dr.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof ad)return t.elements.push(new Pp(this.constants_,e)),t.hasStatement=!0,void(null===t.align&&(t.align=e.align));super.addInput_(e,t)}addAlignmentPadding_(e,t){if(this.rightAlignedDummyInputs.get(e)){let i;for(let t=0;t<e.elements.length;t++){const s=e.elements[t];if(xh.isSpacer(s)&&(i=s),xh.isField(s)&&s instanceof Fh&&s.parentInput===this.rightAlignedDummyInputs.get(e))break}if(i)return i.width+=t,void(e.width+=t)}super.addAlignmentPadding_(e,t)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let t=e;for(let n=2;n<this.rows.length-1;n+=2){var i=this.rows[n-1];const o=this.rows[n];var s=this.rows[n+1];if(i=2===n?!!this.topRow.hasPreviousConnection:!!i.followsStatement,s=n+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!s.precedesStatement,xh.isInputRow(o)&&o.hasStatement){let i,s;o.measure(),t=o.width-(null!=(s=null==(i=o.getLastInput())?void 0:i.width)?s:0)+e}else if(i&&(2===n||s)&&xh.isInputRow(o)&&!o.hasStatement){s=o.xPos,i=null;for(let e=0;e<o.elements.length;e++){const n=o.elements[e];xh.isSpacer(n)&&(i=n),i&&(xh.isField(n)||xh.isInput(n))&&s<t&&!(xh.isField(n)&&n instanceof Fh&&(n.field instanceof sd||n.field instanceof $p))&&(i.width+=t-s),s+=n.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,i=0;i<this.rows.length;i++){const e=this.rows[i];e.yPos=t,t+=e.height}this.height=t,i=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(i),i=e.width(i),this.outputConnection.height=t,this.outputConnection.width=i,this.outputConnection.startX=i,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(i),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=i,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=i,this.width+=i+e,this.widthWithChildren+=i+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,t=0;t<this.rows.length;t++){var i=this.rows[t];if(!xh.isInputRow(i))continue;e=i.elements[i.elements.length-2];let s=this.getNegativeSpacing_(i.elements[1]),n=this.getNegativeSpacing_(e);e=s+n;const o=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<o&&(s=(e=this.width-o)/2,n=e/2),i.elements.unshift(new Gh(this.constants_,-s)),i.elements.push(new Gh(this.constants_,-n))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,t=0;t<this.rows.length;t++)i=this.rows[t],xh.isTopOrBottomRow(i)&&(i.elements[1].width-=e),i.width-=e,i.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const t=this.outputConnection.width;var i=this.outputConnection.shape.type;const s=this.constants_;if(1<this.inputRows.length)switch(i){case s.SHAPES.ROUND:return i=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,t-(i=this.height/2>i?i:this.height/2)*(1-Math.sin(Math.acos((i-this.constants_.SMALL_PADDING)/i)));default:return 0}if(xh.isInlineInput(e)&&e instanceof Bh){const n=e.connectedBlock;return null==(e=n?n.pathObject.outputShapeType:e.shape.type)||n&&n.outputConnection&&(n.statementInputCount||n.nextConnection)||i===s.SHAPES.HEXAGONAL&&i!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][e]}return xh.isField(e)&&e instanceof Fh?i===s.SHAPES.ROUND&&e.field instanceof Mp?t-2.75*s.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][0]:xh.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let s=2;s<this.rows.length-1;s+=2){const n=this.rows[s-1],o=this.rows[s],r=this.rows[s+1];var e=2===s,t=s+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!r.precedesStatement;if(e?this.topRow.hasPreviousConnection:n.followsStatement){var i=o.elements[1];if(i=3===o.elements.length&&i instanceof Fh&&(i.field instanceof sd||i.field instanceof $p),!e&&i)n.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING,o.height-=this.constants_.MEDIUM_PADDING;else if(e||t){if(t){for(e=!1,t=0;t<o.elements.length;t++)if((i=o.elements[t])instanceof Bh&&xh.isInlineInput(i)&&i.connectedBlock&&!i.connectedBlock.isShadow()&&40<=i.connectedBlock.getHeightWidth().height){e=!0;break}e&&(n.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING)}}else n.height+=this.constants_.SMALL_PADDING}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},Gp=class extends hd{constructor(e,t,i){super(e,t,i),this.markerCircle=null}showWithInputOutput(e){const t=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle(e.x,e.y),this.setParent_(t),this.showCurrent_()}showWithOutput_(e){this.showWithInputOutput(e)}showWithInput_(e){this.showWithInputOutput(e)}showWithBlock_(e){const t=(e=e.getLocation()).getHeightWidth();this.positionRect_(0,0,t.width,t.height),this.setParent_(e),this.showCurrent_()}positionCircle(e,t){let i,s;null==(i=this.markerCircle)||i.setAttribute("cx",`${e}`),null==(s=this.markerCircle)||s.setAttribute("cy",`${t}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=se(hl.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();se(hl.ANIMATE,e,this.markerCircle)}return this.markerSvg_}applyColour_(e){let t,i;if(super.applyColour_(e),null==(t=this.markerCircle)||t.setAttribute("fill",this.colour_),null==(i=this.markerCircle)||i.setAttribute("stroke",this.colour_),this.isCursor()){let t;e=this.colour_+";transparent;transparent;",null==(t=this.markerCircle)||t.firstElementChild.setAttribute("values",e)}}},Vp=class extends dd{constructor(e,t,i){super(e,t,i),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=i}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const t=e.getParent();e.isShadow()&&t&&this.svgPath.setAttribute("stroke",t.style.colourTertiary);for(const e of this.outlines.values())e.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){(e=this.getOutlinePath(e)).setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,se(hl.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,i;null==(t=this.outlines.get(e))||null==(i=t.parentNode)||i.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},jp=class extends _d{constructor(e){super(e)}makeConstants_(){return new xp}makeRenderInfo_(e){return new Hp(this,e)}makeDrawer_(e,t){return new Lp(e,t)}makeMarkerDrawer(e,t){return new Gp(e,this.getConstants(),t)}makePathObject(e,t){return new Vp(e,t,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(e,t,i){return ie("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),t.type===Ac.OUTPUT_VALUE?e.isConnected()?gd.PREVIEW_TYPE.REPLACEMENT_FADE:gd.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(e,t,i)}};Ao("zelos",jp);var Wp={};Wp.BottomRow=Bp,Wp.ConstantProvider=xp,Wp.Drawer=Lp,Wp.MarkerSvg=Gp,Wp.PathObject=Vp,Wp.RenderInfo=Hp,Wp.Renderer=jp,Wp.RightConnectionShape=Fp,Wp.StatementInput=Pp,Wp.TopRow=Up,Ir();var Yp={};Yp.registerCleanup=or,Yp.registerCollapse=ar,Yp.registerCollapseExpandBlock=_r,Yp.registerComment=mr,Yp.registerDefaultOptions=Ir,Yp.registerDelete=Tr,Yp.registerDeleteAll=dr,Yp.registerDisable=br,Yp.registerDuplicate=gr,Yp.registerExpand=lr,Yp.registerHelp=Er,Yp.registerInline=fr,Yp.registerRedo=nr,Yp.registerUndo=sr;var zp,Xp=class extends Dp{constructor(e,t,i){super(oh.SKIP_SETUP),this.clockwise=Xp.CLOCKWISE,this.offset=Xp.OFFSET,this.wrap=Xp.WRAP,this.round=Xp.ROUND,this.boundEvents=[],this.symbol_=this.gauge=this.line=null,e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){switch(super.configure_(e),e.mode){case zp.COMPASS:this.clockwise=!0,this.offset=90;break;case zp.PROTRACTOR:this.clockwise=!1,this.offset=0}e.clockwise&&(this.clockwise=e.clockwise),e.offset&&(this.offset=e.offset),e.wrap&&(this.wrap=e.wrap),e.round&&(this.round=e.round)}initView(){super.initView(),this.symbol_=se(hl.TSPAN,{}),this.symbol_.appendChild(document.createTextNode("°")),this.getTextElement().appendChild(this.symbol_)}render_(){super.render_(),this.updateGraph()}showEditor_(e){super.showEditor_(e,Va||Fa||Ua),e=this.dropdownCreate(),ms().appendChild(e),this.sourceBlock_ instanceof Fd&&_s(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary),Ts(this,this.dropdownDispose.bind(this)),this.updateGraph()}dropdownCreate(){const e=se(hl.SVG,{xmlns:nl,"xmlns:html":ol,"xmlns:xlink":rl,version:"1.1",height:2*Xp.HALF+"px",width:2*Xp.HALF+"px"});e.style.touchAction="none";const t=se(hl.CIRCLE,{cx:Xp.HALF,cy:Xp.HALF,r:Xp.RADIUS,class:"blocklyAngleCircle"},e);this.gauge=se(hl.PATH,{class:"blocklyAngleGauge"},e),this.line=se(hl.LINE,{x1:Xp.HALF,y1:Xp.HALF,class:"blocklyAngleLine"},e);for(let t=0;360>t;t+=15)se(hl.LINE,{x1:Xp.HALF+Xp.RADIUS,y1:Xp.HALF,x2:Xp.HALF+Xp.RADIUS-(0==t%45?10:5),y2:Xp.HALF,class:"blocklyAngleMarks",transform:"rotate("+t+","+Xp.HALF+","+Xp.HALF+")"},e);return this.boundEvents.push(Y(e,"click",this,this.hide)),this.boundEvents.push(Y(t,"pointerdown",this,this.onMouseMove_,!0)),this.boundEvents.push(Y(t,"pointermove",this,this.onMouseMove_,!0)),e}dropdownDispose(){for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.line=this.gauge=null}hide(){ws(this),Gi()}onMouseMove_(e){var t=this.gauge.ownerSVGElement.getBoundingClientRect();const i=e.clientX-t.left-Xp.HALF;e=e.clientY-t.top-Xp.HALF,t=Math.atan(-e/i),isNaN(t)||(t=us(t),0>i?t+=180:0<e&&(t+=360),t=this.clockwise?this.offset+360-t:360-(this.offset-t),this.displayMouseOrKeyboardValue(t))}displayMouseOrKeyboardValue(e){if(this.round&&(e=Math.round(e/this.round)*this.round),(e=this.wrapValue(e))!==this.value_){const t=this.value_;this.setEditorValue_(e,!1),this.sourceBlock_&&$()&&this.value_!==t&&w(new(P(Qr))(this.sourceBlock_,this.name||null,t,this.value_))}}updateGraph(){if(this.gauge&&this.line){var e=Number(this.getText())+this.offset,t=cs(e%360);e=["M ",Xp.HALF,",",Xp.HALF];var i=Xp.HALF,s=Xp.HALF;if(!isNaN(t)){const n=Number(this.clockwise),o=cs(this.offset),r=Math.cos(o)*Xp.RADIUS,a=Math.sin(o)*-Xp.RADIUS;n&&(t=2*o-t),i+=Math.cos(t)*Xp.RADIUS,s-=Math.sin(t)*Xp.RADIUS,t=Math.abs(Math.floor((t-o)/Math.PI)%2),n&&(t=1-t),e.push(" l ",r,",",a," A ",Xp.RADIUS,",",Xp.RADIUS," 0 ",t," ",n," ",i,",",s," z")}this.gauge.setAttribute("d",e.join("")),this.line.setAttribute("x2",`${i}`),this.line.setAttribute("y2",`${s}`)}}onHtmlInputKeyDown_(e){super.onHtmlInputKeyDown_(e);var t=this.getSourceBlock();if(!t)throw new rh;let i=0;switch(e.key){case"ArrowLeft":i=t.RTL?1:-1;break;case"ArrowRight":i=t.RTL?-1:1;break;case"ArrowDown":i=-1;break;case"ArrowUp":i=1}i&&(t=this.getValue(),this.displayMouseOrKeyboardValue(t+i*this.round),e.preventDefault(),e.stopPropagation())}doClassValidation_(e){return e=Number(e),isNaN(e)||!isFinite(e)?null:this.wrapValue(e)}wrapValue(e){return 0>(e%=360)&&(e+=360),e>this.wrap&&(e-=360),e}static fromJson(e){return new this(e.angle,void 0,e)}};Xp.HALF=50,Xp.RADIUS=Xp.HALF-1,Xp.CLOCKWISE=!1,Xp.OFFSET=0,Xp.WRAP=360,Xp.ROUND=15,$n("field_angle",Xp),Xp.prototype.DEFAULT_VALUE=0,ee("\n.blocklyAngleCircle {\n  stroke: #444;\n  stroke-width: 1;\n  fill: #ddd;\n  fill-opacity: 0.8;\n}\n\n.blocklyAngleMarks {\n  stroke: #444;\n  stroke-width: 1;\n}\n\n.blocklyAngleGauge {\n  fill: #f88;\n  fill-opacity: 0.8;\n  pointer-events: none;\n}\n\n.blocklyAngleLine {\n  stroke: #f00;\n  stroke-width: 2;\n  stroke-linecap: round;\n  pointer-events: none;\n}\n"),function(e){e.COMPASS="compass",e.PROTRACTOR="protractor"}(zp||(zp={}));var Kp={};Kp.FieldAngle=Xp,Kp.Mode=zp;var qp=class extends oh{constructor(e,t,i){super(oh.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=qp.CHECK_CHAR,e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(qp);return null!==e?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();ne(e,"blocklyCheckbox"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||qp.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool_(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(e){return"string"==typeof e?"TRUE"===e:!!e}static fromJson(e){return new this(e.checked,void 0,e)}};qp.CHECK_CHAR="✓",$n("field_checkbox",qp),qp.prototype.DEFAULT_VALUE=!1;var Jp=class extends oh{constructor(e,t,i){super(oh.SKIP_SETUP),this.highlightedIndex=this.picker=null,this.boundEvents=[],this.SERIALIZABLE=!0,this.CURSOR="default",this.isDirty_=!1,this.titles=this.colours=null,this.columns=0,e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.colourOptions&&(this.colours=e.colourOptions),e.colourTitles&&(this.titles=e.colourTitles),e.columns&&(this.columns=e.columns)}initView(){this.size_=new pl(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT),this.createBorderRect_(),this.getBorderRect().style.fillOpacity="1",this.getBorderRect().setAttribute("stroke","#fff"),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new rh;const t=this.getConstants();return e.isSimpleReporter()&&!(null==t||!t.FIELD_COLOUR_FULL_BLOCK)}applyColour(){const e=this.getSourceBlock();if(!e)throw new rh;if(this.fieldGroup_){var t=this.borderRect_;if(!t)throw Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getValue()),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getValue())}}getSize(){let e;return null!=(e=this.getConstants())&&e.FIELD_COLOUR_FULL_BLOCK&&(this.render_(),this.isDirty_=!1),super.getSize()}render_(){super.render_();const e=this.getSourceBlock();if(!e)throw new rh;e.applyColour()}updateSize_(e){var t=this.getConstants();this.isFullBlockField()?(e=2*(null!=e?e:0),t=t.FIELD_TEXT_HEIGHT):(e=t.FIELD_COLOUR_DEFAULT_WIDTH,t=t.FIELD_COLOUR_DEFAULT_HEIGHT),this.size_.height=t,this.size_.width=e,this.positionBorderRect_()}doClassValidation_(e){return"string"!=typeof e?null:yn(e)}getText(){let e=this.value_;return/^#(.)\1(.)\2(.)\3$/.test(e)&&(e="#"+e[1]+e[3]+e[5]),e}setColours(e,t){return this.colours=e,t&&(this.titles=t),this}setColumns(e){return this.columns=e,this}showEditor_(){this.dropdownCreate(),ms().appendChild(this.picker),Ts(this,this.dropdownDispose.bind(this)),this.picker.focus({preventScroll:!0})}onClick(e){null!==(e=(e=e.target)&&e.getAttribute("data-colour"))&&(this.setValue(e),ws(this))}onKeyDown(e){let t=!0;var i;switch(e.key){case"ArrowUp":this.moveHighlightBy(0,-1);break;case"ArrowDown":this.moveHighlightBy(0,1);break;case"ArrowLeft":this.moveHighlightBy(-1,0);break;case"ArrowRight":this.moveHighlightBy(1,0);break;case"Enter":(i=this.getHighlighted())&&null!==(i=i.getAttribute("data-colour"))&&this.setValue(i),Ns();break;default:t=!1}t&&e.stopPropagation()}moveHighlightBy(e,t){if(this.highlightedIndex){var i=this.colours||Jp.COLOURS,s=this.columns||Jp.COLUMNS,n=this.highlightedIndex%s,o=Math.floor(this.highlightedIndex/s);n+=e,o+=t,0>e?0>n&&0<o?(n=s-1,o--):0>n&&(n=0):0<e?n>s-1&&o<Math.floor(i.length/s)-1?(n=0,o++):n>s-1&&n--:0>t?0>o&&(o=0):0<t&&o>Math.floor(i.length/s)-1&&(o=Math.floor(i.length/s)-1),this.setHighlightedCell(this.picker.childNodes[o].childNodes[n],o*s+n)}}onMouseMove(e){const t=(e=e.target)&&Number(e.getAttribute("data-index"));null!==t&&t!==this.highlightedIndex&&this.setHighlightedCell(e,t)}onMouseEnter(){let e;null==(e=this.picker)||e.focus({preventScroll:!0})}onMouseLeave(){var e;null==(e=this.picker)||e.blur(),(e=this.getHighlighted())&&re(e,"blocklyColourHighlighted")}getHighlighted(){if(!this.highlightedIndex)return null;const e=this.columns||Jp.COLUMNS,t=this.picker.childNodes[Math.floor(this.highlightedIndex/e)];return t?t.childNodes[this.highlightedIndex%e]:null}setHighlightedCell(e,t){const i=this.getHighlighted();i&&re(i,"blocklyColourHighlighted"),ne(e,"blocklyColourHighlighted"),this.highlightedIndex=t,(e=e.getAttribute("id"))&&this.picker&&Bi(this.picker,Pc.ACTIVEDESCENDANT,e)}dropdownCreate(){const e=this.columns||Jp.COLUMNS,t=this.colours||Jp.COLOURS,i=this.titles||Jp.TITLES,s=this.getValue(),n=document.createElement("table");let o;n.className="blocklyColourTable",n.tabIndex=0,n.dir="ltr",Mi(n,Bc.GRID),Bi(n,Pc.EXPANDED,!0),Bi(n,Pc.ROWCOUNT,Math.floor(t.length/e)),Bi(n,Pc.COLCOUNT,e);for(let r=0;r<t.length;r++){0==r%e&&(o=document.createElement("tr"),Mi(o,Bc.ROW),n.appendChild(o));const a=document.createElement("td");o.appendChild(a),a.setAttribute("data-colour",t[r]),a.title=i[r]||t[r],a.id=C(),a.setAttribute("data-index",`${r}`),Mi(a,Bc.GRIDCELL),Bi(a,Pc.LABEL,t[r]),Bi(a,Pc.SELECTED,t[r]===s),a.style.backgroundColor=t[r],t[r]===s&&(a.className="blocklyColourSelected",this.highlightedIndex=r)}this.boundEvents.push(Y(n,"pointerdown",this,this.onClick,!0)),this.boundEvents.push(Y(n,"pointermove",this,this.onMouseMove,!0)),this.boundEvents.push(Y(n,"pointerenter",this,this.onMouseEnter,!0)),this.boundEvents.push(Y(n,"pointerleave",this,this.onMouseLeave,!0)),this.boundEvents.push(Y(n,"keydown",this,this.onKeyDown,!1)),this.picker=n}dropdownDispose(){for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.highlightedIndex=this.picker=null}static fromJson(e){return new this(e.colour,void 0,e)}};Jp.COLOURS="#ffffff #cccccc #c0c0c0 #999999 #666666 #333333 #000000 #ffcccc #ff6666 #ff0000 #cc0000 #990000 #660000 #330000 #ffcc99 #ff9966 #ff9900 #ff6600 #cc6600 #993300 #663300 #ffff99 #ffff66 #ffcc66 #ffcc33 #cc9933 #996633 #663333 #ffffcc #ffff33 #ffff00 #ffcc00 #999900 #666600 #333300 #99ff99 #66ff99 #33ff33 #33cc00 #009900 #006600 #003300 #99ffff #33ffff #66cccc #00cccc #339999 #336666 #003333 #ccffff #66ffff #33ccff #3366ff #3333ff #000099 #000066 #ccccff #9999ff #6666cc #6633ff #6600cc #333399 #330099 #ffccff #ff99ff #cc66cc #cc33cc #993399 #663366 #330033".split(" "),Jp.TITLES=[],Jp.COLUMNS=7,Jp.prototype.DEFAULT_VALUE=Jp.COLOURS[0],$n("field_colour",Jp),ee("\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: 0.5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n");var Zp=class extends sd{constructor(e,t,i){super(String(null!=e?e:""),t,i),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(wn(e.text),void 0,e)}};$n("field_label_serializable",Zp);var Qp=class extends Mp{constructor(e,t,i){super(oh.SKIP_SETUP),this.textGroup=null,this.maxLines_=1/0,this.isOverflowedY_=!1,e!==oh.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t&&this.setValidator(t))}configure_(e){super.configure_(e),e.maxLines&&this.setMaxLines(e.maxLines)}toXml(e){return e.textContent=this.getValue().replace(/\n/g,"&#10;"),e}fromXml(e){this.setValue(e.textContent.replace(/&#10;/g,"\n"))}saveState(){const e=this.saveLegacyState(Qp);return null!==e?e:this.getValue()}loadState(e){this.loadLegacyState(oh,e)||this.setValue(e)}initView(){this.createBorderRect_(),this.textGroup=se(hl.G,{class:"blocklyEditableText"},this.fieldGroup_)}getDisplayText_(){const e=this.getSourceBlock();if(!e)throw new rh;let t=this.getText();if(!t)return oh.NBSP;const i=t.split("\n");t="";const s=this.isOverflowedY_?this.maxLines_:i.length;for(let e=0;e<s;e++){let n=i[e];n.length>this.maxDisplayLength?n=n.substring(0,this.maxDisplayLength-4)+"...":this.isOverflowedY_&&e===s-1&&(n=n.substring(0,n.length-3)+"..."),t+=n=n.replace(/\s/g,oh.NBSP),e!==s-1&&(t+="\n")}return e.RTL&&(t+="‏"),t}doValueUpdate_(e){super.doValueUpdate_(e),null!==this.value_&&(this.isOverflowedY_=this.value_.split("\n").length>this.maxLines_)}render_(){var e=this.getSourceBlock();if(!e)throw new rh;for(var t,i=this.textGroup;t=i.firstChild;)i.removeChild(t);t=this.getDisplayText_().split("\n");let s=0;for(let e=0;e<t.length;e++){const n=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;se(hl.TEXT,{class:"blocklyText blocklyMultilineText",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:s+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},i).appendChild(document.createTextNode(t[e])),s+=n}this.isBeingEdited_&&(i=this.htmlInput_,this.isOverflowedY_?ne(i,"blocklyHtmlTextAreaInputOverflowedY"):re(i,"blocklyHtmlTextAreaInputOverflowedY")),this.updateSize_(),this.isBeingEdited_&&(e.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),e=this.htmlInput_,this.isTextValid_?(re(e,"blocklyInvalidInput"),Bi(e,Pc.INVALID,!1)):(ne(e,"blocklyInvalidInput"),Bi(e,Pc.INVALID,!0)))}updateSize_(){var e=this.textGroup.childNodes;const t=this.getConstants().FIELD_TEXT_FONTSIZE,i=this.getConstants().FIELD_TEXT_FONTWEIGHT,s=this.getConstants().FIELD_TEXT_FONTFAMILY;let n=0,o=0;for(var r=0;r<e.length;r++){var a=me(e[r],t,i,s);a>n&&(n=a),o+=this.getConstants().FIELD_TEXT_HEIGHT+(0<r?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}if(this.isBeingEdited_){for(e=String(this.value_).split("\n"),r=se(hl.TEXT,{class:"blocklyText blocklyMultilineText"}),a=0;a<e.length;a++){e[a].length>this.maxDisplayLength&&(e[a]=e[a].substring(0,this.maxDisplayLength)),r.textContent=e[a];const o=me(r,t,i,s);o>n&&(n=o)}n+=this.htmlInput_.offsetWidth-this.htmlInput_.clientWidth}this.borderRect_&&(o+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING,n+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",`${n}`),this.borderRect_.setAttribute("height",`${o}`)),this.size_.width=n,this.size_.height=o,this.positionBorderRect_()}showEditor_(e,t){super.showEditor_(e,t),this.forceRerender()}widgetCreate_(){const e=Pi(),t=this.workspace_.getScale(),i=document.createElement("textarea");i.className="blocklyHtmlInput blocklyHtmlTextAreaInput",i.setAttribute("spellcheck",String(this.spellcheck_));var s=this.getConstants().FIELD_TEXT_FONTSIZE*t+"pt";e.style.fontSize=s,i.style.fontSize=s,i.style.borderRadius=Mp.BORDERRADIUS*t+"px",s=this.getConstants().FIELD_BORDER_RECT_X_PADDING*t;const n=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*t/2;return i.style.padding=n+"px "+s+"px "+n+"px "+s+"px",s=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,i.style.lineHeight=s*t+"px",e.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.setAttribute("data-untyped-default-value",String(this.value_)),i.setAttribute("data-old-value",""),Pa?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),this.bindInputEvents_(i),i}setMaxLines(e){"number"==typeof e&&0<e&&e!==this.maxLines_&&(this.maxLines_=e,this.forceRerender())}getMaxLines(){return this.maxLines_}onHtmlInputKeyDown_(e){"Enter"!==e.key&&super.onHtmlInputKeyDown_(e)}static fromJson(e){return new this(wn(e.text),void 0,e)}};$n("field_multilinetext",Qp),ee("\n.blocklyHtmlTextAreaInput {\n  font-family: monospace;\n  resize: none;\n  overflow: hidden;\n  height: 100%;\n  text-align: left;\n}\n\n.blocklyHtmlTextAreaInputOverflowedY {\n  overflow-y: scroll;\n}\n");var eg=class extends Dp{constructor(e,t,i,s,n,o){super(oh.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==oh.SKIP_SETUP&&(o?this.configure_(o):this.setConstraints(t,i,s),this.setValue(e),n&&this.setValidator(n))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);-1!==t.indexOf("e")&&(t=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const i=t.indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}getPrecision(){return this.precision_}doClassValidation_(e){return null===e?null:(e=(e=(e=`${e}`.replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e)?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),null!==this.decimalPlaces&&(e=Number(e.toFixed(this.decimalPlaces))),e))}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,Bi(e,Pc.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,Bi(e,Pc.VALUEMAX,this.max_)),e}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};$n("field_number",eg),eg.prototype.DEFAULT_VALUE=0;var tg=class extends dh{constructor(e,t,i,s,n){super(oh.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=tg.dropdownCreate,this.defaultVariableName="string"==typeof e?e:"",this.size_=new pl(0,0),e!==oh.SKIP_SETUP&&(n?this.configure_(n):this.setTypes(i,s),t&&this.setValidator(t))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new rh;this.variable||(e=Dr.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new rh;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!==e.type)}fromXml(e){var t=this.getSourceBlock();if(!t)throw new rh;const i=e.getAttribute("id"),s=e.textContent,n=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(t=Dr.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,i,s,n),null!==n&&n!==t.type)throw Error("Serialized variable type with id '"+t.getId()+"' had type "+t.type+", and does not match variable field that references it: "+Pt(e)+".");this.setValue(t.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.name,this.variable.type&&e.setAttribute("variabletype",this.variable.type),e}saveState(e){var t=this.saveLegacyState(tg);return null!==t||(this.initModel(),t={id:this.variable.getId()},e&&(t.name=this.variable.name,t.type=this.variable.type)),t}loadState(e){const t=this.getSourceBlock();if(!t)throw new rh;this.loadLegacyState(tg,e)||(e=Dr.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(null===e)return null;var t=this.getSourceBlock();if(!t)throw new rh;return(t=Dr.getVariable$$module$build$src$core$variables(t.workspace,e))?(t=t.type,this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const t=this.getSourceBlock();if(!t)throw new rh;this.variable=Dr.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const t=this.getVariableTypes();if(!t)return!0;for(let i=0;i<t.length;i++)if(e===t[i])return!0;return!1}getVariableTypes(){var e=this.variableTypes;if(null===e&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(0===(e=e||[""]).length)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e}setTypes(e=null,t=""){if(Array.isArray(e)){let i=!1;for(let s=0;s<e.length;s++)e[s]===t&&(i=!0);if(!i)throw Error("Invalid default type '"+t+"' in the definition of a FieldVariable")}else if(null!==e)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=t,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if("RENAME_VARIABLE_ID"===e)return void Dr.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);if("DELETE_VARIABLE_ID"===e)return void this.sourceBlock_.workspace.deleteVariableById(this.variable.getId())}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(wn(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let t=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var i=this.getVariableTypes(),s=0;s<i.length;s++){const e=this.sourceBlock_.workspace.getVariablesOfType(i[s]);t=t.concat(e)}for(t.sort(Zl.compareByName),i=[],s=0;s<t.length;s++)i[s]=[t[s].name,t[s].getId()];return i.push([Dr.Msg$$module$build$src$core$msg.RENAME_VARIABLE,"RENAME_VARIABLE_ID"]),Dr.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&i.push([Dr.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),"DELETE_VARIABLE_ID"]),i}};$n("field_variable",tg);var ig=class{constructor(e,t,i,s){this.workspace=e,this.targetWorkspace=t,this.isLabel_=s,this.onMouseUpWrapper=null,this.height=this.width=0,this.svgText=this.svgGroup=null,this.text=i.text,this.position=new el(0,0),this.callbackKey=i.callbackKey||i.callbackkey,this.cssClass=i["web-class"]||null,this.info=i}createDom(){var e=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";let t;this.cssClass&&(e+=" "+this.cssClass),this.svgGroup=se(hl.G,{class:e},this.workspace.getCanvas()),this.isLabel_||(t=se(hl.RECT,{class:"blocklyFlyoutButtonShadow",rx:ig.BORDER_RADIUS,ry:ig.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=se(hl.RECT,{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:ig.BORDER_RADIUS,ry:ig.BORDER_RADIUS},this.svgGroup);const i=se(hl.TEXT,{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var s=wn(this.text);this.workspace.RTL&&(s+="‏"),i.textContent=s,this.isLabel_&&(this.svgText=i,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const n=ye(i,"fontSize"),o=ye(i,"fontWeight"),r=ye(i,"fontFamily");if(this.width=fe(i,n,o,r),s=_e(s,n,o,r),this.height=s.height,!this.isLabel_){let e,i;this.width+=2*ig.TEXT_MARGIN_X,this.height+=2*ig.TEXT_MARGIN_Y,null==(e=t)||e.setAttribute("width",String(this.width)),null==(i=t)||i.setAttribute("height",String(this.height))}return e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),i.setAttribute("x",String(this.width/2)),i.setAttribute("y",String(this.height/2-s.height/2+s.baseline)),this.updateTransform(),this.onMouseUpWrapper=Y(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}isLabel(){return this.isLabel_}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}dispose(){this.onMouseUpWrapper&&X(this.onMouseUpWrapper),this.svgGroup&&le(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isLabel_&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isLabel_||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isLabel_||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};ig.TEXT_MARGIN_X=5,ig.TEXT_MARGIN_Y=2,ig.BORDER_RADIUS=4,ee("\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n");var sg,ng=class extends gp{constructor(e,t){super(e),this.flyout_=t}getBoundingBox_(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch(t){e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const t=this.getBoundingBox_();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,i){return t=i||this.getContentMetrics(),i=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*i)/e,width:(t.width+t.left+i)/e,top:0,left:0}}};!function(e){e.BLOCK="block",e.BUTTON="button"}(sg||(sg={}));var og=class extends Gd{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.isVisible_=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new Od(e),this.workspace_.setMetricsManager(new ng(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.id=S(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=se(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=se(hl.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new pp(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(Y(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(Y(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:1,capabilities:[qa.Capability.AUTOHIDEABLE,qa.Capability.DELETE_AREA,qa.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)X(e);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&le(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}isVisible(){return this.isVisible_}setVisible(e){const t=e!==this.isVisible();this.isVisible_=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}updateDisplay(){let e,t;e=!!this.containerVisible&&this.isVisible(),this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none"),null==(t=this.workspace_.scrollbar)||t.setContainerVisible(e)}positionAt_(e,t,i,s){let n,o;null==(n=this.svgGroup_)||n.setAttribute("width",`${e}`),null==(o=this.svgGroup_)||o.setAttribute("height",`${t}`),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&he(this.svgGroup_,"translate("+i+"px,"+s+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(i,s),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const e of this.listeners)X(e);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),"string"==typeof e&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=Pe(e),e=this.createFlyoutInfo(e),vt(this.workspace_),this.layout_(e.contents,e.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(e){const t=[],i=[];this.permanentlyDisabled.length=0;const s=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const n of e){if("custom"in n){e=this.getDynamicCategoryContents(n.custom),e=Pe(e);const{contents:s,gaps:o}=this.createFlyoutInfo(e);t.push(...s),i.push(...o)}switch(n.kind.toUpperCase()){case"BLOCK":e=n;const o=this.createFlyoutBlock(e);t.push({type:sg.BLOCK,block:o}),this.addBlockGap(e,i,s);break;case"SEP":this.addSeparatorGap(n,i,s);break;case"LABEL":e=this.createButton(n,!0),t.push({type:sg.BUTTON,button:e}),i.push(s);break;case"BUTTON":e=this.createButton(n,!1),t.push({type:sg.BUTTON,button:e}),i.push(s)}}return{contents:t,gaps:i}}getDynamicCategoryContents(e){if("function"!=typeof(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}createButton(e,t){return new ig(this.workspace_,this.targetWorkspace,e,t)}createFlyoutBlock(e){let t;return e.blockxml?(e="string"==typeof e.blockxml?Dr.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,(t=this.getRecycledBlock(e.getAttribute("type")))||(t=Gt(e,this.workspace_))):(t=this.getRecycledBlock(e.type))||(void 0===e.enabled&&(e.enabled="true"!==e.disabled&&!0!==e.disabled),t=mi(e,this.workspace_)),t.isEnabled()||this.permanentlyDisabled.push(t),t}getRecycledBlock(e){let t=-1;for(let i=0;i<this.recycledBlocks.length;i++)if(this.recycledBlocks[i].type===e){t=i;break}return-1===t?void 0:this.recycledBlocks.splice(t,1)[0]}addBlockGap(e,t,i){let s;e.gap?s=parseInt(String(e.gap)):e.blockxml&&(e="string"==typeof e.blockxml?Dr.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,s=parseInt(e.getAttribute("gap"))),t.push(!s||isNaN(s)?i:s)}addSeparatorGap(e,t,i){e=parseInt(String(e.gap)),!isNaN(e)&&0<t.length?t[t.length-1]=e:t.push(i)}clearOldBlocks(){var e=this.workspace_.getTopBlocks(!1);for(let t,i=0;t=e[i];i++)this.blockIsRecyclable_(t)?this.recycleBlock(t):t.dispose(!1,!1);for(e=0;e<this.mats.length;e++){const t=this.mats[e];t&&(sn(t),le(t))}this.mats.length=0;for(let e,t=0;e=this.buttons_[t];t++)e.dispose();let t;this.buttons_.length=0,null==(t=this.workspace_.getPotentialVariableMap())||t.clear()}emptyRecycledBlocks(){for(let e=0;e<this.recycledBlocks.length;e++)this.recycledBlocks[e].dispose();this.recycledBlocks=[]}blockIsRecyclable_(e){return!1}recycleBlock(e){const t=e.getRelativeToSurfaceXY();e.moveBy(-t.x,-t.y),this.recycledBlocks.push(e)}addBlockListeners_(e,t,i){this.listeners.push(Y(e,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(Y(i,"pointerdown",null,this.blockMouseDown(t))),this.listeners.push(z(e,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(z(e,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()}))),this.listeners.push(z(i,"pointerenter",t,(()=>{this.targetWorkspace.isDragging()||t.addSelect()}))),this.listeners.push(z(i,"pointerleave",t,(()=>{this.targetWorkspace.isDragging()||t.removeSelect()})))}blockMouseDown(e){return t=>{const i=this.targetWorkspace.getGesture(t);i&&(i.setStartBlock(e),i.handleFlyoutStart(t,this))}}onMouseDown(e){const t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()}createBlock(e){let t=null;Dr.disable$$module$build$src$core$events$utils();var i=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{Dr.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=Tt(this.targetWorkspace,i),$()){for(Dr.setGroup$$module$build$src$core$events$utils(!0),i=0;i<e.length;i++){const t=e[i];w(new(P(ea))(t))}w(new(P(Dr.CREATE$$module$build$src$core$events$utils))(t))}return this.autoClose?this.hide():this.filterForCapacity(),t}initFlyoutButton_(e,t,i){const s=e.createDom();e.moveTo(t,i),e.show(),this.listeners.push(Y(s,"pointerdown",this,this.onMouseDown)),this.buttons_.push(e)}createRect_(e,t,i,s,n){return(t=se(hl.RECT,{"fill-opacity":0,x:t,y:i,height:s.height,width:s.width})).tooltip=e,tn(t),this.workspace_.getCanvas().insertBefore(t,e.getSvgRoot()),this.rectMap_.set(e,t),this.mats[n]=t}moveRectToBlock_(e,t){const i=t.getHeightWidth();e.setAttribute("width",String(i.width)),e.setAttribute("height",String(i.height)),t=t.getRelativeToSurfaceXY(),e.setAttribute("y",String(t.y)),e.setAttribute("x",String(this.RTL?t.x-i.width:t.x))}filterForCapacity(){const e=this.workspace_.getTopBlocks(!1);for(let t,i=0;t=e[i];i++)if(-1===this.permanentlyDisabled.indexOf(t)){const e=this.targetWorkspace.isCapacityAvailable(y(t));for(;t;)t.setEnabled(e),t=t.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return!!this.workspace_.scrollbar&&this.workspace_.scrollbar.isVisible()}placeNewBlock(e){var t=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const i=oi(e);return t.setResizesEnabled(!1),t=gi(i,t),this.positionNewBlock(e,t),t}positionNewBlock(e,t){const i=this.targetWorkspace;var s=i.getOriginOffsetInPixels(),n=this.workspace_.getOriginOffsetInPixels();(e=e.getRelativeToSurfaceXY()).scale(this.workspace_.scale),n=el.sum(n,e),(s=el.difference(n,s)).scale(1/i.scale),t.moveTo(new el(s.x,s.y))}};og.FlyoutItemType=sg;var rg=class extends og{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),s=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.x&&(this.workspace_.scrollX=-(i.left+(i.width-s.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();e=e.getToolboxMetrics();const s=this.toolboxPosition_===Al.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?s?e.height:i.height-this.height_:s?0:i.height:s?0:i.height+t.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===Al.TOP,s=["M 0,"+(i?0:this.CORNER_RADIUS)];i?(s.push("h",e+2*this.CORNER_RADIUS),s.push("v",t),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("h",-e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),s.push("h",e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("v",t),s.push("h",-e-2*this.CORNER_RADIUS)),s.push("z"),this.svgBackground_.setAttribute("d",s.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setX(this.RTL?1/0:0)}wheel_(e){var t=Z(e);if(t=t.x||t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let s;t=e.getViewMetrics().left-i.left+t,null==(s=this.workspace_.scrollbar)||s.setX(t),Gi(),Ns()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;const i=this.MARGIN;let s=i+this.tabWidth_;this.RTL&&(e=e.reverse());for(let a,l=0;a=e[l];l++)if("block"===a.type){var n=a.block,o=n.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=n.getSvgRoot();const e=n.getHeightWidth();var r=n.outputConnection?this.tabWidth_:0;r=this.RTL?s+e.width:s-r,n.moveBy(r,i),r=this.createRect_(n,r,i,e,l),s+=e.width+t[l],this.addBlockListeners_(o,n,r)}else"button"===a.type&&(n=a.button,this.initFlyoutButton_(n,s,i),s+=n.width+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<90+t&&e>90-t||e>-90-t&&e<-90+t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.top;return this.toolboxPosition_===Al.TOP?new dl(-1e9,t+e.height,-1e9,1e9):new dl(t,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;const t=this.workspace_.getTopBlocks(!1);for(let i,s=0;i=t[s];s++)e=Math.max(e,i.getHeightWidth().height);const i=this.buttons_;for(let t,s=0;t=i[s];s++)e=Math.max(e,t.height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=Tl.scrollbarThickness,this.height_!==e){for(let e,i=0;e=t[i];i++)this.rectMap_.has(e)&&this.moveRectToBlock_(this.rectMap_.get(e),e);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Al.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};t(Ur.FLYOUTS_HORIZONTAL_TOOLBOX,Fr,rg);var ag=class extends og{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var t=this.workspace_.getMetricsManager(),i=t.getScrollMetrics(),s=t.getViewMetrics();t=t.getAbsoluteMetrics(),"number"==typeof e.y&&(this.workspace_.scrollY=-(i.top+(i.height-s.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+t.left,this.workspace_.scrollY+t.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const t=e.getAbsoluteMetrics(),i=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Al.LEFT?e.width:i.width-this.width_:this.toolboxPosition_===Al.LEFT?0:i.width:this.toolboxPosition_===Al.LEFT?0:i.width+t.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var t=this.getY();this.positionAt_(this.width_,this.height_,e,t)}}setBackgroundPath(e,t){const i=this.toolboxPosition_===Al.RIGHT;var s=e+this.CORNER_RADIUS;(s=["M "+(i?s:0)+",0"]).push("h",i?-e:e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("v",Math.max(0,t)),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("h",i?e:-e),s.push("z"),this.svgBackground_.setAttribute("d",s.join(" "))}scrollToStart(){let e;null==(e=this.workspace_.scrollbar)||e.setY(0)}wheel_(e){var t=Z(e);if(t.y){const e=this.workspace_.getMetricsManager(),i=e.getScrollMetrics();let s;t=e.getViewMetrics().top-i.top+t.y,null==(s=this.workspace_.scrollbar)||s.setY(t),Gi(),Ns()}e.preventDefault(),e.stopPropagation()}layout_(e,t){this.workspace_.scale=this.targetWorkspace.scale;var i=this.MARGIN;const s=this.RTL?i:i+this.tabWidth_;for(let a,l=0;a=e[l];l++)if("block"===a.type){var n=a.block,o=n.getDescendants(!1);for(let e,t=0;e=o[t];t++)e.isInFlyout=!0;o=n.getSvgRoot();const e=n.getHeightWidth();var r=n.outputConnection?s-this.tabWidth_:s;n.moveBy(r,i),r=this.createRect_(n,this.RTL?r-e.width:r,i,e,l),this.addBlockListeners_(o,n,r),i+=e.height+t[l]}else"button"===a.type&&(n=a.button,this.initFlyoutButton_(n,s,i),i+=n.height+t[l])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const t=this.dragAngleRange_;return e<t&&e>-t||e<-180+t||e>180-t}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),t=e.left;return this.toolboxPosition_===Al.LEFT?new dl(-1e9,1e9,-1e9,t+e.width):new dl(-1e9,1e9,t,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;var t=this.workspace_.getTopBlocks(!1);for(let s,n=0;s=t[n];n++){var i=s.getHeightWidth().width;s.outputConnection&&(i-=this.tabWidth_),e=Math.max(e,i)}for(let t,i=0;t=this.buttons_[i];i++)e=Math.max(e,t.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=Tl.scrollbarThickness,this.width_!==e){for(let s,n=0;s=t[n];n++){if(this.RTL){i=s.getRelativeToSurfaceXY().x;let t=e/this.workspace_.scale-this.MARGIN;s.outputConnection||(t-=this.tabWidth_),s.moveBy(t-i,0)}this.rectMap_.has(s)&&this.moveRectToBlock_(this.rectMap_.get(s),s)}if(this.RTL)for(let i,s=0;i=this.buttons_[s];s++)t=i.getPosition().y,i.moveTo(e/this.workspace_.scale-i.width-this.MARGIN-this.tabWidth_,t);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Al.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};ag.registryName="verticalFlyout",t(Ur.FLYOUTS_VERTICAL_TOOLBOX,Fr,ag),Dr.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=g());var t=[];this.init(e),e=e.getTopBlocks(!0);for(let i,s=0;i=e[s];s++){let e=this.blockToCode(i);Array.isArray(e)&&(e=e[0]),e&&(i.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,i)+e),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,i))),t.push(e))}return t=t.join("\n"),(t=(t=(t=this.finish(t)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)}allNestedComments(e){const t=[];e=e.getDescendants(!0);for(let i=0;i<e.length;i++){const s=e[i].getCommentText();s&&t.push(s)}return t.length&&t.push(""),t.join("\n")}blockToCode(e,t){if(!1===this.isInitialized&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var i=this.forBlock[e.type];if(!i&&this[e.type]&&(ie("block generator functions on CodeGenerator objects","10.0","11.0","the .forBlock[blockType] dictionary"),i=this[e.type]),"function"!=typeof i)throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(i=i.call(e,e,this),Array.isArray(i)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,i[0],t),i[1]]}if("string"==typeof i)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(i=this.injectId(this.STATEMENT_PREFIX,e)+i),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(i+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,i,t);if(null===i)return"";throw SyntaxError("Invalid code generated: "+i)}valueToCode(e,t,i){if(isNaN(i))throw TypeError("Expecting valid order from block: "+e.type);var s=e.getInputTargetBlock(t);if(!s)return"";if(""===(t=this.blockToCode(s)))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${s.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+s.type);if(!e)return"";s=!1;var n=Math.floor(i);const o=Math.floor(t);if(n<=o&&(n!==o||0!==n&&99!==n))for(s=!0,n=0;n<this.ORDER_OVERRIDES.length;n++)if(this.ORDER_OVERRIDES[n][0]===i&&this.ORDER_OVERRIDES[n][1]===t){s=!1;break}return s&&(e="("+e+")"),e}statementToCode(e,t){if(e=e.getInputTargetBlock(t),"string"!=typeof(t=this.blockToCode(e)))throw TypeError("Expecting code from statement block: "+(e&&e.type));return t&&(t=this.prefixLines(t,this.INDENT)),t}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,t){if(!this.definitions_[e]){const i=this.nameDB_.getDistinctName(e,Dr.NameType$$module$build$src$core$names.PROCEDURE);let s;for(this.functionNames_[e]=i,Array.isArray(t)&&(t=t.join("\n")),t=t.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,i);s!==t;)s=t,t=t.replace(/^(( {2})*) {2}/gm,"$1\0");t=t.replace(/\0/g,this.INDENT),this.definitions_[e]=t}return this.functionNames_[e]}getVariableName(e){return this.getName(e,Dr.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,Dr.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,t)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,i){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},Dr.CodeGenerator$$module$build$src$core$generator;var lg=!1,cg={};cg.Align=Dr.Align$$module$build$src$core$inputs$align,cg.DummyInput=od,cg.EndRowInput=rd,cg.Input=nd,cg.StatementInput=ad,cg.ValueInput=Dr.ValueInput$$module$build$src$core$inputs$value_input,cg.inputTypes=Dr.inputTypes$$module$build$src$core$inputs$input_types;var ug=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,i){Dr.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=i,i.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{Dr.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){Dr.disable$$module$build$src$core$events$utils();try{this.hidePreview();const i=e.getSourceBlock(),s=this.createInsertionMarker(i),n=this.getMatchingConnection(i,s,e);if(!n)throw Error("Could not create insertion marker to preview connection");s.queueRender(),vt(),n.connect(t);const o={x:t.x-n.x,y:t.y-n.y},r=n.getOffsetInBlock().clone();kt().then((()=>{null==s||s.positionNearConnection(n,o,r),null==s||s.getSvgRoot().setAttribute("visibility","visible")})),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.markerConn=n,this.draggedConn=e,this.staticConn=t}finally{Dr.enable$$module$build$src$core$events$utils()}}}createInsertionMarker(e){const t=this.workspace.newBlock(e.type);if(t.setInsertionMarker(!0),e.saveExtraState){var i=e.saveExtraState(!0);i&&t.loadExtraState&&t.loadExtraState(i)}else e.mutationToDom&&(i=e.mutationToDom())&&t.domToMutation&&t.domToMutation(i);for(i=0;i<e.inputList.length;i++){const s=e.inputList[i];if("_TEMP_COLLAPSED_INPUT"===s.name)continue;const n=t.inputList[i];if(!n)throw Error("The insertion marker previewer tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","an input"));for(let e=0;e<s.fieldRow.length;e++){const t=s.fieldRow[e],i=n.fieldRow[e];if(!i)throw Error("The insertion marker previewer tried to create a marker but the result is missing %1. If you are using a mutator, make sure your domToMutation method is properly defined.".replace("%1","a field"));i.setValue(t.getValue())}}for(const e of t.getDescendants(!1))e.setInsertionMarker(!0);return t.setCollapsed(e.isCollapsed()),t.setInputsInline(e.getInputsInline()),t.initSvg(),t.getSvgRoot().setAttribute("visibility","hidden"),t}getMatchingConnection(e,t,i){if(e=e.getConnections_(!0),t=t.getConnections_(!0),e.length!==t.length)return null;for(let s=0;s<e.length;s++)if(e[s]===i)return t[s];return null}hidePreview(){Dr.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{Dr.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const t=e.getSourceBlock(),i=t.outputConnection;let s;if(null!=(s=t.previousConnection)&&s.targetConnection||null!=i&&i.targetConnection)t.unplug(!0);else{let t;null==(t=e.targetBlock())||t.unplug(!1)}t.dispose()}dispose(){this.hidePreview()}};t(Ur.CONNECTION_PREVIEWER,Fr,ug);var hg=class extends ed{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},dg=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+"\n"+this.inlineSteps_}drawTopCorner(e){this.steps_+=so(e.xPos,this.info_.startY);for(let t,i=0;t=e.elements[i];i++)xh.isLeftSquareCorner(t)?this.steps_+=this.highlightConstants_.START_POINT:xh.isLeftRoundedCorner(t)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):xh.isPreviousConnection(t)?this.steps_+=this.notchPaths_.pathLeft:xh.isHat(t)?this.steps_+=this.startPaths_.path(this.RTL_):xh.isSpacer(t)&&0!==t.width&&(this.steps_+=ro("H",t.xPos+t.width-this.highlightOffset));this.steps_+=ro("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+ro("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const t=e.getLastInput();if(this.RTL_){const i=e.height-t.connectionHeight;this.steps_+=io(t.xPos+t.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+ro("v",i)}else this.steps_+=io(t.xPos+t.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const t=e.getLastInput();if(t)if(this.RTL_){const i=e.height-2*this.insideCornerPaths_.height;this.steps_+=io(t.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+ro("v",i)+this.insideCornerPaths_.pathBottom(this.RTL_)+no(e.width-t.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=io(t.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+no(e.width-t.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const t=e.xPos+e.width-this.highlightOffset;e instanceof Jh&&e.followsStatement&&(this.steps_+=ro("H",t)),this.RTL_&&(this.steps_+=ro("H",t),e.height>this.highlightOffset&&(this.steps_+=ro("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=ro("V",e.baseline-this.highlightOffset);else{const t=this.info_.bottomRow.elements[0];xh.isLeftSquareCorner(t)?this.steps_+=io(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):xh.isLeftRoundedCorner(t)&&(this.steps_+=io(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=io(this.info_.startX,e):(this.steps_+=io(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=ro("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,xh.isLeftRoundedCorner(e.elements[0])?this.steps_+=ro("V",this.outsideCornerPaths_.height):this.steps_+=ro("V",e.capline+this.highlightOffset))}drawInlineInput(e){const t=this.highlightOffset,i=e.xPos+e.connectionWidth;var s=e.centerline-e.height/2;const n=e.width-e.connectionWidth,o=s+t;this.RTL_?(s=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=io(i-t,o)+ro("v",s)+this.puzzleTabPaths_.pathDown(this.RTL_)+ro("v",e)+ro("h",n)):this.inlineSteps_+=io(e.xPos+e.width+t,o)+ro("v",e.height)+ro("h",-n)+io(i,s+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},pg=class extends id{constructor(e,t){super(e,t),this.highlighter_=new dg(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=ro("H",e.xPos+e.width)+ro("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const t=e.centerline-e.height/2;if(e.connectionModel){let i=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),e.connectionModel.setOffsetInBlock(i,t+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const t=e.getLastInput();if(null!=t&&t.connectionModel){let i=e.xPos+e.statementEdge+t.notchOffset;i=this.info_.RTL?-1*i:i+this.constants_.DARK_PATH_OFFSET,t.connectionModel.setOffsetInBlock(i,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const t=e.getLastInput();if(t&&t.connectionModel){let i=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(i*=-1),t.connectionModel.setOffsetInBlock(i,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const t=e.connection,i=t.xPos;t.connectionModel.setOffsetInBlock((this.info_.RTL?-i:i)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},gg=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=so(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e+t)-t,s=so(i,i)+ao("a","0 0,0",e,eo(-i-t,e-i)),n=ao("a","0 0,0",e+t,eo(e+t,e+t)),o=so(i,-i)+ao("a","0 0,0",e+t,eo(e-i,i+t));return{width:e+t,height:e,pathTop:e=>e?s:"",pathBottom:e=>e?n:o}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e-t)+t,s=so(i,i)+ao("a","0 0,1",e-t,eo(e-i,-i+t)),n=so(t,e)+ao("a","0 0,1",e-t,eo(e,-e+t)),o=-i,r=so(i,o)+ao("a","0 0,1",e-t,eo(-i+t,-o-e));return{height:e,topLeft:e=>e?s:n,bottomLeft:()=>r}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,i=so(-2,3.4-t)+no(-.45*e,-2.1),s=ro("v",2.5)+so(.97*-e,2.5)+to("q",[eo(.05*-e,10),eo(.3*e,9.5)])+so(.67*e,-1.9)+ro("v",2.5),n=ro("v",-1.5)+so(-.92*e,-.5)+to("q",[eo(-.19*e,-5.5),eo(0,-11)])+so(.92*e,1),o=so(-5,t-.7)+no(.46*e,-2.1);return{width:e,height:t,pathUp:e=>e?i:n,pathDown:e=>e?s:o}}makeNotch(){return{pathLeft:ro("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:no(5.1,2.6)+so(-10.2,6.8)+no(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,t=so(25,-8.7)+to("c",[eo(29.7,-6.2),eo(57.2,-.5),eo(75,8.7)]),i=to("c",[eo(17.8,-9.2),eo(45.3,-14.9),eo(75,-8.7)])+io(100.5,e+.5);return{path:e=>e?t:i}}},mg=class extends Vh{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},fg=class extends jh{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},_g=class extends ld{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ad||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new mg(this.constants_,e)),t.hasInlineInput=!0):e instanceof ad?(t.elements.push(new fg(this.constants_,e)),t.hasStatement=!0):e instanceof Dr.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Ph(this.constants_,e)),t.hasExternalInput=!0):(e instanceof od||e instanceof rd)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||null!==t.align||(t.align=e.align)}addElemSpacing_(){let e=!1;for(let t,i=0;t=this.rows[i];i++)t.hasExternalInput&&(e=!0);for(let i,s=0;i=this.rows[s];s++){var t=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new Gh(this.constants_,this.getInRowSpacing_(null,t[0]))),t.length){for(let e=0;e<t.length-1;e++){i.elements.push(t[e]);const s=this.getInRowSpacing_(t[e],t[e+1]);i.elements.push(new Gh(this.constants_,s))}i.elements.push(t[t.length-1]),i.endsWithElemSpacer()&&(t=this.getInRowSpacing_(t[t.length-1],null),e&&i.hasDummyInput&&(t+=this.constants_.TAB_WIDTH),i.elements.push(new Gh(this.constants_,t)))}}}getInRowSpacing_(e,t){if(!e)return t&&xh.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&xh.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&xh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!xh.isInput(e)&&(!t||xh.isStatementInput(t)))return xh.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:xh.isIcon(e)?2*this.constants_.LARGE_PADDING+1:xh.isHat(e)?this.constants_.NO_PADDING:xh.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:xh.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:xh.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(xh.isInput(e)&&!t){if(xh.isExternalInput(e))return this.constants_.NO_PADDING;if(xh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(xh.isStatementInput(e))return this.constants_.NO_PADDING}if(!xh.isInput(e)&&t&&xh.isInput(t)){if(xh.isField(e)&&e.isEditable){if(xh.isInlineInput(t)||xh.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(xh.isInlineInput(t)||xh.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(xh.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(xh.isIcon(e)&&t&&!xh.isInput(t))return this.constants_.LARGE_PADDING;if(xh.isInlineInput(e)&&t&&xh.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(xh.isLeftSquareCorner(e)&&t){if(xh.isHat(t))return this.constants_.NO_PADDING;if(xh.isPreviousConnection(t))return t.notchOffset;if(xh.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(xh.isLeftRoundedCorner(e)&&t){if(xh.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if(xh.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return xh.isField(e)&&t&&xh.isField(t)&&e.isEditable===t.isEditable||t&&xh.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return xh.isTopRow(e)&&xh.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:xh.isTopRow(e)||xh.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(xh.isSpacer(t))return e.yPos+t.height/2;if(xh.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,xh.isNextConnection(t)?e+t.height/2:e-t.height/2;if(xh.isTopRow(e))return xh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return xh.isField(t)||xh.isIcon(t)?(i+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(i+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):i=xh.isInlineInput(t)?i+t.height/2:i+e.height/2,i}alignRowElements_(){if(this.isInline){var e=0,t=new WeakMap,i=null;for(let s,n=this.rows.length-1;s=this.rows[n];n--)t.set(s,e),xh.isInputRow(s)&&(s.hasStatement&&this.alignStatementRow_(s),i&&i.hasStatement&&s.width<i.width?t.set(s,i.width):e=s.hasStatement?s.width:Math.max(e,s.width),i=s);e=0;for(let s,n=0;s=this.rows[n];n++)s.hasStatement?e=this.getDesiredRowWidth_(s):xh.isSpacer(s)?s.width=Math.max(e,t.get(s)):(i=s.width,0<(e=Math.max(e,t.get(s))-i)&&this.addAlignmentPadding_(s,e),e=s.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,t=0;for(let s,n=0;s=this.rows[n];n++){s.yPos=t,s.xPos=this.startX,t+=s.height,e=Math.max(e,s.widthWithConnectedBlocks);var i=t-this.topRow.ascenderHeight;s===this.bottomRow&&i<this.constants_.MIN_BLOCK_HEIGHT&&(i=this.constants_.MIN_BLOCK_HEIGHT-i,this.bottomRow.height+=i,t+=i),this.recordElemPositions_(s)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=t+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},bg=class extends dd{constructor(e,t,i){super(e,t,i),this.constants=i,this.colourDark="#000000",this.svgPathDark=se(hl.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=se(hl.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=Cn("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},Tg=class extends _d{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t){super.refreshDom(e,t),this.getHighlightConstants().init()}makeConstants_(){return new hg}makeRenderInfo_(e){return new _g(this,e)}makeDrawer_(e,t){return new pg(e,t)}makePathObject(e,t){return new bg(e,t,this.getConstants())}makeHighlightConstants_(){return new gg(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};Ao("geras",Tg);var Eg={};Eg.ConstantProvider=hg,Eg.Drawer=pg,Eg.HighlightConstantProvider=gg,Eg.Highlighter=dg,Eg.InlineInput=mg,Eg.PathObject=bg,Eg.RenderInfo=_g,Eg.Renderer=Tg,Eg.StatementInput=fg;var yg=class extends ed{constructor(){super(),ie("Blockly.minimalist.ConstantProvider","v10","v11","Blockly.blockRendering.ConstantProvider")}},Ig=class extends id{constructor(e,t){super(e,t),ie("Blockly.minimalist.Drawer","v10","v11","Blockly.blockRendering.Drawer")}},kg=class extends ld{constructor(e,t){super(e,t),ie("Blockly.minimalist.RenderInfo","v10","v11","Blockly.blockRendering.RenderInfo")}getRenderer(){return this.renderer_}},vg=class extends _d{constructor(e){super(e),ie("Blockly.minimalist.Renderer","v10","v11","Blockly.blockRendering.Renderer")}makeConstants_(){return new yg}makeRenderInfo_(e){return new kg(this,e)}makeDrawer_(e,t){return new Ig(e,t)}};Ao("minimalist",vg);var Cg={};Cg.ConstantProvider=yg,Cg.Drawer=Ig,Cg.RenderInfo=kg,Cg.Renderer=vg;var Sg=class extends ld{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){const s=this.rows[t];var i=s.elements;if(s.elements=[],s.startsWithElemSpacer()&&s.elements.push(new Gh(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(let e=0;e<i.length-1;e++){s.elements.push(i[e]);const t=this.getInRowSpacing_(i[e],i[e+1]);s.elements.push(new Gh(this.constants_,t))}s.elements.push(i[i.length-1]),s.endsWithElemSpacer()&&(i=this.getInRowSpacing_(i[i.length-1],null),e&&s.hasDummyInput&&(i+=this.constants_.TAB_WIDTH),s.elements.push(new Gh(this.constants_,i)))}}}getInRowSpacing_(e,t){if(!e)return t&&xh.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&xh.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&xh.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!xh.isInput(e)&&!t)return xh.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:xh.isIcon(e)?2*this.constants_.LARGE_PADDING+1:xh.isHat(e)?this.constants_.NO_PADDING:xh.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:xh.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:xh.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(xh.isInput(e)&&!t){if(xh.isExternalInput(e))return this.constants_.NO_PADDING;if(xh.isInlineInput(e))return this.constants_.LARGE_PADDING;if(xh.isStatementInput(e))return this.constants_.NO_PADDING}if(!xh.isInput(e)&&t&&xh.isInput(t)){if(xh.isField(e)&&e.isEditable){if(xh.isInlineInput(t)||xh.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if(xh.isInlineInput(t)||xh.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if(xh.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(xh.isIcon(e)&&t&&!xh.isInput(t))return this.constants_.LARGE_PADDING;if(xh.isInlineInput(e)&&t&&xh.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(xh.isLeftSquareCorner(e)&&t){if(xh.isHat(t))return this.constants_.NO_PADDING;if(xh.isPreviousConnection(t)||xh.isNextConnection(t))return t.notchOffset}return xh.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:xh.isField(e)&&t&&xh.isField(t)&&e.isEditable===t.isEditable||t&&xh.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return xh.isTopRow(e)&&xh.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:xh.isTopRow(e)||xh.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if(xh.isSpacer(t))return e.yPos+t.height/2;if(xh.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,xh.isNextConnection(t)?e+t.height/2:e-t.height/2;if(xh.isTopRow(e))return xh.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return xh.isField(t)&&e.hasStatement?i+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):i+e.height/2}finalize_(){let e=0,t=0;for(var i=0;i<this.rows.length;i++){const n=this.rows[i];n.yPos=t,n.xPos=this.startX,t+=n.height,e=Math.max(e,n.widthWithConnectedBlocks);var s=t-this.topRow.ascenderHeight;n===this.bottomRow&&s<this.constants_.MIN_BLOCK_HEIGHT&&(s=this.constants_.MIN_BLOCK_HEIGHT-s,this.bottomRow.height+=s,t+=s),this.recordElemPositions_(n)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}},Og=class extends _d{constructor(e){super(e)}makeRenderInfo_(e){return new Sg(this,e)}};Ao("thrasos",Og);var Ag={};Ag.RenderInfo=Sg,Ag.Renderer=Og;var wg=new qu("zelos",{colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},{colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}}),Rg={Classic:Ju,Zelos:wg},Ng=class{constructor(e,t,i){this.id_=e.toolboxitemid||C(),this.level_=(this.parent_=i||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}},xg=class extends Ng{constructor(e,t,i){super(e,t,i),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),"true"===this.toolboxItemDef_.hidden&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let t=0;t<e.length;t++){const i=e[t];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(i)}}parseCategoryDef_(e){this.name_="name"in e?wn(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),Mi(this.htmlDiv_,Bc.TREEITEM),Bi(this.htmlDiv_,Pc.SELECTED,!1),Bi(this.htmlDiv_,Pc.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),Mi(this.iconDom_,Bc.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&Bi(this.htmlDiv_,Pc.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&ne(e,t),e}createRowContainer_(){const e=document.createElement("div");var t=this.cssConfig_.row;return t&&ne(e,t),t=xg.nestedPadding*this.getLevel()+"px",this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){const e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&ne(e,t),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&ne(e,t)}return e.style.display="inline-block",e}createLabelDom_(e){const t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&ne(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=xg.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle_(t);if(e)return this.parseColour_(e)}return""}getColourfromStyle_(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour_(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour_(e){if(null==(e=wn(e))||""===e)return"";var t=Number(e);return isNaN(t)?(t=yn(e))?t:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):Sn(t)}openIcon_(e){if(e){var t=this.cssConfig_.closedicon;t&&oe(e,t),(t=this.cssConfig_.openicon)&&ne(e,t)}}closeIcon_(e){if(e){var t=this.cssConfig_.openicon;t&&oe(e,t),(t=this.cssConfig_.closedicon)&&ne(e,t)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(!(e=e.getParent()).isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var t=this.cssConfig_.selected;if(e){const e=this.parseColour_(xg.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||e,t&&ne(this.rowDiv_,t)}else this.rowDiv_.style.backgroundColor="",t&&re(this.rowDiv_,t);Bi(this.htmlDiv_,Pc.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_="string"==typeof e?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:Pe(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){le(this.htmlDiv_)}};xg.registrationName="category",xg.nestedPadding=19,xg.borderWidth=8,xg.defaultBackgroundColour="#57e",ee('\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n'),t(Ur.TOOLBOX_ITEM,xg.registrationName,xg);var Lg=class extends Ng{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv_=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div"),t=this.cssConfig_.container;return t&&ne(e,t),this.htmlDiv_=e}getDiv(){return this.htmlDiv_}dispose(){le(this.htmlDiv_)}};Lg.registrationName="sep",ee('\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n'),t(Ur.TOOLBOX_ITEM,Lg.registrationName,Lg);var $g=class extends xg{constructor(e,t,i){super(e,t,i),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxContents",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const t=e.contents;if(t){this.flyoutItems_=[],e=!0;for(let i=0;i<t.length;i++){const s=t[i];!o(Ur.TOOLBOX_ITEM,s.kind)||s.kind.toLowerCase()===Lg.registrationName&&e?(this.flyoutItems_.push(s),e=!0):(this.createToolboxItem_(s),e=!1)}}}}createToolboxItem_(e){let t=e.kind;"CATEGORY"===t.toUpperCase()&&He(e)&&(t=$g.registrationName),e=new(r(Ur.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded("true"===this.toolboxItemDef_.expanded||!0===this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),Mi(this.subcategoriesDiv_,Bc.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),Bi(this.htmlDiv_,Pc.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const t=this.cssConfig_.icon;t&&ne(e,t),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const t=document.createElement("div");t.style.display="none";var i=this.cssConfig_.contents;for(i&&ne(t,i),i=0;i<e.length;i++){const s=e[i];s.init();const n=s.getDiv();if(t.appendChild(n),s.getClickTarget){let e;null==(e=s.getClickTarget())||e.setAttribute("id",s.getId())}}return t}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let e;null==(e=this.parentToolbox_.getFlyout())||e.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}Bi(this.htmlDiv_,Pc.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const t=this.getChildToolboxItems();for(let i=0;i<t.length;i++)t[i].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};$g.registrationName="collapsibleCategory",t(Ur.TOOLBOX_ITEM,$g.registrationName,$g);var Dg=class extends Gd{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout_=e.options.horizontalLayout,this.RTL=e.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const t=e.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),ce(this.flyout_.createDom("svg"),t),this.setVisible(!0),this.flyout_.init(e),this.render(this.toolboxDef_),(e=e.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[qa.Capability.AUTOHIDEABLE,qa.Capability.DELETE_AREA,qa.Capability.DRAG_TARGET]})}createDom_(e){e=e.getParentSvg();const t=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,Mi(this.contentsDiv_,Bc.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),ne(e,"blocklyToolboxDiv"),ne(e,"blocklyNonSelectable"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return ne(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=Y(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=Y(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){if(q(e)||e.target===this.HtmlDiv)g().hideChaff(!1);else{var t=e.target.getAttribute("id");t&&(t=this.getToolboxItemById(t)).isSelectable()&&(this.setSelectedItem(t),t.onClick(e)),g().hideChaff(!0)}G()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext_();break;case"ArrowUp":t=this.selectPrevious_();break;case"ArrowLeft":t=this.selectParent_();break;case"ArrowRight":t=this.selectChild_();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}!t&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(t=this.selectedItem_.onKeyDown(e)),t&&e.preventDefault()}createFlyout_(){const e=this.workspace_,t=new Zu({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?c(Ur.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):c(Ur.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e;for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t&&t.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const t=document.createDocumentFragment();for(let i=0;i<e.length;i++)this.createToolboxItem_(e[i],t);this.contentsDiv_.appendChild(t)}createToolboxItem_(e,t){var i=e.kind;"CATEGORY"===i.toUpperCase()&&He(e)&&(i=$g.registrationName),(i=r(Ur.TOOLBOX_ITEM,i.toLowerCase()))&&((e=new i(e,this)).init(),this.addToolboxItem_(e),(i=e.getDiv())&&t.appendChild(i),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible()){e=e.getChildToolboxItems();for(let t=0;t<e.length;t++)this.addToolboxItem_(e[t])}}getToolboxItems(){return this.contents_}addStyle(e){e&&this.HtmlDiv&&ne(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&re(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const t=e.top,i=t+e.height,s=e.left;return e=s+e.width,this.toolboxPosition===Al.TOP?new dl(-1e7,i,-1e7,1e7):this.toolboxPosition===Al.BOTTOM?new dl(t,1e7,-1e7,1e7):this.toolboxPosition===Al.LEFT?new dl(-1e7,1e7,-1e7,e):new dl(-1e7,1e7,s,1e7)}wouldDelete(e,t){return e instanceof Fd?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contentMap_[e]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout_?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===Al.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===Al.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const e=this.workspace_,t=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition===Al.LEFT?e.scrollX+t.width:e.scrollX,this.toolboxPosition===Al.TOP?e.scrollY+t.height:e.scrollY),E(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let e=0;e<this.contents_.length;e++){const t=this.contents_[e];t.refreshTheme&&t.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(e){const t=this.selectedItem_;!e&&!t||e&&!xr(e)||(this.shouldDeselectItem_(t,e)&&null!==t&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&null!==e&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent_(t,e))}shouldDeselectItem_(e,t){return null!==e&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return null!==t&&t!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),Bi(this.contentsDiv_,Pc.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),Bi(this.contentsDiv_,Pc.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e]).isSelectable()&&this.setSelectedItem(e)}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout_.show(t.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(e,t){const i=e&&e.getName();let s=t&&t.getName();e===t&&(s=null),e=new(P("toolbox_item_select"))(i,s,this.workspace_.id),w(e)}selectParent_(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext_():e.toggleExpanded(),!0}selectNext_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[++e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){let t=this.contents_[e];for(;t&&!t.isSelectable();)t=this.contents_[--e];if(t&&t.isSelectable())return this.setSelectedItem(t),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout_.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)X(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),le(this.HtmlDiv))}};ee('\n.blocklyToolboxDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url("<<<PATH>>>/handclosed.cur"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n'),t(Ur.TOOLBOX,Fr,Dg);var Mg=Dr.Align$$module$build$src$core$inputs$align.LEFT,Bg=Dr.Align$$module$build$src$core$inputs$align.CENTRE,Pg=Dr.Align$$module$build$src$core$inputs$align.RIGHT,Fg=Ac.INPUT_VALUE,Ug=Ac.OUTPUT_VALUE,Hg=Ac.NEXT_STATEMENT,Gg=Ac.PREVIOUS_STATEMENT,Vg=Dr.inputTypes$$module$build$src$core$inputs$input_types.DUMMY,jg=Al.TOP,Wg=Al.BOTTOM,Yg=Al.LEFT,zg=Al.RIGHT;Cd.prototype.newBlock=function(e,t){return new Nd(this,e,t)},Od.prototype.newBlock=function(e,t){return new Fd(this,e,t)},Od.newTrashcan=function(e){return new Vd(e)},rc.prototype.showContextMenu=function(e){if(!this.workspace.options.readOnly){var t=[];this.isDeletable()&&this.isMovable()&&(t.push(as(this)),t.push(rs(this))),Qi(e,t,this.RTL)}},fh.prototype.newWorkspaceSvg=function(e){return new Od(e)},Dr.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=(e=uo(e))[0].concat(e[1]);for(let t=0;t<e.length;t++)this.getName(e[t][0],Dr.Names$$module$build$src$core$names.NameType.PROCEDURE)};var Xg=Ac,Kg={ALIGN_CENTRE:Bg,ALIGN_LEFT:Mg,ALIGN_RIGHT:Pg};return Kg.ASTNode=cd,Kg.BasicCursor=$d,Kg.Block=Nd,Kg.BlockDragger=bp,Kg.BlockSvg=Fd,Kg.Blocks=jr,Kg.Bubble=mh,Kg.BubbleDragger=Cu,Kg.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD",Kg.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",Kg.COLLAPSE_CHARS=30,Kg.CodeGenerator=Dr.CodeGenerator$$module$build$src$core$generator,Kg.CollapsibleToolboxCategory=$g,Kg.ComponentManager=qa,Kg.Connection=pd,Kg.ConnectionChecker=yd,Kg.ConnectionDB=Rc,Kg.ConnectionType=Ac,Kg.ContextMenu=eu,Kg.ContextMenuItems=Yp,Kg.ContextMenuRegistry=tu,Kg.Css=Qa,Kg.Cursor=Ld,Kg.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID",Kg.DRAG_STACK=!0,Kg.DUMMY_INPUT=Vg,Kg.DeleteArea=Gd,Kg.DragTarget=Hd,Kg.DropDownDiv=yu,Kg.Events=Np,Kg.Extensions=Eh,Kg.Field=oh,Kg.FieldAngle=Xp,Kg.FieldCheckbox=qp,Kg.FieldColour=Jp,Kg.FieldDropdown=dh,Kg.FieldImage=$p,Kg.FieldLabel=sd,Kg.FieldLabelSerializable=Zp,Kg.FieldMultilineInput=Qp,Kg.FieldNumber=eg,Kg.FieldTextInput=Mp,Kg.FieldVariable=tg,Kg.Flyout=og,Kg.FlyoutButton=ig,Kg.FlyoutMetricsManager=ng,Kg.Generator=Dr.CodeGenerator$$module$build$src$core$generator,Kg.Gesture=Yu,Kg.Grid=zu,Kg.HorizontalFlyout=rg,Kg.INPUT_VALUE=Fg,Kg.Input=nd,Kg.InsertionMarkerManager=gd,Kg.InsertionMarkerPreviewer=ug,Kg.Marker=xd,Kg.MarkerManager=Xu,Kg.Menu=Vc,Kg.MenuItem=jc,Kg.MetricsManager=gp,Kg.Msg=Dr.Msg$$module$build$src$core$msg,Kg.NEXT_STATEMENT=Hg,Kg.Names=Dr.Names$$module$build$src$core$names,Kg.OPPOSITE_TYPE=Su,Kg.OUTPUT_VALUE=Ug,Kg.Options=Zu,Kg.PREVIOUS_STATEMENT=Gg,Kg.PROCEDURE_CATEGORY_NAME="PROCEDURE",Kg.Procedures=Rh,Kg.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID",Kg.RenderedConnection=Md,Kg.Scrollbar=Tl,Kg.ScrollbarPair=pp,Kg.ShortcutItems=ap,Kg.ShortcutRegistry=np,Kg.TOOLBOX_AT_BOTTOM=Wg,Kg.TOOLBOX_AT_LEFT=Yg,Kg.TOOLBOX_AT_RIGHT=zg,Kg.TOOLBOX_AT_TOP=jg,Kg.TabNavigateCursor=Dd,Kg.Theme=qu,Kg.ThemeManager=Td,Kg.Themes=Rg,Kg.Toolbox=Dg,Kg.ToolboxCategory=xg,Kg.ToolboxItem=Ng,Kg.ToolboxSeparator=Lg,Kg.Tooltip=ju,Kg.Touch=Ma,Kg.Trashcan=Vd,Kg.UnattachedFieldError=rh,Kg.VARIABLE_CATEGORY_NAME="VARIABLE",Kg.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC",Kg.VERSION="10.4.1",Kg.VariableMap=vd,Kg.VariableModel=Zl,Kg.Variables=tc,Kg.VariablesDynamic=Ed,Kg.VerticalFlyout=ag,Kg.WidgetDiv=qc,Kg.Workspace=Cd,Kg.WorkspaceAudio=Sd,Kg.WorkspaceComment=ic,Kg.WorkspaceCommentSvg=rc,Kg.WorkspaceDragger=Wu,Kg.WorkspaceSvg=Od,Kg.Xml=pc,Kg.ZoomControls=Ul,Kg.blockAnimations=vu,Kg.blockRendering=bd,Kg.browserEvents=za,Kg.bubbles=Tp,Kg.bumpObjects=_p,Kg.clipboard=Mc,Kg.common=Kr,Kg.config=Dr.config$$module$build$src$core$config,Kg.connectionTypes=Xg,Kg.constants={COLLAPSED_FIELD_NAME:"_TEMP_COLLAPSED_FIELD",COLLAPSED_INPUT_NAME:"_TEMP_COLLAPSED_INPUT"},Kg.defineBlocksWithJsonArray=k,Kg.dialog=Xl,Kg.fieldRegistry=hh,Kg.geras=Eg,Kg.getMainWorkspace=g,Kg.getSelected=f,Kg.hasBubble=fn,Kg.hideChaff=Lr,Kg.icons=Nh,Kg.inject=kr,Kg.inputTypes=Dr.inputTypes$$module$build$src$core$inputs$input_types,Kg.inputs=cg,Kg.isCopyable=Bo,Kg.isIcon=Rr,Kg.isObservable=Ln,Kg.isPaster=Nr,Kg.isSerializable=ii,Kg.isVariableBackedParameterModel=it,Kg.minimalist=Cg,Kg.procedures=Rh,Kg.registry=Hr,Kg.renderManagement=dc,Kg.serialization=dp,Kg.setLocale=Gl,Kg.setParentContainer=T,Kg.svgResize=E,Kg.thrasos=Ag,Kg.uiPosition=Ml,Kg.utils=Ih,Kg.zelos=Wp,Object.defineProperties(Kg,{HSV_SATURATION:{get:function(){return ie("Blockly.HSV_SATURATION","version 10","version 11","Blockly.utils.colour.getHsvSaturation()"),_n()},set:function(e){ie("Blockly.HSV_SATURATION","version 10","version 11","Blockly.utils.colour.setHsvSaturation()"),bn(e)}},HSV_VALUE:{get:function(){return ie("Blockly.HSV_VALUE","version 10","version 11","Blockly.utils.colour.getHsvValue()"),Tn()},set:function(e){ie("Blockly.HSV_VALUE","version 10","version 11","Blockly.utils.colour.setHsvValue()"),En(e)}}}),"Blockly"in globalThis||(globalThis.Blockly={Msg:Vl}),Kg.__namespace__=Dr,Kg},"function"==typeof define&&define.amd?define([],n):"object"==typeof i?t.exports=n():s.Blockly=n()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],193:[function(e,t,i){var s,n;s=this,n=function(e){return e},"function"==typeof define&&define.amd?define(["./blocks_compressed"],n):"object"==typeof i?t.exports=e("./blocks_compressed"):s.BlocklyBlocks=s.BlocklyBlocks},{"./blocks_compressed":194}],194:[function(e,t,i){var s,n;s=this,n=function(e){var t=e.__namespace__,i=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),s={customContextMenu:function(e){if(this.isInFlyout)"variables_get_dynamic"!==this.type&&"variables_get_reporter_dynamic"!==this.type||(s={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:n(this)},r=this.getField("VAR").getText(),r={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",r),enabled:!0,callback:o(this)},e.unshift(s),e.unshift(r));else{if("variables_get_dynamic"===this.type)var i="variables_set_dynamic",s=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else i="variables_get_dynamic",s=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var r=this.getField("VAR");i={type:i,fields:{VAR:r.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:s.replace("%1",r.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)})}},onchange:function(e){e=this.getFieldValue("VAR"),e=t.getVariable$$module$build$src$core$variables(this.workspace,e),"variables_get_dynamic"===this.type?this.outputConnection.setCheck(e.type):this.getInput("VALUE").connection.setCheck(e.type)}},n=function(e){return function(){const i=e.workspace,s=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(i,s)}},o=function(e){return function(){const t=e.workspace,i=e.getField("VAR").getVariable();t.deleteVariableById(i.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",s),t.defineBlocks$$module$build$src$core$common(i);var r={blocks:i},a=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),l={customContextMenu:function(e){if(this.isInFlyout)"variables_get"!==this.type&&"variables_get_reporter"!==this.type||(s={text:t.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:c(this)},n=this.getField("VAR").getText(),n={text:t.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",n),enabled:!0,callback:u(this)},e.unshift(s),e.unshift(n));else{if("variables_get"===this.type)var i="variables_set",s=t.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else i="variables_get",s=t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var n=this.getField("VAR");i={type:i,fields:{VAR:n.saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:s.replace("%1",n.getText()),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)})}}},c=function(e){return function(){const i=e.workspace,s=e.getField("VAR").getVariable();t.renameVariable$$module$build$src$core$variables(i,s)}},u=function(e){return function(){const t=e.workspace,i=e.getField("VAR").getVariable();t.deleteVariableById(i.getId()),t.refreshToolboxSelection()}};t.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",l),t.defineBlocks$$module$build$src$core$common(a);var h={blocks:a},d=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_multiline",message0:"%1 %2",args0:[{type:"field_image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAARCAYAAADpPU2iAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAdhgAAHYYBXaITgQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMS42/U4J6AAAAP1JREFUOE+Vks0KQUEYhjmRIja4ABtZ2dm5A3t3Ia6AUm7CylYuQRaUhZSlLZJiQbFAyRnPN33y01HOW08z8873zpwzM4F3GWOCruvGIE4/rLaV+Nq1hVGMBqzhqlxgCys4wJA65xnogMHsQ5lujnYHTejBBCK2mE4abjCgMGhNxHgDFWjDSG07kdfVa2pZMf4ZyMAdWmpZMfYOsLiDMYMjlMB+K613QISRhTnITnsYg5yUd0DETmEoMlkFOeIT/A58iyK5E18BuTBfgYXfwNJv4P9/oEBerLylOnRhygmGdPpTTBZAPkde61lbQe4moWUvYUZYLfUNftIY4zwA5X2Z9AYnQrEAAAAASUVORK5CYII=",width:12,height:17,alt:"¶"},{type:"field_multilinetext",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),p={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var i=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",`${i}`),i=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",`${i}`),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),2===e&&t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL));const s=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});s.setValidator((function(t){const s="FROM_START"===t||"FROM_END"===t;if(s!==i){const i=this.getSourceBlock();return i.updateAt_(e,s),i.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(s,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}};d.text_getSubstring=p,d.text_changeCase={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},d.text_trim={init:function(){const e=[[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[t.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},d.text_print={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var g={updateType_:function(e){this.outputConnection.setCheck("NUMBER"===e?"Number":"String")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("type",this.getFieldValue("TYPE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("type"))}};d.text_prompt_ext=Object.assign({},g,{init:function(){var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendValueInput("TEXT").appendField(e,"TYPE"),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});var m=Object.assign({},g,{init:function(){this.mixin(f);var e=[[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((e=>{this.updateType_(e)})),this.appendDummyInput().appendField(e,"TYPE").appendField(this.newQuote_(!0)).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip((()=>"TEXT"===this.getFieldValue("TYPE")?t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER))}});d.text_prompt=m,d.text_count={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},d.text_replace={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},d.text_reverse={init:function(){this.jsonInit({message0:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:t.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var f={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(e){for(let t,i=0;t=this.inputList[i];i++)for(let i,s=0;i=t.fieldRow[s];s++)if(e===i.name)return t.insertFieldAt(s,this.newQuote_(!0)),void t.insertFieldAt(s+2,this.newQuote_(!1));console.warn('field named "'+e+'" not found in '+this.toDevString())},newQuote_:function(e){return e=this.RTL?!e:e,t.fromJson$$module$build$src$core$field_registry({type:"field_image",src:e?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:e?"“":"”"})}},_={itemCount_:0,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",`${this.itemCount_}`),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("text_create_join_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("text_create_join_item");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const i=this.getInput("ADD"+t).connection.targetConnection;i&&-1===e.indexOf(i)&&i.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let i;null==(i=e[t])||i.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const i=this.getInput("ADD"+t);e.valueConnection_=i&&i.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const i=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&i.appendField(t.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};t.register$$module$build$src$core$extensions("text_append_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var b={isAt_:!1,mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("at",`${this.isAt_}`),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),e&&(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=e}};t.register$$module$build$src$core$extensions("text_indexOf_tooltip",(function(){this.setTooltip((()=>t.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))})),t.register$$module$build$src$core$extensions("text_quotes",(function(){this.mixin(f),this.quoteField_("TEXT")})),t.registerMixin$$module$build$src$core$extensions("quote_image_mixin",f),t.registerMutator$$module$build$src$core$extensions("text_join_mutator",_,(function(){this.mixin(f),this.itemCount_=2,this.updateShape_(),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))})),t.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",b,(function(){this.getField("WHERE").setValidator((function(e){e="FROM_START"===e||"FROM_END"===e;const t=this.getSourceBlock();e!==t.isAt_&&t.updateAt_(e)})),this.updateAt_(!0),this.setTooltip((()=>{var e=this.getFieldValue("WHERE");let i=t.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return("FROM_START"===e||"FROM_END"===e)&&(e="FROM_START"===e?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(i+="  "+e.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i}))})),t.defineBlocks$$module$build$src$core$common(d);var T={blocks:d},E={},y={setStatements_:function(e){this.hasStatements_!==e&&(e?(this.appendStatementInput("STACK").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=e)},updateParams_:function(){let e="";this.arguments_.length&&(e=t.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),t.disable$$module$build$src$core$events$utils();try{this.setFieldValue(e,"PARAMS")}finally{t.enable$$module$build$src$core$events$utils()}},mutationToDom:function(e){const i=t.createElement$$module$build$src$core$utils$xml("mutation");e&&i.setAttribute("name",this.getFieldValue("NAME"));for(let s=0;s<this.argumentVarModels_.length;s++){const n=t.createElement$$module$build$src$core$utils$xml("arg"),o=this.argumentVarModels_[s];n.setAttribute("name",o.name),n.setAttribute("varid",o.getId()),e&&this.paramIds_&&n.setAttribute("paramId",this.paramIds_[s]),i.appendChild(n)}return this.hasStatements_||i.setAttribute("statements","false"),i},domToMutation:function(e){this.arguments_=[],this.argumentVarModels_=[];for(let s,n=0;s=e.childNodes[n];n++)if("arg"===s.nodeName.toLowerCase()){var i=s;const e=i.getAttribute("name");i=i.getAttribute("varid")||i.getAttribute("varId"),this.arguments_.push(e),null!==(i=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,i,e,""))?this.argumentVarModels_.push(i):console.log(`Failed to create a variable named "${e}", ignoring.`)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_("false"!==e.getAttribute("statements"))},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const e=Object.create(null);if(this.argumentVarModels_.length){e.params=[];for(let t=0;t<this.argumentVarModels_.length;t++)e.params.push({name:this.argumentVarModels_[t].name,id:this.argumentVarModels_[t].getId()})}return this.hasStatements_||(e.hasStatements=!1),e},loadExtraState:function(e){if(this.arguments_=[],this.argumentVarModels_=[],e.params)for(let s=0;s<e.params.length;s++){var i=e.params[s];i=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,i.id,i.name,""),this.arguments_.push(i.name),this.argumentVarModels_.push(i)}this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(!1!==e.hasStatements)},decompose:function(e){const i=t.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_mutatorcontainer");var s=t.createElement$$module$build$src$core$utils$xml("statement");s.setAttribute("name","STACK"),i.appendChild(s);for(let e=0;e<this.arguments_.length;e++){const i=t.createElement$$module$build$src$core$utils$xml("block");i.setAttribute("type","procedures_mutatorarg");var n=t.createElement$$module$build$src$core$utils$xml("field");n.setAttribute("name","NAME");const o=t.createTextNode$$module$build$src$core$utils$xml(this.arguments_[e]);n.appendChild(o),i.appendChild(n),n=t.createElement$$module$build$src$core$utils$xml("next"),i.appendChild(n),s.appendChild(i),s=n}return e=t.domToBlock$$module$build$src$core$xml(i,e),"procedures_defreturn"===this.type?e.setFieldValue(this.hasStatements_,"STATEMENTS"):e.removeInput("STATEMENT_INPUT"),t.mutateCallers$$module$build$src$core$procedures(this),e},compose:function(e){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let i=e.getInputTargetBlock("STACK");for(;i&&!i.isInsertionMarker();){var s=i.getFieldValue("NAME");this.arguments_.push(s),s=this.workspace.getVariable(s,""),this.argumentVarModels_.push(s),this.paramIds_.push(i.id),i=i.nextConnection&&i.nextConnection.targetBlock()}if(this.updateParams_(),t.mutateCallers$$module$build$src$core$procedures(this),null!==(e=e.getFieldValue("STATEMENTS"))&&(e="TRUE"===e,this.hasStatements_!==e))if(e){var n;this.setStatements_(!0),null==(n=this.statementConnection_)||n.reconnect(this,"STACK"),this.statementConnection_=null}else n=this.getInput("STACK").connection,(this.statementConnection_=n.targetConnection)&&((n=n.targetBlock()).unplug(),n.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(e,i){var s=this.workspace.getVariableById(e);if(""===s.type){s=s.name,i=this.workspace.getVariableById(i);var n=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e&&(this.arguments_[t]=i.name,this.argumentVarModels_[t]=i,n=!0);n&&(this.displayRenamedVar_(s,i.name),t.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(e){const i=e.name;let s,n=!1;for(let t=0;t<this.argumentVarModels_.length;t++)this.argumentVarModels_[t].getId()===e.getId()&&(s=this.arguments_[t],this.arguments_[t]=i,n=!0);n&&(this.displayRenamedVar_(s,i),t.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(e,i){this.updateParams_();var s=this.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(s&&s.bubbleIsVisible()){s=s.getWorkspace().getAllBlocks(!1);for(let n,o=0;n=s[o];o++)"procedures_mutatorarg"===n.type&&t.Names$$module$build$src$core$names.equals(e,n.getFieldValue("NAME"))&&n.setFieldValue(i,"NAME")}},customContextMenu:function(e){if(!this.isInFlyout){var i=this.getFieldValue("NAME"),s={type:this.callType_,extraState:{name:i,params:this.arguments_}};if(e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",i),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,s)}),!this.isCollapsed())for(i=0;i<this.argumentVarModels_.length;i++){const n={type:"variables_get",fields:{VAR:{name:(s=this.argumentVarModels_[i]).name,id:s.getId(),type:s.type}}};e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",s.name),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,n)})}}}};E.procedures_defnoreturn=Object.assign({},y,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),E.procedures_defreturn=Object.assign({},y,{init:function(){var e=t.findLegalName$$module$build$src$core$procedures("",this);(e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(t.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(t.Align$$module$build$src$core$inputs$input.RIGHT).appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var I={init:function(){this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(t.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};E.procedures_mutatorcontainer=I;var k={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_input",text:t.DEFAULT_ARG$$module$build$src$core$procedures});e.setValidator(this.validator_),e.oldShowEditorFn_=e.showEditor_,e.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,e.onFinishEditing_=this.deleteIntermediateVars_,e.createdVariables_=[],e.onFinishEditing_("x")},validator_:function(e){var t=this.getSourceBlock();const i=t.workspace.getRootWorkspace();if(!(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;const s=(t.workspace.targetWorkspace||t.workspace).getAllBlocks(!1),n=e.toLowerCase();for(let e=0;e<s.length;e++){if(s[e].id===this.getSourceBlock().id)continue;const t=s[e].getFieldValue("NAME");if(t&&t.toLowerCase()===n)return null}return t.isInFlyout||((t=i.getVariable(e,""))&&t.name!==e&&i.renameVariableById(t.getId(),e),t||(t=i.createVariable(e,""))&&this.createdVariables_&&this.createdVariables_.push(t)),e},deleteIntermediateVars_:function(e){const t=this.getSourceBlock().workspace.getRootWorkspace();if(t)for(let i=0;i<this.createdVariables_.length;i++){const s=this.createdVariables_[i];s.name!==e&&t.deleteVariableById(s.getId())}}};E.procedures_mutatorarg=k;var v={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,i){t.Names$$module$build$src$core$names.equals(e,this.getProcedureCall())&&(this.setFieldValue(i,"NAME"),this.setTooltip((this.outputConnection?t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",i)))},setProcedureParameters_:function(e,i){var s=t.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((s=(s=s&&s.getIcon(t.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&s.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),e.join("\n")===this.arguments_.join("\n"))this.quarkIds_=i;else{if(i.length!==e.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let e=0;e<this.arguments_.length;e++){var n=this.getInput("ARG"+e);n&&(n=n.connection.targetConnection,this.quarkConnections_[this.quarkIds_[e]]=n,s&&n&&-1===i.indexOf(this.quarkIds_[e])&&(n.disconnect(),n.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(e),this.argumentVarModels_=[],e=0;e<this.arguments_.length;e++)s=t.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[e],""),this.argumentVarModels_.push(s);if(this.updateShape_(),this.quarkIds_=i)for(i=0;i<this.arguments_.length;i++)if((e=this.quarkIds_[i])in this.quarkConnections_){let t;null!=(t=this.quarkConnections_[e])&&t.reconnect(this,"ARG"+i)||delete this.quarkConnections_[e]}}},updateShape_:function(){for(var e=0;e<this.arguments_.length;e++){var i=this.getField("ARGNAME"+e);if(i){t.disable$$module$build$src$core$events$utils();try{i.setValue(this.arguments_[e])}finally{t.enable$$module$build$src$core$events$utils()}}else i=t.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[e]}),this.appendValueInput("ARG"+e).setAlign(t.Align$$module$build$src$core$inputs$input.RIGHT).appendField(i,"ARGNAME"+e).init()}for(e=this.arguments_.length;this.getInput("ARG"+e);e++)this.removeInput("ARG"+e);(e=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||(e.appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"),e.init()):this.getField("WITH")&&e.removeField("WITH"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("name",this.getProcedureCall());for(let i=0;i<this.arguments_.length;i++){const s=t.createElement$$module$build$src$core$utils$xml("arg");s.setAttribute("name",this.arguments_[i]),e.appendChild(s)}return e},domToMutation:function(e){var t=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),t),t=[];const i=[];for(let s,n=0;s=e.childNodes[n];n++)"arg"===s.nodeName.toLowerCase()&&(t.push(s.getAttribute("name")),i.push(s.getAttribute("paramId")));this.setProcedureParameters_(t,i)},saveExtraState:function(){const e=Object.create(null);return e.name=this.getProcedureCall(),this.arguments_.length&&(e.params=this.arguments_),e},loadExtraState:function(e){if(this.renameProcedure(this.getProcedureCall(),e.name),e=e.params){const t=[];t.length=e.length,t.fill(null),this.setProcedureParameters_(e,t)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&e.recordUndo)if(e.type===t.CREATE$$module$build$src$core$events$utils&&-1!==e.ids.indexOf(this.id)){var i=this.getProcedureCall();if(!(i=t.getDefinition$$module$build$src$core$procedures(i,this.workspace))||i.type===this.defType_&&JSON.stringify(i.getVars())===JSON.stringify(this.arguments_)||(i=null),!i){t.setGroup$$module$build$src$core$events$utils(e.group),e=t.createElement$$module$build$src$core$utils$xml("xml"),(i=t.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type",this.defType_);var s=this.getRelativeToSurfaceXY(),n=s.y+2*t.config$$module$build$src$core$config.snapRadius;i.setAttribute("x",`${s.x+t.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),i.setAttribute("y",`${n}`),s=this.mutationToDom(),i.appendChild(s),(s=t.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),n=this.getProcedureCall();const o=t.findLegalName$$module$build$src$core$procedures(n,this);n!==o&&this.renameProcedure(n,o),s.appendChild(t.createTextNode$$module$build$src$core$utils$xml(n)),i.appendChild(s),e.appendChild(i),t.domToWorkspace$$module$build$src$core$xml(e,this.workspace),t.setGroup$$module$build$src$core$events$utils(!1)}}else e.type===t.DELETE$$module$build$src$core$events$utils?(i=this.getProcedureCall(),t.getDefinition$$module$build$src$core$procedures(i,this.workspace)||(t.setGroup$$module$build$src$core$events$utils(e.group),this.dispose(!0),t.setGroup$$module$build$src$core$events$utils(!1))):e.type===t.CHANGE$$module$build$src$core$events$utils&&"disabled"===e.element&&(i=this.getProcedureCall(),(i=t.getDefinition$$module$build$src$core$procedures(i,this.workspace))&&i.id===e.blockId&&((i=t.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),t.setGroup$$module$build$src$core$events$utils(e.group),e.newValue?(this.previousEnabledState_=this.isEnabled(),this.setEnabled(!1)):this.setEnabled(this.previousEnabledState_),t.setGroup$$module$build$src$core$events$utils(i)))},customContextMenu:function(e){if(this.workspace.isMovable()){var i=this.getProcedureCall(),s=this.workspace;e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const e=t.getDefinition$$module$build$src$core$procedures(i,s);e&&(s.centerOnBlock(e.id),e.select())}})}}};E.procedures_callnoreturn=Object.assign({},v,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},defType_:"procedures_defnoreturn"}),E.procedures_callreturn=Object.assign({},v,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},defType_:"procedures_defreturn"});var C={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("value",String(Number(this.hasReturnValue_))),e},domToMutation:function(e){this.hasReturnValue_="1"===e.getAttribute("value"),this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(e){if(!(this.workspace.isDragging&&this.workspace.isDragging()||e.type!==t.MOVE$$module$build$src$core$events$utils)){var i=!1,s=this;do{if(-1!==this.FUNCTION_TYPES.indexOf(s.type)){i=!0;break}s=s.getSurroundParent()}while(s);i?("procedures_defnoreturn"===s.type&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):"procedures_defreturn"!==s.type||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(t.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(t.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),this.isInFlyout||(s=t.getGroup$$module$build$src$core$events$utils(),t.setGroup$$module$build$src$core$events$utils(e.group),this.setEnabled(i),t.setGroup$$module$build$src$core$events$utils(s))}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};E.procedures_ifreturn=C,t.defineBlocks$$module$build$src$core$common(E);var S={blocks:E},O=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["π","PI"],["e","E"],["φ","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(½)","SQRT1_2"],["∞","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]);t.register$$module$build$src$core$extensions("math_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"}));var A={mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),i="DIVISIBLE_BY"===this.getFieldValue("PROPERTY");return e.setAttribute("divisor_input",String(i)),e},domToMutation:function(e){e="true"===e.getAttribute("divisor_input"),this.updateShape_(e)},updateShape_:function(e){const t=this.getInput("DIVISOR");e?t||this.appendValueInput("DIVISOR").setCheck("Number"):t&&this.removeInput("DIVISOR")}};t.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",A,(function(){this.getField("PROPERTY").setValidator((function(e){e="DIVISIBLE_BY"===e,this.getSourceBlock().updateShape_(e)}))})),t.register$$module$build$src$core$extensions("math_change_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var w={updateType_:function(e){"MODE"===e?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("op",this.getFieldValue("OP")),e},domToMutation:function(e){if(null===(e=e.getAttribute("op")))throw new TypeError("xmlElement had no op attribute");this.updateType_(e)}};t.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",w,(function(){this.getField("OP").setValidator(function(e){this.updateType_(e)}.bind(this))})),t.defineBlocks$$module$build$src$core$common(O);var R={blocks:O},N=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]);t.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",{WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"})),t.register$$module$build$src$core$extensions("controls_flow_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",{BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"}));var x={customContextMenu:function(e){if(!this.isInFlyout){var i=this.getField("VAR"),s=i.getVariable().name;this.isCollapsed()||null===s||(i={type:"variables_get",fields:{VAR:i.saveState(!0)}},e.push({enabled:!0,text:t.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",s),callback:t.callbackFactory$$module$build$src$core$contextmenu(this,i)}))}}};t.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",x),t.register$$module$build$src$core$extensions("controls_for_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),t.register$$module$build$src$core$extensions("controls_forEach_tooltip",t.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var L=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),$={getSurroundLoop:function(){let e=this;do{if(L.has(e.type))return e;e=e.getSurroundParent()}while(e);return null},onchange:function(e){var i=this.workspace;if(i.isDragging&&!i.isDragging()&&e.type===t.MOVE$$module$build$src$core$events$utils&&(i=!!this.getSurroundLoop(),this.setWarningText(i?null:t.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout)){const s=t.getGroup$$module$build$src$core$events$utils();t.setGroup$$module$build$src$core$events$utils(e.group),this.setEnabled(i),t.setGroup$$module$build$src$core$events$utils(s)}}};t.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",$),t.defineBlocks$$module$build$src$core$common(N);var D={blocks:N,loopTypes:L},M=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["≠","NEQ"],["‏<","LT"],["‏≤","LTE"],["‏>","GT"],["‏≥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]);t.register$$module$build$src$core$extensions("logic_op_tooltip",t.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"}));var B={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=t.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&e.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&e.setAttribute("else","1"),e},domToMutation:function(e){this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const e=Object.create(null);return this.elseifCount_&&(e.elseIfCount=this.elseifCount_),this.elseCount_&&(e.hasElse=!0),e},loadExtraState:function(e){this.elseifCount_=e.elseIfCount||0,this.elseCount_=e.hasElse?1:0,this.updateShape_()},decompose:function(e){const t=e.newBlock("controls_if_if");t.initSvg();let i=t.nextConnection;for(let t=1;t<=this.elseifCount_;t++){const t=e.newBlock("controls_if_elseif");t.initSvg(),i.connect(t.previousConnection),i=t.nextConnection}return this.elseCount_&&((e=e.newBlock("controls_if_else")).initSvg(),i.connect(e.previousConnection)),t},compose:function(e){e=e.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const t=[null],i=[null];let s=null;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":this.elseifCount_++,t.push(e.valueConnection_),i.push(e.statementConnection_);break;case"controls_if_else":this.elseCount_++,s=e.statementConnection_;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(t,i,s)},saveConnections:function(e){e=e.nextConnection.targetBlock();let t=1;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":var i=this.getInput("IF"+t);const s=this.getInput("DO"+t);e.valueConnection_=i&&i.connection.targetConnection,e.statementConnection_=s&&s.connection.targetConnection,t++;break;case"controls_if_else":i=this.getInput("ELSE"),e.statementConnection_=i&&i.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}},rebuildShape_:function(){const e=[null],t=[null];let i=null;this.getInput("ELSE")&&(i=this.getInput("ELSE").connection.targetConnection);for(let i=1;this.getInput("IF"+i);i++){const s=this.getInput("IF"+i),n=this.getInput("DO"+i);e.push(s.connection.targetConnection),t.push(n.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(e,t,i)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var e=1;this.getInput("IF"+e);e++)this.removeInput("IF"+e),this.removeInput("DO"+e);for(e=1;e<=this.elseifCount_;e++)this.appendValueInput("IF"+e).setCheck("Boolean").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+e).appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(t.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(e,t,i){for(let i=1;i<=this.elseifCount_;i++){let s,n;null==(s=e[i])||s.reconnect(this,"IF"+i),null==(n=t[i])||n.reconnect(this,"DO"+i)}null==i||i.reconnect(this,"ELSE")}};t.registerMutator$$module$build$src$core$extensions("controls_if_mutator",B,null,["controls_if_elseif","controls_if_else"]),t.register$$module$build$src$core$extensions("controls_if_tooltip",(function(){this.setTooltip(function(){return this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4:"":t.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1}.bind(this))}));var P={onchange:function(e){this.prevBlocks_||(this.prevBlocks_=[null,null]);var i=this.getInputTargetBlock("A");const s=this.getInputTargetBlock("B");i&&s&&!this.workspace.connectionChecker.doTypeChecks(i.outputConnection,s.outputConnection)&&(t.setGroup$$module$build$src$core$events$utils(e.group),(e=this.prevBlocks_[0])!==i&&(i.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("A").connection.connect(e.outputConnection)),(i=this.prevBlocks_[1])!==s&&(s.unplug(),!i||i.isDisposed()||i.isShadow()||this.getInput("B").connection.connect(i.outputConnection)),this.bumpNeighbours(),t.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}};t.register$$module$build$src$core$extensions("logic_compare",(function(){this.mixin(P)}));var F={prevParentConnection_:null,onchange:function(e){const i=this.getInputTargetBlock("THEN"),s=this.getInputTargetBlock("ELSE"),n=this.outputConnection.targetConnection;if((i||s)&&n)for(let o=0;2>o;o++){const r=1===o?i:s;r&&!r.workspace.connectionChecker.doTypeChecks(r.outputConnection,n)&&(t.setGroup$$module$build$src$core$events$utils(e.group),n===this.prevParentConnection_?(this.unplug(),n.getSourceBlock().bumpNeighbours()):(r.unplug(),r.bumpNeighbours()),t.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=n}};t.registerMixin$$module$build$src$core$extensions("logic_ternary",F),t.defineBlocks$$module$build$src$core$common(M);var U=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),H={init:function(){this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new t.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",String(this.itemCount_)),e},domToMutation:function(e){if(!(e=e.getAttribute("items")))throw new TypeError("element did not have items");this.itemCount_=parseInt(e,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(e){const t=e.newBlock("lists_create_with_container");t.initSvg();let i=t.getInput("STACK").connection;for(let t=0;t<this.itemCount_;t++){const t=e.newBlock("lists_create_with_item");if(t.initSvg(),!t.previousConnection)throw Error("itemBlock has no previousConnection");i.connect(t.previousConnection),i=t.nextConnection}return t},compose:function(e){var t=e.getInputTargetBlock("STACK");for(e=[];t;)t.isInsertionMarker()||e.push(t.valueConnection_),t=t.getNextBlock();for(t=0;t<this.itemCount_;t++){const i=this.getInput("ADD"+t).connection.targetConnection;i&&-1===e.indexOf(i)&&i.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),t=0;t<this.itemCount_;t++){let i;null==(i=e[t])||i.reconnect(this,"ADD"+t)}},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){if(e.isInsertionMarker()){e=e.getNextBlock();continue}const i=this.getInput("ADD"+t);let s;e.valueConnection_=null==(s=i)?void 0:s.connection.targetConnection,e=e.getNextBlock(),t++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){const i=this.appendValueInput("ADD"+e).setAlign(t.Align$$module$build$src$core$inputs$align.RIGHT);0===e&&i.appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(e=this.itemCount_;this.getInput("ADD"+e);e++)this.removeInput("ADD"+e)}};U.lists_create_with=H;var G={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};U.lists_create_with_container=G;var V={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};U.lists_create_with_item=V;var j={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),!(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})))throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(e,"END"),this.setInputsInline(!0),this.setTooltip((()=>t.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1")))}};U.lists_indexOf=j;var W={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),(e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator((function(e){e="REMOVE"===e,this.getSourceBlock().updateStatement_(e)})),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),i=this.getFieldValue("WHERE");let s="";switch(e+" "+i){case"GET FROM_START":case"GET FROM_END":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":s=t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return"FROM_START"!==i&&"FROM_END"!==i||(s+="  "+("FROM_START"===i?t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),s}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");e.setAttribute("statement",String(!this.outputConnection));const i=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(i)),e},domToMutation:function(e){const t="true"===e.getAttribute("statement");this.updateStatement_(t),e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(e){e.isStatement?this.updateStatement_(!0):"string"==typeof e&&this.domToMutation(t.textToDom$$module$build$src$core$utils$xml(e))},updateStatement_:function(e){e!==!this.outputConnection&&(this.unplug(!0,!0),e?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==e){const e=this.getSourceBlock();return e.updateAt_(i),e.setFieldValue(t,"WHERE"),null}})),this.getInput("AT").appendField(i,"WHERE"),t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};U.lists_getIndex=W;var Y={init:function(){var e=[[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip((()=>{const e=this.getFieldValue("MODE"),i=this.getFieldValue("WHERE");let s="";switch(e+" "+i){case"SET FROM_START":case"SET FROM_END":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":s=t.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return"FROM_START"!==i&&"FROM_END"!==i||(s+="  "+t.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),s}))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation"),i=this.getInput("AT")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(i)),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const i=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});i.setValidator((function(t){const i="FROM_START"===t||"FROM_END"===t;if(i!==e){const e=this.getSourceBlock();return e.updateAt_(i),e.setFieldValue(t,"WHERE"),null}})),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(i,"WHERE")}};U.lists_setIndex=Y;var z={init:function(){this.WHERE_OPTIONS_1=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");var i=this.getInput("AT1")instanceof t.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",String(i)),i=this.getInput("AT2")instanceof t.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",String(i)),e},domToMutation:function(e){const t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e);const s=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+e]});s.setValidator((function(t){const s="FROM_START"===t||"FROM_END"===t;if(s!==i){const i=this.getSourceBlock();return i.updateAt_(e,s),i.setFieldValue(t,"WHERE"+e),null}})),this.getInput("AT"+e).appendField(s,"WHERE"+e),1===e&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),t.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};U.lists_getSublist=z,U.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},U.lists_split={init:function(){const e=t.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!e)throw Error("field_dropdown not found");e.setValidator((e=>{this.updateType_(e)})),this.setHelpUrl(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(e,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(t.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip((()=>{const e=this.getFieldValue("MODE");if("SPLIT"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if("JOIN"===e)return t.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+e)}))},updateType_:function(e){if(this.getFieldValue("MODE")!==e){const e=this.getInput("INPUT").connection;e.setShadowDom(null);const t=e.targetBlock();t&&(e.disconnect(),t.isShadow()?t.dispose(!1):this.bumpNeighbours())}"SPLIT"===e?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const e=t.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("mode",this.getFieldValue("MODE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("mode"))},saveExtraState:function(){return null},loadExtraState:function(){}},t.defineBlocks$$module$build$src$core$common(U);var X={blocks:U},K=t.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"colour_picker",message0:"%1",args0:[{type:"field_colour",name:"COLOUR",colour:"#ff0000"}],output:"Colour",helpUrl:"%{BKY_COLOUR_PICKER_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_PICKER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"colour_random",message0:"%{BKY_COLOUR_RANDOM_TITLE}",output:"Colour",helpUrl:"%{BKY_COLOUR_RANDOM_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RANDOM_TOOLTIP}"},{type:"colour_rgb",message0:"%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3",args0:[{type:"input_value",name:"RED",check:"Number",align:"RIGHT"},{type:"input_value",name:"GREEN",check:"Number",align:"RIGHT"},{type:"input_value",name:"BLUE",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_RGB_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RGB_TOOLTIP}"},{type:"colour_blend",message0:"%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} %1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3",args0:[{type:"input_value",name:"COLOUR1",check:"Colour",align:"RIGHT"},{type:"input_value",name:"COLOUR2",check:"Colour",align:"RIGHT"},{type:"input_value",name:"RATIO",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_BLEND_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_BLEND_TOOLTIP}"}]);t.defineBlocks$$module$build$src$core$common(K);var q={blocks:K},J={blocks:Object.assign({},K,U,M,N,O,E,a,i),colour:q,lists:X,loops:D,math:R,procedures:S,texts:T,variables:h,variablesDynamic:r};return J.__namespace__=t,J},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],n):"object"==typeof i?t.exports=n(e("./blockly_compressed.js")):s.Blockly.libraryBlocks=n(s.Blockly)},{"./blockly_compressed.js":192}],195:[function(e,t,i){var s,n;s=this,n=function(e,t,i,s){"use strict";return e.setLocale(t),e},"function"==typeof define&&define.amd?define(["./core-browser","./msg/en","./blocks","./javascript"],n):"object"==typeof i?t.exports=n(e("./core-browser"),e("./msg/en"),e("./blocks"),e("./javascript")):s.Blockly=n(s.Blockly,s.En,s.BlocklyBlocks,s.BlocklyJS)},{"./blocks":193,"./core-browser":196,"./javascript":198,"./msg/en":200}],196:[function(e,t,i){var s,n;s=this,n=function(e){"use strict";return e},"function"==typeof define&&define.amd?define(["./blockly"],n):"object"==typeof i?t.exports=n(e("./blockly")):s.Blockly=n(s.Blockly)},{"./blockly":191}],197:[function(e,t,i){var s,n;s=this,n=function(e){return e},"function"==typeof define&&define.amd?define(["./browser"],n):"object"==typeof i?t.exports=e("./node"):s.Blockly=s.Blockly},{"./node":195}],198:[function(e,t,i){var s,n;s=this,n=function(e,t){return t},"function"==typeof define&&define.amd?define(["./core","./javascript_compressed.js"],n):"object"==typeof i?t.exports=n(e("./core"),e("./javascript_compressed.js")):s.BlocklyJavaScript=n(s.Blockly,s.BlocklyJavaScript)},{"./core":196,"./javascript_compressed.js":199}],199:[function(e,t,i){var s,n;s=this,n=function(e){var t,i,s=e.__namespace__,n=function(e,i){var s=0;let n="";i.STATEMENT_PREFIX&&(n+=i.injectId(i.STATEMENT_PREFIX,e));do{const o=i.valueToCode(e,"IF"+s,t.NONE)||"false";let r=i.statementToCode(e,"DO"+s);i.STATEMENT_SUFFIX&&(r=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+r),n+=(0<s?" else ":"")+"if ("+o+") {\n"+r+"}",s++}while(e.getInput("IF"+s));return(e.getInput("ELSE")||i.STATEMENT_SUFFIX)&&(s=i.statementToCode(e,"ELSE"),i.STATEMENT_SUFFIX&&(s=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)+s),n+=" else {\n"+s+"}"),n+"\n"},o=function(e,i){let n;n=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):i.valueToCode(e,"TIMES",t.ASSIGNMENT)||"0";let o=i.statementToCode(e,"DO");o=i.addLoopTrap(o,e),e="";const r=i.nameDB_.getDistinctName("count",s.NameType$$module$build$src$core$names.VARIABLE);let a=n;return n.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string(n)||(e+="var "+(a=i.nameDB_.getDistinctName("repeat_end",s.NameType$$module$build$src$core$names.VARIABLE))+" = "+n+";\n"),e+"for (var "+r+" = 0; "+r+" < "+a+"; "+r+"++) {\n"+o+"}\n"},r=function(e,i){const s=e.getFieldValue("OP");let n;if("NEG"===s)return"-"===(e=i.valueToCode(e,"NUM",t.UNARY_NEGATION)||"0")[0]&&(e=" "+e),["-"+e,t.UNARY_NEGATION];switch(e="SIN"===s||"COS"===s||"TAN"===s?i.valueToCode(e,"NUM",t.DIVISION)||"0":i.valueToCode(e,"NUM",t.NONE)||"0",s){case"ABS":n="Math.abs("+e+")";break;case"ROOT":n="Math.sqrt("+e+")";break;case"LN":n="Math.log("+e+")";break;case"EXP":n="Math.exp("+e+")";break;case"POW10":n="Math.pow(10,"+e+")";break;case"ROUND":n="Math.round("+e+")";break;case"ROUNDUP":n="Math.ceil("+e+")";break;case"ROUNDDOWN":n="Math.floor("+e+")";break;case"SIN":n="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":n="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":n="Math.tan("+e+" / 180 * Math.PI)"}if(n)return[n,t.FUNCTION_CALL];switch(s){case"LOG10":n="Math.log("+e+") / Math.log(10)";break;case"ASIN":n="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":n="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":n="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+s)}return[n,t.DIVISION]},a=function(e,i){const s=i.getProcedureName(e.getFieldValue("NAME"));var n="";i.STATEMENT_PREFIX&&(n+=i.injectId(i.STATEMENT_PREFIX,e)),i.STATEMENT_SUFFIX&&(n+=i.injectId(i.STATEMENT_SUFFIX,e)),n&&(n=i.prefixLines(n,i.INDENT));let o="";i.INFINITE_LOOP_TRAP&&(o=i.prefixLines(i.injectId(i.INFINITE_LOOP_TRAP,e),i.INDENT));const r=i.statementToCode(e,"STACK");let a=i.valueToCode(e,"RETURN",t.NONE)||"",l="";r&&a&&(l=n),a&&(a=i.INDENT+"return "+a+";\n");const c=[],u=e.getVars();for(let e=0;e<u.length;e++)c[e]=i.getVariableName(u[e]);return n="function "+s+"("+c.join(", ")+") {\n"+n+o+r+l+a+"}",n=i.scrub_(e,n),i.definitions_["%"+s]=n,null},l=function(e,i){return i="window.prompt("+(e.getField("TEXT")?i.quote_(e.getFieldValue("TEXT")):i.valueToCode(e,"TEXT",t.NONE)||"''")+")","NUMBER"===e.getFieldValue("TYPE")&&(i="Number("+i+")"),[i,t.FUNCTION_CALL]},c=function(e,i){return[i.getVariableName(e.getFieldValue("VAR")),t.ATOMIC]},u=function(e,i){const s=i.valueToCode(e,"VALUE",t.ASSIGNMENT)||"0";return i.getVariableName(e.getFieldValue("VAR"))+" = "+s+";\n"};(i=t||(t={}))[i.ATOMIC=0]="ATOMIC",i[i.NEW=1.1]="NEW",i[i.MEMBER=1.2]="MEMBER",i[i.FUNCTION_CALL=2]="FUNCTION_CALL",i[i.INCREMENT=3]="INCREMENT",i[i.DECREMENT=3]="DECREMENT",i[i.BITWISE_NOT=4.1]="BITWISE_NOT",i[i.UNARY_PLUS=4.2]="UNARY_PLUS",i[i.UNARY_NEGATION=4.3]="UNARY_NEGATION",i[i.LOGICAL_NOT=4.4]="LOGICAL_NOT",i[i.TYPEOF=4.5]="TYPEOF",i[i.VOID=4.6]="VOID",i[i.DELETE=4.7]="DELETE",i[i.AWAIT=4.8]="AWAIT",i[i.EXPONENTIATION=5]="EXPONENTIATION",i[i.MULTIPLICATION=5.1]="MULTIPLICATION",i[i.DIVISION=5.2]="DIVISION",i[i.MODULUS=5.3]="MODULUS",i[i.SUBTRACTION=6.1]="SUBTRACTION",i[i.ADDITION=6.2]="ADDITION",i[i.BITWISE_SHIFT=7]="BITWISE_SHIFT",i[i.RELATIONAL=8]="RELATIONAL",i[i.IN=8]="IN",i[i.INSTANCEOF=8]="INSTANCEOF",i[i.EQUALITY=9]="EQUALITY",i[i.BITWISE_AND=10]="BITWISE_AND",i[i.BITWISE_XOR=11]="BITWISE_XOR",i[i.BITWISE_OR=12]="BITWISE_OR",i[i.LOGICAL_AND=13]="LOGICAL_AND",i[i.LOGICAL_OR=14]="LOGICAL_OR",i[i.CONDITIONAL=15]="CONDITIONAL",i[i.ASSIGNMENT=16]="ASSIGNMENT",i[i.YIELD=17]="YIELD",i[i.COMMA=18]="COMMA",i[i.NONE=99]="NONE";var h=class extends s.CodeGenerator$$module$build$src$core$generator{constructor(e="JavaScript"){super(e),this.ORDER_OVERRIDES=[[t.FUNCTION_CALL,t.MEMBER],[t.FUNCTION_CALL,t.FUNCTION_CALL],[t.MEMBER,t.MEMBER],[t.MEMBER,t.FUNCTION_CALL],[t.LOGICAL_NOT,t.LOGICAL_NOT],[t.MULTIPLICATION,t.MULTIPLICATION],[t.ADDITION,t.ADDITION],[t.LOGICAL_AND,t.LOGICAL_AND],[t.LOGICAL_OR,t.LOGICAL_OR]],this.isInitialized=!1;for(const i in t)"string"!=typeof(e=t[i])&&(this["ORDER_"+i]=e);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new s.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const t=[];var i=s.allDeveloperVariables$$module$build$src$core$variables(e);for(let e=0;e<i.length;e++)t.push(this.nameDB_.getName(i[e],s.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=s.allUsedVarModels$$module$build$src$core$variables(e),i=0;i<e.length;i++)t.push(this.nameDB_.getName(e[i].getId(),s.NameType$$module$build$src$core$names.VARIABLE));t.length&&(this.definitions_.variables="var "+t.join(", ")+";"),this.isInitialized=!0}finish(e){const t=Object.values(this.definitions_);return super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),t.join("\n\n")+"\n\n\n"+e}scrubNakedValue(e){return e+";\n"}quote_(e){return"'"+(e=e.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(" + '\\n' +\n")}scrub_(e,t,i=!1){let n="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=s.wrap$$module$build$src$core$utils$string(o,this.COMMENT_WRAP-3),n+=this.prefixLines(o+"\n","// "));for(let t=0;t<e.inputList.length;t++)e.inputList[t].type===s.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(o=e.inputList[t].connection.targetBlock())&&(o=this.allNestedComments(o))&&(n+=this.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),n+t+(i?"":this.blockToCode(e))}getAdjusted(e,i,n=0,o=!1,r=t.NONE){e.workspace.options.oneBasedIndex&&n--;const a=e.workspace.options.oneBasedIndex?"1":"0";let l=r;return 0<n?l=t.ADDITION:0>n?l=t.SUBTRACTION:o&&(l=t.UNARY_NEGATION),e=this.valueToCode(e,i,l)||a,0!==n||o?s.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+n),o&&(e=String(-Number(e))),e):(0<n?e=`${e} + ${n}`:0>n&&(e=`${e} - ${-n}`),o&&(e=n?`-(${e})`:`-${e}`),Math.floor(r)>=Math.floor(l)&&(e=`(${e})`),e):e}},d={};d.JavascriptGenerator=h,d.Order=t;var p={colour_blend:function(e,i){const s=i.valueToCode(e,"COLOUR1",t.NONE)||"'#000000'",n=i.valueToCode(e,"COLOUR2",t.NONE)||"'#000000'";return e=i.valueToCode(e,"RATIO",t.NONE)||.5,[i.provideFunction_("colourBlend",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+"("+s+", "+n+", "+e+")",t.FUNCTION_CALL]},colour_picker:function(e,i){return[i.quote_(e.getFieldValue("COLOUR")),t.ATOMIC]},colour_random:function(e,i){return[i.provideFunction_("colourRandom",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * Math.pow(2, 24));\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`)+"()",t.FUNCTION_CALL]},colour_rgb:function(e,i){const s=i.valueToCode(e,"RED",t.NONE)||0,n=i.valueToCode(e,"GREEN",t.NONE)||0;return e=i.valueToCode(e,"BLUE",t.NONE)||0,[i.provideFunction_("colourRgb",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`)+"("+s+", "+n+", "+e+")",t.FUNCTION_CALL]}},g=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},m={lists_create_empty:function(e,i){return["[]",t.ATOMIC]},lists_create_with:function(e,i){const s=Array(e.itemCount_);for(let n=0;n<e.itemCount_;n++)s[n]=i.valueToCode(e,"ADD"+n,t.NONE)||"null";return["["+s.join(", ")+"]",t.ATOMIC]},lists_getIndex:function(e,i){const s=e.getFieldValue("MODE")||"GET",n=e.getFieldValue("WHERE")||"FROM_START";var o=i.valueToCode(e,"VALUE","RANDOM"===n?t.NONE:t.MEMBER)||"[]";switch(n){case"FIRST":if("GET"===s)return[o+"[0]",t.MEMBER];if("GET_REMOVE"===s)return[o+".shift()",t.MEMBER];if("REMOVE"===s)return o+".shift();\n";break;case"LAST":if("GET"===s)return[o+".slice(-1)[0]",t.MEMBER];if("GET_REMOVE"===s)return[o+".pop()",t.MEMBER];if("REMOVE"===s)return o+".pop();\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"GET"===s)return[o+"["+e+"]",t.MEMBER];if("GET_REMOVE"===s)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===s)return o+".splice("+e+", 1);\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!0),"GET"===s)return[o+".slice("+e+")[0]",t.FUNCTION_CALL];if("GET_REMOVE"===s)return[o+".splice("+e+", 1)[0]",t.FUNCTION_CALL];if("REMOVE"===s)return o+".splice("+e+", 1);";break;case"RANDOM":if(o=i.provideFunction_("listsGetRandomItem",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`)+"("+o+", "+("GET"!==s)+")","GET"===s||"GET_REMOVE"===s)return[o,t.FUNCTION_CALL];if("REMOVE"===s)return o+";\n"}throw Error("Unhandled combination (lists_getIndex).")},lists_getSublist:function(e,i){var s={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},n=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const o=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");if("FIRST"===o&&"LAST"===r)n+=".slice(0)";else if(n.match(/^\w+$/)||"FROM_END"!==o&&"FROM_START"===r){switch(o){case"FROM_START":s=i.getAdjusted(e,"AT1");break;case"FROM_END":s=n+".length - "+(s=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":s="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=n+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=n+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}n=n+".slice("+s+", "+i+")"}else{const t=i.getAdjusted(e,"AT1");e=i.getAdjusted(e,"AT2"),n=i.provideFunction_("subsequence"+s[o]+s[r],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===o||"FROM_START"===o?", at1":""}${"FROM_END"===r||"FROM_START"===r?", at2":""}) {\n  var start = ${g("sequence",o,"at1")};\n  var end = ${g("sequence",r,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+n+("FROM_END"===o||"FROM_START"===o?", "+t:"")+("FROM_END"===r||"FROM_START"===r?", "+e:"")+")"}return[n,t.FUNCTION_CALL]},lists_indexOf:function(e,i){const s="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",n=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+"."+s+"("+n+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},lists_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.LOGICAL_NOT]},lists_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"[]")+".length",t.MEMBER]},lists_repeat:function(e,i){return[i.provideFunction_("listsRepeat",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`)+"("+(i.valueToCode(e,"ITEM",t.NONE)||"null")+", "+(e=i.valueToCode(e,"NUM",t.NONE)||"0")+")",t.FUNCTION_CALL]},lists_reverse:function(e,i){return[(i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]")+".slice().reverse()",t.FUNCTION_CALL]},lists_setIndex:function(e,i){function n(){if(o.match(/^\w+$/))return"";const e=i.nameDB_.getDistinctName("tmpList",s.NameType$$module$build$src$core$names.VARIABLE),t="var "+e+" = "+o+";\n";return o=e,t}let o=i.valueToCode(e,"LIST",t.MEMBER)||"[]";const r=e.getFieldValue("MODE")||"GET";var a=e.getFieldValue("WHERE")||"FROM_START";const l=i.valueToCode(e,"TO",t.ASSIGNMENT)||"null";switch(a){case"FIRST":if("SET"===r)return o+"[0] = "+l+";\n";if("INSERT"===r)return o+".unshift("+l+");\n";break;case"LAST":if("SET"===r)return n()+(o+"[")+o+".length - 1] = "+l+";\n";if("INSERT"===r)return o+".push("+l+");\n";break;case"FROM_START":if(e=i.getAdjusted(e,"AT"),"SET"===r)return o+"["+e+"] = "+l+";\n";if("INSERT"===r)return o+".splice("+e+", 0, "+l+");\n";break;case"FROM_END":if(e=i.getAdjusted(e,"AT",1,!1,t.SUBTRACTION),a=n(),"SET"===r)return a+(o+"[")+o+".length - "+e+"] = "+l+";\n";if("INSERT"===r)return a+(o+".splice(")+o+".length - "+e+", 0, "+l+");\n";break;case"RANDOM":if(e=n(),e+="var "+(a=i.nameDB_.getDistinctName("tmpX",s.NameType$$module$build$src$core$names.VARIABLE))+" = Math.floor(Math.random() * "+o+".length);\n","SET"===r)return e+(o+"[")+a+"] = "+l+";\n";if("INSERT"===r)return e+(o+".splice(")+a+", 0, "+l+");\n"}throw Error("Unhandled combination (lists_setIndex).")},lists_sort:function(e,i){const s=i.valueToCode(e,"LIST",t.FUNCTION_CALL)||"[]",n="1"===e.getFieldValue("DIRECTION")?1:-1;return e=e.getFieldValue("TYPE"),[s+".slice().sort("+(i=i.provideFunction_("listsGetSortCompare",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return String(a) > String(b) ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `))+'("'+e+'", '+n+"))",t.FUNCTION_CALL]},lists_split:function(e,i){let s=i.valueToCode(e,"INPUT",t.MEMBER);if(i=i.valueToCode(e,"DELIM",t.NONE)||"''","SPLIT"===(e=e.getFieldValue("MODE")))s||(s="''"),e="split";else{if("JOIN"!==e)throw Error("Unknown mode: "+e);s||(s="[]"),e="join"}return[s+"."+e+"("+i+")",t.FUNCTION_CALL]}},f={};f.controls_if=n,f.controls_ifelse=n,f.logic_boolean=function(e,i){return["TRUE"===e.getFieldValue("BOOL")?"true":"false",t.ATOMIC]},f.logic_compare=function(e,i){const s={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],n="=="===s||"!="===s?t.EQUALITY:t.RELATIONAL;return[(i.valueToCode(e,"A",n)||"0")+" "+s+" "+(e=i.valueToCode(e,"B",n)||"0"),n]},f.logic_negate=function(e,i){const s=t.LOGICAL_NOT;return["!"+(i.valueToCode(e,"BOOL",s)||"true"),s]},f.logic_null=function(e,i){return["null",t.ATOMIC]},f.logic_operation=function(e,i){const s="AND"===e.getFieldValue("OP")?"&&":"||",n="&&"===s?t.LOGICAL_AND:t.LOGICAL_OR;let o=i.valueToCode(e,"A",n);return e=i.valueToCode(e,"B",n),o||e?(i="&&"===s?"true":"false",o||(o=i),e||(e=i)):e=o="false",[o+" "+s+" "+e,n]},f.logic_ternary=function(e,i){return[(i.valueToCode(e,"IF",t.CONDITIONAL)||"false")+" ? "+(i.valueToCode(e,"THEN",t.CONDITIONAL)||"null")+" : "+(e=i.valueToCode(e,"ELSE",t.CONDITIONAL)||"null"),t.CONDITIONAL]};var _={controls_flow_statements:function(e,t){let i="";if(t.STATEMENT_PREFIX&&(i+=t.injectId(t.STATEMENT_PREFIX,e)),t.STATEMENT_SUFFIX&&(i+=t.injectId(t.STATEMENT_SUFFIX,e)),t.STATEMENT_PREFIX){const s=e.getSurroundLoop();s&&!s.suppressPrefixSuffix&&(i+=t.injectId(t.STATEMENT_PREFIX,s))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+"break;\n";case"CONTINUE":return i+"continue;\n"}throw Error("Unknown flow statement.")},controls_for:function(e,i){var n=i.getVariableName(e.getFieldValue("VAR")),o=i.valueToCode(e,"FROM",t.ASSIGNMENT)||"0",r=i.valueToCode(e,"TO",t.ASSIGNMENT)||"0";const a=i.valueToCode(e,"BY",t.ASSIGNMENT)||"1";let l=i.statementToCode(e,"DO");if(l=i.addLoopTrap(l,e),s.isNumber$$module$build$src$core$utils$string(o)&&s.isNumber$$module$build$src$core$utils$string(r)&&s.isNumber$$module$build$src$core$utils$string(a))e="for ("+n+" = "+o+"; "+n+((i=Number(o)<=Number(r))?" <= ":" >= ")+r+"; "+n,e=1===(n=Math.abs(Number(a)))?e+(i?"++":"--"):e+(i?" += ":" -= ")+n,e+=") {\n"+l+"}\n";else{e="";let t=o;o.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string(o)||(e+="var "+(t=i.nameDB_.getDistinctName(n+"_start",s.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),o=r,r.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string(r)||(e+="var "+(o=i.nameDB_.getDistinctName(n+"_end",s.NameType$$module$build$src$core$names.VARIABLE))+" = "+r+";\n"),e+="var "+(r=i.nameDB_.getDistinctName(n+"_inc",s.NameType$$module$build$src$core$names.VARIABLE))+" = ",e=s.isNumber$$module$build$src$core$utils$string(a)?e+(Math.abs(Number(a))+";\n"):e+"Math.abs("+a+");\n",e+="if ("+t+" > "+o+") {\n",e=(e+=i.INDENT+r+" = -"+r+";\n")+"}\nfor ("+n+" = "+t+"; "+r+" >= 0 ? "+n+" <= "+o+" : "+n+" >= "+o+"; "+n+" += "+r+") {\n"+l+"}\n"}return e},controls_forEach:function(e,i){const n=i.getVariableName(e.getFieldValue("VAR"));var o=i.valueToCode(e,"LIST",t.ASSIGNMENT)||"[]";let r=i.statementToCode(e,"DO");r=i.addLoopTrap(r,e),e="";let a=o;return o.match(/^\w+$/)||(e+="var "+(a=i.nameDB_.getDistinctName(n+"_list",s.NameType$$module$build$src$core$names.VARIABLE))+" = "+o+";\n"),e+"for (var "+(o=i.nameDB_.getDistinctName(n+"_index",s.NameType$$module$build$src$core$names.VARIABLE))+" in "+a+") {\n"+(r=i.INDENT+n+" = "+a+"["+o+"];\n"+r)+"}\n"}};_.controls_repeat=o,_.controls_repeat_ext=o,_.controls_whileUntil=function(e,i){const s="UNTIL"===e.getFieldValue("MODE");let n=i.valueToCode(e,"BOOL",s?t.LOGICAL_NOT:t.NONE)||"false",o=i.statementToCode(e,"DO");return s&&(n="!"+n),"while ("+n+") {\n"+(o=i.addLoopTrap(o,e))+"}\n"};var b={math_arithmetic:function(e,i){var s={ADD:[" + ",t.ADDITION],MINUS:[" - ",t.SUBTRACTION],MULTIPLY:[" * ",t.MULTIPLICATION],DIVIDE:[" / ",t.DIVISION],POWER:[null,t.NONE]}[e.getFieldValue("OP")];const n=s[0];s=s[1];const o=i.valueToCode(e,"A",s)||"0";return e=i.valueToCode(e,"B",s)||"0",n?[o+n+e,s]:["Math.pow("+o+", "+e+")",t.FUNCTION_CALL]},math_atan2:function(e,i){const s=i.valueToCode(e,"X",t.NONE)||"0";return["Math.atan2("+(i.valueToCode(e,"Y",t.NONE)||"0")+", "+s+") / Math.PI * 180",t.DIVISION]},math_change:function(e,i){const s=i.valueToCode(e,"DELTA",t.ADDITION)||"0";return(e=i.getVariableName(e.getFieldValue("VAR")))+" = (typeof "+e+" === 'number' ? "+e+" : 0) + "+s+";\n"},math_constant:function(e,i){return{PI:["Math.PI",t.MEMBER],E:["Math.E",t.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.DIVISION],SQRT2:["Math.SQRT2",t.MEMBER],SQRT1_2:["Math.SQRT1_2",t.MEMBER],INFINITY:["Infinity",t.ATOMIC]}[e.getFieldValue("CONSTANT")]},math_constrain:function(e,i){return["Math.min(Math.max("+(i.valueToCode(e,"VALUE",t.NONE)||"0")+", "+(i.valueToCode(e,"LOW",t.NONE)||"0")+"), "+(e=i.valueToCode(e,"HIGH",t.NONE)||"Infinity")+")",t.FUNCTION_CALL]},math_modulo:function(e,i){return[(i.valueToCode(e,"DIVIDEND",t.MODULUS)||"0")+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0"),t.MODULUS]},math_number:function(e,i){return e=Number(e.getFieldValue("NUM")),[String(e),0<=e?t.ATOMIC:t.UNARY_NEGATION]},math_number_property:function(e,i){var s={EVEN:[" % 2 === 0",t.MODULUS,t.EQUALITY],ODD:[" % 2 === 1",t.MODULUS,t.EQUALITY],WHOLE:[" % 1 === 0",t.MODULUS,t.EQUALITY],POSITIVE:[" > 0",t.RELATIONAL,t.RELATIONAL],NEGATIVE:[" < 0",t.RELATIONAL,t.RELATIONAL],DIVISIBLE_BY:[null,t.MODULUS,t.EQUALITY],PRIME:[null,t.NONE,t.FUNCTION_CALL]};const n=e.getFieldValue("PROPERTY"),[o,r,a]=s[n];return s=i.valueToCode(e,"NUMBER_TO_CHECK",r)||"0",[e="PRIME"===n?i.provideFunction_("mathIsPrime",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`)+"("+s+")":"DIVISIBLE_BY"===n?s+" % "+(e=i.valueToCode(e,"DIVISOR",t.MODULUS)||"0")+" === 0":s+o,a]},math_on_list:function(e,i){var s=e.getFieldValue("OP");switch(s){case"SUM":e=i.valueToCode(e,"LIST",t.MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":e="Math.min.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MAX":e="Math.max.apply(null, "+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"AVERAGE":e=(s=i.provideFunction_("mathMean",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MEDIAN":e=(s=i.provideFunction_("mathMedian",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"MODE":e=(s=i.provideFunction_("mathModes",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n        modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"STD_DEV":e=(s=i.provideFunction_("mathStandardDeviation",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance = variance / n;\n  return Math.sqrt(variance);\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;case"RANDOM":e=(s=i.provideFunction_("mathRandomList",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`))+"("+(e=i.valueToCode(e,"LIST",t.NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+s)}return[e,t.FUNCTION_CALL]},math_random_float:function(e,i){return["Math.random()",t.FUNCTION_CALL]},math_random_int:function(e,i){const s=i.valueToCode(e,"FROM",t.NONE)||"0";return e=i.valueToCode(e,"TO",t.NONE)||"0",[i.provideFunction_("mathRandomInt",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`)+"("+s+", "+e+")",t.FUNCTION_CALL]}};b.math_round=r,b.math_single=r,b.math_trig=r;var T={procedures_callnoreturn:function(e,t){return t.forBlock.procedures_callreturn(e,t)[0]+";\n"},procedures_callreturn:function(e,i){const s=i.getProcedureName(e.getFieldValue("NAME")),n=[],o=e.getVars();for(let s=0;s<o.length;s++)n[s]=i.valueToCode(e,"ARG"+s,t.NONE)||"null";return[s+"("+n.join(", ")+")",t.FUNCTION_CALL]}};T.procedures_defnoreturn=a,T.procedures_defreturn=a,T.procedures_ifreturn=function(e,i){let s="if ("+(i.valueToCode(e,"CONDITION",t.NONE)||"false")+") {\n";return i.STATEMENT_SUFFIX&&(s+=i.prefixLines(i.injectId(i.STATEMENT_SUFFIX,e),i.INDENT)),e.hasReturnValue_?(e=i.valueToCode(e,"VALUE",t.NONE)||"null",s+=i.INDENT+"return "+e+";\n"):s+=i.INDENT+"return;\n",s+"}\n"};var E=/^\s*'([^']|\\')*'\s*$/,y=function(e){return E.test(e)?[e,t.ATOMIC]:["String("+e+")",t.FUNCTION_CALL]},I=function(e,t,i){return"FIRST"===t?"0":"FROM_END"===t?e+".length - 1 - "+i:"LAST"===t?e+".length - 1":i},k={text:function(e,i){return[i.quote_(e.getFieldValue("TEXT")),t.ATOMIC]},text_append:function(e,i){const s=i.getVariableName(e.getFieldValue("VAR"));return e=i.valueToCode(e,"TEXT",t.NONE)||"''",s+" += "+y(e)[0]+";\n"},text_changeCase:function(e,i){const s={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=i.valueToCode(e,"TEXT",s?t.MEMBER:t.NONE)||"''",[s?e+s:i.provideFunction_("textToTitleCase",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`)+"("+e+")",t.FUNCTION_CALL]},text_charAt:function(e,i){const s=e.getFieldValue("WHERE")||"FROM_START",n=i.valueToCode(e,"VALUE","RANDOM"===s?t.NONE:t.MEMBER)||"''";switch(s){case"FIRST":return[n+".charAt(0)",t.FUNCTION_CALL];case"LAST":return[n+".slice(-1)",t.FUNCTION_CALL];case"FROM_START":return[n+".charAt("+(e=i.getAdjusted(e,"AT"))+")",t.FUNCTION_CALL];case"FROM_END":return[n+".slice("+(e=i.getAdjusted(e,"AT",1,!0))+").charAt(0)",t.FUNCTION_CALL];case"RANDOM":return[i.provideFunction_("textRandomLetter",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`)+"("+n+")",t.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},text_count:function(e,i){const s=i.valueToCode(e,"TEXT",t.NONE)||"''";return e=i.valueToCode(e,"SUB",t.NONE)||"''",[i.provideFunction_("textCount",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`)+"("+s+", "+e+")",t.FUNCTION_CALL]},text_getSubstring:function(e,i){var s={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const n=e.getFieldValue("WHERE1"),o=e.getFieldValue("WHERE2");var r="FROM_END"!==n&&"LAST"!==n&&"FROM_END"!==o&&"LAST"!==o,a=i.valueToCode(e,"STRING",r?t.MEMBER:t.NONE)||"''";if("FIRST"===n&&"LAST"===o)return[a,t.NONE];if(a.match(/^'?\w+'?$/)||r){switch(n){case"FROM_START":s=i.getAdjusted(e,"AT1");break;case"FROM_END":s=a+".length - "+(s=i.getAdjusted(e,"AT1",1,!1,t.SUBTRACTION));break;case"FIRST":s="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(o){case"FROM_START":i=i.getAdjusted(e,"AT2",1);break;case"FROM_END":i=a+".length - "+(i=i.getAdjusted(e,"AT2",0,!1,t.SUBTRACTION));break;case"LAST":i=a+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}a=a+".slice("+s+", "+i+")"}else r=i.getAdjusted(e,"AT1"),e=i.getAdjusted(e,"AT2"),a=i.provideFunction_("subsequence"+s[n]+s[o],`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(sequence${"FROM_END"===n||"FROM_START"===n?", at1":""}${"FROM_END"===o||"FROM_START"===o?", at2":""}) {\n  var start = ${I("sequence",n,"at1")};\n  var end = ${I("sequence",o,"at2")} + 1;\n  return sequence.slice(start, end);\n}\n`)+"("+a+("FROM_END"===n||"FROM_START"===n?", "+r:"")+("FROM_END"===o||"FROM_START"===o?", "+e:"")+")";return[a,t.FUNCTION_CALL]},text_indexOf:function(e,i){const s="FIRST"===e.getFieldValue("END")?"indexOf":"lastIndexOf",n=i.valueToCode(e,"FIND",t.NONE)||"''";return i=(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+"."+s+"("+n+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.ADDITION]:[i,t.FUNCTION_CALL]},text_isEmpty:function(e,i){return["!"+(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.LOGICAL_NOT]},text_join:function(e,i){switch(e.itemCount_){case 0:return["''",t.ATOMIC];case 1:return e=i.valueToCode(e,"ADD0",t.NONE)||"''",y(e);case 2:var s=i.valueToCode(e,"ADD0",t.NONE)||"''";return e=i.valueToCode(e,"ADD1",t.NONE)||"''",[y(s)[0]+" + "+y(e)[0],t.ADDITION];default:s=Array(e.itemCount_);for(let n=0;n<e.itemCount_;n++)s[n]=i.valueToCode(e,"ADD"+n,t.NONE)||"''";return["["+s.join(",")+"].join('')",t.FUNCTION_CALL]}},text_length:function(e,i){return[(i.valueToCode(e,"VALUE",t.MEMBER)||"''")+".length",t.MEMBER]},text_multiline:function(e,i){return e=i.multiline_quote_(e.getFieldValue("TEXT")),i=-1!==e.indexOf("+")?t.ADDITION:t.ATOMIC,[e,i]},text_print:function(e,i){return"window.alert("+(i.valueToCode(e,"TEXT",t.NONE)||"''")+");\n"}};k.text_prompt=l,k.text_prompt_ext=l,k.text_replace=function(e,i){const s=i.valueToCode(e,"TEXT",t.NONE)||"''",n=i.valueToCode(e,"FROM",t.NONE)||"''";return e=i.valueToCode(e,"TO",t.NONE)||"''",[i.provideFunction_("textReplace",`\nfunction ${i.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')\n                 .replace(/\\x08/g, '\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`)+"("+s+", "+n+", "+e+")",t.FUNCTION_CALL]},k.text_reverse=function(e,i){return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+".split('').reverse().join('')",t.FUNCTION_CALL]},k.text_trim=function(e,i){const s={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(i.valueToCode(e,"TEXT",t.MEMBER)||"''")+s,t.FUNCTION_CALL]};var v={};v.variables_get=c,v.variables_set=u;var C={};C.variables_get_dynamic=c,C.variables_set_dynamic=u;var S=new h,O=Object.assign({},p,m,f,_,b,T,k,v,C);for(const e in O)S.forBlock[e]=O[e];var A={};return A.JavascriptGenerator=h,A.Order=t,A.javascriptGenerator=S,A.__namespace__=s,A},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],n):"object"==typeof i?t.exports=n(e("./blockly_compressed.js")):(s.javascript=n(s.Blockly),s.Blockly.JavaScript=s.javascript.javascriptGenerator)},{"./blockly_compressed.js":192}],200:[function(e,t,i){!function(e,s){if("function"==typeof define&&define.amd)define([],s);else if("object"==typeof i)t.exports=s();else{var n=s();for(var o in n)e.Blockly.Msg[o]=n[o]}}(this,(function(){"use strict";var e=e||{Msg:Object.create(null)};return e.Msg.ADD_COMMENT="Add Comment",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",e.Msg.CHANGE_VALUE_TITLE="Change value:",e.Msg.CLEAN_UP="Clean up Blocks",e.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",e.Msg.COLLAPSE_ALL="Collapse Blocks",e.Msg.COLLAPSE_BLOCK="Collapse Block",e.Msg.COLOUR_BLEND_COLOUR1="colour 1",e.Msg.COLOUR_BLEND_COLOUR2="colour 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="ratio",e.Msg.COLOUR_BLEND_TITLE="blend",e.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",e.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="random colour",e.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",e.Msg.COLOUR_RGB_BLUE="blue",e.Msg.COLOUR_RGB_GREEN="green",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="red",e.Msg.COLOUR_RGB_TITLE="colour with",e.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",e.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",e.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",e.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",e.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",e.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",e.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",e.Msg.CONTROLS_IF_MSG_ELSE="else",e.Msg.CONTROLS_IF_MSG_ELSEIF="else if",e.Msg.CONTROLS_IF_MSG_IF="if",e.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",e.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",e.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",e.Msg.CONTROLS_REPEAT_INPUT_DO="do",e.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",e.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",e.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",e.Msg.DELETE_BLOCK="Delete Block",e.Msg.DELETE_VARIABLE="Delete the '%1' variable",e.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",e.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",e.Msg.DIALOG_CANCEL="Cancel",e.Msg.DIALOG_OK="OK",e.Msg.DISABLE_BLOCK="Disable Block",e.Msg.DUPLICATE_BLOCK="Duplicate",e.Msg.DUPLICATE_COMMENT="Duplicate Comment",e.Msg.ENABLE_BLOCK="Enable Block",e.Msg.EXPAND_ALL="Expand Blocks",e.Msg.EXPAND_BLOCK="Expand Block",e.Msg.EXTERNAL_INPUTS="External Inputs",e.Msg.HELP="Help",e.Msg.INLINE_INPUTS="Inline Inputs",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",e.Msg.LISTS_GET_INDEX_FIRST="first",e.Msg.LISTS_GET_INDEX_FROM_END="# from end",e.Msg.LISTS_GET_INDEX_FROM_START="#",e.Msg.LISTS_GET_INDEX_GET="get",e.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",e.Msg.LISTS_GET_INDEX_LAST="last",e.Msg.LISTS_GET_INDEX_RANDOM="random",e.Msg.LISTS_GET_INDEX_REMOVE="remove",e.Msg.LISTS_GET_INDEX_TAIL="",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",e.Msg.LISTS_GET_SUBLIST_END_LAST="to last",e.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",e.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",e.Msg.LISTS_GET_SUBLIST_TAIL="",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",e.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",e.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",e.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",e.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",e.Msg.LISTS_INLIST="in list",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",e.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="length of %1",e.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",e.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",e.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",e.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",e.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",e.Msg.LISTS_SET_INDEX_INPUT_TO="as",e.Msg.LISTS_SET_INDEX_INSERT="insert at",e.Msg.LISTS_SET_INDEX_SET="set",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",e.Msg.LISTS_SORT_ORDER_DESCENDING="descending",e.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",e.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",e.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",e.Msg.LOGIC_BOOLEAN_FALSE="false",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",e.Msg.LOGIC_BOOLEAN_TRUE="true",e.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="not %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",e.Msg.LOGIC_NULL_TOOLTIP="Returns null.",e.Msg.LOGIC_OPERATION_AND="and",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="or",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",e.Msg.LOGIC_TERNARY_CONDITION="test",e.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",e.Msg.LOGIC_TERNARY_IF_FALSE="if false",e.Msg.LOGIC_TERNARY_IF_TRUE="if true",e.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",e.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",e.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",e.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",e.Msg.MATH_CHANGE_TITLE="change %1 by %2",e.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",e.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",e.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants: π (3.141…), e (2.718…), φ (1.618…), sqrt(2) (1.414…), sqrt(½) (0.707…), or ∞ (infinity).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",e.Msg.MATH_DIVISION_SYMBOL="÷",e.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",e.Msg.MATH_IS_EVEN="is even",e.Msg.MATH_IS_NEGATIVE="is negative",e.Msg.MATH_IS_ODD="is odd",e.Msg.MATH_IS_POSITIVE="is positive",e.Msg.MATH_IS_PRIME="is prime",e.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",e.Msg.MATH_IS_WHOLE="is whole",e.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",e.Msg.MATH_MODULO_TITLE="remainder of %1 ÷ %2",e.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",e.Msg.MATH_MULTIPLICATION_SYMBOL="×",e.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",e.Msg.MATH_NUMBER_TOOLTIP="A number.",e.Msg.MATH_ONLIST_HELPURL="",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",e.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",e.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",e.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",e.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",e.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",e.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",e.Msg.MATH_ROUND_OPERATOR_ROUND="round",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",e.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",e.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",e.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",e.Msg.MATH_SINGLE_OP_ROOT="square root",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",e.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",e.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",e.Msg.NEW_NUMBER_VARIABLE="Create number variable...",e.Msg.NEW_STRING_VARIABLE="Create string variable...",e.Msg.NEW_VARIABLE="Create variable...",e.Msg.NEW_VARIABLE_TITLE="New variable name:",e.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",e.Msg.ORDINAL_NUMBER_SUFFIX="",e.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",e.Msg.PROCEDURES_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CREATE_DO="Create '%1'",e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",e.Msg.PROCEDURES_DEFNORETURN_TITLE="to",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFRETURN_RETURN="return",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",e.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",e.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",e.Msg.REDO="Redo",e.Msg.REMOVE_COMMENT="Remove Comment",e.Msg.RENAME_VARIABLE="Rename variable...",e.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="to %1 append text %2",e.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",e.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",e.Msg.TEXT_CHARAT_FIRST="get first letter",e.Msg.TEXT_CHARAT_FROM_END="get letter # from end",e.Msg.TEXT_CHARAT_FROM_START="get letter #",e.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",e.Msg.TEXT_CHARAT_LAST="get last letter",e.Msg.TEXT_CHARAT_RANDOM="get random letter",e.Msg.TEXT_CHARAT_TAIL="",e.Msg.TEXT_CHARAT_TITLE="in text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",e.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",e.Msg.TEXT_GET_SUBSTRING_TAIL="",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",e.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",e.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",e.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",e.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",e.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="length of %1",e.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="print %1",e.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",e.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",e.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",e.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",e.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",e.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",e.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",e.Msg.TODAY="Today",e.Msg.UNDO="Undo",e.Msg.UNNAMED_KEY="unnamed",e.Msg.VARIABLES_DEFAULT_NAME="item",e.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",e.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",e.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",e.Msg.VARIABLES_SET="set %1 to %2",e.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",e.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",e.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",e.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_HELPURL=e.Msg.LISTS_INDEX_OF_HELPURL,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.MATH_HUE="230",e.Msg.LOOPS_HUE="120",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.VARIABLES_HUE="330",e.Msg.TEXTS_HUE="160",e.Msg.PROCEDURES_HUE="290",e.Msg.COLOUR_HUE="20",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg}))},{}],201:[function(e,t,i){"use strict";var s=e("react-is"),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return s.isMemo(e)?r:a[e.$$typeof]||n}a[s.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[s.Memo]=r;var c=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,g=Object.prototype;t.exports=function e(t,i,s){if("string"!=typeof i){if(g){var n=p(i);n&&n!==g&&e(t,n,s)}var r=u(i);h&&(r=r.concat(h(i)));for(var a=l(t),m=l(i),f=0;f<r.length;++f){var _=r[f];if(!(o[_]||s&&s[_]||m&&m[_]||a&&a[_])){var b=d(i,_);try{c(t,_,b)}catch(t){}}}}return t}},{"react-is":209}],202:[function(e,t,i){"use strict";var s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(e){s[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,l=r(e),c=1;c<arguments.length;c++){for(var u in i=Object(arguments[c]))n.call(i,u)&&(l[u]=i[u]);if(s){a=s(i);for(var h=0;h<a.length;h++)o.call(i,a[h])&&(l[a[h]]=i[a[h]])}}return l}},{}],203:[function(e,t,i){"use strict";var s=e("./lib/ReactPropTypesSecret");function n(){}function o(){}o.resetWarningCache=n,t.exports=function(){function e(e,t,i,n,o,r){if(r!==s){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:n};return i.PropTypes=i,i}},{"./lib/ReactPropTypesSecret":205}],204:[function(e,t,i){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":203}],205:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],206:[function(e,t,i){"use strict";var s=e("react"),n=e("object-assign"),o=e("scheduler");function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!s)throw Error(r(227));var a=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,g={},m={};function f(e,t,i,s,n,o,r){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=r}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_[e]=new f(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_[t]=new f(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_[e]=new f(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_[e]=new f(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_[e]=new f(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_[e]=new f(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)}));var b=/[\-:]([a-z])/g;function T(e){return e[1].toUpperCase()}function E(e,t,i,s){var n=_.hasOwnProperty(t)?_[t]:null;(null!==n?0===n.type:!s&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,i,s){if(null==t||function(e,t,i,s){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!s&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,s))return!0;if(s)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,n,s)&&(i=null),s||null===n?function(e){return!!p.call(m,e)||!p.call(g,e)&&(d.test(e)?m[e]=!0:(g[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=null===i?3!==n.type&&"":i:(t=n.attributeName,s=n.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(n=n.type)||4===n&&!0===i?"":""+i,s?e.setAttributeNS(s,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(b,T);_[t]=new f(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(b,T);_[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(b,T);_[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)})),_.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=60103,k=60106,v=60107,C=60108,S=60114,O=60109,A=60110,w=60112,R=60113,N=60120,x=60115,L=60116,$=60121,D=60128,M=60129,B=60130,P=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;I=F("react.element"),k=F("react.portal"),v=F("react.fragment"),C=F("react.strict_mode"),S=F("react.profiler"),O=F("react.provider"),A=F("react.context"),w=F("react.forward_ref"),R=F("react.suspense"),N=F("react.suspense_list"),x=F("react.memo"),L=F("react.lazy"),$=F("react.block"),F("react.scope"),D=F("react.opaque.id"),M=F("react.debug_trace_mode"),B=F("react.offscreen"),P=F("react.legacy_hidden")}var U,H="function"==typeof Symbol&&Symbol.iterator;function G(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=H&&e[H]||e["@@iterator"])?e:null}function V(e){if(void 0===U)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var j=!1;function W(e,t){if(!e||j)return"";j=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var s=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){s=e}e.call(t.prototype)}else{try{throw Error()}catch(e){s=e}e()}}catch(e){if(e&&s&&"string"==typeof e.stack){for(var n=e.stack.split("\n"),o=s.stack.split("\n"),r=n.length-1,a=o.length-1;1<=r&&0<=a&&n[r]!==o[a];)a--;for(;1<=r&&0<=a;r--,a--)if(n[r]!==o[a]){if(1!==r||1!==a)do{if(r--,0>--a||n[r]!==o[a])return"\n"+n[r].replace(" at new "," at ")}while(1<=r&&0<=a);break}}}finally{j=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?V(e):""}function Y(e){switch(e.tag){case 5:return V(e.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return W(e.type,!1);case 11:return W(e.type.render,!1);case 22:return W(e.type._render,!1);case 1:return W(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case v:return"Fragment";case k:return"Portal";case S:return"Profiler";case C:return"StrictMode";case R:return"Suspense";case N:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case O:return(e._context.displayName||"Context")+".Provider";case w:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case x:return z(e.type);case $:return z(e._render);case L:t=e._payload,e=e._init;try{return z(e(t))}catch(e){}}return null}function X(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var n=i.get,o=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){s=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),s="";return e&&(s=K(e)?e.checked?"true":"false":e.value),(e=s)!==i&&(t.setValue(e),!0)}function Z(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var i=t.checked;return n({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function ee(e,t){var i=null==t.defaultValue?"":t.defaultValue,s=null!=t.checked?t.checked:t.defaultChecked;i=X(null!=t.value?t.value:i),e._wrapperState={initialChecked:s,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&E(e,"checked",t,!1)}function ie(e,t){te(e,t);var i=X(t.value),s=t.type;if(null!=i)"number"===s?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===s||"reset"===s)return void e.removeAttribute("value");t.hasOwnProperty("value")?ne(e,t.type,i):t.hasOwnProperty("defaultValue")&&ne(e,t.type,X(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function se(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!("submit"!==s&&"reset"!==s||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ne(e,t,i){"number"===t&&Z(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}function oe(e,t){return e=n({children:void 0},t),(t=function(e){var t="";return s.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function re(e,t,i,s){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&s&&(e[i].defaultSelected=!0)}else{for(i=""+X(i),t=null,n=0;n<e.length;n++){if(e[n].value===i)return e[n].selected=!0,void(s&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return n({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(r(92));if(Array.isArray(i)){if(!(1>=i.length))throw Error(r(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:X(i)}}function ce(e,t){var i=X(t.value),s=X(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=s&&(e.defaultValue=""+s)}function ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he="http://www.w3.org/1999/xhtml",de="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ge(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,fe,_e=(fe=function(e,t){if(e.namespaceURI!==de||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction((function(){return fe(e,t)}))}:fe);function be(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var Te={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ee=["Webkit","ms","Moz","O"];function ye(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||Te.hasOwnProperty(e)&&Te[e]?(""+t).trim():t+"px"}function Ie(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var s=0===i.indexOf("--"),n=ye(i,t[i],s);"float"===i&&(i="cssFloat"),s?e.setProperty(i,n):e[i]=n}}Object.keys(Te).forEach((function(e){Ee.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Te[t]=Te[e]}))}));var ke=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ke[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(r(62))}}function Ce(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Oe=null,Ae=null,we=null;function Re(e){if(e=Qs(e)){if("function"!=typeof Oe)throw Error(r(280));var t=e.stateNode;t&&(t=tn(t),Oe(e.stateNode,e.type,t))}}function Ne(e){Ae?we?we.push(e):we=[e]:Ae=e}function xe(){if(Ae){var e=Ae,t=we;if(we=Ae=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Le(e,t){return e(t)}function $e(e,t,i,s,n){return e(t,i,s,n)}function De(){}var Me=Le,Be=!1,Pe=!1;function Fe(){null===Ae&&null===we||(De(),xe())}function Ue(e,t){var i=e.stateNode;if(null===i)return null;var s=tn(i);if(null===s)return null;i=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(r(231,t,typeof i));return i}var He=!1;if(h)try{var Ge={};Object.defineProperty(Ge,"passive",{get:function(){He=!0}}),window.addEventListener("test",Ge,Ge),window.removeEventListener("test",Ge,Ge)}catch(fe){He=!1}function Ve(e,t,i,s,n,o,r,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var je=!1,We=null,Ye=!1,ze=null,Xe={onError:function(e){je=!0,We=e}};function Ke(e,t,i,s,n,o,r,a,l){je=!1,We=null,Ve.apply(Xe,arguments)}function qe(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ze(e){if(qe(e)!==e)throw Error(r(188))}function Qe(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(r(188));return t!==e?null:e}for(var i=e,s=t;;){var n=i.return;if(null===n)break;var o=n.alternate;if(null===o){if(null!==(s=n.return)){i=s;continue}break}if(n.child===o.child){for(o=n.child;o;){if(o===i)return Ze(n),e;if(o===s)return Ze(n),t;o=o.sibling}throw Error(r(188))}if(i.return!==s.return)i=n,s=o;else{for(var a=!1,l=n.child;l;){if(l===i){a=!0,i=n,s=o;break}if(l===s){a=!0,s=n,i=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===i){a=!0,i=o,s=n;break}if(l===s){a=!0,s=o,i=n;break}l=l.sibling}if(!a)throw Error(r(189))}}if(i.alternate!==s)throw Error(r(190))}if(3!==i.tag)throw Error(r(188));return i.stateNode.current===i?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var i=e.alternate;null!==t;){if(t===e||t===i)return!0;t=t.return}return!1}var tt,it,st,nt,ot=!1,rt=[],at=null,lt=null,ct=null,ut=new Map,ht=new Map,dt=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gt(e,t,i,s,n){return{blockedOn:e,domEventName:t,eventSystemFlags:16|i,nativeEvent:n,targetContainers:[s]}}function mt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":ut.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ht.delete(t.pointerId)}}function ft(e,t,i,s,n,o){return null===e||e.nativeEvent!==o?(e=gt(t,i,s,n,o),null!==t&&null!==(t=Qs(t))&&it(t),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function _t(e){var t=Zs(e.target);if(null!==t){var i=qe(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Je(i)))return e.blockedOn=t,void nt(e.lanePriority,(function(){o.unstable_runWithPriority(e.priority,(function(){st(i)}))}))}else if(3===t&&i.stateNode.hydrate)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=Qs(i))&&it(t),e.blockedOn=i,!1;t.shift()}return!0}function Tt(e,t,i){bt(e)&&i.delete(t)}function Et(){for(ot=!1;0<rt.length;){var e=rt[0];if(null!==e.blockedOn){null!==(e=Qs(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i){e.blockedOn=i;break}t.shift()}null===e.blockedOn&&rt.shift()}null!==at&&bt(at)&&(at=null),null!==lt&&bt(lt)&&(lt=null),null!==ct&&bt(ct)&&(ct=null),ut.forEach(Tt),ht.forEach(Tt)}function yt(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Et)))}function It(e){function t(t){return yt(t,e)}if(0<rt.length){yt(rt[0],e);for(var i=1;i<rt.length;i++){var s=rt[i];s.blockedOn===e&&(s.blockedOn=null)}}for(null!==at&&yt(at,e),null!==lt&&yt(lt,e),null!==ct&&yt(ct,e),ut.forEach(t),ht.forEach(t),i=0;i<dt.length;i++)(s=dt[i]).blockedOn===e&&(s.blockedOn=null);for(;0<dt.length&&null===(i=dt[0]).blockedOn;)_t(i),null===i.blockedOn&&dt.shift()}function kt(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var vt={animationend:kt("Animation","AnimationEnd"),animationiteration:kt("Animation","AnimationIteration"),animationstart:kt("Animation","AnimationStart"),transitionend:kt("Transition","TransitionEnd")},Ct={},St={};function Ot(e){if(Ct[e])return Ct[e];if(!vt[e])return e;var t,i=vt[e];for(t in i)if(i.hasOwnProperty(t)&&t in St)return Ct[e]=i[t];return e}h&&(St=document.createElement("div").style,"AnimationEvent"in window||(delete vt.animationend.animation,delete vt.animationiteration.animation,delete vt.animationstart.animation),"TransitionEvent"in window||delete vt.transitionend.transition);var At=Ot("animationend"),wt=Ot("animationiteration"),Rt=Ot("animationstart"),Nt=Ot("transitionend"),xt=new Map,Lt=new Map,$t=["abort","abort",At,"animationEnd",wt,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Nt,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var i=0;i<e.length;i+=2){var s=e[i],n=e[i+1];n="on"+(n[0].toUpperCase()+n.slice(1)),Lt.set(s,t),xt.set(s,n),c(n,[s])}}(0,o.unstable_now)();var Mt=8;function Bt(e){if(0!=(1&e))return Mt=15,1;if(0!=(2&e))return Mt=14,2;if(0!=(4&e))return Mt=13,4;var t=24&e;return 0!==t?(Mt=12,t):0!=(32&e)?(Mt=11,32):0!=(t=192&e)?(Mt=10,t):0!=(256&e)?(Mt=9,256):0!=(t=3584&e)?(Mt=8,t):0!=(4096&e)?(Mt=7,4096):0!=(t=4186112&e)?(Mt=6,t):0!=(t=62914560&e)?(Mt=5,t):67108864&e?(Mt=4,67108864):0!=(134217728&e)?(Mt=3,134217728):0!=(t=805306368&e)?(Mt=2,t):0!=(1073741824&e)?(Mt=1,1073741824):(Mt=8,e)}function Pt(e,t){var i=e.pendingLanes;if(0===i)return Mt=0;var s=0,n=0,o=e.expiredLanes,r=e.suspendedLanes,a=e.pingedLanes;if(0!==o)s=o,n=Mt=15;else if(0!=(o=134217727&i)){var l=o&~r;0!==l?(s=Bt(l),n=Mt):0!=(a&=o)&&(s=Bt(a),n=Mt)}else 0!=(o=i&~r)?(s=Bt(o),n=Mt):0!==a&&(s=Bt(a),n=Mt);if(0===s)return 0;if(s=i&((0>(s=31-jt(s))?0:1<<s)<<1)-1,0!==t&&t!==s&&0==(t&r)){if(Bt(t),n<=Mt)return t;Mt=n}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=s;0<t;)n=1<<(i=31-jt(t)),s|=e[i],t&=~n;return s}function Ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ht(24&~t))?Ut(10,t):e;case 10:return 0===(e=Ht(192&~t))?Ut(8,t):e;case 8:return 0===(e=Ht(3584&~t))&&0===(e=Ht(4186112&~t))&&(e=512),e;case 2:return 0===(t=Ht(805306368&~t))&&(t=268435456),t}throw Error(r(358,e))}function Ht(e){return e&-e}function Gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Vt(e,t,i){e.pendingLanes|=t;var s=t-1;e.suspendedLanes&=s,e.pingedLanes&=s,(e=e.eventTimes)[t=31-jt(t)]=i}var jt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/Yt|0)|0},Wt=Math.log,Yt=Math.LN2;var zt=o.unstable_UserBlockingPriority,Xt=o.unstable_runWithPriority,Kt=!0;function qt(e,t,i,s){Be||De();var n=Zt,o=Be;Be=!0;try{$e(n,e,t,i,s)}finally{(Be=o)||Fe()}}function Jt(e,t,i,s){Xt(zt,Zt.bind(null,e,t,i,s))}function Zt(e,t,i,s){var n;if(Kt)if((n=0==(4&t))&&0<rt.length&&-1<pt.indexOf(e))e=gt(null,e,t,i,s),rt.push(e);else{var o=Qt(e,t,i,s);if(null===o)n&&mt(e,s);else{if(n){if(-1<pt.indexOf(e))return e=gt(o,e,t,i,s),void rt.push(e);if(function(e,t,i,s,n){switch(t){case"focusin":return at=ft(at,e,t,i,s,n),!0;case"dragenter":return lt=ft(lt,e,t,i,s,n),!0;case"mouseover":return ct=ft(ct,e,t,i,s,n),!0;case"pointerover":var o=n.pointerId;return ut.set(o,ft(ut.get(o)||null,e,t,i,s,n)),!0;case"gotpointercapture":return o=n.pointerId,ht.set(o,ft(ht.get(o)||null,e,t,i,s,n)),!0}return!1}(o,e,t,i,s))return;mt(e,s)}Ns(e,t,s,null,i)}}}function Qt(e,t,i,s){var n=Se(s);if(null!==(n=Zs(n))){var o=qe(n);if(null===o)n=null;else{var r=o.tag;if(13===r){if(null!==(n=Je(o)))return n;n=null}else if(3===r){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null)}}return Ns(e,t,s,n,i),null}var ei=null,ti=null,ii=null;function si(){if(ii)return ii;var e,t,i=ti,s=i.length,n="value"in ei?ei.value:ei.textContent,o=n.length;for(e=0;e<s&&i[e]===n[e];e++);var r=s-e;for(t=1;t<=r&&i[s-t]===n[o-t];t++);return ii=n.slice(e,1<t?1-t:void 0)}function ni(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function oi(){return!0}function ri(){return!1}function ai(e){function t(t,i,s,n,o){for(var r in this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(n):n[r]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?oi:ri,this.isPropagationStopped=ri,this}return n(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oi)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oi)},persist:function(){},isPersistent:oi}),t}var li,ci,ui,hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},di=ai(hi),pi=n({},hi,{view:0,detail:0}),gi=ai(pi),mi=n({},pi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Si,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ui&&(ui&&"mousemove"===e.type?(li=e.screenX-ui.screenX,ci=e.screenY-ui.screenY):ci=li=0,ui=e),li)},movementY:function(e){return"movementY"in e?e.movementY:ci}}),fi=ai(mi),_i=ai(n({},mi,{dataTransfer:0})),bi=ai(n({},pi,{relatedTarget:0})),Ti=ai(n({},hi,{animationName:0,elapsedTime:0,pseudoElement:0})),Ei=ai(n({},hi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),yi=ai(n({},hi,{data:0})),Ii={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ki={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ci(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=vi[e])&&!!t[e]}function Si(){return Ci}var Oi=ai(n({},pi,{key:function(e){if(e.key){var t=Ii[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ni(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ki[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Si,charCode:function(e){return"keypress"===e.type?ni(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ni(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Ai=ai(n({},mi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),wi=ai(n({},pi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Si})),Ri=ai(n({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ni=ai(n({},mi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xi=[9,13,27,32],Li=h&&"CompositionEvent"in window,$i=null;h&&"documentMode"in document&&($i=document.documentMode);var Di=h&&"TextEvent"in window&&!$i,Mi=h&&(!Li||$i&&8<$i&&11>=$i),Bi=String.fromCharCode(32),Pi=!1;function Fi(e,t){switch(e){case"keyup":return-1!==xi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ui(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hi=!1;var Gi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gi[e.type]:"textarea"===t}function ji(e,t,i,s){Ne(s),0<(t=Ls(t,"onChange")).length&&(i=new di("onChange","change",null,i,s),e.push({event:i,listeners:t}))}var Wi=null,Yi=null;function zi(e){Cs(e,0)}function Xi(e){if(J(en(e)))return e}function Ki(e,t){if("change"===e)return t}var qi=!1;if(h){var Ji;if(h){var Zi="oninput"in document;if(!Zi){var Qi=document.createElement("div");Qi.setAttribute("oninput","return;"),Zi="function"==typeof Qi.oninput}Ji=Zi}else Ji=!1;qi=Ji&&(!document.documentMode||9<document.documentMode)}function es(){Wi&&(Wi.detachEvent("onpropertychange",ts),Yi=Wi=null)}function ts(e){if("value"===e.propertyName&&Xi(Yi)){var t=[];if(ji(t,Yi,e,Se(e)),e=zi,Be)e(t);else{Be=!0;try{Le(e,t)}finally{Be=!1,Fe()}}}}function is(e,t,i){"focusin"===e?(es(),Yi=i,(Wi=t).attachEvent("onpropertychange",ts)):"focusout"===e&&es()}function ss(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xi(Yi)}function ns(e,t){if("click"===e)return Xi(t)}function os(e,t){if("input"===e||"change"===e)return Xi(t)}var rs="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},as=Object.prototype.hasOwnProperty;function ls(e,t){if(rs(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(s=0;s<i.length;s++)if(!as.call(t,i[s])||!rs(e[i[s]],t[i[s]]))return!1;return!0}function cs(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function us(e,t){var i,s=cs(e);for(e=0;s;){if(3===s.nodeType){if(i=e+s.textContent.length,e<=t&&i>=t)return{node:s,offset:t-e};e=i}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=cs(s)}}function hs(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hs(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ds(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=Z((e=t.contentWindow).document)}return t}function ps(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var gs=h&&"documentMode"in document&&11>=document.documentMode,ms=null,fs=null,_s=null,bs=!1;function Ts(e,t,i){var s=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;bs||null==ms||ms!==Z(s)||(s="selectionStart"in(s=ms)&&ps(s)?{start:s.selectionStart,end:s.selectionEnd}:{anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},_s&&ls(_s,s)||(_s=s,0<(s=Ls(fs,"onSelect")).length&&(t=new di("onSelect","select",null,t,i),e.push({event:t,listeners:s}),t.target=ms)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt($t,2);for(var Es="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),ys=0;ys<Es.length;ys++)Lt.set(Es[ys],0);u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Is="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ks=new Set("cancel close invalid load scroll toggle".split(" ").concat(Is));function vs(e,t,i){var s=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,s,n,o,a,l,c){if(Ke.apply(this,arguments),je){if(!je)throw Error(r(198));var u=We;je=!1,We=null,Ye||(Ye=!0,ze=u)}}(s,t,void 0,e),e.currentTarget=null}function Cs(e,t){t=0!=(4&t);for(var i=0;i<e.length;i++){var s=e[i],n=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var r=s.length-1;0<=r;r--){var a=s[r],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&n.isPropagationStopped())break e;vs(n,a,c),o=l}else for(r=0;r<s.length;r++){if(l=(a=s[r]).instance,c=a.currentTarget,a=a.listener,l!==o&&n.isPropagationStopped())break e;vs(n,a,c),o=l}}}if(Ye)throw e=ze,Ye=!1,ze=null,e}function Ss(e,t){var i=sn(t),s=e+"__bubble";i.has(s)||(Rs(t,e,2,!1),i.add(s))}var Os="_reactListening"+Math.random().toString(36).slice(2);function As(e){e[Os]||(e[Os]=!0,a.forEach((function(t){ks.has(t)||ws(t,!1,e,null),ws(t,!0,e,null)})))}function ws(e,t,i,s){var n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=i;if("selectionchange"===e&&9!==i.nodeType&&(o=i.ownerDocument),null!==s&&!t&&ks.has(e)){if("scroll"!==e)return;n|=2,o=s}var r=sn(o),a=e+"__"+(t?"capture":"bubble");r.has(a)||(t&&(n|=4),Rs(o,e,n,t),r.add(a))}function Rs(e,t,i,s){var n=Lt.get(t);switch(void 0===n?2:n){case 0:n=qt;break;case 1:n=Jt;break;default:n=Zt}i=n.bind(null,t,i,e),n=void 0,!He||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),s?void 0!==n?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):void 0!==n?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function Ns(e,t,i,s,n){var o=s;if(0==(1&t)&&0==(2&t)&&null!==s)e:for(;;){if(null===s)return;var r=s.tag;if(3===r||4===r){var a=s.stateNode.containerInfo;if(a===n||8===a.nodeType&&a.parentNode===n)break;if(4===r)for(r=s.return;null!==r;){var l=r.tag;if((3===l||4===l)&&((l=r.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;r=r.return}for(;null!==a;){if(null===(r=Zs(a)))return;if(5===(l=r.tag)||6===l){s=o=r;continue e}a=a.parentNode}}s=s.return}!function(e,t,i){if(Pe)return e(t,i);Pe=!0;try{Me(e,t,i)}finally{Pe=!1,Fe()}}((function(){var s=o,n=Se(i),r=[];e:{var a=xt.get(e);if(void 0!==a){var l=di,c=e;switch(e){case"keypress":if(0===ni(i))break e;case"keydown":case"keyup":l=Oi;break;case"focusin":c="focus",l=bi;break;case"focusout":c="blur",l=bi;break;case"beforeblur":case"afterblur":l=bi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=_i;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=wi;break;case At:case wt:case Rt:l=Ti;break;case Nt:l=Ri;break;case"scroll":l=gi;break;case"wheel":l=Ni;break;case"copy":case"cut":case"paste":l=Ei;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ai}var u=0!=(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,g=s;null!==g;){var m=(p=g).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Ue(g,d))&&u.push(xs(g,m,p))),h)break;g=g.return}0<u.length&&(a=new l(a,c,null,i,n),r.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(c=i.relatedTarget||i.fromElement)||!Zs(c)&&!c[qs])&&(l||a)&&(a=n.window===n?n:(a=n.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=s,null!==(c=(c=i.relatedTarget||i.toElement)?Zs(c):null)&&(c!==(h=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=s),l!==c)){if(u=fi,m="onMouseLeave",d="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=Ai,m="onPointerLeave",d="onPointerEnter",g="pointer"),h=null==l?a:en(l),p=null==c?a:en(c),(a=new u(m,g+"leave",l,i,n)).target=h,a.relatedTarget=p,m=null,Zs(n)===s&&((u=new u(d,g+"enter",c,i,n)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,g=0,p=u=l;p;p=$s(p))g++;for(p=0,m=d;m;m=$s(m))p++;for(;0<g-p;)u=$s(u),g--;for(;0<p-g;)d=$s(d),p--;for(;g--;){if(u===d||null!==d&&u===d.alternate)break e;u=$s(u),d=$s(d)}u=null}else u=null;null!==l&&Ds(r,a,l,u,!1),null!==c&&null!==h&&Ds(r,h,c,u,!0)}if("select"===(l=(a=s?en(s):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var f=Ki;else if(Vi(a))if(qi)f=os;else{f=ss;var _=is}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(f=ns);switch(f&&(f=f(e,s))?ji(r,f,i,n):(_&&_(e,a,s),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&ne(a,"number",a.value)),_=s?en(s):window,e){case"focusin":(Vi(_)||"true"===_.contentEditable)&&(ms=_,fs=s,_s=null);break;case"focusout":_s=fs=ms=null;break;case"mousedown":bs=!0;break;case"contextmenu":case"mouseup":case"dragend":bs=!1,Ts(r,i,n);break;case"selectionchange":if(gs)break;case"keydown":case"keyup":Ts(r,i,n)}var b;if(Li)e:{switch(e){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Hi?Fi(e,i)&&(T="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(T="onCompositionStart");T&&(Mi&&"ko"!==i.locale&&(Hi||"onCompositionStart"!==T?"onCompositionEnd"===T&&Hi&&(b=si()):(ti="value"in(ei=n)?ei.value:ei.textContent,Hi=!0)),0<(_=Ls(s,T)).length&&(T=new yi(T,e,null,i,n),r.push({event:T,listeners:_}),(b||null!==(b=Ui(i)))&&(T.data=b))),(b=Di?function(e,t){switch(e){case"compositionend":return Ui(t);case"keypress":return 32!==t.which?null:(Pi=!0,Bi);case"textInput":return(e=t.data)===Bi&&Pi?null:e;default:return null}}(e,i):function(e,t){if(Hi)return"compositionend"===e||!Li&&Fi(e,t)?(e=si(),ii=ti=ei=null,Hi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mi&&"ko"!==t.locale?null:t.data;default:return null}}(e,i))&&0<(s=Ls(s,"onBeforeInput")).length&&(n=new yi("onBeforeInput","beforeinput",null,i,n),r.push({event:n,listeners:s}),n.data=b)}Cs(r,t)}))}function xs(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Ls(e,t){for(var i=t+"Capture",s=[];null!==e;){var n=e,o=n.stateNode;5===n.tag&&null!==o&&(n=o,null!=(o=Ue(e,i))&&s.unshift(xs(e,o,n)),null!=(o=Ue(e,t))&&s.push(xs(e,o,n))),e=e.return}return s}function $s(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ds(e,t,i,s,n){for(var o=t._reactName,r=[];null!==i&&i!==s;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===s)break;5===a.tag&&null!==c&&(a=c,n?null!=(l=Ue(i,o))&&r.unshift(xs(i,l,a)):n||null!=(l=Ue(i,o))&&r.push(xs(i,l,a))),i=i.return}0!==r.length&&e.push({event:t,listeners:r})}function Ms(){}var Bs=null,Ps=null;function Fs(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Us(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Hs="function"==typeof setTimeout?setTimeout:void 0,Gs="function"==typeof clearTimeout?clearTimeout:void 0;function Vs(e){(1===e.nodeType||9===e.nodeType&&null!=(e=e.body))&&(e.textContent="")}function js(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Ws(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var Ys=0;var zs=Math.random().toString(36).slice(2),Xs="__reactFiber$"+zs,Ks="__reactProps$"+zs,qs="__reactContainer$"+zs,Js="__reactEvents$"+zs;function Zs(e){var t=e[Xs];if(t)return t;for(var i=e.parentNode;i;){if(t=i[qs]||i[Xs]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=Ws(e);null!==e;){if(i=e[Xs])return i;e=Ws(e)}return t}i=(e=i).parentNode}return null}function Qs(e){return!(e=e[Xs]||e[qs])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function en(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function tn(e){return e[Ks]||null}function sn(e){var t=e[Js];return void 0===t&&(t=e[Js]=new Set),t}var nn=[],on=-1;function rn(e){return{current:e}}function an(e){0>on||(e.current=nn[on],nn[on]=null,on--)}function ln(e,t){nn[++on]=e.current,e.current=t}var cn={},un=rn(cn),hn=rn(!1),dn=cn;function pn(e,t){var i=e.type.contextTypes;if(!i)return cn;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var n,o={};for(n in i)o[n]=t[n];return s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function gn(e){return null!=e.childContextTypes}function mn(){an(hn),an(un)}function fn(e,t,i){if(un.current!==cn)throw Error(r(168));ln(un,t),ln(hn,i)}function _n(e,t,i){var s=e.stateNode;if(e=t.childContextTypes,"function"!=typeof s.getChildContext)return i;for(var o in s=s.getChildContext())if(!(o in e))throw Error(r(108,z(t)||"Unknown",o));return n({},i,s)}function bn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cn,dn=un.current,ln(un,e),ln(hn,hn.current),!0}function Tn(e,t,i){var s=e.stateNode;if(!s)throw Error(r(169));i?(e=_n(e,t,dn),s.__reactInternalMemoizedMergedChildContext=e,an(hn),an(un),ln(un,e)):an(hn),ln(hn,i)}var En=null,yn=null,In=o.unstable_runWithPriority,kn=o.unstable_scheduleCallback,vn=o.unstable_cancelCallback,Cn=o.unstable_shouldYield,Sn=o.unstable_requestPaint,On=o.unstable_now,An=o.unstable_getCurrentPriorityLevel,wn=o.unstable_ImmediatePriority,Rn=o.unstable_UserBlockingPriority,Nn=o.unstable_NormalPriority,xn=o.unstable_LowPriority,Ln=o.unstable_IdlePriority,$n={},Dn=void 0!==Sn?Sn:function(){},Mn=null,Bn=null,Pn=!1,Fn=On(),Un=1e4>Fn?On:function(){return On()-Fn};function Hn(){switch(An()){case wn:return 99;case Rn:return 98;case Nn:return 97;case xn:return 96;case Ln:return 95;default:throw Error(r(332))}}function Gn(e){switch(e){case 99:return wn;case 98:return Rn;case 97:return Nn;case 96:return xn;case 95:return Ln;default:throw Error(r(332))}}function Vn(e,t){return e=Gn(e),In(e,t)}function jn(e,t,i){return e=Gn(e),kn(e,t,i)}function Wn(){if(null!==Bn){var e=Bn;Bn=null,vn(e)}Yn()}function Yn(){if(!Pn&&null!==Mn){Pn=!0;var e=0;try{var t=Mn;Vn(99,(function(){for(;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}})),Mn=null}catch(t){throw null!==Mn&&(Mn=Mn.slice(e+1)),kn(wn,Wn),t}finally{Pn=!1}}}var zn=y.ReactCurrentBatchConfig;function Xn(e,t){if(e&&e.defaultProps){for(var i in t=n({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}var Kn=rn(null),qn=null,Jn=null,Zn=null;function Qn(){Zn=Jn=qn=null}function eo(e){var t=Kn.current;an(Kn),e.type._context._currentValue=t}function to(e,t){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)===t){if(null===i||(i.childLanes&t)===t)break;i.childLanes|=t}else e.childLanes|=t,null!==i&&(i.childLanes|=t);e=e.return}}function io(e,t){qn=e,Zn=Jn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&($r=!0),e.firstContext=null)}function so(e,t){if(Zn!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Zn=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Jn){if(null===qn)throw Error(r(308));Jn=t,qn.dependencies={lanes:0,firstContext:t,responders:null}}else Jn=Jn.next=t;return e._currentValue}var no=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lo(e,t){if(null!==(e=e.updateQueue)){var i=(e=e.shared).pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}}function co(e,t){var i=e.updateQueue,s=e.alternate;if(null!==s&&i===(s=s.updateQueue)){var n=null,o=null;if(null!==(i=i.firstBaseUpdate)){do{var r={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===o?n=o=r:o=o.next=r,i=i.next}while(null!==i);null===o?n=o=t:o=o.next=t}else n=o=t;return i={baseState:s.baseState,firstBaseUpdate:n,lastBaseUpdate:o,shared:s.shared,effects:s.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function uo(e,t,i,s){var o=e.updateQueue;no=!1;var r=o.firstBaseUpdate,a=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var c=l,u=c.next;c.next=null,null===a?r=u:a.next=u,a=c;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==a&&(null===d?h.firstBaseUpdate=u:d.next=u,h.lastBaseUpdate=c)}}if(null!==r){for(d=o.baseState,a=0,h=u=c=null;;){l=r.lane;var p=r.eventTime;if((s&l)===l){null!==h&&(h=h.next={eventTime:p,lane:0,tag:r.tag,payload:r.payload,callback:r.callback,next:null});e:{var g=e,m=r;switch(l=t,p=i,m.tag){case 1:if("function"==typeof(g=m.payload)){d=g.call(p,d,l);break e}d=g;break e;case 3:g.flags=-4097&g.flags|64;case 0:if(null==(l="function"==typeof(g=m.payload)?g.call(p,d,l):g))break e;d=n({},d,l);break e;case 2:no=!0}}null!==r.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[r]:l.push(r))}else p={eventTime:p,lane:l,tag:r.tag,payload:r.payload,callback:r.callback,next:null},null===h?(u=h=p,c=d):h=h.next=p,a|=l;if(null===(r=r.next)){if(null===(l=o.shared.pending))break;r=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===h&&(c=d),o.baseState=c,o.firstBaseUpdate=u,o.lastBaseUpdate=h,Ba|=a,e.lanes=a,e.memoizedState=d}}function ho(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var s=e[t],n=s.callback;if(null!==n){if(s.callback=null,s=i,"function"!=typeof n)throw Error(r(191,n));n.call(s)}}}var po=(new s.Component).refs;function go(e,t,i,s){i=null==(i=i(s,t=e.memoizedState))?t:n({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var mo={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var s=ll(),n=cl(e),o=ao(s,n);o.payload=t,null!=i&&(o.callback=i),lo(e,o),ul(e,n,s)},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var s=ll(),n=cl(e),o=ao(s,n);o.tag=1,o.payload=t,null!=i&&(o.callback=i),lo(e,o),ul(e,n,s)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ll(),s=cl(e),n=ao(i,s);n.tag=2,null!=t&&(n.callback=t),lo(e,n),ul(e,s,i)}};function fo(e,t,i,s,n,o,r){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,o,r):!(t.prototype&&t.prototype.isPureReactComponent&&ls(i,s)&&ls(n,o))}function _o(e,t,i){var s=!1,n=cn,o=t.contextType;return"object"==typeof o&&null!==o?o=so(o):(n=gn(t)?dn:un.current,o=(s=null!=(s=t.contextTypes))?pn(e,n):cn),t=new t(i,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mo,e.stateNode=t,t._reactInternals=e,s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=o),t}function bo(e,t,i,s){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,s),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,s),t.state!==e&&mo.enqueueReplaceState(t,t.state,null)}function To(e,t,i,s){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs=po,oo(e);var o=t.contextType;"object"==typeof o&&null!==o?n.context=so(o):(o=gn(t)?dn:un.current,n.context=pn(e,o)),uo(e,i,n,s),n.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(go(e,t,o,i),n.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof n.getSnapshotBeforeUpdate||"function"!=typeof n.UNSAFE_componentWillMount&&"function"!=typeof n.componentWillMount||(t=n.state,"function"==typeof n.componentWillMount&&n.componentWillMount(),"function"==typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&mo.enqueueReplaceState(n,n.state,null),uo(e,i,n,s),n.state=e.memoizedState),"function"==typeof n.componentDidMount&&(e.flags|=4)}var Eo=Array.isArray;function yo(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(r(309));var s=i.stateNode}if(!s)throw Error(r(147,e));var n=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===n?t.ref:((t=function(e){var t=s.refs;t===po&&(t=s.refs={}),null===e?delete t[n]:t[n]=e})._stringRef=n,t)}if("string"!=typeof e)throw Error(r(284));if(!i._owner)throw Error(r(290,e))}return e}function Io(e,t){if("textarea"!==e.type)throw Error(r(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function ko(e){function t(t,i){if(e){var s=t.lastEffect;null!==s?(s.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i,i.nextEffect=null,i.flags=8}}function i(i,s){if(!e)return null;for(;null!==s;)t(i,s),s=s.sibling;return null}function s(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function o(t,i,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<i?(t.flags=2,i):s:(t.flags=2,i):i}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,i,s){return null===t||6!==t.tag?((t=Yl(i,e.mode,s)).return=e,t):((t=n(t,i)).return=e,t)}function c(e,t,i,s){return null!==t&&t.elementType===i.type?((s=n(t,i.props)).ref=yo(e,t,i),s.return=e,s):((s=Vl(i.type,i.key,i.props,null,e.mode,s)).ref=yo(e,t,i),s.return=e,s)}function u(e,t,i,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=zl(i,e.mode,s)).return=e,t):((t=n(t,i.children||[])).return=e,t)}function h(e,t,i,s,o){return null===t||7!==t.tag?((t=jl(i,e.mode,s,o)).return=e,t):((t=n(t,i)).return=e,t)}function d(e,t,i){if("string"==typeof t||"number"==typeof t)return(t=Yl(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case I:return(i=Vl(t.type,t.key,t.props,null,e.mode,i)).ref=yo(e,null,t),i.return=e,i;case k:return(t=zl(t,e.mode,i)).return=e,t}if(Eo(t)||G(t))return(t=jl(t,e.mode,i,null)).return=e,t;Io(e,t)}return null}function p(e,t,i,s){var n=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==n?null:l(e,t,""+i,s);if("object"==typeof i&&null!==i){switch(i.$$typeof){case I:return i.key===n?i.type===v?h(e,t,i.props.children,s,n):c(e,t,i,s):null;case k:return i.key===n?u(e,t,i,s):null}if(Eo(i)||G(i))return null!==n?null:h(e,t,i,s,null);Io(e,i)}return null}function g(e,t,i,s,n){if("string"==typeof s||"number"==typeof s)return l(t,e=e.get(i)||null,""+s,n);if("object"==typeof s&&null!==s){switch(s.$$typeof){case I:return e=e.get(null===s.key?i:s.key)||null,s.type===v?h(t,e,s.props.children,n,s.key):c(t,e,s,n);case k:return u(t,e=e.get(null===s.key?i:s.key)||null,s,n)}if(Eo(s)||G(s))return h(t,e=e.get(i)||null,s,n,null);Io(t,s)}return null}function m(n,r,a,l){for(var c=null,u=null,h=r,m=r=0,f=null;null!==h&&m<a.length;m++){h.index>m?(f=h,h=null):f=h.sibling;var _=p(n,h,a[m],l);if(null===_){null===h&&(h=f);break}e&&h&&null===_.alternate&&t(n,h),r=o(_,r,m),null===u?c=_:u.sibling=_,u=_,h=f}if(m===a.length)return i(n,h),c;if(null===h){for(;m<a.length;m++)null!==(h=d(n,a[m],l))&&(r=o(h,r,m),null===u?c=h:u.sibling=h,u=h);return c}for(h=s(n,h);m<a.length;m++)null!==(f=g(h,n,m,a[m],l))&&(e&&null!==f.alternate&&h.delete(null===f.key?m:f.key),r=o(f,r,m),null===u?c=f:u.sibling=f,u=f);return e&&h.forEach((function(e){return t(n,e)})),c}function f(n,a,l,c){var u=G(l);if("function"!=typeof u)throw Error(r(150));if(null==(l=u.call(l)))throw Error(r(151));for(var h=u=null,m=a,f=a=0,_=null,b=l.next();null!==m&&!b.done;f++,b=l.next()){m.index>f?(_=m,m=null):_=m.sibling;var T=p(n,m,b.value,c);if(null===T){null===m&&(m=_);break}e&&m&&null===T.alternate&&t(n,m),a=o(T,a,f),null===h?u=T:h.sibling=T,h=T,m=_}if(b.done)return i(n,m),u;if(null===m){for(;!b.done;f++,b=l.next())null!==(b=d(n,b.value,c))&&(a=o(b,a,f),null===h?u=b:h.sibling=b,h=b);return u}for(m=s(n,m);!b.done;f++,b=l.next())null!==(b=g(m,n,f,b.value,c))&&(e&&null!==b.alternate&&m.delete(null===b.key?f:b.key),a=o(b,a,f),null===h?u=b:h.sibling=b,h=b);return e&&m.forEach((function(e){return t(n,e)})),u}return function(e,s,o,l){var c="object"==typeof o&&null!==o&&o.type===v&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case I:e:{for(u=o.key,c=s;null!==c;){if(c.key===u){switch(c.tag){case 7:if(o.type===v){i(e,c.sibling),(s=n(c,o.props.children)).return=e,e=s;break e}break;default:if(c.elementType===o.type){i(e,c.sibling),(s=n(c,o.props)).ref=yo(e,c,o),s.return=e,e=s;break e}}i(e,c);break}t(e,c),c=c.sibling}o.type===v?((s=jl(o.props.children,e.mode,l,o.key)).return=e,e=s):((l=Vl(o.type,o.key,o.props,null,e.mode,l)).ref=yo(e,s,o),l.return=e,e=l)}return a(e);case k:e:{for(c=o.key;null!==s;){if(s.key===c){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){i(e,s.sibling),(s=n(s,o.children||[])).return=e,e=s;break e}i(e,s);break}t(e,s),s=s.sibling}(s=zl(o,e.mode,l)).return=e,e=s}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==s&&6===s.tag?(i(e,s.sibling),(s=n(s,o)).return=e,e=s):(i(e,s),(s=Yl(o,e.mode,l)).return=e,e=s),a(e);if(Eo(o))return m(e,s,o,l);if(G(o))return f(e,s,o,l);if(u&&Io(e,o),void 0===o&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(r(152,z(e.type)||"Component"))}return i(e,s)}}var vo=ko(!0),Co=ko(!1),So={},Oo=rn(So),Ao=rn(So),wo=rn(So);function Ro(e){if(e===So)throw Error(r(174));return e}function No(e,t){switch(ln(wo,t),ln(Ao,e),ln(Oo,So),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ge(null,"");break;default:t=ge(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}an(Oo),ln(Oo,t)}function xo(){an(Oo),an(Ao),an(wo)}function Lo(e){Ro(wo.current);var t=Ro(Oo.current),i=ge(t,e.type);t!==i&&(ln(Ao,e),ln(Oo,i))}function $o(e){Ao.current===e&&(an(Oo),an(Ao))}var Do=rn(0);function Mo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bo=null,Po=null,Fo=!1;function Uo(e,t){var i=Ul(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=t,i.return=e,i.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Ho(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Go(e){if(Fo){var t=Po;if(t){var i=t;if(!Ho(e,t)){if(!(t=js(i.nextSibling))||!Ho(e,t))return e.flags=-1025&e.flags|2,Fo=!1,void(Bo=e);Uo(Bo,i)}Bo=e,Po=js(t.firstChild)}else e.flags=-1025&e.flags|2,Fo=!1,Bo=e}}function Vo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Bo=e}function jo(e){if(e!==Bo)return!1;if(!Fo)return Vo(e),Fo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Us(t,e.memoizedProps))for(t=Po;t;)Uo(e,t),t=js(t.nextSibling);if(Vo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){Po=js(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}Po=null}}else Po=Bo?js(e.stateNode.nextSibling):null;return!0}function Wo(){Po=Bo=null,Fo=!1}var Yo=[];function zo(){for(var e=0;e<Yo.length;e++)Yo[e]._workInProgressVersionPrimary=null;Yo.length=0}var Xo=y.ReactCurrentDispatcher,Ko=y.ReactCurrentBatchConfig,qo=0,Jo=null,Zo=null,Qo=null,er=!1,tr=!1;function ir(){throw Error(r(321))}function sr(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!rs(e[i],t[i]))return!1;return!0}function nr(e,t,i,s,n,o){if(qo=o,Jo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Xo.current=null===e||null===e.memoizedState?Rr:Nr,e=i(s,n),tr){o=0;do{if(tr=!1,!(25>o))throw Error(r(301));o+=1,Qo=Zo=null,t.updateQueue=null,Xo.current=xr,e=i(s,n)}while(tr)}if(Xo.current=wr,t=null!==Zo&&null!==Zo.next,qo=0,Qo=Zo=Jo=null,er=!1,t)throw Error(r(300));return e}function or(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qo?Jo.memoizedState=Qo=e:Qo=Qo.next=e,Qo}function rr(){if(null===Zo){var e=Jo.alternate;e=null!==e?e.memoizedState:null}else e=Zo.next;var t=null===Qo?Jo.memoizedState:Qo.next;if(null!==t)Qo=t,Zo=e;else{if(null===e)throw Error(r(310));e={memoizedState:(Zo=e).memoizedState,baseState:Zo.baseState,baseQueue:Zo.baseQueue,queue:Zo.queue,next:null},null===Qo?Jo.memoizedState=Qo=e:Qo=Qo.next=e}return Qo}function ar(e,t){return"function"==typeof t?t(e):t}function lr(e){var t=rr(),i=t.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=e;var s=Zo,n=s.baseQueue,o=i.pending;if(null!==o){if(null!==n){var a=n.next;n.next=o.next,o.next=a}s.baseQueue=n=o,i.pending=null}if(null!==n){n=n.next,s=s.baseState;var l=a=o=null,c=n;do{var u=c.lane;if((qo&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),s=c.eagerReducer===e?c.eagerState:e(s,c.action);else{var h={lane:u,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=h,o=s):l=l.next=h,Jo.lanes|=u,Ba|=u}c=c.next}while(null!==c&&c!==n);null===l?o=s:l.next=a,rs(s,t.memoizedState)||($r=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=l,i.lastRenderedState=s}return[t.memoizedState,i.dispatch]}function cr(e){var t=rr(),i=t.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=e;var s=i.dispatch,n=i.pending,o=t.memoizedState;if(null!==n){i.pending=null;var a=n=n.next;do{o=e(o,a.action),a=a.next}while(a!==n);rs(o,t.memoizedState)||($r=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,s]}function ur(e,t,i){var s=t._getVersion;s=s(t._source);var n=t._workInProgressVersionPrimary;if(null!==n?e=n===s:(e=e.mutableReadLanes,(e=(qo&e)===e)&&(t._workInProgressVersionPrimary=s,Yo.push(t))),e)return i(t._source);throw Yo.push(t),Error(r(350))}function hr(e,t,i,s){var n=wa;if(null===n)throw Error(r(349));var o=t._getVersion,a=o(t._source),l=Xo.current,c=l.useState((function(){return ur(n,t,i)})),u=c[1],h=c[0];c=Qo;var d=e.memoizedState,p=d.refs,g=p.getSnapshot,m=d.source;d=d.subscribe;var f=Jo;return e.memoizedState={refs:p,source:t,subscribe:s},l.useEffect((function(){p.getSnapshot=i,p.setSnapshot=u;var e=o(t._source);if(!rs(a,e)){e=i(t._source),rs(h,e)||(u(e),e=cl(f),n.mutableReadLanes|=e&n.pendingLanes),e=n.mutableReadLanes,n.entangledLanes|=e;for(var s=n.entanglements,r=e;0<r;){var l=31-jt(r),c=1<<l;s[l]|=e,r&=~c}}}),[i,t,s]),l.useEffect((function(){return s(t._source,(function(){var e=p.getSnapshot,i=p.setSnapshot;try{i(e(t._source));var s=cl(f);n.mutableReadLanes|=s&n.pendingLanes}catch(e){i((function(){throw e}))}}))}),[t,s]),rs(g,i)&&rs(m,t)&&rs(d,s)||((e={pending:null,dispatch:null,lastRenderedReducer:ar,lastRenderedState:h}).dispatch=u=Ar.bind(null,Jo,e),c.queue=e,c.baseQueue=null,h=ur(n,t,i),c.memoizedState=c.baseState=h),h}function dr(e,t,i){return hr(rr(),e,t,i)}function pr(e){var t=or();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:ar,lastRenderedState:e}).dispatch=Ar.bind(null,Jo,e),[t.memoizedState,e]}function gr(e,t,i,s){return e={tag:e,create:t,destroy:i,deps:s,next:null},null===(t=Jo.updateQueue)?(t={lastEffect:null},Jo.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(s=i.next,i.next=e,e.next=s,t.lastEffect=e),e}function mr(e){return e={current:e},or().memoizedState=e}function fr(){return rr().memoizedState}function _r(e,t,i,s){var n=or();Jo.flags|=e,n.memoizedState=gr(1|t,i,void 0,void 0===s?null:s)}function br(e,t,i,s){var n=rr();s=void 0===s?null:s;var o=void 0;if(null!==Zo){var r=Zo.memoizedState;if(o=r.destroy,null!==s&&sr(s,r.deps))return void gr(t,i,o,s)}Jo.flags|=e,n.memoizedState=gr(1|t,i,o,s)}function Tr(e,t){return _r(516,4,e,t)}function Er(e,t){return br(516,4,e,t)}function yr(e,t){return br(4,2,e,t)}function Ir(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function kr(e,t,i){return i=null!=i?i.concat([e]):null,br(4,2,Ir.bind(null,t,e),i)}function vr(){}function Cr(e,t){var i=rr();t=void 0===t?null:t;var s=i.memoizedState;return null!==s&&null!==t&&sr(t,s[1])?s[0]:(i.memoizedState=[e,t],e)}function Sr(e,t){var i=rr();t=void 0===t?null:t;var s=i.memoizedState;return null!==s&&null!==t&&sr(t,s[1])?s[0]:(e=e(),i.memoizedState=[e,t],e)}function Or(e,t){var i=Hn();Vn(98>i?98:i,(function(){e(!0)})),Vn(97<i?97:i,(function(){var i=Ko.transition;Ko.transition=1;try{e(!1),t()}finally{Ko.transition=i}}))}function Ar(e,t,i){var s=ll(),n=cl(e),o={lane:n,action:i,eagerReducer:null,eagerState:null,next:null},r=t.pending;if(null===r?o.next=o:(o.next=r.next,r.next=o),t.pending=o,r=e.alternate,e===Jo||null!==r&&r===Jo)tr=er=!0;else{if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var a=t.lastRenderedState,l=r(a,i);if(o.eagerReducer=r,o.eagerState=l,rs(l,a))return}catch(e){}ul(e,n,s)}}var wr={readContext:so,useCallback:ir,useContext:ir,useEffect:ir,useImperativeHandle:ir,useLayoutEffect:ir,useMemo:ir,useReducer:ir,useRef:ir,useState:ir,useDebugValue:ir,useDeferredValue:ir,useTransition:ir,useMutableSource:ir,useOpaqueIdentifier:ir,unstable_isNewReconciler:!1},Rr={readContext:so,useCallback:function(e,t){return or().memoizedState=[e,void 0===t?null:t],e},useContext:so,useEffect:Tr,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,_r(4,2,Ir.bind(null,t,e),i)},useLayoutEffect:function(e,t){return _r(4,2,e,t)},useMemo:function(e,t){var i=or();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var s=or();return t=void 0!==i?i(t):t,s.memoizedState=s.baseState=t,e=(e=s.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ar.bind(null,Jo,e),[s.memoizedState,e]},useRef:mr,useState:pr,useDebugValue:vr,useDeferredValue:function(e){var t=pr(e),i=t[0],s=t[1];return Tr((function(){var t=Ko.transition;Ko.transition=1;try{s(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=pr(!1),t=e[0];return mr(e=Or.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,i){var s=or();return s.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:i},hr(s,e,t,i)},useOpaqueIdentifier:function(){if(Fo){var e=!1,t=function(e){return{$$typeof:D,toString:e,valueOf:e}}((function(){throw e||(e=!0,i("r:"+(Ys++).toString(36))),Error(r(355))})),i=pr(t)[1];return 0==(2&Jo.mode)&&(Jo.flags|=516,gr(5,(function(){i("r:"+(Ys++).toString(36))}),void 0,null)),t}return pr(t="r:"+(Ys++).toString(36)),t},unstable_isNewReconciler:!1},Nr={readContext:so,useCallback:Cr,useContext:so,useEffect:Er,useImperativeHandle:kr,useLayoutEffect:yr,useMemo:Sr,useReducer:lr,useRef:fr,useState:function(){return lr(ar)},useDebugValue:vr,useDeferredValue:function(e){var t=lr(ar),i=t[0],s=t[1];return Er((function(){var t=Ko.transition;Ko.transition=1;try{s(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=lr(ar)[0];return[fr().current,e]},useMutableSource:dr,useOpaqueIdentifier:function(){return lr(ar)[0]},unstable_isNewReconciler:!1},xr={readContext:so,useCallback:Cr,useContext:so,useEffect:Er,useImperativeHandle:kr,useLayoutEffect:yr,useMemo:Sr,useReducer:cr,useRef:fr,useState:function(){return cr(ar)},useDebugValue:vr,useDeferredValue:function(e){var t=cr(ar),i=t[0],s=t[1];return Er((function(){var t=Ko.transition;Ko.transition=1;try{s(e)}finally{Ko.transition=t}}),[e]),i},useTransition:function(){var e=cr(ar)[0];return[fr().current,e]},useMutableSource:dr,useOpaqueIdentifier:function(){return cr(ar)[0]},unstable_isNewReconciler:!1},Lr=y.ReactCurrentOwner,$r=!1;function Dr(e,t,i,s){t.child=null===e?Co(t,null,i,s):vo(t,e.child,i,s)}function Mr(e,t,i,s,n){i=i.render;var o=t.ref;return io(t,n),s=nr(e,t,i,s,o,n),null===e||$r?(t.flags|=1,Dr(e,t,s,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~n,ta(e,t,n))}function Br(e,t,i,s,n,o){if(null===e){var r=i.type;return"function"!=typeof r||Hl(r)||void 0!==r.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Vl(i.type,null,s,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Pr(e,t,r,s,n,o))}return r=e.child,0==(n&o)&&(n=r.memoizedProps,(i=null!==(i=i.compare)?i:ls)(n,s)&&e.ref===t.ref)?ta(e,t,o):(t.flags|=1,(e=Gl(r,s)).ref=t.ref,e.return=t,t.child=e)}function Pr(e,t,i,s,n,o){if(null!==e&&ls(e.memoizedProps,s)&&e.ref===t.ref){if($r=!1,0==(o&n))return t.lanes=e.lanes,ta(e,t,o);0!=(16384&e.flags)&&($r=!0)}return Hr(e,t,i,s,o)}function Fr(e,t,i){var s=t.pendingProps,n=s.children,o=null!==e?e.memoizedState:null;if("hidden"===s.mode||"unstable-defer-without-hiding"===s.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},bl(t,i);else{if(0==(1073741824&i))return e=null!==o?o.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},bl(t,e),null;t.memoizedState={baseLanes:0},bl(t,null!==o?o.baseLanes:i)}else null!==o?(s=o.baseLanes|i,t.memoizedState=null):s=i,bl(t,s);return Dr(e,t,n,i),t.child}function Ur(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=128)}function Hr(e,t,i,s,n){var o=gn(i)?dn:un.current;return o=pn(t,o),io(t,n),i=nr(e,t,i,s,o,n),null===e||$r?(t.flags|=1,Dr(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~n,ta(e,t,n))}function Gr(e,t,i,s,n){if(gn(i)){var o=!0;bn(t)}else o=!1;if(io(t,n),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),_o(t,i,s),To(t,i,s,n),s=!0;else if(null===e){var r=t.stateNode,a=t.memoizedProps;r.props=a;var l=r.context,c=i.contextType;c="object"==typeof c&&null!==c?so(c):pn(t,c=gn(i)?dn:un.current);var u=i.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof r.getSnapshotBeforeUpdate;h||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==s||l!==c)&&bo(t,r,s,c),no=!1;var d=t.memoizedState;r.state=d,uo(t,s,r,n),l=t.memoizedState,a!==s||d!==l||hn.current||no?("function"==typeof u&&(go(t,i,u,s),l=t.memoizedState),(a=no||fo(t,i,a,s,d,l,c))?(h||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4)):("function"==typeof r.componentDidMount&&(t.flags|=4),t.memoizedProps=s,t.memoizedState=l),r.props=s,r.state=l,r.context=c,s=a):("function"==typeof r.componentDidMount&&(t.flags|=4),s=!1)}else{r=t.stateNode,ro(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Xn(t.type,a),r.props=c,h=t.pendingProps,d=r.context,l="object"==typeof(l=i.contextType)&&null!==l?so(l):pn(t,l=gn(i)?dn:un.current);var p=i.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==h||d!==l)&&bo(t,r,s,l),no=!1,d=t.memoizedState,r.state=d,uo(t,s,r,n);var g=t.memoizedState;a!==h||d!==g||hn.current||no?("function"==typeof p&&(go(t,i,p,s),g=t.memoizedState),(c=no||fo(t,i,c,s,d,g,l))?(u||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(s,g,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(s,g,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=s,t.memoizedState=g),r.props=s,r.state=g,r.context=l,s=c):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),s=!1)}return Vr(e,t,i,s,o,n)}function Vr(e,t,i,s,n,o){Ur(e,t);var r=0!=(64&t.flags);if(!s&&!r)return n&&Tn(t,i,!1),ta(e,t,o);s=t.stateNode,Lr.current=t;var a=r&&"function"!=typeof i.getDerivedStateFromError?null:s.render();return t.flags|=1,null!==e&&r?(t.child=vo(t,e.child,null,o),t.child=vo(t,null,a,o)):Dr(e,t,a,o),t.memoizedState=s.state,n&&Tn(t,i,!0),t.child}function jr(e){var t=e.stateNode;t.pendingContext?fn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&fn(0,t.context,!1),No(e,t.containerInfo)}var Wr,Yr,zr,Xr,Kr={dehydrated:null,retryLane:0};function qr(e,t,i){var s,n=t.pendingProps,o=Do.current,r=!1;return(s=0!=(64&t.flags))||(s=(null===e||null!==e.memoizedState)&&0!=(2&o)),s?(r=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===n.fallback||!0===n.unstable_avoidThisFallback||(o|=1),ln(Do,1&o),null===e?(void 0!==n.fallback&&Go(t),e=n.children,o=n.fallback,r?(e=Jr(t,e,o,i),t.child.memoizedState={baseLanes:i},t.memoizedState=Kr,e):"number"==typeof n.unstable_expectedLoadTime?(e=Jr(t,e,o,i),t.child.memoizedState={baseLanes:i},t.memoizedState=Kr,t.lanes=33554432,e):((i=Wl({mode:"visible",children:e},t.mode,i,null)).return=t,t.child=i)):(e.memoizedState,r?(n=function(e,t,i,s,n){var o=t.mode,r=e.child;e=r.sibling;var a={mode:"hidden",children:i};return 0==(2&o)&&t.child!==r?((i=t.child).childLanes=0,i.pendingProps=a,null!==(r=i.lastEffect)?(t.firstEffect=i.firstEffect,t.lastEffect=r,r.nextEffect=null):t.firstEffect=t.lastEffect=null):i=Gl(r,a),null!==e?s=Gl(e,s):(s=jl(s,o,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,s}(e,t,n.children,n.fallback,i),r=t.child,o=e.child.memoizedState,r.memoizedState=null===o?{baseLanes:i}:{baseLanes:o.baseLanes|i},r.childLanes=e.childLanes&~i,t.memoizedState=Kr,n):(i=function(e,t,i,s){var n=e.child;return e=n.sibling,i=Gl(n,{mode:"visible",children:i}),0==(2&t.mode)&&(i.lanes=s),i.return=t,i.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=i}(e,t,n.children,i),t.memoizedState=null,i))}function Jr(e,t,i,s){var n=e.mode,o=e.child;return t={mode:"hidden",children:t},0==(2&n)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Wl(t,n,0,null),i=jl(i,n,s,null),o.return=e,i.return=e,o.sibling=i,e.child=o,i}function Zr(e,t){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),to(e.return,t)}function Qr(e,t,i,s,n,o){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:i,tailMode:n,lastEffect:o}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=i,r.tailMode=n,r.lastEffect=o)}function ea(e,t,i){var s=t.pendingProps,n=s.revealOrder,o=s.tail;if(Dr(e,t,s.children,i),0!=(2&(s=Do.current)))s=1&s|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Zr(e,i);else if(19===e.tag)Zr(e,i);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ln(Do,s),0==(2&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;null!==i;)null!==(e=i.alternate)&&null===Mo(e)&&(n=i),i=i.sibling;null===(i=n)?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),Qr(t,!1,n,i,o,t.lastEffect);break;case"backwards":for(i=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===Mo(e)){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}Qr(t,!0,i,null,o,t.lastEffect);break;case"together":Qr(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ta(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Ba|=t.lanes,0!=(i&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(i=Gl(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Gl(e,e.pendingProps)).return=t;i.sibling=null}return t.child}return null}function ia(e,t){if(!Fo)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var s=null;null!==i;)null!==i.alternate&&(s=i),i=i.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function sa(e,t,i){var s=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return gn(t.type)&&mn(),null;case 3:return xo(),an(hn),an(un),zo(),(s=t.stateNode).pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==e&&null!==e.child||(jo(t)?t.flags|=4:s.hydrate||(t.flags|=256)),Yr(t),null;case 5:$o(t);var o=Ro(wo.current);if(i=t.type,null!==e&&null!=t.stateNode)zr(e,t,i,s,o),e.ref!==t.ref&&(t.flags|=128);else{if(!s){if(null===t.stateNode)throw Error(r(166));return null}if(e=Ro(Oo.current),jo(t)){s=t.stateNode,i=t.type;var a=t.memoizedProps;switch(s[Xs]=t,s[Ks]=a,i){case"dialog":Ss("cancel",s),Ss("close",s);break;case"iframe":case"object":case"embed":Ss("load",s);break;case"video":case"audio":for(e=0;e<Is.length;e++)Ss(Is[e],s);break;case"source":Ss("error",s);break;case"img":case"image":case"link":Ss("error",s),Ss("load",s);break;case"details":Ss("toggle",s);break;case"input":ee(s,a),Ss("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!a.multiple},Ss("invalid",s);break;case"textarea":le(s,a),Ss("invalid",s)}for(var c in ve(i,a),e=null,a)a.hasOwnProperty(c)&&(o=a[c],"children"===c?"string"==typeof o?s.textContent!==o&&(e=["children",o]):"number"==typeof o&&s.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(c)&&null!=o&&"onScroll"===c&&Ss("scroll",s));switch(i){case"input":q(s),se(s,a,!0);break;case"textarea":q(s),ue(s);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(s.onclick=Ms)}s=e,t.updateQueue=s,null!==s&&(t.flags|=4)}else{switch(c=9===o.nodeType?o:o.ownerDocument,e===he&&(e=pe(i)),e===he?"script"===i?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof s.is?e=c.createElement(i,{is:s.is}):(e=c.createElement(i),"select"===i&&(c=e,s.multiple?c.multiple=!0:s.size&&(c.size=s.size))):e=c.createElementNS(e,i),e[Xs]=t,e[Ks]=s,Wr(e,t,!1,!1),t.stateNode=e,c=Ce(i,s),i){case"dialog":Ss("cancel",e),Ss("close",e),o=s;break;case"iframe":case"object":case"embed":Ss("load",e),o=s;break;case"video":case"audio":for(o=0;o<Is.length;o++)Ss(Is[o],e);o=s;break;case"source":Ss("error",e),o=s;break;case"img":case"image":case"link":Ss("error",e),Ss("load",e),o=s;break;case"details":Ss("toggle",e),o=s;break;case"input":ee(e,s),o=Q(e,s),Ss("invalid",e);break;case"option":o=oe(e,s);break;case"select":e._wrapperState={wasMultiple:!!s.multiple},o=n({},s,{value:void 0}),Ss("invalid",e);break;case"textarea":le(e,s),o=ae(e,s),Ss("invalid",e);break;default:o=s}ve(i,o);var u=o;for(a in u)if(u.hasOwnProperty(a)){var h=u[a];"style"===a?Ie(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&_e(e,h):"children"===a?"string"==typeof h?("textarea"!==i||""!==h)&&be(e,h):"number"==typeof h&&be(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=h&&"onScroll"===a&&Ss("scroll",e):null!=h&&E(e,a,h,c))}switch(i){case"input":q(e),se(e,s,!1);break;case"textarea":q(e),ue(e);break;case"option":null!=s.value&&e.setAttribute("value",""+X(s.value));break;case"select":e.multiple=!!s.multiple,null!=(a=s.value)?re(e,!!s.multiple,a,!1):null!=s.defaultValue&&re(e,!!s.multiple,s.defaultValue,!0);break;default:"function"==typeof o.onClick&&(e.onclick=Ms)}Fs(i,s)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Xr(e,t,e.memoizedProps,s);else{if("string"!=typeof s&&null===t.stateNode)throw Error(r(166));i=Ro(wo.current),Ro(Oo.current),jo(t)?(s=t.stateNode,i=t.memoizedProps,s[Xs]=t,s.nodeValue!==i&&(t.flags|=4)):((s=(9===i.nodeType?i:i.ownerDocument).createTextNode(s))[Xs]=t,t.stateNode=s)}return null;case 13:return an(Do),s=t.memoizedState,0!=(64&t.flags)?(t.lanes=i,t):(s=null!==s,i=!1,null===e?void 0!==t.memoizedProps.fallback&&jo(t):i=null!==e.memoizedState,s&&!i&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Do.current)?0===$a&&($a=3):(0!==$a&&3!==$a||($a=4),null===wa||0==(134217727&Ba)&&0==(134217727&Pa)||gl(wa,Na))),(s||i)&&(t.flags|=4),null);case 4:return xo(),Yr(t),null===e&&As(t.stateNode.containerInfo),null;case 10:return eo(t),null;case 17:return gn(t.type)&&mn(),null;case 19:if(an(Do),null===(s=t.memoizedState))return null;if(a=0!=(64&t.flags),null===(c=s.rendering))if(a)ia(s,!1);else{if(0!==$a||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Mo(e))){for(t.flags|=64,ia(s,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===s.lastEffect&&(t.firstEffect=null),t.lastEffect=s.lastEffect,s=i,i=t.child;null!==i;)e=s,(a=i).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return ln(Do,1&Do.current|2),t.child}e=e.sibling}null!==s.tail&&Un()>Ga&&(t.flags|=64,a=!0,ia(s,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=Mo(c))){if(t.flags|=64,a=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),ia(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!Fo)return null!==(t=t.lastEffect=s.lastEffect)&&(t.nextEffect=null),null}else 2*Un()-s.renderingStartTime>Ga&&1073741824!==i&&(t.flags|=64,a=!0,ia(s,!1),t.lanes=33554432);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(i=s.last)?i.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(i=s.tail,s.rendering=i,s.tail=i.sibling,s.lastEffect=t.lastEffect,s.renderingStartTime=Un(),i.sibling=null,t=Do.current,ln(Do,a?1&t|2:1&t),i):null;case 23:case 24:return Tl(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==s.mode&&(t.flags|=4),null}throw Error(r(156,t.tag))}function na(e){switch(e.tag){case 1:gn(e.type)&&mn();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(xo(),an(hn),an(un),zo(),0!=(64&(t=e.flags)))throw Error(r(285));return e.flags=-4097&t|64,e;case 5:return $o(e),null;case 13:return an(Do),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return an(Do),null;case 4:return xo(),null;case 10:return eo(e),null;case 23:case 24:return Tl(),null;default:return null}}function oa(e,t){try{var i="",s=t;do{i+=Y(s),s=s.return}while(s);var n=i}catch(e){n="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:n}}function ra(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Wr=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Yr=function(){},zr=function(e,t,i,s){var o=e.memoizedProps;if(o!==s){e=t.stateNode,Ro(Oo.current);var r,a=null;switch(i){case"input":o=Q(e,o),s=Q(e,s),a=[];break;case"option":o=oe(e,o),s=oe(e,s),a=[];break;case"select":o=n({},o,{value:void 0}),s=n({},s,{value:void 0}),a=[];break;case"textarea":o=ae(e,o),s=ae(e,s),a=[];break;default:"function"!=typeof o.onClick&&"function"==typeof s.onClick&&(e.onclick=Ms)}for(h in ve(i,s),i=null,o)if(!s.hasOwnProperty(h)&&o.hasOwnProperty(h)&&null!=o[h])if("style"===h){var c=o[h];for(r in c)c.hasOwnProperty(r)&&(i||(i={}),i[r]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in s){var u=s[h];if(c=null!=o?o[h]:void 0,s.hasOwnProperty(h)&&u!==c&&(null!=u||null!=c))if("style"===h)if(c){for(r in c)!c.hasOwnProperty(r)||u&&u.hasOwnProperty(r)||(i||(i={}),i[r]="");for(r in u)u.hasOwnProperty(r)&&c[r]!==u[r]&&(i||(i={}),i[r]=u[r])}else i||(a||(a=[]),a.push(h,i)),i=u;else"dangerouslySetInnerHTML"===h?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(a=a||[]).push(h,u)):"children"===h?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(h,""+u):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=u&&"onScroll"===h&&Ss("scroll",e),a||c===u||(a=[])):"object"==typeof u&&null!==u&&u.$$typeof===D?u.toString():(a=a||[]).push(h,u))}i&&(a=a||[]).push("style",i);var h=a;(t.updateQueue=h)&&(t.flags|=4)}},Xr=function(e,t,i,s){i!==s&&(t.flags|=4)};var aa="function"==typeof WeakMap?WeakMap:Map;function la(e,t,i){(i=ao(-1,i)).tag=3,i.payload={element:null};var s=t.value;return i.callback=function(){Ya||(Ya=!0,za=s),ra(e,t)},i}function ca(e,t,i){(i=ao(-1,i)).tag=3;var s=e.type.getDerivedStateFromError;if("function"==typeof s){var n=t.value;i.payload=function(){return ra(e,t),s(n)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(i.callback=function(){"function"!=typeof s&&(null===Xa?Xa=new Set([this]):Xa.add(this),ra(e,t));var i=t.stack;this.componentDidCatch(t.value,{componentStack:null!==i?i:""})}),i}var ua="function"==typeof WeakSet?WeakSet:Set;function ha(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ml(e,t)}else t.current=null}function da(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var i=e.memoizedProps,s=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?i:Xn(t.type,i),s),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Vs(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(r(163))}function pa(e,t,i){switch(i.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var s=e.create;e.destroy=s()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var n=e;s=n.next,0!=(4&(n=n.tag))&&0!=(1&n)&&(Ll(i,e),xl(i,e)),e=s}while(e!==t)}return;case 1:return e=i.stateNode,4&i.flags&&(null===t?e.componentDidMount():(s=i.elementType===i.type?t.memoizedProps:Xn(i.type,t.memoizedProps),e.componentDidUpdate(s,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=i.updateQueue)&&ho(i,t,e));case 3:if(null!==(t=i.updateQueue)){if(e=null,null!==i.child)switch(i.child.tag){case 5:e=i.child.stateNode;break;case 1:e=i.child.stateNode}ho(i,t,e)}return;case 5:return e=i.stateNode,void(null===t&&4&i.flags&&Fs(i.type,i.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===i.memoizedState&&(i=i.alternate,null!==i&&(i=i.memoizedState,null!==i&&(i=i.dehydrated,null!==i&&It(i)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(r(163))}function ga(e,t){for(var i=e;;){if(5===i.tag){var s=i.stateNode;if(t)"function"==typeof(s=s.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{s=i.stateNode;var n=i.memoizedProps.style;n=null!=n&&n.hasOwnProperty("display")?n.display:null,s.style.display=ye("display",n)}}else if(6===i.tag)i.stateNode.nodeValue=t?"":i.memoizedProps;else if((23!==i.tag&&24!==i.tag||null===i.memoizedState||i===e)&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function ma(e,t){if(yn&&"function"==typeof yn.onCommitFiberUnmount)try{yn.onCommitFiberUnmount(En,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var s=i,n=s.destroy;if(s=s.tag,void 0!==n)if(0!=(4&s))Ll(t,i);else{s=t;try{n()}catch(e){Ml(s,e)}}i=i.next}while(i!==e)}break;case 1:if(ha(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ml(t,e)}break;case 5:ha(t);break;case 4:ya(e,t)}}function fa(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function _a(e){return 5===e.tag||3===e.tag||4===e.tag}function ba(e){e:{for(var t=e.return;null!==t;){if(_a(t))break e;t=t.return}throw Error(r(160))}var i=t;switch(t=i.stateNode,i.tag){case 5:var s=!1;break;case 3:case 4:t=t.containerInfo,s=!0;break;default:throw Error(r(161))}16&i.flags&&(be(t,""),i.flags&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||_a(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.flags)continue t;if(null===i.child||4===i.tag)continue t;i.child.return=i,i=i.child}if(!(2&i.flags)){i=i.stateNode;break e}}s?Ta(e,i,t):Ea(e,i,t)}function Ta(e,t,i){var s=e.tag,n=5===s||6===s;if(n)e=n?e.stateNode:e.stateNode.instance,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=Ms));else if(4!==s&&null!==(e=e.child))for(Ta(e,t,i),e=e.sibling;null!==e;)Ta(e,t,i),e=e.sibling}function Ea(e,t,i){var s=e.tag,n=5===s||6===s;if(n)e=n?e.stateNode:e.stateNode.instance,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==s&&null!==(e=e.child))for(Ea(e,t,i),e=e.sibling;null!==e;)Ea(e,t,i),e=e.sibling}function ya(e,t){for(var i,s,n=t,o=!1;;){if(!o){o=n.return;e:for(;;){if(null===o)throw Error(r(160));switch(i=o.stateNode,o.tag){case 5:s=!1;break e;case 3:case 4:i=i.containerInfo,s=!0;break e}o=o.return}o=!0}if(5===n.tag||6===n.tag){e:for(var a=e,l=n,c=l;;)if(ma(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}s?(a=i,l=n.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):i.removeChild(n.stateNode)}else if(4===n.tag){if(null!==n.child){i=n.stateNode.containerInfo,s=!0,n.child.return=n,n=n.child;continue}}else if(ma(e,n),null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;4===(n=n.return).tag&&(o=!1)}n.sibling.return=n.return,n=n.sibling}}function Ia(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var s=i=i.next;do{3==(3&s.tag)&&(e=s.destroy,s.destroy=void 0,void 0!==e&&e()),s=s.next}while(s!==i)}return;case 1:return;case 5:if(null!=(i=t.stateNode)){s=t.memoizedProps;var n=null!==e?e.memoizedProps:s;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(i[Ks]=s,"input"===e&&"radio"===s.type&&null!=s.name&&te(i,s),Ce(e,n),t=Ce(e,s),n=0;n<o.length;n+=2){var a=o[n],l=o[n+1];"style"===a?Ie(i,l):"dangerouslySetInnerHTML"===a?_e(i,l):"children"===a?be(i,l):E(i,a,l,t)}switch(e){case"input":ie(i,s);break;case"textarea":ce(i,s);break;case"select":e=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!s.multiple,null!=(o=s.value)?re(i,!!s.multiple,o,!1):e!==!!s.multiple&&(null!=s.defaultValue?re(i,!!s.multiple,s.defaultValue,!0):re(i,!!s.multiple,s.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(r(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((i=t.stateNode).hydrate&&(i.hydrate=!1,It(i.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Ha=Un(),ga(t.child,!0)),void ka(t);case 19:return void ka(t);case 17:return;case 23:case 24:return void ga(t,null!==t.memoizedState)}throw Error(r(163))}function ka(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new ua),t.forEach((function(t){var s=Pl.bind(null,e,t);i.has(t)||(i.add(t),t.then(s,s))}))}}function va(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&null!==(t=t.memoizedState)&&null===t.dehydrated}var Ca=Math.ceil,Sa=y.ReactCurrentDispatcher,Oa=y.ReactCurrentOwner,Aa=0,wa=null,Ra=null,Na=0,xa=0,La=rn(0),$a=0,Da=null,Ma=0,Ba=0,Pa=0,Fa=0,Ua=null,Ha=0,Ga=1/0;function Va(){Ga=Un()+500}var ja,Wa=null,Ya=!1,za=null,Xa=null,Ka=!1,qa=null,Ja=90,Za=[],Qa=[],el=null,tl=0,il=null,sl=-1,nl=0,ol=0,rl=null,al=!1;function ll(){return 0!=(48&Aa)?Un():-1!==sl?sl:sl=Un()}function cl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Hn()?1:2;if(0===nl&&(nl=Ma),0!==zn.transition){0!==ol&&(ol=null!==Ua?Ua.pendingLanes:0),e=nl;var t=4186112&~ol;return 0==(t&=-t)&&0==(t=(e=4186112&~e)&-e)&&(t=8192),t}return e=Hn(),e=Ut(0!=(4&Aa)&&98===e?12:e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),nl)}function ul(e,t,i){if(50<tl)throw tl=0,il=null,Error(r(185));if(null===(e=hl(e,t)))return null;Vt(e,t,i),e===wa&&(Pa|=t,4===$a&&gl(e,Na));var s=Hn();1===t?0!=(8&Aa)&&0==(48&Aa)?ml(e):(dl(e,i),0===Aa&&(Va(),Wn())):(0==(4&Aa)||98!==s&&99!==s||(null===el?el=new Set([e]):el.add(e)),dl(e,i)),Ua=e}function hl(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}function dl(e,t){for(var i=e.callbackNode,s=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-jt(a),c=1<<l,u=o[l];if(-1===u){if(0==(c&s)||0!=(c&n)){u=t,Bt(c);var h=Mt;o[l]=10<=h?u+250:6<=h?u+5e3:-1}}else u<=t&&(e.expiredLanes|=c);a&=~c}if(s=Pt(e,e===wa?Na:0),t=Mt,0===s)null!==i&&(i!==$n&&vn(i),e.callbackNode=null,e.callbackPriority=0);else{if(null!==i){if(e.callbackPriority===t)return;i!==$n&&vn(i)}15===t?(i=ml.bind(null,e),null===Mn?(Mn=[i],Bn=kn(wn,Yn)):Mn.push(i),i=$n):i=14===t?jn(99,ml.bind(null,e)):jn(i=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(r(358,e))}}(t),pl.bind(null,e)),e.callbackPriority=t,e.callbackNode=i}}function pl(e){if(sl=-1,ol=nl=0,0!=(48&Aa))throw Error(r(327));var t=e.callbackNode;if(Nl()&&e.callbackNode!==t)return null;var i=Pt(e,e===wa?Na:0);if(0===i)return null;var s=i,n=Aa;Aa|=16;var o=Il();for(wa===e&&Na===s||(Va(),El(e,s));;)try{Cl();break}catch(t){yl(e,t)}if(Qn(),Sa.current=o,Aa=n,null!==Ra?s=0:(wa=null,Na=0,s=$a),0!=(Ma&Pa))El(e,0);else if(0!==s){if(2===s&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vs(e.containerInfo)),0!==(i=Ft(e))&&(s=kl(e,i))),1===s)throw t=Da,El(e,0),gl(e,i),dl(e,Un()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=i,s){case 0:case 1:throw Error(r(345));case 2:Al(e);break;case 3:if(gl(e,i),(62914560&i)===i&&10<(s=Ha+500-Un())){if(0!==Pt(e,0))break;if(((n=e.suspendedLanes)&i)!==i){ll(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=Hs(Al.bind(null,e),s);break}Al(e);break;case 4:if(gl(e,i),(4186112&i)===i)break;for(s=e.eventTimes,n=-1;0<i;){var a=31-jt(i);o=1<<a,(a=s[a])>n&&(n=a),i&=~o}if(i=n,10<(i=(120>(i=Un()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ca(i/1960))-i)){e.timeoutHandle=Hs(Al.bind(null,e),i);break}Al(e);break;case 5:Al(e);break;default:throw Error(r(329))}}return dl(e,Un()),e.callbackNode===t?pl.bind(null,e):null}function gl(e,t){for(t&=~Fa,t&=~Pa,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-jt(t),s=1<<i;e[i]=-1,t&=~s}}function ml(e){if(0!=(48&Aa))throw Error(r(327));if(Nl(),e===wa&&0!=(e.expiredLanes&Na)){var t=Na,i=kl(e,t);0!=(Ma&Pa)&&(i=kl(e,t=Pt(e,t)))}else i=kl(e,t=Pt(e,0));if(0!==e.tag&&2===i&&(Aa|=64,e.hydrate&&(e.hydrate=!1,Vs(e.containerInfo)),0!==(t=Ft(e))&&(i=kl(e,t))),1===i)throw i=Da,El(e,0),gl(e,t),dl(e,Un()),i;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e),dl(e,Un()),null}function fl(e,t){var i=Aa;Aa|=1;try{return e(t)}finally{0===(Aa=i)&&(Va(),Wn())}}function _l(e,t){var i=Aa;Aa&=-2,Aa|=8;try{return e(t)}finally{0===(Aa=i)&&(Va(),Wn())}}function bl(e,t){ln(La,xa),xa|=t,Ma|=t}function Tl(){xa=La.current,an(La)}function El(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,Gs(i)),null!==Ra)for(i=Ra.return;null!==i;){var s=i;switch(s.tag){case 1:null!=(s=s.type.childContextTypes)&&mn();break;case 3:xo(),an(hn),an(un),zo();break;case 5:$o(s);break;case 4:xo();break;case 13:case 19:an(Do);break;case 10:eo(s);break;case 23:case 24:Tl()}i=i.return}wa=e,Ra=Gl(e.current,null),Na=xa=Ma=t,$a=0,Da=null,Fa=Pa=Ba=0}function yl(e,t){for(;;){var i=Ra;try{if(Qn(),Xo.current=wr,er){for(var s=Jo.memoizedState;null!==s;){var n=s.queue;null!==n&&(n.pending=null),s=s.next}er=!1}if(qo=0,Qo=Zo=Jo=null,tr=!1,Oa.current=null,null===i||null===i.return){$a=1,Da=t,Ra=null;break}e:{var o=e,r=i.return,a=i,l=t;if(t=Na,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(0==(2&a.mode)){var u=a.alternate;u?(a.updateQueue=u.updateQueue,a.memoizedState=u.memoizedState,a.lanes=u.lanes):(a.updateQueue=null,a.memoizedState=null)}var h=0!=(1&Do.current),d=r;do{var p;if(p=13===d.tag){var g=d.memoizedState;if(null!==g)p=null!==g.dehydrated;else{var m=d.memoizedProps;p=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(p){var f=d.updateQueue;if(null===f){var _=new Set;_.add(c),d.updateQueue=_}else f.add(c);if(0==(2&d.mode)){if(d.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var b=ao(-1,1);b.tag=2,lo(a,b)}a.lanes|=1;break e}l=void 0,a=t;var T=o.pingCache;if(null===T?(T=o.pingCache=new aa,l=new Set,T.set(c,l)):void 0===(l=T.get(c))&&(l=new Set,T.set(c,l)),!l.has(a)){l.add(a);var E=Bl.bind(null,o,c,a);c.then(E,E)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);l=Error((z(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==$a&&($a=2),l=oa(l,a),d=r;do{switch(d.tag){case 3:o=l,d.flags|=4096,t&=-t,d.lanes|=t,co(d,la(d,o,t));break e;case 1:o=l;var y=d.type,I=d.stateNode;if(0==(64&d.flags)&&("function"==typeof y.getDerivedStateFromError||null!==I&&"function"==typeof I.componentDidCatch&&(null===Xa||!Xa.has(I)))){d.flags|=4096,t&=-t,d.lanes|=t,co(d,ca(d,o,t));break e}}d=d.return}while(null!==d)}Ol(i)}catch(e){t=e,Ra===i&&null!==i&&(Ra=i=i.return);continue}break}}function Il(){var e=Sa.current;return Sa.current=wr,null===e?wr:e}function kl(e,t){var i=Aa;Aa|=16;var s=Il();for(wa===e&&Na===t||El(e,t);;)try{vl();break}catch(t){yl(e,t)}if(Qn(),Aa=i,Sa.current=s,null!==Ra)throw Error(r(261));return wa=null,Na=0,$a}function vl(){for(;null!==Ra;)Sl(Ra)}function Cl(){for(;null!==Ra&&!Cn();)Sl(Ra)}function Sl(e){var t=ja(e.alternate,e,xa);e.memoizedProps=e.pendingProps,null===t?Ol(e):Ra=t,Oa.current=null}function Ol(e){var t=e;do{var i=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(i=sa(i,t,xa)))return void(Ra=i);if(24!==(i=t).tag&&23!==i.tag||null===i.memoizedState||0!=(1073741824&xa)||0==(4&i.mode)){for(var s=0,n=i.child;null!==n;)s|=n.lanes|n.childLanes,n=n.sibling;i.childLanes=s}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(i=na(t)))return i.flags&=2047,void(Ra=i);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ra=t);Ra=t=e}while(null!==t);0===$a&&($a=5)}function Al(e){var t=Hn();return Vn(99,wl.bind(null,e,t)),null}function wl(e,t){do{Nl()}while(null!==qa);if(0!=(48&Aa))throw Error(r(327));var i=e.finishedWork;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(r(177));e.callbackNode=null;var s=i.lanes|i.childLanes,n=s,o=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<o;){var c=31-jt(o),u=1<<c;n[c]=0,a[c]=-1,l[c]=-1,o&=~u}if(null!==el&&0==(24&s)&&el.has(e)&&el.delete(e),e===wa&&(Ra=wa=null,Na=0),1<i.flags?null!==i.lastEffect?(i.lastEffect.nextEffect=i,s=i.firstEffect):s=i:s=i.firstEffect,null!==s){if(n=Aa,Aa|=32,Oa.current=null,Bs=Kt,ps(a=ds())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else e:if(l=(l=a.ownerDocument)&&l.defaultView||window,(u=l.getSelection&&l.getSelection())&&0!==u.rangeCount){l=u.anchorNode,o=u.anchorOffset,c=u.focusNode,u=u.focusOffset;try{l.nodeType,c.nodeType}catch(e){l=null;break e}var h=0,d=-1,p=-1,g=0,m=0,f=a,_=null;t:for(;;){for(var b;f!==l||0!==o&&3!==f.nodeType||(d=h+o),f!==c||0!==u&&3!==f.nodeType||(p=h+u),3===f.nodeType&&(h+=f.nodeValue.length),null!==(b=f.firstChild);)_=f,f=b;for(;;){if(f===a)break t;if(_===l&&++g===o&&(d=h),_===c&&++m===u&&(p=h),null!==(b=f.nextSibling))break;_=(f=_).parentNode}f=b}l=-1===d||-1===p?null:{start:d,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Ps={focusedElem:a,selectionRange:l},Kt=!1,rl=null,al=!1,Wa=s;do{try{Rl()}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);rl=null,Wa=s;do{try{for(a=e;null!==Wa;){var T=Wa.flags;if(16&T&&be(Wa.stateNode,""),128&T){var E=Wa.alternate;if(null!==E){var y=E.ref;null!==y&&("function"==typeof y?y(null):y.current=null)}}switch(1038&T){case 2:ba(Wa),Wa.flags&=-3;break;case 6:ba(Wa),Wa.flags&=-3,Ia(Wa.alternate,Wa);break;case 1024:Wa.flags&=-1025;break;case 1028:Wa.flags&=-1025,Ia(Wa.alternate,Wa);break;case 4:Ia(Wa.alternate,Wa);break;case 8:ya(a,l=Wa);var I=l.alternate;fa(l),null!==I&&fa(I)}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);if(y=Ps,E=ds(),T=y.focusedElem,a=y.selectionRange,E!==T&&T&&T.ownerDocument&&hs(T.ownerDocument.documentElement,T)){null!==a&&ps(T)&&(E=a.start,void 0===(y=a.end)&&(y=E),"selectionStart"in T?(T.selectionStart=E,T.selectionEnd=Math.min(y,T.value.length)):(y=(E=T.ownerDocument||document)&&E.defaultView||window).getSelection&&(y=y.getSelection(),l=T.textContent.length,I=Math.min(a.start,l),a=void 0===a.end?I:Math.min(a.end,l),!y.extend&&I>a&&(l=a,a=I,I=l),l=us(T,I),o=us(T,a),l&&o&&(1!==y.rangeCount||y.anchorNode!==l.node||y.anchorOffset!==l.offset||y.focusNode!==o.node||y.focusOffset!==o.offset)&&((E=E.createRange()).setStart(l.node,l.offset),y.removeAllRanges(),I>a?(y.addRange(E),y.extend(o.node,o.offset)):(E.setEnd(o.node,o.offset),y.addRange(E))))),E=[];for(y=T;y=y.parentNode;)1===y.nodeType&&E.push({element:y,left:y.scrollLeft,top:y.scrollTop});for("function"==typeof T.focus&&T.focus(),T=0;T<E.length;T++)(y=E[T]).element.scrollLeft=y.left,y.element.scrollTop=y.top}Kt=!!Bs,Ps=Bs=null,e.current=i,Wa=s;do{try{for(T=e;null!==Wa;){var k=Wa.flags;if(36&k&&pa(T,Wa.alternate,Wa),128&k){E=void 0;var v=Wa.ref;if(null!==v){var C=Wa.stateNode;switch(Wa.tag){case 5:E=C;break;default:E=C}"function"==typeof v?v(E):v.current=E}}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(r(330));Ml(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);Wa=null,Dn(),Aa=n}else e.current=i;if(Ka)Ka=!1,qa=e,Ja=t;else for(Wa=s;null!==Wa;)t=Wa.nextEffect,Wa.nextEffect=null,8&Wa.flags&&((k=Wa).sibling=null,k.stateNode=null),Wa=t;if(0===(s=e.pendingLanes)&&(Xa=null),1===s?e===il?tl++:(tl=0,il=e):tl=0,i=i.stateNode,yn&&"function"==typeof yn.onCommitFiberRoot)try{yn.onCommitFiberRoot(En,i,void 0,64==(64&i.current.flags))}catch(e){}if(dl(e,Un()),Ya)throw Ya=!1,e=za,za=null,e;return 0!=(8&Aa)||Wn(),null}function Rl(){for(;null!==Wa;){var e=Wa.alternate;al||null===rl||(0!=(8&Wa.flags)?et(Wa,rl)&&(al=!0):13===Wa.tag&&va(e,Wa)&&et(Wa,rl)&&(al=!0));var t=Wa.flags;0!=(256&t)&&da(e,Wa),0==(512&t)||Ka||(Ka=!0,jn(97,(function(){return Nl(),null}))),Wa=Wa.nextEffect}}function Nl(){if(90!==Ja){var e=97<Ja?97:Ja;return Ja=90,Vn(e,$l)}return!1}function xl(e,t){Za.push(t,e),Ka||(Ka=!0,jn(97,(function(){return Nl(),null})))}function Ll(e,t){Qa.push(t,e),Ka||(Ka=!0,jn(97,(function(){return Nl(),null})))}function $l(){if(null===qa)return!1;var e=qa;if(qa=null,0!=(48&Aa))throw Error(r(331));var t=Aa;Aa|=32;var i=Qa;Qa=[];for(var s=0;s<i.length;s+=2){var n=i[s],o=i[s+1],a=n.destroy;if(n.destroy=void 0,"function"==typeof a)try{a()}catch(e){if(null===o)throw Error(r(330));Ml(o,e)}}for(i=Za,Za=[],s=0;s<i.length;s+=2){n=i[s],o=i[s+1];try{var l=n.create;n.destroy=l()}catch(e){if(null===o)throw Error(r(330));Ml(o,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Aa=t,Wn(),!0}function Dl(e,t,i){lo(e,t=la(e,t=oa(i,t),1)),t=ll(),null!==(e=hl(e,1))&&(Vt(e,1,t),dl(e,t))}function Ml(e,t){if(3===e.tag)Dl(e,e,t);else for(var i=e.return;null!==i;){if(3===i.tag){Dl(i,e,t);break}if(1===i.tag){var s=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&(null===Xa||!Xa.has(s))){var n=ca(i,e=oa(t,e),1);if(lo(i,n),n=ll(),null!==(i=hl(i,1)))Vt(i,1,n),dl(i,n);else if("function"==typeof s.componentDidCatch&&(null===Xa||!Xa.has(s)))try{s.componentDidCatch(t,e)}catch(e){}break}}i=i.return}}function Bl(e,t,i){var s=e.pingCache;null!==s&&s.delete(t),t=ll(),e.pingedLanes|=e.suspendedLanes&i,wa===e&&(Na&i)===i&&(4===$a||3===$a&&(62914560&Na)===Na&&500>Un()-Ha?El(e,0):Fa|=i),dl(e,t)}function Pl(e,t){var i=e.stateNode;null!==i&&i.delete(t),0==(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Hn()?1:2:(0===nl&&(nl=Ma),0===(t=Ht(62914560&~nl))&&(t=4194304))),i=ll(),null!==(e=hl(e,t))&&(Vt(e,t,i),dl(e,i))}function Fl(e,t,i,s){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ul(e,t,i,s){return new Fl(e,t,i,s)}function Hl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var i=e.alternate;return null===i?((i=Ul(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Vl(e,t,i,s,n,o){var a=2;if(s=e,"function"==typeof e)Hl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case v:return jl(i.children,n,o,t);case M:a=8,n|=16;break;case C:a=8,n|=1;break;case S:return(e=Ul(12,i,t,8|n)).elementType=S,e.type=S,e.lanes=o,e;case R:return(e=Ul(13,i,t,n)).type=R,e.elementType=R,e.lanes=o,e;case N:return(e=Ul(19,i,t,n)).elementType=N,e.lanes=o,e;case B:return Wl(i,n,o,t);case P:return(e=Ul(24,i,t,n)).elementType=P,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case O:a=10;break e;case A:a=9;break e;case w:a=11;break e;case x:a=14;break e;case L:a=16,s=null;break e;case $:a=22;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Ul(a,i,t,n)).elementType=e,t.type=s,t.lanes=o,t}function jl(e,t,i,s){return(e=Ul(7,e,s,t)).lanes=i,e}function Wl(e,t,i,s){return(e=Ul(23,e,s,t)).elementType=B,e.lanes=i,e}function Yl(e,t,i){return(e=Ul(6,e,null,t)).lanes=i,e}function zl(e,t,i){return(t=Ul(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xl(e,t,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Gt(0),this.expirationTimes=Gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gt(0),this.mutableSourceEagerHydrationData=null}function Kl(e,t,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==s?null:""+s,children:e,containerInfo:t,implementation:i}}function ql(e,t,i,s){var n=t.current,o=ll(),a=cl(n);e:if(i){t:{if(qe(i=i._reactInternals)!==i||1!==i.tag)throw Error(r(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(gn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(r(171))}if(1===i.tag){var c=i.type;if(gn(c)){i=_n(i,c,l);break e}}i=l}else i=cn;return null===t.context?t.context=i:t.pendingContext=i,(t=ao(o,a)).payload={element:e},null!==(s=void 0===s?null:s)&&(t.callback=s),lo(n,t),ul(n,a,o),a}function Jl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Zl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Ql(e,t){Zl(e,t),(e=e.alternate)&&Zl(e,t)}function ec(e,t,i){var s=null!=i&&null!=i.hydrationOptions&&i.hydrationOptions.mutableSources||null;if(i=new Xl(e,t,null!=i&&!0===i.hydrate),t=Ul(3,null,null,2===t?7:1===t?3:0),i.current=t,t.stateNode=i,oo(t),e[qs]=i.current,As(8===e.nodeType?e.parentNode:e),s)for(e=0;e<s.length;e++){var n=(t=s[e])._getVersion;n=n(t._source),null==i.mutableSourceEagerHydrationData?i.mutableSourceEagerHydrationData=[t,n]:i.mutableSourceEagerHydrationData.push(t,n)}this._internalRoot=i}function tc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ic(e,t,i,s,n){var o=i._reactRootContainer;if(o){var r=o._internalRoot;if("function"==typeof n){var a=n;n=function(){var e=Jl(r);a.call(e)}}ql(t,r,e,n)}else{if(o=i._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var i;i=e.lastChild;)e.removeChild(i);return new ec(e,0,t?{hydrate:!0}:void 0)}(i,s),r=o._internalRoot,"function"==typeof n){var l=n;n=function(){var e=Jl(r);l.call(e)}}_l((function(){ql(t,r,e,n)}))}return Jl(r)}function sc(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!tc(t))throw Error(r(200));return Kl(e,t,null,i)}ja=function(e,t,i){var s=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hn.current)$r=!0;else{if(0==(i&s)){switch($r=!1,t.tag){case 3:jr(t),Wo();break;case 5:Lo(t);break;case 1:gn(t.type)&&bn(t);break;case 4:No(t,t.stateNode.containerInfo);break;case 10:s=t.memoizedProps.value;var n=t.type._context;ln(Kn,n._currentValue),n._currentValue=s;break;case 13:if(null!==t.memoizedState)return 0!=(i&t.child.childLanes)?qr(e,t,i):(ln(Do,1&Do.current),null!==(t=ta(e,t,i))?t.sibling:null);ln(Do,1&Do.current);break;case 19:if(s=0!=(i&t.childLanes),0!=(64&e.flags)){if(s)return ea(e,t,i);t.flags|=64}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),ln(Do,Do.current),s)break;return null;case 23:case 24:return t.lanes=0,Fr(e,t,i)}return ta(e,t,i)}$r=0!=(16384&e.flags)}else $r=!1;switch(t.lanes=0,t.tag){case 2:if(s=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,n=pn(t,un.current),io(t,i),n=nr(null,t,s,e,n,i),t.flags|=1,"object"==typeof n&&null!==n&&"function"==typeof n.render&&void 0===n.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,gn(s)){var o=!0;bn(t)}else o=!1;t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,oo(t);var a=s.getDerivedStateFromProps;"function"==typeof a&&go(t,s,a,e),n.updater=mo,t.stateNode=n,n._reactInternals=t,To(t,s,e,i),t=Vr(null,t,s,!0,o,i)}else t.tag=0,Dr(null,t,n,i),t=t.child;return t;case 16:n=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,n=(o=n._init)(n._payload),t.type=n,o=t.tag=function(e){if("function"==typeof e)return Hl(e)?1:0;if(null!=e){if((e=e.$$typeof)===w)return 11;if(e===x)return 14}return 2}(n),e=Xn(n,e),o){case 0:t=Hr(null,t,n,e,i);break e;case 1:t=Gr(null,t,n,e,i);break e;case 11:t=Mr(null,t,n,e,i);break e;case 14:t=Br(null,t,n,Xn(n.type,e),s,i);break e}throw Error(r(306,n,""))}return t;case 0:return s=t.type,n=t.pendingProps,Hr(e,t,s,n=t.elementType===s?n:Xn(s,n),i);case 1:return s=t.type,n=t.pendingProps,Gr(e,t,s,n=t.elementType===s?n:Xn(s,n),i);case 3:if(jr(t),s=t.updateQueue,null===e||null===s)throw Error(r(282));if(s=t.pendingProps,n=null!==(n=t.memoizedState)?n.element:null,ro(e,t),uo(t,s,null,i),(s=t.memoizedState.element)===n)Wo(),t=ta(e,t,i);else{if((o=(n=t.stateNode).hydrate)&&(Po=js(t.stateNode.containerInfo.firstChild),Bo=t,o=Fo=!0),o){if(null!=(e=n.mutableSourceEagerHydrationData))for(n=0;n<e.length;n+=2)(o=e[n])._workInProgressVersionPrimary=e[n+1],Yo.push(o);for(i=Co(t,null,s,i),t.child=i;i;)i.flags=-3&i.flags|1024,i=i.sibling}else Dr(e,t,s,i),Wo();t=t.child}return t;case 5:return Lo(t),null===e&&Go(t),s=t.type,n=t.pendingProps,o=null!==e?e.memoizedProps:null,a=n.children,Us(s,n)?a=null:null!==o&&Us(s,o)&&(t.flags|=16),Ur(e,t),Dr(e,t,a,i),t.child;case 6:return null===e&&Go(t),null;case 13:return qr(e,t,i);case 4:return No(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=vo(t,null,s,i):Dr(e,t,s,i),t.child;case 11:return s=t.type,n=t.pendingProps,Mr(e,t,s,n=t.elementType===s?n:Xn(s,n),i);case 7:return Dr(e,t,t.pendingProps,i),t.child;case 8:case 12:return Dr(e,t,t.pendingProps.children,i),t.child;case 10:e:{s=t.type._context,n=t.pendingProps,a=t.memoizedProps,o=n.value;var l=t.type._context;if(ln(Kn,l._currentValue),l._currentValue=o,null!==a)if(l=a.value,0==(o=rs(l,o)?0:0|("function"==typeof s._calculateChangedBits?s._calculateChangedBits(l,o):1073741823))){if(a.children===n.children&&!hn.current){t=ta(e,t,i);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===s&&0!=(u.observedBits&o)){1===l.tag&&((u=ao(-1,i&-i)).tag=2,lo(l,u)),l.lanes|=i,null!==(u=l.alternate)&&(u.lanes|=i),to(l.return,i),c.lanes|=i;break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Dr(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,s=(o=t.pendingProps).children,io(t,i),s=s(n=so(n,o.unstable_observedBits)),t.flags|=1,Dr(e,t,s,i),t.child;case 14:return o=Xn(n=t.type,t.pendingProps),Br(e,t,n,o=Xn(n.type,o),s,i);case 15:return Pr(e,t,t.type,t.pendingProps,s,i);case 17:return s=t.type,n=t.pendingProps,n=t.elementType===s?n:Xn(s,n),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,gn(s)?(e=!0,bn(t)):e=!1,io(t,i),_o(t,s,n),To(t,s,n,i),Vr(null,t,s,!0,e,i);case 19:return ea(e,t,i);case 23:case 24:return Fr(e,t,i)}throw Error(r(156,t.tag))},ec.prototype.render=function(e){ql(e,this._internalRoot,null,null)},ec.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;ql(null,e,null,(function(){t[qs]=null}))},tt=function(e){13===e.tag&&(ul(e,4,ll()),Ql(e,4))},it=function(e){13===e.tag&&(ul(e,67108864,ll()),Ql(e,67108864))},st=function(e){if(13===e.tag){var t=ll(),i=cl(e);ul(e,i,t),Ql(e,i)}},nt=function(e,t){return t()},Oe=function(e,t,i){switch(t){case"input":if(ie(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var s=i[t];if(s!==e&&s.form===e.form){var n=tn(s);if(!n)throw Error(r(90));J(s),ie(s,n)}}}break;case"textarea":ce(e,i);break;case"select":null!=(t=i.value)&&re(e,!!i.multiple,t,!1)}},Le=fl,$e=function(e,t,i,s,n){var o=Aa;Aa|=4;try{return Vn(98,e.bind(null,t,i,s,n))}finally{0===(Aa=o)&&(Va(),Wn())}},De=function(){0==(49&Aa)&&(function(){if(null!==el){var e=el;el=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,dl(e,Un())}))}Wn()}(),Nl())},Me=function(e,t){var i=Aa;Aa|=2;try{return e(t)}finally{0===(Aa=i)&&(Va(),Wn())}};var nc={Events:[Qs,en,tn,Ne,xe,Nl,{current:!1}]},oc={findFiberByHostInstance:Zs,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},rc={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ac=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ac.isDisabled&&ac.supportsFiber)try{En=ac.inject(rc),yn=ac}catch(fe){}}i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nc,i.createPortal=sc,i.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(r(188));throw Error(r(268,Object.keys(e)))}return null===(e=Qe(t))?null:e.stateNode},i.flushSync=function(e,t){var i=Aa;if(0!=(48&i))return e(t);Aa|=1;try{if(e)return Vn(99,e.bind(null,t))}finally{Aa=i,Wn()}},i.hydrate=function(e,t,i){if(!tc(t))throw Error(r(200));return ic(null,e,t,!0,i)},i.render=function(e,t,i){if(!tc(t))throw Error(r(200));return ic(null,e,t,!1,i)},i.unmountComponentAtNode=function(e){if(!tc(e))throw Error(r(40));return!!e._reactRootContainer&&(_l((function(){ic(null,null,e,!1,(function(){e._reactRootContainer=null,e[qs]=null}))})),!0)},i.unstable_batchedUpdates=fl,i.unstable_createPortal=function(e,t){return sc(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},i.unstable_renderSubtreeIntoContainer=function(e,t,i,s){if(!tc(i))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ic(e,t,i,!1,s)},i.version="17.0.2"},{"object-assign":202,react:239,scheduler:243}],207:[function(e,t,i){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":206}],208:[function(e,t,i){"use strict";var s="function"==typeof Symbol&&Symbol.for,n=s?Symbol.for("react.element"):60103,o=s?Symbol.for("react.portal"):60106,r=s?Symbol.for("react.fragment"):60107,a=s?Symbol.for("react.strict_mode"):60108,l=s?Symbol.for("react.profiler"):60114,c=s?Symbol.for("react.provider"):60109,u=s?Symbol.for("react.context"):60110,h=s?Symbol.for("react.async_mode"):60111,d=s?Symbol.for("react.concurrent_mode"):60111,p=s?Symbol.for("react.forward_ref"):60112,g=s?Symbol.for("react.suspense"):60113,m=s?Symbol.for("react.suspense_list"):60120,f=s?Symbol.for("react.memo"):60115,_=s?Symbol.for("react.lazy"):60116,b=s?Symbol.for("react.block"):60121,T=s?Symbol.for("react.fundamental"):60117,E=s?Symbol.for("react.responder"):60118,y=s?Symbol.for("react.scope"):60119;function I(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case h:case d:case r:case l:case a:case g:return e;default:switch(e=e&&e.$$typeof){case u:case p:case _:case f:case c:return e;default:return t}}case o:return t}}}function k(e){return I(e)===d}i.AsyncMode=h,i.ConcurrentMode=d,i.ContextConsumer=u,i.ContextProvider=c,i.Element=n,i.ForwardRef=p,i.Fragment=r,i.Lazy=_,i.Memo=f,i.Portal=o,i.Profiler=l,i.StrictMode=a,i.Suspense=g,i.isAsyncMode=function(e){return k(e)||I(e)===h},i.isConcurrentMode=k,i.isContextConsumer=function(e){return I(e)===u},i.isContextProvider=function(e){return I(e)===c},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},i.isForwardRef=function(e){return I(e)===p},i.isFragment=function(e){return I(e)===r},i.isLazy=function(e){return I(e)===_},i.isMemo=function(e){return I(e)===f},i.isPortal=function(e){return I(e)===o},i.isProfiler=function(e){return I(e)===l},i.isStrictMode=function(e){return I(e)===a},i.isSuspense=function(e){return I(e)===g},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===d||e===l||e===a||e===g||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===_||e.$$typeof===f||e.$$typeof===c||e.$$typeof===u||e.$$typeof===p||e.$$typeof===T||e.$$typeof===E||e.$$typeof===y||e.$$typeof===b)},i.typeOf=I},{}],209:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":208}],210:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=i.ReactReduxContext=void 0;var n=s(e("react")).default.createContext(null);i.ReactReduxContext=n;var o=n;i.default=o},{"@babel/runtime/helpers/interopRequireDefault":183,react:239}],211:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default,n=e("@babel/runtime/helpers/interopRequireWildcard").default;i.__esModule=!0,i.default=void 0;var o=n(e("react")),r=(s(e("prop-types")),e("./Context")),a=e("../utils/Subscription"),l=e("../utils/useIsomorphicLayoutEffect");var c=function(e){var t=e.store,i=e.context,s=e.children,n=(0,o.useMemo)((function(){var e=(0,a.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,o.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=n.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[n,c]);var u=i||r.ReactReduxContext;return o.default.createElement(u.Provider,{value:n},s)};i.default=c},{"../utils/Subscription":226,"../utils/useIsomorphicLayoutEffect":232,"./Context":210,"@babel/runtime/helpers/interopRequireDefault":183,"@babel/runtime/helpers/interopRequireWildcard":184,"prop-types":204,react:239}],212:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default,n=e("@babel/runtime/helpers/interopRequireWildcard").default;i.__esModule=!0,i.default=function(e,t){void 0===t&&(t={});var i=t,s=i.getDisplayName,n=void 0===s?function(e){return"ConnectAdvanced("+e+")"}:s,h=i.methodName,I=void 0===h?"connectAdvanced":h,k=i.renderCountProp,v=void 0===k?void 0:k,C=i.shouldHandleStateChanges,S=void 0===C||C,O=i.storeKey,A=void 0===O?"store":O,w=(i.withRef,i.forwardRef),R=void 0!==w&&w,N=i.context,x=void 0===N?d.ReactReduxContext:N,L=(0,r.default)(i,p),$=x;return function(t){var i=t.displayName||t.name||"Component",s=n(i),h=(0,o.default)({},L,{getDisplayName:n,methodName:I,renderCountProp:v,shouldHandleStateChanges:S,storeKey:A,displayName:s,wrappedComponentName:i,WrappedComponent:t}),d=L.pure,p=d?l.useMemo:function(e){return e()};function k(i){var s=(0,l.useMemo)((function(){var e=i.reactReduxForwardedRef,t=(0,r.default)(i,g);return[i.context,e,t]}),[i]),n=s[0],a=s[1],d=s[2],I=(0,l.useMemo)((function(){return n&&n.Consumer&&(0,c.isContextConsumer)(l.default.createElement(n.Consumer,null))?n:$}),[n,$]),k=(0,l.useContext)(I),v=Boolean(i.store)&&Boolean(i.store.getState)&&Boolean(i.store.dispatch);Boolean(k)&&Boolean(k.store);var C=v?i.store:k.store,O=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,h)}(C)}),[C]),A=(0,l.useMemo)((function(){if(!S)return f;var e=(0,u.createSubscription)(C,v?null:k.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[C,v,k]),w=A[0],R=A[1],N=(0,l.useMemo)((function(){return v?k:(0,o.default)({},k,{subscription:w})}),[v,k,w]),x=(0,l.useReducer)(_,m,y),L=x[0][0],D=x[1];if(L&&L.error)throw L.error;var M=(0,l.useRef)(),B=(0,l.useRef)(d),P=(0,l.useRef)(),F=(0,l.useRef)(!1),U=p((function(){return P.current&&d===B.current?P.current:O(C.getState(),d)}),[C,L,d]);b(T,[B,M,F,d,U,P,R]),b(E,[S,C,w,O,B,M,F,P,R,D],[C,w,O]);var H=(0,l.useMemo)((function(){return l.default.createElement(t,(0,o.default)({},U,{ref:a}))}),[a,t,U]);return(0,l.useMemo)((function(){return S?l.default.createElement(I.Provider,{value:N},H):H}),[I,H,N])}var C=d?l.default.memo(k):k;if(C.WrappedComponent=t,C.displayName=k.displayName=s,R){var O=l.default.forwardRef((function(e,t){return l.default.createElement(C,(0,o.default)({},e,{reactReduxForwardedRef:t}))}));return O.displayName=s,O.WrappedComponent=t,(0,a.default)(O,t)}return(0,a.default)(C,t)}};var o=s(e("@babel/runtime/helpers/extends")),r=s(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),a=s(e("hoist-non-react-statics")),l=n(e("react")),c=e("react-is"),u=e("../utils/Subscription"),h=e("../utils/useIsomorphicLayoutEffect"),d=e("./Context"),p=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],g=["reactReduxForwardedRef"],m=[],f=[null,null];function _(e,t){var i=e[1];return[t.payload,i+1]}function b(e,t,i){(0,h.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),i)}function T(e,t,i,s,n,o,r){e.current=s,t.current=n,i.current=!1,o.current&&(o.current=null,r())}function E(e,t,i,s,n,o,r,a,l,c){if(e){var u=!1,h=null,d=function(){if(!u){var e,i,d=t.getState();try{e=s(d,n.current)}catch(e){i=e,h=e}i||(h=null),e===o.current?r.current||l():(o.current=e,a.current=e,r.current=!0,c({type:"STORE_UPDATED",payload:{error:i}}))}};return i.onStateChange=d,i.trySubscribe(),d(),function(){if(u=!0,i.tryUnsubscribe(),i.onStateChange=null,h)throw h}}}var y=function(){return[null,0]}},{"../utils/Subscription":226,"../utils/useIsomorphicLayoutEffect":232,"./Context":210,"@babel/runtime/helpers/extends":182,"@babel/runtime/helpers/interopRequireDefault":183,"@babel/runtime/helpers/interopRequireWildcard":184,"@babel/runtime/helpers/objectWithoutPropertiesLoose":186,"hoist-non-react-statics":201,react:239,"react-is":236}],213:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.createConnect=m,i.default=void 0;var n=s(e("@babel/runtime/helpers/extends")),o=s(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),r=s(e("../components/connectAdvanced")),a=s(e("../utils/shallowEqual")),l=s(e("./mapDispatchToProps")),c=s(e("./mapStateToProps")),u=s(e("./mergeProps")),h=s(e("./selectorFactory")),d=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function p(e,t,i){for(var s=t.length-1;s>=0;s--){var n=t[s](e);if(n)return n}return function(t,s){throw new Error("Invalid value of type "+typeof e+" for "+i+" argument when connecting component "+s.wrappedComponentName+".")}}function g(e,t){return e===t}function m(e){var t=void 0===e?{}:e,i=t.connectHOC,s=void 0===i?r.default:i,m=t.mapStateToPropsFactories,f=void 0===m?c.default:m,_=t.mapDispatchToPropsFactories,b=void 0===_?l.default:_,T=t.mergePropsFactories,E=void 0===T?u.default:T,y=t.selectorFactory,I=void 0===y?h.default:y;return function(e,t,i,r){void 0===r&&(r={});var l=r,c=l.pure,u=void 0===c||c,h=l.areStatesEqual,m=void 0===h?g:h,_=l.areOwnPropsEqual,T=void 0===_?a.default:_,y=l.areStatePropsEqual,k=void 0===y?a.default:y,v=l.areMergedPropsEqual,C=void 0===v?a.default:v,S=(0,o.default)(l,d),O=p(e,f,"mapStateToProps"),A=p(t,b,"mapDispatchToProps"),w=p(i,E,"mergeProps");return s(I,(0,n.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:O,initMapDispatchToProps:A,initMergeProps:w,pure:u,areStatesEqual:m,areOwnPropsEqual:T,areStatePropsEqual:k,areMergedPropsEqual:C},S))}}var f=m();i.default=f},{"../components/connectAdvanced":212,"../utils/shallowEqual":231,"./mapDispatchToProps":214,"./mapStateToProps":215,"./mergeProps":216,"./selectorFactory":217,"@babel/runtime/helpers/extends":182,"@babel/runtime/helpers/interopRequireDefault":183,"@babel/runtime/helpers/objectWithoutPropertiesLoose":186}],214:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=void 0,i.whenMapDispatchToPropsIsFunction=r,i.whenMapDispatchToPropsIsMissing=a,i.whenMapDispatchToPropsIsObject=l;var n=s(e("../utils/bindActionCreators")),o=e("./wrapMapToProps");function r(e){return"function"==typeof e?(0,o.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,o.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,o.wrapMapToPropsConstant)((function(t){return(0,n.default)(e,t)})):void 0}var c=[r,a,l];i.default=c},{"../utils/bindActionCreators":228,"./wrapMapToProps":219,"@babel/runtime/helpers/interopRequireDefault":183}],215:[function(e,t,i){"use strict";i.__esModule=!0,i.default=void 0,i.whenMapStateToPropsIsFunction=n,i.whenMapStateToPropsIsMissing=o;var s=e("./wrapMapToProps");function n(e){return"function"==typeof e?(0,s.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,s.wrapMapToPropsConstant)((function(){return{}}))}var r=[n,o];i.default=r},{"./wrapMapToProps":219}],216:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=void 0,i.defaultMergeProps=o,i.whenMergePropsIsFunction=a,i.whenMergePropsIsOmitted=l,i.wrapMergePropsFunc=r;var n=s(e("@babel/runtime/helpers/extends"));s(e("../utils/verifyPlainObject"));function o(e,t,i){return(0,n.default)({},i,e,t)}function r(e){return function(t,i){i.displayName;var s,n=i.pure,o=i.areMergedPropsEqual,r=!1;return function(t,i,a){var l=e(t,i,a);return r?n&&o(l,s)||(s=l):(r=!0,s=l),s}}}function a(e){return"function"==typeof e?r(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];i.default=c},{"../utils/verifyPlainObject":233,"@babel/runtime/helpers/extends":182,"@babel/runtime/helpers/interopRequireDefault":183}],217:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t){var i=t.initMapStateToProps,s=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,n.default)(t,o),u=i(e,c),h=s(e,c),d=l(e,c);return(c.pure?a:r)(u,h,d,e,c)},i.impureFinalPropsSelectorFactory=r,i.pureFinalPropsSelectorFactory=a;var n=s(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),o=(s(e("./verifySubselectors")),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function r(e,t,i,s){return function(n,o){return i(e(n,o),t(s,o),o)}}function a(e,t,i,s,n){var o,r,a,l,c,u=n.areStatesEqual,h=n.areOwnPropsEqual,d=n.areStatePropsEqual,p=!1;function g(n,p){var g,m,f=!h(p,r),_=!u(n,o,p,r);return o=n,r=p,f&&_?(a=e(o,r),t.dependsOnOwnProps&&(l=t(s,r)),c=i(a,l,r)):f?(e.dependsOnOwnProps&&(a=e(o,r)),t.dependsOnOwnProps&&(l=t(s,r)),c=i(a,l,r)):_?(g=e(o,r),m=!d(g,a),a=g,m&&(c=i(a,l,r)),c):c}return function(n,u){return p?g(n,u):(a=e(o=n,r=u),l=t(s,r),c=i(a,l,r),p=!0,c)}}},{"./verifySubselectors":218,"@babel/runtime/helpers/interopRequireDefault":183,"@babel/runtime/helpers/objectWithoutPropertiesLoose":186}],218:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t,i,s){o(e,"mapStateToProps",s),o(t,"mapDispatchToProps",s),o(i,"mergeProps",s)};var n=s(e("../utils/warning"));function o(e,t,i){if(!e)throw new Error("Unexpected value for "+t+" in "+i+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,n.default)("The selector for "+t+" of "+i+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":234,"@babel/runtime/helpers/interopRequireDefault":183}],219:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.getDependsOnOwnProps=n,i.wrapMapToPropsConstant=function(e){return function(t,i){var s=e(t,i);function n(){return s}return n.dependsOnOwnProps=!1,n}},i.wrapMapToPropsFunc=function(e,t){return function(t,i){i.displayName;var s=function(e,t){return s.dependsOnOwnProps?s.mapToProps(e,t):s.mapToProps(e)};return s.dependsOnOwnProps=!0,s.mapToProps=function(t,i){s.mapToProps=e,s.dependsOnOwnProps=n(e);var o=s(t,i);return"function"==typeof o&&(s.mapToProps=o,s.dependsOnOwnProps=n(o),o=s(t,i)),o},s}};s(e("../utils/verifyPlainObject"));function n(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":233,"@babel/runtime/helpers/interopRequireDefault":183}],220:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0;var n=s(e("./components/Provider"));i.Provider=n.default;var o=s(e("./components/connectAdvanced"));i.connectAdvanced=o.default;var r=e("./components/Context");i.ReactReduxContext=r.ReactReduxContext;var a=s(e("./connect/connect"));i.connect=a.default;var l=e("./hooks/useDispatch");i.useDispatch=l.useDispatch,i.createDispatchHook=l.createDispatchHook;var c=e("./hooks/useSelector");i.useSelector=c.useSelector,i.createSelectorHook=c.createSelectorHook;var u=e("./hooks/useStore");i.useStore=u.useStore,i.createStoreHook=u.createStoreHook;var h=s(e("./utils/shallowEqual"));i.shallowEqual=h.default},{"./components/Context":210,"./components/Provider":211,"./components/connectAdvanced":212,"./connect/connect":213,"./hooks/useDispatch":221,"./hooks/useSelector":223,"./hooks/useStore":224,"./utils/shallowEqual":231,"@babel/runtime/helpers/interopRequireDefault":183}],221:[function(e,t,i){"use strict";i.__esModule=!0,i.createDispatchHook=o,i.useDispatch=void 0;var s=e("../components/Context"),n=e("./useStore");function o(e){void 0===e&&(e=s.ReactReduxContext);var t=e===s.ReactReduxContext?n.useStore:(0,n.createStoreHook)(e);return function(){return t().dispatch}}var r=o();i.useDispatch=r},{"../components/Context":210,"./useStore":224}],222:[function(e,t,i){"use strict";i.__esModule=!0,i.useReduxContext=function(){return(0,s.useContext)(n.ReactReduxContext)};var s=e("react"),n=e("../components/Context")},{"../components/Context":210,react:239}],223:[function(e,t,i){"use strict";i.__esModule=!0,i.createSelectorHook=c,i.useSelector=void 0;var s=e("react"),n=e("./useReduxContext"),o=e("../utils/Subscription"),r=e("../utils/useIsomorphicLayoutEffect"),a=e("../components/Context"),l=function(e,t){return e===t};function c(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?n.useReduxContext:function(){return(0,s.useContext)(e)};return function(e,i){void 0===i&&(i=l);var n=t(),a=function(e,t,i,n){var a,l=(0,s.useReducer)((function(e){return e+1}),0)[1],c=(0,s.useMemo)((function(){return(0,o.createSubscription)(i,n)}),[i,n]),u=(0,s.useRef)(),h=(0,s.useRef)(),d=(0,s.useRef)(),p=(0,s.useRef)(),g=i.getState();try{if(e!==h.current||g!==d.current||u.current){var m=e(g);a=void 0!==p.current&&t(m,p.current)?p.current:m}else a=p.current}catch(e){throw u.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\n"),e}return(0,r.useIsomorphicLayoutEffect)((function(){h.current=e,d.current=g,p.current=a,u.current=void 0})),(0,r.useIsomorphicLayoutEffect)((function(){function e(){try{var e=i.getState();if(e===d.current)return;var s=h.current(e);if(t(s,p.current))return;p.current=s,d.current=e}catch(e){u.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[i,c]),a}(e,i,n.store,n.subscription);return(0,s.useDebugValue)(a),a}}var u=c();i.useSelector=u},{"../components/Context":210,"../utils/Subscription":226,"../utils/useIsomorphicLayoutEffect":232,"./useReduxContext":222,react:239}],224:[function(e,t,i){"use strict";i.__esModule=!0,i.createStoreHook=r,i.useStore=void 0;var s=e("react"),n=e("../components/Context"),o=e("./useReduxContext");function r(e){void 0===e&&(e=n.ReactReduxContext);var t=e===n.ReactReduxContext?o.useReduxContext:function(){return(0,s.useContext)(e)};return function(){return t().store}}var a=r();i.useStore=a},{"../components/Context":210,"./useReduxContext":222,react:239}],225:[function(e,t,i){"use strict";i.__esModule=!0;var s={batch:!0},n=e("./exports");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(s,e)||e in i&&i[e]===n[e]||(i[e]=n[e]))}));var o=e("./utils/reactBatchedUpdates");i.batch=o.unstable_batchedUpdates,(0,e("./utils/batch").setBatch)(o.unstable_batchedUpdates)},{"./exports":220,"./utils/batch":227,"./utils/reactBatchedUpdates":230}],226:[function(e,t,i){"use strict";i.__esModule=!0,i.createSubscription=function(e,t){var i,o=n;function r(){l.onStateChange&&l.onStateChange()}function a(){i||(i=t?t.addNestedSub(r):e.subscribe(r),o=function(){var e=(0,s.getBatch)(),t=null,i=null;return{clear:function(){t=null,i=null},notify:function(){e((function(){for(var e=t;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],i=t;i;)e.push(i),i=i.next;return e},subscribe:function(e){var s=!0,n=i={callback:e,next:null,prev:i};return n.prev?n.prev.next=n:t=n,function(){s&&null!==t&&(s=!1,n.next?n.next.prev=n.prev:i=n.prev,n.prev?n.prev.next=n.next:t=n.next)}}}}())}var l={addNestedSub:function(e){return a(),o.subscribe(e)},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:r,isSubscribed:function(){return Boolean(i)},trySubscribe:a,tryUnsubscribe:function(){i&&(i(),i=void 0,o.clear(),o=n)},getListeners:function(){return o}};return l};var s=e("./batch");var n={notify:function(){},get:function(){return[]}}},{"./batch":227}],227:[function(e,t,i){"use strict";i.__esModule=!0,i.setBatch=i.getBatch=void 0;var s=function(e){e()};i.setBatch=function(e){return s=e};i.getBatch=function(){return s}},{}],228:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e,t){var i={},s=function(s){var n=e[s];"function"==typeof n&&(i[s]=function(){return t(n.apply(void 0,arguments))})};for(var n in e)s(n);return i}},{}],229:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i}},{}],230:[function(e,t,i){"use strict";i.__esModule=!0,i.unstable_batchedUpdates=void 0;var s=e("react-dom");i.unstable_batchedUpdates=s.unstable_batchedUpdates},{"react-dom":207}],231:[function(e,t,i){"use strict";function s(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}i.__esModule=!0,i.default=function(e,t){if(s(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(var o=0;o<i.length;o++)if(!Object.prototype.hasOwnProperty.call(t,i[o])||!s(e[i[o]],t[i[o]]))return!1;return!0}},{}],232:[function(e,t,i){"use strict";i.__esModule=!0,i.useIsomorphicLayoutEffect=void 0;var s=e("react"),n="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?s.useLayoutEffect:s.useEffect;i.useIsomorphicLayoutEffect=n},{react:239}],233:[function(e,t,i){"use strict";var s=e("@babel/runtime/helpers/interopRequireDefault").default;i.__esModule=!0,i.default=function(e,t,i){(0,n.default)(e)||(0,o.default)(i+"() in "+t+" must return a plain object. Instead received "+e+".")};var n=s(e("./isPlainObject")),o=s(e("./warning"))},{"./isPlainObject":229,"./warning":234,"@babel/runtime/helpers/interopRequireDefault":183}],234:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],235:[function(e,t,i){"use strict";var s=60103,n=60106,o=60107,r=60108,a=60114,l=60109,c=60110,u=60112,h=60113,d=60120,p=60115,g=60116,m=60121,f=60122,_=60117,b=60129,T=60131;if("function"==typeof Symbol&&Symbol.for){var E=Symbol.for;s=E("react.element"),n=E("react.portal"),o=E("react.fragment"),r=E("react.strict_mode"),a=E("react.profiler"),l=E("react.provider"),c=E("react.context"),u=E("react.forward_ref"),h=E("react.suspense"),d=E("react.suspense_list"),p=E("react.memo"),g=E("react.lazy"),m=E("react.block"),f=E("react.server.block"),_=E("react.fundamental"),b=E("react.debug_trace_mode"),T=E("react.legacy_hidden")}function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case s:switch(e=e.type){case o:case a:case r:case h:case d:return e;default:switch(e=e&&e.$$typeof){case c:case u:case g:case p:case l:return e;default:return t}}case n:return t}}}var I=l,k=s,v=u,C=o,S=g,O=p,A=n,w=a,R=r,N=h;i.ContextConsumer=c,i.ContextProvider=I,i.Element=k,i.ForwardRef=v,i.Fragment=C,i.Lazy=S,i.Memo=O,i.Portal=A,i.Profiler=w,i.StrictMode=R,i.Suspense=N,i.isAsyncMode=function(){return!1},i.isConcurrentMode=function(){return!1},i.isContextConsumer=function(e){return y(e)===c},i.isContextProvider=function(e){return y(e)===l},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===s},i.isForwardRef=function(e){return y(e)===u},i.isFragment=function(e){return y(e)===o},i.isLazy=function(e){return y(e)===g},i.isMemo=function(e){return y(e)===p},i.isPortal=function(e){return y(e)===n},i.isProfiler=function(e){return y(e)===a},i.isStrictMode=function(e){return y(e)===r},i.isSuspense=function(e){return y(e)===h},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===a||e===b||e===r||e===h||e===d||e===T||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===p||e.$$typeof===l||e.$$typeof===c||e.$$typeof===u||e.$$typeof===_||e.$$typeof===m||e[0]===f)},i.typeOf=y},{}],236:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":235}],237:[function(e,t,i){"use strict";e("object-assign");var s=e("react"),n=60103;if(i.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;n=o("react.element"),i.Fragment=o("react.fragment")}var r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var s,o={},c=null,u=null;for(s in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,s)&&!l.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:n,type:e,key:c,ref:u,props:o,_owner:r.current}}i.jsx=c,i.jsxs=c},{"object-assign":202,react:239}],238:[function(e,t,i){"use strict";var s=e("object-assign"),n=60103,o=60106;i.Fragment=60107,i.StrictMode=60108,i.Profiler=60114;var r=60109,a=60110,l=60112;i.Suspense=60113;var c=60115,u=60116;if("function"==typeof Symbol&&Symbol.for){var h=Symbol.for;n=h("react.element"),o=h("react.portal"),i.Fragment=h("react.fragment"),i.StrictMode=h("react.strict_mode"),i.Profiler=h("react.profiler"),r=h("react.provider"),a=h("react.context"),l=h("react.forward_ref"),i.Suspense=h("react.suspense"),c=h("react.memo"),u=h("react.lazy")}var d="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function f(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}function _(){}function b(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=f.prototype;var T=b.prototype=new _;T.constructor=b,s(T,f.prototype),T.isPureReactComponent=!0;var E={current:null},y=Object.prototype.hasOwnProperty,I={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,i){var s,o={},r=null,a=null;if(null!=t)for(s in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(r=""+t.key),t)y.call(t,s)&&!I.hasOwnProperty(s)&&(o[s]=t[s]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===o[s]&&(o[s]=l[s]);return{$$typeof:n,type:e,key:r,ref:a,props:o,_owner:E.current}}function v(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function S(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,i,s,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case o:l=!0}}if(l)return r=r(l=e),e=""===s?"."+S(l,0):s,Array.isArray(r)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),O(r,t,i,"",(function(e){return e}))):null!=r&&(v(r)&&(r=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(r,i+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(C,"$&/")+"/")+e)),t.push(r)),1;if(l=0,s=""===s?".":s+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=s+S(a=e[c],c);l+=O(a,t,i,u,r)}else if("function"==typeof(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e)))for(e=u.call(e),c=0;!(a=e.next()).done;)l+=O(a=a.value,t,i,u=s+S(a,c++),r);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,i){if(null==e)return e;var s=[],n=0;return O(e,s,"","",(function(e){return t.call(i,e,n++)})),s}function w(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var R={current:null};function N(){var e=R.current;if(null===e)throw Error(p(321));return e}var x={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:E,IsSomeRendererActing:{current:!1},assign:s};i.Children={map:A,forEach:function(e,t,i){A(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!v(e))throw Error(p(143));return e}},i.Component=f,i.PureComponent=b,i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x,i.cloneElement=function(e,t,i){if(null==e)throw Error(p(267,e));var o=s({},e.props),r=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=E.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)y.call(t,u)&&!I.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=i;else if(1<u){c=Array(u);for(var h=0;h<u;h++)c[h]=arguments[h+2];o.children=c}return{$$typeof:n,type:e.type,key:r,ref:a,props:o,_owner:l}},i.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:r,_context:e},e.Consumer=e},i.createElement=k,i.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},i.createRef=function(){return{current:null}},i.forwardRef=function(e){return{$$typeof:l,render:e}},i.isValidElement=v,i.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:w}},i.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},i.useCallback=function(e,t){return N().useCallback(e,t)},i.useContext=function(e,t){return N().useContext(e,t)},i.useDebugValue=function(){},i.useEffect=function(e,t){return N().useEffect(e,t)},i.useImperativeHandle=function(e,t,i){return N().useImperativeHandle(e,t,i)},i.useLayoutEffect=function(e,t){return N().useLayoutEffect(e,t)},i.useMemo=function(e,t){return N().useMemo(e,t)},i.useReducer=function(e,t,i){return N().useReducer(e,t,i)},i.useRef=function(e){return N().useRef(e)},i.useState=function(e){return N().useState(e)},i.version="17.0.2"},{"object-assign":202}],239:[function(e,t,i){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":238}],240:[function(e,t,i){"use strict";t.exports=e("./cjs/react-jsx-runtime.production.min.js")},{"./cjs/react-jsx-runtime.production.min.js":237}],241:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("@babel/runtime/helpers/objectSpread2");var n,o=(n=s)&&"object"==typeof n&&"default"in n?n:{default:n};function r(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var a="function"==typeof Symbol&&Symbol.observable||"@@observable",l=function(){return Math.random().toString(36).substring(7).split("").join(".")},c={INIT:"@@redux/INIT"+l(),REPLACE:"@@redux/REPLACE"+l(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+l()}};function u(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function h(e,t,i){var s;if("function"==typeof t&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===i&&(i=t,t=void 0),void 0!==i){if("function"!=typeof i)throw new Error(r(1));return i(h)(e,t)}if("function"!=typeof e)throw new Error(r(2));var n=e,o=t,l=[],d=l,p=!1;function g(){d===l&&(d=l.slice())}function m(){if(p)throw new Error(r(3));return o}function f(e){if("function"!=typeof e)throw new Error(r(4));if(p)throw new Error(r(5));var t=!0;return g(),d.push(e),function(){if(t){if(p)throw new Error(r(6));t=!1,g();var i=d.indexOf(e);d.splice(i,1),l=null}}}function _(e){if(!u(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if(p)throw new Error(r(9));try{p=!0,o=n(o,e)}finally{p=!1}for(var t=l=d,i=0;i<t.length;i++)(0,t[i])();return e}return _({type:c.INIT}),(s={dispatch:_,subscribe:f,getState:m,replaceReducer:function(e){if("function"!=typeof e)throw new Error(r(10));n=e,_({type:c.REPLACE})}})[a]=function(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(r(11));function i(){e.next&&e.next(m())}return i(),{unsubscribe:t(i)}}})[a]=function(){return this},e},s}var d=h;function p(e,t){return function(){return t(e.apply(this,arguments))}}function g(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}i.__DO_NOT_USE__ActionTypes=c,i.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(){var i=e.apply(void 0,arguments),s=function(){throw new Error(r(15))},n={getState:i.getState,dispatch:function(){return s.apply(void 0,arguments)}},a=t.map((function(e){return e(n)}));return s=g.apply(void 0,a)(i.dispatch),o.default(o.default({},i),{},{dispatch:s})}}},i.bindActionCreators=function(e,t){if("function"==typeof e)return p(e,t);if("object"!=typeof e||null===e)throw new Error(r(16));var i={};for(var s in e){var n=e[s];"function"==typeof n&&(i[s]=p(n,t))}return i},i.combineReducers=function(e){for(var t=Object.keys(e),i={},s=0;s<t.length;s++){var n=t[s];"function"==typeof e[n]&&(i[n]=e[n])}var o,a=Object.keys(i);try{!function(e){Object.keys(e).forEach((function(t){var i=e[t];if(void 0===i(void 0,{type:c.INIT}))throw new Error(r(12));if(void 0===i(void 0,{type:c.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(i)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var s=!1,n={},l=0;l<a.length;l++){var c=a[l],u=i[c],h=e[c],d=u(h,t);if(void 0===d)throw t&&t.type,new Error(r(14));n[c]=d,s=s||d!==h}return(s=s||a.length!==Object.keys(e).length)?n:e}},i.compose=g,i.createStore=h,i.legacy_createStore=d},{"@babel/runtime/helpers/objectSpread2":185}],242:[function(e,t,i){"use strict";var s,n,o,r;if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var u=null,h=null,d=function(){if(null!==u)try{var e=i.unstable_now();u(!0,e),u=null}catch(e){throw setTimeout(d,0),e}};s=function(e){null!==u?setTimeout(s,0,e):(u=e,setTimeout(d,0))},n=function(e,t){h=setTimeout(e,t)},o=function(){clearTimeout(h)},i.unstable_shouldYield=function(){return!1},r=i.unstable_forceFrameRate=function(){}}else{var p=window.setTimeout,g=window.clearTimeout;if("undefined"!=typeof console){var m=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var f=!1,_=null,b=-1,T=5,E=0;i.unstable_shouldYield=function(){return i.unstable_now()>=E},r=function(){},i.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5};var y=new MessageChannel,I=y.port2;y.port1.onmessage=function(){if(null!==_){var e=i.unstable_now();E=e+T;try{_(!0,e)?I.postMessage(null):(f=!1,_=null)}catch(e){throw I.postMessage(null),e}}else f=!1},s=function(e){_=e,f||(f=!0,I.postMessage(null))},n=function(e,t){b=p((function(){e(i.unstable_now())}),t)},o=function(){g(b),b=-1}}function k(e,t){var i=e.length;e.push(t);e:for(;;){var s=i-1>>>1,n=e[s];if(!(void 0!==n&&0<S(n,t)))break e;e[s]=t,e[i]=n,i=s}}function v(e){return void 0===(e=e[0])?null:e}function C(e){var t=e[0];if(void 0!==t){var i=e.pop();if(i!==t){e[0]=i;e:for(var s=0,n=e.length;s<n;){var o=2*(s+1)-1,r=e[o],a=o+1,l=e[a];if(void 0!==r&&0>S(r,i))void 0!==l&&0>S(l,r)?(e[s]=l,e[a]=i,s=a):(e[s]=r,e[o]=i,s=o);else{if(!(void 0!==l&&0>S(l,i)))break e;e[s]=l,e[a]=i,s=a}}}return t}return null}function S(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}var O=[],A=[],w=1,R=null,N=3,x=!1,L=!1,$=!1;function D(e){for(var t=v(A);null!==t;){if(null===t.callback)C(A);else{if(!(t.startTime<=e))break;C(A),t.sortIndex=t.expirationTime,k(O,t)}t=v(A)}}function M(e){if($=!1,D(e),!L)if(null!==v(O))L=!0,s(B);else{var t=v(A);null!==t&&n(M,t.startTime-e)}}function B(e,t){L=!1,$&&($=!1,o()),x=!0;var s=N;try{for(D(t),R=v(O);null!==R&&(!(R.expirationTime>t)||e&&!i.unstable_shouldYield());){var r=R.callback;if("function"==typeof r){R.callback=null,N=R.priorityLevel;var a=r(R.expirationTime<=t);t=i.unstable_now(),"function"==typeof a?R.callback=a:R===v(O)&&C(O),D(t)}else C(O);R=v(O)}if(null!==R)var l=!0;else{var c=v(A);null!==c&&n(M,c.startTime-t),l=!1}return l}finally{R=null,N=s,x=!1}}var P=r;i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(e){e.callback=null},i.unstable_continueExecution=function(){L||x||(L=!0,s(B))},i.unstable_getCurrentPriorityLevel=function(){return N},i.unstable_getFirstCallbackNode=function(){return v(O)},i.unstable_next=function(e){switch(N){case 1:case 2:case 3:var t=3;break;default:t=N}var i=N;N=t;try{return e()}finally{N=i}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=P,i.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=N;N=e;try{return t()}finally{N=i}},i.unstable_scheduleCallback=function(e,t,r){var a=i.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?a+r:a,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:w++,callback:t,priorityLevel:e,startTime:r,expirationTime:l=r+l,sortIndex:-1},r>a?(e.sortIndex=r,k(A,e),null===v(O)&&e===v(A)&&($?o():$=!0,n(M,r-a))):(e.sortIndex=l,k(O,e),L||x||(L=!0,s(B))),e},i.unstable_wrapCallback=function(e){var t=N;return function(){var i=N;N=t;try{return e.apply(this,arguments)}finally{N=i}}}},{}],243:[function(e,t,i){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":242}]},{},[131]);